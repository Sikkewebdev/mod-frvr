(function(){function r(s,l,_){function o(t,e){if(!l[t]){if(!s[t]){var a="function"==typeof require&&require
if(!e&&a)return a(t,!0)
if(c)return c(t,!0)
var i=new Error("Cannot find module '"+t+"'")
throw i.code="MODULE_NOT_FOUND",i}var n=l[t]={exports:{}}
s[t][0].call(n.exports,function(e){return o(s[t][1][e]||e)},n,n.exports,r,s,l,_)}return l[t].exports}for(var c="function"==typeof require&&require,e=0;e<_.length;e++)o(_[e])
return o}return r})()({1:[function(e,t,r){"use strict"
r.abTestFBLoginButton=abTestFBLoginButton
r.abTestWorldsPostStartup=abTestWorldsPostStartup
r.abTestWorldsStartup=abTestWorldsStartup
var a=e("../glov/client/abtest")
var i=a.abTestGet
var o=a.abTestRegister
var n=e("./analytics").logEvent
function abTestFBLoginButton(){return"yes"===i("fblogin")}var s={}
function analyticsABTest(e,t){var r="abtest_"+e
if(s)s[r]=t
else n(r,void 0,void 0,t)}function abTestWorldsPostStartup(){for(var e in s)n(e,void 0,void 0,s[e])
s=null}function abTestWorldsStartup(){o({name:"fblogin",values:["yes"],scope:"client",permanent:true,cb:analyticsABTest.bind(null,"fblogin")})}},{"../glov/client/abtest":288,"./analytics":6}],2:[function(e,t,r){"use strict"
r.accessControlStartup=accessControlStartup
r.accessControlGetUserContext=accessControlGetUserContext
r.accessControlGetUser=accessControlGetUser
r.accessControlRun=accessControlRun
r.doAccessControl=doAccessControl
var x=e("../glov/client/auto_reset").autoResetSkippedFrames
var a=e("../glov/client/cmds").cmd_parse
var M=e("../glov/client/font").ALIGN
var D=e("../glov/client/input")
var c=e("../glov/client/net").netUserId
var P=e("../glov/client/scroll_area").scrollAreaCreate
var i=e("../glov/client/selection_box")
var B=i.dropDown
var k=i.dropDownCreate
var U=e("../glov/client/ui")
var o=e("../glov/client/ui")
var n=o.uiButtonHeight
var G=o.uiButtonWidth
var s=o.uiGetFont
var l=o.uiGetTitleFont
var F=e("../glov/common/util").nop
var _=e("../glov/common/vmath")
var u=_.v3add
var d=_.vec3
var f=e("../common/editvolume_common")
var v=f.EDITVOLUME_MAX_SIZE
var h=f.volumeContainsPoint
var p=e("../common/globals").CHUNK_SIZE
var m=e("../common/world_constants")
var W=m.ACCESS_ADMIN
var H=m.ACCESS_AREA_BUILDER
var z=m.ACCESS_BUILDER
var E=m.ACCESS_OWNER
var V=m.ACCESS_READONLY
var Y=m.VOLUME_SETTLEMENT_PREFIX
var g=e("./editvolume_client")
var j=g.editVolumeAddHereCmd
var K=g.editVolumeClearContents
var q=g.editVolumeDefaultAccess
var T=g.editVolumeForPos
var y=e("./layout")
var X=y.layoutCameraCurX1
var Q=y.layoutCameraCurY1
var $=y.layoutWide
var J=e("./localization/localization").L
var S=e("./main")
var I=S.charControllerPos
var ee=S.menuExit
var A=S.toggleMenuPage
var w=e("./menu")
var L=w.ACCESS_CONTROL
var O=w.menuInteractGetPos
var R=w.menuPanelX0
var te=e("./status")
var b=e("./styles")
var N=b.color_line
var re=b.label_style
var ae=b.label_warning_style
var ie=b.menu_header_style
var oe=e("./ui_util")
var C=e("./user_data")
var ne=C.areaClearAllowed
var se=C.manageVolumesAllowed
var le=e("./voxel_data").worldPosFromLocalPos
var _e=e("./waygate_ui")
var ce=_e.FONT_HEIGHT
var ue=_e.PAD
var de=e("./world_comm").worldGetRoles
var fe=e("./world_info_view")
var ve=fe.UserQueueState
var he=fe.accessString
var pe=fe.displayUserList
var me=fe.getSkyOptions
var Ee=fe.worldCmdParseGated
var ge=fe.worldGetUserList
var Te=fe.worldInfoModifyingAccess
var ye=e("./world_metadata").worldAccessDefault
var Se=Math.abs,Ie=Math.max
var Ae
var we
function accessControlStartup(){Ae=s()
we=l()}a.register({cmd:"area_access_control",help:"Open the Area Access Control interface",access_run:["world_areabuilder"],func:function func(e,t){A(L)
t()}})
var Le=[{name:J.LBL_ACCESS_PRESET_READONLY,tag:"readonly"},{name:J.LBL_ACCESS_PRESET_BUILD,tag:"builder"}]
var Oe=100
var Re=254
function lineSep(e,t,r){U.drawLine(e-40,t,e+40,t,r+.1,2,1,N)
return 8}var be
var Ne
var Ce
function userAccessFromVolume(e,t){var r=e&&e.access&&e.access.ids
if(r){var a=r[t]
if(a){Ce=false
return a.level}}Ce=true
return q(e)}function accessControlGetUserContext(){var e=de().world_admin
if(!be)return{is_world_admin:e}
var t=userAccessFromVolume(be,c())
return{my_volume_access:t,is_world_admin:e,is_volume_admin:t>=W,is_volume_owner:t>=E,mcid:null==be?void 0:be.mcid,volume_id:null==be?void 0:be.volume_id}}var xe={loading:false,allow_actions:false}
function accessControlGetUser(e,t,r){if(!be)return xe
var a=e.is_world_admin,i=e.is_volume_admin,o=e.my_volume_access
if(!a&&!i)return xe
var n=Te()
var s=false
if(a&&t!==c())s=true
var l=userAccessFromVolume(be,t)
var _=Ce
if(i&&o>l)s=true
if(!a)if(Ne[t])if(Ne[t].world_admin)s=false
return{loading:n,allow_actions:s,access:he(l),access_from_default:_}}function volumeLost(){ee()
te.push(J.ACCESSCONTROL_AREA_LOST)}var Me=[J.LBL_AREA_COORDS_X,J.LBL_AREA_COORDS_Y,J.LBL_AREA_COORDS_Z]
function displayResizeControls(e){var s=e.edit_volume,n=e.x,t=e.w,l=e.y,_=e.local_pos
var r=n
var a=.3*t
var c=Te()
function mod(e,t,r){var a={min:s.min.slice(0),max:s.max.slice(0)}
a[t][e]+=r*p
var i="world_volume_bounds "+s.mcid+" "+s.volume_id+" "+a.min+" "+a.max
var o=false
if(_){var n=le(d(),_)
if(h(s,n)&&!h(a,n))o=true}if(o)U.modalDialog({text:J.DLG_MOVE_WARN_MSG,buttons:{ok:function ok(){Ee(i,volumeLost)},cancel:null}})
else Ee(i,function(e){if(e&&"ERR_MISSING_MC"===e)U.modalDialog({title:J.DLG_ERR_MODIFYING_WORLD_TITLE,text:J.DLG_ERR_RESIZE_BOUNDS_MSG,buttons:{OK:null}})})}function button(e,t,r){var a="min"===t?"max":"min"
var i=s[t][e]+r*p
var o=s[a][e]
if(U.buttonText({x:n,y:l,w:Oe,h:Oe,font_height:Oe,disabled:c||i===o||Se(i-o)>v,text:r<0?"-":"+"}))mod(e,t,r)
n+=Oe+ue}function text(e,t,r){if(r)Ae.draw({style:ie,x:n,y:l-ce,w:e,align:M.HCENTERFIT,size:ce,text:r})
Ae.draw({style:re,x:n,y:l,w:e,h:Oe,align:M.HVCENTERFIT,size:ce,text:t})
n+=e+ue}var i=Oe
l+=ue+ce
for(var o=0;o<3;++o){n=r+(t-a-2*i-4*Oe-6*ue)/2
button(o,"min",-1)
text(i,String(s.min[o]),0===o&&J.LBL_AREA_COORDS_MIN)
button(o,"min",1)
text(a,J.$(Me[o],s.max[o]-s.min[o]),0===o&&J.LBL_AREA_COORDS_SIZE)
button(o,"max",-1)
text(i,String(s.max[o]),0===o&&J.LBL_AREA_COORDS_MAX)
button(o,"max",1)
l+=Oe+ue}return l}function drawUserListHeader(e,t){var r=t===ve.OFFLINE?e.can_manage_access?J.LBL_USERS_OFFLINE:J.LBL_AREA_OWNER:J.LBL_AREA_ACCESS_FOR_NEARBY_BUILDERS
if(r===e.last_header)return
e.last_header=r
if(!e.first_header)e.y+=8
e.first_header=false
we.drawSizedAligned(ie,e.x,e.y,e.z+1,1.5*ce,M.HCENTER,e.w,0,r)
e.y+=1.5*ce+8
e.y+=lineSep(e.x+e.w/2,e.y,e.z)}var De
var Pe
var Be
function accessControlRun(e,t,r,a){var i
var o=x("accessControlRun")
if(o){Be=true
if(Pe)Pe.resetScroll()}if(!o&&be&&!r){volumeLost()
return}be=r
var n=se()
var s=Z.UI
var l=X()-e
var _=e+l/2
var c=e+l/3
var u=t+8
var d=Te()
if(!r&&!n){u+=Ae.draw({style:ae,x:e,y:u,z:s,w:l,size:ce,align:M.HWRAP|M.HCENTER,text:J.ACCESSCONTROL_CANNOT_CREATE})+ue
return}if(!r){if(U.buttonText({text:J.BTN_CREATE_AREA,font_height:ce,w:G(),h:Oe,x:_-G()/2,y:u,disabled:d}))Ee(j(null,a),F)
return}var f=accessControlGetUserContext().is_volume_admin||n
var v=r.volume_id.startsWith(Y)
var h=n&&!v
var p=q(r)
if(f){Ae.draw({style:re,x:c-8,y:u,z:s,h:Oe,size:ce,align:M.HRIGHT|M.VCENTER,text:J.LBL_ACCESS_PRESET})
if(!De)De=k({z:Z.UI,width:2*Re,auto_reset:false,entry_height:Oe,display:{centered:true},items:Le,font_height:ce})
if(!d&&!De.dropdown_visible)De.selected=p===V?0:1
De.run({x:c,y:u,disabled:d})
if(De.was_clicked&&!d)if("builder"===De.getSelected().tag)Ee("world_volume_access "+r.mcid+" "+r.volume_id+" default BUILDER",F)
else Ee("world_volume_access "+r.mcid+" "+r.volume_id+" default READONLY",F)
u+=Oe+ue}else u+=Ae.draw({style:ae,x:e,y:u,z:s,w:l,size:ce,align:M.HWRAP|M.HCENTER,text:J.ACCESSCONTROL_CANNOT_MANAGE})+ue
u+=ue
var m=e
var E=l
var g=Q()-u
if($()){m+=(E-1e3)/2
E=1e3}if(!Pe)Pe=P({auto_hide:true,background_color:null})
Pe.begin({x:m,y:u,w:E,h:g})
u=0
_=E/2
var T=E-Pe.barWidth()
if(f){var y
if(p===V)y=J.ACCESSCONTROL_READONLY_NOTE
if(!y&&p===z)if(ye()!==H)y=J.ACCESSCONTROL_WORLD_PRESET_NOTE
if(y)u+=Ae.draw({style:re,x:0,y:u,z:s,w:E,size:ce,align:M.HWRAP|M.HCENTER,text:y})+ue}if(h){if(U.button({img:oe.sprite,frame:oe.LOCK,x:_-Oe-ue/2,y:u,w:Oe,h:Oe,tooltip:J.TLTP_CHANGE_ACCESS,font_height:ce,disabled:d||!Be}))Be=false
if(U.button({img:oe.sprite,frame:oe.RESIZE,x:_+ue/2,y:u,w:Oe,h:Oe,tooltip:J.LBL_RESIZE_OR_DELETE_AREA,font_height:ce,disabled:d||Be}))Be=true
u+=Oe+ue}else Be=false
var S=(null==(i=r.access)?void 0:i.ids)||{}
var I=q(r)
Ne={}
function clientIdsToVolumeAccess(e){var t=e.user_id,r=e.roles
if(!r.world_areabuilder)return null
Ne[t]=r
var a
if(S[t])a=S[t].level
else a=I
if(r.world_admin)a=Ie(a,W)
return he(a)}if(Be){we.drawSizedAligned(ie,_,u,s+1,1.5*ce,M.HCENTER,0,0,J.LBL_RESIZE_OR_DELETE_AREA)
u+=1.5*ce+8
u+=lineSep(_,u,s)
var A=ne()
var w=1.4*Re
var L=.333*Re
var O=A?3:2
var R=_-(w+(O-1)*Re+O*ue+L)/2
if(U.buttonText({text:J.addEllipsis(J.BTN_DELETE_AREA),font_height:ce,w:Re,h:Oe,x:R,y:u,disabled:d}))U.modalDialog({title:J.DLG_DELETE_AREA_TITLE,text:J.DLG_DELETE_AREA_MSG,buttons:{yes:{cb:function cb(){Ee("world_volume_delete "+r.mcid+" "+r.volume_id,F)
ee()},in_event_cb:!D.touch_mode?D.pointerLockEnter:null},no:null}})
R+=Re+ue
if(A){if(U.buttonText({text:J.addEllipsis(J.BTN_CLEAR_AREA),font_height:ce,w:Re,h:Oe,x:R,y:u,disabled:d}))U.modalDialog({title:J.DLG_CLEAR_AREA_TITLE,text:J.DLG_CLEAR_AREA_MSG,buttons:{yes:{cb:function cb(){K(r,function(e){if(e)te.push(e)})
ee()},in_event_cb:!D.touch_mode?D.pointerLockEnter:null},no:null}})
R+=Re+ue}U.label({x:R,y:u,size:ce,font_style:re,align:M.HRIGHT|M.HFIT|M.VCENTER,h:Oe,w:L,text:J.addColon(J.LBL_WORLD_SKY_SHORT)})
R+=L+ue
var b=r.props||{}
var N=B({items:me(),x:R,y:u,width:w,entry_height:Oe,font_height:ce,disabled:d,display:{centered:true,use_markdown:true}},b.sky||"default",{suppress_return_during_dropdown:true})
if(N)Ee("world_volume_property "+r.mcid+" "+r.volume_id+" sky "+N.tag,F)
R+=w+ue
u=displayResizeControls({edit_volume:r,x:0,w:E,y:u+=Oe+ue,local_pos:a})}else{var C=ge(S,clientIdsToVolumeAccess,!f,null).list
u+=pe({can_manage_access:f,first_header:true,last_header:null,list:C,x:0,y:u,w:T,z:s,font_height:ce,row_h:Oe,draw_header:drawUserListHeader})}Pe.end(u)}var ke=[d(0,1,0),d(-1,0,0),d(0,-1,0),d(1,0,0),d(0,0,-1),d(0,0,1)]
var Ue=d()
function doAccessControl(){var e=O()
var t
if(e){var r=e[3]
if(!(t=T(e)))for(var a=0;a<ke.length&&!t;++a){var i=a
if(r&&a<4)i=(a+r)%4
u(Ue,e,ke[i])
t=T(Ue)}}else{e=I()
t=T(e)}accessControlRun(R(),n(),t,e)
return J.LBL_AREA_ACCESS_CONTROL}},{"../common/editvolume_common":242,"../common/globals":248,"../common/world_constants":267,"../glov/client/auto_reset":290,"../glov/client/cmds":298,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/selection_box":350,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./editvolume_client":84,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./status":193,"./styles":197,"./ui_util":205,"./user_data":208,"./voxel_data":216,"./waygate_ui":222,"./world_comm":226,"./world_info_view":231,"./world_metadata":235}],3:[function(e,t,r){"use strict"
r.Account=r.AccountState=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var _=e("assert")
var a=e("../glov/client/client_config").platformParameterGet
var i=e("../glov/client/external_users_client")
var o=i.externalUsersCheckEmailVerified
var n=i.externalUsersCurrentUser
var s=i.externalUsersEnabled
var c=i.externalUsersLogIn
var l=i.externalUsersLogOut
var u=i.externalUsersSendRecoverEmail
var d=e("../glov/client/local_storage.js")
var f=d.localStorageGetJSON
var v=d.localStorageSet
var h=e("../glov/client/net")
var p=h.netClient
var m=h.netDisconnected
var E=h.netDisconnectedRaw
var g=h.netSubs
var T=h.netUserId
var y=e("../glov/common/external_users_common").ERR_NO_USER_ID
var S=e("../glov/common/util").cloneShallow
var I=e("../common/external_users/external_users_provider_ids")
var A=I.USERS_PROVIDER_FACEBOOK_GAMING
var w=I.USERS_PROVIDER_FRVR
var L=e("./external_users/external_users_client_frvr").LOCAL_STORAGE_AUTH_EXTERNAL_PROVIDER
var O;(function(e){e["UNAUTHENTICATED"]="unauthenticated"
e["LOGGING_IN"]="logging_in"
e["UNCONFIRMED_EMAIL"]="unconfirmed_email"
e["LOGGED_IN"]="logged_in"
e["LOGGING_OUT"]="logging_out"
e["NEEDS_FRVR_ACCOUNT"]="needs_frvr_account"})((r.AccountState=O)||(r.AccountState=O={}))
function logSafeCreds(){var e=S(g().getLastLoginCredentials()||{})
delete e.password
return e}var R=0
var b=5e3
function trackLongLoginAttempt(){var e=g().getLastLoginCredentials()
if(null!=e&&e.provider&&(null==e?void 0:e.provider)!==w)return
if(!R)R=Date.now()
if(R>0&&Date.now()-R>b){g().serverLog("long_login_attempt: started",_extends({},logSafeCreds(),{start:R}))
R=-1}}function handleLongLoginAttempt(e){var t=g().getLastLoginCredentials()
if(null!=t&&t.provider&&(null==t?void 0:t.provider)!==w)return
if(e&&-1===R)g().serverLog("long_login_attempt: successful",_extends({},logSafeCreds(),{user_id:T(),end:Date.now()}))
R=0}var N=function(){function Account(e){this.subscription_manager=void 0
this.is_anonymous=void 0
this.external_email=void 0
this.migrating=false
this.subscription_manager=e}var e=Account.prototype
e.isEmailPassLogin=function isEmailPassLogin(){if(!this.getEmail())return false
if(!this.is_anonymous&&this.getProvider()===w)if(!f(L))return true
return false}
e.fetchExternalEmail=function fetchExternalEmail(r,a){var i=this
if(f(L)!==A)return a(null)
var o=this.subscription_manager.getUserId()
this.getExternalLoginData(A,{user_initiated:false},function(e){if(e)return a("Unable to fetch external login data: "+e)
n(A,function(e,t){if(o!==i.subscription_manager.getUserId())return a("Logged out")
if(e||!(null!=t&&t.email))return a("Unable to fetch external user info: "+e+" "+(null==t?void 0:t.email))
i.external_email=t.email
if(!m()&&t.email!==r)p().send("iap_email",t.email)
return a(null,t.email)})})}
e.getEmail=function getEmail(){return this.subscription_manager.logged_in_email||this.external_email}
e.getState=function getState(e,t){if(e&&this.subscription_manager.loggedIn()&&this.getProvider()!==w&&!this.is_anonymous){handleLongLoginAttempt(true)
if(!t&&!this.getProvider())return O.LOGGED_IN
return O.NEEDS_FRVR_ACCOUNT}if(this.subscription_manager.logging_in||this.migrating){trackLongLoginAttempt()
return O.LOGGING_IN}if(this.subscription_manager.logging_out)return O.LOGGING_OUT
if(this.subscription_manager.loggedIn()){handleLongLoginAttempt(true)
return O.LOGGED_IN}handleLongLoginAttempt(false)
return O.UNAUTHENTICATED}
e.getProvider=function getProvider(){var e
return null==(e=this.subscription_manager.getLastLoginCredentials())?void 0:e.provider}
e.getUserId=function getUserId(){return this.subscription_manager.getUserId()}
e.getIsFirstSession=function getIsFirstSession(){return g().isFirstSession()}
e.getAutoLoginError=function getAutoLoginError(){return this.subscription_manager.auto_login_error}
e.getAnonymousUserCreationEnabled=function getAnonymousUserCreationEnabled(){return Boolean(this.subscription_manager.auto_create_user)}
e.getProviderEnabled=function getProviderEnabled(e){return s(e)}
e.createAccount=function createAccount(e,t){this.subscription_manager.userCreate(e,t)}
e.loginEmailPass=function loginEmailPass(e,t){this.subscription_manager.loginEmailPass(e,t)}
e.loginExternal=function loginExternal(e,r){var a=this
var t=function handleNewExternalUser(e){var t=a.subscription_manager.getLastLoginCredentials()
if(e!==y||t.provider===w)return r(e)
return a.subscription_manager.loginExternal({provider:w,external_login_data:_extends({},t.external_login_data),creation_display_name:t.creation_display_name},r)}
this.subscription_manager.loginExternal(e,t)}
e.loginLegacy=function loginLegacy(e,t,r){this.subscription_manager.login(e,t,r)}
e.loginAnonymous=function loginAnonymous(t){var r=this
var e="anon"+String(Math.random()).slice(2,8)
var a="test"
v("name",e)
this.loginLegacy(e,a,function(e){if(!e)r.subscription_manager.sendCmdParse("rename_random",function(e){if(e)console.log(e)})
r.is_anonymous=true
t(e)})}
e.logout=function logout(e,t){this.is_anonymous=false
this.external_email=void 0
l(e)
if(!(null!=t&&t.only_external))this.subscription_manager.logout()}
e.retryLogin=function retryLogin(e){return this.subscription_manager.loginRetry(e)}
e.sendActivationEmail=function sendActivationEmail(e,t){this.subscription_manager.sendActivationEmail(e,t)}
e.getExternalLoginData=function getExternalLoginData(e,t,r){c(e,_extends({},t,{user_initiated:true}),r)}
e.migrateToFRVRAccount=function migrateToFRVRAccount(e,s){var l=this
c(w,_extends({},e,{user_initiated:true}),function(e,t){var r=null==t?void 0:t.validation_data
if(e||!r)return s(e)
var a=l.subscription_manager
var i=w
if(!a.loggedIn())return s("No logged in account to migrate")
if(l.migrating)return s("Migration already in progress")
if(E())return s("Lost connection")
l.migrating=true
var o={provider:i,validation_data:r}
var n=a.getLastLoginCredentials()
if(n.password)o.password=a.sessionHashedPassword()
else{o.current_provider=n.provider
_(n.external_login_data)
o.current_validation_data=n.external_login_data.validation_data}return p().send("migrate_account_identity",o,null,function(e){l.migrating=false
if(e)return s(e)
a.login_credentials={provider:i}
return s(e)})})}
e.sendRecoverEmail=function sendRecoverEmail(e,t){u(e,t)}
e.checkEmailVerified=function checkEmailVerified(e){o(e)}
e.shouldShowLogout=function shouldShowLogout(){return a("show_logout")}
return Account}()
r.Account=N},{"../common/external_users/external_users_provider_ids":247,"../glov/client/client_config":297,"../glov/client/external_users_client":312,"../glov/client/local_storage.js":329,"../glov/client/net":338,"../glov/common/external_users_common":387,"../glov/common/util":400,"./external_users/external_users_client_frvr":92,assert:void 0}],4:[function(e,t,r){"use strict"
r.formatUserID=formatUserID
r.createAccountUI=createAccountUI
var a=e("../glov/common/external_users_common")
var ye=a.ERR_EMAIL_ALREADY_USED
var Se=a.ERR_NO_USER_ID
var Ie=a.ERR_UNCONFIRMED_EMAIL
var i=e("../common/external_users/external_users_provider_ids")
var Ae=i.USERS_PROVIDER_APPLE
var we=i.USERS_PROVIDER_FACEBOOK_GAMING
var te=i.USERS_PROVIDER_FRVR
var Le=e("./localization/localization").L
var Oe=e("./abtest_worlds").abTestFBLoginButton
var Re=e("../glov/client/engine.js")
var be=e("./ui_util_2")
var o=e("./app_access.js")
var Ne=o.accessFRVRAuth
var Ce=o.accessFRVRAuthUserPassMigration
var n=e("./account")
var s=n.Account
var l=n.AccountState
var xe=e("assert")
var _=e("../glov/client/cmds.js").cmd_parse
var Me=e("../glov/client/local_storage.js")
var De=e("../glov/client/font.js")
var c=e("../glov/client/input.js"),Pe=c.click,Be=c.KEYS,ke=c.keyDownEdge,Ue=c.inputTouchMode
var u=e("../glov/client/link.js"),Ge=u.linkGetDefaultStyle,Fe=u.linkText
var d=e("../glov/client/net.js"),We=d.netClient,f=d.netSubs,re=d.netDisconnectedRaw
var He=e("../glov/client/settings.js")
var v=e("../glov/client/social"),ze=v.SOCIAL_ONLINE,Ve=v.socialPresenceStatusSet
var Ye=e("../glov/client/ui.js")
var h=e("../glov/client/ui.js"),je=h.uiButtonHeight,Ke=h.uiTextHeight
var qe=e("../glov/client/urlhash.js")
var p=e("../glov/common/util.js"),Ze=p.EMAIL_REGEX,m=p.errorString
var E=e("../glov/common/vmath.js"),g=E.vec2,Xe=E.vec4
var T=e("./iframe_content_handlers.js"),Qe=T.privacyPolicyShow,$e=T.termsOfServiceShow
var y=e("../glov/client/wsclient.js"),Je=y.ERR_RESTARTING,et=y.ERR_CLIENT_VERSION_NEW,tt=y.ERR_CLIENT_VERSION_OLD
var S=e("../glov/client/sprites.js").spriteCreate
var I=e("./platform_worlds_client.js"),rt=I.PLATFORM_FBINSTANT,at=I.PLATFORM_MOBILE,it=I.PLATFORM_WEB,ot=I.PLATFORM_MSSTART,nt=I.PLATFORM_DISCORD
var A=e("./styles.js"),st=A.auth_migration_error,lt=A.helper_text_style,_t=A.chat_style_error,ae=A.menu_header_style,ie=A.menu_style,oe=A.color_black
var w=e("./analytics.js"),ct=w.analyticsPostLogin,ne=w.analyticsPostLogout,ut=w.analyticsLoginFailed,dt=w.analyticsAccountMigrated,ft=w.analyticsAccountMigrationFailed
He.register({show_logout_on_welcome:{default_value:0,type:_.TYPE_INT,range:[0,1]}})
var vt=3e4
var ht=1e4
var pt
var mt=3e3
function formatUserID(e,t){var r=t||e
if(e.toLowerCase()!==r.toLowerCase())r=Le.addParenthesesAfter(t,e)
return r}var Et
var gt=false
var se=false
var Tt=false
var le=false
var yt=false
var _e=false
var St=false
var It=false
var At=false
function resetMigrationFlags(){At=It=St=_e=yt=le=Tt=se=gt=false}function copyUserId(e,t){var r
if(!Ye.copyTextToClipboard(t))Ye.provideUserString(e,t)
else r=Le.MSG_COPY_TEXT_SUCCESS
return r}var wt=false
var Lt=l.LOGGING_IN,Ot=l.LOGGED_IN,Rt=l.LOGGING_OUT,bt=l.NEEDS_FRVR_ACCOUNT
var Nt=function safeErrorString(e){return m(e).replace("ERR_ACCOUNT_MIGRATED","This account has been migrated to an FRVR Account, please log in with the email address associated with that account.").replace("ERR_ACCOUNT_BANNED","Servers down!")}
var ce=270
var ue=40
function migrateAccountModalTick(e,t,a){var r=Z.MODAL
var i=t.account,o=t.button_height,n=t.pad,s=t.font_height,l=t.min_h,_=t.button_width
var c=a.edit_box_frvr_email
var u=a.edit_box_frvr_password
var d=a.edit_box_frvr_password_confirm
var f=a.login_button_facebook
var v=a.login_button_apple
var h=function frvrMigrateSuccess(){ct(i.getUserId())
dt(i.getProvider())
Me.set("name",void 0)
Me.set("password",void 0)
Me.set("login_external",te)
a.edit_box_name.text=c.text
Ye.modalDialogClear()
Ye.modalDialog({title:Le.DLG_FRVR_ALL_SET_TITLE,text:Le.DLG_FRVR_ALL_SET_MSG,button_width:150,buttons:{ok:{label:Le.BTN_LETS_PLAY}}})}
var p=function pollLogin(){a.polling_email_validation=true
var r={do_creation:false,creation_display_name:null,email:c.text,password:u.text}
i.checkEmailVerified(function(e,t){if(e||!t){a.polling_email_validation=setTimeout(pollLogin,ht)
return}_e=true
a.polling_email_validation=clearTimeout(a.polling_email_validation)
i.getExternalLoginData(te,r,function(e,t){if(e){ut(e,"migration_sign_up")
yt=false
St=true
return}i.migrateToFRVRAccount({external_login_data:t},function(e){yt=false
if(e){ft(e,i.getUserId(),"migration_sign_up")
St=true
_e=false
return}h()})})})}
if("confirm_email"===Et)if(!a.polling_email_validation&&!_e&&!St)p()
var m=function resetErrs(){a.email_err=""
a.password_err=""
a.confirm_err=""}
var E=e.x0,g=e.y,T=e.avail_width,y=e.modal_width
var S=Ye.font
var I=.5*T
var A=e.x+.5*T
var w=2*e.font_height
var L=1.5*e.font_height
var O=L
var R=1.2*ce
var b
if("first_dialog"===Et)b=Le.DLG_NEW_FRVR_ACC_TITLE
else if("creating_account"===Et)b=Le.BTN_CREATE_FRVR_ACC
else if("have_account"===Et)b=Le.DLG_HAVE_FRVR_ACC_TITLE
else if("confirm_email"===Et)b=_e?Le.DLG_MIGRATING_ACCOUNT_TITLE:Le.LBL_CONFIRMATION_EMAIL_SENT
else if("migration_failed"===Et)b=Le.DLG_ACCOUNT_MIGRATION_FAILED_TITLE
S.drawSizedAligned(ae,A,g,r,w,S.ALIGN.HCENTER,0,0,b)
g+=w+32
if("first_dialog"===Et||"confirm_email"===Et||"migration_failed"===Et)if("first_dialog"===Et){g+=S.drawSizedAlignedWrapped(ie,e.x,g,r,0,L,De.ALIGN.HCENTER,T,0,Le.DLG_NEW_FRVR_ACC_MSG.$({user:i.getUserId()}))
S.drawSizedAligned(ie,A,g+=32,r,L,S.ALIGN.HCENTER,0,0,Le.LBL_MIGRATING_ACCOUNT.$({user:i.getUserId()}))
g+=64}else if("confirm_email"===Et){if(_e){S.drawSizedAligned(ie,A,g,r,L,De.ALIGN.HCENTER,0,0,Le.addEllipsis(Le.DLG_MIGRATING_ACCOUNT_MSG))
g+=L+je()+32}else{var N=S.numLines(ie,T,0,L,Le.LBL_CONFIRMATION_EMAIL_WILL_RECEIVE_TRY_AGAIN)
S.drawSizedAligned(ie,e.x,g,r,L,De.ALIGN.HCENTERFIT|De.ALIGN.HWRAP,T,l,Le.LBL_CONFIRMATION_EMAIL_WILL_RECEIVE_TRY_AGAIN)
g+=L*(N+1)
if(a.show_resend_email_button){var C=Le.LBL_CONFIRMATION_RESEND_EMAIL
var x=Ye.font.getStringWidth(ie,L,C)
if(Ye.buttonText({x:A-.5*x,y:g,z:r,w:x+4,h:.8*je(),font_height:L,text:C}))i.sendActivationEmail(c.text,function(e){if(e){Ye.modalDialog({title:Le.DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE,text:Nt(e),buttons:{ok:null}})
a.show_resend_email_button=true
return}a.show_resend_email_button=false
setTimeout(function(){a.show_resend_email_button=true},vt)})}g+=1.3*je()+24}var M={x:A,y:g,w:o,h:o,z:r,rot:a.spinner_rot,frame:be.SPINNER,color:oe}
be.getUIUtil2SpriteCentered().draw(M)
g+=o
if(!_e){if(Ye.buttonText({x:A-.5*_,y:g,z:r,w:_,h:o,font_height:s,text:Le.BTN_CANCEL})){yt=false
Tt=true
a.polling_email_validation=clearTimeout(a.polling_email_validation)}g+=.5*o}}else if("migration_failed"===Et){var D=S.numLines(ie,T,0,L,Le.DLG_ACCOUNT_MIGRATION_FAILED_MSG)
S.drawSizedAligned(ie,e.x,g,r,L,De.ALIGN.HVCENTERFIT|De.ALIGN.HWRAP,T,l,Le.DLG_ACCOUNT_MIGRATION_FAILED_MSG)
g+=L*(D+1)+24
g+=48}var P="creating_account"===Et||"have_account"===Et
var B=false
if(P){var k=A-20
var U=k+4
if("creating_account"===Et){S.drawSizedAligned(ie,k,g,r,w,S.ALIGN.HRIGHT,0,0,Le.addColon(Le.LBL_EMAIL))
B=c.run({x:U,y:g,w:I,font_height:w})===c.SUBMIT||B
g+=w+8
if(a.email_err)g+=Ye.font.drawSizedAlignedWrapped(st,U,g,r,0,O,De.ALIGN.HLEFT,I,0,a.email_err)+8
S.drawSizedAligned(ie,k,g,r,w,S.ALIGN.HRIGHT,0,0,Le.addColon(Le.LBL_PASSWORD))
B=u.run({x:U,y:g,w:I,font_height:w})===u.SUBMIT||B
g+=w+8
if(a.password_err)g+=Ye.font.drawSizedAlignedWrapped(st,U,g,r,0,O,De.ALIGN.HLEFT,I,0,a.password_err)+8
S.drawSizedAligned(ie,k,g,r,w,S.ALIGN.HRIGHT,0,0,Le.addColon(Le.LBL_CONFIRM_PASSWORD))
B=d.run({x:U,y:g,w:I,font_height:w})===d.SUBMIT||B
g+=w+8
if(a.confirm_err)g+=Ye.font.drawSizedAlignedWrapped(st,U,g,r,0,O,De.ALIGN.HLEFT,I,0,a.confirm_err)+8}else if("have_account"===Et){S.drawSizedAligned(ie,k,g,r,w,S.ALIGN.HRIGHT,0,0,Le.addColon(Le.LBL_EMAIL))
B=c.run({x:U,y:g,w:I,font_height:w})===c.SUBMIT||B
g+=w+8
if(a.email_err)g+=Ye.font.drawSizedAlignedWrapped(st,U,g,r,0,O,De.ALIGN.HLEFT,I,0,a.email_err)+8
S.drawSizedAligned(ie,k,g,r,w,S.ALIGN.HRIGHT,0,0,Le.addColon(Le.LBL_PASSWORD))
B=u.run({x:U,y:g,w:I,font_height:w})===u.SUBMIT||B
g+=w+8
if(a.password_err)g+=Ye.font.drawSizedAlignedWrapped(st,U,g,r,0,O,De.ALIGN.HLEFT,I,0,a.password_err)+8}g+=32}var G=(y-3*ue)/2
if("confirm_email"!==Et){if(Ye.buttonText({x:E+ue+G/2-R/2,y:g,z:r+1,h:je(),w:R,font_height:L,text:"first_dialog"===Et?Le.BTN_CREATE_FRVR_ACC:Le.BTN_CANCEL})||"first_dialog"!==Et&&ke(Be.ESC))if("first_dialog"===Et){gt=true
m()}else if("creating_account"===Et)gt=false
else if("have_account"===Et)Tt=false
else if("migration_failed"===Et)_e=St=false
var F
var W
var H
if("first_dialog"===Et){F=Le.BTN_HAVE_FRVR_ACC
H=function confirm_btn_cb(){Tt=true
m()}}else if("creating_account"===Et){F=se?Le.addEllipsis(Le.BTN_CREATING_ACC):Le.BTN_CREATE_FRVR_ACC
W=se
H=function confirm_btn_cb(){m()
if(!Ze.test(c.text))a.email_err=Le.DLG_REGISTER_ERROR_EMAIL_MSG
if(u.text.length<8)a.password_err=Le.LBL_REGISTER_ERROR_PASSWORD_LENGTH
else if(c.text.includes(u.text))a.password_err=Le.LBL_REGISTER_ERROR_PASSWORD_SIMILAR_EMAIL
else if(u.text!==d.text)a.confirm_err=Le.LBL_REGISTER_ERROR_CONFIRM_PASSWORD
if(!(a.email_err||a.password_err||a.confirm_err)){se=true
var e={email:c.text,password:u.text,do_creation:true,creation_display_name:""}
i.getExternalLoginData(te,e,function(e,t){if(e){ut(e,"migration_sign_in")
if("ERR_EMAIL_ALREADY_USED"===e)a.email_err=Le.LBL_REGISTER_ERROR_EMAIL_ALREADY_USED
else if("ERR_INVALID_DATA"===e)a.email_err=e
else if("ERR_CONNECTION"===e)a.confirm_err=Le.LBL_REGISTER_ERROR_GENERIC
else a.confirm_err=e}else{gt=false
yt=true}se=false})}}}else if("have_account"===Et){F=le?Le.LOGINMSG_LOGGING_IN:Le.BTN_LOG_IN_TO_FRVR
W=le
H=function confirm_btn_cb(){m()
if(!Ze.test(c.text))a.email_err=Le.DLG_REGISTER_ERROR_EMAIL_MSG
else if(!u.text)a.password_err=Le.DLG_REGISTER_ERROR_NO_PASSWORD
if(!(a.email_err||a.password_err)){var e={email:c.text,password:u.text}
le=true
i.migrateToFRVRAccount(e,function(e){if(e){ft(e,i.getUserId())
if(e===Ie){Tt=false
yt=true}else if("ERR_EMAIL_ALREADY_USED"===e)a.email_err=Le.LBL_REGISTER_ERROR_EMAIL_ALREADY_USED
else if("ERR_UNAUTHORIZED"===e||"ERR_INVALID_DATA"===e)a.password_err=Le.LBL_REGISTER_ERROR_WRONG_CREDENTIALS
else a.password_err=e}else h()
le=false})}}}else if("migration_failed"===Et){F=Le.BTN_TRY_AGAIN
H=function confirm_btn_cb(){yt=_e=true
St=false
p()}}if((B=Ye.buttonText({x:E+2*ue+G+G/2-R/2,y:g,z:r+1,h:je(),w:R,text:F,font_height:L,disabled:W})||B)&&!W)H()
g+=je()+32}if("first_dialog"===Et){var z=Le.BTN_LOGOUT
var V=Ye.font.getStringWidth(ie,L,z)+8
var Y=.75*je()
var j=V+Y
if(Ye.button({x:e.x,y:g,z:r,w:j,h:Y,font_height:L,text:z,img:be.sprite,frame:be.BTNICON_EXIT})){Ye.modalDialogClear()
a.edit_box_password.setText("")
if(re())Ye.modalDialog({title:Le.DLG_ERR_LOST_CONNECTION_TITLE,text:Le.DLG_ERR_CANNOT_COMMUNICATE,buttons:{OK:null}})
else{i.logout()
ne("button")}}S.drawSizedAligned(ie,e.x+j+6,g+.375*je(),r,L,S.ALIGN.HLEFT|S.ALIGN.VCENTER,0,0,Le.DISCLAIMER_LOGOUT)
g+=32}if(P){var K=i.getProviderEnabled(we)
K=K&&Oe()&&!ot
var q=i.getProviderEnabled(Ae)
var X=(K?1:0)+(q?1:0)
if(X>0){var Q
if("creating_account"===Et)Q=Le.LBL_EXTERNAL_SIGNUPS
else if("have_account"===Et)Q=Le.LBL_EXTERNAL_LOGINS
var $=o
var J=2*n
var ee=A-($*X+J*(X-1))/2
S.drawSizedAligned(ie,A,g,r,L,De.ALIGN.HCENTER,0,0,Le.addColon(Q))
g+=L+8
if(K){if(Ye.buttonImage({x:ee,y:g,z:r,shrink:1,w:$,h:o,img:f,no_bg:true}))i.getExternalLoginData(we,{},function(e,t){if(e){ut(e,"fb_migration")
if("creating_account"===Et)a.confirm_err=e
else if("have_account"===Et)a.password_err=e
return}i.migrateToFRVRAccount({external_login_data:t},function(e){if(e){if("creating_account"===Et)ft(e,i.getProvider())
else if("have_account"===Et)ft(e,i.getUserId(),"fb_migration")
if("creating_account"===Et)a.confirm_err=e
else if("have_account"===Et)a.password_err=e
i.logout(we,{only_external:true})
return}h()})})
ee+=$+J}if(q){if(Ye.buttonImage({x:ee,y:g,z:r,w:$,h:o,img:v,shrink:1,no_bg:true}))i.getExternalLoginData(Ae,{},function(e,t){if(e){ut(e,"apple_migration")
if("creating_account"===Et)a.confirm_err=e
else if("have_account"===Et)a.password_err=e
return}i.migrateToFRVRAccount({external_login_data:t},function(e){if(e){ft(e,i.getUserId(),"apple_migration")
if("creating_account"===Et)a.confirm_err=e
else if("have_account"===Et)a.password_err=e
i.logout(Ae,{only_external:true})
return}h()})})
ee+=$+J}g+=.5*o}}e.y=g}function AccountUI(){this.edit_box_name=Ye.createEditBox({key:"eb_name",placeholder:Le.LBL_EMAIL_OR_USER_ID,initial_focus:true,text:Me.get("name")||"",autocomplete:"username"})
this.edit_box_password=Ye.createEditBox({key:"eb_password",placeholder:Le.LBL_PASSWORD,type:"password",text:Me.get("name")&&Me.get("password")||""})
this.edit_box_password_confirm=Ye.createEditBox({key:"eb_confirm_password",placeholder:Le.LBL_CONFIRM_PASSWORD,type:"password",text:"",autocomplete:"new-password"})
this.edit_box_email=Ye.createEditBox({key:"eb_email",placeholder:Le.LBL_EMAIL,text:"",autocomplete:"email"})
this.edit_box_display_name=Ye.createEditBox({key:"eb_display_name",placeholder:Le.LBL_DISPLAY_NAME,text:"",autocomplete:"nickname"})
this.edit_box_frvr_password=Ye.createEditBox({placeholder:Le.LBL_PASSWORD,type:"password",text:""})
this.edit_box_frvr_password_confirm=Ye.createEditBox({placeholder:Le.LBL_CONFIRM_PASSWORD,type:"password",text:""})
this.edit_box_frvr_email=Ye.createEditBox({initial_focus:true,placeholder:Le.LBL_EMAIL,text:Me.get("name")||""})
this.creation_mode=false
this.age_consented=false
this.show_email_confirmation_screen=false
this.show_password_reset=true
this.show_password_reset_screen=false
this.password_reset_button_label=Le.BTN_SEND_EMAIL
this.show_password_reset_send_button=true
this.show_resend_email_button=true
this.checked_sprite=S({url:"img/ui/checkbox_checked.png",size:g(128,128),soft_error:true})
this.spinner_rot=0
this.unchecked_sprite=S({url:"img/ui/checkbox.png",size:g(128,128),soft_error:true})
this.login_button_facebook=S({url:"img/ui/button_login_facebook.png",size:g(100,100),soft_error:true})
this.login_button_apple=S({url:"img/ui/button_login_apple.png",size:g(100,100),soft_error:true})
this.account=new s(f())
this.polling_email_validation=false
this.email_err=""
this.password_err=""
this.confirm_err=""}AccountUI.prototype.doLogout=function(){this.edit_box_password.setText("")
resetMigrationFlags()
this.account.logout()
ne("button")}
AccountUI.prototype.showLogin=function(e){var r=this
var d=e.x,f=e.y,v=e.style,t=e.button_height,a=e.button_width,h=e.url_tos,p=e.url_priv,i=e.text_w,m=e.font_height,o=e.font_height_small,E=e.pad,n=e.user_id_x
m=m||Ke()
o=o||.75*m
t=t||je()
a=a||240
i=i||400
E=E||10
var s=this.edit_box_name,l=this.edit_box_password,_=this.edit_box_password_confirm,c=this.edit_box_email,u=this.edit_box_display_name
var g
var T=m
var y=2*T+3*E+t
var S=this.account
var I=S.getState(Ne(),Ce())
function showTOS(e){if(h){xe(p)
var t=.6*m
var r=(e?Le.DISCLAIMER_CREATE_ACCOUNT:Le.DISCLAIMER_LOGIN)+" "
var a=Le.LBL_TERMS_OF_SERVICE
var i=Le.separateWords("",Le.DISCLAIMER_TOS_PP_SEPARATOR,"")
var o=Le.LBL_PRIVACY_POLICY
var n=Ye.font.getStringWidth(v,t,r)
var s=Ge()
var l=Ye.font.getStringWidth(s,t,a)
var _=Ye.font.getStringWidth(v,t,i)
var c=Ye.font.getStringWidth(s,t,o)
var u=(n+l+_+c)/-2
f+=E
Ye.font.drawSizedAligned(v,d+u,f,Z.UI,t,De.ALIGN.HLEFT,0,0,r)
if(Fe({x:d+(u+=n),y:f,z:Z.UI,font_size:t,url:h,text:a,internal:true}))$e()
Ye.font.drawSizedAligned(v,d+(u+=l),f,Z.UI,t,De.ALIGN.HLEFT,0,0,i)
if(Fe({x:d+(u+=_),y:f,z:Z.UI,font_size:t,url:p,text:o,internal:true}))Qe()
u+=c
f+=t+2*E}}var A=We()
if(!A.connected)if(A.connect_error===Je||A.connect_error===et)g=Le.LOGINMSG_SERVER_RESTARTING
else if(A.connect_error===tt)g=rt?Le.LOGINMSG_NEW_VERSION+"\n"+Le.LOGINMSG_RESTART_OR_UPDATE_APP:at?Le.LOGINMSG_APP_TOO_OLD+"\n"+(A.update_available?Le.LOGINMSG_UPDATE_APP:Le.LOGINMSG_NO_UPDATE_AVAILABLE+"\n"+Le.LOGINMSG_VISIT_WEB):it?Le.LOGINMSG_NEW_VERSION+"\n"+Le.LOGINMSG_RELOAD_PAGE:Le.LOGINMSG_UNDER_MAINTENANCE+"\n"+Le.LOGINMSG_TRY_AGAIN
else g=Le.LOGINMSG_CONNECTING
else if(I===Lt)g=Le.LOGINMSG_LOGGING_IN
else if(I===Rt)g=Le.LOGINMSG_LOGGING_OUT
else if(I!==Ot&&S.getAutoLoginError()===Se&&!wt){var w="worlds_auto_new_user"
S.loginExternal({provider:S.getProvider()},function(e){if(e){wt=true
return void ut(e,w)}ct(S.getUserId(),w)})}else if(I!==Ot&&S.getAutoLoginError()&&(rt||nt)){var L=""
var O=""
if(rt){L="fbi_auto"
O="Facebook"}else if(nt){L="discord_auto"
O="Discord"}if(!wt){wt=true
ut(S.getAutoLoginError(),L)}Ye.modalDialog({title:Le.$(Le.DLG_PLATFORM_LOGIN_FAILED_TITLE,O),text:Nt(S.getAutoLoginError()),buttons:{retry:{cb:function cb(){return S.retryLogin(function(e){if(!e){ct(S.getUserId(),L)
return}ut(e,L)})}}}})}else if(I!==Ot&&S.getAnonymousUserCreationEnabled()&&!Me.get("did_auto_anon")&&!Me.get("name")){g=Le.LOGINMSG_AUTO_LOGGING_IN
Me.set("did_auto_anon","yes")
Ve(ze)
S.loginAnonymous(function(e){if(e){Ye.modalDialog({title:Le.DLG_AUTO_LOGGIN_FAILED_TITLE,text:Nt(e),buttons:{retry:{cb:function cb(){Me.set("did_auto_anon",void 0)
Me.set("name",void 0)}},cancel:null}})
ut(e,"auto")}else ct(S.getUserId(),"auto")})}else if(I===bt&&S.getProvider()&&!It){if(!At){g=Le.LOGINMSG_LOGGING_IN
At=true
S.getExternalLoginData(S.getProvider(),{},function(e,t){if(e){g=""
It=true
ut(e,S.getProvider()+"_seamless_migration")
return}S.migrateToFRVRAccount({external_login_data:t},function(e){g=""
if(e){It=true
S.logout(S.getProvider(),{only_external:true})
ft(e,S.getProvider())
return}ct(S.getUserId())
dt(S.getProvider())})})}}else if(I===bt){this.spinner_rot+=2*Math.PI/16*.0166*Re.getFrameDt()
if(gt)Et="creating_account"
else if(Tt)Et="have_account"
else if(yt)Et="confirm_email"
else if(St)Et="migration_failed"
else Et="first_dialog"
if(!Ye.isMenuUp()){var R={account:S,button_height:t,pad:E,font_height:m,min_h:y,button_width:a}
var b={width:980,no_fullscreen_zoom:true,tick:function tick(e){migrateAccountModalTick(e,R,r)}}
Ye.modalDialog(b)}}else if(I!==Ot){if(S.getAutoLoginError()&&!wt){wt=true
ut(S.getAutoLoginError(),"worlds_auto")}var N=.25*i
var C=d-1.5*N+N
var x=E/2
var M=C-E
var D=De.ALIGN.HRIGHT
var P=C+x
var B=2*N
var k=.6*m
var U=Ye.font.getStringWidth(v,k,Le.AGE_CONSENTMENT)
var G=U/-2
var F=d-a-x
var W=d+x
var H=false
if(this.polling_email_validation&&!this.show_email_confirmation_screen)this.polling_email_validation=clearTimeout(this.polling_email_validation)
if(this.show_email_confirmation_screen){if(!this.polling_email_validation){var z={do_creation:false,creation_display_name:null,email:c.text,password:l.text}
var V=function pollLogin(){S.loginEmailPass(z,function(e){if(e){ut(e,"worlds_sign_up")
r.polling_email_validation=setTimeout(pollLogin,ht)
return}r.polling_email_validation=false
r.show_email_confirmation_screen=false
ct(S.getUserId(),"worlds_sign_up")})}
this.polling_email_validation=setTimeout(V,ht)}var Y=1e3
var j=52
f-=j
Ye.font.drawSizedAligned(v,d-.5*Y,f,Z.UI,1.2*m,De.ALIGN.HVCENTERFIT|De.ALIGN.HWRAP,Y,y,Le.LBL_CONFIRMATION_EMAIL_SENT)
f+=1.2*m+j
Ye.font.drawSizedAligned(v,d-.5*Y,f,Z.UI,.8*m,De.ALIGN.HVCENTERFIT|De.ALIGN.HWRAP,Y,y,Le.LBL_CONFIRMATION_EMAIL_WILL_RECEIVE_TRY_AGAIN)
f+=.8*m+j
if(this.show_resend_email_button){var K=Le.LBL_CONFIRMATION_RESEND_EMAIL
var q=Ye.font.getStringWidth(v,.8*m,K)
if(Ye.buttonText({x:d-.5*q,y:f+.4*y,z:Z.UI,w:q,h:m,font_height:.8*m,text:K}))S.sendActivationEmail(s.text,function(e){if(e){Ye.modalDialog({title:Le.DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE,text:Nt(e),buttons:{ok:null}})
r.show_resend_email_button=true
return}r.show_resend_email_button=false
setTimeout(function(){r.show_resend_email_button=true},vt)})}f+=.8*m+1.25*j+t
this.spinner_rot+=2*Math.PI/16*.0166*Re.getFrameDt()
var X={x:d,y:f,w:t,h:t,z:Z.UI,rot:this.spinner_rot,frame:be.SPINNER}
be.getUIUtil2SpriteCentered().draw(X)
f+=1.25*j
if(Ye.buttonText({x:d-.5*a,y:f,w:a,h:t,font_height:m,text:Le.BTN_CANCEL})){this.show_email_confirmation_screen=false
this.creation_mode=false}}else if(this.creation_mode){var Q=.4*m
if(!Ne()){Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_USER_ID))
H=s.run({x:P,y:f,w:B,font_height:m,placeholder:Le.LBL_USER_ID})===s.SUBMIT||H
f+=T+E}Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_EMAIL))
H=c.run({x:P,y:f,w:B,font_height:m})===l.SUBMIT||H
f+=T+E
if(this.email_err){Ye.font.drawSizedAligned(_t,P,f,Z.UI,Q,De.ALIGN.HLEFT,0,0,this.email_err)
f+=Q+E}Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_PASSWORD))
H=l.run({x:P,y:f,w:B,font_height:m,autocomplete:"new-password"})===l.SUBMIT||H
f+=T+E
if(this.password_err){Ye.font.drawSizedAligned(_t,P,f,Z.UI,Q,De.ALIGN.HLEFT,0,0,this.password_err)
f+=Q+E}Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_CONFIRM_PASSWORD))
H=_.run({x:P,y:f,w:B,font_height:m})===l.SUBMIT||H
f+=T+E
if(this.confirm_err){Ye.font.drawSizedAligned(_t,P,f,Z.UI,Q,De.ALIGN.HLEFT,0,0,this.confirm_err)
f+=Q+E}Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_DISPLAY_NAME))
H=u.run({x:P,y:f,w:B,font_height:m})===l.SUBMIT||H
if(Ye.buttonText({x:P+B+E,y:f,w:.5*a,h:T+E-2,font_height:o,text:Le.BTN_RANDOM}))A.send("random_name",null,null,function(e,t){if(t)u.setText(t)})
f+=T+E
showTOS(true)
Ye.font.drawSizedAligned(v,d+G,f+E,Z.UI,k,De.ALIGN.HLEFT,0,0,Le.AGE_CONSENTMENT)
if(Ye.buttonImage({x:d+G+U,y:f,w:.5*a,h:T+E-2,no_bg:true,shrink:1,img:this.age_consented?this.checked_sprite:this.unchecked_sprite}))this.age_consented=!this.age_consented
f+=T+E
if(Ye.buttonText({x:F,y:f,w:a,h:t,font_height:m,text:Le.BTN_CANCEL})||ke(Be.ESC)){this.creation_mode=false
this.age_consented=false
s.setText(Me.get("name")||"")
l.setText(Me.get("name")&&Me.get("password")||"")}H=Ye.buttonText({key:"create",x:W,y:f,w:a,h:t,font_height:m,text:Le.BTN_CREATE_USER,disabled:!this.age_consented})||H
f+=t+E
if(H&&this.age_consented){this.email_err=""
this.password_err=""
this.confirm_err=""
if(!Ze.test(c.text))this.email_err=Le.DLG_REGISTER_ERROR_EMAIL_MSG
if(l.text.length<8&&Ne())this.password_err=Le.LBL_REGISTER_ERROR_PASSWORD_LENGTH
else if(c.text.includes(l.text))this.password_err=Le.LBL_REGISTER_ERROR_PASSWORD_SIMILAR_EMAIL
else if(l.text!==_.text)this.confirm_err=Le.LBL_REGISTER_ERROR_CONFIRM_PASSWORD
if(!(this.email_err||this.password_err||this.confirm_err))if(!Ne()){var $=s.getText()
Me.set("name",$)
Ve(ze)
S.createAccount({user_id:$,email:c.text,password:l.text,password_confirm:_.text,display_name:u.text},function(e){if(e){ut(e,"worlds_sign_up")
Ye.modalDialog({title:Le.DLG_LOGIN_ERROR_TITLE,text:Nt(e),buttons:{ok:null}})}else{r.creation_mode=false
_.setText("")
c.setText("")
u.setText("")
ct(S.getUserId(),"worlds_sign_up",true)}})}else{var J={do_creation:true,creation_display_name:u.text,email:c.text,password:l.text}
S.loginEmailPass(J,function(e){if(e){ut(e,"worlds_sign_up")
if(e===Ie){r.show_email_confirmation_screen=true
s.setText(c.text)
setTimeout(function(){r.show_resend_email_button=true},vt)}else if(e===ye)r.email_err=Le.LBL_REGISTER_ERROR_EMAIL_ALREADY_USED
else Ye.modalDialog({title:Le.DLG_LOGIN_ERROR_TITLE,text:Nt(e),buttons:{ok:null}})}else{r.creation_mode=false
_.setText("")
c.setText("")
u.setText("")
s.setText(J.email)
ct(S.getUserId(),"worlds_sign_up")}})}}}else if(this.show_password_reset_screen){var ee=900
var te=48
f-=te
Ye.font.drawSizedAligned(v,d-.5*ee,f,Z.UI,1.2*m,De.ALIGN.HVCENTERFIT|De.ALIGN.HWRAP,ee,y,Le.BTN_RESET_PASSWORD)
f+=1.2*m+te
Ye.font.drawSizedAligned(v,d-.5*ee,f,Z.UI,.8*m,De.ALIGN.HVCENTERFIT|De.ALIGN.HWRAP,ee,y,Le.LBL_RESET_PASSWORD_EMAIL)
f+=.8*m+3*te
Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_EMAIL))
s.run({x:P,y:f,w:B,font_height:m})
if(this.email_err)Ye.font.drawSizedAlignedWrapped(st,P,f+m+8,Z.UI,0,.5*m,De.ALIGN.HLEFT,B,0,this.email_err)
f+=m+te
if(Ye.buttonText({x:F,y:f,w:a,h:t,font_height:m,text:Le.BTN_CANCEL})){this.show_password_reset_screen=false
this.email_err=""}if(Ye.buttonText({x:W,y:f,w:a,h:t,font_height:m,text:this.password_reset_button_label,disabled:!Ze.test(s.text)||!this.show_password_reset_send_button})){this.password_reset_button_label=Le.BTN_EMAIL_SENDING
this.email_err=""
this.show_password_reset_send_button=false
S.sendRecoverEmail(s.text,function(e){if(e){r.password_reset_button_label=Le.BTN_SEND_EMAIL
r.email_err=e
r.show_password_reset_send_button=true
return}r.password_reset_button_label=Le.BTN_EMAIL_SENT
setTimeout(function(){r.password_reset_button_label=Le.BTN_SEND_EMAIL
r.show_password_reset_send_button=true},vt)})}}else{var re=Ne()?Le.LBL_EMAIL_OR_USER_ID:Le.LBL_USER_ID
Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(re))
H=s.run({x:P,y:f,w:B,font_height:m,placeholder:re})===s.SUBMIT||H
f+=T+E
Ye.font.drawSizedAligned(v,M,f,Z.UI,m,D,0,0,Le.addColon(Le.LBL_PASSWORD))
H=l.run({x:P,y:f,w:B,font_height:m,autocomplete:"current-password"})===l.SUBMIT||H
f+=T+E
showTOS(false)
if(Ye.buttonText({x:F,y:f,w:a,h:.8*t,font_height:m,text:Le.BTN_NEW_USER})){this.creation_mode=true
if(Ne()){c.setText(s.text)
u.setText("")}else{u.setText(s.text)
c.setText("")}_.setText("")
c.focus()}H=Ye.buttonText({x:W,y:f,w:a,h:.8*t,font_height:m,text:Le.BTN_LOGIN})||H
f+=t+E
if(this.show_password_reset&&Ne()){f+=32
var ae=.6*m
var ie=.5*t
var oe=Le.LBL_FORGOT_PASSWORD
var ne=Ye.font.getStringWidth(v,ae,oe)
Ye.font.drawSizedAligned(v,d-.5*ne,f,Z.UI,ae,De.ALIGN.HVCENTER,0,0,oe)
if(Ye.buttonText({x:d+8,y:f-.5*ie,w:.8*a,h:ie,font_height:ae,text:Le.BTN_RESET_PASSWORD})){this.show_password_reset_screen=true
this.email_err=""}f+=E}var se=S.getProviderEnabled(Ae)
var le=S.getProviderEnabled(we)
var _e=((le=le&&Oe()&&!ot)?1:0)+(se?1:0)
if(_e>0){f+=o
Ye.font.drawSizedAligned(v,d,f,Z.UI,o,De.ALIGN.HCENTER,0,0,Le.addColon(Le.LBL_EXTERNAL_LOGINS))
f+=o+E
var ce=t
var ue=2*E
var de=d-(ce*_e+ue*(_e-1))/2
if(le){if(Ye.buttonImage({x:de,y:f,shrink:1,w:ce,h:t,img:this.login_button_facebook,no_bg:true}))S.loginExternal({provider:we},function(e){if(e){if("Facebook login failed"===e&&Re.DEBUG&&!qe.get("nocoop"))e+="\nDebug note: likely requires ?nocoop=1 query parameter"
Ye.modalDialog({title:Le.$(Le.DLG_PLATFORM_LOGIN_FAILED_TITLE,"Facebook"),text:Nt(e),buttons:{cancel:null}})
ut(e,"fb_but")}else ct(S.getUserId(),"fb_but")})
de+=ce+ue}if(se){if(Ye.buttonImage({x:de,y:f,w:ce,h:t,img:this.login_button_apple,shrink:1,no_bg:true}))S.loginExternal({provider:Ae},function(e){if(e){Ye.modalDialog({title:Le.$(Le.DLG_PLATFORM_LOGIN_FAILED_TITLE,"Apple"),text:Nt(e),buttons:{cancel:null}})
ut(e,"apple_but")}else ct(S.getUserId(),"apple_but")})
de+=ce+ue}f+=t+E}if(H){Me.set("name",s.text)
Ve(ze)
var fe=s.text
var ve=function legacyLogin(){S.loginLegacy(s.text,l.text,function(e){if(e){Ye.modalDialog({title:Le.DLG_LOGIN_ERROR_TITLE,text:Nt(e),buttons:{ok:null}})
ut(e,"worlds_sign_in")}else ct(S.getUserId(),"worlds_sign_in")})}
if(!Ne()||!Ze.test(fe))ve()
else{var he={do_creation:false,creation_display_name:null,email:fe,password:l.text}
S.loginEmailPass(he,function(e){if(e===Ie){r.show_email_confirmation_screen=true
S.sendActivationEmail(he.email,function(e){if(e)Ye.modalDialog({title:Le.DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE,text:Nt(e),buttons:{ok:null}})})
setTimeout(function(){r.show_resend_email_button=true},vt)
ut(e,"worlds_sign_in")}else if(e&&Ze.test(he.email)){ut(e,"worlds_sign_in")
var t
if("ERR_SERVER"===e)t=Le.DLG_ERR_CANNOT_COMMUNICATE
else if("ERR_UNAUTHORIZED"===e||"ERR_INVALID_DATA"===e){t=Le.DLG_FRVR_LOGIN_ERROR_MSG
r.show_password_reset=true}else t=e
Ye.modalDialog({title:Le.DLG_LOGIN_ERROR_TITLE,text:t,buttons:{ok:null}})}else if(e){ut(e,"worlds_sign_in")
ve()}else ct(S.getUserId(),"worlds_sign_in")})}}}}else{var pe=S.getUserId()
var me=.8*o
if(S.shouldShowLogout()){ct(pe,"worlds_auto")
if(He.show_logout_on_welcome){if(Ye.button({x:d-.5*a,y:f,w:a,h:t,font_height:m,text:Le.BTN_LOGOUT,img:be.sprite,frame:be.BTNICON_EXIT}))this.doLogout()
f+=t+8}}else{var Ee=""
if(rt)Ee="facebook"
else if(nt)Ee="discord"
ct(pe,Ee)}var ge=f
Ye.font.drawSizedAligned(v,(n||d)-.5*i,f,Z.UI,me,De.ALIGN.HCENTERFIT,i,0,Le.separateColon(Le.LBL_LOGGED_IN_AS,pe))
f+=me+4
Ye.font.drawSizedAligned(lt,(n||d)-i/2,f,Z.UI,.7*me,De.ALIGN.HCENTERFIT,i,0,pt||(Ue()?Le.LBL_TAP_TO_COPY:Le.LBL_CLICK_TO_COPY))
if(Pe({x:d-i/2,y:ge,w:i,h:(f+=me+8)-ge,button:0}))pt=copyUserId(Le.DLG_SHARE_USER_ID_TITLE,pe)
else if(pt)if((mt-=Re.frame_dt)<=0){mt=3e3
pt=void 0}}if(g){var Te=800
Ye.font.drawSizedAligned(v,d-400,f,Z.UI,1.5*m,De.ALIGN.HVCENTERFIT|De.ALIGN.HWRAP,Te,y,g)
Ye.drawRect(d-.5*(Te+=100),f,d+.5*Te,f+y,Z.UI-.5,Xe(0,0,0,.25))
f+=y}return f}
function createAccountUI(){return new AccountUI}},{"../common/external_users/external_users_provider_ids":247,"../glov/client/cmds.js":298,"../glov/client/engine.js":305,"../glov/client/font.js":315,"../glov/client/input.js":326,"../glov/client/link.js":328,"../glov/client/local_storage.js":329,"../glov/client/net.js":338,"../glov/client/settings.js":351,"../glov/client/social":357,"../glov/client/sprites.js":363,"../glov/client/ui.js":367,"../glov/client/urlhash.js":369,"../glov/client/wsclient.js":375,"../glov/common/external_users_common":387,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./abtest_worlds":1,"./account":3,"./analytics.js":6,"./app_access.js":12,"./iframe_content_handlers.js":105,"./localization/localization":131,"./platform_worlds_client.js":160,"./styles.js":197,"./ui_util_2":206,assert:void 0}],5:[function(e,t,r){"use strict"
r.resetMoveTime=resetMoveTime
r.aiTick=aiTick
var s=e("assert")
var a=e("../glov/client/engine")
var i=a.getFrameDt
var o=a.getFrameTimestamp
var n=e("../glov/common/vmath")
var l=n.v3distSq
var _=n.vec3
var c=e("../common/globals").CHUNK_SIZE
var u=e("./client_entities").getEntityManager
var d=e("./main").charControllerPos
var f=e("./voxel_chunk_manager").getViewDist
var v=e("./voxel_data").worldPosFromLocalPos
var h=Math.PI,p=Math.random,m=Math.sin,E=Math.cos
var g=2e3
var T
var y=_()
function lastUpdatedBySomeoneElse(e){if(!e.data.seq_ai_move)return false
if(e.data.seq_ai_move.startsWith(e.entity_manager.getSubscriptionIdPrefix()))return false
return true}function resetMoveTime(e,t){e.next_move_time=T+500+p()*(500+(t?g:0))}function tickAI(e,t){if(e.waiting||e.hasPendingBatchUpdate())return
if(T<e.next_move_time)return
if(lastUpdatedBySomeoneElse(e))if(T-e.last_update_timestamp<g){resetMoveTime(e,false)
return}var r=e.getData("pos")
s(r)
var a=f()*c/2
if(l(r,y)>a*a)return
if(!e.home_point)e.home_point=r.slice(0)
var i=5*p()
var o=p()*h*2
var n=[e.home_point[0]+m(o)*i,e.home_point[1]-E(o)*i,0,o,0,0]
e.my_activate_time=T
resetMoveTime(e,false)
e.applyAIMove(n)}var S=o()
function aiTick(){if((T=o())<S+100)return
v(y,d())
S=T
var e=i()
var t=u().entities
for(var r in t){var a=t[Number(r)]
if(!a.do_ai)continue
tickAI(a,e)}}},{"../common/globals":248,"../glov/client/engine":305,"../glov/common/vmath":402,"./client_entities":44,"./main":135,"./voxel_chunk_manager":214,"./voxel_data":216,assert:void 0}],6:[function(e,t,r){"use strict"
r.analyticsOn=analyticsOn
r.getMenuContext=getMenuContext
r.errorEvent=errorEvent
r.logEvent=logEvent
r.clickEvent=clickEvent
r.itemFlowEvent=itemFlowEvent
r.iapEvent=iapEvent
r.promoOfferEvent=promoOfferEvent
r.logEventOnce=logEventOnce
r.clearEventOnce=clearEventOnce
r.analyticsPostLogin=analyticsPostLogin
r.analyticsPostLogout=analyticsPostLogout
r.analyticsAccountMigrated=analyticsAccountMigrated
r.analyticsAccountMigrationFailed=analyticsAccountMigrationFailed
r.analyticsLoginFailed=analyticsLoginFailed
r.analyticsAddFieldFunction=analyticsAddFieldFunction
r.analyticsStartup=analyticsStartup
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var n=e("assert")
var a=e("../glov/client/client_config")
var s=a.MODE_PRODUCTION
var i=a.PLATFORM
var o=e("../glov/client/engine")
var l=e("../glov/client/engine").stateActive
var _=e("../glov/client/environments").getCurrentEnvironment
var c=e("../glov/client/net")
var u=c.netClient
var d=c.netDisconnected
var f=c.netSubs
var v=c.netUserId
var h=e("../glov/common/md5")
var p=e("../common/globals")
var m=p.CURRENT_VERSION
var E=p.ENV_PRODUCTION
var g=e("./frvr_sdk_worlds")
var T=g.delayedThrow
var y=g.frvrIsInitialized
var S=g.frvrOnInitialized
var I=e("./main_menu").mainMenu
var A=e("./menu")
var w=A.CHARACTER_CUSTOMIZATION
var L=A.CURRENCY_SHOP
var O=A.getMenuPage
var R=e("./welcome_screen").welcomeScreenIsActive
var b={}
var N=false
var C=false
var x
var M
var D
function analyticsOn(){return N}function getMenuContext(e){var t=""
var r=""
if(l(I))t="main_menu"
else if(R())t="welcome_screen"
else t="gameplay"
if(e)return""+t
switch(O()){case w:r="customization"
break
case L:r="currency_shop"
break
default:if("main_menu"===t)r="world_selection"
else r=""}return t+";"+r}function errorEvent(t,r,a,i){n(C)
if(!N)return
S(function(e){if(e)FRVR.tracker.logEvent("error",{msg:t,line:r,col:a,label:i})})
var e=r?"["+r+","+a+"] "+t:t
if(i)e+=" "+i
if(window.gtag)window.gtag("event","exception",{description:e,fatal:false})}var P
function logEvent(t,r,e,a,i){n(C)
if(!N)return
if(void 0!==i&&"object"!==typeof i){n(s,'Fix the usage of analytics.logEvent ("extra" parameter must be an object)')
i={extra:i}}var o=_extends({category:e,label:a},P,i)
S(function(e){if(e)if(void 0!==r&&null!==r)FRVR.tracker.logValuedEvent(t,r,o)
else FRVR.tracker.logEvent(t,o)})
if(window.gtag)window.gtag("event",t,{event_category:e,event_label:a,value:r})}function clickEvent(e,t,r){logEvent(e+"_button",t||1,"button",getMenuContext(),r)}function itemFlowEvent(e,t,r,a,i,o){if(!N)return
if(y())FRVR.tracker.logEvent("item_flow",_extends({},P,{item:e,flow_type:t,amount:r,item_context:getMenuContext(!a),context_details:i,wallet:o}))
if(window.gtag)window.gtag("event","source"===t?"earn_virtual_currency":"spend_virtual_currency",{virtual_currency_name:e,value:r})}function iapEvent(e,t,r,a,i,o,n){var s="show"
var l
if("iap_request_payment_success"===e){s="succ"
l="purchase"}else if("iap_request_payment_failed"===e)s=""+i
else l="begin_checkout"
if(y())FRVR.tracker.logEvent(e,{label:s,priceValue:a.amount,currencyCode:a.currency,productId:t.id,provider:r})
if(window.gtag&&l&&o)window.gtag("event",l,{currency:a.currency,value:a.amount,transaction_id:o,items:[{item_id:t.id,item_category:r}]})}function promoOfferEvent(e,t,r){logEvent(e,Number(t),r,getMenuContext())}var B={}
function logEventOnce(e,t,r,a,i){if(B[e])return
B[e]=true
logEvent(e,t,r,a,i)}function clearEventOnce(e){if("*"===e){B={}
return}delete B[e]}function getRuid(t){n(f().loggedIn())
n(!d())
f().getMyUserChannel().onceSubscribe(function(e){t(e.public?e.public.ruid:void 0)})}function analyticsPostLogin(r,a,i){n(C)
if(!N||r===x)return
x=r
f().getMyUserChannel().send("get_analytics_stats",null,function(e,t){if(v()!==r)return
if(e){console.log(e)
return}P=t})
var o=f().isFirstSession()
getRuid(function(e){if(v()!==r)return
if(!e){errorEvent("RUID not present")
N=false
return}M=h(r+e)
a=a||"worlds"
var t=M
S(function(e){if(e){FRVR.tracker.getGlobalUserId=function(){return t}
u().send("session_id",FRVR.tracker.getPlaySessionId())}if(o&&!b[r]){b[r]=true
logEvent("account_created",void 0,void 0,void 0,{method:a})}logEvent("logged_in",void 0,void 0,void 0,{method:a})})
if(window.gtag){window.gtag("set",{user_id:M})
if(i)window.gtag("event","sign_up",{method:a})
window.gtag("event","login",{method:a})}})}function analyticsPostLogout(t){n(C)
if(!N||!x)return
clearEventOnce("*")
S(function(e){logEvent("logged_out",void 0,void 0,void 0,{method:t})
if(e)FRVR.tracker.getGlobalUserId=D
if(window.gtag)window.gtag("set",{user_id:e?FRVR.tracker.getGlobalUserId():void 0})})
P=M=x=null}function analyticsAccountMigrated(e){n(C)
if(y())FRVR.tracker.logEvent("account_migrated",{provider:e})}function analyticsAccountMigrationFailed(e,t){if(void 0===t)t="worlds"
n(C)
if(y())FRVR.tracker.logEvent("account_migration_failed",{error:e,provider:t})}function analyticsLoginFailed(e,t){if(void 0===t)t="worlds"
logEvent("login_failed",void 0,void 0,void 0,{error:e,method:t})}function analyticsAddFieldFunction(t){S(function(e){if(e)FRVR.tracker.addExtraFieldFunction(t)})}function analyticsStartup(){n(!C)
var e=_()
if(!(N=Boolean(s&&e&&e.name===E||o.defines.ANALYTICS))){console.log("Analytics are turned off")
C=true
return}if(window.gtag)window.gtag("set","user_properties",{platform:i,env:e&&e.name||"unknown"})
try{S(function(e){if(e){FRVR.tracker.addExtraFieldFunction(function(e){e.context="worlds"
e.app_build="1718180230532"
e.app_version=m
if(!e.user_id&&M)e.user_id=M})
D=FRVR.tracker.getGlobalUserId.bind(FRVR.tracker)
if(window.gtag)window.gtag("set",{user_id:FRVR.tracker.getGlobalUserId()})}})}catch(e){T(e)}C=true}},{"../common/globals":248,"../glov/client/client_config":297,"../glov/client/engine":305,"../glov/client/environments":310,"../glov/client/net":338,"../glov/common/md5":390,"./frvr_sdk_worlds":102,"./main_menu":136,"./menu":140,"./welcome_screen":224,assert:void 0}],7:[function(e,t,r){"use strict"
r.logEventFTUE=logEventFTUE
r.FTUE=void 0
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i=e("../glov/client/net").netSubs
var o=e("./analytics").logEvent
var n;(function(){((r.FTUE=n)||(r.FTUE=n={}))["MAIN"]="main"})()
var s=((a={})[n.MAIN]=0,a)
function logEventFTUE(e,t,r,a){if(i().isFirstSession()&&s[e]<t){s[e]=t
o("ftue",1,void 0,void 0,_extends({ftue_type:e,step_number:t,step_name:r},a))}}},{"../glov/client/net":338,"./analytics":6}],8:[function(e,t,r){"use strict"
r.getSkeleton=getSkeleton
r.animationStartup=animationStartup
r.Skeleton=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var s=e("assert")
var I=e("../glov/client/engine.js")
var o=e("../glov/client/fetch.js").fetch
var i=e("../glov/client/filewatch.js").filewatchOn
var n=e("../glov/client/locate_asset").locateAsset
var l=e("../glov/client/net.js").netDisconnected
var a=e("../glov/client/quat.js")
var A=a.qInvert
var w=a.qLerp
var L=a.qMult
var O=a.qTransformVec3
var _=a.quat
var c=e("../glov/client/urlhash.js").getURLBase
var u=e("../glov/client/webfs.js")
var d=u.webFSGetFile
var f=u.webFSGetFileNames
var R=e("../glov/common/data_error.js").dataErrorEx
var v=e("../glov/common/util.js").map01
var h=e("../glov/common/vmath.js")
var b=h.v3addScale
var N=h.v3copy
var C=h.v3lengthSq
var x=h.v3lerp
var M=h.v4copy
var p=h.vec3
var m=h.vec4
var E=e("./animation_enum.js")
var D=E.AnimEnum
var P=E.isCrouchAnim
var g=e("./client_entities.js").registerMovingAnim
var T=e("./particle_system.js")
var y=T.createDetachedParticleSystem
var S=T.createParticleSystemWithOwner
var B=T.getParticleSystem
var k=Math.min
var U;(function(e){e[e["NOT_LOADED"]=1]="NOT_LOADED"
e[e["LOADING"]=2]="LOADING"
e[e["LOADED"]=3]="LOADED"})(U=U||{})
var G="animations/animation_data/"
var F=".json"
var W=4
var H={}
var z={}
var V={}
function getSkeleton(e){return z[e]||null}var Y=1/15
var j=m(-.5,.5,.5,.5)
var K=p(12,0,0)
var q=.01
function findInterval(e,t){for(var r=0;r<t.length;r++){if(r===t.length-1)return r
if(e<t[r+1].time)return r}return 0}function lerpAnimation(e,t,r,a,i,o){var n=r%i
var s=0
if((s=findInterval(n,a))===a.length-1)if(0===o.loop){N(e,a[s].pos)
M(t,a[s].value)}else{n=v(n,a[s].time,i)
x(e,n,a[s].pos,a[0].pos)
w(t,n,a[s].value,a[0].value)}else{n=v(n,a[s].time,a[s+1].time)
x(e,n,a[s].pos,a[s+1].pos)
w(t,n,a[s].value,a[s+1].value)}}function initAnimation(e,t){var r
if(t.particleSystems){r={}
for(var a=0;a<t.particleSystems.length;a++){var i=t.particleSystems[a]
var o=r[i.bone]
if(!o)o=r[i.bone]=[]
o.push(i)}}H[e]=_extends({id:e,status:U.LOADED,particleMap:r,attempts:0,last_attempt:0},t)}function loadAnimation(r,a,e){var t=Date.now()
if(!e&&t-a.last_attempt<a.attempts*a.attempts*100)return
if(l())a.attempts=0
else if(a.attempts<W&&!l()){var i=D[r].toLowerCase()
a.status=U.LOADING
o({url:""+c()+n(""+G+i+F)+(a.attempts?"?retry="+a.attempts:""),response_type:"json"},function(e,t){if(e){a.status=U.NOT_LOADED
a.last_attempt=Date.now()
a.attempts++
console.error("Failed to load animation: "+i+": "+e)
if(a.attempts===W)s(false,"Exhausted attempts to load animation: "+i+" ("+e+")")}else{s(t)
initAnimation(r,t)}})}}function getLoadedAnimation(e){var t=H[e]
s(t)
s(t.status===U.LOADED)
return t}function getAnimation(e){var t=H[e]
s(t)
if(t.status===U.NOT_LOADED)loadAnimation(e,t)
return t}function getAnimId(e){var t=D[e.toUpperCase()]
s(t)
return t}var Z=_()
var X=[]
var Q=function(){function Skeleton(o){this.scale=Y
this.bone_root={pos:p(),rot:_()}
this.bones={}
this.animationBones=void 0
this.animationBones_old=void 0
this.last_update_frame=0
this.time=[0,0]
this.blend_start=[0,0]
this.blend_start_old=[0,0]
this.animations={}
this.animation_array=[]
this.animation_old_array=[]
this.difference=10
this.rot_old=_()
this.rot_new=_()
this.head_rot=_()
this.is_lerping=false
this.qd=_()
this.hand_pos=p()
this.hand_rot=_()
this.temp_offs=p()
this.rot_lerped=_()
this.pos_lerped=p()
this.rot_lerped_old=_()
this.pos_lerped_old=p()
this.tool_pos=p()
this.animation_particles=[]
this.costume_particles=[]
this.original_particles=[]
this.generation=void 0
this.variant_source=void 0
this.variant=void 0
var e=getAnimId(o.animations.default)
var t=getLoadedAnimation(e)
this.animationBones=new Array(t.animationBones.length)
this.animationBones_old=new Array(t.animationBones.length)
this.generation=o.generation
this.variant_source=o.variant_source
var n=this
function initBones(e){var t="root"===e?n.bone_root:n.bones[e]
s(t)
var r=o.bone_tree[e]
if(r)for(var a=0;a<r.length;++a){var i=r[a]
n.bones[i]={parent:t,pos:p(),rot:_()}
initBones(i)}}initBones("root")
this.animations[e]=true
if(o.animations.preloaded)for(var r=0;r<o.animations.preloaded.length;r++)this.animations[getAnimId(o.animations.preloaded[r])]=true
if(o.animations.streamed)for(var a=0;a<o.animations.streamed.length;a++)this.animations[getAnimId(o.animations.streamed[a])]=true
this.animation_array[0]=this.animation_array[1]=t
this.animationBones=t.animationBones
this.animation_old_array[0]=this.animation_old_array[1]=t
this.animationBones_old=t.animationBones
for(var i=0;i<this.animationBones.length;i++)this.animation_particles[i]=[]}var e=Skeleton.prototype
e.initParticles=function initParticles(e,t,r,a){for(var i=0;i<t.length;i++){var o=t[i]
var n=void 0
if(B(o).burst)n=y(r,o)
else n=S(null,o,a)
n.fitToOwner(a,r)
e.push(n)}}
e.particleSystemRunLimb=function particleSystemRunLimb(e,t,r,a){if(I.defines.NOPARTICLES)return null
if(!e[0])this.initParticles(e,t,r,a)
for(var i=0;i<e.length;i++){if(e[i].detached)continue
e[i].updateParticleSystemOwner(a,r)}return e.length}
e.update=function update(e,t,r,a,i,o){M(Z,i)
X[0]=t
X[1]=r?r:t
this.time[0]+=e
this.time[1]+=e
if(this.last_update_frame!==I.frame_index-1){M(this.head_rot,o)
M(this.rot_old,Z)
M(this.rot_new,Z)}this.last_update_frame=I.frame_index
if(this.animation_array[1].id===D.FALL&&(r===D.IDLE||r===D.WALK||r===D.RUN)){this.animation_old_array[1]=this.animation_array[1]
t=D.LANDING
this.animation_array[0]=getLoadedAnimation(t)
this.blend_start_old[0]=this.time[0]
this.time[0]=0
this.blend_start[0]=this.time[0]}var n
if(this.animations[X[0]]&&this.animations[X[1]])for(var s=0;s<2;s++){n=this.time[s]*this.animation_array[s].speed/this.animation_array[s].length
var l=getAnimation(X[s])
if(l.status===U.LOADED&&X[s]!==this.animation_array[s].id&&(this.animation_array[s].priority>=l.priority||n+l.blendTime/this.animation_array[s].length>=1)){this.animation_old_array[s]=this.animation_array[s]
this.animation_array[s]=l
this.blend_start_old[s]=this.time[s]
this.time[s]=0
this.blend_start[s]=this.time[s]}}A(this.qd,Z)
L(this.qd,this.qd,this.rot_old)
var _=C(this.qd)
this.difference=2*Math.atan2(_,this.qd[3])
var c=.3
var u=.02
if(r!==D.IDLE)u=c=0
if(this.difference>c){M(this.rot_new,Z)
this.is_lerping=true}if(this.difference<u){this.is_lerping=false
M(Z,this.rot_old)}while(e>0){var d=k(e,8)
w(this.head_rot,.01*d,this.head_rot,o)
if(this.is_lerping){w(Z,.005*d,this.rot_old,this.rot_new)
M(this.rot_old,Z)}else M(Z,this.rot_old)
e-=8}N(this.bone_root.pos,a)
M(this.bone_root.rot,Z)
for(var f=0;f<this.animationBones.length;f++){var v=0
if(("leg_r"===this.animationBones[f].name||"leg_l"===this.animationBones[f].name)&&r!==D.LANDING)v=1
if(r&&P(r)&&"torso"===this.animationBones[f].name)v=1
var h=this.animation_array[v]
var p=this.animation_old_array[v]
this.animationBones_old=p.animationBones
this.animationBones=h.animationBones
lerpAnimation(this.pos_lerped,this.rot_lerped,this.time[v]*h.speed,this.animationBones[f].rotation,h.length,h)
var m=(this.time[v]-this.blend_start[v])/h.blendTime
if(m<=1){lerpAnimation(this.pos_lerped_old,this.rot_lerped_old,(this.blend_start_old[v]+this.time[v])*p.speed,this.animationBones_old[f].rotation,p.length,p)
w(this.rot_lerped,m,this.rot_lerped_old,this.rot_lerped)
x(this.pos_lerped,m,this.pos_lerped_old,this.pos_lerped)}var E=this.bones[this.animationBones[f].name]
L(E.rot,E.parent.rot,this.rot_lerped)
if("head"===this.animationBones[f].name){this.pos_lerped[0]+=q
if(1===h.additiveHead)L(E.rot,this.head_rot,this.rot_lerped)
else if(!h.additiveHead)M(E.rot,this.head_rot)}if("torso"===this.animationBones[f].name&&t===D.MINING)L(E.rot,w(this.head_rot,.5,this.head_rot,Z),this.rot_lerped)
O(this.temp_offs,this.pos_lerped,E.parent.rot)
b(E.pos,E.parent.pos,this.temp_offs,this.scale)
if(this.variant){var g=this.variant&&V[this.variant]
if(g){O(this.temp_offs,g.offs[this.animationBones[f].name],E.parent.rot)
b(E.pos,E.pos,this.temp_offs,this.scale)}else R({msg:'Skeleton referencing unknown skeleton_variant "'+this.variant+'"',per_frame:true})}var T=this.animation_particles[f]
var y=h.particleMap&&h.particleMap[this.animationBones[f].name]
if(y)this.particleSystemRunLimb(T,y,E.pos,E.rot)
else while(T.length){var S=T.pop()
if(S.detached)continue
if(Infinity===S.system_lifetime)S.killParticles()
else S.addParticleSystemToQueue()}}if(this.bones.arm_r){if(this.tool_pos)O(this.temp_offs,this.tool_pos,this.bones.arm_r.rot)
else O(this.temp_offs,K,this.bones.arm_r.rot)
b(this.hand_pos,this.bones.arm_r.pos,this.temp_offs,this.scale)
L(this.hand_rot,this.bones.arm_r.rot,j)}}
return Skeleton}()
r.Skeleton=Q
function getAnimIdFromFilename(e){var t=e.split("/")[2]
if(".json"===t.substring(t.length-5))t=t.slice(0,-5)
return getAnimId(t)}function loadBundledAnimation(e){var t=d(e,"jsobj")
initAnimation(getAnimIdFromFilename(e),t)}function loadSkeleton(e){var t=d(e,"jsobj")
loadBundledAnimation(""+G+t.animations.default)
if(t.animations.preloaded)for(var r=0;r<t.animations.preloaded.length;++r)loadBundledAnimation(""+G+t.animations.preloaded[r])
if(t.animations.streamed)for(var a=0;a<t.animations.streamed.length;++a){var i=getAnimId(t.animations.streamed[a])
H[i]={status:U.NOT_LOADED,attempts:0,last_attempt:0}}if(t.moving_animations)for(var o=0;o<t.moving_animations.length;++o){var n=getAnimId(t.moving_animations[o])
g(n)}var s=z[t.name]
var l=s&&s.generation||0
t.generation=++l
z[t.name]=t}function loadSkeletonVariant(e){var t=d(e,"jsobj")
V[t.name]=t}function animationReload(e){var t=getAnimIdFromFilename(e)
var r=H[t]
r.attempts=0
loadAnimation(t,r,true)}function animationStartup(){var e=f("animations/skeletons/skeleton_bases")
var t=f("animations/skeletons/skeleton_variants")
for(var r in e)loadSkeleton(e[r])
for(var a in t)loadSkeletonVariant(t[a])
i(/^animations\/animation_data\//,animationReload)
i(/^animations\/skeletons\/skeleton_bases\//,loadSkeleton)
i(/^animations\/skeletons\/skeleton_variants\//,loadSkeletonVariant)}},{"../glov/client/engine.js":305,"../glov/client/fetch.js":313,"../glov/client/filewatch.js":314,"../glov/client/locate_asset":331,"../glov/client/net.js":338,"../glov/client/quat.js":346,"../glov/client/urlhash.js":369,"../glov/client/webfs.js":371,"../glov/common/data_error.js":381,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./animation_enum.js":9,"./client_entities.js":44,"./particle_system.js":152,assert:void 0}],9:[function(e,t,r){"use strict"
r.isCrouchAnim=isCrouchAnim
r.isLadderAnim=isLadderAnim
r.AnimEnum=void 0
var a;(function(e){e[e["IDLE"]=1]="IDLE"
e[e["WALK"]=2]="WALK"
e[e["RUN"]=3]="RUN"
e[e["JUMP"]=4]="JUMP"
e[e["FALL"]=5]="FALL"
e[e["LANDING"]=6]="LANDING"
e[e["CROUCH_IDLE"]=7]="CROUCH_IDLE"
e[e["CROUCH_WALK"]=8]="CROUCH_WALK"
e[e["CROUCH_RUN"]=9]="CROUCH_RUN"
e[e["SWIM_IDLE"]=10]="SWIM_IDLE"
e[e["SWIM"]=11]="SWIM"
e[e["LADDER_IDLE"]=12]="LADDER_IDLE"
e[e["LADDER_CLIMB"]=13]="LADDER_CLIMB"
e[e["LADDER_SPRINT"]=14]="LADDER_SPRINT"
e[e["LADDER_SLIDE"]=15]="LADDER_SLIDE"
e[e["MINING"]=16]="MINING"
e[e["DIG"]=17]="DIG"
e[e["SIT"]=18]="SIT"
e[e["WAVE"]=19]="WAVE"
e[e["STATIC"]=20]="STATIC"
e[e["PART_THUMBNAIL"]=21]="PART_THUMBNAIL"})((r.AnimEnum=a)||(r.AnimEnum=a={}))
function isCrouchAnim(e){return e===a.CROUCH_IDLE||e===a.CROUCH_WALK||e===a.CROUCH_RUN}function isLadderAnim(e){return e===a.LADDER_IDLE||e===a.LADDER_CLIMB||e===a.LADDER_SPRINT||e===a.LADDER_SLIDE}},{}],10:[function(e,t,r){"use strict"
r.drawCostumeNeedsReinit=drawCostumeNeedsReinit
r.drawCostumePrep=drawCostumePrep
r.animationDrawPlayer=animationDrawPlayer
var T=e("../glov/client/engine.js")
var a=e("./animation.js")
var _=a.Skeleton
var c=a.getSkeleton
var i=e("./cosmetics.js")
var n=i.DEFAULT_COSTUME
var u=i.attachInit
var d=i.canInitGeomThisFrame
var s=i.costume_dict
var l=i.instantiateCostumeData
var y=e("./shadow.js").shadowDraw
var f=e("./voxel_data_xraw.js").loadAsyncModelBinary
function setAnimDataVariant(e){for(var t=0;t<e.costume_data.attachments.length;++t)if(e.costume_data.attachments[t].bone===e.skeleton.variant_source)e.skeleton.variant=e.costume_data.attachments[t].skeleton_variant}function setAnimDataCostume(e,t,r){var a=r&&r.name||n
var i
if("custom"===a)i={}
else i=s[a]||s[n]
var o=r||{}
e.costume_data=l(i,o)
e.costume_mod=t.costume_mod
setAnimDataVariant(e)}function drawCostumeNeedsReinit(e){var t=e.anim_data
var r=c("player")
if(!t)return true
else if(t.skeleton.generation!==r.generation)return true
else if(t.costume_mod!==e.costume_mod)return true
return false}function drawCostumePrep(e,t){var r=e.anim_data
var a=c("player")
if(!r)setAnimDataCostume(r=e.anim_data={skeleton:new _(a)},e,t)
else if(r.skeleton.generation!==a.generation){r.skeleton=new _(a)
setAnimDataCostume(r,e,t)}else if(r.costume_mod!==e.costume_mod)setAnimDataCostume(r,e,t)
var i=r.costume_data
if(i.fully_drawable)return true
var o=i.attachments
var n=true
for(var s=0;s<o.length;++s){var l=o[s]
if(l.drawable||!l.geom)continue
if(f(l.geom)&&d())u(l,i)
else n=false}return n}function animationDrawPlayer(e,t,r,a,i,o){var n=T.frame_dt
var s=e.draw_opts
drawCostumePrep(e,r)
var l=e.anim_data
var _=l.skeleton,c=l.costume_data
var u=t.anim_state,d=u.anim,f=u.anim_secondary
var v=e.anim_override
if(v)if((T.frame_timestamp-v.start)/v.duration>=1)e.anim_override=null
else d=v.anim
_.update(n,d,f,a,i,o)
var h=c.attachments
for(var p=0;p<h.length;++p){var m=h[p]
var E=_.bones[m.bone]
if(m.drawable){if(e.alpha<1&&p>e.alpha*h.length);else m.drawable.draw(E.pos,E.rot,7*_.scale,s)
if(m.drawable.tool_pos)_.tool_pos=m.drawable.tool_pos
if(m.particleSystems){var g=m.particleSystems
if(!_.costume_particles[p]){_.costume_particles[p]=[]
_.original_particles[p]=g}else if(g!==_.original_particles[p]){_.costume_particles[p]=[]
_.original_particles[p]=g}_.particleSystemRunLimb(_.costume_particles[p],g,E.pos,E.rot)}}}if(e.draw_shadows)y(a,e)
return{pos:_.hand_pos,rot:_.hand_rot,animation_progress:_.time_progress}}},{"../glov/client/engine.js":305,"./animation.js":8,"./cosmetics.js":64,"./shadow.js":183,"./voxel_data_xraw.js":218}],11:[function(e,t,r){"use strict"
window.glov_build_version="1718180230532"
e("../glov/client/bootstrap.js")
var a=false
function onLoad(){if(a)return
a=true
window.time_load_onload=Date.now()
e("../glov/client/worker_comm.js").startup(null,["mesh","gen","lod"])
e("./main.js").main()
window.time_load_init=Date.now()}window.addEventListener("DOMContentLoaded",onLoad)
window.onload=onLoad},{"../glov/client/bootstrap.js":292,"../glov/client/worker_comm.js":373,"./main.js":135}],12:[function(e,t,r){"use strict"
r.accessServerSpec=accessServerSpec
r.accessRequiresToken=accessRequiresToken
r.accessHasAccess=accessHasAccess
r.accessAllowFeedback=accessAllowFeedback
r.accessSubtitle=accessSubtitle
r.accessPrerelease=accessPrerelease
r.accessFRVRAuth=accessFRVRAuth
r.accessFRVRAuthUserPassMigration=accessFRVRAuthUserPassMigration
var a=e("../glov/client/engine")
var i=e("../glov/client/net")
var o=e("./world_comm").getPerm
function accessServerSpec(){var e
return(null==(e=i.subs.cack_data.app_data)?void 0:e.access)||{}}function accessRequiresToken(){return accessServerSpec().token}function accessHasAccess(){if(accessRequiresToken())return o("access")
else return true}function accessAllowFeedback(){return accessServerSpec().feedback}function accessSubtitle(){return accessServerSpec().subtitle||""}function accessPrerelease(){return accessServerSpec().prerelease&&!a.defines.HIDE_UNRELEASED}function accessFRVRAuth(){return accessServerSpec().frvr_auth}function accessFRVRAuthUserPassMigration(){return accessServerSpec().frvr_auth_user_pass_migration}},{"../glov/client/engine":305,"../glov/client/net":338,"./world_comm":226}],13:[function(e,t,r){"use strict"
r.startup=startup
var a=e("../glov/client/cmds.js").cmd_parse
var i=e("../glov/client/settings.js")
var o=e("../glov/client/browser.js").is_discrete_gpu
var n=e("./character_controller_constants.js"),s=n.MAX_CAMERA_DISTANCE,l=n.MIN_CAMERA_DISTANCE
var _={fly_relative:{default_value:0,type:a.TYPE_INT,range:[0,1]},max_jump_tap_touch:{default_value:1,type:a.TYPE_INT,range:[0,1],help:"Jump to max height with only a tap on touch controls"},max_jump_tap_kb:{default_value:0,type:a.TYPE_INT,range:[0,1],help:"Jump to max height with only a tap on keyboard controls"},mousewheel_mode:{default_value:1,type:a.TYPE_INT,range:[0,1],help:"Mouse-wheel controls quickbar or camera distance"},ctrl_disable:{default_value:0,type:a.TYPE_INT,range:[0,1],help:"Disable Ctrl as a movement key"},camera_view:{default_value:1,type:a.TYPE_INT,range:[0,1],enum_lookup:{"1ST":0,"3RD":1}},camera_max_distance:{default_value:6,type:a.TYPE_FLOAT,range:[l,s]},fov_third_override:{default_value:0,type:a.TYPE_FLOAT,range:[0,100],help:"Override FOV in 3rd person"},mouse_sensitivity:{default_value:1,type:a.TYPE_FLOAT,range:[.001,10]},quickbar_show_inhand:{default_value:0,ver:1,type:a.TYPE_INT,range:[0,1]},quickbar_show_recent:{default_value:1,type:a.TYPE_INT,range:[0,1]},live_url:{default_value:1,type:a.TYPE_INT,range:[0,1],help:"Keep the browser URL in sync with your current location"},aa:{label:"Anti-aliasing",default_value:o?1:0,type:a.TYPE_INT,range:[0,1],help:"Use anti-aliasing when available"}}
function startup(){i.register(_)}},{"../glov/client/browser.js":293,"../glov/client/cmds.js":298,"../glov/client/settings.js":351,"./character_controller_constants.js":38}],14:[function(e,t,r){t.exports={primary:{fn:"voxels",tiles_per_row:8,tile_res:224,pad:4,tex_res:2048,nudge:[56,60],tile_map:"default"},primary_mask:{fn:"voxels_mask",tiles_per_row:8,tile_res:224,pad:4,tex_res:2048,nudge:[56,60],tile_map:"default"},primary_normal:{fn:"voxels_normal",tiles_per_row:8,tile_res:224,pad:4,tex_res:2048,nudge:[56,60],tile_map:"default"},util:{fn:"voxel_util",tiles_per_row:4,tile_res:124,pad:2,tex_res:512}}},{}],15:[function(e,t,r){"use strict"
r.gateTimeDropdown=gateTimeDropdown
r.gateAccessDropdown=gateAccessDropdown
r.gateAccessBlocked=gateAccessBlocked
r.autoActivateIgnored=autoActivateIgnored
r.autoActivateOnProp=autoActivateOnProp
r.autoActivateNoParticles=autoActivateNoParticles
r.autoActivateSuppress=autoActivateSuppress
r.autoActivateTick=autoActivateTick
r.GateAccess=r.GateTime=void 0
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var u;(function(e){e[e["DEFAULT"]=0]="DEFAULT"
e[e["FAST"]=1]="FAST"
e[e["INSTANT"]=2]="INSTANT"})((r.GateTime=u)||(r.GateTime=u={}))
var n;(function(e){e[e["PUBLIC"]=0]="PUBLIC"
e[e["BUILDERS"]=1]="BUILDERS"
e[e["BOOSTERS"]=2]="BOOSTERS"})((r.GateAccess=n)||(r.GateAccess=n={}))
var d=e("../glov/client/engine")
var i=e("../glov/client/selection_box").dropDown
var f=e("../glov/common/vmath").v3distSq
var o=e("../common/ids")
var v=o.ITEM_LEAPGATE
var h=o.ITEM_WAYGATE
var p=e("../common/leapgate_common").LeapgateMode
var s=e("./leapgate_ui")
var m=s.leapgateExecuteAutoActivate
var E=s.leapgateSelectAutoActivate
var l=e("./localization/localization").L
var g=e("./main")
var _=e("./prop_edit").saveProp
var c=e("./props").PIEB_CHECK_CUR_SIZE
var T=e("./status").statusGet
var y=e("./user_data").worldReadOnly
var S=e("./waygate_ui")
var I=S.drawWaygateFX
var A=S.waygateExecuteAutoActivate
var w=S.waygateSelectAutoActivate
var L=e("./world_comm").worldGetRoles
var O=e("./world_metadata").worldAmIBooster
var R=Math.max
var b=((a={})[u.DEFAULT]=3,a[u.FAST]=1,a[u.INSTANT]=0,a)
var N=[{name:l.LBL_WG_TIME_DEFAULT.$({val:b[u.DEFAULT]}),tag:"DEFAULT"},{name:l.LBL_WG_TIME_FAST.$({val:b[u.FAST]}),tag:"FAST"},{name:l.LBL_WG_TIME_INSTANT.$({val:b[u.INSTANT]}),tag:"INSTANT"}]
function gateTimeDropdown(e,t){var r=i(_extends({},t,{display:{centered:true},items:N}),u[e.gate_time],{suppress_return_during_dropdown:true})
if(r){e.gate_time=u[r.tag]
_(e)}}var C=[{name:l.LBL_USABLE_BY_PUBLIC,tag:"PUBLIC"},{name:l.LBL_USABLE_BY_BOOSTERS,tag:"BOOSTERS"},{name:l.LBL_USABLE_BY_BUILDERS,tag:"BUILDERS"}]
function gateAccessDropdown(e,t,r){var a=i(_extends({},r,{display:{centered:true},items:C}),n[e[t]],{suppress_return_during_dropdown:true})
if(a){e[t]=n[a.tag]
_(e)}}function gateAccessBlocked(e,t){var r=e
var a=r[t]
if(!a)return 0
var i=!y()&&r.inEditBounds(c)
var o=Boolean(L().world_admin)
if(a===n.BUILDERS&&!i)return a
else if(a===n.BOOSTERS&&!(O()||o))return a
return 0}var x=0
var M
var D=0
var P=null
var B=0
var k=null
var U=false
function autoActivateIgnored(e){return e===P}function autoActivateOnProp(e){return e===k}function autoActivateNoParticles(){return U}function autoActivateSuppress(){B=500}function autoActivateTick(e){var t=e?g.char_controller.getPropsOn():{}
var r=k=null
for(var a in t){var i=t[a]
if(i.item_id===h||i.item_id===v&&i.stage===p.COMPLETE)if(r){if(f(g.char_controller.feet_pos,i.getLocalPos())<f(g.char_controller.feet_pos,r.getLocalPos()))r=i}else r=i}var o=r&&r.item_id===h?r:null
var n=r&&r.item_id===v?r:null
var s=Boolean(o||n)
if(B){B=R(0,B-d.frame_dt)
if(r)P=r}if(P&&r===P)s=false
else if(e)P=null
var l="auto_activate"
var _={no_particles:false}
var c
if(s){if("number"!==typeof(c=b[r.gate_time]))c=b[u.DEFAULT]
c*=1e3
if(!D||c<D)D=c
if(o)s=w(o,D,l,_)
else if(n)s=E(n,D,l,_)}U=_.no_particles
if(!s){null==M||M.remove()
M=null
D=0
if(x)if(x=R(0,x-.01*d.frame_dt))I(x)
return}M=T(l)
if(!c)x=1
else x=1-D/c
I(x)
if(d.frame_dt<D){D-=d.frame_dt
k=r}else{P=r
D=0
null==M||M.remove()
M=null
if(o)A(o,_)
else if(n)m(n,_)}}},{"../common/ids":249,"../common/leapgate_common":252,"../glov/client/engine":305,"../glov/client/selection_box":350,"../glov/common/vmath":402,"./leapgate_ui":121,"./localization/localization":131,"./main":135,"./prop_edit":170,"./props":171,"./status":193,"./user_data":208,"./waygate_ui":222,"./world_comm":226,"./world_metadata":235}],16:[function(e,t,r){"use strict"
var a=e("assert")
var i=e("../../common/ids.js")
var o=e("../../common/materials_common")
var n=o.CraftClass
var s=o.Mat
var l=i.TYPE_ITEM,_=i.TYPE_BLOCK,c=i.TYPE_CRAFT_CLASS
var u=e("../items.js"),d=u.COST_FUNCS,f=u.DYNAMIC_COST_FUNCS,v=u.parseAttribMods
var h=e("../localization/localization").L
var p=e("../tiles.js")
var m=e("../../glov/common/vmath.js").vec3
var E=e("../../glov/common/util.js").arrayToSet
r.init=function(e){a(h.ITEM_ACCESS_CONTROL_NAME)
e(l,"ITEM_ACCESS_CONTROL",function ItemAccessControl(e){this.initBase(e)
this.name=h.ITEM_ACCESS_CONTROL_NAME
if(h.get("ITEM_ACCESS_CONTROL_DESC"))this.desc=h.ITEM_ACCESS_CONTROL_DESC
if(h.get("ITEM_ACCESS_CONTROL_INFO"))this.info=h.ITEM_ACCESS_CONTROL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,intangible:false,rooted:false,size_auto:true,baked_swap:true,baked_key:"access_control",cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_ALGAE_NAME)
e(l,"ITEM_ALGAE",function ItemAlgae(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_ALGAE_NAME
if(h.get("ITEM_ALGAE_DESC"))this.desc=h.ITEM_ALGAE_DESC
if(h.get("ITEM_ALGAE_INFO"))this.info=h.ITEM_ALGAE_INFO
this.cost=[d.item({type:l,id:i.ITEM_ALGAE_SPORES,count:1})]
this.updateCostFromMatMap()},{cost_mat_map:{attr1:{cost_idx:0}},see_through:true,perched:true,underwater_only:true,mat_baked_key:{MINT_ALGAE:"algae-mint",JADE_ALGAE:"algae-jade",BUBBLEGUM_ALGAE:"algae-bubblegum",INDIGO_ALGAE:"algae-indigo",ULTRAMARINE_ALGAE:"algae-ultramarine",def:"algae-mint"},stage_baked_key:["algae-0","$KEY$-1","$KEY$-2"],stage_spawn:2,growth_heights:m(1,2,4),growth_period:2,harvest_results:[{type:l,id:i.ITEM_ALGAE_SPORES,count:1,keep_attr1:true},{type:l,id:i.ITEM_ALGAE_SPORES,count:1,keep_attr1:true,drop_chance:.25},{type:l,id:i.ITEM_FIBER,count:1}],unlockable_variants:[{attr1:"JADE_ALGAE",methods:"lf_break"},{attr1:"BUBBLEGUM_ALGAE",methods:"lf_break"},{attr1:"INDIGO_ALGAE",methods:"lf_break"},{attr1:"ULTRAMARINE_ALGAE",methods:"lf_break"}],fallback_baked_key:"algae-mint",ground_filter:"sea_floor",on_unflow:"dig"})
a(h.ITEM_ALGAE_SPORES_NAME)
e(l,"ITEM_ALGAE_SPORES",function ItemAlgaeSpores(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_ALGAE_SPORES_NAME
if(h.get("ITEM_ALGAE_SPORES_DESC"))this.desc=h.ITEM_ALGAE_SPORES_DESC
if(h.get("ITEM_ALGAE_SPORES_INFO"))this.info=h.ITEM_ALGAE_SPORES_INFO},{craft_classes:E([n.PAINT_COLOR]),is_ingredient_with_no_recipes:true,placeable:false,mat_baked_key:{MINT_ALGAE:"algae_spores-mint",JADE_ALGAE:"algae_spores-jade",BUBBLEGUM_ALGAE:"algae_spores-bubblegum",INDIGO_ALGAE:"algae_spores-indigo",ULTRAMARINE_ALGAE:"algae_spores-ultramarine",def:"algae_spores-mint"},allowed_in_inventory:true,size_auto:true,has_inv_variants:true,definitive_examples:[{attr1:s.MINT_ALGAE},{attr1:s.JADE_ALGAE},{attr1:s.BUBBLEGUM_ALGAE},{attr1:s.INDIGO_ALGAE},{attr1:s.ULTRAMARINE_ALGAE}]})
a(h.ITEM_ANEMONE_NAME)
e(l,"ITEM_ANEMONE",function ItemAnemone(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_ANEMONE_NAME
if(h.get("ITEM_ANEMONE_DESC"))this.desc=h.ITEM_ANEMONE_DESC
if(h.get("ITEM_ANEMONE_INFO"))this.info=h.ITEM_ANEMONE_INFO},{def_material:s.DIRT,size:m(2,2,2),name_no_attr3:true,mat_baked_key:{def:{1:"anemone-carnation",2:"anemone-imperial",3:"anemone-cerulean",def:"anemone-carnation"}},intangible:false,dig_rate:10,unlockable_variants:[{attr1:"NONE",attr3:2,methods:"lf_break"},{attr1:"NONE",attr3:3,methods:"lf_break"}],fallback_baked_key:"anemone-carnation",cost:[d.item({type:l,id:i.ITEM_ANEMONE_PILE,count:1})]})
a(h.ITEM_ANEMONE_PILE_NAME)
e(l,"ITEM_ANEMONE_PILE",function ItemAnemonePile(e){this.initBase(e)
this.name=h.ITEM_ANEMONE_PILE_NAME
if(h.get("ITEM_ANEMONE_PILE_DESC"))this.desc=h.ITEM_ANEMONE_PILE_DESC
if(h.get("ITEM_ANEMONE_PILE_INFO"))this.info=h.ITEM_ANEMONE_PILE_INFO},{craft_classes:E([n.INGREDIENT,n.SEAFOOD]),placeable:false,baked_key:"anemone_pile",size:m(2,2,2),allowed_in_inventory:true,no_attribs:true})
a(h.ITEM_ANVIL_NAME)
e(l,"ITEM_ANVIL",function ItemAnvil(e){this.initBase(e)
this.name=h.ITEM_ANVIL_NAME
if(h.get("ITEM_ANVIL_DESC"))this.desc=h.ITEM_ANVIL_DESC
if(h.get("ITEM_ANVIL_INFO"))this.info=h.ITEM_ANVIL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:20})]
this.updateCostFromMatMap()},{def_material:s.IRON,baked_key:"anvil",baked_swap:true,intangible:false,size_auto:true,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},floater_z:1.2,unlock_display_item:{type:l,id:i.ITEM_ANVIL,attr1:s.IRON},particle_systems:[{name:"factory_spark_particles",rot:0,offset_position:m(0,0,1.5)}]})
a(h.ITEM_ARBORHEART_NAME)
e(l,"ITEM_ARBORHEART",function ItemArborheart(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_ARBORHEART_NAME
if(h.get("ITEM_ARBORHEART_DESC"))this.desc=h.ITEM_ARBORHEART_DESC
if(h.get("ITEM_ARBORHEART_INFO"))this.info=h.ITEM_ARBORHEART_INFO},{def_material:s.WOOD,allowed_in_inventory:true,allowed_in_quickbar:false,placeable:false,is_crafted:true,mat_baked_key:{LIGHT_WOOD:"arborheart-willow",DARK_WOOD:"arborheart-oak",RED_WOOD:"arborheart-pine",def:"arborheart-poplar"},size:m(1,1,1),cost:[]})
e(l,"ITEM_BAG",function ItemBag(e){this.initBase(e)},{name:"Bag",clickable:false,mineable:false,is_container:true})
a(h.ITEM_BED_NAME)
e(l,"ITEM_BED",function ItemBed(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_BED_NAME
if(h.get("ITEM_BED_DESC"))this.desc=h.ITEM_BED_DESC
if(h.get("ITEM_BED_INFO"))this.info=h.ITEM_BED_INFO
this.cost=[d.fromMaterial(this,0,60)]},{mat_baked_key:{IRON:"bed-metal",STONE:"bed-stone",FANCY_STONE:"bed-fancystone",LIGHT_WOOD:"bed-lightwood",DARK_WOOD:"bed-darkwood",RED_WOOD:"bed-redwood",def:"bed-wood"},boosted_key:{0:{FANCY_STONE:"bed-stone"}},intangible:false,size_auto:true,flips_on_x:true})
a(h.ITEM_BENCH_NAME)
e(l,"ITEM_BENCH",function ItemBench(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_BENCH_NAME
if(h.get("ITEM_BENCH_DESC"))this.desc=h.ITEM_BENCH_DESC
if(h.get("ITEM_BENCH_INFO"))this.info=h.ITEM_BENCH_INFO
this.cost=[d.fromMaterial(this,0,24)]},{mat_baked_key:{IRON:"bench-metal",STONE:"bench-stone",FANCY_STONE:"bench-fancystone",LIGHT_WOOD:"bench-lightwood",DARK_WOOD:"bench-darkwood",RED_WOOD:"bench-redwood",def:"bench-wood"},boosted_key:{0:{FANCY_STONE:"bench-stone"}},size_auto:true})
a(h.ITEM_BERRY_NAME)
e(l,"ITEM_BERRY",function ItemBerry(e){this.initBase(e)
this.name=h.ITEM_BERRY_NAME
if(h.get("ITEM_BERRY_DESC"))this.desc=h.ITEM_BERRY_DESC
if(h.get("ITEM_BERRY_INFO"))this.info=h.ITEM_BERRY_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:2}),craft_classes:E([n.INGREDIENT,n.PIE_FILLING,n.PAINT_COLOR]),placeable:false,consumable:true,allowed_in_inventory:true,baked_swap:true,baked_key:"berries-item",size_auto:true,has_inv_variants:true,definitive_examples:[{attr1:s.RED_BERRY},{attr1:s.YELLOW_BERRY},{attr1:s.BLUE_BERRY}]})
a(h.ITEM_BERRY_BUSH_BLUE_NAME)
e(l,"ITEM_BERRY_BUSH_BLUE",function ItemBerryBushBlue(e){this.initBase(e)
this.name=h.ITEM_BERRY_BUSH_BLUE_NAME
if(h.get("ITEM_BERRY_BUSH_BLUE_DESC"))this.desc=h.ITEM_BERRY_BUSH_BLUE_DESC
if(h.get("ITEM_BERRY_BUSH_BLUE_INFO"))this.info=h.ITEM_BERRY_BUSH_BLUE_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,size:m(2,2,1),allowed_in_inventory:true,always_interact:true,perched:true,baked_key:"blue-berry-bush",stage_baked_key:["$KEY$-0","$KEY$-1","$KEY$-2"],stage_spawn:2,growth_heights:m(1,1,1),growth_period:7,is_waterable:true,harvest_reverting_stage:1,harvest_results:[{type:l,id:i.ITEM_BERRY,count:1,attr1:s.BLUE_BERRY},{type:l,id:i.ITEM_BERRY_BUSH_BLUE,drop_chance:.05}],ground_filter:"dirt",growstick_chat_extra_chance:.02,growstick_chat_extra:["MSG_GROW_BERRY_BUSH_BLUE"],on_flow:"dig"})
a(h.ITEM_BERRY_BUSH_RED_NAME)
e(l,"ITEM_BERRY_BUSH_RED",function ItemBerryBushRed(e){this.initBase(e)
this.name=h.ITEM_BERRY_BUSH_RED_NAME
if(h.get("ITEM_BERRY_BUSH_RED_DESC"))this.desc=h.ITEM_BERRY_BUSH_RED_DESC
if(h.get("ITEM_BERRY_BUSH_RED_INFO"))this.info=h.ITEM_BERRY_BUSH_RED_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,size:m(2,2,1),allowed_in_inventory:true,always_interact:true,perched:true,baked_key:"red-berry-bush",stage_baked_key:["$KEY$-0","$KEY$-1","$KEY$-2"],stage_spawn:2,growth_heights:m(1,1,1),growth_period:7,is_waterable:true,harvest_reverting_stage:1,harvest_results:[{type:l,id:i.ITEM_BERRY,count:1,attr1:s.RED_BERRY},{type:l,id:i.ITEM_BERRY_BUSH_RED,drop_chance:.05}],ground_filter:"dirt",on_flow:"dig"})
a(h.ITEM_BERRY_BUSH_YELLOW_NAME)
e(l,"ITEM_BERRY_BUSH_YELLOW",function ItemBerryBushYellow(e){this.initBase(e)
this.name=h.ITEM_BERRY_BUSH_YELLOW_NAME
if(h.get("ITEM_BERRY_BUSH_YELLOW_DESC"))this.desc=h.ITEM_BERRY_BUSH_YELLOW_DESC
if(h.get("ITEM_BERRY_BUSH_YELLOW_INFO"))this.info=h.ITEM_BERRY_BUSH_YELLOW_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,size:m(2,2,2),allowed_in_inventory:true,always_interact:true,perched:true,baked_key:"yellow-berry-bush",stage_baked_key:["$KEY$-0","$KEY$-1","$KEY$-2"],stage_spawn:2,growth_heights:m(1,2,2),growth_period:7,is_waterable:true,harvest_reverting_stage:1,harvest_results:[{type:l,id:i.ITEM_BERRY,count:1,attr1:s.YELLOW_BERRY},{type:l,id:i.ITEM_BERRY_BUSH_YELLOW,drop_chance:.05}],ground_filter:"dirt",on_flow:"dig"})
a(h.ITEM_BERRY_DECORATIVE_NAME)
e(l,"ITEM_BERRY_DECORATIVE",function ItemBerryDecorative(e){this.initBase(e)
this.name=h.ITEM_BERRY_DECORATIVE_NAME
if(h.get("ITEM_BERRY_DECORATIVE_DESC"))this.desc=h.ITEM_BERRY_DECORATIVE_DESC
if(h.get("ITEM_BERRY_DECORATIVE_INFO"))this.info=h.ITEM_BERRY_DECORATIVE_INFO
this.cost=[d.item({type:l,id:i.ITEM_BERRY,count:1})]
this.updateCostFromMatMap()},{def_material:s.LEAF,placeable:true,size:m(1,1,1),cost_mat_map:{attr1:{cost_idx:0}},baked_swap:true,baked_key:"berries-build",allowed_in_inventory:false,definitive_examples:[{attr1:s.RED_BERRY},{attr1:s.YELLOW_BERRY},{attr1:s.BLUE_BERRY}]})
a(h.ITEM_BONFIRE_NAME)
e(l,"ITEM_BONFIRE",function ItemBonfire(e){this.initBase(e)
this.name=h.ITEM_BONFIRE_NAME
if(h.get("ITEM_BONFIRE_DESC"))this.desc=h.ITEM_BONFIRE_DESC
if(h.get("ITEM_BONFIRE_INFO"))this.info=h.ITEM_BONFIRE_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:5}),d.item({type:c,id:n.STONE_RAW,count:5})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"bonfire",baked_swap:true,intangible:false,size_auto:true,particles_always_on_in_unlimited:true,progress_indicator:false,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE",pick_as:0}},floater_z:1.1,particle_systems:[{name:"factory_bonfire_particles",rot:0,offset_position:m(0,0,.4)},{name:"factory_bonfire_smoke_particles",rot:0,offset_position:m(0,0,1.4)}]})
a(h.ITEM_BONFIRE_METAL_NAME)
e(l,"ITEM_BONFIRE_METAL",function ItemBonfireMetal(e){this.initBase(e)
this.name=h.ITEM_BONFIRE_METAL_NAME
if(h.get("ITEM_BONFIRE_METAL_DESC"))this.desc=h.ITEM_BONFIRE_METAL_DESC
if(h.get("ITEM_BONFIRE_METAL_INFO"))this.info=h.ITEM_BONFIRE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1}),d.item({type:c,id:n.STONE_RAW,count:10})]
this.updateCostFromMatMap()},{def_material:s.IRON,baked_key:"bonfire-metal",baked_swap:true,intangible:false,size_auto:true,particles_always_on_in_unlimited:true,progress_indicator:false,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"},attr2:{cost_idx:1,def:"STONE",pick_as:0}},floater_z:1.5,particle_systems:[{name:"factory_bonfire_particles",rot:0,offset_position:m(0,0,1)},{name:"factory_bonfire_smoke_particles",rot:0,offset_position:m(0,0,2)}]})
a(h.ITEM_BOTTLE_NAME)
a(h.ITEM_BOTTLE_BUILD_NAME)
e(l,"ITEM_BOTTLE",function ItemBottle(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_BOTTLE_NAME
this.build_name=h.ITEM_BOTTLE_BUILD_NAME
if(h.get("ITEM_BOTTLE_DESC"))this.desc=h.ITEM_BOTTLE_DESC
if(h.get("ITEM_BOTTLE_INFO"))this.info=h.ITEM_BOTTLE_INFO},{def_material:s.SAND,name_no_attr3:true,allowed_in_inventory:true,mat_baked_key:{def:{1:"bottle-empty-build",def:"bottle-small"}},quickbar_default_build:{type:l,id:i.ITEM_BOTTLE,attr3:1},baked_key_resource:"bottle-empty",is_crafted:true,no_attribs:true,size:m(1,1,1),build_name:i.ITEM_BOTTLE_BUILD_NAME,cost:[d.item({type:l,id:i.ITEM_BOTTLE,count:1})]})
a(h.ITEM_BRANCHFORGE_NAME)
e(l,"ITEM_BRANCHFORGE",function ItemBranchforge(e){this.initBase(e)
this.name=h.ITEM_BRANCHFORGE_NAME
if(h.get("ITEM_BRANCHFORGE_DESC"))this.desc=h.ITEM_BRANCHFORGE_DESC
if(h.get("ITEM_BRANCHFORGE_INFO"))this.info=h.ITEM_BRANCHFORGE_INFO
this.cost=[d.item({type:c,id:n.WOOD_RAW,count:30}),d.item({type:_,id:p.LEAVES3,count:100}),d.item({type:_,id:p.VEINIUM,count:77})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"branchforge",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},floater_z:.5,particle_systems:[{name:"factory_branchforge_base",offset_position:m(0,0,1)},{name:"factory_branchforge_rise",offset_position:m(0,0,.714)}]})
a(h.ITEM_BREAD_NAME)
e(l,"ITEM_BREAD",function ItemBread(e){this.initBase(e)
this.name=h.ITEM_BREAD_NAME
if(h.get("ITEM_BREAD_DESC"))this.desc=h.ITEM_BREAD_DESC
if(h.get("ITEM_BREAD_INFO"))this.info=h.ITEM_BREAD_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:5}),craft_classes:E([n.INGREDIENT]),placeable:false,size_auto:true,allowed_in_inventory:true,consumable:true,baked_key:"bread-item",is_crafted:true,no_attr1:true,no_attr2:true})
a(h.ITEM_BREAD_DECORATIVE_NAME)
e(l,"ITEM_BREAD_DECORATIVE",function ItemBreadDecorative(e){this.initBase(e)
this.name=h.ITEM_BREAD_DECORATIVE_NAME
if(h.get("ITEM_BREAD_DECORATIVE_DESC"))this.desc=h.ITEM_BREAD_DECORATIVE_DESC
if(h.get("ITEM_BREAD_DECORATIVE_INFO"))this.info=h.ITEM_BREAD_DECORATIVE_INFO},{def_material:s.LEAF,intangible:false,placeable:true,size:m(1,1,1),baked_key:"bread-build",allowed_in_inventory:false,cost:[d.item({type:l,id:i.ITEM_BREAD,count:1})]})
a(h.ITEM_BUCKET_NAME)
e(l,"ITEM_BUCKET",function ItemBucket(e){this.initBase(e)
this.name=h.ITEM_BUCKET_NAME
if(h.get("ITEM_BUCKET_DESC"))this.desc=h.ITEM_BUCKET_DESC
if(h.get("ITEM_BUCKET_INFO"))this.info=h.ITEM_BUCKET_INFO},{placeable:false,no_spin:true,potentially_unlimited:true,allowed_in_inventory:true,tool_page:true,is_crafted:true,recipe_list:["wood_bucket","metal_bucket"],is_tool:true})
a(h.ITEM_BUZZERGOAL_NAME)
e(l,"ITEM_BUZZERGOAL",function ItemBuzzergoal(e){this.initBase(e)
this.name=h.ITEM_BUZZERGOAL_NAME
if(h.get("ITEM_BUZZERGOAL_DESC"))this.desc=h.ITEM_BUZZERGOAL_DESC
if(h.get("ITEM_BUZZERGOAL_INFO"))this.info=h.ITEM_BUZZERGOAL_INFO
this.cost=[d.item({type:c,id:n.STONE_RAW,count:15}),d.item({type:l,id:i.ITEM_CORD,count:3})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"buzzergoal_ready",intangible:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},see_through:true,particle_systems:[{name:"buzzer_circle_bottom_particles",rot:0,offset_position:m(0,0,0)}],particle_triggers:{fireworks:[{name:"buzzer_firework_particles",rot:0,offset_position:m(0,0,3)}]}})
a(h.ITEM_BUZZERSTART_NAME)
e(l,"ITEM_BUZZERSTART",function ItemBuzzerstart(e){this.initBase(e)
this.name=h.ITEM_BUZZERSTART_NAME
if(h.get("ITEM_BUZZERSTART_DESC"))this.desc=h.ITEM_BUZZERSTART_DESC
if(h.get("ITEM_BUZZERSTART_INFO"))this.info=h.ITEM_BUZZERSTART_INFO
this.cost=[d.item({type:c,id:n.STONE_RAW,count:15}),d.item({type:l,id:i.ITEM_CORD,count:3})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"buzzerstart_ready",intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},particle_triggers:{press:[{name:"buzzer_smoke_particles",rot:0,offset_position:m(0,0,1)},{name:"buzzer_spark_particles",rot:0,offset_position:m(0,0,1)}]}})
a(h.ITEM_CACTINY_NAME)
e(l,"ITEM_CACTINY",function ItemCactiny(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CACTINY_NAME
if(h.get("ITEM_CACTINY_DESC"))this.desc=h.ITEM_CACTINY_DESC
if(h.get("ITEM_CACTINY_INFO"))this.info=h.ITEM_CACTINY_INFO
this.cost=[d.item({type:l,id:i.ITEM_CACTINY_SEEDS,count:1})]
this.updateCostFromMatMap()},{cost_mat_map:{attr1:{cost_idx:0}},perched:true,ground_filter:"sand",mat_baked_key:{LIZARDITE_CACTINY:"cactiny-lizardite",AMETHYST_CACTINY:"cactiny-amethyst",def:"cactiny-lizardite"},size:m(1,1,1),stage_baked_key:["cactiny-0","$KEY$-1","$KEY$-2"],stage_spawn:2,growth_heights:m(1,1,2),growth_period:3,harvest_results:[{type:l,id:i.ITEM_CACTINY_SEEDS,count:1,keep_attr1:true},{type:l,id:i.ITEM_CACTINY_SEEDS,count:1,keep_attr1:true,drop_chance:.1},{type:l,id:i.ITEM_FIBER,count:1,drop_chance:.5}],unlockable_variants:[{attr1:"AMETHYST_CACTINY",methods:"lf_break"}],fallback_baked_key:"cactiny-lizardite",growstick_chat_extra_chance:.1,growstick_chat_extra:["MSG_GROW_CACTUS1","MSG_GROW_CACTUS2"],on_flow:"dig"})
a(h.ITEM_CACTINY_SEEDS_NAME)
e(l,"ITEM_CACTINY_SEEDS",function ItemCactinySeeds(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CACTINY_SEEDS_NAME
if(h.get("ITEM_CACTINY_SEEDS_DESC"))this.desc=h.ITEM_CACTINY_SEEDS_DESC
if(h.get("ITEM_CACTINY_SEEDS_INFO"))this.info=h.ITEM_CACTINY_SEEDS_INFO},{craft_classes:E([n.PAINT_COLOR]),is_ingredient_with_no_recipes:true,placeable:false,mat_baked_key:{LIZARDITE_CACTINY:"cactiny_seeds-lizardite",AMETHYST_CACTINY:"cactiny_seeds-amethyst",def:"cactiny_seeds-lizardite"},allowed_in_inventory:true,size_auto:true,has_inv_variants:true,definitive_examples:[{attr1:s.LIZARDITE_CACTINY},{attr1:s.AMETHYST_CACTINY}]})
a(h.ITEM_CACTORB_NAME)
e(l,"ITEM_CACTORB",function ItemCactorb(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CACTORB_NAME
if(h.get("ITEM_CACTORB_DESC"))this.desc=h.ITEM_CACTORB_DESC
if(h.get("ITEM_CACTORB_INFO"))this.info=h.ITEM_CACTORB_INFO
this.cost=[d.item({type:l,id:i.ITEM_CACTORB_SEEDS,count:1})]
this.updateCostFromMatMap()},{cost_mat_map:{attr1:{cost_idx:0}},perched:true,ground_filter:"sand",mat_baked_key:{RUBY_CACTORB:"cactorb-ruby",KYANITE_CACTORB:"cactorb-kyanite",def:"cactorb-ruby"},size:m(2,2,1),stage_baked_key:["cactorb-0","$KEY$-1","$KEY$-2"],stage_spawn:2,growth_heights:m(1,1,2),growth_period:3,harvest_results:[{type:l,id:i.ITEM_CACTORB_SEEDS,count:1,keep_attr1:true},{type:l,id:i.ITEM_CACTORB_SEEDS,count:1,keep_attr1:true,drop_chance:.1},{type:l,id:i.ITEM_FIBER,count:1,drop_chance:.5},{type:l,id:i.ITEM_FIBER,count:1}],unlockable_variants:[{attr1:"KYANITE_CACTORB",methods:"lf_break"}],fallback_baked_key:"cactorb-ruby",growstick_chat_extra_chance:.1,growstick_chat_extra:["MSG_GROW_CACTUS1","MSG_GROW_CACTUS2"],on_flow:"dig"})
a(h.ITEM_CACTORB_SEEDS_NAME)
e(l,"ITEM_CACTORB_SEEDS",function ItemCactorbSeeds(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CACTORB_SEEDS_NAME
if(h.get("ITEM_CACTORB_SEEDS_DESC"))this.desc=h.ITEM_CACTORB_SEEDS_DESC
if(h.get("ITEM_CACTORB_SEEDS_INFO"))this.info=h.ITEM_CACTORB_SEEDS_INFO},{craft_classes:E([n.PAINT_COLOR]),is_ingredient_with_no_recipes:true,placeable:false,mat_baked_key:{RUBY_CACTORB:"cactorb_seeds-ruby",KYANITE_CACTORB:"cactorb_seeds-kyanite",def:"cactorb_seeds-ruby"},allowed_in_inventory:true,size_auto:true,has_inv_variants:true,definitive_examples:[{attr1:s.RUBY_CACTORB},{attr1:s.KYANITE_CACTORB}]})
a(h.ITEM_CAMPFIRE_NAME)
e(l,"ITEM_CAMPFIRE",function ItemCampfire(e){this.initBase(e)
this.name=h.ITEM_CAMPFIRE_NAME
if(h.get("ITEM_CAMPFIRE_DESC"))this.desc=h.ITEM_CAMPFIRE_DESC
if(h.get("ITEM_CAMPFIRE_INFO"))this.info=h.ITEM_CAMPFIRE_INFO
this.cost=[d.item({type:c,id:n.WOOD_RAW,count:5}),d.item({type:c,id:n.STONE_RAW,count:5})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"campfire",baked_swap:true,intangible:false,size_auto:true,place_rot:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.1,particles_always_on_in_unlimited:true,particle_systems:[{name:"factory_campfire_particles",rot:0,offset_position:m(.1,-.1,0)},{name:"factory_fire_burst_particles",rot:0,offset_position:m(.1,-.1,.8)},{name:"factory_campfire_smoke_particles",rot:0,offset_position:m(0,0,1.2)}]})
a(h.ITEM_CARROT_NAME)
e(l,"ITEM_CARROT",function ItemCarrot(e){this.initBase(e)
this.name=h.ITEM_CARROT_NAME
if(h.get("ITEM_CARROT_DESC"))this.desc=h.ITEM_CARROT_DESC
if(h.get("ITEM_CARROT_INFO"))this.info=h.ITEM_CARROT_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:2}),craft_classes:E([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_key:"carrot",size_auto:true,placeable:false,consumable:true,allowed_in_inventory:true})
a(h.ITEM_CHAIN_NAME)
e(l,"ITEM_CHAIN",function ItemChain(e){this.initBase(e)
this.name=h.ITEM_CHAIN_NAME
if(h.get("ITEM_CHAIN_DESC"))this.desc=h.ITEM_CHAIN_DESC
if(h.get("ITEM_CHAIN_INFO"))this.info=h.ITEM_CHAIN_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"chain",baked_swap:true,intangible:true,size_auto:true,pick_as_mode:0,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},mode_list:["Vert","Horiz"],mode_list_ids:[null,i.ITEM_CHAINH],see_through:true})
e(l,"ITEM_CHAINH",function ItemChainh(e){this.initBase(e)
a(h.ITEM_CHAIN_NAME)
this.name=h.ITEM_CHAIN_NAME
if(h.get("ITEM_CHAINH_DESC"))this.desc=h.ITEM_CHAINH_DESC
if(h.get("ITEM_CHAINH_INFO"))this.info=h.ITEM_CHAINH_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"chain-horizontal",baked_swap:true,intangible:false,size_auto:true,pick_as_id:i.ITEM_CHAIN,pick_as_mode:1,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},see_through:true})
a(h.ITEM_CHAIR_NAME)
e(l,"ITEM_CHAIR",function ItemChair(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHAIR_NAME
if(h.get("ITEM_CHAIR_DESC"))this.desc=h.ITEM_CHAIR_DESC
if(h.get("ITEM_CHAIR_INFO"))this.info=h.ITEM_CHAIR_INFO
this.cost=[d.fromMaterial(this,0,12)]},{mat_baked_key:{STONE:"chair-stone",FANCY_STONE:"chair-fancystone",LIGHT_WOOD:"chair-lightwood",DARK_WOOD:"chair-darkwood",RED_WOOD:"chair-redwood",def:"chair-wood"},boosted_key:{0:{FANCY_STONE:"chair-stone"}},intangible:false,tangible_height:1,size_auto:true,snapshot_size:m(1,1,2)})
e(l,"ITEM_CHAIR_METAL",function ItemChairMetal(e){this.initBase(e)
a(h.ITEM_CHAIR_NAME)
this.name=h.ITEM_CHAIR_NAME
if(h.get("ITEM_CHAIR_METAL_DESC"))this.desc=h.ITEM_CHAIR_METAL_DESC
if(h.get("ITEM_CHAIR_METAL_INFO"))this.info=h.ITEM_CHAIR_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:5})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"chair-metal",baked_swap:true,intangible:false,tangible_height:1,size_auto:true,snapshot_size:m(1,1,2),cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_CHEST_MEDIUM_NAME)
e(l,"ITEM_CHEST_MEDIUM",function ItemChestMedium(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_MEDIUM_NAME
if(h.get("ITEM_CHEST_MEDIUM_DESC"))this.desc=h.ITEM_CHEST_MEDIUM_DESC
if(h.get("ITEM_CHEST_MEDIUM_INFO"))this.info=h.ITEM_CHEST_MEDIUM_INFO
this.cost=[d.fromMaterial(this,0,30)]},{intangible:false,is_container:true,name_no_attr3:true,size_auto:true,mat_baked_key:{IRON:"chest-medium-metal",STONE:"chest-medium-stone",FANCY_STONE:"chest-medium-fancystone",LIGHT_WOOD:{2:"crate-wood",def:"chest-medium-lightwood"},DARK_WOOD:{2:"crate-wood",def:"chest-medium-darkwood"},RED_WOOD:{2:"crate-wood",def:"chest-medium-redwood"},def:{1:"chest-medium-sunken",2:"crate-wood",def:"chest-medium-wood"}},baked_swap:true,boosted_key:{0:{FANCY_STONE:"chest-medium-stone"}},unlockable_variants:[{attr1:"WOOD",attr3:1,methods:"lf_break",tab:"props"}],fallback_baked_key:"chest-medium-wood"})
e(l,"ITEM_CHEST_MEDIUM_METAL",function ItemChestMediumMetal(e){this.initBase(e)
a(h.ITEM_CHEST_MEDIUM_NAME)
this.name=h.ITEM_CHEST_MEDIUM_NAME
if(h.get("ITEM_CHEST_MEDIUM_METAL_DESC"))this.desc=h.ITEM_CHEST_MEDIUM_METAL_DESC
if(h.get("ITEM_CHEST_MEDIUM_METAL_INFO"))this.info=h.ITEM_CHEST_MEDIUM_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:8})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,intangible:false,is_container:true,size_auto:true,baked_key:"chest-medium-metal",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_CHEST_MEDIUM_WOOD_ALIAS",function ItemChestMediumWoodAlias(e){this.initBase(e)
a(h.ITEM_CHEST_MEDIUM_2_NAME)
this.name=h.ITEM_CHEST_MEDIUM_2_NAME
if(h.get("ITEM_CHEST_MEDIUM_WOOD_ALIAS_DESC"))this.desc=h.ITEM_CHEST_MEDIUM_WOOD_ALIAS_DESC
if(h.get("ITEM_CHEST_MEDIUM_WOOD_ALIAS_INFO"))this.info=h.ITEM_CHEST_MEDIUM_WOOD_ALIAS_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:30})]
this.updateCostFromMatMap()},{def_material:s.WOOD,place_as_id:i.ITEM_CHEST_MEDIUM,any_as_material_class:true,name_no_attr3:true,baked_key:"crate-wood",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_CHEST_SMALL_NAME)
e(l,"ITEM_CHEST_SMALL",function ItemChestSmall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_SMALL_NAME
if(h.get("ITEM_CHEST_SMALL_DESC"))this.desc=h.ITEM_CHEST_SMALL_DESC
if(h.get("ITEM_CHEST_SMALL_INFO"))this.info=h.ITEM_CHEST_SMALL_INFO
this.cost=[d.fromMaterial(this,0,20)]},{intangible:false,is_container:true,size:m(2,1,1),mat_baked_key:{IRON:"chest-small-metal",STONE:"chest-small-stone",FANCY_STONE:"chest-small-fancystone",LIGHT_WOOD:"chest-small-lightwood",DARK_WOOD:"chest-small-darkwood",RED_WOOD:"chest-small-redwood",def:"chest-small-wood"},boosted_key:{0:{FANCY_STONE:"chest-small-stone"}}})
a(h.ITEM_CHEST_TALL_NAME)
e(l,"ITEM_CHEST_TALL",function ItemChestTall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_TALL_NAME
if(h.get("ITEM_CHEST_TALL_DESC"))this.desc=h.ITEM_CHEST_TALL_DESC
if(h.get("ITEM_CHEST_TALL_INFO"))this.info=h.ITEM_CHEST_TALL_INFO
this.cost=[d.fromMaterial(this,0,60)]},{intangible:false,is_container:true,size_auto:true,mat_baked_key:{IRON:"chest-tall-metal",STONE:"chest-tall-stone",FANCY_STONE:"chest-tall-fancystone",LIGHT_WOOD:"chest-tall-lightwood",DARK_WOOD:"chest-tall-darkwood",RED_WOOD:"chest-tall-redwood",def:"chest-tall-wood"},boosted_key:{0:{FANCY_STONE:"chest-tall-stone"}}})
a(h.ITEM_CHEST_TINY_NAME)
e(l,"ITEM_CHEST_TINY",function ItemChestTiny(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CHEST_TINY_NAME
if(h.get("ITEM_CHEST_TINY_DESC"))this.desc=h.ITEM_CHEST_TINY_DESC
if(h.get("ITEM_CHEST_TINY_INFO"))this.info=h.ITEM_CHEST_TINY_INFO
this.cost=[d.fromMaterial(this,0,10)]},{intangible:false,is_container:true,mat_baked_key:{IRON:"chest-tiny-metal",STONE:"chest-tiny-stone",FANCY_STONE:"chest-tiny-fancystone",LIGHT_WOOD:"chest-tiny-lightwood",DARK_WOOD:"chest-tiny-darkwood",RED_WOOD:"chest-tiny-redwood",def:"chest-tiny-wood"},boosted_key:{0:{FANCY_STONE:"chest-tiny-stone"}}})
a(h.ITEM_COAL_NAME)
e(l,"ITEM_COAL",function ItemCoal(e){this.initBase(e)
this.initPreviewBlock()
this.name=h.ITEM_COAL_NAME
if(h.get("ITEM_COAL_DESC"))this.desc=h.ITEM_COAL_DESC
if(h.get("ITEM_COAL_INFO"))this.info=h.ITEM_COAL_INFO
this.cost=[d.identity(this,1)]},{def_material:s.COAL,baked_key:"coal",intangible:true,size_auto:true,allowed_in_inventory:true,fuel_rate:1,preview_block_map:{def:"COAL"},is_crafted:true,no_attribs:true})
a(h.ITEM_CORAL_CRUNCH_NAME)
e(l,"ITEM_CORAL_CRUNCH",function ItemCoralCrunch(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_CORAL_CRUNCH_NAME
if(h.get("ITEM_CORAL_CRUNCH_DESC"))this.desc=h.ITEM_CORAL_CRUNCH_DESC
if(h.get("ITEM_CORAL_CRUNCH_INFO"))this.info=h.ITEM_CORAL_CRUNCH_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({TIMED_UNDERWATER_SPEED_MEDIUM:120}),craft_classes:E([n.INGREDIENT]),baked_key:"coral_crunch",placeable:false,allowed_in_inventory:true,size:m(2,2,2),consumable:true,is_crafted:true,no_attr1:true,no_attr2:true})
a(h.ITEM_CORAL_POWDER_NAME)
e(l,"ITEM_CORAL_POWDER",function ItemCoralPowder(e){this.initBase(e)
this.name=h.ITEM_CORAL_POWDER_NAME
if(h.get("ITEM_CORAL_POWDER_DESC"))this.desc=h.ITEM_CORAL_POWDER_DESC
if(h.get("ITEM_CORAL_POWDER_INFO"))this.info=h.ITEM_CORAL_POWDER_INFO
this.cost=[d.identity(this,1)]},{craft_classes:E([n.INGREDIENT]),baked_key:"coral_powder",allowed_in_inventory:true,size:m(2,2,2),is_crafted:true,no_attribs:true,placeable:false})
a(h.ITEM_CORAL_TUBES_NAME)
e(l,"ITEM_CORAL_TUBES",function ItemCoralTubes(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_CORAL_TUBES_NAME
if(h.get("ITEM_CORAL_TUBES_DESC"))this.desc=h.ITEM_CORAL_TUBES_DESC
if(h.get("ITEM_CORAL_TUBES_INFO"))this.info=h.ITEM_CORAL_TUBES_INFO},{def_material:s.DIRT,size:m(2,2,2),name_no_attr3:true,mat_baked_key:{def:{1:"coral_tubes-pizzazz",2:"coral_tubes-butter",def:"coral_tubes-pizzazz"}},stage_baked_key:["$KEY$-0","$KEY$-1"],stage_spawn:1,growth_heights:[1,2],growth_period:6,unlockable_variants:[{attr1:"NONE",attr3:2,methods:"lf_break"}],fallback_baked_key:"coral_tubes-pizzazz",perched:true,underwater_only:true,particle_systems:[{name:"tube_air_bubbles_particles",rot:0,offset_position:m(0,0,1.3)}],cost:[d.item({type:l,id:i.ITEM_CORAL_POWDER,count:3})]})
a(h.ITEM_CORD_NAME)
e(l,"ITEM_CORD",function ItemCord(e){this.initBase(e)
this.name=h.ITEM_CORD_NAME
if(h.get("ITEM_CORD_DESC"))this.desc=h.ITEM_CORD_DESC
if(h.get("ITEM_CORD_INFO"))this.info=h.ITEM_CORD_INFO},{baked_key:"cord",placeable:false,is_crafted:true,no_attribs:true,size:m(1.5,1.5,1)})
a(h.ITEM_CORN_NAME)
e(l,"ITEM_CORN",function ItemCorn(e){this.initBase(e)
this.name=h.ITEM_CORN_NAME
if(h.get("ITEM_CORN_DESC"))this.desc=h.ITEM_CORN_DESC
if(h.get("ITEM_CORN_INFO"))this.info=h.ITEM_CORN_INFO},{craft_classes:E([n.CEREAL_GRAIN,n.GRINDABLE,n.INGREDIENT,n.VEGETABLE]),placeable:false,baked_key:"corn-harvested",allowed_in_inventory:true,size:m(2,2,2)})
a(h.ITEM_CROISSANT_NAME)
e(l,"ITEM_CROISSANT",function ItemCroissant(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_CROISSANT_NAME
if(h.get("ITEM_CROISSANT_DESC"))this.desc=h.ITEM_CROISSANT_DESC
if(h.get("ITEM_CROISSANT_INFO"))this.info=h.ITEM_CROISSANT_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:5}),craft_classes:E([n.INGREDIENT]),placeable:false,size:m(2,2,2),allowed_in_inventory:true,consumable:true,baked_key:"croissant",is_crafted:true})
e(l,"ITEM_CUP_METAL",function ItemCupMetal(e){this.initBase(e)
a(h.ITEM_CUP_WOOD_NAME)
this.name=h.ITEM_CUP_WOOD_NAME
if(h.get("ITEM_CUP_METAL_DESC"))this.desc=h.ITEM_CUP_METAL_DESC
if(h.get("ITEM_CUP_METAL_INFO"))this.info=h.ITEM_CUP_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"cup-metal",baked_swap:true,size_auto:true,intangible:false,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_CUP_STONE",function ItemCupStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_CUP_WOOD_NAME)
this.name=h.ITEM_CUP_WOOD_NAME
if(h.get("ITEM_CUP_STONE_DESC"))this.desc=h.ITEM_CUP_STONE_DESC
if(h.get("ITEM_CUP_STONE_INFO"))this.info=h.ITEM_CUP_STONE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,mat_baked_key:{FANCY_STONE:"cup-fancystone",def:"cup-stone"},boosted_key:{0:{FANCY_STONE:"cup-stone"}},size_auto:true,intangible:false})
a(h.ITEM_CUP_WOOD_NAME)
e(l,"ITEM_CUP_WOOD",function ItemCupWood(e){this.initBase(e)
this.name=h.ITEM_CUP_WOOD_NAME
if(h.get("ITEM_CUP_WOOD_DESC"))this.desc=h.ITEM_CUP_WOOD_DESC
if(h.get("ITEM_CUP_WOOD_INFO"))this.info=h.ITEM_CUP_WOOD_INFO
this.cost=[d.item({type:c,id:n.WOOD_RAW,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,any_as_material_class:true,baked_key:"cup-wood",baked_swap:true,size_auto:true,intangible:false,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_DISC_CORAL_NAME)
e(l,"ITEM_DISC_CORAL",function ItemDiscCoral(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_DISC_CORAL_NAME
if(h.get("ITEM_DISC_CORAL_DESC"))this.desc=h.ITEM_DISC_CORAL_DESC
if(h.get("ITEM_DISC_CORAL_INFO"))this.info=h.ITEM_DISC_CORAL_INFO},{def_material:s.DIRT,size:m(4,4,1),name_no_attr3:true,mat_baked_key:{def:{1:"disc_coral-scarlet",2:"disc_coral-evergreen",3:"disc_coral-piggy",4:"disc_coral-tangerine",5:"disc_coral-teal",def:"disc_coral-scarlet"}},intangible:false,unlockable_variants:[{attr1:"NONE",attr3:2,methods:"lf_break"},{attr1:"NONE",attr3:3,methods:"lf_break"},{attr1:"NONE",attr3:4,methods:"lf_break"},{attr1:"NONE",attr3:5,methods:"lf_break"}],fallback_baked_key:"disc_coral-scarlet",cost:[d.item({type:l,id:i.ITEM_CORAL_POWDER,count:3})]})
a(h.ITEM_DOME_NAME)
e(l,"ITEM_DOME",function ItemDome(e){this.initBase(e)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOME_DESC"))this.desc=h.ITEM_DOME_DESC
if(h.get("ITEM_DOME_INFO"))this.info=h.ITEM_DOME_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_swap:true,baked_key:"dome-auto",is_crafted:false,intangible:false,size_auto:true,no_auto_rot:true,mode_list:["Auto","Base","Horiz","Top"],mode_list_ids:[null,i.ITEM_DOMEBASE,i.ITEM_DOMEHORIZ,i.ITEM_DOMETOP],pick_as_mode:0,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_DOMEBASE",function ItemDomebase(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMEBASE_DESC"))this.desc=h.ITEM_DOMEBASE_DESC
if(h.get("ITEM_DOMEBASE_INFO"))this.info=h.ITEM_DOMEBASE_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{is_crafted:false,intangible:false,no_auto_rot:true,baked_key:"dome-base",baked_swap:true,pick_as_id:i.ITEM_DOME,pick_as_mode:1,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_DOMEHORIZ",function ItemDomehoriz(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMEHORIZ_DESC"))this.desc=h.ITEM_DOMEHORIZ_DESC
if(h.get("ITEM_DOMEHORIZ_INFO"))this.info=h.ITEM_DOMEHORIZ_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"dome-horiz",baked_swap:true,pick_as_id:i.ITEM_DOME,pick_as_mode:2,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_DOMESTONE",function ItemDomestone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMESTONE_DESC"))this.desc=h.ITEM_DOMESTONE_DESC
if(h.get("ITEM_DOMESTONE_INFO"))this.info=h.ITEM_DOMESTONE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,mat_baked_key:{FANCY_STONE:"dome-fancystone-auto",def:"dome-stone-auto"},baked_swap:true,boosted_key:{0:{FANCY_STONE:"dome-stone-auto"}},is_crafted:false,intangible:false,size_auto:true,mode_list:["Auto","Base","Horiz","Top"],mode_list_ids:[null,i.ITEM_DOMESTONEBASE,i.ITEM_DOMESTONEHORIZ,i.ITEM_DOMESTONETOP],pick_as_mode:0})
e(l,"ITEM_DOMESTONEBASE",function ItemDomestonebase(e){this.initBase(e)
this.initBaked()
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMESTONEBASE_DESC"))this.desc=h.ITEM_DOMESTONEBASE_DESC
if(h.get("ITEM_DOMESTONEBASE_INFO"))this.info=h.ITEM_DOMESTONEBASE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,is_crafted:false,intangible:false,mat_baked_key:{FANCY_STONE:"dome-fancystone-base",def:"dome-stone-base"},boosted_key:{0:{FANCY_STONE:"dome-stone-base"}},baked_swap:true,pick_as_id:i.ITEM_DOMESTONE,pick_as_mode:1})
e(l,"ITEM_DOMESTONEHORIZ",function ItemDomestonehoriz(e){this.initBase(e)
this.initBaked()
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMESTONEHORIZ_DESC"))this.desc=h.ITEM_DOMESTONEHORIZ_DESC
if(h.get("ITEM_DOMESTONEHORIZ_INFO"))this.info=h.ITEM_DOMESTONEHORIZ_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,is_crafted:false,intangible:false,mat_baked_key:{FANCY_STONE:"dome-fancystone-horiz",def:"dome-stone-horiz"},boosted_key:{0:{FANCY_STONE:"dome-stone-horiz"}},baked_swap:true,pick_as_id:i.ITEM_DOMESTONE,pick_as_mode:2})
e(l,"ITEM_DOMESTONETOP",function ItemDomestonetop(e){this.initBase(e)
this.initBaked()
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMESTONETOP_DESC"))this.desc=h.ITEM_DOMESTONETOP_DESC
if(h.get("ITEM_DOMESTONETOP_INFO"))this.info=h.ITEM_DOMESTONETOP_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,is_crafted:false,intangible:false,mat_baked_key:{FANCY_STONE:"dome-fancystone-top",def:"dome-stone-top"},boosted_key:{0:{FANCY_STONE:"dome-stone-top"}},baked_swap:true,pick_as_id:i.ITEM_DOMESTONE,pick_as_mode:3})
e(l,"ITEM_DOMETOP",function ItemDometop(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMETOP_DESC"))this.desc=h.ITEM_DOMETOP_DESC
if(h.get("ITEM_DOMETOP_INFO"))this.info=h.ITEM_DOMETOP_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{is_crafted:false,intangible:false,no_auto_rot:true,baked_key:"dome-top",baked_swap:true,pick_as_id:i.ITEM_DOME,pick_as_mode:3,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_DOMEWOOD",function ItemDomewood(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMEWOOD_DESC"))this.desc=h.ITEM_DOMEWOOD_DESC
if(h.get("ITEM_DOMEWOOD_INFO"))this.info=h.ITEM_DOMEWOOD_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,any_as_material_class:true,baked_key:"dome-wood-auto",baked_swap:true,is_crafted:false,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},mode_list:["Auto","Base","Horiz","Top"],mode_list_ids:[null,i.ITEM_DOMEWOODBASE,i.ITEM_DOMEWOODHORIZ,i.ITEM_DOMEWOODTOP],pick_as_mode:0})
e(l,"ITEM_DOMEWOODBASE",function ItemDomewoodbase(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMEWOODBASE_DESC"))this.desc=h.ITEM_DOMEWOODBASE_DESC
if(h.get("ITEM_DOMEWOODBASE_INFO"))this.info=h.ITEM_DOMEWOODBASE_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,baked_key:"dome-wood-base",baked_swap:true,pick_as_id:i.ITEM_DOMEWOOD,pick_as_mode:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_DOMEWOODHORIZ",function ItemDomewoodhoriz(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMEWOODHORIZ_DESC"))this.desc=h.ITEM_DOMEWOODHORIZ_DESC
if(h.get("ITEM_DOMEWOODHORIZ_INFO"))this.info=h.ITEM_DOMEWOODHORIZ_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,baked_key:"dome-wood-horiz",baked_swap:true,pick_as_id:i.ITEM_DOMEWOOD,pick_as_mode:2,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_DOMEWOODTOP",function ItemDomewoodtop(e){this.initBase(e)
a(h.ITEM_DOME_NAME)
this.name=h.ITEM_DOME_NAME
if(h.get("ITEM_DOMEWOODTOP_DESC"))this.desc=h.ITEM_DOMEWOODTOP_DESC
if(h.get("ITEM_DOMEWOODTOP_INFO"))this.info=h.ITEM_DOMEWOODTOP_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,baked_key:"dome-wood-top",baked_swap:true,pick_as_id:i.ITEM_DOMEWOOD,pick_as_mode:3,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_DOOR_NAME)
e(l,"ITEM_DOOR",function ItemDoor(e){this.initBase(e)
this.initBaked()
this.initBakedInhand()
this.name=h.ITEM_DOOR_NAME
if(h.get("ITEM_DOOR_DESC"))this.desc=h.ITEM_DOOR_DESC
if(h.get("ITEM_DOOR_INFO"))this.info=h.ITEM_DOOR_INFO
this.cost=[d.fromMaterial(this,0,16)]},{attr3_as_num:true,intangible:false,size:m(2,1,4),flips_on_x:true,mat_baked_key:{LIGHT_WOOD:"door-light-frame",DARK_WOOD:"door-dark-frame",RED_WOOD:"door-red-frame",STONE:"door-stone-frame",FANCY_STONE:"door-fancystone-frame",def:{1:"door-wood2-frame",def:"door-wood-frame"}},boosted_key:{0:{FANCY_STONE:"door-stone-frame"}},mat_baked_keys_inhand:{LIGHT_WOOD:{1:["door-light-frame","door-light2"],def:["door-light-frame","door-light"]},DARK_WOOD:{1:["door-dark2","door-dark-frame"],def:["door-dark","door-dark-frame"]},RED_WOOD:{1:["door-red2","door-red-frame"],def:["door-red","door-red-frame"]},STONE:{1:["door-stone2","door-stone-frame"],def:["door-stone","door-stone-frame"]},FANCY_STONE:{1:["door-fancystone2","door-fancystone-frame"],def:["door-fancystone","door-fancystone-frame"]},def:{1:["door-wood2","door-wood2-frame"],def:["door-wood","door-wood-frame"]}}})
a(h.ITEM_DOOR_DOUBLE_NAME)
e(l,"ITEM_DOOR_DOUBLE",function ItemDoorDouble(e){this.initBase(e)
this.initBaked()
this.initBakedInhand()
this.name=h.ITEM_DOOR_DOUBLE_NAME
if(h.get("ITEM_DOOR_DOUBLE_DESC"))this.desc=h.ITEM_DOOR_DOUBLE_DESC
if(h.get("ITEM_DOOR_DOUBLE_INFO"))this.info=h.ITEM_DOOR_DOUBLE_INFO
this.cost=[d.fromMaterial(this,0,32)]},{intangible:false,size:m(4,1,4),mat_baked_key:{LIGHT_WOOD:"doubledoor-lightwood-frame",DARK_WOOD:"doubledoor-darkwood-frame",RED_WOOD:"doubledoor-redwood-frame",STONE:"doubledoor-stone-frame",FANCY_STONE:"doubledoor-fancystone-frame",def:"doubledoor-wood-frame"},boosted_key:{0:{FANCY_STONE:"doubledoor-stone-frame"}},mat_baked_keys_inhand:{LIGHT_WOOD:["doubledoor-lightwood-frame","doubledoor-lightwood-left","doubledoor-lightwood-right"],DARK_WOOD:["doubledoor-darkwood-frame","doubledoor-darkwood-left","doubledoor-darkwood-right"],RED_WOOD:["doubledoor-redwood-frame","doubledoor-redwood-left","doubledoor-redwood-right"],STONE:["doubledoor-stone-frame","doubledoor-stone-left","doubledoor-stone-right"],FANCY_STONE:["doubledoor-fancystone-frame","doubledoor-fancystone-left","doubledoor-fancystone-right"],def:["doubledoor-wood-frame","doubledoor-wood-left","doubledoor-wood-right"]}})
a(h.ITEM_DOOR_DOUBLE_GATE_NAME)
e(l,"ITEM_DOOR_DOUBLE_GATE",function ItemDoorDoubleGate(e){this.initBase(e)
this.initBakedInhand()
this.name=h.ITEM_DOOR_DOUBLE_GATE_NAME
if(h.get("ITEM_DOOR_DOUBLE_GATE_DESC"))this.desc=h.ITEM_DOOR_DOUBLE_GATE_DESC
if(h.get("ITEM_DOOR_DOUBLE_GATE_INFO"))this.info=h.ITEM_DOOR_DOUBLE_GATE_INFO
this.cost=[d.item({type:c,id:n.ROD_METAL,count:8})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"doubledoor-metal-gate-frame",baked_swap:true,mat_baked_keys_inhand:{def:["doubledoor-metal-gate"]},size:m(4,1,4),cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},intangible:false})
e(l,"ITEM_DOOR_DOUBLE_METAL",function ItemDoorDoubleMetal(e){this.initBase(e)
this.initBakedInhand()
a(h.ITEM_DOOR_DOUBLE_NAME)
this.name=h.ITEM_DOOR_DOUBLE_NAME
if(h.get("ITEM_DOOR_DOUBLE_METAL_DESC"))this.desc=h.ITEM_DOOR_DOUBLE_METAL_DESC
if(h.get("ITEM_DOOR_DOUBLE_METAL_INFO"))this.info=h.ITEM_DOOR_DOUBLE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:8}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:4})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"doubledoor-metal-frame",mat_baked_keys_inhand:{def:{1:["doubledoor-metal-gate"],def:["doubledoor-metal-left","doubledoor-metal-right","doubledoor-metal-frame"]}},baked_swap:true,size:m(4,1,4),cost_mat_map:{attr1:{cost_idx:0,def:"IRON"},attr2:{cost_idx:1,def:"IRON"}},intangible:false})
e(l,"ITEM_DOOR_METAL",function ItemDoorMetal(e){this.initBase(e)
this.initBaked()
this.initBakedInhand()
a(h.ITEM_DOOR_NAME)
this.name=h.ITEM_DOOR_NAME
if(h.get("ITEM_DOOR_METAL_DESC"))this.desc=h.ITEM_DOOR_METAL_DESC
if(h.get("ITEM_DOOR_METAL_INFO"))this.info=h.ITEM_DOOR_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:4}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:2})]
this.updateCostFromMatMap()},{def_material:s.IRON,attr3_as_num:true,any_as_material_class:true,mat_baked_key:{def:{1:"door-metal2-frame",def:"door-metal-frame"}},mat_baked_keys_inhand:{def:{1:["door-metal2-frame","door-metal2"],def:["door-metal-frame","door-metal"]}},baked_swap:true,size:m(2,1,4),cost_mat_map:{attr1:{cost_idx:0,def:"IRON"},attr2:{cost_idx:1,def:"IRON"}},intangible:false,flips_on_x:true})
a(h.ITEM_DOWSER_ADVANCED_NAME)
e(l,"ITEM_DOWSER_ADVANCED",function ItemDowserAdvanced(e){this.initBase(e)
this.initDowser()
this.name=h.ITEM_DOWSER_ADVANCED_NAME
if(h.get("ITEM_DOWSER_ADVANCED_DESC"))this.desc=h.ITEM_DOWSER_ADVANCED_DESC
if(h.get("ITEM_DOWSER_ADVANCED_INFO"))this.info=h.ITEM_DOWSER_ADVANCED_INFO},{baked_key:"dowser-advanced",size_auto:true,placeable:false,baked_swap:true,stackable:false,allowed_in_inventory:true,snapshot_size:m(2,2,3.2),tool_page:true,is_crafted:true,is_tool:true})
a(h.ITEM_DOWSER_SIMPLE_NAME)
e(l,"ITEM_DOWSER_SIMPLE",function ItemDowserSimple(e){this.initBase(e)
this.initDowser()
this.name=h.ITEM_DOWSER_SIMPLE_NAME
if(h.get("ITEM_DOWSER_SIMPLE_DESC"))this.desc=h.ITEM_DOWSER_SIMPLE_DESC
if(h.get("ITEM_DOWSER_SIMPLE_INFO"))this.info=h.ITEM_DOWSER_SIMPLE_INFO},{baked_key:"dowser",size_auto:true,placeable:false,baked_swap:true,stackable:false,allowed_in_inventory:true,snapshot_size:m(2,2,3.2),tool_page:true,is_crafted:true,is_tool:true})
a(h.ITEM_ENERGY_WELL_NAME)
e(l,"ITEM_ENERGY_WELL",function ItemEnergyWell(e){this.initBase(e)
this.name=h.ITEM_ENERGY_WELL_NAME
if(h.get("ITEM_ENERGY_WELL_DESC"))this.desc=h.ITEM_ENERGY_WELL_DESC
if(h.get("ITEM_ENERGY_WELL_INFO"))this.info=h.ITEM_ENERGY_WELL_INFO
this.cost=[d.item({type:c,id:n.STONE_RAW,count:100})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"energy-well-empty",intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},particle_systems:[{name:"energy_well_particles",rot:0,offset_position:m(0,0,.5)}]})
e(l,"ITEM_FACTORY_DEBUG",function ItemFactoryDebug(e){this.initBase(e)},{def_material:s.STONE,name:"Debug Factory",baked_key:"factory-placeholder",intangible:false,size_auto:true,particle_systems:[],cost:[]})
a(h.ITEM_FENCE_NAME)
e(l,"ITEM_FENCE",function ItemFence(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_FENCE_NAME
if(h.get("ITEM_FENCE_DESC"))this.desc=h.ITEM_FENCE_DESC
if(h.get("ITEM_FENCE_INFO"))this.info=h.ITEM_FENCE_INFO
this.cost=[d.fromByMat(this)]},{intangible:false,no_auto_rot:true,size:m(1,1,2),mat_baked_key:{STONE:{1:"fence-stonebrick",def:"fence-stone"},FANCY_STONE:"fence-fancystone",LIGHT_WOOD:"fence-lightwood",DARK_WOOD:"fence-darkwood",RED_WOOD:"fence-redwood",def:"fence-wood"},boosted_key:{0:{FANCY_STONE:"fence-stone"}},cost_by_mat:{STONE:{1:[{type:_,id:p.BRICK_STONE,count:2}],def:[{type:c,id:n.STONE_RAW,count:2}]},FANCY_STONE:[{type:c,id:n.BRICK,count:2}],LIGHT_WOOD:[{type:_,id:p.PLANKS_WOOD_LIGHT,count:2}],DARK_WOOD:[{type:_,id:p.PLANKS_WOOD_DARK,count:2}],RED_WOOD:[{type:_,id:p.PLANKS_WOOD_RED,count:2}],def:[{type:_,id:p.PLANKS_WOOD,count:2}]}})
e(l,"ITEM_FENCE_METAL",function ItemFenceMetal(e){this.initBase(e)
a(h.ITEM_FENCE_NAME)
this.name=h.ITEM_FENCE_NAME
if(h.get("ITEM_FENCE_METAL_DESC"))this.desc=h.ITEM_FENCE_METAL_DESC
if(h.get("ITEM_FENCE_METAL_INFO"))this.info=h.ITEM_FENCE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,intangible:false,no_auto_rot:true,size:m(1,1,2),baked_key:"fence-metal",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_FIBER_NAME)
e(l,"ITEM_FIBER",function ItemFiber(e){this.initBase(e)
this.name=h.ITEM_FIBER_NAME
if(h.get("ITEM_FIBER_DESC"))this.desc=h.ITEM_FIBER_DESC
if(h.get("ITEM_FIBER_INFO"))this.info=h.ITEM_FIBER_INFO},{def_material:s.LEAF,baked_key:"fiber",placeable:false,size:m(1.5,1.5,2),allowed_in_inventory:true})
a(h.ITEM_FLOUR_NAME)
e(l,"ITEM_FLOUR",function ItemFlour(e){this.initBase(e)
this.name=h.ITEM_FLOUR_NAME
if(h.get("ITEM_FLOUR_DESC"))this.desc=h.ITEM_FLOUR_DESC
if(h.get("ITEM_FLOUR_INFO"))this.info=h.ITEM_FLOUR_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.INGREDIENT]),intangible:false,baked_key:"flour-build",baked_key_resource:"flour-item",allowed_in_inventory:true,size:m(1,1,1),is_crafted:true,no_attribs:true})
a(h.ITEM_FLOWERPOT_NAME)
e(l,"ITEM_FLOWERPOT",function ItemFlowerpot(e){this.initBase(e)
this.name=h.ITEM_FLOWERPOT_NAME
if(h.get("ITEM_FLOWERPOT_DESC"))this.desc=h.ITEM_FLOWERPOT_DESC
if(h.get("ITEM_FLOWERPOT_INFO"))this.info=h.ITEM_FLOWERPOT_INFO},{def_material:s.DIRT,intangible:false,baked_key:"flowerpot",no_auto_rot:true,cost:[]})
a(h.ITEM_FURNACE_GLASS_NAME)
e(l,"ITEM_FURNACE_GLASS",function ItemFurnaceGlass(e){this.initBase(e)
this.name=h.ITEM_FURNACE_GLASS_NAME
if(h.get("ITEM_FURNACE_GLASS_DESC"))this.desc=h.ITEM_FURNACE_GLASS_DESC
if(h.get("ITEM_FURNACE_GLASS_INFO"))this.info=h.ITEM_FURNACE_GLASS_INFO
this.cost=[d.item({type:_,id:p.BRICK_STONE,count:20}),d.item({type:c,id:n.WOOD_PLANK,count:10}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.IRON,count:2})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"furnace-glass",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:1,def:"WOOD"}},floater_z:1.2,particle_systems:[{name:"factory_spark_particles",rot:0,offset_position:m(0,0,1.7)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(1,0,1.05)}]})
a(h.ITEM_FURNACE_ORE_NAME)
e(l,"ITEM_FURNACE_ORE",function ItemFurnaceOre(e){this.initBase(e)
this.name=h.ITEM_FURNACE_ORE_NAME
if(h.get("ITEM_FURNACE_ORE_DESC"))this.desc=h.ITEM_FURNACE_ORE_DESC
if(h.get("ITEM_FURNACE_ORE_INFO"))this.info=h.ITEM_FURNACE_ORE_INFO},{def_material:s.STONE,baked_key:"furnace-ore",intangible:false,size_auto:true,floater_z:.9,particle_systems:[{name:"factory_smoke_particles",rot:0,offset_position:m(0,.8,2.8)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(0,.2,.8)}],cost:[d.item({type:_,id:p.BRICK_STONE,count:20})]})
a(h.ITEM_GEM_NAME)
e(l,"ITEM_GEM",function ItemGem(e){this.initBase(e)
this.name=h.ITEM_GEM_NAME
if(h.get("ITEM_GEM_DESC"))this.desc=h.ITEM_GEM_DESC
if(h.get("ITEM_GEM_INFO"))this.info=h.ITEM_GEM_INFO},{def_material:s.FANCY_STONE,no_auto_rot:true,intangible:true,rooted:false,sysadmin_only:true,size:m(1,1,2),baked_key:"emit-1x2",cost:[]})
a(h.ITEM_GRASS_NAME)
e(l,"ITEM_GRASS",function ItemGrass(e){this.initBase(e)
this.name=h.ITEM_GRASS_NAME
if(h.get("ITEM_GRASS_DESC"))this.desc=h.ITEM_GRASS_DESC
if(h.get("ITEM_GRASS_INFO"))this.info=h.ITEM_GRASS_INFO},{def_material:s.LEAF,baked_key:"plant-seed",intangible:true,size_auto:true,perched:true,place_rot_random:true,cost:[d.item({type:_,id:p.DIRT,count:1})]})
a(h.ITEM_GRASS_SPIKY_NAME)
e(l,"ITEM_GRASS_SPIKY",function ItemGrassSpiky(e){this.initBase(e)
this.name=h.ITEM_GRASS_SPIKY_NAME
if(h.get("ITEM_GRASS_SPIKY_DESC"))this.desc=h.ITEM_GRASS_SPIKY_DESC
if(h.get("ITEM_GRASS_SPIKY_INFO"))this.info=h.ITEM_GRASS_SPIKY_INFO},{def_material:s.LEAF,baked_key:"grass-spiky",intangible:true,size_auto:true,perched:true,place_rot_random:true,unlockable_variants:[{attr1:0,methods:"lf_break"}],fallback_baked_key:"plant-seed",on_flow:"dig",cost:[d.item({type:l,id:i.ITEM_FIBER,count:15})]})
a(h.ITEM_GROW_NAME)
e(l,"ITEM_GROW",function ItemGrow(e){this.initBase(e)
this.calcHP()
this.name=h.ITEM_GROW_NAME
if(h.get("ITEM_GROW_DESC"))this.desc=h.ITEM_GROW_DESC
if(h.get("ITEM_GROW_INFO"))this.info=h.ITEM_GROW_INFO},{baked_key:"grow",size_auto:true,placeable:false,baked_swap:true,has_hp:true,hp_vis_scale:.01,stackable:false,allowed_in_inventory:true,potentially_unlimited:true,snapshot_size:m(2,2,3.2),tool_page:true,is_crafted:true,is_tool:true})
a(h.ITEM_HOE_NAME)
e(l,"ITEM_HOE",function ItemHoe(e){this.initBase(e)
this.calcHP()
this.name=h.ITEM_HOE_NAME
if(h.get("ITEM_HOE_DESC"))this.desc=h.ITEM_HOE_DESC
if(h.get("ITEM_HOE_INFO"))this.info=h.ITEM_HOE_INFO},{craft_classes:E([n.REPAIRABLE]),size_auto:true,placeable:false,no_spin:true,stackable:false,has_hp:true,brush_size:"2x1",allowed_in_inventory:true,potentially_unlimited:true,tool_page:true,is_crafted:true,is_tool:true})
a(h.ITEM_INDICATOR_NAME)
e(l,"ITEM_INDICATOR",function ItemIndicator(e){this.initBase(e)
this.name=h.ITEM_INDICATOR_NAME
if(h.get("ITEM_INDICATOR_DESC"))this.desc=h.ITEM_INDICATOR_DESC
if(h.get("ITEM_INDICATOR_INFO"))this.info=h.ITEM_INDICATOR_INFO},{def_material:s.FANCY_STONE,no_auto_rot:true,intangible:true,rooted:false,sysadmin_only:true,size:m(2,2,2),cost:[]})
a(h.ITEM_INGOT_NAME)
e(l,"ITEM_INGOT",function ItemIngot(e){this.initBase(e)
this.name=h.ITEM_INGOT_NAME
if(h.get("ITEM_INGOT_DESC"))this.desc=h.ITEM_INGOT_DESC
if(h.get("ITEM_INGOT_INFO"))this.info=h.ITEM_INGOT_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:3})]
this.updateCostFromMatMap()},{def_material:s.IRON,craft_classes:E([n.SCALED_INGOT]),any_as_material_class:true,baked_key:"ingot-iron",baked_swap:true,intangible:false,size_auto:true,is_crafted:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},allowed_in_inventory:true,has_inv_variants:true})
a(h.ITEM_JUICE_NAME)
e(l,"ITEM_JUICE",function ItemJuice(e){this.initBase(e)
this.initSpiced()
this.name=h.ITEM_JUICE_NAME
if(h.get("ITEM_JUICE_DESC"))this.desc=h.ITEM_JUICE_DESC
if(h.get("ITEM_JUICE_INFO"))this.info=h.ITEM_JUICE_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:3,TIMED_STAMINA_MED:10}),placeable:false,allowed_in_inventory:true,consumable:true,is_crafted:true,has_inv_variants:true,size_auto:true,examples:[{attr1:s.RED_BERRY},{attr1:s.YELLOW_BERRY},{attr1:s.BLUE_BERRY}]})
a(h.ITEM_JUICER_NAME)
e(l,"ITEM_JUICER",function ItemJuicer(e){this.initBase(e)
this.name=h.ITEM_JUICER_NAME
if(h.get("ITEM_JUICER_DESC"))this.desc=h.ITEM_JUICER_DESC
if(h.get("ITEM_JUICER_INFO"))this.info=h.ITEM_JUICER_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:60}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.IRON,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"juicer",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},particle_systems:[{name:"factory_color_particles",rot:0,offset_position:m(0,0,1.3)}]})
a(h.ITEM_KILN_NAME)
e(l,"ITEM_KILN",function ItemKiln(e){this.initBase(e)
this.name=h.ITEM_KILN_NAME
if(h.get("ITEM_KILN_DESC"))this.desc=h.ITEM_KILN_DESC
if(h.get("ITEM_KILN_INFO"))this.info=h.ITEM_KILN_INFO
this.cost=[d.item({type:c,id:n.STONE_RAW,count:10}),d.item({type:_,id:p.DIRT,count:10})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"kiln",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},floater_z:1.1,particle_systems:[{name:"factory_smoke_particles",rot:0,offset_position:m(0,0,2.8)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(0,0,0)}]})
a(h.ITEM_LADDER_NAME)
e(l,"ITEM_LADDER",function ItemLadder(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_LADDER_NAME
if(h.get("ITEM_LADDER_DESC"))this.desc=h.ITEM_LADDER_DESC
if(h.get("ITEM_LADDER_INFO"))this.info=h.ITEM_LADDER_INFO
this.cost=[d.fromMaterial(this,0,4)]},{is_ladder:true,mat_baked_key:{STONE:"ladder-stone",FANCY_STONE:"ladder-fancystone",LIGHT_WOOD:"ladder-lightwood",DARK_WOOD:"ladder-darkwood",RED_WOOD:"ladder-redwood",def:"ladder-wood"},boosted_key:{0:{FANCY_STONE:"ladder-stone"}},snapshot_size:m(2,1,2),size:m(2,1,1),see_through:true})
e(l,"ITEM_LADDER_METAL",function ItemLadderMetal(e){this.initBase(e)
a(h.ITEM_LADDER_NAME)
this.name=h.ITEM_LADDER_NAME
if(h.get("ITEM_LADDER_METAL_DESC"))this.desc=h.ITEM_LADDER_METAL_DESC
if(h.get("ITEM_LADDER_METAL_INFO"))this.info=h.ITEM_LADDER_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,is_ladder:true,baked_key:"ladder-metal",baked_swap:true,snapshot_size:m(2,1,2),size:m(2,1,1),cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},see_through:true})
a(h.ITEM_LANTERN_NAME)
e(l,"ITEM_LANTERN",function ItemLantern(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_LANTERN_NAME
if(h.get("ITEM_LANTERN_DESC"))this.desc=h.ITEM_LANTERN_DESC
if(h.get("ITEM_LANTERN_INFO"))this.info=h.ITEM_LANTERN_INFO
this.cost=[d.fromMaterial(this,0,4)]},{is_lighting:true,no_auto_rot:true,on_flow:"dig",mat_baked_key:{STONE:"lantern-stone",FANCY_STONE:"lantern-fancystone",LIGHT_WOOD:"lantern-lightwood",DARK_WOOD:"lantern-darkwood",RED_WOOD:"lantern-redwood",def:"lantern-wood"},boosted_key:{0:{FANCY_STONE:"lantern-stone"}}})
e(l,"ITEM_LANTERN_METAL",function ItemLanternMetal(e){this.initBase(e)
a(h.ITEM_LANTERN_NAME)
this.name=h.ITEM_LANTERN_NAME
if(h.get("ITEM_LANTERN_METAL_DESC"))this.desc=h.ITEM_LANTERN_METAL_DESC
if(h.get("ITEM_LANTERN_METAL_INFO"))this.info=h.ITEM_LANTERN_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,is_lighting:true,intangible:false,no_auto_rot:true,on_flow:"dig",baked_key:"lantern-metal",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_LEAPGATE_NAME)
e(l,"ITEM_LEAPGATE",function ItemLeapgate(e){this.initBase(e)
this.name=h.ITEM_LEAPGATE_NAME
if(h.get("ITEM_LEAPGATE_DESC"))this.desc=h.ITEM_LEAPGATE_DESC
if(h.get("ITEM_LEAPGATE_INFO"))this.info=h.ITEM_LEAPGATE_INFO},{def_material:s.SILVER,baked_key:"leapgate",stage_baked_key:["$KEY$-unset","$KEY$-inactive","$KEY$-inactive","$KEY$-active"],stage_preview:3,intangible:false,rooted:false,size:m(3,2,6),tangible_height:1,particles_always_on_in_unlimited:true,place_rot:2,particle_systems_progress:[{name:"leapgate-portal-progression",rot:1,offset_position:m(0,-.5,3.2)}],particle_systems_active:[{name:"leapgate-portal-small",rot:1,offset_position:m(0,-.5,3.2)},{name:"leapgate-portal-spark-small",rot:1,offset_position:m(0,.5,3.2)}],particle_systems_activating:[{name:"leapgate-portal",rot:1,offset_position:m(0,-.5,3.2)},{name:"leapgate-portal-spark",rot:1,offset_position:m(0,1,3.2)}],cost:[d.item({type:_,id:p.STONE_LIGHT,count:10}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.SILVER,count:1})]})
a(h.ITEM_LEAPGATE_SHARD_NAME)
e(l,"ITEM_LEAPGATE_SHARD",function ItemLeapgateShard(e){this.initBase(e)
this.name=h.ITEM_LEAPGATE_SHARD_NAME
if(h.get("ITEM_LEAPGATE_SHARD_DESC"))this.desc=h.ITEM_LEAPGATE_SHARD_DESC
if(h.get("ITEM_LEAPGATE_SHARD_INFO"))this.info=h.ITEM_LEAPGATE_SHARD_INFO},{def_material:s.STONE,allowed_in_inventory:true,allowed_in_quickbar:false,placeable:false,size:m(1,1,2),stackable:false,heavy:true,baked_key:"leapgate-shard",cost:[]})
a(h.ITEM_LEFTOVERS_NAME)
e(l,"ITEM_LEFTOVERS",function ItemLeftovers(e){this.initBase(e)
this.name=h.ITEM_LEFTOVERS_NAME
if(h.get("ITEM_LEFTOVERS_DESC"))this.desc=h.ITEM_LEFTOVERS_DESC
if(h.get("ITEM_LEFTOVERS_INFO"))this.info=h.ITEM_LEFTOVERS_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:1}),placeable:false,size:m(1.3,1.3,1),allowed_in_inventory:true,consumable:true,baked_key:"leftovers",is_crafted:true,no_attribs:true})
a(h.ITEM_LIGHT_CUBE_NAME)
e(l,"ITEM_LIGHT_CUBE",function ItemLightCube(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_LIGHT_CUBE_NAME
if(h.get("ITEM_LIGHT_CUBE_DESC"))this.desc=h.ITEM_LIGHT_CUBE_DESC
if(h.get("ITEM_LIGHT_CUBE_INFO"))this.info=h.ITEM_LIGHT_CUBE_INFO
this.cost=[d.fromMaterial(this,0,4),d.item({type:l,id:i.ITEM_COAL,count:1})]},{intangible:false,on_flow:"block",mat_baked_key:{STONE:"cubelight-stone",FANCY_STONE:"cubelight-fancystone",LIGHT_WOOD:"cubelight-lightwood",DARK_WOOD:"cubelight-darkwood",RED_WOOD:"cubelight-redwood",def:"cubelight-wood"},boosted_key:{0:{FANCY_STONE:"cubelight-stone"}}})
e(l,"ITEM_LIGHT_CUBE_METAL",function ItemLightCubeMetal(e){this.initBase(e)
a(h.ITEM_LIGHT_CUBE_NAME)
this.name=h.ITEM_LIGHT_CUBE_NAME
if(h.get("ITEM_LIGHT_CUBE_METAL_DESC"))this.desc=h.ITEM_LIGHT_CUBE_METAL_DESC
if(h.get("ITEM_LIGHT_CUBE_METAL_INFO"))this.info=h.ITEM_LIGHT_CUBE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:2}),d.item({type:l,id:i.ITEM_COAL,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,is_lighting:true,intangible:false,on_flow:"block",baked_key:"cubelight-metal",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_LIQUID_NAME)
e(l,"ITEM_LIQUID",function ItemLiquid(e){this.initBase(e)
this.name=h.ITEM_LIQUID_NAME
if(h.get("ITEM_LIQUID_DESC"))this.desc=h.ITEM_LIQUID_DESC
if(h.get("ITEM_LIQUID_INFO"))this.info=h.ITEM_LIQUID_INFO},{placeable:false,no_spin:true,potentially_unlimited:true,is_tool:true})
a(h.ITEM_MILL_NAME)
e(l,"ITEM_MILL",function ItemMill(e){this.initBase(e)
this.name=h.ITEM_MILL_NAME
if(h.get("ITEM_MILL_DESC"))this.desc=h.ITEM_MILL_DESC
if(h.get("ITEM_MILL_INFO"))this.info=h.ITEM_MILL_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:20}),d.item({type:c,id:n.STONE_RAW,count:10})]
this.updateCostFromMatMap()},{def_material:s.DARK_WOOD,baked_key:"mill",baked_swap:true,intangible:false,size_auto:true,place_rot:1,cost_mat_map:{attr1:{cost_idx:0,def:"DARK_WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.1,particle_systems:[{name:"factory_spark_particles",rot:0,offset_position:m(0,0,1)}]})
a(h.ITEM_MUSHROOM_NAME)
e(l,"ITEM_MUSHROOM",function ItemMushroom(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_MUSHROOM_NAME
if(h.get("ITEM_MUSHROOM_DESC"))this.desc=h.ITEM_MUSHROOM_DESC
if(h.get("ITEM_MUSHROOM_INFO"))this.info=h.ITEM_MUSHROOM_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,consume_attribs:v({STAMINA:1}),craft_classes:E([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_swap:true,baked_key:"mushroom",placeable:false,consumable:true,allowed_in_inventory:true,size_auto:true,has_inv_variants:true,definitive_examples:[{attr1:s.BROWN_MUSHROOM},{attr1:s.RED_MUSHROOM},{attr1:s.LUMINESCENT_MUSHROOM},{attr1:s.CORAL_MUSHROOM}]})
a(h.ITEM_ORE_NAME)
e(l,"ITEM_ORE",function ItemOre(e){this.initBase(e)
this.initPreviewBlock()
this.name=h.ITEM_ORE_NAME
if(h.get("ITEM_ORE_DESC"))this.desc=h.ITEM_ORE_DESC
if(h.get("ITEM_ORE_INFO"))this.info=h.ITEM_ORE_INFO
this.cost=[d.item({type:l,id:i.ITEM_ORE,attr1:s.ANY,count:5})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"ore-iron",baked_swap:true,intangible:false,size_auto:true,ignore_take:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},allowed_in_inventory:true,preview_block_map:{COPPER:"COPPER",IRON:"IRON",TIN:"TIN",SILVER:"SILVER",EMBERYLLIUM:"EMBERYLLIUM",GOLD:"GOLD",COBALT:"COBALT",MYTHRIL:"MYTHRIL",AETHERSTONE:"AETHERSTONE",def:"IRON"},has_inv_variants:true})
a(h.ITEM_OVEN_NAME)
e(l,"ITEM_OVEN",function ItemOven(e){this.initBase(e)
this.name=h.ITEM_OVEN_NAME
if(h.get("ITEM_OVEN_DESC"))this.desc=h.ITEM_OVEN_DESC
if(h.get("ITEM_OVEN_INFO"))this.info=h.ITEM_OVEN_INFO},{def_material:s.STONE,baked_key:"oven",intangible:false,size_auto:true,floater_z:1.2,particle_systems:[{name:"factory_smoke_particles",rot:0,offset_position:m(0,.4,3.5)},{name:"factory_furnacefire_particles",rot:0,offset_position:m(0,.2,1.2)}],cost:[d.item({type:_,id:p.BRICK_STONE,count:10}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.BRONZE,count:1})]})
a(h.ITEM_PAINT_NAME)
e(l,"ITEM_PAINT",function ItemPaint(e){this.initBase(e)
this.name=h.ITEM_PAINT_NAME
if(h.get("ITEM_PAINT_DESC"))this.desc=h.ITEM_PAINT_DESC
if(h.get("ITEM_PAINT_INFO"))this.info=h.ITEM_PAINT_INFO
this.cost=[d.identity(this,1)]},{placeable:false,size_auto:true,allowed_in_inventory:true,baked_swap:true,baked_key:"paint",is_crafted:true,has_inv_variants:true,definitive_examples:[{attr1:s.RED},{attr1:s.ORANGE},{attr1:s.YELLOW},{attr1:s.GREEN},{attr1:s.BLUE},{attr1:s.PURPLE}]})
a(h.ITEM_PAINT_MIXER_NAME)
e(l,"ITEM_PAINT_MIXER",function ItemPaintMixer(e){this.initBase(e)
this.name=h.ITEM_PAINT_MIXER_NAME
if(h.get("ITEM_PAINT_MIXER_DESC"))this.desc=h.ITEM_PAINT_MIXER_DESC
if(h.get("ITEM_PAINT_MIXER_INFO"))this.info=h.ITEM_PAINT_MIXER_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:50}),d.item({type:l,id:i.ITEM_INGOT,attr1:s.IRON,count:3})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"paint-mixer",baked_swap:true,intangible:false,size_auto:true,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},particle_systems:[{name:"factory_color_particles",rot:0,offset_position:m(.642,0,1.5)}]})
e(l,"ITEM_PARTICLE_DEBUGGER",function ItemParticleDebugger(e){this.initBase(e)},{def_material:s.STONE,name:"Debugger Particle",baked_key:"factory-placeholder",intangible:false,size_auto:true,particle_systems:[{name:"watering_system_particles",rot:0,offset_position:m(0,0,.6)},{name:"energy_well_particles",rot:.5,offset_position:m(0,0,.6)},{name:"factory_campfire_particles",rot:1,offset_position:m(0,0,.6)},{name:"factory_color_particles",rot:1.5,offset_position:m(0,0,.6)},{name:"factory_sawmill_particles",rot:1,offset_position:m(0,0,.6)},{name:"factory_spark_particles",rot:1,offset_position:m(0,0,.6)},{name:"factory_smoke_particles",rot:1,offset_position:m(0,0,.6)}],cost:[d.item({type:_,id:p.STONE,count:1})]})
a(h.ITEM_PIE_NAME)
e(l,"ITEM_PIE",function ItemPie(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_PIE_NAME
if(h.get("ITEM_PIE_DESC"))this.desc=h.ITEM_PIE_DESC
if(h.get("ITEM_PIE_INFO"))this.info=h.ITEM_PIE_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({TIMED_STAMINA_SMALL:300}),craft_classes:E([n.INGREDIENT,n.BAKED_FOOD]),placeable:false,size_auto:true,allowed_in_inventory:true,consumable:true,is_crafted:true,has_inv_variants:true,examples:[{attr1:s.PUMPKIN},{attr1:s.RED_BERRY}]})
a(h.ITEM_PLANT_NAME)
e(l,"ITEM_PLANT",function ItemPlant(e){this.initBase(e)
this.name=h.ITEM_PLANT_NAME
if(h.get("ITEM_PLANT_DESC"))this.desc=h.ITEM_PLANT_DESC
if(h.get("ITEM_PLANT_INFO"))this.info=h.ITEM_PLANT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,name_no_attr3:true,allowed_in_inventory:true,has_inv_variants:true,always_interact:true,snapshot_size:m(1,1,1),dig_rate:10,perched:true,override_stage_baked_key:true,stage_spawn:1,growth_heights:[1,1],is_waterable:true,ground_filter:"dirt",on_flow:"dig",place_rot_random:true})
e(l,"ITEM_PLATE_METAL",function ItemPlateMetal(e){this.initBase(e)
a(h.ITEM_PLATE_WOOD_NAME)
this.name=h.ITEM_PLATE_WOOD_NAME
if(h.get("ITEM_PLATE_METAL_DESC"))this.desc=h.ITEM_PLATE_METAL_DESC
if(h.get("ITEM_PLATE_METAL_INFO"))this.info=h.ITEM_PLATE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"plate-metal",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_PLATE_STONE",function ItemPlateStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_PLATE_WOOD_NAME)
this.name=h.ITEM_PLATE_WOOD_NAME
if(h.get("ITEM_PLATE_STONE_DESC"))this.desc=h.ITEM_PLATE_STONE_DESC
if(h.get("ITEM_PLATE_STONE_INFO"))this.info=h.ITEM_PLATE_STONE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,mat_baked_key:{FANCY_STONE:"plate-fancystone",def:"plate-stone"},boosted_key:{0:{FANCY_STONE:"plate-stone"}},size_auto:true})
a(h.ITEM_PLATE_WOOD_NAME)
e(l,"ITEM_PLATE_WOOD",function ItemPlateWood(e){this.initBase(e)
this.name=h.ITEM_PLATE_WOOD_NAME
if(h.get("ITEM_PLATE_WOOD_DESC"))this.desc=h.ITEM_PLATE_WOOD_DESC
if(h.get("ITEM_PLATE_WOOD_INFO"))this.info=h.ITEM_PLATE_WOOD_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,any_as_material_class:true,baked_key:"plate-wood",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_PUMPKIN_NAME)
e(l,"ITEM_PUMPKIN",function ItemPumpkin(e){this.initBase(e)
this.name=h.ITEM_PUMPKIN_NAME
if(h.get("ITEM_PUMPKIN_DESC"))this.desc=h.ITEM_PUMPKIN_DESC
if(h.get("ITEM_PUMPKIN_INFO"))this.info=h.ITEM_PUMPKIN_INFO
this.cost=[d.identity(this,1)]},{craft_classes:E([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_key:"pumpkin",size_auto:true,placeable:false,allowed_in_inventory:true})
a(h.ITEM_ROAST_SEAFOOD_NAME)
e(l,"ITEM_ROAST_SEAFOOD",function ItemRoastSeafood(e){this.initBase(e)
this.initBaked()
this.initUniqueSpiced()
this.name=h.ITEM_ROAST_SEAFOOD_NAME
if(h.get("ITEM_ROAST_SEAFOOD_DESC"))this.desc=h.ITEM_ROAST_SEAFOOD_DESC
if(h.get("ITEM_ROAST_SEAFOOD_INFO"))this.info=h.ITEM_ROAST_SEAFOOD_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:3}),craft_classes:E([n.INGREDIENT,n.SANDWICH_FILLING]),mat_baked_key:{STARFISH:"roast_seafood-starfish",ANEMONE:"roast_seafood-anemone",def:"roast_seafood-starfish"},placeable:false,allowed_in_inventory:true,size:m(2,2,2),consumable:true,is_crafted:true,has_inv_variants:true,examples:[{attr1:s.STARFISH},{attr1:s.ANEMONE}]})
a(h.ITEM_ROAST_VEGETABLES_NAME)
e(l,"ITEM_ROAST_VEGETABLES",function ItemRoastVegetables(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_ROAST_VEGETABLES_NAME
if(h.get("ITEM_ROAST_VEGETABLES_DESC"))this.desc=h.ITEM_ROAST_VEGETABLES_DESC
if(h.get("ITEM_ROAST_VEGETABLES_INFO"))this.info=h.ITEM_ROAST_VEGETABLES_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:3}),craft_classes:E([n.INGREDIENT,n.SANDWICH_FILLING]),baked_key:"roast-vegetables",baked_swap:true,size_auto:true,placeable:false,allowed_in_inventory:true,consumable:true,is_crafted:true,has_inv_variants:true,examples:[{attr1:s.CORN},{attr1:s.TOMATO}]})
a(h.ITEM_ROD_NAME)
e(l,"ITEM_ROD",function ItemRod(e){this.initBase(e)
this.initFuelRate()
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_ROD_DESC"))this.desc=h.ITEM_ROD_DESC
if(h.get("ITEM_ROD_INFO"))this.info=h.ITEM_ROD_INFO
this.cost=[d.identity(this,1)]
this.updateCraftClassesFromMat()},{is_crafted:true,intangible:false,no_auto_rot:true,baked_key_resource:"rod_resource",baked_key:"rod",baked_swap:true,fuel_rate_map:{WOOD:20,LIGHT_WOOD:20,DARK_WOOD:20,RED_WOOD:20},craft_class_map:{WOOD:["ROD_WOOD"],LIGHT_WOOD:["ROD_WOOD"],DARK_WOOD:["ROD_WOOD"],RED_WOOD:["ROD_WOOD"],def:["ROD_METAL"]},mode_list:["Auto","Vert","Horiz"],mode_list_ids:[null,i.ITEM_RODV,i.ITEM_RODH],pick_as_mode:0,recipe_list:["wood_rod","metal_rod"]})
e(l,"ITEM_ROD_METAL_ALIAS",function ItemRodMetalAlias(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_ROD_METAL_ALIAS_DESC"))this.desc=h.ITEM_ROD_METAL_ALIAS_DESC
if(h.get("ITEM_ROD_METAL_ALIAS_INFO"))this.info=h.ITEM_ROD_METAL_ALIAS_INFO
this.cost=[d.item({type:c,id:n.ROD_METAL,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,place_as_id:i.ITEM_ROD,any_as_material_class:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}},no_auto_rot:true,baked_key:"rod",baked_swap:true,mode_list:["Auto","Vert","Horiz"],mode_list_ids:[null,i.ITEM_RODV_METAL_ALIAS,i.ITEM_RODH_METAL_ALIAS]})
e(l,"ITEM_ROD_STONE",function ItemRodStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_ROD_STONE_DESC"))this.desc=h.ITEM_ROD_STONE_DESC
if(h.get("ITEM_ROD_STONE_INFO"))this.info=h.ITEM_ROD_STONE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,is_crafted:false,intangible:false,no_auto_rot:true,mat_baked_key:{FANCY_STONE:"rod-fancystone",def:"rod-stone"},boosted_key:{0:{FANCY_STONE:"rod-stone"}},size_auto:true,mode_list:["Auto","Vert","Horiz"],mode_list_ids:[null,i.ITEM_RODV_STONE,i.ITEM_RODH_STONE],pick_as_mode:0})
e(l,"ITEM_ROD_WOOD_ALIAS",function ItemRodWoodAlias(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_ROD_WOOD_ALIAS_DESC"))this.desc=h.ITEM_ROD_WOOD_ALIAS_DESC
if(h.get("ITEM_ROD_WOOD_ALIAS_INFO"))this.info=h.ITEM_ROD_WOOD_ALIAS_INFO
this.cost=[d.item({type:c,id:n.ROD_WOOD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,place_as_id:i.ITEM_ROD,any_as_material_class:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},no_auto_rot:true,baked_key:"rod",baked_swap:true,mode_list:["Auto","Vert","Horiz"],mode_list_ids:[null,i.ITEM_RODV_WOOD_ALIAS,i.ITEM_RODH_WOOD_ALIAS]})
e(l,"ITEM_RODH",function ItemRodh(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODH_DESC"))this.desc=h.ITEM_RODH_DESC
if(h.get("ITEM_RODH_INFO"))this.info=h.ITEM_RODH_INFO
this.cost=[d.item({type:l,id:i.ITEM_ROD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"rodh",baked_swap:true,pick_as_id:i.ITEM_ROD,pick_as_mode:2,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_RODH_METAL_ALIAS",function ItemRodhMetalAlias(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODH_METAL_ALIAS_DESC"))this.desc=h.ITEM_RODH_METAL_ALIAS_DESC
if(h.get("ITEM_RODH_METAL_ALIAS_INFO"))this.info=h.ITEM_RODH_METAL_ALIAS_INFO
this.cost=[d.item({type:c,id:n.ROD_METAL,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,place_as_id:i.ITEM_RODH,is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"rodh",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_RODH_STONE",function ItemRodhStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODH_STONE_DESC"))this.desc=h.ITEM_RODH_STONE_DESC
if(h.get("ITEM_RODH_STONE_INFO"))this.info=h.ITEM_RODH_STONE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,is_crafted:false,intangible:false,no_auto_rot:false,mat_baked_key:{FANCY_STONE:"rodh-fancystone",def:"rodh-stone"},boosted_key:{0:{FANCY_STONE:"rodh-stone"}},pick_as_id:i.ITEM_ROD_STONE,pick_as_mode:2})
e(l,"ITEM_RODH_WOOD_ALIAS",function ItemRodhWoodAlias(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODH_WOOD_ALIAS_DESC"))this.desc=h.ITEM_RODH_WOOD_ALIAS_DESC
if(h.get("ITEM_RODH_WOOD_ALIAS_INFO"))this.info=h.ITEM_RODH_WOOD_ALIAS_INFO
this.cost=[d.item({type:c,id:n.ROD_WOOD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,place_as_id:i.ITEM_RODH,is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"rodh",baked_swap:true,pick_as_id:i.ITEM_ROD,pick_as_mode:2,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_RODV",function ItemRodv(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODV_DESC"))this.desc=h.ITEM_RODV_DESC
if(h.get("ITEM_RODV_INFO"))this.info=h.ITEM_RODV_INFO
this.cost=[d.item({type:l,id:i.ITEM_ROD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"rodv",baked_swap:true,pick_as_id:i.ITEM_ROD,pick_as_mode:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_RODV_METAL_ALIAS",function ItemRodvMetalAlias(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODV_METAL_ALIAS_DESC"))this.desc=h.ITEM_RODV_METAL_ALIAS_DESC
if(h.get("ITEM_RODV_METAL_ALIAS_INFO"))this.info=h.ITEM_RODV_METAL_ALIAS_INFO
this.cost=[d.item({type:c,id:n.ROD_METAL,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,place_as_id:i.ITEM_RODV,is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"rodv",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_RODV_STONE",function ItemRodvStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODV_STONE_DESC"))this.desc=h.ITEM_RODV_STONE_DESC
if(h.get("ITEM_RODV_STONE_INFO"))this.info=h.ITEM_RODV_STONE_INFO
this.cost=[d.fromMaterial(this,0,1)]},{def_material:s.STONE,is_crafted:false,intangible:false,no_auto_rot:false,mat_baked_key:{FANCY_STONE:"rodv-fancystone",def:"rodv-stone"},boosted_key:{0:{FANCY_STONE:"rodv-stone"}},pick_as_id:i.ITEM_ROD_STONE,pick_as_mode:1})
e(l,"ITEM_RODV_WOOD_ALIAS",function ItemRodvWoodAlias(e){this.initBase(e)
a(h.ITEM_ROD_NAME)
this.name=h.ITEM_ROD_NAME
if(h.get("ITEM_RODV_WOOD_ALIAS_DESC"))this.desc=h.ITEM_RODV_WOOD_ALIAS_DESC
if(h.get("ITEM_RODV_WOOD_ALIAS_INFO"))this.info=h.ITEM_RODV_WOOD_ALIAS_INFO
this.cost=[d.item({type:c,id:n.ROD_WOOD,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,place_as_id:i.ITEM_RODV,is_crafted:false,intangible:false,no_auto_rot:false,baked_key:"rodv",baked_swap:true,pick_as_id:i.ITEM_ROD,pick_as_mode:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_RUG_NAME)
e(l,"ITEM_RUG",function ItemRug(e){this.initBase(e)
this.name=h.ITEM_RUG_NAME
if(h.get("ITEM_RUG_DESC"))this.desc=h.ITEM_RUG_DESC
if(h.get("ITEM_RUG_INFO"))this.info=h.ITEM_RUG_INFO},{def_material:s.WOOD,baked_key:"rug",size_auto:true,cost:[]})
a(h.ITEM_SANDWICH_NAME)
e(l,"ITEM_SANDWICH",function ItemSandwich(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_SANDWICH_NAME
if(h.get("ITEM_SANDWICH_DESC"))this.desc=h.ITEM_SANDWICH_DESC
if(h.get("ITEM_SANDWICH_INFO"))this.info=h.ITEM_SANDWICH_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({STAMINA:6}),craft_classes:E([n.INGREDIENT,n.BAKED_FOOD]),placeable:false,size:m(2,2,2),allowed_in_inventory:true,consumable:true,is_crafted:true,has_inv_variants:true,examples:[{attr1:s.TOMATO},{attr1:s.ANEMONE}]})
a(h.ITEM_SAPLING_NAME)
e(l,"ITEM_SAPLING",function ItemSapling(e){this.initBase(e)
this.name=h.ITEM_SAPLING_NAME
if(h.get("ITEM_SAPLING_DESC"))this.desc=h.ITEM_SAPLING_DESC
if(h.get("ITEM_SAPLING_INFO"))this.info=h.ITEM_SAPLING_INFO
this.cost=[d.item({type:l,id:i.ITEM_ARBORHEART,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"sapling-oak",name_no_attr3:true,size:m(1,1,1),on_flow:"block",cost_mat_map:{attr1:{cost_idx:0}}})
a(h.ITEM_SAWMILL_NAME)
e(l,"ITEM_SAWMILL",function ItemSawmill(e){this.initBase(e)
this.name=h.ITEM_SAWMILL_NAME
if(h.get("ITEM_SAWMILL_DESC"))this.desc=h.ITEM_SAWMILL_DESC
if(h.get("ITEM_SAWMILL_INFO"))this.info=h.ITEM_SAWMILL_INFO
this.cost=[d.item({type:c,id:n.WOOD_RAW,count:20}),d.item({type:l,id:i.ITEM_TOOL_HEAD,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"sawmill",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.5,particle_systems:[{name:"factory_sawmill_particles",rot:1,offset_position:m(.5,0,1.3)}]})
a(h.ITEM_SEA_CANDY_NAME)
e(l,"ITEM_SEA_CANDY",function ItemSeaCandy(e){this.initBase(e)
this.initUniqueSpiced()
this.name=h.ITEM_SEA_CANDY_NAME
if(h.get("ITEM_SEA_CANDY_DESC"))this.desc=h.ITEM_SEA_CANDY_DESC
if(h.get("ITEM_SEA_CANDY_INFO"))this.info=h.ITEM_SEA_CANDY_INFO
this.cost=[d.identity(this,1)]},{consume_attribs:v({TIMED_O2_CAPACITY_LARGE:120}),craft_classes:E([n.INGREDIENT]),baked_key:"sea_candy",placeable:false,allowed_in_inventory:true,size:m(2,2,2),consumable:true,is_crafted:true,no_attr1:true,no_attr2:true})
a(h.ITEM_SEASHELL_NAME)
e(l,"ITEM_SEASHELL",function ItemSeashell(e){this.initBase(e)
this.initBaked()
this.initIntangible()
this.name=h.ITEM_SEASHELL_NAME
if(h.get("ITEM_SEASHELL_DESC"))this.desc=h.ITEM_SEASHELL_DESC
if(h.get("ITEM_SEASHELL_INFO"))this.info=h.ITEM_SEASHELL_INFO},{def_material:s.DIRT,size:m(1,1,1),name_no_attr3:true,mat_baked_key:{def:{1:"seashell-thistle",2:"seashell-conch-thistle",3:"seashell-imperial",4:"seashell-navy",5:"seashell-daffodil",6:"seashell-conch-mocha",7:"seashell-conch-plum",8:"seashell-conch-indigo",9:"seashell-open",def:"seashell-thistle"}},intangible:true,intangible_mat_map:{def:{2:false,6:false,7:false,8:false,9:false,def:true}},dig_rate:10,unlockable_variants:[{attr1:"NONE",attr3:3,methods:"lf_break"},{attr1:"NONE",attr3:4,methods:"lf_break"},{attr1:"NONE",attr3:5,methods:"lf_break"},{attr1:"NONE",attr3:6,methods:"lf_break"},{attr1:"NONE",attr3:7,methods:"lf_break"},{attr1:"NONE",attr3:8,methods:"lf_break"},{attr1:"NONE",attr3:9,methods:"lf_break"}],fallback_baked_key:"seashell-thistle",cost:[d.item({type:l,id:i.ITEM_SEASHELL_PILE,count:1})]})
a(h.ITEM_SEASHELL_PILE_NAME)
e(l,"ITEM_SEASHELL_PILE",function ItemSeashellPile(e){this.initBase(e)
this.name=h.ITEM_SEASHELL_PILE_NAME
if(h.get("ITEM_SEASHELL_PILE_DESC"))this.desc=h.ITEM_SEASHELL_PILE_DESC
if(h.get("ITEM_SEASHELL_PILE_INFO"))this.info=h.ITEM_SEASHELL_PILE_INFO},{craft_classes:E([n.GRINDABLE]),placeable:false,baked_key:"seashell_pile",size:m(2,2,2),allowed_in_inventory:true,no_attribs:true})
a(h.ITEM_SEEDS_CARROT_NAME)
a(h.ITEM_SEEDS_CARROT_BUILD_NAME)
e(l,"ITEM_SEEDS_CARROT",function ItemSeedsCarrot(e){this.initBase(e)
this.name=h.ITEM_SEEDS_CARROT_NAME
this.build_name=h.ITEM_SEEDS_CARROT_BUILD_NAME
if(h.get("ITEM_SEEDS_CARROT_DESC"))this.desc=h.ITEM_SEEDS_CARROT_DESC
if(h.get("ITEM_SEEDS_CARROT_INFO"))this.info=h.ITEM_SEEDS_CARROT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.FARMING_SEED]),place_rot_random:true,ground_filter:"tilled",rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),build_name:i.ITEM_SEEDS_CARROT_BUILD_NAME,baked_key_resource:"seedbag-carrot",baked_key:"crop-carrot",stage_baked_key:["$KEY$-1","$KEY$-2","$KEY$-3","$KEY$-4"],stage_spawn:3,growth_heights:[1,1,1,1],is_waterable:true,harvest_results:[{type:l,id:i.ITEM_CARROT,min:1,max:3},{type:l,id:i.ITEM_SEEDS_CARROT,min:1,max:3}],harvest_full_sound:"crop_harvest",growstick_chat_extra_chance:.01,growstick_chat_extra:["MSG_GROW_CARROT1","MSG_GROW_CARROT2"],on_flow:"dig"})
a(h.ITEM_SEEDS_CORAL_MUSHROOM_NAME)
e(l,"ITEM_SEEDS_CORAL_MUSHROOM",function ItemSeedsCoralMushroom(e){this.initBase(e)
this.name=h.ITEM_SEEDS_CORAL_MUSHROOM_NAME
if(h.get("ITEM_SEEDS_CORAL_MUSHROOM_DESC"))this.desc=h.ITEM_SEEDS_CORAL_MUSHROOM_DESC
if(h.get("ITEM_SEEDS_CORAL_MUSHROOM_INFO"))this.info=h.ITEM_SEEDS_CORAL_MUSHROOM_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,allowed_in_inventory:true,always_interact:true,dig_rate:10,perched:true,underwater_only:true,baked_key:"coral_mushroom",stage_baked_key:["mushroom-seed","$KEY$-1"],stage_spawn:1,growth_heights:[1,1],harvest_results:[{type:l,id:i.ITEM_SEEDS_CORAL_MUSHROOM,count:1},{type:l,id:i.ITEM_MUSHROOM,count:1,attr1:s.CORAL_MUSHROOM}],ground_filter:"sea_floor",no_attribs:true,on_unflow:"dig"})
a(h.ITEM_SEEDS_CORN_NAME)
a(h.ITEM_SEEDS_CORN_BUILD_NAME)
e(l,"ITEM_SEEDS_CORN",function ItemSeedsCorn(e){this.initBase(e)
this.name=h.ITEM_SEEDS_CORN_NAME
this.build_name=h.ITEM_SEEDS_CORN_BUILD_NAME
if(h.get("ITEM_SEEDS_CORN_DESC"))this.desc=h.ITEM_SEEDS_CORN_DESC
if(h.get("ITEM_SEEDS_CORN_INFO"))this.info=h.ITEM_SEEDS_CORN_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.FARMING_SEED]),place_rot_random:true,ground_filter:"tilled",rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),see_through:true,build_name:i.ITEM_SEEDS_CORN_BUILD_NAME,baked_key_resource:"seedbag-corn",baked_key:"crop-corn",stage_baked_key:["$KEY$-1","$KEY$-2","$KEY$-3","$KEY$-4","$KEY$-5","$KEY$-6","$KEY$-7","$KEY$-8"],stage_spawn:7,growth_heights:[1,2,3,4,5,6,6,6],is_waterable:true,harvest_pickable_stage:5,harvest_results:[{type:l,id:i.ITEM_CORN,count:1,pickable_early:true},{type:l,id:i.ITEM_SEEDS_CORN,count:1}],harvest_full_sound:"crop_harvest",growstick_chat_extra_chance:.01,growstick_chat_extra:["MSG_GROW_CORN"],on_flow:"dig"})
a(h.ITEM_SEEDS_PUMPKIN_NAME)
a(h.ITEM_SEEDS_PUMPKIN_BUILD_NAME)
e(l,"ITEM_SEEDS_PUMPKIN",function ItemSeedsPumpkin(e){this.initBase(e)
this.name=h.ITEM_SEEDS_PUMPKIN_NAME
this.build_name=h.ITEM_SEEDS_PUMPKIN_BUILD_NAME
if(h.get("ITEM_SEEDS_PUMPKIN_DESC"))this.desc=h.ITEM_SEEDS_PUMPKIN_DESC
if(h.get("ITEM_SEEDS_PUMPKIN_INFO"))this.info=h.ITEM_SEEDS_PUMPKIN_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.FARMING_SEED]),place_rot_random:true,ground_filter:"tilled",rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),build_name:i.ITEM_SEEDS_PUMPKIN_BUILD_NAME,baked_key_resource:"seedbag-pumpkin",baked_key:"crop-pumpkin",stage_baked_key:["$KEY$-1","$KEY$-2","$KEY$-3","$KEY$-4","$KEY$-5"],stage_spawn:4,growth_heights:[1,1,1,1,2],is_waterable:true,harvest_results:[{type:l,id:i.ITEM_PUMPKIN,min:1,max:3},{type:l,id:i.ITEM_SEEDS_PUMPKIN,count:1}],harvest_full_sound:"crop_harvest",growstick_chat_extra_chance:.05,growstick_chat_extra:["MSG_GROW_PUMPKIN"],on_flow:"dig"})
a(h.ITEM_SEEDS_SUGAR_CANE_NAME)
a(h.ITEM_SEEDS_SUGAR_CANE_BUILD_NAME)
e(l,"ITEM_SEEDS_SUGAR_CANE",function ItemSeedsSugarCane(e){this.initBase(e)
this.name=h.ITEM_SEEDS_SUGAR_CANE_NAME
this.build_name=h.ITEM_SEEDS_SUGAR_CANE_BUILD_NAME
if(h.get("ITEM_SEEDS_SUGAR_CANE_DESC"))this.desc=h.ITEM_SEEDS_SUGAR_CANE_DESC
if(h.get("ITEM_SEEDS_SUGAR_CANE_INFO"))this.info=h.ITEM_SEEDS_SUGAR_CANE_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.FARMING_SEED]),place_rot_random:true,ground_filter:"tilled",rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),see_through:true,build_name:i.ITEM_SEEDS_SUGAR_CANE_BUILD_NAME,baked_key_resource:"seedbag-sugarcane",baked_key:"crop-sugar-cane",stage_baked_key:["$KEY$-1","$KEY$-2","$KEY$-3","$KEY$-4","$KEY$-5"],stage_spawn:4,growth_heights:[1,1,2,3,4],is_waterable:true,harvest_results:[{type:l,id:i.ITEM_SUGAR_CANE,min:1,max:4},{type:l,id:i.ITEM_SEEDS_SUGAR_CANE,count:1}],harvest_full_sound:"crop_harvest",growstick_chat_extra_chance:.05,growstick_chat_extra:["MSG_GROW_SUGARCANE1","MSG_GROW_SUGARCANE2"],on_flow:"dig"})
a(h.ITEM_SEEDS_TOMATO_NAME)
a(h.ITEM_SEEDS_TOMATO_BUILD_NAME)
e(l,"ITEM_SEEDS_TOMATO",function ItemSeedsTomato(e){this.initBase(e)
this.name=h.ITEM_SEEDS_TOMATO_NAME
this.build_name=h.ITEM_SEEDS_TOMATO_BUILD_NAME
if(h.get("ITEM_SEEDS_TOMATO_DESC"))this.desc=h.ITEM_SEEDS_TOMATO_DESC
if(h.get("ITEM_SEEDS_TOMATO_INFO"))this.info=h.ITEM_SEEDS_TOMATO_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.FARMING_SEED]),place_rot_random:true,ground_filter:"tilled",rooted:true,allowed_in_inventory:true,always_interact:true,size:m(1,1,2),build_name:i.ITEM_SEEDS_TOMATO_BUILD_NAME,baked_key_resource:"seedbag-tomato",baked_key:"crop-tomato",stage_baked_key:["$KEY$-1","$KEY$-2","$KEY$-3","$KEY$-4","$KEY$-5"],stage_spawn:3,stage_preview:3,growth_heights:[2,2,2,2,2],growth_max_stage:3,is_waterable:true,harvest_reverting_stage:2,harvest_limit:3,harvest_results:[{type:l,id:i.ITEM_TOMATO,min:1,max:1.6},{type:l,id:i.ITEM_SEEDS_TOMATO,drop_chance:.33}],harvest_full_sound:"crop_harvest",on_flow:"dig"})
a(h.ITEM_SEEDS_WHEAT_NAME)
a(h.ITEM_SEEDS_WHEAT_BUILD_NAME)
e(l,"ITEM_SEEDS_WHEAT",function ItemSeedsWheat(e){this.initBase(e)
this.name=h.ITEM_SEEDS_WHEAT_NAME
this.build_name=h.ITEM_SEEDS_WHEAT_BUILD_NAME
if(h.get("ITEM_SEEDS_WHEAT_DESC"))this.desc=h.ITEM_SEEDS_WHEAT_DESC
if(h.get("ITEM_SEEDS_WHEAT_INFO"))this.info=h.ITEM_SEEDS_WHEAT_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.FARMING_SEED]),place_rot_random:true,ground_filter:"tilled",rooted:true,allowed_in_inventory:true,always_interact:true,size:m(2,2,1),build_name:i.ITEM_SEEDS_WHEAT_BUILD_NAME,baked_key_resource:"seedbag-wheat",baked_key:"crop-wheat",stage_baked_key:["$KEY$-1","$KEY$-2","$KEY$-3","$KEY$-4","$KEY$-5"],stage_spawn:4,growth_heights:[1,1,1,2,2],is_waterable:true,harvest_results:[{type:l,id:i.ITEM_WHEAT,min:1,max:4},{type:l,id:i.ITEM_SEEDS_WHEAT,count:1}],harvest_full_sound:"crop_harvest",on_flow:"dig"})
a(h.ITEM_SHELF_NAME)
e(l,"ITEM_SHELF",function ItemShelf(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_SHELF_NAME
if(h.get("ITEM_SHELF_DESC"))this.desc=h.ITEM_SHELF_DESC
if(h.get("ITEM_SHELF_INFO"))this.info=h.ITEM_SHELF_INFO
this.cost=[d.fromMaterial(this,0,12)]},{intangible:false,size_auto:true,mat_baked_key:{STONE:"shelf-stone",FANCY_STONE:"shelf-fancystone",LIGHT_WOOD:"shelf-lightwood",DARK_WOOD:"shelf-darkwood",RED_WOOD:"shelf-redwood",def:"shelf-wood"},boosted_key:{0:{FANCY_STONE:"shelf-stone"}}})
e(l,"ITEM_SHELF_METAL",function ItemShelfMetal(e){this.initBase(e)
a(h.ITEM_SHELF_NAME)
this.name=h.ITEM_SHELF_NAME
if(h.get("ITEM_SHELF_METAL_DESC"))this.desc=h.ITEM_SHELF_METAL_DESC
if(h.get("ITEM_SHELF_METAL_INFO"))this.info=h.ITEM_SHELF_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:4})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,intangible:false,size_auto:true,baked_key:"shelf-metal",baked_swap:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_SIGNBOARD_NAME)
e(l,"ITEM_SIGNBOARD",function ItemSignboard(e){this.initBase(e)
this.name=h.ITEM_SIGNBOARD_NAME
if(h.get("ITEM_SIGNBOARD_DESC"))this.desc=h.ITEM_SIGNBOARD_DESC
if(h.get("ITEM_SIGNBOARD_INFO"))this.info=h.ITEM_SIGNBOARD_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:4})]
this.updateCostFromMatMap()},{def_material:s.WOOD,any_as_material_class:true,baked_key:"signboard",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_SIGNBOARD_METAL",function ItemSignboardMetal(e){this.initBase(e)
a(h.ITEM_SIGNBOARD_NAME)
this.name=h.ITEM_SIGNBOARD_NAME
if(h.get("ITEM_SIGNBOARD_METAL_DESC"))this.desc=h.ITEM_SIGNBOARD_METAL_DESC
if(h.get("ITEM_SIGNBOARD_METAL_INFO"))this.info=h.ITEM_SIGNBOARD_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"signboard-metal",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_SIGNBOARD_STONE",function ItemSignboardStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_SIGNBOARD_NAME)
this.name=h.ITEM_SIGNBOARD_NAME
if(h.get("ITEM_SIGNBOARD_STONE_DESC"))this.desc=h.ITEM_SIGNBOARD_STONE_DESC
if(h.get("ITEM_SIGNBOARD_STONE_INFO"))this.info=h.ITEM_SIGNBOARD_STONE_INFO
this.cost=[d.fromMaterial(this,0,4)]},{def_material:s.STONE,mat_baked_key:{FANCY_STONE:"signboard-fancystone",def:"signboard-stone"},boosted_key:{0:{FANCY_STONE:"signboard-stone"}},size_auto:true})
a(h.ITEM_SIGNPOST_NAME)
e(l,"ITEM_SIGNPOST",function ItemSignpost(e){this.initBase(e)
this.name=h.ITEM_SIGNPOST_NAME
if(h.get("ITEM_SIGNPOST_DESC"))this.desc=h.ITEM_SIGNPOST_DESC
if(h.get("ITEM_SIGNPOST_INFO"))this.info=h.ITEM_SIGNPOST_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:6})]
this.updateCostFromMatMap()},{def_material:s.WOOD,any_as_material_class:true,baked_key:"signpost",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
e(l,"ITEM_SIGNPOST_METAL",function ItemSignpostMetal(e){this.initBase(e)
a(h.ITEM_SIGNPOST_NAME)
this.name=h.ITEM_SIGNPOST_NAME
if(h.get("ITEM_SIGNPOST_METAL_DESC"))this.desc=h.ITEM_SIGNPOST_METAL_DESC
if(h.get("ITEM_SIGNPOST_METAL_INFO"))this.info=h.ITEM_SIGNPOST_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:1})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"signpost-metal",baked_swap:true,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_SIGNPOST_STONE",function ItemSignpostStone(e){this.initBase(e)
this.initBaked()
a(h.ITEM_SIGNPOST_NAME)
this.name=h.ITEM_SIGNPOST_NAME
if(h.get("ITEM_SIGNPOST_STONE_DESC"))this.desc=h.ITEM_SIGNPOST_STONE_DESC
if(h.get("ITEM_SIGNPOST_STONE_INFO"))this.info=h.ITEM_SIGNPOST_STONE_INFO
this.cost=[d.fromMaterial(this,0,6)]},{def_material:s.STONE,mat_baked_key:{FANCY_STONE:"signpost-fancystone",def:"signpost-stone"},boosted_key:{0:{FANCY_STONE:"signpost-stone"}},size_auto:true})
a(h.ITEM_SPICE_NAME)
e(l,"ITEM_SPICE",function ItemSpice(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_SPICE_NAME
if(h.get("ITEM_SPICE_DESC"))this.desc=h.ITEM_SPICE_DESC
if(h.get("ITEM_SPICE_INFO"))this.info=h.ITEM_SPICE_INFO
this.cost=[d.identity(this,1)]},{craft_classes:E([n.INGREDIENT]),mat_baked_key:{def:{HOT:"hot",PUNGENT:"pungent",SAVORY:"savory",def:"hot"}},allowed_in_inventory:true,placeable:false,has_inv_variants:true,definitive_examples:[{attr3:s.HOT},{attr3:s.PUNGENT},{attr3:s.SAVORY}]})
a(h.ITEM_SPICE_PLANT_NAME)
e(l,"ITEM_SPICE_PLANT",function ItemSpicePlant(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_SPICE_PLANT_NAME
if(h.get("ITEM_SPICE_PLANT_DESC"))this.desc=h.ITEM_SPICE_PLANT_DESC
if(h.get("ITEM_SPICE_PLANT_INFO"))this.info=h.ITEM_SPICE_PLANT_INFO
this.cost=[d.item({type:l,id:i.ITEM_SPICE,count:1})]
this.updateCostFromMatMap()},{def_material:s.LEAF,mat_baked_key:{def:{HOT:"hot-plant",PUNGENT:"pungent-plant",SAVORY:"savory-plant",def:"hot-plant"}},cost_mat_map:{attr3:{target_attr3:true,cost_idx:0}},rooted:true,size_auto:true,always_interact:true,dig_rate:10,harvest_results:[{type:l,id:i.ITEM_SPICE,count:1,keep_attr3:true}],unlockable_variants:[{attr3:"HOT",methods:"lf_break"},{attr3:"PUNGENT",methods:"lf_break"},{attr3:"SAVORY",methods:"lf_break"}],fallback_baked_key:"plant-seed",on_flow:"dig"})
a(h.ITEM_STARFISH_NAME)
e(l,"ITEM_STARFISH",function ItemStarfish(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_STARFISH_NAME
if(h.get("ITEM_STARFISH_DESC"))this.desc=h.ITEM_STARFISH_DESC
if(h.get("ITEM_STARFISH_INFO"))this.info=h.ITEM_STARFISH_INFO},{def_material:s.DIRT,size:m(1,1,1),name_no_attr3:true,mat_baked_key:{def:{1:"starfish-canary",2:"starfish-sangria",3:"starfish-tiger",def:"starfish-canary"}},intangible:true,dig_rate:10,unlockable_variants:[{attr1:"NONE",attr3:2,methods:"lf_break"},{attr1:"NONE",attr3:3,methods:"lf_break"}],fallback_baked_key:"starfish-canary",cost:[d.item({type:l,id:i.ITEM_STARFISH_PILE,count:1})]})
a(h.ITEM_STARFISH_PILE_NAME)
e(l,"ITEM_STARFISH_PILE",function ItemStarfishPile(e){this.initBase(e)
this.name=h.ITEM_STARFISH_PILE_NAME
if(h.get("ITEM_STARFISH_PILE_DESC"))this.desc=h.ITEM_STARFISH_PILE_DESC
if(h.get("ITEM_STARFISH_PILE_INFO"))this.info=h.ITEM_STARFISH_PILE_INFO},{craft_classes:E([n.INGREDIENT,n.SEAFOOD]),placeable:false,baked_key:"starfish_pile",size:m(2,2,2),allowed_in_inventory:true,no_attribs:true})
a(h.ITEM_STEPS_NAME)
e(l,"ITEM_STEPS",function ItemSteps(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_STEPS_NAME
if(h.get("ITEM_STEPS_DESC"))this.desc=h.ITEM_STEPS_DESC
if(h.get("ITEM_STEPS_INFO"))this.info=h.ITEM_STEPS_INFO
this.cost=[d.fromMaterial(this,4,0)]},{mat_baked_key:{IRON:"steps-metal",STONE:"steps-stone",FANCY_STONE:"steps-fancystone",LIGHT_WOOD:"steps-lightwood",DARK_WOOD:"steps-darkwood",RED_WOOD:"steps-redwood",def:"steps-wood"},boosted_key:{0:{FANCY_STONE:"steps-stone"}},size_auto:true,intangible:false})
a(h.ITEM_STONECUTTER_ADVANCED_NAME)
e(l,"ITEM_STONECUTTER_ADVANCED",function ItemStonecutterAdvanced(e){this.initBase(e)
this.name=h.ITEM_STONECUTTER_ADVANCED_NAME
if(h.get("ITEM_STONECUTTER_ADVANCED_DESC"))this.desc=h.ITEM_STONECUTTER_ADVANCED_DESC
if(h.get("ITEM_STONECUTTER_ADVANCED_INFO"))this.info=h.ITEM_STONECUTTER_ADVANCED_INFO
this.cost=[d.item({type:c,id:n.WOOD_RAW,count:20}),d.item({type:l,id:i.ITEM_TOOL_HEAD,attr1:s.ANY,count:4}),d.item({type:_,id:p.BRICK_STONE,count:4})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"stonecutter-advanced",baked_swap:true,intangible:false,size_auto:true,place_rot:1,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},particle_systems:[]})
a(h.ITEM_STONECUTTER_SIMPLE_NAME)
e(l,"ITEM_STONECUTTER_SIMPLE",function ItemStonecutterSimple(e){this.initBase(e)
this.name=h.ITEM_STONECUTTER_SIMPLE_NAME
if(h.get("ITEM_STONECUTTER_SIMPLE_DESC"))this.desc=h.ITEM_STONECUTTER_SIMPLE_DESC
if(h.get("ITEM_STONECUTTER_SIMPLE_INFO"))this.info=h.ITEM_STONECUTTER_SIMPLE_INFO
this.cost=[d.item({type:c,id:n.STONE_RAW,count:10}),d.item({type:l,id:i.ITEM_CORD,count:2})]
this.updateCostFromMatMap()},{def_material:s.STONE,baked_key:"stonecutter-simple",intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"STONE",pick_as:0}},floater_z:1.5,particle_systems:[{name:"factory_stonecutter_particles",rot:1,offset_position:m(0,.4,.5)}]})
a(h.ITEM_SUGAR_NAME)
e(l,"ITEM_SUGAR",function ItemSugar(e){this.initBase(e)
this.name=h.ITEM_SUGAR_NAME
if(h.get("ITEM_SUGAR_DESC"))this.desc=h.ITEM_SUGAR_DESC
if(h.get("ITEM_SUGAR_INFO"))this.info=h.ITEM_SUGAR_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,craft_classes:E([n.INGREDIENT]),baked_key:"sugar",allowed_in_inventory:true,size:m(2,2,2),is_crafted:true,no_attribs:true,placeable:false})
a(h.ITEM_SUGAR_CANE_NAME)
e(l,"ITEM_SUGAR_CANE",function ItemSugarCane(e){this.initBase(e)
this.name=h.ITEM_SUGAR_CANE_NAME
if(h.get("ITEM_SUGAR_CANE_DESC"))this.desc=h.ITEM_SUGAR_CANE_DESC
if(h.get("ITEM_SUGAR_CANE_INFO"))this.info=h.ITEM_SUGAR_CANE_INFO},{craft_classes:E([n.GRINDABLE]),placeable:false,baked_key:"sugar-cane-harvested",allowed_in_inventory:true,size:m(2,2,2)})
a(h.ITEM_TABLE_LARGE_NAME)
e(l,"ITEM_TABLE_LARGE",function ItemTableLarge(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_TABLE_LARGE_NAME
if(h.get("ITEM_TABLE_LARGE_DESC"))this.desc=h.ITEM_TABLE_LARGE_DESC
if(h.get("ITEM_TABLE_LARGE_INFO"))this.info=h.ITEM_TABLE_LARGE_INFO
this.cost=[d.fromMaterial(this,0,24)]},{mat_baked_key:{STONE:"table-large-stone",FANCY_STONE:"table-large-fancystone",LIGHT_WOOD:"table-large-lightwood",DARK_WOOD:"table-large-darkwood",RED_WOOD:"table-large-redwood",def:"table-large-wood"},boosted_key:{0:{FANCY_STONE:"table-large-stone"}},intangible:false,size_auto:true})
e(l,"ITEM_TABLE_LARGE_METAL",function ItemTableLargeMetal(e){this.initBase(e)
a(h.ITEM_TABLE_LARGE_NAME)
this.name=h.ITEM_TABLE_LARGE_NAME
if(h.get("ITEM_TABLE_LARGE_METAL_DESC"))this.desc=h.ITEM_TABLE_LARGE_METAL_DESC
if(h.get("ITEM_TABLE_LARGE_METAL_INFO"))this.info=h.ITEM_TABLE_LARGE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:10})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"table-large-metal",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_TABLE_SMALL_NAME)
e(l,"ITEM_TABLE_SMALL",function ItemTableSmall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_TABLE_SMALL_NAME
if(h.get("ITEM_TABLE_SMALL_DESC"))this.desc=h.ITEM_TABLE_SMALL_DESC
if(h.get("ITEM_TABLE_SMALL_INFO"))this.info=h.ITEM_TABLE_SMALL_INFO
this.cost=[d.fromMaterial(this,0,16)]},{mat_baked_key:{IRON:"table-small-metal",STONE:"table-small-stone",FANCY_STONE:"table-small-fancystone",LIGHT_WOOD:"table-small-lightwood",DARK_WOOD:"table-small-darkwood",RED_WOOD:"table-small-redwood",def:"table-small-wood"},boosted_key:{0:{FANCY_STONE:"table-small-stone"}},intangible:false,size_auto:true})
e(l,"ITEM_TABLE_SMALL_METAL",function ItemTableSmallMetal(e){this.initBase(e)
a(h.ITEM_TABLE_SMALL_NAME)
this.name=h.ITEM_TABLE_SMALL_NAME
if(h.get("ITEM_TABLE_SMALL_METAL_DESC"))this.desc=h.ITEM_TABLE_SMALL_METAL_DESC
if(h.get("ITEM_TABLE_SMALL_METAL_INFO"))this.info=h.ITEM_TABLE_SMALL_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:4})]
this.updateCostFromMatMap()},{def_material:s.IRON,any_as_material_class:true,baked_key:"table-small-metal",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
e(l,"ITEM_TEST00",function ItemTest00(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test00",intangible:false,placeable:true,rooted:false,baked_key:"test00",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST01",function ItemTest01(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test01",baked_key:"test01",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST02",function ItemTest02(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test02",baked_key:"test02",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST03",function ItemTest03(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test03",baked_key:"test03",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST04",function ItemTest04(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test04",baked_key:"test04",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST05",function ItemTest05(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test05",baked_key:"test05",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST06",function ItemTest06(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test06",baked_key:"test06",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST07",function ItemTest07(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test07",baked_key:"test07",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST08",function ItemTest08(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test08",baked_key:"test08",size_auto:true,debug_only:true,cost:[]})
e(l,"ITEM_TEST09",function ItemTest09(e){this.initBase(e)},{def_material:s.WOOD,name:"Item Test09",baked_key:"test09",size_auto:true,debug_only:true,cost:[]})
a(h.ITEM_TOMATO_NAME)
e(l,"ITEM_TOMATO",function ItemTomato(e){this.initBase(e)
this.name=h.ITEM_TOMATO_NAME
if(h.get("ITEM_TOMATO_DESC"))this.desc=h.ITEM_TOMATO_DESC
if(h.get("ITEM_TOMATO_INFO"))this.info=h.ITEM_TOMATO_INFO
this.cost=[d.identity(this,1)]},{def_material:s.LEAF,consume_attribs:v({STAMINA:2}),craft_classes:E([n.INGREDIENT,n.VEGETABLE,n.PIE_FILLING]),baked_key:"tomato",placeable:false,consumable:true,allowed_in_inventory:true,size_auto:true})
a(h.ITEM_TOOL_HEAD_NAME)
e(l,"ITEM_TOOL_HEAD",function ItemToolHead(e){this.initBase(e)
this.name=h.ITEM_TOOL_HEAD_NAME
if(h.get("ITEM_TOOL_HEAD_DESC"))this.desc=h.ITEM_TOOL_HEAD_DESC
if(h.get("ITEM_TOOL_HEAD_INFO"))this.info=h.ITEM_TOOL_HEAD_INFO},{baked_key:"tool-head",placeable:false,potentially_unlimited:true,is_crafted:true,size_auto:true,baked_swap:true,recipe_list:["stone_tool_head","metal_tool_head_cast"],has_inv_variants:true})
a(h.ITEM_TOOL_HEAD_CAST_NAME)
e(l,"ITEM_TOOL_HEAD_CAST",function ItemToolHeadCast(e){this.initBase(e)
this.name=h.ITEM_TOOL_HEAD_CAST_NAME
if(h.get("ITEM_TOOL_HEAD_CAST_DESC"))this.desc=h.ITEM_TOOL_HEAD_CAST_DESC
if(h.get("ITEM_TOOL_HEAD_CAST_INFO"))this.info=h.ITEM_TOOL_HEAD_CAST_INFO},{def_material:s.STONE,baked_key:"tool-head-cast",intangible:false,tangible_height:1,size_auto:true,floater_z:.5,flips_on_x:true,particle_system_type:"factory_spark_particles",particle_systems:[{name:"factory_tool_head_cast_molten_particles",rot:0,offset_position:m(-.25,0,.4)},{name:"factory_tool_head_cast_smoke_particles",rot:0,offset_position:m(-.2,0,.7)}],cost:[d.item({type:_,id:p.BRICK_STONE,count:5})]})
a(h.ITEM_TORCH_NAME)
e(l,"ITEM_TORCH",function ItemTorch(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_TORCH_NAME
if(h.get("ITEM_TORCH_DESC"))this.desc=h.ITEM_TORCH_DESC
if(h.get("ITEM_TORCH_INFO"))this.info=h.ITEM_TORCH_INFO
this.cost=[d.fromMaterial(this,1,0)]},{is_lighting:true,no_auto_rot:true,on_flow:"dig",mat_baked_key:{LIGHT_WOOD:"torch-lightwood",DARK_WOOD:"torch-darkwood",RED_WOOD:"torch-redwood",def:"torch-wood"}})
e(l,"ITEM_UNKNOWNID",function ItemUnknownid(e){this.initBase(e)
this.name=h.ITEM_UNKNOWNID_NAME
if(h.get("ITEM_UNKNOWNID_DESC"))this.desc=h.ITEM_UNKNOWNID_DESC
if(h.get("ITEM_UNKNOWNID_INFO"))this.info=h.ITEM_UNKNOWNID_INFO},{mineable:false,baked_key:"unknown",allowed_in_inventory:false,stackable:false,cost:[d.item({type:l,id:i.ITEM_UNKNOWNID,count:1})]})
e(l,"ITEM_VASE_METAL",function ItemVaseMetal(e){this.initBase(e)
this.initBaked()
a(h.ITEM_VASE_WOOD_NAME)
this.name=h.ITEM_VASE_WOOD_NAME
if(h.get("ITEM_VASE_METAL_DESC"))this.desc=h.ITEM_VASE_METAL_DESC
if(h.get("ITEM_VASE_METAL_INFO"))this.info=h.ITEM_VASE_METAL_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:2})]
this.updateCostFromMatMap()},{def_material:s.IRON,attr3_as_num:true,any_as_material_class:true,mat_baked_key:{def:{1:"vase-metal2",def:"vase-metal"}},baked_swap:true,size_auto:true,intangible:false,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"}}})
a(h.ITEM_VASE_WOOD_NAME)
e(l,"ITEM_VASE_WOOD",function ItemVaseWood(e){this.initBase(e)
this.name=h.ITEM_VASE_WOOD_NAME
if(h.get("ITEM_VASE_WOOD_DESC"))this.desc=h.ITEM_VASE_WOOD_DESC
if(h.get("ITEM_VASE_WOOD_INFO"))this.info=h.ITEM_VASE_WOOD_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:2})]
this.updateCostFromMatMap()},{def_material:s.WOOD,any_as_material_class:true,baked_key:"vase-wood",baked_swap:true,size_auto:true,intangible:false,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}}})
a(h.ITEM_VEINIUM_GRINDER_NAME)
e(l,"ITEM_VEINIUM_GRINDER",function ItemVeiniumGrinder(e){this.initBase(e)
this.name=h.ITEM_VEINIUM_GRINDER_NAME
if(h.get("ITEM_VEINIUM_GRINDER_DESC"))this.desc=h.ITEM_VEINIUM_GRINDER_DESC
if(h.get("ITEM_VEINIUM_GRINDER_INFO"))this.info=h.ITEM_VEINIUM_GRINDER_INFO
this.cost=[d.item({type:l,id:i.ITEM_INGOT,attr1:s.ANY,count:2}),d.item({type:c,id:n.WOOD_PLANK,count:5})]
this.updateCostFromMatMap()},{def_material:s.IRON,baked_key:"veinium-grinder",baked_swap:true,intangible:false,size_auto:true,place_rot:1,flips_on_x:true,cost_mat_map:{attr1:{cost_idx:0,def:"IRON"},attr2:{cost_idx:1,def:"WOOD"}},floater_z:1.1,particle_systems:[{name:"factory_veinium_grinder_particles",rot:0,offset_position:m(1,0,1.3)},{name:"factory_veinium_grinder_dirt_particles",rot:0,offset_position:m(.5,0,1.5)}]})
a(h.ITEM_WATERING_SYSTEM_NAME)
e(l,"ITEM_WATERING_SYSTEM",function ItemWateringSystem(e){this.initBase(e)
this.name=h.ITEM_WATERING_SYSTEM_NAME
if(h.get("ITEM_WATERING_SYSTEM_DESC"))this.desc=h.ITEM_WATERING_SYSTEM_DESC
if(h.get("ITEM_WATERING_SYSTEM_INFO"))this.info=h.ITEM_WATERING_SYSTEM_INFO
this.cost=[d.item({type:c,id:n.WOOD_PLANK,count:20}),d.item({type:l,id:i.ITEM_BOTTLE,count:1})]
this.updateCostFromMatMap()},{def_material:s.WOOD,allowed_in_inventory:true,size:m(1,1,2),cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"}},baked_key:"watering-system",stage_baked_key:["$KEY$-0","$KEY$-1","$KEY$-2","$KEY$-3"],is_waterable:true,particle_systems:[{name:"watering_system_particles",rot:0,offset_position:m(0,0,.6)},{name:"watering_system_particles",rot:.5,offset_position:m(0,0,.6)},{name:"watering_system_particles",rot:1,offset_position:m(0,0,.6)},{name:"watering_system_particles",rot:1.5,offset_position:m(0,0,.6)}]})
a(h.ITEM_WAYGATE_NAME)
e(l,"ITEM_WAYGATE",function ItemWaygate(e){this.initBase(e)
this.name=h.ITEM_WAYGATE_NAME
if(h.get("ITEM_WAYGATE_DESC"))this.desc=h.ITEM_WAYGATE_DESC
if(h.get("ITEM_WAYGATE_INFO"))this.info=h.ITEM_WAYGATE_INFO},{def_material:s.FANCY_STONE,dynamic_cost:f.waygate,intangible:false,rooted:false,size:m(2,2,1),baked_key:"waygate",place_rot:2,particle_systems_activating:[{name:"waygate-portal",rot:1,offset_position:m(0,0,1.2)},{name:"waygate-portal-spark",rot:1,offset_position:m(0,0,1.2)}],cost:[d.item({type:_,id:p.STONE_LIGHT,count:20})]})
a(h.ITEM_WHEAT_NAME)
e(l,"ITEM_WHEAT",function ItemWheat(e){this.initBase(e)
this.name=h.ITEM_WHEAT_NAME
if(h.get("ITEM_WHEAT_DESC"))this.desc=h.ITEM_WHEAT_DESC
if(h.get("ITEM_WHEAT_INFO"))this.info=h.ITEM_WHEAT_INFO},{craft_classes:E([n.CEREAL_GRAIN,n.GRINDABLE]),placeable:false,baked_key:"wheat-harvested",size:m(2,2,2),allowed_in_inventory:true})
a(h.ITEM_WILD_CROP_NAME)
e(l,"ITEM_WILD_CROP",function ItemWildCrop(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WILD_CROP_NAME
if(h.get("ITEM_WILD_CROP_DESC"))this.desc=h.ITEM_WILD_CROP_DESC
if(h.get("ITEM_WILD_CROP_INFO"))this.info=h.ITEM_WILD_CROP_INFO
this.cost=[d.fromByMat(this)]},{def_material:s.LEAF,name_no_attr3:true,mat_baked_key:{def:{0:"wild-crop-tomato",1:"wild-crop-corn",2:"wild-crop-pumpkin",3:"wild-crop-wheat",4:"wild-crop-carrot",5:"wild-crop-sugarcane",def:"wild-crop-corn"}},cost_by_mat:{def:{0:[{type:l,id:i.ITEM_SEEDS_TOMATO,count:1}],1:[{type:l,id:i.ITEM_SEEDS_CORN,count:1}],2:[{type:l,id:i.ITEM_SEEDS_PUMPKIN,count:1}],3:[{type:l,id:i.ITEM_SEEDS_WHEAT,count:1}],4:[{type:l,id:i.ITEM_SEEDS_CARROT,count:1}],5:[{type:l,id:i.ITEM_SEEDS_SUGAR_CANE,count:1}],def:[]}},rooted:true,snapshot_size:m(1,1,2),always_interact:true,size_auto:true,dig_rate:10,harvest_results_exclusive:true,harvest_full_sound:"crop_harvest",harvest_results:{def:{0:[{type:l,id:i.ITEM_SEEDS_TOMATO,count:1,drop_chance:.5},{type:l,id:i.ITEM_TOMATO,count:1}],1:[{type:l,id:i.ITEM_SEEDS_CORN,count:1}],2:[{type:l,id:i.ITEM_SEEDS_PUMPKIN,count:1,drop_chance:.5},{type:l,id:i.ITEM_PUMPKIN,count:1}],3:[{type:l,id:i.ITEM_SEEDS_WHEAT,count:1}],4:[{type:l,id:i.ITEM_SEEDS_CARROT,count:1,drop_chance:.5},{type:l,id:i.ITEM_CARROT,count:1}],5:[{type:l,id:i.ITEM_SEEDS_SUGAR_CANE,count:1}],def:[]}},ground_filter:"dirt",on_flow:"dig"})
a(h.ITEM_WINDOW_LARGE_NAME)
e(l,"ITEM_WINDOW_LARGE",function ItemWindowLarge(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WINDOW_LARGE_NAME
if(h.get("ITEM_WINDOW_LARGE_DESC"))this.desc=h.ITEM_WINDOW_LARGE_DESC
if(h.get("ITEM_WINDOW_LARGE_INFO"))this.info=h.ITEM_WINDOW_LARGE_INFO
this.cost=[d.fromMaterial(this,0,30)]},{intangible:false,size_auto:true,mat_baked_key:{IRON:"window-large-metal",STONE:"window-large-stone",FANCY_STONE:"window-large-fancystone",LIGHT_WOOD:"window-large-lightwood",DARK_WOOD:"window-large-darkwood",RED_WOOD:"window-large-redwood",def:"window-large-wood"},boosted_key:{0:{FANCY_STONE:"window-large-stone"}}})
a(h.ITEM_WINDOW_MEDIUM_NAME)
e(l,"ITEM_WINDOW_MEDIUM",function ItemWindowMedium(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WINDOW_MEDIUM_NAME
if(h.get("ITEM_WINDOW_MEDIUM_DESC"))this.desc=h.ITEM_WINDOW_MEDIUM_DESC
if(h.get("ITEM_WINDOW_MEDIUM_INFO"))this.info=h.ITEM_WINDOW_MEDIUM_INFO
this.cost=[d.fromMaterial(this,0,20)]},{intangible:false,size_auto:true,mat_baked_key:{IRON:"window-medium-metal",STONE:"window-medium-stone",FANCY_STONE:"window-medium-fancystone",LIGHT_WOOD:"window-medium-lightwood",DARK_WOOD:"window-medium-darkwood",RED_WOOD:"window-medium-redwood",def:"window-medium-wood"},boosted_key:{0:{FANCY_STONE:"window-medium-stone"}}})
a(h.ITEM_WINDOW_SMALL_NAME)
e(l,"ITEM_WINDOW_SMALL",function ItemWindowSmall(e){this.initBase(e)
this.initBaked()
this.name=h.ITEM_WINDOW_SMALL_NAME
if(h.get("ITEM_WINDOW_SMALL_DESC"))this.desc=h.ITEM_WINDOW_SMALL_DESC
if(h.get("ITEM_WINDOW_SMALL_INFO"))this.info=h.ITEM_WINDOW_SMALL_INFO
this.cost=[d.fromMaterial(this,0,10)]},{intangible:false,size_auto:true,mat_baked_key:{IRON:"window-small-metal",STONE:"window-small-stone",FANCY_STONE:"window-small-fancystone",LIGHT_WOOD:"window-small-lightwood",DARK_WOOD:"window-small-darkwood",RED_WOOD:"window-small-redwood",def:"window-small-wood"},boosted_key:{0:{FANCY_STONE:"window-small-stone"}}})
a(h.ITEM_WORKBENCH_NAME)
e(l,"ITEM_WORKBENCH",function ItemWorkbench(e){this.initBase(e)
this.name=h.ITEM_WORKBENCH_NAME
if(h.get("ITEM_WORKBENCH_DESC"))this.desc=h.ITEM_WORKBENCH_DESC
if(h.get("ITEM_WORKBENCH_INFO"))this.info=h.ITEM_WORKBENCH_INFO
this.cost=[d.item({type:c,id:n.WOOD_RAW,count:10}),d.item({type:c,id:n.STONE_RAW,count:4})]
this.updateCostFromMatMap()},{def_material:s.WOOD,baked_key:"workbench",baked_swap:true,intangible:false,size_auto:true,cost_mat_map:{attr1:{cost_idx:0,def:"WOOD"},attr2:{cost_idx:1,def:"STONE"}},floater_z:1.5,particle_systems:[{name:"factory_workbench_particles",rot:0,offset_position:m(0,.21,1.5)}]})}},{"../../common/ids.js":249,"../../common/materials_common":253,"../../glov/common/util.js":400,"../../glov/common/vmath.js":402,"../items.js":119,"../localization/localization":131,"../tiles.js":199,assert:void 0}],17:[function(e,t,r){"use strict"
var a
e("../../glov/client/hsv").hsvToRGB
e("../../glov/common/vmath").vec3
e("../../common/ids")
e("../../common/ids").TYPE_ITEM
var i=e("../../common/materials_common")
i.CraftClass
i.Mat
var o=e("../tiles_const")
var n=o.LIQUID_TILES
o.TILES
o.FuelRate
o.Tint
t.exports=((a={})[n.WATER]={tile_code:"WATER",def:24,inv:[],name:"Water"},a[n.WATER_FLOW]={tile_code:"WATER_FLOW",def:34,inv:[],name:"Water"},a)},{"../../common/ids":249,"../../common/materials_common":253,"../../glov/client/hsv":324,"../../glov/common/vmath":402,"../tiles_const":200}],18:[function(e,t,r){"use strict"
var a,i,o,n,s
var l=e("../../glov/client/hsv").hsvToRGB
var _=e("../../glov/common/vmath").vec3
var c=e("../../common/ids")
var u=e("../../common/ids").TYPE_ITEM
var d=e("../../common/materials_common")
var f=d.CraftClass
var v=d.Mat
var h=e("../tiles_const")
h.LIQUID_TILES
var p=h.TILES
var m=h.FuelRate
var E=h.Tint
t.exports=((s={})[p.AETHERSTONE]={tile_code:"AETHERSTONE",mat:v.AETHERSTONE,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Aetherstone",unplaceable:true},s[p.BRICK_CLAY]={tile_code:"BRICK_CLAY",mat:v.STONE,craft_class:f.BRICK,def:28,not_material_source:true,crafted:true},s[p.BRICK_STONE]={tile_code:"BRICK_STONE",mat:v.FANCY_STONE,craft_class:f.BRICK,def:36,crafted:true},s[p.COAL]={tile_code:"COAL",mat:v.COAL,def:4,inv:[{type:u,id:c.ITEM_COAL}],not_material_source:true},s[p.COBALT]={tile_code:"COBALT",mat:v.COBALT,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Cobalt",unplaceable:true},s[p.COLORED_HUE0]={tile_code:"COLORED_HUE0",tint_color:l(_(),342,1,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE1]={tile_code:"COLORED_HUE1",tint_color:l(_(),38,1,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE2]={tile_code:"COLORED_HUE2",tint_color:l(_(),55,.85,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE3]={tile_code:"COLORED_HUE3",tint_color:l(_(),134,1,.89),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE4]={tile_code:"COLORED_HUE4",tint_color:l(_(),195,.67,1),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COLORED_HUE5]={tile_code:"COLORED_HUE5",tint_color:l(_(),260,.63,.86),mat:v.WOOD,def:10,not_material_source:true,crafted:true},s[p.COPPER]={tile_code:"COPPER",mat:v.COPPER,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Copper",unplaceable:true},s[p.CORAL1]={tile_code:"CORAL1",mat:v.CORAL,def:2},s[p.CORAL2]={tile_code:"CORAL2",mat:v.CORAL,def:3,not_material_source:true},s[p.DIRT]={tile_code:"DIRT",below:((a={})[p.STONE]=57,a),mat:v.DIRT,def:8,face:[9,9]},s[p.DIRT_WITH_FLINT]={tile_code:"DIRT_WITH_FLINT",mat:v.DIRT,blueprint:p.DIRT,def:33,inv:[p.DIRT,{type:u,id:c.ITEM_HATCHET,attr1:v.FLINT}],name:"Dirt (+Flint)",unplaceable:true},s[p.EMBERYLLIUM]={tile_code:"EMBERYLLIUM",mat:v.EMBERYLLIUM,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Emberyllium",unplaceable:true},s[p.GLASS]={tile_code:"GLASS",mat:v.SAND,def:35,tile1:true,no_self:true,alpha_cutout:true,crafted:true},s[p.GOLD]={tile_code:"GOLD",mat:v.GOLD,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Gold",unplaceable:true},s[p.GRASS]={tile_code:"GRASS",below:((i={})[p.GRASS]=1,i[p.STONE]=58,i),tint:E.GRASS,mat:v.DIRT,def:56,face:[1,9],inv:p.DIRT,not_material_source:true},s[p.IRON]={tile_code:"IRON",mat:v.IRON,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Iron",unplaceable:true},s[p.LEAVES1]={tile_code:"LEAVES1",tint_color:l(_(),70,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.LEAVES2]={tile_code:"LEAVES2",tint_color:l(_(),90,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.LEAVES3]={tile_code:"LEAVES3",tint_color:l(_(),105,1,.76),mat:v.LEAF,fuel_rate:m.LEAVES,def:20,inv:p.LEAVES3},s[p.LEAVES4]={tile_code:"LEAVES4",tint_color:l(_(),120,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.LEAVES5]={tile_code:"LEAVES5",tint_color:l(_(),140,1,.76),mat:v.LEAF,def:20,inv:p.LEAVES3,not_material_source:true},s[p.MYTHRIL]={tile_code:"MYTHRIL",mat:v.MYTHRIL,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Mythril",unplaceable:true},s[p.ORE_IN_STONE]={tile_code:"ORE_IN_STONE",tint:E.ORE,mat:v.STONE,limited_blueprint:p.STONE,def:5,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_STONE_DARK]={tile_code:"ORE_IN_STONE_DARK",tint:E.ORE,mat:v.STONE,limited_blueprint:p.STONE_DARK,def:13,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_STONE_LIGHT]={tile_code:"ORE_IN_STONE_LIGHT",tint:E.ORE,mat:v.STONE,limited_blueprint:p.STONE_LIGHT,def:21,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_STONE_RED]={tile_code:"ORE_IN_STONE_RED",tint:E.ORE,mat:v.STONE,limited_blueprint:p.STONE_RED,def:22,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.ORE_IN_VEINIUM]={tile_code:"ORE_IN_VEINIUM",tint:E.ORE,mat:v.STONE,limited_blueprint:p.VEINIUM,def:11,not_material_source:true,is_stone:true,unlimited_only:true,variable_yield:true},s[p.PASSABLE_LEAVES]={tile_code:"PASSABLE_LEAVES",tint_color:l(_(),90,1,.76),mat:v.LEAF,debug_as:p.LEAVES2,def:20,no_self:true,doublesided:true,draw_passable_overlay:true,inv:p.LEAVES3,not_material_source:true},s[p.PLANKS_WOOD]={tile_code:"PLANKS_WOOD",mat:v.WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:31,crafted:true},s[p.PLANKS_WOOD_DARK]={tile_code:"PLANKS_WOOD_DARK",mat:v.DARK_WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:47,crafted:true},s[p.PLANKS_WOOD_LIGHT]={tile_code:"PLANKS_WOOD_LIGHT",mat:v.LIGHT_WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:39,crafted:true},s[p.PLANKS_WOOD_RED]={tile_code:"PLANKS_WOOD_RED",mat:v.RED_WOOD,craft_class:f.WOOD_PLANK,fuel_rate:m.PLANKS,def:55,crafted:true},s.prop={def:52,tile1:true,unplaceable:true},s[p.SAND]={tile_code:"SAND",mat:v.SAND,def:18,face:[19,19]},s[p.SILVER]={tile_code:"SILVER",mat:v.SILVER,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Silver",unplaceable:true},s[p.SNOW]={tile_code:"SNOW",mat:v.DIRT,def:26,face:[27,27],not_material_source:true},s[p.STONE]={tile_code:"STONE",mat:v.STONE,craft_class:f.STONE_RAW,def:16,face:[17,17],is_stone:true},s[p.STONE_DARK]={tile_code:"STONE_DARK",mat:v.STONE,craft_class:f.STONE_RAW,def:14,not_material_source:true,is_stone:true},s[p.STONE_LIGHT]={tile_code:"STONE_LIGHT",mat:v.STONE,craft_class:f.STONE_RAW,def:15,not_material_source:true,is_stone:true},s[p.STONE_RED]={tile_code:"STONE_RED",mat:v.STONE,craft_class:f.STONE_RAW,def:23,not_material_source:true,is_stone:true},s[p.TILLED]={tile_code:"TILLED",above:((o={})[p.TILLED]=8,o[p.TILLED_WATERED]=8,o[p.DIRT]=8,o[p.GRASS]=8,o),mat:v.DIRT,limited_blueprint:p.DIRT,def:59,face:[6,8],inv:p.DIRT,not_material_source:true,unlimited_only:true},s[p.TILLED_WATERED]={tile_code:"TILLED_WATERED",above:((n={})[p.TILLED]=8,n[p.TILLED_WATERED]=8,n[p.DIRT]=8,n[p.GRASS]=8,n),mat:v.DIRT,limited_blueprint:p.DIRT,def:60,face:[7,8],inv:p.DIRT,not_material_source:true,unlimited_only:true},s[p.TIN]={tile_code:"TIN",mat:v.TIN,def:4,not_material_source:true,variable_yield:true,name:"Drop Debug: Tin",unplaceable:true},s.unknown={mat:v.DIRT,def:52,tile1:true,inv:[],not_material_source:true,unknown:true,unplaceable:true},s[p.VEINIUM]={tile_code:"VEINIUM",mat:v.STONE,craft_class:f.STONE_RAW,def:12,not_material_source:true,is_stone:true},s[p.WOOD]={tile_code:"WOOD",mat:v.WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:29,face:[30,30]},s[p.WOOD_BARK]={tile_code:"WOOD_BARK",mat:v.WOOD,blueprint:p.WOOD,def:29,face:[30,30],inv:[p.WOOD,{type:u,id:c.ITEM_FIBER}],name:"Wood",name2:"Old Wood w/ Bark",unplaceable:true},s[p.WOOD_DARK]={tile_code:"WOOD_DARK",mat:v.DARK_WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:45,face:[46,46]},s[p.WOOD_DARK_BARK]={tile_code:"WOOD_DARK_BARK",mat:v.DARK_WOOD,blueprint:p.WOOD_DARK,def:45,face:[46,46],inv:[p.WOOD_DARK,{type:u,id:c.ITEM_FIBER}],name:"Dark Wood",name2:"Old Dark Wood w/ Bark",unplaceable:true},s[p.WOOD_LIGHT]={tile_code:"WOOD_LIGHT",mat:v.LIGHT_WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:37,face:[38,38]},s[p.WOOD_LIGHT_BARK]={tile_code:"WOOD_LIGHT_BARK",mat:v.LIGHT_WOOD,blueprint:p.WOOD_LIGHT,def:37,face:[38,38],inv:[p.WOOD_LIGHT,{type:u,id:c.ITEM_FIBER}],name:"Light Wood",name2:"Old Light Wood w/ Bark",unplaceable:true},s[p.WOOD_RED]={tile_code:"WOOD_RED",mat:v.RED_WOOD,craft_class:f.WOOD_RAW,fuel_rate:m.WOOD,def:53,face:[54,54]},s[p.WOOD_RED_BARK]={tile_code:"WOOD_RED_BARK",mat:v.RED_WOOD,blueprint:p.WOOD_RED,def:53,face:[54,54],inv:[p.WOOD_RED,{type:u,id:c.ITEM_FIBER}],name:"Red Wood",name2:"Old Red Wood w/ Bark",unplaceable:true},s)},{"../../common/ids":249,"../../common/materials_common":253,"../../glov/client/hsv":324,"../../glov/common/vmath":402,"../tiles_const":200}],19:[function(e,t,r){"use strict"
r.drawBaked=drawBaked
r.drawBaked2=drawBaked2
r.getBakedEmit=getBakedEmit
r.assertBakeRuleExists=assertBakeRuleExists
r.lookupMat=lookupMat
r.meshWorkerSetUnreleasedTiles=meshWorkerSetUnreleasedTiles
r.bakedEmits=bakedEmits
r.bakedSize=bakedSize
r.bakedSwapped=bakedSwapped
r.bakedSwappedSimple=bakedSwappedSimple
r.startup=startup
var d=e("assert")
var Ne=e("../glov/client/engine")
var Ce=e("../glov/client/filewatch").filewatchOn
var a=e("../glov/client/quat")
var E=a.qFromAxisAngle
var g=a.qRotateX
var T=a.qRotateY
var y=a.qRotateZ
var i=a.quat
var o=e("../glov/client/webfs")
var xe=o.webFSExists
var Me=o.webFSGetFile
var De=o.webFSGetFileNames
var n=e("../glov/common/data_error").dataError
var s=e("../glov/common/util")
var l=s.cloneShallow
var f=s.defaults
var _=s.mod
var c=s.nop
var S=e("../glov/common/verify")
var u=e("../glov/common/vmath")
var v=u.unit_vec
var I=u.v3add
var A=u.v3iAdd
var w=u.v4copy
var h=u.vec3
var L=u.zaxis
var p=e("../common/globals").CHUNK_SIZE
var m=e("../common/materials_common.js").Mat
var O=e("./mesh_calc")
var R=O.bakedKeySame
var b=O.meshCalcBakeRules
var Pe=O.meshCalcSetBakingMeshGetter
var N=e("./palette").generateSwapKey
var C=e("./task_sched")
var x=C.WORKER_MESH
var M=C.taskCreate
var D=C.workerFlush
var P=e("./tiles")
var B=P.TILE_INTANGIBLE
var k=P.TILE_PROP_BASE
var U=P.TILE_PROP_MAX
var G=P.setUnreleasedTiles
var F=e("./voxel_data")
var W=F.andGetProp
var H=F.getTileLocal
var z=e("./voxel_data_drawable").voxelDataDrawableLoad
var Be=e("./voxel_data_xraw").MODELS_BASEPATH
var V=Math.max,ke=Math.PI
var Ue=30/180*ke
var Y=-.25*ke
var Ge
function bakingRealizeRuleData(e){var t=e.filename,r=e.opts
var a=z(t,f({for_baking:true},r)),i=a.drawing,o=a.meshing
d(o)
e.meshing=o
e.drawing=i}function bakingMeshFromRuleData(e){if(null===e.meshing)bakingRealizeRuleData(e)
return e.meshing}function bakingDrawableFromRuleData(e){if(null===e.drawing)bakingRealizeRuleData(e)
return e.drawing}function fitsPeriod(e,t){if(_(e[0],p)%t[0]^_(e[1],p)%t[1]^_(e[2],p)%t[2])return false
return true}var j=h()
var K=h()
var q=i()
var Z
function isTangible(e,t){I(j,e,t)
Z=null
var r=H(j,0,false)
if(!r)return false
if(r>=B)if(r>=k&&r<=U){if(!(Z=W())||Z.inv.intangible)return false}else return false
return true}function isSame(e,t,r){I(j,e,t)
var a=H(j,0,false)
if(a>=k&&a<=U){var i=W()
if(i&&R(i.inv.baked_key,r.inv.baked_key))return true}return false}function isEmpty(e,t){I(j,e,t)
return!H(j,0,false)}function drawBaked(e,t){var r=e.baked.key
var a=Ge[r]
if(!S(a))return
w(q,e.quat)
var i
var o=e.draw_opts.for_snapshot
for(var n=0;n<a.rules.length;++n){i=a.rules[n]
if(o){if(i.snapshot)break
continue}var s=true
if(i.period&&!fitsPeriod(t,i.period))s=false
if(i.same)for(var l=0;l<i.same.length;++l)if(!isSame(t,i.same[l],e)){s=false
break}if(i.tangible)for(var _=0;_<i.tangible.length;++_){if(!isTangible(t,i.tangible[_])){s=false
break}if(i.tangible_not_same&&Z)if(R(Z.inv.baked_key,e.inv.baked_key)){s=false
break}}if(i.intangible)for(var c=0;c<i.intangible.length;++c)if(isTangible(t,i.intangible[c])){s=false
break}if(i.empty)for(var u=0;u<i.empty.length;++u)if(!isEmpty(t,i.empty[u])){s=false
break}if(s)break}if(!i)return
if(void 0!==i.rot)E(q,L,i.rot*ke/2)
var d=1
I(K,t,e.draw_offs)
if(o){if(a.tool){var f=bakingDrawableFromRuleData(i.data).vd,v=f.maxpos,h=f.minpos
var p=V(v[0]-h[0],v[1]-h[1],v[2]-h[2])+1
K[1]-=h[0]/7
d=7/p}if(a.roty===Ue){T(q,q,Ue)
A(K,[-.28,0,.03])}else if(a.roty===Y){T(q,q,Y)
A(K,[.35,0,.13])}else if(a.roty)T(q,q,a.roty)
if(a.draw_offs)A(K,a.draw_offs)
if(a.rotx)g(q,q,a.rotx)
if(a.rotz)y(q,q,a.rotz)}var m=bakingDrawableFromRuleData(i.data)
e.draw_opts.unlit=!e.draw_opts.scale_lights
if(a.emit)e.draw_opts.torch_factor=a.emit
m.draw(K,q,d,e.draw_opts)}function drawBaked2(e,t,r){var a=Ge[t]
d(a)
var i
for(var o=0;o<a.rules.length;++o)if((i=a.rules[o]).snapshot||i.preview)break
if(!i)return
var n=bakingDrawableFromRuleData(i.data)
if(a.emit)r.torch_factor=a.emit
n.drawMat(e,r)}function getBakedEmit(e){var t=Ge[e]
d(t)
return t.emit}function assertBakeRuleExists(e){if(!Ge[e])d(Ge[e],"Referencing unknown baked key "+e)}function lookupMat(e){if(!e)return 0
if(!m[e]){n('Unknown material "'+e+'"')
return 0}return m[e]}var X=[1,1,1]
function loadBothSub(e,t){d(!t.origin_offset||Array.isArray(t.origin_offset)||t.origin_offset instanceof Float32Array)
return{meshing:null,drawing:null,filename:e,opts:t,size:t.size||X}}function loadBoth(e,t){var r=lookupMat(t.mat1)
var a=lookupMat(t.mat2)
var i=loadBothSub(e,t)
if(r||a){i.src_mat1=r
i.src_mat2=a}i.orig_filename=e
return i}function cloneDataReplace(e,t){if("object"!==typeof e)return e
if(Array.isArray(e)){var r=[]
for(var a=0;a<e.length;++a)r[a]=cloneDataReplace(e[a],t)
return r}var i={}
for(var o in e){var n=e[o]
if("data"===o)i[o]=t(n)
else i[o]=cloneDataReplace(n,t)}return i}function stripDrawing(e){if(e.drawing)delete(e=l(e)).drawing
return e}function updateRules(e){var t=cloneDataReplace(e,stripDrawing)
if(!Ne.defines.NOWORKERS){M({worker:x,time:0,type:"mesh_bake_rules",data:t},c)
D(x)}b(t)}function meshWorkerSetUnreleasedTiles(){if(!Ne.defines.NOWORKERS){M({worker:x,time:0,type:"set_unreleased_tiles"},c)
D(x)}G()}function bakedEmits(e){return Ge[e]&&Ge[e].emit||0}function bakedSize(e){return Ge[e]&&Ge[e].size||v}function bakedSwapped(e,_,c){var t=e+","+(_=_||0)+","+(c=c||0)
if(Ge[t])return t
var r=Ge[e]
if(!r)d(r,"Could not find bake_rule["+e+"]")
var u=[]
var a=cloneDataReplace(r,function(e){for(var t=0;t<u.length;++t)if(u[t].key===e)return u[t].value
var r
if(!e.orig_filename)r=e
else{var a=e.src_mat1,i=e.src_mat2,o=e.orig_filename,n=e.opts
d(n)
var s={}
if(a&&_)s[a]=_
if(i&&c)s[i]=c
var l=N(n.palette,s)
r=loadBothSub(o,f({palette:l},n))}u.push({key:e,value:r})
return r})
Ge[t]=a
var i={}
i[t]=a
updateRules(i)
return t}function bakedSwappedSimple(e,o){var t=N(e,o)
if(Ge[t])return t
var r=Ge[e]
if(!r)d(r,"Could not find bake_rule["+e+"]")
var n=[]
var a=cloneDataReplace(r,function(e){for(var t=0;t<n.length;++t)if(n[t].key===e)return n[t].value
var r
var a=e.opts
d(a)
var i=N(a.palette,o)
r=loadBothSub(e.orig_filename,f({palette:i},a))
n.push({key:e,value:r})
return r})
Ge[t]=a
var i={}
i[t]=a
updateRules(i)
return t}function simple(e){return{rules:[{data:e}],size:e.size}}function simpleEmit(e,t){return{rules:[{data:e}],size:e.size,emit:t||1}}function simpleRotSnapshot(e,t){return{rules:[{data:e},{data:e,snapshot:1,rot:t}],size:e.size}}function tool(e){return{tool:1,rotx:30/180*ke,roty:Y,rotz:-.5*ke,rules:[{data:e}],size:e.size}}function torchRules(e,t,r,a,i){var o={emit:1,rules:[{tangible:[[0,0,-1]],data:e,snapshot:1},{tangible:[[0,-1,0]],data:t,rot:0},{tangible:[[0,1,0]],data:t,rot:2},{tangible:[[1,0,0]],data:t,rot:1},{tangible:[[-1,0,0]],data:t,rot:3},{tangible:[[0,0,1]],data:r},{data:a}],size:e.size}
if(i)o.rules.splice(1,0,{tangible:[[0,0,1],[0,1,0],[0,-1,0]],data:r,rot:0},{tangible:[[0,0,1],[1,0,0],[-1,0,0]],data:r,rot:1},{tangible:[[0,0,1],[0,1,0],[-1,0,0]],data:i,rot:0},{tangible:[[0,0,1],[-1,0,0],[0,-1,0]],data:i,rot:1},{tangible:[[0,0,1],[0,-1,0],[1,0,0]],data:i,rot:2},{tangible:[[0,0,1],[1,0,0],[0,1,0]],data:i,rot:3},{tangible:[[0,0,1],[0,1,0]],data:r,rot:0},{tangible:[[0,0,1],[0,-1,0]],data:r,rot:2},{tangible:[[0,0,1],[1,0,0]],data:r,rot:1},{tangible:[[0,0,1],[-1,0,0]],data:r,rot:3})
return o}function fenceRules(e,t,r,a,i,o,n,s){var l=[{tangible:[[1,0,0],[0,-1,0],[-1,0,0],[0,1,0]],data:o,rot:0},{tangible:[[1,0,0],[0,-1,0],[-1,0,0]],data:i,rot:0},{tangible:[[1,0,0],[-1,0,0],[0,1,0]],data:i,rot:2},{tangible:[[1,0,0],[0,-1,0],[0,1,0]],data:i,rot:1},{tangible:[[0,-1,0],[-1,0,0],[0,1,0]],data:i,rot:3},{tangible:[[1,0,0],[2,0,0],[-1,0,0],[-2,0,0]],intangible:[[1,-1,0],[1,1,0],[-1,-1,0],[-1,1,0]],period:[4,1,1],data:n,rot:0,snapshot:1},{tangible:[[0,1,0],[0,2,0],[0,-1,0],[0,-2,0]],intangible:[[1,-1,0],[1,1,0],[-1,-1,0],[-1,1,0]],period:[1,4,1],data:n,rot:1}]
if(s)l.push({tangible:[[1,0,0],[2,0,0],[-1,0,0],[-2,0,0]],intangible:[[1,-1,0],[1,1,0],[-1,-1,0],[-1,1,0]],period:[2,1,1],data:s,rot:0},{tangible:[[0,1,0],[0,2,0],[0,-1,0],[0,-2,0]],intangible:[[1,-1,0],[1,1,0],[-1,-1,0],[-1,1,0]],period:[1,2,1],data:s,rot:1})
l.push({tangible:[[1,0,0],[-1,0,0]],data:e,rot:0},{tangible:[[0,-1,0],[0,1,0]],data:e,rot:1},{tangible:[[1,0,0],[0,-1,0]],data:a,rot:0},{tangible:[[-1,0,0],[0,1,0]],data:a,rot:2},{tangible:[[1,0,0],[0,1,0]],data:a,rot:1},{tangible:[[0,-1,0],[-1,0,0]],data:a,rot:3},{tangible:[[0,-1,0]],data:r,rot:0},{tangible:[[0,1,0]],data:r,rot:2},{tangible:[[1,0,0]],data:r,rot:1},{tangible:[[-1,0,0]],data:r,rot:3},{data:t})
return{rules:l,size:e.size}}function ladderRules(e,t,r){return{rules:[{period:[1,1,2],data:t},{data:r},{snapshot:1,data:e}],size:e.size}}function startup(){var e=["wood","lightwood","darkwood","redwood","stone","fancystone","metal"]
Ge={}
var a=Me("model_opts/torch-cube","jsobj")
e.forEach(function(e){var t="torch-"+e
if(e.includes("wood"))Ge[t]=torchRules(loadBoth(t+"-torch-base.vm",Me("model_opts/torch-base","jsobj")),loadBoth(t+"-torch-horiz.vm",Me("model_opts/torch-horiz","jsobj")),loadBoth(t+"-torch-top.vm",Me("model_opts/torch-top","jsobj")),loadBoth(t+"-torch-float.vm",Me("model_opts/torch-float","jsobj")))
var r
if(xe(""+Be+t+"-lantern-top-corner.vm"))r=loadBoth(t+"-lantern-top-corner.vm",Me("model_opts/torch-top","jsobj"))
Ge["lantern-"+e]=torchRules(loadBoth(t+"-lantern-base.vm",Me("model_opts/torch-base","jsobj")),loadBoth(t+"-lantern-horiz.vm",Me("model_opts/torch-horiz","jsobj")),loadBoth(t+"-lantern-top.vm",Me("model_opts/torch-top","jsobj")),loadBoth(t+"-lantern-float.vm",Me("model_opts/torch-float","jsobj")),r)
Ge["cubelight-"+e]=simpleEmit(loadBoth("torch-"+e+"-cube.vm",a))})
var t=Me("model_opts/fence","jsobj")
var r=Me("model_opts/fence-pole","jsobj")
var i=Me("model_opts/fence-end","jsobj")
var o=Me("model_opts/fence-corner","jsobj")
var n=Me("model_opts/fence-t","jsobj")
var s=Me("model_opts/fence-plus","jsobj")
var l=Me("model_opts/fence-dash","jsobj")
e.concat(["stonebrick"]).forEach(function(e){Ge["fence-"+e]=fenceRules(loadBoth("fence-"+e+".vm",t),loadBoth("fence-"+e+"-pole.vm",r),loadBoth("fence-"+e+"-end.vm",i),loadBoth("fence-"+e+"-corner.vm",o),loadBoth("fence-"+e+"-t.vm",n),loadBoth("fence-"+e+"-plus.vm",s),loadBoth("fence-"+e+"-dash.vm",l),xe("models/fence-"+e+"-dash2.vm")?loadBoth("fence-"+e+"-dash2.vm",l):null)})
var _=Me("model_opts/ladder","jsobj")
var c=Me("model_opts/ladder-half","jsobj")
var u=Me("model_opts/ladder-half","jsobj")
e.forEach(function(e){Ge["ladder-"+e]=ladderRules(loadBoth("ladder-"+e+".vm",_),loadBoth("ladder-"+e+"-up.vm",c),loadBoth("ladder-"+e+"-down.vm",u))})
function loadSimple(e,t){Ge[e]=simple(loadBoth(e+".vm",t))}var d=Me("model_opts/door_frame","jsobj")
var f=Me("model_opts/door-inhand","jsobj")
loadSimple("door-wood",f)
loadSimple("door-wood-frame",d)
loadSimple("door-wood2",f)
loadSimple("door-wood2-frame",d)
loadSimple("door-light",f)
loadSimple("door-light-frame",d)
loadSimple("door-light2",f)
loadSimple("door-dark",f)
loadSimple("door-dark-frame",d)
loadSimple("door-dark2",f)
loadSimple("door-red",f)
loadSimple("door-red-frame",d)
loadSimple("door-red2",f)
loadSimple("door-stone",f)
loadSimple("door-stone-frame",d)
loadSimple("door-stone2",f)
loadSimple("door-fancystone",f)
loadSimple("door-fancystone-frame",d)
loadSimple("door-fancystone2",f)
loadSimple("door-metal-frame",d)
loadSimple("door-metal",f)
loadSimple("door-metal2-frame",d)
loadSimple("door-metal2",f)
var v=Me("model_opts/doubledoor-frame","jsobj")
var h=Me("model_opts/doubledoor-inhand-left","jsobj")
var p=Me("model_opts/doubledoor-inhand-right","jsobj")
loadSimple("doubledoor-wood-frame",v)
loadSimple("doubledoor-wood-left",h)
loadSimple("doubledoor-wood-right",p)
loadSimple("doubledoor-lightwood-frame",v)
loadSimple("doubledoor-lightwood-left",h)
loadSimple("doubledoor-lightwood-right",p)
loadSimple("doubledoor-darkwood-frame",v)
loadSimple("doubledoor-darkwood-left",h)
loadSimple("doubledoor-darkwood-right",p)
loadSimple("doubledoor-redwood-frame",v)
loadSimple("doubledoor-redwood-left",h)
loadSimple("doubledoor-redwood-right",p)
loadSimple("doubledoor-stone-frame",v)
loadSimple("doubledoor-stone-left",h)
loadSimple("doubledoor-stone-right",p)
loadSimple("doubledoor-fancystone-frame",v)
loadSimple("doubledoor-fancystone-left",h)
loadSimple("doubledoor-fancystone-right",p)
loadSimple("doubledoor-metal-frame",v)
loadSimple("doubledoor-metal-gate-frame",Me("model_opts/doubledoor-gate-frame","jsobj"))
loadSimple("doubledoor-metal-gate",Me("model_opts/doubledoor-gate-inhand","jsobj"))
loadSimple("doubledoor-metal-left",h)
loadSimple("doubledoor-metal-right",p)
var m=Me("model_opts/plant-7x7","jsobj")
var E=Me("model_opts/plant-15x15","jsobj")
var g=Me("model_opts/plant-7x7-blue","jsobj")
var T=Me("model_opts/plant-15x15-blue","jsobj")
var y=Me("model_opts/plant-7x7-sway","jsobj")
loadSimple("plant-seed",m)
loadSimple("mushroom-seed",y)
loadSimple("plant-2",y)
loadSimple("plant-3",y)
loadSimple("plant-4",y)
loadSimple("plant-13",y)
loadSimple("plant-14",y)
loadSimple("plant-15",y)
loadSimple("plant-16",y)
loadSimple("plant-17",y)
loadSimple("plant-18",y)
loadSimple("plant-19",y)
loadSimple("plant-20",y)
loadSimple("plant-21",y)
loadSimple("plant-22",y)
loadSimple("plant-23",y)
loadSimple("plant-24",y)
loadSimple("plant-25",y)
loadSimple("plant-26",y)
loadSimple("plant-27",y)
loadSimple("plant-28",y)
loadSimple("plant-29",y)
loadSimple("plant-30",y)
loadSimple("plant-31",y)
loadSimple("plant-32",y)
loadSimple("plant-33",y)
var S=loadBoth("plant-34.vm",m)
Ge["plant-34"]=simpleEmit(S,.5)
Ge["plant-35"]=simpleEmit(S,.4)
Ge["plant-36"]=simpleEmit(S,.25)
Ge["plant-34-no-emit"]=simple(S)
Ge["plant-36-no-emit"]=Ge["plant-35-no-emit"]=Ge["plant-34-no-emit"]
loadSimple("coral_mushroom-1",y)
loadSimple("grass-spiky",m)
loadSimple("sapling-poplar",m)
loadSimple("sapling-oak",m)
loadSimple("sapling-pine",m)
loadSimple("sapling-willow",m)
var I=Me("model_opts/arborheart","jsobj")
Ge["arborheart-poplar"]=simpleEmit(loadBoth("arborheart-poplar.vm",I),.5)
Ge["arborheart-oak"]=simpleEmit(loadBoth("arborheart-oak.vm",I),.5)
Ge["arborheart-pine"]=simpleEmit(loadBoth("arborheart-pine.vm",I),.5)
Ge["arborheart-willow"]=simpleEmit(loadBoth("arborheart-willow.vm",I),.5)
loadSimple("arborheart-dead",I)
loadSimple("arborheart-dying",I)
var A=Me("model_opts/plant-14x14","jsobj")
loadSimple("red-berry-bush-0",A)
Ge["yellow-berry-bush-0"]=Ge["blue-berry-bush-0"]=Ge["red-berry-bush-0"]
loadSimple("red-berry-bush-1",A)
loadSimple("red-berry-bush-2",A)
loadSimple("blue-berry-bush-1",A)
loadSimple("blue-berry-bush-2",A)
loadSimple("yellow-berry-bush-1",A)
loadSimple("yellow-berry-bush-2",A)
loadSimple("berries-item",T)
loadSimple("berries-build",g)
loadSimple("bottle-empty",E)
loadSimple("bottle-empty-build",m)
loadSimple("bottle-small",m)
loadSimple("bottle-juice",E)
loadSimple("bottle-juice-label",E)
loadSimple("hot-plant",m)
loadSimple("hot",m)
loadSimple("pungent-plant",m)
loadSimple("pungent",m)
loadSimple("savory-plant",m)
loadSimple("savory",m)
loadSimple("wild-crop-tomato",m)
loadSimple("wild-crop-corn",m)
loadSimple("wild-crop-pumpkin",m)
loadSimple("wild-crop-wheat",m)
loadSimple("wild-crop-carrot",m)
var w=Me("model_opts/crop-corn","jsobj")
for(var L=1;L<9;L++)loadSimple("crop-corn-"+L,w)
loadSimple("corn-harvested",E)
var O=Me("model_opts/crop-wheat","jsobj")
for(var R=1;R<6;R++)loadSimple("crop-wheat-"+R,O)
loadSimple("wheat-harvested",E)
loadSimple("flour-build",m)
loadSimple("flour-item",E)
var b=Me("model_opts/crop-sugar-cane","jsobj")
var N=Me("model_opts/crop-sugar-cane-full","jsobj")
for(var C=1;C<6;C++)loadSimple("crop-sugar-cane-"+C,C>=4?N:b)
loadSimple("sugar-cane-harvested",E)
loadSimple("sugar",E)
var x=Me("model_opts/crop-tomato","jsobj")
for(var M=1;M<6;M++)loadSimple("crop-tomato-"+M,x)
var D=Me("model_opts/crop-pumpkin","jsobj")
var P=Me("model_opts/crop-carrot-full","jsobj")
for(var B=1;B<5;B++)loadSimple("crop-carrot-"+B,B<4?D:P)
var k=Me("model_opts/crop-pumpkin","jsobj")
var U=Me("model_opts/crop-pumpkin-full","jsobj")
for(var G=1;G<6;G++)loadSimple("crop-pumpkin-"+G,G<3?k:U)
loadSimple("seedbag-carrot",E)
loadSimple("seedbag-corn",E)
loadSimple("seedbag-mushroom",E)
loadSimple("seedbag-pumpkin",E)
loadSimple("seedbag-sugarcane",E)
loadSimple("seedbag-tomato",E)
loadSimple("seedbag-wheat",E)
loadSimple("tomato",E)
loadSimple("carrot",E)
loadSimple("pumpkin",E)
loadSimple("mushroom",E)
loadSimple("bread-item",E)
loadSimple("bread-build",m)
loadSimple("pie",E)
loadSimple("roast-vegetables",E)
loadSimple("sandwich",E)
loadSimple("croissant",E)
var F=Me("model_opts/algae","jsobj")
loadSimple("algae-0",m)
loadSimple("algae-mint-1",F)
loadSimple("algae-mint-2",F)
loadSimple("algae-jade-1",F)
loadSimple("algae-jade-2",F)
loadSimple("algae-bubblegum-1",F)
loadSimple("algae-bubblegum-2",F)
loadSimple("algae-indigo-1",F)
loadSimple("algae-indigo-2",F)
loadSimple("algae-ultramarine-1",F)
loadSimple("algae-ultramarine-2",F)
loadSimple("algae_spores-mint",E)
loadSimple("algae_spores-jade",E)
loadSimple("algae_spores-bubblegum",E)
loadSimple("algae_spores-indigo",E)
loadSimple("algae_spores-ultramarine",E)
var W=Me("model_opts/seashell","jsobj")
loadSimple("seashell-thistle",W)
loadSimple("seashell-conch-thistle",W)
loadSimple("seashell-imperial",W)
loadSimple("seashell-navy",W)
loadSimple("seashell-daffodil",W)
loadSimple("seashell-conch-mocha",W)
loadSimple("seashell-conch-plum",W)
loadSimple("seashell-conch-indigo",W)
loadSimple("seashell-open",W)
loadSimple("coral_powder",E)
loadSimple("sea_candy",E)
loadSimple("coral_crunch",E)
var H=Me("model_opts/anemone","jsobj")
loadSimple("anemone-carnation",H)
loadSimple("anemone-imperial",H)
loadSimple("anemone-cerulean",H)
var z=Me("model_opts/starfish","jsobj")
loadSimple("starfish-canary",z)
loadSimple("starfish-sangria",z)
loadSimple("starfish-tiger",z)
var V=Me("model_opts/disc_coral","jsobj")
loadSimple("disc_coral-scarlet",V)
loadSimple("disc_coral-evergreen",V)
loadSimple("disc_coral-piggy",V)
loadSimple("disc_coral-tangerine",V)
loadSimple("disc_coral-teal",V)
var Y=Me("model_opts/coral_tubes","jsobj")
loadSimple("coral_tubes-pizzazz-0",Y)
loadSimple("coral_tubes-pizzazz-1",Y)
loadSimple("coral_tubes-butter-0",Y)
loadSimple("coral_tubes-butter-1",Y)
loadSimple("roast_seafood-anemone",E)
loadSimple("roast_seafood-starfish",E)
loadSimple("cactorb_seeds-ruby",E)
loadSimple("cactorb_seeds-kyanite",E)
loadSimple("cactorb-0",A)
loadSimple("cactorb-ruby-1",A)
loadSimple("cactorb-ruby-2",A)
loadSimple("cactorb-kyanite-1",A)
Ge["cactorb-kyanite-2"]=simpleRotSnapshot(loadBoth("cactorb-kyanite-2.vm",A),3)
loadSimple("cactiny_seeds-lizardite",E)
loadSimple("cactiny_seeds-amethyst",E)
loadSimple("cactiny-0",m)
loadSimple("cactiny-lizardite-1",m)
loadSimple("cactiny-lizardite-2",m)
loadSimple("cactiny-amethyst-1",m)
loadSimple("cactiny-amethyst-2",m)
var j=Me("model_opts/watering-system","jsobj")
for(var K=0;K<4;K++)loadSimple("watering-system-"+K,j)
loadSimple("paint",Me("model_opts/prop-mat-15x15","jsobj"))
loadSimple("chest-medium-metal",Me("model_opts/chest-medium-metal","jsobj"))
var q=Me("model_opts/chest-medium","jsobj")
var Z=Me("model_opts/chest-tiny","jsobj")
var X=Me("model_opts/chest-small","jsobj")
e.forEach(function(e){var t="chest-medium-"+e
if(!Ge[t])loadSimple(t,q)
loadSimple("chest-tiny-"+e,Z)
loadSimple("chest-small-"+e,X)})
function loadDome(e){var t=Me("model_opts/"+e,"jsobj")
var r=loadBoth(e+"-base.vm",t)
Ge[e+"-base"]=simple(r)
var a=loadBoth(e+"-horiz.vm",t)
Ge[e+"-horiz"]=simple(a)
var i=loadBoth(e+"-top.vm",t)
Ge[e+"-top"]=simple(i)
Ge[e+"-auto"]={rules:[{tangible_not_same:true,tangible:[[0,0,-1]],data:r},{tangible_not_same:true,tangible:[[0,1,0]],data:a,rot:0},{tangible_not_same:true,tangible:[[-1,0,0]],data:a,rot:1},{tangible_not_same:true,tangible:[[0,-1,0]],data:a,rot:2},{tangible_not_same:true,tangible:[[1,0,0]],data:a,rot:3},{tangible_not_same:true,tangible:[[0,0,1]],data:i},{data:r,preview:1}],size:r.size}}loadDome("dome")
loadDome("dome-wood")
loadDome("dome-stone")
loadDome("dome-fancystone")
function rodRules(e,t,r,a){return{rules:[{tangible:[[0,0,-1]],period:[1,1,2],data:r},{tangible:[[0,0,-1]],data:a},{same:[[0,1,0]],period:[1,2,1],data:e},{same:[[0,1,0]],data:t},{same:[[0,-1,0]],period:[1,2,1],data:e},{same:[[0,-1,0]],data:t},{same:[[1,0,0]],period:[2,1,1],data:e,rot:1},{same:[[1,0,0]],data:t,rot:1},{same:[[-1,0,0]],period:[2,1,1],data:e,rot:1},{same:[[-1,0,0]],data:t,rot:1},{tangible:[[0,1,0],[0,-1,0]],period:[1,2,1],data:e},{tangible:[[0,1,0],[0,-1,0]],data:t},{tangible:[[1,0,0],[-1,0,0]],period:[2,1,1],data:e,rot:1},{tangible:[[1,0,0],[-1,0,0]],data:t,rot:1},{tangible:[[0,1,0]],period:[1,2,1],data:e},{tangible:[[0,1,0]],data:t},{tangible:[[0,-1,0]],period:[1,2,1],data:e},{tangible:[[0,-1,0]],data:t},{tangible:[[1,0,0]],period:[2,1,1],data:e,rot:1},{tangible:[[1,0,0]],data:t,rot:1},{tangible:[[-1,0,0]],period:[2,1,1],data:e,rot:1},{tangible:[[-1,0,0]],data:t,rot:1},{period:[1,1,2],data:r},{data:a,preview:1}],size:r.size}}function rodvRules(e,t){return{roty:0,rules:[{period:[1,1,2],data:e},{data:t,preview:1}],size:e.size}}function rodhRules(e,t){return{rotz:.5*ke,rules:[{period:[2,2,1],data:e},{data:t,preview:1}],size:e.size}}var Q=Me("model_opts/rod-h","jsobj")
var $=loadBoth("rod-h1.vm",Q)
var J=loadBoth("rod-h2.vm",Q)
var ee=Me("model_opts/rod-v","jsobj")
var te=loadBoth("rod-v1.vm",ee)
var re=loadBoth("rod-v2.vm",ee)
var ae=loadBoth("rod-snapshot.vm",Me("model_opts/rod-snapshot","jsobj"))
Ge.rod=rodRules($,J,te,re)
Ge.rod_resource=simple(ae)
Ge.rod_resource.roty=Ue
Ge.rodv=rodvRules(te,re)
Ge.rodh=rodhRules($,J)
var ie=Me("model_opts/rod-stone","jsobj")
var oe=loadBoth("rod-stone-h1.vm",ie)
var ne=loadBoth("rod-stone-h2.vm",ie)
var se=loadBoth("rod-stone-v1.vm",ie)
var le=loadBoth("rod-stone-v2.vm",ie)
Ge["rod-stone"]=rodRules(oe,ne,se,le)
Ge["rodh-stone"]=rodhRules(oe,ne)
Ge["rodv-stone"]=rodvRules(se,le)
var _e=Me("model_opts/rod-fancystone","jsobj")
var ce=loadBoth("rod-fancystone-h1.vm",_e)
var ue=loadBoth("rod-fancystone-h2.vm",_e)
var de=loadBoth("rod-fancystone-v1.vm",_e)
var fe=loadBoth("rod-fancystone-v2.vm",_e)
Ge["rod-fancystone"]=rodRules(ce,ue,de,fe)
Ge["rodh-fancystone"]=rodhRules(ce,ue)
Ge["rodv-fancystone"]=rodvRules(de,fe)
function loadTools(e,t){Ge[e+"_pickax"]=tool(loadBoth(e+"-15-pickax.vm",t))
Ge[e+"_hatchet"]=tool(loadBoth(e+"-15-hatchet.vm",t))
Ge[e+"_hoe"]=tool(loadBoth(e+"-15-hoe.vm",t))
Ge[e+"_shovel"]=tool(loadBoth(e+"-15-shovel.vm",t))
Ge[e+"_shovel"].rotz=ke
Ge[e+"_hoe"].roty=Ue}loadTools("metal",Me("model_opts/metal-15","jsobj"))
loadTools("stone",Me("model_opts/stone-15","jsobj"))
Ge["crude-stone-hatchet"]=tool(loadBoth("crude-stone-hatchet.vm",Me("model_opts/crude-stone-hatchet","jsobj")))
Ge["crude-stone-pickax"]=tool(loadBoth("crude-stone-pickax.vm",Me("model_opts/crude-stone-pickax","jsobj")))
Ge["crude-stone-shovel"]=tool(loadBoth("crude-stone-shovel.vm",Me("model_opts/crude-stone-shovel","jsobj")))
var ve=loadBoth("grow.vm",Me("model_opts/grow","jsobj"))
Ge.grow={rotx:-30/180*ke,rotz:+ke,draw_offs:[0,0,-.7],rules:[{data:ve}],size:ve.size}
var he=Me("model_opts/bucket","jsobj")
Ge.bucket_full=tool(loadBoth("bucket-full.vm",he))
Ge.bucket_flow=tool(loadBoth("bucket-flow.vm",he))
Ge.bucket_empty=tool(loadBoth("bucket-empty.vm",he))
Ge.bucket_flow.rotz=Ge.bucket_full.rotz=Ge.bucket_empty.rotz=ke/4
Ge.bucket_flow.roty=Ge.bucket_full.roty=Ge.bucket_empty.roty=0
Ge.bucket_flow.rotx=Ge.bucket_full.rotx=Ge.bucket_empty.rotx=ke/6
var pe=Me("model_opts/waygate","jsobj")
Ge.waygate=simpleRotSnapshot(loadBoth("waygate.vm",pe),2)
var me=Me("model_opts/leapgate","jsobj")
loadSimple("leapgate-unset",me)
loadSimple("leapgate-inactive",me)
Ge["leapgate-active"]=simpleRotSnapshot(loadBoth("leapgate-active.vm",me),2)
Ge.buzzerstart_ready=simpleEmit(loadBoth("buzzerstart_ready.vm",Me("model_opts/buzzerstart","jsobj")),.3)
Ge.buzzergoal_ready=simpleEmit(loadBoth("buzzergoal_ready.vm",Me("model_opts/buzzergoal","jsobj")),.3)
Ge.buzzerstart_racing=simpleEmit(loadBoth("buzzerstart_racing.vm",Me("model_opts/buzzerstart","jsobj")),.3)
Ge.buzzergoal_racing=simpleEmit(loadBoth("buzzergoal_racing.vm",Me("model_opts/buzzergoal","jsobj")),.3)
loadSimple("buzzerstart_blank",Me("model_opts/buzzerstart","jsobj"))
loadSimple("buzzergoal_blank",Me("model_opts/buzzergoal","jsobj"))
var Ee=Me("model_opts/shelf","jsobj")
e.forEach(function(e){loadSimple("shelf-"+e,Ee)})
var ge=loadBoth("flowerpot.vm",Me("model_opts/flowerpot","jsobj"))
var Te=loadBoth("flowerpot-wall.vm",Me("model_opts/flowerpot-wall","jsobj"))
var ye=loadBoth("flowerpot-wall.vm",Me("model_opts/flowerpot-wall-raised","jsobj"))
Ge.flowerpot={rules:[{empty:[[0,0,-1],[0,0,1]],tangible:[[0,1,0]],data:ye},{empty:[[0,0,-1],[0,0,1]],tangible:[[0,-1,0]],data:ye,rot:2},{empty:[[0,0,-1],[0,0,1]],tangible:[[1,0,0]],data:ye,rot:3},{empty:[[0,0,-1],[0,0,1]],tangible:[[-1,0,0]],data:ye,rot:1},{empty:[[0,0,-1]],tangible:[[0,1,0]],data:Te},{empty:[[0,0,-1]],tangible:[[0,-1,0]],data:Te,rot:2},{empty:[[0,0,-1]],tangible:[[1,0,0]],data:Te,rot:3},{empty:[[0,0,-1]],tangible:[[-1,0,0]],data:Te,rot:1},{data:ge,preview:1}],size:ge.size}
var Se=Me("model_opts/steps","jsobj")
e.forEach(function(e){loadSimple("steps-"+e,Se)})
Ge.campfire=simpleEmit(loadBoth("campfire.vm",Me("model_opts/factory-placeholder","jsobj")),1)
Ge.bonfire=simpleEmit(loadBoth("bonfire.vm",Me("model_opts/bonfire","jsobj")),1)
Ge["bonfire-metal"]=simpleEmit(loadBoth("bonfire-metal.vm",Me("model_opts/bonfire-metal","jsobj")),1)
var Ie=Me("model_opts/energy-well","jsobj")
loadSimple("energy-well-empty",Ie)
loadSimple("energy-well-full1",Ie)
loadSimple("energy-well-full2",Ie)
loadSimple("energy-well-full3",Ie)
var Ae={small:Me("model_opts/window-small","jsobj"),medium:Me("model_opts/window-medium","jsobj"),large:Me("model_opts/window-large","jsobj")}
e.forEach(function(r){["small","medium","large"].forEach(function(e){var t="window-"+e+"-"+r
Ge[t]=simple(loadBoth(t+".vm",Ae[e]))})})
Ge["emit-1x2"]={emit:1,size:[1,1,2],rules:[]}
var we=De("models/")
for(var Le=0;Le<we.length;++Le){var Oe=we[Le].match(/^models\/(.*)\.vm$/)
if(!Oe)continue
var Re=Oe[1]
if(Ge[Re])continue
var be="model_opts/"+Re
if(!xe(be))continue
loadSimple(Re,Me(be,"jsobj"))}updateRules(Ge)
Pe(bakingMeshFromRuleData)
Ce(/^model_opts\//,Ne.reloadSafe)}},{"../common/globals":248,"../common/materials_common.js":253,"../glov/client/engine":305,"../glov/client/filewatch":314,"../glov/client/quat":346,"../glov/client/webfs":371,"../glov/common/data_error":381,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./mesh_calc":142,"./palette":149,"./task_sched":198,"./tiles":199,"./voxel_data":216,"./voxel_data_drawable":217,"./voxel_data_xraw":218,assert:void 0}],20:[function(e,t,r){"use strict"
r.fdeg=fdeg
r.fpos=fpos
r.isJumpingController=isJumpingController
r.isFlyingController=isFlyingController
r.isDoubleJumpToFlyController=isDoubleJumpToFlyController
r.BaseController=r.TODEG=r.TORAD=r.MAX_STEP_DT=r.MAX_TIMESLICE=void 0
var a=e("../glov/common/util").clamp
var i=e("../glov/common/verify")
var o=e("../glov/common/vmath")
var n=o.v2copy
var s=o.v3copy
var l=o.v3iAdd
var _=o.vec2
var c=o.vec3
var u=o.zero_vec
var d=e("../common/globals")
var f=d.CHUNK_SIZE
var v=d.SAFE_DIST
var h=d.SAFE_DIST_Z
var p=e("./camera")
var m=p.getActiveController
var E=p.shiftCurrentCameraPos
var g=e("./voxel_const").origin_chunk
var T=Math.abs,y=Math.sign,S=Math.PI
var I=1e3
r.MAX_TIMESLICE=I
var A=16
r.MAX_STEP_DT=A
var w=S/180
var L=1/(r.TORAD=w)
r.TODEG=L
function fdeg(e){return(e*L).toFixed(0)}function fpos(e,t){return e.toFixed(t)}var O=[v,v,h]
var R=.01
var b=function(){function BaseController(e,t){this.pos=c(0,0,100)
this.ypr=c(90*w,0,0)
this.facing=c()
this.cardinal_facing=_()
this.char_right=c()
this.char_up=c()
this.base_speed=void 0
this.eye_height=void 0
this.col_bounds=void 0
this.controller_height=void 0
this.camera_pos=void 0
this.user_active=false
this.vel=c(0,0,0)
this.auto_run=false
this.blocked_accum=0
this.blocked_frames=0
this.blocked_target=null
this.col_bounds=e.col_bounds
this.eye_height=e.eye_height
this.controller_height=this.eye_height+this.col_bounds.max[2]
this.base_speed=t}var e=BaseController.prototype
e.setPos=function setPos(e){s(this.pos,e)
this.makePositionSafe()}
e.getCardinalFacing=function getCardinalFacing(){var e=T(this.facing[0])>T(this.facing[1])?0:1
n(this.cardinal_facing,u)
this.cardinal_facing[e]=y(this.facing[e])
return this.cardinal_facing}
e.getPosString=function getPosString(){var e=g
var t=this.pos
var r=f
return fpos(t[0]+e[0]*r,1)+","+fpos(t[1]+e[1]*r,1)+","+fpos(t[2]+e[2]*r,1)+","+fdeg(this.ypr[0])+","+fdeg(this.ypr[1])+","+(this.flying?"f":"")}
e.makePositionSafe=function makePositionSafe(){for(var e=0;e<3;++e){var t=O[e]
var r=this.pos[e]+g[e]*f
if(r<-t)this.pos[e]=-t-g[e]*f
else if(r>t)this.pos[e]=t-g[e]*f
if(!i(isFinite(this.pos[e])))this.pos[e]=0}}
e.shift=function shift(e){l(this.pos,e)
if(this.blocked_target&&3===this.blocked_target.length)l(this.blocked_target,e)
if(m()===this)E(e)}
e.updateSize=function updateSize(e){this.col_bounds=e.col_bounds
this.eye_height=e.eye_height
this.controller_height=this.eye_height+this.col_bounds.max[2]}
e.getClearanceHeight=function getClearanceHeight(){return this.controller_height}
e.updateYawPitch=function updateYawPitch(e){n(this.ypr,e)
if(this.ypr[0]<0)this.ypr[0]+=2*S
else if(this.ypr[0]>2*S)this.ypr[0]-=2*S
this.ypr[1]=a(this.ypr[1],-S/2+R,S/2-R)}
e.getCameraPos=function getCameraPos(){return this.camera_pos}
e.applyTweakedCameraPos=function applyTweakedCameraPos(e){s(this.camera_pos,e)}
e.getCameraTargetDir=function getCameraTargetDir(){return this.facing}
return BaseController}()
r.BaseController=b
function isJumpingController(e){return void 0!==e.jump_time}function isFlyingController(e){return Boolean(e.isAerial)}function isDoubleJumpToFlyController(e){return e.can_doublejump_to_fly}},{"../common/globals":248,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./camera":35,"./voxel_const":215}],21:[function(e,t,r){"use strict"
r.genSunkenChestProp=genSunkenChestProp
r.detailGenCoralCave=detailGenCoralCave
r.CORAL_CAVE_MAX_HEIGHT=r.CORAL_CAVE_SIZE=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("../glov/common/util")
var q=a.clamp
var i=a.inherits
var s=a.mod
var o=e("../glov/common/vmath")
var n=o.ivec2
var l=o.ivec3
var _=o.v2add
var c=o.v2floor
var Z=o.v3sub
var u=e("../common/globals")
var X=u.CHUNK_SIZE
var Q=u.CS2
var d=e("../common/ids")
var f=d.ITEM_BERRY
var v=d.ITEM_CARROT
var h=d.ITEM_CHEST_MEDIUM
var p=d.ITEM_CORAL_CRUNCH
var m=d.ITEM_CORD
var E=d.ITEM_CORN
var g=d.ITEM_PLANT
var T=d.ITEM_PUMPKIN
var y=d.ITEM_ROD
var S=d.ITEM_SEA_CANDY
var I=d.ITEM_SPICE
var A=d.ITEM_TOMATO
var w=d.TYPE_ITEM
var L=e("../common/materials_common").Mat
var O=e("./biome_details").TREE_CHECK_CORNERS
var R=e("./detail_gen_base")
var b=R.DetailGenBase
var $=R.tryDeleteProp
var J=R.tryPlaceProp
var N=e("./flora_constants")
var C=N.FLOWER_SEEDS
var x=N.SUNKEN_CHEST
var M=e("./proc_gen")
var D=e("./proc_gen_biomes")
var ee=D.calcBlendWeightsVS
var te=D.world_noise3D
var P=e("./proc_gen_constants").PROP_2x2x2
var B=e("./tiles")
var re=B.TILE_CORAL1
var ae=B.TILE_CORAL2
var ie=B.TILE_PROP_BASE
var oe=B.TILE_WATER
var k=Math.floor,ne=Math.max,se=Math.min
var U=240
r.CORAL_CAVE_SIZE=U
var le=20
var G=50
r.CORAL_CAVE_MAX_HEIGHT=G
var _e=l()
function DetailGenCoralCave(e,t,r,a){b.call(this)
var i=a.hexome
this.seed=e
this.owner_hexome=i
c(_e,i.pos_world)
var o=M.getVerticalSliceMapData(_e).h
this.chest_pos=l(_e[0],_e[1],o+1)
if(s(this.chest_pos[0],X)===X-1)--this.chest_pos[0]
if(s(this.chest_pos[1],X)===X-1)--this.chest_pos[1]
if(s(this.chest_pos[2],X)===X-1)--this.chest_pos[2]
this.chest_cave_pos=this.chest_pos.slice(0)
this.chest_cave_pos[0]-=2
this.chest_cave_pos[1]-=2;--this.chest_cave_pos[2]
this.size_x=this.size_y=U
this.size_z=G;(t=this.origin=t.slice(0))[2]=o-k(G/2)
var n=t[2]+G-1
this.surface_range=[t[2]-1,n-le]
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,t[0],t[1],t[2],t[0]+this.size_x-1,t[1]+this.size_y-1,n)}i(DetailGenCoralCave,b)
DetailGenCoralCave.prototype.type="DetailGenCoralCave"
DetailGenCoralCave.prototype.priority=200
var ce=.5
var ue=.9
var de=8
var fe=.6
var ve=.8
var he=1/(ve-fe)
var pe=1/(1-fe)
function genSunkenChestProp(e){var t=[{type:w,id:I,attr3:[L.PUNGENT,L.HOT,L.SAVORY],count:[10,60]},{type:w,id:A,chance:.25,count:[1,20]},{type:w,id:v,chance:.25,count:[1,20]},{type:w,id:T,chance:.25,count:[1,20]},{type:w,id:E,chance:.25,count:[1,20]},{type:w,id:m,chance:.25,count:[1,20]},{type:w,id:y,chance:.25,count:[5,10],attr1:[L.WOOD,L.RED_WOOD,L.DARK_WOOD,L.LIGHT_WOOD]},{type:w,id:g,chance:.25,count:[1,5],attr3:C},{type:w,id:f,chance:.25,count:[3,12],attr1:[L.RED_BERRY,L.BLUE_BERRY,L.YELLOW_BERRY]},{type:w,id:S,chance:.25,count:[1,5]},{type:w,id:p,chance:.25,count:[1,5]}]
var r=[]
for(var a=0;a<t.length;++a){var i=t[a]
var o=i.count
if(Array.isArray(o))o=o[0]+e.range(o[1]-o[0])
if(o<=0)continue
var n=_extends({},i,{count:o})
if(n.chance){if(e.random()>n.chance)continue
delete n.chance}for(var s in n){var l=n[s]
if(Array.isArray(l))n[s]=l[e.range(l.length)]}r.push(n)}return{id:h,size:P,attr3:x,attr1:L.WOOD,contents:r,rot:e.range(4)}}var me=[["...","..X",".XX"],["..X",".XO","XOO"],[".XX","XOO","XOO"]]
var Ee=l()
var ge=.1
var Te=n()
DetailGenCoralCave.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i){t.alloc(false)
i=t.data}var o=t.liquid
var n=this.size_x,s=this.size_y,l=this.size_z,_=this.origin,c=this.owner_hexome,u=this.chest_pos,d=this.chest_cave_pos,f=this.surface_range
var v=r.map
var h=t.pos_world
Z(Ee,h,_)
var p=ne(-Ee[0],0)
var m=se(n-Ee[0],X)
var E=ne(-Ee[1],0)
var g=se(s-Ee[1],X)
var T=ne(-Ee[2],0)
var y=se(l-Ee[2],X)
for(var S=E;S<g;++S){var I=h[1]+S
Te[1]=S
var A=I-_[1]
var w=I-d[1]
var L=w>=0&&w<6
if(L&&w>2)w=5-w
var O=v[S]
for(var R=p;R<m;++R){var b=h[0]+R
Te[0]=R
var N=b-_[0]
var C=b-d[0]
var x=L&&C>=0&&C<6
if(x&&C>2)C=5-C
var M=O[R].h
M=q(M,f[0],f[1])
var D=0
ee(r,Te,false)
for(var P=0;P<r.hexomes.length;++P)if(r.hexomes[P]===c){D=r.blend_weights[P]
break}if((D=2*D-1)<0)continue
var B=D
if(N<3)B*=(N+1)/4
else if(N>=n-3)B*=(n-N)/4
if(A<3)B*=(A+1)/4
else if(A>=s-3)B*=(s-A)/4
for(var k=T;k<=y;++k){var U=h[2]+k
var G=U-_[2]
var F=U-d[2]
var W=R+S*X+k*Q
if(x&&F>=0&&F<6){if(F>2)F=5-F
var H=i[W]
if(H>=ie)if(!$(t,H,R,S,k))continue
var z=me[F][w][C]
if("X"===z){i[W]=re
if(o)o[W]=0
continue}else if("O"===z){if(H){i[W]=0
if(!o){t.alloc(true)
o=t.liquid}o[W]=oe}continue}}var V=te[0](b*ge,I*ge,U*ge)
var Y=(U-M)/le
if(Y>=1)break
if(V<(G<de?G/de*ce:Y<fe?ce:Y<ve?ce+(ue-ce)*(Y-fe)*he:ue*(1-(Y-ve)*pe))*B){var j=i[W]
if(j>=ie)if(!$(t,j,R,S,k))continue
i[W]=ae
if(o)o[W]=0}}}}if(u[0]>=h[0]&&u[0]<h[0]+X&&u[1]>=h[1]&&u[1]<h[1]+X&&u[2]>=h[2]&&u[2]<h[2]+X){Z(_e,u,h)
var K=genSunkenChestProp(a)
J(t,_e,K,oe)}}
var F=n()
function detailGenCoralCave(e,t,r,a){for(var i=0;i<O.length;++i){_(F,t,O[i])
var o=M.getVerticalSliceMapData(F)
if(o.h>o.water_level-le)return null}return new DetailGenCoralCave(e,t,r,a)}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../glov/common/util":400,"../glov/common/vmath":402,"./biome_details":23,"./detail_gen_base":74,"./flora_constants":101,"./proc_gen":162,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./tiles":199}],22:[function(e,t,r){"use strict"
r.detailGenPitfall=detailGenPitfall
r.PITFALL_MAX_HEIGHT=r.PITFALL_SIZE=void 0
var n=e("../glov/client/rand_fast").randFastCreate
var a=e("../glov/common/util").inherits
var i=e("../glov/common/vmath")
var o=i.ivec2
var s=i.ivec3
var l=i.v2add
var U=i.v3sub
var _=e("../common/globals")
var G=_.CHUNK_SIZE
var F=_.CS2
var W=e("../common/ids").ITEM_GRASS_SPIKY
var c=e("./biome_details")
var u=c.TREE_CHECK_CORNERS
var d=c.pickTreeType
var f=e("./detail_gen_base")
var v=f.DetailGenBase
var H=f.tryDeleteProp
var z=f.tryPlaceProp
var h=e("./proc_gen")
var V=e("./proc_gen_constants").PROP_1x1x1
var p=e("./tiles")
var m=p.TILE_LEAVES2
var Y=p.TILE_PASSABLE_LEAVES
var j=p.TILE_PROP_BASE
var K=Math.max,q=Math.min
var E=10
r.PITFALL_SIZE=E
var g=32
r.PITFALL_MAX_HEIGHT=g
function DetailGenPitfall(e,t,r){v.call(this)
var a=d(t)
var i=n(e)
this.seed=e
this.leaf_type=a.leaves[i.range(a.leaves.length)]
this.is_pitfall=i.range(2)>0
if(this.is_pitfall)this.leaf_type=m
var o=6+i.range(6)
this.spike_x=4+i.range(2)
this.spike_y=4+i.range(2)
this.size_x=this.size_y=E;(t=this.origin=t.slice(0))[2]-=o
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,t[0],t[1],t[2],t[0]+this.size_x-1,t[1]+this.size_y-1,t[2]+g-1)}a(DetailGenPitfall,v)
DetailGenPitfall.prototype.type="DetailGenPitfall"
DetailGenPitfall.prototype.priority=200
var Z=5
var X=4.5
var Q=12.25
var $=20.25
var J=4.5
var ee=12.5
var te=16
var re=s()
DetailGenPitfall.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=this.size_x,s=this.size_y,l=this.origin,_=this.leaf_type,c=this.is_pitfall,u=this.spike_x,d=this.spike_y
var f=r.map
var v=t.pos_world
U(re,v,l)
var h=K(-re[0],0)
var p=q(n-re[0],G)
var m=K(-re[1],0)
var E=q(s-re[1],G)
var g=K(-re[2],0)
for(var T=m;T<E;++T){var y=v[1]+T-l[1]
var S=f[T]
for(var I=h;I<p;++I){var A=v[0]+I-l[0]
var w=S[I].h-v[2]
var L=(A-X)*(A-X)+(y-X)*(y-X)
var O=L<=J
var R=L<=te
var b=R
if(!O&&R)if(a.random()*(te-J)<L-J)b=false
if(b&&w>=0&&w<G)for(var N=w;N<=w;++N){var C=I+T*G+N*F
if(o&&o[C])continue
var x=i[C]
if(!x)continue
if(x>=j)if(!H(t,x,I,T,w))continue
i[C]=c&&O?Y:_}for(var M=q(w,G)-1;M>=g;--M){var D=v[2]+M-l[2]
var P=D<Z
if(L<(P?$:ee)){if(L>(P?Q:J))if(a.random()>.25)continue
var B=I+T*G+M*F
if(o&&o[B])continue
var k=i[B]
if(!k)continue
if(k>=j)if(!H(t,k,I,T,w))continue
if(M<G-1)if(i[B+F]>=j)continue
if(A===u&&y===d&&0===D)if(M>0&&!i[B-F])i[B]=0
else z(t,[I,T,M],{id:W,size:V,rot:a.range(4)})
else i[B]=0}}}}}
var T=o()
function detailGenPitfall(e,t,r){var a=-Infinity
var i=Infinity
var o=false
for(var n=0;n<u.length;++n){l(T,t,u[n])
var s=h.getVerticalSliceMapData(T)
a=K(a,s.h)
i=q(i,s.h)
if(s.h<s.water_level)o=true}if(a-i>2||o)return null
return new DetailGenPitfall(e,t,r)}},{"../common/globals":248,"../common/ids":249,"../glov/client/rand_fast":347,"../glov/common/util":400,"../glov/common/vmath":402,"./biome_details":23,"./detail_gen_base":74,"./proc_gen":162,"./proc_gen_constants":164,"./tiles":199}],23:[function(e,t,a){"use strict"
a.seedWorld=seedWorld
a.pickTreeType=pickTreeType
a.providerSpring=providerSpring
a.providerMegaTree=providerMegaTree
a.providerFloatyRocks=providerFloatyRocks
a.providerCoralCave=providerCoralCave
a.SPRING_3x3=a.MARKER=a.CACTUS2=a.CACTUS1=a.SANDCASTLE=a.ROCK=a.STUMP=a.BOULDER=a.MEGA_TREE=a.SNOW_PINE_FOREST=a.CORAL_CAVE=a.PITFALL=a.FOREST_MEDIUM=a.genPoplarV2=a.genPineV2=a.genWillowV2=a.genOakV2=a.TREE_CHECK_CORNERS=a.TREE_HEIGHT_OFFSET=a.TREE_MAX_HEIGHT=a.TREE_DIM_HALF=a.TREE_DIM=void 0
var r=12
var H=15
var z=r+2*H
var i=(a.TREE_DIM=z)/2
a.TREE_DIM_HALF=i
var O=70
a.TREE_MAX_HEIGHT=O
var V=5
a.TREE_HEIGHT_OFFSET=V
var o=e("../glov/common/vmath").ivec2
var l=[o(4,4),o(4,8),o(8,8),o(8,4),o(6,6)]
a.TREE_CHECK_CORNERS=l
var w=e("assert")
var n=e("./detail_generators.js")
var s=e("../common/globals.js").CHUNK_SIZE
var Y=Math.abs,j=Math.ceil,_=Math.cos,ee=Math.floor,K=Math.max,q=Math.min,Z=Math.PI,X=Math.round,c=Math.sin,Q=Math.sqrt
var te=e("./proc_gen.js")
var u=e("./proc_gen_biomes.js"),d=u.NOISE_DETAIL_IDX,f=u.world_noise,v=u.getVerticalSliceById
var h=e("./detail_gen_base.js").DETAIL_Z0
var p=e("../glov/common/rand_alea.js").mashString
var $=e("../glov/client/rand_fast.js").randSimpleSpatial
var re=e("./rand_seed.js").createFast
var J=e("./saplings_shared.js").saplingPruneForProcgen
var m=e("open-simplex-noise").makeNoise3D
var E=e("./biome_detail_coral_cave.js"),g=E.CORAL_CAVE_MAX_HEIGHT,T=E.CORAL_CAVE_SIZE,y=E.detailGenCoralCave,S=E.genSunkenChestProp
var I=e("./biome_detail_pitfall.js"),A=I.PITFALL_MAX_HEIGHT,L=I.PITFALL_SIZE,R=I.detailGenPitfall
var b=e("./proc_gen_constants.js").SNOW_ELEVATION
var N=e("./tiles.js"),C=N.TILE_COLORED_HUE0,x=N.TILE_SNOW,ae=N.TILE_WOOD,ie=N.TILE_WOOD_LIGHT,oe=N.TILE_WOOD_DARK,M=N.TILE_WOOD_RED,ne=N.TILE_LEAVES1,se=N.TILE_LEAVES2,le=N.TILE_LEAVES3,D=N.TILE_LEAVES4,P=N.TILE_LEAVES5,_e=N.TILE_GRASS,B=N.TILE_SAND,k=N.TILE_STONE,U=N.TILE_STONE_DARK,G=N.TILE_STONE_LIGHT,F=N.TILE_STONE_RED,W=N.TILE_ORE_IN_STONE_LIGHT,ce=N.TILE_ORE_IN_STONE_DARK,ue=N.TILE_ORE_IN_STONE_RED,de=N.TILE_ORE_IN_STONE,fe=N.TILE_AIR,ve=N.TILE_WATER
var he=e("../glov/common/util.js"),pe=he.lerp,me=he.mod,Ee=he.sign
var ge=e("../glov/common/vmath.js"),Te=ge.ivec3,ye=ge.v2add,Se=ge.v2distSq,Ie=ge.v3distSq,Ae=ge.v3set,we=ge.v3sub,Le=ge.unit_vec,Oe=ge.v3add,Re=ge.v3copy,be=ge.v3iAdd,Ne=ge.v2set,Ce=ge.v3iScale,xe=ge.v3floor,Me=ge.vec3,De=ge.zero_vec,Pe=ge.v3addScale
var Be=e("../common/voxel_data_common.js").createUtilVD
var ke=1
var Ue=2
var Ge=3
var Fe=new Array(1)
function seedWorld(e){var t="bd"+e.seed
for(var r=0;r<Fe.length;++r)Fe[r]=m(p(""+t+r))}var We=4
var He=100
var ze=36
var Ve=4*z
var Ye=z/2
var je=120
var Ke=12
var qe=15
var Ze=Ke+2*qe
var Xe=70
var Qe=100
var $e=45
var Je=40
var et=14
var tt=4
var rt=8
var at=[[0,1,ae],[0,2,ae],[1,0,ae],[1,1,ae],[1,2,ae],[1,3,ae],[2,0,ae],[2,1,ae],[2,2,ae],[2,3,ae],[3,1,ae],[3,2,ae]]
var it=[[1,1,ae],[1,2,ae],[2,1,ae],[2,2,ae]]
var ot=[[2,2,ae]]
var nt=[[0,1,-1],[0,2,-1],[1,0,-2],[1,3,2],[2,0,-2],[2,3,2],[3,1,1],[3,2,1]]
var st=[[1,2,-1],[2,1,-2],[2,3,2],[3,2,1]]
var lt=[[-1,1,-1],[-1,2,-1],[1,-1,-2],[2,-1,-2],[1,4,2],[2,4,2],[4,1,1],[4,2,1]]
var _t={wood:ae,leaves:[P,D,ne]}
var ct={wood:ie,leaves:[se,le,ne]}
var ut={wood:oe,leaves:[D,P,le]}
var dt={wood:M,leaves:[D,P,le]}
var ft=[_t,ct,ut,dt]
var vt=[U,k,F,G]
function rotate(e,t,r,a,i){var o=ee(t*_(e)+r[0])
var n=ee(t*c(e)+r[1])
return Ae(i,o,n,r[2]+1+a.range(3))}var ht=function(){var u=Te()
var d=Te()
var f=Te()
return function randomWalkFn(e,t,r,a,i,o){we(u,e,t)
d[0]=Y(u[0]+a.range(2))
d[1]=Y(u[1]+a.range(2))
d[2]=Y(u[2])
var n=d[0]+d[1]+d[2]
r.set(e,o)
var s=n
for(var l=0;l<s;l++){var _=a.range(n)
if(_<d[0]){d[0]--
e[0]+=-1*Ee(u[0])}else if(_<d[0]+d[1]){d[1]--
e[1]+=-1*Ee(u[1])}else{d[2]--
e[2]+=-1*Ee(u[2])}r.set(e,o)
for(var c=1;c<15;c++){Ae(f,e[0],e[1],e[2]-c)
if(r.get(f)!==i)break
r.set(f,0)}n--}}}()
function placeFoot(i,o,e,n,s,l,_,c,u,d,t){var f=(null==s?void 0:s.pos_world)||De
function extendFootRecursive(e,t,r){if(t<r)if(1===l.range(2)){t++
_[Y(o[e][2])-1]+=Ee(o[e][2])
var a=0
if(s){d[0]=f[0]+_[0]
d[1]=f[1]+_[1]
a=te.getVerticalSliceMapData(d).h-(u-1)}if(_[2]>a&&_[2]>=0){n.set(_,i)
_[2]=a}if(_[2]>=0)n.set(_,i)
extendFootRecursive(e,t,r)
return}if(t>0){_[0]=c+o[e][0]
_[1]=c+o[e][1]
_[2]++
r=t-1
if(_[2]>=0)n.set(_,i)
extendFootRecursive(e,0,r)}}for(var r=0;r<o.length;++r){_[0]=c+o[r][0]
_[1]=c+o[r][1]
if(s){ye(d,f,_)
var a=te.getVerticalSliceMapData(d)
_[2]=a.h-u+1}else _[2]=0
l.reseed(t+r)
if(_[2]>=0&&_[2]<n.size[2]&&l.range(5)>1){n.set(_,i)
extendFootRecursive(r,0,e)}}}var pt=function(){var u=Te()
return function placeFootV2fn(o,e,n,s,l,_,t,c){function root(e,t,r){Ae(u,o+e[0],o+e[1],V)
var a=ee(s+_.random())
for(var i=0;i<a;++i){l.set(u,n)
if(c&&i<3&&_.random()<c){u[2]++
l.set(u,n)
u[2]--}if(u[2]>0&&_.random()>.5){u[2]--
l.set(u,n)}if(_.random()>.8)t=Y(t-1)
u[t]+=r}}for(var r=0;r<e.length;++r){var a=e[r]
var i=Y(a[2])-1
_.reseed(t+r)
root(a,i,Ee(a[2]))}}}()
var mt=Te()
var Et=o()
var gt=16
function placeTrunk(e,t,r,a,i,o,n,s){var l=0
var _=0
for(var c=0;c<t.length;++c){l+=t[c][0]
_+=t[c][1]}Ne(Et,ee(l/t.length),ee(_/t.length))
for(var u=a;u<i;++u){mt[2]=u
for(var d=0;d<t.length;++d){if(s&&!o.range(s))continue
mt[0]=e+t[d][0]
mt[1]=e+t[d][1]
n.set(mt,r)}}}var Tt=function(){var I=Te()
var A=Te(z/2,z/2,0)
var w=o()
var L=Te(z,z,O)
return function genOakFn(e,t,r,a){var i=Be(L)
var o=re(e.seed)
var n=r?7:o.range(8)
var s=ee(n/3)
var l=6+n
var _=a.leaves[o.range(a.leaves.length)]
Ae(e.pos_world,e.origin[0]-H,e.origin[1]-H,t)
var c=(z-4)/2
var u=ee(1.8*l)
if(r)u=11+(l=50)
placeTrunk(c,at,oe,0,l,o,i,gt)
placeTrunk(c,it,oe,l,u,o,i,gt)
var d=6+o.range(8)
var f=new Array(d)
A[2]=l
var v=2*Z/d
for(var h=0;h<d;h++)f[h]=rotate(h*v,8+n,A,o,Te())
A[2]=u
var p=4+o.range(4)
var m=new Array(d)
v=2*Z/p
for(var E=0;E<p;E++)m[E]=rotate(E*v,5+s,A,o,Te())
function branching(e,t,r){for(var a=0;a<e;a++){if(r)A[2]=K(l,A[2]-o.range(u-l-2))
ht(t[a],A,i,o,_,oe)}}A[2]=l-4
var g=500
var T=3.5
v=2*Z/g
n-=4
for(var y=l-4;y<u+5;y++){A[2]++
if(A[2]<l)n+=2
else n--
if(y>u)T=K(0,--T)
for(var S=0;S<g;S++){rotate(S*v,8+n,A,o,I)
rotate(S*v,8+n+T*Fe[0](e.origin[0]+.25*I[0],e.origin[1]+.25*I[1],t+.25*I[2]),A,o,I)
if(I[2]<u+8)i.set(I,_)}}A[2]=l
branching(d,f,false)
A[2]=u
branching(p,m,true)
placeFoot(oe,lt,2,i,e,o,I,c,t,w)
return i}}()
var yt=function(){var B=Te()
var k=Me()
var U=Te(z/2,z/2,0)
var G=[D,P,le]
var F=Te(z,z,O)
var W=re()
return function genOakV2Fn(e,t,r,a){var i=e?e.seed:a
W.reseed(i)
var o=W.uint32()
var n=W.range(8)
var s=ee(n/3)
var l=6+n
l=K(1,ee(r*l))+V
var _=K(l+1,ee(l+3*r+(l-V)*W.random()*2))
var c=X(5*r)
var u=Be(F)
var d=G[W.range(3)]
for(var f=0;f<3;++f)k[f]=256*W.random()
if(e)Ae(e.pos_world,e.origin[0]-H,e.origin[1]-H,t)
var v=(z-4)/2
var h=at
var p=lt
if(r<.25){h=ot
p=st}else if(r<.45){h=it
p=nt}placeTrunk(v,h,oe,V,l,W,u,gt)
var m=6+W.range(8)
var E=new Array(m)
U[2]=l
var g=ee((8+n)*r)
var T=2*Z/m
for(var y=0;y<m;y++)E[y]=rotate(y*T,g,U,W,Te())
U[2]=_
var S=4+W.range(4)
var I=new Array(m)
T=2*Z/S
for(var A=0;A<S;A++)I[A]=rotate(A*T,ee((5+s)*r),U,W,Te())
function branching(e,t,r){var a=0
for(var i=0;i<e;i++){if(r){U[2]=l+W.range(_-l)
t[i][2]=U[2]+W.range(_-U[2])
a=K(a,U[2])}ht(t[i],U,u,W,d,oe)}return a}var w=ee(500*r)
var L=3.5
T=2*Z/w
var O=8+n
var R=_+c
var b=R-l
var N=K(l-4,V+1)+1
var C=(O+(l-N+1))/b
for(var x=N;x<=R;x++){if((U[2]=x)<l)O+=1
else{if(x!==N)O-=C
if(O*r<.75)break}for(var M=0;M<w;M++){var D=M*T
rotate(D,(O+L*Fe[0](k[0]+.25*x,k[1]+5*D,k[2]+W.random()))*r,U,W,B)
if(B[0]<0||B[1]<0||B[0]>=z||B[1]>=z)continue
B[2]--
if(!u.get(B))u.set(B,d)}}U[2]=l
branching(m,E,false)
U[2]=_
var P=K(_,branching(S,I,true))
placeTrunk(v,it,oe,l,P,W,u,gt)
pt(v,p,oe,6*r,u,W,o,.5)
J(u)
return u}}()
a.genOakV2=yt
var St=function(){var m=o()
var E=Te()
var g=Te()
var T=Te(z/2,z/2,0)
var y=Te(z,z,O)
return function genWillowFn(_,c,e){var u=Be(y)
var d=re(_.seed)
var t=d.range(12)
var f=12+t
var v=ee(t/3)
Ae(_.pos_world,_.origin[0]-H,_.origin[1]-H,c)
var r=(z-4)/2
placeTrunk(r,it,ie,0,f/2,d,u,gt)
var h=e.leaves[d.range(e.leaves.length)]
function placeDropDown(e,t,r){var a=3+d.range(7+v)
for(var i=0;i<a;i++){Ae(E,e,t,r-i)
u.set(E,h)}}function placeCrown(e,t,r){var a=(.12+.06*d.range(8+v))*Ye
for(var i=0;i<z;++i)for(var o=0;o<z;++o)for(var n=f-8;n<f+25;++n){var s=Q(Ie([i,o,n],[T[0]+e,T[1]+t,T[2]+r]))/a
Ae(E,i,o,n-ee(a/2))
var l=.1*Fe[0](_.origin[0]+.25*E[0],_.origin[1]+.25*E[1],c+.25*E[2])
if(s<1+l&&s>.75-Y(l)&&T[2]+r+ee(a/2)<n){u.set(E,h)
if(T[2]+r+ee(a/2)===n-1&&1===d.range(5))placeDropDown(i,o,n-ee(a/2))}}}var a=3+d.range(v)
var i=new Array(a)
T[2]=f
for(var o=0;o<a;o++){g[0]=-7+d.range(14+v)
g[1]=-7+d.range(14+v)
g[2]=-4+d.range(6+v)
i[o]=Oe(Te(),g,T)
placeCrown(g[0],g[1],g[2])}T[2]=f/2
for(var n=0;n<a;n++){i[n][2]--
for(var s=0;s<5;s++)if(u.get(i[n])!==h){i[n][2]++
continue}else{i[n][2]--
break}ht(i[n],T,u,d,h,ie)}for(var l=0;l<nt.length;++l){E[0]=r+nt[l][0]
E[1]=r+nt[l][1]
ye(m,_.pos_world,E)
var p=te.getVerticalSliceMapData(m)
E[2]=p.h-c
if(E[2]>=0&&E[2]<u.size[2])u.set(E,_e)}placeFoot(ie,nt,0,u,_,d,E,r,c,m)
return u}}()
var It=function(){var C=Te()
var x=Te()
var M=[se,le,ne]
var D=Me()
var P=Te()
var B=re()
var k=re()
var U=Me()
var G=Me()
var F=Me()
var W=z/2
return function genWillowV2Fn(e,t,n,r){var a=e?e.seed:r
B.reseed(a)
var g=M[B.range(3)]
var i=B.uint32()
var o=B.uint32()
var s=B.uint32()
var T=B.uint32()
var l=B.uint32()
var _=25
var c=B.range(12)
for(var u=0;u<3;++u)U[u]=256*B.random()
var d=12+c
var f=(d=ee(d*n))+V
var y=f+_
var S=Be(Te(z,z,y))
var v=c/3
var h=ee(v)
var p=ee(c/3*n)
var m=3+B.range(h)
if(e)Ae(e.pos_world,e.origin[0]-H,e.origin[1]-H,t)
var E=ee(d/3)
var I=(z-4)/2
B.reseed(i)
placeTrunk(I,it,ie,V,V+E,B,S,gt)
function placeDropDown(e,t,r){var a=$(l,e,t,0)*(7+p)
var i=ee((3+a)*n)
for(var o=0;o<i;o++){Ae(C,e,t,r-o)
S.set(C,g)}}function placeCrown(e,t,r,a){var i=ee(e/2)
var o=1.1*e
var n=K(0,ee(t-o))
var s=q(z,j(t+o))
var l=K(0,ee(r-o))
var _=q(z,j(r+o))
var c=a+1
var u=q(y,j(a+o-i))
var d=false
var f=c
Ae(F,t,r,a-i)
for(var v=n;v<s;++v){C[0]=v
for(var h=l;h<_;++h){C[1]=h
for(var p=c;p<u;++p){C[2]=p
var m=Q(Ie(C,F))/e
Pe(G,U,C,.25)
var E=.1*Fe[0](G[0],G[1],G[2])
if(m<1+E&&m>.75-Y(E)){S.set(C,g)
if(v===t&&h===r)d=true
f=K(f,p)
if(p===c&&$(T,v,h,0)<.2)placeDropDown(v,h,p)}}}}if(!d){Ae(C,t,r,f)
S.set(C,g)}}var A=new Array(m)
k.reseed(s)
Ae(x,z/2,z/2,f)
var w=4+.5*v
for(var L=0;L<m;L++){var O=1+(1+k.random()*w)/7*(W-1)
D[0]=k.random()*(14+p)-7
D[1]=k.random()*(14+p)-7
D[2]=k.random()*(6+p)-4
Ce(D,n)
xe(P,D)
A[L]=Te(P[0]+x[0],P[1]+x[1],P[2]+x[2])
O=q(O,A[L][0]+3,A[L][1]+3)
O=q(O,z-1-A[L][0]+3,z-1-A[L][1]+3)
A[L][2]=K(A[L][2],V+2)
placeCrown(O*n,A[L][0],A[L][1],A[L][2])}for(var R=0;R<m;R++){A[R][2]--
for(var b=0;b<5;b++)if(S.get(A[R])!==g){A[R][2]++
continue}else{A[R][2]--
break}}x[2]=V+E
for(var N=0;N<m;N++){B.reseed(a+20+N)
if(0===E)x[0]=x[1]=I+2
else{x[0]=I+1+B.range(2)
x[1]=I+1+B.range(2)}ht(A[N],x,S,B,g,ie)}pt(I,0===E?st:nt,ie,4*n,S,B,o,.1)
J(S)
return S}}()
a.genWillowV2=It
var At=function(){var p=Te()
var m=Te(z/2,z/2,0)
var E=o()
var g=Te()
var T=Te(z,z,O)
return function genPineFn(r,a,e,t){var l=Be(T)
var _=re(r.seed)
var i=_.range(12)
var o=9+i
Ae(r.pos_world,r.origin[0]-H,r.origin[1]-H,a)
var c=e?x:t.leaves[_.range(t.leaves.length)]
function checkHeight(e){ye(E,r.pos_world,e)
var t=te.getVerticalSliceMapData(E)
if(e[2]<=t.h-a)return false
return true}function branch(e,t,r){Ae(p,m[0],m[1],r)
if(e<=1){p[Y(t)-1]+=Ee(t)
l.set(p,c)
return}var a=0
for(var i=0;i<e;i++){if(i%3===1&&_.range(10)>1){if(i>e-2){p[Y(t)-1]+=Ee(t)
l.set(p,c)
p[Y(t)-1]-=Ee(t)}p[2]--
p[Y(t)-1]+=2*Ee(t)
l.set(p,c)
p[Y(t)-1]-=2*Ee(t)
Ae(g,p[0],p[1],p[2])
g[1-(Y(t)-1)]--
for(var o=0;o<3;o++){l.set(g,c)
g[1-(Y(t)-1)]++}l.set(p,c)}Ae(g,p[0],p[1],p[2])
if(i<ee(e/2))a=2*i
else a=2+e-i
a=K(1,a-_.range(3))
if(i>e-1)a=1
g[Y(t)-1]+=Ee(t)
if(1!==a)g[1-(Y(t)-1)]-=ee(a/2)
for(var n=0;n<a;n++){if(!checkHeight(g))return
l.set(g,c)
g[1-(Y(t)-1)]++}p[Y(t)-1]+=Ee(t)
if(e-2>=i){l.set(p,c)
Ae(g,p[0],p[1],p[2]+1)
l.set(g,c)
a-=2
a-=_.range(3)
g[1-(Y(t)-1)]-=ee(a/2)
for(var s=0;s<a;s++){l.set(g,c)
g[1-(Y(t)-1)]++}}}}var n=(z-4)/2
placeTrunk(n,it,M,0,o,_,l,gt)
m[2]=ee(2*o)
Ae(p,m[0],m[1],m[2])
var s=_.range(8)
for(var u=o;u<2*o;u++){Ae(p,m[0],m[1],u)
if(u>2*o-s){l.set(p,c)
continue}l.set(p,M)}for(var d=3+_.range(i/2);d<ee(1.8*o);d+=2){branch(K(1,o/2-d/2.5+4+(-2+_.range(5))),1,2+d)
d+=_.range(4)}for(var f=3+_.range(i/2);f<ee(1.8*o);f+=2){branch(K(1,o/2-f/2.5+4+(-2+_.range(5))),-1,2+f)
f+=_.range(4)}for(var v=3+_.range(i/2);v<ee(1.8*o);v+=2){branch(K(1,o/2-v/2.5+4+(-2+_.range(5))),-2,2+v)
v+=_.range(4)}for(var h=3+_.range(i/2);h<ee(1.8*o);h+=2){branch(K(1,o/2-h/2.5+4+(-2+_.range(5))),2,2+h)
h+=_.range(4)}Ae(p,m[0],m[1],m[2])
placeFoot(M,nt,1,l,r,_,p,n,a,E)
return l}}()
var wt=function(){var T=Te()
var y=Te(z/2,z/2,0)
var S=o()
var I=[D,P,le]
var A=re()
return function genPineV2Fn(r,a,e,t,i){var o=r?r.seed:t
A.reseed(o)
var n=A.uint32()
var s=A.range(12)
var l=9+s
l=1+ee(e*l)+V
var c=Be(Te(z,z,O+V))
if(r)Ae(r.pos_world,r.origin[0]-H,r.origin[1]-H,a)
var u=i?x:I[A.range(3)]
function checkHeight(e){if(!r)return true
ye(S,r.pos_world,e)
var t=te.getVerticalSliceMapData(S)
if(e[2]<=t.h-a)return false
return true}function branch(e,t,r){var a=Te()
Ae(T,y[0],y[1],r)
if(e<=1){T[Y(t)-1]+=Ee(t)
if(!c.get(T))c.set(T,u)
return}var i=0
for(var o=0;o<e;o++){if(o%3===1&&A.range(10)>1){if(o>e-2){T[Y(t)-1]+=Ee(t)
if(!c.get(T))c.set(T,u)
T[Y(t)-1]-=Ee(t)}T[2]--
T[Y(t)-1]+=2*Ee(t)
if(!c.get(T))c.set(T,u)
T[Y(t)-1]-=2*Ee(t)
Ae(a,T[0],T[1],T[2])
a[1-(Y(t)-1)]--
for(var n=0;n<3;n++){if(!c.get(T))c.set(a,u)
a[1-(Y(t)-1)]++}if(!c.get(T))c.set(T,u)}Re(a,T)
if(o<ee(e/2))i=2*o
else i=2+e-o
i=K(1,i-A.range(3))
if(o>e-1)i=1
a[Y(t)-1]+=Ee(t)
if(1!==i)a[1-(Y(t)-1)]-=ee(i/2)
for(var s=0;s<i;s++){if(!checkHeight(a))return
if(!c.get(a))c.set(a,u)
a[1-(Y(t)-1)]++}T[Y(t)-1]+=Ee(t)
var l=A.range(3)
if(e-2>=o){if(!c.get(T))c.set(T,u)
Ae(a,T[0],T[1],T[2]+1)
if(!c.get(a))c.set(a,u)
i-=2
i-=l
a[1-(Y(t)-1)]-=ee(i/2)
for(var _=0;_<i;_++){if(!c.get(a))c.set(a,u)
a[1-(Y(t)-1)]++}}}}var _=(z-4)/2
placeTrunk(_,it,M,V,l,A,c,gt)
y[2]=ee(2*l)-V
Ae(T,y[0],y[1],y[2])
var d=X(A.range(8)*e)
for(var f=l;f<y[2];f++){Ae(T,y[0],y[1],f)
if(f>2*l-d){c.set(T,u)
continue}c.set(T,M)}var v=4*e
for(var h=-2;h<3;h++){A.reseed(o+h)
var p=V+1+ee(e*(3+A.range(s/2)))
var m=ee(1.8*l)-V
for(var E=p;E<m;E+=2){var g=(-2+A.range(5))*e
branch(K(1,v+(l/2-E/2.5)+g),h,2+E)
E+=A.range(4)}}pt(_,nt,M,3*e,c,A,n,0)
J(c)
return c}}()
a.genPineV2=wt
var Lt=function(){var v=Te()
var h=o()
var p=Te(z/2,z/2,0)
var m=Te(z,z,O)
return function genPoplarFn(e,t,r){var a=Be(m)
var i=re(e.seed)
var o=30+i.range(12)
Ae(e.pos_world,e.origin[0]-H,e.origin[1]-H,t)
var n=r.leaves[i.range(r.leaves.length)]
var s=.4*(2+i.range(3))*Ye
p[2]=o
for(var l=0;l<z;++l)for(var _=0;_<z;++_)for(var c=o-25;c<o+15;++c){var u=K(o-25+3,q(c,o+5-5))
var d=Q(Ie([l,_,c],[p[0],p[1],u])/s)
if(d<1)if(i.range(7)*d<2){Ae(v,l,_,c)
a.set(v,n)}}var f=(z-4)/2
placeTrunk(f,it,ae,0,o,i,a,gt)
placeFoot(ae,nt,1,a,e,i,v,f,t,h)
return a}}()
var Ot=function(){var w=Te()
var L=Me()
var O=[P,D,ne]
var R=re()
var e=.29
var b=e*e
var t=5
var N=ee(z/2-.5-t)
var C=j(z/2-.5+t)
return function genPoplarV2Fn(e,t,r,a){var i=e?e.seed:a
R.reseed(i)
var o=R.uint32()
var n=R.uint32()
var s=30+R.range(12)
var l=K(1,ee(r*s))+V
var _=K(1,s-25)
var c=V+ee(pe(r,1,_))
var u=r<.5?1:2
var d=15
var f=Be(Te(z,z,l+d))
if(2===u)Ae(L,z/2-.5,z/2-.5,0)
else Ae(L,z/2,z/2,0)
if(e)Ae(e.pos_world,e.origin[0]-H,e.origin[1]-H,t)
var v=O[R.range(3)]
var h=K((3+3*R.random())*r,2)
var p=h*h
var m=1/p
for(var E=c;E<l+d;++E){var g=K(c+3*r,q(E,l))
w[2]=E
for(var T=N;T<=C;++T){w[1]=T
for(var y=N;y<=C;++y){w[0]=y
var S=R.random()
L[2]=g
var I=Ie(w,L)
if(I<=p)if(S*S*I*m<b)f.set(w,v)}}}var A=(z-4)/2
R.reseed(n)
placeTrunk(A,2===u?it:ot,ae,V,l,R,f,2===u?gt:0)
pt(A,2===u?nt:st,ae,3*r,f,R,o,0)
J(f)
return f}}()
a.genPoplarV2=Ot
function sampleNoise(e,t,r,a){return f[e].noise2D(r*t,a*t)}function spikyRockNoise(e,t){var r
var a
r=sampleNoise(1,.05,e,t)
a=sampleNoise(2,.05,e,t)
return sampleNoise(2,.05,e+=r,t+=a)}var Rt=Te()
function dropLiana(e,t,r,a,i){Re(Rt,e)
var o=2+a.range(t)
for(var n=0;n<o;++n){Rt[2]--
if(Rt[2]<0||i.get(Rt))return
i.set(Rt,r)}}var bt=function(){var y=Te()
var S=Te()
var I=Te(Ze/2,Ze/2,0)
var A=[P,D,ne,se,le]
var w=Te(Ze,Ze,Xe)
return function genFloatyRockFn(e){var u=Be(w)
var d=re(e.seed)
var t=e.provider_data.height
var r=d.uint32()
var f=A[d.range(5)]
var a=te.getVerticalSliceMapData(e.origin).h
Ae(e.pos_world,e.origin[0],e.origin[1],a)
var i=vt[ee(r/3)%vt.length]
var o=_e
if(a>=b)f=o=x
function smallTree(e){var t=3+d.range(3)
var r=5
var a=3+d.range(3)
if(e[0]-t<0||e[1]-t<0||e[2]-1<0||e[0]+t>Ze||e[1]+t>Ze||e[2]+r+a>Xe)return
Re(S,e)
S[2]++
var i=3
var o=d.range(2)
for(var n=-ee(t/2);n<ee(t/2)+1;++n){S[o]=e[o]+n
if(u.get(S)){u.set(S,ae)
S[2]++}else{u.set(S,ae)
S[2]--
if(u.get(S))S[2]++}if(1===d.range(i)){i++
u.set(S,ae)
S[Y(o-1)]+=1===d.range(2)?-1:1}u.set(S,ae)}Re(S,e)
for(var s=0;s<a;++s){S[2]++
if(1===d.range(3)){u.set(S,ae)
S[d.range(2)]+=1===d.range(2)?-1:1}u.set(S,ae)}if(S[0]-t<0||S[1]-t<0||S[2]-1<0||S[0]+t>Ze||S[1]+t>Ze)return
for(var l=-t;l<t+1;++l)for(var _=-t;_<t+1;++_)for(var c=0;c<r;++c)if(.5*(l*l+_*_)<t-c+d.range(2)){Ae(S,e[0]+l,e[1]+_,e[2]+c+a)
u.set(S,f)
if(0===c&&1===d.range(10))dropLiana(S,2,f,d,u)}}var n=e.provider_data.radius
I[2]=t
for(var s=0;s<Ze;++s)for(var l=0;l<Ze;++l)for(var _=0;_<Xe;++_){Ae(S,s,l,_)
var c=Q(Se(S,I)/n)
var v=Xe-_
if(Y(spikyRockNoise(s+e.origin[0],l+e.origin[1]))*(3+c*c*-1)/2>v/35&&c<2+d.range(2)&&5*Y(sampleNoise(2,.02,s+e.origin[0],l+e.origin[1]))<v){Ae(y,s,l,_-t)
if(_-t>0)u.set(y,i)}}for(var h=0;h<z;h++)for(var p=0;p<z;p++)for(var m=Xe;m>0;m--){Ae(y,h,p,m)
if(u.get(y)===i){Ae(y,h,p,m)
u.set(y,o)
if(1===d.range(80))smallTree(y)
break}}for(var E=0;E<Ze;E++)for(var g=0;g<Ze;g++)for(var T=0;T<Xe;T++){Ae(y,E,g,T)
if(u.get(y)===i){if(1===d.range(20))dropLiana(y,15,f,d,u)
break}}return u}}()
var Nt=function(){var p=Te()
var m=Te()
var E=Te()
var g=Te()
var T=Te()
var y=Te()
var S=[P,D,ne,se,le]
var I=[]
return function genLianafn(e){var t=re(e.seed)
var r=S[t.range(5)]
Re(m,e.provider_data.start_pos)
Re(E,e.provider_data.end_pos)
var a=te.getVerticalSliceMapData(m).h
var i=te.getVerticalSliceMapData(E).h
m[2]=Xe+a-m[2]
E[2]=Xe+i-E[2]
if(a>=b||i>=b)r=x
if(Y(m[0])-Y(E[0])>40||Y(m[1])-Y(E[1])>40||Y(m[2])-Y(E[2])>40){Ae(g,0,0,0)
return Be(g)}Ae(e.pos_world,Ze/2+q(m[0],E[0]),Ze/2+q(m[1],E[1]),q(m[2]-6,E[2])-6)
we(g,m,E)
Ae(y,Ee(g[0]),Ee(g[1]),Ee(g[2]))
g[0]=Y(g[0])
g[1]=Y(g[1])
g[2]=Y(g[2])
var o=3
Ae(T,g[0]+1,g[1]+1,g[2]+1+o)
var n=Be(T)
var s=y[2]>0?0:g[2]
var l
var _=g[0]+g[1]+g[2]
if(0===_)return n
var c=_/g[0]
var u=_/g[1]
var d=_/g[2]
I=[]
for(var f=0;f<_;++f){l=s/g[2]*2
var v=false
if(f%c<1){I.push(0)
v=true}if(f%u<1){I.push(1)
v=true}if(f%d*(2-l)<1){I.push(2)
s+=y[2]
v=true}if(!v)_++}Ae(p,y[0]>0?0:g[0],y[1]>0?0:g[1],y[2]>0?o:g[2]+o)
n.set(p,r)
for(var h=0;h<I.length;++h){p[I[h]]+=y[I[h]]
if(p[0]<0||p[0]>g[0]||p[1]<0||p[1]>g[1]||p[2]<0||p[2]>g[2]+o){p[I[h]]-=y[I[h]]
continue}if(1===t.range(25))dropLiana(p,5,r,t,n)
n.set(p,r)}return n}}()
var Ct=30
var xt=function(){var h=Te()
var p=o()
var m=Te(et,et,Ct)
return function genStumpFn(e,t,r){var a=Be(m)
var i=re(e.seed)
var o=3+i.range(3)
var n
var s
var l=r.wood
var _
var c=[]
if(i.range(100)<1)o+=i.range(15)
if(r===_t){n=it
s=nt
_=1}else if(r===dt){n=it
s=nt
_=1}else if(r===ct){n=it
s=nt
_=1}else{n=at
s=lt
_=2}Ae(e.pos_world,e.origin[0],e.origin[1],t)
var u=(et-4)/2
for(var d=0;d<n.length;++d)c[d]=o+i.range(3)
for(var f=0;f<o+3;++f){h[2]=f
for(var v=0;v<n.length;++v){h[0]=u+n[v][0]
h[1]=u+n[v][1]
if(c[v]<f)continue
a.set(h,l)}}placeFoot(l,s,_,a,e,i,h,u,t,p)
return a}}()
var Mt=function(){var f=Te()
var v=Te()
var h=Te()
var p=Te()
var m=[ne,se,le,D,P]
var E=Te(Ve,Ve,je)
return function genMegaMapleFn(l,_){var u=re(l.seed)
var d=Be(E)
var c=m[u.range(5)]
Ae(l.pos_world,l.origin[0]-ze,l.origin[1]-ze,_-10)
Ae(f,Ve/2,Ve/2,10)
function randomBranch(e,t){we(h,e,t)
p[0]=Y(h[0]+u.range(2))
p[1]=Y(h[1]+u.range(2))
p[2]=Y(h[2])
var r=p[0]+p[1]+p[2]
var a=r
for(var i=0;i<a;i++){var o=u.range(r)
if(o<p[0]){p[0]--
e[0]+=-1*Ee(h[0])}else if(o<p[0]+p[1]){p[1]--
e[1]+=-1*Ee(h[1])}else if(o<r){p[2]--
e[2]+=-1*Ee(h[2])}r--
var n=5
for(var s=e[0]-n;s<e[0]+n;s++)for(var l=e[1]-n;l<e[1]+n;l++)for(var _=e[2]-n;_<e[2]+n;_++){Ae(v,s,l,_)
var c=Q(Ie([s,l,_],e))
if(v[2]>=0&&c<3-q(2,r/20))d.set(v,ae)}}}function placeCrown(e){var t=15+u.range(15)
e[2]-=t-3
for(var r=e[0]-t;r<e[0]+t;++r)for(var a=e[1]-t;a<e[1]+t;++a)for(var i=e[2]-t;i<e[2]+t;++i){var o=Q(Ie([r,a,i],[e[0],e[1],e[2]]))
Ae(v,r,a,i)
var n=2*Fe[0](l.origin[0]+.2*v[0],l.origin[1]+.2*v[1],_+.2*v[2])
var s=4*Fe[0](l.origin[0]+.04*v[0],l.origin[1]+.04*v[1],_+.04*v[2])
if(o<t-n&&o>t-(n+3)&&o>.75-Y(n)&&e[2]+t/1.5+s<i)if(v[2]>=0&&v[2]<je&&v[0]>=0&&v[0]<Ve&&v[1]>=0&&v[1]<Ve)d.set(v,c)}e[2]+=t}function branch(e,t,r,a){var i=r+u.range(5)
var o=new Array(i)
var n=u.range(60)
var s=2*Z/(i+n)
for(var l=0;l<i;l++){o[l]=rotate(u.range(n)*s,e,v,u,Te())
be(o[l],[0,0,t-10])
if(a)placeCrown(o[l])
Re(v,f)
randomBranch(o[l],v,a)}}var e=0
var t=0
for(var r=0;r<70;r++){switch(r){case 10:Re(v,f)
branch(30,-(15+u.range(5)),10,false)
break
case 30:Re(v,f)
branch(35,u.range(20),1,true)
break
case 35:Re(v,f)
branch(25,u.range(20),1,true)
break
case 40:Re(v,f)
branch(20,u.range(20),1,true)
break
case 55:Re(v,f)
branch(15,u.range(20),1,true)
break
case 65:Re(v,f)
branch(10,u.range(20),1,true)}var a=Fe[0](l.origin[0]+.1*f[0],l.origin[1]+.1*f[1],_+.1*f[2])
if(a>.15)f[0]++
else if(a<-.15)f[0]--
var i=Fe[0](l.origin[0]+.1*(f[0]+10),l.origin[1]+.1*(f[1]+10),_+.1*(f[2]+10))
if(i>.15)f[1]++
else if(i<-.15)f[1]--
if(Fe[0](l.origin[0]+.1*(f[0]+20),l.origin[1]+.1*(f[1]+20),_+.1*(f[2]+20))>-.8)f[2]++
if(10===++e){if(t>=f[2])f[2]++
t=f[2]
e=0}for(var o=f[0]-7;o<f[0]+7;o++)for(var n=f[1]-7;n<f[1]+7;n++)for(var s=f[2];s<f[2]+7;s++){Ae(v,o,n,s)
if(Q(Ie([o,n,s],f))<7-q(7,r/14))d.set(v,ae)}}placeCrown(f)
return d}}()
var Dt=[]
Dt[G]=W
Dt[k]=de
Dt[U]=ce
Dt[F]=ue
var Pt=function(){var X=Te()
var Q=Te()
var $=o()
var J=[le,D,P]
return function genBoulderfn(_,c){var u=re(_.seed)
var e=u.uint32()
var d=J[e%3]
var f=vt[ee(e/3)%vt.length]
var o=1
var n=new Array(u.range(10)+25)
for(var t=0;t<n.length;t++){n[t]=Te()
Ae(n[t],u.range(Je),u.range(Je),u.range($e))}Ae(n[0],Je/2,Je/2,10)
var s=[]
s.push(0)
var r=[]
var l=[]
for(var a=0;a<Je;a++)for(var i=0;i<Je;i++)for(var v=$e;v>0;v--){var h=Infinity
var p=Infinity
Ae(X,a,i,v)
for(var m=0;m<n.length;m++){var E=Ie(n[m],X)
if(h>E){p=m
h=E}}if(0===a||0===i||0===v||a===Je-1||i===Je-1||i===$e-1){if(void 0===l[p])l[p]=1
l[p]++}r.push(p)}function addRandomCell(){var e=u.range(o)
var t=Infinity
var r=Infinity
for(var a=0;a<n.length;a++){if(-1!==s.indexOf(a))continue
if(l[a]>225)continue
var i=Ie(n[a],n[s[e]])
if(t>i){r=a
t=i}}o++
s.push(r)}var g=u.range(5)
for(var T=0;T<g;T++)addRandomCell()
var y=-Infinity
var S=-Infinity
var I=-Infinity
var A=Infinity
var w=Infinity
var L=Infinity
var O=0
for(var R=0;R<Je;R++)for(var b=0;b<Je;b++)for(var N=$e;N>0;N--){if(-1!==s.indexOf(r[O])){if(R<A)A=R
if(R>y)y=R
if(b<w)w=b
if(b>S)S=b
if(N<L)L=N
if(N>I)I=N}O++}var C=y-A
var x=S-w
var M=I-L
var D=Be(Te(C+1,x+1,M+20))
function destroyUpwards(e){for(var t=0;t<e;t++){if(X[2]===$e-1)return
D.set(X,0)
X[2]++}}Ae(_.pos_world,_.origin[0]+A,_.origin[1]+w,c+L-5)
for(var P=O=0;P<Je;P++)for(var B=0;B<Je;B++)for(var k=$e;k>0;k--){if(-1!==s.indexOf(r[O])){Ae(X,P-A,B-w,k-L)
var U=false
Ne($,_.pos_world[0]+X[0],_.pos_world[1]+X[1])
var G=te.getVerticalSliceMapData($)
if(_.pos_world[2]+X[2]-1<G.water_level)U=true
if((0===P||0===B||P===Je-1||B===Je-1)&&u.range(20)<1)destroyUpwards(20)
else if(!U){D.set(X,f)
var F=Ie(X,n[0])
if(u.range(F)<1)D.set(X,Dt[f])}else{D.set(X,0)
X[2]++
D.set(X,0)
X[2]++
D.set(X,0)
X[2]++
if(u.range(3)>0)destroyUpwards(u.range(4))}}O++}function smallPine(e){var t=u.range(10)
var r=5+t
var a=3+u.range(3)
var i=1+u.range(t/2)
if(e[0]<=i||e[0]>=C-i||e[1]<=i||e[1]>=x-i)return
e[2]++
D.set(e,ae)
for(var o=0;o<r;o++){e[2]++
for(var n=e[0]-10;n<e[0]+10;n++)for(var s=e[1]-10;s<e[1]+10;s++){Ae(Q,n,s,e[2])
var l=2*Fe[0](_.origin[0]+4*Q[0],_.origin[1]+4*Q[1],c+4*Q[2])
if(Ie(e,Q)+l<i*(1-o/r)*(a-o%a))if(D.get(Q)!==f)D.set(Q,d)}if(D.get(e)!==f)D.set(e,ae)}e[2]++
D.set(e,d)}var W=5+u.range(20)
var H=600
function checkNeighbours(){--X[0]
if(D.get(X))return false
X[0]+=2
if(D.get(X))return false;--X[0];--X[1]
if(D.get(X))return false
X[1]+=2
if(D.get(X))return false;--X[1]
D.set(X,0)
return true}function checkKernel(e){if(D.data[e+1]&&D.data[e-1]&&D.data[e-C]&&D.data[e+C]&&D.data[e-C*x]&&D.data[e-C*x])return
D.data[e]=0}var z=C*x*M
var V=.04*z+u.range(.04*z)
for(var Y=0;Y<V;Y++)checkKernel(u.range(z))
for(var j=0;j<C+1;j++)for(var K=0;K<x+1;K++)for(var q=M;q>0;q--){Ae(X,j,K,q)
if(D.get(X)===f){Ne($,_.pos_world[0]+X[0],_.pos_world[1]+X[1])
var Z=te.getVerticalSliceMapData($)
if(checkNeighbours())continue
Ae(X,j,K,q)
if(u.range(W)>1&&X[2]+_.pos_world[2]>Z.h){D.set(X,_e)
if(u.range(H)<1)smallPine(X)}break}}return D}}()
var Bt=6
var kt=function(){var g=tt
var T=tt
var y=g*T
var S=[0,g-1,y-1,y-g]
var I=[1,g,-1,-g]
var A=[g,-1,-g,1]
return function genRockFn(e,t){var r=re(e.seed)
var a=3+r.range(4)
w(a<=Bt)
var i=Be(Te(g,T,a))
var o=i.data
for(var n=0;n<y;++n)o[n]=k
for(var s=1;s<a;++s){var l=s*y
for(var _=0;_<y;++_)o[l+_]=o[l+_-y]
if(s===T/2)for(var c=0;c<4;++c)if(o[l+S[c]])o[l+S[c]]=0
var u=r.range(4)
var d=l+S[u]
var f=I[u]
var v=A[u]
var h=1&u?T:g
var p=1&u?g:T
if(o[d]&&o[d+f*(h-1)])o[d]=o[d+f*(h-1)]=0
else for(var m=0;m<h;++m)for(var E=0;E<p;++E)if(o[d+m*f+E*v]){o[d+m*f+E*v]=0
break}}Ae(e.pos_world,e.origin[0]+4,e.origin[1]+4,t)
return i}}()
var Ut=function(){var E=Me()
return function genSandCastleFn(e,t){var r=Me()
var a=re(e.seed)
var i=6+a.range(4)
var o=5+a.range(3)
var n=Be(Me(o,o,i+3))
for(var s=0;s<o;++s)for(var l=0;l<o;++l)for(var _=0;_<i;++_){Ae(r,s,l,_)
if(0===s||0===l||s===o-1||l===o-1){if(_===i-1&&(s+l)%2===1||_===ee(i/2)&&(s===o/2||l===o/2))continue
n.set(r,B)}}var c=a.range(3)
for(var u=i-1;u<i+c;++u){Ae(r,0,0,u)
n.set(r,B)
Ae(r,0,o-1,u)
n.set(r,B)
Ae(r,o-1,o-1,u)
n.set(r,B)
Ae(r,o-1,0,u)
n.set(r,B)}Ae(r,ee(o/2),ee(o/2),0)
Oe(r,e.origin,r)
var d=Infinity
var f=te.getVerticalSliceMapData(r)
d=q(f.h,d)
r[0]+=1
f=te.getVerticalSliceMapData(r)
d=q(f.h,d)
r[1]+=1
f=te.getVerticalSliceMapData(r)
d=q(f.h,d);--r[0]
f=te.getVerticalSliceMapData(r)
d=q(f.h,d)
Ae(r,ee(o/2),ee(o/2),Y(d+1-t))
Ae(e.pos_world,e.origin[0],e.origin[1],q(d+1,t))
if(me(r[0]+e.origin[0],16)<15&&me(r[1]+e.origin[1],16)<15){var v=S(a)
v.prop_underwater=true
v.pos=r.slice(0)
Re(E,r)
n.alloc(true)
for(var h=0;h<2;h++){for(var p=0;p<2;p++){for(var m=0;m<2;m++){n.set(E,fe,false)
n.set(E,ve,true)
E[2]++}E[1]++
E[2]-=2}E[0]++
E[1]-=2}if(!n.props)n.props=[]
n.props.push(v)}return n}}()
function pickTreeType(e){var t=0
var r=-1
for(var a=0;a<ft.length;++a){var i=f[d].noise2D(100*a+.001*e[0],.001*e[1])
if(i>r){r=i
t=a}}return ft[t]}var Gt=[o(1,1),o(1,16),o(16,16),o(16,1),o(8,8),o(0,8),o(8,0)]
var Ft=o()
function genForestMedium(e){var t=-Infinity
var r=Infinity
var a=false
for(var i=0;i<l.length;++i){ye(Ft,e.origin,l[i])
var o=te.getVerticalSliceMapData(Ft)
t=K(t,o.h)
r=q(r,o.h)
if(o.h<o.water_level)a=true}if(t-r>2||a)return kt(e,r)
else{var n=pickTreeType(e.pos_world)
if(re(e.seed).range(100)>1)if(n===dt)return At(e,r,false,dt)
else if(n===_t)return Lt(e,r,_t)
else if(n===ct)return St(e,r,ct)
else return Tt(e,r,false,ut)
else return xt(e,r,n)}}function genSnowPineForest(e){var t=-Infinity
var r=Infinity
var a=false
var i=0
var o=0
for(var n=0;n<l.length;++n){ye(Ft,e.origin,l[n])
var s=te.getVerticalSliceMapData(Ft)
i+=s.surface===x?1:0
o+=s.surface===_e?1:0
t=K(t,s.h)
r=q(r,s.h)
if(s.h<s.water_level)a=true}if(t-r>4||a)return kt(e,r)
else{if(i>4)return At(e,r,true,dt)
if(o>1)return At(e,r,false,dt)
return kt(e,r)}}var Wt=.8*Je
var Ht=.2*Je
var zt=[o(Ht,Ht),o(Ht,Wt),o(Wt,Ht),o(Wt,Wt)]
function genBoulders(e){var t=-Infinity
var r=Infinity
for(var a=0;a<zt.length;++a){ye(Ft,e.origin,zt[a])
var i=te.getVerticalSliceMapData(Ft)
t=K(t,i.h)
r=q(r,i.h)}if(t-r>50)return kt(e,r)
else return Pt(e,r)}function genStumps(e){var t=-Infinity
var r=Infinity
for(var a=0;a<l.length;++a){ye(Ft,e.origin,l[a])
var i=te.getVerticalSliceMapData(Ft)
t=K(t,i.h)
r=q(r,i.h)}return xt(e,r,ut)}function genMegaTree(e){var t=Infinity
for(var r=0;r<Gt.length;++r){ye(Ft,e.origin,Gt[r])
Ft[0]+=ze
Ft[1]+=ze
var a=te.getVerticalSliceMapData(Ft)
t=q(t,a.h)}return Mt(e,t)}function genRockOnly(e){var t=Infinity
for(var r=0;r<l.length;++r){ye(Ft,e.origin,l[r])
var a=te.getVerticalSliceMapData(Ft)
t=q(t,a.h)}return kt(e,t)}var Vt=[o(0,0),o(0,0),o(rt,0),o(rt/2,rt/2),o(rt/2,0),o(0,rt/2),o(rt/2,rt),o(rt,rt/2),o(0,rt),o(rt,rt)]
function genSandCastleOnly(e){var t=-Infinity
var r=Infinity
for(var a=0;a<Vt.length;++a){ye(Ft,e.origin,Vt[a])
var i=te.getVerticalSliceMapData(Ft)
t=K(t,i.h)
r=q(r,i.h)}if(t-r>2)return kt(e,r)
else return Ut(e,r)}var Yt
function genMarker(e){var t=te.getVerticalSliceMapData(e.origin).h+1
if(!Yt){var r=(Yt=Be(Te(3,1,5))).data
for(var a=0;a<5;++a)r[1+3*a]=C+a
r[3]=C
r[5]=C}Ae(e.pos_world,e.origin[0]-1,e.origin[1],t)
return Yt}var jt=12
var Kt=7
var qt=[ne,se,le]
var Zt=[1,Kt,-1,-Kt]
var Xt=Te(Kt,Kt,jt)
function genCactus1(e){var t=te.getVerticalSliceMapData(e.origin)
if(t.h<t.water_level)return Be(Le)
var r=Kt
var a=r*r
var i=re(e.seed)
var o=qt[i.range(qt.length)]
var n=5+i.range(5)
var s=Be(Xt)
s.alloc(true)
var l=s.data
var _=(r-1)/2
var c=_+_*r
for(var u=0;u<n;++u)l[c+u*a]=o
var d=i.range(4)
var f=Zt[d]
function doArm(){var e=c+f
var t=2+i.range(q(n-4,4))
var r=t+2+i.range(K(0,n-(t+2)))
l[e+t*a]=o
e+=f
if(0===i.range(4))t++
while(t<r){l[e+t*a]=o
t++}}doArm()
f=Zt[(d+2)%4]
doArm()
var v=te.getVerticalSliceMapData(e.origin).h
Ae(e.pos_world,e.origin[0]-_,e.origin[1]-_,v)
return s}var Qt=[1,1+Kt,Kt,Kt-1,-1,-Kt-1,-Kt,1-Kt]
function genCactus2(e){var t=te.getVerticalSliceMapData(e.origin)
if(t.h<t.water_level)return Be(Le)
var r=Kt
var _=r*r
var c=re(e.seed)
var u=qt[c.range(qt.length)]
var d=4+c.range(2)
var a=Be(Xt)
a.alloc(true)
var f=a.data
var i=(r-1)/2
var v=i+i*r
for(var o=0;o<d;++o)f[v+o*_]=u
var h=[false,false,false,false,false,false,false,false]
function complexArm(e){h[2*e]=h[(2*e+1)%8]=h[(2*e+7)%8]=true
var t=Zt[e]
var r=d-1-c.range(2)
var a=v+t
f[a+r*_]=u
var i=c.range(2)
h[(2*e+(i?2:6))%8]=true
var o=Zt[(e+(i?1:3))%4]
var n=d+2+c.range(4)
for(var s=r+1;s<n;++s)f[a+o+s*_]=u
f[(a+=t)+r*_]=u
o=Zt[(e+(i?3:1))%4]
n=d+2+c.range(4)
for(var l=r+1;l<n;++l)f[a+o+l*_]=u}var n=c.range(4)
complexArm(n)
if(!c.range(4))complexArm(n+2)
for(var s=0;s<4;++s){var l=c.range(8)
if(h[l])continue
h[l]=h[(l+1)%8]=h[(l+7)%8]=true
var p=Qt[l]
var m=d-c.range(2)
var E=v+p
var g=d+2+c.range(4)
for(;m<g;++m)f[E+m*_]=u}var T=te.getVerticalSliceMapData(e.origin).h
Ae(e.pos_world,e.origin[0]-i,e.origin[1]-i,T)
return a}var $t=[o(0,-1),o(-1,0),o(1,0),o(0,1)]
var Jt=5
var er=Jt+2
var tr=Te(3,3,er)
function genSpring3x3(e){var t
var r=1
var a
do{var i=0
t=[]
for(var o=0;o<$t.length;++o){Ft[0]=e.origin[0]+1+$t[o][0]*r
Ft[1]=e.origin[1]+1+$t[o][1]*r
var n=te.getVerticalSliceMapData(Ft)
var s=n.h<n.water_level
t.push(s)
if(s)++i}if(!i){if(!a)return Be(Le)
t=a
break}else if(i<3)break;++r
a=t}while(true)
ye(Ft,e.origin,Le)
var l=te.getVerticalSliceMapData(Ft).water_level-Jt+1
var _=Be(tr)
_.alloc(true)
var c=_.data
var u=_.liquid
var d=re(e.seed)
for(var f=0;f<Jt;++f){var v=3*f*3
c[v+0]=d.range(3)?k:0
c[v+1]=k
c[v+2]=d.range(3)?k:0
c[v+3]=k
c[v+4]=fe
u[v+4]=ve
c[v+5]=k
c[v+6]=d.range(3)?k:0
c[v+7]=k
c[v+8]=d.range(3)?k:0}var h=3*Jt*3
c[h+0]=d.range(3)?k:0
c[h+1]=t[0]?fe:k
u[h+1]=t[0]?ve:0
c[h+2]=d.range(3)?k:0
c[h+3]=t[1]?fe:k
u[h+3]=t[1]?ve:0
c[h+4]=fe
u[h+4]=ve
c[h+5]=t[2]?fe:k
u[h+5]=t[2]?ve:0
c[h+6]=d.range(3)?k:0
c[h+7]=t[3]?fe:k
u[h+7]=t[3]?ve:0
c[h+8]=d.range(3)?k:0
c[(h+=9)+4]=k
Ae(e.pos_world,e.origin[0],e.origin[1],l)
return _}var rr={exclusion:Te(r,r,We),bounds:[Te(-H,-H,h),Te(r+H,r+H,O)],gen:genForestMedium,priority:ke}
a.FOREST_MEDIUM=rr
var ar=1
var ir=A
var or=j((L-ar)/2)
var nr={exclusion:Te(ar,ar,ir),bounds:[Te(-or,-or,h-A),Te(L-or,L-or,A)],factory:R}
a.PITFALL=nr
var sr=j(T/2)
var lr=g
var _r=j((T-sr)/2)
var cr={exclusion:Te(sr,sr,lr),bounds:[Te(-_r,-_r,h-g),Te(T-_r,T-_r,g)],factory:y}
a.CORAL_CAVE=cr
var ur={exclusion:Te(0,0,0),bounds:[Te(0,0,h),Te(Ke+2*qe,Ke+2*qe,Xe)],gen:bt,priority:Ue}
var dr={exclusion:Te(0,0,0),bounds:[Te(0,0,h),Te(Qe,Qe,Qe)],gen:Nt,priority:ke}
var fr={exclusion:Te(r,r,We),bounds:[Te(-H,-H,h),Te(r+H,r+H,O)],gen:genSnowPineForest,priority:ke}
a.SNOW_PINE_FOREST=fr
var vr={exclusion:Te(He,He,We),bounds:[Te(-ze,-ze,h),Te(ze+He,ze+He,je)],gen:genMegaTree,priority:Ge,unblockable:true}
a.MEGA_TREE=vr
var hr={exclusion:Te(Je+1,Je+1,1),bounds:[Te(0,0,h),Te(Je+1,Je+1,$e)],gen:genBoulders,priority:ke}
a.BOULDER=hr
var pr={exclusion:Te(et,et,1),bounds:[Te(0,0,h),Te(et,et,Ct)],gen:genStumps,priority:ke}
a.STUMP=pr
var mr={exclusion:Te(tt+1,tt+1,1),bounds:[Te(0,0,h),Te(tt+1,tt+1,Bt)],gen:genRockOnly,priority:ke}
a.ROCK=mr
var Er={exclusion:Me(rt+1,rt+1,Bt),bounds:[Me(0,0,h),Me(rt+1,rt+1,Bt)],gen:genSandCastleOnly,priority:Ge}
a.SANDCASTLE=Er
var gr={exclusion:Te(1,1,1),bounds:[Te(-3,-3,h),Te(-3+Kt,-3+Kt,jt)],gen:genCactus1,priority:ke}
a.CACTUS1=gr
var Tr={exclusion:Te(1,1,1),bounds:[Te(-3,-3,h),Te(-3+Kt,-3+Kt,jt)],gen:genCactus2,priority:ke}
a.CACTUS2=Tr
var yr={exclusion:Te(1,1,1),bounds:[Te(-1,0,h),Te(2,1,5)],gen:genMarker,priority:Ge}
a.MARKER=yr
var Sr={exclusion:Te(3,3,1),bounds:[Te(0,0,h),Te(3,3,er)],gen:genSpring3x3,priority:Ge}
a.SPRING_3x3=Sr
function providerSpring(e){w(null!==e.hydro_source_vsid)
var t=v(e.hydro_source_vsid)
te.initPhase40(t)
w(isFinite(t.hydro_jitter_x))
w(isFinite(t.hydro_jitter_y))
var r=t.pos_world[0]+s/2+t.hydro_jitter_x
var a=t.pos_world[1]+s/2+t.hydro_jitter_y
return[{pos:Te(r-1,a-1,0),type:Sr}]}function providerMegaTree(e){var t=X(e.pos_world[0])
var r=X(e.pos_world[1])
return[{pos:Te(t-H,r-H,0),type:vr}]}function providerFloatyRocks(e){var t=[]
var r=[]
var a=re(e.seed)
var i=0
var o=X(e.pos_world[0])
var n=X(e.pos_world[1])
var s=2+a.range(4)
for(var l=0;l<s;l++){i=20+a.range(50)
var _=a.range(50)
var c=Te(o+(a.range(60)-30),n+(a.range(60)-30),_)
r.push(c)
t.push({pos:c,type:ur,provider_data:{radius:i,height:_}})}for(var u=0;u<3*s;u++){var d=a.range(s)
var f=r[d]
var v=r[d+1===r.length?d-1:d+1]
t.push({pos:f,type:dr,provider_data:{start_pos:f,end_pos:v}})}return t}function providerCoralCave(e){var t=X(e.pos_world[0]-T/2)
var r=X(e.pos_world[1]-T/2)
var a=[]
a.push({pos:Te(t,r,0),type:cr,provider_data:{hexome:e}})
return a}(function(){for(var e in a){var t=a[e]
if(t.gen){w.equal(t.exclusion.length,3)
w.equal(t.bounds[0].length,3)
w.equal(t.bounds[1].length,3)
w.equal(typeof t.priority,"number")
t.name=e}}for(var r in n){w(!a[r])
a[r]=n[r]}})()},{"../common/globals.js":248,"../common/voxel_data_common.js":264,"../glov/client/rand_fast.js":347,"../glov/common/rand_alea.js":395,"../glov/common/util.js":400,"../glov/common/vmath":402,"../glov/common/vmath.js":402,"./biome_detail_coral_cave.js":21,"./biome_detail_pitfall.js":22,"./detail_gen_base.js":74,"./detail_generators.js":76,"./proc_gen.js":162,"./proc_gen_biomes.js":163,"./proc_gen_constants.js":164,"./rand_seed.js":175,"./saplings_shared.js":179,"./tiles.js":199,assert:void 0,"open-simplex-noise":void 0}],24:[function(e,t,r){"use strict"
r.setupFlat=setupFlat
r.BIOME_PARAM_TYPE=r.TYPE_NON_INTERP=r.TYPE_ARR=r.BIOME_BY_ID=r.BIOMES=r.TYPE_IDS=void 0
var n=e("assert")
var s=e("../glov/common/util").arrayToSet
var a=e("../common/globals").SAFE_DIST_Z
var i=e("../common/ids")
var o=i.ITEM_ALGAE
var l=i.ITEM_ANEMONE
var _=i.ITEM_BERRY_BUSH_BLUE
var c=i.ITEM_BERRY_BUSH_RED
var u=i.ITEM_BERRY_BUSH_YELLOW
var d=i.ITEM_CACTINY
var f=i.ITEM_CACTORB
var v=i.ITEM_CORAL_TUBES
var h=i.ITEM_DISC_CORAL
var p=i.ITEM_PLANT
var m=i.ITEM_SEASHELL
var E=i.ITEM_SEEDS_CORAL_MUSHROOM
var g=i.ITEM_SPICE_PLANT
var T=i.ITEM_STARFISH
var y=i.ITEM_WILD_CROP
var S=e("../common/materials_common").Mat
var I=e("../common/waygate_common")
var A=I.FLAT_SEED_EMPTY
var w=I.FLAT_SEED_GRASS_ON_STONE
var L=I.FLAT_SEED_WATER
var O=e("./flora_constants")
var R=O.ALL_FLOWERS
var b=O.BLUE_FLOWERS
var N=O.RED_FLOWERS
var C=O.WILD_CARROT
var x=O.WILD_CORN
var M=O.WILD_PUMPKIN
var D=O.WILD_SUGAR_CANE
var P=O.WILD_TOMATO
var B=O.WILD_WHEAT
var k=O.YELLOW_FLOWERS
var U=e("./proc_gen_constants")
var G=U.PROP_1x1x1
var F=U.PROP_1x1x2
var W=U.PROP_1x1x4
var H=U.PROP_2x2x1
var z=U.PROP_2x2x2
var V=U.PROP_4x4x1
var Y=e("./tiles")
var j=Y.TILE_COAL
var K=Y.TILE_CORAL1
var q=Y.TILE_CORAL2
var Z=Y.TILE_DIRT
var X=Y.TILE_GRASS
var Q=Y.TILE_SAND
var $=Y.TILE_SNOW
var J=Y.TILE_STONE
var ee=Y.TILE_STONE_DARK
var te=Y.TILE_STONE_LIGHT
var re=Y.TILE_STONE_RED
function avgTint(e){var t=[]
for(var r=0;r<3;++r){var a=e[r]
if(a.length)a=(a[0]+a[1])/2
t.push(a)}return t}var ae=[[75,125,.005,0],.65,.8]
var ie=[[70,110,.01,0],[.6,.9,.005,0],.9]
var oe=[[100,130,.005,0],.7,[.9,.5,.005,0,0]]
var ne=oe
var se=ne
var le=[[60,155,.005,0],.55,.6]
var _e=avgTint(ae)
var ce=[[120,145,.005,0],.65,.9]
var ue=[[120,145,.005,0],.65,.9]
var de=[[55,70,.005,0],.65,.9]
var fe=[[55,70,.005,0],.65,.9]
var ve={FLAT:1,HILLS:2,HILLS_FOREST:3,TUNDRA:4,PLAINS:5,PLAINS_BLUE:6,PLAINS_RED:7,PLAINS_FOREST:8,DENSE_FOREST:9,DESERT:10,OCEAN:11,MOUNTAINS:12,CLIFFS:13,PLAINS_SPRING:14,HILLS_SPRING:15,MOUNTAINS_SPRING:16,FOREST_MEGA_TREE:17,SNOW_PINE_MOUNTAINS:18,FOREST_RUIN:19,RIVER_DELTA:20,SHALLOWS_SPIKY:21,PLAINS_FOREST_SPIKY:22,PLAINS_YELLOW:23,PLAINS_RED_V2:24,PLAINS_BLUE_V2:25,PLAINS_WITH_BERRIES:26,PLAINS_BLUE_V3:27,MOUNTAINS_FLOATY_ROCKS:28,DESERT_V2:29,DENSE_FOREST_LEAVES:30,CORAL_REEF_RIDGES:31,CORAL_REEF_MASS:32,CORAL_REEF_CAVES:33}
r.TYPE_IDS=ve
var he={BASE:{name:"BASE",surface:X,surface_depth:[1],ground:Z,ground_depth:[10,20],noise_periods:[],noise_weights:[],height_func:null,blend:[.5,.5],details:[],plants:[],min_erosion:0,spawn_weight:0,debug_color_hsv:[[0,360],1,1],tint_grass_hsv:ae},FLAT:{name:"Flat",surface:J,surface_depth:[Infinity],ground:J,ground_depth:[0,0],details:[],plants:[],spawn_weight:1,debug_color_hsv:[0,0,[0,1]],tint_grass_hsv:_e},HILLS:{name:"Hills",noise_periods:[.005,.025],noise_weights:[32,4],height_func:"genericHeight",details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.02,offs:10}],plants:[{id:p,size:G,over:X,min:-2,max:6,freq:.005,chance:1,offs:100,attr3_list:R},{id:y,over:X,min:-2,max:2,freq:.007,chance:.3,offs:450,attr3_list:[x]}],spawn_weight:0,debug_color_hsv:[[100,140],.75,1],tint_grass_hsv:ie},HILLS_FOREST:{name:"ForestedHills",inherit:"HILLS",debug_color_hsv:[[100,140],.75,.5],details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:0,max:4,freq:.005,chance:.66,offs:0}],plants:[{id:p,size:G,over:X,min:-2,max:1,freq:.005,chance:1,offs:100,attr3_list:R},{id:y,over:X,min:-2,max:1,freq:.005,chance:.2,offs:270,attr3_list:[M]},{id:g,over:X,min:-2,max:1,freq:.005,chance:.5,offs:200,attr3_list:[S.HOT]},{id:y,over:X,min:-2,max:2,freq:.005,chance:.2,offs:150,attr3_list:[D]}],spawn_weight:.5,tint_grass_hsv:oe,tint_lod_hsv:ne},TUNDRA:{name:"Tundra",surface:$,surface_depth:[3],noise_periods:[1/80],noise_weights:[4],height_func:"genericHeight",details:[],plants:[],debug_color_hsv:[[195,285],.125,2]},PLAINS:{name:"Plains",noise_periods:[.025],noise_weights:[2],height_func:"genericHeight",details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:-16,max:4,freq:.004,chance:.125,offs:0}],plants:[{id:p,size:G,over:X,min:-2,max:6,freq:.005,chance:1,offs:100,attr3_list:R},{id:y,over:X,min:-2,max:2,freq:.007,chance:.2,offs:150,attr3_list:[B]}],spawn_weight:1,debug_color_hsv:[[40,80],.75,1]},PLAINS_WITH_BERRIES:{inherit:"PLAINS",spawn_weight:.2,plants:[{id:p,size:G,over:X,min:-2,max:6,freq:.005,chance:1,offs:100,attr3_list:R},{id:y,over:X,min:-2,max:2,freq:.007,chance:.2,offs:150,attr3_list:[B]},{id:c,over:X,size:H,min:-30,max:10,freq:.003,chance:.03,offs:100},{id:u,over:X,size:z,min:-30,max:10,freq:.003,chance:.03,offs:100},{id:_,over:X,size:H,min:-30,max:10,freq:.003,chance:.03,offs:100}]},PLAINS_BLUE:{name:"Blue Flower Plains",inherit:"PLAINS",spawn_weight:.2,debug_color_hsv:[[150,190],.75,1],plants:[{id:p,over:X,min:-30,max:25,freq:.003,chance:1,offs:100,attr3_list:b.weighted}],tint_grass_hsv:ce,tint_lod_hsv:ue},PLAINS_BLUE_V2:{inherit:"PLAINS_BLUE",plants:[{id:p,over:X,min:-30,max:25,freq:.003,chance:1,offs:100,attr3_list:b.weighted},{id:_,over:X,size:H,min:-30,max:25,freq:.003,chance:.2,offs:100}]},PLAINS_BLUE_V3:{inherit:"PLAINS_BLUE",plants:[{id:p,over:X,min:-30,max:27,freq:.003,chance:1,offs:100,attr3_list:b.weighted},{id:_,over:X,size:H,min:-30,max:10,freq:.003,chance:.2,offs:100}]},PLAINS_RED:{name:"Red Flower Plains",inherit:"PLAINS",spawn_weight:.2,tint_grass_hsv:de,tint_lod_hsv:fe,debug_color_hsv:[[0,40],.75,1],plants:[{id:p,over:X,min:-30,max:30,freq:.003,chance:1,offs:100,attr3_list:N.key}]},PLAINS_RED_V2:{inherit:"PLAINS_RED",plants:[{id:p,over:X,min:-30,max:30,freq:.003,chance:1,offs:100,attr3_list:N.key},{id:c,over:X,size:H,min:-30,max:10,freq:.003,chance:.2,offs:100}]},PLAINS_YELLOW:{name:"Yellow Flower Plains",inherit:"PLAINS",spawn_weight:.2,debug_color_hsv:[[45,60],.75,1],plants:[{id:p,over:X,min:-30,max:25,freq:.003,chance:1,offs:100,attr3_list:k.key},{id:u,over:X,size:z,min:-30,max:10,freq:.003,chance:.2,offs:100}],tint_grass_hsv:de,tint_lod_hsv:fe},PLAINS_FOREST:{name:"ForestedPlains",inherit:"PLAINS",spawn_weight:1,debug_color_hsv:[[40,80],.75,.5],details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:-1,max:4,freq:.005,chance:.66,offs:0}],plants:[{id:p,size:G,over:X,min:-2,max:1,freq:.005,chance:1,offs:100,attr3_list:R},{id:y,over:X,min:-2,max:1,freq:.005,chance:.2,offs:100,attr3_list:[M]},{id:g,over:X,min:-2,max:1,freq:.005,chance:.5,offs:100,attr3_list:[S.HOT]}],tint_grass_hsv:oe,tint_lod_hsv:ne},PLAINS_FOREST_SPIKY:{name:"ForestedPlainsSpiky",inherit:"PLAINS_FOREST",height_func:"spikyHeight",local_func:"shallowsSpikyReef",spawn_weight:.1,debug_color_hsv:[[270,300],.48,.91],ground_depth:[0,0],surface_depth:[1],plants:[{id:y,over:X,min:-2,max:2,freq:.005,chance:1,offs:100,attr3_list:[C]}]},DENSE_FOREST:{name:"DenseForest",inherit:"PLAINS",noise_periods:[.005,.025],noise_weights:[16,3],spawn_weight:.5,debug_color_hsv:[[0,40],.75,.5],details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:10},{type_name:"FOREST_MEDIUM",min:1,max:4,freq:.005,chance:.75,offs:0}],plants:[{id:p,over:X,min:-2,max:10,freq:.005,chance:1,offs:100,attr3_list:R},{id:g,over:X,min:-2,max:1,freq:.005,chance:.5,offs:200,attr3_list:[S.HOT]},{id:y,over:X,min:-2,max:2,freq:.005,chance:.2,offs:150,attr3_list:[D]}],tint_grass_hsv:oe,tint_lod_hsv:se},DENSE_FOREST_LEAVES:{name:"DenseForestLeaves",inherit:"DENSE_FOREST",details:[{type_name:"BOULDER",min:-10,max:1,freq:.005,chance:.2,offs:150},{type_name:"FOREST_MEDIUM",min:1,max:4,freq:.005,chance:.75,offs:0},{type_name:"PITFALL",min:1,max:3,freq:.005,chance:.25,offs:0}]},FOREST_RUIN:{name:"ForestRuin",inherit:"DENSE_FOREST",spawn_weight:0,debug_color_hsv:[[0,10],1,.75],details:[{type_name:"FOREST_MEDIUM",min:2,max:6,freq:.005,chance:.75,offs:0}],detail_provider:"providerForestedRuin"},DESERT:{name:"Desert",surface:Q,surface_depth:[9],noise_periods:[.005,.025],noise_weights:[10,6],height_func:"genericHeight",details:[],plants:[{id:g,over:Q,min:-2,max:1,freq:.005,chance:1,offs:100,attr3_list:[S.SAVORY]}],debug_color_hsv:[[40,80],.25,1],spawn_weight:-1},DESERT_V2:{inherit:"DESERT",plants:[{id:g,over:Q,min:-12,max:3,freq:.005,chance:1,offs:100,attr3_list:[S.SAVORY]},{id:d,over:Q,size:F,attr1_list:[S.LIZARDITE_CACTINY],min:-15,max:10,freq:.0052,chance:.65,offs:200},{id:d,over:Q,size:F,attr1_list:[S.AMETHYST_CACTINY],min:-100,max:10,freq:.0019,chance:.5,offs:1e3},{id:f,over:Q,size:z,attr1_list:[S.RUBY_CACTORB],min:0,max:1,freq:1.1,chance:.1,offs:200},{id:f,over:Q,size:z,attr1_list:[S.KYANITE_CACTORB],min:-100,max:10,freq:.0015,chance:1,offs:250}],details:[{type_name:"CACTUS1",min:-6,max:4,freq:.0023,chance:.2,offs:0},{type_name:"CACTUS2",min:-6,max:4,freq:.0027,chance:.25,offs:200}]},OCEAN:{name:"Ocean",surface:Q,surface_depth:[3],noise_periods:[.005,.025],noise_weights:[-6,-2],height_func:"genericHeight",details:[],plants:[],spawn_weight:-100,debug_color_hsv:[[195,205],.75,1]},CORAL_REEF_RIDGES:{name:"Coral reef ridges",surface:Q,inherit:"OCEAN",height_func:"reefHeight",local_func:"corallyReef",ground:K,ground_depth:[5,10],details:[{type_name:"SANDCASTLE",min:-15,max:1,freq:.009,chance:.75,offs:0}],plants:[{id:m,over:Q,min:-2,max:2,freq:.5,chance:.5,offs:100,attr3_list:[1,2],underwater_only:true},{id:m,over:Q,min:-5,max:1,freq:.3,chance:.5,offs:230,attr3_list:[3,4,5,6,7,8],underwater_only:true},{id:m,over:Q,min:-11,max:1,freq:.1,chance:.5,offs:235,attr3_list:[9],underwater_only:true},{id:T,over:[Q,K],min:-5,max:1,freq:.3,chance:1,offs:220,attr3_list:[2],underwater_only:true},{id:h,over:[Q,K],min:-2,max:2,freq:.5,chance:1,offs:140,attr3_list:[1],underwater_only:true,size:V},{id:h,over:[Q,K],min:-2,max:1,freq:2,chance:1,offs:340,attr3_list:[2,4],underwater_only:true,size:V},{id:o,over:[Q,K],min:-2,max:6,freq:1,chance:1,offs:150,attr1_list:[S.MINT_ALGAE],underwater_only:true,size:W},{id:o,over:[Q,K],min:-2,max:6,freq:1,chance:1,offs:250,attr1_list:[S.JADE_ALGAE],underwater_only:true,size:W},{id:o,over:[Q,K],min:-2,max:2,freq:1,chance:1,offs:350,attr1_list:[S.BUBBLEGUM_ALGAE,S.INDIGO_ALGAE,S.ULTRAMARINE_ALGAE],underwater_only:true,size:W},{id:E,over:[Q,K],min:-2,max:5,freq:1,chance:.5,offs:360,underwater_only:true}],debug_color_hsv:[[300,320],.75,.5]},CORAL_REEF_MASS:{name:"Coral reef mass",surface:Q,surface_depth:[4,3],inherit:"OCEAN",height_func:"reefMassHeight",local_func:"reefMassLocal",ground:q,ground_depth:[1,10],details:[{type_name:"SANDCASTLE",min:-20,max:1,freq:.005,chance:.125,offs:0}],plants:[{id:m,over:Q,min:-2,max:2,freq:.5,chance:.5,offs:100,attr3_list:[1,2],underwater_only:true},{id:m,over:Q,min:-5,max:1,freq:.3,chance:.5,offs:230,attr3_list:[3,4,5,6,7,8],underwater_only:true},{id:m,over:Q,min:-11,max:1,freq:.1,chance:.5,offs:235,attr3_list:[9],underwater_only:true},{id:T,over:Q,min:-2,max:3,freq:1.2,chance:1,offs:120,attr3_list:[1],underwater_only:true},{id:T,over:Q,min:-11,max:1,freq:.1,chance:1,offs:320,attr3_list:[3],underwater_only:true},{id:l,over:[Q,K],min:-2,max:4,freq:.5,chance:1,offs:130,attr3_list:[1],underwater_only:true,size:z},{id:l,over:[Q,K],min:-5,max:2,freq:1.2,chance:1,offs:230,attr3_list:[2],underwater_only:true,size:z},{id:l,over:[Q,K],min:-11,max:1,freq:.1,chance:1,offs:330,attr3_list:[3],underwater_only:true,size:z},{id:h,over:[Q,K],min:-2,max:2,freq:.5,chance:1,offs:140,attr3_list:[1],underwater_only:true,size:V},{id:h,over:[Q,K],min:-2,max:1,freq:2,chance:1,offs:340,attr3_list:[3,5],underwater_only:true,size:V},{id:v,over:[Q,K],min:-2,max:1,freq:1,chance:1,offs:160,attr3_list:[1],underwater_only:true,size:z},{id:v,over:[Q,K],min:-10,max:1,freq:.001,chance:.5,offs:260,attr3_list:[2],underwater_only:true,size:z},{id:E,over:[Q,K],min:-2,max:5,freq:1,chance:.1,offs:360,underwater_only:true}],debug_color_hsv:[[300,320],.75,1]},CORAL_REEF_CAVES:{name:"Coral reef caves",inherit:"OCEAN",detail_provider:"providerCoralCave",plants:[{id:v,over:[Q,q],min:-1,max:2,freq:1,chance:1,offs:160,attr3_list:[1],underwater_only:true,size:z},{id:v,over:[Q,q],min:-10,max:1,freq:.001,chance:.5,offs:260,attr3_list:[2],underwater_only:true,size:z},{id:m,over:Q,min:-1,max:8,freq:.5,chance:.5,offs:100,attr3_list:[1,2],underwater_only:true},{id:m,over:Q,min:-2,max:4,freq:.3,chance:.5,offs:230,attr3_list:[3,4,5,6,7,8],underwater_only:true},{id:m,over:Q,min:-11,max:1,freq:.1,chance:.5,offs:235,attr3_list:[9],underwater_only:true},{id:h,over:[Q,q],min:-2,max:2,freq:2,chance:1,offs:340,attr3_list:[2,5],underwater_only:true,size:V},{id:o,over:[Q,q],min:-2,max:12,freq:1,chance:1,offs:150,attr1_list:[S.MINT_ALGAE],underwater_only:true,size:W},{id:o,over:[Q,q],min:-2,max:8,freq:1,chance:1,offs:250,attr1_list:[S.JADE_ALGAE],underwater_only:true,size:W},{id:o,over:[Q,q],min:-2,max:6,freq:1,chance:1,offs:350,attr1_list:[S.BUBBLEGUM_ALGAE,S.INDIGO_ALGAE,S.ULTRAMARINE_ALGAE],underwater_only:true,size:W}],debug_color_hsv:[[220,240],.75,.5]},MOUNTAINS:{name:"Mountains",surface:Z,surface_depth:[0],ground_depth:[-100,0],height_func:"mountainsHeight",local_func:"grassyMountain",blend:[0,0],plants:[{id:g,over:X,min:-2,max:2,freq:.005,chance:1,offs:100,attr3_list:[S.PUNGENT]},{id:y,over:X,min:-2,max:2,freq:.003,chance:1,offs:230,attr3_list:[P]}],spawn_weight:-1,debug_color_hsv:[[0,360],.125,.75],min_erosion:7,tint_grass_hsv:le},MOUNTAINS_FLOATY_ROCKS:{name:"Mountains Floaty Rocks",inherit:"MOUNTAINS",detail_provider:"providerFloatyRocks",debug_color_hsv:[270,1,.8]},RIVER_DELTA:{name:"RiverDelta",inherit:"OCEAN",height_func:"riverDeltaHeight",debug_color_hsv:[[195,285],.25,.5]},SHALLOWS_SPIKY:{name:"shallows_spiky",inherit:"OCEAN",ground_depth:[0,0],surface_depth:[0],debug_color_hsv:[[270,300],.48,[.2,.3]],height_func:"shallowsSpikyHeight",local_func:"shallowsSpikyReef"},CLIFFS:{name:"Cliffs",surface:ee,surface_depth:[3],ground_depth:[-100,0],height_func:"cliffsHeight",blend:[0,0],details:[],plants:[],spawn_weight:-1,debug_color_hsv:[[0,360],.125,.25],min_erosion:7,tint_grass_hsv:le},HILLS_SPRING:{name:"HillsSpring",inherit:"HILLS",detail_provider:"providerSpring"},PLAINS_SPRING:{name:"PlainsSpring",inherit:"PLAINS",detail_provider:"providerSpring"},MOUNTAINS_SPRING:{name:"MountainsSpring",inherit:"MOUNTAINS",detail_provider:"providerSpring"},FOREST_MEGA_TREE:{name:"MegaTree",inherit:"DENSE_FOREST",detail_provider:"providerMegaTree",spawn_weight:.2,plants:[{id:p,over:X,min:-2,max:6,freq:.03,chance:1,offs:100,attr3_list:R}],debug_color_hsv:[300,1,1]},SNOW_PINE_MOUNTAINS:{name:"SnowPineMountain",inherit:"MOUNTAINS",details:[{type_name:"SNOW_PINE_FOREST",min:1,max:4,freq:.005,chance:.75,offs:0}]}}
r.BIOMES=he
var pe=function(){var e=[]
for(var t in he)if("BASE"!==t){var r=ve[t]
n(r)
e[he[t].id=r]=he[t]}return e}()
r.BIOME_BY_ID=pe
var me=1
r.TYPE_ARR=me
var Ee=2
r.TYPE_NON_INTERP=Ee
var ge=function(){var e={}
var t=he.BASE
for(var r in t){var a=t[r]
n(a||0===a||null===a)
e[r]=a&&a.length?me:Ee}return e}();(r.BIOME_PARAM_TYPE=ge).debug_color=me
function doInherit(e,t){if(t){var r=he[t]
n(r)
n(!r.inherit)
for(var a in r)if(void 0===e[a])e[a]=r[a]}}(function(){for(var e in he){var t=he[e]
var r=t.inherit
if("BASE"!==e&&void 0===r)r="BASE"
doInherit(he[e],r)
n.equal(he[e].ground_depth.length,2)
delete t.inherit
if(t.plants)for(var a=0;a<t.plants.length;++a){var i=t.plants[a]
var o=i.over
if("object"!==typeof o||Array.isArray(o)){n(o)
if(!Array.isArray(o))o=[o]
i.over=s(o)}}}})()
var Te=[X,J,$,Q,ee,te,re,j,K,q]
function setupFlat(e){var t=he.FLAT
t.fixed_elev=-1
switch(e){case L:t.surface=Q
t.surface_depth=[1]
t.ground=Z
t.ground_depth=[15,15]
t.fixed_elev=-16
break
case w:t.surface=X
t.surface_depth=[1]
t.ground=Z
t.ground_depth=[15,15]
break
case A:t.surface=ee
t.surface_depth=[Infinity]
t.ground=ee
t.ground_depth=[0,0]
t.fixed_elev=2*-a
break
default:var r=e
if(-1===Te.indexOf(e))r=J
t.surface=r
t.surface_depth=[Infinity]
t.ground=r
t.ground_depth=[0,0]}}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/waygate_common":265,"../glov/common/util":400,"./flora_constants":101,"./proc_gen_constants":164,"./tiles":199,assert:void 0}],25:[function(e,t,r){"use strict"
r.drawBlockIntersections=drawBlockIntersections
var a=e("./camera.js"),S=a.getActiveController,I=a.getCurrentCameraPos,A=a.getCurrentCameraTargetDir
var i=e("../glov/client/cmds.js").cmd_parse
var w=e("../glov/client/engine.js")
var o=e("./main.js").charControllerPos
var L=Math.tan,O=Math.min,R=Math.max,b=Math.floor
var n=e("./proc_gen_biomes.js").getElevationEstimate
var N=e("../glov/client/settings.js")
var s=e("./tiles.js"),l=s.TILE_COAL,_=s.TILE_NON_OPAQUE
var c=e("../glov/common/vmath.js"),C=c.v3add,x=c.v3addScale,M=c.v3sub,u=c.vec3,D=c.unit_vec
var d=e("./voxel_data.js"),P=d.drawSingleVoxel,B=d.getPropLighting,f=d.getTileLocal,v=d.worldPosFromLocalPos
N.register({draw_block_intersections:{default_value:1,type:i.TYPE_INT,range:[0,1],access_run:["sysadmin"]}})
var h=u()
function tileSolid(e){var t=f(e,-1,false)
if(-1===t){v(h,o())
if(n(h)-h[2]<0)t=0
else t=l}if(t>=_)t=0
return t}var k=[u(),u(),u(),u()]
var U=[[-1,-1],[-1,1],[1,1],[1,-1]]
var G=u()
var F=u()
var W=u()
var H=u()
var z=u()
var V={scale_lights:true,torch_factor:1,sun_factor:1}
var Y=[null,u(0,0,1),u(0,0,-1),u(0,1,0),u(0,-1,0),u(1,0,0),u(-1,0,0)]
function drawBlockIntersections(){if(!N.draw_block_intersections)return
var e=w.fov_x,t=w.fov_y,r=w.ZNEAR
var a=S(),i=a.char_up,o=a.char_right
x(G,I(),A(),r)
var n=L(t/2)*r
var s=L(e/2)*r
for(var l=0;l<k.length;++l){var _=k[l]
x(_,x(_,G,i,U[l][0]*n),o,U[l][1]*s)
for(var c=0;c<3;++c){var u=b(_[c])
if(0===l)F[c]=W[c]=u
else{F[c]=O(F[c],u)
W[c]=R(W[c],u)}}}M(F,F,D)
C(W,W,D)
var d=false
for(var f=F[2];f<=W[2];++f){var v=f===F[2]?1:f===W[2]?2:0
H[2]=f
for(var h=F[1];h<=W[1];++h){var p=h===F[1]?3:h===W[1]?4:0
if(p&&v)continue
var m=p+v
H[1]=h
for(var E=F[0];E<=W[0];++E){var g=(H[0]=E)===F[0]?5:E===W[0]?6:0
if(m&&g)continue
var T=m+g
if(!T)continue
var y=tileSolid(H)
if(y){C(z,H,Y[T])
if(tileSolid(z)){if(!d)B(V,H,false)
P({tile:y,opaque:true,pos:H,lit:true,draw_opts:V,face:T-1})}}}}}}},{"../glov/client/cmds.js":298,"../glov/client/engine.js":305,"../glov/client/settings.js":351,"../glov/common/vmath.js":402,"./camera.js":35,"./main.js":135,"./proc_gen_biomes.js":163,"./tiles.js":199,"./voxel_data.js":216}],26:[function(e,t,r){"use strict"
r.blueboxDrawAllEditBounds=blueboxDrawAllEditBounds
r.blueboxEditListAdd=blueboxEditListAdd
r.blueboxEditListRemove=blueboxEditListRemove
r.blueboxEditListUpdate=blueboxEditListUpdate
r.blueboxEditListCheck=blueboxEditListCheck
r.blueboxEditListCheckPoint=blueboxEditListCheckPoint
r.boundedPropListAdd=boundedPropListAdd
r.boundedPropListRemove=boundedPropListRemove
r.boundedPropListUpdate=boundedPropListUpdate
r.boundedPropListCheck=boundedPropListCheck
r.boundedPropListCheckPoint=boundedPropListCheckPoint
r.boundsStartup=boundsStartup
var a=e("../glov/client/aabbtree")
var i=e("../glov/client/cmds").cmd_parse
var o=e("../glov/client/draw_list")
var E=e("../glov/client/engine")
var n=e("../glov/client/geom").geomCreateQuads
var g=e("../glov/client/settings")
var s=e("../glov/client/shaders")
var l=s.SEMANTIC
var _=s.shaderCreate
var c=s.shadersBind
var u=s.shadersPrelink
var d=e("../glov/client/textures")
var f=e("../glov/common/util")
var v=f.easeInOut
var h=f.ridx
var p=e("../glov/common/vmath")
var m=p.mat4
var T=p.unit_vec
var y=p.v3add
var S=p.v3addScale
var I=p.v3copy
var A=p.v3dist
var w=p.v3iMin
var L=p.v3mul
var O=p.v3scale
var R=p.v3sub
var b=p.v4copy
var N=p.v4mul
var C=p.vec3
var x=p.vec4
var M=e("../common/globals").CHUNK_SIZE
var D=e("../common/world_constants").VOLUME_SETTLEMENT_PREFIX
var P=e("./bluebox_ui")
var B=P.blueboxGetSelected
var k=P.bluebox_color_bounds
var U=e("./camera").getCurrentCameraPos
var G=e("./huds")
var F=G.settlementBoundsShouldDraw
var W=G.settlementVolumeBoundsShouldDraw
var H=e("./main").charControllerPos
var z=e("./megachunk_client").megaChunkGetNearbyVolumes
var V=e("./settlement").settlementFromVolume
var Y=e("./voxel_chunk_manager").getThisFrameFrustumPlanes
var j=e("./voxel_const").origin_chunk
var K=e("./voxel_data").localPosFromWorldPos
var q=Math.abs,Z=Math.max,X=Math.min,Q=Math.sin,$=Math.sqrt
var J
var ee
var te
var re
function BlueboxListEdit(e){this.tree=a.create({name:e})
this.prepared_list=[]
this.query_list=[]}var ae=new Float32Array(6)
var ie=1/M
BlueboxListEdit.prototype.add=function(e){ae[0]=e.bounded_origin[0]*ie
ae[1]=e.bounded_origin[1]*ie
ae[2]=e.bounded_origin[2]*ie
ae[3]=ae[0]+e.bounded_size[0]*ie
ae[4]=ae[1]+e.bounded_size[1]*ie
ae[5]=ae[2]+e.bounded_size[2]*ie
this.tree.add(e,ae)}
BlueboxListEdit.prototype.remove=function(e){this.tree.remove(e)}
BlueboxListEdit.prototype.update=function(e){ae[0]=e.bounded_origin[0]*ie
ae[1]=e.bounded_origin[1]*ie
ae[2]=e.bounded_origin[2]*ie
ae[3]=ae[0]+e.bounded_size[0]*ie
ae[4]=ae[1]+e.bounded_size[1]*ie
ae[5]=ae[2]+e.bounded_size[2]*ie
this.tree.update(e,ae)}
BlueboxListEdit.prototype.getVisible=function(){this.tree.finalize()
var e=Y()
var t=this.tree.getVisibleNodes(e,this.prepared_list,0)
this.prepared_list.length=t
return this.prepared_list}
var oe=.25*ie
var ne=2*oe
BlueboxListEdit.prototype.query=function(e,t){ae[0]=e[0]*ie+j[0]+oe
ae[1]=e[1]*ie+j[1]+oe
ae[2]=e[2]*ie+j[2]+oe
ae[3]=ae[0]+t[0]*ie-ne
ae[4]=ae[1]+t[1]*ie-ne
ae[5]=ae[2]+t[2]*ie-ne
var r=this.tree.getOverlappingNodes(ae,this.query_list,0)
this.query_list.length=r
return this.query_list}
var se=new BlueboxListEdit("bluebox_list_edit")
var le=new BlueboxListEdit("bounded_prop_list")
var _e=x()
function drawBoundsBoxImp(e){var t=this
E.projectionZBias(.03,Z(16,t.min_dist))
E.updateMatrices(t.mat)
d.bind(0,re)
b(_e,t.color_set.outside)
_e[3]*=t.alpha
var r={size:t.size,color:_e,char_pos:H(),pos_world:t.pos_world}
c(J,ee,r)
te.draw()
if(t.color_set.inside!==t.color_set.outside){b(_e,t.color_set.inside)
_e[3]*=t.alpha
c(J,ee,r)}gl.cullFace(gl.FRONT)
te.draw()
gl.cullFace(gl.BACK)
E.projectionZBias(0)}var ce=C()
var ue=C()
function drawBoundsBox(e,t,r){profilerStart("drawBoundsBox")
e.mat=e.mat||m()
e.pos_world=e.pos_world||new Float32Array(e.mat.buffer,48,3)
I(e.pos_world,t)
e.drawAlpha=drawBoundsBoxImp
e.size=r
var a=U()
R(ce,a,t)
y(ue,t,r)
R(ue,a,ue)
for(var i=0;i<3;++i)if(ce[i]>0&&ue[i]<0)ce[i]=0
L(ce,ce,ce)
L(ue,ue,ue)
w(ce,ue)
e.min_dist=$(ce[0]+ce[1]+ce[2])
o.alphaQueue(e)
profilerStop("drawBoundsBox")}var de=C()
function volumeBoundaryForPos(e,t,r){var a=e.size,i=e.local_pos
var o=Infinity
var n=true
for(var s=0;s<3;++s){var l=t[s]
var _=i[s]
var c=_+a[s]
if(l<_){de[s]=_
n=false}else if(l>c){de[s]=c
n=false}else{de[s]=l
o=X(o,l-_,c-l)}}if(!n)o=A(t,de)
else if(!e.contains_settlement)return 0
if(o<r)return o
return null}function volumeBoundsAlpha(e){var t=volumeBoundaryForPos(e,H(),10)
if(null===t)return 0
return v(1-t/10,2)}g.register({show_area_bounds:{label:"Show Area Bounds",usage:"Automatic (default): /show_area_bounds -1\nAlways: /show_area_bounds 1\nNever: /show_area_bounds 0",default_value:-1,type:i.TYPE_INT,range:[-1,1],ver:2},show_settlement_bounds:{label:"Show Settlement Bounds",usage:"Automatic (default): /show_settlement_bounds -1\nAlways: /show_settlement_bounds 1\nNever: /show_settlement_bounds 0",default_value:-1,type:i.TYPE_INT,range:[-1,1]}})
function showLabel(e){return-1===e?"Automatic (default)":0===e?"OFF":"ON"}i.register({cmd:"show_bounds",help:"Show Area and Settlement Bounds",usage:"Automatic (default): /show_bounds -1\nAlways: /show_bounds 1\nNever: /show_bounds 0",func:function func(e,t){var r=Number(e)
if(-1===r||0===r||1===r){g.set("show_area_bounds",r)
g.set("show_settlement_bounds",r)}return void t(null,"Show EditVolume Bounds = "+showLabel(g.show_area_bounds)+"\nShow Settlement Bounds = "+showLabel(g.show_settlement_bounds))}})
var fe={inside:k,outside:N(x(),k,[1,1,1,.25])}
var ve=x(.7,.4,1,1)
var he={inside:ve,outside:ve}
var pe={inside:x(0,1,1,1),outside:x(0,1,1,.25)}
var me=x(1,.2,.1,.5)
var Ee={inside:N(x(),me,[1,1,1,.5]),outside:me}
var ge=[{inside:x(1,.25,.25,1),outside:x(1,.25,.25,1)},{inside:x(.5,1,.5,1),outside:x(.5,1,.5,1)},{inside:x(1,.8,.5,1),outside:x(1,.8,.5,1)}]
var Te=C()
var ye=.25
var Se={}
function contextAlloc(e,t){var r={local_pos:Te,color_set:t?he:pe,size:C(),contains_settlement:e,alpha:1}
if(e)r.settlement_ctx=contextAlloc(false,true)
return r}function blueboxDrawAllEditBounds(){if(E.defines.NOUI)return
profilerStart("blueboxDrawAllEditBounds")
profilerStart("bluebox")
var e=se.getVisible()
var t=B()
for(var r=0;r<e.length;++r){var a=e[r]
K(Te,a.bounded_origin)
var i=a.box_ctx=a.box_ctx||{sort_bias:a.bluebox_bounds_sort_bias,color_set:fe}
if(a===t)i.alpha=.5+.5*q(Q(.005*E.frame_timestamp))
else i.alpha=1
drawBoundsBox(a.box_ctx,Te,a.bounded_size)}if(E.defines.BOUNDED){profilerStopStart("bounded")
var o=le.getVisible()
for(var n=0;n<o.length;++n){var s=o[n]
K(Te,s.bounded_origin)
s.box_ctx=s.box_ctx||{color_set:ge[s.state]||ge[0],alpha:1}
drawBoundsBox(s.box_ctx,Te,s.bounded_size)}}profilerStopStart("volumes")
var l=z()
for(var _ in l){var c=l[_]
var u=Se[_]
if(!u){var d=_.startsWith(D)
u=Se[_]=contextAlloc(d)}R(u.size,c.max,c.min)
K(Te,c.min)
var f=false
var v=false
if(!c.build_allowed)f=true
else if(u.contains_settlement){if(F())v=true
f=W()}else f=true
if(-1!==g.show_area_bounds)f=Boolean(g.show_area_bounds)
if(u.contains_settlement&&-1!==g.show_settlement_bounds)v=Boolean(g.show_settlement_bounds)
if(f){var h=1===g.show_area_bounds?1:volumeBoundsAlpha(u)
if(h){u.alpha=h
u.color_set=c.build_allowed?pe:Ee
drawBoundsBox(u,Te,u.size)}}if(v){u=u.settlement_ctx
var p=V(c)
if(p){S(Te,p.world_pos,T,-p.radius)
K(Te,Te)
O(u.size,T,2*p.radius+1)
var m=(1===g.show_settlement_bounds?1:volumeBoundsAlpha(u))*ye
if(m){u.alpha=m
drawBoundsBox(u,Te,u.size)}}}}profilerStop()
profilerStop("blueboxDrawAllEditBounds")}function blueboxEditListAdd(e){se.add(e)}function blueboxEditListRemove(e){se.remove(e)}function blueboxEditListUpdate(e){se.update(e)}function listCheck(e,t,r,a,i){var o=e.query(t,r)
if(a||i)for(var n=o.length-1;n>=0;--n){var s=o[n]
if(s===a||i&&i===s.blueprint_def.owner_id)h(o,n)}return o.length?o:null}function blueboxEditListCheck(e,t,r,a){return listCheck(se,e,t,r,a)}function blueboxEditListCheckPoint(e,t,r){return listCheck(se,e,T,t,r)}function boundedPropListAdd(e){le.add(e)}function boundedPropListRemove(e){le.remove(e)}function boundedPropListUpdate(e){le.update(e)}function boundedPropListCheck(e,t,r){return listCheck(le,e,t,r)}function boundedPropListCheckPoint(e,t){return listCheck(le,e,T,t)}function boundsStartup(){J=_("shaders/bounds.vp")
ee=_("shaders/bounds.fp")
u(J,ee)
te=n([[l.POSITION,gl.UNSIGNED_BYTE,4,false],[l.TEXCOORD_0,gl.UNSIGNED_BYTE,4,false],[l.TEXCOORD_1,gl.UNSIGNED_BYTE,4,false]],new Uint8Array([0,1,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,1,1,0,1,0,1,0,0,0,0,0,1,1,0,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,1,1,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,0,1,1,1,0,0,1,0,0,0,0,1,0,1,2,0,0,0,1,0,1,0,0,1,0,0,2,0,0,0,0,0,1,0,1,1,1,0,2,0,1,0,0,0,0,0,1,1,1,1,2,0,1,0,1,0,0,0,0,0,1,1,2,0,1,0,1,0,0,0,0,0,1,0,2,0,1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,1,0,1,0,0,1,2,0,0,0,1,0,1,0,0]))
re=d.load({url:"img/bounds.png",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_max:gl.LINEAR,wrap_s:gl.REPEAT,wrap_t:gl.REPEAT})}},{"../common/globals":248,"../common/world_constants":267,"../glov/client/aabbtree":287,"../glov/client/cmds":298,"../glov/client/draw_list":301,"../glov/client/engine":305,"../glov/client/geom":318,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/textures":365,"../glov/common/util":400,"../glov/common/vmath":402,"./bluebox_ui":27,"./camera":35,"./huds":104,"./main":135,"./megachunk_client":139,"./settlement":181,"./voxel_chunk_manager":214,"./voxel_const":215,"./voxel_data":216}],27:[function(e,t,r){"use strict"
r.blueprintCaptureEnabled=blueprintCaptureEnabled
r.blueboxUIInit=blueboxUIInit
r.blueboxShift=blueboxShift
r.blueboxSelected=blueboxSelected
r.blueboxGetSelected=blueboxGetSelected
r.blueboxSelect=blueboxSelect
r.propCanEditPos=propCanEditPos
r.simpleSnapShotToExport=simpleSnapShotToExport
r.tickBlueboxUI=tickBlueboxUI
r.blueboxShowPreview=blueboxShowPreview
r.blueboxDrawForSnapshot=blueboxDrawForSnapshot
r.blueboxTickProp=blueboxTickProp
r.blueboxGetTitle=blueboxGetTitle
r.doBluebox=doBluebox
r.blueboxOnPlace=blueboxOnPlace
r.blueboxSelectProp=blueboxSelectProp
r.blueboxAutoSelect=blueboxAutoSelect
r.capture_preview_origin_offset=r.capture_preview_size=r.bluebox_color_bounds=void 0
var a=e("../glov/common/vmath")
var d=a.mat4
var Je=a.unit_vec
var j=a.v3add
var f=a.v3addScale
var et=a.v3copy
var n=a.v3distSq
var K=a.v3iAdd
var tt=a.v3iMax
var rt=a.v3iMin
var q=a.v3iSub
var at=a.v3same
var it=a.v3scale
var ot=a.v3set
var i=a.vec3
var o=a.vec4
var s=o(.5,.5,1,1)
r.bluebox_color_bounds=s
var nt=e("assert")
var l=e("../glov/client/cmds").cmd_parse
var _=e("../glov/client/draw_list").opaqueQueue
var c=e("../glov/client/effects")
var le=e("../glov/client/engine")
var _e=e("../glov/client/font").ALIGN
var ce=e("../glov/client/input")
var v=e("../glov/client/mat4ScaleRotateTranslate")
var ue=e("../glov/client/scroll_area").scrollAreaCreate
var st=e("../glov/client/settings")
var de=e("../glov/client/ui")
var u=e("../glov/client/ui")
var fe=u.uiButtonHeight
var ve=u.uiTextHeight
var h=e("../glov/common/util")
var X=h.deepEqual
var he=h.defaults
var pe=h.nop
var lt=h.toNumber
var p=e("../glov/common/verify")
var z=e("../common/blueprint_common").BLUEPRINT_MAX_DIM
var m=e("../common/globals")
var _t=m.CHUNK_SIZE
var ct=m.CS3
var Q=m.ID2
var $=m.ID_FACTOR
var E=e("../common/ids")
var me=E.ITEM_BLUEPRINT
var T=E.ITEM_BUCKET
var g=E.ITEM_LIQUID
var y=E.TYPE_BLOCK
var Ee=E.TYPE_ITEM
var S=e("../common/materials_common").Mat
var I=e("../common/voxel_data_common")
var ut=I.ANIM_STYLE_BEAM
var dt=I.ANIM_TYPE_POS
var A=I.TRANSACT_PROP_INV_MOD
var w=e("../common/world_constants")
var L=w.ACCESS_BUILDER
var O=w.ACCESS_OWNER
var R=e("./bluebox_edit_list")
var ft=R.blueboxEditListCheck
var vt=R.blueboxEditListCheckPoint
var b=e("./blueprint")
var ht=b.STATE_BUILD
var pt=b.STATE_EDIT
var ge=b.STATE_PAUSED
var mt=b.STATE_PRE_BUILD
var Et=b.STATE_PRE_EDIT
var gt=b.STATE_SELF_DESTRUCT
var J=b.TYPE_EDITABLE
var ee=b.blueprintGetTempDef
var Tt=b.finalizeCost
var Te=e("./build_menu").blueprintInLibrary
var yt=e("./build_mode")
var N=e("./build_mode")
var St=N.VU_TILE_BOX
var It=N.VU_TILE_ERROR
var At=N.drawUtilVoxel
var wt=N.protectBlock
var Lt=N.tempPoint
var C=e("./editvolume_client")
var x=C.editVolumeDefaultAccess
var Ot=C.editVolumeForPos
var M=C.inEditBoundsAndReady
var D=C.volumeIsSettlement
var ye=e("./file_management").uploadInProgress
var P=e("./inventory")
var Se=P.INV_PLAYER
var Rt=P.countAvailableEx
var B=P.findAddIdxList
var bt=P.inventoryEmpty
var Ie=P.inventoryGetArr
var Nt=P.inventoryLocked
var Ct=P.payCostEx
var k=P.transBucketConsume
var U=P.transInvAdd
var xt=P.transInvDec
var G=e("./inventory_ui")
var Ae=G.inventoryButton
var we=G.inventoryButtonPrep
var Mt=e("./item_anims")
var Le=e("./item_info_view").itemInfoViewShow
var Oe=e("./items")
var F=e("./items")
var Re=F.ITEM_CONTEXT_BUILD
var be=F.ITEM_CONTEXT_ITEM
var Dt=F.createItem
var Pt=F.itemIsAllowedInQuickbar
var Bt=F.notLiquid
var kt=F.sameItem
var Ut=e("./localization/localization").L
var W=e("./main")
var H=W.charControllerPos
var Gt=W.getFrameTransaction
var Ne=W.menuExit
var Ce=e("./menu")
var V=e("./menu")
var xe=V.getMenuPage
var Me=V.menuInteractGetProp
var De=V.menuX1
var Pe=V.menuY1
var Ft=e("./props")
var Y=e("./props")
var Be=Y.PIEB_CHECK_CUR_SIZE
var te=Y.inv_rot_mat
var re=Y.inv_rot_mat_flipped
var Wt=Y.propClone
var Ht=Y.rot_mat
var zt=Y.rot_mat_flipped
var ke=e("./quickbar")
var Vt=e("./status")
var ae=e("./styles")
var Ue=ae.label_style
var Ge=ae.loading_style
var ie=e("./tiles")
var Yt=ie.TILE_AIR
var jt=ie.TILE_PROP_BASE
var Kt=ie.TILE_PROP_MAX
var qt=ie.tile_map_default
var Fe=e("./ui_util")
var We=e("./user_data").worldReadOnly
var oe=e("./voxel_const").origin_chunk
var ne=e("./voxel_data")
var se=e("./voxel_data")
var Zt=se.andGetLiquid
var Xt=se.andGetProp
var Qt=se.chunkIdFromLocalIntPos
var He=se.createSimpleDrawable
var ze=se.createWorldVD
var $t=se.drawProp
var Jt=se.drawSingleVoxel
var Ve=se.exportCombinedGeometry
var er=se.getPropLocalExact
var tr=se.getTileLocal
var rr=se.getTileLocalOrQueuedPlace
var ar=se.liquidUpdateDefer
var ir=se.transPropRemove
var or=se.transPropUpdateField
var nr=se.transSetPropLocal
var sr=se.transSetTileLocal
var Ye=se.worldPosFromLocalPos
var je=e("./world_metadata")
var Ke=je.worldAccessDefault
var qe=je.worldAccessExvolume
var lr=je.worldEnforcePropPlacement
var Ze=Math.abs,_r=Math.floor,cr=Math.max,Xe=Math.min,ur=Math.random,Qe=Math.round,$e=Math.sin
nt(qt)
var dr
var fr=de.makeColorSet([.5,1,.5,1])
var vr=de.makeColorSet([.75,0,0,1])
var hr=o(0,1,0,.667)
var pr=o(1,1,1,.5)
var mr=o(1,.5,.5,.5)
var Er=o(0,1,0,.5)
st.register({blueprint_auto_resize:{default_value:1,type:l.TYPE_INT,range:[0,1]},blueprint_auto_destroy:{default_value:0,type:l.TYPE_INT,range:[0,1],help:"Placed blueprints destroy themselves if they cannot complete instead of pausing"},blueprint_rate:{type:l.TYPE_FLOAT,default_value:1,range:[.001,1e6],help:"(Admin) Adjust the rate at which blueprints build",access_run:["sysadmin"],store:false},blueprint_place_paused:{default_value:0,type:l.TYPE_INT,range:[0,1],help:"Placed blueprints start paused"}})
var gr=0
var Tr=24
l.registerValue("blueprint_capture",{type:l.TYPE_INT,help:"(Admin) Allow placing an empty blueprints over content",label:"Blueprint Capture",range:[0,1],get:function get(){return gr},set:function set(e){return gr=e},access_run:["sysadmin"]})
l.registerValue("blueprint_capture_size",{type:l.TYPE_INT,help:"(Admin) Choose size used by /blueprint_capture",label:"Blueprint Capture Size",range:[1,256],get:function get(){return Tr},set:function set(e){return Tr=e},access_run:["sysadmin"]})
function blueprintCaptureEnabled(){return gr}function blueboxUIInit(){}function blueboxShift(e){if(dr)K(dr,e)}function blueboxSelected(e){return dr&&at(dr,e)}function blueboxGetSelected(){if(!dr)return null
var e=er(dr)
if(!e||e.item_id!==me)return dr=null
return e}function blueboxSelect(e,t){if(!dr)dr=i()
et(dr,e)}function matchingItem(e,t){nt(e)
return kt(e,t)||t&&e.type===Ee&&t.type===Ee&&(e.id===T||e.id===g)&&(t.id===T||t.id===g)&&e.attr2===t.attr2}function countInList(e,t){var r=0
for(var a=0;a<t.length;++a)if(matchingItem(e,t[a]))r+=t[a].count
return r}function deposit(e,t,r,a,i,o,n){nt(!e.bluebox_unlimited)
var s=e.contents
var l=Ie()
for(var _=0;o&&_<l.length;++_){var c=l[_]
if(!matchingItem(i,c))continue
var u=Xe(o,c.count)
if(c.type===Ee&&c.id===T){var d=k(a,_,u)
if(d)a=d
else u=0}else{a=a||Gt()
xt(a,Se,_,u)}if(u){o-=u
var f=B(e,i,u,true)
nt(f)
for(var v=0;v<f.length;){var h=f[v++]
var p=f[v++]
if(n)if(s[h])s[h].count+=p
else{var m=i
if(m.count!==p)(m=Dt(i)).count=p
s[h]=m}else{a=a||Gt()
U(a,e,i,h,false,p)}}}}if(e.bluebox_state!==ht&&r){var E=false
for(var g=0;g<t.length;++g)if(countInList(t[g],s)){E=true
break}if(E)e.blueboxChangeState(a,ht,n)}return a}function depositAll(e,t,r,a,i,o){nt(!e.bluebox_unlimited)
var n=e.contents
var s=Ie()
for(var l=0;l<t.length;++l){var _=t[l]
var c=countInList(_,n)
var u=cr(_.count-c,0)
var d=countInList(_,s)
if(u&&d)i=deposit(e,r,a,i,_,Xe(u,d),o)}}var yr=2
var Sr=3
function notPropInvMod(e){return e[0]!==A}var Ir=[]
function blockToItem(e){var t=Ir[e]
if(!t){t=Ir[e]=Dt({type:y,id:e})
nt(t.cost)}return t}var Ar=[]
function liquidToItem(e){var t=Ar[e]
if(!t){var r=e
if(1&r)--r;(t=Ar[e]=Dt({type:Ee,id:g,attr1:S.ANY,attr2:r})).cost=[t]}return t}function blueboxSelfDelete(e,t){if(e)e.ops=e.ops.filter(notPropInvMod)
e=e||Gt()
t.transBusy(e)
ir(e,t,false,false)
e.bluebox_no_last_update=true
if(t.bluebox_state===gt)e.silent_error=true
return e}var wr=o(.5,.5,1,1)
var Lr=2
var Or=2
var Rr=new Int32Array([Tr,Tr,Tr])
r.capture_preview_size=Rr
var br=new Int32Array([-7,1,0])
r.capture_preview_origin_offset=br
var Nr=100
var Cr=5
var xr=15e3
function flipAmount(e,t){if(e.inv.flips_on_x)return t%2===0?2:0
else return t%2===0?0:2}function propCanEditPos(e,t,r){var a=t(r)
var i
if(a===e)i=true
else if(a&&e)i=x(a)>=L&&x(e)>=L
else{nt(a&&!e||!a&&e)
if(a&&D(a))i=false
else if(e&&D(e))i=true
else if(qe()>O)i=false
else if(e)i=Ke()>=L&&x(e)<L
else{nt(a)
i=x(a)>=L}}if(i&&!M(r))return false
return i}var Mr=function(){var Ge=[new Int32Array(3),new Int32Array(3)]
var Fe=new Int32Array(3)
var k=[new Int32Array(3),new Int32Array(3)]
var U=new Int32Array(3)
function getBounds(e,t){if(t[0]<0){Ge[0][0]=e[0]+t[0]+1
Ge[1][0]=e[0]
Fe[0]=-t[0]}else{Ge[0][0]=e[0]
Ge[1][0]=e[0]+t[0]-1
Fe[0]=t[0]}if(t[1]<0){Ge[0][1]=e[1]+t[1]+1
Ge[1][1]=e[1]
Fe[1]=-t[1]}else{Ge[0][1]=e[1]
Ge[1][1]=e[1]+t[1]-1
Fe[1]=t[1]}Ge[0][2]=e[2]
Ge[1][2]=e[2]+t[2]-1
Fe[2]=t[2]}function showBounds(){At(St,Ge[0],s,et(Lt(),Fe),Sr+Fe[2]/2)
At(St,[Ge[1][0]+1,Ge[1][1]+1,Ge[1][2]+1],s,[-Fe[0],-Fe[1],-Fe[2]],Sr+Fe[2]/2)}var We
var He
function checkBounds(e,t,r,a,i,o,n){if(r&&i.is_preview)showBounds()
if(a)for(U[2]=Ge[0][2];U[2]<=Ge[1][2];++U[2])for(U[1]=Ge[0][1];U[1]<=Ge[1][1];++U[1])for(U[0]=Ge[0][0];U[0]<=Ge[1][0];++U[0]){var s=false
if(tr(U))if(!a[U.join(",")]){if(r){At(It,U,yt.color_prop_blocked,Je,yr)
s=true}He=false}if(Zt(0))if(!a["L"+U.join(",")]){if(r){At(It,U,yt.color_prop_blocked,Je,yr)
s=true}He=false}if(!s&&o)if(vt(U,i,n)){We=false
if(r)At(It,U,yt.color_prop_blocked,Je,yr)}}else He=false}function checkPosBlocked(e){if(tr(U,0,true))return true
var t
if(e)t=rr(U)
else t=tr(U)
if(t){if(t===jt){var r=Xt()
if(r&&r.vacate)return false}return true}return false}var ze=new Int32Array(3)
var G=new Int32Array(3)
var F=[[0,0,0,-1,0,2,1,0,"-Y"],[1,0,0,1,1,2,0,1,"+X"],[0,1,0,1,0,2,1,2,"+Y"],[0,0,0,-1,1,2,0,3,"-X"],[0,0,1,1,0,1,2,-1,"+Z"]]
var W=[[0,0,1],[0,1,1],[1,0,-1],[1,1,-1]]
var H=[[1,0,-1],[1,1,-1],[0,0,1],[0,1,1]]
function checkResize(e,t,r){if(!st.blueprint_auto_resize||Nt(t)||t.trans_busy)return e
var a=t.rot,i=t.flipped
et(k[0],Ge[0])
et(k[1],Ge[1])
var o=false
var n=true
var s=gr?Tr:z
var l=(a+2)%4
var _
do{_=false
for(var c=0;c<F.length;++c){var u=F[c]
var d=u[7]
if(d===a)continue
var f=u[8]
var v=u[4]
var h=u[5]
var p=u[6]
var m=k[1][v]-k[0][v]+1
var E=k[1][h]-k[0][h]+1
var g=k[1][p]-k[0][p]+1
ot(U,k[u[0]][0],k[u[1]][1],k[u[2]][2])
var T=U[v]
var y=U[h]
var S=true
if(1===g||U[p]===ze[p])S=false
for(var I=0;I<m&&S;++I){U[v]=T+I
for(var A=0;A<E;++A){U[h]=y+A
if(checkPosBlocked(true)){S=false
break}}}if(S){if(d===l){if(g<=Or)continue}else switch(f){case"+Z":if(k[1][2]-k[0][2]<Lr)continue
break
case"-X":if(k[0][0]>=ze[0]-1)continue
break
case"+X":if(k[1][0]<=ze[0]+1)continue
break
case"-Y":if(k[0][1]>=ze[1]-1)continue
break
case"+Y":if(k[1][1]<=ze[1]+1)continue
break
default:nt(0)}U[p]-=u[3]
var w=true
for(var L=0;L<m&&w;++L){U[v]=T+L
for(var O=0;O<E;++O){U[h]=y+O
if(checkPosBlocked(true)){w=false
break}}}if(w){o=true
k[u[3]>0?1:0][p]=U[p]
_=true}}else{if(d===l){if(g>=s)continue}else if(k[1][p]-k[0][p]+1>=s)continue
U[p]+=u[3]
U[v]=T
U[h]=y
G[v]=m
G[h]=E
G[p]=1
var R=true
if(ft(U,G))R=false
if(R)for(var b=0;b<m;++b){U[v]=T+b
for(var N=0;N<E;++N){U[h]=y+N
if(checkPosBlocked(false)){R=false
if(!r)At(It,U,wr,Je,yr)
n=false}}}if(R){_=o=true
k[u[3]>0?1:0][p]=U[p]}}}}while(_)
if(o)n=false
if(r)return n
if(o){e=e||Gt()
var C=[k[1][0]-k[0][0]+1,k[1][1]-k[0][1]+1,k[1][2]-k[0][2]+1]
if(1===a||3===a){var x=C[0]
C[0]=C[1]
C[1]=x}if(!at(C,t.bluebox_size)){or(e,t,"bs","bluebox_size",C)
e.silent_error=true}var M=(i?H:W)[a]
var D=k[M[0]][M[1]]-Ge[M[0]][M[1]]
if(D){var P=t.bluebox_origin_offset
var B=[P[0]+D*M[2],P[1],P[2]]
or(e,t,"bo","bluebox_origin_offset",B)}t.blueboxUpdatePos()
t.transBusy(e)
nt(e.ops.length)}return e}var Ve=new Int32Array([3,2,2])
var Ye=new Int32Array([-1,1,0])
var je=-2
var Ke=new Int32Array(3)
var qe=new Int32Array(3)
var Ze=new Int32Array(3)
var Xe=new Int32Array(3)
var Qe=new Int32Array(3)
var $e=new Int32Array([z,z,z])
return function blueboxEvaluateImp(u,e){var t=e.do_build,r=e.draw_debug,a=e.highlight_good,i=e.show_blocked_ghosts,o=e.check_bounds,n=e.do_transitions,s=e.place_preview
var l=8e3
if(Nt(u)||u.trans_busy)n=t=false
if(gr){ot(Rr,Tr,Tr,Tr)
br[0]=_r(-(Tr-1)/2)}var _=r&&!s
var c=_||s
var d=[]
var f=[]
var v=u.blueprint_def,h=u.rot,p=u.flipped,m=u.bluebox_state,E=u.bluebox_unlimited
nt(v.loaded)
if(!v.subscribe())n=t=false
var g=t
var T=v.origin_offset,y=v.size
nt(T)
if(m===pt){T=u.bluebox_origin_offset
y=u.bluebox_size
if(v.isEmptyEditable()&&s)if(gr){y=Rr
T=br}else{y=Ve
T=Ye}nt(T&&y)}if(!y)y=$e
var S=(p?zt:Ht)[h]
u.getLocalPos(ze)
Ke[0]=ze[0]+T[0]*S[0]+T[1]*S[1]
Ke[1]=ze[1]+T[0]*S[2]+T[1]*S[3]
Ke[2]=ze[2]+T[2]
var I=null
ot(Qe,y[0]*S[0]+y[1]*S[1],y[0]*S[2]+y[1]*S[3],y[2])
getBounds(Ke,Qe)
if(m===pt){if(u.is_preview)showBounds()
var A
if(n)I=checkResize(I,u,false)
else if(o)A=checkResize(null,u,true)
return{trans:I,cost:[],cost_clear:[],bounds_stable:A}}function checkEject(e,t){var r=true
var a=u.contents
var i
for(var o=0;o<a.length;++o){var n=a[o]
if(!n)continue
var s=countInList(n,d)
var l=n.count-s
if(l>0){if(!i)i=u.findDropOptions(false,e,t)
if(!i.length){r=false
Vt.get("nodrop").setMessage(Ut.STATUSMSG_BBOX_CANNOT_EJECT)}else{I=I||Gt()
var _=i[_r(ur()*i.length)]
var c=Dt(n)
c.count=l
u.getLocalPos(Ze)
if(Bt(c))Ft.bagAddTrans(I,{target_pos:_,item:c,src_pos:Ze,emptied_pos:null,is_update_func:true})
xt(I,u,o,l)}}}return r}if(m===gt){if(t)if(checkEject())if(n)I=blueboxSelfDelete(I,u)
return{trans:I,cost:[],cost_clear:[]}}var w=r&&m===Et
var L
if(o=o||m===Et)L={}
var O=[Infinity,Infinity,Infinity]
var R=[-Infinity,-Infinity,-Infinity]
var b=false
var N=true
We=He=true
var C=false
var x=false
function checkFailed(e,t){N=false
if(r&&l){--l
At(t?St:It,e,yt.color_prop_blocked,Je,yr)}}function addPosRot(e){var t=qe[0]+(15&e)
var r=qe[1]+((240&e)>>4)
Ze[0]=Ke[0]+t*S[0]+r*S[1]
Ze[1]=Ke[1]+t*S[2]+r*S[3]
Ze[2]=Ke[2]+qe[2]+((3840&e)>>8)}var M={}
function getTile(e){var t=tr(e,-1,false)
if(t===jt&&at(e,ze))return 0
if(!t)return M[e.join(",")]||0
return t}var D=v.chunk_map,P=v.owner_id
var B=t>=Nr
var k=ft(Ge[0],Fe,u)
var U=false
if(k)if(U=ft(Ge[0],Fe,u,P))We=false
var G=[]
var F={}
function volumeForPos(e){var t=Qt(e)
var r=F[t]
if(!r)r=F[t]=Ot(e)
return r}var W=volumeForPos(ze)
var H=propCanEditPos.bind(null,W,volumeForPos)
var z=Object.keys(D).map(lt)
for(var V=0;V<z.length;++V){var Y=D[z[V]]
var j=Y.data
if(j){it(qe,Y.pos,_t)
for(var K=0;K<ct;++K){var q=j[K]
if(qt[q].unplaceable)q=0
if(!q||q>=jt&&q<=Kt)continue
if(q===Yt)q=0
addPosRot(K)
if(L)L[Ze.join(",")]=true
rt(O,Ze)
tt(R,Ze)
var Z=getTile(Ze)
if(-1===Z){N=false
continue}if(!E&&q&&q!==Z)q=qt[q].limited_blueprint||q
if(q&&Z&&q!==Z){q=qt[q].blueprint||q
Z=qt[Z].blueprint||Z}if(q===Z){if(a&&l){--l
At(St,Ze,Er,Je,yr)}continue}var X=void 0
if(q){X=blockToItem(q)
for(var Q=0;Q<X.cost.length;++Q)d.push(X.cost[Q])}if(U&&vt(Ze,u,P)){We=false
Z=-1}if(Z===jt){var $=Xt()
if($&&$.vacate&&H(Ze)){Z=0
if(t){I=I||Gt()
ir(I,$,true,false)
G.push($)}}}if(Z||!H(Ze)){checkFailed(Ze)
continue}if(!q)continue
for(var J=0;J<X.cost.length;++J)f.push(X.cost[J])
M[Ze.join(",")]=q
if(_&&l){--l
Jt({tile:q,pos:et(Lt(),Ze),color:pr,sort_bias:yr})}if(g)if(E||Rt(u,X))if(t){--t
I=I||Gt()
if(!E)Ct(I,u,X)
if(!B)Mt.add({style:ut,target_type:dt,target:Ze,src_type:dt,src:ze,item:X})
sr(I,Ze,q,false,false,Z,true)
var ee=tr(Ze,0,true)
if(ee)sr(I,Ze,0,true,false,ee,true)
wt(Ze)}else x=true
else b=true
else C=true}}}var te=u.bluebox_previously_placed
for(var re=0;re<z.length;++re){var ae=z[re]
var ie=D[ae]
var oe=ie.props
it(qe,ie.pos,_t)
for(var ne in oe){var se=oe[ne=Number(ne)]
if(!Pt(se.toItem())||!se.inv.placeable)continue
addPosRot(ne)
var le=(se.size[0]-1)*S[0]+(se.size[1]-1)*S[1]
var _e=(se.size[0]-1)*S[2]+(se.size[1]-1)*S[3]
if(le<0){Ze[0]+=le
le=-le}if(_e<0){Ze[1]+=_e
_e=-_e}rt(O,Ze)
tt(R,[Ze[0]+le,Ze[1]+_e,Ze[2]+se.size[2]])
var ce=er(Ze)
if(ce)if(kt(ce.toItem(),se.toItem())){if(a&&l){--l
At(St,Ze,Er,[le+1,_e+1,se.size[2]],yr)}if(L)for(var ue=0;ue<=_e;++ue){Xe[1]=Ze[1]+ue
for(var de=0;de<=le;++de){Xe[0]=Ze[0]+de
for(var fe=0;fe<se.size[2];++fe){Xe[2]=Ze[2]+fe
L[Xe.join(",")]=true}}}continue}var ve=(se=se.blueprintFilter(true,true)).toItem()
var he=ve.cost
nt(he)
d=d.concat(he)
var pe=false
for(var me=0;me<=_e;++me){Xe[1]=Ze[1]+me
for(var Ee=0;Ee<=le;++Ee){Xe[0]=Ze[0]+Ee
if(lr()&&(se.inv.rooted||se.groundFilter)){Xe[2]=Ze[2]-1
var ge=getTile(Xe)
if(ge&&se.groundFilter&&!se.groundFilter(ge))ge=0
if(ge>=jt&&ge<=Kt){var Te=Xt()
if(!Te||Te.inv.intangible)ge=0}if(!ge){checkFailed(Xe,true)
pe=true}}for(var ye=0;ye<se.size[2];++ye){Xe[2]=Ze[2]+ye
var Se=Xe.join(",")
if(L)L[Se]=true
var Ie=getTile(Xe)
if(Ie===jt){var Ae=Xt()
if(Ae&&Ae.vacate){Ie=0
if(t){I=I||Gt()
ir(I,Ae,true,false)
G.push(Ae)}}}if(m===mt&&te&&te[ae+","+ne]&&Zt(0)){checkFailed(Xe)
pe=true}if(U&&vt(Xe,u,P)){We=false
Ie=-1}if(Ie||!H(Xe)){checkFailed(Xe)
pe=true}else M[Se]=je}}}var we=null
if(_||c&&!(se.baked&&se.baked.key))if(pe){if(i)we=mr}else we=pr
if(we||t&&!pe){(se=Wt(se,true)).size[0]=le+1
se.size[1]=_e+1
se.setRot(se.inv.no_auto_rot?0:se.rot+h+(p?flipAmount(se,se.rot):0))}if(we&&l){--l
se.allowAlpha()
se.draw_opts.color=we
se.draw_opts.unlit=true
se.draw_opts.z_bias=-.03
$t(se,et(Lt(),Ze))}if(pe)continue
f=f.concat(he)
if(g)if(E||Rt(u,ve))if(t){t=cr(0,t-Cr)
I=I||Gt()
if(!E)Ct(I,u,ve)
if(!B)Mt.add({style:ut,target_type:dt,target:Ze,src_type:dt,src:ze,item:ve});(se=se.blueprintFilter(true,true)).updateBeforePlace(Ze,null,true)
if(!te)te=u.bluebox_previously_placed={}
te[ae+","+ne]=true
nr(I,Ze,se,true,at(Ze,ze))
wt(Ze)}else x=true
else b=true
else C=true}}var Le=false
for(var Oe=0;Oe<z.length;++Oe){var Re=z[Oe]
var be=D[Re]
var Ne=be.liquid
it(qe,be.pos,_t)
if(Ne)for(var Ce=0;Ce<ct;++Ce){var xe=Ne[Ce]
if(!xe)continue
if(xe===Yt)xe=0
addPosRot(Ce)
if(L)L["L"+Ze.join(",")]=true
rt(O,Ze)
tt(R,Ze)
var Me=liquidToItem(xe)
var De=getTile(Ze)
var Pe=Zt(-1)
if(xe!==Pe)d.push(Me)
if(xe===Pe){if(a&&l){--l
At(St,Ze,Er,Je,yr)}continue}if(U&&vt(Ze,u,P)){We=false
De=-1}if(Pe||!H(Ze)){checkFailed(Ze)
continue}if(De>=jt&&De<=Kt){var Be=Xt()
if(Be&&Be.flowThrough())De=0}if(De===je)De=0
if(De&&xe){checkFailed(Ze)
continue}if(m===mt&&te&&te["L"+Re+","+Ce])continue
f.push(Me)
if(_&&l){--l
Jt({is_liquid:true,tile:xe,pos:et(Lt(),Ze),color:pr,sort_bias:yr})}if(g)if(E||Rt(u,Me))if(t){Le=true
I=I||Gt()
if(!E)Ct(I,u,Me)
if(!B)Mt.add({style:ut,target_type:dt,target:Ze,src_type:dt,src:ze,item:Me})
if(!te)te=u.bluebox_previously_placed={}
te["L"+Re+","+Ce]=true
sr(I,Ze,xe,true,false,Pe,true)
ar(Qt(Ze))}else x=true
else b=true
else C=true}}if(Le)--t
if(w||o)checkBounds(Ke,Qe,w,L,u,k,P)
d=Tt({},{},d)
f=Tt({},{},f)
for(var ke=0;ke<G.length;++ke){var Ue=G[ke]
Ue.getLocalPos(Ze)
Ue.vacate(I,Ze,true)}if(t)if(!checkEject(O,R))N=false
if(b||x||!N)C=true
if(I)I.compact()
if(g&&m===ht&&!x&&bt(u))if(!C||st.blueprint_auto_destroy)I=blueboxSelfDelete(I,u)
else{I=I||Gt()
u.blueboxChangeState(I,mt)}if(n&&m===mt&&st.blueprint_auto_destroy&&!x&&bt(u))I=blueboxSelfDelete(I,u)
if(n&&m===Et)if(C){if(!I){I=Gt()
u.blueboxChangeState(I,mt)
I.silent_error=true}}else if(He&&We&&!C)if(!I){I=Gt()
u.blueboxChangeState(I,pt)
I.silent_error=true}return{trans:I,cost:d,cost_clear:f,build_all:N,build_incomplete:C,bounds_clear:He,bounds_clear_edit:We}}}()
var Dr=function(){var _=i()
var c=i()
var u=i(.5,.5,0)
return function blueboxDrawForSnapshotInternalImp(e,t){(t=t||{}).alpha_queue=true
var r=e.blueprint_def,a=e.quat
if(null===e.chunk_id)ot(c,0,0,0)
else e.getLocalPos(c)
K(c,u)
nt(r.loaded)
var i=r.chunk_map,o=r.origin_offset
nt(o)
var n=e.preview_mat
if(!n)n=e.preview_mat=d()
v(n,1,a,c)
if(e.flipped){t.flipped=true
it(n,n,-1)}for(var s in i){var l=i[s]
if(l.ver_meshing!==l.geom_ver_meshing){l.updateGeometrySimple({need_offs:true})
f(_,o,l.pos,_t)
it(_,_,-1)
K(_,u)
K(_,Je)
l.bluebox_drawable=He(l,_)}l.bluebox_drawable.drawMat(n,t)}}}()
function simpleSnapShotToExport(e){var t=e
var r=new Uint16Array
var a=t.chunk_map
for(var i in a){var o=a[i]
var n=o.updateAndReturnGeometry(o.pos)
var s=r.length+n.length
var l=new Uint16Array(s)
l.set(r,0)
l.set(n,r.length)
r=l}Ve(r,t.name)}var Pr=function(){var k=new Int32Array(3)
var U=new Int32Array(3)
var G=new Int32Array(3)
var F=new Int32Array(3)
var W=new Int32Array(3)
var H=0
var z=1
var V=2
var Y=0
return function blueboxSerializeDefFn(e,t){var r=e.blueprint_def,a=e.rot,i=e.flipped,o=e.bluebox_last_serialized_def,n=e.bluebox_last_serialized_chunk_deps
nt(r)
nt(r.loaded)
nt(r.channel)
nt.equal(r.type,J)
var s=e.bluebox_origin_offset.slice(0)
var l=e.bluebox_size.slice(0)
var _=(i?zt:Ht)[a]
var c=(i?re:te)[a]
e.getLocalPos(G)
k[0]=G[0]+s[0]*_[0]+s[1]*_[1]
k[1]=G[1]+s[0]*_[2]+s[1]*_[3]
k[2]=G[2]+s[2]
var u={}
for(var d=0;;){var f=(_r((k[2]+d)/_t)+oe[2])*Q
for(var v=0;;){for(var h=0;;){U[0]=h*_[0]+v*_[1]
U[1]=h*_[2]+v*_[3]
var p=_r((k[0]+U[0])/_t)+oe[0]+(_r((k[1]+U[1])/_t)+oe[1])*$+f
var m=ne.chunk_map[p]
u[p]=(m&&m.ver_data||0)+(m&&m.ver_props||0)
if(h===l[0]-1)break
h=Xe(h+16,l[0]-1)}if(v===l[1]-1)break
v=Xe(v+16,l[1]-1)}if(d===l[2]-1)break
d=Xe(d+16,l[2]-1)}if(n)if(X(n,u))return o
var E=[-s[0],0,0]
var g=[-s[0],0,0]
for(var T=0;T<l[2];++T){F[2]=k[2]+T
for(var y=0;y<l[1];++y)for(var S=0;S<l[0];++S){U[0]=S*_[0]+y*_[1]
U[1]=S*_[2]+y*_[3]
F[0]=k[0]+U[0]
F[1]=k[1]+U[1]
if(tr(F,0,false)||Zt()){ot(W,S,y,T)
rt(E,W)
tt(g,W)}}}j(l,g,Je)
K(s,E)
q(l,E)
k[0]=G[0]+s[0]*_[0]+s[1]*_[1]
k[1]=G[1]+s[0]*_[2]+s[1]*_[3]
k[2]=G[2]+s[2]
var I=ee()
et(I.origin_offset,s)
I.name=r.name
et(I.size,l)
function set(e,t,r,a,i){var o=(-16&e)>>4
var n=(-16&t)>>4
var s=(-16&r)>>4
var l=s*Q+n*$+o
var _=I.chunk_map[l]
if(!_)(_=I.chunk_map[l]=ze(o,n,s,l)).main_world=false
ot(W,15&e,15&t,15&r)
switch(i){case H:if(!_.data)_.alloc()
a=qt[a].blueprint||a
_.setUnchecked(W,a)
break
case z:if(!_.liquid)_.alloc(true)
_.setUncheckedLiquid(W,a)
break
case V:var c=W[2]*_.stride2+W[1]*_.stride1+W[0]
if(!_.props)_.props={}
a.setPos(W)
var u=a
if((_.props[c]=u).baked){if(!_.baked_props)_.baked_props={}
_.baked_props[c]=u.baked}if(u.draw){if(!_.drawable_props)_.drawable_props={}
_.drawable_props[c]=u}if(!_.data)_.alloc()
_.setUnchecked(W,jt)
break
default:nt(0)}}I.has_fallbacks=false
for(var A=0;A<l[2];++A){F[2]=k[2]+A
for(var w=0;w<l[1];++w)for(var L=0;L<l[0];++L){U[0]=L*_[0]+w*_[1]
U[1]=L*_[2]+w*_[3]
F[0]=k[0]+U[0]
F[1]=k[1]+U[1]
var O=tr(F,0,false)
if(O)if(O===jt){var R=Xt()
nt(R)
var b=Wt(R,false).blueprintFilter(false,false)
if(b){if(b.fallback)I.has_fallbacks=true
var N=L
var C=w
var x=[U[0]+R.size[0],U[1]+R.size[1]]
var M=x[0]*c[0]+x[1]*c[1]-N
var D=x[0]*c[2]+x[1]*c[3]-C
if(M<0){N+=M+1
M=-M}if(D<0){C+=D+1
D=-D}b.size[0]=M
b.size[1]=D
var P=R.rot-a
b.setRot(R.inv.no_auto_rot?0:P+(i?flipAmount(R,P):0))
set(N,C,A,b,V)}}else if(O<jt)set(L,w,A,O,H)
var B=Zt()
if(B)set(L,w,A,B,z)}}I.ver=-Y++
I.loaded=true
e.bluebox_last_serialized_def=I
e.bluebox_last_serialized_chunk_deps=u
if(t)I.calcCost()
return I}}()
var Br=256
var kr=256
var Ur={}
function blueboxSaveDef(a){var e=Pr(a,false)
var t=a.blueprint_def
var r=Ur[t.bid]
nt(r)
r.blueprint_def=e
var i
r.updateThumbnail({item_context:Re,snapshot_backdrop:Oe.sprite_blueprint_bg,snapshot_res:Br,snapshot_post:function snapshot_post(){c.clearAlpha()
var e=le.canvas
var t=document.createElement("canvas")
t.width=Br
t.height=kr
t.getContext("2d").drawImage(e,0,le.height-kr,Br,kr,0,0,Br,kr)
i=t.toDataURL("image/jpeg",.92)},force_update:true})
nt(i)
var o={snapshot:{data:i,w:Br,h:kr}}
if(blueprintCaptureEnabled())e.c=1
t.saveBlueprint(e,o,function(e,t){if(!e){a.bluebox_saved_at=Date.now()
nt(t.ver&&t.ver!==a.bluebox_ver)
if(!a.removed){var r=Gt()
or(r,a,"bv","bluebox_ver",t.ver)
nt(r.ops.length)}}})}function blueboxEvaluateAndCheckResources(e,t){t=he(t,{do_build:false,draw_debug:true,do_transitions:true})
var r=Mr(e,t)
var a=r.cost,i=r.cost_clear,o=r.trans,n=r.build_incomplete
var s=true
var l=0
var _=false
if(e.bluebox_unlimited)_=i.length>0
else{var c=e.contents
for(var u=0;u<a.length;++u){var d=a[u]
if(countInList(d,c)<d.count){s=false
l++}}for(var f=0;f<i.length;++f)if(countInList(i[f],c))_=true}r.resources_all=s
r.resources_missing=l
r.resources_any_clear=_
if(!Nt(e)&&!e.trans_busy){if(e.bluebox_state===mt&&_){o=o||Gt()
e.blueboxChangeState(o,ht)
o.silent_error=true}if(e.bluebox_state===mt&&bt(e)&&!n){var v=e.blueprint_def
if(v&&v.loaded&&!v.isEditable()){Vt.push(Ut.STATUSMSG_BP_COMPLETELY_BUILT)
o=blueboxSelfDelete(o,e)}}}r.trans=o
return r}var Gr=o(1,0,0,1)
var Fr=o(.5,.5,1,1)
var Wr=o(1,1,0,1)
var Hr=new Int32Array(3)
function tickBlueboxUI(){var e=blueboxGetSelected()
if(!e)return
if(!e.blueprint_def.loaded)return
if(!e.inEditBounds(Be))return
e.getLocalPos(Hr)
if(n(H(),Hr)>3*_t*_t*3){dr=null
return}var t=blueboxEvaluateAndCheckResources(e,{draw_debug:true})
var r=t.build_all,a=t.bounds_clear,i=t.bounds_clear_edit,o=t.resources_all
if(e.bluebox_state===pt){Wr[3]=Ze($e(.005*le.frame_timestamp))
At(St,Hr,Wr)}else if(!(r&&o&&a&&i)){Gr[3]=Ze($e(.005*le.frame_timestamp))
At(St,Hr,Gr)}else{Fr[3]=.25*Ze($e(.005*le.frame_timestamp))
At(St,Hr,Fr)}}function blueboxShowPreview(e){var t=e.blueprint_def
var r=Mr(e,{do_build:false,draw_debug:true,highlight_good:true,show_blocked_ghosts:true,do_transitions:false,place_preview:true,check_bounds:t.isEmptyEditable()&&!gr})
var a={noprops:true,color:pr,unlit:true}
_(Dr.bind(null,e,a))
var i=r.build_incomplete
if(t.isEditable()&&!i){if(e.bluebox_state!==pt){e.bluebox_state=pt
e.updateRuntimeBehaviour()}}else if(e.bluebox_state!==ht){e.bluebox_state=ht
e.updateRuntimeBehaviour()}}function blueboxDrawForSnapshot(e){Dr(e)}function expTicks(e){var t=_r((e-7)/2)
return e<5?0:e<8?1:2+t*(t-1)+(!(1&e)?t:0)}function blueboxTickProp(e,t){nt(t)
if(e.bluebox_unlimited&&e.bluebox_state===ht){var r=e.bluebox_done_ticks
var a=expTicks(e.bluebox_total_ticks)
t=a-r
e.bluebox_done_ticks=a
if(!p(t>=0))return null
if(!t)return null
var i=Xe(Qe(Nr*st.blueprint_rate),xr)
if(t>i){var o=t-i
e.bluebox_done_ticks-=o
t-=o}}return Mr(e,{do_build:t,draw_debug:false,do_transitions:true}).trans}function cmpItem(e,t){if(e.type!==t.type)return e.type-t.type
if(e.id!==t.id)return e.id-t.id
if(e.attr1!==t.attr1)return e.attr1<t.attr1?-1:1
if(e.attr2!==t.attr2)return e.attr2<t.attr2?-1:1
return e.attr3-t.attr3}var zr={label:Ut.BTN_DEPOSIT_ALL}
var Vr={label:Ut.BTN_SAVE}
var Yr={label:Ut.BTN_REMOVE_BBOX}
var jr={label:Ut.BTN_PAUSE}
var Kr={label:Ut.BTN_RESUME}
var qr={label:Ut.BTN_INFO}
var Zr=[]
Zr[ge]=Fe.BLUEBOX_PRE_BUILD
Zr[mt]=Fe.BLUEBOX_PRE_BUILD
Zr[ht]=Fe.BLUEBOX_BUILD
Zr[Et]=Fe.BLUEBOX_PRE_EDIT
Zr[pt]=Fe.BLUEBOX_EDIT
Zr[gt]=Fe.BLUEBOX_PRE_EDIT
var Xr=8
var Qr
var $r
function blueboxGetTitle(){return Qr}function doBluebox(e){var t=Z.UI
var r=Pe()
var a=0
var i=De()-a
var o=r-e
var n=e
var s=le.font
var l=ve()
Qr=Ut.LBL_BLUEPRINT
var _=Me()
if(!_){dr=null
if(xe()===Ce.BLUEBOX)Ne()
return}_.getLocalPos(Hr)
blueboxSelect(Hr,false)
var c=_.bluebox_state,u=_.blueprint_def,d=_.bluebox_unlimited
if(u.error){s.drawSizedAligned(Ge,a,e,t,l,_e.HVCENTER,i,2*o/3,Ut.$(Ut.BBOX_BP_DATA_ERROR,u.error))
Qr=Ut.LBL_BLUEPRINT_ERROR
return}if(!u.loaded){u.lazyLoad()
s.drawSizedAligned(Ge,a,e,t,l,_e.HVCENTER,i,2*o/3,Ut.BBOX_BP_DATA_LOADING)
Qr=Ut.LBL_BLUEPRINT_LOADING
return}if(Nt(_)||Nt(Se)){s.drawSizedAligned(Ge,a,e,t,l,_e.HVCENTER,i,2*o/3,Ut.BBOX_REFRESHING_STATE)
Qr=Ut.LBL_BLUEPRINT_LOADING
return}var f=false
var v
if(u.isEditable()){Qr=Ut.LBL_EDITABLE_BLUEPRINT
v=f=u.isMyBlueprint()}else v=Te(u.bid)
Qr=Ut.separateColon(Qr,u.name)
var h=_.contents
var p=Ie()
var m=blueboxEvaluateAndCheckResources(_,{draw_debug:true,check_bounds:u.isEditable()})
var E=m.cost,g=m.cost_clear,T=m.build_all,y=m.bounds_clear,S=m.bounds_clear_edit,I=m.resources_all,A=m.resources_missing,w=m.resources_any_clear
var L
if(c===pt)E=(L=Pr(_,true)).cost
var O=100
var R={x:a+i/2-O-4,y:n+=Xr,z:t,w:O,h:O,frame:Zr[c]}
Fe.sprite.draw(R)
var b={x:a+i/2+4,y:n,z:t,w:O,h:O,dynamic_snapshot_on_mouseover:true,draw_only:true,hide_count:true,tooltip:null,snapshot_backdrop:Oe.sprite_blueprint_bg,no_perframe_limit:true,shrink:1,item_context:Re}
b.z++
var N=Ur[u.bid]
if(!N)N=Ur[u.bid]=Dt({type:Ee,id:me,attr1:u.bid,attr2:1})
N.blueprint_def=L||u
we(b,N)
b.img.draw(b)
n+=O+Xr
if(!$r)$r=ue({z:Z.UI,background_color:null,auto_hide:true})
$r.keyboardScroll()
$r.begin({x:a,y:n,w:i,h:r-n})
n=0
var C=[]
var x=[]
function addButton(e,t){x[C.length]=t
C.push(e)}function statusLine(e){s.drawSizedAligned(Ue,a,n,t,l,_e.HCENTER,i,0,e)
n+=l+Xr}var M=false
var D=T
if(c===Et&&!E.length);else{var P=d&&c!==pt?Ut.LBL_LEFT_TO_BUILD:Ut.LBL_REQUIRED_RESOURCES
statusLine(P=E.length?Ut.addColon(P):Ut.separateColon(P,Ut.LBL_NONE_RESOURCES.upper()))
E.sort(cmpItem)
var B=E.length>15?9:5
var k=Xe(B,E.length)
var U=0
var G=d||c===pt
for(var F=0;F<E.length;++F){var W=a+(i-(O+Xr)*k-Xr)/2+(O+Xr)*U
var H=E[F]
var z={x:W,y:n,w:O,z:t,disabled:true,base_name:"inv_info",item_context:be}
var V=countInList(H,h)
var Y=d?Infinity:countInList(H,p)
var j=cr(0,H.count-V)
var K=0
if(!G){z.count_override=Ut.$(Ut.FORMAT_FRACTION,V,H.count)
if(!j){z.base_name="inv_info"
Fe.sprite.draw(he({color:hr,h:O,z:t+.5,frame:Fe.CHECK},z))}else if(Y){z.base_name="inv_active"
K=Xe(j,Y)
M=true
z.tooltip=Ut.$(Ut.TLTP_DEPOSIT_RESOURCE,K,H.getName())
z.disabled=false
z.colors=fr
if(K!==j)D=false
else if(1===A&&T)z.in_event_cb=ce.pointerLockEnter}else{z.base_name="inv_info"
z.colors=vr
D=false}}if(Ae(z,H)&&K){deposit(_,g,T,null,H,K,false)
if(z.in_event_cb)Ne()}if(++U===B||F===E.length-1){U=0
k=Xe(E.length-F-1,B)
n+=O+Xr}}if(!I&&!M)statusLine(Ut.BBOX_NO_MATCHING_RESOURCES)
if(!I)statusLine(Ut.BBOX_MISSING_RESOURCES)}if(c===Et){if(!S)statusLine(Ut.BBOX_OVERLAPS_ANOTHER_EDITED_BP)
if(!y)statusLine(Ut.BBOX_MUST_CLEAR_BOUNDS)}if(c===mt||c===ht||c===ge){if(!T)statusLine(Ut.BBOX_SOMETHING_BLOCKING)
if(!S)statusLine(Ut.BBOX_OVERLAPS_EDITED_BP)
if(!d)addButton(zr,!M)
if(f&&u.isEditable())statusLine(Ut.BBOX_TO_EDIT_FINISH_AND_PLACE)}if(c===ht||c===mt)addButton(jr)
else if(c===ge)addButton(Kr)
var q=true
var X=false
if(c===pt){var Q=!f||u.saving||ye()||L.has_fallbacks
if(u.saving)statusLine(Ut.MSG_SAVING)
else if(L.has_fallbacks)statusLine(Ut.BBOX_HAS_FALLBACKS_SAVE)
else{if(ye())statusLine(Ut.BBOX_WAITING_PREVIOUS_SAVE)
if((X=_.bluebox_ver!==u.ver)&&f){statusLine(Ut.BBOX_MODIFIED_ELSEWHERE_MSG_WARNING)
statusLine(Ut.BBOX_MODIFIED_ELSEWHERE_MSG_OVERWRITE)
statusLine(Ut.BBOX_MODIFIED_ELSEWHERE_MSG_EDIT)}if((q=_.blueprint_def.equals(L))&&_.blueprint_def.img_url){Q=true
statusLine(_.bluebox_saved_at&&Date.now()-_.bluebox_saved_at<1e4?Ut.BBOX_BP_SAVED:Ut.BBOX_NO_CHANGES_DETECTED)}else if(!f)statusLine(Ut.$(Ut.BBOX_CANNOT_SAVE_OWNED_BY,u.owner_id))
if(X&&q){var $=Gt()
or($,_,"bv","bluebox_ver",u.ver)
nt($.ops.length)}}addButton(Vr,Q)}addButton(Yr,u.saving)
addButton(qr,u.deleted||!v)
var J=260
var ee=36
var te=Xe(C.length,3)
var re=a+(i-((J+Xr)*te-Xr))/2
for(var ae=0;ae<C.length;++ae){var ie=null
var oe=C[ae]
if(!ce.touch_mode)if(oe===Yr||oe===zr&&D)ie=ce.pointerLockEnter
var ne=C[ae].label
if(de.buttonText({x:re,y:n,z:t,font_height:ee,w:J,text:ne,disabled:x[ae],colors:!x[ae]&&oe===zr?fr:void 0,in_event_cb:ie})){switch(oe){case jr:_.blueboxChangeState(null,ge,false)
break
case Kr:_.blueboxChangeState(null,w?ht:mt,false)
break
case zr:depositAll(_,E,g,D,null)
break
case Vr:blueboxSaveDef(_)
break
case Yr:if(!q&&!u.deleted)de.modalDialog({title:Ut.DLG_UNSAVED_CHANGES_TITLE,text:Ut.DLG_UNSAVED_CHANGES_MSG,buttons:{yes:{cb:function cb(){if(!_.removed&&_.inEditBounds(Be)&&!We())_.blueboxOnDig(null,null,false)},in_event_cb:!ce.touch_mode?ce.pointerLockEnter:null},no:{cb:pe,in_event_cb:!ce.touch_mode?ce.pointerLockEnter:null}}})
else{if(_.inEditBounds(Be)&&!We())_.blueboxOnDig(null,null,false)
if(!ce.touch_mode){var se=ke.getSelected()
if(se&&se.getBID()===u.bid)ke.selectGatheringTools()}}break
case qr:Le({x:re,y:fe(),inv:_.inv,context:Re})
break
default:nt(false)}if(ie)Ne()}re+=J+Xr
if(ae===te-1){n+=fe()+8
re=a+(i-((J+Xr)*(C.length-te)-Xr))/2}}$r.end(n)}function blueboxOnPlace(e,t){if(t.bluebox_state===pt)t.bluebox_state=Et
var r=t.blueprint_def.isEmptyEditable()&&gr
var a=Mr(t,{do_build:false,draw_debug:false,do_transitions:false,check_bounds:t.blueprint_def.isEditable()&&!r})
var i=a.cost,o=a.cost_clear,n=a.build_incomplete,s=a.bounds_clear,l=a.bounds_clear_edit
if(r){s=l=true
gr=false}if(t.bluebox_state===Et)if(s&&l&&!n)t.bluebox_state=pt
else t.bluebox_origin_offset=t.bluebox_size=null
else{nt.equal(t.bluebox_state,mt)
if(t.blueprint_def.isEditable()&&!n)if(s&&l)t.blueboxChangeState(e,pt,true)
else t.blueboxChangeState(e,Et,true)
else if(t.bluebox_unlimited)if(st.blueprint_place_paused)t.blueboxChangeState(e,ge,true)
else if(o.length)t.blueboxChangeState(e,ht,true)
else t.blueboxChangeState(e,mt,true)
else{depositAll(t,i,o,true,e,true)
if(st.blueprint_place_paused)t.blueboxChangeState(e,ge,true)
else if(t.bluebox_state===mt&&!n)t.blueboxChangeState(e,ht,true)}}}function blueboxSelectProp(e){if(blueboxSelected(e.interactDetails())){e.blueboxOpenUI()
return}blueboxSelect(e.interactDetails())
if(!e.blueprint_def.loaded){e.blueprint_def.lazyLoad()
Vt.push(Ut.STATUSMSG_BP_STILL_LOADING)
return}var t=false
if(e.bluebox_state===mt||e.bluebox_state===ge){if(blueboxEvaluateAndCheckResources(e,{do_build:false,draw_debug:false,do_transitions:false}).resources_missing)t=true}else if(e.bluebox_state===pt)if(blueboxEvaluateAndCheckResources(e,{do_build:false,draw_debug:false,do_transitions:false,check_bounds:true}).bounds_stable)t=true
if(t)e.blueboxOpenUI()
else Vt.push(Ut.STATUSMSG_PREVIEWING_BP)}function filterEditable(e){return e.bid[0]===J}var Jr=i()
function blueboxAutoSelect(e){var t=vt(e)
if(t){var r=blueboxGetSelected()
if(r&&r.blueboxCalcBounds()){var a=r.bounded_origin
var i=r.bounded_inv_origin
Ye(Jr,e)
if(Jr[0]>=a[0]&&Jr[0]<i[0]&&Jr[1]>=a[1]&&Jr[1]<i[1]&&Jr[2]>=a[2]&&Jr[2]<i[2])return}if(1===(t=t.filter(filterEditable)).length)blueboxSelect(t[0].interactDetails())}}},{"../common/blueprint_common":240,"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/voxel_data_common":264,"../common/world_constants":267,"../glov/client/cmds":298,"../glov/client/draw_list":301,"../glov/client/effects":304,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/mat4ScaleRotateTranslate":336,"../glov/client/scroll_area":349,"../glov/client/settings":351,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./bluebox_edit_list":26,"./blueprint":28,"./build_menu":32,"./build_mode":33,"./editvolume_client":84,"./file_management":98,"./inventory":114,"./inventory_ui":115,"./item_anims":116,"./item_info_view":117,"./items":119,"./localization/localization":131,"./main":135,"./menu":140,"./props":171,"./quickbar":172,"./status":193,"./styles":197,"./tiles":199,"./ui_util":205,"./user_data":208,"./voxel_const":215,"./voxel_data":216,"./world_metadata":235,assert:void 0}],28:[function(e,t,r){"use strict"
r.finalizeCost=finalizeCost
r.blueprintIdValid=blueprintIdValid
r.blueprintGetDef=blueprintGetDef
r.blueprintGetDefForLoadingScreen=blueprintGetDefForLoadingScreen
r.blueprintGetTempDef=blueprintGetTempDef
r.blueprintUnsubscribeAll=blueprintUnsubscribeAll
r.blueprintStartup=blueprintStartup
var a=e("../common/blueprint_common")
var i=a.BLUEPRINT_MAX_DIM
var o=a.STATE_BUILD
var n=a.STATE_EDIT
var s=a.STATE_PAUSED
var l=a.STATE_PRE_BUILD
var _=a.STATE_PRE_EDIT
var c=a.STATE_SELF_DESTRUCT
var u=a.TYPE_EDITABLE
var d=a.TYPE_READONLY
var f=a.bid_valid_regex
r.STATE_SELF_DESTRUCT=c
r.STATE_PRE_BUILD=l
r.STATE_BUILD=o
r.STATE_PAUSED=s
r.STATE_PRE_EDIT=_
r.STATE_EDIT=n
r.TYPE_EDITABLE=u
r.TYPE_READONLY=d
var h=e("assert")
var v=e("glov-async").asyncLimiter
var p=e("../glov/client/engine")
var m=e("../glov/client/local_storage")
var E=e("../glov/client/net")
var g=E.netClient
var T=E.netSubs
var y=E.netUserId
var S=e("../glov/common/util")
var I=S.callEach
var A=S.empty
var w=S.ridx
var L=e("../glov/common/verify")
var O=e("../glov/common/vmath")
var R=O.unit_vec
var b=O.v3copy
var N=O.v3same
var C=O.zero_vec
var x=e("../common/ids")
var M=x.ITEM_GEM
var D=x.ITEM_LIQUID
var P=x.TYPE_BLOCK
var B=x.TYPE_CRAFT_CLASS
var k=x.TYPE_ITEM
var U=e("../common/materials_common")
var G=U.CraftClass
var F=U.Mat
var W=e("../common/megachunk_common").parseChunkId
var H=e("./analytics").logEvent
var z=e("./build_menu").updateBlueprintMetadata
var V=e("./crafting").craftClassMatches
var Y=e("./file_management").uploadImageSet
var j=e("./items")
var K=j.craftClassAndMatToItem
var q=j.createItem
var Z=j.isItem
var X=j.sameItem
var Q=e("./localization/localization").L
var $=e("./main")
var J=e("./status")
var ee=e("./tiles").TILE_PROP_BASE
var te=e("./voxel_data").createWorldVD
var re=e("./world_comm")
var ae=re.getPerm
var ie=re.whenConnected
function BlueprintDef(e){this.bid=e
this.type=e[0]
this.chunk_map=[]
this.origin_offset=new Int32Array(3)
this.size=new Int32Array(3)
this.name=void 0
this.desc=void 0
this.owner_id=void 0
this.deleted=false
this.world_id=void 0
this.modified=0
this.loaded=false
this.load_issued=false
this.ver=1
this.subscribed=false
this.channel=null
this.props=[]
this.on_load=[]}BlueprintDef.prototype.toJSON=function(){var e={}
var t=this.chunk_map
for(var r in t)e[r]=t[r].serialize()
var a={cm:e,o:[this.origin_offset[0],this.origin_offset[1],this.origin_offset[2]],s:[this.size[0],this.size[1],this.size[2]]}
if(this.type===u)a.v=this.ver
return a}
BlueprintDef.prototype.dispose=function(){var e=this.chunk_map
for(var t in e){e[t].dispose()
delete e[t]}}
BlueprintDef.prototype.isEmptyEditable=function(){if(this.type!==u)return false
return A(this.chunk_map)}
BlueprintDef.prototype.isEmpty=function(){return A(this.chunk_map)}
BlueprintDef.prototype.isEditable=function(){return this.type===u}
BlueprintDef.prototype.isMyBlueprint=function(){return $.omp?y()===this.owner_id:true}
BlueprintDef.prototype.isSubscribed=function(){return this.channel}
BlueprintDef.prototype.onBlueprintDataInternal=function(e){var t=e.def,r=e.owner_id,a=e.name,i=e.desc,o=e.world_id,n=e.deleted,s=e.img,l=e.modified,_=e.renamed
if(t)this.fromJSON(t)
if(r)this.owner_id=r
if(a)this.name=a
if(i)this.desc=i
if(o)this.world_id=o
if(n)this.deleted=n
if(l)this.modified=l
this.renamed=Boolean(_)
if(s)this.img_url=s}
BlueprintDef.prototype.onBlueprintData=function(e){this.onBlueprintDataInternal(e)
this.subscribed=true}
BlueprintDef.prototype.saveBlueprint=function(a,e,i){var o=this
if(!$.omp){this.ver++
a.ver=this.ver
m.setJSON("blueprint."+this.bid,a.toData())
this.fromJSON(a.toJSON())
i(null,{ver:this.ver})
return}h(this.channel)
this.saving=true
Y(e,true,function(e,t){if(e){o.saving=false
$.chat_ui.addChatError(Q.$(Q.CHATERROR_SAVING_BP_SNAPSHOT,e))
return i(e)}var r=g().pak("blueprint_save")
r.writeAnsiString(o.bid)
r.writeInt(t.snapshot.id)
r.writeJSON(a)
return r.send(function(e,t){o.saving=false
if(e)$.chat_ui.addChatError(Q.$(Q.CHATERROR_SAVING_BP,e))
else{H("blueprint_saved")
J.push(Q.STATUSMSG_BP_SAVED)}return i(e,t)})})}
function onBlueprintData(e){var t=this.bpdef
if(t)t.onBlueprintData(e)}BlueprintDef.prototype.unsubscribe=function(){if(!this.channel)return
T().unsubscribe("blueprint."+this.bid)
this.subscribed=false
this.channel.bpdef=null
this.channel=null}
BlueprintDef.prototype.subscribe=function(){if(this.type!==u||!$.omp)return true
if(!this.channel){this.channel=T().getChannel("blueprint."+this.bid,true)
this.channel.bpdef=this}return this.subscribed}
function compressCost(e){for(var t=0;t<e.length;++t){var r=e[t]
for(var a=e.length-1;a>t;--a){var i=e[a]
if(X(r,i)){if(r===e[t])r=q(r)
r.count+=i.count
w(e,a)}}e[t]=r}return e}function finalizeCost(e,t,r){for(var a=0;a<r.length;++a){var i=r[a]
if(i.type===B)i=r[a]=K(i.id,i.id===G.STONE_RAW?F.STONE:i.id===G.BRICK?F.FANCY_STONE:0,i.count,false)
if(!Z(i))i=r[a]=q(i)}for(var o in e){o=Number(o)
var n=q({type:P,id:o}).cost
if(!L(n))n=[]
for(var s=0;s<n.length;++s){var l=n[s];(l=q(l)).count*=e[o]
r.push(l)}}for(var _ in t){_=Number(_)
r.push(q({type:k,id:D,attr1:F.ANY,attr2:_,count:t[_]}))}return compressCost(r)}BlueprintDef.prototype.calcCost=function(){var e=this.chunk_map
var t={}
var r={}
var a=[]
for(var i in e){var o=e[i]
if(o.data)for(var n=0;n<o.data.length;++n){var s=o.data[n]
if(!s||s>=ee)continue
t[s]=(t[s]||0)+1}if(o.liquid)for(var l=0;l<o.liquid.length;++l){var _=o.liquid[l]
if(!_)continue
if(1&_)--_
r[_]=(r[_]||0)+1}if(o.props)for(var c in o.props){var u=o.props[c].toItem().cost
h(u)
a=a.concat(u)}}this.cost=finalizeCost(t,r,a)
var d=-1
for(var f=0;f<this.cost.length;++f){var v=this.cost[f]
if(-1===d||v.count>this.cost[d].count)if(V(G.STONE_RAW,v))d=f}if(-1!==d){this.cost[d]=q(this.cost[d])
this.cost[d].count++}else this.cost.push(q({type:B,id:G.STONE_RAW,count:1}))}
BlueprintDef.prototype.fromJSON=function(e){var t=e.cm
var r=this.chunk_map
for(var a in r){if(!r[a].dispose)throw new Error("Non-VoxelData element found in BlueprintDef.chunk_map["+a+"]")
r[a].dispose()
delete r[a]}for(var i in t){i=Number(i)
var o=W(i)
var n=r[i]=te(o.chunk_pos[0],o.chunk_pos[1],o.chunk_pos[2],i)
n.main_world=false
n.deserialize(t[i])
if(n.props)for(var s in n.props)if(n.props[s].item_id===M){delete n.props[s]
delete n.baked_props[s]
delete n.drawable_props[s]}}this.calcCost()
b(this.origin_offset,e.o||C)
b(this.size,e.s||R)
if(this.type===u)this.ver=e.v||0
this.loaded=true
for(var l=0;l<this.props.length;++l)this.props[l].blueboxUpdatePos()
I(this.on_load,this.on_load=null)}
BlueprintDef.prototype.fromError=function(e){this.error=e
this.loaded=false}
BlueprintDef.prototype.fromData=function(e){var t
if(null!=e&&null!=(t=e.def)&&t.s&&(e.def.s[0]>i||e.def.s[1]>i||e.def.s[2]>i)&&!ae("sysadmin")){this.fromError("ERR_INVALID_BLUEPRINT")
return}this.onBlueprintDataInternal(e)
z(this)}
BlueprintDef.prototype.toData=function(){return{name:this.name,desc:this.desc,owner_id:this.owner_id,world_id:this.world_id,img_url:this.img_url,def:this.toJSON()}}
BlueprintDef.prototype.onLoad=function(e){h(!this.loaded)
if(!this.on_load)this.on_load=[]
this.on_load.push(e)}
BlueprintDef.prototype.addProp=function(e){this.props.push(e)}
BlueprintDef.prototype.removeProp=function(e){var t=this.props.indexOf(e)
w(this.props,t)}
BlueprintDef.prototype.equals=function(e){if(!N(this.origin_offset,e.origin_offset))return false
if(!N(this.size,e.size))return false
var t=this.chunk_map
var r=e.chunk_map
for(var a in t){var i=t[a]
var o=r[a]
if(!o)return false
if(!i.equals(o))return false}for(var n in r)if(!t[n])return false
return true}
var oe={}
function blueprintIdValid(e){return e&&e.match(f)}function blueprintGetDef(e,t){var r=e[0]
h(r===d||r===u)
var a=oe[e]
if(a){if(!t)a.lazyLoad()
return a}a=oe[e]=new BlueprintDef(e)
if(!t)a.startLoading()
return a}function blueprintGetDefForLoadingScreen(e){var t=blueprintGetDef(e,true)
t.for_loading_screen=true
t.lazyLoad()
return t}var ne=v(40)
var se=v(1)
BlueprintDef.prototype.startLoading=function(){h(!this.loaded)
h(!this.load_issued)
h(!this.err)
this.load_issued=true
var a=this
var e=this.for_loading_screen;(e?se:ne)(function(r){ie(function(){g().send(e?"blueprint_get_bypass":"blueprint_get",a.bid,null,function(e,t){r()
if(a.channel)return
if(e){console.warn("Error getting blueprint definition "+a.bid+": "+e)
a.fromError(e)}else{p.fixNatives(false)
a.fromData(t)}})})})}
BlueprintDef.prototype.lazyLoad=function(){if(this.loaded||this.load_issued)return
this.startLoading()}
function blueprintGetTempDef(){return new BlueprintDef("E(temp)")}function blueprintUnsubscribeAll(){for(var e in oe)oe[e].unsubscribe()}function blueprintStartup(){T().onChannelMsg("blueprint","blueprint_data",onBlueprintData)}},{"../common/blueprint_common":240,"../common/ids":249,"../common/materials_common":253,"../common/megachunk_common":254,"../glov/client/engine":305,"../glov/client/local_storage":329,"../glov/client/net":338,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./analytics":6,"./build_menu":32,"./crafting":66,"./file_management":98,"./items":119,"./localization/localization":131,"./main":135,"./status":193,"./tiles":199,"./voxel_data":216,"./world_comm":226,assert:void 0,"glov-async":void 0}],29:[function(e,t,r){"use strict"
r.blueprintMetaEdit=blueprintMetaEdit
var a=e("../glov/client/cmds").cmd_parse
var p=e("../glov/client/engine")
var m=e("../glov/client/input")
var i=e("../glov/client/ui")
var E=i.buttonText
var g=i.modalDialog
var T=i.modalTextEntry
var y=i.uiButtonHeight
var S=e("../glov/client/urlhash")
var o=e("../glov/common/util")
var I=o.nop
var A=o.sanitize
var w=e("../common/blueprint_common").BLUEPRINT_NAME_LEN
var n=e("../common/ids")
var L=n.ITEM_BLUEPRINT
var O=n.TYPE_ITEM
var R=e("./analytics").logEvent
var b=e("./bluebox_ui").simpleSnapShotToExport
var s=e("./blueprint").blueprintGetDef
var l=e("./build_menu")
var N=l.SUB_BLUEPRINTS
var C=l.blueprintAddToLibraryOrSelect
var x=l.blueprintInLibrary
var _=l.blueprintLastPublishedID
var M=l.buildMenuRemoveBlueprint
var D=l.buildMenuRenameBlueprint
var c=l.dynamicAddBlueprint
var P=l.getBuildMenuSubPage
var u=e("./item_info_view")
var B=u.itemInfoViewClear
var k=u.itemInfoViewPush
var U=u.itemInfoViewing
var d=e("./items")
var G=d.ITEM_CONTEXT_BUILD
var F=d.createItem
var W=e("./localization/localization").L
var H=e("./main")
var z=e("./menu")
var f=e("./menu")
var V=f.isBuildMenu
var Y=f.menuActive
var j=f.menuDoTransition
var v=e("./quickbar")
var h=e("./sharing/platform_share_handlers")
var K=h.shareBlueprint
var q=h.shareBlueprintLink
var X=h.sharingEnabled
var Q=h.sharingLinksEnabled
var $=e("./world_comm")
var J=$.myUserCmdParse
var ee=$.myUserCmdParseWrap
var te=4
var re=false
function blueprintPublish(r,a){var e=s(r)
if(!(e.loaded&&e.isEditable()&&e.isMyBlueprint()))return void a(W.ERR_CMD_REQUIRES_OWNED_BP)
var t
function onLoad(){if(t)if(t.equals(e))return void C(t.bid,function(){a(null,t.bid,true)})
J("blueprint_publish "+r,function(e,t){if(t&&t.bid){c(t.bid,r)
return void a(null,t.bid,false)}a(e,t)})}var i=_(r)
if(!i)return void onLoad()
if((t=s(i)).loaded)return void onLoad()
t.onLoad(onLoad)}a.register({cmd:"blueprint_publish",help:"Make a read-only copy of the blueprint currently held in hand for sharing",func:function func(e,a){var t=v.getSelected()
var r=t&&t.getBID()
if(!r)return void a("No blueprint in-hand")
blueprintPublish(r,function(e,t,r){if(e)return void a(e,t)
return void a(null,"Blueprint "+(r?"already ":"")+"published as "+t)})}})
function blueprintMetaEdit(r,a,i,o){var e=0
var n=Z.USER_INFO_VIEW
var s=i.getBID()
var l=e
var _=(a-te)/2
var c=.65*y()
var t=m.keyDown(m.KEYS.SHIFT)||m.padButtonDown(m.PAD.LT)
var u=o.isEditable()
var d=o.loaded
function button(e){if(l+_>a){l=0
r+=c+te}var t=E({x:l,y:r,z:n,w:_,h:c,disabled:re,text:e.text,tooltip:e.tooltip,tooltip_above:e.tooltip_above})
l+=_+te
return t}var f=u?W.BTN_DELETE:W.BTN_REMOVE
var v=u?W.TLTP_DELETE_THIS_BP:W.TLTP_REMOVE_THIS_BP
if(button({text:f=t?f:W.addEllipsis(f),tooltip:v=t?v:v+"\n"+W.TLTP_HOLD_SKIP_CONFIRMATION.$({keyname:W.INPUT_KEY_SHIFT.upper()}),tooltip_above:true})){var h=function doDelete(){R("blueprint_delete")
B()
ee("blueprint_delete "+s,function(e){M(i)
H.chat_ui.handleCmdParse(null,u?W.MSG_BP_DELETED:W.MSG_BP_REMOVED)})}
if(t)h()
else g({title:u?W.DLG_DELETE_BP_TITLE:W.DLG_REMOVE_BP_TITLE,text:W.$(u?W.DLG_DELETE_BP_MSG:W.DLG_REMOVE_BP_MSG,i.getBlueprintName()),buttons:{yes:h,no:null}})}if(d&&button({text:W.addEllipsis(W.BTN_RENAME),tooltip:!u&&o.isMyBlueprint()?W.TLTP_RENAME_BP_FOR_ALL:W.TLTP_RENAME_BP_IN_LIBRARY,tooltip_above:true}))T({edit_text:i.getBlueprintName(),title:W.DLG_RENAME_BP_TITLE,text:W.$(W.DLG_RENAME_BP_MSG,i.getBlueprintName()),max_len:w,buttons:{OK:function OK(r){if((r=A(r).trim())===i.getBlueprintName())return
var a="blueprint_rename "+s+" "+r
J(a,function(e,t){if(e){H.chat_ui.addChatError(W.$(W.CHATERROR_RUNNING_CMD,"/"+a,e))
g({title:W.DLG_ERROR_RENAMING_BP_TITLE,text:e,buttons:{ok:null}})}else{if(o.isMyBlueprint()){o.renamed=true
o.name=r}D(s,r)
H.chat_ui.handleCmdParse(null,W.MSG_BP_RENAMED)}})},Cancel:null}})
if(d&&u&&o.isMyBlueprint()&&!o.isEmpty())if(button({text:re?W.BTN_SHARING:W.BTN_SHARE,tooltip:W.TLTP_SHARE_BP})){re=true
blueprintPublish(s,function(e,t,r){re=false
if(e){g({title:W.DLG_ERROR_SHARING_BP_TITLE,text:e,buttons:{ok:null}})
H.chat_ui.addChatError(e)}else{R("blueprint_share")
if(U(i,G))k(F({type:O,id:L,attr1:t}),G)}})}if(d&&!u&&x(s))if(button({disabled:re,text:W.LBL_VIEW_INFO,tooltip:W.TLTP_BP_VIEW_INFO})){j()
S.goRoute("blueprint/"+s)}if(d&&!u&&o.isMyBlueprint()&&Q()){if(button({disabled:re,text:W.BTN_GET_LINK,tooltip:W.TLTP_LINK_BP_GET}))if(!o.renamed)g({title:W.DLG_ERROR_SHARING_BP_TITLE,text:W.ERR_MUST_NAME_BP,buttons:{ok:null}})
else q(s)
if(X("shareBlueprint"))if(button({disabled:re,text:W.BTN_SHARE,tooltip:W.TLTP_LINK_BP_SHARE}))if(!o.renamed)g({title:W.DLG_ERROR_SHARING_BP_TITLE,text:W.ERR_MUST_NAME_BP,buttons:{ok:null}})
else K(s)
if(o.isMyBlueprint()&&p.DEBUG)if(button({text:"Export",tooltip:"Get a OBJ file from your blueprint"}))b(o)}if(d&&x(s)&&!(Y()&&V()&&P()===N))if(button({text:W.BTN_SHOW_IN_BUILD_MENU,tooltip:W.TLTP_SHOW_BP_IN_BUILD_MENU})){z.init(z.BUILD)
C(s,I)}return r+=c+te}},{"../common/blueprint_common":240,"../common/ids":249,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/util":400,"./analytics":6,"./bluebox_ui":27,"./blueprint":28,"./build_menu":32,"./item_info_view":117,"./items":119,"./localization/localization":131,"./main":135,"./menu":140,"./quickbar":172,"./sharing/platform_share_handlers":185,"./world_comm":226}],30:[function(e,t,r){"use strict"
r.blueprintViewGetTitle=blueprintViewGetTitle
r.blueprintViewInit=blueprintViewInit
r.doBlueprintView=doBlueprintView
var a=e("../glov/client/cmds").cmd_parse
var g=e("../glov/client/engine")
var T=e("../glov/client/font").ALIGN
var i=e("../glov/client/net")
var y=i.netSubs
var S=i.netUserId
var o=e("../glov/client/ui")
var I=o.buttonText
var A=o.modalDialog
var w=o.uiTextHeight
var n=e("../glov/client/urlhash")
var s=e("../common/ids")
var l=s.ITEM_BLUEPRINT
var _=s.TYPE_ITEM
var L=e("./account_ui").formatUserID
var c=e("./blueprint")
var O=c.blueprintGetDef
var R=c.blueprintIdValid
var u=e("./build_menu")
var b=u.blueprintAddToLibrary
var N=u.blueprintInLibrary
var C=e("./inventory_ui").inventoryButtonPrep
var d=e("./items")
var x=d.ITEM_CONTEXT_BUILD
var f=d.createItem
var v=e("./layout")
var M=v.PHOTOUI_USERBUTTON_H
var D=v.UIVIEWS_BUTTON_H
var P=v.UIVIEWS_BUTTON_W
var B=v.UIVIEWS_CONTENT_PAD
var k=e("./localization/localization").L
var h=e("./main")
var p=e("./main_menu")
var m=p.ensureDefaultSeed
var U=p.requireLogin
var E=e("./menu")
var G=e("./menu")
var F=G.menuX1
var W=G.menuY1
var H=e("./sharing/platform_share_handlers")
var z=H.shareBlueprintLink
var V=H.sharingLinksEnabled
var Y=e("./styles")
var j=Y.label_style
var K=Y.loading_style
var q=e("./user_info_view")
var X=q.userInfoGet
var Q=q.userProfileButton
var $=q.viewUser
var J=e("./world_comm")
var ee=J.getPerm
var te=J.myUserCmdParse
var re=Math.max
var ae
function blueprintViewGetTitle(){return ae}var ie
var oe
var ne=false
var se=false
function blueprintViewInit(e){m()
se=false
if(e){ne=false
oe=f({type:_,id:l,attr1:ie=e})
ae=k.LBL_BP_VIEW_LOADING}}function blueprintViewReInit(){h.toggleMenuPage(E.BLUEPRINT_VIEW)
se=true}function doBlueprintView(e){var t=Z.UI
var r=W()
var a=0
var i=F()-a
var o=r-e
var n=e
var s=a
var l=g.font
var _=w()
ae=k.LBL_BP_VIEW
if(!R(ie)){l.drawSizedAligned(K,a,e,t,_,T.HVCENTER,i,2*o/3,k.BBOX_INVALID_BP_ID)
ae=k.LBL_BP_VIEW_ERROR
return}var c=O(ie)
if(c.error){l.drawSizedAligned(K,a,e,t,_,T.HVCENTER,i,2*o/3,k.$(k.BBOX_BP_DATA_ERROR,c.error))
ae=k.LBL_BP_VIEW_ERROR
return}if(!c.loaded){l.drawSizedAligned(K,a,e,t,_,T.HVCENTER,i,2*o/3,k.BBOX_BP_DATA_LOADING)
ae=k.LBL_BP_VIEW_LOADING
return}if(c.isEditable()){l.drawSizedAligned(K,a,e,t,_,T.HVCENTER,i,2*o/3,k.BBOX_INVALID_BP_ID)
ae=k.LBL_BP_VIEW_ERROR
return}var u=500
var d={x:s+(i-u)/2,y:n,w:u,z:t+2,hide_count:true,dynamic_snapshot:true,item_context:x,img:null}
C(d,oe)
d.img.draw(d)
n+=u+2*B
var f=2*_
l.drawSizedAligned(j,s,n,t+1,f,T.HCENTERFIT,i,0,oe.getBuildName())
n+=f+B
var v=oe.getBlueprintName()
var h=c.name
if(v!==h){l.drawSizedAligned(j,s,n,t+1,_,T.HCENTERFIT,i,0,k.separateColon(k.LBL_ORIGINAL_NAME,h))
n+=_+B}var p=X(c.owner_id)
if(p.user_id&&!p.user_id.startsWith("$")){var m=re(_,M)
var E=s+(i+l.drawSizedAligned(j,s,n,t+1,_,T.HVCENTERFIT,i,m,k.separateColon(k.LBL_AUTHOR,L(p.user_id,p.display_name))))/2+B
if(Q({user_id:p.user_id,show_online_status:false,x:E,y:n,z:t+1,w:M,h:M}))$({x:E,y:n,user_id:p.user_id})
n+=m+B}if(c.desc)n+=l.drawSizedWrapped(j,s,n,t+1,i,80,_,k.separateColon(k.LBL_DESCRIPTION,c.desc))+B
n+=2*B
if(N(ie)){l.drawSizedAligned(j,s,n,t+1,_,T.HCENTERFIT,i,0,k.BBOX_BP_IS_IN_YOUR_LIBRARY)
n+=_+B}else if(!c.deleted){if(I({x:s+(i-P)/2,y:n,w:P,h:D,z:t+2,disabled:ne,text:ne?k.BTN_ADDING_TO_LIBRARY:k.BTN_ADD_TO_LIBRARY})||se){se=false
ne=true
if(y().loggedIn())b(ie,function(e){ne=false
if(e)A({title:k.DLG_ERROR_ADDING_BP_TITLE,text:e,buttons:{OK:null}})})
else U(blueprintViewReInit)}n+=D+B}if(c.owner_id===S()&&V()){if(I({x:s+(i-P)/2,y:n,w:P,h:D,z:t+2,text:k.BTN_GET_LINK}))if(!c.renamed)A({title:k.DLG_ERROR_SHARING_BP_TITLE,text:k.ERR_MUST_NAME_BP,buttons:{ok:null}})
else z(ie)
n+=D+B}if(ee("sysadmin")&&!c.deleted)if(I({x:s+(i-P)/2,y:n,w:P,h:D,z:t+2,disabled:ne,text:"(Admin) Purge blueprint..."}))A({title:"Purge Blueprint",text:"Are you sure you wish to purge this blueprint, making it invalid for all users?",buttons:{yes:function yes(){ne=true
te("blueprint_purge "+ie,function(e){ne=false
if(e)A({title:k.DLG_ERROR_ADDING_BP_TITLE,text:e,buttons:{OK:null}})
else A({text:"Blueprint has been purged, will take effect when clients reload",buttons:{OK:null}})})},no:null}})}a.register({cmd:"blueprint_view",help:"View blueprint details",func:function func(e,t){n.goRoute("blueprint/"+e)
t()}})},{"../common/ids":249,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/net":338,"../glov/client/ui":367,"../glov/client/urlhash":369,"./account_ui":4,"./blueprint":28,"./build_menu":32,"./inventory_ui":115,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./main_menu":136,"./menu":140,"./sharing/platform_share_handlers":185,"./styles":197,"./user_info_view":210,"./world_comm":226}],31:[function(e,t,r){"use strict"
r.worldBoostable=worldBoostable
r.worldBoostWidget=worldBoostWidget
r.boostViewInit=boostViewInit
r.doBoostView=doBoostView
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var me=e("assert")
var Ee=e("../glov/client/animation").animationSequencerCreate
var ge=e("../glov/client/engine")
var Te=e("../glov/client/engine").getFrameDt
var ye=e("../glov/client/font").ALIGN
var Se=e("../glov/client/input").inputClick
var Ie=e("../glov/client/markdown").markdownAuto
var a=e("../glov/client/net")
var Ae=a.netDisconnected
var we=a.netSubs
var Le=e("../glov/client/scroll_area").scrollAreaCreate
var i=e("../glov/client/ui")
var Oe=i.button
var Re=i.buttonWasFocused
var be=i.label
var Ne=i.modalDialog
var Ce=i.panel
var xe=i.progressBar
var Me=i.uiGetFont
var De=i.uiGetTitleFont
var Pe=i.uiTextHeight
var Be=e("../glov/common/util").easeOut
var ke=e("../common/store_data").PRODUCT_ITEM_ID_BOOST_TOKEN
var o=e("../common/world_constants")
var Ue=o.BOOST_COOLDOWN
var Ge=o.BOOST_GRANULARITY
var Fe=o.BOOST_KICKBACK
var We=o.BOOST_MAX_LEVEL
var He=o.BOOST_PERKS
var ze=o.BOOST_THRESHOLDS
var Ve=o.boostLevelFromCount
var Ye=e("./analytics").logEvent
var n=e("./currency_shop")
var je=n.OVERLAY_BAR_POS
var Ke=n.OVERLAY_BORDER_OFFSET
var qe=n.shopButtonBackground
var Ze=n.shopButtonPrice
var s=e("./layout")
var Xe=s.UIVIEWS_BUTTON_H
var Qe=s.UIVIEWS_CONTENT_PAD
var $e=e("./localization/localization").L
var l=e("./main").toggleMenuPage
var _=e("./menu")
var c=_.BOOST_VIEW
var Je=_.menuX1
var et=_.menuY1
var u=e("./store")
var tt=u.gameCurrencyPurchase
var rt=u.getProductIdOrbCost
var d=e("./styles")
var at=d.color_boost
var it=d.color_boost_base
var ot=d.color_boost_bright
var nt=d.color_boost_panel_current
var st=d.color_boost_panel_other
var lt=d.color_gray80
var _t=d.color_white
var ct=d.color_white_50
var ut=d.label_style
var dt=d.loading_style
var ft=d.menu_header_style
var vt=d.style_boost_buy_text
var ht=d.style_booster
var y=d.style_boostwidget_text
var pt=d.style_wallet_boost_tokens
var mt=d.sublabel_style
var Et=e("./ui_util")
var gt=e("./ui_util").CHECK_SYMBOL
var Tt=e("./ui_util_2")
var f=e("./user_info_view")
var yt=f.userProfileButton
var St=f.viewUser
var It=e("./user_profile_view").userProfileViewOpenToMyBoosts
var At=e("./world_comm").getBoostTokenBalance
var v=e("./world_info")
var wt=v.getWorldInfo
var Lt=v.isFullWorldInfo
var h=e("./world_info_view")
var Ot=h.isWorldInfoContext
var Rt=h.worldInfoGetContext
var bt=e("./worlds_sound").playSound
var Nt=Math.max,Ct=Math.min
var xt="unknown"
function boostViewOpen(e,t){xt=t||"unknown"
Ye("boost_view_open",void 0,"button",t)
l(c,e)}function worldBoostable(e){if(e.frozen)return false
var t=e.owner
if(t.user_id&&t.user_id.startsWith("$"))return false
if(!e.user_access)return false
return true}function boostInfoFromWorld(e){var t=e.boost_count||0
var r=Ve(t)
return{boost_count:t,level:r,next_level:r+1,required:ze[r+1]||Infinity}}function worldBoostWidget(e,t,r,a,i,o){var n=wt(e,false)
if(!n||n.err)return
me(Lt(n))
var s=Z.UI
var l=boostInfoFromWorld(n)
var _=l.level,c=l.boost_count,u=l.required
var d=""+$e.LBL_BOOST_WIDGET_1.$(l)
var f=.75
var v
var h=i*f
var p=.18
var m=i*(.5-p)/2
if(_===We)v=$e.LBL_BOOST_WIDGET_2_MAX.$(l)
else{v=$e.LBL_BOOST_WIDGET_2.$(l)
var E=h+i*p
xe({x:t+E,y:r+i/2,w:a-E-p*i,h:i/2-p*i,z:s+.05,progress:c/u})}var g=Me()
var T=Pe()
g.drawSizedAligned(y,t+h,r+i/2-m,s+.1,T,ye.HVCENTER,a-h,0,d)
g.drawSizedAligned(y,t+h,r+i/2+m,s+.1,T,ye.HVCENTER,a-h,0,v)
if(Oe({x:t,y:r,z:s,w:a,h:i,shrink:f,text:" ",align:ye.HWRAP|ye.HVCENTERFIT,img:Tt.sprite,frame:Tt.BOOST0+_}))boostViewOpen(e,o)}function highlight(e){return"[c=bvhighlight]"+e+"[/c]"}var Mt={override_count:null,progress_anim:0,pulse_anim:0,anim:null}
function boostPreviewClear(){Mt.override_count=null
Mt.progress_anim=0
Mt.pulse_anim=0
Mt.anim=null}var Dt
var Pt
function boostViewInit(e){me(e||"string"===typeof e)
if(Pt!==e){Pt=e
null==Dt||Dt.resetScroll()}boostPreviewClear()}var Bt=100
var kt=254
var Ut=20
function doBoostView(e){var o=0
var t=Je()
var r=et()
var m=Z.UI+5
var E=t-o
var a=r-e
var g=Me()
var n=De()
var s=Pe()
var i=Rt(Pt)
if(!Ot(i)){g.drawSizedAligned(dt,o,e,m,s,ye.HVCENTER,E,2*a/3,$e.WORLDINFO_LOADING)
return}var l=i.world_info
if(l.err){g.drawSizedAligned(dt,o,e,m,s,ye.HVCENTER,E,2*a/3,$e.$($e.WORLDINFO_LOADING_ERROR,l.err))
return}me(Lt(l))
var _=l.owner,c=l.frozen,u=l.booster
var T=boostInfoFromWorld(l)
var d=T.boost_count,f=T.level
if(Mt.anim)if(!Mt.anim.update(Te())){Mt.anim=null
Mt.override_count=null}if(null!==Mt.override_count){d=Mt.override_count
f=Ve(d)}if(!Dt)Dt=Le({z:m,background_color:null,auto_hide:false})
Dt.keyboardScroll()
var v=Dt.barWidth()
var h={x:o,y:e,w:E,h:r-e,auto_hide:false}
Dt.begin(h)
var y=0
E-=v
var S=At()
if(S>0){var p=2*s
var I=y+Qe
var A=E-p-Qe
var w=$e.TLTP_BOOST_TOKEN_COUNT.$({count:S})
be({x:A,y:I,w:p,h:p,tooltip:w,img:Tt.sprite,frame:Tt.BOOST_TOKEN})
be({x:A,y:I,h:p,size:p,font_style:pt,tooltip:w,align:ye.HRIGHT,text:""+S})}var L=2*s
y+=Ut
y+=g.drawSizedAligned(ut,o+.25*E,y,m,L,ye.HCENTER|ye.HWRAP,.5*E,0,$e.LBL_BOOST_HEADER)
y+=2*Qe+2*Ut
n.drawSizedAligned(ft,o,y,m,L,ye.HCENTERFIT,E,0,l.name)
y+=L+Qe
var O=worldBoostable(l)
if(_.user_id&&_.user_id.startsWith("$"));else{var R=Xe
var b=R
var N=g.drawSizedAligned(ut,0,y,m+1,s,ye.HCENTERFIT|ye.VCENTER,E,b,$e.separateColon(c?$e.LBL_ACCESS_OWNER_CREATOR:$e.LBL_ACCESS_OWNER,_.display_name||_.user_id))
if(yt({user_id:_.user_id,show_online_status:false,x:(E+N)/2+4,y:y,z:m+1,w:R,h:R})||Se({x:(E-N)/2,y:y,w:N,h:b,button:0}))St({x:E/2,y:y+R,user_id:_.user_id})
y+=R+4}var C=o+3*Ut
var x=E-3*Ut*2
function drawBuyButton(){var e=200
var t=(E-e)/2
var r=rt(ke)
me(r)
var a=Nt(0,Ge-S)
var i=Ct(S,Ge)
var o=Oe({x:t,y:y,z:m,h:e,w:e,base_name:"cosmetic_unselected",align:ye.HWRAP|ye.HVCENTER,text:" ",shrink:.5,disabled:!O})
var n=Re()
var s=e*Ke
var l=t+s
var _=y+1.04*s
var c=t+e-s
var u=_+g.drawSizedAligned(vt,l,_,m+1,.175*e,ye.HWRAP|ye.HCENTERFIT,c-l,0,$e.BTN_BOOST.$({days:Ge}))
var d=y+je*e
var f=d-u
if(f>0)Tt.sprite_centered.draw({frame:Tt.BOOST1,x:t+.5*e,y:.5*(u+d),z:m+1,w:f,h:f,color:n?lt:void 0})
var v={x:t,y:y,z:m-1,h:e,w:e,color_top:it,color_bottom:ot,price_type:"orb",price:r*a}
qe(v)
if(a){if(i)v.align="left"
Ze(v)}if(i){if(a)v.align="right"
v.price=i
v.price_type="boost_token"
Ze(v)}if(o){Ye("boost_apply_start",void 0,"button",xt)
var h=function after_orbs_fn(e){if(e){Ye("boost_apply_cancel")
return}function applyBoost(){function handleResult(e){if(e){boostPreviewClear()
Ye("boost_apply_error")
Ne({title:$e.DLG_ERROR_TITLE,text:e,buttons:{ok:null}})}else{if(!a)bt("purchase")
wt(Pt,true,1)
Ye("boost_apply_success",void 0,void 0,xt)
Ne({title:$e.DLG_BOOST_SUCCESS_TITLE,text:$e.DLG_BOOST_SUCCESS_MSG.$({level:Ve(T.boost_count+1)}),buttons:{ok:function ok(){var e=Mt.anim=Ee()
var t=e.add(0,T.level<We?1e3:60,function(e){if(1===e){Mt.progress_anim=0
Mt.override_count=T.boost_count+1}else Mt.progress_anim=Be(e,2)})
e.add(t,1e3,function(e){Mt.pulse_anim=1-Be(e,2)})}}})}}if(Ae())return handleResult("ERR_DISCONNECTED")
boostPreviewClear()
Mt.override_count=T.boost_count
Ne({title:$e.DLG_BOOSTING_TITLE})
if(ge.defines.BOOST_TEST){setTimeout(function(){handleResult(null)},500)
return}var e=we().getMyUserChannel().pak("user_world_boost")
e.writeAnsiString(xt)
e.writeAnsiString(Pt)
e.send(handleResult)}if(!S)return applyBoost()
Ne({title:$e.DLG_BOOST_CONFIRM_TITLE,text:$e.DLG_BOOST_CONFIRM_MSG.$({cooldown:Ue})+("\n\n  "+$e.separateColon($e.DLG_BOOST_CONFIRM_CURRENT,At())),buttons:{yes:applyBoost,no:function no(){Ye("boost_apply_cancel")}}})}
var p=function after_confirm_fn(){if(a)tt("orb",ke,a,$e.LBL_WORLD_BOOST.$({days:a}),"boost_view:"+xt,h)
else h()}
if(T.level===We)Ne({title:$e.DLG_BOOST_CONFIRM_TITLE,text:$e.DLG_BOOST_CONFIRM_MAX_MSG,buttons:{yes:p,no:null}})
else p()}t+=e+Ut
y+=e}function drawBoostCount(){if(d){var e=$e.LBL_BOOST_COUNT.$({boost_count:d,icon:"[ICON]"}).toLocalString().split("[ICON]")
if(2===e.length){me.equal(e.length,2)
var t=g.getStringWidth(ut,s,e[0])
var r=g.getStringWidth(ut,s,e[1])
var a=s
var i=o+(E-(t+r+a))/2
g.drawSized(ut,i,y,m,s,e[0])
Tt.sprite.draw({x:i+=t,y:y,z:m,w:s,h:s,frame:Tt.BOOST1})
g.drawSized(ut,i+=a,y,m,s,e[1])}else{me.equal(e.length,1)
g.drawSizedAligned(mt,o,y,m,s,ye.HCENTER,E,0,e[0])}}else g.drawSizedAligned(mt,o,y,m,s,ye.HCENTERFIT,E,0,$e.LBL_BOOST_COUNT_ZERO)
y+=s}if(u)y+=g.drawSizedAligned(ht,C,y,m,s,ye.HCENTERFIT|ye.HWRAP,x,0,$e.LBL_YOU_ARE_A_BOOSTER)+Qe
y+=Ut
drawBuyButton()
y+=Ut
var M=((x=E-2*Ut)-Ut*We)/(We+1)
var D=.5*M
var P=(C=o+Ut)+D
var B=x-2*D
var k=B/We
var U=2*s
var G=y+=.5*U
var F=0
var W=0
var H=.4*Ut
var z
var V=He[0]
for(var Y=0;Y<=We;++Y){var j=0===Y
var K=ze[Y]
var q=He[Y]
var X=d+Mt.progress_anim
if(X>W){var Q=(X-W)/(K-W)
if(Y===We){var $=.64*U/k
Q=$+Q*(1-$)}F=(Y-1+Q)/We}W=K
y=G
var J=P+k*Y
var ee=f===Y
var te=U*(1+(ee?Mt.pulse_anim:0))
Tt.sprite_centered.draw({x:J,y:y,z:m+1,w:te,h:te,frame:Tt.BOOST0+Y,color:f>=Y?void 0:ct})
y+=.5*U
var re=ee?ht:f>=Y?ut:mt
var ae=$e.LBL_BOOST_LEVEL.$({level:Y})
if(ee)ae=$e.LBL_BOOST_CURRENT_LEVEL.$({check:gt,level:ae})
g.drawSizedAligned(re,J,y,m,s,ye.HCENTER,0,0,ae)
y+=s+Qe
if(j){drawBoostCount()
y+=10
y+=g.drawSizedAligned(ut,C,y,m,s,ye.HCENTERFIT|ye.HWRAP,x,0,u?$e.LBL_BOOST_PERKS_EVERYONE_BOOSTER:$e.LBL_BOOST_PERKS_EVERYONE_NONBOOSTER)
z=y+=Qe+15}else y=z
var ie=y
var oe=C+Y*(M+Ut)
n.drawSizedAligned(ft,oe,y,m,s,ye.HLEFT,M,0,$e.LBL_BOOST_LEVEL_LONG.$({level:Y}))
if(K)g.drawSizedAligned(mt,oe,y,m,.75*s,ye.HRIGHT|ye.VCENTER,M,s,$e.LBL_BOOSTS_NEEDED.$({threshold:K}))
y+=s+Qe
var ne={font_style:ut,x:oe,z:m,text_height:s,align:ye.HCENTERFIT,w:M}
var se=$e.FORMAT_NUMBER_OF_BUILDERS_PREFORMAT.$({num:q.builder_limit,str:q.builder_limit>V.builder_limit?highlight(q.builder_limit):q.builder_limit})
Ie(_extends({},ne,{y:y,text:se}))
y+=s+Qe
var le=q.spinners
var _e=void 0
if(0===le.length)_e=$e.LBL_BOOST_LOAD_SPINNERS_DEFAULT
else if(le.includes("custom"))_e=$e.LBL_BOOST_LOAD_SPINNERS_CUSTOM
else _e=$e.LBL_BOOST_LOAD_SPINNERS_CHOICE.$({count:le.length+1})
Ie(_extends({},ne,{y:y,text:_e}))
Ie(_extends({},ne,{y:y+=s+Qe,text:$e.LBL_BOOST_SKIES.$({num:q.skies.length,str:q.skies.length>V.skies.length?highlight(q.skies.length):q.skies.length})}))
y+=s+Qe
var ce=q.info_bgs
var ue=void 0
var de=ce.length+1
var fe=q.info_bgs.length>V.info_bgs.length
if(1===de)ue=$e.LBL_BOOST_INFO_BGS_DEFAULT
else if(ce.includes("custom"))ue=fe?$e.LBL_BOOST_INFO_BGS_CUSTOM_HL:$e.LBL_BOOST_INFO_BGS_CUSTOM
else ue=$e.LBL_BOOST_INFO_BGS_CHOICE.$({num:de,str:fe?highlight(de):de})
Ie(_extends({},ne,{y:y,text:ue}))
y+=s+Qe
if(!j){Ie(_extends({},ne,{y:y,text:1===Y?$e.LBL_BOOST_PREMIUM_PROPS_HL:$e.LBL_BOOST_PREMIUM_PROPS}))
y+=s+Qe
var ve=q.boost_icon
fe=ve>V.boost_icon||1===Y
Ie(_extends({},ne,{y:y,text:$e.LBL_BOOST_BOOSTER_ICON_COUNT.$({num:ve,str:fe?highlight(ve):ve})}))
y+=s+Qe
g.drawSizedAligned(ut,oe,y,m,s,ye.HCENTERFIT,M,0,$e.LBL_BOOST_CHAT_HISTORY.$({count:q.chat_hist}))
y+=s+Qe}Ce({x:oe-H,y:ie-H,w:M+2*H,h:y-ie+2*H,pixel_scale:.25,color:ee?nt:st})
V=q}var he=.5*s
var pe=.55*U
xe({color:at,color_trough:_t,x:P+pe,y:G-he/2,z:m-2,w:B-2*pe,h:he,progress:F})
y+=Ut
function drawBenefitListAny(e){var t=1.25*M
var r=y
var a=C+(x-t)/2
n.drawSizedAligned(ft,a,y,m,s,ye.HFIT,.7*t,0,$e.LBL_BOOST_ANY)
g.drawSizedAligned(mt,a+.7*t,y,m,.75*s,ye.HRIGHT|ye.HFIT|ye.VCENTER,.3*t,s,$e.LBL_BOOSTS_NEEDED.$({threshold:1}))
y+=s+Qe
for(var i=0;i<e.length;++i){var o=e[i]
g.drawSizedAligned(ut,a,y,m,s,ye.HCENTERFIT,t,0,o)
y+=s+Qe}Ce({x:a-H,y:r-H,w:t+2*H,h:y-r+2*H,pixel_scale:.25,color:u?nt:st})
y+=20}if(u)y+=g.drawSizedAligned(ut,C,y,m,s,ye.HCENTERFIT|ye.HWRAP,x,0,$e.LBL_BOOST_PERKS_SELF_BOOSTER)+Ut
else y+=g.drawSizedAligned(ut,C,y,m,s,ye.HCENTERFIT|ye.HWRAP,x,0,$e.LBL_BOOST_PERKS_SELF_NONBOOSTER)+Ut
drawBenefitListAny([$e.LBL_BOOST_BUILD_QUEUE_PRIORITY,$e.LBL_BOOST_BADGE,$e.LBL_BOOST_WORLD_ACCESS_1,$e.LBL_BOOST_WORLD_ACCESS_2])
y+=g.drawSizedAligned(ut,C,y,m,s,ye.HCENTERFIT|ye.HWRAP,x,0,$e.LBL_BOOST_PERKS_OWNER)+Ut
drawBenefitListAny([$e.LBL_BOOST_FEATURING,$e.LBL_BOOST_TIP_1.$({percent:Fe}),$e.LBL_BOOST_TIP_2])
if(Oe({x:(E-2*kt)/2,y:y+=20,w:2*kt,h:Bt,text:"Manage My Boosts...",font_height:32,img:Et.sprite,frame:Et.SETTINGS}))It()
y+=Bt
y+=20
Dt.end(y)}},{"../common/store_data":262,"../common/world_constants":267,"../glov/client/animation":289,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/markdown":332,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/ui":367,"../glov/common/util":400,"./analytics":6,"./currency_shop":72,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./store":195,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_info_view":210,"./user_profile_view":212,"./world_comm":226,"./world_info":229,"./world_info_view":231,"./worlds_sound":236,assert:void 0}],32:[function(e,t,r){"use strict"
r.getBuildMenuSubPage=getBuildMenuSubPage
r.blueprintInLibrary=blueprintInLibrary
r.blueprintMetaName=blueprintMetaName
r.blueprintLastPublishedID=blueprintLastPublishedID
r.buildMenuRemoveBlueprint=buildMenuRemoveBlueprint
r.buildMenuRenameBlueprint=buildMenuRenameBlueprint
r.updateUserBlueprints=updateUserBlueprints
r.updateBlueprintMetadata=updateBlueprintMetadata
r.dynamicAddBlueprint=dynamicAddBlueprint
r.blueprintAddToLibrary=blueprintAddToLibrary
r.blueprintAddToLibraryOrSelect=blueprintAddToLibraryOrSelect
r.buildMenuInit=buildMenuInit
r.deselect=deselect
r.buildMenuStartup=buildMenuStartup
r.buildMenuIsOpenAndIconView=buildMenuIsOpenAndIconView
r.doBuildEarly=doBuildEarly
r.doBuild=doBuild
r.SUB_SEARCH=r.SUB_BLUEPRINTS=r.SUB_TOOLS=r.SUB_FLORA=r.SUB_SETTLEMENT=r.SUB_PROPS=r.SUB_BRICKS=r.SUB_BLOCKS=void 0
var a
var N=0
r.SUB_BLOCKS=N
var C=1
r.SUB_BRICKS=C
var x=2
r.SUB_PROPS=x
var M=3
r.SUB_SETTLEMENT=M
var D=4
r.SUB_FLORA=D
var Se=5
r.SUB_TOOLS=Se
var Ie=6
r.SUB_BLUEPRINTS=Ie
var Ae=7
r.SUB_SEARCH=Ae
var P=e("assert")
var B=e("../glov/client/camera2d")
var i=e("../glov/client/cmds").cmd_parse
var v=e("../glov/client/edit_box").editBoxCreate
var E=e("../glov/client/engine")
var we=e("../glov/client/input")
var k=e("../glov/client/input").KEYS
var o=e("../glov/client/net").netSubs
var Le=e("../glov/client/scroll_area").scrollAreaCreate
var Oe=e("../glov/client/settings")
var n=e("../glov/client/sprites")
var Re=n.spriteClipPause
var be=n.spriteClipResume
var Ne=e("../glov/client/ui")
var s=e("../glov/client/ui")
var U=s.button
var G=s.buttonImage
var F=s.buttonText
var Ce=s.buttonWasFocused
var l=s.modalDialog
var _=s.modalTextEntry
var xe=s.panel
var Me=s.uiButtonHeight
var c=s.uiGetFont
var u=s.uiGetTitleFont
var De=s.uiTextHeight
var d=e("../glov/common/util")
var f=d.cmpNumericSmart
var Pe=d.defaults
var h=d.sanitize
var p=e("../glov/common/vmath").vec2
var m=e("../common/blueprint_common").BLUEPRINT_NAME_LEN
var g=e("../common/ids")
var T=g.ITEM_ACCESS_CONTROL
var y=g.ITEM_ALGAE
var S=g.ITEM_ANEMONE
var I=g.ITEM_ANVIL
var A=g.ITEM_BED
var w=g.ITEM_BENCH
var L=g.ITEM_BERRY_BUSH_BLUE
var O=g.ITEM_BERRY_BUSH_RED
var R=g.ITEM_BERRY_BUSH_YELLOW
var b=g.ITEM_BERRY_DECORATIVE
var W=g.ITEM_BLUEPRINT
var H=g.ITEM_BONFIRE
var z=g.ITEM_BONFIRE_METAL
var V=g.ITEM_BOTTLE
var Y=g.ITEM_BRANCHFORGE
var j=g.ITEM_BREAD_DECORATIVE
var K=g.ITEM_BUCKET
var q=g.ITEM_BUZZERGOAL
var X=g.ITEM_BUZZERSTART
var Q=g.ITEM_CACTINY
var $=g.ITEM_CACTORB
var J=g.ITEM_CAMPFIRE
var ee=g.ITEM_CHAIN
var te=g.ITEM_CHAIR
var re=g.ITEM_CHAIR_METAL
var ae=g.ITEM_CHEST_MEDIUM
var ie=g.ITEM_CHEST_MEDIUM_METAL
var oe=g.ITEM_CHEST_MEDIUM_WOOD_ALIAS
var ne=g.ITEM_CHEST_SMALL
var se=g.ITEM_CHEST_TALL
var le=g.ITEM_CHEST_TINY
var _e=g.ITEM_COAL
var ce=g.ITEM_CORAL_TUBES
var ue=g.ITEM_CUP_METAL
var de=g.ITEM_CUP_STONE
var fe=g.ITEM_CUP_WOOD
var ve=g.ITEM_DISC_CORAL
var he=g.ITEM_DOME
var pe=g.ITEM_DOMESTONE
var me=g.ITEM_DOMEWOOD
var Ee=g.ITEM_DOOR
var ge=g.ITEM_DOOR_DOUBLE
var Te=g.ITEM_DOOR_DOUBLE_GATE
var ye=g.ITEM_DOOR_DOUBLE_METAL
var Be=g.ITEM_DOOR_METAL
var ke=g.ITEM_ENERGY_WELL
var Ue=g.ITEM_FACTORY_DEBUG
var Ge=g.ITEM_FENCE
var Fe=g.ITEM_FENCE_METAL
var We=g.ITEM_FLOUR
var He=g.ITEM_FLOWERPOT
var ze=g.ITEM_FURNACE_GLASS
var Ve=g.ITEM_FURNACE_ORE
var Ye=g.ITEM_GEM
var je=g.ITEM_GRASS
var Ke=g.ITEM_GRASS_SPIKY
var qe=g.ITEM_GROW
var Ze=g.ITEM_HOE
var Xe=g.ITEM_INGOT
var Qe=g.ITEM_JUICER
var $e=g.ITEM_KILN
var Je=g.ITEM_LADDER
var et=g.ITEM_LADDER_METAL
var tt=g.ITEM_LANTERN
var rt=g.ITEM_LANTERN_METAL
var at=g.ITEM_LEAPGATE
var it=g.ITEM_LIGHT_CUBE
var ot=g.ITEM_LIGHT_CUBE_METAL
var nt=g.ITEM_MILL
var st=g.ITEM_ORE
var lt=g.ITEM_OVEN
var _t=g.ITEM_PAINT_MIXER
var ct=g.ITEM_PARTICLE_DEBUGGER
var ut=g.ITEM_PLANT
var dt=g.ITEM_PLATE_METAL
var ft=g.ITEM_PLATE_STONE
var vt=g.ITEM_PLATE_WOOD
var ht=g.ITEM_ROD_METAL_ALIAS
var pt=g.ITEM_ROD_STONE
var mt=g.ITEM_ROD_WOOD_ALIAS
var Et=g.ITEM_RUG
var gt=g.ITEM_SAPLING
var Tt=g.ITEM_SAWMILL
var yt=g.ITEM_SEASHELL
var St=g.ITEM_SEEDS_CARROT
var It=g.ITEM_SEEDS_CORAL_MUSHROOM
var At=g.ITEM_SEEDS_CORN
var wt=g.ITEM_SEEDS_PUMPKIN
var Lt=g.ITEM_SEEDS_SUGAR_CANE
var Ot=g.ITEM_SEEDS_TOMATO
var Rt=g.ITEM_SEEDS_WHEAT
var bt=g.ITEM_SHELF
var Nt=g.ITEM_SHELF_METAL
var Ct=g.ITEM_SIGNBOARD
var xt=g.ITEM_SIGNBOARD_METAL
var Mt=g.ITEM_SIGNBOARD_STONE
var Dt=g.ITEM_SIGNPOST
var Pt=g.ITEM_SIGNPOST_METAL
var Bt=g.ITEM_SIGNPOST_STONE
var kt=g.ITEM_SPICE_PLANT
var Ut=g.ITEM_STARFISH
var Gt=g.ITEM_STEPS
var Ft=g.ITEM_STONECUTTER_SIMPLE
var Wt=g.ITEM_TABLE_LARGE
var Ht=g.ITEM_TABLE_LARGE_METAL
var zt=g.ITEM_TABLE_SMALL
var Vt=g.ITEM_TABLE_SMALL_METAL
var Yt=g.ITEM_TEST00
var jt=g.ITEM_TOOL_HEAD_CAST
var Kt=g.ITEM_TORCH
var qt=g.ITEM_VASE_METAL
var Zt=g.ITEM_VASE_WOOD
var Xt=g.ITEM_VEINIUM_GRINDER
var Qt=g.ITEM_WATERING_SYSTEM
var $t=g.ITEM_WAYGATE
var Jt=g.ITEM_WILD_CROP
var er=g.ITEM_WINDOW_LARGE
var tr=g.ITEM_WINDOW_MEDIUM
var rr=g.ITEM_WINDOW_SMALL
var ar=g.ITEM_WORKBENCH
var ir=g.TYPE_BLOCK
var or=g.TYPE_ITEM
var nr=e("../common/items_common")
var sr=nr.itemHasUnlockMethod
var lr=nr.itemIsReleased
var _r=e("../common/materials_common").Mat
var cr=e("../common/world_constants").ATTRIB_FIXED_MAX
var ur=e("./analytics").logEvent
var dr=e("./app_access").accessPrerelease
var fr=e("./blueprint")
var vr=fr.TYPE_EDITABLE
var hr=fr.blueprintGetDef
var pr=e("./build_mode")
var mr=e("./flora_constants").FLOWERS
var Er=e("./inventory")
var gr=Er.INV_PLAYER
var Tr=Er.countAvailable
var yr=Er.inventoryGet
var Sr=Er.inventoryGetBuildMenuMapped
var Ir=Er.inventoryGetSize
var Ar=Er.inventoryGetVer
var wr=e("./inventory_ui")
var Lr=wr.inventoryButton
var Or=wr.setMouseoverItem
var Rr=wr.setSelectedItem
var br=e("./item_info_view")
var Nr=br.ITEM_INFO_VIEW_W
var Cr=br.itemCustomizationAny
var xr=br.itemCustomizationClear
var Mr=br.itemCustomized
var Dr=br.itemInfoViewClear
var Pr=br.itemInfoViewShow
var Br=br.itemInfoViewing
var kr=e("./item_unlock_ui")
var Ur=kr.itemUnlockClearNew
var Gr=kr.itemUnlockIsNew
var Fr=e("./items")
var Wr=Fr.BOOST_BLOCKED_CURRENTLY
var Hr=Fr.ITEM_CONTEXT_BUILD
var zr=Fr.createItem
var Vr=Fr.itemIsAccountLocked
var Yr=Fr.itemIsAllowedInQuickbar
var jr=Fr.itemIsBlueprint
var Kr=Fr.itemIsSettlementLocked
var qr=Fr.itemPropEntitlementKey
var Zr=Fr.sameItem
var Xr=e("./layout")
var Qr=Xr.WIDE
var $r=Xr.layoutCameraTallWide
var Jr=Xr.layoutCameraTallWideMode
var ea=e("./localization/localization").L
var ta=e("./main")
var ra=Math.floor,aa=Math.max,ia=Math.min
var oa=e("./menu")
var na=e("./menu")
var sa=na.isBuildMenu
var la=na.menuActive
var _a=na.menuPanelX0
var ca=na.menuTabColors
var ua=na.menuX1
var da=na.menuY0
var fa=na.menuY1
var va=e("./quickbar")
var ha=e("./saplings_shared")
var pa=ha.SAPLING_TYPE_OAK
var ma=ha.SAPLING_TYPE_PINE
var Ea=ha.SAPLING_TYPE_POPLAR
var ga=ha.SAPLING_TYPE_WILLOW
var Ta=e("./settlement").settlementCurrent
var ya=e("./styles")
var Sa=ya.label_style
var Ia=ya.menu_header_style
var Aa=e("./tiles")
var wa=Aa.TILE_EMPTY
var La=Aa.TILE_WATER
var Oa=Aa.TILE_WATER_FLOW
var Ra=Aa.tile_map_default
var ba=e("./tiles_ui").TILES_UI_SORT
var Na=e("./ui_util")
var Ca=e("./ui_util_2")
var xa=e("./user_data")
var Ma=xa.isWaiting
var Da=xa.unlimitedItemsAllowed
var Pa=xa.worldReadOnly
var Ba=e("./world_comm")
var ka=Ba.getPerm
var Ua=Ba.getWorldID
var Ga=Ba.myUserCmdParse
var Fa=Ba.myUserCmdParseWrap
var Wa=e("./world_metadata")
var Ha=Wa.adventureMode
var za=Wa.worldLiquid
var Va=e("./worlds_sound").playSound
var Ya=N
function getBuildMenuSubPage(){return Ya}var ja=230
var Ka=8
var qa=false
var Za
var Xa
var Qa
var $a=-1
var Ja=null
var ei
var ti
var ri
var ai=0
var ii=1
var oi=2
var ni=3
var si=4
var li=/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~]/g
function stripSearch(e){return e.replace(/\s+/g," ").replace(li,"").toLowerCase()}function itemUpdateSearch(e){var t=[e.getBuildName({for_search:true})]
t=(t=t.concat(e.getDesc(true))).join(" ")
e.calced_text=stripSearch(t)
if(!e.calced_text)e.calced_text=t.toLowerCase()
e.calced_text_simple=e.calced_text.replace(/ /g,"")
if(!e.calced_text_simple)e.calced_text_simple=t.toLowerCase()}var _i={RECENT:{sort_all:true,cmp:function cmp(e,t){if(e.getBID()){if(t.getBID())return e.blueprint_sort_idx-t.blueprint_sort_idx
return-1}else if(t.getBID())return 1
return f(e.calced_text_simple,t.calced_text_simple)}},NAME:{sort_all:false,cmp:function cmp(e,t){var r=f(e.calced_text_simple,t.calced_text_simple)
if(r)return r
P(e.getBID())
P(t.getBID())
return e.blueprint_sort_idx-t.blueprint_sort_idx}}}
var ci="RECENT"
var ui="RECENT"
var di="NAME"
var fi=((a={})[Ie]=true,a)
function updateSearch(){var e
if(-1!==$a){var t
e=null==(t=ei[Ya])?void 0:t[$a]}var r=[]
for(var a=0;a<Ae;++a){var i=ei[a]
for(var o=0;o<i.length;++o){var n=i[o]
if(!n.calced_text)itemUpdateSearch(n)}if(fi[a])i.sort(_i[ci].cmp)
r=r.concat(i)}var s={}
r=r.filter(function(e){var t=[e.type,e.id,e.attr1||0,e.attr2||0,e.attr3||0].join(",")
if(s[t])return false
return s[t]=true})
if(_i[ci].sort_all)r.sort(_i[ci].cmp)
ei[Ae]=r
if(e&&(Ya===Ae||Ya===Ie))Ja=e}function cmpTile(e,t){return(ba[Ra[e.id].tile_code]||9e9)-(ba[Ra[t.id].tile_code]||9e9)||e.id-t.id}var vi=0
var hi=1
var pi=2
function shouldShowAll(){return E.defines.NEWART&&dr()?pi:E.DEBUG&&!E.defines.NONEWART?hi:vi}var mi
var Ei
function notWorldLiquid(){return!za()}function gatherBuildables(){var e=shouldShowAll()
var t=(mi=e)>=pi
var r=e>=hi
var a=null==ei?void 0:ei[Ie]
var s=dr()
Ei=s
ei=[]
for(var i=0;i<Ae;++i)ei.push([])
if(a)ei[Ie]=a
for(var o in Ra){var n=Ra[o]
o=Number(o)
if(isFinite(o)&&!n.unplaceable&&(!n.next_release||s)){var l=zr({type:ir,id:o})
if(n.crafted)ei[C].push(l)
else ei[N].push(l)}}ei[N].sort(cmpTile)
ei[C].sort(cmpTile)
var _=or
var c=false
var u=x
function add2(e,t,r,a,i,o){var n=zr({type:_,id:e,attr1:t,attr2:r,attr3:a,attribs:i})
if(c)n.unlimited_only_for_build_menu=true
if(o)n.spot_key=o
if(lr(n,s))ei[u].push(n)
return n}function add(e,t,r){add2(e,t,0,r)}function addWithKey(e,t,r,a){add2(e,r,0,a,void 0,t)}function addEachWood(e,t){add(e,_r.LIGHT_WOOD,t)
add(e,_r.WOOD,t)
add(e,_r.DARK_WOOD,t)
add(e,_r.RED_WOOD,t)}function addEachNewMats(e,t){add(e,_r.STONE,t)
add(e,_r.FANCY_STONE,t)
add(e,_r.IRON,t)}function addEachNewMatsExceptMetal(e,t){add(e,_r.STONE,t)
add(e,_r.FANCY_STONE,t)}function addEachBase(e,t){addEachWood(e,t)
addEachNewMats(e,t)}function addEachBaseCustomizedMetal(e,t,r){addEachWood(e,r)
addEachNewMatsExceptMetal(e,r)
if(t)add(t,_r.ANY,r)}function addAttr3Variants(e,t){for(var r=1;r<=t;++r)add(e,0,r)}addEachBaseCustomizedMetal(ae,ie)
if(t)add(oe,_r.ANY,2)
add(ae,_r.WOOD,1)
addEachBaseCustomizedMetal(Ee,Be,0)
addEachBaseCustomizedMetal(Ee,Be,1)
addEachBaseCustomizedMetal(ge,ye)
add(Te,_r.ANY)
addEachBaseCustomizedMetal(Je,et)
addEachWood(Kt)
addEachBaseCustomizedMetal(tt,rt)
addEachBaseCustomizedMetal(it,ot)
addEachWood(Ge)
add(Ge,_r.STONE,0)
add(Ge,_r.STONE,1)
add(Ge,_r.FANCY_STONE)
add(Fe,_r.ANY)
addEachBaseCustomizedMetal(te,re)
addEachBaseCustomizedMetal(Wt,Ht)
addEachBaseCustomizedMetal(zt,Vt)
add(mt,_r.ANY)
add(ht,_r.ANY)
addEachNewMatsExceptMetal(pt)
add(Dt,_r.ANY)
add(Pt,_r.ANY)
addEachNewMatsExceptMetal(Bt)
add(Ct,_r.ANY)
add(xt,_r.ANY)
addEachNewMatsExceptMetal(Mt)
add(me,_r.ANY)
add(he,_r.ANY)
addEachNewMatsExceptMetal(pe)
add(X)
add(q)
add(V,0,1)
add(V)
add(J)
add(Ye)
add($t)
add(_e)
add(st,_r.ANY)
add(Xe,_r.ANY)
add(ee,_r.ANY)
addEachBaseCustomizedMetal(bt,Nt)
add(fe,_r.ANY)
add(ue,_r.ANY)
addEachNewMatsExceptMetal(de)
add(vt,_r.ANY)
add(dt,_r.ANY)
addEachNewMatsExceptMetal(ft)
add(Zt,_r.ANY)
add(qt,_r.ANY,0)
add(qt,_r.ANY,1)
if(t){add(He)
addEachBase(le)
addEachBase(ne)
addEachBase(se)
addEachBase(Gt)
addEachBase(w)
addEachBase(A)
addEachBase(rr)
addEachBase(tr)
addEachBase(er)
add(Et)}if(t&&E.DEBUG)for(var d=0;d<10;++d)add(Yt+d)
if(r)add(ct)
u=M
add($t)
add(J)
add(ke)
addWithKey(ar,"build_menu_workbench")
add(Ft)
add(Tt)
add(Ve)
add(jt)
add(ze)
add(I,_r.IRON)
add(Qe)
add(nt)
add(Qt)
add(Y)
add(lt)
add($e)
add(_t)
add(H)
add(z)
add(Xt)
if(r)add(Ue)
add(T)
add(at)
u=D
add(At)
add(Rt)
add(Lt)
add(Ot)
add(St)
add(wt)
add(gt,_r.LIGHT_WOOD,ga)
add(gt,_r.DARK_WOOD,pa)
add(gt,_r.RED_WOOD,ma)
add(gt,_r.WOOD,Ea)
for(var f=0;f<mr.length;f++)add(ut,0,mr[f].key[0])
add(It)
add(O,0,0)
add(L,0,0)
add(R,0,0)
add($,_r.RUBY_CACTORB)
add($,_r.KYANITE_CACTORB)
add(Q,_r.LIZARDITE_CACTINY)
add(Q,_r.AMETHYST_CACTINY)
add(y,_r.MINT_ALGAE)
add(y,_r.JADE_ALGAE)
add(y,_r.BUBBLEGUM_ALGAE)
add(y,_r.INDIGO_ALGAE)
add(y,_r.ULTRAMARINE_ALGAE)
addAttr3Variants(yt,9)
addAttr3Variants(Ut,3)
addAttr3Variants(S,3)
addAttr3Variants(ve,5)
addAttr3Variants(ce,2)
add(je)
add(Ke)
add(Jt,0,0)
addAttr3Variants(Jt,5)
add(kt,0,_r.HOT)
add(kt,0,_r.PUNGENT)
add(kt,0,_r.SAVORY)
add(We)
add(j)
add(b,_r.RED_BERRY)
add(b,_r.BLUE_BERRY)
add(b,_r.YELLOW_BERRY)
u=Se
c=true
add2(Ze,_r.IRON,_r.WOOD,0,{hp:cr})
add2(K,_r.WOOD,La)
add2(K,_r.WOOD,Oa).filter_func=notWorldLiquid
add2(K,_r.WOOD,wa)
add2(qe,_r.WOOD,0,0,{hp:cr})
if(E.DEBUG)for(var v=0;v<Ae;++v){var h=ei[v]
for(var p=0;p<h.length;++p){var m=h[p]
if(m.isCrafted())P(m.getCraftCost())
if(!(Yr(m)||m.sysadmin_only))P(Yr(m)||m.sysadmin_only)}}updateSearch()}var gi=0
var Ti=false
var yi={}
function blueprintInLibrary(e){return Boolean(yi[e])}function blueprintMetaName(e){var t=yi[e]
return t&&t.meta_name}function blueprintLastPublishedID(e){var t=yi[e]
return t&&t.last_publish}function addBlueprint(e,t,r,a){var i=zr({type:or,id:W,attr1:e})
if(t)i.meta_name=t
if(r)i.last_publish=r
yi[e]=i
var o=ei[Ie]
if(a)if(e[0]===vr)o.splice(0,0,i)
else{var n=0
while(n<o.length&&o[n].getBID()[0]===vr)++n
o.splice(n,0,i)}else{o.push(i)
Ti=true}if(a)updateSearch()
return i}function buildMenuRemoveBlueprint(e){var t=e.getBID()
delete yi[t]
var r=ei[Ie]
for(var a=r.length-1;a>=0;--a)if(r[a].getBID()===t)r.splice(a,1)
$a=-1
if(!Ma()&&Ua())va.unslot(e)
if(t[0]===vr)--gi
updateSearch()}function buildMenuRenameBlueprint(e,t){var r=ei[Ie]
for(var a=r.length-1;a>=0;--a){var i=r[a]
if(i.getBID()===e){i.meta_name=t
itemUpdateSearch(i)}}}function clearUserBlueprints(){ei[Ie].length=0
yi={}
gi=0}var Si=null
function updateUserBlueprints(){if(!ei)gatherBuildables()
function onBlueprintList(e){clearUserBlueprints()
for(var t in e.edit){var r=e.edit[t]
addBlueprint(t,r.name,r.last_publish);++gi}for(var a in e.library)addBlueprint(a,e.library[a].name)
updateSearch()}var e=o().loggedIn()
if(e!==Si)if(Si=e)Fa("blueprint_list",onBlueprintList)
else clearUserBlueprints()
updateSearch()}function refreshBlueprints(){Si=null
updateUserBlueprints()}function newBlueprintName(e){var t=e||ea.LBL_NEW_BLUEPRINT
var r=ei[Ie]
var a={}
for(var i=0;i<r.length;++i)a[r[i].getBlueprintName()]=true
var o=1
if(e){if(!a[e])return e
o++}for(;;++o){var n=String(ea.addParenthesesAfter(t,o))
if(!a[n])return n}}function updateBlueprintMetadata(e){var t=e.bid
var r=yi[t]
if(r){Ti=true
itemUpdateSearch(r)}}function autoSelectBlueprint(e){Ya=Ie
ci=ui
Ja=e}function dynamicAddBlueprint(e,t){if(t){var r=yi[t]
if(r)r.last_publish=e}var a=addBlueprint(e,void 0,void 0,true)
itemUpdateSearch(a)
if(ta.main_active&&!Pa()){va.selectByItem(a)
autoSelectBlueprint(a)}}function blueprintAddToLibrary(r,a){if(!(r=r.trim().toUpperCase()))return void a(ea.ERR_MISSING_BLUEPRINT_ID)
Ga("blueprint_add "+r,function(e,t){if(!e)dynamicAddBlueprint(r)
a(e,t)})}i.register({cmd:"blueprint_add",help:"Add a public blueprint to your library",func:blueprintAddToLibrary})
function blueprintAddToLibraryOrSelect(e,t){if(!blueprintInLibrary(e))return void blueprintAddToLibrary(e,function(e){t()})
var r=yi[e]
if(!Ma())va.selectByItem(r)
autoSelectBlueprint(r)
t()}function searchPrep(e){var t=e.split(" ").filter(function(e){return e})
if(!t.length)return null
var r=[]
var a=0
var i=false
while(a<t.length){var o=t[a++]
if('"'===o[0]){i=true
o=o.slice(1)
while(a<t.length){var n=t[a++]
if('"'===n.slice(-1)){o+=" "+n.slice(0,-1)
break}o+=" "+n}}r.push(stripSearch(o))}r.quoted=i
return r}function searchMatch(e,t){if(1===e.length&&!e.quoted)return-1!==t.calced_text_simple.indexOf(e[0])
var r=t.calced_text
for(var a=0;a<e.length;++a)if(-1===r.indexOf(e[a]))return false
return true}function buildMenuInit(){$a=-1
Dr()}function deselect(){$a=-1
Dr()}function buildMenuStartup(){Za=Na.sprite
ti=c()
ri=u()
o().onLogin(updateUserBlueprints)
o().on("logout",updateUserBlueprints)
o().onChannelMsg("user","blueprints_need_refresh",refreshBlueprints)
gatherBuildables()}Oe.register({build_menu_details:{label:"Build Menu Details View",default_value:1,type:i.TYPE_INT,range:[0,1]},blueprint_name_first:{label:"Choose Blueprint Name First",default_value:0,type:i.TYPE_INT,range:[0,1]}})
function buildMenuIsOpenAndIconView(){return!Oe.build_menu_details&&la()&&sa()}var Ii=[0,0,0,0]
var Ai=-1
var wi
var Li=p()
var Oi=p(24,24)
var Ri
function buildMenuContext(e){$r()
if(e){if(Ai===E.frame_index-1)B.set.apply(B,Ii)}else{Ai=E.frame_index
Ii=[B.x0(),B.y0(),B.x1(),B.y1()]}if(Ri===E.frame_index)return wi
Ri=E.frame_index
var t=oa.page===oa.QUICK_SLOT
var r=false
var a=Me()
var i=qa
var o=[]
if(Ya===Ie)o.push(ai)
if(Ya===x||Ya===M)if(Cr())o.push(si)
if(Da())i=false
else if(Ya===Se)i=true
else o.push(ii)
if(Ya===Ie)o.push(ni)
if(Ya===Ae){var n=Xa&&Xa.isFocused()
if(we.touch_mode&&n){B.domDeltaToVirtual(Li,Oi)
a=aa(a,Li[0])
if(B.w()>3*B.h()){r=true
a*=2}}o.push(ni)}o.push(oi)
var s=a/Me()
P(isFinite(s))
P(s>0)
var l=r?B.x0():_a()
var _=r?B.x1():ua()
var c=0
var u=l+Ka
var d=_-u
var f=r?B.y0():da()
if(c)d-=ja*s
return wi={do_filter_afford:i,list_row_height:a,list_fullscreen:r,is_quick_slot:t,buttons:o,scale:s,do_selected:c,max_x:_,avail_w:d,x0:l,y0:f,contents_x:u,did_early:false}}function buildMenuTooltip(e){var t=e.tooltip_user_data,r=e.tooltip_clicking_closes,a=e.tooltip_inv,i=e.tooltip_is_locked
var o=t.is_quick_slot,n=t.details_view
if(o)return n?null:a.getBuildName()
else{var s=n?"":a.getBuildName()+"\n"
if(i)return(s+=ea.TLTP_LOCKED_ITEM+"\n")+(sr(a,"lf_break")?ea.TLTP_LOCKED_ITEM_LF_BREAK+"\n":"")
var l=we.touch_mode?ea.INPUT_TAP:ea.INPUT_CLICK
var _=we.touch_mode?ea.INPUT_TAP_DOUBLE:ea.INPUT_CLICK_RIGHT
var c=r?ea.TLTP_CLOSE_BUILD_MENU:ea.TLTP_SELECT_IN_QB_AND_VIEW
s+=oa.prefixShortcutKey(l,c)+"\n"+oa.prefixShortcutKey(_,ea.TLTP_SELECT_AND_CLOSE_BUID_MENU)
if(!we.touch_mode)s+="\n"+oa.prefixShortcutKey("2-"+(Oe.split_build?7:8),ea.TLTP_PLACE_IN_QB)
return s}}var bi=12
var Ni
var Ci=null
var xi=0
var Mi={}
function showList(e,t,r,a,i,o,n){var s=e.is_quick_slot,l=e.do_filter_afford,_=e.scale
profilerStart("filter")
var c=De()*_
var u=Me()*_
var d=u
var f=d+bi*_
var v=f
var h=ra((o-d)/f)+1
var p=Ya===Ae&&Qa&&searchPrep(Qa)
var m=[]
var E=[]
var g=false
var T=false
for(var y=0;y<t.length;++y){var S=t[y]
var I=false
if(p&&!searchMatch(p,S))I=true
if(!I&&(S.unlimited_only||S.unlimited_only_for_build_menu)&&!Da())I=true
if(!I&&(Vr(S)||S.isBoostBlocked()===Wr)){I=true
E.push(y)}if(!I&&S.sysadmin_only&&!ka("csr"))I=true
if(!I&&S.is_settlement_locked){var A=Kr(S)
if(1===A)g=true
else if(2===A)I=g=true}if(!I&&l)if(!Tr(S))if(jr(S)){var w=hr(S.getBID())
if(w&&!w.loaded);else T=I=true}else T=I=true
if(!I&&S.filter_func&&!S.filter_func())I=true
if(!I)m.push(y)}var L=[]
for(var O=0;O<m.length;++O){var R=m[O]
var b=t[R]
L[R]=Tr(b)}if(!Da())m.sort(function(e,t){if(L[e]){if(!L[t])return-1}else if(L[t])return 1
return e-t})
if(Ya!==Ae&&!T)m=m.concat(E)
if(!Ni)Ni=Le({z:Z.UI,background_color:null,auto_hide:false,no_disable:true,min_dist:pr.MIN_DRAG_DISTANCE})
var N=aa(1,ra(h/3))
var C=Oe.build_menu_details
if(C)f=(d=(o-(h=N)*bi*_-Ni.barWidth())/h)+bi*_
if(Ja){var x=t.indexOf(Ja)
if(-1!==x){$a=x
var M=m.indexOf(x)
if(-1!==M){var D=ra(M/h)
Ni.scrollIntoFocus(D*v,(D+1)*v,n)}}}var P=!we.touch_mode&&!s
var B={x:r,y:a,z:i,w:o,h:n}
Ni.begin(B)
r=a=0
var k={is_quick_slot:s,details_view:C}
profilerStopStart("show")
var U=0
var G=0
for(var F=0;F<m.length;++F){var W=m[F]
var H=t[W]
var z=H=Sr(H)
var V=(H=Mr(H)).fallback
var Y=P&&!V
var j=s&&!V
var K=$a===W
var q=L[W]
if(K)Rr(H)
if(U>=h){U=0
G++}var X=r+U*f
var Q=a+G*v
U++
if(Q+v<Ni.getScrollPos()||Q>Ni.getScrollPos()+B.h)continue
var $=H.spot_key||F
var J=Mi[$]
if(!J)J=Mi[$]={drag_over:true,dynamic_snapshot_on_mouseover:true,tooltip:buildMenuTooltip,tooltip_markdown:false,key:H.spot_key||"bm"+F,item_context:Hr}
J.tooltip_user_data=k
J.tooltip_inv=H
J.tooltip_is_locked=V
J.x=X
J.y=Q
J.z=i+2
J.w=d
J.h=u
J.left_align=C
J.draw_only_mouseover=V
delete J.count_override
var ee=void 0
if(jr(H))if(!(ee=hr(H.getBID())).loaded||ee.error)J.count_override=ee.error?ea.LBL_ERROR.lower():ea.MSG_LOADING.lower()
if(Da()||V){J.hide_count=true
J.auto_count=false}else{J.hide_count=false
J.auto_count=true}J.in_event_cb=void 0
if(Y){var te=J.drag_param
if(!te){(te=J.drag_param={}).min_dist=pr.MIN_DRAG_DISTANCE
te.button=0}te.x=J.x
te.y=J.y
te.w=J.w
te.h=J.h
H.item_context=Hr
te.payload=H
var re=we.drag(te)
if(re){var ae=Pe({disabled:true,x:re.cur_pos[0]-u/2,y:re.cur_pos[1]-J.h/2,z:Z.DRAG,w:u,base_name:"inv_active",draw_only:true,dynamic_snapshot_on_mouseover:false,dynamic_snapshot:false},J)
Re()
Lr(ae,H)
be()
$a=W}}J.base_name=K?"inv_selected":q?"inv_active":"inv_empty"
if(ee&&ee.isEditable()&&"inv_selected"!==J.base_name)J.base_name="inv_customize"
var ie=K&&Br(H,Hr)&&!V
J.tooltip_clicking_closes=ie
var oe=null
if(H.is_settlement_locked&&Ha()&&H.id!==ke)J.hook="w_b_"+H.id
else{var ne=qr(H)
if(ne&&!H.silhouette&&Gr(ne)){oe=ne
J.hook="false"}else J.hook=void 0}if(Y){J.in_event_cb=we.pointerLockEnter
if(ie){J.button=0
if(we.click(J)){Va("button_click")
va.selectByItem(H)
ta.menuExit()}delete J.phys}J.button=2
if(we.click(J)){Va("button_click")
va.selectByItem(H)
ta.menuExit()}delete J.button
delete J.in_event_cb}else if(j){J.button=2
var se=false
if(we.click(J))se=true
delete J.button
if(we.longPress(J))se=true
if(se){Va("button_click")
Ci=z
xi=J.x+J.w
if($a===W&&Br(H,Hr))deselect()
else $a=W}J.button=0
J.in_event_cb=we.pointerLockEnter}var le=Lr(J,H)
if(le){if(oe)Ur(oe)
if(j){va.setQuickItem(H)
ta.menuExit()}else if(ie)ta.menuExit()
else{if(!V)va.selectByItem(H)
Ci=z
xi=J.x+J.w
if(we.touch_mode&&le.double_click){Ci=null
ta.menuExit()}if($a===W&&Br(H,Hr))deselect()
else $a=W}}if(Ce()&&!V)Or(H)
if(C){var _e=X+u
ti.drawSizedAligned(Sa,_e,Q,i+4,24*_,ti.ALIGN.HFIT|ti.ALIGN.VCENTER,X+d-_e-8,u,H.getBuildName())}}var ce=a+ ++G*v
if(!m.length){var ue=n/3
ti.drawSizedAligned(Sa,r,a,i,2*c,ti.ALIGN.HVCENTER,o,ue,Ya===Se?ea.BUILDMENU_NO_TOOLS_OR_CONSUMABLES:T?ea.BUILDMENU_NOTHING_AFFORDABLE:g&&!Ta()?ea.MSG_OUT_OF_SETTLEMENT_ALERT:Ya===Ie?ea.BUILDMENU_NO_BP_AVAILABLE:ea.BUILDMENU_ITEM_NOT_FOUND)
ce+=.5*ue}var de
if(g&&Ya!==Ae)if(!Ta())de=[ea.MSG_OUT_OF_SETTLEMENT_ALERT]
else de=[ea.BUILDMENU_UNLOCK_SCHEMATICS]
if(Ya===Ie&&t.length<4)de=[ea.BUILDMENU_HINT_NEW_BP_MSG_CREATE,ea.BUILDMENU_HINT_NEW_BP_MSG_START]
if(Ya===Se&&m.length<6&&!Da()&&Ha())de=[ea.BUILDMENU_HINT_CRAFT_TOOLS_AND_CONSUMABLES]
if(de){var fe=600
var ve=24
var he=r+(o-fe)/2
var pe=ce+=v/2
var me=2*c
var Ee=(v-me)/2
ce+=Ee
for(var ge=0;ge<de.length;++ge)ce+=ti.drawSizedAligned(Sa,he,ce,i+1,me,ti.ALIGN.HCENTER|ti.ALIGN.HWRAP,fe,0,de[ge])
xe({x:he-ve,y:pe,z:i,w:fe+2*ve,h:(ce+=Ee)-pe,color:oa.hint_color,sprite:Ne.sprites.hint_panel})}Ni.end(ce)
if(1===m.length&&Ya===Ae){var Te=m[0]
var ye=t[Te]
if(!va.getSelected()||!Zr(va.getSelected(),ye)){va.selectByItem(ye)
Ci=ye
xi=r
$a=Te}}Ja=null
profilerStop()}var Di=120
var Pi=48
var Bi=8
function buttonsWidth(e,t,r){var a=Di*t
var i=(a+Bi)*e.length
if(e.includes(ni))i+=a/2
if(e.includes(si))i=i-a+r
return i}var ki=0
function doBuildEarly(){var e=buildMenuContext(true)
var t=e.list_fullscreen,r=e.list_row_height,a=e.scale,i=e.avail_w,o=e.contents_x,n=e.buttons,s=e.y0
e.did_early=true
if(Ya===Ae){var l=s
var _=Xa&&Xa.isFocused()
if(!Xa)Xa=v({placeholder:ea.LBL_SEARCH_ALL,initial_select:true,auto_unfocus:true,max_len:40,text:"",spellcheck:false})
var c=l
var u=2*De()
var d=300
if(we.touch_mode){u=r
d=ia(_?10*u:400,i-buttonsWidth(n,a,r)-2*Ka)}d=ia(d,i-Ka)
var f=Xa.run({x:o,y:c,w:d,font_height:u,initial_focus:!we.touch_mode,pointer_lock:!we.touch_mode})
if(f===Xa.SUBMIT)Xa.unfocus()
else if(f===Xa.CANCEL)ta.menuExit()
ki=c+u+12}if(t)doBuild(true)}function cmpBlueprint(e,t){var r=e.getBID()
var a=t.getBID()
if(r[0]!==a[0])if(r[0]===vr)return-1
else return 1
var i=hr(r)
if(i&&!i.loaded)i=null
var o=hr(a)
if(o&&!o.loaded)o=null
if(!i){if(!o)return r<a?-1:1
return 1}else if(!o)return-1
return o.modified-i.modified||(r<a?-1:1)}function sortBlueprints(){var e=ei[Ie]
e.sort(cmpBlueprint)
for(var t=0;t<e.length;++t)e[t].blueprint_sort_idx=t}var Ui=false
function doBlueprintAllocate(i){Ui=true
var e=Ua()
Ga("blueprint_create "+e+" "+i,function(e,t){Ui=false
var r=t&&t.blueprint_id
if(r){var a=addBlueprint(r,i,void 0,true);++gi
itemUpdateSearch(a)
if(!Ma()&&Ua())va.selectByItem(a)
autoSelectBlueprint(a)
ta.menuExit()}else{e=e||ea.CHATERROR_EMPTY_RESPONSE
ta.chat_ui.addChatError(e)
we.pointerLockExit()}})}var Gi=""
function newBlueprint(e){var t=ka("max_blueprints")
if(gi>=t){ur("blueprint_new_fail",1,"button",null,{num:gi,quota:t})
l({title:ea.DLG_QUOTA_EXCEEDED_TITLE,text:ea.$(ea.DLG_QUOTA_EXCEEDED_MSG,ka("max_blueprints")),buttons:{OK:null}})}else{ur("blueprint_new",1,"button",null,{num:gi,quota:t})
if(e)_({edit_text:Gi||"",title:ea.DLG_NAME_BP_TITLE,text:ea.DLG_NAME_BP_MSG,max_len:m,buttons:{OK:function OK(e){Gi=e=h(e).trim()
doBlueprintAllocate(newBlueprintName(e))},Cancel:null}})
else doBlueprintAllocate(newBlueprintName())}}var Fi=[]
var Wi
function gatherToolsList(e){var t=Ar(gr)
if(t===Wi)return Fi
var r=Ir(gr)
var a=0
e:for(var i=0;i<r;++i){var o=yr(i)
if(o&&o.showOnToolPage()){if(o.has_hp){if(!o.hp_cur)continue;(o=zr(o)).hp_cur=o.hp_max}for(var n=0;n<a;++n)if(Zr(Fi[n],o,"hp"))continue e
Fi[a++]=o}}(Fi=Fi.concat(e)).length=a+e.length
Wi=t
return Fi}function doBuild(e){profilerStart("doBuild")
profilerStart("top")
var t=buildMenuContext(e)
var r=t.list_fullscreen,s=t.list_row_height,l=t.scale,_=t.buttons,a=t.max_x,c=t.avail_w,i=t.x0,u=t.y0,d=t.contents_x,o=t.did_early,n=t.is_quick_slot
if(!o)doBuildEarly(e)
if(r&&true!==e){profilerStop()
profilerStop("doBuild")
return}if(mi!==shouldShowAll()||Ei!==dr())gatherBuildables()
if(Ti){Ti=false
sortBlueprints()
updateSearch()}var f=Z.UI+15
var v=i-Me()
var h=u
var p=De()*l
function tabButton(e,t,r,a,i,o){var n=Ya===e
if(G({x:v-4,y:h,z:n?f:f-20,z_bias:n?null:{down:20},shrink:o||.7,img:Za,frame:t,colors:ca(n),disabled:false,base_name:n?"tab_horiz":"tab_inactive",tooltip:r,drag_over:true,reddot_pos:"upper_left",hook:i,key:"build_menu_tab_"+e})){if(!n&&Ni)Ni.resetScroll()
if(e<Ya)n=true
Ya=e
$a=-1
Dr()
if(Ya===Ie&&ui!==ci){ci=ui
updateSearch()}else if(Ya===Ae&&di!==ci){ci=di
updateSearch()}}h+=Me()
if(n&&!a)ri.drawSizedAligned(Ia,d,u+Ka,f,Pi*l,ti.ALIGN.HFIT,c-buttonsWidth(_,l,s),0,r)}if(!r){h+=.25*Me()
tabButton(N,Na.RAW_BLOCKS,ea.LBL_RAW_BLOCKS)
tabButton(C,Na.CRAFTED_BLOCKS,ea.LBL_CRAFTED_BLOCKS)
tabButton(x,Na.PROPS,ea.LBL_PROPS,false,"new_build_lf_break_props")
tabButton(M,Na.SETTLEMENT_PROPS,ea.LBL_SETTLEMENT,false,"new_build_settlement",.8)
tabButton(D,Na.TAB_FLORA,ea.LBL_FARMING_AND_FLORA,false,"new_build_lf_break_flora",.8)
tabButton(Se,Na.TAB_TOOLS,ea.LBL_TOOLS_AND_CONSUMABLES,false,void 0,.8)
tabButton(Ie,Na.BLUEPRINTS,ea.addParenthesesAfter(ea.LBL_BLUEPRINTS,ea.$(ea.FORMAT_FRACTION,gi,ka("max_blueprints"))))
h+=.5*Me()
tabButton(Ae,Na.SEARCH,ea.LBL_SEARCH_ALL,true)}v=d
var m=fa()
if(r)m=B.y1()
var E=d+c
var g={y:h=u,z:f,w:Di*l,h:s,font_height:p}
E-=buttonsWidth(_,l,s)
for(var T=0;T<_.length;++T){switch(_[T]){case ai:var y=(we.keyDown(k.SHIFT)?1:0)^Oe.blueprint_name_first
var S=Ui?ea.BTN_ALLOCATING:y?ea.addEllipsis(ea.BTN_NEW_BP):ea.BTN_NEW_BP
var I={keyname:ea.INPUT_KEY_SHIFT.upper()}
var A=Oe.blueprint_name_first?ea.TLTP_HOLD_SKIP_NEW_NAME:ea.TLTP_HOLD_NEW_NAME
A=ea.TLTP_NEW_BP+"\n"+A.$(I)
var w=F(Pe({x:E,button_long_press:true,text:S,disabled:Ui,in_event_cb:!we.touch_mode&&!y?we.pointerLockEnter:null,tooltip:A},g))
if(w){if(w.long_press||2===w.button)y=!y
newBlueprint(y)}break
case ii:if(F(Pe({x:E,text:qa?ea.BTN_AFFORDABLE_ITEMS:ea.BTN_ALL_ITEMS},g)))qa=!qa
break
case oi:if(F(Pe({x:E,text:Oe.build_menu_details?ea.BTN_DETAILS:ea.BTN_ICONS},g)))Oe.set("build_menu_details",1-Oe.build_menu_details)
break
case ni:if(U(Pe({x:E,w:1.5*g.w,text:"RECENT"===ci?ea.LBL_SORT_RECENT:ea.LBL_SORT_NAME,shrink:.5,img:Na.sprite,frame:Na.SORT},g))){if("RECENT"===ci)ci="NAME"
else ci="RECENT"
if(Ya===Ie)ui=ci
else di=ci
updateSearch()}E+=.5*g.w
break
case si:if(U(Pe({x:E,w:g.h,img:Ca.sprite,frame:Ca.CUSTOMIZATION_CLEAR,tooltip:ea.TLTP_CUSTOMIZATION_CLEAR},g)))xr()
E=E-g.w+g.h
break
default:P(0)}E+=g.w+Bi}var L=h+g.h+Bi
if(Ya===Ae)if(Xa){Qa=Xa.getText()
L=aa(L,ki)}var O=ei[Ya]
if(Ya===Se&&!Da())O=gatherToolsList(ei[Ya])
var R=m-L-Ka
Ci=null
profilerStopStart("showList")
if(c>0&&R>0)showList(t,O,v,L,f,c,R)
profilerStop()
if(r){xe({x:B.x0Real(),y:u,z:f-1,w:B.wReal(),h:m-u,color:oa.panel_color,pixel_scale:Me()/256})
Dr()}if(Ci){var b=a-Nr+50
if(xi+150>b)b=Jr()===Qr?100:Ka
Pr({x:b,y:200,inv:Ci,auto_close:false,context:Hr,allow_customize:true,for_quick_slot:n})}profilerStop("doBuild")}},{"../common/blueprint_common":240,"../common/ids":249,"../common/items_common":251,"../common/materials_common":253,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/edit_box":303,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/settings":351,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./app_access":12,"./blueprint":28,"./build_mode":33,"./flora_constants":101,"./inventory":114,"./inventory_ui":115,"./item_info_view":117,"./item_unlock_ui":118,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./quickbar":172,"./saplings_shared":179,"./settlement":181,"./styles":197,"./tiles":199,"./tiles_ui":201,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./world_comm":226,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],33:[function(e,t,r){"use strict"
r.doStamina=doStamina
r.doDurability=doDurability
r.startup=startup
r.doingDragPlace=doingDragPlace
r.shift=shift
r.tempPoint=tempPoint
r.tempMat=tempMat
r.tempColorFade=tempColorFade
r.oreFromLocalPos=oreFromLocalPos
r.applyDigProgress=applyDigProgress
r.isEmptyOrBag=isEmptyOrBag
r.addToBagSplatter=addToBagSplatter
r.protectBlock=protectBlock
r.protectBlockIdx=protectBlockIdx
r.tileMaterial=tileMaterial
r.playSoundForMaterial=playSoundForMaterial
r.consumeDurability=consumeDurability
r.checkStaminaBeforeAction=checkStaminaBeforeAction
r.drawUtilVoxel=drawUtilVoxel
r.propAutoSelectOnBreakArea=propAutoSelectOnBreakArea
r.interactDetails=interactDetails
r.interactableProp=interactableProp
r.undergroundFactors=undergroundFactors
r.tickBuildModeInactive=tickBuildModeInactive
r.mouseMoveFadeReset=mouseMoveFadeReset
r.tempPointReset=tempPointReset
r.doPointerLockTop=doPointerLockTop
r.doPointerLockBottom=doPointerLockBottom
r.pointerLockJustEntered=pointerLockJustEntered
r.suppressQueuedPlaceCancel=suppressQueuedPlaceCancel
r.cancelDragPlace=cancelDragPlace
r.tickBuildMode=tickBuildMode
r.buildModeReset=buildModeReset
r.tex_voxel_util=r.color_prop_blocked=r.MAX_INTERACT_DIST_CHECK_SQ=r.MAX_INTERACT_DIST=r.MIN_DRAG_DISTANCE=r.VU_TILE_RETICULE_WATER=r.VU_TILE_RETICULE_DIG=r.VU_TILE_DIG_PROGRESS=r.VU_TILE_BRUSHSIZE3=r.VU_TILE_BRUSHSIZE2=r.VU_TILE_BOX=r.VU_TILE_ERROR=void 0
var N=0
r.VU_TILE_ERROR=N
var H=1
r.VU_TILE_BOX=H
var C=2
r.VU_TILE_BRUSHSIZE2=C
var a=3
r.VU_TILE_BRUSHSIZE3=a
var y=4
r.VU_TILE_DIG_PROGRESS=y
var n=9
r.VU_TILE_RETICULE_DIG=n
var x=10
r.VU_TILE_RETICULE_WATER=x
var i=20
var o=11
var M=160
var D=20
var s=20
r.MIN_DRAG_DISTANCE=s
var P=32
var l=11
var _=Math.max(l,i)
var c=((r.MAX_INTERACT_DIST=_)+5)*(_+5)
r.MAX_INTERACT_DIST_CHECK_SQ=c
var u=200
var d=100
var S=1500
var z=e("assert")
var V=e("gl-mat4/invert")
var Y=e("../glov/client/camera2d")
var f=e("../glov/client/cmds").cmd_parse
var j=e("../glov/client/engine")
var v=e("../glov/client/font").ALIGN
var K=e("../glov/client/input")
var h=e("../glov/client/input").mouseDownAnywhere
var I=e("../glov/client/net").netDisconnected
var q=e("../glov/client/settings")
var p=e("../glov/client/spot").spotUnfocus
var m=e("../glov/client/textures")
var E=e("../glov/client/ui")
var X=E.buttonText
var Q=E.buttonWasFocused
var g=E.drawCircle
var T=E.drawHollowCircle
var $=E.isMenuUp
var J=E.uiButtonHeight
var A=E.uiGetFont
var w=E.uiTextHeight
var L=e("../glov/common/util")
var B=L.clamp
var O=L.defaults
var R=L.easeOut
var b=L.nop
var k=L.ridx
var U=e("../glov/common/verify")
var G=e("../glov/common/vmath")
var F=G.half_vec
var W=G.mat4
var ee=G.unit_vec
var te=G.v2addScale
var re=G.v2copy
var ae=G.v2same
var ie=G.v2set
var oe=G.v3add
var ne=G.v3addScale
var se=G.v3copy
var le=G.v3distSq
var _e=G.v3dot
var ce=G.v3floor
var ue=G.v3iAdd
var de=G.v3iFloor
var fe=G.v3iNormalize
var ve=G.v3mulMat4
var he=G.v3same
var pe=G.v3sub
var me=G.v4copy
var Ee=G.v4set
var ge=G.vec2
var Te=G.vec3
var ye=G.vec4
var Se=G.xaxis
var Ie=G.yaxis
var Ae=G.zaxis
var we=e("../common/globals")
var Le=we.CHUNK_SIZE
var Oe=we.ID_FACTOR
var Re=e("../common/ids")
var be=Re.ITEM_BAG
var Ne=Re.ITEM_BLUEPRINT
var Ce=Re.ITEM_DOWSER_ADVANCED
var xe=Re.ITEM_DOWSER_SIMPLE
var Me=Re.ITEM_GROW
var De=Re.ITEM_HANDSTOOL
var Pe=Re.ITEM_HOE
var Be=Re.ITEM_ORE
var ke=Re.ITEM_SAPLING
var Ue=Re.ITEM_WAYGATE
var Ge=Re.TYPE_BLOCK
var Fe=Re.TYPE_CRAFT_CLASS
var We=Re.TYPE_ITEM
var He=e("../common/materials_common").Mat
var ze=e("../common/megachunk_common")
var Ve=e("../common/voxel_data_common")
var Ye=Ve.ANIM_STYLE_BEAM
var je=Ve.ANIM_TYPE_PLAYER
var Ke=Ve.ANIM_TYPE_POS
var qe=e("../common/world_constants")
var Ze=qe.TOOL_LOCK_CRAFTED
var Xe=qe.WORLD_DIG_MAX_CLIENTS
var Qe=e("../common/world_trans").encodeChunkPos
var $e=e("./analytics").logEvent
var Je=e("./bluebox_edit_list")
var et=Je.blueboxEditListCheck
var tt=Je.boundedPropListCheck
var rt=Je.boundedPropListCheckPoint
var at=e("./bluebox_ui")
var it=at.blueboxAutoSelect
var ot=at.blueboxShowPreview
var nt=at.tickBlueboxUI
var st=e("./blueprint").STATE_PRE_EDIT
var lt=e("./build_menu").blueprintInLibrary
var _t=e("./build_queue_ui").boostWidgetShow
var ct=e("./camera")
var ut=ct.cameraHandleDrag
var dt=ct.getCurrentCameraPos
var ft=ct.getCurrentCameraTargetDir
var vt=ct.getCurrentViewMatrix
var ht=e("./client_entities").getEntityManager
var pt=e("./debug")
var mt=e("./dowser_simple").simpleDowserStartup
var Et=e("./dowser_ui").dowserUI
var gt=e("./draw_line3d").drawLine3D
var Tt=e("./editvolume_client")
var yt=Tt.editVolumeShift
var St=Tt.inEditBounds
var It=Tt.settlementEstablishAllowed
var At=Tt.updateEditVolumes
var wt=e("./inventory")
var Lt=e("./inventory")
var Ot=Lt.INV_EQUIP
var Rt=Lt.INV_PLAYER
var bt=Lt.countAvailable
var Nt=Lt.findAvailableEx
var Ct=Lt.inventoryGetAccountMapped
var xt=Lt.inventoryGetMaterialCostMapped
var Mt=Lt.inventoryLocked
var Dt=Lt.inventoryTransHPMod
var Pt=Lt.payCostEx
var Bt=Lt.transInvDec
var kt=Lt.undoTransactionOp
var Ut=e("./items")
var Gt=Ut.BOOST_BLOCKED_CURRENTLY
var Ft=Ut.ITEM_CONTEXT_BUILD
var Wt=Ut.craftClassAndMatToItem
var Ht=Ut.createItem
var zt=Ut.isItem
var Vt=Ut.itemIsAllowedInQuickbar
var Yt=Ut.itemIsPlaceable
var jt=Ut.itemIsSettlementLocked
var Kt=Ut.sameItem
var qt=e("./layout")
var Zt=qt.CORNER_BUTTON_MARGIN
var Xt=qt.layoutCameraFull
var Qt=qt.menuUpperLeft
var $t=qt.quickbarOnTop
var Jt=e("./line3d").lineLineDist
var er=e("./localization/localization").L
var tr=e("./main")
var rr=e("./main").verifyFrameTransactions
var ar=e("./materials")
var ir=ar.MATERIAL_CLASS
var or=ar.MATERIAL_CLASS_SOUND
var nr=ar.MATERIAL_DIG_RATE
var sr=ar.MATERIAL_DURABILITY_COST
var lr=ar.MATERIAL_NAME
var _r=ar.MATERIAL_SOUND
var cr=ar.MATERIAL_TIER
var ur=ar.MATERIAL_TO_MINE_MATERIAL
var dr=ar.MATERIAL_TO_MINE_STONE_TIER
var fr=ar.MaterialClass
var vr=ar.STAMINA_BY_MATERIAL
var hr=ar.STAMINA_BY_MATERIAL_CLASS
var pr=e("./megachunk_client")
var mr=e("./megachunk_client").megachunkResubscribing
var Er=e("./menu_ribbon")
var gr=Er.getMenuRibbonXOuter
var Tr=Er.getMenuRibbonY0
var yr=e("./mobs")
var Sr=yr.placePrevented
var Ir=yr.playerToolAnim
var Ar=e("./particle_system").createDetachedParticlesFromList
var wr=e("./proc_gen")
var Lr=wr.oreFromChunkPos
var Or=wr.stoneTierFromPos
var Rr=e("./proc_gen_biomes").getElevationEstimate
var br=e("./proc_gen_debug")
var Nr=br.fmt
var Cr=br.hexomeDebug
var xr=e("./props")
var Mr=e("./props")
var Dr=Mr.PIEB_CHECK_CUR_SIZE
var Pr=Mr.PROP_DEBUG_SKIP
var Br=e("./quickbar")
var kr=e("./quickbar")
var Ur=kr.bucketFill
var Gr=kr.bucketSelected
var Fr=kr.consumableSelected
var Wr=kr.consumeSelected
var Hr=kr.consumeSelectedBucket
var zr=kr.getCurrentBrushSize
var Vr=kr.getCurrentModeMappedProp
var Yr=kr.getSelectedGatherTool
var jr=kr.getSelectedIfOwned
var Kr=kr.payCostSelected
var qr=kr.selectedIsFlipped
var Zr=e("./status")
var Xr=e("./stone_tiers")
var Qr=Xr.STONE_TIER_NAMES
var $r=Xr.STONE_TIER_SCALAR
var Jr=e("./tiles")
var ea=Jr.DIG_RATE_DEFAULT
var ta=Jr.DIG_RATE_PROP
var ra=Jr.TILE_DIRT
var aa=Jr.TILE_EMPTY
var ia=Jr.TILE_GRASS
var oa=Jr.TILE_PROP_BASE
var na=Jr.TILE_PROP_MAX
var sa=Jr.TILE_PROP_PENDING
var la=Jr.TILE_TILLED
var _a=Jr.TILE_TILLED_WATERED
var ca=Jr.TILE_UNDIGABLE
var ua=Jr.TILE_WATER
var da=Jr.TILE_WATER_FLOW
var fa=Jr.tile_code_name
var va=Jr.tile_map_default
var ha=Jr.tile_name_block
var pa=e("./todo_list").todoDone
var ma=e("./tutorial").tutorialHook
var Ea=e("./ui_util")
var ga=e("./ui_util").getUIUtilSprite
var Ta=e("./user_data")
var ya=Ta.blueprintAllowed
var Sa=Ta.saplingsAllowed
var Ia=Ta.shouldHaveAvatar
var Aa=Ta.staminaUsageScale
var wa=Ta.unlimitedItemsAllowed
var La=Ta.userAttribGetDigRate
var Oa=Ta.userDataGet
var Ra=Ta.userDataIsWaiting
var ba=Ta.userDataPredict
var Na=Ta.userStaminaCur
var Ca=Ta.userStaminaMod
var xa=Ta.worldReadOnly
var Ma=e("./voxel_const").origin_chunk
var Da=e("./voxel_data")
var Pa=e("./voxel_data")
var Ba=Pa.chunkIdFromLocalIntPos
var ka=Pa.getPropLighting
var Ua=Pa.liquidUpdateDefer
var Ga=Pa.propInWorld
var Fa=Pa.transItemAnim
var Wa=Pa.transSetPropLocal
var Ha=Pa.transSetTileLocal
var za=Pa.worldPosFromLocalPos
var Va=e("./voxel_gen").voxelGenGetDetailDebugData
var Ya=e("./voxel_mesh").voxelMeshGetZMapDebugData
var ja=e("./world_claims").CLAIM_NAME
var Ka=e("./world_comm")
var qa=Ka.getPerm
var Za=Ka.getWorldID
var Xa=Ka.worldGetRoles
var Qa=Ka.worldPak
var $a=Ka.worldSetUserData
var Ja=e("./world_metadata")
var ei=Ja.adventureMode
var ti=Ja.unlimitedMode
var ri=Ja.worldEnergy
var ai=Ja.worldEnforcePropPlacement
var ii=Ja.worldFactories
var oi=Ja.worldItemDrop
var ni=Ja.worldLiquid
var si=Ja.worldSeed
var li=Ja.worldSettlements
var _i=Ja.worldToolLock
var ci=e("./worlds_sound").playSound
var ui=e("./worlds_soundscape")
var di=ui.SoundScapeEventMod
var fi=ui.logSSEventModState
var vi=Math.ceil,hi=Math.cos,pi=Math.floor,mi=Math.max,Ei=Math.min,gi=Math.random,Ti=Math.round,yi=Math.sin,Si=Math.sqrt
var Ii=Te()
var Ai=Te()
var wi=Te()
var Li=ye(1,1,1,.25)
var Oi=ye(1,1,1,.5)
var Ri
var bi=ye(1,1,1,1)
var Ni=ye(0,0,0,1)
var Ci=ye(1,1,1,1)
var xi=ye(0,0,0,1)
var Mi=ye(0,1,.5,1)
var Di=ye(1,1,1,.5)
var Pi=ye(.5,0,0,1)
var Bi=ye(0,0,0,1)
var ki=ye(1,0,0,1)
r.color_prop_blocked=ki
var Ui
r.tex_voxel_util=Ui
var Gi
var Fi
var Wi=false
var Hi=null
var zi=1
var Vi=50
var Yi=500
var ji=50
var Ki=250
var qi=40
var Zi=0
var Xi=250
var Qi=250
var $i=250
var Ji=300
var eo=.05
var to=.15
var ro=.75
var ao=1/2e3
var io=50
var oo=[50,250]
var no=.2
var so=100
var lo=0
var _o=-28
var co=-.01
var uo=-.01
var fo=-.04
var vo=250
var ho=15
var po=(ho-1)/2e4
var mo=false
var Eo=false
var go=null
var To=0
var yo=false
var So=false
var Io={}
var Ao=false
var wo=false
var Lo
var Oo=null
var Ro=null
var bo=[]
var No=[]
var Co=null
var xo
var Mo
var Do
q.register({debug_verbose:{label:"(Admin) Verbose info in F3 Debug Cursor",default_value:j.DEBUG?1:0,type:f.TYPE_INT,range:[0,1],access_run:["sysadmin"]},ignore_volumes:{label:"(Admin) Ignore edit volumes in client logic",default_value:0,type:f.TYPE_INT,range:[0,1],access_run:["sysadmin"],on_change:At}})
function doStamina(){return ri()&&!xa()}function doDurability(){return ii()&&!wa()}function startup(){Lo=tr.getFrameTransaction
Fi=tr.char_controller
r.tex_voxel_util=Ui=m.load(O({url:j.webgl2?"img/voxel_util.array.png":"img/voxel_util.atlas.png"},Da.pack_tex_params))
Gi=ga()
mt()}function doingDragPlace(){return Boolean(Hi)}function shift(e){if(Hi)ue(Hi,e)
yt(e)
for(var t in Io){var r=Io[t]
ue(r.pos,e)}for(var a=Oo;a;a=a.next)ue(a.pos,e)
for(var i=0;i<bo.length;++i)ue(bo[i].pos,e)
for(var o=0;o<No.length;++o)ue(No[o].pos,e)}var Po=[]
var Bo
function tempPoint(){if(Bo===Po.length)Po.push(Te())
return Po[Bo++]}var ko=[]
var Uo
function tempMat(){if(Uo===ko.length)ko.push(W())
return ko[Uo++]}var Go=[]
var Fo
function tempColor(){if(Fo===Go.length)Go.push(ye())
return Go[Fo++]}function tempColorFade(e,t){if(1===t)return e
var r=tempColor()
r[0]=e[0]
r[1]=e[1]
r[2]=e[2]
r[3]=e[3]*t
return r}var Wo=Te()
var Ho=Te()
var zo=Te()
function oreFromLocalPos(e){ne(zo,Ma,e,1/Le)
de(zo)
return Lr(zo)}function getDigTarget(e,t){var r=e.join()
var a=Io[r]
if(a)return a
Da.getLocalPosFromPosPair(Wo,e)
var i
if(!t)i=Da.getPropLocalExact(Wo)
var o=ea
var n
var s
var l
var _=0
var c=Da.getTilePosPair(e,0,t)
var u
if(i){o=i.inv.dig_rate||ta
s=i.getMaterial()
l=i.getMaterialClass()}else{if(!(n=va[c]))return 0
s=n.mat
if(!U(t||s))return 0
u=n.stamina_use
l=ir[s]
if(n.variable_yield&&s===He.STONE){s=oreFromLocalPos(Wo)
l=fr.METAL}if(n.is_stone){za(Ho,Wo)
_=Or(Ho)
o/=$r[_]}if(nr[s])o*=nr[s]}if(void 0===u)u=vr[s]||hr[l]||hr[fr.STONE]
return Io[r]={pos:Wo.slice(0),pair:e,progress:0,size:i?i.size:ee,base_rate:o,tile:c,tile_data:n,tile_material:s,tile_material_class:l,is_liquid:t,stone_tier:_,stamina_use:u,prop:Boolean(i),done:false,key:r,last_rate:0,other_rate:0,other_rate_countdown:0}}var Vo=7500
function applyDigProgress(e){var t=0
var r=e.readInt()
var a=0
var i=0
for(var o=0;o<r;++o){var n=a+e.readInt()
a=n
var s=i+e.readInt()
i=s
var l=e.readU8()/255
var _=e.readU8()/Vo
var c=[n,s]
if(!Da.getTilePosPair(c,0,false))continue
var u=getDigTarget(c)
if(!u)continue
t=mi(t,_)
u.progress=mi(u.progress,l)
u.other_rate=_
u.other_rate_countdown=so}}function cmpDigProgress(e,t){var r=e[0]-t[0]
if(r)return r
return e[1]-t[1]}function notMoreNearbyPlayersThan(e){var t=ht().entities
var r=0
for(var a in t)if(t[a].is_player)if(++r>e)return false
return true}var Yo=0
function updateDigTargets(e){var t=j.frame_index
var r=tr.omp&&j.frame_timestamp-Yo>so&&notMoreNearbyPlayersThan(Xe)
var a
if(r){a=[]
Yo=j.frame_timestamp}for(var i in Io){var o=Io[i]
if(o.frame!==t&&!o.done)o.progress-=e*ao
var n=Da.getTilePosPair(o.pair,0,o.is_liquid)
if(o.progress<=0||n!==o.tile){delete Io[i]
continue}var s=eo
if(o.prop){s=to
var l=Da.getPropLocalExact(o.pos)
if(!l||l.item_id===be){delete Io[i]
continue}if(l&&l.shouldDigSlow())s*=no}if(o.other_rate_countdown&&o.progress<1){var _=Ei(e,o.other_rate_countdown)
o.other_rate_countdown-=_
o.progress=Ei(.999,o.progress+_*o.other_rate)}if(o.progress>s){var c=o.pos
var u=o.progress
var d=void 0
var f=void 0
if(o.done){d=4
f=0}else{d=pi(3*u)
z(d>=0&&d<3)
z((f=3*u-d)>=0&&f<=1)}Da.drawSingleVoxelTextured({tile:y+d,blend:f,pos:c,z_bias:-uo,color:Bi,tex:Ui,size:o.size,sort_bias:_o,atlas_params_vp:Da.atlas_params_voxel_util_vp,atlas_params_fp:Da.atlas_params_voxel_util_fp})
if(r&&o.frame===t&&!o.done)a.push([o.pair[0],o.pair[1],pi(255*o.progress),B(Ti(o.last_rate*Vo),0,255)])}}if(r&&a.length&&!I()){var v=Qa("dig")
v.writeInt(a.length)
var h=0
var p=0
a.sort(cmpDigProgress)
for(var m=0;m<a.length;++m){var E=a[m]
var g=E[0]-h
h=E[0]
v.writeInt(g)
var T=E[1]-p
p=E[1]
v.writeInt(T)
v.writeU8(E[2])
v.writeU8(E[3])}v.send()}}function getPlaceQueue(e){for(var t=Oo;t;t=t.next)if(he(t.pos,e))return t.tile
for(var r=0;r<bo.length;++r)if(he(bo[r].pos,e))return bo[r].tile
for(var a=0;a<No.length;++a){var i=No[a].pos
var o=No[a].prop.size
if(e[0]>=i[0]&&e[0]<i[0]+o[0]&&e[1]>=i[1]&&e[1]<i[1]+o[1]&&e[2]>=i[2]&&e[2]<i[2]+o[2])return sa}return 0}function propAt(e,t){var r=Da.getPropLocal(e)
return r&&r.item_id===t&&r}function isEmptyOrBag(e){var t=Da.getTileLocal(e,1)
if(!t||t===oa&&propAt(e,be))if(!getPlaceQueue(e)&&St(e))return true
return false}var jo=1
var Ko
var qo=function(){var e=[Te(0,0,0)]
for(var t=-jo;t<=jo;++t){if(1===t)Ko=e.length
for(var r=-jo;r<=jo;++r)for(var a=-jo;a<=jo;++a)if(a||r||t)e.push(Te(a,r,t))}return e}()
var Zo=Te()
function addToBagSplatter(e,t,r,a,i){z(r.cost)
if(!oi()&&!a)return
var o=[0]
var n=[]
for(var s=1;s<qo.length;++s){var l=qo[s]
oe(Zo,t,l)
if(isEmptyOrBag(Zo))if(s>=Ko)n.push(s)
else o.push(s)}var _=r.cost
z(_)
var c=o.length/(o.length+.25*n.length)
var u=1===_.length?4:2===_.length?2:1
if(1===_.length&&_[0].type===We&&!r.variable_yield)u=1
for(var d=0;d<_.length;++d){var f=_[d]
if(f.type===Fe)f=Wt(f.id,r.attr1,f.count,false)
z(f.type===We||f.type===Ge)
if(f.type===We&&!zt(f)){_[d]=f=Ht(f)
if(f.has_hp)f.setHP(f.hp_max)}if(r.variable_yield){var v={type:We,count:1+pi(5*gi())}
v.attr1=oreFromLocalPos(t)
v.id=Be
f=Ht(v)}var h=f.count
var p=vi(h/u)
while(h){var m=Ei(p,h)
h-=m
var E=void 0
if(m===f.count)E=f
else(E=Ht(f)).count=m
var g=void 0
if(j.defines.BAG&&0===o[0])g=0
else if(gi()<c)g=o[pi(gi()*o.length)]
else g=n[pi(gi()*n.length)]
var T={target_pos:oe(tempPoint(),t,qo[g]),item:E,src_pos:t,auto_pickup:true,emptied_pos:t,from_center:true,is_update_func:i}
xr.bagAddTrans(e,T)}}}function protectBlock(e){if(!Co)return
var t=Da.posPairFromLocalIntPos(e)
Co[t.join(",")]=true}function protectBlockIdx(e,t){if(!Co)return
Co[e+","+t]=true}function tileMaterial(e){var t=va[e]
return t&&t.mat||null}function playSoundForMaterial(e,t){var r=_r[t]||or[ir[t]]||"_dirt"
ci(""+e+r)}function digProgressName(e,t){var r=e.tile_data
if(r){var a=er.get("TILES_"+fa[e.tile]+"_NAME")
if(r&&r.variable_yield&&e.tile_material_class===fr.METAL)a=lr[e.tile_material]+" Ore"
return a}else return t.inv.getName()}function consumeDurability(e,t,r,a){var i=a||sr[r]
U(i)
var o=-(i||1)
var n=Ot
var s=n.contents.indexOf(t)
if(-1===s){s=(n=Rt).contents.indexOf(t)
z(-1!==s)}Dt(e,n,s,o)
if(!t.hp_cur){ci("tool_break")
var l=t.getRarity()<=1&&t.getMaterialClass()===fr.STONE&&!Mt(n)
if(l)Bt(e,n,s,1)
var _=false
if(j.defines.AUTOREPLACE)if(n===Ot){var c=Nt(Rt,t)
if(c){var u=Rt.contents.indexOf(c)
z(-1!==u)
wt.transSwap(e,Ot,s,Rt,u)
Zr.push(er.STATUSMSG_TOOL_BROKE_REPLACE)
_=true}}if(!_)Zr.push(l?er.STATUSMSG_TOOL_BROKE:t.id===Me?er.STATUSMSG_GROWSTICK_BROKE_RECHARGE:er.STATUSMSG_TOOL_BROKE_REPAIR)}}f.register({cmd:"damage_tool",help:"Damages an equipped tool",access_run:["sysadmin"],prefix_usage_with_help:true,usage:"Usage: /damage_tool <-1|0|1|2> <amount>",func:function func(e,t){if(!doDurability())return void t(null,"Not valid in Unlimited mode")
var r=e.split(" ")
if(2!==r.length)return void t("Need a tool index and damage")
var a=Number(r[0])
var i=Number(r[1])
var o=null
if(-1===a)o=(o=jr())&&Nt(Rt,o)
else o=Ot.contents[a]
if(!o||!o.has_hp)return void t("No tool with HP found at index "+a)
o.tool_last_use_frame=j.frame_index+60
consumeDurability(tr.getFrameTransaction(),o,null,i)
t()}})
function checkStaminaBeforeAction(e){var t=Na()
if(doStamina())if(!t){if(e){Zr.get("dig_error").setMessage(e,S)
Zr.get("no_stamina_hint").setMessage(er.STATUSMSG_DIG_NO_STAMINA_HINT,S).noBounce()}return false}return true}function calcDigData(e,t,r){var a=Da.posPairFromLocalIntPos(t)
if(Co&&Co[a.join(",")])return false
var i=getDigTarget(a)
if(!i)return false
if(i.stamina_use&&!checkStaminaBeforeAction(e?er.STATUSMSG_DIG_NO_STAMINA_DIG:void 0))return false
if(r&&!r.inEditBounds(Dr))return false
if(r&&!r.mineable()){if(r.inv.mineable)if(e)r.mineWhenBlocked()
return false}var o=i.tile_material_class,n=i.tile_material,s=i.stone_tier
var l=Yr(o,e)
if(!l){if(e&&_i()&&_i()!==Ze){var _=digProgressName(i,r)
Zr.get("dig_error_"+_).setMessage(er.STATUSMSG_TOOL_CUSTOM_NOT_ALLOWED,S)}return false}z(l.is_gather)
z(l.dig_rates)
var c=l.dig_rates[o]*l.dig_rate_mod
if(!c){if(e){var u=digProgressName(i,r)
var d=Zr.get("dig_error_"+u)
if(l&&(l.type!==We||l.id!==De))d.setMessage(er.$(er.STATUSMSG_DIG_WRONG_TOOL,l.getName(),u),S)}return false}if(l.max_tier){var f=l.max_tier[o]
if(f)if(cr[n]>f){if(e){var v=ur[n]
var h=v&&lr[v]
if(h){var p=digProgressName(i,r)
var m
m=Zr.get("dig_error_"+p)
if(r)m.setMessage(er.$(er.STATUSMSG_DIG_WRONG_TIER_DECONSTRUCT,l.name,h,p),S)
else m.setMessage(er.$(er.STATUSMSG_DIG_WRONG_TIER_GATHER,l.name,h,p),S)}}return false}}if(s)if(l.max_stone_tier<s){if(e){var E=dr[s]
var g=E&&lr[E]
if(g){var T=digProgressName(i,r)
Zr.get("dig_error_"+T).setMessage(er.$(er.STATUSMSG_DIG_WRONG_TIER_BREAK,er.ITEM_PICKAX_NAME,g,Qr[s],T),S)}else{var y=digProgressName(i,r)
Zr.get("dig_error_"+y).setMessage(er.$(er.STATUSMSG_DIG_LOW_TIER_BREAK,er.ITEM_PICKAX_NAME,Qr[s],y),S)}}return false}if(r&&r.shouldDigSlow()){c=Ei(c,1)
c*=no}return{rate_mod:c*=i.base_rate,target:i,inv:l}}var Xo=[{name:"stone_dig_particles",rot:0}]
var Qo=[{name:"water_gather_particles",rot:0}]
var $o=Te()
function calcBucketData(e,t){var r=Da.posPairFromLocalIntPos(e)
if(Co&&Co[r.join(",")])if(t.liquid===ua||t.liquid===da);else return false
var a=getDigTarget(r,true)
if(!a)return false
return{rate_mod:1,target:a}}function drawUtilVoxel(e,t,r,a,i){Da.drawSingleVoxelTextured({tile:e,pos:se(tempPoint(),t),z_bias:-fo,color:r,tex:Ui,size:a,sort_bias:i||_o-.2,atlas_params_vp:Da.atlas_params_voxel_util_vp,atlas_params_fp:Da.atlas_params_voxel_util_fp})}function propAutoSelect(e){it(e)
var t=rt(e)
if(t)for(var r=0;r<t.length;++r){var a=t[r]
if(a.autoSelect)a.autoSelect()}}var Jo=Te()
function propAutoSelectOnBreakArea(e,t){pe(Jo,t,e)
ue(Jo,ee)
var r=tt(e,Jo)
if(r)for(var a=0;a<r.length;++a){var i=r[a]
if(i.autoSelect)i.autoSelect()}}function waterTile(t,e,r){t.progress=0
t.done=true
var a=Hr()
if(a){Ha(a,Ii,_a,false,false,e.tile,true)
if(doStamina()){var i=d*Aa()
Ca(a,-Ti(i))}a.silent_error=true
Ir(r,false,void 0,Ai)
ci("bucket_water_crops")
a.onComplete(function(e){if(e)console.log("Error watering tile at "+t.pos[0]+","+t.pos[1]+","+t.pos[2]+": "+e)
Io[t.key]=null
delete Io[t.key]})}}function fillBucket(e,t,r,a){a.progress=0
a.done=true
var i=Ur(ua)
if(i){Ha(i,e,0,true,false,t.liquid,true)
if(doStamina()){var o=d*Aa()
Ca(i,-Ti(o))}i.silent_error=true
Ir(r,false,void 0,Ai)
ci("bucket_fill")
i.onComplete(function(e){if(e)console.log("Error gathering water at "+a.pos[0]+","+a.pos[1]+","+a.pos[2]+": "+e)
Io[a.key]=null
delete Io[a.key]})}}function wateringProgress(e,t,r){var a=calcDigData(false,Ii)
if(!a)return 0
var i=a.rate_mod,o=a.target
if(I()||mr())e=0
i*=La()
if(!yo)i=Ei(i,1)
if(oi())i=Ei(i,3)
o.last_rate=i/Ji
o.progress+=e*o.last_rate
if(So)o.progress=1
if(o.progress>1)o.progress=1
var n=eo
if(o.progress>n){r.tool_last_use_frame=j.frame_index
Ir(r,true,i,Ai)}if(o.progress>=1)waterTile(o,t,r)
o.frame=j.frame_index
return o.progress}var en=8
function doHoeing(t,e,r){t.progress=0
t.done=true
var a=tr.getFrameTransaction()
Ha(a,e,la,false,false,void 0,true)
a.silent_error=true
Ir(r,false,void 0,Ai)
ci("hoe")
var i=Nt(Rt,r)
if(i){if(doDurability()&&i.has_hp)consumeDurability(a,i,null,en)
if(doStamina()){var o=u*i.getStaminaRate()*Aa()
Ca(a,-Ti(o))}}a.onComplete(function(e){if(e)console.log("Error using hoe at "+t.pos[0]+","+t.pos[1]+","+t.pos[2]+": "+e)
Io[t.key]=null
delete Io[t.key]})}function hoeProgress(e,t,r){var a=calcDigData(false,t)
if(!a)return 0
var i=a.rate_mod,o=a.target
if(I()||mr())e=0
i*=La()
if(!yo)i=Ei(i,1)
if(oi())i=Ei(i,3)
o.last_rate=i/Ji
o.progress+=e*o.last_rate
if(So)o.progress=1
if(o.progress>1)o.progress=1
var n=eo
if(o.progress>n){r.tool_last_use_frame=j.frame_index
Ir(r,true,i,Ai)}if(o.progress>=1)doHoeing(o,t,r)
o.frame=j.frame_index
return o.progress}function fillProgress(e,t,r,a){var i=calcBucketData(e,r)
if(!i)return 0
var o=i.rate_mod,n=i.target
if(I()||mr())t=0
o*=La()
n.last_rate=o/Ji
n.progress+=t*n.last_rate
if(So)n.progress=1
if(n.progress>1)n.progress=1
var s=eo
if(n.progress>s){Ua(Ba(e))
a.tool_last_use_frame=j.frame_index
Ir(a,true,o,Ai)}if(n.progress>=1){oe($o,n.pos,F)
Ar($o,Qo,Fi.pos)
fillBucket(e,r,a,n)}n.frame=j.frame_index
return n.progress}function digProgress(e,t,r){var a=calcDigData(true,e,t),i=a.rate_mod,o=a.target,n=a.inv
if(!i)return 0
var s=o.tile_material,l=o.stamina_use
if(I()||mr())r=0
var _=i
i*=La()
if(!yo)i=Ei(i,1)
if(oi())i=Ei(i,3)
o.last_rate=i/Ji
o.progress+=r*o.last_rate
if(So)o.progress=1
if(o.progress>1)o.progress=1
var c=t?to:eo
if(o.progress>c){n.tool_last_use_frame=j.frame_index
Ir(n,true,i,Ai)}if(o.progress>=1&&!o.done){fi(di.Broken)
playSoundForMaterial("block_break",s)
oe($o,o.pos,F)
Ar($o,Xo,Fi.pos,o)
yo=true
o.done=true
var u=tr.getFrameTransaction()
u.silent_error=true
if(t)t.onDig(u,null,false)
else{var d=Da.getTileLocal(e,0,false)
z(d)
Ha(u,e,0,false,false,d,true)
addToBagSplatter(u,e,Ht({type:Ge,id:d}))}for(var f=-1;f<o.size[2]+1;++f){Wo[2]=o.pos[2]+f
for(var v=-1;v<o.size[1]+1;++v){Wo[1]=o.pos[1]+v
for(var h=-1;h<o.size[0]+1;++h){Wo[0]=o.pos[0]+h
var p=Da.getPropLocal(Wo)
if(p&&p.neighborChanged&&ai())p.neighborChanged(u,o.pos)}}}if(doDurability()&&n.has_hp)consumeDurability(u,n,s)
if(doStamina()&&l){l*=Aa()
var m=mi(1,Ti(l*n.getStaminaRate()/mi(1,_)))
Ca(u,-m)}u.onComplete(function(e){if(e)console.log("Error digging tile at "+o.pos[0]+","+o.pos[1]+","+o.pos[2]+": "+e)
Io[o.key]=null
delete Io[o.key]})
propAutoSelect(e)}o.frame=j.frame_index
return o.progress}function getLiquidTile(e){Da.getTileLocal(e,1,false)
return Da.andGetLiquid(1)}var tn=false
var rn
function canPlaceOverTile(e,t,r,a){var i=Da.getTileLocal(e,1,false)
var o
if(a)o=Da.andGetLiquid(1)
if(i===oa){var n=Da.getPropLocal(e)
if(n&&n.vacate&&t){rn=n
return true}tn=false}if(a&&o)return o===da&&r!==da||o===ua&&r===da
return!i}function canPlaceOver(e,t,r,a,i){tn=true
if(!canPlaceOverTile(e,t,a,i))return false
tn=false
if(!St(e))return false
return r||!Sr(e)}var an=0
function placeBlockFinish(t,e){var r=t.pos,a=t.tile,i=t.pay_cost,o=t.is_liquid
i=i||[]
var n=Da.getPropLocal(r)
if(!e&&n&&!n.vacate){Zr.get("placefail").setMessage(er.STATUSMSG_PLACE_BLOCKED)
e=true}var s=Da.getVDFromLocalPos(r)
if(!e&&(!s||!s.did_gen)){Zr.get("placefail").setMessage(er.STATUSMSG_PLACE_CHUNK_UNLOAD)
e=true}if(!e&&!St(r))e=true
if(!e&&o)if(Da.getTileLocal(r,1,true)===t.liquid_tile)e=true
if(e){i.forEach(kt)
Da.queuedPlaceClear(r)
return}if(1===++an||100===an||1e3===an||1e4===an)$e("blocks_placed",an,"game_event")
var l=o?Hr(null,t.inv):Lo()
if(!l){Da.queuedPlaceClear(r)
return}if(n)n.vacate(l,r)
if(o)Ir(t.inv,false,void 0,Ai)
else Ir({type:Ge,id:a},false,void 0,Ai)
for(var _=0;_<i.length;++_)l.opInvMod(i[_])
fi(di.BlocksPlaced)
if(o)ci("bucket_place_liquid")
else playSoundForMaterial("block_place",tileMaterial(a))
var c={type:Ge,id:a,count:1}
pa(c,Ft)
if(o){var u=Da.getTileLocal(r,1,true)
var d=t.liquid_tile
z(d)
z(d===ua||d===da)
z(u!==d)
Ha(l,r,d,true,false,u,false)}else{Ha(l,r,a,false,false,0,false)
Ha(l,r,0,true,false,void 0,false)
Fa(l,{style:Ye,src_type:je,target_type:Ke,target:r,items:[c]})}bo.push(t)
l.silent_error=true
l.onComplete(function(e){if(e)Zr.get("placefail").setMessage(er.STATUSMSG_PLACE_BLOCKED)
t.wait_trans=false
t.vd_ver=t.vd.ver_meshing})}function placeBlock(e,t,r,a){z(t)
z(!(t>=oa&&t<=na))
if(getPlaceQueue(e))return
var i
if(!wa()&&!r){if(!(i=Kr()))return
z(i.length)
z(i[0].delta)}var o={tile:t,pay_cost:i,pos:e.slice(0),is_liquid:r,time:vo,next:null,vd:Da.getVDFromLocalPos(e),wait_trans:true,pointer_locked:K.pointerLocked()}
if(r){o.liquid_tile=a.attr2
o.time=1
o.inv=a}o.vd_reused=o.vd.reused
if(Oo){Ro.next=o
Ro=o}else Oo=Ro=o
Da.queuedPlaceSet(o.pos,o.tile)
propAutoSelect(o.pos)}var on=Te()
function placeProp(e,t,r,a){r=t.inv
z(r.placeable)
var i=xr.createFromInv(r)
i.is_preview=true
i.flipped=t.flipped
i.faceMe()
var o=i.size
for(var n=0;n<o[2];++n){on[2]=e[2]+n
for(var s=0;s<o[1];++s){on[1]=e[1]+s
for(var l=0;l<o[0];++l){on[0]=e[0]+l
if(getPlaceQueue(on))return}}}var _=Lo()
var c=Pt(_,Rt,Br.getSelected())
var u=false
if(a){u=true
a.vacate(_,e)}i.main_world=true
if(i.applyBoostLevel){i.inv.is_preview=false
i.applyBoostLevel()
i.inv.is_preview=true}i.updateBeforePlace(e,_,false)
i.updateRuntimeBehaviour()
Wa(_,e,i,false,u)
Fa(_,{style:Ye,src_type:je,target_type:Ke,target:e,items:[r]})
var d=i
d.is_preview=true
d.allowAlpha()
d.place_rot=i.place_rot
d.faceMe()
d.draw_opts.color=xr.color_prop_preview
if(d.item_id===Ne){d.blueboxChangeState(null,i.bluebox_state,true)
d.updateRuntimeBehaviour()}for(var f=0;f<o[2];++f){on[2]=e[2]+f
for(var v=0;v<o[1];++v){on[1]=e[1]+v
for(var h=0;h<o[0];++h){on[0]=e[0]+h
Da.queuedPlaceSet(on,sa)}}}var p={prop:i,prop_preview:d,pos:e.slice(0),vd:Da.getVDFromLocalPos(e),wait_trans:true,pay_cost:c}
p.vd_reused=p.vd.reused
No.push(p)
_.silent_error=true
var m=i.item_id===Ue&&!wa()&&!c.length&&!Oa("used_free_settlement")
if(m){p.pay_cost=null
ba("used_free_settlement",1,false)}ma("transacting_build_prop_"+p.prop.item_id,true,true)
_.onComplete(function(e){ma("transacting_build_prop_"+p.prop.item_id,false,true)
if(e)Zr.get("placefail").setMessage(er.STATUSMSG_PLACE_BLOCKED)
else if(m)$a("used_free_settlement",1,b)
p.vd_ver=p.vd.ver_meshing
p.wait_trans=false
if(!e&&Za()&&!Ra()){ma("build_prop_"+p.prop.item_id)
pa(i.inv,Ft)}})
propAutoSelect(p.pos)}function resetBlockPlaceQueue(){Oo=Ro=null
bo=[]
No=[]
Da.queuedPlaceReset()}var nn
var sn=0
var ln=1
var _n=2
var cn=3
var un=4
var dn=6
var fn=7
var vn
var hn=1
var pn=2
var mn=3
var En=4
var gn
var Tn=ge()
var yn=ge()
var Sn=Te()
var In=Te()
var An=Te()
var wn=Te()
var Ln=[[1,2],[0,2],[0,1]]
var On={monochrome:true}
function utilVoxelGetLighting(e){ka(On,e,false)}function drawUtilVoxelLit(e,t,r,a,i){var o={tile:e,pos:se(tempPoint(),t),z_bias:-fo,color:r,tex:Ui,size:a,sort_bias:i||_o-.2,atlas_params_vp:Da.atlas_params_voxel_util_vp,atlas_params_fp:Da.atlas_params_voxel_util_fp,lit:true,draw_opts:On}
Da.drawSingleVoxelTextured(o)}var Rn
function interactDetails(){return Rn}var bn
function interactableProp(){if(bn&&!Ga(bn))bn=null
return bn}function blockPlacePreview(e){Da.drawSingleVoxel({tile:e.tile,is_liquid:e.is_liquid,pos:e.pos,color:Oi,sort_bias:_o})}function propPlacePreview(e){Da.getPropLighting(e.prop_preview.draw_opts,e.pos)
Da.drawProp(e.prop_preview,e.pos)}var Nn=1
var Cn=0
function tickBlockPlaceQueue(e){var t=e*(Nn=B(Nn+(Oo?1:-5)*po*e,1,ho))
if(!Oo)Cn=Ei(Cn+t,vo)
else if(Cn){t=Ei(t+Cn,vo)
Cn=0}while(Oo){var r=Oo.pointer_locked&&!K.pointerLocked()&&!doingDragPlace()
if(t>=Oo.time||r){t-=Oo.time
var a=Oo
if(!(Oo=Oo.next))Ro=null
placeBlockFinish(a,r)}else{Oo.time-=t
t=0
break}}for(var i=Oo;i;i=i.next)blockPlacePreview(i)
for(var o=bo.length-1;o>=0;--o){var n=bo[o]
if(n.vd.reused!==n.vd_reused){Da.queuedPlaceClear(n.pos)
k(bo,o)
continue}if(!n.wait_trans&&n.vd.geom_ver_meshing>=n.vd_ver){Da.queuedPlaceClear(n.pos)
k(bo,o)
continue}blockPlacePreview(n)}for(var s=No.length-1;s>=0;--s){var l=No[s]
var _=false
if(l.vd.reused!==l.vd_reused)_=true
else if(!l.wait_trans&&l.vd.geom_ver_meshing>=l.vd_ver)_=true
if(_){var c=Da.getPropLocalExact(l.pos)
if(c&&c.item_id===l.prop.item_id){if(!wa())c.local_last_pay_cost=l.pay_cost
c.afterPlace()}var u=l.prop.size
for(var d=0;d<u[2];++d){on[2]=l.pos[2]+d
for(var f=0;f<u[1];++f){on[1]=l.pos[1]+f
for(var v=0;v<u[0];++v){on[0]=l.pos[0]+v
Da.queuedPlaceClear(on)}}}k(No,s)}else propPlacePreview(l)}}var xn=Te()
function lineLineDistNoNear(e,t,r,a,i){var o=r[0]?0:a[0]-t[0]
var n=r[1]?0:a[1]-t[1]
var s=r[2]?0:a[2]-t[2]
if(o*o+n*n+s*s<2)return-2
var l=Jt(e,t,r,a,i)
pe(xn,e,a)
if(_e(xn,i)<=0)return-3
return l}function undergroundFactors(e){if(j.defines.NOSHADOW)return[0,0]
za(Ho,Fi.pos)
var t=Rr(Ho)-(void 0===e?Ho[2]:e)
return[B((t-100)/100,0,1),B(t/50,0,1)]}var Mn={type:1,seed:1,priority:1,blockable:1,blocked:1,blocked_origin:1,blocked_size:1,blocked_r:1,blocked_check:1,lines:1,factory_estimator:1}
var Dn=Te()
var Pn=Te()
var Bn=Te()
var kn=ye(.5,.5,.5,1)
function cursorDebug(e){var t=q.debug_verbose
ce(Bn,e)
e=Bn
var r=Da.chunkIdFromLocalFloatPos(Dn,e)
var a=ze.parseChunkId(r)
za(Pn,e)
var i=["Block under cursor"]
i.push("  World Pos: "+Nr(Pn)+(t?" (local: "+Nr(e)+")":"")+" (seed: "+si()+")")
if(t){i.push("  Chunk "+r+(t?" ("+Nr(a.chunk_pos)+") offset "+Nr(Dn):"")+" idx "+Qe(Dn))
i.push("  VSID "+(a.chunk_pos[0]+a.chunk_pos[1]*Oe))}var o=Da.chunk_map[r]
if(o){var n=[]
if(o.mesh_dirty)n.push("MeshDirty")
if(o.liquid_unstable&&o.liquid)n.push("LiquidUnstable")
if(!o.did_gen)n.push("NOT(DidGen)")
if(t){n.push(ja[o.claimed])
if(o.shadow_buf)n.push("shad="+o.shadow_buf.length+"b")
if(o.geom_high)n.push("tri="+o.geom_low_tricount+"/"+o.geom_mid_tricount+"/"+o.geom_high_tricount)}if(n.length)i.push("  "+n.join(", "))}if(t){var s=pr.getSpoilInfo(a.chunk_pos)
var l=""
if(s){l="spoiled:"+s.spoiled
if(t)l+=" details:"+(s.details?s.details.ver:"-")+(s.details_spoiled?",s":"")}var _=Ya(Pn)
i.push("  MegaChunk "+a.mcid+(t?" ("+Nr(a.mchunk_pos)+") offset "+Nr(a.local_pos):"")+" "+l+(t?" ZM:"+_:""))}if(j.defines.DETAILS&&(j.DEBUG||qa("sysadmin"))){var c=Va(r)
if(c.length)for(var u=0;u<c.length;++u){var d=c[u]
i.push("  Detail "+u+" ("+d.type+"#"+d.seed+", P"+d.priority+"):")
if(d.blocked)i.push("    BLOCKED: "+d.blocked_origin+"+"+d.blocked_size+", r="+d.blocked_r)
else{for(var f in d){if(Mn[f])continue
i.push("    "+f+": "+JSON.stringify(d[f]).replace(/"/g,""))}if(d.blockable)i.push("    Blockable: "+(d.blocked_check?"":"UNCHECKED ")+" "+d.blocked_origin+"+"+d.blocked_size+", r="+d.blocked_r)}if(d.lines)for(var v=0;v<d.lines.length;++v){var h=d.lines[v]
gt({p0:h[0],p1:h[1],color:kn,color2:ee})}}}var p=Da.getTileLocal(e,-1,false)
var m=Da.andGetLiquid(-1)
var E=Da.andGetLightDebug()
var g=null
if(p>=oa&&p<=na)g=Da.andGetProp()
var T
var y=va[p]
if(y){if(ei()||!Xa().world_admin)if(y.debug_as){E.sun=E.torch=0
p=y.debug_as}T=ha[p]}if(!T&&p>=oa&&p<=na)T="Prop"+p
T=T||"Unknown"
if(t)T=p+"("+T+")"
i.push("  Tile="+T+"  Liquid="+m+"  Sun="+E.sun+"  Torch="+E.torch)
if(t){var S=Rr(Pn,true)-Pn[2]
var I=Lr(a.chunk_pos)
var A=Or(Pn)
i[i.length-1]+="  Ore="+lr[I]+", StoneTier="+Qr[A]+"("+A+") (depth="+S.toFixed(0)+")"}pt.addText(i.join("\n"))
if(g)if(t)pt.debugAddObject(g,"Prop Debug",Pr)
else{var w=g.inv
var L=""+w.id
if(g.item_id!==Ne&&(w.attr1||w.attr2||w.attr3)){L+=" attr:"+w.attr1
if(w.attr2||w.attr3){L+="/"+w.attr2
if(w.attr3)L+="/"+w.attr3}}pt.addText("  Prop="+L)}}function tickBuildModeInactive(){tickBlockPlaceQueue(j.frame_dt)
if(qa("sysadmin")&&Ia()&&!ht().hasMyEnt())A().drawSizedAligned(null,Y.x1(),Y.y1(),Z.DEBUG,w(),v.HRIGHT|v.VBOTTOM,0,0,"(no entity / invisible)")}function clickAnywhere(e){var t=K.click({max_dist:ji,peek:e})
return t&&!Ao&&Date.now()-t.start_time<Yi}var Un=0
function mouseMoveFade(){if(j.defines.NOUI)return 0
if(K.touch_mode)return 1
return R(B(1-(Un-500)/1e3,0,1),2)}function mouseMoveFadeReset(){Un=0}function tempPointReset(){Fo=Uo=Bo=0}var Gn=1e3
function doPointerLockTop(){var e=K.pointerLocked()
if(e&&!wo){Ao=true
p()}wo=e
if(K.touch_mode){if(e)K.pointerLockExit()}else if(!e){if(!Br.isDragging()&&!K.pad_mode)K.click({button:0,in_event_cb:K.pointerLockEnter})}else if(!Ao)if(K.click({button:2}))K.pointerLockExit()
return e}function doPointerLockBottom(){if(Ao&&!h(0)&&!h(2))Ao=false}function pointerLockJustEntered(){return Ao}function suppressQueuedPlaceCancel(){for(var e=Oo;e;e=e.next)e.pointer_locked=false}function cancelDragPlace(){if(Hi){suppressQueuedPlaceCancel()
Hi=null
if(!K.touch_mode)Ao=true}}function gameplayHUD(){Xt()
if(j.defines.NOUI)return
if(xa())return
var e=Br.getSelectedVisible()
if(e.type===We&&(e.id===xe||e.id===Ce))Et(e)}var Fn=W()
function checkRayLength(e,t,r){if(e&&t*t<le(Fi.pos,r||Ii))return 0
return e}var Wn
function doFakeTouch(e){if(Wn&&(!e||K.mouseButtonHadEdge())){Wn=false
K.fakeTouchEvent(Wn)}if(K.keyDownEdge(K.KEYS.R,{in_event_cb:K.pointerLockEnter}))if(!Wn){Wn=true
K.fakeTouchEvent(Wn)}if(Wn&&(K.keyUpEdge(K.KEYS.R)||K.keyDown(K.KEYS.SPACE)||K.keyDown(K.KEYS.ESC))){Wn=false
K.fakeTouchEvent(Wn)}if(K.keyDownEdge(K.KEYS.T,Wn?null:{in_event_cb:K.pointerLockEnter})){Wn=!Wn
K.fakeTouchEvent(Wn)
Ao=false}}function getCursorModeFromInventory(e,t,r,a,i,o){if(Eo)nn=fn
else if(e.type===Ge)if(Yt(e))nn=t||va[e.id].unknown?cn:ln
else nn=fn
else if(e.id===De)nn=fn
else if(Yt(e))if(t);else{nn=_n
var n=e
if(e.mode_list_ids)n=Vr(n)
n=xt(n)
n=Ct(n)
a=(r=xr.getForPreview(n,xr.PREVIEW_PLACE)).size[0]*r.size[1]*r.size[2]}else if(Fr());else if(e.id===xe||e.id===Ce){nn=fn
i=true}else if(e.is_gather){nn=un
vn=hn}else if(e.id===Pe){nn=un
vn=En}else if(Gr())if(t);else if(Gr(aa)){nn=un
vn=pn}else{var s=Da.raycast3DLocal(Ii,wi,Ai,o,Sn,qi,true,false,false)
if(s&&(s.tile===la||s.tile===_a)){nn=un
vn=mn}else nn=ln}else nn=fn
return{inv:e,edit_prop:r,prop_size_sum:a,want_crosshair:i}}function getCursorMaxDistance(){return nn===ln||nn===_n?wa()?i:o:l}function handleItemPick(e,t){var r
if(e){r=e.toItem()
if(e.item_id===Ne&&!lt(r.getBID()))r=null}else if(!t.liquid&&t.tile&&t.tile!==sa&&-1!==t.tile){var a
var i=t.tile
if(null!=(a=va[i])&&a.blueprint){var o
i=null==(o=va[i])?void 0:o.blueprint}if((r=Ht({type:Ge,id:i}))&&!Yt(r))if(r.cost&&r.cost.length>=1)r=Ht(r.cost[0])}if(Vt(r))Br.selectByItem(r,true)
if(r&&mo)cancelCurrentAction()}function handleHitProp(e,t,r,a){if(e.shouldPropertyEdit()){nn=dn
Ri=Mi
Do=true}else if(nn===ln&&doingDragPlace())e=null
else if((!t&&e.inEditBounds(Dr)||e.read_only_interact)&&(r=e.interactable())){if(nn!==un||nn===un&&vn===pn)nn=cn
if(!mo)Ri=r
Rn=(bn=e).interactDetails()
Do=true
var i=a>=(K.touch_mode?$i:0)
var o=gn&&gn.prop
if(e.interactable_continuously&&oi()&&i&&o&&!r.no_continuous){Eo=true
e.interact(null,Ai)
fi(di.PropsInteracted)
nn=cn}else if(clickAnywhere())if(gn&&gn.prop===e){e.interact(null,Ai)
fi(di.PropsInteracted)
nn=cn}}else if(e.inv.always_interact){if(nn===ln||nn===_n||nn===un&&vn===pn)nn=cn}else if(nn===ln||nn===_n)e=null
return{hit_prop:e,interactable:r}}function startAction(e,t,r,a,i,o){var n=K.touch_mode?io:Infinity
var s=e?Qi:K.touch_mode?Xi:Zi
if(!mo){if(t.total<n)if(r>=s){mo=true
go=o
To=nn
yo=false
a=K.touch_mode?Ei(i,r-s)*ro:Ei(i,t.down_time)}}else a=Ei(i,t.down_time)
if((vn===hn?zr()===ee:true)&&!yo)if(clickAnywhere(true))if(ti())if(t.total<n){mo=So=true
go=o
To=nn
yo=false}return a}function handleActionPlaceDragStart(e,t,r,a,i,o,n,s){if(e){Br.lock()
if(nn===ln)if(!mo)if(K.touch_mode){if(e.total>t)nn=cn
else if(r>Yi||K.click({peek:true})){mo=Wi=true
To=nn
z(go=s)}}else{mo=Wi=true
To=nn
z(go=s)}if(nn===_n)if(K.touch_mode)if(e.total>t)nn=cn
else{To=nn
z(go=s)}if(nn===un)i=startAction(a,e,r,i,o,s)}else{yo=mo=false
cancelDragPlace()
if(K.touch_mode)nn=sn
else{K.mousePos(yn)
if(!n&&!K.pad_mode)nn=j.defines.DEBUGCURSOR?cn:sn
if(j.defines.DEBUGCURSOR)if(!ae(Tn,yn)){mouseMoveFadeReset()
re(Tn,yn)}}}return{action_delta:i}}function handleConsumable(e){if((nn===cn||nn===fn)&&Fr()&&!e){nn=sn
if(!K.touch_mode&&clickAnywhere())if(Eo)Eo=false
else Wr(null)}}function handleDigOnProp(e,t,r,a,i){var o=tempPoint()
e.getLocalPos(o)
var n=!St(o)
An[2]=o[2]+e.size[2]
e:for(var s=0;s<e.size[1];++s){An[1]=o[1]+s
for(var l=0;l<e.size[0];++l){An[0]=o[0]+l
var _=Da.getPropLocal(An)
if(_&&_.inv.rooted&&ai()){n=true
break e}}}if(n){if(!i||mo)Ri=ki}else if(e.mineable()){if(mo)t=digProgress(Ii,e,r)}else if(e.inv.mineable&&mo&&a>Ji){Ri=ki
e.mineWhenBlocked()}return t}var Hn=Te()
function digBeamCast(e,t,r,a,i,o,n,s){xo=[]
Mo=[]
var l
if(e===ee){if(t)if(r)z(false)
else if(t.tile<ca){xo.push(Ii)
if(calcDigData(false,Ii,null).rate_mod)Mo.push(me(tempColor(),bi))
else Mo.push(me(tempColor(),ki))
a.push(1)
i.push(null)}}else{var _=tempPoint()
z.equal(e[0],e[1])
z.equal(e[1],e[2])
var c=e[0]/2+.25
var u=Si(2)/2
var d=e[0]/2+.5
var f=tempPoint()
var v=checkRayLength(t=Da.beamcast3DLocal2(Hn,o,Sn,qi,c,f),n)
if(!(t=checkRayLength(t,n,Hn))&&v)if(le(Hn,Ii)<2)t=v
if(j.defines.BEAM&&t){drawUtilVoxel(C,ne(Te(),Hn,ee,-.5),[1,0,1,1])
if(j.defines.BEAMHIT)drawUtilVoxel(N,f,[1,0,0,.5])}if(t){var h=vi(d+.5)
l=tempPoint()
s=tempPoint()
ce(s,Hn)
for(var p=-h;p<=h;++p){_[2]=s[2]+p
for(var m=-h;m<=h;++m){_[1]=s[1]+m
for(var E=-h;E<=h;++E){_[0]=s[0]+E
var g=Da.getTileLocal(_,0,false)
if(g){se(l,_)
var T=false
for(var y=0;y<3;++y){l[y]+=Fi.pos[y]<_[y]?-1:1
var S=Da.getTileLocal(l,1,false)
if(!S||S>=ca){T=true
break}l[y]=_[y]}if(le(dt(),_)<1)T=true
if(!T)continue
oe(l,_,F)
var I=Si(le(Hn,l))
if(I>=d){if(j.defines.BEAM&&g<ca){xo.push(se(tempPoint(),_))
Mo.push(ki)}continue}var A=B(1-(I-u)/(d-u),0,1)
if(g<ca){xo.push(se(tempPoint(),_))
a[xo.length-1]=A
var w=tempColor()
if(calcDigData(false,_,null).rate_mod)me(w,bi)
else me(w,ki)
if(j.defines.BEAM)Ee(w,A,A,A)
else w[3]=A
Mo.push(w)}else if(g>=oa&&g<=na){var L=Da.getPropLocal(_)
if(L)if(L.inv.clickable){xo.push(se(tempPoint(),_))
var O=tempColor()
var R=calcDigData(false,L.getLocalPos(),L)
var b=i.indexOf(L)
i[xo.length-1]=L
if(-1===b)a[xo.length-1]=A
else a[b]=mi(a[b],A)
if(R.rate_mod)me(O,bi)
else me(O,ki)
if(j.defines.BEAM)Ee(O,A,A,A,1)
else O[3]=A
Mo.push(O)}}}}}}}}return{dig_weights:a,dig_props:i,ray_hit:t,check_root:s}}function checkBrushTargetBlockage(e,t,r){for(var a=0;a<xo.length;++a)if(e[a])if(t[a]){var i=t[a]
if(!r)r=tempPoint()
i.getLocalPos(r)
var o=!St(r)
An[2]=r[2]+i.size[2]+1
e:for(var n=0;n<i.size[1];++n){An[1]=r[1]+n
for(var s=0;s<i.size[0];++s){An[0]=r[0]+s
var l=Da.getPropLocal(An)
if(l&&l.inv.rooted&&ai()){o=true
break e}}}if(o){e[a]=0
for(var _=a;_<t.length;++_)if(t[_]===i)se(Mo[_],ki)}}else{var c=xo[a]
var u=Da.getPropLocal(oe(An,c,Ae))
if(u&&ai()&&(u.inv.rooted||u.neighborChanged&&!u.inEditBounds(Dr))||!St(c)){se(Mo[a],ki)
e[a]=0}}}function doDigging(e,t,r,a){if(mo)if(xo.length)for(var i=xo.length-1;i>=0;--i)if(e[i]){var o=t[i]
var n=void 0
if(o){if(!o.existsInWorld())continue
n=digProgress(o.getLocalPos(tempPoint()),o,r*e[i])}else n=digProgress(xo[i],null,r*e[i])
a=mi(a,n)}return a}function drawTouchModeCircle(e){g(yn[0],yn[1],Z.DIG_INDICATOR,Ei(1,e)*oo[1],.99,Di)
T(yn[0],yn[1],Z.DIG_INDICATOR,oo[1],.99,Pi)}var zn=Te()
function doDigAction(e,t,r,a,i,o,n,s,l){var _=0
if(e&&(!e.inv.mineable||t||r===ee))_=handleDigOnProp(e,_,a,i,t)
else{var c
var u=digBeamCast(r,s,e,o,n,zn,l,c)
o=u.dig_weights
n=u.dig_props
s=u.ray_hit
c=u.check_root
z.equal(xo.length,Mo.length)
checkBrushTargetBlockage(o,n,c)
_=doDigging(o,n,a,_)}if(s)Do=true
if(mo&&K.touch_mode&&!So)drawTouchModeCircle(_)}function hoeBeamCast(e,t,r,a){if(e&&t)e=0
else{xo=[]
Mo=[]
if(r===ee){if(e)xo.push(Ii)}else if(e=checkRayLength(e=Da.beamcast3DLocal(Ii,zn,Sn,qi,r,true,true),a)){var i=tempPoint()
for(var o=0;o<r[2];++o){i[2]=Ii[2]+o
for(var n=0;n<r[1];++n){i[1]=Ii[1]+n
for(var s=0;s<r[0];++s){i[0]=Ii[0]+s
if(Da.getTileLocal(i,0,false))xo.push(se(tempPoint(),i))}}}}var l=false
if(!checkStaminaBeforeAction())l=true
for(var _=0;_<xo.length;++_){var c=xo[_]
var u=Da.getTileLocal(c,0,false)
if(u===la||u===_a)Mo[_]=xi
else if(l)Ri=ki
else if(u===ra||u===ia){oe(An,c,Ae)
var d=Da.getTileLocal(An,1,false)
var f=Da.andGetLiquid()
if(d||f||!St(c))Mo[_]=ki
else Mo[_]=Ci}else Mo[_]=ki}}Do=true
return e}function doHoeAction(e,t,r,a,i,o){if(!St(Ii)){Ri=ki
return}e=hoeBeamCast(e,t,r,a)
if(mo&&xo.length){if(!checkStaminaBeforeAction(er.STATUSMSG_DIG_NO_STAMINA_HOE)){Do=false
return}var n=0
for(var s=0;s<xo.length;++s)if(Mo[s]===Ci){var l=void 0
l=hoeProgress(i,xo[s],o)
n=mi(n,l)}if(K.touch_mode&&!So)drawTouchModeCircle(n)}}function doBucketProgress(e,t,r,a){if(!checkStaminaBeforeAction())Ri=ki
else Ri=xr.color_interact_water
if(mo){if(!checkStaminaBeforeAction(e?er.STATUSMSG_DIG_NO_STAMINA_BUCKET:er.STATUSMSG_DIG_NO_STAMINA_WATER))return
var i=e?wateringProgress(t,r,a):fillProgress(xo[0],t,r,a)
var o=mi(0,i)
if(K.touch_mode&&!So)drawTouchModeCircle(o)}}function doBucketAction(e,t,r,a){if(!St(Ii)){Ri=ki
Do=true
return}(xo=[]).push(Ii)
Mo=[]
if(vn===mn&&!r&&e){if(e.tile===_a)Ri=ki
else if(e.tile===la)doBucketProgress(true,t,e,a)
Do=true}else if(vn===pn&&e&&(!r||!r.onUnflow||!ai())){if(e.liquid===ua||e.liquid===da)doBucketProgress(false,t,e,a)
else Ri=ki
Do=true}}var Vn=false
function placeBeamCast(e,t,r,a,i,o,n){xo=[]
Mo=[]
var s
var l
if(e===ee){var _=(l=r.liquid===da&&!(n&&o===da)&&ni())?Ii:wi
if(l&&Hi&&he(Hi,Ii))Vn=true
else Vn=false
if(canPlaceOver(t=s=_,true))xo.push(_)
else{Mo[xo.length]=ki
xo.push(_)}}else{r=checkRayLength(r=Da.beamcast3DLocal(Ii,zn,Sn,qi,e,false,false),a)
s=Ii
if(r){var c=tempPoint()
for(var u=0;u<e[2];++u){c[2]=Ii[2]+u
for(var d=0;d<e[1];++d){c[1]=Ii[1]+d
for(var f=0;f<e[0];++f){c[0]=Ii[0]+f
if(canPlaceOver(c,true,false,o,n))xo.push(se(tempPoint(),c))
else{Mo[xo.length]=ki
xo.push(se(tempPoint(),c))}}}}}}i=s
if(Wi&&r){Wi=false
Hi=s.slice(0)
if(l)Vn=true
zi=e}return{debug_pos:t,ray_hit:r,this_frame_place_origin:i}}function placePropBeamCast(e,t,r,a){e.faceMe()
e.flipped=qr()
if(t&&r)t=0
else if(1===e.size[0]&&1===e.size[1]&&1===e.size[2])se(wn,wi)
else if(e.inv.rooted&&j.defines.PROPROOT){re(wn,e.size)
wn[2]=1
t=checkRayLength(t=Da.beamcast3DLocal(wn,zn,Sn,qi,wn,true,false),a,wn)
wn[2]++}else if(!j.defines.PROPFULL){ne(Hn,zn,Ae,(e.size[2]-1)/2)
se(wn,e.size)
t=checkRayLength(t=Da.beamcast3DLocal(wn,Hn,Sn,qi,wn,false,false),a,wn)}else{se(wn,e.size)
t=checkRayLength(t=Da.beamcast3DLocal(wn,zn,Sn,qi,wn,false,false),a,wn)}return t}function doDragPlace(e,t,r,a,i,o){z(i)
var n=Gr(ua)||Gr(da)
var s=K.click({max_dist:Infinity})
Do=true
ne(In,Hi,e,.5)
var l=[tempPoint(),tempPoint(),tempPoint()]
var _=[lineLineDistNoNear(l[0],In,Se,t,Sn),lineLineDistNoNear(l[1],In,Ie,t,Sn),lineLineDistNoNear(l[2],In,Ae,t,Sn)]
for(var c=0;c<3;++c){if(_[c]<0)continue
var u=l[c][c]-In[c]>0?1:-1
var d=Ln[c][0]
var f=Ln[c][1]
var v=false
for(var h=0;h<e[d];++h){Ii[d]=Hi[d]+h
for(var p=0;p<e[f];++p){Ii[f]=Hi[f]+p
if(u>0)Ii[c]=Hi[c]+e[c]
else Ii[c]=Hi[c]-1
if(canPlaceOver(Ii,true,false,i,n))v=true}}if(!v)_[c]=-4
if(_[c]>=0)_[c]/=Si(le(l[c],t))}var m=0
if(_[1]>=0&&(_[m]<0||_[1]<_[m]))m=1
if(_[2]>=0&&(_[m]<0||_[2]<_[m]))m=2
var E=l[m]
var g=Si(le(In,E))-.5*e[m]
if(he(r,Hi)||Vn&&le(r,Hi)<=1)g=0
g+=e[m]-1
g=Ei(g,P-1)
g=mi(g,e[m]-1)
var T=0
var y=E[m]-In[m]>0?1:-1
var S=Ln[m][0]
var I=Ln[m][1]
var A=bt(a,true)
var w=wa()?M:D
for(var L=0;A&&L<e[S];++L){Ii[S]=Hi[S]+L
for(var O=0;A&&O<e[I];++O){Ii[I]=Hi[I]+O
if(y>0)Ii[m]=Hi[m]-1
else Ii[m]=Hi[m]+e[m]
for(var R=0;A&&R<g+1;++R){Ii[m]+=y
if(Si(le(Fi.pos,Ii))>w)break
if(!canPlaceOver(Ii,true,false,i,n)){if(!tn)drawUtilVoxel(H,Ii,ki)
break}Da.drawSingleVoxel({tile:i,is_liquid:n,pos:se(tempPoint(),Ii),z_bias:-co,color:Oi,sort_bias:_o})
T=mi(T,R)
if(n)drawUtilVoxel(x,Ii,xr.color_interact_water_place)
else drawUtilVoxel(H,Ii,Ni);--A
if(s)if(n)placeBlock(Ii,i,true,a)
else placeBlock(Ii,i)}}}if(T){var b=Zr.get("drag_place")
b.setMessage(T+1+"x"+e[0])
b.fade(5)}if(s)Hi=null}function doPropPlace(e,t,r){var a=true
var i=he(e.size,ee)
rn=null
var o
var n
var s=ai()
for(var l=0;l<e.size[1];++l){An[1]=wn[1]+l
for(var _=0;_<e.size[0];++_){An[0]=wn[0]+_
if((e.inv.rooted||e.groundFilter)&&s){An[2]=wn[2]-1
var c=Da.getTileLocal(An,0,false)
if(c&&e.groundFilter&&!e.groundFilter(c))c=0
if(c>=oa&&c<=na){var u=Da.andGetProp()
if(!u||u.inv.intangible)c=0}if(!c){if(e.groundFilter&&e.groundFilter.label)n=e.groundFilter.label
a=false
drawUtilVoxel(H,An,ki)}else drawUtilVoxel(H,An,Ri)}for(var d=0;d<e.size[2];++d){An[2]=wn[2]+d
var f=s&&e.inv.underwater_only&&getLiquidTile(An)!==ua
var v=e.flowDestroys()&&getLiquidTile(An)
o=f?er.STATUSMSG_UNDERWATER_ONLY:v?er.STATUSMSG_OUT_OF_WATER_ONLY:o
if(f||v||!canPlaceOver(An,i,e.inv.intangible)){a=false
drawUtilVoxel(H,An,ki)}}}}if(o)Zr.get("terrain_filter").setMessage(o).fade()
else if(n)Zr.get("terrain_filter").setMessage(er.$(er.STATUSMSG_GROUND_WRONG_KIND,n)).fade()
var h=et(wn,e.size,null)
if(h){za(An,wn)
for(var p=0;p<h.length;++p){var m=h[p]
if(m.bluebox_state===st)continue
var E=m.bounded_origin
var g=m.bounded_size
if(An[0]<E[0]||An[0]+e.size[0]>E[0]+g[0]||An[1]<E[1]||An[1]+e.size[1]>E[1]+g[1]||An[2]<E[2]||An[2]+e.size[2]>E[2]+g[2])a=false}}Do=true
if(e.item_id===Ne&&!ya())Zr.get("blueprint_err").setMessage(er.STATUSMSG_BP_NOT_ALLOWED)
else if(e.item_id===ke&&!Sa())Zr.get("blueprint_err").setMessage(er.STATUSMSG_SAPLING_NOT_ALLOWED)
else if(a){if(jt(e.inv))Zr.get("settlement_locked").setMessage(er.STATUSMSG_SETTLEMENT_OUT_OF_BOUNDS)
if(e.item_id===Ue&&li())if(!It(wn))Zr.get("settlement_overlap").setMessage(er.STATUSMSG_SETTLEMENT_OVERLAP).fade()
if(e.item_id===Ne&&e.blueprint_def.loaded){e.setLocalPos(wn)
ot(e)}Da.getPropLighting(e.draw_opts,wn)
Da.drawProp(e,wn)
if(t){fi(di.PropsPlaced)
playSoundForMaterial("prop_place",e.getMaterial())
placeProp(wn,e,r,rn)
Ir(r,false,void 0,Ai)}}else drawUtilVoxel(H,wn,ki,e.size)}function drawBlockHighlight(e,t){var r=e&&e.tile||(nn===cn?H:n)
var a=mouseMoveFade()
if(a>0){var i
if(ti())i=drawUtilVoxel
else{i=drawUtilVoxelLit
utilVoxelGetLighting(wi)}if(xo.length)for(var o=0;o<xo.length;++o)i(r,xo[o],tempColorFade(Mo&&Mo[o]||Ri,a))
else i(r,Ii,tempColorFade(Ri,a),t&&t.size)}}function drawCrosshair(){var e=mouseMoveFade()
if(e>0){var t=Y.x0Real()+.5*Y.wReal()
var r=Y.y0Real()+.5*Y.hReal()
var a=Do?ye(1,1,1,.5*e):ye(1,1,1,e)
Gi.draw({x:t-.5*Vi,y:r-.5*Vi,z:Z.CROSSHAIR+.1,w:Vi,h:Vi,frame:Ea.CROSSHAIR,color:a})
if(nn===dn)Gi.draw({x:t,y:r,z:Z.CROSSHAIR,w:Vi,h:Vi,frame:Ea.EDIT,color:a})}}function cancelCurrentAction(){To=sn
go=null
Wi=mo=false
Hi=true
cancelDragPlace()
nn=sn}function itemChangedDuringAction(e){if(go&&(!Kt(e,go)||nn!==To))return true
return false}function inventoryLockedDuringAction(e){if(go&&e)return true
return false}function tickBuildMode(){rr("build mode:top")
var e=j.frame_dt
var t=Ei(1.5*Gn,e)
Gn=t
bn=Rn=null
if(Fi.user_active)Un=0
else Un+=e
var r=doPointerLockTop()
doFakeTouch(r)
var a=xa()
if(!a)nt()
rr("build mode:after bluebox")
var i=dt()
var o=ft()
se(zn,i)
if((q.camera_view&&!tr.char_controller.zoomed_in_fpv||tr.char_controller.zoomed_out_tpv)&&!K.touch_mode)ne(zn,i,o,tr.char_controller.camera_distance)
V(Fn,vt())
Y.setAspectFixed2(j.game_width,j.game_height)
var n=K.drag(!K.touch_mode?{button:0}:null)
if(Ao)n=null
if(n){Un=0
re(yn,n.cur_pos)
if(K.touch_mode&&ut(n))n=null}else{if(gn)gn=void 0
if(Eo)Eo=false}var s=n?Date.now()-n.start_time:0
var l=a?null:jr()
var _=a?true:Mt(Rt)
var c
if(l)if((l.isBoostBlocked&&l.isBoostBlocked())===Gt){_t("prop")
Zr.get("boost_block").setMessage(er.STATUSMSG_BOOST_BLOCKED).fade()}Ri=bi
var u=false
var d
var f=!r&&!K.touch_mode&&!K.pad_mode
if(!mo||f){nn=cn
vn=sn
if(j.defines.DEBUGCURSOR);else if($()||f||Ao){nn=sn
mo=false}else if(l){var v=getCursorModeFromInventory(l,_,d,c,u,i)
l=v.inv
d=v.edit_prop
c=v.prop_size_sum
u=v.want_crosshair}}if(d)d.updatePreview()
if(r||K.pad_mode)ie(yn,Y.x0Real()+.5*Y.wReal(),Y.y0Real()+.5*Y.hReal())
if(lo&&(nn===un||nn===cn||nn===fn)&&K.touch_mode)te(yn,yn,ee,lo)
var h
if(j.defines.DEBUGHEXOME&&(j.DEBUG||qa("sysadmin")))h=300
else h=getCursorMaxDistance()
Sn[0]=(yn[0]-Y.x0Real())/Y.wReal()
Sn[1]=(yn[1]-Y.y0Real())/Y.hReal()
Sn[0]=(2*Sn[0]-1)*yi(j.fov_x/2)/hi(j.fov_x/2)
Sn[1]=(2*(1-Sn[1])-1)*yi(j.fov_y/2)/hi(j.fov_y/2)
Sn[2]=-1
ve(Sn,Sn,Fn)
fe(Sn)
var p=nn===ln||nn===_n
var m=Da.raycast3DLocal(Ii,wi,Ai,i,Sn,qi,Gr(),p,false)
m=checkRayLength(m,h)
if(j.defines.DEBUGHEXOME&&(j.DEBUG||qa("sysadmin")))Cr(Ii)
var E=Ii
var g=j.defines.DEBUGCURSOR?null:m&&m.prop
if(n&&!gn)gn=m||true
var T=g
Do=false
if(m&&!_&&K.click({button:1}))if(Gr()){var y=Da.raycast3DLocal(Ii,wi,Ai,i,Sn,qi,false,p,false)
if(y=checkRayLength(y,h))handleItemPick(j.defines.DEBUGCURSOR?null:m&&m.prop,y)}else handleItemPick(T,m)
var S=false
if(nn&&g){rr("build mode:before prop")
var I=handleHitProp(g,a,S,s)
g=I.hit_prop
S=I.interactable
rr("build mode:after prop")}if(g)if(nn===un&&vn===pn);else g.getLocalPos(Ii)
So=false
var A=0
var w=K.touch_mode&&nn===_n&&c>2?Ki:ji
if(!Eo){A=handleActionPlaceDragStart(n,w,s,S,A,t,r,l).action_delta
rr("build mode:after drag place start")}handleConsumable(S)
rr("build mode:after consumable")
var L=ee
if(doingDragPlace())L=zi
else if(!g||g.inv.mineable)L=zr()
var O
var R=[]
var b=[]
xo=[]
if(nn===un&&mo){if(!Co)Co={}}else Co=null
if(itemChangedDuringAction(l)||inventoryLockedDuringAction(_))cancelCurrentAction()
else if(nn===un){switch(vn){case hn:doDigAction(g,S,L,A,s,R,b,m,h)
break
case pn:case mn:doBucketAction(m,A,g,l)
break
case En:doHoeAction(m,g,L,h,A,l)}rr("build mode:after action")}else if(nn===ln){var N=Gr(ua)||Gr(da)
var C
if(N)C=l.attr2
else C=l&&l.type===Ge&&l.id||0
var x=placeBeamCast(L,E,m,h,O,C,N)
E=x.debug_pos
m=x.ray_hit
O=x.this_frame_place_origin
rr("build mode:after place")}else if(nn===_n&&d){m=placePropBeamCast(d,m,g,h)
rr("build mode:after place prop")}if(nn){var M
var D=Gr(ua)||Gr(da)
if(nn===ln)if(D)M=l.attr2
else M=l&&l.type===Ge&&l.id||0
if(nn===ln&&doingDragPlace()){z(go)
z.equal(To,ln)
z(!a)
z(M)
var P=false
if(K.touch_mode){var B=270
var k=230
var U={x:gr()+(Qt()?Zt:-B-Zt),y:Tr(),w:B,h:k,z:Z.MENUBUTTON+10,font_height:90,text:"Cancel",max_dist:Infinity}
if(n&&n.start_pos[0]>=U.x&&n.start_pos[0]<=U.x+U.w&&n.start_pos[1]>=U.y&&n.start_pos[1]<=U.y+U.h){U.x=Qt()?Y.x1()-B-J()-10:J()+10
if(!Qt()&&$t())U.y+=J()+10}if(X(U)){Hi=null
P=true}if(Q())P=true}if(P);else{doDragPlace(L,i,O,l,M,D,m)
rr("build mode:after doDragPlace")}}else if(m||L!==ee&&xo.length){var G=K.click({max_dist:w})
if(G&&!(nn===ln||nn===_n))if(Date.now()-G.start_time>Yi)G=null
if(Ao)G=null
if(G&&G.button)G=null
if(nn===_n&&d){doPropPlace(d,G,l)
rr("build mode:after doPropPlace")}else if(nn===cn||nn===fn||nn===un){if(!a&&nn!==fn||S)drawBlockHighlight(S,g)}else if(nn===ln){var F=Li
if(xo.length)for(var W=0;W<xo.length;++W)if(Mo&&Mo[W])drawUtilVoxel(H,xo[W],Mo[W])
else{Da.drawSingleVoxel({tile:M,is_liquid:D,pos:xo[W],z_bias:-co,color:F,sort_bias:_o})
Ri=Ni
drawUtilVoxel(H,xo[W],Ri)}Do=true}else if(nn===dn){drawUtilVoxel(H,Ii,tempColorFade(Ri,mouseMoveFade()),g.size)
if(G)g.propertyEdit()}}}if(r||K.pad_mode||u)drawCrosshair()
gameplayHUD()
if(K.keyDownEdge(K.KEYS.F3))j.defines.DEBUGCURSOR=!j.defines.DEBUGCURSOR
if(j.defines.DEBUGCURSOR)cursorDebug(E)
doPointerLockBottom()
rr("build mode:bottom")
updateDigTargets(e)
tickBuildModeInactive()
rr("build mode:after bottom")}function buildModeReset(){resetBlockPlaceQueue()
cancelCurrentAction()
Io={}}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/megachunk_common":254,"../common/voxel_data_common":264,"../common/world_constants":267,"../common/world_trans":268,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/settings":351,"../glov/client/spot":361,"../glov/client/textures":365,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./analytics":6,"./bluebox_edit_list":26,"./bluebox_ui":27,"./blueprint":28,"./build_menu":32,"./build_queue_ui":34,"./camera":35,"./client_entities":44,"./debug":73,"./dowser_simple":78,"./dowser_ui":79,"./draw_line3d":81,"./editvolume_client":84,"./inventory":114,"./items":119,"./layout":120,"./line3d":124,"./localization/localization":131,"./main":135,"./materials":137,"./megachunk_client":139,"./menu_ribbon":141,"./mobs":145,"./particle_system":152,"./proc_gen":162,"./proc_gen_biomes":163,"./proc_gen_debug":165,"./props":171,"./quickbar":172,"./status":193,"./stone_tiers":194,"./tiles":199,"./todo_list":202,"./tutorial":203,"./ui_util":205,"./user_data":208,"./voxel_const":215,"./voxel_data":216,"./voxel_gen":219,"./voxel_mesh":220,"./world_claims":225,"./world_comm":226,"./world_metadata":235,"./worlds_sound":236,"./worlds_soundscape":237,assert:void 0,"gl-mat4/invert":void 0}],34:[function(e,t,r){"use strict"
r.boostWidgetShow=boostWidgetShow
r.buildQueuePanel=buildQueuePanel
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var s=e("assert")
var o=e("../glov/client/engine")
var n=e("../glov/client/engine").getFrameIndex
var u=e("../glov/client/input").inputDrag
var d=e("../glov/client/ui")
var f=e("../glov/client/ui").uiTextHeight
var a=e("./boost_view").worldBoostWidget
var l=e("./huds").boostingWouldHelp
var v=e("./localization/localization").L
var h=e("./menu")
var _=e("./menu").menuActive
var c=e("./menu_ribbon").pushMenuRibbonElement
var p=e("./styles").menu_style
var i=e("./user_data")
var m=i.joinQueueAllowed
var E=i.userBuildAccessWait
var g=i.worldReadOnlyBypassPlayingAs
var T=e("./world_comm").getWorldID
var y=e("./world_comm_effective_access").worldEffAccessGetSorted
var S=e("./world_info_view")
var I=S.refreshWorldInfo
var A=S.worldCmdParseGated
var w=e("./world_metadata")
var L=w.worldBoostPerk
var O=w.worldBuildQueue
var R=e("./worlds_sound").playSound
var b=130
var N=42
var C=10
var x=4
var M=-1
function toogleQueueStatus(){R("button_click")
if(M>=0)A("build_queue_leave",I)
else A("build_queue_join",I)}function countActiveBuilders(){var e=y(),t=e.sorted_users,r=e.online,a=e.threshold
var i=0
for(var o=0;o<t.length&&o<a;++o){var n=r[t[o]]
s(n)
if(n<0)break;++i}return i}var D=b+2*C
function drawQueuePanel(e,t){var r=e+D/2-b/2
var a=t+C
var i=.75*f()
var o
var n
if(-1!==M){if(M)o=v.LBL_QUEUE_CURRENT_POS.$({index:M})
else o=v.LBL_QUEUE_BUILDING
n=v.BTN_QUEUE_LEAVE}else{o=v.LBL_QUEUE_AVAILABLE
n=v.BTN_QUEUE_JOIN}var s=O()
var l=s&&s.threshold||L("builder_limit")
var _=countActiveBuilders()
o=o+"\n"+v.FORMAT_NUMBER_OF_MAX_BUILDERS.$({count:_,max:l})
a+=d.font.drawSizedAlignedWrapped(p,r,a,Z.MENUBUTTON,0,i,d.font.ALIGN.HCENTER,D-2*C,0,o)
a+=x
if(d.buttonText({x:r,y:a,z:Z.MENUBUTTON,w:b,h:N,text:n}))toogleQueueStatus()
var c={x:e,y:t,w:D,h:(a+=N+C)-t}
u(c)
d.panel(_extends({},c,{z:Z.MENUBUTTON-1,pixel_scale:.5,color:h.panel_color_popup}))}var P=300
var B=100
function drawBoostPanel(e,t,r){a(T(),t,r,P,B,e)}var k=-2
var U
function boostWidgetShow(e){k=n()
U=e}function buildQueuePanel(){var e=O()
if(e){M=E()
var t=e.force_ui
var r=!e.manual
var a=M>0
var i=t&&m()||g()&&m()||r&&a
if(!o.defines.NOUI)if(i){c({w:D,cb:drawQueuePanel})
if(a&&!_())if(l())c({w:P,cb:drawBoostPanel.bind(null,"queue_waiting")})}else if(k>=n()-1)c({w:P,cb:drawBoostPanel.bind(null,U)})}}},{"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/ui":367,"./boost_view":31,"./huds":104,"./localization/localization":131,"./menu":140,"./menu_ribbon":141,"./styles":197,"./user_data":208,"./world_comm":226,"./world_comm_effective_access":227,"./world_info_view":231,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],35:[function(e,t,r){"use strict"
r.getActiveController=getActiveController
r.setCharacterControllerAsActive=setCharacterControllerAsActive
r.setPhotoControllerAsActive=setPhotoControllerAsActive
r.cameraGetMainFOV=cameraGetMainFOV
r.getCurrentCameraPos=getCurrentCameraPos
r.getCurrentCameraTargetDir=getCurrentCameraTargetDir
r.getCurrentCameraUnderwater=getCurrentCameraUnderwater
r.setCurrentCameraPos=setCurrentCameraPos
r.setCurrentCameraTargetDir=setCurrentCameraTargetDir
r.shiftCurrentCameraPos=shiftCurrentCameraPos
r.updateCurrentCamera=updateCurrentCamera
r.updateAndGetViewMatrix=updateAndGetViewMatrix
r.getCurrentViewMatrix=getCurrentViewMatrix
r.getChunkViewMatrix=getChunkViewMatrix
r.setViewParameters=setViewParameters
r.getCameraMode=getCameraMode
r.setCameraModeRegular=setCameraModeRegular
r.changeCameraMode=changeCameraMode
r.cameraConsumeV=cameraConsumeV
r.handleCameraInput=handleCameraInput
r.cameraHandleDrag=cameraHandleDrag
r.cameraStartup=cameraStartup
r.CAMMODE_REGULAR=void 0
var a=1
var i=4
var o=a
r.CAMMODE_REGULAR=o
var n=2
var s=3
var l=i
var _=e("assert")
var c=e("gl-mat4/lookAt")
var u=e("../glov/client/cmds").cmd_parse
var d=e("../glov/client/dyn_geom.js").dynGeomLookAt
var f=e("../glov/client/engine")
var v=e("../glov/client/input")
var h=v.KEYS
var p=v.drag
var m=v.keyDown
var E=v.keyDownEdge
var g=v.keyUpEdge
var T=v.mouseWheel
var y=e("../glov/client/settings")
var S=e("../glov/client/shaders").shadersAddGlobal
var I=e("../glov/client/transition")
var A=e("../glov/common/verify")
var w=e("../glov/common/vmath")
var L=w.m4TransformVec3
var O=w.mat4
var R=w.mat4isFinite
var b=w.v2addScale
var N=w.v2copy
var C=w.v2dist
var x=w.v3add
var M=w.v3addScale
var D=w.v3copy
var P=w.v3cross
var B=w.v3floor
var k=w.v3iAdd
var U=w.v3iMax
var G=w.v3iMin
var F=w.v3iNormalize
var W=w.vec2
var H=w.vec3
var z=e("../common/globals").CHUNK_SIZE
var V=e("./character_controller_constants").MIN_CAMERA_DISTANCE
var Y=e("./controller_common").UP
var j=e("./debug").debugAddText
var K=e("./main")
var q=e("./main")
var X=q.charControllerPos
var Q=q.setExploreCanMoveChar
var $=q.setExploreCanMovePht
var J=e("./status").statusPush
var ee=e("./tiles")
var te=ee.TILE_WATER
var re=ee.TILE_WATER_FLOW
var ae=e("./voxel_data")
var ie=ae.getTileLocal
var oe=ae.origin_chunk
var ne=e("./world_comm").getPerm
var se=Math.PI,le=Math.tan,_e=Math.max
var ce=f.defines.FREECAM&&f.DEBUG?n:o
var ue=H()
var de
function getActiveController(){return de}function setCharacterControllerAsActive(){de=K.char_controller}function setPhotoControllerAsActive(){de=K.pht_controller}function cameraGetMainFOV(){return(y.camera_view&&y.fov_third_override?y.fov_third_override:y.fov)*se/180}var fe=H()
var ve=H()
var he=false
function getCurrentCameraPos(){return fe}function getCurrentCameraTargetDir(){return ve}function getCurrentCameraUnderwater(){return he}function setCurrentCameraPos(e){D(fe,e)}function setCurrentCameraTargetDir(e){D(ve,e)}var pe=H()
var me=H()
var Ee=H()
var ge=H()
var Te=H()
var ye=H()
var Se=H()
var Ie=H()
function underwaterTest(e){var t=ie(e,0,true)
return t===te||t===re}function checkCameraUnderwater(){D(pe,fe)
var e=f.ZNEAR
M(pe,pe,ve,e)
var t=le(f.fov_x/2)*e
var r=le(f.fov_y/2)*e
P(ge,ve,Y)
F(ge)
P(Ee,ge,ve)
F(Ee)
M(me,M(me,pe,ge,t),Ee,r)
D(Te,me)
D(ye,me)
M(me,M(me,pe,ge,t),Ee,-r)
G(Te,me)
U(ye,me)
M(me,M(me,pe,ge,-t),Ee,r)
G(Te,me)
U(ye,me)
M(me,M(me,pe,ge,-t),Ee,-r)
G(Te,me)
U(ye,me)
B(Se,Te)
B(Ie,ye)
he=false
var a=[[0,0],[0,0],[0,0]]
for(var i=0;i<2;++i){me[2]=(i?Ie:Se)[2]
for(var o=0;o<2;++o){me[1]=(o?Ie:Se)[1]
for(var n=0;n<2;++n){me[0]=(n?Ie:Se)[0]
if(underwaterTest(me)){he=true
a[0][n]++
a[1][o]++
a[2][i]++}}}}if(Ie[2]-Se[2]>1||Ie[1]-Se[1]>1||Ie[0]-Se[0]>1)for(me[2]=Se[2];me[2]<=Ie[2];++me[2])for(me[1]=Se[1];me[1]<=Ie[1];++me[1])for(me[0]=Se[0];me[0]<=Ie[0];++me[0])if(underwaterTest(me))he=true
var s=false
for(var l=0;l<3;++l){var _=a[l]
if(_[0]!==_[1])if(A(Ie[l]!==Se[l])){var c=(ye[l]-Te[l])/2
if(c>.5)continue
s=true
var u=Ie[l]
if(_[0]>_[1])fe[l]=u-c-ve[l]*e
else fe[l]=u+c-ve[l]*e}}if(s){de.applyTweakedCameraPos(fe)
if(f.defines.CAMERA)j("camera_underwater_shifted")}if(f.defines.CAMERA&&he)j("camera_underwater")}function shiftCurrentCameraPos(e){k(fe,e)}function updateCurrentCamera(){setCurrentCameraPos(de.updateAndGetCameraPos())
setCurrentCameraTargetDir(de.getCameraTargetDir())
checkCameraUnderwater()
f.setGlobalMatrices(updateAndGetViewMatrix())}var Ae=H()
var we=O()
function updateAndGetViewMatrix(){x(Ae,fe,ve)
c(we,fe,Ae,Y)
d(fe,Ae,Y)
return we}function getCurrentViewMatrix(){return we}var Le=H()
var Oe=H()
var Re=O()
function getChunkViewMatrix(){M(Le,oe,de.getCameraPos(),1/z)
x(Oe,Le,de.getCameraTargetDir())
c(Re,Le,Oe,Y)
return Re}function setViewParameters(e,t){e=e||updateAndGetViewMatrix()
_(R(e))
if(t||!de.is_tpv)ue[0]=ue[1]=ue[2]=0
else L(ue,X(),e)
f.setGlobalMatrices(e)}y.register({camera_mode_max:{default_value:i,type:u.TYPE_INT,range:[a,i],help:"(Admin) Change maximum camera mode to cycle",access_run:["sysadmin"]}})
function getCameraMode(){return ce}function setCameraModeRegular(){K.char_controller.updateCameraPos()
setCharacterControllerAsActive()
K.char_controller.setModeToWalk()
$(true)
Q(true)
ce=o
J("Current Camera Mode: Regular")}function setCameraModeFreecam(){setCharacterControllerAsActive()
K.char_controller.setModeToFreeCam()
$(true)
Q(true)
ce=n
J("Current Camera Mode: FreeCam")}function setCameraModeDetached(){K.char_controller.setModeToWalk()
if(ce!==l)K.pht_controller.getParamsFromController(K.char_controller)
setPhotoControllerAsActive()
$(false)
Q(true)
ce=s
J("Current Camera Mode: Detached")}function setCameraModeMoveCam(){K.char_controller.setModeToWalk()
if(ce!==s)K.pht_controller.getParamsFromController(K.char_controller)
setPhotoControllerAsActive()
$(true)
Q(false)
ce=l
J("Current Camera Mode: MoveCam")}function changeCameraMode(e){if(e===o)setCameraModeRegular()
else if(e===n)setCameraModeFreecam()
else if(e===s)setCameraModeDetached()
else if(e===l)setCameraModeMoveCam()
else console.warn("Invalid Camera Mode")}function zoomToggleTransition(){I.queue(Z.TRANSITION_FINAL,I.fade(180))}var be=0
var Ne=1
function zoomInOut(e){if(1===y.camera_view){if(e>0&&be<0)if(e>-be){e+=be
be=0}else{be+=e
e=0}var t=y.camera_max_distance+e
if(t<V){be-=V-t
e=0
t=V}if(be<=-Ne){zoomToggleTransition()
y.setAsync("camera_view",0)
be=0}y.set("camera_max_distance",t)}else if((be=_e(be+e,0))>=Ne){be=0
zoomToggleTransition()
y.setAsync("camera_view",1)
K.char_controller.resetCameraDistanceForZoomOut()
y.set("camera_max_distance",V)}}var Ce=false
function cameraConsumeV(){Ce=true}function handleCameraInput(){var e=ne("sysadmin")||f.DEBUG
var t=0
var r=m(h.V)
if(Boolean(y.mousewheel_mode)===Boolean(!r))t+=-T()
if(r)t+=.02*(m(h.PAGEDOWN)-m(h.PAGEUP))
if(t){Ce=true
zoomInOut(t)}if(g(h.V)){if(!Ce){zoomToggleTransition()
y.setAsync("camera_view",y.camera_view?0:1)
be=0}Ce=false}if(!r)Ce=false
if(e)if(m(h.SHIFT)&&E(h.F2))if(ce===a)changeCameraMode(y.camera_mode_max)
else changeCameraMode(ce-1)
else if(E(h.F2))if(ce>=y.camera_mode_max)changeCameraMode(a)
else changeCameraMode(ce+1)}var xe=W()
var Me=W()
var De=W()
var Pe=W()
var Be=W()
var ke=10
function cameraHandleDrag(e){if(e.total<ke)return false
N(xe,e.delta)
N(De,e.cur_pos)
b(Me,De,e.delta,-1)
var t=p({min_dist:ke})
if(t){N(Be,t.cur_pos)
b(Pe,Be,t.delta,-1)
var r=C(Me,Pe)
zoomInOut(-.01*(C(De,Be)-r))
return true}return false}function cameraStartup(){S("flashlight_pos_vs",ue)}},{"../common/globals":248,"../glov/client/cmds":298,"../glov/client/dyn_geom.js":302,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/transition":366,"../glov/common/verify":401,"../glov/common/vmath":402,"./character_controller_constants":38,"./controller_common":49,"./debug":73,"./main":135,"./status":193,"./tiles":199,"./voxel_data":216,"./world_comm":226,assert:void 0,"gl-mat4/lookAt":void 0}],36:[function(e,t,r){"use strict"
r.caveGenSphere=caveGenSphere
r.caveGenBoring=caveGenBoring
r.oreVeinGen=oreVeinGen
r.caveGenMaze=caveGenMaze
var S=e("assert")
var a=e("../glov/client/quat")
var y=a.qFromYPR
var I=a.qMult
var A=a.qTransformVec3
var i=a.quat
var o=e("../glov/client/rand_fast")
var n=o.randFastCreate
var Z=o.randSimpleSpatial
var s=e("../glov/common/util")
var w=s.easeIn
var l=s.inherits
var q=s.lerp
var d=s.mod
var _=e("../glov/common/vmath")
var f=_.ivec3
var L=_.v3copy
var X=_.v3distSq
var Q=_.v3iAdd
var O=_.v3iMax
var R=_.v3iMin
var b=_.v3iMul
var $=_.v3iNormalize
var J=_.v3scale
var N=_.v3set
var ee=_.v3sub
var C=_.vec2
var c=_.vec3
var u=_.vec4
var v=e("../common/globals")
var te=v.CHUNK_SIZE
var re=v.CS2
var h=e("../common/ids")
var ae=h.ITEM_CHEST_MEDIUM
var ie=h.ITEM_DOOR
var oe=h.ITEM_DOOR_DOUBLE
var ne=h.ITEM_INGOT
var se=h.ITEM_PLANT
var le=h.ITEM_TORCH
var _e=h.TYPE_ITEM
var ce=e("../common/materials_common").Mat
var p=e("./detail_gen_base")
var x=p.DetailGenBase
var m=p.blocksAlways
var E=p.blocksNever
var ue=p.bounds_z
var de=p.maxSurfaceClear
var fe=p.step_pos
var ve=p.surfaceCheckSetParams
var he=p.tryDeleteProp
var pe=p.tryPlaceProp
var g=e("./flora_constants")
var me=g.BROWN_MUSHROOMS
var Ee=g.LUMINESCENT_MUSHROOMS
var ge=g.RED_MUSHROOMS
var Te=e("./line2d").ptLineDistSqBBV
var T=e("./line3d")
var V=T.ptLineDist3DSqBBV
var ye=T.ptLineNearestBBV
var Y=T.v3distSqBV
var M=e("./maze_gen")
var Se=M.M_DOOR
var Ie=M.M_INTERIOR
var D=M.M_LEAF
var Ae=M.M_TORCH
var we=M.M_TREASURE
var Le=M.M_WALL
var P=M.mazeGen
var Oe=e("./proc_gen_biomes").world_noise3D
var B=e("./proc_gen_constants")
var Re=B.PROP_1x1x1
var be=B.PROP_1x2x4
var Ne=B.PROP_1x4x4
var Ce=B.PROP_2x1x4
var xe=B.PROP_2x2x2
var Me=B.PROP_4x1x4
var k=e("./proc_gen_details")
var U=k.MAX_DETAIL_REACH
var G=k.f32Alloc
var F=e("./tiles")
var De=F.TILE_BRICK_STONE
var Pe=F.TILE_COAL
var j=F.TILE_DIRT
var K=F.TILE_GRASS
var W=F.TILE_ORE_IN_STONE
var H=F.TILE_ORE_IN_STONE_DARK
var z=F.TILE_ORE_IN_STONE_LIGHT
var Be=F.TILE_ORE_IN_STONE_RED
var ke=F.TILE_ORE_IN_VEINIUM
var Ue=F.TILE_PROP_BASE
var Ge=F.TILE_STONE
var Fe=F.TILE_STONE_DARK
var We=F.TILE_STONE_LIGHT
var He=F.TILE_STONE_RED
var ze=F.TILE_VEINIUM
var Ve=F.TILE_WATER
var Ye=Math.abs,je=Math.acos,Ke=Math.cos,qe=Math.ceil,Ze=Math.floor,Xe=Math.max,Qe=Math.min,$e=Math.round,Je=Math.sin,et=Math.sqrt,tt=Math.PI
var rt=false
var at=n()
function CaveGenSphere(e,t,r){x.call(this)
at.reseed(e)
this.origin=t.slice(0)
var a=this.r=at.floatBetween(5,16)
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,t[0]-a,t[1]-a,t[2]-a,t[0]+a,t[1]+a,t[2]+a)}l(CaveGenSphere,x)
CaveGenSphere.prototype.type="CaveGenSphere"
CaveGenSphere.prototype.priority=100
CaveGenSphere.prototype.blocksOther=m
var it=[ce.WOOD,ce.LIGHT_WOOD,ce.DARK_WOOD,ce.RED_WOOD]
CaveGenSphere.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=r.map
var n=t.pos_world,s=t.props
var l=this.origin,_=this.r
var c=_*_
var u=r.owner_hexome.water_level
ve(o,u,n[2])
var d=l[2]-$e(.25*_)
this.stepInit(n)
for(var f=0;f<te;++f){if(!this.stepY(f))continue
var v=o[f]
for(var h=0;h<te;++h){if(!this.stepX(h))continue
var p=f*te+h
var m=de(v,h,f)
var E=Qe(te,m-n[2]+1)
var g=fe[0]===l[0]&&fe[1]===l[1]
for(var T=0;T<E;++T,p+=re){var y=n[2]+T
fe[2]=y
if(!i[p])continue
if(X(fe,l)>c)continue
var S=l[2]-fe[2]
var I=0
var A=null
if(g&&fe[2]===d&&fe[2]<m-10)A={id:le,attr1:it[a.range(it.length)],size:Re}
else if(S>0){fe[2]-=S/2
if(X(fe,l)>c)if(Ye(fe[0]-l[0])+Ye(fe[1]-l[1])<1.99&&y<l[2]-_+1)I=ke
else if(g)I=a.random()>.8?ke:ze
else if(S<3||a.random()>.75)continue
else I=j
else if(g&&fe[2]<d)I=a.random()>.8?ke:ze}var w=i[p]
if(w>=Ue)if(!he(t,w,h,f,T))continue
if(A){i[p]=Ue
if(!s)s=t.props={}
s[p]=A}else i[p]=I
t.full=false}}}}
function caveGenSphere(e,t,r){return new CaveGenSphere(e,t,r)}function randFloatExp(e,t){var r=at.random()
return e+r*r*(t-e)}function randomQuatAngle(e){var t=at.floatBetween(0,2*tt)
var r=je(at.floatBetween(-1,1))
y(e,t,r,0)}var ot=c()
var nt=c()
var st=c()
var lt=i()
var _t=i()
var ct=c()
var ut=10
var dt=20
var ft=16
S(ut*dt+ft<U)
var vt=c()
var ht=6
function CaveGenBoring(e,t,r){x.call(this)
at.reseed(e)
var a=at.random()
var i=at.random()
var o=0
if(a<.05)N(vt,.2,1,1)
else if(a<.1)N(vt,1,.2,1)
else if(a<.15)N(vt,1/3,1/3,1)
else if(a<.3)N(vt,1,1,.2)
else{N(vt,1,1,1)
if(i<.1)o=1}var n=randFloatExp(2,ft/2)
var s=randFloatExp(1,ft/2)
var l=at.floatBetween(n,s)
var _=8+at.range(ut+1-8)
randomQuatAngle(lt)
var c=at.floatBetween(.75*dt,dt)
var u=at.floatBetween(tt/4,tt/2)
var d=at.floatBetween(0,1)
this.boundsAlloc(_)
var f=this.bounds_idx
var v=ht+4*(_+1)
var h=G(v),p=h[0],m=h[1]
this.f32buf=p
var E=m
this.header_idx=m
p[m++]=vt[0]
p[m++]=vt[1]
p[m++]=vt[2]
p[m++]=d
p[m++]=o
p[m++]=i
this.origin_idx=m
function addPoint(){p[m++]=st[0]*vt[0]
p[m++]=st[1]*vt[1]
p[m++]=st[2]*vt[2]
p[m++]=l}var g=this
function addLeg(e){L(ot,st)
L(nt,st)
N(ct,0,0,c)
A(ct,ct,lt)
b(ct,vt)
if(o)ct[2]=-Ye(ct[2])
Q(st,ct)
y(_t,at.floatBetween(-u,u),at.floatBetween(-u,u),0)
I(lt,lt,_t)
var t=l
l=at.floatBetween(n,s)
t=Xe(t,l)+1
R(ot,st)
O(nt,st)
f=g.boundsPush(f,ot[0]-t/vt[0],ot[1]-t/vt[1],ot[2]-t/vt[2],nt[0]+t/vt[0],nt[1]+t/vt[1],nt[2]+t/vt[2])
addPoint()}L(st,t)
addPoint()
for(var T=0;T<_;++T)addLeg(T)
S.equal(f,this.bounds_idx+6*this.bounds_len)
S.equal(m,E+v)}l(CaveGenBoring,x)
CaveGenBoring.prototype.type="CaveGenBoring"
CaveGenBoring.prototype.priority=100
CaveGenBoring.prototype.getDebugLines=function(){var e=this.origin_idx,t=this.f32buf,r=this.header_idx
var a=[]
for(var i=0;i<this.bounds_len;++i){var o=e+4*i
a.push([[t[o]/t[r],t[o+1]/t[r+1],t[o+2]/t[r+2]],[t[o+4]/t[r],t[o+5]/t[r+1],t[o+6]/t[r+2]]])}return a}
var pt=u()
var mt=u()
var Et=c()
CaveGenBoring.prototype.blocksOther=function(e,t,r,a){var i=e.blocked_r
var o=this.origin_idx,n=this.f32buf,s=this.header_idx
Et[0]=t[0]*n[s]
Et[1]=t[1]*n[s+1]
for(var l=0;l<this.bounds_len;++l)if(a&1<<l){var _=o+4*l
var c=(n[_+2]+n[_+6])/(2*n[s+2])
if(t[2]>c)Et[2]=t[2]
else if(t[2]+r<c)Et[2]=t[2]+r
else Et[2]=c
Et[2]*=n[s+2]
V(pt,n,_,_+4,Et)
var u=pt[1]
var d=q(pt[0],n[_+3],n[_+7])+.25
if(u<(d+=i)*d)return true}return false}
var gt=[]
gt[We]=z
gt[Ge]=W
gt[Fe]=H
gt[He]=Be
var Tt=.5
var yt=2.5
var St=.1
var It=.87
var At=.25
var wt=new Array(32)
var Lt=c()
var Ot=c()
CaveGenBoring.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=r.map
var s=r.owner_hexome.water_level
var l=t.pos_world,_=t.props
var c=this.origin_idx,u=this.f32buf,d=this.header_idx
var f=u[d+3]
var v=u[d+4]
var h=u[d+5]
var p=!(Ze(1001*h)%4)
var m=!(Ze(10001*h)%3)
this.stepInit(l)
ve(n,s,l[2])
for(var E=0;E<te;++E){if(!this.stepY(E))continue
Lt[1]=fe[1]*u[d+1]
var g=n[E]
for(var T=0;T<te;++T){var y=this.stepX(T)
if(!y)continue
Lt[0]=fe[0]*u[d]
for(var S=0;S<y;++S)wt[S]=c+4*ue[S]
var I=E*te+T
var A=de(g,T,E)
var w=false
var L=Qe(te,A-l[2]+1)
var O=false
for(var R=0;R<L;++R,I+=re){var b=l[2]+R
var N=false
var C=false
var x=false
var M=null
if(w&&i[I]>=Ue)N=true
else{fe[2]=b
w=false
for(var D=0;D<y;++D){var P=wt[D]
Lt[2]=b*u[d+2]
ye(pt,u,P,P+4,Lt)
var B=X(pt,Lt)
var k=Lt[2]-pt[2]
var U=B?k*k/B:1
if(k>0)U*=f
var G=(2*Oe[0](Lt[0]*Tt,Lt[1]*Tt,.1*Lt[2])-1)*(1-U)*3
Lt[2]+=G
ye(pt,u,P,P+4,Lt)
B=X(pt,Lt)
var F=pt[3]
var W=q(F,u[P+3],u[P+7])
if(B<W*W){N=true
break}var H=et(B)
if(v)if(b<A-5&&k<0&&H<W+v+.5){Te(mt,u,P,P+4,Lt)
if(mt[1]<1.5)C=true}if(!C)if(H<W+yt)if(Oe[0](fe[0]*St,fe[1]*St,fe[2]*St)>It&&a.random()<At){ee(Ot,Lt,pt)
$(Ot)
J(Ot,Ot,W)
Q(Ot,pt)
Ot[0]/=u[d]
Ot[1]/=u[d+1]
Ot[2]=(Ot[2]-G)/u[d+2]
if(X(Ot,fe)<yt*yt)x=true}}if(N&&p&&b<A-30&&!O&&i[I-re]&&!C){O=true
var z=Oe[0](.05*fe[0],.05*fe[1],.05*fe[2])
var V=a.range(100)
if(z>.5&&V>85)M={id:se,size:Re,attr3:me.key[a.range(me.key.length)]}
var Y=500
if((z=Oe[0](.05*fe[0]+Y,.05*fe[1]+Y,.05*fe[2]))>.7&&V>90)M={id:se,size:Re,attr3:ge.key[a.range(ge.key.length)]}
if(a.range(1e3)<1&&b<A-50)M={id:se,size:Re,attr3:Ee.key[a.range(Ee.key.length)]}}}if(C)if(!N)N=true
else C=false
if(N)x=false
if(!N&&!x)continue
var j=i[I]
if(j>=Ue)if(!he(t,j,T,E,R))continue
if(C){if(!o){t.alloc(true)
o=t.liquid}t.liquid_stable=false
o[I]=Ve}if(x){var K=gt[j]
if(K)i[I]=m?Pe:K}else if(M){if(!_)_=t.props={}
_[I]=M
i[I]=Ue
t.full=false}else if(N){i[I]=0
w=true
t.full=false}}}}}
function caveGenBoring(e,t,r){return new CaveGenBoring(e,t,r)}var Rt=[[Pe,null],[ke,ze],[ke,ze],[ke,ze]]
function OreVeinGen(e,t,r){x.call(this,e,t,r)
at.reseed(e)
var a=Rt[at.range(Rt.length)]
this.ore_type=a[0]
this.stone_type=rt?0:a[1]
this.surface_offs=randFloatExp(-.66,1)
this.ore_r=randFloatExp(1,1.5)
var i=this.vein_r=this.ore_r+at.floatBetween(1,3)
var o=at.floatBetween(30,80)
var n=5+Ze((o-30)/50*4)
var s=o/(this.num_legs=n)
var l=randFloatExp(tt/4,tt/2)
this.center_factor=this.ore_type===Pe?1:.5
this.center_chance=this.ore_type===Pe?.9:.6
var _=C(at.floatBetween(0,2*tt),at.floatBetween(0,2*tt))
var c=_.slice(0)
this.boundsAlloc(2*n+1)
var u=this.bounds_idx
var d=2*(n+1)*4
var f=G(d),v=f[0],h=f[1]
this.f32buf=v
var p=h
this.origin_idx=h
var m=qe(this.ore_r+1)
u=this.boundsPush(u,t[0]-m,t[1]-m,t[2]-m,t[0]+m,t[1]+m,t[2]+m)
var E=1
function addPoint(){v[h++]=st[0]
v[h++]=st[1]
v[h++]=st[2]
v[h++]=E}var g=this
function addLeg(e){L(ot,st)
L(nt,st)
st[0]+=Je(c[0])*s
st[1]+=Ke(c[0])*s
st[2]+=Ke(c[1])*s
c[0]+=at.floatBetween(-l,l)
c[1]+=at.floatBetween(-l,l)
R(ot,st)
O(nt,st)
var t=E*i
u=g.boundsPush(u,ot[0]-t,ot[1]-t,ot[2]-t,nt[0]+t,nt[1]+t,nt[2]+t)
E=w(1-(e+1)/n,2)
addPoint()}L(st,t)
addPoint()
for(var T=0;T<n;++T)addLeg(T);(c=_)[0]+=tt
c[1]+=tt
E=1
L(st,t)
addPoint()
for(var y=0;y<n;++y)addLeg(y)
S.equal(h,p+d)
S.equal(u,this.bounds_idx+6*this.bounds_len)}l(OreVeinGen,x)
OreVeinGen.prototype.type="OreVeinGen"
OreVeinGen.prototype.priority=10
OreVeinGen.prototype.blocksOther=E
OreVeinGen.prototype.checkBounds=function(e){e=this.bounds_idx+6*e
if(fe[0]<this.bounds_buf[e++]||fe[0]>=this.bounds_buf[e++]||fe[1]<this.bounds_buf[e++]||fe[1]>=this.bounds_buf[e++])return false
return true}
OreVeinGen.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=r.map
var s=t.pos_world
var l=this.origin_idx,_=this.stone_type,c=this.ore_type,u=this.ore_r,d=this.vein_r,f=this.surface_offs,v=this.f32buf,h=this.num_legs,p=this.center_factor,m=this.center_chance
var E=h+1
var g
this.stepInit(s)
var T
for(var y=0;y<te;++y){if(!this.stepY(y))continue
var S=n[y]
for(var I=0;I<te;++I){var A=this.stepX(I)
if(!A)continue
for(var w=0;w<A;++w){var L=ue[w]
if(L)wt[w]=l+4*(L-1)+(L>=E?4:0)
else wt[w]=0}var O=y*te+I
var R=S[I].h
var b=R+Ze(f+.66*a.random())
var N=-1
for(var C=0;C<te;++C,O+=re){fe[2]=s[2]+C
var x=a.random()
if(fe[2]>b){var M=fe[2]-b
if(M>4)break
var D=C&&i[O-re]
if(!D||D>=Ue)break
x-=.25*M}var P=false
for(var B=0;B<A;++B){var k=wt[B]
if(!k){var U=Xe(0,u+2*x-1)
if(Y(v,l,fe)>U*U)continue
g=c}else{V(pt,v,k,k+4,fe)
var G=pt[1]
var F=q(pt[0],v[k+3],v[k+7])
var W=Xe(0,F*d+2*x)
if(G>W*W)continue
if(G<p*F&&a.random()<m)g=c
else{if(null===_)continue
g=_}}P=true
break}if(!P)continue
var H=i[O]
if(H>=Ue)if(!he(t,H,I,y,C))continue
i[O]=g
if(o)o[O]=0
if(fe[2]>R){var z=O-re
fe[2]--
while(z>=0&&fe[2]>=R&&(!i[z]||i[z]===K||i[z]===j)){if(o)o[z]=0
i[z]=_
z-=re
fe[2]--}N=O}if(rt)t.full=false}if(-1!==N){if(!T)T=[]
T.push(N)}}}if(T&&a.random()<.75)i[T[a.range(T.length)]]=c}
function oreVeinGen(e,t,r){return new OreVeinGen(e,t,r)}var bt=16
function CaveGenMaze(e,t,r){x.call(this)
at.reseed(e)
var a=this.size=$e(randFloatExp(37,60))
this.origin=f(t[0]-a/2,t[1]-a/2,t[2])
var i=this.door_w=2+Xe(0,at.range(5)-2)
var o={seed:e,w:a,h:a,min_dim:2+at.range(2),door_w:i,r1:2+at.range(7),treasure:4e-4,treasure_size:2}
var n=this.maze=P(o)
this.room_h=8
this.wood=it[at.range(it.length)]
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,this.origin[0],this.origin[1],this.origin[2],this.origin[0]+a-1,this.origin[1]+a-1,this.origin[2]+this.room_h+bt-1)
var s=a*a-1
for(var l=a-1;l>=0;--l)for(var _=a-1;_>=0;--_,--s){var c=n[s]
if((15&c)===we)if((15&n[s-1])===we||(15&n[s-a])===we)n[s]=-16&c|D
else{var u=s
if(d(this.origin[0]+_,te)===te-1)--u
if(d(this.origin[1]+l,te)===te-1)u-=a
if(s!==u){n[u]=we|-16&n[u]
n[s]=-16&c|D}}}}l(CaveGenMaze,x)
CaveGenMaze.prototype.type="CaveGenMaze"
CaveGenMaze.prototype.priority=50
CaveGenMaze.prototype.dispose=function(){this.maze=null}
var Nt=f()
CaveGenMaze.prototype.genLocal=function(e){var t=e.vd,r=e.vs,a=e.non_spatial_rand
var i=t.data
if(!i)return
var o=t.liquid
var n=this.room_h,s=this.maze,l=this.size,_=this.door_w,c=this.seed,u=this.origin
var d=r.map
var f=r.owner_hexome.water_level
var v=t.pos_world,h=t.props
ve(d,f,v[2])
ee(Nt,v,u)
var p=Xe(-Nt[0],0)
var m=Qe(l-Nt[0],te)
var E=Xe(-Nt[1],0)
var g=Qe(l-Nt[1],te)
var T=[]
var y=[]
var S=0
for(var I=E;I<g;++I){var A=v[1]+I
var w=A-u[1]
var L=d[I]
for(var O=p;O<m;++O){var R=v[0]+O
var b=R-u[0]+w*l
var N=s[b]
var C=15&N
if(C===Le)continue
var x=N>>4
var M=de(L,O,I)
var D=Nt[2]-x
var P=Xe(-D,0)
var B=Qe(Qe(n-D,te),M-v[2])
var k=I*te+O+P*re
var U=u[2]-v[2]+x+1
if(U>=-4&&U<te){if(C===Se&&(2===_||4===_)&&Z(c,R,A,u[2])<.25){var G=false
if((15&s[b-1])===Se||(15&s[b-l])===Se);else if((15&s[b+1])===Se){if(O<=te-_){G=true
S=0}}else if((15&s[b+l])===Se)if(I<=te-_){G=true
S=1}if(G)y.push([O,I,U,S])}if(C===we)T.push([O,I,U])}for(var F=P;F<B;++F,k+=re){var W=v[2]+F-u[2]-x
var H=i[k]
if(!H)continue
if(H>=Ue)if(!he(t,H,O,I,F))continue
var z=0
if(C===Se&&W>=5)z=5===W?Ge:De
else if(0===W||W===n-1)z=C===Ie?Ge:De
else if(C===Ae&&4===W){z=Ue
if(!h)h=t.props={}
h[k]={id:le,attr1:this.wood,size:Re}}if(!(i[k]=z))t.full=false
if(o)o[k]=0}}}for(var V=0;V<T.length;++V){var Y=T[V]
pe(t,Y,{id:ae,size:xe,attr1:this.wood,rot:a.range(4),contents:[{type:_e,id:ne,attr1:ce.GOLD,count:3+a.range(4)}]})}for(var j=0;j<y.length;++j){var K=y[j]
var q=K[3]
pe(t,K,{id:4===_?oe:ie,size:4===_?q?Ne:Me:q?be:Ce,attr1:this.wood,rot:q})}}
function caveGenMaze(e,t,r){return new CaveGenMaze(e,t,r)}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../glov/client/quat":346,"../glov/client/rand_fast":347,"../glov/common/util":400,"../glov/common/vmath":402,"./detail_gen_base":74,"./flora_constants":101,"./line2d":123,"./line3d":124,"./maze_gen":138,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./proc_gen_details":166,"./tiles":199,assert:void 0}],37:[function(e,t,r){"use strict"
r.dirToLookAngle=dirToLookAngle
r.CharacterController=r.CC_FLY_FACTOR=r.CC_SPRINT_FACTOR=r.CC_BASE_SPEED=void 0
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var M=e("assert")
var D=e("../glov/client/engine")
var a=e("../glov/client/error_report").errorReportSetDynamicDetails
var i=e("../glov/client/net")
var o=i.netDisconnected
var _=i.netSubs
var P=e("../glov/client/ui").isMenuUp
var B=e("../glov/client/urlhash")
var n=e("../glov/common/util")
var k=n.lerp
var U=n.map01
var s=n.toNumber
var l=e("../glov/common/vmath")
var c=l.v2add
var u=l.v2dist
var d=l.v2length
var f=l.v2scale
var v=l.v3add
var G=l.v3addScale
var F=l.v3copy
var W=l.v3distSq
var h=l.v3floor
var p=l.v3iAdd
var H=l.v3iNormalize
var m=l.v3iSub
var E=l.v3length
var z=l.v3lengthSq
var g=l.v3lerp
var V=l.v3sub
var T=l.vec2
var y=l.vec3
var S=l.zaxis
var Y=l.zero_vec
var I=e("../common/globals")
var A=I.CHUNK_SIZE
var w=I.VOXELS_PER_M
var L=e("../common/ids").TYPE_ITEM
var O=e("../common/world_trans").decodeWorldPos
var R=e("./animation_enum").AnimEnum
var b=e("./auto_activate_ui").autoActivateSuppress
var N=e("./baking").bakedEmits
var C=e("./base_controller")
var x=C.BaseController
var j=C.MAX_STEP_DT
var K=C.MAX_TIMESLICE
var q=C.TODEG
var Z=C.TORAD
var X=e("./build_mode")
var Q=X.doStamina
var $=X.playSoundForMaterial
var J=X.tileMaterial
var ee=e("./camera")
var te=ee.getActiveController
var re=ee.updateCurrentCamera
var ae=e("./character_controller_constants")
var ie=ae.CAMERA_FIRST_ZOOM_DIST
var oe=ae.CHAR_SIZES
var ne=ae.CHAR_SIZE_SMALL
var se=ae.CHAR_SIZE_TALL
var le=ae.CROUCH_RATIO
var _e=ae.EYE_HEIGHT
var ce=ae.FOLLOW_PLAYER_DISTANCE
var ue=ae.FOLLOW_PLAYER_PITCH_FPV
var de=ae.FOLLOW_PLAYER_PITCH_TPV
var fe=ae.MAX_CAMERA_DISTANCE
var ve=ae.MIN_CAMERA_DISTANCE
var he=e("./client_entities")
var pe=he.adminWantsNoEntity
var me=he.clientEntitiesSendEntJoin
var Ee=he.clientEntityForUser
var ge=he.getEntityManager
var Te=he.getEntityPosManager
var ye=e("./controller_common")
var Se=ye.movementShared
var Ie=ye.rotationShared
var Ae=ye.updateFacing
var we=e("./controller_components/auto_crouch_comp").AutoCrouchComponent
var Le=e("./controller_components/debug_comp").DebugComponent
var Oe=e("./controller_components/feet_check_comp")
var Re=Oe.FeetCheckComponent
var be=Oe.makePropsOnOffset
var Ne=e("./controller_modes/fly_mode").FlyMode
var Ce=e("./controller_modes/freecam_mode").FreeCamMode
var xe=e("./controller_modes/ladderclimbing_mode").LadderClimbingMode
var Me=e("./controller_modes/mode_common")
var De=Me.FLY_ID
var Pe=Me.FLY_MULT_MAX_SPEED
var Be=Me.FREECAM_ID
var ke=Me.LADDERCLIMBING_ID
var Ue=Me.MAX_SPEED
var Ge=Me.SITTING_ID
var Fe=Me.SWIMMING_ID
var We=Me.WALK_ID
var He=Me.WALK_SHIFT_MULT_SPEED
var ze=Me.clampPhotoPosition
var Ve=Me.getFloorPos
var Ye=e("./controller_modes/sitting_mode").SittingMode
var je=e("./controller_modes/swimming_mode").SwimmingMode
var Ke=e("./controller_modes/walk_mode").WalkMode
var qe=e("./debug").debugAddText
var Ze=e("./huds").showStaminaDamage
var Xe=e("./localization/localization").L
var Qe=e("./main")
var $e=e("./menu").menuActive
var Je=e("./photo_mode")
var et=Je.getPhotoStartPosition
var tt=Je.photoModeActive
var rt=Je.photoModeCancel
var at=e("./proc_gen_biomes").getElevationEstimate
var it=e("./proc_gen_constants").SNOW_ELEVATION
var ot=e("./props")
var nt=ot.PREVIEW_HELD
var st=ot.getForPreview
var lt=e("./quickbar").getSelectedVisible
var _t=e("./race_ui").raceReady
var ct=e("./settlement")
var ut=ct.settlementCurrent
var dt=ct.settlementLastBound
var ft=e("./sky").skyGetTimeOfDay
var vt=e("./state_machine").StateMachine
var ht=e("./status").statusGet
var pt=e("./ui_util").STAMINA_SYMBOL
var mt=e("./user_data")
var Et=mt.doFallDamage
var gt=mt.doWaygateSickness
var Tt=mt.flyingAllowed
var yt=mt.followUserAllowed
var St=mt.isPlayAsViewer
var It=mt.staminaUsageScale
var At=mt.userAttribGetSprintingStaminaScale
var wt=mt.userDataGet
var Lt=mt.userDataSet
var Ot=mt.userHomeSettlementID
var Rt=mt.userO2Cur
var bt=mt.userO2Max
var Nt=mt.userStaminaCur
var Ct=mt.userStaminaMod
var xt=e("./user_party")
var Mt=xt.partyGetParticipants
var Dt=xt.partyIsActive
var Pt=e("./voxel_const").origin_chunk
var Bt=e("./voxel_data")
var kt=e("./voxel_data")
var Ut=kt.getPropLighting
var Gt=kt.getTileLocal
var Ft=kt.localPosFromWorldPos
var Wt=kt.worldPosFromLocalPos
var Ht=e("./world_comm")
var zt=e("./world_metadata")
var Vt=zt.adventureMode
var Yt=zt.worldMetadataFreePos
var jt=zt.worldMetadataWaygate
var Kt=e("./worlds_sound").playSound
var qt=e("./worlds_soundscape")
var Zt=qt.SoundScapeInstantMod
var Xt=qt.SoundScapePeriodicMod
var Qt=qt.SoundScapeTag
var $t=qt.addSSPeriodicModState
var Jt=qt.setSSInstantModState
var er=qt.soundscapeSetTag
var tr=e("../glov/client/settings.js")
var rr=e("./tiles.js"),ar=rr.TILE_PROP_BASE,ir=rr.TILE_PROP_MAX,or=rr.TILE_WATER,nr=rr.TILE_WATER_FLOW
var sr=Math.abs,lr=Math.ceil,_r=Math.cos,cr=Math.floor,ur=Math.min,dr=Math.random,fr=Math.round,vr=Math.sin,hr=Math.sqrt,pr=Math.PI
var mr=.001
var Er=.5
var gr=1.3
var Tr=[T(0,0),T(0,.4),T(0,-.4),T(1,.4),T(1,-.4)]
var yr=y()
var Sr=y()
var Ir=y()
var Ar=1e-4
var wr=.05
var Lr=y()
var Or=2500
var Rr=y()
var br=y()
var Nr=T()
var Cr=y()
var xr=y()
var Mr={}
function updateOnGround(e){var t=e.pos[2]-e.eye_height
var r=Ve(e,e.pos)
e.on_ground=false
if(t-r<.05)e.on_ground=true}var Dr=.005*w
r.CC_BASE_SPEED=Dr
var Pr=2
r.CC_SPRINT_FACTOR=Pr
var Br=2
r.CC_FLY_FACTOR=Br
var kr=.4
var Ur=.6
var Gr=.5
var Fr=.6
var Wr=.02
var Hr=.04
var zr=1500
var Vr=.05
var Yr=15e3
function fallingDamageFromDeltaVelocity(e){if(!Et())return 0
var t=0
if(e<Wr)t=0
else if(e<Hr)t=k(U(e,Wr,Hr),0,zr)
else t=k(U(e,Hr,Vr),zr,Yr)
if(t<500)return 0
return fr(t*It())}var jr=Ue*He
var Kr=Ue*He*Pe
var qr=40
var Zr=20
function checkHasStaminaToRun(e){if(e.sprinting&&Nt()<=0){ht("sprint_no_stamina").setMessage(Xe.$(Xe.STATUSMSG_CANNOT_SPRINT,pt),1e3)
ht("no_stamina_hint").setMessage(Xe.STATUSMSG_CONSUME_OR_RETURN,1e3).noBounce()
e.sprinting=0}}function checkPosUnderwater(e,t){h(e,t)
var r=Gt(e,0,true)
return r===or||r===nr}function dirToLookAngle(e){return Math.atan2(e[1],e[0])-pr/2}var Xr=y()
var Qr=""
var $r=0
var Jr=1e3
var ea="0,0,100,0,0"
var ta
B.register({key:"pos",clear_on_route_change:true,change:function change(e){if(ta)ta.updatePosFromString(e,true)}})
a("pos",function(){if(!ta||!Qe.omp)return""
return"w/"+Ht.world_id+"?pos="+ta.getPosString()})
function sitHandler(e,t,r){var a=r.new_look_angle
if(e.csm.getState()!==Ge)e.csm.transit(t,Ge)
if(void 0!==a&&!isNaN(a))e.head_angle[0]=a
e.head_angle[1]=0
e.look_angle=e.head_angle[0]
if(!tr.camera_view&&!e.fpv_when_done){e.fpv_when_done=true
tr.camera_view=1}}function setModeToWalkHandler(e,t){e.csm.transit(t,We)}function setModeToFreeCamHandler(e,t){e.csm.transit(t,Be)}function useToolHandler(e,t,r){var a=r.look_angle,i=r.anim
if(e.csm.getState()===Ge)e.csm.transit(t,We)
if(null!==a&&e.csm.getState()!==ke)e.look_angle=a
e.anim=i
e.anim_in_grace_time=true
e.animation_grace_time=0}function waveHandler(e,t){if(e.csm.getState()===Ge)e.csm.transit(t,We)
e.anim=R.WAVE
e.anim_in_grace_time=true
e.animation_grace_time=0
if(!tr.camera_view){e.zoomed_out_tpv=true
e.camera_distance=2.1
e.zoom_timer=0}}var ra=y()
var aa=T()
function parsePosString(e){var t=e.split(",")
var r={pos:null,yp:null,flying:null}
if(t.length>=3){r.pos=ra
for(var a=0;a<ur(t.length,3);++a){ra[a]=s(t[a])
if(!isFinite(ra[a]))r.pos=null}}if(t.length>=5){r.yp=aa
for(var i=3;i<ur(t.length,5);++i){aa[i-3]=s(t[i])
if(!isFinite(aa[i-3]))r.yp=null}}if(t.length>=6)if(t[5].includes("f"))r.flying=true
else r.flying=false
return r}var ia=1e3
var oa=300
var na=function(n){_inheritsLoose(CharacterController,n)
function CharacterController(){var e
var t;(t=n.call(this,oe[se],Dr)||this).csm=void 0
t.auto_crouch_comp=void 0
t.feet_check_comp=void 0
t.debug_comp=void 0
t.center_pos=y()
t.feet_pos=y()
t.root_pos=y()
t.on_ground=false
t.sizes=void 0
t.center_pos_offset=void 0
t.feet_pos_offset=void 0
t.camera_pos=y()
t.camera_distance=tr.camera_max_distance
t.camera_height_scale=gr
t.camera_dir=y()
t.dummy_camera_pos=y()
t.is_tpv=false
t.zoomed_in_fpv=false
t.zoomed_out_tpv=false
t.zoom_timer=0
t.camera_translation=void 0
t.sprint_speed_factor=Pr
t.crouch_speed_factor=kr
t.underwater_speed_factor=Ur
t.underwater_exhausted_speed_factor=Gr
t.fly_speed_factor=Br
t.ladder_speed_factor=Fr
t.speed_modifiers={}
t.jump_time=0
t.jump_ok=true
t.jumping_off=void 0
t.flying=false
t.can_doublejump_to_fly=true
t.jump_last_tap_time=0
t.jump_last_tap_frame=0
t.stamina_sprint_time_accum=0
t.stamina_swim_time_accum=0
t.fall_damage_shield=void 0
t.underwater={head:false,body:false,feet:false}
t.not_underwater_timer=Infinity
t.ladder_cooldown=0
t.dropped_from_ladder=void 0
t.ladder=void 0
t.fpv_when_done=void 0
t.props_collided={}
t.last_tick_props_collided={}
t.anim=R.IDLE
t.anim_secondary=R.IDLE
t.anim_in_grace_time=false
t.animation_grace_time=0
t.head_angle=T(0,0)
t.look_angle=100
t.lighting_values={force_opaque:true,scale_lights:true,torch_factor:0,sun_factor:1,torch_target:0,sun_target:1}
t.net_pos=new Float64Array(6)
t.follow_user_on_update=void 0
t.follow_user_on_load=void 0
t.just_jumped=void 0
t.just_landed=void 0
t.just_toggled_flying=false
t.just_stepped_into_water=void 0
t.damage=void 0
t.stun_timer=void 0
t.invulnerability_timer=void 0
t.external_forces=[]
var r=se
var a=ne
t.sizes=oe
t.csm=new vt(_assertThisInitialized(t),[Ne,Ce,Ye,je,Ke,xe],D.defines.FREECAM&&D.DEBUG?Be:We)
t.center_pos_offset=t.sizes[r].center_pos_offset
t.feet_pos_offset=t.sizes[r].feet_pos_offset
var i="fly"
var o=be(t.sizes[r])
t.feet_check_comp=new Re(_assertThisInitialized(t),((e={})[r]=o,e[a]=be(t.sizes[a]),e[i]=o.concat(o.map(function(e){return v(y(),e,S)})),e),r)
t.auto_crouch_comp=new we(_assertThisInitialized(t),[We,Ge,Fe],[We,Fe],a,r)
t.csm.addObserver(t.auto_crouch_comp)
t.debug_comp=new Le(_assertThisInitialized(t))
t.updatePosFromString(null,false)
ta=_assertThisInitialized(t)
return t}var e=CharacterController.prototype
e.setPosBase=function setPosBase(e){if(tt())ze(e,et())
n.prototype.setPos.call(this,e)
this.updateSecondaryPos()
this.updatePropsOn()}
e.setPos=function setPos(e){this.setPosBase(e)
if(this.shouldUpdateOnGround())updateOnGround(this)}
e.shouldUpdateOnGround=function shouldUpdateOnGround(){switch(this.csm.getState()){case ke:return!this.dropped_from_ladder
case Fe:case We:return true
default:return false}}
e.updateSecondaryPos=function updateSecondaryPos(){v(this.center_pos,this.pos,this.center_pos_offset)
v(this.feet_pos,this.pos,this.feet_pos_offset)}
e.updatePosFromString=function updatePosFromString(e,t){if(e&&(!t||Yt())){var r=parsePosString(e)
if(null!==r.pos){Ft(br,r.pos)
if(!t){br[0]+=.004*dr()-.002
br[1]+=.004*dr()-.002
br[2]+=.004*dr()-.002}rt()
this.setPos(br)}else Qe.chat_ui.addChatError(Xe.$(Xe.CHATERROR_INVALID_POS_STRING,e))
if(null!==r.yp){f(Nr,r.yp,Z)
this.updateYawPitch(Nr)}if(null!==r.flying)if(r.flying&&Tt())this.flying=true
else this.flying=false
this.updateCameraPos()}var a=_r(-this.ypr[1])
this.facing[0]=vr(this.ypr[0])*a
this.facing[1]=_r(this.ypr[0])*a
this.facing[2]=vr(-this.ypr[1])
this.head_angle[0]=-this.ypr[0]
this.head_angle[1]=-this.ypr[1]
this.look_angle=this.head_angle[0]
if(te()===this)re()
b()}
e.getRootPos=function getRootPos(){G(this.root_pos,this.feet_pos,S,mr)
return this.root_pos}
e.shift=function shift(e){n.prototype.shift.call(this,e)
p(this.camera_pos,e)
this.updateSecondaryPos()}
e.toggleSize=function toggleSize(e){var t=this.sizes[e],r=t.center_pos_offset,a=t.feet_pos_offset
var i=this.eye_height
this.updateSize(this.sizes[e])
this.center_pos_offset=r
this.feet_pos_offset=a
var o=y()
G(o,this.pos,S,this.eye_height-i)
this.setPosAndSmoothCam(true,o)
this.setPropsOnOffset(e)}
e.getClearanceHeight=function getClearanceHeight(){var e=this.sizes.small
return e.eye_height+e.col_bounds.max[2]}
e.updateCameraTranslation=function updateCameraTranslation(e,t){var r=t.pos,a=t.speed
F(this.camera_pos,e)
V(this.camera_pos,this.camera_pos,r)
g(this.camera_pos,a,this.camera_pos,e)
V(r,e,this.camera_pos)
if(z(r)<Ar)this.camera_translation=null}
e.updateCameraPos=function updateCameraPos(){if(!this.zoomed_in_fpv&&(this.zoomed_out_tpv||tr.camera_view)){this.is_tpv=true
G(Lr,this.pos,this.facing,-this.camera_distance)
G(Lr,Lr,this.char_up,this.camera_height_scale)}else{this.is_tpv=false
F(Lr,this.pos)}if(this.camera_translation)this.updateCameraTranslation(Lr,this.camera_translation)
else F(this.camera_pos,Lr)}
e.resetCameraDistanceForZoomOut=function resetCameraDistanceForZoomOut(){this.camera_distance=ie}
e.setPosAndSmoothCam=function setPosAndSmoothCam(e,t,r){if(e)if(this.camera_translation){p(this.camera_translation.pos,t)
m(this.camera_translation.pos,this.pos)
this.camera_translation.speed=r||wr}else{this.camera_translation={pos:y(),speed:r||wr}
V(this.camera_translation.pos,t,this.pos)}this.setPosBase(t)}
e.updateAndGetCameraPos=function updateAndGetCameraPos(){this.updateCameraPos()
return this.getCameraPos()}
e.isAerial=function isAerial(){var e=this.csm.getState()
return e===Fe||e===De||e===Be}
e.getNetAnimState=function getNetAnimState(){var e=lt()
M(e)
M(e.type)
return{anim:this.anim,anim_secondary:this.anim_secondary,held_item:e}}
e.update=function update(e){profilerStart("input")
if(this.follow_user_on_update){this.updatePosAndLookAtVisibleUser(this.follow_user_on_update,yt())
this.follow_user_on_update=null
B.set("u","")
B.set("action","")}if(P())e=false
var t=Q()
var r=lt()
var a=!ge().checkNet()
if(!a)e=false
if(e&&this.flying&&!Tt())this.flying=false
var i=ur(D.frame_dt,K)
this.animation_grace_time+=i
if(this.animation_grace_time>500&&this.anim_in_grace_time)this.anim_in_grace_time=false
if(this.csm.getState()!==ke&&this.ladder_cooldown>0)this.ladder_cooldown-=i
F(Rr,this.vel)
var o=Se(this,i,e)
if(_t())F(o,Y)
if(t)checkHasStaminaToRun(o)
if(this.stun_timer&&o){this.stun_timer-=i
F(o,Y)
delete o.sprinting
if(this.stun_timer<=0)delete this.stun_timer}var n=-1
var s=.5
this.underwater.head=checkPosUnderwater(xr,this.pos)
F(br,this.pos)
br[2]+=n*(this.getCrouched()?le:1)
this.underwater.body=checkPosUnderwater(xr,br)
if(this.underwater.body)this.not_underwater_timer=0
else this.not_underwater_timer+=i
var l=this.underwater.feet
F(br,this.feet_pos)
br[2]+=s
this.underwater.feet=checkPosUnderwater(xr,br)
this.just_stepped_into_water=!l&&this.underwater.feet
if(e)Ie(this,i)
Ae(this)
for(var _ in this.last_tick_props_collided)if(!this.last_tick_props_collided[_].existsInWorld())delete this.last_tick_props_collided[_]
var c=0
var u={frame_time_sprinting:0,frame_time_swimming:0}
if(i>0){profilerStopStart("tick")
var d=i
while(d>0){var f=ur(d,j)
if(this.invulnerability_timer){this.invulnerability_timer-=f
if(this.invulnerability_timer<=0)delete this.invulnerability_timer}for(var v in this.last_tick_props_collided)if(this.last_tick_props_collided[v].areaInteract)this.last_tick_props_collided[v].areaInteract()
var h=void 0
h=this.csm.tick({dt:f,impulse:o,do_stamina:t})||Mr
u.frame_time_sprinting+=h.frame_time_sprinting||0
u.frame_time_swimming+=h.frame_time_swimming||0
d-=f
for(var p in this.props_collided)if(this.props_collided[p].collisionInteract){var m=!this.last_tick_props_collided[p]
this.props_collided[p].collisionInteract(m,d)}this.last_tick_props_collided=this.props_collided
if(!this.invulnerability_timer&&this.damage){this.invulnerability_timer=this.damage.invulnerability_time
this.stun_timer=this.damage.stun_time
var E=t?this.damage.amount:0
c+=E
Ze(E,this.damage.message)
Kt(this.damage.sound)
if(this.damage.knockback_absolute)F(this.vel,Y)
if(this.damage.knockback_vel)this.external_forces.push(this.damage.knockback_vel)
delete this.damage}this.props_collided={}
this.speed_modifiers={}}}profilerStopStart("bottom")
if(D.defines.CAMERA&&te()===this)this.setDebugFloorInfo()
if(t){this.stamina_sprint_time_accum+=u.frame_time_sprinting
var g=qr/At()
if(this.stamina_sprint_time_accum>=g){var T=cr(this.stamina_sprint_time_accum/g)
this.stamina_sprint_time_accum-=T*g
c+=T}this.stamina_swim_time_accum+=u.frame_time_swimming
g=Zr/It()
if(this.stamina_swim_time_accum>=g){var y=cr(this.stamina_swim_time_accum/g)
this.stamina_swim_time_accum-=y*g
c+=y}if(this.getCrouched())c*=2
var S
if(this.fall_damage_shield){this.fall_damage_shield-=i
if(this.fall_damage_shield<=0){this.fall_damage_shield=0
ht("fall_damage_shield").fade(2)}else{var I=lr(this.fall_damage_shield/1e3)
ht("fall_damage_shield").setMessage(Xe.STATUSMSG_FALL_DAMAGE_SHIELD.$({val:I}))}}else if(!(this.csm.getState()===De)){for(var A=0;A<3;++A)if(Rr[A]>0&&this.vel[A]<Rr[A])Cr[A]=ur(Rr[A],Rr[A]-this.vel[A])
else if(Rr[A]<0&&this.vel[A]>Rr[A])Cr[A]=ur(-Rr[A],-(Rr[A]-this.vel[A]))
else Cr[A]=0
if(S=fallingDamageFromDeltaVelocity(hr(z(Cr)))){c+=S
Ze(S,"fall damage")}}if(c)Ct(null,-c)
if(S)Kt("fall_damage")}this.updateHeldTorchFactor()
Ut(this.lighting_values,this.pos,true)
if(D.defines.CAMERA&&te()===this)this.addControllerDebugText()
M(r)
M(r.type)
if(a)Te().updateMyPos(this.getNetPos(),this.getNetAnimState())
this.updateHistoryFromPos()
var w=0
var L=0
G(this.dummy_camera_pos,this.pos,this.facing,-tr.camera_max_distance)
G(this.dummy_camera_pos,this.dummy_camera_pos,this.char_up,gr)
V(this.camera_dir,this.dummy_camera_pos,this.pos)
H(this.camera_dir)
for(var O=0;O<5;O++){var R=Tr[O]
G(xr,this.pos,this.char_right,R[0]*R[1])
G(xr,xr,this.char_up,(1-R[0])*R[1])
if(Bt.raycast3DLocal(yr,Sr,Ir,xr,this.camera_dir,tr.camera_max_distance,null,null,true)){w++
L+=W(xr,Ir)}}while(i>0){var b=ur(i,8)
var N=.005*b
this.zoom_timer+=b
var C=void 0
if(this.zoomed_out_tpv){C=U(this.zoom_timer,0,2500)
C=vr(C*pr)}if(w){var x=hr(L/w)-.5
if(x<this.camera_distance)N=.05*b
if(this.zoomed_out_tpv&&x<4){this.camera_distance=0
this.zoomed_out_tpv=false
this.zoom_timer=0}if(this.zoomed_out_tpv)this.camera_distance=k(C,2,x)
else this.camera_distance=k(N,this.camera_distance,x)}else if(this.zoomed_out_tpv)this.camera_distance=k(C,2,fe/1.8)
else if(sr(this.camera_distance-tr.camera_max_distance)>.03)this.camera_distance=k(N,this.camera_distance,tr.camera_max_distance)
this.camera_height_scale=k(U(this.camera_distance,ve,fe),Er,gr)
i-=8}if(this.camera_distance<2)this.zoomed_in_fpv=true
else if(this.zoomed_in_fpv&&this.camera_distance>ie){this.camera_distance=2
this.zoomed_in_fpv=false}if(this.camera_distance<2&&this.zoomed_out_tpv){this.zoomed_out_tpv=false
this.zoom_timer=0}this.handleCharacterSound()
profilerStop()}
e.forceUpdatePos=function forceUpdatePos(){if(!ge().checkNet()){Te().updateMyPos(this.getNetPos(),this.getNetAnimState(),true)
return true}return false}
e.setSpeedModifier=function setSpeedModifier(e,t){this.speed_modifiers[e]=t}
e.getSpeedModifier=function getSpeedModifier(e){return this.speed_modifiers[e]}
e.setFallDamageShield=function setFallDamageShield(e){if(Q())this.fall_damage_shield=1e3*e}
e.sitOnBlock=function sitOnBlock(){h(Xr,this.pos)
Xr[2]-=Math.ceil(this.controller_height)
var e=this.getCardinalFacing()
c(Xr,Xr,e)
var t=Gt(Xr,0,false)
if(!this.on_ground||this.csm.getState()===ke)Qe.chat_ui.addChat(Xe.MSG_NOWHERE_TO_SIT)
else if(this.csm.getState()===Ge)Qe.chat_ui.addChat(Xe.MSG_ALREADY_SAT_DOWN)
else if(t)this.sit()
else this.sit(dirToLookAngle(e))}
e.sitOnChair=function sitOnChair(e,t){e[2]+=this.eye_height
this.setPosAndSmoothCam(this.is_tpv,e)
this.sit(t)}
e.sit=function sit(e){this.csm.addHandlingCB(sitHandler,{new_look_angle:e})}
e.setModeToWalk=function setModeToWalk(){this.csm.addHandlingCB(setModeToWalkHandler)}
e.setModeToFreeCam=function setModeToFreeCam(){this.csm.addHandlingCB(setModeToFreeCamHandler)}
e.useTool=function useTool(e,t){this.csm.addHandlingCB(useToolHandler,{look_angle:e,anim:t})}
e.wave=function wave(){this.csm.addHandlingCB(waveHandler)}
e.load=function load(e){var t=wt("pos")||e||ea
var r=yt()
if(!r)this.updatePosFromString(t,false)
var a=this.follow_user_on_load&&this.updatePosAndLookAtVisibleUser(this.follow_user_on_load,r)
if(!this.follow_user_on_load&&Dt()){var i=Mt()
for(var o=0;o<i.length;o++){var n=i[o]
if(this.updatePosAndLookAtVisibleUser(n.user_id,r)){this.follow_user_on_load=n.user_id
a=true
break}}}this.follow_user_on_update=this.follow_user_on_load
this.follow_user_on_load=null
if(r&&!a)this.updatePosFromString(t,false)
var s=Array.prototype.slice.call(this.getNetPos(),0)
M(6===s.length)
var l={pos:s}
if(pe())l.want_no_ent=true
me(l)}
e.enterWorldInit=function enterWorldInit(){F(this.vel,Y)}
e.setFollowUserOnLoad=function setFollowUserOnLoad(e){this.follow_user_on_load=e}
e.followOrLookAtVisibleUser=function followOrLookAtVisibleUser(e){var t=yt()
if(this.updatePosAndLookAtVisibleUser(e,t)){if(t)this.follow_user_on_update=e
return true}return false}
e.updatePosAndLookAtVisibleUser=function updatePosAndLookAtVisibleUser(e,t){if(e===_().loggedIn())return false
var r=Ee(e)
if(!r)return false
var a=r.data.pos
if(t){var i=a[3]
var o=(tr.camera_view?de:ue)*Z
var n=a[0]-vr(i)*ce
var s=a[1]-_r(i)*ce
var l=a[2]+_e
this.updatePosFromString(n+","+s+","+l+","+i*q+","+o*q,true)}else{Ft(br,a)
br[2]+=_e
V(br,br,this.pos)
Nr[0]=Math.atan2(br[0],br[1])
Nr[1]=-Math.atan2(br[2],d(br))
this.updateYawPitch(Nr)}return true}
e.getNetPos=function getNetPos(){var e=Pt
var t=this.pos
var r=this.net_pos
r[0]=t[0]+e[0]*A
r[1]=t[1]+e[1]*A
r[2]=t[2]-this.eye_height+e[2]*A
r[3]=-this.head_angle[0]
r[4]=-this.head_angle[1]
r[5]=this.look_angle
if(r[4]>-.1&&r[4]<.2)r[4]=0
return r}
e.updateHistoryFromPos=function updateHistoryFromPos(){var e=this.getPosString()
if(o())return
if(St()&&Vt())return
if($e())return
if(e!==Qr&&D.frame_timestamp-$r>Jr){$r=D.frame_timestamp
Lt("pos",Qr=e)
if(gt()){Lt("pos_adv",1)
Lt("last_adv_pos",e)}else{var t=wt("last_adv_pos")
var r=0
if(t){var a=parsePosString(t)
if(null!==a.pos){Ft(br,a.pos)
if(W(br,this.pos)<Or)r=1}}Lt("pos_adv",r)}Lt("wg",B.get("wg"))
B.setMulti({w:Qe.omp?Ht.world_id:"",pos:Yt()&&tr.live_url?e:""})}}
e.clearPos=function clearPos(){$r=D.frame_timestamp
Qr=""
B.set("pos","")}
e.updateHeldTorchFactor=function updateHeldTorchFactor(){var e=lt()
if(!e)return
if(e.type===L&&(e.need_thumbnail_update||e.thumbnail_updated)){var t=st(e,nt)
if(t&&t.baked&&t.baked.key){var r=N(t.baked.key)
if(r)this.lighting_values.torch_factor=r}}}
e.applyExternalForces=function applyExternalForces(){if(this.external_forces.length>0){for(var e=0;e<this.external_forces.length;++e)v(this.vel,this.vel,this.external_forces[e])
this.external_forces.length=0}}
e.handleSoundscapeTags=function handleSoundscapeTags(e){var t=ft()
Wt(br,this.pos)
var r=at(br)
G(br,this.pos,Pt,A)
er(Qt.Home,Boolean(ut()),e)
er(Qt.Night,t<5||t>22,e)
er(Qt.Underground,br[2]<r-15,e)
er(Qt.Snow,br[2]>it+5,e)
er(Qt.Underwater,this.underwater.head,e)}
e.handleCharacterSound=function handleCharacterSound(){if(this.just_jumped){this.just_jumped=false
Kt("jump")}if(this.just_landed){this.just_landed=false
h(br,this.pos)
br[2]-=Math.ceil(this.controller_height)
var e=Bt.getTileLocal(br,0,false)
if(e>=ar&&e<=ir){var t=Bt.andGetProp()
$("land",null==t?void 0:t.getMaterial())}else $("land",J(e))}if(this.just_toggled_flying){this.just_toggled_flying=false
Kt(this.flying?"character_enter_flying":"character_exit_flying")}if(this.just_stepped_into_water){this.just_stepped_into_water=false
Kt("character_enter_water")}$t(Xt.O2Attribute,1-Rt()/bt())
var r=dt()
var a
if(r)a=r.world_pos
else if(r=jt(Ot())){a=y()
O(a,r.pos[0],r.pos[1])}if(r){Wt(br,this.pos)
Jt(Zt.DistHorizontal,u(br,a)/ia)
Jt(Zt.DistVertical,sr(a[2]-br[2])/oa)}if(this.flying){Jt(Zt.IsFlying,1)
$t(Xt.VelFly,E(this.vel)/Kr)
$t(Xt.VelHorizontal,0)
$t(Xt.VelVertical,0)}else{Jt(Zt.IsFlying,0)
$t(Xt.VelFly,0)
$t(Xt.VelHorizontal,d(this.vel)/jr)
$t(Xt.VelVertical,sr(this.vel[2])/Vr)}this.handleSoundscapeTags()}
e.getPropsOn=function getPropsOn(){return this.feet_check_comp.getPropsOn()}
e.setPropsOnOffset=function setPropsOnOffset(e){return this.feet_check_comp.setPropsOnOffset(e)}
e.updatePropsOn=function updatePropsOn(){return this.feet_check_comp.updatePropsOn()}
e.getCrouched=function getCrouched(){return this.auto_crouch_comp.getCrouched()}
e.getCanCrouch=function getCanCrouch(){return this.auto_crouch_comp.getCanCrouch()}
e.getCanUncrouch=function getCanUncrouch(){return this.auto_crouch_comp.getCanUncrouch()}
e.getCrouchEyeHeightOffset=function getCrouchEyeHeightOffset(){return this.auto_crouch_comp.getCrouchEyeHeightOffset()}
e.getCrouchColBounds=function getCrouchColBounds(){return this.auto_crouch_comp.getCrouchColBounds()}
e.getUncrouchColBounds=function getUncrouchColBounds(){return this.auto_crouch_comp.getUncrouchColBounds()}
e.crouch=function crouch(){return this.auto_crouch_comp.crouch()}
e.uncrouch=function uncrouch(){return this.auto_crouch_comp.uncrouch()}
e.addControllerDebugText=function addControllerDebugText(){this.debug_comp.addControllerDebugText()
var e=[]
var t=[]
if(this.on_ground)e.push("On Ground")
if(this.lighting_values)e.push("Torch: "+this.lighting_values.torch_factor.toFixed(3)+"  Sun: "+this.lighting_values.sun_factor.toFixed(3))
var r=this.underwater
for(var a in r)if(r[a])t.push(a+"_underwater")
if(t.length)e.push(t.join(" "))
qe(e.join("\n"))}
e.setDebugFloorInfo=function setDebugFloorInfo(){return this.debug_comp.setDebugFloorInfo()}
return CharacterController}(x)
r.CharacterController=na},{"../common/globals":248,"../common/ids":249,"../common/world_trans":268,"../glov/client/engine":305,"../glov/client/error_report":311,"../glov/client/net":338,"../glov/client/settings.js":351,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/util":400,"../glov/common/vmath":402,"./animation_enum":9,"./auto_activate_ui":15,"./baking":19,"./base_controller":20,"./build_mode":33,"./camera":35,"./character_controller_constants":38,"./client_entities":44,"./controller_common":49,"./controller_components/auto_crouch_comp":50,"./controller_components/debug_comp":52,"./controller_components/feet_check_comp":53,"./controller_modes/fly_mode":55,"./controller_modes/freecam_mode":56,"./controller_modes/ladderclimbing_mode":57,"./controller_modes/mode_common":58,"./controller_modes/sitting_mode":60,"./controller_modes/swimming_mode":61,"./controller_modes/walk_mode":62,"./debug":73,"./huds":104,"./localization/localization":131,"./main":135,"./menu":140,"./photo_mode":158,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./props":171,"./quickbar":172,"./race_ui":174,"./settlement":181,"./sky":188,"./state_machine":192,"./status":193,"./tiles.js":199,"./ui_util":205,"./user_data":208,"./user_party":211,"./voxel_const":215,"./voxel_data":216,"./world_comm":226,"./world_metadata":235,"./worlds_sound":236,"./worlds_soundscape":237,assert:void 0}],38:[function(e,t,r){"use strict"
r.CHAR_SIZES=r.CHAR_SIZE_SMALL=r.CHAR_SIZE_TALL=r.CAMERA_FIRST_ZOOM_DIST=r.MIN_CAMERA_DISTANCE=r.MAX_CAMERA_DISTANCE=r.FOLLOW_PLAYER_PITCH_TPV=r.FOLLOW_PLAYER_PITCH_FPV=r.FOLLOW_PLAYER_DISTANCE=r.CROUCH_RATIO=r.PLAYER_COL_WIDTH=r.EYE_HEIGHT=void 0
var a
var i=e("../glov/common/vmath")
var o=i.v3copy
var n=i.v3scale
var s=i.vec3
var l=3
r.EYE_HEIGHT=l
var _=.75
r.PLAYER_COL_WIDTH=_
var c=1.5+.001
var u=3.75-l
var d=.75
r.CROUCH_RATIO=d
var f=s(0,0,-l+1.75)
var v=s(0,0,-l)
var h=10
r.FOLLOW_PLAYER_DISTANCE=h
var p=5
r.FOLLOW_PLAYER_PITCH_FPV=p
var m=20
r.FOLLOW_PLAYER_PITCH_TPV=m
var E=12
r.MAX_CAMERA_DISTANCE=E
var g=4
var T=(r.MIN_CAMERA_DISTANCE=g)-1
r.CAMERA_FIRST_ZOOM_DIST=T
var y="tall"
r.CHAR_SIZE_TALL=y
var S="small"
r.CHAR_SIZE_SMALL=S
var I=((a={})[y]={col_bounds:{min:s(-_,-_,-l+c),max:s(_,_,u)},eye_height:l,center_pos_offset:o(s(),f),feet_pos_offset:o(s(),v)},a[S]={col_bounds:{min:s(-_,-_,-l*d+c),max:s(_,_,u*d)},eye_height:l*d,center_pos_offset:n(s(),f,d),feet_pos_offset:n(s(),v,d)},a)
r.CHAR_SIZES=I},{"../glov/common/vmath":402}],39:[function(e,t,r){"use strict"
r.customizationPendingChanges=customizationPendingChanges
r.characterCustomizationOnMyChannelData=characterCustomizationOnMyChannelData
r.characterCustomizationMenuStartup=characterCustomizationMenuStartup
r.characterCustomizationMenuInit=characterCustomizationMenuInit
r.saveCostume=saveCostume
r.renamePrompt=renamePrompt
r.partPairedPart=partPairedPart
r.costumeSetOnPurchase=costumeSetOnPurchase
r.handleBottomButton=handleBottomButton
r.doCharacterCustomization=doCharacterCustomization
r.clock_animation=r.clock_sprite=void 0
var M=e("assert")
var T=e("../glov/client/camera2d")
var y=e("../glov/client/engine")
var S=e("../glov/client/input")
var a=e("../glov/client/input")
var i=a.inputTouchMode
var o=a.pointerLockEnter
var n=e("../glov/client/net")
var s=n.netDisconnected
var l=n.netSubs
var _=n.netUserId
var I=e("../glov/client/scroll_area").scrollAreaCreate
var c=e("../glov/client/sprite_animation").spriteAnimationCreate
var u=e("../glov/client/sprites").spriteCreate
var D=e("../glov/client/ui")
var d=e("../glov/client/ui")
var f=d.modalDialog
var v=d.modalTextEntry
var N=d.uiButtonHeight
var h=e("../glov/common/net_common")
var p=h.DISPLAY_NAME_MAX_LENGTH
var m=h.DISPLAY_NAME_MAX_VISUAL_SIZE
var E=e("../glov/common/util")
var g=E.clone
var A=E.cloneShallow
var C=E.dateToSafeLocaleString
var w=E.deepEqual
var L=E.msToTimeString
var O=e("../glov/common/vmath")
var P=O.unit_vec
var B=O.v3dot
var R=O.vec2
var b=e("../common/cosmetics_common")
var x=b.CosmeticRarities
var k=b.Parts
var U=b.isCostume
var G=b.isPart
var F=b.isSwap
var W=e("../common/entitlements")
var H=W.entitlementForCostume
var z=W.entitlementForPart
var V=e("./analytics")
var Y=V.getMenuContext
var j=V.logEvent
var K=e("./cosmetic_thumbnails").cosmeticGetImage
var q=e("./cosmetics")
var X=q.cosmeticDisplayName
var Q=q.cosmeticOwned
var $=q.cosmeticSwapsOwned
var J=q.costumeOwned
var ee=q.costume_dict
var te=q.getCosmeticsAvailability
var re=q.getCosmeticsOwnerships
var ae=q.getOwnedCostumesAmount
var ie=q.getRarityColors
var oe=q.getRarityLabel
var ne=q.getRarityStyle
var se=q.getSwapColors
var le=q.maybeTranslated
var _e=q.partChoiceKey
var ce=q.part_choice_dict
var ue=q.swaps_dict
var de=e("./costume_edit")
var fe=de.costumeCurrent
var ve=de.costumeSet
var he=de.incrementCurCostumeMod
var pe=e("./in_app_purchases/iap_client_worlds").iapProductPrice
var me=e("./layout")
var Ee=me.WIDE
var ge=me.layoutCameraTallWideMode
var Te=me.menuUpperLeft
var ye=e("./localization/localization")
var Se=ye.DURATION_ONLY_DAYS
var Ie=ye.L
var Ae=e("./main")
var we=e("./main")
var Le=we.mainActive
var Oe=we.menuExit
var Re=we.toggleMenuPage
var be=e("./main_menu").mainMenu
var Ne=e("./menu")
var Ce=e("./menu")
var xe=Ce.CHARACTER_CUSTOMIZATION
var Me=Ce.getMenuPage
var De=Ce.menuTabColors
var Pe=e("./paperdoll").doPaperDoll
var Be=e("./red_dot").redDotSeen
var ke=e("./show_first_offer")
var Ue=ke.FIRST_OFFER_PRODUCT_ID
var Ge=ke.showFirstOffer
var Fe=e("./store")
var We=Fe.gameCurrencyPurchase
var He=Fe.getProductIdGemCost
var ze=Fe.getProductIdOrbCost
var Ve=e("./styles")
var Ye=Ve.chat_style_error
var je=Ve.color_black
var Ke=Ve.color_black_30
var qe=Ve.color_transparent
var Ze=Ve.color_white_30
var Xe=Ve.color_white_50
var Qe=Ve.colors_disabled
var $e=Ve.colors_gems
var Je=Ve.colors_green
var et=Ve.colors_orbs_buy
var tt=Ve.flavour_text_style
var rt=Ve.menu_header_style
var at=Ve.menu_style
var it=Ve.white_label_style_shadow
var ot=e("./ui_util")
var nt=e("./ui_util_2")
var st=e("./world_comm")
var lt=st.getPerm
var _t=st.myUserCmdParse
var ct;(function(e){e[e["COSTUMES"]=0]="COSTUMES"
e[e["HEADS"]=1]="HEADS"
e[e["TORSOS"]=2]="TORSOS"
e[e["ARMS"]=3]="ARMS"
e[e["LEGS"]=4]="LEGS"
e[e["COLORS"]=5]="COLORS"})(ct=ct||{})
var ut=ct.COSTUMES
var dt=true
var ft;(function(e){e[e["SKIN"]=0]="SKIN"
e[e["HAIR"]=1]="HAIR"
e[e["EYES"]=2]="EYES"})(ft=ft||{})
function getSubmenuFromName(e){return"number"===typeof ft[e]?ft[e]:-1}var vt=false
var ht
var pt=[]
var mt=[]
var Et
var gt=[]
var Tt=[]
var yt=[]
var St=[]
var It=[]
var At=[[],[],[]]
var wt=[gt,Tt,yt,St,It]
var Lt
function shouldShowPromoInfo(e){return Boolean(e.promo_product_id&&pe(e.promo_product_id))}function showPromo(e){switch(e.promo_product_id){case Ue:Ge(true)
break
default:M(false)}}function customizationPendingChanges(){return vt}function resetItemLists(){vt=false
for(var e=0;e<wt.length;e++)wt[e].length=0
for(var t=0;t<At.length;t++)At[t].length=0}function orderItemsAlphabetically(e,t){var r=X(e)
var a=X(t)
if(!r)r=""
if(!a)a=""
return(r=r.toString().toLowerCase())>a.toString().toLowerCase()?1:-1}function orderItemsOwnership(e,t){return Number(Q(t))-Number(Q(e))}function orderItemsRarity(e,t){return x[t.rarity||"LEGENDARY"]-x[e.rarity||"LEGENDARY"]}function orderItemsRace(e,t){var r="COSMETIC_RACE_UNKNOWN"
if((G(e)||U(e))&&e.race_key)r=e.race_key
var a="COSMETIC_RACE_UNKNOWN"
if((G(t)||U(t))&&t.race_key)a=t.race_key
return r<a?-1:r>a?1:0}var Ot={ALPHABETIC:orderItemsAlphabetically,RACE:orderItemsRace,OWNERSHIP:orderItemsOwnership,RARITY:orderItemsRarity}
function filterItemsAvailable(e){return Q(e)||e.available}var Rt={AVAILABLE:filterItemsAvailable}
function orderItems(e){var t=[gt,Tt,yt,St,It,At[ft.SKIN],At[ft.HAIR],At[ft.EYES]]
var r=Ot[e]
for(var a=0;a<t.length;a++)t[a].sort(r)}function filterItems(e){var t=[gt,Tt,yt,St,It,At[ft.SKIN],At[ft.HAIR],At[ft.EYES]]
var r=Rt[e]
for(var a=0;a<t.length;a++){var i=t[a].filter(r)
for(var o=t[a].length=0;o<i.length;o++)t[a].push(i[o])}}var bt
var Nt=24
var Ct=1.5*Nt
var xt=1920
var Mt=810
var Dt=[]
var Pt
var Bt
var kt
var Ut
var Gt
var Ft
r.clock_sprite=Ft
var Wt
r.clock_animation=Wt
function getSprites(){Pt=ot.sprite
Bt=nt.sprite
kt=u({url:"img/ui/locked.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:R(.5,.5)})
Ut=u({url:"img/ui/round_alert.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:R(.5,.5)})
Gt=u({url:"img/ui/cosmetic_highlighted.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:R(.5,.5)})
r.clock_sprite=Ft=u({name:"clock",ws:[32,32,32,32,32,32,32,32],hs:[32],origin:R(.5,.5)})
r.clock_animation=Wt=c({rotate:{frames:[0,1,2,3,4,5,6,7],times:[500,125,125,125,125,125,125,125]}})
Wt.setState("rotate")
D.loadUISprite("cosmetic_selected",[40,48,40],[256])
D.loadUISprite("cosmetic_unselected",[40,48,40],[256])
D.loadUISprite("cosmetic_placeholder",[40,48,40],[256])}function firstOfferGetTimeLeftString(e){var t=e-Date.now()
if(t<=0)return""
else if(t<1728e5)return L(t,{hide_ms:true})
else{var r=Math.floor(.001*t)
return""+Ie.duration(r,Se)}}function getListFromBone(e){if("head"===e.bone)return Tt
else if("torso"===e.bone)return yt
else if("arm_r"===e.bone)return St
else if("leg_r"===e.bone)return It
return null}function getItemByName(e,t){var r
if(!t)return r
var a="string"===typeof t?t:_e(t)
for(var i=0;i<e.length;i++)if(e[i].name===a)return e[i]
return r}function getCosmetics(){for(var e in ee)if("preview"!==e&&"custom"!==e){var t=ee[e]
gt.push(t)}for(var r in ce){var a=ce[r]
var i=getListFromBone(a)
if(i)i.push(a)}for(var o in ue){var n=ue[o]
var s=getSubmenuFromName(n.type.toUpperCase())
if(-1!==s){n.rarity=n.is_default?x[0]:n.rarity||"LEGENDARY"
n.color_submenu=s
At[s].push(n)}}}function getCurrentSelectionFromCostume(e){pt[ct.COSTUMES]=getItemByName(gt,e.name)
pt[ct.HEADS]=getItemByName(Tt,e.parts[k.HEAD])
pt[ct.TORSOS]=getItemByName(yt,e.parts[k.TORSO])
pt[ct.ARMS]=getItemByName(St,e.parts[k.ARM_R])
pt[ct.LEGS]=getItemByName(It,e.parts[k.LEG_R])
var t=e.swaps||{}
mt[ft.SKIN]=getItemByName(At[ft.SKIN],t.skin)
mt[ft.HAIR]=getItemByName(At[ft.HAIR],t.hair)
mt[ft.EYES]=getItemByName(At[ft.EYES],t.eyes)}function cosmeticBestAvailableCostume(e){if(G(e)||F(e)&&!e.is_default)if(e.available_costumes){var t=null
for(var r=0;r<e.available_costumes.length;r++){var a=e.available_costumes[r]
var i=ee[a]
M(i)
if(!t||!t.rarity||i.rarity&&x[i.rarity]<x[t.rarity])t=i}if(t)return{costume:t,multiple:e.available_costumes.length>1}}return null}function costumeForCosmetic(e){if(G(e)||F(e)&&!e.is_default)if(e.costumes&&1===e.costumes.length)return{costume:ee[e.costumes[0]],multiple:false}
else{if(e.costumes){var t=null
for(var r=0;r<e.costumes.length;r++){var a=e.costumes[r]
if(J(a)){var i=ee[a]
M(i)
if(!t||!t.rarity||i.rarity&&x[i.rarity]<x[t.rarity])t=i}}if(t)return{costume:t,multiple:e.costumes.length>1}}return cosmeticBestAvailableCostume(e)}return null}function checkSaveEnabled(){var e=true
var t=ee.preview
vt=true
var r=t.parts
for(var a=0;a<r.length;a++){var i=r[a]
var o=_e(i)
var n=ce[o]
M(n)
if(!Q(n)){e=false
break}}if(t.swaps&&!$(t.swaps))e=false
if(dt=e)if(Lt&&w(Lt.parts,t.parts)&&w(Lt.swaps,t.swaps)){vt=false
if("custom"!==Lt.name)pt[ct.COSTUMES]=getItemByName(gt,Lt.name)}}function costumeClone(e){var t=A(e)
t.parts=g(t.parts)
t.swaps=g(t.swaps)
t.attachments=t.attachments.slice(0)
return t}var Ht=false
function getInitialPreview(){var e=fe()
var t=ee[e.name]
M(t)
var r=ee.preview=costumeClone(t)
if("custom"===r.name){for(var a=0;a<r.parts.length;a++){var i=r.parts[a]
var o=_e(i)
var n=ce[o]
M(n)
r.attachments[a]=n}r.is_custom=true}Lt={name:r.name,parts:g(r.parts),swaps:g(r.swaps)}
getCurrentSelectionFromCostume(r)
Et=pt[ct.COSTUMES]
checkSaveEnabled()
Ht=true}function characterCustomizationOnMyChannelData(e,t,r){if(Me()!==xe)return
if(!t||t.startsWith("public.permissions.owned"))characterCustomizationMenuInit(Boolean(t))
else if(t&&t.startsWith("public.costume"))getInitialPreview()}function characterCustomizationMenuStartup(){getSprites()
se()}function characterCustomizationMenuInit(e){resetItemLists()
re()
te()
getCosmetics()
if(y.defines.NEWART&&lt("sysadmin"));else filterItems("AVAILABLE")
orderItems("ALPHABETIC")
orderItems("RACE")
orderItems("RARITY")
orderItems("OWNERSHIP")
if(!e){ut=ct.COSTUMES
Ht=false}else[[ct.COSTUMES,gt],[ct.HEADS,Tt],[ct.TORSOS,yt],[ct.ARMS,St],[ct.LEGS,It]].forEach(function(e){var t=e[0],r=e[1]
var a=pt[t]
if(a){var i=pt[t]=getItemByName(r,a.name)
if(ut===t)Et=i}})
checkSaveEnabled()}function itemButton(e,t){var r=D.font
var a
if(U(t)&&!Q(t))a=H(t.name)
if(G(t)&&!Q(t))a=z(t.name)
if(a)e.hook=["c"+(G(t)?"p":"")+"."+t.name]
var i=D.button(e)
var o=e.bg_offset?e.bg_offset:0
var n=e.x+o
var s=e.y+o
var l=e.x+e.w-o
var _=e.y+e.h-o
var c=e.z
var u=e.x+.5*e.w
if(F(t))D.drawRect(n,s,l,_,c-2,t.color_vec)
else{var d=ie(t.rarity||"LEGENDARY")
var f=e.y+.5*e.h
D.drawRect4Color(n,s,l,_,c-2,d.bright_color,d.bright_color,d.base_color,d.base_color)
if("cosmetic_selected"===e.base_name){var v=.72*e.w
var h={x:u,y:f,z:c-2,w:v,h:v,color:Ze}
Gt.draw(h)}D.drawCircle(u,f,c-1,.25*e.w,0,Xe)}if(!e.owned){var p=kt
var m
var E=e.z+1
var g=.175*e.w
var T=e.x+.8*e.w
var y=e.y+.25*e.h
var S=.9
var I=Ke
if(U(t)&&(shouldShowPromoInfo(t)||!t.promo_product_id&&t.expire_date)){var A=t.expire_date
p=Ft
S=1
m=Wt.getFrame()
D.drawRect(n,s+.59*e.h,l,_,c-1,Ke)
var w=32
var L=(""+(shouldShowPromoInfo(t)?Ie.LBL_PROMO_AVAILABLE:Ie.LBL_LIMITED_TIME)).toUpperCase()
M(A)
var O=firstOfferGetTimeLeftString(A)
if(O){var R=.5*w
var b=w
var N=s+.61*e.h
D.font.drawSizedAligned(it,u,N,c+2,R,r.ALIGN.HCENTER,0,0,L)
r.drawSizedAligned(it,u,N+=R,c+2,b,r.ALIGN.HCENTER,0,0,O)}else{var C=false
t.promo_product_id=void 0
characterCustomizationMenuInit(C)}}else if(F(t)){g=.5*e.w
T=e.x+.5*e.w
y=e.y+.5*e.h
if(B(t.color_vec,P)<1)I=Ze}var x={x:T,y:y,w:g*S,h:g,z:E,color:I,frame:m}
p.draw(x)}return i}function tabButton(e,t,r,a,i,o,n,s){var l=false
if(a===ct.COLORS)for(var _=0;_<mt.length;_++){var c=mt[_]
if(c&&!Q(c)){l=true
break}}else{var u=pt[a]
if(u&&!Q(u))l=true}if(l)s=void 0
var d=ut===a
if(D.buttonImage({x:e,y:t,z:d?r+1:r-1,z_bias:d?void 0:{down:1},img:i,frame:o,colors:De(d),disabled:false,base_name:d?"tab":"tab_inactive",tooltip:n,hook:s})){if((ut=a)===ct.COLORS)Et=mt[0]
else Et=pt[a]
for(var f=0;f<Dt.length;f++)if(Dt[f])Dt[f].resetScroll()}if(l){var v=N()
var h=.75*v
var p={x:e+v-24,y:t+24,w:h,h:h,z:r+2}
Ut.draw(p)}}function saveCostume(e){var t=ee.preview
M(t)
var r=t.name
var a
if(t.is_custom){r="custom"
ee.custom=costumeClone(t)
ee.custom.name="custom"
a=[]
for(var i=0;i<ee.custom.attachments.length;i++){var o=ee.custom.attachments[i]
a.push({name:o.base_name||o.name,swaps:o.swaps})}}var n={name:r,parts:a,swaps:t.swaps}
if(e)n.override=true
ve(n,Ae.chat_ui.handle_cmd_parse_error)
var s=Y(true)
if(Le())Re(Ne.CHARACTER_CUSTOMIZATION)
else Oe()
j("save_costume",void 0,s,n.name,{parts:JSON.stringify(n.parts),swaps:JSON.stringify(n.swaps)})}function renamePrompt(e){v({edit_text:e,title:Ie.DLG_DISPLAY_NAME_TITLE,text:Ie.DLG_DISPLAY_NAME_MSG,max_len:p,max_visual_size:m,buttons:{OK:function OK(r){var e=r.trim()
f({title:Ie.DLG_DISPLAY_NAME_TITLE,text:Ie.DLG_DISPLAY_NAME_CONFIRM_MSG.$({name:e}),buttons:{accept:{label:Ie.BTN_ACCEPT,cb:function cb(){if(!l().loggedIn()||s())return void D.modalDialog({title:Ie.DLG_ERROR_TITLE,text:Ie.DLG_DISPLAY_NAME_ERROR_MSG,buttons:{OK:null}})
_t("rename "+e,function(e,t){D.modalDialog({title:e?Ie.DLG_ERROR_TITLE:Ie.DLG_DISPLAY_NAME_CHANGED_TITLE,text:e||Ie.$(Ie.DLG_DISPLAY_NAME_CHANGED_MSG_NEW,r)+"  "+Ie.$(Ie.DLG_DISPLAY_NAME_CHANGED_MSG_USERID,_()),buttons:{OK:null}})})}},edit:{label:Ie.BTN_EDIT,cb:function cb(){renamePrompt(e)}},cancel:null}})},Cancel:null}})}function cantSavePrompt(){var e=""
var t=pt[ct.COSTUMES]
if(t&&!Q(t)){var r=X(t)
if(r)e+=r+"\n"}else{var a=ee.preview.parts
for(var i=0;i<a.length;i++){var o=a[i]
var n=_e(o)
var s=ce[n]
M(s)
if(!Q(s)){var l=X(s)
if(l)e+=l+"\n"}}}for(var _=0;_<mt.length;_++){var c=mt[_]
if(c&&!Q(c))e+=Ie.get(c.type_key)+" "+Ie.get(c.display_name_key)+"\n"}var u={OK:null}
if(lt("sysadmin"))u["Admin: force"]=function(){saveCostume(true)}
D.modalDialog({title:Ie.DLG_CANT_SAVE_COSTUME_TITLE,text:Ie.addColon(Ie.DLG_CANT_SAVE_COSTUME_MSG)+"\n\n"+e,buttons:u})}function changePreviewPart(e){var t=ee.preview
M(t)
var r=t.attachments
for(var a=0;a<r.length;a++)if(r[a].part_type===e.part_type){r[a]=e
break}var i=t.parts
for(var o=0;o<i.length;o++){var n=i[o]
var s=_e(n)
var l=ce[s]
M(l)
if(l.part_type===e.part_type){n.name=e.base_name||e.name
if(e.swaps)n.swaps=e.swaps
else delete n.swaps
break}}t.name="preview"
t.is_custom=true}function changePreviewSwap(e){var t=ue[e]
var r=ee.preview
var a=r.swaps||{}
a[t.type]=null==t?void 0:t.name
r.swaps=a
r.name="preview"
r.is_custom=true}function partPairedPart(e){if(e.paired_part){var t=ce[e.paired_part]
if(t)return t}return null}function previewItem(e){ht=void 0
if(U(e))getCurrentSelectionFromCostume(ee.preview=costumeClone(e))
else if(G(e)){pt[ct.COSTUMES]=void 0
changePreviewPart(e)
var t=partPairedPart(e)
if(t)changePreviewPart(t)}else if(F(e))changePreviewSwap(e.swap_key)
checkSaveEnabled()
he()}function costumeSetOnPurchase(e,t){if(!t)if(U(e)){var r={name:e.name}
ve(r,Ae.chat_ui.handle_cmd_parse_error)}}function drawItemInfo(e,t){var r=D.font
var a=8
var i=bt===Ee?t.x:t.x+a
var o=bt===Ee?t.y:t.y
var n=i+a
var s=n
var l=o
var _=t.z+2
var c=bt===Ee?t.w-2*a:t.w
var u=1.2*Nt
l+=a
var d=ie(e?e.rarity||"LEGENDARY":"COMMON")
var f=t.x
var v=t.y
var h=t.x+t.w
var p=t.y+u+2*a
D.drawRect4Color(f,v,h,p,_-1,d.bright_color,d.bright_color_transparent,d.bright_color,d.bright_color_transparent)
if(!e){s+=r.drawSizedAligned(rt,s,l,_,u,r.ALIGN.HLEFT,0,0,Ie.TLTP_CUSTOM_OUTFIT)
s=n
r.drawSizedWrapped(at,s,l+=u+2*a,_,c,0,u,Ie.CUSTOMIZATION_CUSTOM_OUTFIT)}else{var m=e.rarity||"LEGENDARY"
var E=ne(m)
var g=oe(m)+" | "
var T=""+Ie.get(e.type_key)
s+=r.drawSizedAligned(E,s,l,_,u,r.ALIGN.HLEFT,0,0,g)
s+=r.drawSizedAligned(rt,s,l,_,u,r.ALIGN.HLEFT,0,0,T)
var y=le(e.collection_key,e.collection_untranslated)
if(y)s+=r.drawSizedAligned(rt,i+t.w,l,_,u,r.ALIGN.HRIGHT,0,0,y)
s=n
l+=u+2*a
var S=X(e)
s+=r.drawSizedAligned(rt,s,l,_,Ct,r.ALIGN.HLEFT,0,0,S||"Unknown item")
if(U(e)&&!Q(e)&&(shouldShowPromoInfo(e)||!e.promo_product_id&&e.expire_date)){var I=new Date(e.expire_date)
var A=C(I,true)
var w=o-(Ct+.5*a)
r.drawSizedAligned(Ye,i+t.w,w,Z.PAPERDOLL+1,u,r.ALIGN.HRIGHT,0,0,Ie.$(Ie.LBL_FOR_SALE_UNTIL,A))}s=n
l+=Ct+1.1*a
if(U(e)||G(e)){var L=""
L="["+(e.race_key?Ie.get(e.race_key):Ie.COSMETIC_RACE_UNKNOWN)+"] "
var O=le(e.flavour_text_key,e.flavour_text_untranslated)
if(O)L+=O
l+=r.drawSizedWrapped(tt,s,l,_,c,0,u,L)
l+=a
s=n}if(G(e)||F(e)&&!e.is_default){var R=costumeForCosmetic(e)
if(R){var b=G(e)?Ie.addColon(Ie.TLTP_ITEM_PART_OF):Ie.addColon(Ie.TLTP_ITEM_COLOR_OF)
var N=X(R.costume)
s+=r.drawSizedAligned(at,s,l,_,u,r.ALIGN.HLEFT,0,0,b)
r.drawSizedAligned(rt,s,l,_,u,r.ALIGN.HLEFT,0,0," "+(R.multiple?Ie.LBL_MULTIPLE:N))}}}}function drawTabs(e,t,r){var a=N()
var i=4
tabButton(e,t,r,ct.COSTUMES,Bt,nt.COSTUME,Ie.TLTP_TAB_COSTUMES,"new_cosmetic_costume")
tabButton(e+=a+i,t,r,ct.HEADS,Bt,nt.HEAD,Ie.TLTP_TAB_HEADS,"new_cosmetic_head")
tabButton(e+=a+i,t,r,ct.TORSOS,Bt,nt.TORSO,Ie.TLTP_TAB_TORSOS,"new_cosmetic_torso")
tabButton(e+=a+i,t,r,ct.ARMS,Bt,nt.ARMS,Ie.TLTP_TAB_ARMS,"new_cosmetic_arm")
tabButton(e+=a+i,t,r,ct.LEGS,Bt,nt.LEGS,Ie.TLTP_TAB_LEGS,"new_cosmetic_leg")
tabButton(e+=a+i,t,r,ct.COLORS,Bt,nt.PAINT,Ie.TLTP_TAB_COLORING,void 0)}function showList(e,t,r,a,i,o,n,s){if(!Dt[e])Dt[e]=I({z:i,background_color:null,auto_hide:true})
var l={x:r,y:a,z:i,w:o,h:n}
var _=Dt[e]
_.begin(l)
var c=8
var u=c
var d=8
var f=12
var v=(o-s*f-_.barWidth())/s
var h=_.getScrollPos()-v/2
var p=h+n+v
for(var m=1;m<=t.length;m++){var E=t[m-1]
var g={x:u,y:d,z:i+1,w:v,h:v,left_align:true,shrink:.85,img:D.sprites.white,reddot_pos:"upper_left",reddot_pad:.1*v,reddot_r:.05*v}
u+=v+f
if(m%s===0){u=c
d+=v+f}if(g.y>p||g.y+g.h<h)continue
var T=void 0
if(F(E))T=mt[E.color_submenu]
else T=pt[ut]
g.base_name=T&&T.name===E.name?"cosmetic_selected":"cosmetic_unselected"
if(F(E)){g.owned=Q(E)
g.img=D.sprites.white
g.img_color=qe
g.bg_offset=bt===Ee?7:9}else{g.owned=Q(E)
g.img=D.sprites.cosmetic_placeholder
g.z_inc=-.75
g.dynamic_snapshot=false
g.peek=true
if(S.mouseOver(g))g.dynamic_snapshot=true
g.bg_offset=16
K(g,E)}if(itemButton(g,E)&&Et!==E){if(F(Et=E))mt[E.color_submenu]=E
else{if(U(E))Be("c."+E.name)
else if(G(E)&&z(E.name))Be("cp."+E.name)
pt[ut]=E}previewItem(E)}}if(t.length%s>0)d+=v+f
_.end(d)}function doColorsTab(e){var t=8
var r=12
var a=bt===Ee?4:12
var i=e.x
var o=e.y
var n=e.z+1
var s=.5*e.w-t
var l=At[ft.SKIN]
var _=e.h*(bt===Ee?.35:.45)
var c=e.h*(bt===Ee?.4:.35)
var u=e.h*(bt===Ee?.1:.12)
Bt.draw({x:i,y:o-=a,z:n,w:u,h:u,frame:nt.SKIN})
showList(1,l,i,o+=u-a,n,e.w,_,bt===Ee?8:6)
Bt.draw({x:i+=r,y:o+=_+t,z:n,w:u,h:u,frame:nt.HAIR})
showList(2,l=At[ft.HAIR],i-=r,o+=u-a,n,s,c,4)
i+=s+2*t
Bt.draw({x:i+=r,y:o-=u-a,z:n,w:u,h:u,frame:nt.EYES})
showList(3,l=At[ft.EYES],i-=r,o+=u-a,n,s,c,4)}function eventCBForMenuExit(){return!i()&&!y.stateActive(be)?o:void 0}function handleBottomButton(e){var t=e.y*(bt===Ee?1:.9)
var r=false
if(dt){r=true
if(D.buttonImage({x:e.x,y:t,z:e.z,w:e.w,h:e.h,img:Pt,colors:vt?Je:Qe,frame:ot.CHECK,tooltip:Ie.TLTP_SAVE,disabled:!vt,in_event_cb:eventCBForMenuExit()}))saveCostume(false)}else{var a=Et
var i=.5*N()
var o
if(U(a)&&!Q(a))o=H(a.name)
if(G(a)&&!Q(a))o=z(a.name)
if(o){M(U(a)||G(a))
var n={previously_owned_costumes_amount:ae()}
if(ht)n.redirected_from=ht
var s=He(o)
var l=ze(o)
var _=s||l
var c=X(a)
if(_){r=true
var u=""+s
var d
var f
var v
var h
if(l){d=et
f=""+l
v=ot.ORBS
h=8}else{d=$e
f=""+u
v=ot.GEMS
h=4}var p=D.font.getStringWidth(D.uiFontStyleNormal(),i,f)
var m=i
if(shouldShowPromoInfo(a)){var E=e.w*(bt===Ee?.35:.4)
var g=e.x+.5*E
if(D.buttonText({x:e.x,y:t,z:e.z,w:E,h:e.h,text:"",font_height:i,colors:d}))We(l?"orb":"gem",o,1,c,"costume_shop",costumeSetOnPurchase.bind(null,a),n)
D.font.drawSizedAligned(D.uiFontStyleNormal(),g-.25*m-.5*h-4,t+.5*e.h,e.z,i,D.font.ALIGN.HVCENTER,0,0,f)
ot.sprite_centered.draw({x:g+.5*p+.5*h,y:t+.5*e.h,z:e.z+1,w:m,h:m,frame:v})
var T=e.x+E
var y=e.w-E
var S=8
var I=T+.5*m+S
if(D.buttonText({x:e.x+E,y:t,z:e.z,w:y,h:e.h,text:"",font_height:i,colors:Je}))showPromo(a)
Ft.draw({x:I,y:t+.5*e.h,z:e.z+1,w:m,h:m,color:je,frame:0})
D.font.drawSizedAligned(D.uiFontStyleNormal(),I+.5*m+S,t+.5*e.h,e.z,i,D.font.ALIGN.HVCENTERFIT,y-m-4*S,0,(""+Ie.BTN_SPECIAL_OFFER).toUpperCase())}else{var A=.5*e.w
var w=e.x+A
if(D.buttonText({x:e.x,y:t,z:e.z,w:e.w,h:e.h,text:"",font_height:i,colors:d}))We(l?"orb":"gem",o,1,c,"costume_shop",costumeSetOnPurchase.bind(null,a),n)
D.font.drawSizedAligned(D.uiFontStyleNormal(),w-.25*m-.5*h-4,t+.5*e.h,e.z,i,D.font.ALIGN.HVCENTER,0,0,f)
ot.sprite_centered.draw({x:w+.5*p+.5*h,y:t+.5*e.h,z:e.z+1,w:m,h:m,frame:v})}}}else if(G(a)&&!Q(a)||F(a)&&!Q(a)){var L=cosmeticBestAvailableCostume(a)
var O=L&&L.costume.name
var R=O&&getItemByName(gt,O)
if(R){r=true
if(D.buttonText({x:e.x,y:t,z:e.z,w:e.w,h:e.h,text:Ie.$(Ie.BTN_GET_COSTUME,X(R)),font_height:i,colors:$e})){var b=false
if(pt[ct.COSTUMES]!==R)b=true
previewItem(Et=R)
ut=ct.COSTUMES
if(b)ht=a.name}}}else{r=true
if(D.buttonImage({x:e.x,y:t,z:e.z,w:e.w,h:e.h,img:Bt,colors:$e,frame:nt.EXCLAMATION,tooltip:Ie.TLTP_INFO}))cantSavePrompt()}}if(!r&&lt("sysadmin"))if(D.buttonText({x:e.x,y:t,z:e.z,w:e.w,h:e.h,text:"Admin: force equip",colors:Je,in_event_cb:eventCBForMenuExit()}))saveCostume(true)}var zt=96
function doCharacterCustomization(){Wt.update(y.getFrameDt())
bt=ge()
if(!Ht)getInitialPreview()
var e=0
var t=Ne.menuX1()
var r=N()
var a=Ne.menuY1()
var i=Z.UI
var o=(a-r)/Mt
var n=bt===Ee?Mt:.5*Mt
var s={w:t/xt*(bt===Ee?740:.5*xt),h:n*o*.8,x:e,y:r,button_h:zt,is_customization:true}
Pe(s)
var l=e
var _=0
var c=i
if(Te()){var u=200
l=Math.max(l,T.x0()+u)}drawTabs(l,_,c)
var d=N()/2
var f=wt[ut]
var v=bt===Ee?s.w+d:e-2
var h=bt===Ee?r:a-n*o
var p=i+1
var m=bt===Ee?t-(s.w+d):t
var E=bt===Ee?Mt:.5*Mt
E*=o
var g
g={x:bt===Ee?e+.1*s.w:e+s.w,y:bt===Ee?r+.88*s.h:r+16,z:p,w:bt===Ee?.8*s.w:s.w-16,h:.23*s.h}
drawItemInfo(Et,g)
if(ut===ct.COLORS)doColorsTab({x:v,y:h,z:p,w:m,h:bt===Ee?E:E})
else if(f)showList(0,f,v,h,p,m,E,4)}},{"../common/cosmetics_common":241,"../common/entitlements":244,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/sprite_animation":362,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/common/net_common":391,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./cosmetic_thumbnails":63,"./cosmetics":64,"./costume_edit":65,"./in_app_purchases/iap_client_worlds":111,"./layout":120,"./localization/localization":131,"./main":135,"./main_menu":136,"./menu":140,"./paperdoll":151,"./red_dot":176,"./show_first_offer":187,"./store":195,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./world_comm":226,assert:void 0}],40:[function(e,t,r){"use strict"
r.chatFloaterStartup=chatFloaterStartup
r.chatFloaterAdd=chatFloaterAdd
r.chatFloaterShift=chatFloaterShift
r.chatFloaterTick=chatFloaterTick
r.chatFloaterReset=chatFloaterReset
r.ChatWithTipFloater=r.ChatFloater=r.MSG_FLOATERS_MAX_DIST=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var u=200
r.MSG_FLOATERS_MAX_DIST=u
var d=e("assert")
var a=e("../glov/client/font.js")
var n=a.ALIGN
var i=a.fontStyleAlpha
var f=e("../glov/client/localization").getStringFromLocalizable
var o=e("../glov/client/ui.js")
var s=e("../glov/common/util.js").clamp
var l=e("../glov/common/vmath.js")
var v=l.v3copy
var _=l.v3iAdd
var c=l.v4clone
var h=l.vec3
var p=e("./floater")
var m=p.CompoundFloater
var E=p.DEF_FLT_SCALE
var g=p.GraphicalFloater
var T=p.PanelledTextFloater
var y=p.TextFloater
var S=p.drawFloaterStack
var I=e("./styles.js")
var A=I.STYLE_WITHOUT_OUTLINE
var w=I.color_white
var L=I.getStyleForRole
var O=I.inventory_style
var R=e("./voxel_data").worldPosFromLocalPos
var b=.01
var N=.4
var C=2-2*N
var x=8
var M=function(o){_inheritsLoose(ChatTextFloater,o)
function ChatTextFloater(e,t){var r
var a=1
var i=t;(r=o.call(this,{size:a,style:i,text:e,min_w:C,max_w:x,use_markdown:true})||this).setAlign(r.w>r.text_w?n.HCENTERFIT:n.HLEFT|n.HWRAP)
return r}return ChatTextFloater}(y)
var D=O
var P=w
var B=.9
var k=.015
var U=function(n){_inheritsLoose(ChatFloater,n)
function ChatFloater(e,t,r,a){var i
var o=c(a||P)
o[3]=B;(i=n.call(this,new M(e,t),{color:o,panel_border:N,pixel_scale:k})||this).timestamp=void 0
i.original_style=void 0
i.original_color=void 0
i.timestamp=r
i.original_style=t||D
i.original_color=a||P
return i}var e=ChatFloater.prototype
e.getTimestamp=function getTimestamp(){return this.timestamp}
e.getOriginalStyle=function getOriginalStyle(){return this.original_style}
e.getOriginalColor=function getOriginalColor(){return this.original_color}
e.setBaseAlpha=function setBaseAlpha(e){this.fp_pairs.text.floater.setStyle(i(this.original_style,e))
this.fp_pairs.panel.floater.setBaseAlpha(B*e)}
return ChatFloater}(T)
r.ChatFloater=U
var G=1.9
var F=function(r){_inheritsLoose(ChatPanelWithTipFloater,r)
function ChatPanelWithTipFloater(e){var t;(t=r.call(this,e=e||{})||this).pixel_scale=void 0
t.h_split=void 0
t.pixel_scale=e.pixel_scale||1
t.h_split=[.5,.5]
return t}var e=ChatPanelWithTipFloater.prototype
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
o.drawMultiPartBox({x:t,y:r,z:a,w:this.w*i,h:this.h*i},{widths:[-1,this.h_split[0],-1,this.h_split[1],-1],heights:[-1,1,-1]},o.sprites.chat_panel,this.pixel_scale*i,this.color)}
e.offscreenUpdate=function offscreenUpdate(e,t){var r=e[0]/((this.w-G)*t)
this.h_split=[s(.5-r,0,1),s(.5+r,0,1)]}
return ChatPanelWithTipFloater}(g)
var W=.3
var H=function(l){_inheritsLoose(ChatWithTipFloater,l)
function ChatWithTipFloater(e,t,r,a){var i
var o=new M(e,t)
var n=c(a||P)
n[3]=B
var s={text:{floater:o,rel_pos:{x:N,y:N,z:b}},panel:{floater:new F({color:n,pixel_scale:k,w:o.getW()+2*N,h:o.getH()+2*N+W}),rel_pos:{x:0,y:0,z:0}}};(i=l.call(this,s)||this).timestamp=void 0
i.fp_pairs=void 0
i.original_style=void 0
i.original_color=void 0
i.fp_pairs=s
i.timestamp=r
i.original_style=t||D
i.original_color=a||P
return i}var e=ChatWithTipFloater.prototype
e.getTimestamp=function getTimestamp(){return this.timestamp}
e.getText=function getText(){return this.fp_pairs.text.floater.getText()}
e.getOriginalStyle=function getOriginalStyle(){return this.original_style}
e.getOriginalColor=function getOriginalColor(){return this.original_color}
e.offscreenUpdate=function offscreenUpdate(e,t){this.fp_pairs.panel.floater.offscreenUpdate(e,t)}
e.setBaseAlpha=function setBaseAlpha(e){this.fp_pairs.text.floater.setStyle(i(this.original_style,e))
this.fp_pairs.panel.floater.setBaseAlpha(B*e)}
return ChatWithTipFloater}(m)
r.ChatWithTipFloater=H
function chatFloaterStartup(){o.loadUISprite("chat_panel",[40,2,44,2,40],[40,160,56])}var z={}
var V=h()
function chatFloaterAdd(e,t,r,a,i){R(V,e)
var o=i||V.join(",")
var n=f(t)
var s=L("SPECTATOR",A)
var l=new H(n,s,Date.now(),r)
var _=z[o]
if(!_)_=z[o]={pos:e.slice(0),floater_list:[]}
else{v(_.pos,e)
var c=_.floater_list[0]
d(c)
c.floater=new U(c.floater.getText(),c.floater.getOriginalStyle(),c.floater.getTimestamp(),c.floater.getOriginalColor())}_.floater_list.unshift({floater:l,max_dist:u})
while(_.floater_list.length>a)_.floater_list.pop()}function chatFloaterShift(e){for(var t in z){var r=z[t]
_(r.pos,e)}}var Y=3e3
var j=1e3
function chatFloaterTick(){for(var e in z){var t=z[e]
for(var r=t.floater_list.length-1;r>=0;--r){var a=t.floater_list[r]
var i=Date.now()-a.floater.getTimestamp()
var o=1-s((i-Y)/j,0,1)
if(0===o)t.floater_list.splice(r,1)
else a.floater.setBaseAlpha(o)}if(!t.floater_list.length)delete z[e]
else S(t.floater_list,t.pos,.5*E)}}function chatFloaterReset(){z={}}},{"../glov/client/font.js":315,"../glov/client/localization":330,"../glov/client/ui.js":367,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./floater":100,"./styles.js":197,"./voxel_data":216,assert:void 0}],41:[function(e,t,r){"use strict"
r.chatUIWorldsStartup=chatUIWorldsStartup
r.boostOnWorldMetadataChange=boostOnWorldMetadataChange
var n=e("assert")
var i=e("glov-async").asyncEach
var a=e("../glov/client/chat_ui").chatUICreate
var o=e("../glov/client/cmds").cmd_parse
var s=e("../glov/client/markdown_parse").mdEscape
var l=e("../glov/client/markdown_renderables").markdownImageRegister
var _=e("../glov/client/urlhash").getURLBase
var c=e("../glov/common/enums").CHAT_FLAG_EMOTE
var u=e("../glov/common/util").matchAll
var d=e("../common/globals").CHAT_MAX_LEN
var f=e("../common/roles_common").classifyRole
var v=e("../common/types").CHAT_FLAG_BOOSTED
var h=e("../common/world_constants").BOOST_ICON_MAX
var p=e("./link_parse")
var m=p.linkParseGeneric
var E=p.linkPayloadToURL
var g=e("./localization/localization")
var T=g.L
var y=g.localizationSetChatUI
var S=e("./main").mapEmoteToAnimation
var I=e("./styles")
var A=I.STYLE_CHAT
var w=I.chat_style_default
var L=I.chat_style_error
var O=I.chat_style_link
var R=I.chat_style_link_hover
var b=I.chat_style_system
var N=I.styles_per_role
var C=e("./ui_util")
var x=e("./ui_util_2")
var M=e("./user_info_view").viewUser
var D=e("./user_party").partyFormatDisplayName
var P=e("./world_comm").worldGetRoles
var B=e("./world_metadata")
var k=B.worldBoostIcon
var U=B.worldUserIsBoosting
var G="(?:"+["blueprint\\/[A-Z0-9]{12,26}","photo\\/[A-Z0-9]{12,26}","w\\/\\d{1,16}(?:\\/[a-z0-9_]*[a-z0-9])?(?:\\?pos=[-\\d.,f]+)?","u\\/(?:fb\\$|[a-zA-Z0-9])[a-zA-Z0-9_]{0,31}[a-zA-Z0-9](?:\\/(?:go|photos))?"].join(")|(?:")+")"
var F=new RegExp("("+G+")")
var W
function cmdLogFilter(e){if(o.canonical(e).startsWith("/worldpass"))return"/world_pass ****"
else return e}var H=/(https:\/\/fb\.gg\/play\/worldsfrvr\/d\/\d+\/?)/g
var z=/(https:\/\/[-./\w]+\/worlds-frvr\/[-\w]+\?msstart3pp=[%"{}:/\w]+(?:%7D|}))/g
function chatPreSend(e,a,t){a=a.replace(z,function(e,t){var r=t
try{t=decodeURIComponent(t)}catch(e){}n(t.includes("msstart3pp="))
var a=t.match(/msstart3pp=(\{[^&]+\})(?:$|&)/)
if(a)try{var i=JSON.parse(a[1])
if(i.url&&"string"===typeof i.url){var o=i.url.match(F)
if(o&&o[0]===i.url)r="[chaturl="+i.url+"]"}}catch(e){}return r})
var r=u(a,H)
if(!r.length)return t(a)
i(r,function(t,r){m(t,null,function(e){if(e)a=a.replace(t,"[chaturl="+E(e)+"]")
r()})},function(){t(a)})}function chatDecorateUser(e){var t=e.display_name
if(e.id)t=D(e.id,t)
t=s(t)
if("join_leave"===e.style&&e.id)if(U(e.id))e.flags=(e.flags||0)|v
if(e.flags&&e.flags&v){t+="[img=booster]"
e.chatsrc_tooltip=T.TLTP_USER_IS_BOOSTER}if(!(e.flags&&e.flags&c))t="\\["+t+"]"
return t}function chatUIWorldsStartup(){var e={def:w,error:L,link:O,link_hover:R,system:b}
for(var t in N)e[t]=N[t][A];(W=a({styles:e,border:12,w:524,inner_width_adjust:-2,max_len:d,url_match:new RegExp(["(?:\\s|^)","(","(?:(?:https?:\\/\\/)?worlds\\.(?:\\w+\\.)?frvr\\.com\\/|https?:\\/\\/localhost(?::\\d+)?\\/)?","(?:"+G+")",")","(?:\\b|$)"].join(""),"g"),url_info:F,url_base:_().match(/frvr\.com|localhost/)?_():"https://worlds.frvr.com/",hide_disconnected_message:true,volume_join_leave:.1,msg_out_err_delay:.3,user_context_cb:function user_context_cb(e){return M(e)},decorate_user_cb:chatDecorateUser,emote_cb:S,message_pre_send_cb:chatPreSend,classifyRole:f,cmdLogFilter:cmdLogFilter})).setGetRoles(P)
y(W)
l("orbs",{sprite:C.sprite,frame:C.ORBS})
l("gems",{sprite:C.sprite,frame:C.GEMS})
l("booster",{sprite:x.sprite,frame:x.BOOSTER0})
l("boost0",{sprite:x.sprite,frame:x.BOOST0})
l("boost1",{sprite:x.sprite,frame:x.BOOST1})
l("boost2",{sprite:x.sprite,frame:x.BOOST2})
l("boost3",{sprite:x.sprite,frame:x.BOOST3})
l("boost_token",{sprite:x.sprite,frame:x.BOOST_TOKEN})
for(var r=0;r<=h;++r)l("booster"+r,{sprite:x.sprite,frame:x.BOOSTER0+r})
return W}function boostOnWorldMetadataChange(){l("booster",{sprite:x.sprite,frame:x.BOOSTER0+k(),override:true})}},{"../common/globals":248,"../common/roles_common":260,"../common/types":263,"../common/world_constants":267,"../glov/client/chat_ui":296,"../glov/client/cmds":298,"../glov/client/markdown_parse":333,"../glov/client/markdown_renderables":334,"../glov/client/urlhash":369,"../glov/common/enums":385,"../glov/common/util":400,"./link_parse":125,"./localization/localization":131,"./main":135,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_info_view":210,"./user_party":211,"./world_comm":226,"./world_metadata":235,assert:void 0,"glov-async":void 0}],42:[function(e,t,r){"use strict"
r.ChunkSearcher=void 0
var i=e("../glov/client/engine")
var a=e("../glov/common/vmath")
var o=a.v3addScale
var n=a.v3copy
var s=a.v3dist
var l=a.v3set
var _=a.v3sub
var c=a.vec3
var u=e("../common/globals")
var d=u.CHUNK_SIZE
var f=u.ID2
var v=u.ID_FACTOR
var h=e("./voxel_const").origin_chunk
var p=e("./voxel_data")
var m=Math.floor
var E=c()
var g=function(){function ChunkSearcher(e){this.chunk_walk=[0,0,0]
this.chunk_min=[0,0,0]
this.chunk_max=[1,1,1]
this.done=true
this.last_closest_chunk=null
this.last_closest_dist=Infinity
this.last_closest_offs=c()
this.closest_chunk=null
this.closest_dist=Infinity
this.closest_offs=c()
this.range=0
this.start=c()
this.work_count=0
this.max_work=void 0
this.search_start_time=Infinity
this.max_work=e}var e=ChunkSearcher.prototype
e.setRange=function setRange(e){this.range=e}
e.setStart=function setStart(e){n(this.start,e)}
e.reset=function reset(e){this.done=false
l(this.chunk_min,m((this.start[0]-this.range)/d+h[0]),m((this.start[1]-this.range)/d+h[1]),m((this.start[2]-this.range)/d+h[2]))
l(this.chunk_max,m((this.start[0]+this.range)/d+h[0]),m((this.start[1]+this.range)/d+h[1]),m((this.start[2]+this.range)/d+h[2]))
n(this.chunk_walk,this.chunk_min)
if(e)this.last_closest_chunk=null
this.closest_chunk=null
this.closest_dist=Infinity}
e.addWork=function addWork(e){this.work_count+=e}
e.search=function search(e){this.work_count=0
this.search_start_time=i.hrnow()
do{var t=this.chunk_walk[0]+this.chunk_walk[1]*v+this.chunk_walk[2]*f
var r=p.chunk_map[t]
this.addWork(1)
if(r&&r.did_gen&&r.data){var a=e(r)
if(a){this.closest_chunk=a.closest_chunk
this.closest_dist=a.closest_dist
n(this.closest_offs,a.closest_offs)}}this.walkChunk()}while(!this.done||this.work_count<this.max_work)
if(this.done){this.last_closest_offs=this.closest_offs
this.last_closest_chunk=this.closest_chunk}this.last_closest_dist=Infinity
if(this.last_closest_chunk){_(E,this.last_closest_chunk.pos,h)
o(E,this.last_closest_offs,E,d)
this.last_closest_dist=s(E,this.start)}}
e.walkChunk=function walkChunk(){this.chunk_walk[0]++
if(this.chunk_walk[0]>this.chunk_max[0]){this.chunk_walk[0]=this.chunk_min[0]
this.chunk_walk[1]++
if(this.chunk_walk[1]>this.chunk_max[1]){this.chunk_walk[1]=this.chunk_min[1]
this.chunk_walk[2]++
if(this.chunk_walk[2]>this.chunk_max[2])this.done=true}}}
return ChunkSearcher}()
r.ChunkSearcher=g},{"../common/globals":248,"../glov/client/engine":305,"../glov/common/vmath":402,"./voxel_const":215,"./voxel_data":216}],43:[function(require,module,exports){"use strict"
exports.isElevated=isElevated
exports.waygateToPosStr=waygateToPosStr
exports.waygateGo=waygateGo
var assert=require("assert")
var _glovClientCmds=require("../glov/client/cmds")
var cmd_parse=_glovClientCmds.cmd_parse
var _glovClientEngine=require("../glov/client/engine")
var engine=_glovClientEngine
var _glovClientFscreen=require("../glov/client/fscreen")
var fscreenActive=_glovClientFscreen.fscreenActive
var fscreenAvailable=_glovClientFscreen.fscreenAvailable
var fscreenEnter=_glovClientFscreen.fscreenEnter
var fscreenExit=_glovClientFscreen.fscreenExit
var _glovClientLocalization=require("../glov/client/localization")
var getStringFromLocalizable=_glovClientLocalization.getStringFromLocalizable
var _glovClientNet=require("../glov/client/net")
var netClient=_glovClientNet.netClient
var netDisconnected=_glovClientNet.netDisconnected
var netSubs=_glovClientNet.netSubs
var _glovClientUi=require("../glov/client/ui")
var ui=_glovClientUi
var _glovClientUrlhash=require("../glov/client/urlhash")
var urlhash=_glovClientUrlhash
var _glovClientWorker_comm=require("../glov/client/worker_comm")
var worker_comm=_glovClientWorker_comm
var md5=require("../glov/common/md5.js")
var _glovCommonUtil=require("../glov/common/util")
var clamp=_glovCommonUtil.clamp
var dateToSafeLocaleString=_glovCommonUtil.dateToSafeLocaleString
var has=_glovCommonUtil.has
var isInteger=_glovCommonUtil.isInteger
var nop=_glovCommonUtil.nop
var plural=_glovCommonUtil.plural
var secondsToFriendlyString=_glovCommonUtil.secondsToFriendlyString
var verify=require("../glov/common/verify")
var _commonEntitlements=require("../common/entitlements")
var entitlements=_commonEntitlements.entitlements
var _commonGlobals=require("../common/globals")
var CHUNK_SIZE=_commonGlobals.CHUNK_SIZE
var ID2=_commonGlobals.ID2
var ID_FACTOR=_commonGlobals.ID_FACTOR
var STACK_SIZE=_commonGlobals.STACK_SIZE
var _commonIds=require("../common/ids")
var INV_ITEM_NAME=_commonIds.INV_ITEM_NAME
var ITEM_BUCKET=_commonIds.ITEM_BUCKET
var TYPE_BLOCK=_commonIds.TYPE_BLOCK
var TYPE_ITEM=_commonIds.TYPE_ITEM
var _commonMaterials_common=require("../common/materials_common")
var Mat=_commonMaterials_common.Mat
var UNRELEASED_ATTR1=_commonMaterials_common.UNRELEASED_ATTR1
var _commonMegachunk_common=require("../common/megachunk_common")
var megachunk_common=_commonMegachunk_common
var _commonWaygate_common=require("../common/waygate_common")
var waygate_invalid_regex=_commonWaygate_common.waygate_invalid_regex
var waygate_valid_regex=_commonWaygate_common.waygate_valid_regex
var _commonWorld_constants=require("../common/world_constants")
var ATTRIB_FIXED_MAX=_commonWorld_constants.ATTRIB_FIXED_MAX
var WAYGATE_FLAG_LISTED=_commonWorld_constants.WAYGATE_FLAG_LISTED
var _commonWorld_trans=require("../common/world_trans")
var TransactionSet=_commonWorld_trans.TransactionSet
var decodeChunkPos=_commonWorld_trans.decodeChunkPos
var _app_access=require("./app_access")
var accessPrerelease=_app_access.accessPrerelease
var _editvolume_client=require("./editvolume_client")
var updateEditVolumes=_editvolume_client.updateEditVolumes
var _energy_well=require("./energy_well")
var possiblyApplyWaygateSickness=_energy_well.possiblyApplyWaygateSickness
var _inventory=require("./inventory")
var INV_PLAYER=_inventory.INV_PLAYER
var canFit=_inventory.canFit
var inventoryLocked=_inventory.inventoryLocked
var transInvAdd=_inventory.transInvAdd
var _items=require("./items")
var createItem=_items.createItem
var _localizationLocalization=require("./localization/localization")
var L=_localizationLocalization.L
var _main=require("./main")
var main=_main
var _main2=require("./main")
var charControllerPos=_main2.charControllerPos
var _materials=require("./materials")
var INV_MATERIAL_NAME=_materials.INV_MATERIAL_NAME
var MATERIAL_CLASS=_materials.MATERIAL_CLASS
var MATERIAL_NAME=_materials.MATERIAL_NAME
var MaterialClass=_materials.MaterialClass
var _orient=require("./orient")
var orient=_orient
var _photo_mode=require("./photo_mode")
var photoModeActive=_photo_mode.photoModeActive
var photoModeCancel=_photo_mode.photoModeCancel
var _proc_gen=require("./proc_gen")
var getFlatOreType=_proc_gen.getFlatOreType
var setFlatOreType=_proc_gen.setFlatOreType
var _race_ui=require("./race_ui")
var possiblyCancelReadyRace=_race_ui.possiblyCancelReadyRace
var _share_menu=require("./share_menu")
var shareMenuPhotoCapture=_share_menu.shareMenuPhotoCapture
var _status=require("./status")
var statusPush=_status.statusPush
var _stuck=require("./stuck")
var unstuck=_stuck.unstuck
var unstuckBlocked=_stuck.unstuckBlocked
var _task_sched=require("./task_sched")
var WORKER_MESH=_task_sched.WORKER_MESH
var taskCreate=_task_sched.taskCreate
var _tiles=require("./tiles")
var TILES=_tiles
var _tiles_const=require("./tiles_const")
var LIQUID_TILES=_tiles_const.LIQUID_TILES
var _user_data=require("./user_data")
var giveItemsAllowed=_user_data.giveItemsAllowed
var isPlayAsViewer=_user_data.isPlayAsViewer
var playAsViewerSet=_user_data.playAsViewerSet
var userAttribGet=_user_data.userAttribGet
var userAttribGetFixed=_user_data.userAttribGetFixed
var userAttribModBatched=_user_data.userAttribModBatched
var userAttribs=_user_data.userAttribs
var userDataGet=_user_data.userDataGet
var userDataPredict=_user_data.userDataPredict
var userHomeSettlementID=_user_data.userHomeSettlementID
var userStaminaCur=_user_data.userStaminaCur
var userStaminaMax=_user_data.userStaminaMax
var userStaminaMod=_user_data.userStaminaMod
var waygateEditAllowed=_user_data.waygateEditAllowed
var worldReadOnly=_user_data.worldReadOnly
var _voxel_const=require("./voxel_const")
var origin_chunk=_voxel_const.origin_chunk
var _voxel_data=require("./voxel_data")
var remeshAll=_voxel_data.remeshAll
var _world_comm=require("./world_comm")
var getWorldChannel=_world_comm.getWorldChannel
var getWorldID=_world_comm.getWorldID
var worldCmdParse=_world_comm.worldCmdParse
var worldRecordCurrentWGID=_world_comm.worldRecordCurrentWGID
var worldSend=_world_comm.worldSend
var _world_info=require("./world_info")
var worldInfoCacheClear=_world_info.worldInfoCacheClear
var _world_metadata=require("./world_metadata")
var adventureMode=_world_metadata.adventureMode
var unlimitedMode=_world_metadata.unlimitedMode
var worldEnergy=_world_metadata.worldEnergy
var worldMetadata=_world_metadata.worldMetadata
var worldMetadataFreePos=_world_metadata.worldMetadataFreePos
var worldMetadataWaygates=_world_metadata.worldMetadataWaygates
var worldRaceAsVisitor=_world_metadata.worldRaceAsVisitor
var worldSettlements=_world_metadata.worldSettlements
var floor=Math.floor,max=Math.max,round=Math.round
var elevated=false
function isElevated(){return elevated}cmd_parse.register({cmd:"pos",help:"Set or display current position",func:function func(e,t){if(!worldMetadata())return void t("Not currently in a world")
var r=main.char_controller
if(e){if(!worldMetadataFreePos()){if(cmd_parse.checkAccess(["sysadmin"])){r.updatePosFromString(e,false)
return void t(null,"Bypassing /world_free_pos as sysadmin")}return void t("This world does not allow free positioning (owner or admin can run /world_free_pos 1 to enable)")}r.updatePosFromString(e,true)}t(null,"Position: "+r.getPosString())}})
var ping_pong_target
var ping_pong_time=5e3
var ping_pong_timeout
function doPingPong(){if(!worldMetadata()||netDisconnected())return
var e=main.char_controller
var t=ping_pong_target
ping_pong_target=e.getPosString()
e.updatePosFromString(t,true)
ping_pong_timeout=setTimeout(doPingPong,ping_pong_time)}cmd_parse.register({cmd:"ping_pong_target",help:"Set target for /ping_pong",usage:"Usage: /ping_pong_taget [target_pos [start_pos [seconds]]] (defaults to setting target_pos=current pos)",prefix_usage_with_help:true,access_run:["sysadmin"],func:function func(e,t){if(!worldMetadata())return void t("Not currently in a world")
var r=e.split(" ").filter(String)
if(r.length>=1)ping_pong_target=r[0]
else ping_pong_target=main.char_controller.getPosString()
if(r.length>=2)main.char_controller.updatePosFromString(r[1],true)
if(3===r.length)return void cmd_parse.handle(this,"ping_pong "+r[2],t)
t(null,"Target position set: "+ping_pong_target)}})
cmd_parse.register({cmd:"ping_pong",help:"Periodically teleport between current position and position set by /ping_pong_target",usage:"Usage: /ping_pong [seconds] (default 5; 0 to cancel)",prefix_usage_with_help:true,access_run:["sysadmin"],func:function func(e,t){if(ping_pong_timeout){clearTimeout(ping_pong_timeout)
ping_pong_timeout=null}if(e){if(!Number(e))return void t(ping_pong_target=null,"Ping pong cancelled")
ping_pong_time=round(1e3*Number(e))}if(!ping_pong_target)return void t(null,"Run /ping_pong_target first")
ping_pong_timeout=setTimeout(doPingPong,ping_pong_time)
t(null,"Ping pong started")}})
cmd_parse.register({cmd:"pos_chunk",help:"Set or display current position by chunk id",access_show:["sysadmin"],func:function func(e,t){if(e){var r=Number(e)
if(isFinite(r)){var a=megachunk_common.parseChunkId(r).chunk_pos
return void cmd_parse.handle(this,"pos "+(a[0]*CHUNK_SIZE+CHUNK_SIZE/2)+","+(a[1]*CHUNK_SIZE+CHUNK_SIZE/2)+","+(a[2]*CHUNK_SIZE+CHUNK_SIZE/2),t)}}var i=origin_chunk
var o=charControllerPos()
var n=floor(o[0]/CHUNK_SIZE+i[0])
var s=floor(o[0]/CHUNK_SIZE+i[0])
t(null,"Chunk ID: "+(floor(o[0]/CHUNK_SIZE+i[0])*ID2+s*ID_FACTOR+n))}})
cmd_parse.register({cmd:"parse_chunk_id",help:"Parse a chunk ID into component parts",access_show:["sysadmin"],func:function func(e,t){var r=Number(e)
if(!e||!isFinite(r))return void t("Invalid chunk ID")
var a=megachunk_common.parseChunkId(r),i=a.chunk_pos,o=a.mchunk_pos,n=a.local_pos,s=a.mcid
t(null,"Chunk ID = "+r+"\nChunk Pos = "+i+"\nWorld Pos = "+i[0]*CHUNK_SIZE+","+i[1]*CHUNK_SIZE+","+i[2]*CHUNK_SIZE+"\nLocal Pos = "+n+"\nMegaChunk ID = "+s+"\nMegaChunk Pos = "+o+"\nMegaChunk2D ID = "+(o[0]+o[1]*ID_FACTOR)+"\n")}})
cmd_parse.register({cmd:"respawn",help:"Return a user or multiple users to a Waygate",prefix_usage_with_help:true,usage:"  Usage: /respawn\nAdditional options only for unlimited world admins:\n  Usage: /respawn user_id [waygate_id]\n  Usage: /respawn ALL [waygate_id]\n  Usage: /respawn OTHERS [waygate_id]\n  Usage: /respawn (READONLY|AREABUILDER|BUILDER|ADMIN) [waygate_id]\n  Usage: /respawn USER user_id [waygate_id]",func:function func(e,t){if(!worldMetadata())return void t("Not currently in a world")
if(!e)cmd_parse.handle(this,"waygate "+userHomeSettlementID(),t)
else getWorldChannel().cmdParse("world_respawn "+e,t)}})
cmd_parse.register({cmd:"client_worker_assert",help:"(Debug) - Fail an assert on the client in a WebWorker",access_show:["sysadmin"],func:function func(e,t){worker_comm.sendmsg(0,"assert_now",null)}})
cmd_parse.register({cmd:"client_worker_assert_later",help:"(Debug) - Fail an assert on the client in a WebWorker outside of handlers",access_show:["sysadmin"],func:function func(e,t){worker_comm.sendmsg(0,"assert_later",null)}})
cmd_parse.register({cmd:"client_worker_crash",help:"(Debug) - Crash on the client in a WebWorker",access_show:["sysadmin"],func:function func(e,t){worker_comm.sendmsg(0,"crash_now",null)}})
cmd_parse.register({cmd:"client_worker_crash_later",help:"(Debug) - Crash on the client in a WebWorker outside of handlers",access_show:["sysadmin"],func:function func(e,t){worker_comm.sendmsg(0,"crash_later",null)}})
cmd_parse.register({cmd:"client_worker_reject",help:"(Debug) - Fail an unhandled promise rejection on the client in a WebWorker",access_show:["sysadmin"],func:function func(e,t){worker_comm.sendmsg(0,"reject_now",null)}})
cmd_parse.register({cmd:"client_reject_now_string",help:"(Debug) - Fail an unhandled promise rejection on the client (string, sync)",access_show:["sysadmin"],func:function func(r,e){new Promise(function(e,t){t(r||"client_reject_now")})}})
cmd_parse.register({cmd:"client_reject_now_object",help:"(Debug) - Fail an unhandled promise rejection on the client (object, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){t({foo:"bar"})})}})
cmd_parse.register({cmd:"client_reject_now_empty",help:"(Debug) - Fail an unhandled promise rejection on the client (empty, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){t()})}})
cmd_parse.register({cmd:"client_reject_now_crash",help:"(Debug) - Crash in an unhandled promise on the client (crash, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){({}).b.c="d"})}})
cmd_parse.register({cmd:"client_reject_now_assert",help:"(Debug) - Assert in an unhandled promise on the client (assert, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){assert(false)})}})
cmd_parse.register({cmd:"client_reject_later",help:"(Debug) - Fail an unhandled promise rejection on the client (Error, async)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){setTimeout(function(){t(new Error("client_reject_later"))},100)})}})
cmd_parse.register({cmd:"client_send_bad_data",help:"(Debug) - Send bad data to the server",access_show:["sysadmin"],func:function func(e,t){var r=Number(e)||100
t()
var a=netClient().pak("set_channel_data")
if(1===r)return a.send()
a.writeAnsiString("user."+netSubs().loggedIn())
if(2===r){a.writeInt(-1)
return a.send()}a.writeBool(false)
a.writeAnsiString("public.dummy")
if(3===r){a.writeAnsiString("not_json")
return a.send()}a.writeJSON({foo:"bar"})
var i=a.getBufferLen()
a.getBuffer()[i-1]=0
return a.send()}})
cmd_parse.register({cmd:"client_verify",help:"(Debug) - Fail a verify on the client",access_show:["sysadmin"],func:function func(e,t){verify(false)}})
cmd_parse.register({cmd:"world_pass",help:"Set or clear password for the current world",usage:"$HELP\n  Usage: /world_pass [CLEAR | password] [WIPE]\n  If WIPE specified, all access from previous password will be removed",access_run:["world_admin"],func:function func(e,t){if(!main.omp||!worldMetadata())return void t("Command only available in multiplayer")
var r=e.split(" ")
if(r[0]&&"clear"!==r[0].toLowerCase())r[0]=md5(md5(String(getWorldID()))+r[0])
var a="world_pass_server "+r.join(" ")
netSubs().sendCmdParse(a,t)}})
cmd_parse.register({cmd:"csr_world_undelete",help:"(CSR) Undelete a world",prefix_usage_with_help:true,usage:"  Usage: /csr_world_undelete world_id [new_owner_user_id]",access_run:["csr"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&2!==r.length)return void t("Invalid parameters")
var a=netClient().pak("world_undelete")
a.writeAnsiString(r[0])
a.writeAnsiString(r[1]||"")
a.send(t)}})
cmd_parse.register({cmd:"csr_world_delete",help:"(CSR) Delete a world",prefix_usage_with_help:true,usage:"  Usage: /csr_world_delete world_id",access_run:["csr"],func:function func(e,t){if(!e)return void t("Invalid parameters")
var r=netClient().pak("csr_world_delete")
r.writeAnsiString(e)
r.send(t)}})
cmd_parse.register({cmd:"csr_world_freeze",help:"(CSR) Freeze a world",prefix_usage_with_help:true,usage:"  Usage: /csr_world_freeze world_id [max age in days]\n  max age defaults to 8 (days)\n  The freeze will error if the world is older than that many days",access_run:["csr"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&2!==r.length)return void t("Invalid parameters")
var a=netClient().pak("world_freeze")
a.writeAnsiString(r[0])
a.writeBool(true)
var i=8
if(r[1]){i=Number(r[1])
if(!isFinite(i))return void t("Invalid parameters")}a.writeInt(round(24*i*60*60*1e3))
a.send(t)}})
cmd_parse.register({cmd:"csr_world_unfreeze",help:"(CSR) Unfreeze a world",prefix_usage_with_help:true,usage:"  Usage: /csr_world_unfreeze world_id",access_run:["csr"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length)return void t("Invalid parameters")
var a=netClient().pak("world_freeze")
a.writeAnsiString(r[0])
a.writeBool(false)
a.writeInt(0)
a.send(t)}})
cmd_parse.register({cmd:"fullscreen",help:"Toggle full-screen mode",func:function func(e,t){if(!fscreenAvailable())return t("Fullscreen not available")
if(fscreenActive())fscreenExit()
else{fscreenEnter()
orient.set(orient.LANDSCAPE)}return t()}})
cmd_parse.register({cmd:"modal",access_show:["sysadmin"],help:"(Hidden) Show a modal dialog for testing",prefix_usage_with_help:true,usage:"/modal TitleWord Messsage text",func:function func(e,t){var r=e.split(" ")
ui.modalDialog({title:r[0]||"Title",text:r.slice(1).join(" ")||"Message",buttons:{OK:null}})
t()}})
cmd_parse.register({cmd:"unlimited",access_show:["sysadmin"],help:"(Hidden) Set or display unlimited mode of the current world",func:function func(e,t){if(isElevated()){var r="1"===e?1:"0"===e?0:null
if(null===r){if(e)return void t("Usage: /unlimited 0 or 1")}else{main.chat_ui.cmdParse("world_unlimited "+r+" "+getWorldID())
return void t()}}else if(e)return void t("Requires elevation.")
t(null,"Unlimited Mode = "+unlimitedMode())}})
cmd_parse.register({cmd:"dom",access_run:["sysadmin"],access_show:["hidden"],func:function func(str,resp_func){str=str.split(" ")
var elem=document.getElementById(str[0])
if(!elem)return resp_func("Element not found")
return resp_func(null,String(eval("(function(elem){ return elem."+str[1]+"; })")(elem)))}})
var give_lookup
function buildGiveLookup(){if(give_lookup)return
give_lookup={}
function add3(e,t){give_lookup[e.replace(/_/g,"")]=t}function add2(e,t){add3(e,t)
if("S"===e.slice(-1))add3(e.slice(0,-1),t)
else add3(e+"S",t)
var r=e.split("_")
if(r.length>1)if("S"===r[0].slice(-1)){r[0]=r[0].slice(0,-1)
add3(r.join("_"),t)}else{r[0]+="S"
add3(r.join("_"),t)}}function add(e,t){add2(e,t)
add2(e.split("_").reverse().join("_"),t)}for(var e in TILES){var t=TILES[e]
if("number"!==typeof t)continue
var r=TILES.tile_map_default[t]
if(r&&r.allowed_in_inventory){add(e,[TYPE_BLOCK,t])
add(getStringFromLocalizable(L.get("TILES_"+TILES.tile_code_name[t]+"_NAME")).toUpperCase().replace(/ /g,"_"),[TYPE_BLOCK,t])}}for(var a in INV_ITEM_NAME){var i=INV_ITEM_NAME[a]
add(a.replace(/^ITEM_/,""),[TYPE_ITEM,i])}}var give_mats=Object.keys(INV_MATERIAL_NAME).filter(function(e){if(e===Mat.FANCY_STONE)return false
if(e===Mat.ANY||e===Mat.LABEL||e===Mat.UNUSED_STONE||e===Mat.FLINT)return false
return true})
var USAGE_GIVE="Usage: /give [count] <ID> [material 1] [material 2] [attr3]\n  Examples: /give 10 snow\n    /give hatchet stone dark_wood"
cmd_parse.register({cmd:"give",help:"Grant an item",access_run:["world_areabuilder"],usage:"$HELP\n"+USAGE_GIVE,func:function func(e,t){if(!main.omp)return t(null,"Error: /give is only allowed when in a world")
if(adventureMode()&&!cmd_parse.checkAccess(["sysadmin"])&&!engine.DEBUG)return t("Not allowed in Lost Frontier worlds")
if(!giveItemsAllowed()&&!isElevated())return t("Access denied.")
if(inventoryLocked(INV_PLAYER))return t("Inventory locked")
function usage(e){t((e?"Error: "+e+"\n":"")+USAGE_GIVE)}var r=e.split(" ")
if(!Number(r[0]))r.splice(0,0,"1")
var a=r[0]
var i=r[1]
var o=r[2]
var n=r[3]
var s=r[4]
if(!i)return usage()
var l=i
i=i.toUpperCase().replace(/_/g,"")
buildGiveLookup()
var _=give_lookup[i]
if(!_)return usage('Invalid ID: "'+l+'"')
var c=_[0]
i=_[1]
if(!(a=Number(a))||!isInteger(a)||a<1||a>STACK_SIZE)return usage("COUNT must be an integer between 1 and "+STACK_SIZE)
if(c===TYPE_BLOCK){if(o||n||s)return usage("BLOCKs must not specify materials")
if(i<1||i>=TILES.PROP_BASE)return usage("Invalid BLOCK ID")}else{if(o)if("0"===o)o=0
else if(!(o=INV_MATERIAL_NAME[o.toUpperCase()])){var u=give_mats
return usage("ATTR1/MATERIAL1 must be one of "+(u=accessPrerelease()?u.join():u.filter(function(e){return!UNRELEASED_ATTR1[Mat[e]]}).join()))}if(n)if("0"===n)n=0
else if(i===ITEM_BUCKET){if(!(n=LIQUID_TILES[n.toUpperCase()]))return usage("ATTR2/MATERIAL2 must be one of "+Object.keys(LIQUID_TILES).filter(function(e){return LIQUID_TILES[e]&&!(LIQUID_TILES[e]%2)}).join())}else if(!(n=INV_MATERIAL_NAME[n.toUpperCase()])){var d=give_mats
return usage("ATTR2/MATERIAL2 must be one of "+(d=accessPrerelease()?d.join():d.filter(function(e){return!UNRELEASED_ATTR1[Mat[e]]}).join()))}if(s){s=Number(s)
if(!isInteger(s))return usage("ATTR3 must be an integer")}}var f
try{f=createItem({type:c,id:i,count:a,attr1:o,attr2:n,attr3:s})}catch(e){return usage("Invalid ID or not allowed in inventory")}if(!f.isAllowedInInventoryAndReleased())return usage("Invalid ID or not allowed in inventory")
if(f.has_hp)f.setHP(f.hp_max)
if(!canFit(f))return t("Cannot add: inventory full")
transInvAdd(main.getFrameTransaction(),INV_PLAYER,f)
return t(null,"Granted.")}})
cmd_parse.register({cmd:"url",help:"Opens a Worlds FRVR internal URL",override:true,func:function func(e,t){setTimeout(function(){profilerStart("/url")
urlhash.goRoute(e)
profilerStop("/url")},1)}})
cmd_parse.register({cmd:"wave",help:"Triggers waving emote",func:function func(){main.mapEmoteToAnimation("waves")}})
cmd_parse.register({access_show:["hidden"],cmd:"waves",help:"Triggers waving emote",func:function func(){main.mapEmoteToAnimation("waves")}})
cmd_parse.register({cmd:"sit",help:"Triggers sitting emote",func:function func(){main.mapEmoteToAnimation("sits")}})
var go_usage="Usage: /go WorldID  or  /go WorldID/WaygateID"
cmd_parse.register({cmd:"go",help:"Go to the specified world",usage:"$HELP\n"+go_usage,func:function func(e,t){if(!e)return void t(go_usage)
urlhash.goRoute("w/"+e)}})
cmd_parse.register({cmd:"waygate_list",help:"List Waygates in the current world",access_run:["world_areabuilder"],func:function func(e,t){if(!worldMetadata())return void t("Not currently in a world")
var r=worldMetadataWaygates()
var a=waygateEditAllowed()
var i=0
var o=["Waygates in "+getWorldID()+":"]
for(var n in r){var s=r[n]
if(!a&&!(s.flags&WAYGATE_FLAG_LISTED))continue;++i
var l=megachunk_common.parseChunkId(s.pos[0]).chunk_pos
var _=decodeChunkPos(s.pos[1])
var c=l[0]*CHUNK_SIZE+_[0]+","+(l[1]*CHUNK_SIZE+_[1])+","+(l[2]*CHUNK_SIZE+_[2])
o.push("  "+n+": "+c+' - "'+s.name+'"'+(s.flags&WAYGATE_FLAG_LISTED?"":" (unlisted)"))}o.push(i+" "+(a?"total":"listed")+" "+plural(i,"Waygate"))
t(null,o.join("\n"))}})
var rot_to_deg=[0,270,180,90]
function waygateToPosStr(e,t){var r=megachunk_common.parseChunkId(e.pos[0]).chunk_pos
var a=decodeChunkPos(e.pos[1])
var i=e.pos[2]
var o=rot_to_deg[i]
var n=1
var s=1
if(t){n=t.size[0]/2
s=t.size[1]/2
if(1&i&&n>s||!(1&i)&&s>n){var l=n
n=s
s=l}}return r[0]*CHUNK_SIZE+a[0]+n+","+(r[1]*CHUNK_SIZE+a[1]+s)+","+(r[2]*CHUNK_SIZE+a[2]+1+main.char_controller.eye_height)+","+o+",0,"}function waygateGo(e,t){var r=worldMetadataWaygates()
if(!e.match(waygate_valid_regex)||e.match(waygate_invalid_regex)||!has(r,e))return"Invalid WGID"
var a=r[e]
if(!(a.flags&WAYGATE_FLAG_LISTED)&&t.listed_only&&e!==userHomeSettlementID())return"Access denied"
if(worldSettlements()&&!worldMetadataFreePos()&&e!==userHomeSettlementID()&&!worldReadOnly())return"You can only travel to your Home Settlement"
possiblyApplyWaygateSickness()
possiblyCancelReadyRace()
main.char_controller.updatePosFromString(waygateToPosStr(a),false)
if(a.flags&WAYGATE_FLAG_LISTED&&!t.from_url)urlhash.set("wg",e)
worldRecordCurrentWGID(e)
return null}cmd_parse.register({cmd:"waygate",help:"Warp to specified Waygate",func:function func(e,t){if(!worldMetadata())return t("Not currently in a world")
var r={listed_only:true}
if(main.chat_ui.getAccessObj().access.world_admin&&!isPlayAsViewer())r.listed_only=false
var a=waygateGo(e,r)
if(a)return t(a)
return t(null,"'Gating to "+e)}})
cmd_parse.register({cmd:"home",access_show:["sysadmin"],help:"(Hidden) Shows your currently bound Settlement ID",func:function func(e,t){t(null,"Bound Settlement ID = "+(userDataGet("home")||"undefined (default)"))}})
var waygate_set_usage="  Usage: /waygate_set wgid chunk_id pos_idx rot (imgid|NC) (settlement|NC)"
cmd_parse.register({cmd:"waygate_set",access_show:["sysadmin"],help:"(Hidden) Set a Waygate on the world metadata",prefix_usage_with_help:true,usage:waygate_set_usage,func:function func(e,a){if(!worldMetadata())return void a("Not currently in a world")
var t=e.split(" ")
var r={wgid:t[0],chunk_id:Number(t[1]),pos_idx:Number(t[2]),rot:Number(t[3])}
if(t[4]&&"NC"!==t[4])r.imgid=Number(t[4])
if(t[5]&&"NC"!==t[5])r.is_settlement="1"===t[5]
worldSend("waygate_set",r,function(e,t){if(e)return void a(e+"\n"+waygate_set_usage)
var r=t.msg
if(t.home){userDataPredict("home",t.home,true)
r+=", home set to "+t.home}a(null,r)})}})
cmd_parse.register({cmd:"world_created",help:"Show when the current world was created",func:function func(e,t){if(!worldMetadata())return void t("Not currently in a world")
var r=worldMetadata().created
var a=new Date(r)
var i=max(0,round((Date.now()-r)/1e3))
t(null,"World created at: "+dateToSafeLocaleString(a)+" ("+secondsToFriendlyString(i,true)+" ago)\nTimestamp="+r+" ("+a.toUTCString()+")")}})
cmd_parse.register({cmd:"stuck",help:"Warp someplace random nearby if available Waygates are blocked",access_run:["world_areabuilder"],func:function func(e,t){var r=unstuckBlocked()
if(r)return void t("/stuck not available: "+r)
unstuck()
t()}})
cmd_parse.register({cmd:"csr_grant",access_run:["csr"],help:"(CSR) Grant a specific entitlement to self or a user",prefix_usage_with_help:true,usage:"  Usage: /csr_grant EntitlementID [UserID] [REVOKE]\nPossible entitlements: "+Object.keys(entitlements).filter(function(e){return!e.includes("test")}).join(", "),func:function func(e,t){var r=e.split(" ")
if(r.length<1||r.length>3)return void t("Invalid number of arguments")
if(r[2]&&"REVOKE"!==r[2].toUpperCase())return void t('Third parameter must be "REVOKE" or nothing')
if(2===r.length&&"REVOKE"===r[1].toUpperCase()){r[2]=r[1]
r[1]=void 0}var a=r[0]
var i=r[1]||netSubs().loggedIn()
var o=r[2]&&"REVOKE"===r[2].toUpperCase()
if(!entitlements[a])return void t("Invalid EntitlementID")
netSubs().getChannelImmediate("user."+i).send("grant",{id:a,revoke:o},function(e){t(e,!e?(o?"Revoked":"Granted")+" "+a+" "+(o?"from":"to")+" "+i:null)})}})
var elevate_registered_connect
cmd_parse.register({cmd:"elevate",access_run:["csr"],help:"(CSR) Toggle elevated permissions level to override world access",func:function func(e,a){if(!elevate_registered_connect){elevate_registered_connect=true
netSubs().on("connect",function(){elevated=false})}var t=!elevated
netClient().send("elevate",t,null,function(e,r){if(e)return void a(e)
elevated=t
worldInfoCacheClear()
updateEditVolumes()
if(!getWorldChannel())return void a(e,r)
worldCmdParse("update_access",function(e,t){a(e,r)})})}})
cmd_parse.register({cmd:"play_as_visitor",access_run:["world_areabuilder"],help:"Toggle previewing a world as a read-only Visitor",func:function func(e,t){if(worldEnergy()&&!cmd_parse.checkAccess(["sysadmin"])&&!engine.DEBUG)return void t("Not allowed in Lost Frontier worlds")
else if(worldRaceAsVisitor()&&userDataGet("race_data"))return void t("Not allowed during a race in this world.")
playAsViewerSet(!isPlayAsViewer())
t(null,isPlayAsViewer()?"Now playing as a VISITOR":"Now NOT playing as a VISITOR")}})
cmd_parse.register({cmd:"user_attrib",access_run:["sysadmin"],help:"(Admin) Get/set user attribute",usage:"$HELP\n  Usage: /user_attrib [ATTRIB [VALUE|MAX]]\nexample: /user_attrib stamina MAX",func:function func(e,t){if(!(e=e.split(" "))[0]||e.length>2){var r=userAttribs()
var a=["Current attribs:"]
for(var i in r)a.push("  "+i+" = "+r[i])
return void t(null,a.join("\n"))}var o=e,n=o[0],s=o[1]
if(2===e.length){if("max"===s.toLowerCase())s=ATTRIB_FIXED_MAX
else s=Number(s)
if(!isFinite(s))return void t("Invalid VALUE")
var l=s-userAttribGet(n)
if(l)userAttribModBatched(n,l)}t(null,n+" = "+userAttribGet(n)+" ("+userAttribGetFixed(n).toFixed(3)+")")}})
cmd_parse.register({cmd:"energy",access_run:["sysadmin"],help:"(Admin) Get/set ⚡",usage:"$HELP\n  Usage: /energy [VALUE|MAX]",func:function func(e,t){if(e){if("max"===e.toLowerCase())e=Infinity
else e=Number(e)
var r=(e=clamp(e,0,userStaminaMax()))-userStaminaCur()
if(r)userStaminaMod(null,r)}t(null,"⚡ = "+userStaminaCur()+" / "+userStaminaMax())}})
cmd_parse.register({cmd:"quit",help:"Leave current world and return to the main menu",func:function func(e,t){if(!worldMetadata())return void t("Not currently in a world")
main.returnToMainMenu()
t()}})
cmd_parse.register({cmd:"flat_ore_type",help:"(Admin) Set ore type for flat worlds",usage:"$HELP\n  Usage: /flat_ore_type [IRON|EMBERYLLIUM|etc]\n  Usage: /flat_ore_type -1 (varies every 16 voxels)",access_run:["sysadmin"],func:function func(e,t){if(e){var r
if("-1"===e)r=-1
else{if(!(r=INV_MATERIAL_NAME[e.toUpperCase()]))return void t('Unknown material "'+e+'"')
if(MATERIAL_CLASS[r]!==MaterialClass.METAL)return void t('"'+e+'" is not a metal')}setFlatOreType(r)
taskCreate({worker:WORKER_MESH,time:0,type:"flat_ore_type",data:r},nop)
remeshAll()}t(null,"Ore type = "+(MATERIAL_NAME[getFlatOreType()]||"Varying"))}})
cmd_parse.register({cmd:"trans_compact_debug",help:"(Admin) Debug a transaction compaction error",access_run:["sysadmin"],func:function func(e,t){e=e||"<paste trans_compact_debug here>"
var r=(new TransactionSet).trans()
r.fromJSON(JSON.parse(e))
r.compact()
t(null,"No error")}})
function cmdFromDefine(t){cmd_parse.registerValue(t,{type:cmd_parse.TYPE_INT,label:t,range:[0,1],get:function get(){return engine.defines[t]?1:0},set:function set(e){return engine.defines[t]=Boolean(e)},access_show:["hidden"]})}cmd_parse.register({cmd:"ban_account",help:"(CSR) Ban the account from accessing the game",usage:"Usage: /ban_account UserID [AUTOIP] [REVOKE]",prefix_usage_with_help:true,access_run:["csr"],func:function func(e,t){var r=e.split(" ")
var a=r[0]
if(!a)return void t("Missing UserID")
var i=false
var o=false
for(var n=1;n<r.length;++n){var s=r[n].toUpperCase()
if("REVOKE"===s)i=true
else if("AUTOIP"===s)o=true
else return void t('Additional parameters must be "REVOKE" or "AUTOIP"')}netSubs().getChannelImmediate("user."+a).send("ban",{revoke:i,autoip:o},t)}})
cmd_parse.register({cmd:"photo_mode",help:"Toggle in-game Photo Mode.",func:function func(e,t){if(photoModeActive()){photoModeCancel()
return void t(null,"Exited Photo Mode")}if(!worldMetadata())return void t("Not currently in a world")
shareMenuPhotoCapture(getWorldID())
t(null,"Entered Photo Mode")}})
cmd_parse.register({cmd:"world_info",help:"View world info",func:function func(e,t){if(!e&&getWorldID())e=getWorldID()
if(!e)return void t("Usage: /world_info WORLDID")
urlhash.goRoute("w/"+e+"/info")
t()}})
cmd_parse.register({cmd:"status",help:"Push a status message",access_show:["sysadmin"],func:function func(e,t){statusPush(e)
t()}});["CHUNKMAN","DEBUGHEXOME","DEBUGCURSOR","NOLODS","NOMESHWORKERS","NOPP","NOPROPS","NOSKY","NOSUN","NOWORKERS","SKYEDIT","TRANSDELAY"].forEach(cmdFromDefine)},{"../common/entitlements":244,"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/megachunk_common":254,"../common/waygate_common":265,"../common/world_constants":267,"../common/world_trans":268,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/fscreen":317,"../glov/client/localization":330,"../glov/client/net":338,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/client/worker_comm":373,"../glov/common/md5.js":390,"../glov/common/util":400,"../glov/common/verify":401,"./app_access":12,"./editvolume_client":84,"./energy_well":85,"./inventory":114,"./items":119,"./localization/localization":131,"./main":135,"./materials":137,"./orient":148,"./photo_mode":158,"./proc_gen":162,"./race_ui":174,"./share_menu":184,"./status":193,"./stuck":196,"./task_sched":198,"./tiles":199,"./tiles_const":200,"./user_data":208,"./voxel_const":215,"./voxel_data":216,"./world_comm":226,"./world_info":229,"./world_metadata":235,assert:void 0}],44:[function(e,t,r){"use strict"
r.getGlobalEntPosData=getGlobalEntPosData
r.hasGlobalEntPosData=hasGlobalEntPosData
r.getEntityManager=getEntityManager
r.getEntityPosManager=getEntityPosManager
r.getMyEntID=getMyEntID
r.allocPerEntData=allocPerEntData
r.clientEntitiesJoinWorld=clientEntitiesJoinWorld
r.clientEntitiesSendEntJoin=clientEntitiesSendEntJoin
r.registerMovingAnim=registerMovingAnim
r.clientEntitiesStartup=clientEntitiesStartup
r.getEntityToDebug=getEntityToDebug
r.setEntityToDebug=setEntityToDebug
r.clientEntitiesTick=clientEntitiesTick
r.clientEntitiesTickLate=clientEntitiesTickLate
r.clientEntityForUser=clientEntityForUser
r.adminWantsNoEntity=adminWantsNoEntity
r.MAX_INTERP_DIST_SQ=r.POS_BLEND_TIME=void 0
var a=1e4
r.POS_BLEND_TIME=a
var m=e("assert")
var i=e("../glov/client/cmds").cmd_parse
var E=e("../glov/client/engine").getFrameTimestamp
var o=e("../glov/client/entity_manager_client").clientEntityManagerCreate
var n=e("../glov/client/entity_position_manager")
var s=n.PerEntData
var l=n.entityPositionManagerCreate
var _=e("../glov/client/net.js").netSubs
var c=e("../glov/common/verify")
var u=e("../glov/common/vmath.js")
var g=u.v3distSq
var T=u.vec3
var d=e("../common/entity_worlds_common.js")
var f=d.ENT_TOL_POS
var v=d.ENT_TOL_ROT
var h=e("../common/globals.js").CHUNK_SIZE
var p=e("../common/items_common").sameItem
var y=e("../common/world_trans.js").decodeWorldPos
var S=e("./ai.js").aiTick
var I=e("./debug").debugAddObject
var A=e("./entity_traits_client")
var w=A.entFactory
var L=A.entityTraitsClientStartup
var O=e("./entity_worlds_client").ENTITY_DEBUG_SKIP
var R=e("./world_comm")
var b=R.getWorldChannel
var N=R.worldCmdParse
var C
var x
var M=65536
r.MAX_INTERP_DIST_SQ=M
var D=null
function getGlobalEntPosData(){return D}function hasGlobalEntPosData(e){return Boolean(D&&D[e])}function getEntityManager(){return C}function getEntityPosManager(){return x}function getMyEntID(){return C.getMyEntID()}function allocPerEntData(){return new s(x)}var P=false
function clientEntitiesJoinWorld(e){C.reinit({channel:e})
x.reinit()
D=null
P=false}function clientEntitiesSendEntJoin(e){m(!P)
P=true
b().send("ent_join",e,function(e){if(e)console.warn("Received error response to ent_join: "+e)})}function onEntUpdate(e){var t=C.getEnt(e)
m(t)
var r=t.draw_data
if(!r)return
r.last_receive_time=E()
if(r.last_costume!==t.data.costume){r.last_costume=t.data.costume
r.costume_mod++}}var B={}
function registerMovingAnim(e){B[e]=true}function animIsStopped(e){return!B[e]}function entityPositionManagerErrorHandler(e){if("ERR_FAILALL_DISCONNECT"!==e&&"ERR_NO_ENTITY"!==e){console.error(new Error(e))
c(false,e)}}var k=8*h+8
function onGlobalEntPosDiff(e,t){if(!D){e.pool()
return}var r=e.readInt()
for(var a=0;a<r;++a){var i=e.readInt()
var o=e.readAnsiString()
var n=e.readInt()
var s=D[i]
if(s){m(s.deleted_at)
m.equal(s.client_id,o)
s.deleted_at=0
s.first_seen=E()}else s=D[i]={client_id:o,chunk_id:n,pos:T(),first_seen:E(),last_seen:0,deleted_at:0}
y(s.pos,n,k)}var l=e.readInt()
for(var _=0;_<l;++_){var c=e.readInt()
var u=e.readInt()
var d=D[c]
m(d)
if(!d.blends)d.blends=[]
d.blends.push({pos:d.pos.slice(0),t0:E()})
y(d.pos,u,k)
if(g(d.pos,d.blends[d.blends.length-1].pos)>M)d.blends=void 0}var f=e.readInt()
for(var v=0;v<f;++v){var h=e.readInt()
var p=D[h]
m(p)
p.deleted_at=E()}}function onGlobalEntPosFull(e,t){D={}
onGlobalEntPosDiff(e,t)}var U
function entCreate(e){var t=e.type
m("string"===typeof t)
return U.allocate(t,e)}function clientEntitiesStartup(){L()
U=w();(C=o({channel_type:"world",create_func:entCreate})).on("ent_update",onEntUpdate)
x=l({entity_manager:C,dim_pos:3,dim_rot:3,tol_pos:f,tol_rot:v,anim_state_defs:{anim:{stopped:animIsStopped},anim_secondary:{stopped:animIsStopped},held_item:{equal:p}},error_handler:entityPositionManagerErrorHandler})
_().onChannelMsg("world","gent_diff",onGlobalEntPosDiff)
_().onChannelMsg("world","gent_full",onGlobalEntPosFull)}var G=0
function getEntityToDebug(){return G}function setEntityToDebug(e){G=e}function clientEntitiesTick(){C.tick()
S()
var e=C.getEnt(G)
if(e)I(e,"Entity Debug",O)}function clientEntitiesTickLate(){C.actionListFlush()}function clientEntityForUser(e){var t=C.entities
for(var r in t){var a=t[r]
if(a.is_player&&a.data.user_id===e)return a}return null}var F=false
i.registerValue("admin_entity",{type:i.TYPE_INT,help:"(CSR) Have a player avatar or not (invisible)",access_run:["csr"],range:[0,1],get:function get(){return F?0:1},set:function set(e){F=!e
if(b())N("world_admin_no_ent "+(F?1:0))}})
function adminWantsNoEntity(){return F}},{"../common/entity_worlds_common.js":246,"../common/globals.js":248,"../common/items_common":251,"../common/world_trans.js":268,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/entity_manager_client":308,"../glov/client/entity_position_manager":309,"../glov/client/net.js":338,"../glov/common/verify":401,"../glov/common/vmath.js":402,"./ai.js":5,"./debug":73,"./entity_traits_client":86,"./entity_worlds_client":87,"./world_comm":226,assert:void 0}],45:[function(e,t,r){"use strict"
r.contextSetThreadName=contextSetThreadName
r.contextThreadName=contextThreadName
r.contextSetDebug=contextSetDebug
r.contextDebug=contextDebug
r.setAccessPrerelease=setAccessPrerelease
r.getAccessPrerelease=getAccessPrerelease
var a="main"
function contextSetThreadName(e){a=e}function contextThreadName(){return a}var i=false
function contextSetDebug(e){i=e}function contextDebug(){return i}var o=false
function setAccessPrerelease(e){o=e}function getAccessPrerelease(){return o}},{}],46:[function(e,t,r){"use strict"
r.continentSeed=continentSeed
r.continentHandleData=continentHandleData
r.continentGetIDs=continentGetIDs
r.continentGetID=continentGetID
r.continentGet=continentGet
r.continentReady=continentReady
var d=e("assert")
var a=e("./continent_serialize.js").continentDeserialize
var i=e("../common/globals.js").ID_FACTOR
var h=Math.abs,o=Math.floor,f=Math.max,p=Math.min,n=Math.round
var s=e("./proc_gen_biomes.js").getContinentIDsForPos
var l=e("./proc_gen_constants.js").HEX_HEIGHT
var _=e("../glov/common/vmath.js").v2set
var c=256
var m=.25
var u
var E=new Uint8Array(c*c)
var g=[[c,1,1-c,-c,-1-c,-1],[c,1+c,1,-c,-1,-1+c]]
function Continent(e,t){this.cid=e
var r=n(e/i)
var a=e-r*i
this.width=c
this.height=c
this.hx=a*c
this.hy=r*c
this.init(t)}Continent.prototype.init=function(e){var t=e.elev,r=e.humidity,a=e.river,i=e.max_elevation,o=e.sea_level,n=e.water_level,s=e.classif
d(t instanceof Uint16Array)
d(r instanceof Uint8Array)
d(a instanceof Uint8Array)
d(s instanceof Uint8Array)
var l=this.total_size=c*c
this.land_range=i-o
this.max_elevation=(i-o)*m
this.water_level_source=n
this.water_level=new Uint16Array(l)
this.elev_source=t
this.elev=new Float32Array(l)
this.humidity=r
this.river=a
this.classif=s
d.equal(l,this.elev.length)
d.equal(l,this.humidity.length)
d.equal(l,this.river.length)
this.coast_distance=new Uint8Array(l)
this.flow=new Uint8Array(l)
this.default_water_level=0
this.calcElevation(o)
this.findCoast()
this.generateDF()
this.calcSlopes()
this.calcFlow()}
Continent.prototype.calcFlow=function(){var e=this.total_size,_=this.flow,c=this.river
function fillStrahler(e,t){var r=c[e]
var a=[]
for(var i=0;i<6;++i)if(i!==t&&r&1<<i)a.push(i)
var o
if(!a.length)o=1
else{var n=g[1&e]
if(1===a.length)o=fillStrahler(e+n[a[0]],(a[0]+3)%6)
else{d.equal(a.length,2)
var s=fillStrahler(e+n[a[0]],(a[0]+3)%6)
var l=fillStrahler(e+n[a[1]],(a[1]+3)%6)
if(s===l)o=s+1
else o=f(s,l)}}_[e]=p(o,31)<<3|t
return o}var t=[]
for(var r=0;r<e;++r){var a=c[r]
if(!a)continue
var i=g[1&r]
var o=false
for(var n=0;n<i.length;++n)if(a&1<<n){var s=r+i[n]
if(!c[s]){d(!o)
o=true
var l=fillStrahler(r,n)
_[s]=l<<3|7}}}for(var u=0;u<t.length;++u)_[t[u]]=7}
Continent.prototype.calcElevation=function(e){var t=this.total_size,r=this.elev_source,a=this.elev,i=this.water_level,o=this.water_level_source
for(var n=0;n<t;++n){a[n]=(r[n]-e)*m+this.default_water_level
var s=o[n]
i[n]=(s?(s-e)*m:0)+this.default_water_level}}
Continent.prototype.findCoast=function(){var e=this.total_size,t=this.elev,r=this.default_water_level
var a=this.coast=[]
for(var i=0;i<e;++i)if(t[i]>=r){var o=g[1&i]
var n=false
for(var s=0;s<o.length;++s)if(t[i+o[s]]<r){n=true
break}if(n)a.push(i)}}
Continent.prototype.generateDF=function(){E.fill(0)
var e=this.coast,t=this.coast_distance,r=this.width,a=this.height
var i=e
var o=0
for(var n=0;n<i.length;++n){var s=i[n]
t[s]=o
E[s]=1}while(i.length){o=p(o+1,255)
var l=[]
for(var _=0;_<i.length;++_){var c=i[_]
var u=g[1&c]
for(var d=0;d<u.length;++d){var f=c+u[d]
if(!E[f]){E[f]=1
t[f]=o
var v=c%r
var h=(c-v)/r
if(!v||!h||v===r-1||h===a-1);else l.push(f)}}}i=l}t[0]=p(t[1]+1,255)
t[this.total_size-1]=p(t[this.total_size-2]+1,255)}
function calcSlope(e,t,r){if(t-e<0&&r-t>0)return 0
return(r-e)/(2*l)}Continent.prototype.calcSlopes=function(){var e=this.total_size,t=this.elev,r=this.width,a=this.height
var i=this.slopes=new Float32Array(4*e)
var o=4/m/this.land_range
for(var n=1;n<a-1;++n)for(var s=1;s<r-1;++s){var l=n*r+s
var _=t[l]
var c=g[1&l]
var u=0
for(var d=0;d<3;++d){var f=t[l+c[d+3]]
var v=t[l+c[d]]
u+=h(f-_)
u+=h(v-_)
i[4*l+d]=calcSlope(f,_,v)}i[4*l+3]=u*o}}
Continent.prototype.getHumidity=function(e){return this.humidity[e]/255}
Continent.prototype.getElevation=function(e){return this.elev[e]}
Continent.prototype.getClassif=function(e){return this.classif[e]}
Continent.prototype.getRiver=function(e){return this.river[e]}
Continent.prototype.getFlowDir=function(e){return 7&this.flow[e]}
Continent.prototype.getFlowAmount=function(e){return this.flow[e]>>3}
Continent.prototype.getWaterLevel=function(e){return this.water_level[e]-1}
Continent.prototype.getCoastDistance=function(e){return this.coast_distance[e]/(this.width+this.height)}
Continent.prototype.getSlopes=function(e){return this.slopes.slice(4*e,4*e+4)}
Continent.prototype.getMinElev=function(e){var t=g[1&e]
var r=this.elev
var a=r[e]
for(var i=0;i<t.length;++i)a=p(r[e+t[i]],a)
return a}
function continentSeed(e){u={}}function continentHandleData(e){for(var t=0;t<e.length;++t){var r=e[t]
d.equal(typeof r.cid,"number")
d(!u[r.cid])
d(r.buffer instanceof Uint8Array)
u[r.cid]=new Continent(r.cid,a(r.buffer))}}Continent.prototype.getMidpointHexomePos=function(e){var t=o(this.width/2)
var r=this.hx+t
var a=o(this.hy+this.height/2+t/2)
return _(e,r,a)}
function continentGetIDs(e,t){t-=o((e+1)/2)
var r=o(e/c)
var a=o(t/c)
return{cid:r+a*i,idx:e-r*c+(t-a*c)*c}}function continentGetID(e,t){t-=o((e+1)/2)
return o(e/c)+o(t/c)*i}function continentGet(e){var t=u[e]
d(t)
return t}var v=[]
function continentReady(e,t){var r=s(v,e,t)
for(var a=0;a<r;++a){var i=v[a]
if(!u[i])return false}return true}},{"../common/globals.js":248,"../glov/common/vmath.js":402,"./continent_serialize.js":48,"./proc_gen_biomes.js":163,"./proc_gen_constants.js":164,assert:void 0}],47:[function(e,t,r){"use strict"
r.continentLoaderProvideC0=continentLoaderProvideC0
r.continentLoadsWaiting=continentLoadsWaiting
r.continentLoaderLeaveWorld=continentLoaderLeaveWorld
r.continentLoaderSeedWorld=continentLoaderSeedWorld
r.continentLoaderReady=continentLoaderReady
r.continentLoaderWhenReady=continentLoaderWhenReady
r.continentLoaderReadyChunkPos=continentLoaderReadyChunkPos
r.continentLoaderWhenReadyChunkPos=continentLoaderWhenReadyChunkPos
var _=e("./localization/localization").L
var c=e("assert")
var a=e("../common/async_dictionary.js").createAsyncDictionary
var i=e("../glov/client/error_report.js").errorReportSetDetails
var u=e("./file_management.js").upload
var o=e("../common/globals.js").CHUNK_SIZE
var d=e("./loading_custom.js").loadingCustomSetMessage
var n=e("../glov/client/net.js"),f=n.netClient,v=n.netSubs
var h=e("./proc_gen_biomes.js").getContinentIDsForPos
var s=e("../glov/common/rand_alea.js").mashString
var l=e("./task_sched.js"),p=l.workerFlush,m=l.taskCreate,E=l.WORKER_GEN
var g=e("./user_data.js").worldReadOnly
var T=e("../glov/common/vmath.js"),y=T.vec2,S=T.v2scale
var I=e("./voxel_gen.js").voxelGenQueueContinentData
var A=e("./world_comm.js"),w=A.whenConnected,L=A.getWorldID,O=A.getWorldChannel
var R=0
var b=false
var N
var C
function continentLoaderProvideC0(e){C=e}function onlyOne(r){var a=false
var i=[]
function onDone(){c(a)
if(!i.length){a=false
return}var e=i.splice(0,1)[0]
r.apply(null,e)}return function(){var e=Array.prototype.slice.call(arguments,0)
var t=e[e.length-1]
e[e.length-1]=function(){onDone()
t.apply(void 0,arguments)}
if(a){i.push(e)
return}a=true
r.apply(null,e)}}function continentGen(e,t,r){if(0===e&&C){i("modapi_cdata",1)
return void r(C,true)}m({worker:E,type:"gen_continent",data:{seed:t}},r)
p(E)}function continentSeed(e){return s(N+"_"+e)}var x="ERR_RESET"
function loadContinentData(o,n){var s=L()
c.equal(typeof s,"string")
var l=R
function handleData(e){I({buffer:e,cid:o})
n(null,{})}var t=5
function doAttempt(e){if(l!==R)return void n(x)
if(!--t)throw e
profilerStart("loadContinentData:doAttempt")
console.log("world_id:"+s+", continent:"+o+", loading...")
function doGen(){d(_.CONTINENT_LOADER_NEW)
console.log("world_id:"+s+", continent:"+o+", generating...")
continentGen(o,continentSeed(o),function(a,i){if(l!==R)return void n(x)
if(g()){d(_.CONTINENT_LOADER_COMPLETE,true)
return void handleData(a)}d(_.CONTINENT_LOADER_SYNCING)
console.log("world_id:"+s+", continent:"+o+", uploading...")
u({u8:a,mime_type:"application/x-continent-data"},function(e,t){if(e){console.error("Error uploading continent data to server",e)
return void doAttempt(e)}console.log("world_id:"+s+", continent:"+o+", sending to world...")
var r=f().pak("world_continent_save")
r.writeString(s)
r.writeInt(o)
r.writeInt(t)
r.writeBool(i)
r.send(function(e){if(l!==R)return void n(x)
if(e){console.error("Error setting continent data on world worker",e)
return void doAttempt(e)}console.log("world_id:"+s+", continent:"+o+", generation complete!")
d(_.CONTINENT_LOADER_COMPLETE,true)
handleData(a)})})})}w(function(){if(l!==R)return void n(x)
c.equal(L(),s)
var e=O().pak("world_continent_load")
e.writeInt(o)
e.send(function(e,t){var r
if(t&&"number"===typeof t)r=v().uploadGetFile(t)
if(l!==R)return void n(x)
if(e){console.log("world_id:"+s+", continent:"+o+":",e)
if("ERR_CONTINENT_NEED_GEN"===e)return void doGen()
setTimeout(doAttempt.bind(null,e),250)
return}console.log("world_id:"+s+", continent:"+o+", received file #"+t)
c(!r.err,r.err)
handleData(r.buffer)})})
profilerStop("loadContinentData:doAttempt")}doAttempt()}var M=onlyOne(function(e,t,r){if(e!==R)return void r(x)
loadContinentData(t,r)})
var D=a({loader:function loader(e,t){M(R,e,t)}})
function continentReady(e){if(!b)return true
return Boolean(D.get(e))}function continentLoadsWaiting(){return D.numLoading()}function continentLoaderLeaveWorld(){++R
D.reset()}function continentLoaderSeedWorld(e){b="flat"!==e.world_type
N=e.seed;++R
D.reset()}var P=[]
function continentLoaderReady(e,t){if(!b)return true
var r=h(P,e,t)
for(var a=0;a<r;++a)if(!continentReady(P[a]))return false
return true}function clwrOnReady(e){if(--e.waiting)return
profilerStart("continentLoaderWhenReady:cb")
e.cb()
profilerStop()}var B=[]
function continentLoaderWhenReady(e,t,r){if(!b)return void r()
var a=h(B,e,t)
var i=0
var o
var n
for(var s=0;s<a;++s){var l=B[s]
if(!D.get(l)){i++
if(!o)o=clwrOnReady.bind(null,n={cb:r})
D.get(l,o)}}if(i)n.waiting=i
else r()}var k=y()
function continentLoaderReadyChunkPos(e,t){S(k,e,o)
return continentLoaderReady(k,t)}function continentLoaderWhenReadyChunkPos(e,t,r){S(k,e,o)
continentLoaderWhenReady(k,t,r)}},{"../common/async_dictionary.js":238,"../common/globals.js":248,"../glov/client/error_report.js":311,"../glov/client/net.js":338,"../glov/common/rand_alea.js":395,"../glov/common/vmath.js":402,"./file_management.js":98,"./loading_custom.js":128,"./localization/localization":131,"./proc_gen_biomes.js":163,"./task_sched.js":198,"./user_data.js":208,"./voxel_gen.js":219,"./world_comm.js":226,assert:void 0}],48:[function(e,t,r){"use strict"
r.encodeRLEZeroes=encodeRLEZeroes
r.encodeRLEU2=encodeRLEU2
r.encodeRLEU3=encodeRLEU3
r.encodeRLEDict=encodeRLEDict
r.encodeDeltaPakInt=encodeDeltaPakInt
r.continentSerialize=continentSerialize
r.continentDeserialize=continentDeserialize
var l=e("assert")
var a=e("../glov/common/packet.js"),_=a.packetCreate,c=a.packetFromBuffer,u=a.PACKET_DEBUG
var d=2
var i=1
var o=2
var n=3
var s=4
var f=5
var v=["elev","water_level","humidity","river","classif"]
var h={elev:i,water_level:o,humidity:i,river:n,classif:f}
var p={elev:i,water_level:o,humidity:i,river:n,classif:s}
var m={elev:Uint16Array,water_level:Uint16Array,humidity:Uint8Array,river:Uint8Array,classif:Uint8Array}
function encodeRLEZeroes(e,t){var r=t.length
var a=0
for(var i=0;i<r;++i){var o=t[i]
if(o){if(a){e.writeInt(a)
a=0}e.writeInt(o)}else{if(!a)e.writeInt(o)
a++}}if(a)e.writeInt(a)}function decodeRLEZeroes(e,t){var r=0
while(r<e.length){var a=t.readInt()
var i=1
if(!a)i=t.readInt()
l(r+i<=e.length)
for(var o=0;o<i;++o)e[r++]=a}}function encodeRLEU2(t,e){var r=e[0]
var a=e.length
var i=0
function writecv(){var e=r<<6|i
t.writeU8(e)}for(var o=1;o<a;++o)if(e[o]!==r||63===i){writecv()
i=0
r=e[o]}else i++
writecv()}function encodeRLEU3(t,e){var r=e[0]
var a=e.length
var i=0
function writecv(){var e=r<<5|i
t.writeU8(e)}for(var o=1;o<a;++o)if(e[o]!==r||31===i){writecv()
i=0
r=e[o]}else i++
writecv()}function decodeRLEU2(e,t){var r=0
while(r<e.length){var a=t.readU8()
var i=1+(63&a)
a>>>=6
l(r+i<=e.length)
for(var o=0;o<i;++o)e[r++]=a}}function decodeRLEU3(e,t){var r=0
while(r<e.length){var a=t.readU8()
var i=1+(31&a)
a>>>=5
l(r+i<=e.length)
for(var o=0;o<i;++o)e[r++]=a}}function encodeRLEDict(t,e){var r=e[0]
var a=e.length
var i=0
var o=[]
var n=0
function writecv(){t.writeInt(i)
var e=o[r]
if(void 0!==e)t.writeInt(e)
else{e=o[r]=n++
t.writeInt(e)
t.writeInt(r)}}for(var s=1;s<a;++s)if(e[s]!==r){writecv()
i=0
r=e[s]}else i++
writecv()}function decodeRLEDict(e,t){var r=0
var a=[]
while(r<e.length){var i=t.readInt()+1
var o=t.readInt()
var n=a[o]
if(void 0===n)n=a[o]=t.readInt()
l(r+i<=e.length)
for(var s=0;s<i;++s)e[r++]=n}}function encodeDeltaPakInt(e,t){var r=124
var a=t.length
for(var i=0;i<a;++i){var o=t[i]-r+124
e.writeInt(o)
r=t[i]}}function decodeDeltaPakInt(e,t){var r=e.length
var a=124
for(var i=0;i<r;++i){a+=t.readInt()-124
e[i]=a}}function encodeToPacket(e,t,r){switch(t){case i:encodeDeltaPakInt(e,r)
break
case o:encodeRLEDict(e,r)
break
case n:encodeRLEZeroes(e,r)
break
case s:encodeRLEU2(e,r)
break
case f:encodeRLEU3(e,r)
break
default:l()}}function decodeFromPacket(e,t,r){switch(t){case i:decodeDeltaPakInt(e,r)
break
case o:decodeRLEDict(e,r)
break
case n:decodeRLEZeroes(e,r)
break
case s:decodeRLEU2(e,r)
break
case f:decodeRLEU3(e,r)
break
default:l()}}var E=227
function continentSerialize(t,e){var r=t.sea_level,a=t.max_elevation
var i=t.elev.length
var o=_(e?u:0,4*i)
o.writeFlags()
o.writeInt(d)
o.writeInt(r)
o.writeInt(a)
o.writeInt(i)
v.forEach(function(e){l(t[e]instanceof m[e])
o.writeInt(E)
o.writeInt(h[e])
encodeToPacket(o,h[e],t[e])})
o.makeReadable()
var n=o.getBufferLen()
var s=o.getBuffer().slice(0,n)
o.pool()
return s}function continentDeserialize(e){var i={}
var o=c(e,e.length,false)
o.readFlags()
var n=o.readInt()
i.sea_level=o.readInt()
i.max_elevation=o.readInt()
var s=o.readInt()
l(s<=262144)
v.forEach(function(e){var t=o.readInt()
l.equal(t,E)
var r=m[e]
var a=i[e]=new r(s)
if(n>1)decodeFromPacket(a,o.readInt(),o)
else decodeFromPacket(a,p[e],o)})
return i}},{"../glov/common/packet.js":392,assert:void 0}],49:[function(e,t,r){"use strict"
r.movementShared=movementShared
r.rotationShared=rotationShared
r.updateFacing=updateFacing
r.DOWN=r.UP=void 0
var a=e("../glov/common/vmath.js")
var c=a.v2add
var u=a.v2lengthSq
var d=a.v2scale
var f=a.v2set
var v=a.v2sub
var i=a.v3cross
var o=a.v3iNormalize
var n=a.v3same
var s=a.v3zero
var l=a.vec2
var _=a.vec3
var h=a.zero_vec
var p=_(0,0,1)
r.UP=p
var m=_(0,0,-1)
r.DOWN=m
var E=e("../glov/client/camera2d.js")
var g=e("../glov/client/cmds.js").cmd_parse
var T=e("../glov/client/engine.js")
var y=e("../glov/client/input.js")
var S=e("../glov/client/input.js")
var I=S.KEYS
var A=S.PAD
var w=e("../glov/client/settings")
var L=e("../glov/client/ui")
var O=L.buttonImage
var R=L.buttonTextDraw
var b=L.drawCircle
var N=L.uiButtonHeight
var C=e("../glov/common/util.js").defaults
var x=e("./base_controller.js")
var M=x.isDoubleJumpToFlyController
var D=x.isFlyingController
var P=x.isJumpingController
var B=e("./layout.js")
var k=B.TC_DPAD_BOT_PAD
var U=B.TC_DPAD_LEFT_PAD
var G=B.TC_DPAD_RADIUS
var F=B.TC_VERTBUTTONS_FH
var W=B.TC_VERTBUTTONS_H
var H=B.TC_VERTBUTTONS_W
var z=B.quickbarOnRight
var V=e("./localization/localization").L
var Y=e("./main.js").isQuickbarVisible
var j=e("./main.js")
var K=e("./quickbar.js").quickbarPadLeft
var q=e("./styles.js")
var X=q.color_touch_dpad_border
var Q=q.color_touch_dpad_cursor
var $=q.color_touch_sprint_active
var J=q.color_touch_sprint_inactive
var ee=q.touch_jump_button_colors
var te=e("./ui_util.js")
var re=e("./user_data.js").flyingAllowed
var ae=Math.abs,ie=Math.cos,oe=Math.min,ne=Math.round,se=Math.sin,le=Math.sqrt,_e=Math.PI
var ce={AUTO:0,LOOK:1,HYBRID:2,MOVE:3}
var ue=_()
var de=_()
var fe={in_event_cb:y.pointerLockEnter}
function lockPointerOnMovement(){if(!y.pointerLocked()){y.keyDownEdge(I.W,fe)
y.keyDownEdge(I.A,fe)
y.keyDownEdge(I.S,fe)
y.keyDownEdge(I.D,fe)
y.keyDownEdge(I.LEFT,fe)
y.keyDownEdge(I.RIGHT,fe)
y.keyDownEdge(I.UP,fe)
y.keyDownEdge(I.DOWN,fe)}}var ve=0
function arrowsDoVertMovement(){if(w.arrows_mode===ce.AUTO)return!ve||ve<T.frame_timestamp-15e3
return w.arrows_mode!==ce.LOOK}function arrowsDoHorizMovement(){return w.arrows_mode===ce.MOVE}function handleMovementKeyInput(e,t){lockPointerOnMovement()
e[0]=(y.keyDown(I.D)-y.keyDown(I.A))/t
e[1]=(y.keyDown(I.W)-y.keyDown(I.S))/t
if(e[0]||e[1])ve=T.frame_timestamp
if(arrowsDoHorizMovement())e[0]+=(y.keyDown(I.RIGHT)-y.keyDown(I.LEFT))/t
if(arrowsDoVertMovement())e[1]+=(y.keyDown(I.UP)-y.keyDown(I.DOWN))/t
e[0]*=w.kb_speed
e[1]*=w.kb_speed
y.padGetAxes(ue,0)
e[0]+=ue[0]
e[1]+=ue[1]}function handleSprintInput(e,t){t.sprinting=y.keyDown(I.SHIFT)+y.padButtonDown(A.LT)
if(y.keyDownEdge(I.EQUALS))e.auto_run=!e.auto_run
if(e.auto_run)if(ae(t[0])+ae(t[1])>.1)e.auto_run=false
else{t.sprinting=1
t[1]++}}var he=96
function touchDPadControls(e,t,r,a,i){if(!T.defines.NOUI)b(r,a,Z.UI,i,.99,X)
var o=y.drag({x:r-i,y:a-i,w:2*i,h:2*i,eat_clicks:true})
var n=false
if(o){v(de,o.cur_pos,[r,a])
d(de,de,1/i)
n=de[1]<-1.5
if(de[1]<-1&&!T.defines.NOUI)O({x:r-he/2,y:a-2*i,w:he,h:he,img:te.sprite,frame:te.SPRINT,shrink:1,draw_only:true,color:n?$:J})
d(de,de,2)
var s=u(de)
if(s>1)d(de,de,1/le(s))
var l=.25*i
var _=i-l
b(r+de[0]*_,a+de[1]*_,Z.UI+1,l,.99,Q)
de[1]*=-1}else f(de,0,0)
c(e,e,de)
e.sprinting=(e.sprinting||0)+(n?t:0)}function touchModeMovement(e,t,r,a){var i=D(e)&&e.isAerial()
touchDPadControls(t,r,U+K(),E.h()-k,G)
var o=E.w()-H
if(Y()&&z())o-=N()
var n={x:o,y:E.h()-W,w:H,h:W,eat_clicks:true,z:Z.UI,font_height:F,text:(i?V.BTN_UP:V.BTN_JUMP).upper(),colors:ee}
var s=y.drag(n)
if(M(e)&&s&&s.is_down_edge)a.num+=s.is_down_edge
var l
var _=W-10
if(i)l=n.y+(_*=.5)
var c
var u
if(s)if(s.cur_pos[0]>=n.x&&s.cur_pos[0]<=n.x+n.w)if(l&&s.cur_pos[1]>=l){c="down";--t[2]}else if(s.cur_pos[1]>=n.y){u="down"
t[2]+=1}n.h=_
n.w-=10
if(i){var d=C({y:l,text:V.BTN_DOWN.upper()},n)
if(!T.defines.NOUI)R(d,c||"regular",false)}else if(P(e)){n.y+=20
n.h-=40
if(e.jump_time)u="down"
else if(e.jump_ok)u="regular"
else u="disabled"}if(!T.defines.NOUI)R(n,u||"regular",false)
while(M(e)&&(s=y.drag(n)))a.num+=s.is_down_edge}var pe=400
var me=6
function checkDoubleJump(e,t){t.num+=y.keyDownEdge(I.SPACE)+y.padButtonDownEdge(A.A)
if(t.num&&re()){var r=Date.now()
for(var a=0;a<t.num;++a)if(r-e.jump_last_tap_time<pe||T.frame_index-e.jump_last_tap_frame<me){e.flying=!e.flying
e.jump_last_tap_time=e.jump_last_tap_frame=0
e.just_toggled_flying=true}else{e.jump_last_tap_time=r
e.jump_last_tap_frame=T.frame_index}}}function handleVerticalInput(e,t,r){t[2]+=(y.keyDown(I.SPACE)*w.kb_speed||y.padButtonDown(A.A))/r
if(D(e)&&e.isAerial()){var a
if(w.ctrl_disable)a=(y.keyDown(I.C)?!y.keyDown(I.CTRL)&&y.keyDown(I.C):0)||0
else a=y.keyDown(I.C)+y.keyDown(I.CTRL)
a*=w.kb_speed
t[2]-=(a+y.padButtonDown(A.B))/r}}var Ee=_()
var ge={num:0}
function movementShared(e,t,r){e.user_active=false
s(Ee)
if(!r){Ee.sprinting=0
e.auto_run=false
return Ee}handleMovementKeyInput(Ee,t)
handleSprintInput(e,Ee)
Ee[2]=0
ge.num=0
if(y.touch_mode&&!j.chat_ui.isFocused())touchModeMovement(e,Ee,t,ge)
var a=u(Ee)
if(a>1)d(Ee,Ee,1/le(a))
if(M(e))checkDoubleJump(e,ge)
handleVerticalInput(e,Ee,t)
if(!n(Ee,h))e.user_active=true
return Ee}w.register({kb_sensitivity:{label:"Keyboard turn sensitivity",default_value:1,type:g.TYPE_FLOAT,range:[0,10]},kb_speed:{label:"Keyboard movement speed",default_value:1,type:g.TYPE_FLOAT,range:[0,1]},pad_sensitivity:{label:"Gamepad turn sensitivity",default_value:1,type:g.TYPE_FLOAT,range:[0,10]},arrows_mode:{label:"Arrow keys control movement or rotation",default_value:ce.AUTO,type:g.TYPE_INT,enum_lookup:ce}})
var Te=Date.now()
var ye=0
var Se=0
var Ie=0
var Ae=0
var we=0
var Le=0
g.registerValue("yaw_log",{type:g.TYPE_INT,range:[0,1],get:function get(){return Le},set:function set(e){return Le=e}})
var Oe=.0025
var Re=.002
var be=.003
var Ne=.001
var Ce=l()
var xe=l()
var Me=70
var De=Me/2
g.registerValue("drag_edge",{label:"Rotate on edge drag area",help:"Set or display how much of the edge of the screen rotates on touch controls",usage:"Set or display what percentage of the edge of the screen causes rotation\nwhen dragged over on touch controls.  Default = 7.\n  Usage: /drag_edge\n  Usage: /drag_dege [0-25]",type:g.TYPE_INT,range:[0,25],get:function get(){return ne(Me/10)},set:function set(e){De=(Me=10*e)/2},store:true})
var Pe=0
function rotationShared(e,t){f(xe,0,0)
var r=y.drag({peek:true,button:y.touch_mode?y.ANY:y.POINTERLOCK})
if(r&&y.touch_mode&&y.drag({peek:true,not_touch_id:r.touch_id}))r=null
if(r){xe[0]+=r.delta[0]*Oe*w.mouse_sensitivity
xe[1]+=r.delta[1]*Oe*w.mouse_sensitivity
if(y.touch_mode){var a=0
if(r.cur_pos[0]<Me){if(1&Pe)a-=oe(1,(Me-r.cur_pos[0])/De)}else Pe|=1
if(r.cur_pos[0]>E.x1()-Me){if(2&Pe)a+=oe(1,(r.cur_pos[0]-(E.x1()-Me))/De)}else Pe|=2
var i=0
if(r.cur_pos[1]<Me){if(4&Pe)i-=oe(1,(Me-r.cur_pos[1])/De)}else Pe|=4
if(r.cur_pos[1]>E.y1()-Me){if(8&Pe)i+=oe(1,(r.cur_pos[1]-(E.y1()-Me))/De)}else Pe|=8
xe[0]+=t*Ne*a
xe[1]+=t*Ne*i}}else Pe=0
var o=Re*w.kb_sensitivity
if(!arrowsDoHorizMovement()){xe[0]-=o*y.keyDown(I.LEFT)
xe[0]+=o*y.keyDown(I.RIGHT)}if(!arrowsDoVertMovement()){var n=o*y.keyDown(I.DOWN)-o*y.keyDown(I.UP)
if(n){xe[1]+=n
ve=T.frame_timestamp}}y.padGetAxes(Ce,1)
xe[0]+=w.pad_sensitivity*be*Ce[0]*t
xe[1]+=w.pad_sensitivity*be*-Ce[1]*t
if(xe[0]||xe[1]){e.user_active=true
c(xe,xe,e.ypr)
e.updateYawPitch(xe)}if(Le){var s=e.ypr[0]-ye
if(s<-_e)s+=2*_e
else if(s>_e)s-=2*_e
var l=Date.now()
t=l-Te
Te=l
ye=e.ypr[0]
we+=t
Ie+=s
Ae+=y.debugGetMouseMoveX()
if(Ie&&we>250){j.chat_ui.addChat((Ie/we*1e3).toFixed(3)+" yaw/s, "+(Ae/we).toFixed(3)+" px/ms, "+(T.frame_index-Se)+" frames, "+we+"ms")
Ie=we=Ae=0
Se=T.frame_index}}}function updateFacing(e){var t=ie(-e.ypr[1])
e.facing[0]=se(e.ypr[0])*t
e.facing[1]=ie(e.ypr[0])*t
e.facing[2]=se(-e.ypr[1])
i(e.char_right,e.facing,p)
o(e.char_right)
i(e.char_up,e.char_right,e.facing)
o(e.char_up)}},{"../glov/client/camera2d.js":295,"../glov/client/cmds.js":298,"../glov/client/engine.js":305,"../glov/client/input.js":326,"../glov/client/settings":351,"../glov/client/ui":367,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./base_controller.js":20,"./layout.js":120,"./localization/localization":131,"./main.js":135,"./quickbar.js":172,"./styles.js":197,"./ui_util.js":205,"./user_data.js":208}],50:[function(e,t,r){"use strict"
r.hasAutoCrouchComponent=hasAutoCrouchComponent
r.AutoCrouchComponent=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var l=e("assert")
var a=e("../../glov/common/vmath.js")
var _=a.v3addScale
var c=a.vec3
var u=a.zaxis
function hasAutoCrouchComponent(e){return Boolean(e.auto_crouch_comp)}var i=function(s){_inheritsLoose(AutoCrouchComponent,s)
function AutoCrouchComponent(e,t,r,a,i){var o;(o=s.call(this,e)||this).crouchable_states=void 0
o.uncrouchable_states=void 0
o.crouched_size_key=void 0
o.uncrouched_size_key=void 0
o.uncrouch_col_bounds=void 0
o.crouched=false
o.can_crouch=true
o.can_uncrouch=true
var n=o.getOwner().sizes
l(n[a])
l(n[i])
l(t)
l(r)
o.crouchable_states=t
o.uncrouchable_states=r
o.crouched_size_key=a
o.uncrouched_size_key=i
o.uncrouch_col_bounds={min:_(c(),n[i].col_bounds.min,u,-.1),max:_(c(),n[i].col_bounds.max,u,.1)}
return o}var e=AutoCrouchComponent.prototype
e.getCrouched=function getCrouched(){return this.crouched}
e.getCanCrouch=function getCanCrouch(){return this.can_crouch}
e.getCanUncrouch=function getCanUncrouch(){return this.can_uncrouch}
e.getCrouchEyeHeightOffset=function getCrouchEyeHeightOffset(){var e=this.getOwner().sizes
return e[this.crouched_size_key].eye_height-e[this.uncrouched_size_key].eye_height}
e.getCrouchColBounds=function getCrouchColBounds(){return this.getOwner().sizes[this.crouched_size_key].col_bounds}
e.getUncrouchColBounds=function getUncrouchColBounds(){return this.uncrouch_col_bounds}
e.crouch=function crouch(){l(this.can_crouch)
this.getOwner().toggleSize(this.crouched_size_key)
this.crouched=true}
e.uncrouch=function uncrouch(){this.getOwner().toggleSize(this.uncrouched_size_key)
this.crouched=false}
e.enterCrouchableState=function enterCrouchableState(){this.can_crouch=true}
e.exitCrouchableState=function exitCrouchableState(){if(this.crouched)this.uncrouch()
this.can_crouch=false}
e.reactTransit=function reactTransit(e,t){var r=e.getState()
if(this.crouchable_states.includes(r)){if(!this.crouchable_states.includes(t))this.exitCrouchableState()}else if(this.crouchable_states.includes(t))this.enterCrouchableState()
this.can_uncrouch=this.uncrouchable_states.includes(t)}
return AutoCrouchComponent}(e("./component.js").Component);(r.AutoCrouchComponent=i).exlcusive={enterCrouchableState:true,exitCrouchableState:true,reactTransit:true}},{"../../glov/common/vmath.js":402,"./component.js":51,assert:void 0}],51:[function(e,t,r){"use strict"
r.Component=void 0
var a=function(){function Component(e){this.owner=void 0
this.owner=e}Component.prototype.getOwner=function getOwner(){return this.owner}
return Component}()
r.Component=a},{}],52:[function(e,t,r){"use strict"
r.DebugComponent=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../../common/globals").CHUNK_SIZE
var a=e("../base_controller")
var n=a.fdeg
var s=a.fpos
var i=e("../controller_modes/mode_common")
var l=i.getFloorInfo
var _=i.getFloorPos
var c=e("../debug").debugAddText
var u=e("../voxel_const").origin_chunk
function fvec(e,t,r){return t(e[0],r)+", "+t(e[1],r)+", "+t(e[2],r)}var d=function(i){_inheritsLoose(DebugComponent,i)
function DebugComponent(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).debug_floor_info=void 0
return e}var e=DebugComponent.prototype
e.addControllerDebugText=function addControllerDebugText(){var e=this.getOwner()
var t=u
var r=e.pos
var a=o
var i=["Pos: "+fvec(r,s,1),"World Pos: "+fvec([r[0]+t[0]*a,r[1]+t[1]*a,r[2]+t[2]*a],s,1)+" (origin: "+t+")","Velocity: "+fvec(e.vel,s,2),"YPR: "+fvec(e.ypr,n),"Facing: "+fvec(e.facing,s,3)]
if(this.debug_floor_info)i.push("  Floor Z: "+this.debug_floor_info[0],"  FlooInfoX: "+JSON.stringify(this.debug_floor_info[1]).replace(/["{}]/g,""),"  FlooInfoY: "+JSON.stringify(this.debug_floor_info[2]).replace(/["{}]/g,""))
c(i.join("\n"))}
e.setDebugFloorInfo=function setDebugFloorInfo(){var e=this.getOwner()
this.debug_floor_info=[_(e,e.pos),l(e,e.pos,0),l(e,e.pos,1)]}
return DebugComponent}(e("./component").Component)
r.DebugComponent=d},{"../../common/globals":248,"../base_controller":20,"../controller_modes/mode_common":58,"../debug":73,"../voxel_const":215,"./component":51}],53:[function(e,t,r){"use strict"
r.makePropsOnOffset=makePropsOnOffset
r.FeetCheckComponent=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var n=e("assert")
var a=e("../../glov/client/engine")
var i=e("../../glov/common/vmath")
var s=i.v3add
var l=i.v3iFloor
var o=i.vec3
var _=e("../camera").getActiveController
var c=e("../debug").debugAddText
var u=e("../voxel_data")
var d=e("./component").Component
var f=o()
function makePropsOnOffset(e){var t=e.col_bounds,r=e.eye_height
return[o(t.min[0]/2,t.min[1]/2,-r-.1),o(t.min[0]/2,t.max[1]/2,-r-.1),o(t.max[0]/2,t.min[1]/2,-r-.1),o(t.max[0]/2,t.max[1]/2,-r-.1)]}var v=function(o){_inheritsLoose(FeetCheckComponent,o)
function FeetCheckComponent(e,t,r){var a;(a=o.call(this,e)||this).props_on={}
a.props_on_offs_map=void 0
a.props_on_offs=void 0
var i=t[r]
n(i)
a.props_on_offs_map=t
a.props_on_offs=i
return a}var e=FeetCheckComponent.prototype
e.getPropsOn=function getPropsOn(){return this.props_on}
e.setPropsOnOffset=function setPropsOnOffset(e){var t=this.props_on_offs_map[e]
n(t)
this.props_on_offs=t}
e.updatePropsOn=function updatePropsOn(){this.props_on={}
for(var e=0;e<this.props_on_offs.length;++e){var t=u.getPropLocal(l(s(f,this.getOwner().pos,this.props_on_offs[e])))
if(t)this.props_on[t.uid]=t}if(a.defines.FEET&&_()===this.getOwner())c("Props Underfoot: "+(Object.values(this.props_on).map(function(e){return e.inv.getName()}).join()||"none"))}
return FeetCheckComponent}(d)
r.FeetCheckComponent=v},{"../../glov/client/engine":305,"../../glov/common/vmath":402,"../camera":35,"../debug":73,"../voxel_data":216,"./component":51,assert:void 0}],54:[function(e,t,r){"use strict"
r.calculateCommonCharSpeed=calculateCommonCharSpeed
r.tryLadderTransit=tryLadderTransit
r.checkLadderTransit=checkLadderTransit
r.calculateFrameTimes=calculateFrameTimes
r.calculateFlooredTargetPos=calculateFlooredTargetPos
r.snapMovementZAxis=snapMovementZAxis
r.calculateNewWalkTypePos=calculateNewWalkTypePos
r.LADDER_GRAB_DISTANCE_SQ=r.LADDER_OFFSET=void 0
var a=e("../../glov/common/vmath")
var f=a.v2add
var n=a.v3addScale
var v=a.v3angle
var h=a.v3copy
var l=a.v3dist
var p=a.v3distSq
var s=a.v3lengthSq
var m=a.v3mul
var E=a.v3sub
var i=a.vec2
var g=a.vec3
var T=e("../props").rotToVec
var o=e("../user_data")
var _=o.userAttribGetSpeedScale
var c=o.userAttribGetUnderwaterSpeedScale
var u=o.userStaminaCur
var y=e("../voxel_data")
var d=e("./mode_common")
var S=d.LADDERCLIMBING_ID
var I=d.WALK_SHIFT_MULT_SPEED
var A=d.checkCollisions
var w=d.collisionPass
var L=d.getFloorInfo
var O=d.getFloorPos
var R=d.sortVelocityAxis
var b=Math.abs,N=Math.ceil,C=Math.floor,x=Math.max,M=Math.min,D=Math.sqrt,P=Math.PI
var B=.001
var k=[i(1,0),i(1,1),i(1,1),i(0,1)]
r.LADDER_OFFSET=k
function calculateCommonCharSpeed(e,t,r){var a=e.base_speed
if(t.sprinting)a*=e.sprint_speed_factor
if(e.underwater.body){a*=c()
if(r&&!u())a*=e.underwater_exhausted_speed_factor
else a*=e.underwater_speed_factor}else a*=_()
for(var i in e.speed_modifiers)a*=e.speed_modifiers[i]
return a}function tryLadderTransit(e,t,r,a){f(r,r,k[t.rot])
r[2]=e.pos[2]
if(!w(e.col_bounds,r).is_blocked){e.ladder=t
e.setPosAndSmoothCam(e.is_tpv,r)
e.csm.transit(a,S)
return true}return false}var U=2
r.LADDER_GRAB_DISTANCE_SQ=U
var G=g()
var F=g()
var W=g()
function checkLadderTransit(e,t,r){var a=false
for(var i in e.last_tick_props_collided){var o=e.last_tick_props_collided[i]
if(o.inv.is_ladder){var n=v(t,T(o.rot))
o.getLocalPos(F)
h(W,F)
f(W,W,k[o.rot])
var s=p(e.pos,W)
var l=p(e.feet_pos,W)
if(n>P/2&&(s<U||l<U))a=true
else{var _
var c=g()
var u=true
var d=y.raycast3DLocal(c,g(),g(),F,g(0,0,1),o.size[2],false,false,false)
if(d&&"number"!==typeof d&&null!=(_=d.prop)&&_.inv.is_ladder)u=false
if(u&&l<U&&n<=P/2){E(G,e.feet_pos,W)
m(G,G,T(o.rot))
if(G[0]<0||G[1]<0)a=true}}if(a&&tryLadderTransit(e,o,F,r))break}}}function calculateFrameTimeSprinting(e,t,r){var a=r/I
if(t>a)return M(1,(t/a-1)/(I-1))*e
return 0}function calculateFrameTimeSwimming(e,t,r){return M(1,t/r)*e}function calculateFrameTimes(e,t,r,a,i){var o=0
var n=0
if(i.sprinting||i.underwater){var s=l(e.pos,r)/t
if(i.sprinting)n=calculateFrameTimeSprinting(t,s,a)
if(i.underwater)o=calculateFrameTimeSwimming(t,s,a)}return{frame_time_sprinting:n,frame_time_swimming:o}}var H=g()
function calculateFlooredTargetPos(e,t){var r=O(e,t)
if(t[2]-e.eye_height<r){var a=1e-4
E(H,t,e.pos)
var i=D(s(H))
if(i<a){e.vel[2]=0
h(t,e.pos)}else{H[2]=r+e.eye_height-e.pos[2]+B
var o=D(s(H))
if(o<a){e.vel[2]=0
h(t,e.pos)}else if(i<o)n(t,e.pos,H,i/o)}}}var z=2.001
var V=g()
var Y=g()
function limitHorizontalSlopeMovement(e,t,r){h(Y,e.pos)
for(var a=0;a<3;++a){var i=t[a]
if(2===i)continue
if(e.vel[i]){var o=L(e,Y,i)
var n=o
if(true){h(V,Y)
V[i]=r[i]
n=L(e,V,i)}if(e.vel[i]<0){o.slope1*=-1
o.slope2*=-1
if(o!==n){n.slope1*=-1
n.slope2*=-1}}var s=x(o.slope1,o.slope2)
if(s>=z||o.blocked&&n.blocked){r[i]=Y[i]
e.vel[i]=0}else{if((s=x(n.slope1,n.slope2))>=z||n.blocked){if(e.vel[i]>0)r[i]=.5*N(2*Y[i])-B
else r[i]=.5*C(2*Y[i])+B
e.vel[i]=0}Y[i]=r[i]}}}}var j=-.008
function snapMovementZAxis(e,t,r){var a=O(e,r)
if(t<a&&a-t<.5){if(e.vel[2]<j)e.just_landed=true
r[2]=a+e.eye_height
if(e.vel[2]<0)e.vel[2]=0}}var K=g()
var q=g()
function calculateNewWalkTypePos(e,t,r){profilerStart("calculateNewWalkTypePos")
n(K,e.pos,e.vel,t)
var a=R(e.vel)
var i
calculateFlooredTargetPos(e,K)
var o=K[2]-e.eye_height
limitHorizontalSlopeMovement(e,a,K)
snapMovementZAxis(e,o,K)
i=b(K[2]-e.pos[2])
h(q,e.pos)
e.props_collided=A(e,t,a,K,q,i,r,true)
profilerStop("calculateNewWalkTypePos")
return q}},{"../../glov/common/vmath":402,"../props":171,"../user_data":208,"../voxel_data":216,"./mode_common":58}],55:[function(e,t,r){"use strict"
r.FlyMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var s=a.v2add
var l=a.v3addScale
var _=a.v3angle
var c=a.v3copy
var u=a.v3distSq
var i=a.vec3
var n=e("../animation_enum").AnimEnum
var d=e("../props").rotToVec
var o=e("../state_machine").State
var f=e("./char_mode_common")
var v=f.LADDER_GRAB_DISTANCE_SQ
var h=f.LADDER_OFFSET
var p=f.calculateCommonCharSpeed
var m=f.calculateFrameTimes
var E=f.tryLadderTransit
var g=e("./mode_common")
var T=g.FLY_ID
var y=g.FREECAM_ID
var S=g.LADDERCLIMBING_ID
var I=g.SITTING_ID
var A=g.WALK_ID
var w=g.calculateVelocityFlyingDesired
var L=g.checkCollisions
var O=g.processVelocityFlying
var R=g.sortVelocityAxis
var b=Math.PI
var N=i()
var C=i()
var x=i()
var M=i()
var D=i()
var P=i()
var B=function(o){_inheritsLoose(FlyMode,o)
function FlyMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=T
t.allowed_transitions=((e={})[y]=true,e[A]=true,e[S]=true,e[I]=true,e)
return t}var e=FlyMode.prototype
e.enter=function enter(){var e=this.sm.getOwner()
e.anim_secondary=n.JUMP
e.setPropsOnOffset("fly")}
e.exit=function exit(){this.sm.getOwner().setPropsOnOffset("tall")}
e.handle=function handle(e){var t=e.impulse
var r=this.sm.getOwner()
if(!r.flying)r.csm.transit(e,A)
if(r.ladder_cooldown<=0)for(var a in r.last_tick_props_collided){var i=r.last_tick_props_collided[a]
if(i.inv.is_ladder){w(M,r,t,1)
var o=_(M,d(i.rot))
i.getLocalPos(D)
c(P,D)
s(P,P,h[i.rot])
var n=u(r.pos,P)
if(o>b/2&&n<v&&E(r,i,D,e))break}}}
e.update=function update(e){profilerStart("FlyMode:update")
var t=e.dt,r=e.do_stamina,a=e.impulse
var i=this.sm.getOwner()
i.makePositionSafe()
c(C,i.vel)
if(!i.anim_in_grace_time)i.anim=i.anim_secondary
var o=p(i,a,r)
o*=i.fly_speed_factor
O(i,t,a,o)
i.applyExternalForces()
l(N,i.pos,i.vel,t)
var n=R(i.vel)
c(x,i.pos)
i.props_collided=L(i,t,n,N,x,0,C,true)
var s=m(i,t,x,o,{sprinting:Boolean(a.sprinting),underwater:i.underwater.body})
i.setPos(x)
profilerStop("FlyMode:update")
return s}
return FlyMode}(o)
r.FlyMode=B},{"../../glov/common/vmath":402,"../animation_enum":9,"../props":171,"../state_machine":192,"./char_mode_common":54,"./mode_common":58}],56:[function(e,t,r){"use strict"
r.FreeCamMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/client/cmds").cmd_parse
var i=e("../../glov/common/vmath")
var n=i.v3addScale
var s=i.v3copy
var o=i.vec3
var l=e("../state_machine").State
var _=e("./mode_common")
var c=_.FLY_ID
var u=_.FREECAM_ID
var d=_.WALK_ID
var f=e("../../glov/client/settings.js")
var v=Math.min
f.register({freecam_speed:{default_value:1,type:a.TYPE_FLOAT,range:[0,4],access_run:["sysadmin"]}})
var h=.02
var p=3
var m=100
var E=1e4
var g=o()
var T=function(o){_inheritsLoose(FreeCamMode,o)
function FreeCamMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=u
t.allowed_transitions=((e={})[c]=true,e[d]=true,e)
t.shift_down_time=0
return t}var e=FreeCamMode.prototype
e.enter=function enter(){}
e.exit=function exit(){}
e.handle=function handle(){}
e.update=function update(e){var t=e.dt,r=e.impulse
var a=this.sm.getOwner()
var i=t*f.freecam_speed*h
if(r.sprinting){this.shift_down_time+=r.sprinting
i*=v(1,this.shift_down_time/E)*(m-p)+p}else this.shift_down_time=0
s(g,a.pos)
n(g,g,a.char_right,r[0]*i)
n(g,g,a.facing,r[1]*i)
n(g,g,a.char_up,r[2]*i)
if(!r[0]&&!r[1]&&!r[2])this.shift_down_time=0
a.setPos(g)}
return FreeCamMode}(l)
r.FreeCamMode=T},{"../../glov/client/cmds":298,"../../glov/client/settings.js":351,"../../glov/common/vmath":402,"../state_machine":192,"./mode_common":58}],57:[function(e,t,r){"use strict"
r.LadderClimbingMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var o=a.v2angle
var n=a.v2scale
var _=a.v3addScale
var c=a.v3copy
var s=a.v3iNormalize
var l=a.v3lengthSq
var u=a.v3sub
var i=a.vec3
var d=e("../animation_enum").AnimEnum
var f=e("../props").rotToVec
var v=e("../state_machine").State
var h=e("./char_mode_common")
var p=h.calculateCommonCharSpeed
var m=h.calculateFlooredTargetPos
var E=h.calculateFrameTimes
var g=h.snapMovementZAxis
var T=e("./mode_common")
var y=T.FREECAM_ID
var S=T.LADDERCLIMBING_ID
var I=T.SITTING_ID
var A=T.WALK_ACCEL
var w=T.WALK_ID
var L=T.checkCollisions
var O=T.sortVelocityAxis
var R=Math.abs,b=Math.sqrt,N=Math.PI
function chooseLadderClimbAnimation(e,t){if(R(t[1])>.1)if(e.vel[2]>0)if(t.sprinting)e.anim_secondary=d.LADDER_SPRINT
else e.anim_secondary=d.LADDER_CLIMB
else e.anim_secondary=d.LADDER_SLIDE
else e.anim_secondary=d.LADDER_IDLE
if(!e.anim_in_grace_time)e.anim=e.anim_secondary}function calculateVelocityLadderDesired(e,t,r,a){s(r)
var i=o(f(t.ladder.rot),t.facing)>N/2?1:-1
n(e,t.char_right,0)
e[2]=r[1]*a*i
return e}var C=i()
function calculateVelocityLadderToApply(e,t,r,a){u(C,a,t.vel)
var i=r*A
var o=l(C)
if(o<=i*i)c(e,a)
else _(e,t.vel,C,i/b(o))}function processJumpLadder(e,t){if(t){if(e.jump_ok){e.jumping_off=true
e.dropped_from_ladder=true}}else{e.jump_ok=true
e.jump_time=0}}var x=500
var M=100
var D=i()
var P=i()
var B=i()
var k=i()
var U=i()
var G=function(o){_inheritsLoose(LadderClimbingMode,o)
function LadderClimbingMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=S
t.allowed_transitions=((e={})[y]=true,e[w]=true,e[I]=true,e)
return t}var e=LadderClimbingMode.prototype
e.enter=function enter(){var e=this.sm.getOwner()
var t=e.ladder
e.dropped_from_ladder=false
var r=t.rot*(N/2)
if(!isNaN(r))e.head_angle[0]=r
e.head_angle[1]=0
e.look_angle=e.head_angle[0]
e.vel[0]=0
e.vel[1]=0
e.vel[2]=0}
e.exit=function exit(){var e=this.sm.getOwner()
delete e.dropped_from_ladder
delete e.ladder}
e.handle=function handle(e){var t=this.sm.getOwner()
c(k,t.pos)
var r=false
for(var a in t.last_tick_props_collided){var i=t.last_tick_props_collided[a]
if(i.inv.is_ladder&&i.rot===t.ladder.rot)r=true}if(t.dropped_from_ladder||!r){t.ladder_cooldown=t.dropped_from_ladder?x:M
t.dropped_from_ladder=false
t.csm.transit(e,w)}}
e.update=function update(e){var t=e.dt,r=e.do_stamina,a=e.impulse
var i=this.sm.getOwner()
i.makePositionSafe()
c(P,i.vel)
i.dropped_from_ladder=false
var o=p(i,a,r)
o*=i.ladder_speed_factor
calculateVelocityLadderDesired(U,i,a,o)
calculateVelocityLadderToApply(i.vel,i,t,U)
processJumpLadder(i,a[2]>0)
i.applyExternalForces()
chooseLadderClimbAnimation(i,a)
_(D,i.pos,i.vel,t)
var n=O(i.vel)
c(B,i.pos)
m(i,D)
var s=D[2]-i.eye_height
g(i,s,D)
i.props_collided=L(i,t,n,D,B,0,P,true)
var l=E(i,t,B,o,{sprinting:Boolean(a.sprinting),underwater:i.underwater.body})
if(i.on_ground&&U[2]<0||i.stun_timer)i.dropped_from_ladder=true
i.setPos(B)
return l}
return LadderClimbingMode}(v)
r.LadderClimbingMode=G},{"../../glov/common/vmath":402,"../animation_enum":9,"../props":171,"../state_machine":192,"./char_mode_common":54,"./mode_common":58}],58:[function(e,t,r){"use strict"
r.calculateVelocityHorizontalDesired=calculateVelocityHorizontalDesired
r.calculateVelocityFlyingDesired=calculateVelocityFlyingDesired
r.calculateVelocityFlyingToApply=calculateVelocityFlyingToApply
r.processVelocityFlying=processVelocityFlying
r.sortVelocityAxis=sortVelocityAxis
r.collisionPass=collisionPass
r.uncrouchPos=uncrouchPos
r.checkCollisions=checkCollisions
r.clampPhotoPosition=clampPhotoPosition
r.getFloorPos=getFloorPos
r.getFloorInfo=getFloorInfo
r.WALK_ACCEL=r.WALK_SHIFT_MULT_SPEED=r.FLY_MULT_MAX_SPEED=r.MAX_SPEED=r.PHTMOVE_ID=r.LADDERCLIMBING_ID=r.FLY_ID=r.WALK_ID=r.SWIMMING_ID=r.SITTING_ID=r.FREECAM_ID=void 0
var a=e("../../common/globals.js").VOXELS_PER_M
var i="freeCam"
r.FREECAM_ID=i
var o="sitting"
r.SITTING_ID=o
var n="swimming"
r.SWIMMING_ID=n
var s="walk"
r.WALK_ID=s
var l="fly"
r.FLY_ID=l
var _="ladderClimbing"
r.LADDERCLIMBING_ID=_
var c="phtMove"
r.PHTMOVE_ID=c
var u=.005*a
r.MAX_SPEED=u
var d=2
r.FLY_MULT_MAX_SPEED=d
var f=2
r.WALK_SHIFT_MULT_SPEED=f
var v=e("../../glov/client/engine.js")
var h=e("../../glov/client/ui.js")
var p=e("../../glov/common/util.js")
var m=p.clamp
var E=p.lerp
var g=p.merge
var T=p.sign
var y=e("../../glov/common/vmath.js")
var S=y.v2addScale
var I=y.v2copy
var A=y.v2floor
var w=y.v2normalize
var L=y.v2scale
var O=y.v2set
var R=y.v3add
var b=y.v3addScale
var N=y.v3copy
var C=y.v3iFloor
var x=y.v3iNormalize
var M=y.v3lengthSq
var D=y.v3scale
var P=y.v3set
var B=y.v3sub
var k=y.vec2
var U=y.vec3
var G=y.zaxis
var F=y.zero_vec
var W=e("../base_controller.js")
var H=W.isFlyingController
var z=W.isJumpingController
var V=e("../controller_components/auto_crouch_comp.js").hasAutoCrouchComponent
var Y=e("../localization/localization").L
var j=e("../photo_mode.js").getPhotoBounds
var K=e("../status.js")
var q=e("../user_data.js").worldReadOnly
var Z=e("../voxel_data.js")
var X=e("../world_metadata.js")
var Q=X.unlimitedMode
var $=X.worldPhotoMove
var J=e("../../glov/client/settings.js")
var ee=Math.abs,te=Math.ceil,re=Math.floor,ae=Math.max,ie=Math.min,oe=Math.random,ne=Math.round,se=Math.sqrt
var le=U(0,0,1)
var _e=U(0,0,-1)
var ce=.001
var ue=U()
var de=U()
var fe=k()
function calculateVelocityHorizontalDesired(e,t,r,a){I(fe,t.facing)
fe[2]=0
w(fe,fe)
L(e,t.char_right,r[0]*a)
S(e,e,fe,r[1]*a)
return e}function calculateVelocityFlyingDesired(e,t,r,a){if(M(r)>1)x(r)
if(J.fly_relative){D(e,t.char_right,r[0]*a)
b(e,e,t.facing,r[1]*a)
b(e,e,t.char_up,r[2]*a)}else{calculateVelocityHorizontalDesired(e,t,r,a)
e[2]=r[2]*a}return e}var ve=25e-6*a
r.WALK_ACCEL=ve
function calculateVelocityFlyingToApply(e,t,r,a){B(ue,a,t.vel)
var i=r*ve
var o=M(ue)
if(o<=i*i)N(e,a)
else b(e,t.vel,ue,i/se(o))
return e}var he=U()
function processVelocityFlying(e,t,r,a){calculateVelocityFlyingDesired(he,e,r,a)
calculateVelocityFlyingToApply(e.vel,e,t,he)}function sortVelocityAxis(e){var t=[ee(e[0]),ee(e[1]),ee(e[2])]
var r=[0,1,2]
if(t[0]<t[1]){r[0]=1
r[1]=0}if(t[r[1]]<t[2]){r[2]=r[1]
r[1]=2
if(t[r[0]]<t[2]){r[1]=r[0]
r[0]=2}}return r}function tryToUnblock(e,t,r,a,i,o){var n
var s=e.vel[t]>0
if(s)if(2===t)n=te(r[2])-ce-e.col_bounds.max[2]
else n=te(r[t])-ce-e.col_bounds.max[t]
else if(2===t){if(i&&i[0]!==i[1])a[0]=i[0]?1:-1
if(o&&o[0]!==o[1])a[1]=o[0]?1:-1}else n=re(r[t])+ce-e.col_bounds.min[t]
if(n&&(s?n>e.pos[t]:n<e.pos[t]))return n
else return e.pos[t]}var pe=.0125*a
var me=2*ve
function checkUnblockPush(e,t,r,a){for(var i=0;i<2;++i)if(a[i]){B(r,r,e.vel)
var o=se(M(r))
if(a[0]&&a[1])o*=.5
var n=ae(o,me*t)
if(a[i]>0){if(e.vel[i]<pe)e.vel[i]=ie(pe,e.vel[i]+n)}else if(a[i]<0)if(e.vel[i]>-pe)e.vel[i]=ae(-pe,e.vel[i]-n)}}var Ee=U()
var ge=U()
var Te=4
var ye=-ne(Te/2)
function cast4Up(){var e=2*Te
if(Z.raycastLocal(ge,Ee,G,e,false))e=ie(ge[2]-Ee[2],e)
Ee[0]++
if(Z.raycastLocal(ge,Ee,G,e,false))e=ie(ge[2]-Ee[2],e)
Ee[1]++
if(Z.raycastLocal(ge,Ee,G,e,false))e=ie(ge[2]-Ee[2],e)
Ee[0]--
if(Z.raycastLocal(ge,Ee,G,e,false))e=ie(ge[2]-Ee[2],e)
Ee[1]--
return e}var Se=U()
var Ie=U()
var Ae=U(0,0,0)
function findEmptyPosNearEff(e,t,r){var a=te(r)
Ae[2]=-t
R(Ie,e,Ae)
C(Ie)
var i=Infinity
var o=0
for(var n=-Te;n<=Te;++n){var s=n>=0?n+1:-n
Ee[1]=Ie[1]+n
for(var l=-Te;l<=Te;++l){var _=l>=0?l+1:-l
Ee[0]=Ie[0]+l
for(var c=ye;c<=Te;++c){Ee[2]=Ie[2]+c
var u=_+s+ee(c)
if(u>i)continue
if(cast4Up()>=a)if(u<i){i=u
o=1
N(Se,Ee)}else if(u===i){++o
if(oe()*o<1)N(Se,Ee)}}}}if(!isFinite(i))return null
Se[0]+=1
Se[1]+=1
Se[2]+=t
return Se}function handleFinalBlocked(e,t,r){if(v.DEBUG)h.print(null,400,400,1e3,"BLOCKED")
e.blocked_accum+=t
e.blocked_frames++
if(e.blocked_accum>250&&e.blocked_frames>4){if(null===e.blocked_target)e.blocked_target=findEmptyPosNearEff(r,e.eye_height,e.controller_height)||"none"
if("none"===e.blocked_target){if(Z.chunksGenedNear(e.pos)){var a=q()?Y.STATUSMSG_STUCK_MENU_OR_LEAVE:Y.STATUSMSG_STUCK_DIG_OR_WG
K.get("blocked").setMessage(a).fade()
e.blocked_target=null}}else{B(de,e.blocked_target,r)
x(de)
D(de,de,.01*t)
for(var i=0;i<3;++i)if(T(r[i]+de[i]-e.blocked_target[i])!==T(r[i]-e.blocked_target[i]))r[i]=e.blocked_target[i]
else r[i]+=de[i]}}}function updateBlockedAccum(e,t){if(e.blocked_target){e.blocked_accum=ie(e.blocked_accum-t,500)
if(e.blocked_accum<0){e.blocked_target=null
e.blocked_accum=0
e.blocked_frames=0}}else{e.blocked_target=null
e.blocked_accum=0
e.blocked_frames=0}}var we=[U(),U()]
var Le=U()
function collisionPass(e,t,r,a,i){a=a||0
P(we[0],re(t[0]+e.min[0]),re(t[1]+e.min[1]),re(t[2]+e.min[2]))
P(we[1],re(t[0]+e.max[0]),re(t[1]+e.max[1]),re(t[2]+e.max[2]+(2!==r?a:0)))
N(Le,F)
var o=false
var n=null
var s=null
Le[2]=we[1][2]
e:for(var l=we[0][1];l<=we[1][1];++l){Le[1]=l
for(var _=we[0][0];_<=we[1][0];++_){Le[0]=_
var c=we[1][2]-we[0][2]+1
var u=i?{}:null
if(Z.raycastLocal(ue,Le,_e,c,null,u))if(ue[2]>=we[0][2])if(2===r&&ue[2]===we[0][2]){o=true
if(_!==we[1][0])(n=n||[])[0]=true
if(_!==we[0][0])(n=n||[])[1]=true
if(l!==we[1][1])(s=s||[])[0]=true
if(l!==we[0][1])(s=s||[])[1]=true}else{o=true
break e}if(i)g(i,u)}}return{is_blocked:o,blocked_x:n,blocked_y:s}}var Oe={min:U(),max:U()}
function crouchCollisionPass(e,t,r,a,i){N(Oe.min,e.getCrouchColBounds().min)
N(Oe.max,e.getCrouchColBounds().max)
Oe.min[2]+=e.getCrouchEyeHeightOffset()
var o=collisionPass(Oe,t,r,a,i)
Oe.min[2]+=.5
Oe.max[2]+=.5
var n=collisionPass(Oe,t,r,a,i)
return!n.is_blocked?n:o}function crouchPos(e,t,r){N(e,t)
e[2]+=r.getCrouchEyeHeightOffset()}function uncrouchPos(e,t,r){N(e,t)
e[2]-=r.getCrouchEyeHeightOffset()}var Re=U()
var be=U()
function checkAxisCollision(e,t,r,a,i,o,n,s){var l=true
var _=false
var c=i[a]
for(var u=0;l&&u<2;++u){N(Re,t)
Re[a]=c
var d=V(e)&&e.getCrouched()?crouchCollisionPass(e,Re,a,r,n):collisionPass(e.col_bounds,Re,a,r,n),f=d.is_blocked,v=d.blocked_x,h=d.blocked_y
l=f
if(!s)break
if(l){if(V(e)&&!e.getCrouched()&&e.getCanCrouch()&&e.on_ground){crouchPos(be,Re,e)
var p=crouchCollisionPass(e,be,a,r,n)
if(!p.is_blocked){N(t,be)
crouchPos(i,i,e)
l=p.is_blocked
v=p.blocked_x
h=p.blocked_y
e.crouch()
continue}}e.vel[a]=0
if(z(e)&&e.jump_time&&2===a)e.jump_time=0
if(0===u)c=tryToUnblock(e,a,Re,o,v,h)
else _=true}else{if(V(e)&&e.getCrouched()&&e.getCanUncrouch()){uncrouchPos(be,Re,e)
var m=collisionPass(e.getUncrouchColBounds(),be,a,r,n)
if(!m.is_blocked){N(t,be)
uncrouchPos(i,i,e)
l=m.is_blocked
v=m.blocked_x
h=m.blocked_y
e.uncrouch()
continue}}N(t,Re)}}return _}var Ne=k()
function checkCollisions(e,t,r,a,i,o,n,s){O(Ne,0,0)
var l=false
var _={}
for(var c=0;c<3;++c)if(checkAxisCollision(e,i,o,r[c],a,Ne,_,s))l=true
if(!H(e)||!e.isAerial())checkUnblockPush(e,t,n,Ne)
if(l)handleFinalBlocked(e,t,i)
else updateBlockedAccum(e,t)
for(var u in _){var d=_[u]
var f=U()
d.getLocalPos(f)
if(f[2]>e.pos[2]+e.col_bounds.max[2]+ce||e.pos[2]-e.eye_height>f[2]+d.size[2]+ce)delete _[u]}return _}var Ce=50
function clampPhotoPosition(e,t){var r=j()
for(var a=0;a<3;++a)if($())if(Q())e[a]=m(e[a],r[a][0],r[a][1])
else e[a]=m(e[a],ae(r[a][0],t[a]-Ce),ie(r[a][1],t[a]+Ce))
else e[a]=t[a]}var xe=2.001
var Me=U()
var De=new Float32Array(5)
var Pe=new Float32Array(4)
var Be=new Float32Array(9)
var ke=[-1,0,1,-1,0,1,-1,0,1]
var Ue=[-1,-1,-1,0,0,0,1,1,1]
var Ge=k()
var Fe=U()
var We=U()
function getCorners(e,t){var r=t[2]-e.eye_height
var a=r+e.getClearanceHeight()
var i=re(r-1)
A(Me,t)
Me[2]=re(a)
O(Ge,t[0]-Me[0],t[1]-Me[1])
for(var o=0;o<9;++o){P(Fe,Me[0]+ke[o],Me[1]+Ue[o],Me[2])
if(Z.raycastLocal(We,Fe,_e,2*e.getClearanceHeight()))Be[o]=ae(We[2]+1,i)
else Be[o]=i}De[0]=ae(ae(Be[0],Be[1]),ae(Be[3],Be[4]))
De[1]=ae(ae(Be[1],Be[2]),ae(Be[4],Be[5]))
De[2]=ae(ae(Be[3],Be[4]),ae(Be[6],Be[7]))
De[3]=ae(ae(Be[4],Be[5]),ae(Be[7],Be[8]))
De[4]=ie(De[0],De[1],De[2],De[3])
if(Ge[0]<=.5)if(Ge[1]<=.5){Pe[0]=De[0]
Pe[1]=ie(De[0],De[1])
Pe[2]=ie(De[0],De[2])
Pe[3]=De[4]}else{Pe[0]=ie(De[0],De[2])
Pe[1]=De[4]
Pe[2]=De[2]
Pe[3]=ie(De[2],De[3])}else if(Ge[1]<=.5){Pe[0]=ie(De[0],De[1])
Pe[1]=De[1]
Pe[2]=De[4]
Pe[3]=ie(De[1],De[3])}else{Pe[0]=De[4]
Pe[1]=ie(De[1],De[3])
Pe[2]=ie(De[2],De[3])
Pe[3]=De[3]}for(var n=0;n<2;++n)if(Ge[n]<=.5)Ge[n]*=2
else Ge[n]=2*Ge[n]-1
return i}function getFloorPos(e,t){getCorners(e,t)
return E(Ge[1],E(Ge[0],Pe[0],Pe[1]),E(Ge[0],Pe[2],Pe[3]))}function getFloorInfo(e,t,r){var a=te(e.getClearanceHeight())
var i=getCorners(e,t)
var o
var n
if(0===r){o=Pe[1]-Pe[0]
n=Pe[3]-Pe[2]}else{o=Pe[2]-Pe[0]
n=Pe[3]-Pe[1]}var s=ie.apply(void 0,Pe)
var l=ae.apply(void 0,Pe)
var _=false
if(s-(i+1)>xe)_=true
else{P(Fe,Me[0],Me[1],l)
if(Z.raycastLocal(We,Fe,le,a+1))if(We[2]-l<a)_=true}return{blocked:_,slope1:o,slope2:n}}},{"../../common/globals.js":248,"../../glov/client/engine.js":305,"../../glov/client/settings.js":351,"../../glov/client/ui.js":367,"../../glov/common/util.js":400,"../../glov/common/vmath.js":402,"../base_controller.js":20,"../controller_components/auto_crouch_comp.js":50,"../localization/localization":131,"../photo_mode.js":158,"../status.js":193,"../user_data.js":208,"../voxel_data.js":216,"../world_metadata.js":235}],59:[function(e,t,r){"use strict"
r.PhotoMoveMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var n=a.v3addScale
var s=a.v3copy
var i=a.vec3
var o=e("../state_machine").State
var l=e("./mode_common")
var _=l.PHTMOVE_ID
var c=l.checkCollisions
var u=l.processVelocityFlying
var d=l.sortVelocityAxis
var f=i()
var v=i()
var h=i()
var p=function(i){_inheritsLoose(PhotoMoveMode,i)
function PhotoMoveMode(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).id=_
e.allowed_transitions={}
return e}var e=PhotoMoveMode.prototype
e.enter=function enter(){}
e.exit=function exit(){}
e.handle=function handle(){}
e.update=function update(e){var t=e.dt,r=e.impulse
var a=this.sm.getOwner()
a.makePositionSafe()
s(v,a.vel)
var i=a.base_speed
if(r.sprinting)i*=a.sprint_speed_factor
u(a,t,r,i)
n(f,a.pos,a.vel,t)
var o=d(a.vel)
s(h,a.pos)
c(a,t,o,f,h,0,v,true)
a.setPos(h)}
return PhotoMoveMode}(o)
r.PhotoMoveMode=p},{"../../glov/common/vmath":402,"../state_machine":192,"./mode_common":58}],60:[function(e,t,r){"use strict"
r.SittingMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath.js")
var i=a.v3copy
var o=a.vec3
var n=a.zero_vec
var s=e("../animation_enum.js").AnimEnum
var l=e("../controller_common.js").DOWN
var _=e("../state_machine.js").State
var c=e("../voxel_data.js")
var u=e("./mode_common.js")
var d=u.FREECAM_ID
var f=u.SITTING_ID
var v=u.WALK_ID
var h=u.checkCollisions
var p=u.collisionPass
var m=u.uncrouchPos
var E=e("../../glov/client/settings.js")
var g=Math.ceil
var T=o()
var y=o()
var S=o()
var I=[0,1,2]
var A=function(o){_inheritsLoose(SittingMode,o)
function SittingMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=f
t.allowed_transitions=((e={})[d]=true,e[v]=true,e)
return t}var e=SittingMode.prototype
e.enter=function enter(){var e=this.sm.getOwner()
if(!e.getCrouched())e.crouch()
e.anim_secondary=s.SIT
e.anim=s.SIT
e.anim_in_grace_time=true
e.animation_grace_time=0}
e.exit=function exit(){var e=this.sm.getOwner()
m(T,e.pos,e)
if(!p(e.getUncrouchColBounds(),T).is_blocked)e.uncrouch()
if(e.fpv_when_done){E.camera_view=0
e.fpv_when_done=false}if(e.anim===s.SIT)e.anim_in_grace_time=false}
e.handle=function handle(e){var t=e.impulse
var r=this.sm.getOwner()
i(S,r.pos);--S[2]
if(t[0]||t[1]||t[2])r.csm.transit(e,v)
else if(!c.raycastLocal(y,S,l,4,false))r.csm.transit(e,v)
else if(S[2]-y[2]<g(r.controller_height)-1)r.csm.transit(e,v)
else if(S[2]-y[2]>=4)r.csm.transit(e,v)}
e.update=function update(e){var t=e.dt
var r=this.sm.getOwner()
i(r.vel,n)
r.applyExternalForces()
r.props_collided=h(r,t,I,r.pos,r.pos,0,r.vel,false)
r.setPos(r.pos)}
return SittingMode}(_)
r.SittingMode=A},{"../../glov/client/settings.js":351,"../../glov/common/vmath.js":402,"../animation_enum.js":9,"../controller_common.js":49,"../state_machine.js":192,"../voxel_data.js":216,"./mode_common.js":58}],61:[function(e,t,r){"use strict"
r.SwimmingMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=e("../../glov/common/vmath")
var l=a.v3copy
var i=a.vec3
var o=e("../animation_enum").AnimEnum
var n=e("../state_machine").State
var s=e("./char_mode_common")
var _=s.calculateCommonCharSpeed
var c=s.calculateFrameTimes
var u=s.calculateNewWalkTypePos
var d=s.checkLadderTransit
var f=e("./mode_common")
var v=f.FLY_ID
var h=f.FREECAM_ID
var p=f.LADDERCLIMBING_ID
var m=f.SITTING_ID
var E=f.SWIMMING_ID
var g=f.WALK_ID
var T=f.calculateVelocityFlyingDesired
var y=f.processVelocityFlying
var S=Math.abs
function chooseSwimmingAnimation(e,t){if(S(t[0])+S(t[1])+S(t[2])<.1||e.anim_in_grace_time)e.anim_secondary=o.SWIM_IDLE
else e.anim_secondary=o.SWIM
if(!e.anim_in_grace_time)e.anim=e.anim_secondary}var I=i()
var A=i()
var w=function(o){_inheritsLoose(SwimmingMode,o)
function SwimmingMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=E
t.allowed_transitions=((e={})[v]=true,e[h]=true,e[p]=true,e[m]=true,e[g]=true,e)
return t}var e=SwimmingMode.prototype
e.enter=function enter(){}
e.exit=function exit(e,t){var r=e.impulse
var a=this.sm.getOwner()
if(t===g&&r[2]>0)a.jumping_off=true}
e.handle=function handle(e){var t=this.sm.getOwner()
if(!t.underwater.body)t.csm.transit(e,g)
var r=e.impulse
if(t.flying)t.csm.transit(e,v)
if(t.ladder_cooldown<=0){T(I,t,r,1)
d(t,I,e)}}
e.update=function update(e){var t=e.dt,r=e.impulse,a=e.do_stamina
var i=this.sm.getOwner()
i.makePositionSafe()
l(A,i.vel)
chooseSwimmingAnimation(i,r)
var o=_(i,r,a)
if(i.getCrouched())o*=i.crouch_speed_factor
y(i,t,r,o)
i.applyExternalForces()
var n=u(i,t,A)
var s=c(i,t,n,o,{sprinting:Boolean(r.sprinting),underwater:true})
i.setPos(n)
return s}
return SwimmingMode}(n)
r.SwimmingMode=w},{"../../glov/common/vmath":402,"../animation_enum":9,"../state_machine":192,"./char_mode_common":54,"./mode_common":58}],62:[function(e,t,r){"use strict"
r.WalkMode=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var i=e("../../glov/client/input")
var a=e("../../glov/common/util").arrayToSet
var o=e("../../glov/common/vmath")
var n=o.v2addScale
var s=o.v2copy
var l=o.v2lengthSq
var _=o.v2sub
var c=o.v3copy
var u=o.vec3
var d=e("../../common/globals").VOXELS_PER_M
var f=e("../animation_enum").AnimEnum
var v=e("../state_machine").State
var h=e("./char_mode_common")
var p=h.calculateCommonCharSpeed
var m=h.calculateFrameTimes
var E=h.calculateNewWalkTypePos
var g=h.checkLadderTransit
var T=e("./mode_common")
var y=T.FLY_ID
var S=T.FREECAM_ID
var I=T.LADDERCLIMBING_ID
var A=T.SITTING_ID
var w=T.SWIMMING_ID
var L=T.WALK_ACCEL
var O=T.WALK_ID
var R=T.calculateVelocityHorizontalDesired
var b=e("../../glov/client/settings.js")
var N=Math.abs,C=Math.max,x=Math.sqrt
var M={regular:{idle:f.IDLE,walk:f.WALK,run:f.RUN},crouch:{idle:f.CROUCH_IDLE,walk:f.CROUCH_WALK,run:f.CROUCH_RUN}}
var D=a([f.IDLE,f.WALK,f.RUN,f.CROUCH_IDLE,f.CROUCH_WALK,f.CROUCH_RUN])
var P=600
function chooseWalkModeAnimation(e,t){var r=e.getCrouched()?M.crouch:M.regular
if(e.vel[2]>0)e.anim_secondary=f.JUMP
else if(e.vel[2]<0&&!D[e.anim_secondary])e.anim_secondary=f.FALL
else if(N(t[0])+N(t[1])>.1){e.anim_secondary=r.walk
if(t.sprinting)e.anim_secondary=r.run}else e.anim_secondary=r.idle
if(e.not_underwater_timer<P)if(e.anim_secondary===r.idle||e.anim_in_grace_time)e.anim_secondary=f.SWIM_IDLE
else e.anim_secondary=f.SWIM
if(!e.anim_in_grace_time)e.anim=e.anim_secondary}var B=u()
function calculateVelocityHorizontalToApply(e,t,r,a){_(B,a,t.vel)
var i=r*L
var o=l(B)
if(o<=i*i)s(e,a)
else n(e,t.vel,B,i/x(o))
return e}var k=.0025*d
var U=300
var G=-9.8*d/1e3/1e3
var F=-.025*d
function processJumpWalk(e,t,r){if(r){if(e.on_ground&&e.jump_ok||e.jumping_off){e.jump_time=U
e.jump_ok=false
e.jumping_off=false
e.just_jumped=true}}else{if(!(i.touch_mode?b.max_jump_tap_touch:b.max_jump_tap_kb))e.jump_time=0
e.jump_ok=true}var a=t
if(e.jump_time&&!e.getCrouched()){e.vel[2]=k
e.on_ground=false
a=0
if(t>e.jump_time){a=t-e.jump_time
e.jump_time=0}else e.jump_time-=t}e.vel[2]=C(F,e.vel[2]+a*G)}var W=u()
var H=u()
var z=u()
var V=function(o){_inheritsLoose(WalkMode,o)
function WalkMode(){var e
var t
for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(t=o.call.apply(o,[this].concat(a))||this).id=O
t.allowed_transitions=((e={})[y]=true,e[S]=true,e[I]=true,e[A]=true,e[w]=true,e)
return t}var e=WalkMode.prototype
e.enter=function enter(){}
e.exit=function exit(){}
e.handle=function handle(e){var t=e.dt,r=e.impulse
var a=this.sm.getOwner()
if(a.underwater.body)a.csm.transit(e,w)
if(a.flying)a.csm.transit(e,y)
if(a.ladder_cooldown<=0){R(B,a,r,1)
calculateVelocityHorizontalToApply(W,a,t,B)
g(a,W,e)}}
e.update=function update(e){profilerStart("WalkMode:update")
var t=e.dt,r=e.impulse,a=e.do_stamina
var i=this.sm.getOwner()
i.makePositionSafe()
c(H,i.vel)
chooseWalkModeAnimation(i,r)
var o=p(i,r,a)
if(i.getCrouched())o*=i.crouch_speed_factor
R(z,i,r,o)
calculateVelocityHorizontalToApply(i.vel,i,t,z)
processJumpWalk(i,t,r[2]>0)
i.applyExternalForces()
var n=E(i,t,H)
var s=m(i,t,n,o,{sprinting:Boolean(r.sprinting)})
i.setPos(n)
profilerStop("WalkMode:update")
return s}
return WalkMode}(v)
r.WalkMode=V},{"../../common/globals":248,"../../glov/client/input":326,"../../glov/client/settings.js":351,"../../glov/common/util":400,"../../glov/common/vmath":402,"../animation_enum":9,"../state_machine":192,"./char_mode_common":54,"./mode_common":58}],63:[function(e,t,r){"use strict"
r.cosmeticThumbnailInvalidate=cosmeticThumbnailInvalidate
r.cosmeticGetImage=cosmeticGetImage
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var g=e("assert")
var T=e("../glov/client/engine")
var a=e("../glov/client/quat")
var i=a.qFromYPR
var o=a.quat
var n=e("../glov/client/snapshot")
var y=n.snapshot
var S=n.snapshotDrawDynamic
var I=e("../glov/client/ui").Z_MIN_INC
var s=e("../glov/common/util")
var l=s.clone
var _=s.lerp
var c=e("../glov/common/vmath")
var u=c.vec3
var A=c.zero_vec
var d=e("../common/cosmetics_common")
var w=d.isCostume
var L=d.isPart
var O=e("./animation_enum").AnimEnum
var f=e("./animation_player")
var R=f.animationDrawPlayer
var b=f.drawCostumeNeedsReinit
var N=f.drawCostumePrep
var v=e("./character_customization").partPairedPart
var C=e("./client_entities").allocPerEntData
var h=e("./cosmetics").costume_dict
var x=e("./items").snapshotOverLimit
var M=e("./mobs").createEntDrawData
var p=e("./props")
var D=p.restoreGlobalState
var P=p.saveGlobalState
var m=e("./voxel_data")
var B=m.applyBevelParamCharacters
var k=m.applyBevelParamWorld
var U=m.applyBevelValue
var E=Math.PI,G=Math.cos,F=Math.sin
function isDynamicParam(e){return Boolean(e.dynamic_snapshot)}var W=128
var H=i(o(),E,0,0)
var z=u(-.5,-.5,.4)
var V=u(-.5,-.5,0)
var Y=u(-.5,-.5,2)
var j=u(1,1,3)
var K=u(1,1,1.5)
var q=K
var X=u()
function headshotAngle(e,t){t=_(t,0,E)
e[0]=G(t)
e[1]=-F(t)
e[2]=.17}function costumeFromPart(e){var t={}
if(e.costumes&&e.costumes.length){var r=h[e.costumes[0]]
if(r.swaps)t=l(r.swaps)}var a=[{name:e.base_name||e.name,swaps:e.swaps}]
var i=v(e)
if(i)a.push({name:i.base_name||i.name,swaps:i.swaps})
return{name:"custom",swaps:t,parts:a,override:true}}var Q={}
function cosmeticThumbnailInvalidate(e,t){t=t||e.name
var r=Q[t]
if(r){r.draw_data.costume_mod++
if(L(e))r.costume=costumeFromPart(e)
else r.costume=e}}function cosmeticGetImage(e,t,r){g(L(t)||w(t))
var a=isDynamicParam(e)
var i=a||e.force_update
r=r||t.name
var o=Q[r]
if(!o){(o=Q[r]={costume:L(t)?costumeFromPart(t):t,per_ent_data:C(),draw_data:M(),need_static_regen:false,rot:0,last_frame:-1}).draw_data.draw_opts={for_snapshot:true,torch_factor:0,sun_factor:1,scale_lights:true}
o.per_ent_data.anim_state.anim=L(t)?O.PART_THUMBNAIL:O.IDLE}var n=o
function drawFunc(){U(1,true)
B()
R(n.draw_data,n.per_ent_data,n.costume,A,H,H)
k()
U()}var s=e.headshot
var l
if(s)headshotAngle(l=X,e.headshot_angle||0)
var _={pos:L(t)?V:s?Y:z,size:L(t)?K:s?q:j,pre:P,post:D,camera_offset:l,draw:drawFunc}
if(a){g(isDynamicParam(e))
N(n.draw_data,n.costume)
if(n.last_frame+1!==T.frame_index)n.rot=0
n.last_frame=T.frame_index
n.rot+=.001*T.frame_dt
var c=e.w*(1-e.shrink)
var u=e.x+c/2
var d=e.y+c/2
var f=(e.z||Z.UI)+(e.z_inc||I)+.001
var v=e.w-c
var h=(e.h||e.w)-c
S(_extends({},_,{x:u,y:d,z:f,w:v,h:h,rot:n.rot}))
e.img=void 0
e.text=" "
return}e.text=void 0
if(b(n.draw_data))n.need_static_regen=true
if(n.need_static_regen)i=true
if(!n.sprite||i)if(!N(n.draw_data,n.costume));else if(!x(false)){var p=W
var m
var E
n.need_static_regen=false
E=function on_unload(){if(n.sprite===m)delete n.sprite
m.texs[0].destroy()
m.texs[1].destroy()}
m=y(_extends({},_,{name:"cosmetic_snap_"+r,sprite:n.sprite,w:p,h:p,on_unload:E}))
n.sprite=m}if(n.sprite)e.img=n.sprite}},{"../common/cosmetics_common":241,"../glov/client/engine":305,"../glov/client/quat":346,"../glov/client/snapshot":356,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./animation_enum":9,"./animation_player":10,"./character_customization":39,"./client_entities":44,"./cosmetics":64,"./items":119,"./mobs":145,"./props":171,"./voxel_data":216,assert:void 0}],64:[function(e,t,r){"use strict"
r.getPreviewCostume=getPreviewCostume
r.getDefaultCostume=getDefaultCostume
r.getPartTypeFromBone=getPartTypeFromBone
r.validBone=validBone
r.getRarityLabel=getRarityLabel
r.getRarityStyle=getRarityStyle
r.getRarityColors=getRarityColors
r.partChoiceKey=partChoiceKey
r.getSwapColors=getSwapColors
r.getCosmeticsOwnerships=getCosmeticsOwnerships
r.cosmeticSwapsOwned=cosmeticSwapsOwned
r.cosmeticOwned=cosmeticOwned
r.costumeOwned=costumeOwned
r.getOwnedCostumesAmount=getOwnedCostumesAmount
r.getPartTypeFromPart=getPartTypeFromPart
r.getCosmeticsAvailability=getCosmeticsAvailability
r.maybeTranslated=maybeTranslated
r.cosmeticDisplayName=cosmeticDisplayName
r.costumeDisplayName=costumeDisplayName
r.canInitGeomThisFrame=canInitGeomThisFrame
r.attachInit=attachInit
r.instantiateCostumeData=instantiateCostumeData
r.startup=startup
r.costume_dict=r.swaps_dict=r.part_choice_dict=r.DEFAULT_COSTUME=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("../common/cosmetics_common")
var g=a.CosmeticRarities
var T=a.CosmeticTypeLangKeys
var y=a.CosmeticTypes
var i=a.Parts
var o=a.isPart
var n=a.isSwap
var s="villager_1"
r.DEFAULT_COSTUME=s
var S={}
var I={}
r.part_choice_dict=I
var A={}
r.swaps_dict=A
var w={}
var L={preview:{name:"preview",attachments:[],parts:[],cosmetic_type:y.COSTUME,type_key:T.COSTUME,owned:false}}
r.costume_dict=L
var v=e("assert")
var l=e("../glov/client/engine")
var O=l.DEBUG
var _=l.getFrameIndex
var c=e("../glov/client/filewatch").filewatchOn
var u=e("../glov/client/webfs")
var R=u.webFSGetFile
var f=u.webFSGetFileNames
var b=e("../glov/common/data_error").dataError
var d=e("../glov/common/enums")
var h=d.isValidNumberEnumKey
var p=d.isValidStringEnumKey
var m=e("../glov/common/util")
var E=m.clone
var N=m.cloneShallow
var C=m.empty
var x=m.merge
var M=e("../glov/common/vmath")
var D=M.v3scale
var P=M.v4copy
var B=M.vec3
var k=M.vec4
var U=e("../common/entitlements").entitlements
var G=e("./character_customization").characterCustomizationMenuInit
var F=e("./cosmetic_thumbnails").cosmeticThumbnailInvalidate
var W=e("./costume_edit").incrementCurCostumeMod
var H=e("./localization/localization").L
var z=e("./palette")
var V=z.paletteRange
var Y=z.paletteSwap
var j=e("./show_first_offer")
var K=j.firstOfferGetExpireTime
var q=j.firstOfferGetTimeLeft
var Z=e("./store")
var X=Z.canPurchaseProduct
var Q=Z.canPurchaseProductId
var $=Z.getAllProducts
var J=e("./styles")
var ee=J.color_cosmetic_base_common
var te=J.color_cosmetic_base_epic
var re=J.color_cosmetic_base_legendary
var ae=J.color_cosmetic_base_rare
var ie=J.color_cosmetic_bright_common
var oe=J.color_cosmetic_bright_epic
var ne=J.color_cosmetic_bright_legendary
var se=J.color_cosmetic_bright_rare
var le=J.customization_common
var _e=J.customization_epic
var ce=J.customization_legendary
var ue=J.customization_rare
var de=e("./voxel_data_drawable").voxelDataDrawableLoad
var fe=e("./world_comm").getPerm
function getPreviewCostume(){return L.preview}function getDefaultCostume(){return L[s]}var ve=0
var he={}
var pe=0
var me=k(1,1,1,1)
var Ee={head:T.HEAD,torso:T.TORSO,arm_r:T.ARMS,leg_r:T.LEGS}
function getTypeKeyFromBone(e){return Ee[e]}function getPartTypeFromBone(e){var t=e.toUpperCase()
return h(i,t)?i[t]:void 0}function getTypeKeyFromSwap(e){var t="SWAP_"+e.toUpperCase()
return p(T,t)?T[t]:void 0}var ge=Object.create(null)
function validBone(e){return Boolean(ge[e])}function getTransparentColor(e){var t=k()
P(t,e)
t[3]=0
return t}var Te={COMMON:{style:le,label:H.LBL_RARITY_COMMON,colors:{base_color:ee,bright_color:ie,bright_color_transparent:getTransparentColor(ie)}},RARE:{style:ue,label:H.LBL_RARITY_RARE,colors:{base_color:ae,bright_color:se,bright_color_transparent:getTransparentColor(se)}},EPIC:{style:_e,label:H.LBL_RARITY_EPIC,colors:{base_color:te,bright_color:oe,bright_color_transparent:getTransparentColor(oe)}},LEGENDARY:{style:ce,label:H.LBL_RARITY_LEGENDARY,colors:{base_color:re,bright_color:ne,bright_color_transparent:getTransparentColor(ne)}}}
function getRarityLabel(e){return Te[e].label}function getRarityStyle(e){return Te[e].style}function getRarityColors(e){return Te[e].colors}function swapKey(e){var t=[]
for(var r in e)t.push(r+","+e[r])
t.sort()
return t.join(";")}function partChoiceKey(e){if(!e.swaps)return e.name
return e.name+";"+swapKey(e.swaps)}function getSwapColors(){for(var e in A){var t=A[e]
var r=V(void 0,t.type+"_"+t.name,t.name)
if(r){var a=r[0][1]
t.color_vec=k(a[0],a[1],a[2],1)}}}var ye=0
function getCosmeticsOwnerships(){ye=0
for(var e in w)delete w[e]
for(var t in fe("owned")){var r=U[t]
if(r)for(var a=0;a<r.length;++a){var i=r[a]
if("costume"===i.type){var o=L[i.name]
if(!o)continue
w[i.name]=true
ye++
o.available=true
for(var n=0;n<o.attachments.length;n++){var s=o.attachments[n]
var l=s.base_name||s.name
w[l]=true
for(var _ in s.swaps){var c=l+";"+_+";"+s.swaps[_]
w[c]=true}}if(o.swaps)for(var u in o.swaps){var d=u+";"+o.swaps[u]
w[d]=true}}else if("swap"===i.type)for(var f=0;f<i.values.length;f++){var v=i.key+";"+i.values[f]
w[v]=true}else if("part"===i.type){var h=S[i.name]
if(!h)continue
var p=i.name
w[p]=true
if(h.swaps)for(var m in h.swaps){var E=p+";"+m+";"+h.swaps[m]
w[E]=true}}}}}function cosmeticSwapsOwned(e,t){for(var r in e){var a=t?t+";"+r+";"+e[r]:r+";"+e[r]
if(!w[a])return false}return true}function cosmeticOwned(e){if(n(e)){if(!w[e.swap_key])return false}else if(o(e)){var t=e.base_name||e.name
if(!w[t])return false
if(e.swaps)if(!cosmeticSwapsOwned(e.swaps,t))return false}else if(!w[e.name])return false
return true}function costumeOwned(e){return w[e]||false}function getOwnedCostumesAmount(){return ye}function getPartTypeFromPart(e){var t=S[e]
v(t)
return t.part_type}function getCosmeticsAvailability(){for(var e in L){var t=L[e]
t.available=false
t.expire_date=void 0
t.promo_product_id=void 0}for(var r in I)I[r].available=false
var a=$()
for(var i=0;i<a.length;i++){var o=a[i]
if(!X(o))continue
var n=o.items
for(var s=0;s<n.length;s++){var l=U[n[s].id]
if(!l)continue
for(var _=0;_<l.length;++_){var c=l[_]
if("costume"===c.type){var u=L[c.name]
if(!u)continue
u.available=true
u.expire_date=o.available_until
if(o.is_first_offer)if(q()>0){u.expire_date=K()
u.promo_product_id=o.id}}else if("part"===c.type){var d=I[c.name]
if(!d)continue
d.available=true
d.expire_date=o.available_until}}}}for(var f in I){var v=I[f]
var h=v.costumes
v.available_costumes=[]
if(h)for(var p=0;p<h.length;p++){var m=h[p]
if(L[m].available)v.available_costumes.push(m)}if(v.available_costumes.length)v.available=true}for(var E in A){var g=A[E]
var T=g.costumes
g.available=false
g.available_costumes=[]
if(T)for(var y=0;y<T.length;y++){var S=T[y]
if(L[S].available)g.available_costumes.push(S)}if(g.available_costumes.length)g.available=true}}function maybeTranslated(e,t){var r=e&&H.get(e)
if(r)return String(r)
if(t)return"(EN)"+t
return""}function cosmeticDisplayName(e){var t=maybeTranslated(e.display_name_key,e.display_name_untranslated)
if(!t&&e.display_name)t=e.display_name
return t}function costumeDisplayName(e){var t=L[e]
var r
if(t)r=cosmeticDisplayName(t)
return r||""+H.COSTUME_UNKNOWN}function getAttachSwapData(e,t){var r={swap_key:e.swap_key,swaps:e.swaps}
if(t.swaps){r.swaps=_extends({},e.swaps,t.swaps)
var a=swapKey(r.swaps)
r.swap_key=a}return r}function canInitGeomThisFrame(){return ve!==_()}function attachInit(e,t){var r=getAttachSwapData(t,e)
var a=e.geom+":"+r.swap_key
if(he[a]){e.drawable=he[a]
return}ve=_()
var i="character"
if(r.swaps&&!C(r.swaps))i=Y(i,r.swaps)
var o=de(e.geom,{origin_offset:D(B(),e.origin,1/7),palette:i,noscale:true}).drawing
he[a]=e.drawable=o
if(pe&&pe>100&&++pe%100===0)console.warn("Cached "+pe+" character geometries")}function instantiateCostumeData(e,t){var r=N(e)
r.attachments=r.attachments?r.attachments.slice(0):[]
var a=getDefaultCostume()
if("custom"===t.name&&!t.override&&r.attachments.length<a.attachments.length)for(var i=0;i<a.attachments.length;++i)if(!r.attachments[i])r.attachments.push(a.attachments[i])
if(!C(r.swaps)){if(!C(t.swaps))r.swaps=x(N(r.swaps),t.swaps)}else if(!C(t.swaps))r.swaps=t.swaps
r.swap_key=swapKey(r.swaps)
if(t.parts)for(var o=0;o<t.parts.length;++o){var n=t.parts[o].name
var s=S[n]
var l=t.parts[o].swaps
if(!s){var _=a.parts[o]||a.parts[0]
n=_.name
s=S[n]
v(s)
l=_.swaps}r.attachments[o]=E(s)
if(l)r.attachments[o].swaps=l}for(var c=0;c<r.attachments.length;++c){var u=N(r.attachments[c])
delete u.drawable
if(u.geom){var d=getAttachSwapData(r,u)
var f=u.geom+":"+d.swap_key
if(he[f])u.drawable=he[f]}r.attachments[c]=u}return r}function partLoad(e){var t=R("cosmetics/parts/"+e,"jsobj")
var r=e
var a=y.PART
var i=getTypeKeyFromBone(t.bone)
var o=getPartTypeFromBone(t.bone)
if(!t.geom.endsWith(".vm"))t.geom+=".vm"
var n=_extends({},t,{name:r,cosmetic_type:a,type_key:i,part_type:o,has_costumes:false})
ge[n.bone]=true
return S[e]=n}function partChoiceSpecific(e){v(!e.name.includes(";"))
var t=S[e.name]
v(t)
if(!e.swaps)return I[e.name]=t
var r=partChoiceKey(e)
var a=I[r]
if(a)return a
var i=N(t)
i.costumes=[]
i.base_name=e.name
i.name=r
i.swaps=E(e.swaps)
return I[r]=i}function costumeLoad(e){var t=R(e,"jsobj")
var r=e.slice("cosmetics/costumes/".length)
if(O)if(!t.display_name)if(t.display_name_key){if(!H.get(t.display_name_key)&&!t.display_name_untranslated)b('Costume "'+e+'": references unknown display_name_key "'+t.display_name_key+'": Must either be a valid key, or also have a display_name_untranslated field.')}else if(!t.display_name)b('Costume "'+e+'": has no display name.  Internal-only costumes must have a "display_name" field.  WIP costumes must have "display_name_key" and "display_name_untranslated" fields.')
if(!t.parts)return void b('Costume "'+e+'": has no parts')
if(t.swaps)for(var a in t.swaps){var i=t.swaps[a]
var o=a+";"+i
var n=A[o]
var s=void 0
if(n)s=n
else A[o]=s={swap_key:o,type:a,name:i,display_name_key:"COSMETIC_COLOR_"+i.toUpperCase(),available:false,is_default:false,costumes:[],cosmetic_type:y.SWAP,type_key:getTypeKeyFromSwap(a),color_submenu:-1,color_vec:me}
if(t.display_name_key){var l=s.costumes
if(!l.includes(r))l.push(r)}if(t.rarity){var _=g[t.rarity]
if(!s.rarity||_<g[s.rarity])s.rarity=t.rarity}}var c=[]
var u=[]
var d={}
for(var f=0;f<t.parts.length;f++){var v=t.parts[f]
if("string"===typeof v)v={name:v}
var h=v.name
if(!h){b('Costume "'+e+'": has parts['+f+"] with no name")
continue}var p=S[h]
if(!p){b('Costume "'+e+'": references unknown part "'+h+'"')
continue}p.has_costumes=true
p=partChoiceSpecific(v)
if(t.race_key&&!p.race_key)p.race_key=t.race_key
if(t.collection_key&&!p.collection_key)p.collection_key=t.collection_key
if(t.collection_untranslated&&!p.collection_untranslated)p.collection_untranslated=t.collection_untranslated
if(t.rarity){var m=g[t.rarity]
if(!p.rarity||m<g[p.rarity]){p.rarity=t.rarity
if(t.collection_key)p.collection_key=t.collection_key
if(t.collection_untranslated)p.collection_untranslated=t.collection_untranslated}}d[p.bone]=p
u.push(v)
c.push(p)
p.costumes=p.costumes||[]
if(!p.costumes.includes(r))p.costumes.push(r)}if(d.arm_r&&d.arm_l){d.arm_r.paired_part=d.arm_l.name
d.arm_l.paired_part=d.arm_r.name}if(d.leg_r&&d.leg_l){d.leg_r.paired_part=d.leg_l.name
d.leg_l.paired_part=d.leg_r.name}var E=_extends({},t,{attachments:c,cosmetic_type:y.COSTUME,type_key:T.COSTUME,name:r,parts:u})
return L[r]=E}function swapsLoad(){for(var e in U){if("dev"===e)continue
var t=U[e]
if(t){var r=void 0
for(var a=0;a<t.length;++a){var i=t[a]
if("costume"===i.type&&"def"!==e)r=i.name
if("swap"===i.type)for(var o=0;o<i.values.length;o++){var n=i.key+";"+i.values[o]
if(!A[n])A[n]={swap_key:n,type:i.key,name:i.values[o],display_name_key:"COSMETIC_COLOR_"+i.values[o].toUpperCase(),costumes:r?[r]:[],is_default:"def"===e,available:"def"===e||Q(e),cosmetic_type:y.SWAP,type_key:getTypeKeyFromSwap(i.key),color_vec:me,color_submenu:-1}
else{var s=A[n]
if(!s.is_default)s.is_default="def"===e
if(!s.available)s.available="def"===e||Q(e)
if(r)if(!s.costumes.includes(r))s.costumes.push(r)}}}}}}function cosmeticsLoad(){var e="cosmetics/parts/"
var t=f(e)
for(var r=0;r<t.length;++r)partLoad(t[r].slice(e.length))
var a=f("cosmetics/costumes/")
for(var i=0;i<a.length;++i)costumeLoad(a[i])
for(var o in U){if("dev"===o)continue
var n=U[o]
var s=void 0
for(var l=0;l<n.length;++l){var _=n[l]
if("costume"===_.type&&"def"!==o)s=_.name
if("part"===_.type){var c=_.name
var u=S[c]
if(u){u.has_costumes=true
u=partChoiceSpecific(u)
if(s){u.costumes=u.costumes||[]
if(!u.costumes.includes(s))u.costumes.push(s)}}}}}for(var d in S)if(!S[d].has_costumes)partChoiceSpecific({name:d})}function refreshCurrentCostume(){W()
G(true)}function costumeReload(e){var t=costumeLoad(e)
if(t)F(t)
swapsLoad()
refreshCurrentCostume()}function partReload(e){var t=e.slice("cosmetics/parts/".length)
var r=partLoad(t)
if(r)F(r)
for(var a in I){var i=I[a]
if(i.base_name===t){delete I[a]
partChoiceSpecific({name:t,swaps:i.swaps})}}for(var o in L){if("preview"===o||"custom"===o)continue
var n=L[o]
for(var s=0;s<n.parts.length;s++)if(n.parts[s].name===t){costumeLoad("cosmetics/costumes/"+o)
F(n)
break}}refreshCurrentCostume()}function startup(){cosmeticsLoad()
swapsLoad()
c(/^cosmetics\/costumes\//,costumeReload)
c(/^cosmetics\/parts\//,partReload)}},{"../common/cosmetics_common":241,"../common/entitlements":244,"../glov/client/engine":305,"../glov/client/filewatch":314,"../glov/client/webfs":371,"../glov/common/data_error":381,"../glov/common/enums":385,"../glov/common/util":400,"../glov/common/vmath":402,"./character_customization":39,"./cosmetic_thumbnails":63,"./costume_edit":65,"./localization/localization":131,"./palette":149,"./show_first_offer":187,"./store":195,"./styles":197,"./voxel_data_drawable":217,"./world_comm":226,assert:void 0}],65:[function(e,t,r){"use strict"
r.incrementCurCostumeMod=incrementCurCostumeMod
r.costumeSet=costumeSet
r.costumePreviewActive=costumePreviewActive
r.costumeFromUserChannel=costumeFromUserChannel
r.costumeCurrent=costumeCurrent
r.costumeCurrentMod=costumeCurrentMod
r.getCostumePurchaseOptions=getCostumePurchaseOptions
r.costumeEditStartup=costumeEditStartup
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var p=e("assert")
var a=e("../glov/client/cmds").cmd_parse
var i=e("../glov/client/engine")
var m=e("../glov/client/net").netSubs
var o=e("../glov/common/util")
var c=o.clone
var s=o.empty
var E=o.ridx
var f=e("../common/cosmetics_common").CosmeticTypes
var g=e("../common/entitlements").entitlements
var l=e("./character_customization").characterCustomizationOnMyChannelData
var u=e("./client_cmds").isElevated
var v=e("./cosmetic_thumbnails").cosmeticThumbnailInvalidate
var n=e("./cosmetics")
var h=n.DEFAULT_COSTUME
var T=n.costume_dict
var y=n.getDefaultCostume
var d=n.getPartTypeFromBone
var S=n.partChoiceKey
var I=n.part_choice_dict
var _=n.validBone
var A=e("./palette")
var w=A.paletteGet
var L=A.paletteIsSwapValid
var O=e("./store")
var R=O.canPurchaseProduct
var b=O.getAllProducts
var N=e("./world_comm")
var C=N.getPerm
var x=N.transDelay
var M=Math.max
var D=-1
var P=null
var B=0
function incrementCurCostumeMod(){++B}function costumeSet(t,r){var a=P;++B
x(function(){var e=m().getMyUserChannel()
p(e)
e.send("costume_set",t,function(e){if(a===P)P=null
r(e)})})}function costumePreviewActive(){if(i.frame_index>D+1){P=null;++B}D=i.frame_index}function costumePreviewIsActive(){return D===i.frame_index}var k={}
function costumeFromUserChannel(e){if(!e.isFullySubscribed())return null
var t=e.channel_subid
var r=k[t]
if(!r)r=k[t]={dirty:true}
if(!r.dirty){p(r.costume)
return r.costume}var a=e.getChannelData("public.costume",null)
if(!a||!a.name)a={name:h}
if(a&&"custom"===a.name){var i=a.parts||[]
var o=y().parts
var n=M(o.length,i.length)
for(var s=0;s<n;s++){var l=i[s]
if(!l)l=i[s]={name:"filled below"}
var _=S(l)
var c=I[_]
if(!c){var u=o[s]||o[0]
_=S(u)
c=I[_]
p(c)
l.name=c.base_name||c.name
l.swaps=c.swaps}}a={name:a.name,swaps:a.swaps,parts:i}}else if(!T[a.name])a={name:h}
var d=_extends({},a,{cosmetic_type:f.COSTUME})
v(d,e.channel_id)
r.costume=d
r.dirty=false
return d}var U
function costumeCurrent(e){if(P&&costumePreviewIsActive()&&!e)return P
var t=m().getMyUserChannel()
if(!t)return U||{name:h}
var r=costumeFromUserChannel(t)
if(!r)r=U||{name:h}
if("custom"===r.name){p(r.parts)
var a=[]
for(var i=0;i<r.parts.length;i++){var o=r.parts[i]
var n=S(o)
var s=I[n]
p(s)
a.push(s)}T.custom={name:r.name,swaps:r.swaps,parts:r.parts,attachments:a,display_name_key:"COSMETIC_COSTUME_CUSTOM",cosmetic_type:f.COSTUME}}return U=r}function costumeCurrentMod(){return B}var G
var F
function getCostumePurchaseOptions(){var e=m().getMyUserChannel()
if(!e)return{costumes:[],parts:[]}
var t=e.channel_id+"_"+e.channel_data_ver
if(t===F)return G
var i=[]
var o=[]
var n={}
function addEntitlement(e){var t=g[e]
if(t)for(var r=0;r<t.length;++r){var a=t[r]
if("costume"===a.type&&!n[a.name]){i.push(a.name)
n[a.name]=true}if("part"===a.type&&!n[a.name]){o.push(a.name)
n[a.name]=true}}}var r=b()
for(var a=0;a<r.length;++a){var s=r[a]
if(R(s)){var l=s.items
for(var _=0;_<l.length;++_)addEntitlement(l[_].id)}}for(var c in C("owned")){var u=g[c]
if(u)for(var d=0;d<u.length;++d){var f=u[d]
if("costume"===f.type&&n[f.name]){var v=i.indexOf(f.name)
p(-1!==v)
E(i,v)
delete n[f.name]}if("part"===f.type&&n[f.name]){var h=o.indexOf(f.name)
p(-1!==h)
E(o,h)
delete n[f.name]}}}F=t
return G={costumes:i,parts:o}}function onChannelData(e,t,r){var a=this
var i=m().getMyUserChannel()
if(!t||t.startsWith("public.costume")||"public.headshot_angle"===t){if(i===a)++B
var o=a.channel_subid
var n=k[o]
if(n)n.dirty=true}if(i===a)l(e,t,r)}function costumeEditStartup(){m().onChannelEvent("user","channel_data",onChannelData)}function changeCostumePart(e,t,r){var a=I[t]
if(!a)return void r("Part does not exist")
var i=c(e)
var o=a.bone
var n=d(o)
if(void 0===n)return void r("Bone does not exist: "+o)
if(i.parts)i.parts[n]={name:t}
else{i.parts=[]
i.parts[n]={name:t}}if(u())i.override=true
costumeSet(i,r)}function changeCostumePartSwap(e,t,r,a,i){var o
var n=c(e)
var s=d(t)
if(void 0===s)return void i("Bone does not exist: "+t)
if(!n.parts)n.parts=[]
if(!n.parts[s]){var l=T[n.name]
p(l)
for(var _=0;_<l.attachments.length;_++)if(l.attachments[_].bone===t){n.parts[s]={name:l.attachments[_].name,swaps:{}}
break}}n.parts[s].swaps=_extends({},n.parts[s].swaps,((o={})[r]=a,o))
if(u())n.override=true
costumeSet(n,i)}a.register({cmd:"costume",help:"(Hidden) Set costume by name",access_show:["sysadmin"],func:function func(e,t){if(!e){var r=m().getMyUserChannel()
p(r)
t(null,c(r.getChannelData("public.costume",{name:h})))}else{var a={name:e}
if(u())a.override=true
costumeSet(a,t)}}})
a.register({cmd:"costume_set_part",help:"(Hidden) Set  or clear a costume part",usage:"$HELP\n  Usage: /costume_set_part [PartName || PartBone]\nexample: /costume_set_part armor_captain_arm_r\nexample: /costume_set_part arm_r",access_show:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length)return void t("Invalid number of arguments")
var a=r[0]
var i=d(a)
if(void 0!==i){var o=costumeCurrent()
if(!o.parts)return void t("Costume not currently using custom parts")
else if(o.parts&&!o.parts[i])return void t('Costume not currently using a custom part for bone "'+a+'"')
else{o.parts[i]=y().parts[i]
costumeSet(o,t)}}else changeCostumePart(costumeCurrent(),a,t)}})
a.register({cmd:"costume_set_part_swap",help:"(Hidden) Set  or clear costume part swaps",usage:"$HELP\n  Usage: /costume_set_part PartBone [SwapName SwapValue]\nexample: /costume_set_part_swap arm_r arms_primary pale_green\nexample: /costume_set_part_swap arm_r",access_show:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&3!==r.length)return void t("Invalid number of arguments")
var a=r[0]
if(!_(a))return void t("Invalid bone type")
if(1===r.length){var i=d(a)
if(void 0===i)return void t("Bone does not exist")
var o=c(costumeCurrent())
if(!o.parts)return void t("No parts to clear")
else if(!o.parts[i]||o.parts[i]&&!o.parts[i].swaps)return void t("No part swaps to clear")
else delete o.parts[i].swaps
if(u())o.override=true
costumeSet(o,t)}else if(3===r.length)changeCostumePartSwap(costumeCurrent(),a,r[1],r[2],t)}})
a.register({cmd:"costume_swap",help:"(Hidden) Set or clear a palette swap on your current costume",usage:"$HELP\n  Usage: /costume_swap key [value]\n  Example: /costume_swap hair brown",access_show:["sysadmin"],func:function func(e,t){var r=e.split(" ")
if(1!==r.length&&2!==r.length)return void t("Usage: /costume_swap key [value]")
var a=m().getMyUserChannel()
p(a)
var i=c(a.getChannelData("public.costume",{name:h}))
i.swaps=i.swaps||{}
var o=r[0],n=r[1]
if(!n){if(!i.swaps[o])return void t('Costume does not currently swap "'+o+'"')
delete i.swaps[o]
if(s(i.swaps))delete i.swaps}else{if(!L(w("character"),o,n))return void t("Invalid palette swap: "+o+", "+n)
i.swaps[o]=n}if(u())i.override=true
costumeSet(i,t)}})},{"../common/cosmetics_common":241,"../common/entitlements":244,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/net":338,"../glov/common/util":400,"./character_customization":39,"./client_cmds":43,"./cosmetic_thumbnails":63,"./cosmetics":64,"./palette":149,"./store":195,"./world_comm":226,assert:void 0}],66:[function(e,t,r){"use strict"
r.craftClassMatches=craftClassMatches
r.sourceMatches=sourceMatches
r.canCraft=canCraft
var a=e("../common/ids")
var l=a.TYPE_CRAFT_CLASS
var _=a.TYPE_ITEM
var i=e("../common/items_common").itemIsReleased
var c=e("../common/materials_common").Mat
var o=e("./app_access").accessPrerelease
var n=e("./inventory")
var s=n.INV_PLAYER
var u=n.inventoryGet
var d=n.inventoryGetSize
function craftClassMatches(e,t){return Boolean(t.craft_classes&&t.craft_classes[e]&&i(t,o()))}function sourceMatches(e,t,r){if(t>=e.inputs.length)return false
if(!r)return false
var a=e.inputs[t]
var i=a.source
var o=i[1]
var n=i[2]
var s=i[3]||0
if(o===l){if(!craftClassMatches(n,r))return false}else{if(r.type!==o||r.id!==n)return false
if(o===_)if(s!==c.ANY&&(r.attr1||0)!==s)return false}if(a.source_check_cb&&!a.source_check_cb(r))return false
return true}function canCraft(e){var t=[]
for(var r=d(s)-1;r>=0;--r){var a=u(r)
if(a)t.push(a)}for(var i=0;i<e.inputs.length;++i){var o=false
for(var n=0;n<t.length;++n)if(sourceMatches(e,i,t[n])){o=true
break}if(!o)return false}return true}},{"../common/ids":249,"../common/items_common":251,"../common/materials_common":253,"./app_access":12,"./inventory":114}],67:[function(e,t,r){"use strict"
r.RARITY_LABEL=r.CMOD_FORMAT=r.CMOD_NAME=r.CMOD_TABLE=r.CMODS=void 0
var a
var i=e("assert")
var o=e("../glov/client/engine")
var n=e("./localization/localization")
var s=n.DURATION_ONLY_MINUTES
var l=n.DURATION_ONLY_SECONDS
var _=n.L
var c=e("./ui_util").STAMINA_SYMBOL
var u=Math.round
var d={DURABILITY:"dur",DIG_RATE:"dig",STAMINA_RATE:"stamrate",RARITY:"rar",SPRINTING_STAMINA:"sprint",O2_CAPACITY:"o2cap",STAMINA_CAPACITY:"stamcap",PREVIEW_MOD_COUNT_MIN:"PREVIEW_MOD_COUNT_MIN",PREVIEW_MOD_COUNT_MAX:"PREVIEW_MOD_COUNT_MAX",STAMINA:"stam",STAMINA_DRAIN:"stam_drain",RANGE:"rng",UNDERWATER_SPEED:"uwspd",SPEED:"spd",TIMED:"t_",TIMED_STAMINA_SMALL:"t_stam_s",TIMED_STAMINA_MED:"t_stam_m",TIMED_STAMINA_LARGE:"t_stam_l",TIMED_DIG_RATE_SMALL:"t_dig_s",TIMED_DIG_RATE_MED:"t_dig_m",TIMED_DIG_RATE_LARGE:"t_dig_l",TIMED_SPRINTING_STAMINA_LARGE:"t_sprint_l",TIMED_O2_CAPACITY_LARGE:"t_o2cap_l",TIMED_UNDERWATER_SPEED_MEDIUM:"t_uwspd_m",TIMED_SPEED_MEDIUM:"t_spd_m",TIMED_STAM_CAPACITY_WGSICK:"t_stamcap_sick",TIMED_STAM_CAPACITY_WELL1:"t_stamcap_w1",TIMED_STAM_CAPACITY_WELL2:"t_stamcap_w2"}
r.CMODS=d
if(o.DEBUG&&"function"===typeof Proxy)r.CMODS=d=new Proxy(d,{get:function get(e,t){var r=e[t]
i(r)
return r}})
var f=[1,1.05,1.1,1.25,1.5]
var v=[0,400,600,800,1200,1600,2800,4e3,4800]
var h=[0,-800]
var p={};(r.CMOD_TABLE=p)[d.DIG_RATE]=f
p[d.STAMINA_RATE]=f
p[d.DURABILITY]=f
p[d.RANGE]=f
p[d.STAMINA]=v
p[d.STAMINA_DRAIN]=h
p[d.TIMED_STAMINA_SMALL]=10
p[d.TIMED_STAMINA_MED]=50
p[d.TIMED_STAMINA_LARGE]=100
p[d.TIMED_DIG_RATE_SMALL]=f[1]
p[d.TIMED_DIG_RATE_MED]=f[2]
p[d.TIMED_DIG_RATE_LARGE]=f[3]
p[d.TIMED_SPRINTING_STAMINA_LARGE]=2
p[d.TIMED_O2_CAPACITY_LARGE]=2
p[d.TIMED_UNDERWATER_SPEED_MEDIUM]=1.5
p[d.TIMED_SPEED_MEDIUM]=1.3
p[d.TIMED_STAM_CAPACITY_WGSICK]=.5
p[d.TIMED_STAM_CAPACITY_WELL1]=1.25
p[d.TIMED_STAM_CAPACITY_WELL2]=1.5
var m={};(r.CMOD_NAME=m)[d.DIG_RATE]=_.CMODS_DIG_RATE
m[d.STAMINA_RATE]=_.$(_.CMODS_STAMINA_RATE,c)
m[d.DURABILITY]=_.CMODS_DIG_DURABILITY
m[d.RANGE]=_.CMODS_STAMINA_RANGE
m[d.STAMINA]=c
m[d.STAMINA_DRAIN]=_.$(_.CMODS_STAMINA_DRAIN,c)
m[d.TIMED_STAMINA_SMALL]=m[d.TIMED_STAMINA_MED]=m[d.TIMED_STAMINA_LARGE]=_.$(_.CMODS_TIMED_STAMINA,c)
m[d.TIMED_DIG_RATE_SMALL]=m[d.TIMED_DIG_RATE_MED]=m[d.TIMED_DIG_RATE_LARGE]=_.CMODS_TIMED_DIG_RATE
m[d.TIMED_SPRINTING_STAMINA_LARGE]=_.$(_.CMODS_TIMED_SPRINTING_STAMINA,c)
m[d.TIMED_O2_CAPACITY_LARGE]=_.CMODS_O2_CAPACITY
m[d.TIMED_UNDERWATER_SPEED_MEDIUM]=_.CMODS_UNDERWATER_SPEED
m[d.TIMED_SPEED_MEDIUM]=_.CMODS_SPEED
m[d.TIMED_STAM_CAPACITY_WGSICK]=_.$(_.CMODS_TIMED_STAMINA_CAPACITY_WGSICK,c)
m[d.TIMED_STAM_CAPACITY_WELL1]=m[d.TIMED_STAM_CAPACITY_WELL2]=_.$(_.CMODS_STAMINA_CAPACITY,c)
function percent(e){return _.addPercentage(u(100*e))}function plusPercent(e,t){return"+"+percent(p[t][e[t]]-1)+" "+m[t]}function plusValue(e,t){return"+"+p[t][e[t]]+" "+m[t]}function minusValue(e,t){return _.CMODS_NOT_GOOD}function previewModCount(e,t){var r=e[d.PREVIEW_MOD_COUNT_MIN]||0
var a=e[d.PREVIEW_MOD_COUNT_MAX]
return _.$(_.CMODS_RANDOM_BONUSES,r,a)}function timed(e,t,r){var a=t[r]
var i=u(a/60)
var o=i>=8?_.duration(60*i,s):_.duration(a,l)
return _.$(_.CMODS_TIMED,e,m[r],o)}function timedRegen(e,t){return timed("+"+p[t],e,t)}function timedPercent(e,t){var r=p[t]-1
return timed((r<0?"":"+")+percent(r),e,t)}var E=((a={})[d.DIG_RATE]=plusPercent,a[d.STAMINA_RATE]=plusPercent,a[d.DURABILITY]=plusPercent,a[d.RANGE]=plusPercent,a[d.PREVIEW_MOD_COUNT_MAX]=previewModCount,a[d.STAMINA]=plusValue,a[d.STAMINA_DRAIN]=minusValue,a[d.TIMED_STAMINA_SMALL]=timedRegen,a[d.TIMED_STAMINA_MED]=timedRegen,a[d.TIMED_STAMINA_LARGE]=timedRegen,a[d.TIMED_DIG_RATE_SMALL]=timedPercent,a[d.TIMED_DIG_RATE_MED]=timedPercent,a[d.TIMED_DIG_RATE_LARGE]=timedPercent,a[d.TIMED_SPRINTING_STAMINA_LARGE]=timedPercent,a[d.TIMED_O2_CAPACITY_LARGE]=timedPercent,a[d.TIMED_UNDERWATER_SPEED_MEDIUM]=timedPercent,a[d.TIMED_SPEED_MEDIUM]=timedPercent,a[d.TIMED_STAM_CAPACITY_WGSICK]=timedPercent,a[d.TIMED_STAM_CAPACITY_WELL1]=timedPercent,a[d.TIMED_STAM_CAPACITY_WELL2]=timedPercent,a)
r.CMOD_FORMAT=E
var g=[null,_.LBL_RARITY_COMMON,_.LBL_RARITY_UNCOMMON,_.LBL_RARITY_RARE]
r.RARITY_LABEL=g},{"../glov/client/engine":305,"./localization/localization":131,"./ui_util":205,assert:void 0}],68:[function(e,t,r){"use strict"
r.recipeValidName=recipeValidName
r.getCraftCost=getCraftCost
r.getRecipesForFactory=getRecipesForFactory
r.getItemExamples=getItemExamples
r.craftingRecipes=craftingRecipes
r.craftingRecipesLocalizationStartup=craftingRecipesLocalizationStartup
r.craftingRecipesStartup=craftingRecipesStartup
r.recipes=void 0
var b=e("assert")
var N=e("../glov/client/engine")
var C=e("../glov/client/error_report.js").errorReportSetDetails
var a=e("../glov/common/util").defaults
var x=e("../glov/common/verify")
var i=e("../glov/common/vmath").vec3
var o=e("../common/ids")
var n=o.ITEM_ALGAE_SPORES
var s=o.ITEM_ANEMONE_PILE
var l=o.ITEM_ANVIL
var _=o.ITEM_ARBORHEART
var c=o.ITEM_BERRY
var u=o.ITEM_BONFIRE
var d=o.ITEM_BONFIRE_METAL
var f=o.ITEM_BOTTLE
var v=o.ITEM_BRANCHFORGE
var h=o.ITEM_BREAD
var p=o.ITEM_BUCKET
var m=o.ITEM_CACTINY_SEEDS
var E=o.ITEM_CACTORB_SEEDS
var g=o.ITEM_CAMPFIRE
var T=o.ITEM_CARROT
var y=o.ITEM_COAL
var S=o.ITEM_CORAL_CRUNCH
var I=o.ITEM_CORAL_POWDER
var A=o.ITEM_CORD
var w=o.ITEM_CORN
var L=o.ITEM_CROISSANT
var O=o.ITEM_DOWSER_ADVANCED
var R=o.ITEM_DOWSER_SIMPLE
var M=o.ITEM_FACTORY_DEBUG
var D=o.ITEM_FIBER
var P=o.ITEM_FLOUR
var B=o.ITEM_FURNACE_GLASS
var k=o.ITEM_FURNACE_ORE
var U=o.ITEM_GROW
var G=o.ITEM_HATCHET
var F=o.ITEM_HOE
var W=o.ITEM_INGOT
var H=o.ITEM_JUICE
var z=o.ITEM_JUICER
var V=o.ITEM_KILN
var Y=o.ITEM_LEFTOVERS
var j=o.ITEM_MILL
var K=o.ITEM_MUSHROOM
var q=o.ITEM_ORE
var Z=o.ITEM_OVEN
var X=o.ITEM_PAINT
var Q=o.ITEM_PAINT_MIXER
var $=o.ITEM_PICKAX
var J=o.ITEM_PIE
var ee=o.ITEM_PLANT
var te=o.ITEM_PUMPKIN
var re=o.ITEM_ROAST_SEAFOOD
var ae=o.ITEM_ROAST_VEGETABLES
var ie=o.ITEM_ROD
var oe=o.ITEM_SANDWICH
var ne=o.ITEM_SAWMILL
var se=o.ITEM_SEASHELL_PILE
var le=o.ITEM_SEA_CANDY
var _e=o.ITEM_SHOVEL
var ce=o.ITEM_SPICE
var ue=o.ITEM_STARFISH_PILE
var de=o.ITEM_STONECUTTER_SIMPLE
var fe=o.ITEM_SUGAR
var ve=o.ITEM_SUGAR_CANE
var he=o.ITEM_TOMATO
var pe=o.ITEM_TOOL_HEAD
var me=o.ITEM_TOOL_HEAD_CAST
var Ee=o.ITEM_VEINIUM_GRINDER
var ge=o.ITEM_WORKBENCH
var Te=o.TYPE_BLOCK
var ye=o.TYPE_CRAFT_CLASS
var Se=o.TYPE_ITEM
var Ie=o.TYPE_RECIPE
var Ae=e("../common/materials_common")
var we=Ae.CraftClass
var Le=Ae.Mat
var Oe=e("../common/world_constants").ATTRIB_FIXED_MAX
var Re=e("./crafting_mods").CMODS
var be=e("./items.js")
var Ne=be.ITEM_ID_NAME
var Ce=be.TOOL_BASE_HP
var xe=be.addItemAdjectives
var Me=be.craftClassAndMatToItem
var De=be.createItem
var Pe=be.getItemsForCraftClass
var Be=be.getItemsForMatAny
var ke=be.getItemsForRecipe
var Ue=be.isItem
var Ge=be.sameItem
var Fe=be.satisfiesCost
var We=e("./localization/localization").L
var He=e("./materials")
var ze=He.ALLOYS
var Ve=He.CRAFT_CLASS_NAME
var Ye=He.CRAFT_CLASS_TO_MATERIAL_CLASS
var je=He.MATERIAL_DURABILITY_FACTOR
var Ke=He.MATERIAL_INGOT_SCALE
var qe=He.MATERIAL_TIER
var Ze=He.MaterialClass
var Xe=e("./proc_gen").deepestOreFromWorldPos
var Qe=e("./stone_tiers")
var $e=Qe.ORE_DISTRO
var Je=Qe.ORE_DROPRATE
var et=e("./tiles")
var tt=e("./tiles")
var rt=tt.TILE_EMPTY
var at=tt.TILE_WATER
var it=tt.tile_map_default
var ot=e("./voxel_data").getWorldPosFromChunkID
var nt=Math.floor,st=Math.max,lt=Math.min,_t=Math.random,ct=Math.round
var ut=Le.IRON
var dt=3/128
var ft=.21875
var vt=[We.LBL_RECIPE_TAG_CONSUMABLE,We.LBL_RECIPE_TAG_CRAFTING_MAT,We.LBL_RECIPE_TAG_FUEL,We.LBL_RECIPE_TAG_INGREDIENT,We.LBL_RECIPE_TAG_PLACEABLE]
var ht=0
var pt=1
var mt=2
var Et=3
var gt=4
function outputInput0IgnoreQuality(e){return De({type:Se,id:this.item_id,attr1:e[0].getMaterial(),attr2:this.material2,attr3:0})}function outputSimple(e){return De({type:Se,id:this.item_id,attr1:0,attr2:0,attr3:0})}function outputSpicedFood(e){return De({type:Se,id:this.item_id,attr1:e[0].attr1,attr2:0,attr3:e[1].attr3})}function outputFromOutputList(e){var t=this.output_list
for(var r=0;r<t.length;++r){var a=t[r]
for(var i=1;i<a.length;i++){var o=a[i]
var n=e[i-1]
if(Fe(o,n)){if(i===a.length-1)return De(a[0])}else break}}return null}var Tt=[[J,ce,{id:J,spiced:1,mat:0}],[ae,h,{id:oe,mat:0}],[re,h,{id:oe,mat:0}],[oe,ce,{id:oe,spiced:1,mat:0}],[ae,ce,{id:ae,spiced:1,mat:0}],[re,ce,{id:re,spiced:1,mat:0}],[P,c,{id:J,mat:1}],[le,ce,{id:le,spiced:1}],[S,ce,{id:S,spiced:1}],[P,K,{id:J,mat:1}],[L,ce,{id:L,spiced:1}]]
var yt=[[{type:Se,id:h},{type:Se,id:P},{type:Se,id:w}],[{type:Se,id:J,attr1:Le.TOMATO},{type:Se,id:P},{type:Se,id:he}],[{type:Se,id:J,attr1:Le.PUMPKIN},{type:Se,id:P},{type:Se,id:te}],[{type:Se,id:J,attr1:Le.CARROT},{type:Se,id:P},{type:Se,id:T}],[{type:Se,id:L},{type:Se,id:P},{type:Se,id:fe}],[{type:Se,id:le},{type:Se,id:I},{type:Se,id:fe}],[{type:Se,id:S},{type:Se,id:I},{type:Se,id:L}]]
var St=function(){var e={}
for(var t=0;t<Tt.length;++t)e[Tt[t][2].id]=true
return e}()
function ovenReverse(e){var t=Le.ANY
if((e.attr1||t)===t&&!e.attr3)if(e.id===J)return[De({type:Se,id:P}),De({type:ye,id:we.PIE_FILLING})]
else if(e.id===oe)return[De({type:Se,id:h}),De({type:ye,id:we.SANDWICH_FILLING})]
for(var r=0;r<Tt.length;++r){var a=Tt[r]
var i=a[2]
if(i.id!==e.id)continue
var o=void 0!==i.spiced
if(Boolean(e.attr3)!==o)continue
var n=[]
var s=[]
var l=[]
if(void 0!==i.mat){n[i.mat]=e.attr1||t
if(!De({type:Se,id:a[i.mat],attr1:n[i.mat]}).isAllowedInInventoryAndReleased())continue}if(o)s[i.spiced]=e.attr3
for(var _=0;_<2;++_)l.push(De({type:Se,id:a[_],attr1:n[_],attr3:s[_]}))
return l}return null}var It=i()
function veiniumGrinderOutput(e,t,r){var a=0
if(!t){ot(It,r.chunk_id,r.pos)
var i=Xe(It)
var o=0
for(var n=st(0,i-4);n<=i;++n)o+=Je[n]
a=nt(_t()*o)
o=0
for(var s=st(1,i-4);s<=i;++s)if((o+=Je[s])>a){a=s
break}}return De({type:Se,id:this.item_id,attr1:$e[a],attr2:0,attr3:0})}function ovenOutput(e){var t=outputFromOutputList.call(this,e)
if(t)return t
var r=[]
r[0]=e[0]
r[1]=e[1]
for(var a=0;a<Tt.length;++a){var i=Tt[a]
if(r[0].id===i[0]&&r[1].id===i[1]||r[1].id===i[0]&&r[0].id===i[1]){var o
r[0]=r[0].id===i[0]?e[0]:e[1]
r[1]=r[1].id===i[0]?e[0]:e[1]
var n=i[2]
var s=void 0
if(void 0!==n.spiced)s=r[n.spiced].attr3
var l={type:Se,id:i[2].id,count:1,attr1:(null==(o=r[n.mat])?void 0:o.attr1)||0,attr3:s||0}
return De(l)}}return De({type:Se,id:Y,count:1})}function timeConstant(t){return function(e){return t}}var At=10
var wt={at_factory:[ge],inputs:[{name:We.LBL_RECIPE_INPUT_HEAD,source:[1,Se,pe,Le.ANY]},{name:We.LBL_RECIPE_INPUT_HAFT,source:[1,Se,ie,Le.ANY]},{name:We.LBL_RECIPE_INPUT_BINDING,source:[2,Se,A]}],available_mods:[Re.DURABILITY,Re.STAMINA_RATE,Re.DIG_RATE],do_attr2:true,output:function output(e,t){var r={hp:Oe}
if(t){r[Re.PREVIEW_MOD_COUNT_MIN]=1
r[Re.PREVIEW_MOD_COUNT_MAX]=4}else{var a=_t()
var i=1
if(a<dt){r[Re.RARITY]=3
i=4}else if(a<ft)i=r[Re.RARITY]=2
else r[Re.RARITY]=1
var o=this.available_mods
for(var n=0;n<i;++n){a=_t()
var s=o[nt(a*o.length)]
r[s]=(r[s]||0)+1}}return De({type:Se,id:this.item_id,attr1:e[0].getMaterial(),attr2:this.do_attr2?e[1].getMaterial():0,attr3:0,attribs:r})},time:timeConstant(At),needs_finish:true}
function outputDowser(e,t){var r={}
if(t)r[Re.PREVIEW_MOD_COUNT_MAX]=2
else{var a=_t()
var i=0
if(a<dt){r[Re.RARITY]=3
i=2}else if(a<ft){r[Re.RARITY]=2
i=1}for(var o=0;o<i;++o){var n=Re.RANGE
r[n]=(r[n]||0)+1}}return De({type:Se,id:this.item_id,attr1:e[0].getMaterial(),attr2:e[1].getMaterial(),attr3:0,attribs:r})}function isAlloySource(e){var t=e.getMaterial()
if(ze[t])return true
for(var r in ze){var a=ze[r]
for(var i in a)if(a[i]===t)return false}return true}function getAlloysOutputList(){var e=[]
for(var t in ze){t=Number(t)
var r=Object.keys(ze[t])
b.equal(r.length,1)
var a=Number(r[0])
var i=ze[t][a]
b(i)
e.push([{type:Se,id:W,attr1:i,count:1},{type:Se,id:W,attr1:t,count:1},{type:Se,id:W,attr1:a,count:1},{type:ye,id:we.FUEL,count:2}])}e.push([{type:Se,id:W,attr1:Le.MUTTAL,count:1},{type:Se,id:W,attr1:Le.ANY,count:1},{type:Se,id:W,attr1:Le.ANY,count:1},{type:ye,id:we.FUEL,count:2}])
return e}function orderInvariant(e){var t=[]
for(var r=0;r<e.length;++r){var a=e[r]
b(a.length>=3)
t.push(a)
var i=(a=a.slice(0))[1]
a[1]=a[2]
a[2]=i
t.push(a)}return t}var Lt={cord:{icon:{type:Se,id:A},at_factory:[ge],tags:[pt],inputs:[{source:[2,Se,D]},{name:We.LBL_RECIPE_INPUT_CATALYST,source:[1,ye,we.STONE_RAW]}],output:outputFromOutputList,output_list:[[{type:Se,id:A,count:1},{type:Se,id:D,count:2},{type:ye,id:we.STONE_RAW,count:1}]],time:timeConstant(3)},wood_rod:{icon:{type:Se,id:ie,attr1:Le.WOOD},at_factory:[ne],tags:[gt,pt],inputs:[{name:We.LBL_RECIPE_INPUT_MATERIAL,source:[3,ye,we.WOOD_RAW]}],item_id:ie,output:outputInput0IgnoreQuality,time:timeConstant(25)},arborheart:{icon:{type:Se,id:_},at_factory:[v],inputs:[{name:We.LBL_RECIPE_INPUT_MATERIAL,source:[7,ye,we.WOOD_RAW]},{name:We.LBL_RECIPE_INPUT_CATALYST,source:[15,Te,et.LEAVES3]},{name:We.LBL_RECIPE_INPUT_LIFE,source:[1,Se,ee,Le.ANY]}],item_id:_,output:outputInput0IgnoreQuality,time:timeConstant(90)},oven:{icon:{type:Se,id:h},at_factory:[Z],tags:[ht],inputs:[{name:We.LBL_RECIPE_INPUT_INGREDIENT,source:[1,ye,we.INGREDIENT]},{name:We.LBL_RECIPE_INPUT_INGREDIENT,source:[1,ye,we.INGREDIENT]}],item_ids:St,reverse:ovenReverse,output:ovenOutput,output_list:orderInvariant(yt),time:timeConstant(5)},mill:{icon:{type:Se,id:P},at_factory:[j],tags:[Et],inputs:[{name:We.LBL_RECIPE_INPUT_GRINDABLE,source:[3,ye,we.GRINDABLE]}],output:outputFromOutputList,output_list:[[{type:Se,id:P},{type:ye,id:we.CEREAL_GRAIN}],[{type:Se,id:fe},{type:Se,id:ve}],[{type:Se,id:I},{type:Se,id:se}]],time:timeConstant(5)},campfire:{icon:{type:Se,id:ae,attr1:Le.CARROT},at_factory:[g],tags:[ht],inputs:[{name:We.LBL_RECIPE_INPUT_INGREDIENT,source:[1,ye,we.INGREDIENT]}],output:outputFromOutputList,output_list:[[{type:Se,id:ae,attr1:Le.TOMATO},{type:Se,id:he}],[{type:Se,id:ae,attr1:Le.PUMPKIN},{type:Se,id:te}],[{type:Se,id:ae,attr1:Le.CARROT},{type:Se,id:T}],[{type:Se,id:ae,attr1:Le.BROWN_MUSHROOM},{type:Se,id:K,attr1:Le.BROWN_MUSHROOM}],[{type:Se,id:ae,attr1:Le.LUMINESCENT_MUSHROOM},{type:Se,id:K,attr1:Le.LUMINESCENT_MUSHROOM}],[{type:Se,id:ae,attr1:Le.RED_MUSHROOM},{type:Se,id:K,attr1:Le.RED_MUSHROOM}],[{type:Se,id:ae,attr1:Le.CORAL_MUSHROOM},{type:Se,id:K,attr1:Le.CORAL_MUSHROOM}],[{type:Se,id:ae,attr1:Le.CORN},{type:Se,id:w}],[{type:Se,id:re,attr1:Le.ANEMONE},{type:Se,id:s}],[{type:Se,id:re,attr1:Le.STARFISH},{type:Se,id:ue}],[{type:Se,id:Y},{type:ye,id:we.INGREDIENT}],[{type:Se,id:ae,attr1:Le.ANY},{type:ye,id:we.VEGETABLE}],[{type:Se,id:re,attr1:Le.ANY},{type:ye,id:we.SEAFOOD}]],time:timeConstant(5)},juice:{icon:{type:Se,id:H,attr1:Le.RED_BERRY},at_factory:[z],inputs:[{name:We.LBL_RECIPE_INPUT_BERRY,source:[3,Se,c,Le.ANY]},{name:We.LBL_RECIPE_INPUT_BOTTLE,source:[1,Se,f]}],item_id:H,output:outputInput0IgnoreQuality,time:timeConstant(5),reverse:function reverse(e){if(e.attr3)return null
var t=this.inputs[0].source
var r=this.inputs[1].source
return[De({type:t[1],id:t[2],count:t[0],attr1:e.attr1}),De({type:r[1],id:r[2],count:r[0]})]}},spicy_juice:{icon:{type:Se,id:H,attr1:Le.RED_BERRY,attr3:Le.SAVORY},at_factory:[z],inputs:[{source:[1,Se,H,Le.ANY]},{source:[1,Se,ce,Le.ANY]}],item_id:H,output:outputSpicedFood,time:timeConstant(5),reverse:function reverse(e){if(!e.attr3||!e.attr1)return null
var t=this.inputs[0].source
var r=this.inputs[1].source
return[De({type:t[1],id:t[2],count:t[0],attr1:e.attr1}),De({type:r[1],id:r[2],count:r[0],attr3:e.attr3})]}},metal_rod:{icon:{type:Se,id:ie,attr1:ut},at_factory:[l],tags:[gt,pt],inputs:[{name:We.LBL_RECIPE_INPUT_MATERIAL,source:[1,Se,W,Le.ANY]}],item_id:ie,output:outputInput0IgnoreQuality,time:timeConstant(30)},stone_tool_head:{icon:{type:Se,id:pe,attr1:Le.STONE},at_factory:[de],tags:[pt],inputs:[{name:We.LBL_RECIPE_INPUT_HEAD,source:[3,ye,we.STONE_RAW]}],output:outputFromOutputList,output_list:[[{type:Se,id:pe,attr1:Le.STONE},{type:ye,id:we.STONE_RAW,count:3}]],time:timeConstant(20)},metal_tool_head_cast:{icon:{type:Se,id:pe,attr1:ut},at_factory:[me],tags:[pt],inputs:[{name:We.LBL_RECIPE_INPUT_HEAD,source:[3,ye,we.SCALED_INGOT]},{name:We.LBL_RECIPE_INPUT_FUEL,source:[1,ye,we.FUEL]}],item_id:pe,output:outputInput0IgnoreQuality,time:timeConstant(30)},metal_tool_head:{icon:{type:Se,id:pe,attr1:ut},at_factory:[l],tags:[pt],inputs:[{name:We.LBL_RECIPE_INPUT_HEAD,source:[3,ye,we.SCALED_INGOT]}],item_id:pe,output:outputInput0IgnoreQuality,time:timeConstant(20)},veinium_grind:{icon:{type:Se,id:q,attr1:ut},at_factory:[Ee],tags:[pt],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[10,Te,et.VEINIUM]}],output:veiniumGrinderOutput,time:timeConstant(120),item_id:q},paint_color:{icon:{type:Se,id:X,attr1:Le.RED},at_factory:[Q],inputs:[{name:We.LBL_RECIPE_INPUT_COLOR,source:[1,ye,we.PAINT_COLOR]},{source:[1,Se,D]}],item_id:X,output:outputFromOutputList,output_list:[[{type:Se,id:X,attr1:Le.RED},{type:Se,id:c,attr1:Le.RED_BERRY},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.YELLOW},{type:Se,id:c,attr1:Le.YELLOW_BERRY},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.BLUE},{type:Se,id:c,attr1:Le.BLUE_BERRY},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.RED},{type:Se,id:E,attr1:Le.RUBY_CACTORB},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.BLUE},{type:Se,id:E,attr1:Le.KYANITE_CACTORB},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.YELLOW},{type:Se,id:m,attr1:Le.LIZARDITE_CACTINY},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.PURPLE},{type:Se,id:m,attr1:Le.AMETHYST_CACTINY},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.GREEN},{type:Se,id:n,attr1:Le.MINT_ALGAE},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.GREEN},{type:Se,id:n,attr1:Le.JADE_ALGAE},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.ORANGE},{type:Se,id:n,attr1:Le.BUBBLEGUM_ALGAE},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.PURPLE},{type:Se,id:n,attr1:Le.INDIGO_ALGAE},{type:Se,id:D}],[{type:Se,id:X,attr1:Le.BLUE},{type:Se,id:n,attr1:Le.ULTRAMARINE_ALGAE},{type:Se,id:D}]],time:timeConstant(5)},mixed_paint:{icon:{type:Se,id:X,attr1:Le.ORANGE},at_factory:[Q],inputs:[{source:[1,Se,X,Le.ANY]},{source:[1,Se,X,Le.ANY]}],item_id:X,output:outputFromOutputList,output_list:orderInvariant([[{type:Se,id:X,attr1:Le.PURPLE},{type:Se,id:X,attr1:Le.RED},{type:Se,id:X,attr1:Le.BLUE}],[{type:Se,id:X,attr1:Le.ORANGE},{type:Se,id:X,attr1:Le.RED},{type:Se,id:X,attr1:Le.YELLOW}],[{type:Se,id:X,attr1:Le.GREEN},{type:Se,id:X,attr1:Le.BLUE},{type:Se,id:X,attr1:Le.YELLOW}],[{type:Se,id:X,attr1:Le.RED},{type:Se,id:X,attr1:Le.RED},{type:Se,id:X,attr1:Le.RED}],[{type:Se,id:X,attr1:Le.YELLOW},{type:Se,id:X,attr1:Le.YELLOW},{type:Se,id:X,attr1:Le.YELLOW}],[{type:Se,id:X,attr1:Le.BLUE},{type:Se,id:X,attr1:Le.BLUE},{type:Se,id:X,attr1:Le.BLUE}],[{type:Se,id:X,attr1:Le.GREEN},{type:Se,id:X,attr1:Le.GREEN},{type:Se,id:X,attr1:Le.GREEN}],[{type:Se,id:X,attr1:Le.PURPLE},{type:Se,id:X,attr1:Le.PURPLE},{type:Se,id:X,attr1:Le.PURPLE}],[{type:Se,id:X,attr1:Le.ORANGE},{type:Se,id:X,attr1:Le.ORANGE},{type:Se,id:X,attr1:Le.ORANGE}]]),time:timeConstant(5)},painted_wood:{icon:{type:Te,id:et.COLORED_HUE2,count:10},at_factory:[Q],tags:[gt],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[10,ye,we.WOOD_PLANK]},{source:[1,Se,X,Le.ANY]}],output_list:[[{type:Te,id:et.COLORED_HUE0,count:10},{type:ye,id:we.WOOD_PLANK,count:10},{type:Se,id:X,attr1:Le.RED,count:1}],[{type:Te,id:et.COLORED_HUE1,count:10},{type:ye,id:we.WOOD_PLANK,count:10},{type:Se,id:X,attr1:Le.ORANGE,count:1}],[{type:Te,id:et.COLORED_HUE2,count:10},{type:ye,id:we.WOOD_PLANK,count:10},{type:Se,id:X,attr1:Le.YELLOW,count:1}],[{type:Te,id:et.COLORED_HUE3,count:10},{type:ye,id:we.WOOD_PLANK,count:10},{type:Se,id:X,attr1:Le.GREEN,count:1}],[{type:Te,id:et.COLORED_HUE4,count:10},{type:ye,id:we.WOOD_PLANK,count:10},{type:Se,id:X,attr1:Le.BLUE,count:1}],[{type:Te,id:et.COLORED_HUE5,count:10},{type:ye,id:we.WOOD_PLANK,count:10},{type:Se,id:X,attr1:Le.PURPLE,count:1}]],output:outputFromOutputList,time:timeConstant(15)},pickax:a({icon:{type:Se,id:$,attr1:ut,attr2:Le.WOOD},item_id:$},wt),hatchet:a({icon:{type:Se,id:G,attr1:ut,attr2:Le.WOOD},item_id:G},wt),shovel:a({icon:{type:Se,id:_e,attr1:ut,attr2:Le.WOOD},item_id:_e},wt),hoe:a({icon:{type:Se,id:F,attr1:ut,attr2:Le.WOOD},item_id:F,available_mods:[Re.DURABILITY,Re.STAMINA_RATE]},wt),growstick:a({icon:{type:Se,id:U,attr1:Le.WOOD},item_id:U,available_mods:[Re.DURABILITY,Re.STAMINA_RATE],at_factory:[v],inputs:[{name:We.LBL_RECIPE_INPUT_SPINE,source:[1,Se,ie,Le.ANY]},{name:We.LBL_RECIPE_INPUT_LIFE,source:[5,ye,we.VEGETABLE]},{name:We.LBL_RECIPE_INPUT_BINDING,source:[2,Se,A]}],do_attr2:false},wt),dowser_simple:{icon:{type:Se,id:R,attr1:ut,attr2:Le.WOOD},at_factory:[ge],inputs:[{name:We.LBL_RECIPE_INPUT_FOCUS,source:[1,Se,q,Le.ANY]},{source:[2,Se,ie,Le.ANY]},{name:We.LBL_RECIPE_INPUT_BINDING,source:[2,Se,A]}],item_id:R,output:outputDowser,time:timeConstant(At),needs_finish:true},dowser_advanced:{icon:{type:Se,id:O,attr1:Le.EMBERYLLIUM,attr2:Le.DARK_WOOD},at_factory:[ge],inputs:[{name:We.LBL_RECIPE_INPUT_FOCUS,source:[1,Se,q,Le.ANY]},{source:[2,Se,ie,Le.ANY]},{name:We.LBL_RECIPE_INPUT_BINDING,source:[2,Se,A]}],item_id:O,output:outputDowser,time:timeConstant(At),needs_finish:true},wood_bucket:{icon:{type:Se,id:p,attr1:Le.WOOD,attr2:at},at_factory:[ge],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[20,ye,we.WOOD_PLANK]},{name:We.LBL_RECIPE_INPUT_BINDING,source:[2,Se,A]}],item_id:p,material2:rt,output:outputInput0IgnoreQuality,time:timeConstant(15)},metal_bucket:{icon:{type:Se,id:p,attr1:ut,attr2:at},at_factory:[l],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[3,Se,W,Le.ANY]},{name:We.LBL_RECIPE_INPUT_BINDING,source:[2,ye,we.WOOD_RAW]}],item_id:p,material2:rt,output:outputInput0IgnoreQuality,time:timeConstant(15),reverse:function reverse(e){if(e.getMaterialClass()===Ze.METAL){var t=this.inputs[0].source
var r=this.inputs[1].source
return[De({type:t[1],id:t[2],count:t[0],attr1:e.getMaterial()}),De({type:r[1],id:r[2],count:r[0],attr1:e.getMaterial()})]}return null}},glass:{icon:{type:Te,id:et.GLASS,count:4},at_factory:[B],tags:[gt,pt],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[3,Te,et.SAND]},{name:We.LBL_RECIPE_INPUT_FUEL,source:[1,ye,we.FUEL]}],output_list:[[{type:Te,id:et.GLASS,count:4},{type:Te,id:et.SAND,count:3},{type:ye,id:we.FUEL,count:1}]],output:outputFromOutputList,time:timeConstant(30)},glass_bottle:{icon:{type:Se,id:f},at_factory:[B],tags:[pt],inputs:[{source:[1,Te,et.GLASS]},{name:We.LBL_RECIPE_INPUT_FUEL,source:[1,ye,we.FUEL]}],item_id:f,output:outputSimple,time:timeConstant(15)},planks:{icon:{type:Te,id:et.PLANKS_WOOD,count:4},at_factory:[ne],tags:[gt,pt],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[1,ye,we.WOOD_RAW]}],output_list:[[{type:Te,id:et.PLANKS_WOOD,count:4},{type:Te,id:et.WOOD,count:1}],[{type:Te,id:et.PLANKS_WOOD_LIGHT,count:4},{type:Te,id:et.WOOD_LIGHT,count:1}],[{type:Te,id:et.PLANKS_WOOD_DARK,count:4},{type:Te,id:et.WOOD_DARK,count:1}],[{type:Te,id:et.PLANKS_WOOD_RED,count:4},{type:Te,id:et.WOOD_RED,count:1}]],output:outputFromOutputList,time:timeConstant(12)},stone_bricks:{icon:{type:Te,id:et.BRICK_STONE},at_factory:[de],tags:[gt,pt],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[4,ye,we.STONE_RAW]}],output_list:[[{type:Te,id:et.BRICK_STONE,count:1},{type:ye,id:we.STONE_RAW,count:4}]],output:outputFromOutputList,time:timeConstant(12)},brick_clay:{icon:{type:Te,id:et.BRICK_CLAY},at_factory:[V],tags:[gt],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[6,Te,et.DIRT]}],output_list:[[{type:Te,id:et.BRICK_CLAY,count:1},{type:Te,id:et.DIRT,count:6}]],output:outputFromOutputList,time:timeConstant(12)},charcoal:{icon:{type:Se,id:y},at_factory:[V],tags:[mt],inputs:[{name:We.LBL_RECIPE_INPUT_MATERIAL,source:[3,ye,we.WOOD_RAW]}],item_id:y,output:outputSimple,time:timeConstant(60)},charcoal_slow:{icon:{type:Se,id:y},at_factory:[u,d],tags:[mt],inputs:[{name:We.LBL_RECIPE_INPUT_MATERIAL,source:[3,ye,we.WOOD_RAW]}],item_id:y,output:outputSimple,time:timeConstant(2600)},ingot:{icon:{type:Se,id:W,attr1:Le.IRON},at_factory:[k],inputs:[{name:We.LBL_RECIPE_INPUT_PRIMARY,source:[10,Se,q,Le.ANY]},{name:We.LBL_RECIPE_INPUT_FUEL,source:[1,ye,we.FUEL]}],item_id:W,output:outputInput0IgnoreQuality,time:timeConstant(35)},alloy:{icon:{type:Se,id:W,attr1:Le.BRONZE},at_factory:[k],inputs:[{name:We.LBL_RECIPE_INPUT_METAL,source:[1,Se,W,Le.ANY],source_check_cb:isAlloySource},{name:We.LBL_RECIPE_INPUT_METAL,source:[1,Se,W,Le.ANY],source_check_cb:isAlloySource},{name:We.LBL_RECIPE_INPUT_FUEL,source:[2,ye,we.FUEL]}],item_id:W,output_list:orderInvariant(getAlloysOutputList()),output:outputFromOutputList,time:timeConstant(45)},tool_repair:{icon:{type:Se,id:$,attr1:Le.MUTTAL,attr2:Le.DARK_WOOD},at_factory:[l],no_unknown_name:true,inputs:[{name:We.LBL_RECIPE_INPUT_TOOL,source:[1,ye,we.REPAIRABLE]},{name:We.LBL_RECIPE_INPUT_METAL,source:[2,Se,W,Le.ANY]}],output:function output(e){var t=e[0]
if(t.hp_cur>=t.hp_max)return null
var r=1
var a
var i=qe[t.getMaterial()]
var o=e[1].getMaterial()
var n=qe[o]
if(t.getMaterialClass()!==e[1].getMaterialClass()){r=.25
a=We.RECIPE_TOOL_REPAIR_WARNING_MISMATCH}else if(n<i){r=.5
a=We.RECIPE_TOOL_REPAIR_WARNING_REDUCED}var s=.5
var l=je[t.attr1]*Ce
var _=t.hp_max-l
var c=ct(je[o]*Ce*r*s)
var u
if(_<=0)u=c
else u=ct(c/l*t.hp_max)
var d=De(t)
var f=lt(d.hp_cur+u,d.hp_max)
if(f===d.hp_max)a=null
if(f-d.hp_cur<.5*u)a=We.RECIPE_TOOL_REPAIR_WARNING_WASTEFUL
d.setHP(f)
if(a)d.craft_warning=a
return d},time:timeConstant(15)},growstick_repair:{icon:{type:Se,id:U,attr1:Le.DARK_WOOD},at_factory:[v],no_unknown_name:true,inputs:[{name:We.LBL_RECIPE_INPUT_TOOL,source:[1,Se,U,Le.ANY]},{name:We.LBL_RECIPE_INPUT_CATALYST,source:[3,ye,we.VEGETABLE]}],output:function output(e){var t=e[0]
if(t.hp_cur>=t.hp_max)return null
var r=1
var a=.5
var i=Ce
var o=t.hp_max-i
var n=ct(Ce*r*a)
var s
if(o<=0)s=n
else s=ct(n/i*t.hp_max)
var l=De(t)
var _=lt(l.hp_cur+s,l.hp_max)
var c=null
if(_-l.hp_cur<.5*s)c=We.RECIPE_TOOL_REPAIR_WARNING_WASTEFUL
l.setHP(_)
if(c)l.craft_warning=c
return l},time:timeConstant(15)}}
r.recipes=Lt
function recipeValidName(e){return Boolean(Lt[e])}function getRecipeAsCraftCost(e){var t
var r=Lt[e]
b(r)
var a=[]
var i=r.inputs
for(var o=0;o<i.length;++o){var n=i[o].source
var s=n[0]
var l=n[1]
var _=n[2]
var c=n[3]
a.push(De({type:l,id:_,count:s,attr1:c}))}a.at_factory=r.at_factory
a.count=null==(t=r.icon)?void 0:t.count
return a}function getCraftCost(e){var t=it
if(e.type===Ie)return getRecipeAsCraftCost(e.attr1)
for(var r in Lt){var a=Lt[r]
var i=a.output_list
if(i){var o=[]
for(var n=0;n<i.length;++n){var s=i[n]
if(Ge(e,s[0])){for(var l=1;l<s.length;l++){var _=s[l]
o.push(De(_))}o.at_factory=a.at_factory
o.count=s[0].count
return o}}}}for(var c in Lt){var u=Lt[c]
if(e.type===Se&&(u.item_id===e.id||u.item_ids&&u.item_ids[e.id])){var d=u.inputs,f=u.output
var v=[]
var h=true
if(u.reverse){if(!(v=u.reverse(e)))continue}else{var p=1
for(var m=0;m<d.length;++m){var E=d[m].source
switch(E[1]){case ye:var g=E[2]
if(f===outputSimple||g===we.FUEL||g===we.VEGETABLE)v.push(De({type:ye,id:g,count:E[0]}))
else if(g===we.SCALED_INGOT&&e.getMaterialClass()===Ze.METAL){var T=e["attr"+p++]
var y=E[0]
y=ct(y*(Ke[T]||1))
v.push(De({type:Se,id:W,count:y,attr1:T}))}else if(g===we.WOOD_PLANK&&e.getMaterialClass()===Ze.WOOD){var S=e.getMaterial(true)
var I=void 0
if(!S);else I=Me(we.WOOD_PLANK,S,1,true)
if(I)v.push(De({type:Te,id:I,count:E[0]}))
else v.push(De({type:ye,id:we.WOOD_PLANK,count:E[0]}))}else{var A=Ye[g]
if(e.attr1===Le.ANY)v.push(De({type:ye,id:g,count:E[0]}))
else if(A&&e.getMaterialClass()===A){var w=t.material_map[e.getMaterial()]
b(w)
v.push(De({type:Te,id:w,count:E[0]}))
x(1===p)
p++}else h=false}break
case Te:v.push(De({type:Te,id:E[2],count:E[0]}))
break
case Se:var L=E[3]
if(L===Le.ANY){var O=e["attr"+p++]
if(O)L=O}v.push(De({type:Se,id:E[2],count:E[0],attr1:L}))
break
default:b(false)}}}if(h){var R
v.at_factory=u.at_factory
v.count=null==(R=u.icon)?void 0:R.count
return v}}}if(N.DEBUG){C("item",JSON.stringify(e))
b(false)}return[]}var Ot={}
function getRecipesForFactory(e){if(Ot[e])return Ot[e]
var t={}
for(var r in Lt){var a=Lt[r]
if(-1!==a.at_factory.indexOf(e)||e===M){if(a.icon&&!Ue(a.icon))a.icon=De(a.icon)
t[r]=a}}return Ot[e]=t}var Rt
function resetExampleCaches(){var e
Rt=((e={})[ye]={},e[Se]={},e[Ie]={},e)}var bt=false
function getItemExamples(e,t){if(bt!==N.defines.HIDE_UNRELEASED)resetExampleCaches()
bt=N.defines.HIDE_UNRELEASED
var r=Rt[e]
if(!r)return[]
else if(r[t])return r[t]
var a
switch(e){case Se:a=Be(t)
break
case ye:a=Pe(t)
break
case Ie:a=ke(t)}return r[t]=a}function craftingRecipes(){return Lt}function craftingRecipesLocalizationStartup(){for(var e in Lt){var t=Lt[e]
t.name=t.name||We.get("RECIPE_"+e.toUpperCase()+"_NAME")
if(!t.name)if(t.output_list&&1===t.output_list.length){var r=t.output_list[0][0]
t.name=De(r).getName()}else if(t.item_id)t.name=Ne[t.item_id]
b(t.name)
t.unknown_name=t.unknown_name||We.get("RECIPE_"+e.toUpperCase()+"_UNKNOWN_NAME")
if(!t.no_unknown_name)if(!t.unknown_name)if(t.output_list&&1===t.output_list.length){var a=t.output_list[0][0]
t.unknown_name=De(a).getName()}else if(t.item_id){t.unknown_name=Ne[t.item_id]
if(t.output!==outputSimple)t.unknown_name=xe(t.unknown_name,We.MAT_UNKNOWN)}else t.unknown_name=xe(t.name,We.MAT_UNKNOWN)
else t.unknown_name=xe(t.unknown_name,We.MAT_UNKNOWN)
t.desc=t.desc||We.get("RECIPE_"+e.toUpperCase()+"_DESC")
if(!t.desc)b(t.desc,"Missing RECIPE_"+e.toUpperCase()+"_DESC")
if(t.tags&&t.tags.length>0){var i=We.addParentheses(We.separateComma(t.tags.map(function(e){return vt[e]})))
t.desc=We.separateWords(i,t.desc)}for(var o=0;o<t.inputs.length;++o){var n=t.inputs[o]
if(!n.name)if(n.source[1]===ye)n.name=Ve[n.source[2]]
else if(n.source[1]===Se)n.name=Ne[n.source[2]]
else if(n.source[1]===Te)n.name=et.tile_name_block[n.source[2]]
else b(false)}}}function craftingRecipesStartup(){craftingRecipesLocalizationStartup()
resetExampleCaches()
for(var e in Lt){var t=Lt[e]
var r=De(t.icon)
r.has_hp=false
r.name=t.name
r.is_recipe=true
r.recipe=e
r.recipe_item=De({type:Ie,id:-1,attr1:e})
t.icon=r}}},{"../common/ids":249,"../common/materials_common":253,"../common/world_constants":267,"../glov/client/engine":305,"../glov/client/error_report.js":311,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./crafting_mods":67,"./items.js":119,"./localization/localization":131,"./materials":137,"./proc_gen":162,"./stone_tiers":194,"./tiles":199,"./voxel_data":216,assert:void 0}],69:[function(e,t,r){"use strict"
r.createFirstWorld=createFirstWorld
r.createFirstWorldStartup=createFirstWorldStartup
r.createFirstWorldPrompt=createFirstWorldPrompt
var a=e("assert")
var i=e("../glov/client/net").netSubs
var o=e("../glov/client/sprites").spriteCreate
var n=e("../glov/client/ui")
var _=n.buttonShared
var p=n.buttonText
var c=n.drawRect
var s=n.modalDialog
var m=n.modalDialogClear
var E=n.uiButtonHeight
var g=n.uiFontStyleModal
var l=n.uiGetFont
var u=e("../common/world_constants").ACCESS_BUILDER
var T=e("./analytics").logEvent
var d=e("./analytics_ftue")
var y=d.FTUE
var S=d.logEventFTUE
var f=e("./fbinstant_worlds").fbGetRoomCurrentMatch
var I=e("./localization/localization").L
var A=e("./menu")
var v=e("./prompt").showPrompt
var h=e("./styles.js")
var w=h.color_photo_frame_shadow
var L=h.color_rollover_cover
var O=h.color_white
var R=h.menu_header_style
var b=e("./ui_util.js")
var N=e("./world_management")
var C=N.createWorld
var x=N.getDefaultWorldName
var M=N.isDoingWorldOp
var D=Math.floor,P=Math.random
var B=1200/630
var k={unl_photo:"img/create_first_world/unlimited_banner.jpg",lf_photo:"img/create_first_world/lost_frontier_banner.jpg",header:"img/worlds_header_simple.png"}
var U={}
var G=false
function loadCreateFirstWorldImages(){for(var e in k)(U[e]=o({url:k[e],wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,lazy_load:true})).lazyLoad()
G=true}var F=980
var W=4
var H=12
var z=270
var V=180
var Y=280
var j=Y/2
var K=25
var q=40
var X=10
var Q=8
var $=35
var J=$
var ee=10
function createWorldData(e){var t
if(f())t=u
return{log_type:e?"adventure":"generated_v1",name:x(),seed:D(1e4*P()),sized:void 0,unlimited:!e,world_mode:e?"adventure":"unlimited",world_type:"v1",access_default:t,access_public:true}}function createFirstLF(){C(createWorldData(true),m)
T("create_first_world_lf",1,"button")
S(y.MAIN,2,"create_first_world",{world_type:"lf"})}function createFirstUnlimited(){C(createWorldData(false),m)
T("create_first_world_unlimited",1,"button")
S(y.MAIN,2,"create_first_world",{world_type:"un"})}function photoFrameButton(e,t,r,a,i,o,n,s){c(e+Q,t+Q,e+Q+r,t+Q+a,i,w)
c(e,t,e+r,t+a,i+.001,O)
var l=_({x:e,y:t,w:r,h:a,disabled:n})
if(l){if(l.ret)s()
if("rollover"===l.state||"disabled"===l.state)c(e,t,e+r,t+a,o,L)}}function createFirstWorld(){var v=l()
var h=Z.MODAL
var e={no_fullscreen_zoom:true,width:F,color:A.panel_color,y0:75,tick:function tick(e){var t=e.x0,r=e.x,a=e.y,i=e.avail_width,o=e.modal_width,n=e.font_height
if(!G)loadCreateFirstWorldImages()
var s=U
var l=v.getStringWidth(R,2.25*n,I.LBL_WELCOME_TITLE)
var _=r+i/2-(l+Y+W+H)/2
s.header.draw({x:_+l+W+H,y:a-K,z:h,w:Y,h:j})
v.drawSizedAligned(R,_+H,a+=20,h,2.25*n,v.ALIGN.HLEFT,0,0,I.LBL_WELCOME_TITLE)
a+=2*n
a+=65
a+=v.drawSizedAlignedWrapped(g(),r,a,h,0,n,v.ALIGN.HVCENTER,i,0,I.MSG_WHAT_KIND_OF_WORLD)
var c=(o-3*q)/2
var u=c-2*X
var d=u/B
var f=d+2*X
v.drawSizedAligned(R,t+q,a+=45,h,1.5*n,v.ALIGN.HVCENTER,c,0,I.LBL_LOST_FRONTIER)
v.drawSizedAligned(R,t+2*q+c,a,h,1.5*n,v.ALIGN.HVCENTER,c,0,I.LBL_UNLIMITED)
a+=1.5*n-12
v.drawSizedAlignedWrapped(g(),t+q,a,h,0,n,v.ALIGN.HCENTER,c,0,I.MSG_CREATE_LF_DESC)
a+=v.drawSizedAlignedWrapped(g(),t+2*q+c,a,h,0,n,v.ALIGN.HCENTER,c,0,I.MSG_CREATE_UNL_DESC)
photoFrameButton(t+q,a+=12,c,f,h+1,h+5,M(),createFirstLF)
photoFrameButton(t+q+c+q,a,c,f,h+1,h+5,M(),createFirstUnlimited)
s.lf_photo.draw({x:t+q+X,y:a+X,z:h+3,w:u,h:d})
s.unl_photo.draw({x:t+2*q+c+X,y:a+X,z:h+3,w:u,h:d})
b.sprite.draw({x:t+q+c-X-$-ee,y:a+X+d-J-ee,z:h+4,w:$,h:J,frame:b.ADVENTURE_MODE})
a+=f+Q
if(p({x:t+q+c/2-z/2,y:a+=16,z:h+1,h:.5*E(),w:z,text:I.BTN_CREATE_LF,disabled:M()}))createFirstLF()
if(p({x:t+2*q+c+c/2-z/2,y:a,z:h+1,h:.5*E(),w:z,text:I.BTN_CREATE_UNL,disabled:M()}))createFirstUnlimited()
a+=.5*E()
a+=65
a+=v.drawSizedAlignedWrapped(g(),r+.25*i,a,h,0,n,v.ALIGN.HVCENTER,.5*i,0,I.MSG_EXPLORE_OTHER_WORLDS_DESC)
if(p({x:r+i/2-V/2,y:a+=10,z:h+1,h:.5*E(),w:V,text:I.BTN_EXPLORE_OTHER_WORLDS,disabled:M()})){m()
T("create_first_world_skip",1,"button")
S(y.MAIN,2,"create_first_world",{skipped:true})}e.y=a+=20}}
s(e)}function createFirstWorldOnChannelData(e){if(!e||!e.public)return
var t=e.public
if(t.prompts_seen&&t.prompts_seen.create_first_world)return
if(t.worlds&&Object.keys(t.worlds).length>0)return
loadCreateFirstWorldImages()}function createFirstWorldOnLogin(){var e=i().getMyUserChannel()
a(e)
e.onceSubscribe(createFirstWorldOnChannelData)}function createFirstWorldStartup(){i().onLogin(createFirstWorldOnLogin)}function createFirstWorldPrompt(){var e=i().getMyUserChannel()
a(e)
var t=e.getChannelData("public.worlds",{})
if(0===Object.keys(t).length)v("create_first_world",1,createFirstWorld)}},{"../common/world_constants":267,"../glov/client/net":338,"../glov/client/sprites":363,"../glov/client/ui":367,"./analytics":6,"./analytics_ftue":7,"./fbinstant_worlds":96,"./localization/localization":131,"./menu":140,"./prompt":169,"./styles.js":197,"./ui_util.js":205,"./world_management":234,assert:void 0}],70:[function(e,t,r){"use strict"
r.createWorldUIInit=createWorldUIInit
var a=e("../glov/client/engine")
var O=e("../glov/client/font").ALIGN
var i=e("../glov/client/input")
var R=i.KEYS
var b=i.inputClick
var N=i.inputTouchMode
var C=i.keyDownEdge
var x=i.pointerLockEnter
var o=e("../glov/client/net").netSubs
var n=e("../glov/client/selection_box")
var M=n.dropDown
var s=n.dropDownCreate
var D=e("../glov/client/sprites").spriteQueueRaw
var l=e("../glov/client/ui")
var P=l.buttonText
var B=l.modalTextEntry
var k=l.uiGetFont
var U=l.uiGetTitleFont
var G=l.uiTextHeight
var _=e("../glov/client/urlhash")
var F=e("../glov/common/rand_alea").mashString
var W=e("../glov/common/util").isInteger
var H=e("../glov/common/vmath").unit_vec
var c=e("../common/waygate_common")
var u=c.FLAT_SEED_EMPTY
var d=c.FLAT_SEED_GRASS_ON_STONE
var f=c.FLAT_SEED_WATER
var z=c.WAYGATE_MAX_VISUAL_SIZE
var V=c.WAYGATE_NAME_LEN
var v=e("../common/world_constants")
var Y=v.ACCESS_AREA_BUILDER
var j=v.ACCESS_BUILDER
var h=v.ACCESS_READONLY
var p=v.ACCESS_SPECTATOR
var K=e("./analytics").logEvent
var q=e("./localization/localization").L
var m=e("./main_menu")
var X=m.mainMenuBottom
var Q=m.mainMenuHeaderLogo
var $=m.mainMenuSetStateInternal
var J=m.mainMenuTop
var ee=e("./mod_api_host").modContinentDataAvailable
var E=e("./styles")
var te=E.label_warning_style
var re=E.menu_style
var g=e("./tiles")
var ae=e("./ui_util")
var ie=e("./waygate_ui").waygateTexture
var T=e("./world_comm").getPerm
var y=e("./world_management")
var oe=y.createWorld
var ne=y.getDefaultWorldName
var se=y.isDoingWorldOp
var le=Math.floor,_e=Math.random
var ce=[{name:q.LBL_ACCESS_PRESET_PRIVATE,tag:"a",access_default:j,access_public:false},{name:q.LBL_ACCESS_PRESET_SPECTATE,tag:"b",access_default:p,access_public:true},{name:q.LBL_ACCESS_PRESET_VISIT,tag:"c",access_default:h,access_public:true},{name:q.LBL_ACCESS_PRESET_AREA_BUILD,tag:"d",access_default:Y,access_public:true},{name:q.LBL_ACCESS_PRESET_BUILD_ANYWHERE,tag:"e",access_default:j,access_public:true}]
var ue=240
var de=48
var fe
var ve
var he
var pe
function createWorldUI(){var e={}
J(e)
Q(e)
var t=e.y
var r=e.w,a=e.x_mid
var i=0
var o=k()
var n=U()
var s=se()
var l=G()
n.drawSizedAligned(re,i,t,Z.UI,1.5*l,O.HCENTERFIT,r,0,q.PAGETITLE_CREATE_NEW_WORLD)
o.drawSizedAligned(re,a-8,t+=1.5*l+16,Z.UI,l,O.HRIGHT|O.VCENTER,0,de,q.LBL_NAME)
if(P({x:a,y:t,w:ue,h:de,text:fe.name,disabled:s}))B({edit_text:fe.name,title:q.LBL_WORLD_NAME,text:q.DLG_NEW_WORLD_NAME_MSG,max_len:V,max_visual_size:z,buttons:{ok:function ok(e){fe.name=e.trim()||ne()},cancel:null}})
t+=de+8
var _=ie(fe,"preview")
var c=ue
var u=3*c/4
if(_.loaded)D([_],a,t,Z.UI,c,u,0,0,1,1,H)
var d=a+.965*c
var f=.2*u
var v=t+.965*u-f
if("adventure"===fe.world_mode){ae.sprite.draw({x:d-=f,y:v,z:Z.UI+.1,w:f,h:f,frame:ae.ADVENTURE_MODE})
d-=.1*f}if(fe.access_public){var h
if(fe.access_default>=j)h=ae.ICON_BUILD
else if(fe.access_default>=Y)h=ae.ICON_AREABUILD
if(h){ae.sprite.draw({x:d-=f,y:v,z:Z.UI+.1,w:f,h:f,frame:h})
d-=.1*f}}var p
o.drawSizedAligned(re,a-8,t+=u+8,Z.UI,l,O.HRIGHT|O.VCENTER,0,de,q.addColon(q.LBL_GAME_MODE))
he.run({x:a,y:t,disabled:s,initial_selection:fe.unlimited?1:0})
if((p=he.getSelected().tag)!==fe.world_mode)if("adventure"===(fe.world_mode=p)&&!fe.seed)fe.seed=le(1e4*_e())
t+=de+16
var m="adventure"===p
o.drawSizedAligned(re,a-8,t,Z.UI,l,O.HRIGHT|O.VCENTER,0,de,q.addColon(q.LBL_WORLD_TYPE))
if(m){ve.reset_selection=true
ve.initial_selection=1}ve.run({x:a,y:t,disabled:s||m})
var E=ve.getSelected().tag
var g=E.type
fe.log_type=m?"adventure":E.log_type
if(g!==fe.world_type){var T="flat"===fe.world_type
var y="flat"===g
fe.world_type=g
if(T!==y)if(y)fe.seed=0
else fe.seed=le(1e4*_e())}fe.sized=E.sized
t+=de+16
if(ee()&&"flat"!==fe.world_type){o.drawSizedAligned(re,a,t-=8,Z.UI,l,O.HFIT,r/2,0,q.LBL_CONTINENT_DATA_MOD)
t+=l+16}o.drawSizedAligned(re,a-8,t,Z.UI,l,O.HRIGHT|O.VCENTER,0,de,q.addColon(q.LBL_WORLD_SEED_SHORT))
if("flat"===fe.world_type){pe.run({x:a,y:t,disabled:s})
fe.seed=pe.getSelected().tag}else if(P({x:a,y:t,w:ue,h:de,text:String(fe.seed),disabled:s}))B({edit_text:String(fe.seed),title:q.LBL_WORLD_SEED,text:q.LBL_WORLD_SEED_ENTER,buttons:{ok:function ok(e){var t=Number(e.trim())
if(W(t)&&t<=4294967295&&t>=0)fe.seed=t
else fe.seed=F(e.trim())},cancel:null}})
t+=de+16
o.drawSizedAligned(re,a-8,t,Z.UI,l,O.HRIGHT|O.VCENTER,0,de,q.addColon(q.LBL_ACCESS_PRESET))
var S=0
for(var I=0;I<ce.length;++I){var A=ce[I]
if(fe.access_default===A.access_default&&fe.access_public===A.access_public)S=I}var w={suppress_return_during_dropdown:false}
var L=M({x:a,y:t,width:ue,entry_height:de,disabled:s,items:ce},S,w)
if(L){fe.access_default=L.access_default
fe.access_public=L.access_public}t+=de+16
if(fe.access_public&&fe.access_default>=j&&!w.dropdown_visible){t+=o.drawSizedAligned(te,a-.4*r,t,Z.UI,l,O.HCENTER|O.HWRAP,.8*r,0,q.WORLDINFO_ANYONE_BUILD_WARNING)
t+=16}if(P({x:a,y:t,w:ue/2-4,h:de,text:q.BTN_SUBMIT,disabled:s,in_event_cb:N()?void 0:x})){K("create_world_button",1,"button",fe.log_type)
oe(fe)
s=se()}if(P({x:a+ue/2+4,y:t,w:ue/2-4,h:de,text:q.BTN_CANCEL,disabled:s})||!s&&(C(R.ESC)||b({button:2})))$()
t+=de
e.y=t
X(e)}function loggedOrLogginIn(){return o().loggedIn()||o().logging_in}function createWorldUIInit(){fe={name:ne(),world_type:null,unlimited:"unlim"===_.get("type"),seed:0,access_default:h,access_public:true}
var e=[{name:q.WORLD_TYPE_FLAT,tag:{type:"flat",sized:void 0,log_type:"flat"}},{name:q.WORLD_TYPE_GENERATED_V1,tag:{type:"v1",sized:void 0,log_type:"generated_v1"}},{name:q.addParenthesesAfter(q.WORLD_TYPE_SMALL,48),tag:{type:"flat",sized:48,log_type:"small_48"}}]
if(T("sysadmin"))e.push({name:"(Admin) Generated V1 (persistent)",tag:{type:"v1",sized:void 0}})
ve=s({items:e,z:Z.UI,width:ue,entry_height:de})
if("unlim"===_.get("type")){ve.initial_selection=1
fe.seed=le(1e4*_e())}he=s({items:[{name:q.GAME_MODE_LOST_FRONTIER,tag:"adventure"},{name:q.GAME_MODE_UNLIMITED,tag:"unlimited"}],z:Z.UI,width:ue,entry_height:de})
pe=s({items:[{name:g.tile_name[g.GRASS],tag:d},{name:g.liquid_name[g.WATER],tag:f},{name:g.tile_name[g.SNOW],tag:g.SNOW},{name:g.tile_name[g.SAND],tag:g.SAND},{name:g.tile_name[g.STONE_LIGHT],tag:g.STONE_LIGHT},{name:g.tile_name[g.STONE],tag:g.STONE},{name:g.tile_name[g.STONE_DARK],tag:g.STONE_DARK},{name:g.tile_name[g.STONE_RED],tag:g.STONE_RED},{name:g.tile_name[g.COAL],tag:g.COAL},{name:g.tile_name[g.CORAL1],tag:g.CORAL1},{name:g.tile_name[g.CORAL2],tag:g.CORAL2},{name:q.WORLD_SEED_EMPTY,tag:u}],z:Z.UI,width:ue,entry_height:de})
if(loggedOrLogginIn()){a.setState(createWorldUI)
_.set("page","")
_.set("type","")}}},{"../common/waygate_common":265,"../common/world_constants":267,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/selection_box":350,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/rand_alea":395,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./localization/localization":131,"./main_menu":136,"./mod_api_host":146,"./styles":197,"./tiles":199,"./ui_util":205,"./waygate_ui":222,"./world_comm":226,"./world_management":234}],71:[function(e,t,r){"use strict"
r.doCreditsMenuWide=doCreditsMenuWide
r.doCreditsMenuTall=doCreditsMenuTall
r.doCreditsMenu=doCreditsMenu
var i=e("../glov/client/ui.js")
var a=e("./layout.js")
var o=a.TALL
var n=a.layoutCameraCurX1
var s=a.layoutCameraTallWideMode
var l=e("./styles.js")
var _=l.inventory_style
var c=l.menu_header_style
var u=32
var d=35
function drawRole(e,t,r,a){i.title_font.drawSizedAligned(c,e,t,Z.UI,u,i.font.ALIGN.HVCENTER,r,0,a)}function drawCrew(e,t,r,a){i.font.drawSizedAligned(_,e,t,Z.UI,u,i.font.ALIGN.HVCENTER,r,0,a)}function drawSectionColumn(e,t,r,a){drawRole(e,t,r,a[0])
for(var i=1;i<a.length;++i)drawCrew(e,t+=d,r,a[i])}function drawSectionWide(e,t,r,a,i){i=i||0
drawRole(e,t,r,a[0])
for(var o=1;o<a.length;o+=2){t+=d
if(a[o+1]){drawCrew(e+i,t,r/2,a[o])
drawCrew(e+r/2-i,t,r/2,a[o+1])}else drawCrew(e,t,r,a[o])}}var f={game_creator:["Game Creator / Lead Engineer","Jimb Esser"],founder:["FRVR Founder","Chris Benjaminsen"],executive_producer:["Executive Producer","Yasin Jensen"],producer:["Producer","Jonas Aksel Billeskov"],community_management:["Community Management","MicChi","Thea Henriksen"],engineering:["Engineering","Beh Yon Chau","Diogo Antunes","Glen Sargent"],design:["Design","João Dias","João Ferreira"],art:["Art","Ricardo Catarino","Satera"],leadership:["FRVR Leadership","Brian Meidell","Joshua Chittick","Maiken Fogtmann","Michael Billing"],publishing_marketing:["Publishing / Marketing","Aga Monteiro","Anel Imanbay","Kester Bishop","Mafalda Campos","Mike Stone","Sam Turner"],additional_engineering:["Additional Engineering","Daniel Entrenas","Daniel Monteiro","Diogo Nunes","Dmitrijs Sergejevs","Francisco Teotónio","Hugo Ferreira","Jorge Galvão","Rogério Oliveira"],additional_art:["Additional Art","Anders Bruhn Pedersen","Cristiana Béjinha","Ellen Grape","Frederik Marius Reinicke Bager","Joachim Brüel Gerber","Niklas Mäckle","Yenz Minnaert"],quality_assurance:["Quality Assurance","Daniel Cutajar","Eduardo Jardim","Miguel Ribeiro"],audio:["Audio","Rasmus Hartvig"],business_intelligence:["Business Intelligence","Daniel André","Daniela Cunha","Hugo Bettencourt","João Monteiro"]}
function doCreditsMenuWide(e){var t=n()
var r=t/3
drawSectionColumn(0,e+=1.5*d,r,f.game_creator)
drawSectionColumn(r,e,r,f.founder)
drawSectionColumn(2*r,e,r,f.art)
drawSectionColumn(0,(e+=3*d)+d,r=t/3,f.engineering)
drawSectionColumn(r,e,r,f.producer)
drawSectionColumn(2*r,e+d/2,r,f.executive_producer)
drawSectionColumn(r,e+=3*d,r,f.community_management)
drawSectionColumn(2*r,e,r,f.design)
drawSectionColumn(0,e+=4*d,r=t/4,f.leadership)
drawSectionColumn(r,e,r,f.publishing_marketing)
drawSectionWide(2*r,e,r,f.additional_engineering,-20)
drawSectionColumn(3*r,e+=1.5*d,r,f.additional_art)
drawSectionColumn(0,e+=4.5*d,r=t/4,f.quality_assurance)
drawSectionWide(2*r,e+=d,r,f.business_intelligence)
drawSectionColumn(r,e+=d,r,f.audio)}function doCreditsMenuTall(e){var t=n()
var r=t
drawSectionColumn(0,e+=d,r,f.game_creator)
drawSectionColumn(0,e+=3*d,r,f.founder)
drawSectionColumn(0,e+=2.5*d,r,f.art)
drawSectionColumn(r=t/5,e+=3.5*d,r,f.producer)
drawSectionColumn(3*r,e,r,f.executive_producer)
drawSectionColumn(r,e+=2.5*d,r,f.engineering)
drawSectionColumn(3*r,e,r,f.design)
drawSectionColumn(3*r,e+=3.5*d,r,f.community_management)
drawSectionColumn(r,e+=d,r,f.publishing_marketing)
drawSectionColumn(3*r,e+=2.5*d,r,f.leadership)
drawSectionColumn(r,e+=5*d,r,f.additional_engineering)
drawSectionColumn(3*r,e+=.5*d,r,f.additional_art)
drawSectionColumn(5*(r=t/7),e+=8.5*d,r,f.business_intelligence)
drawSectionColumn(r,e+=.5*d,r,f.quality_assurance)
drawSectionColumn(3*r,e+=d,r,f.audio)}function doCreditsMenu(e){if(s()===o)doCreditsMenuTall(e)
else doCreditsMenuWide(e)}},{"../glov/client/ui.js":367,"./layout.js":120,"./styles.js":197}],72:[function(e,t,r){"use strict"
r.getUserCanRedeem=getUserCanRedeem
r.getRedeemRequestStatus=getRedeemRequestStatus
r.openCurrencyShop=openCurrencyShop
r.getFreeGemsRedeemTimeLeftString=getFreeGemsRedeemTimeLeftString
r.getFreeCurrencyTimeInfo=getFreeCurrencyTimeInfo
r.isAdParamToken=isAdParamToken
r.doVideoAd=doVideoAd
r.currencyShopStartup=currencyShopStartup
r.currencyShopInit=currencyShopInit
r.shopButtonBackground=shopButtonBackground
r.shopButtonPrice=shopButtonPrice
r.doCurrencyShop=doCurrencyShop
r.OVERLAY_BAR_POS=r.OVERLAY_BORDER_OFFSET=void 0
var D=.07
r.OVERLAY_BORDER_OFFSET=D
var P=.2
var B=1-D-P
r.OVERLAY_BAR_POS=B
var k=e("assert")
var U=e("../glov/client/font").ALIGN
var a=e("../glov/client/local_storage")
var i=a.localStorageGetJSON
var s=a.localStorageSetJSON
var c=e("../glov/client/net").netSubs
var x=e("../glov/client/ui")
var o=e("../glov/client/ui")
var g=o.uiButtonHeight
var G=o.uiGetFont
var u=e("../glov/client/walltime")
var n=e("../glov/common/util")
var l=n.errorString
var _=n.msToTimeString
var d=e("../glov/common/vmath").vec4
var f=e("../common/rewards_common")
var v=f.VIDEO_LIMIT
var h=f.VIDEO_MINIMUM_TIME_BETWEEN
var p=f.rewardTimeUntilAvailable
var m=e("../common/store_data")
var E=m.DAILY_FREE_ADS_ON
var T=m.DAILY_FREE_GEMS_ON
var y=m.DAILY_GEMS_FREE_AMOUNT
var S=m.PRODUCT_ITEM_ID_GEM
var I=m.PRODUCT_ITEM_ID_ORB
var A=e("./analytics")
var w=A.clickEvent
var L=A.itemFlowEvent
var O=A.logEvent
var M=e("./client_cmds").isElevated
var R=e("./frvr_sdk_worlds")
var b=R.AD_PLAY_ERROR_NOT_DISPLAYED
var N=R.AD_PLAY_ERROR_SKIPPED
var C=R.frvrVideoAdsPlay
var F=R.frvrVideoAdsReady
var W=e("./in_app_purchases/iap_client_worlds")
var H=W.iapEnabled
var z=W.iapMakePurchase
var V=W.iapProductPrice
var Y=e("./layout")
var j=Y.WIDE
var K=Y.layoutCameraTallWideMode
var q=e("./localization/localization").L
var X=e("./main").toggleMenuPage
var Q=e("./menu")
var $=Q.CURRENCY_SHOP
var J=Q.menuX1
var ee=Q.menuY1
var te=e("./store")
var re=te.gameCurrencyPurchase
var ae=te.getAllProducts
var ie=e("./styles")
var oe=ie.color_black_20
var ne=ie.color_cosmetic_base_common
var se=ie.color_cosmetic_base_epic
var le=ie.color_cosmetic_base_rare
var _e=ie.color_cosmetic_bright_common
var ce=ie.color_cosmetic_bright_epic
var ue=ie.color_cosmetic_bright_rare
var de=ie.color_white_30
var fe=ie.color_white_50
var ve=ie.label_style
var he=ie.menu_header_style
var pe=ie.shop_cost_currency_style
var me=ie.style_wallet_boost_tokens
var Ee=ie.style_wallet_gems
var ge=ie.style_wallet_gems_expired
var Te=ie.style_wallet_gems_free
var ye=ie.style_wallet_orbs
var Se=ie.style_wallet_orbs_expired
var Ie=e("./ui_util")
var Ae=e("./ui_util_2")
var we=e("./ui_util_hires")
var Le=e("./wallet_ui").walletAnimateIncrease
var Oe=e("./world_comm")
var Re=Oe.getGemBalance
var be=Oe.getOrbBalance
var Ne=e("./worlds_sound").playSound
var Ce=Math.ceil,xe=Math.floor,Me=Math.max
var De
var Pe
var Be
var ke
var Ue=[]
var Ge=[]
var Fe=null
var We=null
function getUserCanRedeem(){return Pe}function getRedeemRequestStatus(){return Be}function openCurrencyShop(e){w("currency_shop",1,e?{entry_point:e}:void 0)
X($)}var He=0
var ze=false
var Ve=false
function getOffers(){ze=H()
Ve=F()
Ue.length=0
Ge.length=0
var e=ae()
for(var t=0;t<e.length;++t){var r=e[t]
if(r&&r.show_in_currency_shop)if(r.items[0].id===S&&r.is_gem_exchange){k("number"===typeof r.cost_orbs)
Ue.push({id:r.id,description:r.description,amount:r.items[0].amount,supposed_amount:r.items[0].supposed_amount,orb_cost:r.cost_orbs})
if(r.is_base_offer)Fe=Ue[Ue.length-1]}else if(r.is_free){var a=void 0
if(r.items[0].id===S)a=Ue
else if(r.items[0].id===I)a=Ge
else k(false)
var i=r.id.endsWith("ad")?"ad":"daily"
if("ad"===i&&!Ve);else a.push({is_free:i,id:r.id,amount:r.items[0].amount})}else{var o=V(r.id)
if(o)if(r.items[0].id===I){Ge.push({id:r.id,amount:r.items[0].amount,price:o.formatted,supposed_amount:r.items[0].supposed_amount})
if(r.is_base_offer)We=Ge[Ge.length-1]}}}He=Ge.length}function updateOffers(){if(F()!==Ve||H()!==ze)getOffers()}function setupTimers(){var e;(ke=new Date(u())).setUTCHours(0,0,0,0)
var t=(null==(e=c().getMyUserChannel())?void 0:e.getChannelData("public.redeems.daily_free_gem_time",0))||0
var r=new Date(t)
if(!(Pe=r<ke))ke.setUTCDate(ke.getUTCDate()+1)}function getFreeGemsRedeemTimeLeft(){var e=ke&&ke.getTime()-u()
if(e<0&&!Be)setupTimers()
return e}var Ye=i("last_video_ad_time",0)
var je=null
function getFreeAdsTimeLeft(e,t){var r
updateOffers()
var a="gem"===e?Ue:Ge
if(!t)for(var i=0;i<a.length;++i){var o=a[i]
if("ad"===o.is_free){je=t=o
break}}if(!t){je=null
return Infinity}var n=v[e]
var s=(null==(r=c().getMyUserChannel())?void 0:r.getChannelData("public.redeems.adhist"+e,[]))||[]
var l=p(u.seconds(),t.amount,s,n)
var _=Me(0,Ye+h-Ce(u()/1e3))
return Me(_,l)}function formatRedeemTimeLeft(e){return _(e,{hide_ms:true})}function getFreeGemsRedeemTimeLeftString(){return formatRedeemTimeLeft(getFreeGemsRedeemTimeLeft())}function getFreeCurrencyTimeInfo(){var e=null
if(E){var t=1e3*getFreeAdsTimeLeft("orb")
if(isFinite(t)&&(!e||t<e.time_until)){k(je)
e={currency_type:"orb",amount:je.amount,time_until:t}}var r=1e3*getFreeAdsTimeLeft("gem")
if(isFinite(r)&&(!e||r<e.time_until)){k(je)
e={currency_type:"gem",amount:je.amount,time_until:r}}}if(T){var a=Me(0,getFreeGemsRedeemTimeLeft())
if(!e||a<e.time_until)e={currency_type:"gem",amount:y,time_until:a}}if(!e)return null
e.time_string=formatRedeemTimeLeft(e.time_until)
return e}function redeemFreeGems(e){Be=true
var t=e.amount
var r=Re()
var a=c().getMyUserChannel()
k(a)
var i=a.pak("redeem_free_daily_gems")
i.writeInt(t)
i.send(function(e){if(e)x.modalDialog({title:q.DLG_ERROR_TITLE,text:q.DLG_DAILY_REDEEM_FAILED_CUSTOM_MSG.$({error:l(e)}),buttons:{ok:null}})
else{Ne("purchase")
Le("gem",t)
L("gem","source",t,true,"daily_free_gems",r)
setupTimers()}Be=false})}function videoAdWaitStart(){x.modalDialog({title:q.DLG_LOADING_AD_TITLE,text:q.MSG_PLEASE_WAIT})
Be=true}function videoAdWaitFinish(){x.modalDialogClear()
Be=false}function isAdParamToken(e){return"token"===e.type}function finishVideoAd(r,a,i){function sendAdFinish(){var e=c().getMyUserChannel()
k(e)
var t=e.pak("video_ad_finish")
t.writeAnsiString(r)
if(isAdParamToken(a)){t.writeAnsiString("token")
t.writeJSON(a.payload)}else{t.writeAnsiString(a.type)
t.writeInt(a.amount)}t.send(function(e,t){videoAdWaitFinish()
if(e){O("video_ad_failed")
x.modalDialog({title:q.DLG_ERROR_TITLE,text:q.DLG_VIDEO_AD_FAILED_CUSTOM_MSG.$({error:l(e)}),buttons:{ok:null}})
return i(l(e))}O("video_ad_finish")
i(null,t)})}c().onceConnected(function(){c().onceLoggedIn(sendAdFinish)})}function startVideoAd(r){O("video_ad_start")
videoAdWaitStart()
var e=c().getMyUserChannel()
k(e)
e.pak("video_ad_start").send(function(e,t){if(e){videoAdWaitFinish()
x.modalDialog({title:q.DLG_ERROR_TITLE,text:q.DLG_VIDEO_AD_FAILED_CUSTOM_MSG.$({error:l(e)}),buttons:{ok:null}})
return r(l(e))}C(function(e){if(e){videoAdWaitFinish()
if(e===N)x.modalDialog({title:q.DLG_VIDEO_AD_SKIPPED_TITLE,text:q.DLG_VIDEO_AD_SKIPPED_MSG,buttons:{ok:null}})
else if(e===b)x.modalDialog({title:q.DLG_VIDEO_AD_FAILED_TITLE,text:q.DLG_VIDEO_AD_FAILED_MSG,buttons:{ok:null}})
else x.modalDialog({title:q.DLG_ERROR_TITLE,text:q.DLG_VIDEO_AD_FAILED_CUSTOM_MSG.$({error:l(e)}),buttons:{ok:null}})
return r(l(e))}r(null,t)})})}function doVideoAd(r,a){startVideoAd(function(e,t){if(e)return a(e)
k(t)
finishVideoAd(t,r,a)})}function doVideoAdForOffer(e,i){var o=u()
var n=e.amount
doVideoAd({type:i,amount:n},function(e){if(e)return
Ne("purchase")
var t
var r
var a
if("gem"===i){t=Re()
r="free_gems_ad"
a="gem"}else{t=be()
r="free_orbs_ad"
a="orb"}Le(a,n)
L(a,"source",n,true,r,t)
setupTimers()
Ye=xe(o/1e3)
s("last_video_ad_time",Ye)})}function currencyShopOnceSubscribe(){setupTimers()
getOffers()}function currencyShopOnLogin(){var e=c().getMyUserChannel()
k(e)
e.onceSubscribe(currencyShopOnceSubscribe)}function currencyShopStartup(){c().onLogin(currencyShopOnLogin)}function currencyShopInit(){De=we.sprite
setupTimers()
getOffers()}var Ke=8
var qe=2
var Ze=d(0,0,0,1)
var Xe=1
var Qe=8
var $e=48
var Je=36
var et=$e+Qe+Je
var tt=56/253
var rt=42/253
function drawSectionTitleAndExplanation(e,t,r,a,i){var o=x.font
var n
var s
if("orb"===i){n=q.LBL_CURRENCY_SHOP_SUBSECTION_ORBS_TITLE
s=q.LBL_CURRENCY_SHOP_SUBSECTION_ORBS_DESCRIPTION}else{n=q.LBL_CURRENCY_SHOP_SUBSECTION_GEMS_TITLE
s=q.LBL_CURRENCY_SHOP_SUBSECTION_GEMS_DESCRIPTION}var l=e+.5*a
o.drawSizedAligned(he,l,t,r+1,$e,U.HCENTER,0,0,n)
t+=$e+Qe
o.drawSizedAligned(ve,l,t,r+1,Je,U.HCENTER,0,0,s)}var at={gems_daily:"GEM_0",gems_ad:"GEM_0",gems_exchange_s:"GEM_1",gems_exchange_m:"GEM_2",gems_exchange_l:"GEM_3",orbs_ad:"ORB_0",orbs_xs:"ORB_1",orbs_s:"ORB_2",orbs_m:"ORB_3",orbs_l:"ORB_4",orbs_xl:"ORB_5",orbs_xxl:"ORB_6"}
function shopButtonBackground(e){var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.color_top,s=e.color_bottom
var l=o*D
var _=t+l
var c=r+l
var u=t+i-l
var d=r+o-l
var f=t+.5*i
var v=r+.5*o
x.drawRect4Color(_,c,u,d,a,n,n,s,s)
x.drawCircle(f,v,a+.1,.25*i,0,de)
x.drawRect(_,r+o*B,u,d,a+.75,oe)}function shopButtonPrice(e){var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.price_type,s=e.can_redeem_this_offer,l=e.redeem_time_left,_=e.is_video_ad,c=e.price
var u=e.align||"center"
var d=G()
var f=o*D
var v=t+f
var h=t+i-f
var p=h-v
var m=t+.5*i
var E=r+o*(B+.5*P)
var g=tt*o
if("free"===n)if(s){d.drawSizedAligned(pe,m,E+.06*g,a+1,g,U.HVCENTER,0,0,(""+q.LBL_CURRENCY_SHOP_FREE).toUpperCase())
if(_){var T=g
Ie.sprite.draw({x:m+.2*i,y:E-.5*T-.002*i,z:a+1,w:T,h:T,frame:Ie.VIDEO_AD})}}else{k("number"===typeof l)
var y=(""+q.LBL_CURRENCY_SHOP_AVAILABLE_IN).toUpperCase()
var S=formatRedeemTimeLeft(l)
var I=rt*o
var A=.5*I
var w=I
d.drawSizedAligned(pe,m,E-=A+8,a+1,A,U.HCENTER,0,0,y)
d.drawSizedAligned(pe,m,E+=A,a+1,w,U.HCENTER,0,0,S)}else if("iap"===n){k(c)
var L=pe
d.drawSizedAligned(L,v+8,E+.06*g,a+1,g,U.VCENTER|U.HCENTERFIT,p-16,0,""+c)}else if("orb"===n||"gem"===n||"boost_token"===n){var O=""+c
var R
var b
var N
if("orb"===n){b=Ie.sprite
N=Ie.ORBS
R=ye}else if("gem"===n){b=Ie.sprite
N=Ie.GEMS
R=Ee}else if("boost_token"===n){b=Ae.sprite
N=Ae.BOOST_TOKEN
R=me}else k(false)
var C=g
if("left"===u){var x=d.drawSizedAligned(R,v+.02*p,E,a+1,g,U.VCENTER|U.HLEFT,0,0,O)
b.draw({x:v+x,y:E-.5*C,z:a+1,w:C,h:C,frame:N})}else if("right"===u){d.drawSizedAligned(R,v,E,a+1,g,U.VCENTER|U.HRIGHT,p-C-.02*p,0,O)
b.draw({x:h-C-.02*p,y:E-.5*C,z:a+1,w:C,h:C,frame:N})}else{var M=d.drawSizedAligned(R,m-C/2,E,a+1,g,U.VCENTER|U.HCENTER,0,0,O)
b.draw({x:m-C/2+M/2,y:E-.5*C,z:a+1,w:C,h:C,frame:N})}}else k(false)}function drawButton(e,t,r,a,i,o,n){var s=e.is_free
var l=true
var _=false
var c=0
if(s)if("ad"===e.is_free){_=true
var u=getFreeAdsTimeLeft(r,e)
l=u<=0
c=1e3*u}else{l=Pe
c=getFreeGemsRedeemTimeLeft()}var d=M()?false:s&&!l||Be
var f=x.font
var v=we[at[e.id]||"GEM_1"]
if(x.buttonImage({x:a,y:i,z:o,w:n,base_name:d?"button_disabled_border":"cosmetic_unselected",img:De,z_inc:-.5,frame:v,shrink:.85,disabled:d}))if("daily"===s)redeemFreeGems(e)
else if("ad"===s)doVideoAdForOffer(e,r)
else if("orb"===r){Be=true
z(e.id,function(){Be=false})}else{Be=true
re("orb",e.id,1,e.description,"currency_shop",function(e){Be=false
if(e)console.log(e)})}var h
var p
if(s){h=_e
p=ne}else if("orb"===r){h=ce
p=se}else{h=ue
p=le}var m
if(!s)if("orb"===r){k(e.price)
m=e.price}else{k(e.orb_cost)
m=e.orb_cost}var E={x:a,y:i,z:o-1,w:n,h:n,color_top:h,color_bottom:p,price_type:s?"free":"orb"===r?"iap":"orb",can_redeem_this_offer:l,redeem_time_left:c,price:m,is_video_ad:_}
shopButtonBackground(E)
shopButtonPrice(E)
var g=.07*n
var T=a+g
var y=a+n-g
var S=a+.5*n
var I
if(s)I=Te
else if("orb"===r)I=ye
else I=Ee
var A=i+.18*n
var w=tt*n
if(!s&&t&&e.amount>t.amount){var L="orb"===r?Se:ge
var O=e.supposed_amount
var R=0
var b=0
if(O>=1e3){R=a+.32*n
b=a+.68*n}else{R=a+.33*n
b=a+.66*n}var N=f.drawSizedAligned(L,R,A,o+1,w,U.HVCENTER,0,0,""+O)
var C=A
x.drawLine(R-.5*N,C,R+.5*N,C,o+2,.1*w,1,fe)
f.drawSizedAligned(I,b,A,o+1,w,U.HVCENTER,0,0,""+e.amount)}else{A+=f.drawSizedAligned(I,S,A,o+1,w,U.HVCENTER,0,0,""+e.amount)
if(s)f.drawSizedAligned(I,T+8,A+=32,o+1,48,U.HVCENTERFIT,y-T-16,0,(""+(_?q.LBL_CURRENCY_SHOP_WATCH_VIDEO_AD:q.LBL_CURRENCY_SHOP_DAILY_BONUS)).toUpperCase())}}function drawCurrencySection(e,t,r,a,i,o,n,s,l){var _
var c=qe
var u
var d
if("orb"===s){u=Ge
d=We}else{u=Ue
d=Fe}var f=e+(a-o*(_=Me(2,Ce(u.length/c)))-Ke*(_-1))/2
drawSectionTitleAndExplanation(e,t,r,a,s)
var v=t+et
var h=c*_
if(u.length<=_&&n===j)v+=(Ke+o)/2
if(u.length<_)f+=(_-u.length)*(Ke+o)/2
var p=v
var m=f
var E=_-1
if(6===h&&5===u.length&&"gem"===s){m+=.5*(Ke+o)
E--}for(var g=0;g<h;g++){var T=u[g]
if(T)drawButton(T,d,s,m,p,r+1,o)
else if(l&&g<E){x.font.draw({style:ve,size:Je,x:m+.1*o,y:p,z:r+1,w:.8*o,h:o,align:U.HVCENTER|U.HWRAP,text:l})
l=null}m+=Ke+o
if(g===E){p+=Ke+o
m=f
var y=h-u.length
if(y&&l)--y
if(y)m+=(Ke+o)*y*.5}}}var it=48
function doCurrencyShop(){updateOffers()
var e=K()
var t=0
var r=J()
var a=g()
var i=ee()
var o=Z.UI
var n=r-t
var s=i-a
var l=a
var _=0
var c=n
var u=c
var d
if(!He){d=325
l+=e===j?it:.25*s}else if(e===j){d=xe(((c=n-3*(_=.01*n))-4*Ke)/6)
u=c/2
l+=it}else{d=xe((s-2*et-4*Ke-2*it)/4)
l+=.5*it}var f=2*d+et
var v=_
drawCurrencySection(v,l,o,u,f,d,e,"gem",q.LBL_CURRENCY_SHOP_SUBSECTION_GEMS_EXTRA)
if(He){if(e===j){var h=v+u+.5*(_+Xe)
var p=l+et-4
var m=2*d+Ke+8
var E=0
x.drawLine(h,p,h+E,p+m,o+1,Xe,1,Ze)
v+=u+_}else l+=f+it
drawCurrencySection(v,l,o,u,f,d,e,"orb",null)}return q.LBL_CURRENCY_SHOP_TITLE}},{"../common/rewards_common":259,"../common/store_data":262,"../glov/client/font":315,"../glov/client/local_storage":329,"../glov/client/net":338,"../glov/client/ui":367,"../glov/client/walltime":370,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./client_cmds":43,"./frvr_sdk_worlds":102,"./in_app_purchases/iap_client_worlds":111,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./store":195,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./ui_util_hires":207,"./wallet_ui":221,"./world_comm":226,"./worlds_sound":236,assert:void 0}],73:[function(e,t,r){"use strict"
r.debugAddText=debugAddText
r.debugDraw=debugDraw
r.debugFilterObject=debugFilterObject
r.debugAddObject=debugAddObject
var i=e("../glov/client/engine")
var a=e("../glov/client/font")
var o=e("../glov/client/ui")
var n=e("../glov/common/vmath").vec4
var s=[]
function debugAddText(e){s.push(e)}r.addText=debugAddText
var l=18
var _=8
var c=a.style(null,{color:4294967295,outline_width:2,outline_color:255})
var u=n(.1,.1,.1,.8)
function debugDraw(e,t){if(s.length){var r=i.font.drawSizedWrapped(c,e+_,t+_,Z.DEBUG_TEXT+1,500,0,l,s.join("\n"))
var a=i.font.last_width
o.panel({x:e,y:t,w:a+2*_,h:r+2*_,z:Z.DEBUG_TEXT,color:u})
s.length=0}}r.draw=debugDraw
function debugFilterObject(e,t){var r={}
var a=e
for(var i in a){if(t&&t[i])continue
var o=a[i]
if("function"===typeof o||void 0===o||false===o||null===o)continue
r[i]=o}return r}function formatValue(e){if(!e)return e
if("number"===typeof e){if(e!==(0|e))return e.toFixed(3)
return e}if(Array.isArray(e))return"["+e.map(function(e){return formatValue(e)}).join(", ")+"]"
return e}var d=[]
function formatObject(n,s,l){var t=[]
var e=Object.keys(n)
e=e.filter(function(e){if(true===n[e]){t.push(e)
return false}return true})
var _=""
for(var r=0;r<s;++r)_+=" "
var a=e.map(function(e){var t=formatValue(n[e])
if("object"===typeof t&&null!==t)if(d.includes(t))t="[circular reference]"
else{var r=debugFilterObject(t)
var a=false
if(Object.keys(r).length>3)a=true
else for(var i in Object.keys(r))if("number"!==typeof r[i])a=true
d.push(t)
var o=formatObject(r,s+2,a)
d.pop()
t="{"+(a?"\n":" ")
t+=o
t+=(a?_:" ")+"}"}return e+": "+t+(l?"\n":"")}).join(l?_:", ").replace(/"/g,"")
var i=t.join(", ")
return(i?""+(l?_:"")+i+"\n":"")+(a?""+(l?_:"")+a:"")}function debugAddObject(e,t,r){d=[e]
debugAddText("  ~~"+t+"~~\n"+formatObject(debugFilterObject(e,r),4,true))}},{"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/ui":367,"../glov/common/vmath":402}],74:[function(e,t,r){"use strict"
r.blocksNever=blocksNever
r.blocksAlways=blocksAlways
r.surfaceCheckSetParams=surfaceCheckSetParams
r.maxSurfaceClear=maxSurfaceClear
r.tryDeleteProp=tryDeleteProp
r.tryPlaceProp=tryPlaceProp
r.DetailGenBase=DetailGenBase
r.DETAIL_Z0=r.DETAIL_ZOFFS=r.step_pos=r.bounds_z=void 0
var n=new Array(32)
r.bounds_z=n
var s=new Int32Array(3)
r.step_pos=s
var a=16
var i=-(r.DETAIL_ZOFFS=a)
r.DETAIL_Z0=i
var w=e("assert")
var o=e("../common/globals.js"),L=o.CHUNK_SIZE,_=o.CS2
var c=Math.abs,u=Math.ceil,l=Math.floor,O=Math.max,R=Math.min
var d=e("./proc_gen_details.js").i32Alloc
var f=e("./tiles.js"),b=f.TILE_PROP_BASE,v=f.TILE_PROP_MAX
function blocksNever(){return false}function blocksAlways(){return true}var h
var p
var m
function surfaceCheckSetParams(e,t,r){h=t
p=e
m=r}function maxSurfaceClear(e,t,r){var a=e[t]
var i=a.h
if(c(m-i)>3*L)return i
var o=1
if(a.hydro_pen>-4)o=-u(a.hydro_pen+5)
if(i<=h+10){var n=0
var s=e[t-1]
if(s)n=O(n,c(i-s.h))
if(s=e[t+1])n=O(n,c(i-s.h))
if(s=r>0&&p[r-1][t])n=O(n,c(i-s.h))
if(s=r<L-1&&p[r+1][t])n=O(n,c(i-s.h))
var l=O(n,1)+2
if(i<=h+l)o=R(o,-l)}return i+o}var E=new Int32Array(3)
var N
function findProp(e,t,r,a,i){w(t>=b)
if(t>v)return null
if(!e.props)return null
var o=t-b
for(var n=o;n>=0;--n){E[2]=i-n
if(E[2]<0)continue
for(var s=o-n;s>=0;--s){E[1]=a-s
if(E[1]<0)continue
var l=o-n-s
E[0]=r-l
if(E[0]<0)continue
N=(E[2]*L+E[1])*L+E[0]
var _=e.props[N]
if(_&&_.size[0]>l&&_.size[1]>s&&_.size[2]>n)return _}}return null}function findDeletableProp(e,t,r,a,i){var o=findProp(e,t,r,a,i)
if(!o)return null
if(E[0]+o.size[0]>L||E[1]+o.size[1]>L||E[2]+o.size[2]>L)return null
return o}function deleteProp(e,t,r){var a=r.size
delete e.props[t]
for(var i=0;i<a[2];++i)for(var o=0;o<a[1];++o){var n=t+i*_+o*L
for(var s=0;s<a[0];++s,++n){var l=e.data[n]
w.equal(l,b+s+o+i)
e.data[n]=0}}}function tryDeleteProp(e,t,r,a,i){var o=findDeletableProp(e,t,r,a,i)
if(!o)return false
deleteProp(e,N,o)
return true}function tryPlaceProp(e,t,r,a){if(!a)a=0
if(t[0]<0||t[1]<0||t[0]+r.size[0]>L||t[1]+r.size[1]>L)w(false,"Prop must not cross XY chunk boundaries")
w(t[2]>=-L&&t[2]<L)
var i=e.data
w(i)
var o=O(0,t[2])
var n=R(L,t[2]+r.size[2])
var s=O(0,t[1])
var l=R(L,t[1]+r.size[1])
var _=O(0,t[0])
var c=R(L,t[0]+r.size[0])
var u=[]
for(var d=o;d<n;++d)for(var f=s;f<l;++f)for(var v=_;v<c;++v){var h=i[(d*L+f)*L+v]
if(h>=b){var p=findDeletableProp(e,h,v,f,d)
if(!p)return false
u.push([N,p])}}for(var m=0;m<u.length;++m){var E=u[m]
deleteProp(e,E[0],E[1])}if(t[2]>=0&&t[2]<L){if(!e.props)e.props={}
var g=(t[2]*L+t[1])*L+t[0]
e.props[g]=r}var T=e.liquid
if(!T&&a){e.alloc(true)
T=e.liquid}for(var y=o;y<n;++y)for(var S=s;S<l;++S)for(var I=_;I<c;++I){var A=(y*L+S)*L+I
i[A]=b+(y-t[2])+(S-t[1])+(I-t[0])
if(T)T[A]=a}return true}var g={bounds_buf:1,bounds_len:1,f32buf:1,bounds_idx:1,last_bits:1,last_use_time:1,cleanup:1,origin_idx:1,owner_hexome:1}
function preserveArrays(e){if(!e||"string"===typeof e)return e
else if(e.length){var t=[]
for(var r=0;r<e.length;++r)t.push(preserveArrays(e[r]))
return t}else if("object"===typeof e){var a={}
for(var i in e)a[i]=preserveArrays(e[i])
return a}return e}function DetailGenBase(e,t,r){}DetailGenBase.prototype.type="DetailGenBase"
DetailGenBase.prototype.priority=100
DetailGenBase.prototype.toJSON=function(){var e={}
var t=this
for(var r in t){var a=t[r]
if(g[r]||"function"===typeof a);else if(a&&a.length>64)e[r]="(length="+a.length+")"
else e[r]=preserveArrays(a)}var i=this.bounds_idx,o=this.bounds_buf,n=this.bounds_len
if(n&&!e.bounds){var s=[]
for(var l=0;l<n;++l){var _=i+6*l
s.push("["+o[_]+","+o[_+2]+","+o[_+4]+"]-["+o[_+1]+","+o[_+3]+","+o[_+5]+"]")}e.bounds=s.join(", ")}if(this.getDebugLines)e.lines=this.getDebugLines()
return e}
DetailGenBase.prototype.cleanup=null
DetailGenBase.prototype.dispose=function(){}
DetailGenBase.prototype.blockable=false
DetailGenBase.prototype.blocked_check=false
DetailGenBase.prototype.blocked=false
DetailGenBase.prototype.blocksOther=blocksNever
DetailGenBase.prototype.boundsAlloc=function(e){var t=d(6*e),r=t[0],a=t[1]
this.bounds_buf=r
this.bounds_idx=a
this.bounds_len=e}
DetailGenBase.prototype.boundsPush=function(e,t,r,a,i,o,n){this.bounds_buf[e++]=l(t)
this.bounds_buf[e++]=l(i+1)
this.bounds_buf[e++]=l(r)
this.bounds_buf[e++]=l(o+1)
this.bounds_buf[e++]=l(a)
this.bounds_buf[e++]=l(n+1)
return e}
var T=new Array(32)
var y=new Array(32)
var S
var I
var A
var C
var x
DetailGenBase.prototype.stepInit=function(e){var t=this.last_bits
x=this.bounds_buf
C=this.bounds_idx
for(var r=I=0;r<this.bounds_len;++r)if(t&1<<r)T[I++]=r
S=e}
DetailGenBase.prototype.stepY=function(e){var t=S[1]+e
for(var r=A=0;r<I;++r){var a=T[r]
var i=C+6*a+2
if(t>=x[i++]&&t<x[i])y[A++]=a}if(!A)return false
s[1]=t
return true}
DetailGenBase.prototype.stepX=function(e){var t=S[0]+e
var r=0
for(var a=0;a<A;++a){var i=y[a]
var o=C+6*i
if(t>=x[o++]&&t<x[o])n[r++]=i}s[0]=t
return r}},{"../common/globals.js":248,"./proc_gen_details.js":166,"./tiles.js":199,assert:void 0}],75:[function(e,t,r){"use strict"
r.renderedDetailGen=renderedDetailGen
var M=e("assert")
var a=e("../glov/common/util")
var D=a.cloneShallow
var i=a.inherits
var P=e("../glov/common/vmath").vec3
var o=e("../common/globals")
var B=o.CHUNK_SIZE
var k=o.CS2
var n=e("./detail_gen_base")
var s=n.DETAIL_ZOFFS
var l=n.DetailGenBase
var _=n.blocksNever
var U=n.tryDeleteProp
var G=n.tryPlaceProp
var F=e("./proc_gen").renderDetail
var c=e("./tiles")
var W=c.TILE_AIR
var H=c.TILE_PROP_BASE
var z=c.TILE_WATER
var V=Math.max,Y=Math.min
function RenderedDetailGen(e){l.call(this)
for(var t in e)switch(t){case"priority":this.priority+=e.priority
break
default:M(!this[t])
this[t]=e[t]}this.rendered=false
this.vd=null
this.boundsAlloc(1)
var r=this.pos_world,a=this.size
this.boundsPush(this.bounds_idx,r[0],r[1],r[2],r[0]+a[0]-1,r[1]+a[1]-1,r[2]+a[2]-1)
if(this.detail_type.unblockable)this.blockable=false
else{this.blocked_origin=P(this.origin[0],this.origin[1],this.origin[2]-s)
var i=this.detail_type.exclusion_calced
if(!i){i=this.detail_type.exclusion
i=this.detail_type.exclusion_calced=P(i[0],i[1],i[2]+s)}this.blocked_size=i
this.blocked_r=-1}}i(RenderedDetailGen,l)
RenderedDetailGen.prototype.type="RenderedDetailGen"
RenderedDetailGen.prototype.priority=150
RenderedDetailGen.prototype.blockable=true
RenderedDetailGen.prototype.blocksOther=_
var u={rendered:1,origin:1,pos_world:1,size:1,detail_type:1,seed:1,hexome:1,owner_mcid:1,vd:1}
RenderedDetailGen.prototype.toJSON=function(){var e={}
for(var t in this)if(!u[t])e[t]=this[t]
e.seed=this.detail_type.name
if(this.vd)e.vd=this.vd.data.length+" bytes"
return l.prototype.toJSON.call(e)}
RenderedDetailGen.prototype.dispose=function(){if(this.rendered){this.vd=null
this.rendered=false}}
RenderedDetailGen.prototype.cleanup=function(){if(this.rendered){this.vd=null
this.rendered=false}}
function chunkContainsDetailProp(e,t,r){for(var a=0;a<3;a++)if(e[a]>=r[a]+t.pos[a]+t.size[a]||e[a]+B<=r[a]+t.pos[a])return false
return true}RenderedDetailGen.prototype.genLocal=function(e){var t=e.vd
if(!this.rendered)F(this)
else M(this.vd)
var r=this.pos_world,a=this.size
var i=t.pos_world
var o=i[2]
var n=o+B
var s=V(o,r[2])
var l=Y(n,r[2]+a[2])
if(s>=l)return
var _=V(i[0],r[0])
var c=Y(i[0]+B,r[0]+a[0])
if(_>=c)return
var u=V(i[1],r[1])
var d=Y(i[1]+B,r[1]+a[1])
if(u>=d)return
var f=this.vd.data
var v=t.data
var h=this.vd.props
var p=[]
var m=_-i[0]
for(var E=s;E<l;++E){var g=E-i[2]
var T=g*k
var y=(E-r[2])*this.vd.stride2
for(var S=u;S<d;++S){var I=S-i[1]
var A=T+I*B+m
var w=y+(S-r[1])*this.vd.stride1+_-r[0]
for(var L=_;L<c;++L){var O=f[w]
var R=false
if(O){if(O===W){O=0
t.full=false}if(!v){t.alloc(false)
v=t.data}var b=v[A]
if(b>=H)if(!U(t,b,L-i[0],I,g))p[A]=R=true
if(!R){v[A]=O
if(t.liquid)t.liquid[A]=0}}if(this.vd.liquid&&!R)if(O=this.vd.liquid[w]){M(f[w])
if(O===W)O=0
if(!t.liquid)t.alloc(true)
t.liquid[A]=O}A++
w++}}}var N=P()
if(h)for(var C=0;C<h.length;C++){var x=h[C]
if(chunkContainsDetailProp(i,x,r)){N[0]=r[0]+x.pos[0]-i[0]
N[1]=r[1]+x.pos[1]-i[1]
N[2]=r[2]+x.pos[2]-i[2]
if(!p[(N[2]*B+N[1])*B+N[0]])if(x.prop_underwater){delete(x=D(x)).prop_underwater
G(t,N,x,z)}else G(t,N,x)}}}
function renderedDetailGen(e){return new RenderedDetailGen(e)}},{"../common/globals":248,"../glov/common/util":400,"../glov/common/vmath":402,"./detail_gen_base":74,"./proc_gen":162,"./tiles":199,assert:void 0}],76:[function(e,t,r){"use strict"
r.providerForestedRuin=providerForestedRuin
r.RUIN_SIMPLE=void 0
var a=e("./detail_gen_base.js"),o=a.DetailGenBase,N=a.tryDeleteProp,i=a.DETAIL_Z0
var n=e("../common/globals.js"),C=n.CHUNK_SIZE,x=n.CS2,M=n.TILE_PROP_BASE
var D=Math.floor,P=Math.max,B=Math.min,s=Math.round
var l=e("../glov/client/rand_fast.js"),_=l.randFastCreate,k=l.randSimpleSpatial
var c=e("./tiles.js"),U=c.TILE_BRICK_STONE,G=c.TILE_STONE
var u=e("../glov/common/util.js").inherits
var d=e("../glov/common/vmath.js"),f=d.ivec3,v=d.vec3,F=d.v3sub
var h=_()
var p=30
var m=16
function DetailGenRuin(e,t,r){o.call(this)
h.reseed(e)
var a=this.size_x=8+h.range(p-8)
var i=this.size_y=8+h.range(p-8)
this.origin=t.slice(0)
this.boundsAlloc(1)
this.boundsPush(this.bounds_idx,this.origin[0],this.origin[1],this.origin[2],this.origin[0]+a-1,this.origin[1]+i-1,this.origin[2]+m-1)}u(DetailGenRuin,o)
DetailGenRuin.prototype.type="DetailGenRuin"
DetailGenRuin.prototype.priority=90
DetailGenRuin.prototype.blockable=false
var W=f()
DetailGenRuin.prototype.genLocal=function(e){var t=e.vd,r=e.vs
var a=t.data
var i=t.liquid
var o=this.size_x,n=this.size_y,s=this.origin,l=this.seed
var _=r.map
var c=t.pos_world
F(W,c,s)
var u=P(-W[0],0)
var d=B(o-W[0],C)
var f=P(-W[1],0)
var v=B(n-W[1],C)
for(var h=f;h<v;++h){var p=c[1]+h
var m=_[h]
var E=p===s[1]||p===s[1]+n-1
for(var g=u;g<d;++g){var T=c[0]+g
var y=m[g].h
if(!(E||T===s[0]||T===s[0]+o-1))continue
var S=D(3*k(l,T,p,0))
var I=P(y-c[2],0)
var A=B(y+S-c[2],C)
var w=h*C+g+I*x
if(A>I)if(!a){t.alloc()
a=t.data}for(var L=I;L<A;++L,w+=x){var O=c[2]+L-y
var R=a[w]
if(R>=M)if(!N(t,R,g,h,L))continue
var b=G
if(0===O)b=U
a[w]=b
if(i)i[w]=0}}}}
function detailGenRuin(e,t,r){return new DetailGenRuin(e,t,r)}var E={exclusion:null,bounds:[v(0,0,i),v(p,p,m)],factory:detailGenRuin}
r.RUIN_SIMPLE=E
function providerForestedRuin(e){var t=s(e.pos_world[0])
var r=s(e.pos_world[1])
return[{pos:v(t-p/2,r-p/2,0),type:E}]}},{"../common/globals.js":248,"../glov/client/rand_fast.js":347,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./detail_gen_base.js":74,"./tiles.js":199}],77:[function(e,t,r){"use strict"
r.advancedDowse=advancedDowse
r.DOWSER_ADVANCED_BASE_LEN=void 0
var g=40
r.DOWSER_ADVANCED_BASE_LEN=g
var T=e("../glov/client/engine.js")
var a=e("../glov/common/util.js").arrayToSet
var i=e("../glov/common/vmath.js")
var y=i.v3addScale
var S=i.v3copy
var I=i.v3iNormalize
var o=i.vec3
var n=e("../common/ids").ITEM_BAG
var A=e("./build_mode.js").oreFromLocalPos
var w=e("./debug.js")
var L=e("./main.js")
var O=e("./main.js").charControllerPos
var s=e("./tiles.js")
var l=s.TILE_COAL
var _=s.TILE_ORE_IN_STONE
var c=s.TILE_ORE_IN_STONE_DARK
var u=s.TILE_ORE_IN_STONE_LIGHT
var d=s.TILE_ORE_IN_STONE_RED
var f=s.TILE_ORE_IN_VEINIUM
var v=s.TILE_PROP_BASE
var h=s.TILE_STONE
var p=s.TILE_STONE_DARK
var m=s.TILE_STONE_LIGHT
var E=s.TILE_STONE_RED
var R=s.TILE_VEINIUM
var b=e("./voxel_data.js")
var N=Math.cos,C=Math.max,x=Math.random,M=Math.sin,D=Math.sqrt,P=Math.PI
var B
var k
var U
var G
var F
var W
var H=a([l,h,p,m,E,_,u,c,d,f,R])
function dowserVoxelCB(e,t){if(e<0)return
if(e===v){var r=b.andGetProp()
if(r&&r.item_id===n)e=0}if(!e){--W
if(!k&&W>=0)return}else k=true
if(e!==U)if(H[e]){++G
if(B[U=e])++F}B[e]=(B[e]||0)+1}var z=5*P/180
var V=o()
var Y=o()
function advancedDowse(e){var t=O()
var r=L.char_controller,a=r.facing,i=r.char_up,o=r.char_right
if(1){var n=x()
var s=x()
var l=2*P*n
var _=N(z)
var c=_+(1-_)*s
var u=D(1-c*c)
var d=N(l)*u
var f=M(l)*u
V[0]=i[0]*d+o[0]*f+a[0]*c
V[1]=i[1]*d+o[1]*f+a[1]*c
V[2]=i[2]*d+o[2]*f+a[2]*c
I(V)}else S(V,a)
B={}
k=false
W=10
F=G=U=0
b.raycast3DLocalCB(t,V,e.dowser_range,dowserVoxelCB)
if(T.defines.DOWSER){w.addText("Transition Count: "+G)
w.addText("Transition Back Count: "+F)
var v=0
var h=0
for(var p in B){var m=B[p]
v=C(v,m)
h+=m}w.addText("Max: "+(100*v/h).toFixed(0)+"%")}var E=(.5*((G=C(0,G-1))-F)+F)/10
y(Y,t,V,.333*g)
return{intensity:E+.05,ore_type:A(Y),blend_time:1e3}}},{"../common/ids":249,"../glov/client/engine.js":305,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./build_mode.js":33,"./debug.js":73,"./main.js":135,"./tiles.js":199,"./voxel_data.js":216}],78:[function(e,t,r){"use strict"
r.simpleDowse=simpleDowse
r.simpleDowserStartup=simpleDowserStartup
r.DOWSER_SIMPLE_BASE_LEN=void 0
var a=30
r.DOWSER_SIMPLE_BASE_LEN=a
var i=e("../glov/client/engine.js")
var o=e("../glov/common/util.js").arrayToSet
var n=e("../glov/common/vmath.js")
var u=n.v3distSq
var d=n.v3iScale
var f=n.v3set
var v=n.v3sub
var s=n.vec3
var l=e("../common/globals.js")
var h=l.CHUNK_SIZE
var _=l.CS3
var c=e("./chunk_searcher.js").ChunkSearcher
var p=e("./debug.js")
var m=e("./main.js").charControllerPos
var E=e("./proc_gen.js").oreFromChunkPos
var g=e("./tiles.js")
var T=g.TILE_ORE_IN_STONE
var y=g.TILE_ORE_IN_STONE_DARK
var S=g.TILE_ORE_IN_STONE_LIGHT
var I=g.TILE_ORE_IN_STONE_RED
var A=g.TILE_ORE_IN_VEINIUM
var w=e("./voxel_const").origin_chunk
var L=Math.max
var O
var R=o([T,S,y,I,A])
function vdHasOre(e,t){if(e.has_ore_ver===e.ver_data)return e.has_ore
t.addWork(10)
e.has_ore_ver=e.ver_data
var r=e.data
for(var a=0;a<_;++a)if(R[r[a]])return e.has_ore=true
return e.has_ore=false}var b=s()
var N=s()
var C=s()
function simpleDowse(e,t){O.setStart(m())
O.setRange(e.dowser_range)
if(t||O.done)O.reset(t)
var l=0
var _=0
var c=0
O.search(function(e){var t=null
_++
if(vdHasOre(e,O)){c++
O.addWork(20)
v(b,e.pos,w)
d(b,h)
var r=e.data
for(var a=0,i=0;i<h;++i)for(var o=0;o<h;++o)for(var n=0;n<h;++n,++a){l++
if(R[r[a]]){N[0]=b[0]+n
N[1]=b[1]+o
N[2]=b[2]+i
var s=u(O.start,N)
if(s<O.closest_dist){f(C,n,o,i)
t={closest_chunk:e,closest_dist:s,closest_offs:C}}}}}return t})
if(i.defines.DOWSER){p.addText("Checks:")
p.addText("  Chunks Checked: "+_)
p.addText("  Chunks With Ore: "+c)
p.addText("  Voxels Checked: "+l)
p.addText("Time: "+(i.hrnow()-O.search_start_time).toFixed(3))
p.addText("Distance: "+O.last_closest_dist.toFixed(1)+"/"+O.range)
p.addText("Walk: "+O.chunk_walk+" / "+O.done)}if(O.last_closest_chunk)return{intensity:L(1-(O.last_closest_dist-2)/O.range,0),ore_type:E(O.last_closest_chunk.pos),blend_time:500}
else return{intensity:0,ore_type:null,blend_time:500}}var x=50
function simpleDowserStartup(){O=new c(x)}},{"../common/globals.js":248,"../glov/client/engine.js":305,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./chunk_searcher.js":42,"./debug.js":73,"./main.js":135,"./proc_gen.js":162,"./tiles.js":199,"./voxel_const":215}],79:[function(e,t,r){"use strict"
r.dowserUI=dowserUI
var h=e("assert")
var p=e("../glov/client/auto_reset").autoResetSkippedFrames
var m=e("../glov/client/camera2d")
var E=e("../glov/client/engine")
var g=e("../glov/client/ui")
var c=e("../glov/client/ui").uiTextHeight
var T=e("../glov/common/util").lerp
var a=e("../glov/common/vmath")
var y=a.v3copy
var S=a.v3distSq
var I=a.v3lerp
var A=a.v4copy
var i=a.vec4
var w=e("../common/ids").ITEM_DOWSER_ADVANCED
var L=e("./dowser_advanced").advancedDowse
var O=e("./dowser_simple").simpleDowse
var R=e("./localization/localization").L
var b=e("./materials").MATERIAL_NAME
var N=e("./styles").label_style
var C=e("./tiles").MAT_METAL_TINT
var x=Math.max,M=Math.min
var u=100
var D=.01
var P={unidentified:0,ore_detected:0}
function drawDowserUIText(e,t,r,a,i,o,n){var s=g.font
var l=M(E.frame_dt/u,1)
n=T(l,n,o?1:0)
var _=s.styleAlpha(e,n)
s.drawSizedAligned(_,t,r,a,1.15*c(),s.ALIGN.HVCENTER,0,0,i)
return n}var B
var k=i(.5,.5,.5,1)
var U=i(1,1,1,1)
var G=i(1,1,1,.5)
var F=i(0,0,0,1)
var W=i()
function dowserUI(e){h(e.dowser_range)
var t=m.w()/2
var r=.75*m.h()
var a=Z.UI
var i=600
var o=50
var n=p("dowserUI")
var s
if(e.id===w)s=L(e)
else s=O(e,n)
var l=s,_=l.intensity,c=l.ore_type,u=l.blend_time
A(W,G)
var d=k
var f=c===e.attr1
if(f)if(C[e.attr1]){d=C[e.attr1]
if(S(d,k)<.12&&x(d[0],d[1],d[2])-M(d[0],d[1],d[2])<.05)d=U}_=M(_,1)
if(n){B=_
y(F,d)}else{var v=M(E.frame_dt/u,1)
B=T(v,B,_)
I(F,v,F,d)}P.unidentified=drawDowserUIText(N,t,r+o/2,a+1,R.DOWSERUI_UNIDENTIFIED,!f&&_>=D,P.unidentified)
P.ore_detected=drawDowserUIText(N,t,r+o/2,a+1,R.$(R.DOWSERUI_ORE_DETECTED,b[e.attr1]),f&&_>=D,P.ore_detected)
g.progressBar({x:t-i/2,y:r,z:a,w:i,h:o,progress:B,color:F,color_trough:W,centered:true})}},{"../common/ids":249,"../glov/client/auto_reset":290,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./dowser_advanced":77,"./dowser_simple":78,"./localization/localization":131,"./materials":137,"./styles":197,"./tiles":199,assert:void 0}],80:[function(e,t,r){"use strict"
r.hasCustomTextures=hasCustomTextures
r.dragdropReloadStartup=dragdropReloadStartup
var i=e("assert")
var a=e("../glov/client/cmds.js").cmd_parse
var o=e("../glov/client/sound")
var n=o.soundFindForReplacement
var s=o.soundReplaceFromDataURL
var l=e("../glov/client/textures.js")
var _=l.textureCname
var c=l.textureFindForReplacement
var u=l.textureUnloadDynamic
var d=e("./atlas_params.json")
var f=e("./voxel_atlas.js").makeAtlas
var v=e("./voxel_data.js")
var h=e("./voxel_data.js").recalcAtlasParams
var p=Math.floor
var m=false
function hasCustomTextures(){return m}function reloadTextureFromDrop(e){var i=_(e.name)
var s=c(e.name)
if(!s){i="voxels"
s=v.pack_texture}var o=new FileReader
o.onload=function(e){var t
function makeAtlasFilter(e,t,r){var a=d[e]
var i=f(a,s,r)
if("primary"===e||"util"===e){var o=a.tiles_per_row
var n=p(r.width/o)
h(e,n,i.width,i.height)}return i}for(var r in d){var a=r
if(d[a].fn===i)t=makeAtlasFilter.bind(null,a)}m=true
s.loadURL(o.result,t)
u()}
o.readAsDataURL(e)}function reloadSoundFromDrop(e){var t=_(e.name)
var r=n(t)
if(!r){console.log("Could not find any sound matching "+t)
return}var a=new FileReader
a.onload=function(e){i("string"===typeof a.result)
s(r,a.result)}
a.readAsDataURL(e)}function reloadAssetFromDrop(e){if(!e||!e.type)return
if(e.type.startsWith("image/"))reloadTextureFromDrop(e)
else if(e.type.startsWith("audio/"))reloadSoundFromDrop(e)}function autoTextureUpload(t){["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){t.addEventListener(e,function(e){e.preventDefault()
e.stopPropagation()})})
t.addEventListener("drop",function(e){e.preventDefault()
e.stopPropagation()
i(e.dataTransfer)
var t=e.dataTransfer.files
for(var r=0;r<t.length;++r)reloadAssetFromDrop(t[r])})}a.register({cmd:"voxel_pack",help:"Apply a replacement voxel pack from your device",func:function func(e,t){var r=document.createElement("input")
r.setAttribute("type","file")
r.setAttribute("accept",".gif,.jpg,.jpeg,.png")
r.setAttribute("multiple","multiple")
r.onchange=function(){if(r.files)for(var e=0;e<r.files.length;++e)reloadAssetFromDrop(r.files[e])}
r.click()}})
function dragdropReloadStartup(e){autoTextureUpload(e)}},{"../glov/client/cmds.js":298,"../glov/client/sound":358,"../glov/client/textures.js":365,"./atlas_params.json":14,"./voxel_atlas.js":213,"./voxel_data.js":216,assert:void 0}],81:[function(e,t,r){"use strict"
r.drawLine3D=drawLine3D
var s=e("../glov/client/draw_list.js").opaqueQueue
var l=e("../glov/client/engine.js")
var _=e("../glov/client/geom.js").geomCreateQuads
var c=e("../glov/client/mat4ScaleRotateTranslate.js")
var u=Math.atan2,d=Math.sqrt
var a=e("../glov/client/quat.js"),i=a.quat,f=a.qFromYPR
var o=e("../glov/client/shaders.js"),v=o.SEMANTIC,h=o.shaderCreate,p=o.shadersRequirePrelink,m=o.shadersBind,E=o.shadersPrelink
var n=e("../glov/client/textures.js"),g=n.textureBind,T=n.textureWhite
var y=e("../glov/common/vmath.js"),S=y.vec3,I=y.v2distSq,A=y.v3copy,w=y.v3distSq,L=y.mat4
var O=e("./voxel_data.js").localPosFromWorldPos
var R=S()
var b=S()
var N=i()
var C
var x
var M
function drawLine3D(e){if(!C){var t=.0125
C=_([[v.POSITION,gl.FLOAT,3,false]],new Float32Array([0,t,t,0,-t,t,1,-t,t,1,t,t,1,t,-t,1,-t,-t,0,-t,-t,0,t,-t,1,t,t,1,t,-t,0,t,-t,0,t,t,0,-t,t,0,-t,-t,1,-t,-t,1,-t,t,1,-t,t,1,-t,-t,1,t,-t,1,t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t]),true)
var r=p(false)
x=h("shaders/line_3d.vp")
M=h("shaders/line_3d.fp")
E(x,M)
p(r)}var a=L()
if(e.local){A(R,e.p0)
A(b,e.p1)}else{O(R,e.p0)
O(b,e.p1)}var i=d(w(R,b))
var o=u(b[1]-R[1],b[0]-R[0])
var n=-u(b[2]-R[2],d(I(R,b)))
f(N,o,0,n)
c(a,1,N,R)
a[0]*=i
a[1]*=i
a[2]*=i
a[3]*=i
s(function(){g(0,T)
l.updateMatrices(a)
m(x,M,{color:e.color,color2:e.color2||e.color})
C.draw()})}},{"../glov/client/draw_list.js":301,"../glov/client/engine.js":305,"../glov/client/geom.js":318,"../glov/client/mat4ScaleRotateTranslate.js":336,"../glov/client/quat.js":346,"../glov/client/shaders.js":353,"../glov/client/textures.js":365,"../glov/common/vmath.js":402,"./voxel_data.js":216}],82:[function(e,t,r){"use strict"
r.drawSprite3DStartup=drawSprite3DStartup
r.drawSprite3D=drawSprite3D
var a=e("./camera.js").getCurrentCameraPos
var i=e("../glov/client/engine.js")
var o=e("../glov/client/geom.js").geomCreateQuads
var n=e("../glov/client/mat4ScaleRotateTranslate.js")
var s=Math.atan2,l=Math.sqrt
var _=e("../glov/client/quat.js"),c=_.quat,u=_.qFromAxisAngle
var d=e("../glov/client/shaders.js"),f=d.SEMANTIC,v=d.shaderCreate,h=d.shadersPrelink,p=d.shadersBind
var m=e("../glov/client/sprites.js")
var E=e("../glov/client/textures.js").textureBindArray
var g=e("../glov/common/vmath.js"),T=g.mat4,y=g.vec3,S=g.v3sub,I=g.v2lengthSq,A=g.unit_vec,w=g.zaxis
var L=T()
var O=c()
var R=y()
var b
var N
function drawSprite3DStartup(){b=o([[f.POSITION,gl.FLOAT,3,false],[f.TEXCOORD,gl.FLOAT,2,false]],new Float32Array([1,0,1,0,0,1,0,-1,0,1,-1,0,-1,1,1,-1,0,1,1,0]),true)
N=v("shaders/billboard.vp")
h(N,m.sprite_fshader)}function drawSprite3D(e){if(!b)drawSprite3DStartup()
S(R,a(),e.pos)
var t=l(I(R))
u(O,w,-s(R[0]/t,R[1]/t))
n(L,1,O,e.pos)
E(e.texs)
i.updateMatrices(L)
p(N,m.sprite_fshader,{size:e.size||A,color:e.color})
b.draw()}},{"../glov/client/engine.js":305,"../glov/client/geom.js":318,"../glov/client/mat4ScaleRotateTranslate.js":336,"../glov/client/quat.js":346,"../glov/client/shaders.js":353,"../glov/client/sprites.js":363,"../glov/client/textures.js":365,"../glov/common/vmath.js":402,"./camera.js":35}],83:[function(e,t,r){"use strict"
r.editVolumeClearContentsInProgress=editVolumeClearContentsInProgress
r.editVolumeClearContentsCancel=editVolumeClearContentsCancel
r.editVolumeClearContentsStart=editVolumeClearContentsStart
r.editVolumeClearContentsTick=editVolumeClearContentsTick
var E=e("../glov/client/camera2d")
var g=e("../glov/client/engine")
var T=e("../glov/client/font").ALIGN
var a=e("../glov/client/ui")
var y=a.buttonText
var S=a.panel
var I=a.progressBar
var A=a.uiButtonHeight
var w=a.uiGetFont
var L=a.uiTextHeight
var i=e("../glov/common/vmath")
var m=i.unit_vec
var O=i.v3add
var R=i.v3sub
var b=e("../common/editvolume_common").volumeContainsPoint
var o=e("../common/globals")
var N=o.CHUNK_SIZE
var v=o.ID_FACTOR
var C=o.TILE_PROP_BASE
var x=o.TILE_PROP_MAX
var M=e("./editvolume_client").editVolumeById
var D=e("./localization/localization").L
var P=e("./main").getFrameTransaction
var B=e("./status")
var k=e("./user_data").worldReadOnly
var U=e("./voxel_data")
var n=e("./voxel_data")
var G=n.getPropRelative
var F=n.transPropRemove
var W=n.transSetTileDirect
var H=e("./world_comm").worldTransactionsInProgress
var z=e("./world_metadata").worldEnforcePropPlacement
var V=Math.min
var Y
var j
function editVolumeClearContentsInProgress(){return g.frame_index<=Y+1}function editVolumeClearContentsCancel(){Y=void 0
if(j.resp_func)j.resp_func()
j=void 0}function editVolumeClearContentsStart(e,t){Y=g.frame_index
var r=e.bounds,a=e.volume_id
var i=[]
var o=r.min_chunk[0]
var n=r.min_chunk[1]
var s=r.min_chunk[2]
var l=r.max_chunk[0]
var _=r.max_chunk[1]
for(var c=r.max_chunk[2]-1;c>=s;--c)for(var u=n;u<_;++u)for(var d=o;d<l;++d){var f=(c*v+u)*v+d
i.push(f)}j={volume_id:a,done:0,total:i.length,walk:i.length-1,walk_last_done:i.length-1,stalled:0,all_chunks:i,resp_func:t}}var K=new Int32Array(3)
var q=new Int32Array(3)
var X=new Int32Array(3)
function clearChunk(e,t){var r=false
var a=t.liquid,i=t.data,o=t.props
var n
var s={}
if(o)for(var l in o){var _=o[l]
if(!_.areaShouldClear())continue
O(X,t.pos_world,_.pos)
O(X,X,_.size)
R(X,X,m)
if(b(e,X)){n=n||P()
s[_.uid]=true
F(n,_,r,false)}}if(a||i)for(var c=0,u=0;c<N;++c){K[2]=c
q[2]=c+1
for(var d=0;d<N;++d){K[1]=d
q[1]=d
for(var f=0;f<N;++f,++u){K[0]=f
q[0]=f
if(i){var v=i[u]
if(v&&!(v>=C&&v<=x)){var h=G(t.chunk_id,q)
if(h&&z()&&(h.inv.rooted||h.neighborChanged)&&!s[h.uid]);else{n=n||P()
W(n,t,K,0,false,false,v,r)}}}if(a){var p=a[u]
if(p){n=n||P()
W(n,t,K,0,true,false,p,r)}}}}}return Boolean(n)}function editVolumeClearContentsTick(){if(!editVolumeClearContentsInProgress())return
var e=j,a=e.all_chunks,t=e.volume_id
var i=M(t)
if(!i||k()){editVolumeClearContentsCancel()
return}if(!a.length){B.push(D.STATUSMSG_AREA_CLEARED)
editVolumeClearContentsCancel()
return}Y=g.frame_index
var r=.75*E.h()
var o=400
var n=E.x0()+(E.w()-o)/2
var s=Z.EDITVOLUME_STATUS
var l=j,_=l.done,c=l.total
var u=24
var d=8
var f=32
var v=r+u
var h=2*L()
w().draw({x:n+u,y:v,z:s,w:o-2*u,h:h,align:T.HVCENTER|T.HWRAP,color:255,text:j.stalled>=2?D.LBL_AREA_CLEARING_STALLED:D.LBL_AREA_CLEARING})
if(y({x:n+o/4,y:v+=h+d,z:s,w:o/2,text:D.BTN_CANCEL}))editVolumeClearContentsCancel()
v+=A()+d
I({x:n+u,y:v,z:s,w:o-2*u,h:f,progress:_/c,tooltip:D.$(D.FORMAT_FRACTION,_,c)})
v+=f
S({x:n,y:r,w:o,h:(v+=u)-r,z:s-1})
if(!j)return
if(H())return
function tryWalk(){if(j.walk<0)j.walk=a.length-1
var e=j.walk--
if(e===j.walk_last_done)j.stalled++
var t=a[e]
var r=U.chunk_map[t]
if(!r)return false
if(!r.allNeighborsGened())return false
j.done++
a.splice(e,1)
j.walk_last_done=V(e,a.length-1)
j.stalled=0
return clearChunk(i,r)}var p=Date.now()
var m=1e3
while(--m&&Date.now()-p<10)if(tryWalk())break}},{"../common/editvolume_common":242,"../common/globals":248,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/ui":367,"../glov/common/vmath":402,"./editvolume_client":84,"./localization/localization":131,"./main":135,"./status":193,"./user_data":208,"./voxel_data":216,"./world_comm":226,"./world_metadata":235}],84:[function(e,t,r){"use strict"
r.inEditBoundsByChunkId=inEditBoundsByChunkId
r.inEditBoundsAndReadyByChunkId=inEditBoundsAndReadyByChunkId
r.inEditBoundsAndReady=inEditBoundsAndReady
r.inEditBounds=inEditBounds
r.editVolumeForPos=editVolumeForPos
r.editVolumeDefaultAccess=editVolumeDefaultAccess
r.hasVolumeAdminAccessForPos=hasVolumeAdminAccessForPos
r.manageVolumeAllowedForPos=manageVolumeAllowedForPos
r.waygateEditAllowedForPos=waygateEditAllowedForPos
r.editVolumeById=editVolumeById
r.volumeIsSettlement=volumeIsSettlement
r.settlementEstablishAllowed=settlementEstablishAllowed
r.resetEditVolumes=resetEditVolumes
r.updateEditVolumes=updateEditVolumes
r.editVolumeShift=editVolumeShift
r.volumeCurrent=volumeCurrent
r.editVolumeClearContents=editVolumeClearContents
r.editVolumeAddHereCmd=editVolumeAddHereCmd
var a=e("../glov/client/cmds").cmd_parse
var i=e("../glov/client/net").netUserId
var _=e("../glov/client/settings")
var o=e("../glov/common/util")
var n=o.nop
var l=o.toNumber
var s=e("../glov/common/vmath")
var c=s.unit_vec
var u=s.v3addScale
var d=s.v3copy
var f=s.v3iAdd
var v=s.v3iFloor
var h=s.v3iRound
var p=s.v3iScale
var m=s.v3scale
var E=s.vec3
var g=e("../common/editvolume_common")
var T=g.EDITVOLUME_MAX_SIZE
var y=g.volumeContainsPoint
var S=g.volumesOverlap
var I=e("../common/globals")
var A=I.CHUNK_SIZE
var w=I.ID_FACTOR
var L=e("../common/megachunk_common").chunkPosFromId
var O=e("../common/waygate_upgrade_common").SETTLEMENT_EDITVOLUME_SIZE
var R=e("../common/world_constants")
var b=R.ACCESS_ADMIN
var N=R.DEFAULT_ACCESS_VOLUME
var C=R.THRESHOLD_ACCESS_MANAGE_VOLUMES
var x=R.THRESHOLD_ACCESS_MODIFY
var M=R.VOLUME_SETTLEMENT_PREFIX
var D=R.WORLD_SKY_OPTIONS
var P=e("./client_cmds").isElevated
var B=e("./editvolume_clear")
var k=B.editVolumeClearContentsCancel
var U=B.editVolumeClearContentsInProgress
var G=B.editVolumeClearContentsStart
var F=e("./main").charControllerPos
var W=e("./megachunk_client").megaChunkGetNearbyVolumes
var H=e("./user_data")
var z=H.editOutsideVolumeAllowed
var V=H.manageVolumesAllowed
var Y=H.userAccessLevel
var j=e("./voxel_data")
var K=j.localPosFromWorldPos
var q=j.origin_chunk
var Z=j.voxelDataChunkIsReady
var X=j.worldPosFromLocalPos
var Q=e("./world_comm")
var $=Q.getWorldChannel
var J=Q.getWorldID
var ee=e("./world_metadata")
var te=ee.worldAccessExvolume
var re=ee.worldMetadata
var ae=Math.abs,ie=Math.floor,oe=Math.max,ne=Math.round
var se
var le
var _e=[]
var ce
function setEditVolumes(e,t){ce=[]
se=e
le=t
for(var r=0;r<t.length;++r){var a=le[r]
var i=_e[r]
if(!i)i=_e[r]=[E(),E(),false]
K(i[0],a.min)
K(i[1],a.max)
i[2]=a.effective
a.build_allowed=e?a.effective:!a.effective}_e.length=le.length}var ue=E()
function inEditBoundsByChunkId(e){if(le.length){var t=ce[e]
if(void 0!==t)return t
var r=L(e)
m(ue,r,A)
var a=ue[0],i=ue[1],o=ue[2]
for(var n=0;n<le.length;++n){var s=le[n]
if(!s.effective)continue
if(a>=s.min[0]&&a<s.max[0]&&i>=s.min[1]&&i<s.max[1]&&o>=s.min[2]&&o<s.max[2])return ce[e]=se}ce[e]=!se}return!se}function inEditBoundsAndReadyByChunkId(e){return inEditBoundsByChunkId(e)&&Z(e)}function inEditBoundsAndReady(e){var t=e[0]
var r=e[1]
var a=e[2]
var i=ie(t/A)+q[0]
var o=ie(r/A)+q[1]
var n=((ie(a/A)+q[2])*w+o)*w+i
return inEditBoundsByChunkId(n)&&Z(n)}function inEditBounds(e){if(_e.length){var t=e[0]
var r=e[1]
var a=e[2]
var i=ie(t/A)+q[0]
var o=ie(r/A)+q[1]
return inEditBoundsByChunkId(((ie(a/A)+q[2])*w+o)*w+i)}return!se}function editVolumeForPos(e){if(_e.length){var t=e[0]
var r=e[1]
var a=e[2]
for(var i=0;i<_e.length;++i){var o=_e[i]
if(t>=o[0][0]&&t<o[1][0]&&r>=o[0][1]&&r<o[1][1]&&a>=o[0][2]&&a<o[1][2])return le[i]}}return null}function editVolumeDefaultAccess(e){if(e&&e.access){var t=e.access.default_level
if(void 0!==t)return t}return N}function volumeCheckAccess(e,t,r){if(e.access&&e.access.ids&&e.access.ids[t])return e.access.ids[t].level>=r
return editVolumeDefaultAccess(e)>=r}function checkVolumeAccessForPos(e,t){var r=editVolumeForPos(e)
if(r)return volumeCheckAccess(r,i(),t)
return null}function editVolumeCheckAccessForPos(e,t,r){var a=checkVolumeAccessForPos(e,t)
if(null!==a){if(!a)return Y()>=C
return a}return Y()>=r}function hasVolumeAdminAccessForPos(e){var t=checkVolumeAccessForPos(e,b)
if(null!==t)return t
return false}function manageVolumeAllowedForPos(e){var t=editVolumeForPos(e)
if(!t)return null
if(_.ignore_volumes)return t
if("small"===t.volume_id)return null
if(volumeCheckAccess(t,i(),C))return t
if(Y()>=C)return t
return null}function waygateEditAllowedForPos(e){if(_.ignore_volumes)return true
var t=re()
return editVolumeCheckAccessForPos(e,t.access_waygate,oe(t.access_waygate,te()))}function editVolumeById(e){for(var t=0;t<le.length;++t){var r=le[t]
if(r.volume_id===e)return r}return null}function volumeIsSettlement(e){return e.volume_id.startsWith(M)}var de={min:E(),max:E()}
var fe={min:E(),max:E()}
function settlementEstablishAllowed(e,t){if(_.ignore_volumes)return true
if(!le.length)return true
var r=de.min,a=de.max
X(r,e)
u(r,r,c,-O/2)
p(r,1/A)
h(r)
p(r,A)
u(a,r,c,O)
var i=fe.min,o=fe.max
d(i,r)
d(o,a)
u(i,i,c,-A)
u(o,o,c,A)
for(var n=0;n<le.length;++n){var s=le[n]
if(t&&s.volume_id===t)continue
var l=volumeIsSettlement(s)?fe:de
if(S(l,s))return false}return true}var ve
function volumesThatAllow(e){return volumeCheckAccess(e,ve,x)}function volumesThatRestrict(e){return!volumesThatAllow(e)}function filterObjectValues(e,t){var r=[]
for(var a in e){var i=e[a]
i.effective=Boolean(t(i))
r.push(i)}return r}function resetEditVolumes(){setEditVolumes(false,[])}function editVolumesUnrestricted(){return P()||_.ignore_volumes||V()}function editVolumePair(e){var t=W()
if(e)return[false,filterObjectValues(t,n)]
else{var r=!z()
ve=i()
if(r)return[true,filterObjectValues(t,volumesThatAllow)]
else return[false,filterObjectValues(t,volumesThatRestrict)]}}function updateEditVolumes(e){if(!e&&J()){var t=editVolumePair(editVolumesUnrestricted())
setEditVolumes(t[0],t[1])}else setEditVolumes(false,[])}function editVolumeShift(e){for(var t=0;t<_e.length;++t){var r=_e[t]
f(r[0],e)
f(r[1],e)}}function formatVolume(e){return"Id: "+e.volume_id+"    Bounds: ["+e.min+"]-["+e.max+"]"}a.register({cmd:"area_list",help:"(Hidden) List nearby Areas",access_show:["sysadmin"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=W()
function format(e){return formatVolume(r[e])}t(null,Object.keys(r).map(format).join("\n")||"No nearby Areas found")}})
function volumeCurrent(){var e=W()
X(ue,F())
v(ue)
for(var t in e){var r=e[t]
if(y(r,ue))return r}return null}a.register({cmd:"area_current",help:"(Hidden) Display the Area you are standing in, if any",access_show:["sysadmin"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t(null,"Not currently in an Area")
t(null,formatVolume(r))}})
a.register({cmd:"area_delete",help:"Permanently delete the Area you are standing in",access_run:["world_admin"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
$().cmdParse("world_volume_delete "+r.mcid+" "+r.volume_id,t)}})
function editVolumeClearContents(e,r){if(U()){k()
return void r(null,"Existing in-progress clear canceled")}if(!re())return void r("Not currently in a world")
$().cmdParse("world_volume_reset_prep "+e.mcid+" "+e.volume_id,function(e,t){if(e)return void r(e)
G(t,r)})}a.register({cmd:"area_delete_contents",access_run:["sysadmin"],help:"(Admin) Clear the contents (blocks, props, etc) of an Area, or the Area you are standing",prefix_usage_with_help:true,usage:"Usage: /area_delete_contents [area_id]",func:function func(e,t){if(!re())return void t("Not currently in a world")
if(e){var r=editVolumeById(e)
if(!r)return void t("Area not found.")
editVolumeClearContents(r,t)}else{var a=volumeCurrent()
if(!a)return void t("Not currently in an Area")
editVolumeClearContents(a,t)}}})
function editVolumeAddHereCmd(e,t){X(ue,t||F())
v(ue)
e=e||[]
for(var r=0;r<3;++r){var a=e[r]
if(!isFinite(a)||a<A)a=A
e[r]=ie(a/A)*A
ue[r]=ne((ue[r]-e[r]/2)/A)*A}return"world_volume_add "+ue+" "+e}a.register({cmd:"area_add",help:"Add a new Area where you are standing",usage:"$HELP\n  Usage: /area_add [sizeX sizeY sizeZ] (defaults: "+A+")\n  Note: sizes must be a multiple of "+A,access_run:["world_admin"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=editVolumeAddHereCmd(e.split(" ").map(l))
$().cmdParse(r,t)}})
a.register({cmd:"area_access",help:"Set or display the access for the Area you are standing in",usage:"$HELP\nDisplay access list: /area_access\nDisplay access: /area_access (user_id|default)\nSet access: /area_access (user_id|default) level\n  Available levels: DEFAULT, READONLY, BUILDER, ADMIN, OWNER",access_run:["world_areabuilder"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
$().cmdParse("world_volume_access "+r.mcid+" "+r.volume_id+" "+e,t)}})
a.register({cmd:"area_size",help:"Set or display the size of the Area you are standing in",usage:"$HELP\n  Usage: /area_size [sizeX sizeY sizeZ]\n  Note: sizes must be a multiple of "+A+" and no greater than "+T,access_run:["world_admin"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
var a=e.split(" ").map(l)
if(3!==a.length)return void t(null,'Area "'+r.volume_id+'": size '+(r.max[0]-r.min[0])+" "+(r.max[1]-r.min[1])+" "+(r.max[2]-r.min[2]))
var i=[]
for(var o=0;o<3;++o){var n=a[o]
if(!isFinite(n)||n<A||n>T||n%A)return void t("Size in each dimension must a positive multiple of "+A+" no greater than "+T)
i[o]=r.min[o]+n}$().cmdParse("world_volume_bounds "+r.mcid+" "+r.volume_id+" "+r.min+" "+i,t)}})
var he="Usage: /area_shift deltaX deltaY deltaZ"
var pe=256
a.register({cmd:"area_shift",help:"Shift the position of the Area you are standing in",usage:"$HELP\n  "+he+"\n  Note: positions must be a multiple of "+A,access_run:["world_admin"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
var a=e.split(" ").map(l)
if(3!==a.length)return void t(he)
var i=[]
var o=[]
for(var n=0;n<3;++n){var s=a[n]
if(!isFinite(s)||s%A||ae(s)>pe)return void t("Delta in each dimension must a multiple of "+A+" and a magnitude of "+pe+" or less")
o[n]=r.min[n]+s
i[n]=r.max[n]+s}$().cmdParse("world_volume_bounds "+r.mcid+" "+r.volume_id+" "+o+" "+i,t)}})
a.register({cmd:"area_sky",help:"Set or display the sky override for the Area you are standing in",prefix_usage_with_help:true,usage:"Usage: **/area_sky [DEFAULT|SkyName]**\nValid **SkyName**s:\n  "+D.join("\n  "),access_run:["world_areabuilder"],func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in an Area")
$().cmdParse("world_volume_property "+r.mcid+" "+r.volume_id+" sky "+e,t)}})
a.register({cmd:"settlement_unlock",access_run:["sysadmin"],help:"(Admin) Unlock or reset unlocks on a Settlement",usage:"$HELP\n  Usage: /settlement_unlock - lists current unlocks and available unlocks\n  Usage: /settlement_unlock unlock_id|ALL [RESET] - unlocks or resets unlocks",func:function func(e,t){if(!re())return void t("Not currently in a world")
var r=volumeCurrent()
if(!r)return void t("Not currently in a volume")
if(!volumeIsSettlement(r))return void t("Not currently in a Settlement volume")
var a=r.volume_id.slice(M.length)
$().cmdParse("world_settlement_unlock "+r.mcid+" "+a+" "+e,t)}})},{"../common/editvolume_common":242,"../common/globals":248,"../common/megachunk_common":254,"../common/waygate_upgrade_common":266,"../common/world_constants":267,"../glov/client/cmds":298,"../glov/client/net":338,"../glov/client/settings":351,"../glov/common/util":400,"../glov/common/vmath":402,"./client_cmds":43,"./editvolume_clear":83,"./main":135,"./megachunk_client":139,"./user_data":208,"./voxel_data":216,"./world_comm":226,"./world_metadata":235}],85:[function(e,t,r){"use strict"
r.energyWellFixupTimes=energyWellFixupTimes
r.possiblyApplyWaygateSickness=possiblyApplyWaygateSickness
r.energyWellStartup=energyWellStartup
r.energyWellInit=energyWellInit
r.energyWellCharged=energyWellCharged
r.energyWellChargedTime=energyWellChargedTime
r.energyWellReadiness=energyWellReadiness
r.energyWellShouldAutoDrink=energyWellShouldAutoDrink
r.energyWellDrink=energyWellDrink
r.energyWellRun=energyWellRun
r.TIME_REFILL=void 0
var a=300
r.TIME_REFILL=a
var i=3600
var o=28800
var m=e("assert")
var n=e("../glov/client/engine")
var E=e("../glov/client/net").netSubs
var b=e("../glov/client/ui")
var N=e("../glov/client/ui").uiTextHeight
var C=e("../glov/client/walltime")
var x=e("../common/ids").ITEM_ENERGY_WELL
var g=e("./analytics").logEvent
var s=e("./build_mode").doStamina
var M=e("./crafting_mods").CMODS
var l=e("./huds")
var D=l.ATTRIB_BAR_H
var _=l.ATTRIB_BAR_W
var T=l.showStaminaMessage
var P=l.staminaBar
var c=e("./layout")
var B=c.layoutCameraCurX1
var k=c.layoutCameraCurY1
var u=e("./localization/localization")
var d=u.DURATION_ONLY_MINUTES
var U=u.DURATION_WITH_MINUTES
var G=u.L
var f=e("./main").getFrameTransaction
var v=e("./settlement")
var F=v.settlementForPos
var W=v.settlementLastBound
var h=e("./styles")
var H=h.color_green
var z=h.color_stamina_bar
var V=h.color_white
var Y=h.label_style
var j=h.stamina_style
var K=h.sublabel_style
var q=e("./ui_util")
var X=e("./ui_util").STAMINA_SYMBOL
var p=e("./user_data")
var y=p.doWaygateSickness
var Q=p.userAttribGet
var S=p.userAttribModBatched
var I=p.userAttribModMaxBatched
var A=p.userAttribModMaxTrans
var w=p.userAttribModTrans
var L=p.userDataSet
var O=p.userDataSetOnNextAttribFlush
var $=p.userHomeSettlementID
var J=p.userLastEnergyWellTime
var R=p.userLastWaygateTime
var ee=p.userStaminaCur
var te=p.userStaminaMax
var re=p.userStaminaMod
var ae=e("./waygate_ui")
var ie=ae.FONT_HEIGHT
var oe=ae.PAD
var ne=ae.SUBLINE_W
var se=ae.drawHLine
var le=e("./waygate_upgrade")
var _e=le.WAYGATE_SAFE_TIME
var ce=le.WAYGATE_SICKNESS_DURATION
var ue=e("./world_metadata").worldSettlements
var de=e("./worlds_sound").playSound
var fe=Math.max,ve=Math.min,he=Math.floor
m(_)
var pe=[{time:a,label:G.$(G.LBL_REFILL_ENERGY,X)},{time:i,cmod:M.TIMED_STAM_CAPACITY_WELL1,duration:900,label:G.$(G.LBL_OVERFILL_ENERGY,G.separate("",G.addPercentage(25),X),G.duration(900,d))},{time:o,cmod:M.TIMED_STAM_CAPACITY_WELL2,duration:3600,label:G.$(G.LBL_WELL_RESTED,G.separate("",G.addPercentage(50),X),G.duration(3600,d))}]
function energyWellFixupTimes(){if(!s())return
var a
var e=C.seconds()
var i=e-J()
function checkMod(e,t){if(a=Q(e)){var r=t-i
if(a>r+10){r=fe(0,r)
S(e,-(a-r))}}}for(var t=0;t<pe.length;++t){var r=pe[t]
if(r.cmod)checkMod(r.cmod,r.duration)}i=e-R()
checkMod(M.TIMED_STAM_CAPACITY_WGSICK,ce)}function possiblyApplyWaygateSickness(){if(!y())return
var e=R()
var t=C.seconds()
var r=fe(0,t-e)
var a=_e-r
L("wg_time",t)
if(a>0){var i=ve(ce,a)
var o
var n
if(i&&(n=Q(M.TIMED_STAM_CAPACITY_WELL1))){var s=ve(n,i)
i-=s
o=o||f()
w(o,M.TIMED_STAM_CAPACITY_WELL1,-s)}if(i&&(n=Q(M.TIMED_STAM_CAPACITY_WELL2))){var l=ve(n,i)
i-=l
o=o||f()
w(o,M.TIMED_STAM_CAPACITY_WELL2,-l)}if(i>Q(M.TIMED_STAM_CAPACITY_WGSICK)){o=o||f()
A(o,M.TIMED_STAM_CAPACITY_WGSICK,i)}}}var me
var Ee
function energyWellStartup(){me=b.font
Ee=q.sprite}function energyWellInit(){}function energyWellCharged(e){if(ue()){var t=F(e.getLocalPos())
if(!t||t!==W())return false
if(e.item_id===x&&!t.unlocked_ids[x])return false}var r=J()
var a=C.seconds()
return fe(0,a-r)>=pe[0].time}function energyWellChargedTime(e){var t=J()
var r=C.seconds()
var a=fe(0,r-t)
return fe(pe[0].time-a,0)}var ge
var Te
function energyWellReadiness(){if(n.frame_index===Te)return ge
if(!s())ge=2
else{var e=J()
var t=C.seconds()
var r=fe(0,t-e)
for(var a=ge=0;a<pe.length;++a)if(r>=pe[a].time)ge=a+1}Te=n.frame_index
return ge}function energyWellShouldAutoDrink(e){return s()&&energyWellCharged(e)&&ee()/te()<.25}function energyWellDrink(){var e=C.seconds()
var t=J()
var r=te()-ee()
var a=t?fe(0,e-t):-1
var i=energyWellReadiness()-1
var o=pe[i]
m(o)
O("well_time",e)
for(var n=0;n<i;++n){var s=pe[n]
if(s.cmod){var l=Q(s.cmod)
if(l)S(s.cmod,-l)}}var _=true
if(o.cmod)for(var c=i+1;c<pe.length;++c){var u=pe[c]
if(u.cmod){var d=Q(u.cmod)
if(d)if(d>o.duration)_=false
else S(u.cmod,-d)}}if(o.cmod&&_){var f=o.duration
var v=Q(M.TIMED_STAM_CAPACITY_WGSICK)
if(v){var h=ve(f,v)
S(M.TIMED_STAM_CAPACITY_WGSICK,-h)
f-=h}if(f)I(o.cmod,f)}var p=te()-ee()
if(p){T(G.$(G.STATUSMSG_ENERGY_WELL_ADD,""+p+X))
re(null,p)}de("energy_well_drink")
E().serverLog("energy_well_drink",{time_since_last_drink:a,delta:p,missing:r})
g("energy_well_drink",a,null,null,{delta:p,missing:r})}var ye=100
var Se=.667*ye
var Ie=254
var Ae=900
function pad2(e){return("0"+e).slice(-2)}function hms(e){var t=he(e/3600)
var r=he((e-=60*t*60)/60)
e-=60*r
var a=[]
if(t)a.push(t)
a.push(pad2(r),pad2(e))
return a.join(":")}var we=Ae/2
var Le=2*D
function energyWellRun(e,t,r,a,i){var o=Z.UI
var n=B()-e
var s=k()-t
var l=e+n/2
var _=t+8
if(!i&&ue()){var c=r&&F(r.getLocalPos())
if((!c||c!==W())&&!("default"===(null==a?void 0:a.wgid)&&"default"===$())){me.drawSizedAligned(Y,e,t,Z.UI+21,2*N(),me.ALIGN.HVCENTERFIT,n,s,G.ENERGYWELL_WITHIN_SETTLEMENT)
return}if(r.item_id===x&&!c.unlocked_ids[x]){me.drawSizedAligned(Y,e,t,Z.UI+21,2*N(),me.ALIGN.HVCENTERFIT,n,s,G.FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK)
return}}var u=J()
var d=C.seconds()
var f=fe(0,d-u)
if(u){me.drawSizedAligned(K,e,_,o,ie,me.ALIGN.HCENTERFIT,n,0,G.$(G.ENERGYWELL_LAST_DRINK,G.duration(f,U)))
_+=ie+oe}var v=l-Ie/2
var h=0
var p=true
var m=0
for(var E=0;E<pe.length;++E){var g=pe[E]
if(!g.text_width)g.text_width=me.getStringWidth(Y,ie,g.label)
var T=f>=g.time
var y=l-g.text_width/2-(Se+oe)
Ee.draw({x:y,y:_,z:o,w:Se,h:Se,frame:T?q.CHECK:q.TIME,color:T?H:V})
if(T){++h
m=g.duration}var S=y+Se+oe
me.drawSizedAligned(T?Y:K,S,_,o,ie,me.ALIGN.HFIT|me.ALIGN.VCENTER,B()-oe-S,Se,g.label)
_+=Se+oe
var I=pe[E+1]
if(!(I&&f>=I.time)){var A=ve(f/g.time,1)
if(A<.015)A=0
if(!T)A=ve(A,.98)
var w={x:l-we/2,y:_,z:o,w:we,h:Le,progress:A,color:p?z:[.5,.5,.5,1]}
b.progressBar(w)
me.drawSizedAligned(T?K:j,w.x,w.y,o+2,T?.5*Le:.8*Le,me.ALIGN.HVCENTERFIT,w.w,w.h,T?G.ENERGYWELL_READY:hms(g.time-f))
_+=Le+oe
if(I)se(l,_,ne)}p=T}var L=te()
var O=ee()
var R=false
if(!h){_+=oe
me.drawSizedAligned(K,e,_,o,ie,me.ALIGN.HCENTERFIT,n,0,G.ENERGYWELL_RECHARGING)
_+=ie+oe
R=true}else if(i){_+=oe
me.drawSizedAligned(K,e,_,o,ie,me.ALIGN.HCENTERFIT,n,0,G.ENERGYWELL_MUST_VISIT)
_+=ie+oe
R=true}else if(O===L&&(1===h||!u)){_+=oe
me.drawSizedAligned(K,e,_,o,ie,me.ALIGN.HCENTERFIT,n,0,G.$(G.ENERGYWELL_FULL,X))
_+=ie+oe
R=true}else if(h>1&&Q(M.TIMED_STAM_CAPACITY_WGSICK)){_+=oe
if(m>Q(M.TIMED_STAM_CAPACITY_WGSICK))me.drawSizedAligned(K,e,_,o,ie,me.ALIGN.HCENTERFIT,n,0,G.ENERGYWELL_CANCEL_SICKNESS_SOME)
else me.drawSizedAligned(K,e,_,o,ie,me.ALIGN.HCENTERFIT,n,0,G.ENERGYWELL_CANCEL_SICKNESS)
_+=ie+oe}if(b.buttonText({x:v,y:_,z:o,w:Ie,h:ye,font_height:ie,disabled:R,text:G.BTN_DRINK}))energyWellDrink()
me.drawSizedAligned(K,e,_=850,o,ie,me.ALIGN.HCENTERFIT,n,0,G.$(G.LBL_CURRENT_ENERGY,X))
P({x:l-Ae/2,y:_+=ie+oe,z:o,w:Ae,h:2*D,font_height:ie,always_show:{stamina:true},verbose:true,attrib_filter:/^t_stamcap/})}},{"../common/ids":249,"../glov/client/engine":305,"../glov/client/net":338,"../glov/client/ui":367,"../glov/client/walltime":370,"./analytics":6,"./build_mode":33,"./crafting_mods":67,"./huds":104,"./layout":120,"./localization/localization":131,"./main":135,"./settlement":181,"./styles":197,"./ui_util":205,"./user_data":208,"./waygate_ui":222,"./waygate_upgrade":223,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],86:[function(e,t,r){"use strict"
r.entFactory=entFactory
r.entityTraitsClientStartup=entityTraitsClientStartup
var a=e("../glov/client/webfs").webFSAPI
var i=e("../glov/common/trait_factory").traitFactoryCreate
var o=e("../glov/common/util").plural
var n=e("../common/entity_traits_common").entityTraitsCommonStartup
var s=e("./client_entities").getEntityManager
var l=e("./entity_worlds_client").EntityWorldsClient
var _=e("./status").statusPush
var c
function entFactory(){return c}function onEntDefReload(t){var e=s().entitiesReload(function(e){return e.type_id===t})
if(e.length)_("Reloaded "+e.length+' "'+t+'" '+o(e.length,"ent"))}function entityTraitsClientStartup(){c=i()
n(c)
c.registerTrait("ai_wander",{properties:{do_ai:true}})
c.initialize({name:"EntityWorldsClient",fs:a(),directory:"entities",ext:".entdef",Ctor:l,reload_cb:onEntDefReload})}},{"../common/entity_traits_common":245,"../glov/client/webfs":371,"../glov/common/trait_factory":398,"../glov/common/util":400,"./client_entities":44,"./entity_worlds_client":87,"./status":193}],87:[function(e,t,r){"use strict"
r.EntityWorldsClient=r.ENTITY_DEBUG_SKIP=r.ENT_DELETE_FADE_TIME=void 0
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var a=250
r.ENT_DELETE_FADE_TIME=a
var i=e("assert")
var o=e("../glov/client/entity_base_client").EntityBaseClient
var n=e("../common/entity_worlds_common").entityWorldsCommonClass
var s=e("./ai").resetMoveTime
var l={entity_manager:true,draw_data:true,data_overrides:true}
r.ENTITY_DEBUG_SKIP=l
var _=function(r){_inheritsLoose(EntityWorldsClient,r)
function EntityWorldsClient(e){var t;(t=r.call(this,e)||this).draw_data=void 0
t.next_move_time=void 0
t.my_activate_time=void 0
t.waiting=void 0
t.home_point=void 0
t.my_activate_time=-Infinity
t.waiting=false
s(_assertThisInitialized(t),true)
return t}var e=EntityWorldsClient.prototype
e.onDelete=function onDelete(e){return a}
e.applyAIMove=function applyAIMove(e){var t=this
i(!this.waiting)
this.waiting=true
this.applyBatchUpdate({field:EntityWorldsClient.AI_MOVE_FIELD,action_id:"ai_move",data_assignments:{pos:e}},function(e){if(e);t.waiting=false})}
return EntityWorldsClient}(n(o));(r.EntityWorldsClient=_).AI_MOVE_FIELD="seq_ai_move"
_.prototype.do_ai=false},{"../common/entity_worlds_common":246,"../glov/client/entity_base_client":307,"./ai":5,assert:void 0}],88:[function(e,t,r){"use strict"
r.environmentsWorldsInit=environmentsWorldsInit
var o=e("../glov/client/client_config").MODE_PRODUCTION
var n=e("../glov/client/cmds").cmd_parse
var s=e("../glov/client/environments").environmentsInit
var l=e("../glov/client/urlhash").getURLBase
var a=e("../common/globals")
var i=a.ENV_LOCAL
var _=a.ENV_PRODUCTION
var c=a.ENV_STAGING
var u=a.ENV_TEST
var d=a.ENV_TEST2
var f=e("./platform_worlds_client").PLATFORM_DISCORD
var v=[{name:u,link_base:"https://worlds.test.frvr.com/",other_hosts:["https://1207715694842613851.discordsays.com/"],use_frvr_prod_api:false},{name:d,link_base:"https://worlds.test2.frvr.com/",use_frvr_prod_api:false},{name:c,link_base:"https://worlds.staging.frvr.com/",other_hosts:["https://1207717984135680071.discordsays.com/"],use_frvr_prod_api:false},{name:_,link_base:"https://worlds.frvr.com/",other_hosts:["https://1205582362897809492.discordsays.com/"],use_frvr_prod_api:true},{name:i,link_base:"http://localhost:3000/",other_hosts:["https://1239613582115737600.discordsays.com/","https://localhost:3100/","https://localhost/"],use_frvr_prod_api:false}]
function environmentsWorldsInit(){var e
var t=null!=(e=window.conf_env)?e:""
if(!t){t=null
var r=l()
for(var a=0;a<v.length;a++){var i=v[a]
if(i.link_base===r||i.other_hosts&&i.other_hosts.includes(r)){t=i.name
break}}}if(o&&f&&!t)t=_
if(f)v.forEach(function(e){e.api_path=l()+"api/"})
s(v,n,t)}},{"../common/globals":248,"../glov/client/client_config":297,"../glov/client/cmds":298,"../glov/client/environments":310,"../glov/client/urlhash":369,"./platform_worlds_client":160}],89:[function(e,t,r){"use strict"
r.ExternalUsersClientApple=void 0
var a=e("../../frvr/client/xplay/signin_with_apple/ios")
var i=a.isAvailable
var n=a.isLogged
var o=a.logout
var s=a.promptLogin
var l=e("../../glov/common/external_users_common").ERR_UNAUTHORIZED
var _=e("../../glov/common/types").isDataObject
var c=e("../../glov/common/util").errorString
var u=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_APPLE
var d=e("../platform_worlds_client").PLATFORM_IOS
var f=function(){function ExternalUsersClientApple(){this.user_id=""
this.user_display_name=""}var e=ExternalUsersClientApple.prototype
e.getProvider=function getProvider(){return u}
e.enabled=function enabled(){return d&&i()}
e.loggedIn=function loggedIn(){return Boolean(this.user_id)}
e.logIn=function logIn(e,r){var a=this
var i=e.user_initiated
var o=function handleResult(e,t){a.user_display_name=""
if(e){r(c(e))
return}if(!(_(t)&&t.userIdentifier&&"string"===typeof t.userIdentifier&&t.token&&"string"===typeof t.token&&t.code&&"string"===typeof t.code&&t.nonce&&"string"===typeof t.nonce)){r(l)
return}a.user_id=t.userIdentifier
if(_(t.user)&&"string"===typeof t.user.name)a.user_display_name=t.user.name
r(null,{provider:u,external_id:a.user_id,validation_data:JSON.stringify({token:t.token,code:t.code,nonce:t.nonce})})}
n(function(e,t){if(i&&(e||!t))s(o)
else o(e,t)})}
e.logOut=function logOut(){this.user_id=""
this.user_display_name=""
o()}
e.getCurrentUser=function getCurrentUser(e){e(null,{external_id:this.user_id,name:this.user_display_name})}
return ExternalUsersClientApple}()
r.ExternalUsersClientApple=f},{"../../common/external_users/external_users_provider_ids":247,"../../frvr/client/xplay/signin_with_apple/ios":285,"../../glov/common/external_users_common":387,"../../glov/common/types":399,"../../glov/common/util":400,"../platform_worlds_client":160}],90:[function(e,t,r){"use strict"
r.ExternalUsersClientFacebookGaming=void 0
var n=e("assert")
var a=e("../../frvr/client/xplay/facebook/facebook")
var s=a.getAuthToken
var i=a.graphAPI
var o=a.isAvailable
var l=a.login
var _=a.logout
var c=e("../../glov/common/external_users_common").ERR_UNAUTHORIZED
var u=e("../../glov/common/types").isDataObject
var d=e("../../glov/common/util").errorString
var f=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_GAMING
function mapToUserInfo(e){n(u(e))
var t=e.id
n(t&&"string"===typeof t)
var r
if("string"===typeof e.name)r=e.name
var a
if("string"===typeof e.email)a=e.email
var i
var o=u(e.picture)&&u(e.picture.data)&&e.picture.data.url
if("string"===typeof o)i=o
return{external_id:t,name:r,profile_picture_url:i,email:a}}var v=function(){function ExternalUsersClientFacebookGaming(){this.user_id=""}var e=ExternalUsersClientFacebookGaming.prototype
e.getProvider=function getProvider(){return f}
e.enabled=function enabled(){return Boolean(o())}
e.loggedIn=function loggedIn(){return Boolean(this.user_id)}
e.logIn=function logIn(e,r){var a=this
var i=e.user_initiated
var o=function handleResult(e,t){if(e){r(d(e))
return}if(!(u(t)&&t.userID&&"string"===typeof t.userID&&t.token&&"string"===typeof t.token)){r(c)
return}a.user_id=t.userID
r(null,{provider:f,external_id:a.user_id,validation_data:JSON.stringify({token:t.token,signed_player_info:t.signedRequest})})}
s(function(e,t){if(i&&(e||!t))l(["gaming_profile","email","user_friends"],o)
else o(e,t)})}
e.logOut=function logOut(){if(this.loggedIn()){this.user_id=""
_()}}
e.getCurrentUser=function getCurrentUser(r){i("/me",void 0,{fields:"id,name,picture,email"},function(e,t){if(e)r(d(e))
else r(null,mapToUserInfo(t))})}
e.getFriends=function getFriends(r){i("/me/friends",void 0,{fields:"id,name,picture"},function(e,t){if(e)r(d(e))
else r(null,u(t)&&Array.isArray(t.data)?t.data.map(mapToUserInfo):[])})}
return ExternalUsersClientFacebookGaming}()
r.ExternalUsersClientFacebookGaming=v},{"../../common/external_users/external_users_provider_ids":247,"../../frvr/client/xplay/facebook/facebook":277,"../../glov/common/external_users_common":387,"../../glov/common/types":399,"../../glov/common/util":400,assert:void 0}],91:[function(e,t,r){"use strict"
r.ExternalUsersClientFacebookInstant=void 0
var a=e("assert")
var i=e("../../glov/common/external_users_common")
var o=i.ERR_NOT_AVAILABLE
var n=i.ERR_UNAUTHORIZED
var s=e("../../glov/common/util").unpromisify
var l=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_INSTANT
var _=e("../fbinstant_worlds").fbGetRoomCurrentMatch
var c=e("../frvr_sdk_worlds").frvrOnInitialized
function mapToUserInfo(e){var t=e.getID()
a(t)
return{external_id:t,name:e.getName()||void 0,profile_picture_url:e.getPhoto()||void 0}}var u=0
var d=function(){function ExternalUsersClientFacebookInstant(){}var e=ExternalUsersClientFacebookInstant.prototype
e.getProvider=function getProvider(){return l}
e.enabled=function enabled(){return Boolean(window.FBInstant)}
e.loggedIn=function loggedIn(){return Boolean(window.FBInstant&&FBInstant.player&&FBInstant.player.getID())}
e.logIn=function logIn(e,i){i=s(i)
if(!this.enabled()){i(n)
return}c(function(e){if(!e){i(o)
return}var a=FBInstant.player.getID()
if(!a){i(n)
return}FBInstant.player.getSignedPlayerInfoAsync().then(function(e){var r=null==e?void 0:e.getSignature()
if(u){--u
i("ERR_ONCE_FBI")
return}if(!r){i(n)
return}FBInstant.player.getSignedASIDAsync().then(function(e){var t=e.getASID()
if(!t){i(n)
return}i(null,{provider:l,external_id:a,validation_data:JSON.stringify({signed_player_info:r,signed_asid:e.getSignature(),asid:t})})},i)},i)})}
e.logOut=function logOut(){}
e.getCurrentUser=function getCurrentUser(e){e(null,mapToUserInfo(FBInstant.player))}
e.getFriends=function getFriends(t){t=s(t)
FBInstant.player.getConnectedPlayersAsync().then(function(e){t(null,e?e.map(mapToUserInfo):[])},t)}
e.getPartyId=function getPartyId(e){var t=_()
if(!t){e()
return}var r=t.getContextID()
a(r)
e(null,r)}
return ExternalUsersClientFacebookInstant}()
r.ExternalUsersClientFacebookInstant=d},{"../../common/external_users/external_users_provider_ids":247,"../../glov/common/external_users_common":387,"../../glov/common/util":400,"../fbinstant_worlds":96,"../frvr_sdk_worlds":102,assert:void 0}],92:[function(e,t,r){"use strict"
r.ExternalUsersClientFRVR=r.LOCAL_STORAGE_AUTH_EXTERNAL_PROVIDER=r.LOCAL_STORAGE_AUTH_TOKENS_KEY=void 0
var c=e("assert")
var i=e("../../frvr/client/frvr_auth_service").AuthService
var o=e("../../glov/client/environments").getCurrentEnvironment
var a=e("../../glov/client/local_storage")
var n=a.localStorageGet
var u=a.localStorageGetJSON
var d=a.localStorageSet
var h=a.localStorageSetJSON
var p=e("../../glov/common/util").errorString
var s=e("../../common/external_users/external_users_provider_ids")
var m=s.USERS_PROVIDER_APPLE
var E=s.USERS_PROVIDER_DISCORD
var g=s.USERS_PROVIDER_FACEBOOK_GAMING
var T=s.USERS_PROVIDER_FACEBOOK_INSTANT
var y=s.USERS_PROVIDER_FRVR
var S=e("../../common/in_app_purchases/iap_common").ERR_INVALID_DATA
var l=e("../platform_worlds_client").PLATFORM_DISCORD
var I="frvr_auth_tokens"
r.LOCAL_STORAGE_AUTH_TOKENS_KEY=I
var A="frvr_auth_external_provider"
r.LOCAL_STORAGE_AUTH_EXTERNAL_PROVIDER=A
var w="frvr_display_name"
var L=0
var _=function(){function ExternalUsersClientFRVR(){this.auth_service=void 0
this.display_name=void 0
this.last_was_production=false
this.login_data_provider=void 0
this.display_name=n(w)}var e=ExternalUsersClientFRVR.prototype
e.getAuthService=function getAuthService(){var e=o()
var t=Boolean(e&&e.use_frvr_prod_api)
if(!this.auth_service||this.last_was_production!==t){var r
var a=t?"":"staging"
if(l)r="/"+a+"crucible-frvr/v1/auth"
else r="https://"+a+(a?".":"")+"crucible.frvr.com/v1/auth"
this.auth_service=new i(r)
this.last_was_production=t}return this.auth_service}
e.getProvider=function getProvider(){return y}
e.enabled=function enabled(){return true}
e.loggedIn=function loggedIn(){return Boolean(u(I))}
e.setLoginDataProvider=function setLoginDataProvider(e){this.login_data_provider=e}
e.logIn=function logIn(e,a){var f=this
var t=u(I)
var r=e.email,i=e.password,o=e.do_creation,n=e.creation_display_name
var s=false
var v=function handleSignInResult(e,t,r){if(L){--L
t="ERR_ONCE_FRVR"}if(t&&s){d(I,null)
d(A,null)}if(t||!r)return a(p(t))
h(I,r)
if(!s)if(null!=e&&e.provider)h(A,null==e?void 0:e.provider)
else d(A,null)
if(n){f.display_name=n
d(w,n)}a(null,{provider:y,validation_data:r.accessToken})}
var l=function handleSignUpResult(e){if(e||!r||!i)return a(p(e))
c("string"===typeof n)
f.display_name=n
d(w,n)
return f.getAuthService().signInWithFRVR({email:r,password:i},v.bind(f,null))}
var _=function handleLoginData(e,t){if(e){var r=v.bind(f,e)
if(e.provider===g&&e.external_id&&e.validation_data){var a=JSON.parse(e.validation_data),i=a.signed_player_info,o=a.token
var n={asid:e.external_id,signedRequest:i,token:o}
return f.getAuthService().signInWithFacebookWeb(n,r)}if(e.provider===T&&e.external_id&&e.validation_data){var s=JSON.parse(e.validation_data),l=s.signed_player_info,_=s.signed_asid
var c={asid:s.asid,asidSignedRequest:_,playerId:e.external_id,playerIdSignedRequest:l}
return f.getAuthService().signInWithFacebookInstant(c,r)}if(e.provider===m&&e.validation_data){var u=JSON.parse(e.validation_data)
var d={identityToken:u.token,code:u.code,nonce:u.nonce}
return f.getAuthService().signInWithApple(d,r)}if(e.provider===E&&e.validation_data)return f.getAuthService().signInWithDiscord(e.validation_data,r)}t()}
return _(e.external_login_data,function(){if(o&&r&&i){c.equal(typeof n,"string")
return f.getAuthService().signUpWithFRVR({email:r,password:i},l)}if(r&&i)return f.getAuthService().signInWithFRVR({email:r,password:i},v.bind(f,null))
if(f.login_data_provider)return f.login_data_provider.getLoginData(function(e,t){if(e)return a(e)
c(t)
_(t,function(){return a(S)})})
if(t&&t.refreshToken){s=true
return f.getAuthService().refreshAccessToken(t.refreshToken,v.bind(f,null))}return a(S)})}
e.logOut=function logOut(){h(I,null)
d(A,null)}
e.getCurrentUser=function getCurrentUser(e){e(null,{external_id:"",name:this.display_name})}
e.sendActivationEmail=function sendActivationEmail(e,t){return this.getAuthService().sendActivationEmail(e,function(e){if(e)return t(e)
return t(null)})}
e.sendRecoverEmail=function sendRecoverEmail(e,t){return this.getAuthService().sendRecoverEmail(e,function(e){if(e)return t(e)
return t(null)})}
e.checkEmailVerified=function checkEmailVerified(r){var e=u(I)
if(e&&e.refreshToken)return this.getAuthService().checkEmailVerified(e.refreshToken,function(e,t){if(e||!t)return r(e)
return r(null,t.verified)})
r("ERR_MISSING_AUTH_TOKENS")}
return ExternalUsersClientFRVR}()
r.ExternalUsersClientFRVR=_},{"../../common/external_users/external_users_provider_ids":247,"../../common/in_app_purchases/iap_common":250,"../../frvr/client/frvr_auth_service":269,"../../glov/client/environments":310,"../../glov/client/local_storage":329,"../../glov/common/util":400,"../platform_worlds_client":160,assert:void 0}],93:[function(e,t,r){"use strict"
r.ExternalUsersClientDiscord=void 0
var s=e("assert")
var a=e("../../glov/common/external_users_common")
var l=a.ERR_NOT_AVAILABLE
var _=a.ERR_UNAUTHORIZED
var i=e("../../glov/common/util").unpromisify
var c=e("../../common/external_users/external_users_provider_ids").USERS_PROVIDER_DISCORD
var o=e("../../common/platform_worlds_common").WorldsPlatform
var u=e("../frvr_sdk_worlds").frvrOnInitialized
var n=e("../platform_worlds_client").PLATFORM_DISCORD
function isAvailable(){var e,t,r,a
if("undefined"===typeof FRVR)return false
if(null!=(e=FRVR.channel)&&e.getId)return FRVR.channel.getId()===o.Discord
return null==(t=window)?void 0:null==(r=t.location)?void 0:null==(a=r.host)?void 0:a.endsWith("discordsays.com")}var d=function(){function ExternalUsersClientDiscord(){}var e=ExternalUsersClientDiscord.prototype
e.getProvider=function getProvider(){return c}
e.enabled=function enabled(){return n&&isAvailable()}
e.loggedIn=function loggedIn(){var e
return Boolean(window.discordSDK&&(null==(e=FRVR.auth)?void 0:e.isLoggedIn()))}
e.getLoginData=function getLoginData(n){u(function(e){var t,r,a,i
if(!e){n(l)
return}var o=null==(t=FRVR.auth)?void 0:t.getCredentials()
s(o,"credentials needed")
if(!o.discord||!o.frvr){n(_)
return}n(null,{provider:c,external_id:null==(r=FRVR.profile)?void 0:r.id(),validation_data:JSON.stringify({accessToken:null==(a=FRVR.auth)?void 0:a.tokenHandler.getAccessToken(),refreshToken:null==(i=FRVR.auth)?void 0:i.tokenHandler.getRefreshToken()})})})}
e.logIn=function logIn(e,t){s(false,"Login call not allowed as already handled by FRVR SDK")}
e.logOut=function logOut(){s(false,"Logout not allowed in this platform")}
e.getCurrentUser=function getCurrentUser(e){s(FRVR.profile)
s(FRVR.auth)
e(null,{external_id:FRVR.profile.id(),name:FRVR.profile.name(),profile_picture_url:FRVR.profile.image()})}
e.getFriends=function getFriends(e){(e=i(e))(null,[])}
e.getPartyId=function getPartyId(t){t=i(t)
u(function(){var e
null==(e=FRVR.social)||e.platform.getContextId().then(function(e){if(!e){t()
return}t(null,e)})})}
return ExternalUsersClientDiscord}()
r.ExternalUsersClientDiscord=d},{"../../common/external_users/external_users_provider_ids":247,"../../common/platform_worlds_common":257,"../../glov/common/external_users_common":387,"../../glov/common/util":400,"../frvr_sdk_worlds":102,"../platform_worlds_client":160,assert:void 0}],94:[function(e,t,r){"use strict"
r.externalUsersWorldsStartup=externalUsersWorldsStartup
var s=e("../../glov/client/external_users_client").externalUsersSetup
var a=e("../platform_worlds_client")
var l=a.PLATFORM_DISCORD
var _=a.PLATFORM_FBINSTANT
var c=a.PLATFORM_IOS
var u=e("./external_users_client_apple").ExternalUsersClientApple
var d=e("./external_users_client_facebook_gaming").ExternalUsersClientFacebookGaming
var f=e("./external_users_client_facebook_instant").ExternalUsersClientFacebookInstant
var v=e("./external_users_client_frvr").ExternalUsersClientFRVR
var h=e("./external_users_client_frvrsdk_discord").ExternalUsersClientDiscord
function externalUsersWorldsStartup(){var e=[]
var t
var r=new v
var a=r.getProvider()
var i=a
e.push(r)
if(_){var o=new f
e.push(o)
t=o.getProvider()}else if(l){var n=new h
e.push(n)
t=r.getProvider()
r.setLoginDataProvider(n)
a=i=void 0}else{e.push(new d)
if(c)e.push(new u)}s(e,t,i,a)}},{"../../glov/client/external_users_client":312,"../platform_worlds_client":160,"./external_users_client_apple":89,"./external_users_client_facebook_gaming":90,"./external_users_client_facebook_instant":91,"./external_users_client_frvr":92,"./external_users_client_frvrsdk_discord":93}],95:[function(e,t,r){"use strict"
r.factoryUIStartup=factoryUIStartup
r.factoryUIInit=factoryUIInit
r.factoryGetProgressEstimator=factoryGetProgressEstimator
r.factoryCraftingInProgress=factoryCraftingInProgress
r.drawZoomed=drawZoomed
r.doFactoryUI=doFactoryUI
r.FACTORY_STALLED=r.FACTORY_ACTIVE=r.FACTORY_PAUSED=r.FACTORY_MAX_OUTPUT=r.FACTORY_MAX_INPUT=void 0
var de=8
r.FACTORY_MAX_INPUT=de
var a=6
r.FACTORY_MAX_OUTPUT=a
var fe=0
r.FACTORY_PAUSED=fe
var ve=1
r.FACTORY_ACTIVE=ve
var he=2
r.FACTORY_STALLED=he
var pe=e("assert")
var u=e("../glov/client/camera2d")
var i=e("../glov/client/cmds").cmd_parse
var me=e("../glov/client/engine")
var F=e("../glov/client/input")
var y=e("../glov/client/net").netSubs
var Ee=e("../glov/client/scroll_area").scrollAreaCreate
var ge=e("../glov/client/settings")
var W=e("../glov/client/ui")
var o=e("../glov/client/ui")
var D=o.buttonImage
var Te=o.buttonText
var H=o.drawHBox
var ye=o.drawLine
var Se=o.drawRect
var z=o.menuUp
var V=o.panel
var Ie=o.progressBar
var p=o.button
var Ae=o.uiButtonHeight
var n=o.uiGetFont
var s=o.uiGetTitleFont
var Y=o.uiTextHeight
var l=e("../glov/client/walltime")
var _=e("../glov/common/rand_alea")
var c=_.randCreate
var d=_.shuffleArray
var f=e("../glov/common/util")
var we=f.clamp
var b=f.easeIn
var m=f.empty
var Le=f.lerp
var Oe=e("../common/globals").STACK_SIZE
var v=e("../common/ids")
var h=v.ITEM_ORE
var E=v.TYPE_CRAFT_CLASS
var g=e("../common/materials_common").CraftClass
var T=e("./app_access").accessPrerelease
var S=e("./build_mode").addToBagSplatter
var I=e("./crafting").sourceMatches
var j=e("./crafting_mods").CMODS
var A=e("./crafting_recipes").getRecipesForFactory
var w=e("./inventory")
var L=e("./inventory")
var O=L.INV_PLAYER
var R=L.canDrop
var K=L.canFit
var Re=L.canFitPartial
var N=L.inventoryGet
var C=L.inventoryGetSize
var x=L.inventoryGetSizeMax
var P=L.inventoryLocked
var M=L.transInvAdd
var B=L.transInvClear
var k=L.transInvDec
var U=e("./inventory_ui")
var G=U.ACCEPT_HIGHLIGHT
var q=U.ACCEPT_NO
var X=U.ACCEPT_OK
var be=U.INVTYPE_CONTAINER
var Q=U.INVTYPE_MAIN
var $=U.ITEM_PAD
var J=U.QUICKBAR_VIEW_BORDER_PAD
var Ne=U.canEquipFromContainer
var ee=U.ctxTrans
var te=U.doInventorySetupContext
var re=U.doInventorySub
var Ce=U.doInventorySubOneItem
var xe=U.drawItemCount
var Me=U.equipFromContainer
var ae=U.inventoryAnimate
var ie=U.inventoryButton
var De=U.inventoryButtonPrep
var Pe=U.inventoryDeselect
var oe=U.inventoryMerge
var ne=U.inventorySwap
var se=U.inventoryUIInit
var Be=U.inventoryUITick
var ke=U.mapInvPos
var Ue=U.quickTransferContainer
var Ge=e("./item_info_view").itemInfoViewShow
var le=e("./items")
var Fe=le.ITEM_CONTEXT_ITEM
var We=le.createItem
var _e=le.itemFullyMergeable
var ce=le.itemPartiallyMergeable
var ue=le.itemPotentiallyMergeable
var He=le.sameItem
var ze=e("./layout")
var Ve=ze.WIDE
var Ye=ze.layoutCameraCurX1
var je=ze.layoutCameraCurY1
var Ke=ze.layoutCameraTallWide
var qe=ze.layoutCameraTallWideMode
var Ze=e("./localization/localization").L
var Xe=e("./main")
var Qe=Xe.getFrameTransaction
var $e=Xe.menuConsumeExit
var Je=Xe.menuExit
var et=e("./materials").MATERIAL_INGOT_SCALE
var tt=e("./menu")
var rt=tt.PANEL_PAD
var at=tt.gameModeWatermark
var it=tt.menuInteractGetProp
var ot=tt.panel_color
var nt=e("./props").PIEB_CHECK_ROOT
var st=e("./red_dot")
var lt=st.redDotIsSeen
var _t=st.redDotSeen
var ct=e("./settlement").settlementForPos
var ut=e("./status")
var dt=e("./styles")
var ft=dt.color_black
var vt=dt.color_green
var ht=dt.color_locked_fade
var pt=dt.color_red
var mt=dt.color_yellow
var Et=dt.colors_green
var gt=dt.colors_red
var Tt=dt.inventory_style
var yt=dt.label_style
var St=dt.menu_header_style
var It=dt.refreshing_style
var At=dt.style_mode_label
var wt=dt.style_progress_label
var Lt=dt.style_rarity
var Ot=dt.sublabel_style
var Rt=e("./todo_list")
var bt=Rt.TODO_TOGGLE
var Nt=Rt.todoDone
var Ct=Rt.todoIsInList
var xt=Rt.todoListActive
var Mt=Rt.todoListAdd
var Dt=Rt.todoTooltip
var Pt=e("./tutorial").tutorialHook
var Bt=e("./ui_util")
var kt=e("./user_data").worldReadOnly
var Ut=e("./voxel_data").transPropUpdateField
var Gt=e("./world_metadata").worldSettlements
var Ft=Math.ceil,Wt=Math.floor,Ht=Math.max,zt=Math.min,Vt=Math.random,Yt=Math.round
var jt
var Kt
var qt
ge.register({crafting_time_scale:{default_value:1,type:i.TYPE_FLOAT,range:[0,1e3],access_run:["sysadmin"]}})
function factoryUIStartup(){jt=n()
Kt=s()
qt=Bt.sprite}var Zt=1
var Xt=false
var Qt=0
var $t=1
var Jt
var er=0
function factoryUIInit(){se()
Jt=Qt
er=0}function secondsTimeNowInt(){return Ft(l()/1e3)-1577836800}function secondsTimeNow(){return l()/1e3-1577836800}function isInputScaledCount(e,t){if(e===E)if(t===g.FUEL)return true
else if(t===g.SCALED_INGOT)return true
return false}function inputScaleCount(e,t,r,a){if(t===E)if(r===g.FUEL)e=zt(e*a.getFuelRate(),Oe)
else if(r===g.SCALED_INGOT)e=Yt(e*(et[a.getMaterial()]||1))
return e}function inputCountPer(e,t){pe(e)
pe(t)
var r=e[0]
return inputScaleCount(r,e[1],e[2],t)}function factoryFitsInSlot(e,t,r){return I(e.recipe,t,r)}function acceptsItemFactory(e,t,r){var a
var i
if(t.type===be&&t.idx<de){if(!r.inv){if(!t.inv){for(var o=0;o<C(O);++o)if(factoryFitsInSlot(e,t.idx,N(o)))return G
var n=e.prop
for(var s=de+Zt;s<n.container_size;++s)if(factoryFitsInSlot(e,t.idx,n.contents[s]))return G}return q}a=t
i=r}else if(r.type===be&&r.idx<de){if(!t.inv){if(!Xt&&t.type===be)return q
return X}a=r
i=t}if(a)if(factoryFitsInSlot(e,a.idx,i.inv))return G
else return q
if(!Xt){if(t.type===be&&r.type===Q)return q
if(t.type===Q&&r.type===be&&t.inv){if(r.inv&&ce(t.inv,r.inv))return X
return q}}return X}function quickTransferFactory(e,t,r,a){var i=e.prop,o=e.recipe
pe(t.type===Q||t.type===be&&t.idx>=de)
var n=o.inputs
for(var s=0;s<n.length;++s)if(!i.contents[s]&&I(o,s,r)){if(1===(a=zt(a,Oe)))a=inputCountPer(n[s].source,r)
oe(e,{type:be,idx:s},t,a)
return true}for(var l=0;l<n.length;++l){var _=i.contents[l]
if(_)if(ue(_,r)){var c=ce(_,r)
if(c){if(1===a){var u=inputCountPer(n[l].source,_)
var d=_.count%u
c=zt(c,u-d)}else c=zt(a,c)
oe(e,{type:be,idx:l},t,c)}return true}}if(!isFinite(a))for(var f=0;f<n.length;++f)if(i.contents[f])if(I(o,f,r)){ne(e,{type:be,idx:f},t)
return true}return false}function quickTransferFactoryThenContainer(e,t,r,a){if(quickTransferFactory(e,t,r,a))return true
return Ue(e,t,r,a)}function findOutputSlot(e,t){if(!e.contents[de]||_e(e.contents[de],t))return de
if(!He(e.contents[de],t)&&!(t&&t.ignore_take))return-1
for(var r=de;r<e.container_size;++r)if(e.contents[r]&&_e(e.contents[r],t))return r
for(var a=de;a<e.container_size;++a)if(!e.contents[a])return a
return-1}function canEject(e){if(R())return true
var t=e.container_size
var r=[]
e:for(var a=0;a<de+Zt;++a){var i=e.contents[a]
if(!i)continue
var o=-1
for(var n=de+Zt;n<t;++n){if(r[n])continue
if(!e.contents[n])o=n
else if(_e(e.contents[n],i)){r[n]=true
continue e}}for(var s=0;s<x(O);++s){var l=t+s
if(r[l])continue
var _=N(s)
if(!_)o=l
else if(_e(_,i)){r[l]=true
continue e}}if(-1===o)return false
r[o]=true}return true}function factoryPause(e){var t=e.prop
var r=ee(e)
Ut(r,t,"fs","factory_state",fe)
Ut(r,t,"ft","factory_time",0)
delete t.factory_time_high}function factoryStall(e){var t=e.prop
var r=ee(e)
Ut(r,t,"fs","factory_state",he)
Ut(r,t,"ft","factory_time",0)
delete t.factory_time_high}function toItemIDs(e){return e.type+","+e.id+","+(e.attr1||0)+","+(e.attr2||0)+","+(e.attr3||0)}function inputsKey(e){return e.map(toItemIDs).join()}function factoryStart(e,t){var r=e.prop
var a=secondsTimeNowInt()
if(r.factory_state!==ve||r.factory_time!==a){var i=ee(e)
Ut(i,r,"fs","factory_state",ve)
Ut(i,r,"ft","factory_time",a)}r.factory_time_high=secondsTimeNow()
r.factory_input_key=inputsKey(t)}function getUnlockedRecipesForFactory(e){var t=A(e.item_id)
var r=e.getLocalPos()
var a=ct(r)
var i={}
var o=0
var n={}
for(var s in t){var l=t[s]
if(l.next_release&&!T())continue
else if(!l.is_settlement_locked||a&&a.allowsRecipe(s)||!Gt())i[s]=l
else if(l.is_settlement_locked)if(a&&a.allowsRecipeSoon(s))n[s]=l
else o++}return[i,o,n]}function setRecipe(s,e){var l=s.prop
var _=ee(s)
var c=false
function ejectInput(e){var t=l.contents[e]
var r=-1
var a=t.count
for(var i=de+Zt;i<l.container_size;++i){var o=l.contents[i]
if(o){var n=ce(o,t)
if(n){oe(s,{type:be,idx:i},{type:be,idx:e},n)
if(!(a-=n))return}}else if(-1===r)r=i}if(-1!==r){ne(s,{type:be,idx:e},{type:be,idx:r})
return}pe(t.count===a)
B(_,l,e)
if(K(t))M(_,O,t)
else{S(_,w.getDropPos(),{cost:[t]},true,true)
c=true}}var t=getUnlockedRecipesForFactory(l)[0][e]
pe(t)
Ut(_,l,"fr","factory_recipe",e)
factoryPause(s)
for(var r=0;r<de+Zt;++r)if(l.contents[r]&&(r>=t.inputs.length||!I(t,r,l.contents[r])))ejectInput(r)
if(c)ut.push(Ze.STATUSMSG_SOME_ITEMS_DROPPED)
l.transBusy(_)}function checkInputs(e){var t=e.prop,r=e.recipe
var a=r.inputs
var i=true
var o=[]
var n=Infinity
for(var s=0;s<a.length;++s){var l=a[s].source
var _=t.contents[s]
if(_&&I(r,s,_)){var c=inputCountPer(l,o[s]=_)
var u=Wt(_.count/c)
n=zt(n,u)}else{i=false
n=0}}var d
var f=false
if(i){f=-1!==findOutputSlot(t,d=r.output(o,true,t))
if(me.DEBUG&&d)if(d.id!==h){pe(d.is_crafted)
var v=d.getCraftCost()
pe(v)
pe(v.length)}if(!d)n=0}if(n&&r.needs_finish)n=1
return{all_inputs_satisfied:i,output_preview:d,output_allowed:f,satisfied_inputs:o,count_craftable:n}}var tr
function factoryCreateOutputs(e,t,r,a){var i=e.prop,o=e.recipe
var n=t.satisfied_inputs,s=t.count_craftable
pe(s)
tr=null
var l
var _
var c
var u
for(_=0;_<r;++_){var d=o.output(n,false,i)
var f=findOutputSlot(i,d)
if(-1===f)break
c=f
if(!me.defines.NO_CRAFT_OUTPUT){l=l||ee(e)
M(l,i,d,f)
if(!u)u=d.toTransLog()}if(!d.isAllowedInInventoryAndReleased())y().serverLog("crafted_illegal_item",{satisfied_inputs:n,output_actual:d,recipe:{name:o.name,at_factory:o.at_factory}})
tr={item:d,prop:i,idx:f}
if(me.defines.NO_CRAFT_OUTPUT)return true}if(!_)return false
l.opStat("craft_total",_)
l.opStat("craft:"+u,_)
Nt(tr.item,Fe)
if(o.icon)Nt(o.icon.recipe_item,Fe)
var v=o.inputs
for(var h=0;h<v.length;++h){var p=v[h].source
var m=p[0]*_
var E=p[1]
var g=p[2]
var T=i.contents[h]
if(T){if(a)ae(T,be+","+h,be+","+c)
if(1===(m=inputScaleCount(m,E,g,T))&&!T.stackable)B(l,i,h)
else k(l,i,h,m)}}return _===r}var rr
function factoryUpdate(e){var t=e.prop,r=e.recipe
if(!r)return
var a=rr>=me.frame_index-1
rr=me.frame_index
if(P(t))return
var i=checkInputs(e)
var o=i.satisfied_inputs,n=i.count_craftable,s=i.output_allowed,l=i.output_preview
var _=t.factory_state
if(_===he||_===ve)if(!n||!l||!s){factoryPause(e)
_=t.factory_state}else{var c=inputsKey(o)
if(!t.factory_input_key)t.factory_input_key=c
if(t.factory_input_key!==c)if(a){factoryStart(e,o)
_=t.factory_state}else t.factory_input_key=c}var u=t.factory_time
if(_===he){if(!r.needs_finish)if(factoryCreateOutputs(e,i,1,a))factoryStart(e,o)}else if(_===ve){var d=me.defines.NO_CRAFT_OUTPUT?1:r.time(o)/ge.crafting_time_scale
var f=Ht(0,secondsTimeNow()-u-er)
var v=Wt(f/d)
Pt("crafting_"+l.type+"_"+l.id)
Nt(r.icon.recipe_item,Fe)
if(v)if(r.needs_finish)factoryStall(e)
else if(!factoryCreateOutputs(e,i,zt(v,n),a))factoryPause(e)
else if(v===n)factoryPause(e)
else{var h=ee(e)
Ut(h,t,"ft","factory_time",u+d*v)}}else if(_===fe)if(n&&l&&s)factoryStart(e,o)}function estimateProgress(){var e=this
var t=e.factory_time,r=e.needed_time,a=e.base_count,i=e.count_craftable,o=e.output_preview
var n=Ht(0,secondsTimeNow()-t-er)/r
var s=Wt(n)
var l=n-s
var _=a+i
var c=a+s*o.count
var u=c<_
_=zt(_,Oe)
if((c=zt(c,_))===_)l=1
return{ready:c,total:_,partial:l,is_running:u}}function estimateProgressStalled(){var e=this.base_count
return{ready:e,total:e,partial:1}}function factoryGetProgressEstimator(e){var t=e.factory_state
var r=0
var a=e.contents[de]
if(a){r=a.count
if(t===fe)return{base_count:r,output_preview:a,estimateProgress:estimateProgressStalled}}if(t===fe)return null
var i=A(e.item_id)
if(!i)return null
var o=i[e.factory_recipe]
if(!o)return null
var n=checkInputs({prop:e,recipe:o})
var s=n.count_craftable,l=n.satisfied_inputs,_=n.output_preview
if(!s)return null
pe(_)
if(t===he)return{base_count:r+1,output_preview:_,estimateProgress:estimateProgressStalled}
pe.equal(t,ve)
return{factory_time:e.factory_time,needed_time:me.defines.NO_CRAFT_OUTPUT?1:o.time(l)/ge.crafting_time_scale,base_count:r,count_craftable:s*_.count,output_preview:_,estimateProgress:estimateProgress}}function factoryCraftingInProgress(e){return e.factory_state!==fe||e.contents[de]}function drawZoomed(e,t,r,a,i,o,n,s,l,_,c,u){if(String(c)===String(u))e=0
a=jt.styleAlpha(a,zt(2*e,1))
r=jt.styleAlpha(r,1-e)
var d=b(1-e,2)
var f=1+d
if(l===jt.ALIGN.HWRAP){var v=s
if(u){var h=[]
var p=0
var m=t.wrapLines(a,_,16,s,u,0,function(e,t,r,a){h.push([e,t*s,r])
p=Ht(p,a)})
var E=m*s
var g=p*f
var T=E*f
var y=i-p*d*.5
var S=o-E*d*.5
for(var I=0;I<h.length;++I){var A=h[I]
var w=A[0]/p
var L=A[1]/E
t.drawSized(a,y+w*g,S+L*T,n+1,s*f,A[2])}v=Ht(v,m*s)}if(c)v=Ht(v,t.drawSizedWrapped(r,i,o,n,_,16,s,c))
return v}else{if(e){var O=i-d*_*.5
var R=o-d*s*.5
t.drawSizedAligned(a,O,R,n+1,s*f,l,_*f,0,u)}if(c)t.drawSizedAligned(r,i,o,n,s,l,_,0,c)
return s}}var ar=8
var ir=36
var or=c(Wt(4294967295*Vt()))
var nr
var sr
function factoryAnimateFinished(C,x,M,e){sr=me.frame_index
var D=[]
var t=We(e)
var r=C.attribs||{}
var a=t.attribs=t.attribs||{}
for(var i in a)if(!r[i])delete a[i]
var o=We(t)
for(var n in r){if(n===j.RARITY)continue
var s=a[n]||0
var l=r[n]||0
pe(s<=l)
while(s<l){++s
D.push(n)}}d(or,D)
o.attribs=o.attribs||{}
if(r[j.RARITY]){var _=r[j.RARITY]
o.attribs[j.RARITY]=1;--_
var c=D.length
while(_){D.splice(c,0,j.RARITY);--_
c=Ft(c/2)}}var P=o
var B=o
var k=0
var U=Infinity
var G=false
function run(e){sr=me.frame_index
if(!He(x.contents[M],C)&&!me.defines.NO_CRAFT_OUTPUT){nr=null
return}var t=0
if(!G){if((U+=me.frame_dt)>1e3){U=0
if(k===D.length){G=true
P=B}else{P=We(B)
var r=D[k++]
B.attribs[r]=(B.attribs[r]||0)+1
if(D[k]&&D[k]===j.RARITY){r=D[k++]
B.attribs[r]=(B.attribs[r]||0)+1}B=We(B)}}t=U/1e3}var a=Z.MODAL+5
var i=100
var o=1e3-2*i
var n=1e3-1.5*i
var s=i
var l=i/2
var _=l
at(s+o,l+n,a-.5)
var c=Ae()
var u={x:s+c,y:l-rt+16,z:a-5,w:o-2*c,h:Ae()}
var d=Y()
Kt.drawSizedAligned(St,u.x+8,u.y,u.z+2,2*d,jt.ALIGN.HVCENTERFIT,u.w-16,u.h,Ze.LBL_CRAFTING_COMPLETE)
H(u,W.sprites.tab,ot)
l+=Ae()+ar
var f=200
var v=2*d
var h=36
ie({x:s+(o-f)/2,y:l,z:a+2,w:f,h:f,dynamic_snapshot:true,ignore_no_spin:true,draw_only:true,base_name:"inv_info",shrink:.921,item_context:Fe},B)
l+=f+8
drawZoomed(t,Kt,Lt[P.getRarity()],Lt[B.getRarity()],s,l,a,v,jt.ALIGN.HCENTERFIT,o,P.getName(),B.getName())
var p=.382*o
ye(s+o/2-p/2,l+=v+4,s+o/2+p/2,l,a,1,1,ft)
l+=4
var m=P.getDesc()
var E=B.getDesc()
for(var g=0;g<m.length;++g)if(m[g]===E[g+1])m.splice(g,0,"")
var T=s+.1*o
var y=.8*o
for(var S=0;S<E.length;++S)l+=drawZoomed(t,jt,Tt,Tt,T,l,a,h,jt.ALIGN.HWRAP,y,m[S],E[S])+4
l=_+n-Ae()-ar
var I=Ne(C),A=I.can_possibly_equip,w=I.can_equip,L=I.should_equip
var O=A?3:2
var R=(o-(O+1)*ar)/O
var b=s+ar
function button(e,t){var r=Te({x:b,y:l,z:a,w:R,font_height:ir,text:e,disabled:t,base_name:t||G?void 0:"inv_empty"})
b+=R+ar
return r}if(button(Ze.BTN_OK)||$e())nr=null
var N=false
if(button(Ze.BTN_TAKE,!K(C)||L)){Ue(e,{type:be,idx:M},C,1)
nr=null
N=true}if(A)if(button(Ze.BTN_EQUIP,!w)&&!N){Me(e,{type:be,idx:M})
nr=null}if(!G&&F.click()){G=true
P=B=C}V({x:s-rt,y:_+Ae()-rt,z:a-5,w:o+2*rt,h:n-Ae()+2*rt,color:ot})
if(F.click())nr=null
if(nr)z()}nr={prop:x,run:run}}var lr=100
var _r=320
var cr=.667*lr
var ur=1e3-(2*lr+$)
var dr=475
var fr=ur
var vr=610
var hr=.618*(fr-lr-ar)
var pr=100
var mr=pr
var Er=30
var gr=24
var Tr=36
var yr=4
var Sr=8
var Ir=36
var Ar=2*lr
var wr=4
var Lr
var Or
function doFactoryUI(e){var ae=it()
if(!ae||!ae.isFactory()||!ae.inEditBounds(nt)){Je()
return Ze.LBL_MISSING_PROP}var t=Ye()
var r=je()
var ie=Z.UI
var oe=qe()===Ve
var ne=P(ae)
var a=Y()
if(ne){Se(0-J,e-J,t+J,r,Z.UI+20,ht)
jt.drawSizedAligned(It,0,e,Z.UI+21,2*a,jt.ALIGN.HVCENTERFIT,t,r-e,Ze.FACTORY_REFRESHING_CONTENTS)
return Ze.LBL_REFRESHING_FACTORY}if(ae.inv.is_settlement_locked&&Gt()){var i=ct(ae.getLocalPos())
if(!i||!i.allowsItem(ae.item_id)){jt.drawSizedAligned(yt,0,e,Z.UI+21,2*a,jt.ALIGN.HVCENTERFIT,t,r-e,i?Ze.FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK:Ze.MSG_OUT_OF_SETTLEMENT_ALERT)
return ae.inv.getName({no_material:true})}}var o=getUnlockedRecipesForFactory(ae),M=o[0],v=o[1],h=o[2]
if(!M||m(M)){jt.drawSizedAligned(yt,0,e,Z.UI+21,2*a,jt.ALIGN.HVCENTERFIT,t,r-e,Ze.FACTORY_NO_RECIPES_AVAILABLE)
return ae.inv.getName({no_material:true})}Pt("factory_"+ae.item_id)
if((!ae.factory_recipe||!M[ae.factory_recipe])&&Jt===Qt){var n=Object.keys(M)
if(1===n.length&&!kt()){var s=Qe()
Ut(s,ae,"fr","factory_recipe",n[0])
ae.transBusy(s)
Jt=Qt}else Jt=$t}var se=M[ae.factory_recipe]
var le=te({prop:ae,recipe:se})
if(nr)if(nr.prop!==ae||sr!==me.frame_index-1)nr=null
else{u.setAspectFixed(1e3,1e3)
nr.run(le)
Ke()}if(!ne)factoryUpdate(le)
var _e=ae.factory_state
var ce=2*a
var ue=me.DEBUG&&false
function doInput(e,t,r,a){var i
if(ue)Se(e,t,e+r,t+a,ie,[1,0,0,.25])
var o=e
var n=t
qt.draw({x:o,y:n,z:ie,w:cr,h:cr,frame:Bt.INPUT})
if(oe)o+=cr+ar
else n+=cr+ar
var s=false
if(Gt())for(var l in M)if(!lt("w_r_"+l)){s=true
break}var _=o
var c=n
o+=lr+ar
if(!oe){n=t
o=e+cr+ar}var u=se?se.name:Ze.LBL_NO_RECIPE_SELECTED
var d=Kt.drawSized(St,o,n,ie,ce,Ze.separateColon(Ze.LBL_RECIPE,""))
var f=o+d+ce
if(se&&se.icon){var v={x:o+d,y:n,z:ie,w:ce,h:ce,item_context:Fe}
De(v,se.icon)
v.img.draw(v)}var h=.75*Ae()
var p=e+r-h-ar
Kt.drawSizedAligned(St,f,n,ie,ce,jt.ALIGN.HFIT,p-f-4,0,u)
var m=F.click({x:o,y:n,w:p-o,h:ce})
if(null!=(i=se.icon)&&i.recipe_item&&xt()&&D({x:p,y:n,z:ie,w:h,h:h,img:Bt.sprite,frame:Ct(se.icon.recipe_item,Fe)?Bt.PINNED:Bt.PIN,tooltip:Dt(se.icon.recipe_item,Fe)}))Mt(se.icon.recipe_item,Fe,bt)
ye(o,n+=ce+4,o+hr,n,ie,1,1,ft)
n+=16
if(D({x:_,y:c,z:ie,img:qt,frame:ge.split_factory?Bt.CRAFTING:Bt.SETTINGS,w:lr,h:lr,hook:s?"false":void 0})||m)if(canEject(ae))Jt=$t
else ut.push(Ze.STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE)
o=e
var E=se.inputs
for(var g=0;g<E.length;++g){var T=E[g]
jt.drawSizedAligned(Tt,o,n,ie+1,Er,jt.ALIGN.HCENTERFIT,r,0,T.name)
n+=Er
var y=(r-pr)/2
var S=T.source
var I=S[0]
var A=S[1]
var w=S[2]
var L=S[3]
if(!S.menu_inv_item){S.menu_inv_item=We({type:A,id:w,count:I,attr1:L})
S.menu_inv_item.show_count=true}var O=S.menu_inv_item
var R=false
var b=false
var N=ae.contents[g]
if(N){R=true
I=inputScaleCount(I,A,w,N)
if(N.count<I)b=true}var C={ctx:le,inv_type:be,ii:g,x:o+y,y:n,z:ie+1,slot_w:pr,no_quickbar:true,quick_transfer_cb:Ue,accepts_item_cb:acceptsItemFactory,empty_inv:O,allow_empty_select:true,count_override:N?Ze.$(Ze.FORMAT_FRACTION,N.count||0,I):isInputScaledCount(A,w)?Ze.$(Ze.FORMAT_FRACTION,0,Ze.$(Ze.FORMAT_NUMBER_OR_MORE,I)):Ze.$(Ze.FORMAT_FRACTION,0,I),label_style:At}
if(b)C.colors=gt
if(Ce(C)&&!ae.contents[g])Ge({x:C.x+C.slot_w+24,y:0,inv:O,context:Fe,auto_close:true})
if(!R||!C.draw_inv_item){C.frame=Bt.QUESTION_MARK
C.z=ie+4
C.color=W.button_last_color
C.w=C.h=C.slot_w
qt.draw(C)}var x=void 0
if(C.draw_inv_item&&N)x=N.getName()
else x=O.getName()
jt.drawSizedAligned(Ot,o,n+pr,ie+1,gr,jt.ALIGN.HCENTERFIT,r,0,x)
n+=mr+gr+16}}function doOutput(e,t,r,a){if(ue)Se(e,t,e+r,t+a,ie,[0,1,0,.25])
var i=checkInputs(le)
var o=i.satisfied_inputs,n=i.count_craftable,s=i.output_preview,l=i.output_allowed
var _=[]
var c
var u
var d={z:ie+2,w:Ar,h:Ar,item_context:Fe}
var f
var v
var h=ae.contents[de]
var p=false
var m=0
var E=0
if(h){p=true
var g=h
u=g.getName()
if(s&&s.getName()===u){var T
if((null==(T=se.icon)?void 0:T.count)>1)u=Ze.$(Ze.LBL_OUTPUT_MULTIPLE,u,se.icon.count)}De(d,g)
f=g.getDesc()
v=255
var y=Re(h)
if(!y)_.push(Ze.FACTORY_FULL_INVENTORY)
if(n&&l){if(_e===fe&&!ne){factoryStart(le,o)
_e=ae.factory_state}E=(m=h.count)+n*s.count}else if(s&&!n){if(He(s,g));else if(y)_.push(Ze.FACTORY_CRAFTING_COMPLETE)}else if(s&&n&&!l)if(y)_.push(Ze.FACTORY_CRAFTING_COMPLETE)}else if(s){var S
u=s.getName()
if((null==(S=se.icon)?void 0:S.count)>1)u=Ze.$(Ze.LBL_OUTPUT_MULTIPLE,u,se.icon.count)
d.count_override=0
d.force_show_count=true
E=n*s.count
De(d,s)
f=s.getDesc()
v=255
if(n&&l){if(_e===fe&&!ne){factoryStart(le,o)
_e=ae.factory_state}}else if(n&&!l)if(se.needs_finish)c=Ze.ERR_CRAFTING_CANNOT_COMPLETE
else c=Ze.ERR_CRAFTING_STALLED
else c=Ze.ERR_INSUFFICIENT_RESOURCES}else{u=se.unknown_name||se.name
if(se.icon){De(d,se.icon)
if(se.icon.count>1)u=Ze.$(Ze.LBL_OUTPUT_MULTIPLE,u,se.icon.count)}else{d.img=qt
d.frame=Bt.QUESTION_MARK}f=[se.desc]
v=1077952767
c=n?Ze.ERR_INVALID_INPUT:Ze.ERR_INSUFFICIENT_RESOURCES}var I=0
var A
var w
var L
var O
var R=true
if(_e===ve){var b=me.defines.NO_CRAFT_OUTPUT?1:se.time(o)/ge.crafting_time_scale
var N=secondsTimeNow()
var C=Ht(0,N-ae.factory_time)
var x=N-ae.factory_time_high
if(x<2)C=Le(x/2,x,C)
A=b-C
I=we(C/b,.004,1)
L=_.length?mt:vt}else if(_e===he&&!c){var M
pe(se.needs_finish)
pe(!_.length)
d.count_override=(null==(M=se.icon)?void 0:M.count)||1
L=_.length?mt:vt
c=Ze.FACTORY_PROGRESS_READY
O=true}else if(_e===he)L=mt
else if(!p){pe(c)
L=pt}if(c)w=c
else if(E){E=zt(Oe,E)
m=zt(m,E)
w=Ze.$(Ze.FORMAT_CRAFTING_PROGRESS,Ze.$(Ze.FORMAT_FRACTION,m,E),Ze.addPercentage((100*I).toFixed(0)))}else w=Ze.addPercentage((100*I).toFixed(0))
if(O)R=false
else if(p&&!I)R=false
var D=t
var P=e
qt.draw({x:P,y:D,z:ie,w:cr,h:cr,frame:Bt.OUTPUT})
var B=t+.618*(vr-2*ar)
if(oe)ye(e,t+cr+ar,e,B,ie,1,1,ft)
var k=r-((P+=cr+ar)-e+ar)
Kt.drawSizedAligned(St,P,D,ie,ce,jt.ALIGN.HFIT,k,0,u)
ye(P,D+=ce+4,P+.618*(r-(P-e)),D,ie,1,1,ft)
D+=4
var U=2*wr+Ir
var G=e+r-ar-P
if(R){Ie({x:P,y:D+=ar,z:ie+1,w:G,h:U,color:L,progress:I})
jt.drawSizedAligned(wt,P,D,ie+3,Ir,jt.ALIGN.HVCENTERFIT,G,U,w)
D+=U+ar}var F=P+Ar+8
var W=e+r-F
var H=D
d.x=P
d.y=D
d.img.draw(d)
if(h)xe(h,d)
else if(s)xe(s,d)
else{var z
if((null==(z=se.icon)?void 0:z.count)>1)xe(se.icon,d)
d.frame=Bt.QUESTION_MARK
qt.draw(d)}d.x+=(d.w-pr)/2
d.y+=(d.w-pr)/2
d.w=pr
ke(be+","+de,d)
d=null
D+=8
var V=Ae()
var Y=t+a-V-ar
if(!Or)Or=Ee({z:ie,background_color:null,auto_hide:true})
var j={x:F,y:D,w:W,h:Y-D}
Or.begin(j)
W-=Or.barWidth()
for(var K=D=0;K<f.length;++K)D+=jt.drawSizedColorWrapped(Tt,0,D,ie+1,W,16,Tr,v,f[K])+yr
if(f.length)D+=Sr
if(s&&s.craft_warning&&!h)D+=jt.drawSizedColorWrapped(Tt,0,D,ie+1,W,16,Tr,2151678207,s.craft_warning)+Sr
Or.end(D)
D=j.y+zt(j.h,D)
D=Ht(D,H+Ar+8)
var q=e+r-P
if(_.length)for(var Z=0;Z<_.length;++Z){if(D+Tr>=Y&&(O||p))break
D+=jt.drawSizedColorWrapped(Tt,P,D,ie+1,q,16,Tr,2147483903,_[Z])+Sr}var X=1
var Q=P
function finishButton(e,t){var r=(G-ar*(X-1))/X
var a=Te({x:Q,y:D,z:ie+1,w:r,h:V,text:e,font_height:ir,disabled:t,colors:t?void 0:Et})
Q+=r+ar
return a}if(O||p){D=zt(Ht(B-V,D),Y)
if(O){if(finishButton(Ze.BTN_FINISH))if(factoryCreateOutputs(le,i,1,true)){factoryStart(le,o)
factoryAnimateFinished(tr.item,tr.prop,tr.idx,s)}}else if(p){var $=Ne(h),J=$.can_possibly_equip,ee=$.can_equip,te=$.should_equip
X=J?2:1
var re=false
Pt("available_to_take_"+h.type+"_"+h.id)
if(finishButton(Ze.BTN_TAKE,!Re(h)||te)){re=true
Nt(h,Fe)
if(se.icon)Nt(se.icon.recipe_item,Fe)
Ue(le,{type:be,idx:de},h)}if(J)if(finishButton(Ze.BTN_EQUIP,!ee)&&!re){Nt(h,Fe)
if(se.icon)Nt(se.icon.recipe_item,Fe)
Me(le,{type:be,idx:de})}D+=V}}else if(L===vt&&A>5&&D+Ir<t+a)jt.drawSizedAligned(yt,P,D,ie+3,Ir,jt.ALIGN.HVCENTERFIT,G,U,Ze.FACTORY_CRAFTING_IN_PROGRESS)}function doOutputInventory(e,t,r,a){if(ue)Se(e,t,e+r,t+a,ie,[0,1,1,.25])
if(!oe)e-=cr+ar
var i=Xt
for(var o=de+Zt;o<ae.contents.length;++o)if(ae.contents[o]){i=true
break}if(i)qt.draw({x:e,y:t,z:ie,w:cr,h:cr,frame:Bt.CONTAINER})
re({ctx:le,inv_type:be,start_idx:de+Zt,no_quickbar:true,final:false,sortable:false,x0:e+cr+ar,y:t,z:ie,scale:1,quick_transfer_cb:quickTransferFactoryThenContainer,accepts_item_cb:acceptsItemFactory,skip_empty:!Xt})}function doInventory(e,t,r,a){if(ue)Se(e,t,e+r,t+a,ie,[0,0,1,.25])
qt.draw({x:e,y:t,z:ie,w:cr,h:cr,frame:Bt.INVENTORY})
var i=e+cr+ar
ye(i,t,i+.618*(e+r-i),t,ie,1,1,ft)
re({ctx:le,inv_type:Q,no_quickbar:true,final:true,no_buttons:true,sortable:true,x0:i,y:t+ar,z:ie,scale:1,quick_transfer_cb:quickTransferFactory,quick_transfer_label:Ze.TLTP_ADD_TO_RECIPE,quick_transfer_label_one:Ze.TLTP_ENOUGH_FOR_ONE,accepts_item_cb:acceptsItemFactory})}function doRecipeList(e,t,r,a){if(Te({x:e,y:t,z:ie,text:"←",font_height:.75*lr,w:lr,h:lr,disabled:!ae.factory_recipe})||ae.factory_recipe&&F.keyDownEdge(F.KEYS.BACKSPACE)){Pe(le)
Jt=Qt}var i=e+lr+ar
var o=t
Kt.drawSizedAligned(St,i,o,ie,ce,jt.ALIGN.HFIT,r-(i-e+ar),0,Ze.separateColon(ae.inv.getName({no_material:true}),Ze.LBL_SELECT_RECIPE))
ye(i,o+=ce+4,i+hr,o,ie,1,1,ft)
o+=4
if(!Lr)Lr=Ee({z:Z.UI,background_color:null,auto_hide:true})
var n=false
var s=e+1e3-i-_r-ar-24
if(oe&&!me.DEBUG)s+=600
var l={x:i,y:o,w:r-i,h:a-o}
Lr.begin(l)
function drawRecipe(e,t){var r=i
var a={x:r,y:o,z:ie,font_height:Ir,w:_r,h:Ae(),text:e.name,tooltip:null,hook:t&&Gt()&&"w_r_"+t,disabled:!t,item_context:Fe}
if(e.icon){De(a,e.icon)
if(e.icon.count>1)xe(e.icon,a)}if(p(a)&&!n){if(ae.factory_recipe!==t)if(canEject(ae))setRecipe(le,t)
else ut.push(Ze.STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE)
Pe(le)
Jt=Qt
n=true}r+=_r+ar
jt.drawSizedAligned(t?yt:Ot,r,o,ie,Ir,jt.ALIGN.VCENTER|jt.ALIGN.HFIT,s,Ae(),t?e.desc:Ze.RECIPELIST_UPGRADE_SETTLEMENT_TO_UNLOCK)
o+=Ae()+4}var _=o=i=0
for(var c in M){++_
drawRecipe(M[c],c)}var u=0
for(var d in h){++u
drawRecipe(h[d],null)}if(Gt()){o+=.75*Ae()
if(v){jt.drawSizedAligned(Ot,i,o,ie,Ir,jt.ALIGN.HCENTERFIT,l.w-l.x,0,m(h)?Ze.RECIPELIST_UNLOCK_MORE_BY_UPGRADING:Ze.RECIPELIST_EVEN_MORE_FROM_LATER_UPGRADES)
o+=Ir+4}var f=_+u+v
jt.drawSizedAligned(yt,i,o,ie,Ir,jt.ALIGN.HCENTERFIT,l.w-l.x,0,_===f?Ze.RECIPELIST_ALL_UNLOCKED_FOR_STATION:Ze.RECIPELIST_AMOUNT_UNLOCKED.$({val:_,total:f}))
o+=Ir+4
o+=.75*Ae()}Lr.end(o)
o=l.y+l.h}if(Jt===Qt){_t("w_r_"+ae.factory_recipe)
if(oe){doInput(0,e,fr,vr)
doOutput(fr,e,ur,dr)
doOutputInventory(fr,e+dr,ur,vr-dr)
var l=e+vr
doInventory(0,l,t,r-l)}else{doInput(0,e,fr,vr)
var _=e+vr
doOutput(0,_,ur,dr)
doOutputInventory(ur,_,t-ur,dr)
var c=_+dr
doInventory(0,c,t,r-c)}}else if(Jt===$t)doRecipeList(0,e,t,r)
if(le.trans){factoryUpdate(le)
le.trans.silent_error=true
le.trans.onComplete(function(e){if(e)er+=.5
else er=0})}Be()
return ae.inv.getName({no_material:true})}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/settings":351,"../glov/client/ui":367,"../glov/client/walltime":370,"../glov/common/rand_alea":395,"../glov/common/util":400,"./app_access":12,"./build_mode":33,"./crafting":66,"./crafting_mods":67,"./crafting_recipes":68,"./inventory":114,"./inventory_ui":115,"./item_info_view":117,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./materials":137,"./menu":140,"./props":171,"./red_dot":176,"./settlement":181,"./status":193,"./styles":197,"./todo_list":202,"./tutorial":203,"./ui_util":205,"./user_data":208,"./voxel_data":216,"./world_metadata":235,assert:void 0}],96:[function(e,t,r){"use strict"
r.canFollowOfficialPage=canFollowOfficialPage
r.canJoinOfficialGroup=canJoinOfficialGroup
r.fbGetRoomCurrentMatch=fbGetRoomCurrentMatch
r.fbIsTournamentActive=fbIsTournamentActive
r.fbGetTournamentData=fbGetTournamentData
r.fbCreateTournament=fbCreateTournament
r.fbLeaveTournament=fbLeaveTournament
r.loadWorldImage=loadWorldImage
r.clearModalDialogAfter=clearModalDialogAfter
r.fbShareUserLink=fbShareUserLink
r.fbShareWorldLink=fbShareWorldLink
r.fbShareWorld=fbShareWorld
r.fbPostPassiveToContext=fbPostPassiveToContext
r.updateSessionData=updateSessionData
r.fbInviteAsync=fbInviteAsync
r.fbInviteCreateAsync=fbInviteCreateAsync
r.fbShareBlueprintLink=fbShareBlueprintLink
r.fbShareBlueprint=fbShareBlueprint
r.fbSharePhoto=fbSharePhoto
r.fbSharePhotoLink=fbSharePhotoLink
r.fbCreateRaceTournament=fbCreateRaceTournament
r.fbPostSessionScoreAsync=fbPostSessionScoreAsync
r.fbLeaveWorldsTournament=fbLeaveWorldsTournament
r.fbFollowOfficialPage=fbFollowOfficialPage
r.fbJoinOfficialGroup=fbJoinOfficialGroup
r.fbCanInvite=fbCanInvite
r.fbCanShare=fbCanShare
r.fbCanShareLink=fbCanShareLink
r.fbInstantPostStart=fbInstantPostStart
r.fbInstantPostInit=fbInstantPostInit
var a=e("../glov/client/client_config")
var i=a.platformOverrideID
var o=a.setAbilityChat
var n=e("../glov/client/engine")
var s=e("../glov/client/environments").getExternalTextureURL
var l=e("../glov/client/error_report").errorReportSetDynamicDetails
var _=e("../glov/client/local_storage")
var c=e("../glov/client/localization").getStringFromLocalizable
var u=e("../glov/client/net").netUserId
var d=e("../glov/client/social").getExternalUserInfos
var f=e("../glov/client/sound").soundPause
var v=e("../glov/client/ui")
var h=e("../glov/client/urlhash")
var p=e("../glov/common/util")
var m=p.merge
var E=p.nop
var g=p.once
var T=p.unpromisify
var y=e("../common/external_users/external_users_provider_ids.js").USERS_PROVIDER_FACEBOOK_INSTANT
var S=e("../common/platform_worlds_common").WorldsPlatform
var I=e("../common/waygate_common.js").waygateImagePath
var A=e("./analytics.js")
var w=A.analyticsOn
var L=A.logEvent
var O=e("./blueprint.js").blueprintGetDef
var R=e("./file_management.js").getCanvasFromURL
var b=e("./frvr_sdk_worlds.js").frvrOnInitialized
var N=e("./localization/localization").L
var C=e("./photo_mode.js")
var x=C.DEFAULT_JPEG_QUALITY
var M=C.provideGlobalScreenshot
var D=e("./social_referral.js").getReferralNumber
var P=e("./user_details").userDetailsGetAsync
var B=e("./world_info.js").getWorldInfoAsync
var k="LIVE_MATCH_NOT_FOUND"
var U="TOURNAMENT_NOT_FOUND"
h.register({key:"IsMobileWeb"})
h.register({key:"context_source_id"})
h.register({key:"entry_point"})
h.register({key:"source"})
h.register({key:"environment_type"})
h.register({key:"session_id"})
var G=[]
function fbInstantLogEvent(e){FBInstant.logEvent(e)
G.push(e)
if(G.length>10)G.splice(0,1)}var F=false
function initSubscribe(e,t){function handleSubscribeToBotComplete(){if(e){setTimeout(e,1)
e=null}}function handleSubscribeToBotFailure(e){if(e&&"USER_INPUT"===e.code)fbInstantLogEvent("bot_subscribe_useraborted")
else{fbInstantLogEvent("bot_subscribe_failure")
console.error("handleSubscribeToBotFailure",e)}handleSubscribeToBotComplete()}function subscribeToBot(){if(Date.now()-_.getJSON("fbi_botsubscribe",0)<864e5)return void handleSubscribeToBotComplete()
console.warn("Window social trying to bot subscribe")
if(-1!==FBInstant.getSupportedAPIs().indexOf("player.canSubscribeBotAsync"))FBInstant.player.canSubscribeBotAsync().then(function(e){if(e){_.setJSON("fbi_botsubscribe",Date.now())
fbInstantLogEvent("bot_subscribe_show")
FBInstant.player.subscribeBotAsync().then(function(){fbInstantLogEvent("bot_subscribe_success")
handleSubscribeToBotComplete()},handleSubscribeToBotFailure)}else handleSubscribeToBotComplete()},handleSubscribeToBotFailure)
else handleSubscribeToBotComplete()}function handleHomescreenComplete(){subscribeToBot()}function handleCreateShortcutFailure(e){if(e&&"USER_INPUT"===e.code)fbInstantLogEvent("homescreen_install_useraborted")
else{fbInstantLogEvent("homescreen_install_failure")
console.error("handleCreateShortcutFailure",e)}handleHomescreenComplete()}var r=_.get("instant.hasInstalledShortcut.v2")
function createShortcut(){if(-1!==FBInstant.getSupportedAPIs().indexOf("canCreateShortcutAsync")&&!r&&!F){console.warn("Window social trying to create shortcut")
F=true
FBInstant.canCreateShortcutAsync().then(function(e){if(e){fbInstantLogEvent("homescreen_install_show")
FBInstant.createShortcutAsync().then(function(){_.set("instant.hasInstalledShortcut.v2",true)
fbInstantLogEvent("homescreen_install_success")
handleHomescreenComplete()},handleCreateShortcutFailure)}else handleHomescreenComplete()},handleCreateShortcutFailure)}else handleHomescreenComplete()}if(t)subscribeToBot()
else createShortcut()}var W=false
var H=false
function canFollowOfficialPage(){return W}function canJoinOfficialGroup(){return H}var z
function fbGetRoomCurrentMatch(){return z}var V
var Y
function fbIsTournamentActive(){return Boolean(V)}function fbGetTournamentData(){return Y}function updateCurrentTournament(e){try{Y=(V=e)&&JSON.parse(V.getPayload())}catch(e){V=Y=null}}function fbCreateTournament(e,t,r){t=t?g(T(t)):E
r=r?g(T(r)):E
FBInstant.tournament.createAsync(e).then(function(e){updateCurrentTournament(e)
t()},r)}function fbLeaveTournament(e,t){e=e?g(T(e)):E
t=t?g(T(t)):E
FBInstant.context.switchAsync("SOLO",true).then(function(){updateCurrentTournament(null)
e()},t)}function loadWorldImage(e,t,r){var a=I(e,"full",t)
var i=true
function onImageLoad(e,t){if(e)if(i){i=false
R(I(null,"full"),onImageLoad)}else return void r(N.ERR_LOAD_WORLD_IMAGE)
else return void r(void 0,t)}R(s(a),onImageLoad)}function clearModalDialogAfter(e){var t=e.success_cb,r=e.failure_cb
t=t?g(T(t)):E
r=r?g(T(r)):E
e.promise.then(function(){t()
v.modalDialogClear()},function(){r()
v.modalDialogClear()})}function wrapModalDialog(e,t){v.modalDialog(e)
clearModalDialogAfter(t)}function fbShareUserLink(r){L("share_user_link_fb",1,"show",r)
v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
P(r,function(e,t){if(e){console.error(e)
v.modalDialogClear()}else clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{u:r}},text:c(N.$(N.FBINSTANT_SHARE,t.display_name))}),success_cb:function success_cb(){L("share_user_link_fb",1,"succ",r)}})})}function fbShareWorldLink(a,i){L("share_link_fb",1,"show",String(a),{wgid:i})
v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
B(a,function(e,r){if(e){console.error(e)
v.modalDialogClear()}else loadWorldImage(r,i,function(e,t){if(e)return void v.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{w:a,wg:i}},image:t.toDataURL("image/jpeg",.92),text:c(N.$(N.FBINSTANT_SHARE,r.name))}),success_cb:function success_cb(){L("share_link_fb",1,"succ",String(a),{wgid:i})}})})})}function fbShareWorld(a,i){L("share_world_fb",1,"show",String(a),{wgid:i})
v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
B(a,function(e,r){if(e){console.error(e)
v.modalDialogClear()}else loadWorldImage(r,i,function(e,t){if(e)return void v.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareAsync({data:{querystring:{w:a,wg:i,referrer:u()}},image:t.toDataURL("image/jpeg",.92),text:0===D()?c(N.FBINSTANT_SHARE_WORLD_REFERRAL):c(N.$(N.FBINSTANT_SHARE,r.name))}),success_cb:function success_cb(){L("share_world_fb",1,"succ",String(a),{wgid:i})
L("referral_message_sent",1)}})})})}function fbShareCurrentWorldToChannel(a,i,o){var n=h.get("w")
var s=h.get("wg")||"default"
B(n,function(e,r){if(e){console.error(e)
if(o)return void o()}else loadWorldImage(r,s,function(e,t){if(e)if(o)return void o()
else return
FBInstant.updateAsync({action:"CUSTOM",cta:c(N.$(N.DLG_SHARE_WORLD_CURRENT_JOIN,FBInstant.player.getName())),image:t.toDataURL(),text:[c(N.$(N.DLG_SHARE_WORLD_FRIEND_INVITING_MSG,FBInstant.player.getName(),r.name)),c(N.$(N.DLG_SHARE_WORLD_FRIEND_JUST_PLAYED_MSG,FBInstant.player.getName(),r.name))][a],strategy:i||"IMMEDIATE",notification:"PUSH",template:"join_multiplayer_game",data:{querystring:{w:n,wg:s}}}).then(function(){console.log("Success")},function(e){console.error("Failure to save instant share image > "+e.message,e)})})})}function fbPostPassiveToContext(){fbShareCurrentWorldToChannel(1,"LAST")}function updateSessionData(e){if("object"!==typeof e||null===e){console.warn("[FBInstant] data provided to updateSessionData is null or not an object but "+typeof e)
return false}if(window.FBInstant&&window.FBInstant.setSessionData)FBInstant.setSessionData(e)
else{console.warn("[FBInstant] setSessionData not called as function was not available")
return false}return true}function fbInviteAsync(e,t){if(!window.FBInstant)return
updateSessionData({contextSwitch:true})
var a=h.get("w")
var i=h.get("wg")||"default"
L("fbInviteAsync",1,"show")
v.modalDialog({title:N.DLG_INVITING_TITLE,text:N.MSG_PLEASE_WAIT})
B(e,function(e,r){if(e){console.error(e)
v.modalDialogClear()}else loadWorldImage(r,void 0,function(e,t){if(e){console.error(e)
return void v.modalDialogClear()}else clearModalDialogAfter({promise:FBInstant.inviteAsync({text:0===D()?c(N.$(N.DLG_SHARE_WORLD_REFERRAL_FRIEND_INVITING_MSG,FBInstant.player.getName())):c(N.$(N.DLG_SHARE_WORLD_FRIEND_INVITING_MSG,FBInstant.player.getName(),r.name)),image:t.toDataURL("image/jpeg",.92),data:{querystring:{w:a,wg:i,referrer:u()}}}),success_cb:function success_cb(){L("fbInviteAsync",1,"succ")
L("referral_message_sent",1)}})})})}function fbInviteCreateAsync(e){var t
if(!window.FBInstant)return
var r=null==(t=d(e))?void 0:t[y]
if(!r)return
updateSessionData({contextSwitch:true})
L("fbInviteCreateAsync",1,"show")
wrapModalDialog({title:N.DLG_INVITING_TITLE,text:N.MSG_PLEASE_WAIT},{promise:FBInstant.context.createAsync(r.external_id),success_cb:function success_cb(){L("fbInviteCreateAsync",1,"succ")
fbShareCurrentWorldToChannel(0)
console.warn("Successfully changed context")
updateSessionData({contextSwitch:false})},failure_cb:function failure_cb(){updateSessionData({contextSwitch:false})}})}function getDefaultBlueprintImage(){return"img/placeholder_blueprint.png"}function getBlueprintImage(e){return e.img_url||getDefaultBlueprintImage()}function loadBlueprintImage(r,a){var e=getBlueprintImage(r)
var i=true
function onImageLoad(e,t){if(e)if(i){i=false
R(getDefaultBlueprintImage(r),onImageLoad)}else return void a(N.ERR_LOAD_BLUEPRINT_IMAGE)
else return void a(void 0,t)}R(s(e),onImageLoad)}function fbShareBlueprintLink(r){v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
var a=O(r)
loadBlueprintImage(a,function(e,t){if(e)return void v.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{blueprint:r}},image:t.toDataURL("image/jpeg",.92),text:c(N.$(N.DLG_SHARE_BLUEPRINT_MSG,a.name))})})})}function fbShareBlueprint(r){v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
var a=O(r)
loadBlueprintImage(a,function(e,t){if(e)return void v.modalDialogClear()
clearModalDialogAfter({promise:FBInstant.shareAsync({data:{querystring:{blueprint:r}},image:t.toDataURL("image/jpeg",.92),text:c(N.$(N.DLG_SHARE_BLUEPRINT_MSG,a.name))})})})}function fbSharePhotoTitle(e){if(!e)return c(N.FBINSTANT_SHARE_PHOTO)
return c(N.FBINSTANT_SHARE_PHOTO_TITLED.$({title:e}))}function fbSharePhoto(r,e,a){v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
R(e,function(e,t){if(e)return void v.modalDialog({title:N.DLG_ERROR_GETTING_PHOTO_TITLE,text:String(e),buttons:{OK:null}})
clearModalDialogAfter({promise:FBInstant.shareAsync({data:{querystring:{photo:r}},image:t.toDataURL("image/jpeg",.92),text:fbSharePhotoTitle(a)})})})}function fbSharePhotoLink(r,e,a){v.modalDialog({title:N.DLG_SHARING_TITLE,text:N.MSG_PLEASE_WAIT})
R(e,function(e,t){if(e)return void v.modalDialog({title:N.DLG_ERROR_GETTING_PHOTO_TITLE,text:String(e),buttons:{OK:null}})
clearModalDialogAfter({promise:FBInstant.shareLinkAsync({data:{querystring:{photo:r}},image:t.toDataURL("image/jpeg",.92),text:fbSharePhotoTitle(a)})})})}function fbRegisterScreenshotProvider(){FBInstant.registerScreenshotProvider(function(a){if(!v.isMenuUp())M(function(e,t){L("screenshot_fb",1)
var r=e.toDataURL("image/jpeg",x)
a({image:r,data:{context:t},text:c(N.FBINSTANT_TAKE_SCREENSHOT)})})})}function fbCreateWorldsTournament(a,i,o,n){function errorCreatingTournament(e){v.modalDialog({title:N.DLG_ERROR_TOURNAMENT_CREATING_TITLE,text:e,buttons:{OK:null}})}v.modalDialog({title:N.DLG_TOURNAMENT_CREATING_TITLE,text:N.MSG_PLEASE_WAIT})
B(a,function(e,t){if(e){console.error(e)
return void errorCreatingTournament(e)}loadWorldImage(t,null,function(e,t){var r={}
if(e)console.error(e)
else r.image=t.toDataURL("image/jpeg",.92)
fbCreateTournament({initialScore:i,data:m({querystring:{w:a}},n),config:m(r,o)},v.modalDialogClear,function(e){if("USER_INPUT"===e.code)v.modalDialogClear()
else{console.error(e)
errorCreatingTournament(e.code)}})})})}function fbCreateRaceTournament(e,t,r){fbCreateWorldsTournament(e,t,{title:r.buzzer_id,sortOrder:"LOWER_IS_BETTER",scoreFormat:"TIME"},{world_id:e,buzzer_id:r.buzzer_id,chunk_id:r.chunk_id,pos_idx:r.pos_idx})}function fbPostSessionScoreAsync(e){v.modalDialog({title:N.DLG_TOURNAMENT_SUBMITTING_TITLE,text:N.MSG_PLEASE_WAIT})
FBInstant.postSessionScoreAsync(e).then(v.modalDialogClear,function(e){console.error(e)
v.modalDialog({title:N.DLG_ERROR_TOURNAMENT_SUBMITTING_TITLE,text:e.code,buttons:{OK:null}})})}function fbLeaveWorldsTournament(e){var t=e?g(T(e)):E
v.modalDialog({title:N.DLG_TOURNAMENT_LEAVING_TITLE,text:N.MSG_PLEASE_WAIT})
fbLeaveTournament(function(){v.modalDialogClear()
t()},function(e){v.modalDialog({title:N.DLG_ERROR_TOURNAMENT_LEAVING_TITLE,text:e.code,buttons:{OK:null}})})}function fbFollowOfficialPage(){wrapModalDialog({title:N.DLG_OFFICIAL_PAGE_TITLE,text:N.MSG_PLEASE_WAIT},{promise:FBInstant.community.followOfficialPageAsync()})}function fbJoinOfficialGroup(){wrapModalDialog({title:N.DLG_OFFICIAL_GROUP_TITLE,text:N.MSG_PLEASE_WAIT},{promise:FBInstant.community.joinOfficialGroupAsync()})}var j=false
function fbCanInvite(){return j}var K=false
var q=false
function fbCanShare(){return K}function fbCanShareLink(){return q}function fbInstantPostStart(){var e=FBInstant.onPause
FBInstant.onPause=!e?f:function(){e()
f()}
fbRegisterScreenshotProvider()
initSubscribe(function(){var e=FBInstant.getSupportedAPIs()
j=e.includes("inviteAsync")
K=e.includes("shareAsync")&&e.includes("shareLinkAsync")
q=e.includes("shareLinkAsync")
function checkFollowPageAndGroup(){FBInstant.community.canFollowOfficialPageAsync().then(function(e){W=e},function(e){console.error(e)})
FBInstant.community.canJoinOfficialGroupAsync().then(function(e){H=e},function(e){console.error(e)})}if(!z)checkFollowPageAndGroup()
if(z)o(false)})}function fbInstantPostInit(){l("fblog",function(){return G.join(",")})
var e=[]
if(FBInstant.context.getID()){e.push(FBInstant.room.getCurrentMatchAsync().then(function(e){return z=e},function(e){if(!e||e.code!==k)console.warn("FBInstant getCurrentMatchAsync failed",e)}))
e.push(FBInstant.getTournamentAsync().then(updateCurrentTournament,function(e){if(!e||e.code!==U)console.warn("FBInstant getTournamentAsync failed",e)}))}return Promise.all(e).then(function(){var e
if(!z&&n.defines.FB_PLAYTOGETHER)z={getContextID:function getContextID(){return"fake_id"}}
if(z)i(S.FBRooms)
b(function(){if(w())L("fbrooms",void 0,void 0,z?"yes":"no")})
var t=FBInstant.getEntryPointData()||{}
var r=(null==(e=fbGetTournamentData())?void 0:e.querystring)||t.querystring||{}
for(var a in r)h.set(a,r[a])})}},{"../common/external_users/external_users_provider_ids.js":247,"../common/platform_worlds_common":257,"../common/waygate_common.js":265,"../glov/client/client_config":297,"../glov/client/engine":305,"../glov/client/environments":310,"../glov/client/error_report":311,"../glov/client/local_storage":329,"../glov/client/localization":330,"../glov/client/net":338,"../glov/client/social":357,"../glov/client/sound":358,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/util":400,"./analytics.js":6,"./blueprint.js":28,"./file_management.js":98,"./frvr_sdk_worlds.js":102,"./localization/localization":131,"./photo_mode.js":158,"./social_referral.js":190,"./user_details":209,"./world_info.js":229}],97:[function(e,t,r){"use strict"
r.feedbackShow=feedbackShow
var a=e("../glov/client/engine")
var i=e("../glov/client/net").netClient
var o=e("./layout").isTopRightCornerReserved
var n=e("./localization/localization").L
var s=e("./main_menu").URL_DISCORD
var l=e("./platform_worlds_client")
var _=l.PLATFORM_FBINSTANT
var c=l.PLATFORM_YANDEX
var u=e("./status")
var d=document.getElementById("debug")
var f=document.getElementById("feedback")
var v=document.getElementById("feedbacklabel")
var h=document.getElementById("feedbacktext")
var p=document.getElementById("feedbackfrm")
var m=document.getElementById("feedbacksubmit")
var E=document.getElementById("feedbackcancel")
var g=document.getElementById("feedbackcancel2")
var T=document.getElementById("feedbackdescription")
var y
function feedbackHide(){f.style.display="none"
a.disableRender(false)
if(y)window.debugmsg(y,true)}function feedbackShow(){v.innerText=n.addColon(n.LBL_FEEDBACK_TEXT).toLocalString()
m.value=n.BTN_SUBMIT.toLocalString()
E.value=n.BTN_CANCEL.toLocalString()
g.style.display=o()?"none":"inline"
T.innerHTML="<ul><li>"+n.FEEDBACK_DESC_GENERIC+"</li>\x3c!--<li>"+n.FEEDBACK_DESC_ACCOUNT_DELETE.$({text:"PLEASE DELETE MY ACCOUNT"})+"</li>--\x3e<li>"+(_?n.FEEDBACK_DESC_FACEBOOK:c?n.FEEDBACK_DESC_YANDEX:n.$(n.FEEDBACK_DESC_DISCORD,'<a target="_blank" href="'+s+'" class="noglov">'+s+"</a>"))+"</li></ul>"
f.style.display="block"
h.focus()
a.disableRender(true)
if(d)if(y=d.innerText){window.debugmsg("",true)
h.value=n.FEEDBACK_ERROR_WHAT_CAUSED+"\n\n"+n.addColon(n.LBL_ERROR_DETAILS)+"\n"+y}var r=false
function feedbackOnsubmit(e){if(e)e.preventDefault()
var t=(h.value||"").trim()
if(t&&!r)if(!i().connected)u.push(n.STATUSMSG_FEEDBACK_SUBMIT_ERROR)
else i().send("feedback",{feedback:t},null,function(e){if(e)u.push(n.STATUSMSG_FEEDBACK_SUBMIT_ERROR)
else{h.value=""
u.push(n.STATUSMSG_FEEDBACK_SUBMITTED)}})
r=true
feedbackHide()
return false}p.onsubmit=feedbackOnsubmit
m.onclick=feedbackOnsubmit
E.onclick=feedbackHide
g.onclick=feedbackHide}},{"../glov/client/engine":305,"../glov/client/net":338,"./layout":120,"./localization/localization":131,"./main_menu":136,"./platform_worlds_client":160,"./status":193}],98:[function(e,t,r){"use strict"
r.uploadInProgress=uploadInProgress
r.upload=upload
r.imageToBinary=imageToBinary
r.uploadImageSet=uploadImageSet
r.getCanvasFromURL=getCanvasFromURL
var s=e("./localization/localization").L
var i=e("assert")
var a=e("glov-async").asyncSeries
var o=e("../glov/common/base64.js").base64Decode
var n=e("../glov/common/chunked_send.js").chunkedSend
var l=e("./main.js").blockImageUpload
var _=e("../glov/client/net.js")
var c=e("../glov/client/urlhash.js")
var u=false
function uploadInProgress(){return u}var d=3
function upload(e,r){var t=e.u8,a=e.mime_type
i(!uploadInProgress(),"Upload already in progress")
u=true
n({client:_.client,buffer:t,mime_type:a,max_in_flight:d},function(e,t){u=false
r(e,t)})}var f=/^data:(image\/[^;]+);base64,/
function imageToBinary(e){var t=e.match(f)
if(!t)return{err:s.$(s.ERR_INVALID_DATA_HEADER,e.slice(0,30))}
var r=t[1]
var a=e.slice(t[0].length)
var i=o(a,function(e){return{u8:new Uint8Array(e)}})
i.mime_type=r
return i}function uploadImageSet(i,e,t){if(e&&l())return void t(s.ERR_CUSTOM_TEXTURES_NOT_ALLOWED)
var r=[]
var o={}
var n
Object.keys(i).forEach(function(a){var e=imageToBinary(i[a].data)
if(e.err){n=e.err
return}r.push(function(r){upload(e,function(e,t){o[a]={id:t,w:i[a].w,h:i[a].h}
r(e)})})})
if(n)return void t(n)
a(r,function(e){t(e,o)})}function getCanvasFromURL(e,t){var r=new Image
r.setAttribute("crossOrigin","anonymous")
r.onload=function(){var e=document.createElement("canvas")
e.width=this.width
e.height=this.height
e.getContext("2d").drawImage(this,0,0)
t(void 0,e)}
r.onerror=function(e){console.warn(e)
t(e,void 0)}
if(!e.match(/^.{2,7}:/))e=""+c.getURLBase()+e
r.src=e}},{"../glov/client/net.js":338,"../glov/client/urlhash.js":369,"../glov/common/base64.js":377,"../glov/common/chunked_send.js":378,"./localization/localization":131,"./main.js":135,assert:void 0,"glov-async":void 0}],99:[function(e,t,r){"use strict"
r.createFixedOctree=createFixedOctree
var _=e("assert")
var n=16
function FixedOctreeNode(){this.split=false
this.children=[]
this.num_children=0}var S=new Int32Array(3)
function nodeSplit(e,t){var r=e.children,a=e.num_children
e.split=true
e.children=new Array(8)
for(var i=e.num_children=0;i<a;++i){var o=r[i]
var n=0
if(o.pos[0]>=S[0])n+=1
if(o.pos[1]>=S[1])n+=2
if(o.pos[2]>=S[2])n+=4
var s=e.children[n]
if(!s){s=e.children[n]=new FixedOctreeNode;++e.num_children}s.children[s.num_children++]=o}}function nodeAdd(e,t,r){if(e.split){var a=0
var i=t>>1
if(r.pos[0]>=S[0]){S[0]+=i
a+=1}else S[0]-=i
if(r.pos[1]>=S[1]){a+=2
S[1]+=i}else S[1]-=i
if(r.pos[2]>=S[2]){a+=4
S[2]+=i}else S[2]-=i
var o=e.children[a]
if(!o){o=e.children[a]=new FixedOctreeNode;++e.num_children}nodeAdd(o,i,r)}else{e.children[e.num_children++]=r
if(e.num_children>n)nodeSplit(e,t)}}function nodeRemove(e,t,r){var a=e.children
if(e.split){var i=0
var o=t>>1
if(r.pos[0]>=S[0]){S[0]+=o
i+=1}else S[0]-=o
if(r.pos[1]>=S[1]){i+=2
S[1]+=o}else S[1]-=o
if(r.pos[2]>=S[2]){i+=4
S[2]+=o}else S[2]-=o
if(nodeRemove(e.children[i],o,r)){e.children[i]=null
if(!--e.num_children)return true}}else{var n=-1
var s=e.num_children
for(var l=0;l<s;++l)if(r===a[l]){n=l
break}_(-1!==n)
if(n!==--s)a[n]=a[s]
delete a[s]
if(!(e.num_children=s))return true}return false}function FixedOctree(e){this.count=0
var t=this.r=e.size>>1
this.center=new Int32Array([e.pos[0]+t,e.pos[1]+t,e.pos[2]+t])
FixedOctreeNode.call(this)}FixedOctree.prototype.add=function(e){++this.count
S[0]=this.center[0]
S[1]=this.center[1]
S[2]=this.center[2]
nodeAdd(this,this.r,e)}
FixedOctree.prototype.remove=function(e){--this.count
S[0]=this.center[0]
S[1]=this.center[1]
S[2]=this.center[2]
nodeRemove(this,this.r,e)}
FixedOctree.prototype.clear=function(){}
FixedOctree.prototype.getNumLeaves=function(){return this.count}
var I
var A
function getAllNodes(e){var t=e.children
if(e.split){for(var r=0;r<8;++r)if(t[r])getAllNodes(t[r])}else{var a=e.num_children
for(var i=0;i<a;++i)A[I++]=t[i]}}var w=Math.sqrt(3)
var L=.5*w
function getVisibleNodes2(e,t,r){var a=r.length
var i,o
var n,s,l,_
if(e.num_children>(e.split?1:2)){s=S[n=0]
l=S[1]
_=S[2]
var c=t*w
var u=true
var d=true
do{if((o=(i=r[n])[0]*s+i[1]*l+i[2]*_)<i[3]-c){u=false
break}if(d)if(o<i[3]+c)d=false
n++}while(n<a)
if(!u)return
if(d){getAllNodes(e)
return}}var f=e.children
if(e.split){var v=t>>1
s=S[0]
l=S[1]
_=S[2]
for(var h=0;h<8;++h){var p=f[h]
if(p){S[0]=1&h?s+v:s-v
S[1]=2&h?l+v:l-v
S[2]=4&h?_+v:_-v
getVisibleNodes2(p,v,r)}}}else{var m=e.num_children
var E,g
for(var T=0;T<m;++T){s=(E=(g=f[T]).pos)[0]+.5
l=E[1]+.5
_=E[2]+.5
var y=true
n=0
do{if((o=(i=r[n])[0]*s+i[1]*l+i[2]*_)<i[3]-L){y=false
break}n++}while(n<a)
if(y)A[I++]=g}}}FixedOctree.prototype.getVisibleNodes=function(e,t,r){if(!this.count)return r
A=t
I=r
S[0]=this.center[0]
S[1]=this.center[1]
S[2]=this.center[2]
getVisibleNodes2(this,this.r,e)
return I}
function createFixedOctree(e){return new FixedOctree(e)}},{assert:void 0}],100:[function(e,t,r){"use strict"
r.drawFloaterSimple=drawFloaterSimple
r.drawFloaterStack=drawFloaterStack
r.PanelledTextFloater=r.PanelFloater=r.ProgressBarFloater=r.SpriteFloater=r.GraphicalFloater=r.TextFloater=r.CompoundFloater=r.DEF_COMP_FLT_SCALE=r.DEF_FLT_SCALE=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var p=e("assert")
var m=e("../glov/client/camera2d")
var E=e("../glov/client/engine")
var a=e("../glov/client/font").ALIGN
var i=e("../glov/client/input")
var s=i.inputClick
var l=i.mouseOver
var o=e("../glov/client/markdown.js")
var _=o.markdownDims
var c=o.markdownDraw
var u=o.markdownLayoutInvalidate
var d=o.markdownPrep
var n=e("../glov/client/ui")
var f=n.drawRect2
var v=n.panel
var h=n.progressBar
var g=n.uiGetFont
var T=e("../glov/common/util")
var y=T.clamp
var S=T.merge
var I=e("../glov/common/vmath")
var A=I.v2copy
var w=I.v3copy
var L=I.v3distSq
var O=I.v3dot
var R=I.v3perspectiveProject
var b=I.v3sub
var N=I.v4copy
var C=I.vec2
var x=I.vec3
var M=I.vec4
var D=I.zero_vec
var P=e("./camera")
var B=P.getActiveController
var k=P.getCurrentViewMatrix
var U=e("./photo_mode").photoModeActive
var G=e("./styles")
var F=G.color_white
var W=G.floater_style_default
var H=Math.abs,z=Math.max,V=Math.min,Y=Math.sqrt
var j=.333
r.DEF_FLT_SCALE=j
var K=.125
r.DEF_COMP_FLT_SCALE=K
var q
var X=function(){function Floater(e){this.w=void 0
this.h=void 0
this.interact_dist=void 0
this.handleInteract=void 0
this.w=(e=e||{}).w||0
this.h=e.h||0
if(this.interact){this.interact_dist=this.interact_dist||-1
this.handleInteract=handleFloaterInteraction}}var e=Floater.prototype
e.getW=function getW(){return this.w}
e.getH=function getH(){return this.h}
e.setInteractDist=function setInteractDist(e){this.interact_dist=e}
return Floater}();(function(i){_inheritsLoose(InteractableFloater,i)
function InteractableFloater(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).interact=void 0
e.interact_dist=void 0
e.handleInteract=void 0
return e}})(X)
function isInteractableFloater(e){return Boolean(e.interact)}var Q=4
var $=4
var J=M(1,1,1,.5)
function floaterInteraction(e,t){var r=e.x,a=e.y,i=e.w,o=e.h
var n={x:r-Q,y:a-Q,w:i+2*Q,h:o+2*$,z:Z.FLOATER_INTERACT,button:0,color:J,allow_pointerlock:true}
if(s(n))t.interact({x:r,y:a,w:i,h:o})
else if(l(S(n,{peek_touch:true})))f(n)}function handleFloaterInteraction(e,t,r,a){if(isInteractableFloater(e))if(-1===e.interact_dist||r<e.interact_dist)floaterInteraction(t,e)}var ee=1e-4
var te=function(c){_inheritsLoose(CompoundFloater,c)
function CompoundFloater(e,t){var r;(r=c.call(this,t=t||{})||this).fp_pairs=void 0
var a=Infinity
var i=Infinity
for(var o in r.fp_pairs=e){p(e[o].rel_pos.x>=0)
p(e[o].rel_pos.y>=0)
p(e[o].rel_pos.z>=0)
if(e[o].rel_pos.x<a)a=e[o].rel_pos.x
if(e[o].rel_pos.y<i)i=e[o].rel_pos.y}for(var n in e){var s=e[n],l=s.rel_pos,_=s.floater
if(l.x-a+_.getW()>r.w)r.w=l.x-a+_.getW()
if(l.y-i+_.getH()>r.h)r.h=l.y-i+_.getH()}if(!r.interact)r.handleInteract=handleCompoundFloaterInteraction
return r}var e=CompoundFloater.prototype
e.getFPPairs=function getFPPairs(){return this.fp_pairs}
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
for(var o in this.fp_pairs)this.fp_pairs[o].floater.draw({x:t+this.fp_pairs[o].rel_pos.x*i,y:r+this.fp_pairs[o].rel_pos.y*i,z:a+this.fp_pairs[o].rel_pos.z*ee,scale:i})}
e.updateAlpha=function updateAlpha(e){for(var t in this.fp_pairs)this.fp_pairs[t].floater.updateAlpha(e)}
e.updateSize=function updateSize(){var e=0
var t=0
var r=Infinity
var a=Infinity
for(var i in this.fp_pairs){if(this.fp_pairs[i].rel_pos.x<r)r=this.fp_pairs[i].rel_pos.x
if(this.fp_pairs[i].rel_pos.y<a)a=this.fp_pairs[i].rel_pos.y}for(var o in this.fp_pairs){var n=this.fp_pairs[o],s=n.rel_pos,l=n.floater
if(s.x-r+l.getW()>e)e=s.x-r+l.getW()
if(s.y-a+l.getH()>t)t=s.y-a+l.getH()}this.w=e
this.h=t}
return CompoundFloater}(X)
r.CompoundFloater=te
function isCompoundFloater(e){return Boolean(e.getFPPairs)}function handleCompoundFloaterInteraction(e,t,r,a){p(isCompoundFloater(e))
for(var i in e.getFPPairs()){var o=e.getFPPairs()[i],n=o.rel_pos,s=o.floater
if(isInteractableFloater(s))if(-1===s.interact_dist||r<s.interact_dist){var l={x:t.x+n.x*a,y:t.y+n.y*a,w:s.getW()*a,h:s.getH()*a}
s.handleInteract(s,l,r,a)}}}var re=1e-4
var ae=function(r){_inheritsLoose(TextFloater,r)
function TextFloater(e){var t;(t=r.call(this,e=e||{})||this).text=void 0
t.draw_text=void 0
t.size=void 0
t.base_style=void 0
t.style=void 0
t.fixed_w=void 0
t.align=void 0
t.max_lines=void 0
t.text_w=void 0
t.use_markdown=void 0
t.md_cache_base=void 0
t.md_cache_height=void 0
t.md_cache_draw=void 0
t.md_last_scale=void 0
t.resize_to_w=void 0
t.max_size=void 0
t.min_size=void 0
t.max_w=void 0
t.min_w=void 0
t.md_draw_param=void 0
q=q||g()
t.text=e.text||""
t.draw_text=t.text
t.use_markdown=e.use_markdown||false
if(t.use_markdown){t.md_cache_base={}
t.md_cache_height={}
t.md_cache_draw={}
t.md_last_scale=0}t.size=e.size||1
t.base_style=e.style||W
t.style=t.base_style
t.fixed_w=void 0!==e.w
if(void(t.max_lines=0)!==e.w){t.w=e.w
t.resize_to_w=e.resize_to_w
if(e.resize_to_w){p(!e.size)
t.max_size=e.max_size||Infinity
t.min_size=e.min_size||re
t.max_lines=e.max_lines||0}}else{t.max_w=e.max_w
t.min_w=e.min_w
if(t.max_w&&t.min_w)p(t.max_w>=t.min_w)}t.align=void 0===e.align?a.HCENTERFIT:e.align
t.updateSize()
return t}var e=TextFloater.prototype
e.getText=function getText(){return this.text}
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
p(void 0!==t&&void 0!==r&&void 0!==a&&void 0!==i)
if(this.use_markdown){var o=this.md_draw_param
if(!o)o=this.md_draw_param={font:q,font_style:this.style,x:0,y:0,z:0,text_height:this.size*i,align:this.align,w:this.w*i,h:this.h*i,text:this.text,renderables:{},cache:this.md_cache_draw,viewport:{x:0,y:0,w:0,h:0}}
o.x=t
o.y=r
o.z=a
o.font_style=this.style
if(H(this.md_last_scale-i)>.1){this.md_last_scale=i
o.text_height=this.size*i
o.w=this.w*i
o.h=this.h*i
u(o)}var n=o.viewport
n.x=t
n.y=r
n.w=this.w*i
n.h=this.h*i-this.size*i*.5
d(o)
o.y+=z(0,(o.h-_(o).h)/2)
c(o)}else q.drawSizedAligned(this.style,t,r,a,this.size*i,this.align,this.w*i,this.h*i,this.draw_text)}
e.updateAlpha=function updateAlpha(e){this.style=q.styleAlpha(this.base_style,e)}
e.updateWidth=function updateWidth(e){this.text_w=this.size*e
if(!this.fixed_w){this.w=this.text_w+re
if(this.max_w)this.w=V(this.w,this.max_w)
if(this.min_w)this.w=z(this.w,this.min_w)}}
e.updateHeight=function updateHeight(){if(this.align&a.HWRAP)if(this.use_markdown)if(this.max_lines)if(this.fixed_w&&this.resize_to_w)this.h=this.min_size*this.max_lines
else this.h=this.size*this.max_lines
else{var e={cache:this.md_cache_height,text:this.text,align:this.align,renderables:{},font:q,font_style:this.style,text_height:this.size,w:this.w}
d(e)
this.h=_(e).h}else if(this.max_lines){var i=[]
var t=q.wrapLines(this.style,this.w,0,this.size,this.text,0,function(e,t,r,a){i.push(r)})
if(t>this.max_lines){i=i.slice(0,this.max_lines)
this.draw_text=i.join("\n")
t=this.max_lines}this.h=this.size*t}else this.h=this.size*q.numLines(this.style,this.w,0,this.size,this.text)
else this.h=this.size}
e.getBaseWidth=function getBaseWidth(){if(this.use_markdown){var e={cache:this.md_cache_base,text:this.text,renderables:{},font:q,font_style:this.style,text_height:1}
d(e)
return _(e).w}else return q.getStringWidth(this.style,1,this.text)}
e.updateSize=function updateSize(){var e=this.getBaseWidth()
if(this.fixed_w&&this.resize_to_w)this.size=e?y((this.w-re)*(1/e),this.min_size,this.max_size):1
this.updateWidth(e)
this.updateHeight()}
e.setAlign=function setAlign(e){if(e===this.align)return
this.align=e
this.updateHeight()}
e.setText=function setText(e){if(e===this.text)return
this.text=e
this.draw_text=e
if(this.use_markdown){u({cache:this.md_cache_base})
u({cache:this.md_cache_height})
u({cache:this.md_cache_draw})
this.md_last_scale=0
if(this.md_draw_param)this.md_draw_param.text=e}this.updateSize()}
e.setStyle=function setStyle(e){if(e===this.base_style)return
this.base_style=e
if(this.use_markdown)this.md_last_scale=0
this.updateSize()}
return TextFloater}(X)
r.TextFloater=ae
var ie=function(r){_inheritsLoose(GraphicalFloater,r)
function GraphicalFloater(e){var t;(t=r.call(this,e=e||{})||this).base_color=void 0
t.color=void 0
t.base_color=M()
t.color=M()
N(t.base_color,e.color||F)
N(t.color,t.base_color)
return t}var e=GraphicalFloater.prototype
e.setColor=function setColor(e){N(this.base_color,e)}
e.setBaseAlpha=function setBaseAlpha(e){this.base_color[3]=e}
e.updateAlpha=function updateAlpha(e){N(this.color,this.base_color)
this.color[3]*=e}
return GraphicalFloater}(X)
var oe=function(r){_inheritsLoose(SpriteFloater,r)
function SpriteFloater(e){var t;(t=r.call(this,e)||this).sprite=void 0
t.sprite_params=void 0
t.sprite=e.sprite
t.sprite_params=e.sprite_params||{}
return t}SpriteFloater.prototype.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
this.sprite.draw(S({x:t,y:r,z:a,w:this.w*i,h:this.h*i,color:this.color},this.sprite_params))}
return SpriteFloater}(r.GraphicalFloater=ie)
r.SpriteFloater=oe
var ne=function(r){_inheritsLoose(ProgressBarFloater,r)
function ProgressBarFloater(e){var t;(t=r.call(this,e=e||{})||this).progress=void 0
t.progress=e.progress||0
return t}var e=ProgressBarFloater.prototype
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
h({x:t,y:r,z:a,w:this.w*i,h:this.h*i,progress:this.progress,color:this.color})}
e.setProgress=function setProgress(e){this.progress=e}
return ProgressBarFloater}(ie)
r.ProgressBarFloater=ne
var se=function(r){_inheritsLoose(PanelFloater,r)
function PanelFloater(e){var t;(t=r.call(this,e=e||{})||this).pixel_scale=void 0
t.pixel_scale=e.pixel_scale||1
return t}var e=PanelFloater.prototype
e.draw=function draw(e){var t=e.x,r=e.y,a=e.z,i=e.scale
v({x:t,y:r,z:a,w:this.w*i,h:this.h*i,pixel_scale:this.pixel_scale*i,color:this.color,eat_clicks:false})}
e.setW=function setW(e){this.w=e}
e.setH=function setH(e){this.h=e}
return PanelFloater}(ie)
r.PanelFloater=se
var le=function(s){_inheritsLoose(PanelledTextFloater,s)
function PanelledTextFloater(e,t){var r
var a=(t=t||{}).pixel_scale||.01
var i=t.panel_border||.4
var o=t.color||F
var n={text:{floater:e,rel_pos:{x:i,y:i,z:1}},panel:{floater:new se({color:o,pixel_scale:a,w:e.getW()+2*i,h:e.getH()+2*i}),rel_pos:{x:0,y:0,z:0}}};(r=s.call(this,n)||this).panel_border=void 0
r.fp_pairs=void 0
r.fp_pairs=n
r.panel_border=i
return r}var e=PanelledTextFloater.prototype
e.updatePanelSize=function updatePanelSize(){var e=this.fp_pairs.panel.floater
var t=this.fp_pairs.text.floater
e.setW(t.getW()+2*this.panel_border)
e.setH(t.getH()+2*this.panel_border)
this.w=e.getW()
this.h=e.getH()}
e.getText=function getText(){return this.fp_pairs.text.floater.getText()}
e.setText=function setText(e){this.fp_pairs.text.floater.setText(e)
this.updatePanelSize()}
e.setStyle=function setStyle(e){this.fp_pairs.text.floater.setStyle(e)
this.updatePanelSize()}
e.setColor=function setColor(e){this.fp_pairs.panel.floater.setColor(e)}
return PanelledTextFloater}(te)
r.PanelledTextFloater=le
function calculateOffscreenScaleFactor(e){return z(e[0]-1,-e[0],e[1]-1,-e[1],.5-e[2],0)}var _e=x()
var ce=x()
function adjustOffscreenScreenPos(e,t){b(_e,t,B().pos)
var r=k()
var a=O(_e,[r[2],r[6],r[10]])
w(ce,e)
if(a>0){ce[0]=1-ce[0]
ce[1]=1-ce[1]}if(H(a)<4)ce[1]=(ce[1]-.5)*H(a)/4+.5
if(ce[0]>=.35&&ce[0]<=.65&&ce[2]>1&&ce[1]<.5)ce[0]=y(ce[0],0,1)
else if(ce[1]>.8||ce[2]<0)ce[0]=ce[0]<.5?0:1
else ce[0]=y(ce[0],0,1)
ce[1]=y(ce[1],0,.8)
return ce}function calculateFloaterScreenPos(e,t,r){var a=calculateOffscreenScaleFactor(t)
var i
if(r&&(t[0]<-.1||t[0]>1.1||t[1]<-.1||t[1]>1||t[2]<.5)){var o=adjustOffscreenScreenPos(t,e)
p(isFinite(o[0]))
p(isFinite(o[1]))
p(isFinite(o[2]))
i=o}else{p(isFinite(t[0]))
p(isFinite(t[1]))
p(isFinite(t[2]))
i=t}return{offscreen_scale_factor:a,screen_pos:i}}var ue=C()
function offscreenOffsetCalculate(e){var t=e.x,r=e.y,a=e.w
A(ue,D)
if(t<m.x0())ue[0]=m.x0()-t
else if(t+a>m.x1())ue[0]=-(t+a-m.x1())
if(r<0)ue[1]=-r
return ue}var de=Infinity
var fe=.2
function calculateFloaterAlpha(e,t,r){t=void 0===t?de:t
r=void 0===r?fe:r
var a=isFinite(t)?t*r:0
var i=1
if(a&&e>t-a)i=z((t-e)/a,0)
return i}function unitLengthAtZ(e,t){t=t||re
return e[5]/t*.5}var ve=9
var he=96
var pe=.15
var me=x()
function commonDrawFloaterSetup(e,t,r,a,i){var o=i.min_scale||ve
var n=i.max_scale||he
var s=void 0===i.vert_offset_scale?pe:i.vert_offset_scale
var l=void 0===i.downscale_if_offscreen?true:i.downscale_if_offscreen
var _=calculateFloaterScreenPos(r,t,e)
var c=_.offscreen_scale_factor
w(me,_.screen_pos)
var u=me[0]*m.wReal()+m.x0Real()
var d=me[1]*m.hReal()+m.y0Real()
var f=B().pos
var v=Y(L(r,f))
if(!isFinite(v))p(false,r+", "+f)
var h=unitLengthAtZ(E.mat_projection,z(.8*v,me[2]))*m.hReal()
d-=s*(a=y(a*=h,o,z(n/2,n-(l?c:0)*n/2)))
p(isFinite(a))
p(isFinite(u))
p(isFinite(d))
return{screen_x:u,screen_y:d,scale:a,dist:v}}var Ee=.001
function calculateFloaterZ(e){return z(Z.FLOATERS_MIN,Z.FLOATERS_MAX-Ee*e)}var ge=C()
var Te=x()
function drawFloaterSimple(e,t,r,a){if(U()&&!e.draw_in_photos)return
var i=e.floater
p(i)
var o=e.show_offscreen||false
p(isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2]))
R(Te,t,E.mat_vp)
p(isFinite(Te[0])&&isFinite(Te[1])&&isFinite(Te[2]))
var n=Te[2]>=.5
if(o||n){var s=commonDrawFloaterSetup(o,Te,t,r,a=a||{}),l=s.screen_x,_=s.screen_y,c=s.scale,u=s.dist
var d=calculateFloaterAlpha(u,e.max_dist,e.fade_dist)
if(d>0){i.updateAlpha(d)
var f=i.getW()*c
var v=i.getH()*c
var h={x:l-f/2,y:_-v,w:f,h:v}
if(o){A(ge,offscreenOffsetCalculate(h))
if(i.offscreenUpdate)i.offscreenUpdate(ge,c)}else A(ge,D)
h.x+=ge[0]
h.y+=ge[1]
i.draw({x:h.x,y:h.y,z:calculateFloaterZ(u),scale:c})
if(i.handleInteract)i.handleInteract(i,h,u,c)}}}function drawFloaterStackSub(e,t,r,a,i){var o=[]
var n=[]
if(e.length>0)if((t=t||false)||Te[2]>=.5){var s=commonDrawFloaterSetup(t,Te,r,a,i),l=s.screen_x,_=s.screen_y,c=s.scale,u=s.dist
var d=0
for(var f=0;f<e.length;f++){if(U()&&!e[f].draw_in_photos)continue
var v=e[f]
var h=calculateFloaterAlpha(u,v.max_dist,v.fade_dist)
e[f].floater.updateAlpha(h)
if(h>0){var p=e[f].floater.getW()*c
var m=e[f].floater.getH()*c
var E={x:l-p/2,y:_-m+d,z:calculateFloaterZ(u),w:p,h:m}
d-=m
n.push(e[f].floater)
o.push(E)}}for(var g=0;g<o.length;g++){var T=n[g]
if(t){A(ge,offscreenOffsetCalculate(o[g]))
if(T.offscreenUpdate)T.offscreenUpdate(ge,c)}else A(ge,D)
o[g].x+=ge[0]
for(var y=0;y<o.length;y++)o[y].y+=ge[1]}for(var S=0;S<o.length;S++){var I=n[S]
I.draw({x:o[S].x,y:o[S].y,z:o[S].z,scale:c})
if(I.handleInteract)I.handleInteract(I,o[S],u,c)}}}function drawFloaterStack(e,t,r,a){if(!e.length)return
if(1===e.length)drawFloaterSimple(e[0],t,r,a)
else{a=a||{}
R(Te,t,E.mat_vp)
var i={off_adjusted:[],not_off_adjusted:[]}
if(Te[0]<0||Te[0]>1||Te[1]<0||Te[1]>1||Te[2]<.5)for(var o=0;o<e.length;o++)if(e[o].show_offscreen)i.off_adjusted.push(e[o])
else i.not_off_adjusted.push(e[o])
else i.off_adjusted=e
drawFloaterStackSub(i.off_adjusted,true,t,r,a)
drawFloaterStackSub(i.not_off_adjusted,false,t,r,a)}}},{"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/markdown.js":332,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./camera":35,"./photo_mode":158,"./styles":197,assert:void 0}],101:[function(e,t,r){"use strict"
r.ALL_FLOWERS=r.SUNKEN_CHEST=r.WILD_SUGAR_CANE=r.WILD_CARROT=r.WILD_WHEAT=r.WILD_PUMPKIN=r.WILD_CORN=r.WILD_TOMATO=r.VALID_PLANT_SEEDS=r.FLOWER_SEEDS=r.FLOWERS=r.LUMINESCENT_MUSHROOMS=r.BROWN_MUSHROOMS=r.RED_MUSHROOMS=r.ORANGE_FLOWERS=r.RED_FLOWERS=r.PURPLE_FLOWERS=r.YELLOW_FLOWERS=r.BLUE_FLOWERS=void 0
var a=e("../glov/common/util").arrayToSet
var i=e("../common/materials_common").Mat
function generateSimpleWeighted(e,t){var r=[]
for(var a=0;a<e.length;a++)for(var i=0;i<t[a];i++)r.push(e[a])
return r}var o=[4,6,25,26,27]
var n={name_key:"FLOWERS_BLUE",key:o,weighted:generateSimpleWeighted(o,[3,3,1,1,1])}
r.BLUE_FLOWERS=n
var s={name_key:"FLOWERS_YELLOW",key:[1,7]}
r.YELLOW_FLOWERS=s
var l=[2,3,19,20,21,22,23,24]
var _={name_key:"FLOWERS_PURPLE",key:l,weighted:generateSimpleWeighted(l,[6,6,1,1,1,1,1,1])}
r.PURPLE_FLOWERS=_
var c={name_key:"FLOWERS_RED",key:[5,8]}
r.RED_FLOWERS=c
var u={name_key:"FLOWERS_ORANGE",key:[13,14,15,16,17,18]}
r.ORANGE_FLOWERS=u
var d={name_key:"MUSHROOMS_RED",key:[28,29],attr1:i.RED_MUSHROOM}
r.RED_MUSHROOMS=d
var f={name_key:"MUSHROOMS_BROWN",key:[30,31,32,33],attr1:i.BROWN_MUSHROOM}
r.BROWN_MUSHROOMS=f
var v={name_key:"MUSHROOMS_LUMINESCENT",key:[34,35,36],attr1:i.LUMINESCENT_MUSHROOM}
var h=[n,s,_,c,u,d,f,r.LUMINESCENT_MUSHROOMS=v]
r.FLOWERS=h
var p=[n,s,_,c,u].map(function(e){return e.key[0]})
r.FLOWER_SEEDS=p
var m=a(h.map(function(e){return e.key[0]}))
r.VALID_PLANT_SEEDS=m
var E=0
r.WILD_TOMATO=E
var g=1
r.WILD_CORN=g
var T=2
r.WILD_PUMPKIN=T
var y=3
r.WILD_WHEAT=y
var S=4
r.WILD_CARROT=S
var I=5
r.WILD_SUGAR_CANE=I
var A=1
r.SUNKEN_CHEST=A
function getPlantArrayFromTypes(e){var t=[]
for(var r=0;r<e.length;r++){var a=e[r].key
for(var i=0;i<a.length;i++)t.push(a[i])}return t}var w=getPlantArrayFromTypes([n,s,_,c,u])
r.ALL_FLOWERS=w},{"../common/materials_common":253,"../glov/common/util":400}],102:[function(e,t,r){"use strict"
r.delayedThrow=delayedThrow
r.frvrIsInitialized=frvrIsInitialized
r.frvrVideoAdsReady=frvrVideoAdsReady
r.frvrVideoAdsPlay=frvrVideoAdsPlay
r.frvrOnInitialized=frvrOnInitialized
r.frvrInit=frvrInit
r.AD_PLAY_ERROR_NOT_DISPLAYED=r.AD_PLAY_ERROR_SKIPPED=void 0
var a="completed"
var i="delivered"
r.AD_PLAY_ERROR_SKIPPED=i
var o="not_displayed"
r.AD_PLAY_ERROR_NOT_DISPLAYED=o
var n=e("assert")
var s=e("../glov/client/cmds").cmd_parse
var l=e("../glov/client/engine")
var _=e("../glov/client/engine")
var c=_.dirtyRenderSet
var u=_.engineSetReloadFunc
var d=e("../glov/client/environments").getCurrentEnvironment
var f=e("../glov/client/settings")
var v=e("../glov/client/sound")
var h=v.soundPause
var p=v.soundResume
var m=e("../glov/common/util")
var E=m.callEach
var g=m.callbackify
var T=m.errorString
var y=m.nop
var S=e("./analytics")
var I=S.analyticsOn
var A=S.logEvent
var w=e("./fbinstant_worlds")
var L=w.fbInstantPostInit
var O=w.fbInstantPostStart
var R=e("./platform_worlds_client").PLATFORM_FBINSTANT
var b=e("./worlds_soundscape")
var N=b.soundscapePause
var C=b.soundscapeResume
f.register({force_ads_available:{default_value:-1,type:s.TYPE_INT,range:[-1,1],access_show:["sysadmin"]}})
var x
function delayedThrow(e){if(!x){if(!((e=e||"ERR_UNKNOWN")instanceof Error))e=new Error(T(e))
x=e
setTimeout(function(){throw x},1)}}var M=false
var D=[]
function frvrIsInitialized(){return!D}function frvrVideoAdsReady(){if(-1!==f.force_ads_available)return Boolean(f.force_ads_available)
if(!frvrIsInitialized())return false
var e="reward"
return FRVR.ads&&FRVR.ads.isReady(e)||false}function playVideoAd(e,t){if(l.DEBUG&&l.defines.FAKEADS)setTimeout(function(){t(null,a)},2500)
else g(FRVR.ads.show.bind(FRVR.ads,e))(t)}function frvrVideoAdsPlay(r){var e="reward"
c(true)
N()
h()
playVideoAd(e,function(e,t){console.log("ad show result",e,t)
c(false)
p()
C()
if(!e&&t!==a)e=t||"unknown error"
r(e)})}function initCompleted(e,t){if(D){l.loadPendingDelta(-1)
E(D,D=null,M=e)
setTimeout(function(){if(I())A("ads_available",void 0,void 0,frvrVideoAdsReady()?"yes":"no")},3e4)}if(!e)delayedThrow(t)}var P=initCompleted.bind(null,true)
var B=initCompleted.bind(null,false)
function frvrOnInitialized(e){if(!D){e(M)
return}D.push(e)}var k=false
function frvrOnSuspend(){console.log("frvr-sdk","suspend")
if(k)return
k=true
if(0)N()}function frvrOnResume(){console.log("frvr-sdk","resume")
if(!k)return
if(k=false)C()}var U=false
function frvrOnAudioSuspend(){console.log("frvr-sdk","audio suspend")
if(U)return
U=true
if(0)h()}function frvrOnAudioResume(){console.log("frvr-sdk","audio resume")
if(!U)return
if(U=false)p()}function worldsPlatformReload(){if(R)try{window.top.location.reload()}catch(e){try{document.location.reload()}catch(e){if(window.FBInstant)window.FBInstant.quit()}}else if(window.discordSDK)window.discordSDK.close(1e3,"Application reload required")
else document.location.reload()}function frvrInit(){var i
u(worldsPlatformReload)
l.loadPendingDelta(1)
function postBootstrapComplete(){if(window.FBInstant)O()}function postBootstrapInit(){var e
if(window.FBInstant)e=L()
if(e)e.then(P,B)
else P()
clearInterval(i)
FRVR.bootstrapper.complete().then(postBootstrapComplete,delayedThrow)}function postSDKLoad(){try{if(R)if(!window.FBInstant){setTimeout(l.reloadSafe,5e3)
return}FRVR.lifecycle.onAudioSuspend=frvrOnAudioSuspend
FRVR.lifecycle.onAudioResume=frvrOnAudioResume
FRVR.lifecycle.onSuspend=frvrOnSuspend
FRVR.lifecycle.onResume=frvrOnResume
var e=d()
var t=e&&e.use_frvr_prod_api?"prod":"dev"
FRVR.init(t).then(y,delayedThrow)
n(FRVR.bootstrapper)
var r=1
var a=0
i=window.setInterval(function(){r*=.9
var e=Math.min(1-r,.99)
if(e!==a){a=e
FRVR.bootstrapper.setProgress(e)}},100)
FRVR.bootstrapper.init().then(postBootstrapInit,B)}catch(e){B(e)}}window.frvrPostLoad(function(){if(l.defines.DELAYSDK)setTimeout(postSDKLoad,5e3)
else postSDKLoad()})}},{"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/environments":310,"../glov/client/settings":351,"../glov/client/sound":358,"../glov/common/util":400,"./analytics":6,"./fbinstant_worlds":96,"./platform_worlds_client":160,"./worlds_soundscape":237,assert:void 0}],103:[function(e,t,r){"use strict"
r.fxUtilGradient=fxUtilGradient
r.fxUtilGlow=fxUtilGlow
var n=Math.sqrt,a=Math.round
var i=e("../glov/client/textures.js"),s=i.TEXTURE_FORMAT,l=i.textureLoad
var _=e("../glov/common/util.js").clamp
var o=64
var c
function fxUtilGradient(){if(!c){var e=new Uint8Array(4*o)
e.fill(255)
for(var t=0;t<o;++t)e[4*t+3]=a(255*t/o)
c=[l({name:"gradient",width:o,height:1,nozoom:true,format:s.RGBA8,data:e,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.REPEAT})]}return c}var u=32
var d
function fxUtilGlow(){if(!d){var e=new Uint8Array(u*u*4)
e.fill(255)
var t=(u-1)/2
for(var r=0;r<u;r++)for(var a=0;a<u;a++){var i=n((a-t)*(a-t)+(r-t)*(r-t))/t
var o=_(1-i,0,1)
e[4*(a+r*u)+3]=255*o}d=[l({url:"fx_util_circle",width:u,height:u,format:s.RGBA8,nozoom:true,data:e,filter_min:gl.LINEAR,filter_max:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})]}return d}},{"../glov/client/textures.js":365,"../glov/common/util.js":400}],104:[function(e,t,r){"use strict"
r.gemsHUD=gemsHUD
r.gemsHudOnGemClaimed=gemsHudOnGemClaimed
r.staminaBar=staminaBar
r.showStaminaMessage=showStaminaMessage
r.showStaminaDamage=showStaminaDamage
r.settlementBoundsShouldDraw=settlementBoundsShouldDraw
r.settlementVolumeBoundsShouldDraw=settlementVolumeBoundsShouldDraw
r.boostingWouldHelp=boostingWouldHelp
r.adventureHUD=adventureHUD
r.socialHUD=socialHUD
r.initHUDs=initHUDs
r.ATTRIB_BAR_H=r.ATTRIB_BAR_W=void 0
var u=e("assert")
var a=e("./layout")
var T=a.CORNER_BUTTON_MARGIN
var S=a.QUICKBAR_BORDER_PAD
var I=a.QUICKBAR_BOX_SIZE
u(I)
var A=400
r.ATTRIB_BAR_W=A
var w=(I-8)/3
r.ATTRIB_BAR_H=w
var L=e("../glov/client/camera2d")
var i=e("../glov/client/cmds").cmd_parse
var b=e("../glov/client/engine")
var N=e("../glov/client/font").ALIGN
var o=e("../glov/client/input")
var n=o.inputTouchMode
var s=o.pointerLockEnter
var l=e("../glov/client/net").netDisconnected
var O=e("../glov/client/settings")
var R=e("../glov/client/sound").soundPlayStreaming
var _=e("../glov/client/ui")
var c=_.button
var y=_.buttonShared
var C=_.drawHollowRect
var d=_.modalDialog
var f=_.modalDialogClear
var x=_.progressBar
var v=_.uiButtonHeight
var h=_.uiGetFont
var M=_.label
var D=_.uiTextHeight
var p=e("../glov/common/util")
var m=p.clamp
var P=p.easeIn
var B=p.easeInOut
var E=p.easeOut
var g=p.lerp
var k=p.map01
var U=e("../glov/common/vmath")
var G=U.v4clone
var F=U.vec4
var W=e("../common/ids")
var H=W.ITEM_ACCESS_CONTROL
var z=W.ITEM_WAYGATE
var V=W.TYPE_ITEM
var Y=e("../common/world_constants")
var j=Y.BOOST_MAX_LEVEL
var K=Y.WORLD_ACCESS_NONE
var q=e("./analytics").itemFlowEvent
var X=e("./build_mode").doStamina
var Q=e("./crafting_mods")
var $=Q.CMODS
var J=Q.CMOD_FORMAT
var ee=Q.CMOD_NAME
var te=e("./currency_shop").doVideoAd
var re=e("./editvolume_client")
var ae=re.inEditBounds
var ie=re.volumeCurrent
var oe=re.volumeIsSettlement
var ne=e("./energy_well").TIME_REFILL
var se=e("./frvr_sdk_worlds").frvrVideoAdsReady
var le=e("./layout")
var _e=le.layoutCameraFull
var ce=le.menuUpperLeft
var ue=le.quickbarOnTop
var de=e("./localization/localization").L
var fe=e("./main")
var ve=fe.charController
var he=fe.charControllerPos
var pe=fe.chatUI
var me=e("./menu_ribbon")
var Ee=me.getMenuRibbonXOuter
var ge=me.getMenuRibbonY1
var Te=e("./quickbar")
var ye=Te.quickbarGetSelected
var Se=Te.selectLightingInstructions
var Ie=e("./settlement")
var Ae=Ie.settlementCurrent
var we=Ie.settlementLastBound
var Le=e("./sky").skyGetSunBrightness
var Oe=e("./status")
var Re=e("./styles")
var be=Re.color_gray80
var Ne=Re.color_o2_bar
var Ce=Re.color_stamina_bar
var xe=Re.color_white
var Me=Re.colors_gems_free_bonus
var De=Re.floater_style
var Pe=Re.stamina_style
var Be=Re.style_gems
var ke=Re.style_wallet_gems_free
var Ue=Re.style_wallet_gems_free_focused
var Ge=e("./ui_util")
var Fe=e("./ui_util")
var We=Fe.GEM_SYMBOL
var He=Fe.STAMINA_SYMBOL
var ze=e("./user_data")
var Ve=ze.STAMINA_BASE_MAX
var Ye=ze.doOxygen
var je=ze.editOutsideVolumeAllowed
var Ke=ze.stamina_mods_table
var qe=ze.unlimitedItemsAllowed
var Ze=ze.userAttribs
var Xe=ze.userBuildAccessWait
var Qe=ze.userDataGemBonusClaimed
var $e=ze.userDataGemsFound
var Je=ze.userDataGet
var et=ze.userDataIsWaiting
var tt=ze.userDataPredict
var rt=ze.userO2Cur
var at=ze.userO2Max
var it=ze.userStaminaCur
var ot=ze.userStaminaMax
var nt=ze.worldReadOnly
var st=e("./world_comm")
var lt=st.getGemBalance
var _t=st.getWorldChannel
var ct=st.getWorldID
var ut=st.worldCommWhenConnectedToAnyWorld
var dt=st.worldGetRoles
var ft=e("./world_comm_effective_access").worldEffAccessGetSorted
var vt=e("./world_info").getWorldInfo
var ht=e("./world_info_view")
var pt=ht.numberFormat
var mt=ht.toggleLiked
var Et=e("./world_metadata")
var gt=Et.worldAmIBooster
var Tt=Et.worldBoostLevel
var yt=Et.worldBoostPerk
var St=Et.worldBuildQueue
var It=Et.worldHasGems
var At=Et.worldOwnerID
var wt=Et.worldSettlements
var Lt=Et.worldUserIsBoosting
var Ot=e("./worlds_sound").playSound
var Rt=J
var bt=Math.max,Nt=Math.min,Ct=Math.round
var xt
O.register({energy_verbose:{label:"Verbose ⚡ damage numbers",default_value:0,type:i.TYPE_INT,range:[0,1]},damage_fx:{label:"Intensity of ⚡ damage effects",default_value:1,type:i.TYPE_FLOAT,range:[0,1]}})
var Mt=0
function gemsHudResetCounters(){Mt=0}function gemsHudDoVideoAd(a){var i=ct()
te({type:"token",payload:{scope:"gembonus",world_id:i}},function(e,r){gemsHudResetCounters()
if(e)return
d({title:de.DLG_CLAIMING_BONUS_TITLE,text:de.MSG_PLEASE_WAIT})
ut(function(){if(ct()!==i){f()
return}var t=lt()
var e=_t().pak("gem_bonus")
e.writeAnsiString(r)
e.send(function(e){f()
gemsHudResetCounters()
pe().handleCmdParseError(e)
if(!e){q("gem","source",a,false,"gem_collect_bonus",t)
Ot("purchase")
tt("gem_bonus",1,true)
Oe.push(de.STATUSMSG_GEM_BONUS.$({label:""+a+We}))}})})})}var Dt=3e3
var Pt=3e4
function gemsHUD(){_e()
if(nt()&&It()&&!b.defines.NOUI){var e=L.w()/2
var t=8
var r=36
var a=$e()
var i=It()
if(a>=i){var o=Qe()
if(!Mt)Mt=b.frame_timestamp
var n=b.frame_timestamp-Mt
var s=1-m((n-(o?Dt:Pt))/2e3,0,1)
if(s){if(!o&&se()){var l=300
if(c({x:e-l/2,y:t,w:l,text:de.BTN_HUDS_GEM_BONUS_CLAIM.$({label:""+i+We}),colors:Me,font_style_normal:ke,font_style_focused:Ue,font_height:r,align:N.HVCENTERFIT|N.HWRAP,img:Ge.sprite,frame:Ge.VIDEO_AD}))gemsHudDoVideoAd(i)
t+=v()+8}xt.drawSizedAligned(xt.styleAlpha(Be,s),e,t,Z.GEMS_HUD,r,N.HCENTER,0,0,1===i?de.$(de.HUDS_GEM_FOUND_ONE,We):de.$(de.HUDS_GEM_FOUND_ALL,""+i+We))
t+=r+2
if(o)xt.drawSizedAligned(xt.styleAlpha(Be,s),e,t,Z.GEMS_HUD,.5*r,N.HCENTER,0,0,de.HUDS_GEM_BONUS_CLAIMED)}}else{xt.drawSizedAligned(De,e,t,Z.GEMS_HUD,r,N.HCENTER,0,0,de.HUDS_GEM_HIDDEN.$({gems:i}))
xt.drawSizedAligned(Be,e,t+=r+2,Z.GEMS_HUD,1.5*r,N.HCENTER,0,0,de.$(de.FORMAT_FRACTION,""+a+We,""+i+We))}}}var Bt=false
function gemsHudOnGemClaimed(){var e=$e()
var t=It()
if(e>=t&&!Qe()&&se()&&!Bt){var r=""+t+We
var a=ct()
d({title:de.DLG_GEM_BONUS_TITLE,text:de.DLG_GEM_BONUS_MSG.$({label:r}),button_width:200,buttons:{yes:{label:de.BTN_YESBANG+"\n+"+r,colors:Me,font_style_normal:ke,font_style_focused:Ue,font_height:30,img:Ge.sprite,shrink:.9,frame:Ge.VIDEO_AD,align:N.HVCENTERFIT|N.HWRAP,cb:gemsHudDoVideoAd.bind(null,t)},no:{label:de.BTN_NO_THANKS,font_height:30,cb:function cb(){gemsHudResetCounters()
Bt=true},in_event_cb:!n()?s:null}},tick:function tick(){if(l()||a!==ct())f()}})}}function blendingValue(a){var i=0
var o=0
var n=0
return function(e,t){if(t){i=e
n=0}if(i!==e){o=i
n=b.frame_timestamp
i=e}if(n){var r=b.frame_timestamp-n
if(r<a)return g(E(r/a,2),o,e)
else n=0}return e}}var kt=150
var Ut=1e3
var Gt=function(){function FadingBar(e){this.color=void 0
this.getCur=void 0
this.getMax=void 0
this.label=void 0
this.style=void 0
this.key=void 0
this.oversize_max=void 0
this.fade=0
this.last_value=0
this.last_change_time=0
this.last_frame=-Infinity
this.displayPercentileBar=void 0
this.displayPercentileLabel=void 0
this.displayWidth=void 0
this.color=G(e.color)
this.getCur=e.getCur
this.getMax=e.getMax
this.label=e.label
this.style=e.style
this.key=e.key
this.oversize_max=e.oversize_max
this.displayPercentileBar=blendingValue(250)
this.displayPercentileLabel=blendingValue(250)
this.displayWidth=blendingValue(250)}FadingBar.prototype.updateAndDraw=function updateAndDraw(e,t){var r,a
var i=t.w,o=t.h,n=t.x,s=t.z,l=t.verbose
var _=null==(r=t.always_show)?void 0:r[this.key]
var c=null==(a=t.oversize)?void 0:a[this.key]
var u=this.getMax()
var d=Nt(this.getCur(),u)
var f=d/u
var v=f<1||_
var h=this.last_frame<b.frame_index-2
if(h){this.fade=v?1:0
this.last_change_time=b.frame_timestamp
this.last_value=f}this.last_frame=b.frame_index
var p=1
var m=1
if(this.oversize_max)m=u/this.oversize_max
if(c){p=m
var E=this.displayWidth(i*p,h)
n-=(E-i)/2
i=E}if(this.last_value!==f){this.last_value=f
this.last_change_time=b.frame_timestamp}var g=this.displayPercentileBar(f,h)
var T=this.displayPercentileLabel(f*m,h)
var y=b.frame_timestamp-this.last_change_time
var S=v&&(f<.25||y<15e3)
if(_)this.fade=1
else if(S)this.fade=Nt(1,this.fade+b.frame_dt/kt)
else this.fade=bt(0,this.fade-b.frame_dt/Ut)
if(this.fade>0){this.color[3]=B(this.fade,2)
var I=de.$(de.FORMAT_FRACTION,Ct(d),de.separateWords(u,this.label))
var A=Ct(100*T)
if(T<p)A=Nt(A,Ct(100*p)-1)
if(T>0)A=bt(A,1)
var w=de.separateWords(de.addPercentage(A),this.label)
if(l){var L=w
w=I
I=L}var O={x:n,y:e,z:s,w:i,h:o,progress:g,tooltip:I,color:this.color}
x(O)
var R=this.style
if(this.fade<1)R=xt.styleAlpha(R,this.color[3])
xt.drawSizedAligned(R,O.x,O.y,s+2,.8*o,N.HVCENTERFIT,O.w,O.h,w)
e+=O.h+4}return e}
return FadingBar}()
var Ft=new Gt({key:"stamina",color:Ce,label:He,style:Pe,getCur:it,getMax:ot,oversize_max:Ve})
var Wt=new Gt({key:"o2",color:Ne,label:"O₂",style:Pe,getCur:rt,getMax:at})
function drawModOrAttrib(e,t,r){var a=e.x,i=e.z,o=e.w,n=e.font_height
var s=1
if(!s)return t
var l=De
if(s<1)l=xt.styleAlpha(l,s)
xt.drawSizedAligned(l,a,t,i,n,N.HCENTERFIT,o,0,r)
return t+n}function staminaBar(e){if(b.defines.NOUI||et())return e.y
var t=e.y,r=e.attrib_filter
if(X()){t=Ft.updateAndDraw(t,e)
if(!r&&Ye())t=Wt.updateAndDraw(t,e)}var a=nt()?{}:Ze()
for(var i in a){var o=Rt[i]
if(o&&(!r||i.match(r))&&(X()||!i.includes("stam")))t=drawModOrAttrib(e,t,""+o(a,i))}if(!r&&X())for(var n=0;n<Ke.length;n++){var s=Ke[n]
if(s[2])t=drawModOrAttrib(e,t,de.$(de.STATUSMSG_STAMINA_MODS,de.addColon(s[0]),de.addPercentage(100*s[1]),ee[$.STAMINA_RATE]))}return t}function showStaminaMessage(e){Oe.push(e)}var Ht=0
var zt=0
function showStaminaDamage(e,t){Ht=b.frame_timestamp
if(!e)return
var r=bt(Ct(100*e/Ve),1)
zt=m(k(r,1,5),0,1)
var a
if(!O.energy_verbose)a=de.addPercentage(r)
else a=e
showStaminaMessage(de.$(de.STATUSMSG_STAMINA_DAMAGE,""+a+He,t))}var Vt=0
var Yt=5e3
function isInTheDark(){var e=ve().lighting_values,t=e.torch_factor,r=e.sun_factor
if(!((Le()<.1||r<.02)&&t<.05)){Vt=0
return false}if(!Vt)Vt=b.frame_timestamp
if(b.frame_timestamp-Vt>Yt)return true
return false}var jt=F(.5,0,0,1)
var Kt=0
var qt=0
var Zt=""
var Xt
var Qt=false
var $t=25e3
var Jt=500
function settlementBoundsShouldDraw(){var e=ye()
if(!e||!e.is_settlement_locked)return false
return true}function settlementVolumeBoundsShouldDraw(){var e=ye()
if(!e)return false
if(e.type===V&&(e.id===z||e.id===H))return true
return false}function boostingWouldHelp(){var e=St()
if(!e)return null
var t=false
if(Tt()!==j)if(!e.threshold||yt("builder_limit")<e.threshold)t=true
var r=false
if(!e.manual&&!gt()&&!dt().world_admin){var a=ft(),i=a.sorted_users,o=a.online,n=a.threshold
var s=false
for(var l=0;l<i.length&&l<n;++l){var _=i[l]
var c=o[_]
u(c)
if(c<0)break
if(_!==At()&&!Lt(_)){s=true
break}}if(s)r=true}if(t||r)return{increase_limit:t,priority_queue:r}
return null}function adventureHUD(){_e()
var e=L.w()/2-A/2
var t=(ue()?S+I+4:0)+8
var r=Z.UI
var a=A
var i=w
var o=D()
t=staminaBar({x:e,y:t,w:a,h:i,z:r,font_height:o,oversize:{stamina:true}})
if(wt()){var n=Ae(false)
var s=!n
if(!n)n=Ae(true)
var l=n?s?de.$(de.HUDS_IN_OUTSKIRTS_OF,n.name):de.$(de.HUDS_IN_SETTLEMENT,n.name):de.HUDS_IN_THE_WILDS
var _=n&&!s&&n===we()
var c=Xt===b.frame_index-1
if(!c)Kt=0
if((l=String(l))!==Zt){Qt=false
if(c)if(Kt>1e4)Qt=true
Kt=0
Zt=l}if(_){if(qt&&c)if(b.frame_timestamp-qt>1e3*ne)R("fanfares/sapling_scenario",1,true)
qt=b.frame_timestamp}Xt=b.frame_index
Kt+=b.frame_dt
var u=Nt(1,Kt/Jt)
var d=bt(0,Nt(1,($t-Kt)/Jt))
var f=Nt(Qt?1:u,d)
if(f&&!b.defines.NOUI){f=B(f,2)
var v=o
if(Qt&&u<1)v*=2-P(u,2)
var h=xt.styleAlpha(De,f)
xt.drawSizedAligned(h,e,t,r,v,N.HCENTERFIT,a,0,l)
t+=o
if(!nt()&&n&&!n.buildAllowed()){xt.drawSizedAligned(h,e,t,r,o,N.HCENTERFIT,a,0,de.STATUSMSG_SETTLEMENT_NO_ACCESS)
t+=o}}}if(Ht){var p=1-(b.frame_timestamp-Ht)/300
if(p<0)Ht=0
else{p=P(p,2)
L.push()
L.setNormalized()
jt[3]=p*O.damage_fx*(.25+.75*zt)
C(0,0,1,1,.1,.25,0,jt)
L.pop()}}if(isInTheDark()&&!b.defines.NOUI){var m=Se()
if(m)Oe.get("dark").setMessage(de.$(de.STATUSMSG_ITS_DARK,m)).fade()}var E=Xe()
if(E>0){var g=""
var T=boostingWouldHelp()
if(T)g="\n"+(T.increase_limit&&T.priority_queue?de.STATUSMSG_BOOSTHELP_BOTH:T.increase_limit?de.STATUSMSG_BOOSTHELP_INCREASE_LIMIT:de.STATUSMSG_BOOSTHELP_PRIORITY_QUEUE).$({img:"[img=booster]"})
if(1===E)Oe.get("build_wait").setMessage(de.STATUSMSG_BUILD_WAIT_NEXT+g).fade()
else Oe.get("build_wait").setMessage(de.STATUSMSG_BUILD_WAIT.$({wait:E-1})+g).fade()}else if(!nt()&&je())if(!ae(he())){var y=ie()
if(y&&oe(y))Oe.get("build_wait").setMessage(de.STATUSMSG_BUILD_BLOCKED_SETTLEMENT).fade()
else Oe.get("build_wait").setMessage(de.STATUSMSG_BUILD_BLOCKED).fade()}}function socialHUD(){if(b.defines.NOUI)return
var e=vt(ct(),true)
if(!e)return
var t=e.stats,r=e.access_public,a=e.access_modify
if(!r)return
if(!qe()&&!nt())return
t=t||{}
var i=64
var o=1.5*D()
var n=Ee()+(ce()?6:-16-i)
var s=ce()?n+i+8:n-8
var l=ge()+T
var _=(i-o)/2
var c=Z.MENUBUTTON
var u=ce()?N.HLEFT:N.HRIGHT
var d=t.like||0
var f={x:n,y:l,z:c,w:i,h:i,pad_focusable:false}
var v=a===K&&!nt()
if(d||!v){var h=Je("liked")
f.tooltip=h?de.TLTP_WORLD_LIKED:de.TLTP_WORLD_CLICK_TO_LIKE
var p=y(f),m=p.ret
var E="regular"!==p.state
f.color=E?be:xe
f.frame=h?Ge.LIKE_ACTIVE:Ge.LIKE
if(m)mt(t)
Ge.sprite.draw(f)
xt.drawSizedAligned(De,s,l+_,c,o,u,0,0,pt(d))
l+=i+8}var g=t.visit_count||0
if(g){f.y=l
f.color=xe
f.frame=Ge.VIEWS
f.tooltip=de.TLTP_WORLD_TIMES_VIEWED.$({views:g})
f.img=Ge.sprite
M(f)
xt.drawSizedAligned(De,s,l+_,c,o,u,0,0,pt(g))}}function initHUDs(){gemsHudResetCounters()
Kt=Ht=0
qt=b.frame_timestamp
xt=h()}},{"../common/ids":249,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/settings":351,"../glov/client/sound":358,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./build_mode":33,"./crafting_mods":67,"./currency_shop":72,"./editvolume_client":84,"./energy_well":85,"./frvr_sdk_worlds":102,"./layout":120,"./localization/localization":131,"./main":135,"./menu_ribbon":141,"./quickbar":172,"./settlement":181,"./sky":188,"./status":193,"./styles":197,"./ui_util":205,"./user_data":208,"./world_comm":226,"./world_comm_effective_access":227,"./world_info":229,"./world_info_view":231,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],105:[function(e,t,r){"use strict"
r.dmcaShow=r.dmcaHide=r.gdprShow=r.gdprHide=r.termsOfServiceShow=r.termsOfServiceHide=r.privacyPolicyShow=r.privacyPolicyHide=r.changelogShow=r.changelogHide=void 0
var n=e("../glov/client/engine")
var s=e("../glov/client/urlhash")
var l=e("./layout").isTopRightCornerReserved
var a=e("./localization/localization").L
var i=e("./main_menu")
var o=i.URL_DMCA
var _=i.URL_GDPR
var c=i.URL_PRIVACY
var u=i.URL_TOS
function buildIframeContentHandlers(i,e){var o=e.urlhashKey,t=e.customPageTitle,r=e.customRoute
function hide(e){if(!e)s.set(o,"")
document.getElementById("iframecontainer").style.display="none"
var t=document.getElementById("iframe")
if(t)t.src="about:blank"
n.disableRender(false)}function show(e){if(!document.getElementById("iframecontainer"))return
if(!e)s.set(o,"1")
document.getElementById("iframecontainer").style.display="block"
var t=document.getElementById("iframe")
if(t.src!==i)t.src=i
var r=document.getElementById("iframecancel")
var a=l()
r.style.left=a?"0":"auto"
r.style.right=a?"auto":"0"
r.onclick=hide.bind(null,false)
n.disableRender(true)}s.register({key:o,title:function title(){return t},push:true,route_only:true,change:function change(e){if(e)show(true)
else hide(true)}})
if(r)s.routeFixed(r,o)
return{hide:hide,show:show}}var d=buildIframeContentHandlers(s.getURLBase()+"changelog.html",{urlhashKey:"cl",customPageTitle:a.PAGETITLE_UPDATES,customRoute:"changelog.html"}),f=d.hide,v=d.show
r.changelogShow=v
r.changelogHide=f
window.changelogHide=f
var h=buildIframeContentHandlers(c,{urlhashKey:"pp",customPageTitle:a.PAGETITLE_PRIVACY_POLICY}),p=h.hide,m=h.show
r.privacyPolicyShow=m
r.privacyPolicyHide=p
var E=buildIframeContentHandlers(u,{urlhashKey:"tos",customPageTitle:a.PAGETITLE_TERMS_OF_SERVICE}),g=E.hide,T=E.show
r.termsOfServiceShow=T
r.termsOfServiceHide=g
var y=buildIframeContentHandlers(_,{urlhashKey:"gdpr",customPageTitle:a.PAGETITLE_GDPR}),S=y.hide,I=y.show
r.gdprShow=I
r.gdprHide=S
var A=buildIframeContentHandlers(o,{urlhashKey:"dmca",customPageTitle:a.PAGETITLE_DMCA}),w=A.hide,L=A.show
r.dmcaShow=L
r.dmcaHide=w},{"../glov/client/engine":305,"../glov/client/urlhash":369,"./layout":120,"./localization/localization":131,"./main_menu":136}],106:[function(e,t,r){t.exports={font_size:24,imageW:1024,imageH:1024,spread:6,channels:1,char_infos:[{c:1,xpad:3.92578,sc:.833333},{c:2,xpad:3.92578,sc:.833333},{c:3,xpad:3.92578,sc:.833333},{c:4,xpad:3.92578,sc:.833333},{c:5,xpad:3.92578,sc:.833333},{c:6,xpad:3.92578,sc:.833333},{c:7,xpad:3.92578,sc:.833333},{c:8,xpad:3.92578,sc:.833333},{c:9,xpad:3.92578,sc:.833333},{c:10,xpad:3.92578,sc:.833333},{c:11,xpad:3.92578,sc:.833333},{c:12,xpad:3.92578,sc:.833333},{c:13,xpad:3.92578,sc:.833333},{c:14,xpad:3.92578,sc:.833333},{c:15,xpad:3.92578,sc:.833333},{c:16,xpad:3.92578,sc:.833333},{c:17,xpad:3.92578,sc:.833333},{c:18,xpad:3.92578,sc:.833333},{c:19,xpad:3.92578,sc:.833333},{c:20,xpad:3.92578,sc:.833333},{c:21,xpad:3.92578,sc:.833333},{c:22,xpad:3.92578,sc:.833333},{c:23,xpad:3.92578,sc:.833333},{c:24,xpad:3.92578,sc:.833333},{c:25,xpad:3.92578,sc:.833333},{c:26,xpad:3.92578,sc:.833333},{c:27,xpad:3.92578,sc:.833333},{c:28,xpad:3.92578,sc:.833333},{c:29,xpad:3.92578,sc:.833333},{c:30,xpad:3.92578,sc:.833333},{c:31,xpad:3.92578,sc:.833333},{c:32,xpad:5.21484},{c:33,x0:92,y0:198,yoffs:4,xpad:1.48633,w:5,h:16},{c:34,x0:74,y0:961,yoffs:4,xpad:.40625,w:10,h:8},{c:35,x0:963,y0:812,yoffs:9,w:15,h:11},{c:36,x0:6,y0:6,yoffs:1,xpad:1.07813,w:12,h:23},{c:37,x0:151,y0:42,yoffs:2,xpad:.425781,w:20,h:20},{c:38,x0:110,y0:198,yoffs:4,xpad:.677734,w:23,h:16},{c:39,x0:97,y0:961,yoffs:4,xpad:.701172,w:5,h:8},{c:40,x0:31,y0:6,yoffs:1,xpad:.621094,w:9,h:23},{c:41,x0:53,y0:6,yoffs:1,xpad:.621094,w:9,h:23},{c:42,x0:888,y0:662,yoffs:4,xpad:.0429688,w:13,h:12},{c:43,x0:461,y0:867,yoffs:9,w:10,h:9},{c:44,x0:484,y0:867,yoffs:16,xpad:.914063,w:6,h:9},{c:45,x0:620,y0:973,yoffs:12,xpad:.585938,w:9,h:3},{c:46,x0:106,y0:982,yoffs:16,xpad:1.28125,w:5,h:4},{c:47,x0:220,y0:6,yoffs:1,w:7,h:22},{c:48,x0:146,y0:198,yoffs:4,xpad:.626953,w:12,h:16},{c:49,x0:171,y0:197,yoffs:4,xpad:.626953,w:12,h:16},{c:50,x0:196,y0:197,yoffs:4,xpad:.626953,w:12,h:16},{c:51,x0:221,y0:197,yoffs:4,xpad:.626953,w:12,h:16},{c:52,x0:246,y0:196,yoffs:4,xpad:.626953,w:12,h:16},{c:53,x0:271,y0:196,yoffs:4,xpad:.626953,w:12,h:16},{c:54,x0:296,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:55,x0:321,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:56,x0:346,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:57,x0:371,y0:195,yoffs:4,xpad:.626953,w:12,h:16},{c:58,x0:991,y0:812,yoffs:9,xpad:1.28125,w:5,h:11},{c:59,x0:396,y0:195,yoffs:9,xpad:.914063,w:6,h:16},{c:60,x0:503,y0:866,yoffs:9,w:9,h:9},{c:61,x0:721,y0:952,yoffs:11,w:10,h:5},{c:62,x0:86,y0:871,yoffs:9,w:9,h:10},{c:63,x0:415,y0:195,yoffs:4,xpad:.322266,w:9,h:16},{c:64,x0:31,y0:42,yoffs:4,xpad:.634766,w:25,h:21},{c:65,x0:437,y0:194,yoffs:4,w:18,h:16},{c:66,x0:468,y0:194,yoffs:4,xpad:.800781,w:14,h:16},{c:67,x0:495,y0:194,yoffs:4,xpad:.451172,w:15,h:16},{c:68,x0:523,y0:194,yoffs:4,xpad:.857422,w:16,h:16},{c:69,x0:552,y0:194,yoffs:4,xpad:1.26367,w:14,h:16},{c:70,x0:579,y0:194,yoffs:4,xpad:.519531,w:14,h:16},{c:71,x0:606,y0:194,yoffs:4,xpad:.25,w:17,h:16},{c:72,x0:636,y0:194,yoffs:4,xpad:.0703125,w:18,h:16},{c:73,x0:667,y0:194,yoffs:4,xpad:.355469,w:8,h:16},{c:74,x0:69,y0:42,yoffs:4,xpad:.015625,w:8,h:21},{c:75,x0:688,y0:194,yoffs:4,w:17,h:16},{c:76,x0:718,y0:194,yoffs:4,xpad:.742188,w:14,h:16},{c:77,x0:745,y0:194,yoffs:4,xpad:.572266,w:20,h:16},{c:78,x0:778,y0:193,yoffs:4,xpad:.517578,w:16,h:16},{c:79,x0:807,y0:193,yoffs:4,xpad:.601563,w:17,h:16},{c:80,x0:837,y0:193,yoffs:4,xpad:.648438,w:14,h:16},{c:81,x0:90,y0:42,yoffs:4,w:20,h:21},{c:82,x0:864,y0:193,yoffs:4,w:16,h:16},{c:83,x0:893,y0:193,yoffs:4,xpad:1.07813,w:12,h:16},{c:84,x0:918,y0:193,yoffs:4,xpad:.638672,w:15,h:16},{c:85,x0:946,y0:193,yoffs:4,w:17,h:16},{c:86,x0:976,y0:193,yoffs:4,w:18,h:16},{c:87,x0:6,y0:229,yoffs:4,w:24,h:16},{c:88,x0:43,y0:229,yoffs:4,xpad:.40625,w:16,h:16},{c:89,x0:72,y0:229,yoffs:4,w:17,h:16},{c:90,x0:102,y0:227,yoffs:4,xpad:.759766,w:14,h:16},{c:91,x0:75,y0:6,yoffs:1,xpad:.126953,w:8,h:23},{c:92,x0:240,y0:6,yoffs:1,w:7,h:22},{c:93,x0:96,y0:6,yoffs:1,xpad:1.12695,w:7,h:23},{c:94,x0:108,y0:871,yoffs:5,xpad:.490234,w:11,h:10},{c:95,x0:150,y0:998,yoffs:21,xpad:.492188,w:9,h:2},{c:96,x0:744,y0:952,yoffs:2,xpad:.101563,w:7,h:5},{c:97,x0:6,y0:847,yoffs:9,w:12,h:11},{c:98,x0:117,y0:107,yoffs:3,xpad:.359375,w:13,h:17},{c:99,x0:31,y0:847,yoffs:9,xpad:.642578,w:11,h:11},{c:100,x0:143,y0:107,yoffs:3,xpad:.359375,w:13,h:17},{c:101,x0:55,y0:847,yoffs:9,xpad:1.14648,w:11,h:11},{c:102,x0:694,y0:41,yoffs:2,w:11,h:18},{c:103,x0:129,y0:227,yoffs:9,w:12,h:16},{c:104,x0:169,y0:107,yoffs:3,xpad:.248047,w:13,h:17},{c:105,x0:195,y0:106,yoffs:3,xpad:.417969,w:7,h:17},{c:106,x0:260,y0:6,yoffs:3,xpad:1.13672,w:6,h:22},{c:107,x0:215,y0:106,yoffs:3,xpad:.212891,w:13,h:17},{c:108,x0:241,y0:106,yoffs:3,xpad:.0429688,w:7,h:17},{c:109,x0:79,y0:847,yoffs:9,w:20,h:11},{c:110,x0:112,y0:847,yoffs:9,w:14,h:11},{c:111,x0:139,y0:847,yoffs:9,xpad:.726563,w:12,h:11},{c:112,x0:154,y0:227,yoffs:9,xpad:.921875,w:13,h:16},{c:113,x0:180,y0:226,yoffs:9,w:14,h:16},{c:114,x0:164,y0:847,yoffs:9,w:11,h:11},{c:115,x0:188,y0:847,yoffs:9,xpad:.447266,w:10,h:11},{c:116,x0:655,y0:339,yoffs:5,w:9,h:15},{c:117,x0:211,y0:847,yoffs:9,xpad:.212891,w:13,h:11},{c:118,x0:237,y0:846,yoffs:9,w:12,h:11},{c:119,x0:262,y0:846,yoffs:9,xpad:.226563,w:17,h:11},{c:120,x0:292,y0:846,yoffs:9,w:12,h:11},{c:121,x0:207,y0:226,yoffs:9,w:12,h:16},{c:122,x0:317,y0:846,yoffs:9,xpad:.677734,w:11,h:11},{c:123,x0:116,y0:6,yoffs:1,xpad:1.26953,w:8,h:23},{c:124,x0:137,y0:6,yoffs:1,xpad:1.97266,w:5,h:23},{c:125,x0:155,y0:6,yoffs:1,xpad:.269531,w:9,h:23},{c:126,x0:764,y0:952,yoffs:11,xpad:.771484,w:11,h:5},{c:160,xpad:5.21484},{c:161,x0:232,y0:226,yoffs:9,xpad:.445313,w:6,h:16},{c:162,x0:365,y0:41,yoffs:5,xpad:.642578,w:11,h:19},{c:163,x0:251,y0:225,yoffs:4,xpad:.470703,w:13,h:16},{c:164,x0:277,y0:225,yoffs:4,xpad:.722656,w:16,h:16},{c:165,x0:306,y0:224,yoffs:4,w:17,h:16},{c:166,x0:177,y0:6,yoffs:1,xpad:1.97266,w:5,h:23},{c:167,x0:86,y0:539,yoffs:3,xpad:.898438,sc:.833333,w:10,h:15},{c:168,x0:926,y0:983,yoffs:3,xpad:1.32617,sc:.833333,w:8,h:3},{c:169,x0:913,y0:661,yoffs:3,xpad:.991211,sc:.833333,w:15,h:14},{c:170,x0:171,y0:997,yoffs:6,xpad:1.62793,sc:.833333,w:7,h:4},{c:171,x0:607,y0:953,yoffs:8,xpad:.854492,sc:.833333,w:10,h:8},{c:172,x0:641,y0:972,yoffs:10,xpad:.999023,sc:.833333,w:8,h:5},{c:173,x0:945,y0:983,yoffs:10,xpad:.988281,sc:.833333,w:7,h:3},{c:174,x0:939,y0:661,yoffs:3,xpad:.834961,sc:.833333,w:15,h:14},{c:175,x0:425,y0:1011,yoffs:3,xpad:.34082,sc:.833333,w:9,h:2},{c:176,x0:123,y0:981,yoffs:2,xpad:.713867,sc:.833333,w:6,h:6},{c:177,x0:524,y0:865,yoffs:7,xpad:.31543,sc:.833333,w:8,h:11},{c:178,x0:787,y0:950,yoffs:3,sc:.833333,w:8,h:7},{c:179,x0:114,y0:960,yoffs:3,xpad:.241211,sc:.833333,w:7,h:10},{c:180,x0:189,y0:997,yoffs:2,sc:.833333,w:6,h:4},{c:181,x0:965,y0:661,yoffs:7,sc:.833333,w:11,h:14},{c:182,x0:335,y0:223,yoffs:3,xpad:.046875,sc:.833333,w:13,h:18},{c:183,x0:206,y0:997,yoffs:10,xpad:.234375,sc:.833333,w:5,h:4},{c:184,x0:806,y0:950,yoffs:14,xpad:1.34082,sc:.833333,w:8,h:7},{c:185,x0:825,y0:950,yoffs:3,xpad:.650391,sc:.833333,w:6,h:7},{c:186,x0:222,y0:997,yoffs:6,xpad:1.31152,sc:.833333,w:8,h:4},{c:187,x0:628,y0:953,yoffs:8,sc:.833333,w:11,h:8},{c:188,x0:717,y0:40,sc:.833333,w:17,h:20},{c:189,x0:745,y0:40,sc:.833333,w:18,h:20},{c:190,x0:774,y0:40,sc:.833333,w:17,h:20},{c:191,x0:360,y0:224,yoffs:9,w:9,h:16},{c:192,x0:279,y0:6,yoffs:-2,w:18,h:22},{c:193,x0:310,y0:6,yoffs:-2,w:18,h:22},{c:194,x0:341,y0:6,yoffs:-2,w:18,h:22},{c:195,x0:372,y0:6,yoffs:-2,w:18,h:22},{c:196,x0:403,y0:6,yoffs:-2,w:18,h:22},{c:197,x0:434,y0:6,yoffs:-2,w:18,h:22},{c:198,x0:382,y0:224,yoffs:4,w:21,h:16},{c:199,x0:123,y0:42,yoffs:4,xpad:.451172,w:15,h:21},{c:200,x0:465,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:201,x0:492,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:202,x0:519,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:203,x0:546,y0:6,yoffs:-2,xpad:1.26367,w:14,h:22},{c:204,x0:573,y0:6,yoffs:-2,xpad:.355469,w:8,h:22},{c:205,x0:594,y0:6,yoffs:-2,w:9,h:22},{c:206,x0:616,y0:6,yoffs:-2,w:10,h:22},{c:207,x0:184,y0:42,xpad:.355469,w:8,h:20},{c:208,x0:416,y0:224,yoffs:4,xpad:.857422,w:16,h:16},{c:209,x0:639,y0:6,yoffs:-2,xpad:.517578,w:16,h:22},{c:210,x0:668,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:211,x0:698,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:212,x0:728,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:213,x0:758,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:214,x0:788,y0:6,yoffs:-2,xpad:.601563,w:17,h:22},{c:215,x0:544,y0:866,yoffs:9,xpad:.662109,w:9,h:9},{c:216,x0:818,y0:6,yoffs:1,xpad:.601563,w:17,h:22},{c:217,x0:848,y0:6,yoffs:-2,w:17,h:22},{c:218,x0:878,y0:6,yoffs:-2,w:17,h:22},{c:219,x0:908,y0:6,yoffs:-2,w:17,h:22},{c:220,x0:938,y0:6,yoffs:-2,w:17,h:22},{c:221,x0:968,y0:6,yoffs:-2,w:17,h:22},{c:222,x0:445,y0:223,yoffs:4,xpad:.554688,w:14,h:16},{c:223,x0:803,y0:41,yoffs:2,xpad:.835938,w:14,h:18},{c:224,x0:830,y0:41,yoffs:2,w:12,h:18},{c:225,x0:855,y0:41,yoffs:2,w:12,h:18},{c:226,x0:880,y0:41,yoffs:2,w:12,h:18},{c:227,x0:905,y0:41,yoffs:2,w:12,h:18},{c:228,x0:261,y0:105,yoffs:3,w:12,h:17},{c:229,x0:930,y0:41,yoffs:2,w:12,h:18},{c:230,x0:341,y0:846,yoffs:9,xpad:.361328,w:17,h:11},{c:231,x0:472,y0:223,yoffs:9,xpad:.642578,w:11,h:16},{c:232,x0:955,y0:41,yoffs:2,xpad:1.14648,w:11,h:18},{c:233,x0:979,y0:41,yoffs:2,xpad:1.14648,w:11,h:18},{c:234,x0:1003,y0:41,yoffs:2,xpad:1.14648,w:11,h:18},{c:235,x0:286,y0:105,yoffs:3,xpad:1.14648,w:11,h:17},{c:236,x0:6,y0:77,yoffs:2,w:8,h:18},{c:237,x0:27,y0:77,yoffs:2,w:8,h:18},{c:238,x0:48,y0:76,yoffs:2,w:10,h:18},{c:239,x0:310,y0:105,yoffs:3,w:9,h:17},{c:240,x0:71,y0:76,yoffs:2,xpad:.539063,w:12,h:18},{c:241,x0:96,y0:76,yoffs:2,w:14,h:18},{c:242,x0:123,y0:76,yoffs:2,xpad:.726563,w:12,h:18},{c:243,x0:148,y0:76,yoffs:2,xpad:.726563,w:12,h:18},{c:244,x0:173,y0:75,yoffs:2,xpad:.726563,w:12,h:18},{c:245,x0:198,y0:75,yoffs:2,xpad:.726563,w:12,h:18},{c:246,x0:332,y0:105,yoffs:3,xpad:.726563,w:12,h:17},{c:247,x0:988,y0:661,yoffs:8,w:10,h:12},{c:248,x0:357,y0:105,yoffs:6,xpad:.726563,w:12,h:17},{c:249,x0:223,y0:75,yoffs:2,xpad:.212891,w:13,h:18},{c:250,x0:249,y0:74,yoffs:2,xpad:.212891,w:13,h:18},{c:251,x0:275,y0:74,yoffs:2,xpad:.212891,w:13,h:18},{c:252,x0:382,y0:105,yoffs:3,xpad:.212891,w:13,h:17},{c:253,x0:195,y0:6,yoffs:2,w:12,h:23},{c:254,x0:998,y0:6,yoffs:3,xpad:.529297,w:13,h:22},{c:255,x0:6,y0:42,yoffs:3,w:12,h:22},{c:256,x0:495,y0:222,yoffs:-1,sc:.833333,w:15,h:18},{c:257,x0:5,y0:696,yoffs:3,sc:.833333,w:10,h:14},{c:258,x0:407,y0:103,yoffs:-2,sc:.833333,w:15,h:19},{c:259,x0:107,y0:539,yoffs:2,sc:.833333,w:10,h:15},{c:260,x0:521,y0:222,yoffs:3,sc:.833333,w:15,h:18},{c:261,x0:26,y0:696,yoffs:7,sc:.833333,w:10,h:14},{c:262,x0:433,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:263,x0:128,y0:539,yoffs:2,xpad:.702148,sc:.833333,w:9,h:15},{c:264,x0:547,y0:222,yoffs:-1,xpad:.420898,sc:.833333,w:11,h:18},{c:265,x0:148,y0:539,yoffs:2,xpad:.213867,sc:.833333,w:9,h:15},{c:266,x0:457,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:267,x0:168,y0:539,yoffs:2,xpad:.702148,sc:.833333,w:9,h:15},{c:268,x0:481,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:269,x0:188,y0:539,yoffs:2,xpad:.702148,sc:.833333,w:9,h:15},{c:270,x0:505,y0:103,yoffs:-2,xpad:.0478516,sc:.833333,w:14,h:19},{c:271,x0:208,y0:539,yoffs:2,sc:.833333,w:14,h:15},{c:272,x0:47,y0:696,yoffs:3,xpad:.0478516,sc:.833333,w:14,h:14},{c:273,x0:233,y0:537,yoffs:2,sc:.833333,w:12,h:15},{c:274,x0:569,y0:222,yoffs:-1,xpad:.719727,sc:.833333,w:12,h:18},{c:275,x0:72,y0:696,yoffs:3,xpad:.12207,sc:.833333,w:10,h:14},{c:276,x0:592,y0:222,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:277,x0:256,y0:536,yoffs:2,xpad:.595703,sc:.833333,w:10,h:15},{c:278,x0:530,y0:103,yoffs:-2,xpad:.719727,sc:.833333,w:12,h:19},{c:279,x0:277,y0:536,yoffs:2,xpad:.12207,sc:.833333,w:10,h:15},{c:280,x0:612,y0:222,yoffs:3,xpad:.719727,sc:.833333,w:12,h:18},{c:281,x0:93,y0:696,yoffs:7,xpad:.12207,sc:.833333,w:10,h:14},{c:282,x0:553,y0:103,yoffs:-2,xpad:.719727,sc:.833333,w:12,h:19},{c:283,x0:298,y0:536,yoffs:2,xpad:.12207,sc:.833333,w:10,h:15},{c:284,x0:635,y0:222,yoffs:-1,xpad:.978516,sc:.833333,w:12,h:18},{c:285,x0:576,y0:103,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:286,x0:597,y0:103,yoffs:-2,xpad:.375,sc:.833333,w:14,h:19},{c:287,x0:622,y0:103,yoffs:2,sc:.833333,w:10,h:19},{c:288,x0:643,y0:103,yoffs:-2,xpad:.375,sc:.833333,w:14,h:19},{c:289,x0:668,y0:103,yoffs:2,sc:.833333,w:10,h:19},{c:290,x0:658,y0:222,yoffs:3,xpad:.375,sc:.833333,w:14,h:18},{c:291,x0:300,y0:73,yoffs:1,sc:.833333,w:10,h:20},{c:292,x0:683,y0:222,yoffs:-1,xpad:.71582,sc:.833333,w:13,h:18},{c:293,x0:689,y0:103,yoffs:-2,sc:.833333,w:13,h:19},{c:294,x0:114,y0:696,yoffs:3,sc:.833333,w:16,h:14},{c:295,x0:319,y0:536,yoffs:2,xpad:.0400391,sc:.833333,w:11,h:15},{c:296,x0:707,y0:222,yoffs:-1,sc:.833333,w:8,h:18},{c:297,x0:454,y0:452,yoffs:1,sc:.833333,w:9,h:16},{c:298,x0:726,y0:222,yoffs:-1,sc:.833333,w:9,h:18},{c:299,x0:141,y0:695,yoffs:3,sc:.833333,w:8,h:14},{c:300,x0:746,y0:222,yoffs:-1,sc:.833333,w:7,h:18},{c:301,x0:341,y0:536,yoffs:2,sc:.833333,w:8,h:15},{c:302,x0:764,y0:222,yoffs:3,sc:.833333,w:7,h:18},{c:303,x0:713,y0:103,yoffs:2,xpad:.181641,sc:.833333,w:6,h:19},{c:304,x0:730,y0:102,yoffs:-2,sc:.833333,w:7,h:19},{c:305,x0:132,y0:959,yoffs:7,xpad:.181641,sc:.833333,w:6,h:10},{c:306,x0:782,y0:221,yoffs:3,xpad:.642578,sc:.833333,w:13,h:18},{c:307,x0:748,y0:102,yoffs:2,xpad:1.12891,sc:.833333,w:11,h:19},{c:308,x0:388,y0:40,yoffs:-1,sc:.833333,w:9,h:21},{c:309,x0:770,y0:102,yoffs:2,sc:.833333,w:9,h:19},{c:310,x0:806,y0:221,yoffs:3,sc:.833333,w:14,h:18},{c:311,x0:790,y0:102,yoffs:2,xpad:.0107422,sc:.833333,w:11,h:19},{c:312,x0:565,y0:865,yoffs:6,sc:.833333,w:12,h:11},{c:313,x0:812,y0:102,yoffs:-2,xpad:.285156,sc:.833333,w:12,h:19},{c:314,x0:321,y0:73,yoffs:-3,sc:.833333,w:7,h:20},{c:315,x0:831,y0:221,yoffs:3,xpad:.285156,sc:.833333,w:12,h:18},{c:316,x0:835,y0:102,yoffs:2,sc:.833333,w:6,h:19},{c:317,x0:160,y0:695,yoffs:3,xpad:.285156,sc:.833333,w:12,h:14},{c:318,x0:360,y0:535,yoffs:2,sc:.833333,w:8,h:15},{c:319,x0:183,y0:695,yoffs:3,xpad:.285156,sc:.833333,w:12,h:14},{c:320,x0:379,y0:535,yoffs:2,sc:.833333,w:9,h:15},{c:321,x0:206,y0:695,yoffs:3,xpad:.207031,sc:.833333,w:12,h:14},{c:322,x0:399,y0:535,yoffs:2,sc:.833333,w:8,h:15},{c:323,x0:852,y0:102,yoffs:-2,sc:.833333,w:14,h:19},{c:324,x0:418,y0:535,yoffs:2,sc:.833333,w:12,h:15},{c:325,x0:854,y0:221,yoffs:3,sc:.833333,w:14,h:18},{c:326,x0:229,y0:695,yoffs:7,sc:.833333,w:12,h:14},{c:327,x0:877,y0:102,yoffs:-2,sc:.833333,w:14,h:19},{c:328,x0:441,y0:535,yoffs:2,sc:.833333,w:12,h:15},{c:329,x0:252,y0:695,yoffs:3,xpad:.803711,sc:.833333,w:13,h:14},{c:330,x0:879,y0:221,yoffs:3,sc:.833333,w:14,h:18},{c:331,x0:276,y0:695,yoffs:7,xpad:1.33789,sc:.833333,w:10,h:14},{c:332,x0:904,y0:221,yoffs:-1,xpad:.667969,sc:.833333,w:14,h:18},{c:333,x0:297,y0:693,yoffs:3,xpad:.605469,sc:.833333,w:10,h:14},{c:334,x0:929,y0:221,yoffs:-1,xpad:.320313,sc:.833333,w:13,h:18},{c:335,x0:474,y0:452,yoffs:1,sc:.833333,w:11,h:16},{c:336,x0:902,y0:102,yoffs:-2,xpad:.667969,sc:.833333,w:14,h:19},{c:337,x0:464,y0:535,yoffs:2,sc:.833333,w:11,h:15},{c:338,x0:318,y0:692,yoffs:3,xpad:1.30664,sc:.833333,w:18,h:14},{c:339,x0:149,y0:959,yoffs:7,xpad:.336914,sc:.833333,w:15,h:10},{c:340,x0:927,y0:102,yoffs:-2,sc:.833333,w:13,h:19},{c:341,x0:486,y0:534,yoffs:2,sc:.833333,w:9,h:15},{c:342,x0:953,y0:221,yoffs:3,sc:.833333,w:13,h:18},{c:343,x0:347,y0:692,yoffs:7,sc:.833333,w:9,h:14},{c:344,x0:951,y0:102,yoffs:-2,sc:.833333,w:13,h:19},{c:345,x0:506,y0:533,yoffs:2,sc:.833333,w:9,h:15},{c:346,x0:975,y0:102,yoffs:-2,xpad:.898438,sc:.833333,w:10,h:19},{c:347,x0:526,y0:533,yoffs:2,xpad:.706055,sc:.833333,w:8,h:15},{c:348,x0:977,y0:221,yoffs:-1,sc:.833333,w:10,h:18},{c:349,x0:545,y0:533,yoffs:2,sc:.833333,w:9,h:15},{c:350,x0:998,y0:221,yoffs:3,xpad:.898438,sc:.833333,w:10,h:18},{c:351,x0:367,y0:692,yoffs:7,xpad:.706055,sc:.833333,w:8,h:14},{c:352,x0:996,y0:102,yoffs:-2,xpad:.898438,sc:.833333,w:10,h:19},{c:353,x0:565,y0:533,yoffs:2,sc:.833333,w:9,h:15},{c:354,x0:5,y0:257,yoffs:3,xpad:.0322266,sc:.833333,w:13,h:18},{c:355,x0:676,y0:338,yoffs:4,sc:.833333,w:8,h:17},{c:356,x0:5,y0:138,yoffs:-2,xpad:.0322266,sc:.833333,w:13,h:19},{c:357,x0:585,y0:532,yoffs:2,sc:.833333,w:8,h:15},{c:358,x0:386,y0:692,yoffs:3,xpad:.0322266,sc:.833333,w:13,h:14},{c:359,x0:370,y0:843,yoffs:4,sc:.833333,w:8,h:13},{c:360,x0:29,y0:257,yoffs:-1,xpad:.939453,sc:.833333,w:12,h:18},{c:361,x0:496,y0:452,yoffs:1,xpad:1.02051,sc:.833333,w:10,h:16},{c:362,x0:52,y0:257,yoffs:-1,sc:.833333,w:14,h:18},{c:363,x0:410,y0:692,yoffs:3,xpad:.0107422,sc:.833333,w:11,h:14},{c:364,x0:77,y0:257,yoffs:-1,xpad:.939453,sc:.833333,w:12,h:18},{c:365,x0:517,y0:452,yoffs:1,xpad:1.02051,sc:.833333,w:10,h:16},{c:366,x0:29,y0:138,yoffs:-2,sc:.833333,w:14,h:19},{c:367,x0:604,y0:532,yoffs:2,xpad:.0107422,sc:.833333,w:11,h:15},{c:368,x0:54,y0:137,yoffs:-2,sc:.833333,w:14,h:19},{c:369,x0:626,y0:532,yoffs:2,xpad:.0107422,sc:.833333,w:11,h:15},{c:370,x0:100,y0:257,yoffs:3,sc:.833333,w:14,h:18},{c:371,x0:432,y0:691,yoffs:7,xpad:.0107422,sc:.833333,w:11,h:14},{c:372,x0:79,y0:137,yoffs:-2,sc:.833333,w:21,h:19},{c:373,x0:648,y0:532,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:374,x0:111,y0:137,yoffs:-2,sc:.833333,w:14,h:19},{c:375,x0:136,y0:136,yoffs:2,sc:.833333,w:10,h:19},{c:376,x0:125,y0:255,yoffs:-1,sc:.833333,w:14,h:18},{c:377,x0:157,y0:136,yoffs:-2,xpad:.299805,sc:.833333,w:12,h:19},{c:378,x0:673,y0:532,yoffs:2,xpad:.731445,sc:.833333,w:9,h:15},{c:379,x0:180,y0:136,yoffs:-2,xpad:.299805,sc:.833333,w:12,h:19},{c:380,x0:693,y0:531,yoffs:2,xpad:.731445,sc:.833333,w:9,h:15},{c:381,x0:203,y0:135,yoffs:-2,xpad:.299805,sc:.833333,w:12,h:19},{c:382,x0:713,y0:531,yoffs:2,xpad:.731445,sc:.833333,w:9,h:15},{c:383,x0:733,y0:531,yoffs:2,sc:.833333,w:9,h:15},{c:384,x0:753,y0:531,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:385,x0:454,y0:691,yoffs:3,xpad:.233398,sc:.833333,w:14,h:14},{c:386,x0:479,y0:691,yoffs:3,xpad:.435547,sc:.833333,w:11,h:14},{c:387,x0:775,y0:531,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:388,x0:501,y0:691,yoffs:3,sc:.833333,w:12,h:14},{c:389,x0:797,y0:531,yoffs:2,xpad:.367188,sc:.833333,w:11,h:15},{c:390,x0:524,y0:691,yoffs:3,xpad:.420898,sc:.833333,w:11,h:14},{c:391,x0:695,y0:338,sc:.833333,w:13,h:17},{c:392,x0:819,y0:531,yoffs:2,sc:.833333,w:11,h:15},{c:393,x0:546,y0:691,yoffs:3,xpad:.266602,sc:.833333,w:13,h:14},{c:394,x0:570,y0:689,yoffs:3,xpad:.454102,sc:.833333,w:15,h:14},{c:395,x0:596,y0:689,yoffs:3,xpad:1.43555,sc:.833333,w:10,h:14},{c:396,x0:841,y0:531,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:15},{c:397,x0:862,y0:531,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:15},{c:398,x0:617,y0:689,yoffs:3,xpad:1.03906,sc:.833333,w:9,h:14},{c:399,x0:637,y0:689,yoffs:3,xpad:.648438,sc:.833333,w:14,h:14},{c:400,x0:662,y0:688,yoffs:3,xpad:.616211,sc:.833333,w:11,h:14},{c:401,x0:150,y0:255,yoffs:3,xpad:.166016,sc:.833333,w:10,h:18},{c:402,x0:171,y0:255,yoffs:3,xpad:.794922,sc:.833333,w:9,h:18},{c:403,x0:719,y0:338,sc:.833333,w:14,h:17},{c:404,x0:191,y0:254,yoffs:3,sc:.833333,w:12,h:18},{c:405,x0:884,y0:531,yoffs:2,xpad:.695313,sc:.833333,w:17,h:15},{c:406,x0:684,y0:688,yoffs:3,sc:.833333,w:8,h:14},{c:407,x0:703,y0:688,yoffs:3,sc:.833333,w:7,h:14},{c:408,x0:721,y0:688,yoffs:3,sc:.833333,w:12,h:14},{c:409,x0:912,y0:531,yoffs:2,sc:.833333,w:12,h:15},{c:410,x0:935,y0:530,yoffs:2,sc:.833333,w:6,h:15},{c:411,x0:952,y0:530,yoffs:2,xpad:.0253906,sc:.833333,w:11,h:15},{c:412,x0:744,y0:687,yoffs:3,xpad:1.55469,sc:.833333,w:17,h:14},{c:413,x0:214,y0:254,yoffs:3,xpad:.897461,sc:.833333,w:14,h:18},{c:414,x0:974,y0:530,yoffs:6,xpad:.777344,sc:.833333,w:11,h:15},{c:415,x0:772,y0:687,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:416,x0:744,y0:338,xpad:.320313,sc:.833333,w:13,h:17},{c:417,x0:996,y0:530,yoffs:2,sc:.833333,w:11,h:15},{c:418,x0:797,y0:687,yoffs:3,xpad:1.27344,sc:.833333,w:19,h:14},{c:419,x0:5,y0:566,yoffs:6,xpad:.655273,sc:.833333,w:16,h:15},{c:420,x0:827,y0:687,yoffs:3,xpad:.447266,sc:.833333,w:13,h:14},{c:421,x0:226,y0:135,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:422,x0:32,y0:566,yoffs:3,sc:.833333,w:12,h:15},{c:423,x0:851,y0:687,yoffs:3,sc:.833333,w:10,h:14},{c:424,x0:588,y0:865,yoffs:6,sc:.833333,w:9,h:11},{c:425,x0:872,y0:687,yoffs:3,sc:.833333,w:11,h:14},{c:426,x0:248,y0:135,yoffs:2,sc:.833333,w:10,h:19},{c:427,x0:768,y0:338,yoffs:4,sc:.833333,w:8,h:17},{c:428,x0:894,y0:686,yoffs:3,xpad:.0791016,sc:.833333,w:11,h:14},{c:429,x0:55,y0:566,yoffs:2,sc:.833333,w:8,h:15},{c:430,x0:239,y0:254,yoffs:3,sc:.833333,w:11,h:18},{c:431,x0:261,y0:253,yoffs:-1,sc:.833333,w:14,h:18},{c:432,x0:74,y0:566,yoffs:2,sc:.833333,w:12,h:15},{c:433,x0:916,y0:686,yoffs:3,xpad:.0917969,sc:.833333,w:14,h:14},{c:434,x0:941,y0:686,yoffs:3,xpad:.554688,sc:.833333,w:13,h:14},{c:435,x0:965,y0:686,yoffs:3,sc:.833333,w:12,h:14},{c:436,x0:97,y0:565,yoffs:6,xpad:.0253906,sc:.833333,w:11,h:15},{c:437,x0:988,y0:685,yoffs:3,xpad:.380859,sc:.833333,w:10,h:14},{c:438,x0:608,y0:865,yoffs:6,sc:.833333,w:9,h:11},{c:439,x0:5,y0:721,yoffs:3,xpad:.595703,sc:.833333,w:10,h:14},{c:440,x0:26,y0:721,yoffs:3,sc:.833333,w:11,h:14},{c:441,x0:119,y0:565,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:442,x0:140,y0:565,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:443,x0:161,y0:565,yoffs:2,xpad:.219727,sc:.833333,w:10,h:15},{c:444,x0:48,y0:721,yoffs:3,xpad:.361328,sc:.833333,w:10,h:14},{c:445,x0:628,y0:865,yoffs:6,sc:.833333,w:10,h:11},{c:446,x0:389,y0:842,yoffs:4,sc:.833333,w:9,h:13},{c:447,x0:182,y0:565,yoffs:6,xpad:.347656,sc:.833333,w:11,h:15},{c:448,x0:204,y0:565,yoffs:2,xpad:1.21484,sc:.833333,w:4,h:15},{c:449,x0:219,y0:565,yoffs:2,xpad:.87793,sc:.833333,w:9,h:15},{c:450,x0:239,y0:563,yoffs:2,xpad:.248047,sc:.833333,w:9,h:15},{c:451,x0:69,y0:721,yoffs:3,xpad:.126953,sc:.833333,w:5,h:14},{c:452,x0:286,y0:253,yoffs:-1,sc:.833333,w:24,h:18},{c:453,x0:259,y0:562,yoffs:2,xpad:.0166016,sc:.833333,w:22,h:15},{c:454,x0:292,y0:562,yoffs:2,xpad:.0976563,sc:.833333,w:20,h:15},{c:455,x0:787,y0:338,yoffs:3,xpad:1.06445,sc:.833333,w:15,h:17},{c:456,x0:269,y0:134,yoffs:2,xpad:.595703,sc:.833333,w:15,h:19},{c:457,x0:295,y0:134,yoffs:2,xpad:.9375,sc:.833333,w:10,h:19},{c:458,x0:813,y0:337,yoffs:3,xpad:1.50781,sc:.833333,w:19,h:17},{c:459,x0:316,y0:134,yoffs:2,xpad:1.04395,sc:.833333,w:19,h:19},{c:460,x0:346,y0:134,yoffs:2,xpad:1.24609,sc:.833333,w:16,h:19},{c:461,x0:321,y0:252,yoffs:-1,sc:.833333,w:13,h:18},{c:462,x0:538,y0:451,yoffs:1,xpad:1.22461,sc:.833333,w:9,h:16},{c:463,x0:345,y0:252,yoffs:-1,sc:.833333,w:8,h:18},{c:464,x0:558,y0:451,yoffs:1,sc:.833333,w:8,h:16},{c:465,x0:364,y0:252,yoffs:-1,xpad:.320313,sc:.833333,w:13,h:18},{c:466,x0:577,y0:451,yoffs:1,sc:.833333,w:11,h:16},{c:467,x0:388,y0:252,yoffs:-1,xpad:.939453,sc:.833333,w:12,h:18},{c:468,x0:599,y0:451,yoffs:1,xpad:1.02051,sc:.833333,w:10,h:16},{c:469,x0:339,y0:73,yoffs:-3,xpad:.939453,sc:.833333,w:12,h:20},{c:470,x0:843,y0:337,xpad:1.02051,sc:.833333,w:10,h:17},{c:471,x0:408,y0:40,yoffs:-4,xpad:.939453,sc:.833333,w:12,h:21},{c:472,x0:411,y0:252,yoffs:-1,xpad:1.02051,sc:.833333,w:10,h:18},{c:473,x0:431,y0:40,yoffs:-4,xpad:.939453,sc:.833333,w:12,h:21},{c:474,x0:432,y0:252,yoffs:-1,xpad:1.02051,sc:.833333,w:10,h:18},{c:475,x0:454,y0:40,yoffs:-4,xpad:.939453,sc:.833333,w:12,h:21},{c:476,x0:453,y0:251,yoffs:-1,xpad:1.02051,sc:.833333,w:10,h:18},{c:477,x0:649,y0:863,yoffs:6,xpad:.595703,sc:.833333,w:10,h:11},{c:478,x0:362,y0:73,yoffs:-3,sc:.833333,w:13,h:20},{c:479,x0:864,y0:337,xpad:.830078,sc:.833333,w:10,h:17},{c:480,x0:386,y0:72,yoffs:-3,sc:.833333,w:13,h:20},{c:481,x0:885,y0:337,xpad:.830078,sc:.833333,w:10,h:17},{c:482,x0:906,y0:337,xpad:.0654297,sc:.833333,w:17,h:17},{c:483,x0:85,y0:721,yoffs:3,xpad:.44043,sc:.833333,w:16,h:14},{c:484,x0:112,y0:721,yoffs:3,sc:.833333,w:13,h:14},{c:485,x0:323,y0:562,yoffs:6,sc:.833333,w:12,h:15},{c:486,x0:474,y0:251,yoffs:-1,xpad:.978516,sc:.833333,w:12,h:18},{c:487,x0:373,y0:134,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:488,x0:497,y0:251,yoffs:-1,sc:.833333,w:12,h:18},{c:489,x0:394,y0:134,yoffs:-2,sc:.833333,w:13,h:19},{c:490,x0:520,y0:251,yoffs:3,xpad:.272461,sc:.833333,w:14,h:18},{c:491,x0:346,y0:562,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:15},{c:492,x0:477,y0:40,xpad:.272461,sc:.833333,w:14,h:21},{c:493,x0:545,y0:251,yoffs:3,xpad:.0986328,sc:.833333,w:11,h:18},{c:494,x0:567,y0:251,yoffs:-1,xpad:.595703,sc:.833333,w:10,h:18},{c:495,x0:418,y0:133,yoffs:2,xpad:.415039,sc:.833333,w:10,h:19},{c:496,x0:439,y0:133,yoffs:2,sc:.833333,w:9,h:19},{c:497,x0:136,y0:721,yoffs:3,sc:.833333,w:24,h:14},{c:498,x0:171,y0:720,yoffs:3,xpad:.0166016,sc:.833333,w:22,h:14},{c:499,x0:368,y0:561,yoffs:2,xpad:.0976563,sc:.833333,w:20,h:15},{c:500,x0:588,y0:251,yoffs:-1,xpad:.978516,sc:.833333,w:12,h:18},{c:501,x0:459,y0:133,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:502,x0:204,y0:720,yoffs:3,xpad:.789063,sc:.833333,w:18,h:14},{c:503,x0:611,y0:251,yoffs:3,xpad:.119141,sc:.833333,w:12,h:18},{c:504,x0:480,y0:133,yoffs:-2,xpad:.954102,sc:.833333,w:12,h:19},{c:505,x0:934,y0:337,xpad:1.08887,sc:.833333,w:10,h:17},{c:506,x0:634,y0:251,yoffs:-1,sc:.833333,w:13,h:18},{c:507,x0:658,y0:251,yoffs:-1,xpad:.830078,sc:.833333,w:10,h:18},{c:508,x0:679,y0:251,yoffs:-1,xpad:.0654297,sc:.833333,w:17,h:18},{c:509,x0:399,y0:561,yoffs:2,xpad:.44043,sc:.833333,w:16,h:15},{c:510,x0:707,y0:251,yoffs:-1,xpad:.272461,sc:.833333,w:14,h:18},{c:511,x0:426,y0:561,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:512,x0:732,y0:251,yoffs:-1,sc:.833333,w:13,h:18},{c:513,x0:448,y0:561,yoffs:2,xpad:.830078,sc:.833333,w:10,h:15},{c:514,x0:756,y0:251,yoffs:-1,sc:.833333,w:13,h:18},{c:515,x0:469,y0:561,yoffs:2,xpad:.830078,sc:.833333,w:10,h:15},{c:516,x0:780,y0:251,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:517,x0:490,y0:560,yoffs:2,xpad:.595703,sc:.833333,w:10,h:15},{c:518,x0:800,y0:250,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:519,x0:511,y0:559,yoffs:2,xpad:.595703,sc:.833333,w:10,h:15},{c:520,x0:820,y0:250,yoffs:-1,sc:.833333,w:9,h:18},{c:521,x0:532,y0:559,yoffs:2,sc:.833333,w:9,h:15},{c:522,x0:840,y0:250,yoffs:-1,sc:.833333,w:7,h:18},{c:523,x0:552,y0:559,yoffs:2,sc:.833333,w:8,h:15},{c:524,x0:858,y0:250,yoffs:-1,xpad:.272461,sc:.833333,w:14,h:18},{c:525,x0:571,y0:559,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:526,x0:883,y0:250,yoffs:-1,xpad:.272461,sc:.833333,w:14,h:18},{c:527,x0:593,y0:558,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:528,x0:908,y0:250,yoffs:-1,sc:.833333,w:12,h:18},{c:529,x0:615,y0:558,yoffs:2,sc:.833333,w:9,h:15},{c:530,x0:931,y0:250,yoffs:-1,sc:.833333,w:12,h:18},{c:531,x0:635,y0:558,yoffs:2,xpad:.139648,sc:.833333,w:8,h:15},{c:532,x0:954,y0:250,yoffs:-1,xpad:.554688,sc:.833333,w:13,h:18},{c:533,x0:654,y0:558,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:534,x0:978,y0:250,yoffs:-1,xpad:.554688,sc:.833333,w:13,h:18},{c:535,x0:676,y0:558,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:536,x0:1002,y0:250,yoffs:3,xpad:.898438,sc:.833333,w:10,h:18},{c:537,x0:233,y0:720,yoffs:7,xpad:.706055,sc:.833333,w:8,h:14},{c:538,x0:5,y0:286,yoffs:3,xpad:.0322266,sc:.833333,w:13,h:18},{c:539,x0:955,y0:337,yoffs:4,sc:.833333,w:8,h:17},{c:540,x0:974,y0:337,yoffs:3,xpad:.274414,sc:.833333,w:11,h:17},{c:541,x0:698,y0:557,yoffs:6,xpad:.0722656,sc:.833333,w:9,h:15},{c:542,x0:29,y0:286,yoffs:-1,xpad:.71582,sc:.833333,w:13,h:18},{c:543,x0:503,y0:133,yoffs:-2,xpad:.763672,sc:.833333,w:12,h:19},{c:544,x0:53,y0:286,yoffs:3,xpad:.642578,sc:.833333,w:13,h:18},{c:545,x0:996,y0:337,yoffs:2,sc:.833333,w:16,h:17},{c:546,x0:252,y0:720,yoffs:3,xpad:.730469,sc:.833333,w:13,h:14},{c:547,x0:718,y0:557,yoffs:2,xpad:.274414,sc:.833333,w:11,h:15},{c:548,x0:77,y0:286,yoffs:3,xpad:.380859,sc:.833333,w:10,h:18},{c:549,x0:740,y0:557,yoffs:6,sc:.833333,w:9,h:15},{c:550,x0:98,y0:286,yoffs:-1,sc:.833333,w:13,h:18},{c:551,x0:760,y0:557,yoffs:2,xpad:.830078,sc:.833333,w:10,h:15},{c:552,x0:122,y0:286,yoffs:3,xpad:1.03906,sc:.833333,w:9,h:18},{c:553,x0:781,y0:557,yoffs:6,xpad:.595703,sc:.833333,w:10,h:15},{c:554,x0:410,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:555,x0:5,y0:373,xpad:.0986328,sc:.833333,w:11,h:17},{c:556,x0:435,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:557,x0:27,y0:373,xpad:.0986328,sc:.833333,w:11,h:17},{c:558,x0:142,y0:284,yoffs:-1,xpad:.272461,sc:.833333,w:14,h:18},{c:559,x0:802,y0:557,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:560,x0:460,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:561,x0:49,y0:373,xpad:.0986328,sc:.833333,w:11,h:17},{c:562,x0:71,y0:373,sc:.833333,w:12,h:17},{c:563,x0:167,y0:284,yoffs:3,sc:.833333,w:11,h:18},{c:564,x0:824,y0:557,yoffs:2,sc:.833333,w:8,h:15},{c:565,x0:670,y0:863,yoffs:6,sc:.833333,w:14,h:11},{c:566,x0:409,y0:842,yoffs:4,sc:.833333,w:9,h:13},{c:567,x0:276,y0:720,yoffs:7,xpad:.947266,sc:.833333,w:5,h:14},{c:568,x0:843,y0:557,yoffs:2,xpad:.226563,sc:.833333,w:17,h:15},{c:569,x0:871,y0:557,yoffs:6,xpad:.226563,sc:.833333,w:17,h:15},{c:570,x0:620,y0:451,yoffs:2,sc:.833333,w:13,h:16},{c:571,x0:644,y0:451,yoffs:2,xpad:.420898,sc:.833333,w:11,h:16},{c:572,x0:189,y0:284,yoffs:2,sc:.833333,w:10,h:18},{c:573,x0:292,y0:720,yoffs:3,xpad:.126953,sc:.833333,w:10,h:14},{c:574,x0:666,y0:451,yoffs:2,sc:.833333,w:11,h:16},{c:575,x0:899,y0:557,yoffs:6,sc:.833333,w:9,h:15},{c:576,x0:919,y0:557,yoffs:6,sc:.833333,w:9,h:15},{c:577,x0:313,y0:718,yoffs:3,sc:.833333,w:9,h:14},{c:578,x0:695,y0:863,yoffs:6,sc:.833333,w:9,h:11},{c:579,x0:333,y0:717,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:14},{c:580,x0:356,y0:717,yoffs:3,sc:.833333,w:14,h:14},{c:581,x0:381,y0:717,yoffs:3,sc:.833333,w:12,h:14},{c:582,x0:688,y0:450,yoffs:2,xpad:1.03906,sc:.833333,w:9,h:16},{c:583,x0:210,y0:283,yoffs:2,xpad:.595703,sc:.833333,w:10,h:18},{c:584,x0:94,y0:373,yoffs:3,sc:.833333,w:8,h:17},{c:585,x0:526,y0:133,yoffs:2,sc:.833333,w:8,h:19},{c:586,x0:231,y0:283,yoffs:3,sc:.833333,w:15,h:18},{c:587,x0:939,y0:556,yoffs:6,sc:.833333,w:12,h:15},{c:588,x0:404,y0:717,yoffs:3,sc:.833333,w:12,h:14},{c:589,x0:715,y0:863,yoffs:6,xpad:.139648,sc:.833333,w:8,h:11},{c:590,x0:427,y0:717,yoffs:3,sc:.833333,w:12,h:14},{c:591,x0:962,y0:556,yoffs:6,sc:.833333,w:11,h:15},{c:592,x0:734,y0:862,yoffs:6,sc:.833333,w:11,h:11},{c:593,x0:756,y0:862,yoffs:6,xpad:1.1377,sc:.833333,w:10,h:11},{c:594,x0:777,y0:862,yoffs:6,xpad:.347656,sc:.833333,w:11,h:11},{c:595,x0:984,y0:556,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:596,x0:799,y0:862,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:597,x0:131,y0:870,yoffs:6,sc:.833333,w:10,h:12},{c:598,x0:545,y0:133,yoffs:2,sc:.833333,w:12,h:19},{c:599,x0:1006,y0:556,yoffs:2,sc:.833333,w:12,h:15},{c:600,x0:819,y0:862,yoffs:6,xpad:.595703,sc:.833333,w:10,h:11},{c:601,x0:649,y0:863,yoffs:6,xpad:.595703,sc:.833333,w:10,h:11},{c:602,x0:840,y0:861,yoffs:6,sc:.833333,w:16,h:11},{c:603,x0:867,y0:861,yoffs:6,sc:.833333,w:10,h:11},{c:604,x0:888,y0:861,yoffs:6,sc:.833333,w:10,h:11},{c:605,x0:909,y0:861,yoffs:6,sc:.833333,w:15,h:11},{c:606,x0:935,y0:861,yoffs:6,xpad:.274414,sc:.833333,w:11,h:11},{c:607,x0:5,y0:592,yoffs:6,sc:.833333,w:8,h:15},{c:608,x0:568,y0:133,yoffs:2,sc:.833333,w:12,h:19},{c:609,x0:24,y0:592,yoffs:6,xpad:1.31348,sc:.833333,w:10,h:15},{c:610,x0:957,y0:861,yoffs:6,xpad:.737305,sc:.833333,w:10,h:11},{c:611,x0:45,y0:592,yoffs:6,sc:.833333,w:11,h:15},{c:612,x0:978,y0:860,yoffs:6,sc:.833333,w:11,h:11},{c:613,x0:67,y0:592,yoffs:6,xpad:.777344,sc:.833333,w:11,h:15},{c:614,x0:89,y0:592,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:615,x0:591,y0:133,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:616,x0:111,y0:591,yoffs:2,sc:.833333,w:6,h:15},{c:617,x0:1e3,y0:859,yoffs:6,xpad:.294922,sc:.833333,w:7,h:11},{c:618,x0:5,y0:894,yoffs:6,sc:.833333,w:7,h:11},{c:619,x0:128,y0:591,yoffs:2,sc:.833333,w:8,h:15},{c:620,x0:147,y0:591,yoffs:2,sc:.833333,w:9,h:15},{c:621,x0:613,y0:133,yoffs:2,sc:.833333,w:7,h:19},{c:622,x0:631,y0:133,yoffs:2,xpad:.623047,sc:.833333,w:13,h:19},{c:623,x0:23,y0:894,yoffs:6,xpad:.602539,sc:.833333,w:17,h:11},{c:624,x0:167,y0:591,yoffs:6,xpad:.602539,sc:.833333,w:17,h:15},{c:625,x0:195,y0:591,yoffs:6,xpad:.602539,sc:.833333,w:17,h:15},{c:626,x0:223,y0:591,yoffs:6,xpad:.314453,sc:.833333,w:12,h:15},{c:627,x0:246,y0:589,yoffs:6,sc:.833333,w:13,h:15},{c:628,x0:51,y0:894,yoffs:6,xpad:.905273,sc:.833333,w:12,h:11},{c:629,x0:74,y0:894,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:11},{c:630,x0:96,y0:893,yoffs:6,xpad:.634766,sc:.833333,w:15,h:11},{c:631,x0:122,y0:893,yoffs:6,sc:.833333,w:15,h:11},{c:632,x0:655,y0:133,yoffs:2,xpad:.594727,sc:.833333,w:14,h:19},{c:633,x0:148,y0:893,yoffs:6,xpad:1.13965,sc:.833333,w:7,h:11},{c:634,x0:270,y0:588,yoffs:2,xpad:1.13965,sc:.833333,w:7,h:15},{c:635,x0:288,y0:588,yoffs:6,sc:.833333,w:9,h:15},{c:636,x0:308,y0:588,yoffs:6,xpad:.139648,sc:.833333,w:8,h:15},{c:637,x0:327,y0:588,yoffs:6,xpad:.139648,sc:.833333,w:8,h:15},{c:638,x0:166,y0:893,yoffs:6,xpad:.133789,sc:.833333,w:7,h:11},{c:639,x0:346,y0:588,yoffs:6,xpad:1.13379,sc:.833333,w:6,h:15},{c:640,x0:184,y0:893,yoffs:6,sc:.833333,w:11,h:11},{c:641,x0:206,y0:893,yoffs:6,sc:.833333,w:11,h:11},{c:642,x0:363,y0:588,yoffs:6,sc:.833333,w:9,h:15},{c:643,x0:680,y0:133,yoffs:2,sc:.833333,w:8,h:19},{c:644,x0:699,y0:133,yoffs:2,sc:.833333,w:8,h:19},{c:645,x0:383,y0:587,yoffs:6,sc:.833333,w:8,h:15},{c:646,x0:718,y0:133,yoffs:2,sc:.833333,w:9,h:19},{c:647,x0:429,y0:842,yoffs:6,sc:.833333,w:8,h:13},{c:648,x0:113,y0:373,yoffs:4,sc:.833333,w:8,h:17},{c:649,x0:228,y0:893,yoffs:6,sc:.833333,w:12,h:11},{c:650,x0:251,y0:892,yoffs:6,sc:.833333,w:12,h:11},{c:651,x0:274,y0:892,yoffs:6,xpad:1.01172,sc:.833333,w:11,h:11},{c:652,x0:296,y0:892,yoffs:6,sc:.833333,w:11,h:11},{c:653,x0:318,y0:892,yoffs:6,sc:.833333,w:16,h:11},{c:654,x0:402,y0:587,yoffs:2,sc:.833333,w:11,h:15},{c:655,x0:345,y0:892,yoffs:6,sc:.833333,w:11,h:11},{c:656,x0:424,y0:587,yoffs:6,sc:.833333,w:10,h:15},{c:657,x0:152,y0:870,yoffs:6,sc:.833333,w:11,h:12},{c:658,x0:445,y0:587,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:659,x0:466,y0:587,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:660,x0:487,y0:587,yoffs:2,sc:.833333,w:9,h:15},{c:661,x0:507,y0:586,yoffs:2,sc:.833333,w:9,h:15},{c:662,x0:527,y0:585,yoffs:2,sc:.833333,w:9,h:15},{c:663,x0:547,y0:585,yoffs:6,xpad:.213867,sc:.833333,w:9,h:15},{c:664,x0:450,y0:716,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:665,x0:367,y0:892,yoffs:6,xpad:.274414,sc:.833333,w:11,h:11},{c:666,x0:389,y0:890,yoffs:6,xpad:.274414,sc:.833333,w:11,h:11},{c:667,x0:567,y0:585,yoffs:2,sc:.833333,w:12,h:15},{c:668,x0:411,y0:889,yoffs:6,xpad:.870117,sc:.833333,w:11,h:11},{c:669,x0:738,y0:132,yoffs:2,sc:.833333,w:8,h:19},{c:670,x0:590,y0:585,yoffs:6,xpad:1.11328,sc:.833333,w:10,h:15},{c:671,x0:433,y0:889,yoffs:6,sc:.833333,w:9,h:11},{c:672,x0:757,y0:132,yoffs:2,sc:.833333,w:12,h:19},{c:673,x0:611,y0:584,yoffs:2,sc:.833333,w:9,h:15},{c:674,x0:631,y0:584,yoffs:2,sc:.833333,w:9,h:15},{c:675,x0:651,y0:584,yoffs:2,xpad:.0371094,sc:.833333,w:18,h:15},{c:676,x0:780,y0:132,yoffs:2,xpad:.125977,sc:.833333,w:19,h:19},{c:677,x0:708,y0:450,yoffs:2,sc:.833333,w:20,h:16},{c:678,x0:448,y0:842,yoffs:4,xpad:.628906,sc:.833333,w:14,h:13},{c:679,x0:810,y0:132,yoffs:2,sc:.833333,w:12,h:19},{c:680,x0:473,y0:842,yoffs:4,xpad:.494141,sc:.833333,w:16,h:13},{c:681,x0:833,y0:132,yoffs:2,xpad:1.24609,sc:.833333,w:16,h:19},{c:682,x0:680,y0:584,yoffs:2,sc:.833333,w:13,h:15},{c:683,x0:704,y0:583,yoffs:2,xpad:.15332,sc:.833333,w:12,h:15},{c:684,x0:475,y0:716,yoffs:3,sc:.833333,w:10,h:14},{c:685,x0:496,y0:716,yoffs:3,xpad:.864258,sc:.833333,w:10,h:14},{c:686,x0:727,y0:583,yoffs:6,xpad:.133789,sc:.833333,w:12,h:15},{c:687,x0:750,y0:583,yoffs:6,sc:.833333,w:14,h:15},{c:802,x0:140,y0:980,yoffs:15,sc:.833333,w:4,h:6},{c:856,x0:241,y0:997,yoffs:2,sc:.833333,w:5,h:4},{c:880,x0:517,y0:716,yoffs:3,xpad:.676758,sc:.833333,w:8,h:14},{c:881,x0:453,y0:889,yoffs:6,sc:.833333,w:8,h:11},{c:882,x0:536,y0:716,yoffs:3,sc:.833333,w:13,h:14},{c:883,x0:775,y0:583,yoffs:2,sc:.833333,w:11,h:15},{c:884,x0:257,y0:997,yoffs:3,sc:.833333,w:5,h:4},{c:885,x0:273,y0:997,yoffs:17,sc:.833333,w:5,h:4},{c:886,x0:560,y0:716,yoffs:3,xpad:.755859,sc:.833333,w:14,h:14},{c:887,x0:472,y0:888,yoffs:6,xpad:.905273,sc:.833333,w:12,h:11},{c:890,x0:289,y0:997,yoffs:17,xpad:2.3418,sc:.833333,w:8,h:4},{c:891,x0:799,y0:862,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:892,x0:495,y0:888,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:893,x0:515,y0:887,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:894,x0:500,y0:841,yoffs:6,xpad:.200195,sc:.833333,w:5,h:13},{c:895,x0:132,y0:373,yoffs:3,xpad:.260742,sc:.833333,w:7,h:17},{c:900,x0:660,y0:972,yoffs:1,xpad:2.3418,sc:.833333,w:8,h:5},{c:901,x0:679,y0:972,yoffs:1,xpad:1.3418,sc:.833333,w:9,h:5},{c:902,x0:797,y0:583,yoffs:2,sc:.833333,w:13,h:15},{c:903,x0:308,y0:996,yoffs:6,xpad:.107422,sc:.833333,w:5,h:4},{c:904,x0:821,y0:583,yoffs:2,xpad:.0996094,sc:.833333,w:12,h:15},{c:905,x0:844,y0:583,yoffs:2,xpad:.776367,sc:.833333,w:15,h:15},{c:906,x0:870,y0:583,yoffs:2,sc:.833333,w:10,h:15},{c:908,x0:891,y0:583,yoffs:2,xpad:.361328,sc:.833333,w:15,h:15},{c:910,x0:917,y0:583,yoffs:2,sc:.833333,w:15,h:15},{c:911,x0:943,y0:582,yoffs:2,sc:.833333,w:16,h:15},{c:912,x0:739,y0:450,yoffs:1,sc:.833333,w:8,h:16},{c:913,x0:585,y0:714,yoffs:3,sc:.833333,w:13,h:14},{c:914,x0:609,y0:714,yoffs:3,sc:.833333,w:12,h:14},{c:915,x0:632,y0:714,yoffs:3,xpad:.102539,sc:.833333,w:10,h:14},{c:916,x0:653,y0:714,yoffs:3,xpad:.530273,sc:.833333,w:13,h:14},{c:917,x0:677,y0:713,yoffs:3,xpad:.639648,sc:.833333,w:10,h:14},{c:918,x0:698,y0:713,yoffs:3,xpad:.605469,sc:.833333,w:10,h:14},{c:919,x0:719,y0:713,yoffs:3,xpad:1.0957,sc:.833333,w:12,h:14},{c:920,x0:742,y0:713,yoffs:3,xpad:.320313,sc:.833333,w:13,h:14},{c:921,x0:766,y0:712,yoffs:3,xpad:.708008,sc:.833333,w:5,h:14},{c:922,x0:782,y0:712,yoffs:3,sc:.833333,w:12,h:14},{c:923,x0:805,y0:712,yoffs:3,sc:.833333,w:12,h:14},{c:924,x0:828,y0:712,yoffs:3,xpad:.770508,sc:.833333,w:14,h:14},{c:925,x0:853,y0:712,yoffs:3,xpad:.954102,sc:.833333,w:12,h:14},{c:926,x0:876,y0:712,yoffs:3,xpad:1.00098,sc:.833333,w:10,h:14},{c:927,x0:897,y0:711,yoffs:3,xpad:.320313,sc:.833333,w:13,h:14},{c:928,x0:921,y0:711,yoffs:3,xpad:.905273,sc:.833333,w:12,h:14},{c:929,x0:944,y0:711,yoffs:3,xpad:.538086,sc:.833333,w:11,h:14},{c:931,x0:966,y0:711,yoffs:3,sc:.833333,w:11,h:14},{c:932,x0:988,y0:710,yoffs:3,sc:.833333,w:11,h:14},{c:933,x0:5,y0:746,yoffs:3,sc:.833333,w:12,h:14},{c:934,x0:970,y0:582,yoffs:2,xpad:.702148,sc:.833333,w:14,h:15},{c:935,x0:28,y0:746,yoffs:3,sc:.833333,w:11,h:14},{c:936,x0:50,y0:746,yoffs:3,xpad:.477539,sc:.833333,w:14,h:14},{c:937,x0:75,y0:746,yoffs:3,xpad:.702148,sc:.833333,w:14,h:14},{c:938,x0:257,y0:283,yoffs:-1,sc:.833333,w:7,h:18},{c:939,x0:275,y0:282,yoffs:-1,sc:.833333,w:12,h:18},{c:940,x0:758,y0:450,yoffs:1,sc:.833333,w:12,h:16},{c:941,x0:781,y0:450,yoffs:1,sc:.833333,w:10,h:16},{c:942,x0:485,y0:72,yoffs:1,xpad:.777344,sc:.833333,w:11,h:20},{c:943,x0:802,y0:450,yoffs:1,xpad:.294922,sc:.833333,w:7,h:16},{c:944,x0:820,y0:450,yoffs:1,xpad:.5625,sc:.833333,w:11,h:16},{c:945,x0:535,y0:887,yoffs:6,sc:.833333,w:12,h:11},{c:946,x0:298,y0:282,yoffs:2,xpad:.586914,sc:.833333,w:11,h:18},{c:947,x0:100,y0:746,yoffs:6,xpad:.19043,sc:.833333,w:10,h:14},{c:948,x0:995,y0:582,yoffs:2,xpad:.654297,sc:.833333,w:10,h:15},{c:949,x0:558,y0:887,yoffs:6,xpad:.130859,sc:.833333,w:9,h:11},{c:950,x0:320,y0:282,yoffs:2,sc:.833333,w:9,h:18},{c:951,x0:121,y0:746,yoffs:6,xpad:.913086,sc:.833333,w:10,h:14},{c:952,x0:5,y0:618,yoffs:2,xpad:.639648,sc:.833333,w:10,h:15},{c:953,x0:578,y0:887,yoffs:6,sc:.833333,w:6,h:11},{c:954,x0:595,y0:887,yoffs:6,sc:.833333,w:11,h:11},{c:955,x0:26,y0:618,yoffs:2,sc:.833333,w:11,h:15},{c:956,x0:142,y0:746,yoffs:7,sc:.833333,w:11,h:14},{c:957,x0:617,y0:887,yoffs:6,sc:.833333,w:10,h:11},{c:958,x0:340,y0:281,yoffs:2,xpad:.0136719,sc:.833333,w:9,h:18},{c:959,x0:638,y0:887,yoffs:6,xpad:.756836,sc:.833333,w:10,h:11},{c:960,x0:175,y0:959,yoffs:7,xpad:.241211,sc:.833333,w:12,h:10},{c:961,x0:164,y0:746,yoffs:6,xpad:.0546875,sc:.833333,w:11,h:14},{c:962,x0:186,y0:745,yoffs:6,sc:.833333,w:9,h:14},{c:963,x0:659,y0:885,yoffs:6,xpad:.103516,sc:.833333,w:11,h:11},{c:964,x0:681,y0:885,yoffs:6,xpad:.477539,sc:.833333,w:9,h:11},{c:965,x0:701,y0:885,yoffs:6,xpad:.307617,sc:.833333,w:10,h:11},{c:966,x0:150,y0:373,yoffs:3,xpad:.165039,sc:.833333,w:14,h:17},{c:967,x0:206,y0:745,yoffs:6,sc:.833333,w:11,h:14},{c:968,x0:175,y0:371,yoffs:3,xpad:.40918,sc:.833333,w:14,h:17},{c:969,x0:722,y0:885,yoffs:6,xpad:.40918,sc:.833333,w:14,h:11},{c:970,x0:48,y0:618,yoffs:2,sc:.833333,w:8,h:15},{c:971,x0:67,y0:618,yoffs:2,xpad:.5625,sc:.833333,w:11,h:15},{c:972,x0:842,y0:450,yoffs:1,xpad:.0986328,sc:.833333,w:11,h:16},{c:973,x0:864,y0:450,yoffs:1,xpad:.5625,sc:.833333,w:11,h:16},{c:974,x0:886,y0:449,yoffs:1,xpad:.46875,sc:.833333,w:15,h:16},{c:975,x0:360,y0:281,yoffs:3,sc:.833333,w:12,h:18},{c:976,x0:89,y0:618,yoffs:2,xpad:.152344,sc:.833333,w:11,h:15},{c:977,x0:111,y0:617,yoffs:2,xpad:.125,sc:.833333,w:13,h:15},{c:978,x0:228,y0:745,yoffs:3,sc:.833333,w:12,h:14},{c:979,x0:135,y0:617,yoffs:2,sc:.833333,w:16,h:15},{c:980,x0:383,y0:281,yoffs:-1,sc:.833333,w:12,h:18},{c:981,x0:655,y0:133,yoffs:2,xpad:.594727,sc:.833333,w:14,h:19},{c:982,x0:747,y0:884,yoffs:6,sc:.833333,w:18,h:11},{c:983,x0:162,y0:617,yoffs:6,sc:.833333,w:13,h:15},{c:984,x0:251,y0:745,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:985,x0:186,y0:617,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:15},{c:986,x0:276,y0:745,yoffs:3,xpad:.420898,sc:.833333,w:11,h:14},{c:987,x0:298,y0:745,yoffs:6,sc:.833333,w:10,h:14},{c:988,x0:319,y0:743,yoffs:3,sc:.833333,w:10,h:14},{c:989,x0:208,y0:617,yoffs:6,xpad:.306641,sc:.833333,w:9,h:15},{c:990,x0:340,y0:742,yoffs:3,sc:.833333,w:10,h:14},{c:991,x0:860,y0:132,yoffs:2,sc:.833333,w:10,h:19},{c:992,x0:361,y0:742,yoffs:3,xpad:.00585938,sc:.833333,w:11,h:14},{c:993,x0:881,y0:132,yoffs:2,sc:.833333,w:11,h:19},{c:1008,x0:776,y0:884,yoffs:6,sc:.833333,w:13,h:11},{c:1009,x0:228,y0:617,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:15},{c:1010,x0:800,y0:884,yoffs:6,xpad:.213867,sc:.833333,w:9,h:11},{c:1011,x0:903,y0:132,yoffs:2,sc:.833333,w:7,h:19},{c:1012,x0:772,y0:687,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:1013,x0:820,y0:884,yoffs:6,xpad:.394531,sc:.833333,w:9,h:11},{c:1014,x0:840,y0:883,yoffs:6,xpad:.179688,sc:.833333,w:9,h:11},{c:1015,x0:383,y0:742,yoffs:3,xpad:.259766,sc:.833333,w:11,h:14},{c:1016,x0:921,y0:132,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:1017,x0:405,y0:742,yoffs:3,xpad:.420898,sc:.833333,w:11,h:14},{c:1018,x0:427,y0:742,yoffs:3,xpad:.904297,sc:.833333,w:16,h:14},{c:1019,x0:250,y0:615,yoffs:6,xpad:.736328,sc:.833333,w:14,h:15},{c:1020,x0:275,y0:614,yoffs:6,xpad:.0791016,sc:.833333,w:11,h:15},{c:1021,x0:524,y0:691,yoffs:3,xpad:.420898,sc:.833333,w:11,h:14},{c:1022,x0:454,y0:741,yoffs:3,xpad:.420898,sc:.833333,w:11,h:14},{c:1023,x0:476,y0:741,yoffs:3,xpad:.420898,sc:.833333,w:11,h:14},{c:1024,x0:406,y0:281,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:18},{c:1025,x0:426,y0:281,yoffs:-1,xpad:.639648,sc:.833333,w:10,h:18},{c:1026,x0:498,y0:741,yoffs:3,xpad:.433594,sc:.833333,w:14,h:14},{c:1027,x0:447,y0:281,yoffs:-1,xpad:.0585938,sc:.833333,w:10,h:18},{c:1028,x0:523,y0:741,yoffs:3,xpad:.138672,sc:.833333,w:12,h:14},{c:1029,x0:546,y0:741,yoffs:3,sc:.833333,w:10,h:14},{c:1030,x0:567,y0:741,yoffs:3,sc:.833333,w:7,h:14},{c:1031,x0:257,y0:283,yoffs:-1,sc:.833333,w:7,h:18},{c:1032,x0:132,y0:373,yoffs:3,xpad:.260742,sc:.833333,w:7,h:17},{c:1033,x0:585,y0:739,yoffs:3,sc:.833333,w:18,h:14},{c:1034,x0:614,y0:739,yoffs:3,sc:.833333,w:18,h:14},{c:1035,x0:643,y0:739,yoffs:3,xpad:.433594,sc:.833333,w:14,h:14},{c:1036,x0:468,y0:280,yoffs:-1,sc:.833333,w:13,h:18},{c:1037,x0:492,y0:280,yoffs:-1,xpad:.755859,sc:.833333,w:14,h:18},{c:1038,x0:517,y0:280,yoffs:-1,sc:.833333,w:12,h:18},{c:1039,x0:200,y0:371,yoffs:3,xpad:1.35449,sc:.833333,w:12,h:17},{c:1040,x0:585,y0:714,yoffs:3,sc:.833333,w:13,h:14},{c:1041,x0:668,y0:739,yoffs:3,xpad:.674805,sc:.833333,w:11,h:14},{c:1042,x0:609,y0:714,yoffs:3,sc:.833333,w:12,h:14},{c:1043,x0:632,y0:714,yoffs:3,xpad:.102539,sc:.833333,w:10,h:14},{c:1044,x0:223,y0:370,yoffs:3,sc:.833333,w:13,h:17},{c:1045,x0:677,y0:713,yoffs:3,xpad:.639648,sc:.833333,w:10,h:14},{c:1046,x0:690,y0:738,yoffs:3,sc:.833333,w:17,h:14},{c:1047,x0:718,y0:738,yoffs:3,xpad:.0205078,sc:.833333,w:11,h:14},{c:1048,x0:740,y0:738,yoffs:3,xpad:1.16406,sc:.833333,w:12,h:14},{c:1049,x0:540,y0:280,yoffs:-1,xpad:1.16406,sc:.833333,w:12,h:18},{c:1050,x0:763,y0:738,yoffs:3,sc:.833333,w:12,h:14},{c:1051,x0:786,y0:737,yoffs:3,sc:.833333,w:13,h:14},{c:1052,x0:828,y0:712,yoffs:3,xpad:.770508,sc:.833333,w:14,h:14},{c:1053,x0:719,y0:713,yoffs:3,xpad:1.0957,sc:.833333,w:12,h:14},{c:1054,x0:897,y0:711,yoffs:3,xpad:.320313,sc:.833333,w:13,h:14},{c:1055,x0:921,y0:711,yoffs:3,xpad:.905273,sc:.833333,w:12,h:14},{c:1056,x0:944,y0:711,yoffs:3,xpad:.538086,sc:.833333,w:11,h:14},{c:1057,x0:810,y0:737,yoffs:3,xpad:.362305,sc:.833333,w:11,h:14},{c:1058,x0:988,y0:710,yoffs:3,sc:.833333,w:11,h:14},{c:1059,x0:832,y0:737,yoffs:3,sc:.833333,w:11,h:14},{c:1060,x0:854,y0:737,yoffs:3,xpad:.804688,sc:.833333,w:14,h:14},{c:1061,x0:28,y0:746,yoffs:3,sc:.833333,w:11,h:14},{c:1062,x0:247,y0:370,yoffs:3,sc:.833333,w:13,h:17},{c:1063,x0:879,y0:737,yoffs:3,xpad:1.17773,sc:.833333,w:11,h:14},{c:1064,x0:901,y0:736,yoffs:3,xpad:.626953,sc:.833333,w:17,h:14},{c:1065,x0:271,y0:370,yoffs:3,sc:.833333,w:18,h:17},{c:1066,x0:929,y0:736,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:1067,x0:954,y0:736,yoffs:3,xpad:1.43066,sc:.833333,w:15,h:14},{c:1068,x0:980,y0:736,yoffs:3,xpad:.674805,sc:.833333,w:11,h:14},{c:1069,x0:1002,y0:735,yoffs:3,xpad:.362305,sc:.833333,w:11,h:14},{c:1070,x0:5,y0:771,yoffs:3,xpad:.422852,sc:.833333,w:18,h:14},{c:1071,x0:34,y0:771,yoffs:3,xpad:.899414,sc:.833333,w:11,h:14},{c:1072,x0:860,y0:883,yoffs:6,xpad:1.22461,sc:.833333,w:9,h:11},{c:1073,x0:912,y0:449,yoffs:1,sc:.833333,w:11,h:16},{c:1074,x0:880,y0:883,yoffs:6,xpad:.258789,sc:.833333,w:10,h:11},{c:1075,x0:901,y0:883,yoffs:6,xpad:.354492,sc:.833333,w:8,h:11},{c:1076,x0:56,y0:771,yoffs:6,xpad:.191406,sc:.833333,w:11,h:14},{c:1077,x0:920,y0:883,yoffs:6,xpad:.0488281,sc:.833333,w:10,h:11},{c:1078,x0:941,y0:883,yoffs:6,sc:.833333,w:15,h:11},{c:1079,x0:967,y0:883,yoffs:6,xpad:.238281,sc:.833333,w:9,h:11},{c:1080,x0:987,y0:882,yoffs:6,xpad:1.32813,sc:.833333,w:10,h:11},{c:1081,x0:934,y0:449,yoffs:1,xpad:1.32813,sc:.833333,w:10,h:16},{c:1082,x0:5,y0:916,yoffs:6,sc:.833333,w:11,h:11},{c:1083,x0:27,y0:916,yoffs:6,xpad:1.02051,sc:.833333,w:10,h:11},{c:1084,x0:48,y0:916,yoffs:6,xpad:.797852,sc:.833333,w:12,h:11},{c:1085,x0:71,y0:916,yoffs:6,xpad:1.31348,sc:.833333,w:10,h:11},{c:1086,x0:92,y0:916,yoffs:6,sc:.833333,w:11,h:11},{c:1087,x0:114,y0:915,yoffs:6,xpad:1.15723,sc:.833333,w:10,h:11},{c:1088,x0:78,y0:771,yoffs:6,xpad:.137695,sc:.833333,w:11,h:14},{c:1089,x0:135,y0:915,yoffs:6,xpad:.116211,sc:.833333,w:9,h:11},{c:1090,x0:155,y0:915,yoffs:6,xpad:.477539,sc:.833333,w:9,h:11},{c:1091,x0:297,y0:614,yoffs:6,sc:.833333,w:10,h:15},{c:1092,x0:563,y0:280,yoffs:2,xpad:.0292969,sc:.833333,w:15,h:18},{c:1093,x0:175,y0:915,yoffs:6,sc:.833333,w:10,h:11},{c:1094,x0:100,y0:771,yoffs:6,sc:.833333,w:12,h:14},{c:1095,x0:196,y0:915,yoffs:6,xpad:.585938,sc:.833333,w:10,h:11},{c:1096,x0:217,y0:915,yoffs:6,xpad:.483398,sc:.833333,w:15,h:11},{c:1097,x0:123,y0:771,yoffs:6,sc:.833333,w:16,h:14},{c:1098,x0:243,y0:915,yoffs:6,xpad:.0898438,sc:.833333,w:12,h:11},{c:1099,x0:266,y0:914,yoffs:6,xpad:1.16504,sc:.833333,w:13,h:11},{c:1100,x0:290,y0:914,yoffs:6,sc:.833333,w:10,h:11},{c:1101,x0:311,y0:914,yoffs:6,xpad:.116211,sc:.833333,w:9,h:11},{c:1102,x0:331,y0:914,yoffs:6,xpad:.0146484,sc:.833333,w:15,h:11},{c:1103,x0:357,y0:914,yoffs:6,xpad:.517578,sc:.833333,w:10,h:11},{c:1104,x0:318,y0:614,yoffs:2,xpad:.595703,sc:.833333,w:10,h:15},{c:1105,x0:339,y0:614,yoffs:2,xpad:.0488281,sc:.833333,w:10,h:15},{c:1106,x0:943,y0:132,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:1107,x0:360,y0:614,yoffs:2,sc:.833333,w:9,h:15},{c:1108,x0:820,y0:884,yoffs:6,xpad:.394531,sc:.833333,w:9,h:11},{c:1109,x0:378,y0:914,yoffs:6,sc:.833333,w:9,h:11},{c:1110,x0:380,y0:614,yoffs:2,xpad:.46875,sc:.833333,w:5,h:15},{c:1111,x0:396,y0:613,yoffs:2,sc:.833333,w:7,h:15},{c:1112,x0:903,y0:132,yoffs:2,sc:.833333,w:7,h:19},{c:1113,x0:398,y0:912,yoffs:6,sc:.833333,w:16,h:11},{c:1114,x0:425,y0:911,yoffs:6,sc:.833333,w:16,h:11},{c:1115,x0:414,y0:613,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:1116,x0:436,y0:613,yoffs:2,sc:.833333,w:12,h:15},{c:1117,x0:459,y0:613,yoffs:2,xpad:.905273,sc:.833333,w:12,h:15},{c:1118,x0:965,y0:132,yoffs:2,sc:.833333,w:11,h:19},{c:1119,x0:150,y0:771,yoffs:6,xpad:1.0459,sc:.833333,w:11,h:14},{c:1120,x0:172,y0:771,yoffs:3,xpad:.0849609,sc:.833333,w:17,h:14},{c:1121,x0:452,y0:911,yoffs:6,sc:.833333,w:16,h:11},{c:1122,x0:200,y0:770,yoffs:3,xpad:.0654297,sc:.833333,w:12,h:14},{c:1123,x0:516,y0:841,yoffs:4,sc:.833333,w:12,h:13},{c:1124,x0:223,y0:770,yoffs:3,xpad:.03125,sc:.833333,w:17,h:14},{c:1125,x0:479,y0:910,yoffs:6,xpad:.34082,sc:.833333,w:14,h:11},{c:1126,x0:251,y0:770,yoffs:3,sc:.833333,w:14,h:14},{c:1127,x0:504,y0:910,yoffs:6,sc:.833333,w:12,h:11},{c:1128,x0:276,y0:770,yoffs:3,sc:.833333,w:19,h:14},{c:1129,x0:527,y0:909,yoffs:6,sc:.833333,w:17,h:11},{c:1130,x0:306,y0:770,yoffs:3,sc:.833333,w:15,h:14},{c:1131,x0:555,y0:909,yoffs:6,xpad:.166992,sc:.833333,w:11,h:11},{c:1132,x0:332,y0:768,yoffs:3,xpad:.238281,sc:.833333,w:19,h:14},{c:1133,x0:577,y0:909,yoffs:6,sc:.833333,w:16,h:11},{c:1134,x0:502,y0:40,xpad:.328125,sc:.833333,w:11,h:21},{c:1135,x0:300,y0:370,yoffs:4,sc:.833333,w:10,h:17},{c:1136,x0:362,y0:767,yoffs:3,xpad:.703125,sc:.833333,w:15,h:14},{c:1137,x0:987,y0:132,yoffs:2,xpad:.00488281,sc:.833333,w:15,h:19},{c:1138,x0:772,y0:687,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:1139,x0:74,y0:894,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:11},{c:1140,x0:388,y0:767,yoffs:3,sc:.833333,w:13,h:14},{c:1141,x0:604,y0:909,yoffs:6,sc:.833333,w:11,h:11},{c:1142,x0:589,y0:280,yoffs:-1,sc:.833333,w:13,h:18},{c:1143,x0:482,y0:613,yoffs:2,sc:.833333,w:11,h:15},{c:1144,x0:613,y0:280,yoffs:3,sc:.833333,w:24,h:18},{c:1145,x0:504,y0:613,yoffs:6,sc:.833333,w:21,h:15},{c:1146,x0:955,y0:449,yoffs:2,xpad:.985352,sc:.833333,w:14,h:16},{c:1147,x0:539,y0:841,yoffs:5,xpad:.172852,sc:.833333,w:12,h:13},{c:1148,x0:507,y0:72,yoffs:-3,xpad:.506836,sc:.833333,w:19,h:20},{c:1149,x0:648,y0:280,yoffs:-1,xpad:.172852,sc:.833333,w:17,h:18},{c:1150,x0:321,y0:369,xpad:.0849609,sc:.833333,w:17,h:17},{c:1151,x0:412,y0:767,yoffs:3,sc:.833333,w:16,h:14},{c:1152,x0:676,y0:280,yoffs:3,xpad:.138672,sc:.833333,w:12,h:18},{c:1153,x0:536,y0:611,yoffs:6,xpad:.394531,sc:.833333,w:9,h:15},{c:1154,x0:562,y0:841,yoffs:4,sc:.833333,w:11,h:13},{c:1160,x0:349,y0:369,yoffs:3,sc:.833333,w:18,h:17},{c:1161,x0:378,y0:368,yoffs:3,xpad:.138672,sc:.833333,w:17,h:17},{c:1162,x0:524,y0:40,yoffs:-1,sc:.833333,w:17,h:21},{c:1163,x0:699,y0:280,yoffs:2,sc:.833333,w:15,h:18},{c:1164,x0:439,y0:767,yoffs:3,xpad:.435547,sc:.833333,w:11,h:14},{c:1165,x0:556,y0:611,yoffs:2,xpad:.00585938,sc:.833333,w:11,h:15},{c:1166,x0:461,y0:766,yoffs:3,xpad:.259766,sc:.833333,w:11,h:14},{c:1167,x0:578,y0:611,yoffs:6,xpad:.347656,sc:.833333,w:11,h:15},{c:1168,x0:406,y0:368,sc:.833333,w:11,h:17},{c:1169,x0:483,y0:766,yoffs:3,xpad:.179688,sc:.833333,w:9,h:14},{c:1170,x0:503,y0:766,yoffs:3,xpad:.0195313,sc:.833333,w:10,h:14},{c:1171,x0:626,y0:909,yoffs:6,sc:.833333,w:9,h:11},{c:1172,x0:725,y0:280,yoffs:3,xpad:.15918,sc:.833333,w:13,h:18},{c:1173,x0:600,y0:611,yoffs:6,sc:.833333,w:11,h:15},{c:1174,x0:428,y0:368,yoffs:3,sc:.833333,w:19,h:17},{c:1175,x0:524,y0:766,yoffs:6,sc:.833333,w:17,h:14},{c:1176,x0:749,y0:280,yoffs:3,xpad:.616211,sc:.833333,w:11,h:18},{c:1177,x0:622,y0:610,yoffs:6,sc:.833333,w:10,h:15},{c:1178,x0:458,y0:368,yoffs:3,sc:.833333,w:14,h:17},{c:1179,x0:552,y0:766,yoffs:6,sc:.833333,w:12,h:14},{c:1180,x0:575,y0:766,yoffs:3,sc:.833333,w:13,h:14},{c:1181,x0:646,y0:909,yoffs:6,sc:.833333,w:12,h:11},{c:1182,x0:599,y0:764,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:14},{c:1183,x0:643,y0:610,yoffs:2,sc:.833333,w:12,h:15},{c:1184,x0:622,y0:764,yoffs:3,sc:.833333,w:14,h:14},{c:1185,x0:669,y0:907,yoffs:6,sc:.833333,w:13,h:11},{c:1186,x0:483,y0:368,yoffs:3,xpad:.078125,sc:.833333,w:15,h:17},{c:1187,x0:647,y0:764,yoffs:6,xpad:.320313,sc:.833333,w:13,h:14},{c:1188,x0:671,y0:764,yoffs:3,sc:.833333,w:15,h:14},{c:1189,x0:693,y0:907,yoffs:6,sc:.833333,w:14,h:11},{c:1190,x0:771,y0:280,yoffs:3,xpad:.166016,sc:.833333,w:20,h:18},{c:1191,x0:666,y0:610,yoffs:6,sc:.833333,w:16,h:15},{c:1192,x0:697,y0:763,yoffs:3,sc:.833333,w:14,h:14},{c:1193,x0:718,y0:907,yoffs:6,sc:.833333,w:12,h:11},{c:1194,x0:802,y0:279,yoffs:3,xpad:.420898,sc:.833333,w:11,h:18},{c:1195,x0:693,y0:610,yoffs:6,xpad:.213867,sc:.833333,w:9,h:15},{c:1196,x0:509,y0:367,yoffs:3,sc:.833333,w:11,h:17},{c:1197,x0:722,y0:763,yoffs:6,sc:.833333,w:10,h:14},{c:1198,x0:743,y0:763,yoffs:3,sc:.833333,w:12,h:14},{c:1199,x0:713,y0:609,yoffs:6,sc:.833333,w:11,h:15},{c:1200,x0:766,y0:763,yoffs:3,sc:.833333,w:12,h:14},{c:1201,x0:735,y0:609,yoffs:6,sc:.833333,w:11,h:15},{c:1202,x0:531,y0:367,yoffs:3,xpad:.320313,sc:.833333,w:13,h:17},{c:1203,x0:789,y0:762,yoffs:6,sc:.833333,w:12,h:14},{c:1204,x0:555,y0:367,yoffs:3,sc:.833333,w:17,h:17},{c:1205,x0:812,y0:762,yoffs:6,xpad:.179688,sc:.833333,w:14,h:14},{c:1206,x0:583,y0:367,yoffs:3,sc:.833333,w:15,h:17},{c:1207,x0:837,y0:762,yoffs:6,xpad:.0126953,sc:.833333,w:13,h:14},{c:1208,x0:861,y0:762,yoffs:3,xpad:1.05176,sc:.833333,w:12,h:14},{c:1209,x0:741,y0:907,yoffs:6,xpad:.757813,sc:.833333,w:11,h:11},{c:1210,x0:884,y0:762,yoffs:3,xpad:.0517578,sc:.833333,w:13,h:14},{c:1211,x0:757,y0:609,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:1212,x0:908,y0:761,yoffs:3,xpad:.99707,sc:.833333,w:16,h:14},{c:1213,x0:763,y0:906,yoffs:6,sc:.833333,w:13,h:11},{c:1214,x0:609,y0:367,yoffs:3,xpad:.99707,sc:.833333,w:16,h:17},{c:1215,x0:935,y0:761,yoffs:6,sc:.833333,w:13,h:14},{c:1216,x0:567,y0:741,yoffs:3,sc:.833333,w:7,h:14},{c:1217,x0:824,y0:279,yoffs:-1,sc:.833333,w:17,h:18},{c:1218,x0:779,y0:609,yoffs:2,sc:.833333,w:16,h:15},{c:1219,x0:852,y0:279,yoffs:3,xpad:.623047,sc:.833333,w:13,h:18},{c:1220,x0:806,y0:609,yoffs:6,xpad:.704102,sc:.833333,w:11,h:15},{c:1221,x0:636,y0:367,yoffs:3,xpad:.0244141,sc:.833333,w:15,h:17},{c:1222,x0:959,y0:761,yoffs:6,xpad:.0322266,sc:.833333,w:13,h:14},{c:1223,x0:876,y0:279,yoffs:3,xpad:.71582,sc:.833333,w:13,h:18},{c:1224,x0:828,y0:609,yoffs:6,xpad:.870117,sc:.833333,w:11,h:15},{c:1225,x0:662,y0:366,yoffs:3,sc:.833333,w:16,h:17},{c:1226,x0:983,y0:761,yoffs:6,sc:.833333,w:14,h:14},{c:1227,x0:689,y0:366,yoffs:3,xpad:1.05176,sc:.833333,w:12,h:17},{c:1228,x0:5,y0:796,yoffs:6,xpad:.757813,sc:.833333,w:11,h:14},{c:1229,x0:712,y0:366,yoffs:3,sc:.833333,w:19,h:17},{c:1230,x0:27,y0:796,yoffs:6,sc:.833333,w:17,h:14},{c:1231,x0:567,y0:741,yoffs:3,sc:.833333,w:7,h:14},{c:1232,x0:900,y0:279,yoffs:-1,sc:.833333,w:13,h:18},{c:1233,x0:850,y0:609,yoffs:2,xpad:.830078,sc:.833333,w:10,h:15},{c:1234,x0:924,y0:279,yoffs:-1,sc:.833333,w:13,h:18},{c:1235,x0:871,y0:609,yoffs:2,xpad:.830078,sc:.833333,w:10,h:15},{c:1236,x0:55,y0:796,yoffs:3,xpad:.0654297,sc:.833333,w:17,h:14},{c:1237,x0:787,y0:906,yoffs:6,xpad:.44043,sc:.833333,w:16,h:11},{c:1238,x0:948,y0:279,yoffs:-1,xpad:.0390625,sc:.833333,w:10,h:18},{c:1239,x0:892,y0:609,yoffs:2,xpad:.595703,sc:.833333,w:10,h:15},{c:1240,x0:637,y0:689,yoffs:3,xpad:.648438,sc:.833333,w:14,h:14},{c:1241,x0:649,y0:863,yoffs:6,xpad:.595703,sc:.833333,w:10,h:11},{c:1242,x0:969,y0:279,yoffs:-1,xpad:.648438,sc:.833333,w:14,h:18},{c:1243,x0:913,y0:609,yoffs:2,xpad:.595703,sc:.833333,w:10,h:15},{c:1244,x0:994,y0:279,yoffs:-1,sc:.833333,w:17,h:18},{c:1245,x0:934,y0:609,yoffs:2,sc:.833333,w:16,h:15},{c:1246,x0:5,y0:315,yoffs:-1,xpad:.616211,sc:.833333,w:11,h:18},{c:1247,x0:961,y0:608,yoffs:2,sc:.833333,w:10,h:15},{c:1248,x0:5,y0:721,yoffs:3,xpad:.595703,sc:.833333,w:10,h:14},{c:1249,x0:445,y0:587,yoffs:6,xpad:.415039,sc:.833333,w:10,h:15},{c:1250,x0:742,y0:366,xpad:.755859,sc:.833333,w:14,h:17},{c:1251,x0:83,y0:796,yoffs:3,xpad:.905273,sc:.833333,w:12,h:14},{c:1252,x0:27,y0:315,yoffs:-1,xpad:.755859,sc:.833333,w:14,h:18},{c:1253,x0:982,y0:608,yoffs:2,xpad:.905273,sc:.833333,w:12,h:15},{c:1254,x0:52,y0:315,yoffs:-1,xpad:.272461,sc:.833333,w:14,h:18},{c:1255,x0:1005,y0:608,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:1256,x0:772,y0:687,yoffs:3,xpad:.272461,sc:.833333,w:14,h:14},{c:1257,x0:74,y0:894,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:11},{c:1258,x0:77,y0:315,yoffs:-1,xpad:.272461,sc:.833333,w:14,h:18},{c:1259,x0:5,y0:644,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:1260,x0:102,y0:315,yoffs:-1,xpad:.884766,sc:.833333,w:11,h:18},{c:1261,x0:27,y0:644,yoffs:2,xpad:.179688,sc:.833333,w:9,h:15},{c:1262,x0:767,y0:366,sc:.833333,w:12,h:17},{c:1263,x0:167,y0:284,yoffs:3,sc:.833333,w:11,h:18},{c:1264,x0:124,y0:315,yoffs:-1,sc:.833333,w:12,h:18},{c:1265,x0:5,y0:168,yoffs:2,sc:.833333,w:11,h:19},{c:1266,x0:147,y0:313,yoffs:-1,sc:.833333,w:12,h:18},{c:1267,x0:27,y0:168,yoffs:2,sc:.833333,w:11,h:19},{c:1268,x0:170,y0:313,yoffs:-1,xpad:1.05176,sc:.833333,w:12,h:18},{c:1269,x0:47,y0:644,yoffs:2,xpad:.757813,sc:.833333,w:11,h:15},{c:1270,x0:790,y0:366,yoffs:3,xpad:.0585938,sc:.833333,w:10,h:17},{c:1271,x0:106,y0:796,yoffs:6,sc:.833333,w:9,h:14},{c:1272,x0:193,y0:313,yoffs:-1,xpad:1.24023,sc:.833333,w:15,h:18},{c:1273,x0:69,y0:644,yoffs:2,xpad:1.23926,sc:.833333,w:14,h:15},{c:1274,x0:219,y0:312,yoffs:3,xpad:.0195313,sc:.833333,w:10,h:18},{c:1275,x0:94,y0:644,yoffs:6,sc:.833333,w:9,h:15},{c:1276,x0:240,y0:312,yoffs:3,xpad:.125,sc:.833333,w:13,h:18},{c:1277,x0:114,y0:643,yoffs:6,xpad:.5625,sc:.833333,w:11,h:15},{c:1278,x0:126,y0:796,yoffs:3,sc:.833333,w:12,h:14},{c:1279,x0:814,y0:906,yoffs:6,sc:.833333,w:11,h:11},{c:7424,x0:836,y0:906,yoffs:6,xpad:.0585938,sc:.833333,w:10,h:11},{c:7425,x0:857,y0:905,yoffs:6,xpad:.696289,sc:.833333,w:13,h:11},{c:7426,x0:881,y0:905,yoffs:6,xpad:.44043,sc:.833333,w:16,h:11},{c:7427,x0:908,y0:905,yoffs:6,sc:.833333,w:12,h:11},{c:7428,x0:931,y0:905,yoffs:6,xpad:.306641,sc:.833333,w:9,h:11},{c:7429,x0:951,y0:905,yoffs:6,xpad:.917969,sc:.833333,w:10,h:11},{c:7430,x0:972,y0:905,yoffs:6,xpad:.917969,sc:.833333,w:10,h:11},{c:7431,x0:993,y0:904,yoffs:6,xpad:.354492,sc:.833333,w:8,h:11},{c:7432,x0:5,y0:938,yoffs:6,sc:.833333,w:10,h:11},{c:7433,x0:136,y0:643,yoffs:6,xpad:.46875,sc:.833333,w:5,h:15},{c:7434,x0:26,y0:938,yoffs:6,xpad:.757813,sc:.833333,w:6,h:11},{c:7435,x0:43,y0:938,yoffs:6,sc:.833333,w:10,h:11},{c:7436,x0:64,y0:938,yoffs:6,xpad:.374023,sc:.833333,w:8,h:11},{c:7437,x0:83,y0:938,yoffs:6,xpad:.78418,sc:.833333,w:13,h:11},{c:7438,x0:107,y0:938,yoffs:6,xpad:.958008,sc:.833333,w:11,h:11},{c:7439,x0:129,y0:937,yoffs:6,xpad:.650391,sc:.833333,w:11,h:11},{c:7440,x0:151,y0:937,yoffs:6,xpad:.321289,sc:.833333,w:9,h:11},{c:7441,x0:171,y0:937,yoffs:6,xpad:.757813,sc:.833333,w:11,h:11},{c:7442,x0:525,y0:954,yoffs:7,xpad:.757813,sc:.833333,w:11,h:9},{c:7443,x0:193,y0:937,yoffs:6,sc:.833333,w:12,h:11},{c:7444,x0:216,y0:937,yoffs:6,xpad:.53418,sc:.833333,w:17,h:11},{c:7445,x0:244,y0:937,yoffs:6,xpad:.449219,sc:.833333,w:10,h:11},{c:7446,x0:155,y0:980,yoffs:6,xpad:.0986328,sc:.833333,w:11,h:6},{c:7447,x0:177,y0:980,yoffs:11,xpad:.0986328,sc:.833333,w:11,h:6},{c:7448,x0:265,y0:937,yoffs:6,xpad:.394531,sc:.833333,w:9,h:11},{c:7449,x0:285,y0:936,yoffs:6,xpad:.931641,sc:.833333,w:9,h:11},{c:7450,x0:305,y0:936,yoffs:6,xpad:.931641,sc:.833333,w:9,h:11},{c:7451,x0:325,y0:936,yoffs:6,xpad:.334961,sc:.833333,w:8,h:11},{c:7452,x0:344,y0:936,yoffs:6,xpad:.689453,sc:.833333,w:11,h:11},{c:7453,x0:198,y0:959,yoffs:6,xpad:.240234,sc:.833333,w:11,h:10},{c:7454,x0:220,y0:959,yoffs:6,sc:.833333,w:15,h:10},{c:7455,x0:980,y0:449,yoffs:3,xpad:.240234,sc:.833333,w:11,h:16},{c:7456,x0:366,y0:936,yoffs:6,xpad:.0527344,sc:.833333,w:9,h:11},{c:7457,x0:386,y0:936,yoffs:6,sc:.833333,w:15,h:11},{c:7458,x0:412,y0:934,yoffs:6,sc:.833333,w:9,h:11},{c:7459,x0:432,y0:933,yoffs:6,xpad:.78418,sc:.833333,w:8,h:11},{c:7460,x0:451,y0:933,yoffs:6,xpad:.354492,sc:.833333,w:8,h:11},{c:7461,x0:470,y0:933,yoffs:6,xpad:.233398,sc:.833333,w:9,h:11},{c:7462,x0:490,y0:932,yoffs:6,xpad:.427734,sc:.833333,w:8,h:11},{c:7463,x0:509,y0:932,yoffs:6,sc:.833333,w:10,h:11},{c:7464,x0:530,y0:931,yoffs:6,xpad:1.02539,sc:.833333,w:10,h:11},{c:7465,x0:265,y0:937,yoffs:6,xpad:.394531,sc:.833333,w:9,h:11},{c:7466,x0:551,y0:931,yoffs:6,xpad:.709961,sc:.833333,w:12,h:11},{c:7467,x0:574,y0:931,yoffs:6,xpad:.917969,sc:.833333,w:10,h:11},{c:7468,x0:324,y0:996,yoffs:8,xpad:3.04688,sc:.833333,w:5,h:4},{c:7469,x0:340,y0:996,yoffs:8,xpad:4.09863,sc:.833333,w:7,h:4},{c:7470,x0:358,y0:996,yoffs:8,xpad:2.83203,sc:.833333,w:5,h:4},{c:7471,x0:547,y0:953,yoffs:3,sc:.833333,w:8,h:9},{c:7472,x0:374,y0:996,yoffs:8,xpad:2.62305,sc:.833333,w:6,h:4},{c:7473,x0:391,y0:996,yoffs:8,xpad:2.52344,sc:.833333,w:4,h:4},{c:7474,x0:406,y0:996,yoffs:8,xpad:2.52344,sc:.833333,w:4,h:4},{c:7475,x0:421,y0:996,yoffs:8,xpad:3.44238,sc:.833333,w:5,h:4},{c:7476,x0:437,y0:994,yoffs:8,xpad:2.91113,sc:.833333,w:6,h:4},{c:7477,x0:454,y0:994,yoffs:8,xpad:1.53613,sc:.833333,w:3,h:4},{c:7478,x0:199,y0:980,yoffs:8,xpad:1.85254,sc:.833333,w:2,h:6},{c:7479,x0:468,y0:993,yoffs:8,xpad:2.74414,sc:.833333,w:5,h:4},{c:7480,x0:484,y0:993,yoffs:8,xpad:4.57715,sc:.833333,w:2,h:4},{c:7481,x0:497,y0:993,yoffs:8,xpad:3.99121,sc:.833333,w:7,h:4},{c:7482,x0:515,y0:992,yoffs:8,xpad:3.46777,sc:.833333,w:6,h:4},{c:7483,x0:566,y0:953,yoffs:3,xpad:.467773,sc:.833333,w:9,h:9},{c:7484,x0:532,y0:991,yoffs:8,xpad:3.26758,sc:.833333,w:6,h:4},{c:7485,x0:549,y0:991,yoffs:8,xpad:2.92578,sc:.833333,w:6,h:4},{c:7486,x0:566,y0:990,yoffs:8,xpad:2.31445,sc:.833333,w:5,h:4},{c:7487,x0:582,y0:990,yoffs:8,xpad:2.69043,sc:.833333,w:5,h:4},{c:7488,x0:598,y0:990,yoffs:8,xpad:1.73828,sc:.833333,w:5,h:4},{c:7489,x0:614,y0:990,yoffs:8,xpad:2.80371,sc:.833333,w:6,h:4},{c:7490,x0:631,y0:988,yoffs:8,xpad:3.27441,sc:.833333,w:8,h:4},{c:7491,x0:963,y0:983,yoffs:9,xpad:3.0459,sc:.833333,w:4,h:3},{c:7492,x0:978,y0:983,yoffs:9,xpad:2.0459,sc:.833333,w:5,h:3},{c:7493,x0:994,y0:983,yoffs:9,xpad:2.36816,sc:.833333,w:5,h:3},{c:7494,x0:1010,y0:983,yoffs:9,xpad:3.68359,sc:.833333,w:7,h:3},{c:7495,x0:650,y0:988,yoffs:8,xpad:2.36816,sc:.833333,w:5,h:4},{c:7496,x0:666,y0:988,yoffs:8,xpad:2.36816,sc:.833333,w:5,h:4},{c:7497,x0:86,y0:1015,yoffs:9,xpad:1.88477,sc:.833333,w:5,h:3},{c:7498,x0:102,y0:1015,yoffs:9,xpad:1.88477,sc:.833333,w:5,h:3},{c:7499,x0:118,y0:1015,yoffs:9,xpad:2.46973,sc:.833333,w:4,h:3},{c:7500,x0:133,y0:1014,yoffs:9,xpad:2.20117,sc:.833333,w:4,h:3},{c:7501,x0:699,y0:970,yoffs:9,xpad:2.36816,sc:.833333,w:5,h:5},{c:7502,x0:715,y0:970,yoffs:9,xpad:1.5498,sc:.833333,w:2,h:5},{c:7503,x0:682,y0:988,yoffs:8,xpad:2.22656,sc:.833333,w:5,h:4},{c:7504,x0:148,y0:1014,yoffs:9,xpad:4.43555,sc:.833333,w:7,h:3},{c:7505,x0:728,y0:969,yoffs:9,xpad:2.65625,sc:.833333,w:5,h:5},{c:7506,x0:166,y0:1012,yoffs:9,xpad:2.20703,sc:.833333,w:5,h:3},{c:7507,x0:182,y0:1012,yoffs:9,xpad:1.98633,sc:.833333,w:4,h:3},{c:7508,xpad:7.20703,sc:.833333},{c:7509,xpad:7.20703,sc:.833333},{c:7510,x0:744,y0:969,yoffs:9,xpad:2.36816,sc:.833333,w:5,h:5},{c:7511,x0:698,y0:988,yoffs:8,xpad:2.05371,sc:.833333,w:3,h:4},{c:7512,x0:197,y0:1012,yoffs:9,xpad:2.65625,sc:.833333,w:5,h:3},{c:7513,x0:445,y0:1009,yoffs:9,xpad:2.31445,sc:.833333,w:5,h:2},{c:7514,x0:213,y0:1012,yoffs:9,xpad:4.43555,sc:.833333,w:7,h:3},{c:7515,x0:231,y0:1012,yoffs:9,xpad:1.63086,sc:.833333,w:5,h:3},{c:7516,x0:247,y0:1012,yoffs:9,xpad:2.00586,sc:.833333,w:4,h:3},{c:7517,x0:212,y0:980,yoffs:8,xpad:2.69043,sc:.833333,w:5,h:6},{c:7518,x0:760,y0:969,yoffs:9,xpad:1.61621,sc:.833333,w:5,h:5},{c:7519,x0:712,y0:986,yoffs:8,xpad:2.20703,sc:.833333,w:5,h:4},{c:7520,x0:776,y0:969,yoffs:9,xpad:3.2334,sc:.833333,w:6,h:5},{c:7521,x0:793,y0:968,yoffs:9,xpad:1.9043,sc:.833333,w:5,h:5},{c:7522,x0:228,y0:980,yoffs:12,xpad:1.5498,sc:.833333,w:2,h:6},{c:7523,x0:809,y0:968,yoffs:13,xpad:1.28809,sc:.833333,w:4,h:5},{c:7524,x0:824,y0:968,yoffs:13,xpad:2.65625,sc:.833333,w:5,h:5},{c:7525,x0:840,y0:968,yoffs:13,xpad:1.63086,sc:.833333,w:5,h:5},{c:7526,x0:842,y0:950,yoffs:12,xpad:2.69043,sc:.833333,w:5,h:7},{c:7527,x0:241,y0:980,yoffs:13,xpad:1.61621,sc:.833333,w:5,h:6},{c:7528,x0:257,y0:980,yoffs:13,xpad:2.20703,sc:.833333,w:5,h:6},{c:7529,x0:273,y0:980,yoffs:13,xpad:3.2334,sc:.833333,w:6,h:6},{c:7530,x0:290,y0:979,yoffs:13,xpad:1.08008,sc:.833333,w:6,h:6},{c:7531,x0:595,y0:931,yoffs:6,xpad:.373047,sc:.833333,w:17,h:11},{c:7532,x0:152,y0:643,yoffs:2,sc:.833333,w:13,h:15},{c:7533,x0:176,y0:643,yoffs:2,sc:.833333,w:13,h:15},{c:7534,x0:200,y0:643,yoffs:2,sc:.833333,w:9,h:15},{c:7535,x0:623,y0:931,yoffs:6,sc:.833333,w:20,h:11},{c:7536,x0:654,y0:931,yoffs:6,sc:.833333,w:14,h:11},{c:7537,x0:220,y0:643,yoffs:6,sc:.833333,w:13,h:15},{c:7538,x0:679,y0:929,yoffs:6,sc:.833333,w:10,h:11},{c:7539,x0:700,y0:929,yoffs:6,sc:.833333,w:9,h:11},{c:7540,x0:720,y0:929,yoffs:6,sc:.833333,w:11,h:11},{c:7541,x0:584,y0:841,yoffs:4,sc:.833333,w:9,h:13},{c:7542,x0:742,y0:929,yoffs:6,sc:.833333,w:9,h:11},{c:7543,x0:244,y0:643,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:7544,x0:262,y0:1012,yoffs:9,xpad:2.70996,sc:.833333,w:5,h:3},{c:7545,x0:266,y0:641,yoffs:6,xpad:.146484,sc:.833333,w:10,h:15},{c:7546,x0:5,y0:485,yoffs:2,xpad:.560547,sc:.833333,w:19,h:16},{c:7547,x0:762,y0:929,yoffs:6,sc:.833333,w:7,h:11},{c:7548,x0:780,y0:928,yoffs:6,xpad:.294922,sc:.833333,w:7,h:11},{c:7549,x0:287,y0:640,yoffs:6,sc:.833333,w:12,h:15},{c:7550,x0:798,y0:928,yoffs:6,sc:.833333,w:12,h:11},{c:7551,x0:821,y0:928,yoffs:6,sc:.833333,w:12,h:11},{c:7680,x0:49,y0:168,yoffs:3,sc:.833333,w:13,h:19},{c:7681,x0:35,y0:485,yoffs:6,xpad:.830078,sc:.833333,w:10,h:16},{c:7682,x0:264,y0:312,yoffs:-1,xpad:.0458984,sc:.833333,w:12,h:18},{c:7683,x0:310,y0:640,yoffs:2,xpad:.347656,sc:.833333,w:11,h:15},{c:7684,x0:811,y0:366,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:17},{c:7685,x0:287,y0:311,yoffs:2,xpad:.347656,sc:.833333,w:11,h:18},{c:7686,x0:834,y0:365,yoffs:3,xpad:.0458984,sc:.833333,w:12,h:17},{c:7687,x0:309,y0:311,yoffs:2,xpad:.347656,sc:.833333,w:11,h:18},{c:7688,x0:204,y0:41,yoffs:-1,xpad:.420898,sc:.833333,w:11,h:22},{c:7689,x0:73,y0:167,yoffs:2,xpad:.213867,sc:.833333,w:9,h:19},{c:7690,x0:331,y0:311,yoffs:-1,xpad:.266602,sc:.833333,w:13,h:18},{c:7691,x0:332,y0:640,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:15},{c:7692,x0:857,y0:365,yoffs:3,xpad:.266602,sc:.833333,w:13,h:17},{c:7693,x0:355,y0:310,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:18},{c:7694,x0:881,y0:365,yoffs:3,xpad:.266602,sc:.833333,w:13,h:17},{c:7695,x0:376,y0:310,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:18},{c:7696,x0:397,y0:310,yoffs:3,xpad:.266602,sc:.833333,w:13,h:18},{c:7697,x0:93,y0:167,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:19},{c:7698,x0:905,y0:365,yoffs:3,xpad:.266602,sc:.833333,w:13,h:17},{c:7699,x0:421,y0:310,yoffs:2,xpad:1.34766,sc:.833333,w:10,h:18},{c:7700,x0:537,y0:72,yoffs:-3,xpad:1.03906,sc:.833333,w:9,h:20},{c:7701,x0:929,y0:365,xpad:.595703,sc:.833333,w:10,h:17},{c:7702,x0:557,y0:72,yoffs:-3,xpad:1.03906,sc:.833333,w:9,h:20},{c:7703,x0:950,y0:365,xpad:.595703,sc:.833333,w:10,h:17},{c:7704,x0:971,y0:365,yoffs:3,xpad:.0390625,sc:.833333,w:10,h:17},{c:7705,x0:149,y0:796,yoffs:6,xpad:.595703,sc:.833333,w:10,h:14},{c:7706,x0:992,y0:365,yoffs:3,xpad:1.03906,sc:.833333,w:9,h:17},{c:7707,x0:170,y0:796,yoffs:6,xpad:.595703,sc:.833333,w:10,h:14},{c:7708,x0:226,y0:40,yoffs:-1,xpad:1.03906,sc:.833333,w:9,h:22},{c:7709,x0:114,y0:167,yoffs:2,xpad:.595703,sc:.833333,w:10,h:19},{c:7710,x0:442,y0:310,yoffs:-1,xpad:.84375,sc:.833333,w:9,h:18},{c:7711,x0:462,y0:310,yoffs:-1,sc:.833333,w:8,h:18},{c:7712,x0:5,y0:401,xpad:.978516,sc:.833333,w:12,h:17},{c:7713,x0:481,y0:309,yoffs:3,xpad:1.34766,sc:.833333,w:10,h:18},{c:7714,x0:502,y0:309,yoffs:-1,xpad:.71582,sc:.833333,w:13,h:18},{c:7715,x0:135,y0:167,yoffs:-2,xpad:.777344,sc:.833333,w:11,h:19},{c:7716,x0:28,y0:401,yoffs:3,xpad:.71582,sc:.833333,w:13,h:17},{c:7717,x0:526,y0:309,yoffs:2,xpad:.777344,sc:.833333,w:11,h:18},{c:7718,x0:548,y0:309,yoffs:-1,xpad:.71582,sc:.833333,w:13,h:18},{c:7719,x0:157,y0:166,yoffs:-2,xpad:.0117188,sc:.833333,w:12,h:19},{c:7720,x0:572,y0:309,yoffs:3,xpad:.71582,sc:.833333,w:13,h:18},{c:7721,x0:180,y0:166,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:7722,x0:596,y0:309,yoffs:3,xpad:.71582,sc:.833333,w:13,h:18},{c:7723,x0:202,y0:166,yoffs:2,xpad:.777344,sc:.833333,w:11,h:19},{c:7724,x0:52,y0:401,yoffs:3,sc:.833333,w:9,h:17},{c:7725,x0:620,y0:309,yoffs:2,sc:.833333,w:8,h:18},{c:7726,x0:577,y0:72,yoffs:-3,sc:.833333,w:7,h:20},{c:7727,x0:72,y0:401,sc:.833333,w:8,h:17},{c:7728,x0:639,y0:309,yoffs:-1,sc:.833333,w:12,h:18},{c:7729,x0:224,y0:165,yoffs:-2,sc:.833333,w:12,h:19},{c:7730,x0:91,y0:401,yoffs:3,sc:.833333,w:12,h:17},{c:7731,x0:662,y0:309,yoffs:2,sc:.833333,w:12,h:18},{c:7732,x0:114,y0:401,yoffs:3,sc:.833333,w:12,h:17},{c:7733,x0:685,y0:309,yoffs:2,sc:.833333,w:12,h:18},{c:7734,x0:137,y0:401,yoffs:3,xpad:.126953,sc:.833333,w:10,h:17},{c:7735,x0:708,y0:309,yoffs:2,xpad:.46875,sc:.833333,w:5,h:18},{c:7736,x0:595,y0:72,sc:.833333,w:11,h:20},{c:7737,x0:552,y0:40,yoffs:-1,sc:.833333,w:7,h:21},{c:7738,x0:158,y0:401,yoffs:3,xpad:.126953,sc:.833333,w:10,h:17},{c:7739,x0:724,y0:309,yoffs:2,sc:.833333,w:7,h:18},{c:7740,x0:179,y0:399,yoffs:3,xpad:.126953,sc:.833333,w:10,h:17},{c:7741,x0:742,y0:309,yoffs:2,sc:.833333,w:9,h:18},{c:7742,x0:247,y0:165,yoffs:-2,xpad:.770508,sc:.833333,w:14,h:19},{c:7743,x0:200,y0:399,xpad:.674805,sc:.833333,w:16,h:17},{c:7744,x0:762,y0:309,yoffs:-1,xpad:.904297,sc:.833333,w:16,h:18},{c:7745,x0:353,y0:640,yoffs:2,xpad:.602539,sc:.833333,w:17,h:15},{c:7746,x0:227,y0:398,yoffs:3,xpad:.904297,sc:.833333,w:16,h:17},{c:7747,x0:191,y0:796,yoffs:6,xpad:.602539,sc:.833333,w:17,h:14},{c:7748,x0:789,y0:309,yoffs:-1,xpad:1.5752,sc:.833333,w:13,h:18},{c:7749,x0:381,y0:640,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:7750,x0:254,y0:398,yoffs:3,xpad:1.5752,sc:.833333,w:13,h:17},{c:7751,x0:219,y0:795,yoffs:6,xpad:.777344,sc:.833333,w:11,h:14},{c:7752,x0:278,y0:398,yoffs:3,xpad:1.5752,sc:.833333,w:13,h:17},{c:7753,x0:241,y0:795,yoffs:6,xpad:.777344,sc:.833333,w:11,h:14},{c:7754,x0:302,y0:398,yoffs:3,xpad:1.5752,sc:.833333,w:13,h:17},{c:7755,x0:263,y0:795,yoffs:6,xpad:.777344,sc:.833333,w:11,h:14},{c:7756,x0:617,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:7757,x0:326,y0:397,xpad:.0986328,sc:.833333,w:11,h:17},{c:7758,x0:642,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:7759,x0:348,y0:397,xpad:.0986328,sc:.833333,w:11,h:17},{c:7760,x0:667,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:7761,x0:370,y0:397,xpad:.0986328,sc:.833333,w:11,h:17},{c:7762,x0:692,y0:72,yoffs:-3,xpad:.272461,sc:.833333,w:14,h:20},{c:7763,x0:392,y0:396,xpad:.0986328,sc:.833333,w:11,h:17},{c:7764,x0:813,y0:308,yoffs:-1,xpad:.259766,sc:.833333,w:11,h:18},{c:7765,x0:272,y0:164,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:7766,x0:835,y0:308,yoffs:-1,xpad:.259766,sc:.833333,w:11,h:18},{c:7767,x0:294,y0:164,yoffs:2,xpad:.347656,sc:.833333,w:11,h:19},{c:7768,x0:857,y0:308,yoffs:-1,sc:.833333,w:12,h:18},{c:7769,x0:403,y0:639,yoffs:2,xpad:.139648,sc:.833333,w:8,h:15},{c:7770,x0:414,y0:396,yoffs:3,sc:.833333,w:12,h:17},{c:7771,x0:285,y0:795,yoffs:6,xpad:.139648,sc:.833333,w:8,h:14},{c:7772,x0:717,y0:71,sc:.833333,w:12,h:20},{c:7773,x0:437,y0:396,yoffs:3,xpad:.139648,sc:.833333,w:8,h:17},{c:7774,x0:456,y0:396,yoffs:3,sc:.833333,w:12,h:17},{c:7775,x0:304,y0:795,yoffs:6,xpad:.139648,sc:.833333,w:8,h:14},{c:7776,x0:880,y0:308,yoffs:-1,sc:.833333,w:10,h:18},{c:7777,x0:422,y0:639,yoffs:2,sc:.833333,w:9,h:15},{c:7778,x0:479,y0:396,yoffs:3,sc:.833333,w:10,h:17},{c:7779,x0:323,y0:795,yoffs:6,sc:.833333,w:9,h:14},{c:7780,x0:901,y0:308,yoffs:-1,sc:.833333,w:10,h:18},{c:7781,x0:442,y0:639,yoffs:2,sc:.833333,w:9,h:15},{c:7782,x0:740,y0:71,yoffs:-3,sc:.833333,w:10,h:20},{c:7783,x0:500,y0:396,sc:.833333,w:9,h:17},{c:7784,x0:570,y0:40,yoffs:-1,sc:.833333,w:10,h:21},{c:7785,x0:922,y0:308,yoffs:2,sc:.833333,w:9,h:18},{c:7786,x0:942,y0:308,yoffs:-1,sc:.833333,w:11,h:18},{c:7787,x0:520,y0:395,sc:.833333,w:8,h:17},{c:7788,x0:539,y0:395,yoffs:3,sc:.833333,w:11,h:17},{c:7789,x0:56,y0:485,yoffs:4,sc:.833333,w:8,h:16},{c:7790,x0:561,y0:395,yoffs:3,sc:.833333,w:11,h:17},{c:7791,x0:75,y0:485,yoffs:4,sc:.833333,w:8,h:16},{c:7792,x0:583,y0:395,yoffs:3,sc:.833333,w:11,h:17},{c:7793,x0:605,y0:395,yoffs:4,sc:.833333,w:9,h:17},{c:7794,x0:964,y0:308,yoffs:-1,xpad:.554688,sc:.833333,w:13,h:18},{c:7795,x0:462,y0:639,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:7796,x0:988,y0:308,yoffs:-1,xpad:.554688,sc:.833333,w:13,h:18},{c:7797,x0:484,y0:639,yoffs:2,xpad:.777344,sc:.833333,w:11,h:15},{c:7798,x0:625,y0:395,yoffs:3,xpad:.554688,sc:.833333,w:13,h:17},{c:7799,x0:506,y0:639,yoffs:6,xpad:.777344,sc:.833333,w:11,h:15},{c:7800,x0:761,y0:71,yoffs:-3,xpad:.554688,sc:.833333,w:13,h:20},{c:7801,x0:649,y0:395,xpad:.777344,sc:.833333,w:11,h:17},{c:7802,x0:785,y0:71,yoffs:-3,xpad:.554688,sc:.833333,w:13,h:20},{c:7803,x0:671,y0:394,xpad:.777344,sc:.833333,w:11,h:17},{c:7804,x0:5,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7805,x0:528,y0:639,yoffs:2,sc:.833333,w:11,h:15},{c:7806,x0:693,y0:394,yoffs:3,sc:.833333,w:12,h:17},{c:7807,x0:343,y0:793,yoffs:6,sc:.833333,w:11,h:14},{c:7808,x0:316,y0:164,yoffs:-2,sc:.833333,w:21,h:19},{c:7809,x0:550,y0:637,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:7810,x0:348,y0:164,yoffs:-2,sc:.833333,w:21,h:19},{c:7811,x0:575,y0:637,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:7812,x0:28,y0:344,yoffs:-1,sc:.833333,w:21,h:18},{c:7813,x0:600,y0:637,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:7814,x0:60,y0:344,yoffs:-1,sc:.833333,w:18,h:18},{c:7815,x0:625,y0:636,yoffs:2,sc:.833333,w:16,h:15},{c:7816,x0:716,y0:394,yoffs:3,sc:.833333,w:18,h:17},{c:7817,x0:365,y0:792,yoffs:6,sc:.833333,w:16,h:14},{c:7818,x0:89,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7819,x0:652,y0:636,yoffs:2,sc:.833333,w:11,h:15},{c:7820,x0:112,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7821,x0:674,y0:636,yoffs:2,sc:.833333,w:11,h:15},{c:7822,x0:135,y0:344,yoffs:-1,sc:.833333,w:12,h:18},{c:7823,x0:380,y0:164,yoffs:2,sc:.833333,w:11,h:19},{c:7824,x0:158,y0:342,yoffs:-1,xpad:.380859,sc:.833333,w:10,h:18},{c:7825,x0:696,y0:636,yoffs:2,sc:.833333,w:9,h:15},{c:7826,x0:745,y0:394,yoffs:3,xpad:.380859,sc:.833333,w:10,h:17},{c:7827,x0:392,y0:792,yoffs:6,sc:.833333,w:9,h:14},{c:7828,x0:766,y0:394,yoffs:3,xpad:.380859,sc:.833333,w:10,h:17},{c:7829,x0:412,y0:792,yoffs:6,sc:.833333,w:9,h:14},{c:7830,x0:179,y0:342,yoffs:2,xpad:.777344,sc:.833333,w:11,h:18},{c:7831,x0:787,y0:394,sc:.833333,w:8,h:17},{c:7832,x0:94,y0:485,yoffs:1,sc:.833333,w:16,h:16},{c:7833,x0:809,y0:71,yoffs:1,sc:.833333,w:11,h:20},{c:7834,x0:121,y0:485,yoffs:1,xpad:.830078,sc:.833333,w:10,h:16},{c:7835,x0:201,y0:342,yoffs:-1,sc:.833333,w:8,h:18},{c:7836,x0:716,y0:635,yoffs:2,sc:.833333,w:9,h:15},{c:7837,x0:736,y0:635,yoffs:2,sc:.833333,w:8,h:15},{c:7838,x0:432,y0:792,yoffs:3,xpad:.155273,sc:.833333,w:14,h:14},{c:7839,x0:755,y0:635,yoffs:2,xpad:.0986328,sc:.833333,w:11,h:15},{c:7840,x0:220,y0:341,yoffs:3,sc:.833333,w:13,h:18},{c:7841,x0:777,y0:635,yoffs:6,xpad:1.22461,sc:.833333,w:9,h:15},{c:7842,x0:402,y0:164,yoffs:-2,sc:.833333,w:13,h:19},{c:7843,x0:806,y0:394,xpad:1.22461,sc:.833333,w:9,h:17},{c:7844,x0:426,y0:163,yoffs:-2,sc:.833333,w:13,h:19},{c:7845,x0:826,y0:394,sc:.833333,w:11,h:17},{c:7846,x0:450,y0:163,yoffs:-2,sc:.833333,w:13,h:19},{c:7847,x0:848,y0:393,xpad:1.22461,sc:.833333,w:9,h:17},{c:7848,x0:474,y0:163,yoffs:-2,sc:.833333,w:13,h:19},{c:7849,x0:868,y0:393,sc:.833333,w:11,h:17},{c:7850,x0:831,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7851,x0:244,y0:341,yoffs:-1,xpad:1.22461,sc:.833333,w:9,h:18},{c:7852,x0:246,y0:40,yoffs:-1,sc:.833333,w:13,h:22},{c:7853,x0:855,y0:71,yoffs:1,xpad:1.22461,sc:.833333,w:9,h:20},{c:7854,x0:875,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7855,x0:264,y0:341,yoffs:-1,xpad:1.22461,sc:.833333,w:9,h:18},{c:7856,x0:899,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7857,x0:284,y0:341,yoffs:-1,xpad:1.22461,sc:.833333,w:9,h:18},{c:7858,x0:923,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7859,x0:498,y0:163,yoffs:-2,xpad:1.22461,sc:.833333,w:9,h:19},{c:7860,x0:947,y0:71,yoffs:-3,sc:.833333,w:13,h:20},{c:7861,x0:304,y0:340,yoffs:-1,xpad:1.22461,sc:.833333,w:9,h:18},{c:7862,x0:270,y0:40,yoffs:-1,sc:.833333,w:13,h:22},{c:7863,x0:971,y0:71,yoffs:1,xpad:1.22461,sc:.833333,w:9,h:20},{c:7864,x0:324,y0:340,yoffs:3,xpad:.639648,sc:.833333,w:10,h:18},{c:7865,x0:797,y0:635,yoffs:6,xpad:.0488281,sc:.833333,w:10,h:15},{c:7866,x0:518,y0:163,yoffs:-2,xpad:.639648,sc:.833333,w:10,h:19},{c:7867,x0:890,y0:393,xpad:.0488281,sc:.833333,w:10,h:17},{c:7868,x0:345,y0:340,yoffs:-1,xpad:.639648,sc:.833333,w:10,h:18},{c:7869,x0:142,y0:485,yoffs:1,xpad:.0488281,sc:.833333,w:10,h:16},{c:7870,x0:539,y0:163,yoffs:-2,sc:.833333,w:11,h:19},{c:7871,x0:911,y0:393,sc:.833333,w:11,h:17},{c:7872,x0:561,y0:163,yoffs:-2,xpad:.639648,sc:.833333,w:10,h:19},{c:7873,x0:933,y0:393,sc:.833333,w:11,h:17},{c:7874,x0:582,y0:163,yoffs:-2,sc:.833333,w:11,h:19},{c:7875,x0:955,y0:393,sc:.833333,w:11,h:17},{c:7876,x0:991,y0:71,yoffs:-3,xpad:.639648,sc:.833333,w:10,h:20},{c:7877,x0:366,y0:339,yoffs:-1,xpad:.0488281,sc:.833333,w:10,h:18},{c:7878,x0:294,y0:40,yoffs:-1,xpad:.639648,sc:.833333,w:10,h:22},{c:7879,x0:5,y0:107,yoffs:1,xpad:.0488281,sc:.833333,w:10,h:20},{c:7880,x0:604,y0:163,yoffs:-2,xpad:.708008,sc:.833333,w:5,h:19},{c:7881,x0:977,y0:393,xpad:.258789,sc:.833333,w:5,h:17},{c:7882,x0:387,y0:339,yoffs:3,xpad:.708008,sc:.833333,w:5,h:18},{c:7883,x0:620,y0:163,yoffs:2,xpad:.258789,sc:.833333,w:5,h:19},{c:7884,x0:403,y0:339,yoffs:3,xpad:.320313,sc:.833333,w:13,h:18},{c:7885,x0:818,y0:635,yoffs:6,sc:.833333,w:11,h:15},{c:7886,x0:636,y0:163,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7887,x0:993,y0:393,sc:.833333,w:11,h:17},{c:7888,x0:660,y0:163,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7889,x0:5,y0:429,sc:.833333,w:11,h:17},{c:7890,x0:684,y0:163,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7891,x0:27,y0:429,sc:.833333,w:11,h:17},{c:7892,x0:708,y0:163,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7893,x0:49,y0:429,sc:.833333,w:11,h:17},{c:7894,x0:26,y0:107,yoffs:-3,xpad:.320313,sc:.833333,w:13,h:20},{c:7895,x0:427,y0:339,yoffs:-1,sc:.833333,w:11,h:18},{c:7896,x0:315,y0:40,yoffs:-1,xpad:.320313,sc:.833333,w:13,h:22},{c:7897,x0:50,y0:106,yoffs:1,sc:.833333,w:11,h:20},{c:7898,x0:732,y0:163,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7899,x0:71,y0:429,sc:.833333,w:11,h:17},{c:7900,x0:756,y0:162,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7901,x0:93,y0:429,sc:.833333,w:11,h:17},{c:7902,x0:780,y0:162,yoffs:-2,xpad:.320313,sc:.833333,w:13,h:19},{c:7903,x0:115,y0:429,sc:.833333,w:11,h:17},{c:7904,x0:449,y0:339,yoffs:-1,xpad:.320313,sc:.833333,w:13,h:18},{c:7905,x0:163,y0:485,yoffs:1,sc:.833333,w:11,h:16},{c:7906,x0:591,y0:40,xpad:.320313,sc:.833333,w:13,h:21},{c:7907,x0:804,y0:162,yoffs:2,sc:.833333,w:11,h:19},{c:7908,x0:473,y0:339,yoffs:3,xpad:.939453,sc:.833333,w:12,h:18},{c:7909,x0:840,y0:635,yoffs:6,xpad:1.02051,sc:.833333,w:10,h:15},{c:7910,x0:826,y0:162,yoffs:-2,xpad:.939453,sc:.833333,w:12,h:19},{c:7911,x0:137,y0:429,xpad:1.02051,sc:.833333,w:10,h:17},{c:7912,x0:849,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7913,x0:158,y0:429,sc:.833333,w:12,h:17},{c:7914,x0:874,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7915,x0:181,y0:427,sc:.833333,w:12,h:17},{c:7916,x0:899,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7917,x0:204,y0:427,sc:.833333,w:12,h:17},{c:7918,x0:496,y0:338,yoffs:-1,sc:.833333,w:14,h:18},{c:7919,x0:185,y0:485,yoffs:1,sc:.833333,w:12,h:16},{c:7920,x0:339,y0:40,yoffs:-1,sc:.833333,w:14,h:22},{c:7921,x0:924,y0:162,yoffs:2,sc:.833333,w:12,h:19},{c:7922,x0:947,y0:162,yoffs:-2,sc:.833333,w:14,h:19},{c:7923,x0:972,y0:162,yoffs:2,sc:.833333,w:10,h:19},{c:7924,x0:521,y0:338,yoffs:3,sc:.833333,w:12,h:18},{c:7925,x0:861,y0:635,yoffs:6,sc:.833333,w:10,h:15},{c:7926,x0:993,y0:162,yoffs:-2,sc:.833333,w:12,h:19},{c:7927,x0:615,y0:40,sc:.833333,w:10,h:21},{c:7928,x0:544,y0:338,yoffs:-1,sc:.833333,w:12,h:18},{c:7929,x0:72,y0:106,yoffs:1,sc:.833333,w:10,h:20},{c:7930,x0:457,y0:792,yoffs:3,xpad:.415039,sc:.833333,w:15,h:14},{c:7931,x0:882,y0:635,yoffs:2,sc:.833333,w:11,h:15},{c:7932,x0:483,y0:791,yoffs:3,xpad:.408203,sc:.833333,w:13,h:14},{c:7933,x0:904,y0:635,yoffs:2,sc:.833333,w:11,h:15},{c:7934,x0:507,y0:791,yoffs:3,sc:.833333,w:12,h:14},{c:7935,x0:926,y0:635,yoffs:6,sc:.833333,w:12,h:15},{c:8192,xpad:8.96484,sc:.833333},{c:8193,xpad:17.9248,sc:.833333},{c:8194,xpad:8.64746,sc:.833333},{c:8195,xpad:17.2949,sc:.833333},{c:8196,xpad:5.97168,sc:.833333},{c:8197,xpad:4.48242,sc:.833333},{c:8198,xpad:2.99316,sc:.833333},{c:8199,xpad:10.2539,sc:.833333},{c:8200,xpad:5.10742,sc:.833333},{c:8201,xpad:3.58398,sc:.833333},{c:8202,xpad:1.79199,sc:.833333},{c:8203,sc:.833333},{c:8204,sc:.833333},{c:8205,sc:.833333},{c:8208,x0:461,y0:1009,yoffs:9,xpad:6.29492,sc:.833333,w:11,h:2},{c:8209,x0:278,y0:1012,yoffs:10,xpad:.401367,sc:.833333,w:6,h:3},{c:8210,x0:295,y0:1012,yoffs:10,xpad:.428711,sc:.833333,w:9,h:3},{c:8211,x0:483,y0:1008,yoffs:10,xpad:.352539,sc:.833333,w:11,h:2},{c:8212,x0:505,y0:1008,yoffs:10,xpad:.254883,sc:.833333,w:16,h:2},{c:8213,x0:532,y0:1006,yoffs:9,xpad:.294922,sc:.833333,w:17,h:2},{c:8214,x0:5,y0:198,xpad:6.29492,sc:.833333,w:11,h:19},{c:8215,x0:856,y0:968,yoffs:16,sc:.833333,w:9,h:5},{c:8216,x0:858,y0:950,yoffs:3,xpad:.683594,sc:.833333,w:5,h:7},{c:8217,x0:874,y0:949,yoffs:3,xpad:.761719,sc:.833333,w:5,h:7},{c:8218,x0:650,y0:953,yoffs:13,xpad:.683594,sc:.833333,w:5,h:8},{c:8219,x0:876,y0:967,yoffs:3,sc:.833333,w:4,h:5},{c:8220,x0:890,y0:949,yoffs:3,xpad:.0439453,sc:.833333,w:10,h:7},{c:8221,x0:911,y0:949,yoffs:3,xpad:1.12207,sc:.833333,w:9,h:7},{c:8222,x0:666,y0:953,yoffs:13,xpad:1.04395,sc:.833333,w:9,h:8},{c:8223,x0:891,y0:967,yoffs:3,sc:.833333,w:8,h:5},{c:8224,x0:27,y0:198,yoffs:2,xpad:.214844,sc:.833333,w:10,h:19},{c:8225,x0:48,y0:198,yoffs:2,xpad:.292969,sc:.833333,w:10,h:19},{c:8226,x0:307,y0:979,yoffs:9,xpad:1.4375,sc:.833333,w:7,h:6},{c:8227,x0:931,y0:949,yoffs:6,sc:.833333,w:7,h:7},{c:8228,x0:728,y0:985,yoffs:13,xpad:1.96484,sc:.833333,w:7,h:4},{c:8229,x0:746,y0:985,yoffs:8,xpad:2.29492,sc:.833333,w:15,h:4},{c:8230,x0:772,y0:985,yoffs:13,xpad:2.18066,sc:.833333,w:18,h:4},{c:8231,x0:801,y0:984,yoffs:8,xpad:6.29492,sc:.833333,w:11,h:4},{c:8232,xpad:10.7568,sc:.833333},{c:8233,xpad:10.7568,sc:.833333},{c:8239,xpad:3.58398,sc:.833333},{c:8240,x0:567,y0:338,yoffs:1,xpad:.518555,sc:.833333,w:26,h:18},{c:8241,x0:530,y0:791,yoffs:3,sc:.833333,w:30,h:14},{c:8242,x0:325,y0:979,yoffs:3,xpad:.494141,sc:.833333,w:6,h:6},{c:8243,x0:342,y0:979,yoffs:3,sc:.833333,w:11,h:6},{c:8244,x0:364,y0:979,yoffs:3,sc:.833333,w:15,h:6},{c:8245,x0:823,y0:984,yoffs:-1,xpad:6.29492,sc:.833333,w:11,h:4},{c:8246,x0:390,y0:979,yoffs:3,xpad:1.52832,sc:.833333,w:10,h:6},{c:8247,x0:411,y0:979,yoffs:3,xpad:1.48828,sc:.833333,w:14,h:6},{c:8248,x0:949,y0:949,yoffs:14,xpad:.172852,sc:.833333,w:7,h:7},{c:8249,x0:686,y0:951,yoffs:8,xpad:.572266,sc:.833333,w:6,h:8},{c:8250,x0:703,y0:951,yoffs:8,xpad:.572266,sc:.833333,w:6,h:8},{c:8251,x0:604,y0:841,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:13},{c:8252,x0:571,y0:791,yoffs:3,xpad:.708984,sc:.833333,w:11,h:14},{c:8253,x0:593,y0:791,yoffs:3,sc:.833333,w:9,h:14},{c:8254,x0:315,y0:1011,sc:.833333,w:11,h:3},{c:8255,x0:910,y0:967,yoffs:16,sc:.833333,w:11,h:5},{c:8256,x0:845,y0:984,yoffs:2,sc:.833333,w:11,h:4},{c:8257,x0:174,y0:870,yoffs:9,sc:.833333,w:8,h:12},{c:8258,x0:636,y0:40,xpad:.882813,sc:.833333,w:24,h:21},{c:8259,x0:337,y0:1011,yoffs:10,sc:.833333,w:6,h:3},{c:8260,x0:93,y0:106,sc:.833333,w:12,h:20},{c:8261,x0:227,y0:426,yoffs:3,sc:.833333,w:6,h:17},{c:8262,x0:244,y0:426,yoffs:3,xpad:.932617,sc:.833333,w:5,h:17},{c:8263,x0:949,y0:635,yoffs:2,xpad:.831055,sc:.833333,w:16,h:15},{c:8264,x0:976,y0:634,yoffs:2,xpad:1.35547,sc:.833333,w:13,h:15},{c:8265,x0:1e3,y0:634,yoffs:2,xpad:.355469,sc:.833333,w:14,h:15},{c:8266,x0:844,y0:928,yoffs:6,xpad:.756836,sc:.833333,w:10,h:11},{c:8267,x0:260,y0:426,yoffs:2,xpad:.743164,sc:.833333,w:11,h:17},{c:8268,x0:246,y0:959,yoffs:6,xpad:.743164,sc:.833333,w:11,h:10},{c:8269,x0:268,y0:959,yoffs:6,xpad:.743164,sc:.833333,w:11,h:10},{c:8270,x0:586,y0:953,yoffs:11,sc:.833333,w:10,h:9},{c:8271,x0:630,y0:841,yoffs:6,xpad:.107422,sc:.833333,w:5,h:13},{c:8272,x0:69,y0:198,yoffs:2,sc:.833333,w:11,h:19},{c:8273,x0:671,y0:40,sc:.833333,w:11,h:21},{c:8274,x0:613,y0:789,yoffs:3,sc:.833333,w:8,h:14},{c:8275,x0:867,y0:984,yoffs:9,sc:.833333,w:18,h:4},{c:8276,x0:932,y0:967,yoffs:16,sc:.833333,w:11,h:5},{c:8277,x0:865,y0:927,yoffs:6,xpad:.694336,sc:.833333,w:11,h:11},{c:8278,x0:632,y0:789,yoffs:3,xpad:.380859,sc:.833333,w:10,h:14},{c:8279,x0:436,y0:977,yoffs:3,xpad:.213867,sc:.833333,w:19,h:6},{c:8280,x0:653,y0:789,yoffs:3,xpad:.649414,sc:.833333,w:15,h:14},{c:8281,x0:679,y0:789,yoffs:3,xpad:.649414,sc:.833333,w:15,h:14},{c:8282,x0:705,y0:788,yoffs:3,xpad:.107422,sc:.833333,w:5,h:14},{c:8283,x0:5,y0:670,yoffs:2,xpad:.421875,sc:.833333,w:12,h:15},{c:8284,x0:28,y0:670,yoffs:2,xpad:.292969,sc:.833333,w:15,h:15},{c:8285,x0:54,y0:670,yoffs:2,xpad:.107422,sc:.833333,w:5,h:15},{c:8286,x0:721,y0:788,yoffs:3,xpad:.107422,sc:.833333,w:5,h:14},{c:8287,xpad:10.7568,sc:.833333},{c:8288,xpad:10.7568,sc:.833333},{c:8289,xpad:10.7568,sc:.833333},{c:8290,xpad:10.7568,sc:.833333},{c:8291,xpad:10.7568,sc:.833333},{c:8292,xpad:10.7568,sc:.833333},{c:8294,sc:.833333},{c:8295,sc:.833333},{c:8296,sc:.833333},{c:8297,sc:.833333},{c:8304,x0:967,y0:949,yoffs:3,xpad:.902344,sc:.833333,w:9,h:7},{c:8305,x0:896,y0:983,yoffs:8,xpad:1.5498,sc:.833333,w:2,h:4},{c:8308,x0:290,y0:958,yoffs:3,sc:.833333,w:9,h:10},{c:8309,x0:887,y0:927,yoffs:2,xpad:1.28613,sc:.833333,w:7,h:11},{c:8310,x0:310,y0:958,xpad:.545898,sc:.833333,w:9,h:10},{c:8311,x0:330,y0:958,yoffs:3,xpad:.549805,sc:.833333,w:8,h:10},{c:8312,x0:349,y0:958,xpad:.467773,sc:.833333,w:9,h:10},{c:8313,x0:369,y0:958,yoffs:3,xpad:.389648,sc:.833333,w:9,h:10},{c:8314,x0:466,y0:976,yoffs:5,xpad:.435547,sc:.833333,w:6,h:6},{c:8315,x0:560,y0:1006,yoffs:7,xpad:.435547,sc:.833333,w:6,h:2},{c:8316,x0:909,y0:983,yoffs:6,xpad:.435547,sc:.833333,w:6,h:4},{c:8317,x0:905,y0:927,yoffs:2,xpad:.335938,sc:.833333,w:4,h:11},{c:8318,x0:920,y0:927,yoffs:2,xpad:.335938,sc:.833333,w:4,h:11},{c:8319,x0:354,y0:1011,yoffs:9,xpad:2.65625,sc:.833333,w:5,h:3},{c:8320,x0:987,y0:949,yoffs:11,xpad:.902344,sc:.833333,w:9,h:7},{c:8321,x0:1007,y0:949,yoffs:11,xpad:.137695,sc:.833333,w:6,h:7},{c:8322,x0:5,y0:982,yoffs:11,sc:.833333,w:8,h:7},{c:8323,x0:389,y0:958,yoffs:11,xpad:.241211,sc:.833333,w:7,h:10},{c:8324,x0:407,y0:958,yoffs:10,sc:.833333,w:9,h:10},{c:8325,x0:935,y0:927,yoffs:10,xpad:1.28613,sc:.833333,w:7,h:11},{c:8326,x0:953,y0:927,yoffs:7,xpad:.545898,sc:.833333,w:9,h:11},{c:8327,x0:973,y0:927,yoffs:10,xpad:.549805,sc:.833333,w:8,h:11},{c:8328,x0:992,y0:927,yoffs:7,xpad:.467773,sc:.833333,w:9,h:11},{c:8329,x0:427,y0:956,yoffs:11,xpad:.389648,sc:.833333,w:9,h:10},{c:8330,x0:483,y0:976,yoffs:13,xpad:.435547,sc:.833333,w:6,h:6},{c:8331,x0:577,y0:1005,yoffs:15,xpad:.435547,sc:.833333,w:6,h:2},{c:8332,x0:954,y0:967,yoffs:13,xpad:.435547,sc:.833333,w:6,h:5},{c:8333,x0:1012,y0:881,yoffs:9,xpad:.335938,sc:.833333,w:4,h:11},{c:8334,x0:5,y0:960,yoffs:9,xpad:.335938,sc:.833333,w:4,h:11},{c:8336,x0:971,y0:967,yoffs:13,xpad:3.0459,sc:.833333,w:4,h:5},{c:8337,x0:986,y0:967,yoffs:13,xpad:1.88477,sc:.833333,w:5,h:5},{c:8338,x0:1002,y0:967,yoffs:13,xpad:2.20703,sc:.833333,w:5,h:5},{c:8339,x0:5,y0:1e3,yoffs:13,xpad:1.73828,sc:.833333,w:5,h:5},{c:8340,x0:21,y0:1e3,yoffs:13,xpad:1.88477,sc:.833333,w:5,h:5},{c:8341,x0:500,y0:975,yoffs:12,xpad:2.65625,sc:.833333,w:5,h:6},{c:8342,x0:516,y0:975,yoffs:12,xpad:2.22656,sc:.833333,w:5,h:6},{c:8343,x0:532,y0:974,yoffs:12,xpad:1.5498,sc:.833333,w:2,h:6},{c:8344,x0:37,y0:1e3,yoffs:13,xpad:4.43555,sc:.833333,w:7,h:5},{c:8345,x0:55,y0:1e3,yoffs:13,xpad:2.65625,sc:.833333,w:5,h:5},{c:8346,x0:545,y0:974,yoffs:13,xpad:2.36816,sc:.833333,w:5,h:6},{c:8347,x0:71,y0:1e3,yoffs:13,xpad:1.79102,sc:.833333,w:4,h:5},{c:8348,x0:561,y0:973,yoffs:12,xpad:1.05371,sc:.833333,w:4,h:6},{c:8352,x0:737,y0:788,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8353,x0:208,y0:483,yoffs:2,sc:.833333,w:11,h:16},{c:8354,x0:758,y0:788,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8355,x0:779,y0:788,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8356,x0:800,y0:787,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8357,x0:70,y0:670,yoffs:4,xpad:.602539,sc:.833333,w:17,h:15},{c:8358,x0:821,y0:787,yoffs:3,sc:.833333,w:11,h:14},{c:8359,x0:843,y0:787,yoffs:3,sc:.833333,w:16,h:14},{c:8360,x0:870,y0:787,yoffs:3,xpad:.420898,sc:.833333,w:16,h:14},{c:8361,x0:897,y0:787,yoffs:3,sc:.833333,w:12,h:14},{c:8362,x0:920,y0:786,yoffs:3,xpad:1.47461,sc:.833333,w:15,h:14},{c:8363,x0:946,y0:786,yoffs:3,xpad:.19043,sc:.833333,w:10,h:14},{c:8364,x0:967,y0:786,yoffs:3,sc:.833333,w:15,h:14},{c:8365,x0:993,y0:786,yoffs:3,sc:.833333,w:11,h:14},{c:8366,x0:5,y0:821,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8367,x0:604,y0:338,yoffs:3,xpad:.105469,sc:.833333,w:18,h:18},{c:8368,x0:633,y0:338,yoffs:3,xpad:.9375,sc:.833333,w:10,h:18},{c:8369,x0:26,y0:821,yoffs:3,sc:.833333,w:11,h:14},{c:8370,x0:230,y0:482,yoffs:2,xpad:1.15918,sc:.833333,w:12,h:16},{c:8371,x0:48,y0:821,yoffs:3,sc:.833333,w:12,h:14},{c:8372,x0:71,y0:821,yoffs:3,sc:.833333,w:11,h:14},{c:8373,x0:253,y0:482,yoffs:2,xpad:.420898,sc:.833333,w:11,h:16},{c:8374,x0:646,y0:839,yoffs:4,xpad:.475586,sc:.833333,w:12,h:13},{c:8375,x0:98,y0:670,yoffs:3,xpad:.105469,sc:.833333,w:13,h:15},{c:8376,x0:93,y0:821,yoffs:3,sc:.833333,w:11,h:14},{c:8377,x0:115,y0:821,yoffs:3,xpad:.649414,sc:.833333,w:10,h:14},{c:8378,x0:136,y0:821,yoffs:3,xpad:.253906,sc:.833333,w:10,h:14},{c:8379,x0:157,y0:821,yoffs:3,sc:.833333,w:15,h:14},{c:8380,x0:183,y0:821,yoffs:3,xpad:.668945,sc:.833333,w:15,h:14},{c:8381,x0:209,y0:821,yoffs:3,sc:.833333,w:11,h:14},{c:8382,x0:275,y0:482,yoffs:1,xpad:.274414,sc:.833333,w:11,h:16},{c:8383,x0:282,y0:426,yoffs:1,xpad:.253906,sc:.833333,w:10,h:17},{c:8482,x0:576,y0:973,yoffs:3,xpad:.523438,sc:.833333,w:16,h:6},{c:8592,x0:24,y0:982,yoffs:7,xpad:.801758,sc:.833333,w:16,h:7},{c:8593,x0:297,y0:482,yoffs:2,xpad:4.80176,sc:.833333,w:12,h:16},{c:8594,x0:51,y0:982,yoffs:7,sc:.833333,w:17,h:7},{c:8595,x0:320,y0:482,yoffs:2,xpad:4.80176,sc:.833333,w:12,h:16},{c:8734,x0:79,y0:981,yoffs:8,xpad:.649414,sc:.833333,w:15,h:7},{c:12353,x0:231,y0:820,yoffs:4,xpad:2.29492,sc:.833333,w:15,h:14},{c:12354,x0:343,y0:481,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12355,x0:20,y0:960,yoffs:6,xpad:1.29492,sc:.833333,w:16,h:11},{c:12356,x0:257,y0:820,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12357,x0:285,y0:820,yoffs:4,xpad:3.29492,sc:.833333,w:14,h:14},{c:12358,x0:370,y0:481,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12359,x0:310,y0:820,yoffs:4,xpad:2.29492,sc:.833333,w:15,h:14},{c:12360,x0:396,y0:481,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12361,x0:669,y0:839,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12362,x0:122,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12363,x0:150,y0:669,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12364,x0:303,y0:426,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12365,x0:423,y0:481,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12366,x0:331,y0:425,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12367,x0:450,y0:480,yoffs:2,xpad:3.29492,sc:.833333,w:14,h:16},{c:12368,x0:475,y0:479,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12369,x0:502,y0:479,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12370,x0:359,y0:425,yoffs:1,sc:.833333,w:18,h:17},{c:12371,x0:336,y0:820,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:14},{c:12372,x0:388,y0:425,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12373,x0:529,y0:479,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12374,x0:416,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12375,x0:555,y0:478,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12376,x0:582,y0:478,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12377,x0:609,y0:478,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12378,x0:444,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12379,x0:178,y0:669,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12380,x0:637,y0:478,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12381,x0:665,y0:478,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12382,x0:692,y0:477,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12383,x0:205,y0:669,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12384,x0:719,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12385,x0:747,y0:477,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12386,x0:472,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12387,x0:447,y0:955,yoffs:7,xpad:1.29492,sc:.833333,w:16,h:10},{c:12388,x0:696,y0:839,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:13},{c:12389,x0:773,y0:477,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12390,x0:362,y0:818,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12391,x0:389,y0:817,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12392,x0:232,y0:669,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:15},{c:12393,x0:500,y0:424,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12394,x0:801,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12395,x0:258,y0:669,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12396,x0:285,y0:667,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12397,x0:313,y0:666,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12398,x0:417,y0:817,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12399,x0:341,y0:666,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12400,x0:528,y0:423,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12401,x0:556,y0:423,yoffs:1,sc:.833333,w:18,h:17},{c:12402,x0:369,y0:666,yoffs:3,xpad:.294922,sc:.833333,w:17,h:15},{c:12403,x0:585,y0:423,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12404,x0:613,y0:423,yoffs:1,sc:.833333,w:18,h:17},{c:12405,x0:397,y0:666,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12406,x0:829,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12407,x0:857,y0:477,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12408,x0:193,y0:870,yoffs:4,xpad:.294922,sc:.833333,w:17,h:12},{c:12409,x0:444,y0:817,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12410,x0:472,y0:817,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12411,x0:425,y0:665,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12412,x0:642,y0:423,yoffs:1,sc:.833333,w:18,h:17},{c:12413,x0:671,y0:422,yoffs:1,sc:.833333,w:18,h:17},{c:12414,x0:885,y0:477,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12415,x0:912,y0:476,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12416,x0:940,y0:476,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12417,x0:968,y0:476,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12418,x0:995,y0:476,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12419,x0:500,y0:816,yoffs:4,xpad:2.29492,sc:.833333,w:15,h:14},{c:12420,x0:700,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12421,x0:723,y0:838,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12422,x0:5,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12423,x0:749,y0:838,yoffs:5,xpad:3.29492,sc:.833333,w:14,h:13},{c:12424,x0:32,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12425,x0:59,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12426,x0:86,y0:512,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12427,x0:112,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12428,x0:453,y0:665,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12429,x0:139,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12430,x0:774,y0:838,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:13},{c:12431,x0:481,y0:665,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12432,x0:166,y0:512,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12433,x0:193,y0:512,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12434,x0:221,y0:510,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12435,x0:248,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12436,x0:276,y0:509,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12437,x0:801,y0:838,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12438,x0:828,y0:837,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12441,x0:86,y0:999,yoffs:1,xpad:11.2949,sc:.833333,w:6,h:5},{c:12442,x0:603,y0:973,yoffs:1,xpad:12.2949,sc:.833333,w:5,h:6},{c:12443,x0:86,y0:999,yoffs:1,xpad:11.2949,sc:.833333,w:6,h:5},{c:12444,x0:603,y0:973,yoffs:1,xpad:12.2949,sc:.833333,w:5,h:6},{c:12445,x0:221,y0:870,yoffs:4,xpad:3.29492,sc:.833333,w:14,h:12},{c:12446,x0:855,y0:837,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:13},{c:12447,x0:728,y0:422,yoffs:1,xpad:1.29492,sc:.833333,w:16,h:17},{c:12448,x0:103,y0:999,yoffs:7,xpad:4.29492,sc:.833333,w:13,h:5},{c:12449,x0:246,y0:869,yoffs:6,xpad:1.29492,sc:.833333,w:16,h:12},{c:12450,x0:509,y0:665,yoffs:3,xpad:.294922,sc:.833333,w:17,h:15},{c:12451,x0:881,y0:837,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12452,x0:537,y0:665,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12453,x0:907,y0:837,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12454,x0:304,y0:509,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12455,x0:47,y0:960,yoffs:6,xpad:2.29492,sc:.833333,w:15,h:11},{c:12456,x0:273,y0:869,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:12},{c:12457,x0:933,y0:837,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12458,x0:564,y0:663,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12459,x0:591,y0:663,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12460,x0:755,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12461,x0:331,y0:509,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12462,x0:783,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12463,x0:811,y0:422,yoffs:1,xpad:1.29492,sc:.833333,w:16,h:17},{c:12464,x0:838,y0:422,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12465,x0:358,y0:508,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12466,x0:866,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12467,x0:526,y0:816,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12468,x0:894,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12469,x0:385,y0:508,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12470,x0:413,y0:508,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12471,x0:441,y0:508,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12472,x0:469,y0:507,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12473,x0:553,y0:816,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12474,x0:922,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12475,x0:618,y0:663,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12476,x0:950,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12477,x0:580,y0:816,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12478,x0:978,y0:421,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12479,x0:5,y0:457,yoffs:1,xpad:1.29492,sc:.833333,w:16,h:17},{c:12480,x0:32,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12481,x0:497,y0:506,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12482,x0:525,y0:506,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12483,x0:960,y0:836,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12484,x0:553,y0:506,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12485,x0:60,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12486,x0:581,y0:505,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12487,x0:88,y0:457,yoffs:1,sc:.833333,w:18,h:17},{c:12488,x0:645,y0:662,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:15},{c:12489,x0:609,y0:505,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12490,x0:636,y0:505,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12491,x0:300,y0:869,yoffs:4,xpad:1.29492,sc:.833333,w:16,h:12},{c:12492,x0:672,y0:662,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:15},{c:12493,x0:664,y0:505,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12494,x0:698,y0:662,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:15},{c:12495,x0:607,y0:816,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12496,x0:692,y0:504,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12497,x0:720,y0:504,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12498,x0:724,y0:661,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:15},{c:12499,x0:748,y0:504,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12500,x0:776,y0:504,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12501,x0:635,y0:814,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12502,x0:117,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12503,x0:145,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12504,x0:327,y0:869,yoffs:4,xpad:.294922,sc:.833333,w:17,h:12},{c:12505,x0:662,y0:814,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12506,x0:690,y0:814,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12507,x0:804,y0:504,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12508,x0:173,y0:457,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12509,x0:201,y0:455,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12510,x0:750,y0:661,yoffs:3,xpad:.294922,sc:.833333,w:17,h:15},{c:12511,x0:832,y0:504,yoffs:2,xpad:2.29492,sc:.833333,w:15,h:16},{c:12512,x0:778,y0:661,yoffs:2,xpad:.294922,sc:.833333,w:17,h:15},{c:12513,x0:858,y0:504,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12514,x0:718,y0:813,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12515,x0:987,y0:835,yoffs:5,xpad:1.29492,sc:.833333,w:16,h:13},{c:12516,x0:885,y0:504,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12517,x0:474,y0:955,yoffs:7,xpad:2.29492,sc:.833333,w:15,h:10},{c:12518,x0:355,y0:869,yoffs:4,xpad:.294922,sc:.833333,w:17,h:12},{c:12519,x0:383,y0:867,yoffs:6,xpad:3.29492,sc:.833333,w:14,h:12},{c:12520,x0:745,y0:813,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:14},{c:12521,x0:913,y0:503,yoffs:2,xpad:1.29492,sc:.833333,w:16,h:16},{c:12522,x0:940,y0:503,yoffs:2,xpad:3.29492,sc:.833333,w:14,h:16},{c:12523,x0:965,y0:503,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12524,x0:771,y0:813,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12525,x0:799,y0:813,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:14},{c:12526,x0:408,y0:866,yoffs:6,xpad:2.29492,sc:.833333,w:15,h:12},{c:12527,x0:806,y0:661,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:15},{c:12528,x0:993,y0:503,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:12529,x0:5,y0:870,yoffs:3,xpad:.294922,sc:.833333,w:17,h:13},{c:12530,x0:833,y0:661,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:15},{c:12531,x0:826,y0:812,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:12532,x0:229,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12533,x0:33,y0:870,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12534,x0:59,y0:870,yoffs:5,xpad:2.29492,sc:.833333,w:15,h:13},{c:12535,x0:257,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12536,x0:285,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12537,x0:5,y0:539,yoffs:1,xpad:.294922,sc:.833333,w:17,h:16},{c:12538,x0:313,y0:454,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:12539,x0:127,y0:998,yoffs:7,xpad:6.29492,sc:.833333,w:11,h:5},{c:12540,x0:370,y0:1011,yoffs:8,xpad:1.29492,sc:.833333,w:16,h:3},{c:12541,x0:500,y0:954,yoffs:5,xpad:3.29492,sc:.833333,w:14,h:10},{c:12542,x0:434,y0:866,yoffs:3,xpad:2.29492,sc:.833333,w:15,h:12},{c:12543,x0:33,y0:539,yoffs:2,xpad:3.29492,sc:.833333,w:14,h:16},{c:19968,x0:397,y0:1011,yoffs:8,xpad:.294922,sc:.833333,w:17,h:3},{c:19971,x0:341,y0:453,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:19977,x0:854,y0:812,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:20061,x0:369,y0:453,yoffs:1,sc:.833333,w:18,h:17},{c:20108,x0:882,y0:812,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:20116,x0:910,y0:812,yoffs:3,xpad:.294922,sc:.833333,w:17,h:14},{c:20843,x0:58,y0:539,yoffs:2,xpad:.294922,sc:.833333,w:17,h:16},{c:20845,x0:398,y0:453,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:21313,x0:426,y0:452,yoffs:1,xpad:.294922,sc:.833333,w:17,h:17},{c:22235,x0:860,y0:661,yoffs:3,xpad:1.29492,sc:.833333,w:16,h:15},{c:65024,sc:.833333},{c:65533,x0:938,y0:811,yoffs:3,sc:.833333,w:13,h:14}]}},{}],107:[function(e,t,r){t.exports={font_size:32,imageW:2048,imageH:1024,spread:8,channels:1,char_infos:[{c:1,xpad:3.92578,sc:.625},{c:2,xpad:3.92578,sc:.625},{c:3,xpad:3.92578,sc:.625},{c:4,xpad:3.92578,sc:.625},{c:5,xpad:3.92578,sc:.625},{c:6,xpad:3.92578,sc:.625},{c:7,xpad:3.92578,sc:.625},{c:8},{c:9,xpad:5.76563},{c:10,xpad:3.92578,sc:.625},{c:11,xpad:3.92578,sc:.625},{c:12,xpad:3.92578,sc:.625},{c:13,xpad:5.76563},{c:14,xpad:3.92578,sc:.625},{c:15,xpad:3.92578,sc:.625},{c:16,xpad:3.92578,sc:.625},{c:17,xpad:3.92578,sc:.625},{c:18,xpad:3.92578,sc:.625},{c:19,xpad:3.92578,sc:.625},{c:20,xpad:3.92578,sc:.625},{c:21,xpad:3.92578,sc:.625},{c:22,xpad:3.92578,sc:.625},{c:23,xpad:3.92578,sc:.625},{c:24,xpad:3.92578,sc:.625},{c:25,xpad:3.92578,sc:.625},{c:26,xpad:3.92578,sc:.625},{c:27,xpad:3.92578,sc:.625},{c:28,xpad:3.92578,sc:.625},{c:29},{c:30,xpad:3.92578,sc:.625},{c:31,xpad:3.92578,sc:.625},{c:32,xpad:5.76563},{c:33,x0:871,y0:53,yoffs:5,xpad:1.77344,w:6,h:22},{c:34,x0:883,y0:325,yoffs:3,xpad:1.17188,w:10,h:9},{c:35,x0:1499,y0:50,yoffs:5,xpad:.757813,w:16,h:21},{c:36,x0:1223,y0:8,yoffs:3,xpad:.710938,w:12,h:27},{c:37,x0:894,y0:53,yoffs:5,xpad:1.0625,w:18,h:22},{c:38,x0:204,y0:55,yoffs:4,xpad:.101563,w:15,h:23},{c:39,x0:910,y0:324,yoffs:3,xpad:1.5625,w:5,h:9},{c:40,x0:89,y0:8,yoffs:2,w:9,h:30},{c:41,x0:115,y0:8,yoffs:2,xpad:1.42188,w:7,h:30},{c:42,x0:880,y0:270,yoffs:5,xpad:.4375,w:11,h:10},{c:43,x0:167,y0:164,yoffs:11,xpad:.710938,w:12,h:12},{c:44,x0:932,y0:323,yoffs:22,xpad:1.85938,w:5,h:9},{c:45,x0:1790,y0:490,yoffs:15,w:7,h:4},{c:46,x0:434,y0:486,yoffs:22,xpad:.859375,w:6,h:5},{c:47,x0:139,y0:8,yoffs:2,w:10,h:30},{c:48,x0:236,y0:55,yoffs:4,xpad:.710938,w:12,h:23},{c:49,x0:1532,y0:50,yoffs:5,xpad:3.71094,w:9,h:21},{c:50,x0:929,y0:53,yoffs:4,xpad:1.71094,w:11,h:22},{c:51,x0:265,y0:55,yoffs:4,xpad:1.71094,w:11,h:23},{c:52,x0:12,y0:12,yoffs:8,xpad:1.06641,sc:1.5,w:18,h:31},{c:53,x0:957,y0:53,yoffs:5,xpad:1.71094,w:11,h:22},{c:54,x0:985,y0:53,yoffs:5,xpad:.710938,w:12,h:22},{c:55,x0:1558,y0:50,yoffs:5,xpad:.710938,w:12,h:21},{c:56,x0:293,y0:55,yoffs:4,xpad:.710938,w:12,h:23},{c:57,x0:1014,y0:53,yoffs:4,xpad:.710938,w:12,h:22},{c:58,x0:535,y0:94,yoffs:10,xpad:.859375,w:6,h:17},{c:59,x0:1587,y0:50,yoffs:10,xpad:.859375,w:6,h:21},{c:60,x0:1293,y0:91,yoffs:10,xpad:.710938,w:12,h:14},{c:61,x0:954,y0:323,yoffs:13,xpad:.710938,w:12,h:9},{c:62,x0:1322,y0:91,yoffs:10,xpad:.710938,w:12,h:14},{c:63,x0:322,y0:55,yoffs:4,xpad:.109375,w:10,h:23},{c:64,x0:1252,y0:8,yoffs:4,xpad:1.35156,w:23,h:27},{c:65,x0:1610,y0:50,yoffs:5,w:15,h:21},{c:66,x0:1043,y0:53,yoffs:5,xpad:.398438,w:15,h:22},{c:67,x0:349,y0:55,yoffs:4,w:14,h:23},{c:68,x0:1075,y0:53,yoffs:5,xpad:1.02344,w:16,h:22},{c:69,x0:1642,y0:50,yoffs:5,xpad:.476563,w:13,h:21},{c:70,x0:1672,y0:50,yoffs:5,xpad:.585938,w:12,h:21},{c:71,x0:380,y0:54,yoffs:4,xpad:1.51563,w:14,h:23},{c:72,x0:1701,y0:50,yoffs:5,xpad:2.02344,w:15,h:21},{c:73,x0:1733,y0:50,yoffs:5,xpad:1.625,w:6,h:21},{c:74,x0:1108,y0:53,yoffs:5,xpad:1.67188,w:10,h:22},{c:75,x0:1756,y0:49,yoffs:5,xpad:.21875,w:15,h:21},{c:76,x0:1788,y0:49,yoffs:5,xpad:.320313,w:12,h:21},{c:77,x0:1817,y0:49,yoffs:5,xpad:1.45313,w:20,h:21},{c:78,x0:1854,y0:49,yoffs:5,xpad:2.17188,w:15,h:21},{c:79,x0:411,y0:54,yoffs:4,xpad:.882813,w:17,h:23},{c:80,x0:1886,y0:49,yoffs:5,xpad:.335938,w:14,h:21},{c:81,x0:591,y0:8,yoffs:4,xpad:.882813,w:17,h:28},{c:82,x0:1917,y0:49,yoffs:5,xpad:.1875,w:15,h:21},{c:83,x0:445,y0:54,yoffs:4,w:12,h:23},{c:84,x0:1949,y0:49,yoffs:5,w:13,h:21},{c:85,x0:1135,y0:53,yoffs:5,xpad:2.22656,w:14,h:22},{c:86,x0:1979,y0:49,yoffs:5,w:15,h:21},{c:87,x0:2011,y0:49,yoffs:5,xpad:.34375,w:22,h:21},{c:88,x0:8,y0:105,yoffs:5,w:14,h:21},{c:89,x0:39,y0:105,yoffs:5,w:14,h:21},{c:90,x0:70,y0:98,yoffs:5,xpad:.765625,w:12,h:21},{c:91,x0:166,y0:8,yoffs:2,w:9,h:30},{c:92,x0:192,y0:8,yoffs:2,w:10,h:30},{c:93,x0:219,y0:8,yoffs:2,xpad:2.30469,w:6,h:30},{c:94,x0:196,y0:164,yoffs:5,xpad:.710938,w:12,h:12},{c:95,x0:59,y0:542,yoffs:29,w:12,h:3},{c:96,x0:999,y0:450,yoffs:2,xpad:2.28125,w:7,h:7},{c:97,x0:558,y0:94,yoffs:10,xpad:1.82813,w:11,h:17},{c:98,x0:1745,y0:8,yoffs:3,xpad:.804688,w:13,h:24},{c:99,x0:586,y0:94,yoffs:10,xpad:.429688,w:10,h:17},{c:100,x0:1775,y0:8,yoffs:3,xpad:1.80469,w:12,h:24},{c:101,x0:613,y0:93,yoffs:10,xpad:.882813,w:12,h:17},{c:102,x0:474,y0:54,yoffs:3,w:10,h:23},{c:103,x0:1166,y0:53,yoffs:10,xpad:1.80469,w:12,h:22},{c:104,x0:501,y0:54,yoffs:3,xpad:1.24219,w:13,h:23},{c:105,x0:1195,y0:53,yoffs:4,xpad:1.14844,w:6,h:22},{c:106,x0:625,y0:8,yoffs:4,xpad:1.14844,w:7,h:28},{c:107,x0:531,y0:54,yoffs:3,w:13,h:23},{c:108,x0:1804,y0:8,yoffs:3,xpad:.179688,w:7,h:24},{c:109,x0:764,y0:93,yoffs:10,xpad:1.625,w:19,h:16},{c:110,x0:800,y0:93,yoffs:10,xpad:1.24219,w:13,h:16},{c:111,x0:642,y0:93,yoffs:10,xpad:.679688,w:13,h:17},{c:112,x0:1218,y0:53,yoffs:10,xpad:.804688,w:13,h:22},{c:113,x0:1248,y0:52,yoffs:10,xpad:1.80469,w:12,h:22},{c:114,x0:830,y0:93,yoffs:10,w:10,h:16},{c:115,x0:672,y0:93,yoffs:10,xpad:.078125,w:10,h:17},{c:116,x0:1277,y0:52,yoffs:5,w:10,h:22},{c:117,x0:699,y0:93,yoffs:10,xpad:2.1875,w:12,h:17},{c:118,x0:857,y0:93,yoffs:10,w:12,h:16},{c:119,x0:886,y0:92,yoffs:10,w:17,h:16},{c:120,x0:920,y0:92,yoffs:10,w:12,h:16},{c:121,x0:1304,y0:52,yoffs:10,w:12,h:22},{c:122,x0:949,y0:92,yoffs:10,xpad:.523438,w:10,h:16},{c:123,x0:242,y0:8,yoffs:2,w:8,h:30},{c:124,x0:267,y0:8,yoffs:2,xpad:1.95313,w:6,h:30},{c:125,x0:290,y0:8,yoffs:2,xpad:.859375,w:7,h:30},{c:126,x0:35,y0:497,yoffs:14,xpad:.710938,w:12,h:6},{c:160,xpad:5.76563},{c:161,x0:1333,y0:52,yoffs:10,xpad:1.77344,w:6,h:22},{c:162,x0:1828,y0:8,yoffs:5,xpad:1.71094,w:11,h:24},{c:163,x0:99,y0:98,yoffs:5,xpad:.710938,w:12,h:21},{c:164,x0:1136,y0:92,yoffs:8,xpad:.710938,w:12,h:15},{c:165,x0:128,y0:96,yoffs:5,w:13,h:21},{c:166,x0:314,y0:8,yoffs:2,xpad:1.95313,w:6,h:30},{c:167,x0:905,y0:267,yoffs:3,xpad:.387695,sc:.625,w:7,h:16},{c:168,x0:353,y0:548,yoffs:2,sc:.625,w:6,h:3},{c:169,x0:849,y0:376,yoffs:3,xpad:1.13477,sc:.625,w:12,h:14},{c:170,x0:263,y0:532,yoffs:3,xpad:.854492,sc:.625,w:5,h:8},{c:171,x0:1811,y0:487,yoffs:6,xpad:.369141,sc:.625,w:8,h:10},{c:172,x0:628,y0:525,yoffs:8,xpad:.944336,sc:.625,w:7,h:6},{c:173,x0:370,y0:548,yoffs:9,xpad:.301758,sc:.625,w:4,h:3},{c:174,x0:872,y0:375,yoffs:3,xpad:1.13477,sc:.625,w:12,h:14},{c:175,x0:891,y0:538,yoffs:3,xpad:.800781,sc:.625,w:5,h:2},{c:176,x0:1038,y0:515,yoffs:2,xpad:.317383,sc:.625,w:5,h:5},{c:177,x0:1830,y0:487,yoffs:7,sc:.625,w:8,h:10},{c:178,x0:279,y0:532,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:179,x0:295,y0:529,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:180,x0:1054,y0:515,yoffs:1,sc:.625,w:6,h:5},{c:181,x0:895,y0:374,yoffs:6,xpad:1.01367,sc:.625,w:8,h:14},{c:182,x0:1803,y0:174,yoffs:3,xpad:1.79004,sc:.625,w:8,h:17},{c:183,x0:385,y0:548,yoffs:9,xpad:.194336,sc:.625,w:4,h:3},{c:184,x0:1071,y0:515,yoffs:15,xpad:.800781,sc:.625,w:5,h:5},{c:185,x0:311,y0:529,yoffs:3,xpad:1.1709,sc:.625,w:4,h:8},{c:186,x0:326,y0:529,yoffs:3,xpad:.723633,sc:.625,w:6,h:8},{c:187,x0:1849,y0:487,yoffs:6,xpad:.369141,sc:.625,w:8,h:10},{c:188,x0:914,y0:374,yoffs:3,xpad:.0419922,sc:.625,w:13,h:14},{c:189,x0:938,y0:373,yoffs:3,xpad:.0419922,sc:.625,w:13,h:14},{c:190,x0:962,y0:372,yoffs:3,xpad:.0419922,sc:.625,w:13,h:14},{c:191,x0:1356,y0:52,yoffs:10,xpad:.109375,w:10,h:22},{c:192,x0:649,y0:8,yoffs:-2,w:15,h:28},{c:193,x0:681,y0:8,yoffs:-2,w:15,h:28},{c:194,x0:713,y0:8,yoffs:-2,w:15,h:28},{c:195,x0:1292,y0:8,yoffs:-1,w:15,h:27},{c:196,x0:1324,y0:8,yoffs:-1,w:15,h:27},{c:197,x0:1481,y0:8,yoffs:1,w:15,h:25},{c:198,x0:158,y0:96,yoffs:5,xpad:.546875,w:21,h:21},{c:199,x0:745,y0:8,yoffs:4,w:14,h:28},{c:200,x0:776,y0:8,yoffs:-2,xpad:.476563,w:13,h:28},{c:201,x0:806,y0:8,yoffs:-2,xpad:.476563,w:13,h:28},{c:202,x0:836,y0:8,yoffs:-2,xpad:.476563,w:13,h:28},{c:203,x0:1356,y0:8,yoffs:-1,xpad:.476563,w:13,h:27},{c:204,x0:866,y0:8,yoffs:-2,xpad:1.625,w:6,h:28},{c:205,x0:889,y0:8,yoffs:-2,w:8,h:28},{c:206,x0:914,y0:8,yoffs:-2,w:8,h:28},{c:207,x0:1386,y0:8,yoffs:-1,w:9,h:27},{c:208,x0:1383,y0:52,yoffs:5,xpad:1.02344,w:16,h:22},{c:209,x0:1412,y0:8,yoffs:-1,xpad:2.17188,w:15,h:27},{c:210,x0:366,y0:8,yoffs:-2,xpad:.882813,w:17,h:29},{c:211,x0:400,y0:8,yoffs:-2,xpad:.882813,w:17,h:29},{c:212,x0:434,y0:8,yoffs:-2,xpad:.882813,w:17,h:29},{c:213,x0:939,y0:8,yoffs:-1,xpad:.882813,w:17,h:28},{c:214,x0:973,y0:8,yoffs:-1,xpad:.882813,w:17,h:28},{c:215,x0:926,y0:269,yoffs:12,xpad:.710938,w:12,h:10},{c:216,x0:561,y0:54,yoffs:4,xpad:.882813,w:17,h:23},{c:217,x0:468,y0:8,yoffs:-2,xpad:2.22656,w:14,h:29},{c:218,x0:499,y0:8,yoffs:-2,xpad:2.22656,w:14,h:29},{c:219,x0:530,y0:8,yoffs:-2,xpad:2.22656,w:14,h:29},{c:220,x0:1007,y0:8,yoffs:-1,xpad:2.22656,w:14,h:28},{c:221,x0:1038,y0:8,yoffs:-2,w:14,h:28},{c:222,x0:196,y0:96,yoffs:5,xpad:.359375,w:14,h:21},{c:223,x0:1856,y0:8,yoffs:3,xpad:.390625,w:14,h:24},{c:224,x0:1513,y0:8,yoffs:2,xpad:1.82813,w:11,h:25},{c:225,x0:1541,y0:8,yoffs:2,xpad:1.82813,w:11,h:25},{c:226,x0:1887,y0:8,yoffs:3,xpad:1.82813,w:11,h:24},{c:227,x0:595,y0:53,yoffs:4,xpad:1.82813,w:11,h:23},{c:228,x0:623,y0:53,yoffs:4,xpad:1.82813,w:11,h:23},{c:229,x0:1915,y0:8,yoffs:3,xpad:1.82813,w:11,h:24},{c:230,x0:728,y0:93,yoffs:10,xpad:.59375,w:19,h:17},{c:231,x0:1416,y0:52,yoffs:10,xpad:.429688,w:10,h:22},{c:232,x0:1569,y0:8,yoffs:2,xpad:.882813,w:12,h:25},{c:233,x0:1598,y0:8,yoffs:2,xpad:.882813,w:12,h:25},{c:234,x0:1943,y0:8,yoffs:3,xpad:.882813,w:12,h:24},{c:235,x0:651,y0:53,yoffs:4,xpad:.882813,w:12,h:23},{c:236,x0:1972,y0:8,yoffs:2,xpad:1.14844,w:6,h:24},{c:237,x0:1995,y0:8,yoffs:2,w:8,h:24},{c:238,x0:680,y0:53,yoffs:3,xpad:.148438,w:7,h:23},{c:239,x0:1443,y0:52,yoffs:4,w:9,h:22},{c:240,x0:2020,y0:8,yoffs:3,xpad:.625,w:13,h:24},{c:241,x0:1469,y0:51,yoffs:4,xpad:1.24219,w:13,h:22},{c:242,x0:1627,y0:8,yoffs:2,xpad:.679688,w:13,h:25},{c:243,x0:1657,y0:8,yoffs:2,xpad:.679688,w:13,h:25},{c:244,x0:8,y0:64,yoffs:3,xpad:.679688,w:13,h:24},{c:245,x0:704,y0:53,yoffs:4,xpad:.679688,w:13,h:23},{c:246,x0:734,y0:53,yoffs:4,xpad:.679688,w:13,h:23},{c:247,x0:1351,y0:91,yoffs:10,xpad:.710938,w:12,h:14},{c:248,x0:505,y0:94,yoffs:9,xpad:.679688,w:13,h:18},{c:249,x0:1687,y0:8,yoffs:2,xpad:2.1875,w:12,h:25},{c:250,x0:1716,y0:8,yoffs:2,xpad:2.1875,w:12,h:25},{c:251,x0:38,y0:64,yoffs:3,xpad:2.1875,w:12,h:24},{c:252,x0:764,y0:53,yoffs:4,xpad:2.1875,w:12,h:23},{c:253,x0:337,y0:8,yoffs:2,w:12,h:30},{c:254,x0:561,y0:8,yoffs:3,xpad:.804688,w:13,h:29},{c:255,x0:1069,y0:8,yoffs:4,w:12,h:28},{c:256,x0:1822,y0:174,xpad:.291992,sc:.625,w:9,h:17},{c:257,x0:986,y0:372,yoffs:3,xpad:1.01758,sc:.625,w:7,h:14},{c:258,x0:222,y0:161,yoffs:-1,xpad:.291992,sc:.625,w:9,h:18},{c:259,x0:980,y0:320,yoffs:2,xpad:1.01758,sc:.625,w:7,h:15},{c:260,x0:1842,y0:174,yoffs:3,xpad:.291992,sc:.625,w:9,h:17},{c:261,x0:1004,y0:372,yoffs:6,xpad:1.01758,sc:.625,w:7,h:14},{c:262,x0:242,y0:160,yoffs:-1,sc:.625,w:9,h:18},{c:263,x0:952,y0:266,yoffs:1,sc:.625,w:7,h:16},{c:264,x0:262,y0:160,yoffs:-1,sc:.625,w:9,h:18},{c:265,x0:998,y0:320,yoffs:2,sc:.625,w:7,h:15},{c:266,x0:282,y0:160,yoffs:-1,sc:.625,w:9,h:18},{c:267,x0:1016,y0:320,yoffs:2,sc:.625,w:7,h:15},{c:268,x0:302,y0:160,yoffs:-1,sc:.625,w:9,h:18},{c:269,x0:1034,y0:320,yoffs:2,sc:.625,w:7,h:15},{c:270,x0:322,y0:160,yoffs:-1,xpad:.639648,sc:.625,w:10,h:18},{c:271,x0:970,y0:266,yoffs:1,sc:.625,w:10,h:16},{c:272,x0:1022,y0:372,yoffs:3,xpad:.639648,sc:.625,w:10,h:14},{c:273,x0:991,y0:266,yoffs:1,sc:.625,w:9,h:16},{c:274,x0:1862,y0:174,xpad:.422852,sc:.625,w:8,h:17},{c:275,x0:1043,y0:372,yoffs:3,xpad:.0517578,sc:.625,w:8,h:14},{c:276,x0:343,y0:159,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:277,x0:1052,y0:320,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:278,x0:362,y0:159,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:279,x0:1071,y0:320,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:280,x0:1881,y0:174,yoffs:3,xpad:.422852,sc:.625,w:8,h:17},{c:281,x0:1062,y0:372,yoffs:6,xpad:.0517578,sc:.625,w:8,h:14},{c:282,x0:381,y0:159,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:283,x0:1090,y0:320,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:284,x0:400,y0:159,yoffs:-1,xpad:.697266,sc:.625,w:9,h:18},{c:285,x0:420,y0:158,yoffs:2,xpad:.62793,sc:.625,w:8,h:18},{c:286,x0:439,y0:158,yoffs:-1,xpad:.697266,sc:.625,w:9,h:18},{c:287,x0:459,y0:158,yoffs:2,xpad:.62793,sc:.625,w:8,h:18},{c:288,x0:478,y0:158,yoffs:-1,xpad:.697266,sc:.625,w:9,h:18},{c:289,x0:498,y0:158,yoffs:2,xpad:.62793,sc:.625,w:8,h:18},{c:290,x0:1900,y0:174,yoffs:3,xpad:.697266,sc:.625,w:9,h:17},{c:291,x0:2034,y0:84,yoffs:1,xpad:.62793,sc:.625,w:8,h:19},{c:292,x0:517,y0:156,yoffs:-1,xpad:.639648,sc:.625,w:10,h:18},{c:293,x0:5,y0:140,yoffs:-2,xpad:.901367,sc:.625,w:8,h:19},{c:294,x0:1081,y0:372,yoffs:3,sc:.625,w:11,h:14},{c:295,x0:1011,y0:266,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:296,x0:538,y0:156,yoffs:-1,sc:.625,w:5,h:18},{c:297,x0:1109,y0:320,yoffs:2,sc:.625,w:6,h:15},{c:298,x0:1920,y0:174,sc:.625,w:5,h:17},{c:299,x0:1103,y0:372,yoffs:3,sc:.625,w:5,h:14},{c:300,x0:554,y0:155,yoffs:-1,sc:.625,w:5,h:18},{c:301,x0:1126,y0:320,yoffs:2,sc:.625,w:5,h:15},{c:302,x0:1936,y0:174,yoffs:3,xpad:.765625,sc:.625,w:4,h:17},{c:303,x0:570,y0:155,yoffs:2,xpad:.467773,sc:.625,w:4,h:18},{c:304,x0:585,y0:155,yoffs:-1,xpad:.765625,sc:.625,w:4,h:18},{c:305,x0:454,y0:483,yoffs:6,xpad:.467773,sc:.625,w:4,h:11},{c:306,x0:1119,y0:372,yoffs:3,xpad:1.06055,sc:.625,w:11,h:14},{c:307,x0:600,y0:155,yoffs:2,xpad:.94043,sc:.625,w:8,h:18},{c:308,x0:619,y0:155,yoffs:-1,sc:.625,w:8,h:18},{c:309,x0:638,y0:154,yoffs:2,sc:.625,w:6,h:18},{c:310,x0:1951,y0:174,yoffs:3,sc:.625,w:10,h:17},{c:311,x0:24,y0:140,yoffs:1,sc:.625,w:8,h:19},{c:312,x0:469,y0:483,yoffs:6,sc:.625,w:8,h:11},{c:313,x0:655,y0:154,yoffs:-1,sc:.625,w:8,h:18},{c:314,x0:43,y0:140,yoffs:-2,sc:.625,w:5,h:19},{c:315,x0:1972,y0:174,yoffs:3,sc:.625,w:8,h:17},{c:316,x0:59,y0:140,yoffs:1,sc:.625,w:5,h:19},{c:317,x0:1141,y0:372,yoffs:3,sc:.625,w:8,h:14},{c:318,x0:1030,y0:266,yoffs:1,sc:.625,w:6,h:16},{c:319,x0:1160,y0:372,yoffs:3,sc:.625,w:8,h:14},{c:320,x0:1047,y0:266,yoffs:1,sc:.625,w:7,h:16},{c:321,x0:1179,y0:372,yoffs:3,sc:.625,w:8,h:14},{c:322,x0:1065,y0:266,yoffs:1,sc:.625,w:6,h:16},{c:323,x0:674,y0:154,yoffs:-1,xpad:.732422,sc:.625,w:10,h:18},{c:324,x0:1082,y0:266,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:325,x0:1991,y0:174,yoffs:3,xpad:.732422,sc:.625,w:10,h:17},{c:326,x0:1198,y0:372,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:327,x0:695,y0:154,yoffs:-1,xpad:.732422,sc:.625,w:10,h:18},{c:328,x0:1142,y0:320,yoffs:2,xpad:.901367,sc:.625,w:8,h:15},{c:329,x0:1101,y0:266,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:330,x0:2012,y0:174,yoffs:3,xpad:.732422,sc:.625,w:10,h:17},{c:331,x0:1217,y0:372,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:332,x0:5,y0:229,xpad:.176758,sc:.625,w:11,h:17},{c:333,x0:1236,y0:371,yoffs:3,xpad:.549805,sc:.625,w:8,h:14},{c:334,x0:716,y0:154,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:335,x0:1161,y0:320,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:336,x0:75,y0:133,yoffs:-2,xpad:.176758,sc:.625,w:11,h:19},{c:337,x0:1120,y0:266,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:338,x0:1255,y0:371,yoffs:3,sc:.625,w:14,h:14},{c:339,x0:488,y0:483,yoffs:6,xpad:.168945,sc:.625,w:13,h:11},{c:340,x0:738,y0:154,yoffs:-1,xpad:.492188,sc:.625,w:9,h:18},{c:341,x0:1139,y0:266,yoffs:1,xpad:.0595703,sc:.625,w:6,h:16},{c:342,x0:27,y0:229,yoffs:3,xpad:.492188,sc:.625,w:9,h:17},{c:343,x0:1280,y0:371,yoffs:6,xpad:.0595703,sc:.625,w:6,h:14},{c:344,x0:758,y0:154,yoffs:-1,xpad:.492188,sc:.625,w:9,h:18},{c:345,x0:1180,y0:320,yoffs:2,xpad:.0595703,sc:.625,w:6,h:15},{c:346,x0:778,y0:153,yoffs:-1,xpad:.387695,sc:.625,w:7,h:18},{c:347,x0:1156,y0:266,yoffs:1,xpad:.298828,sc:.625,w:6,h:16},{c:348,x0:796,y0:153,yoffs:-1,xpad:.387695,sc:.625,w:7,h:18},{c:349,x0:1197,y0:320,yoffs:2,xpad:.298828,sc:.625,w:6,h:15},{c:350,x0:47,y0:229,yoffs:3,xpad:.387695,sc:.625,w:7,h:17},{c:351,x0:1297,y0:371,yoffs:6,xpad:.298828,sc:.625,w:6,h:14},{c:352,x0:814,y0:153,yoffs:-1,xpad:.387695,sc:.625,w:7,h:18},{c:353,x0:1214,y0:319,yoffs:2,xpad:.298828,sc:.625,w:6,h:15},{c:354,x0:65,y0:229,yoffs:3,sc:.625,w:8,h:17},{c:355,x0:84,y0:229,yoffs:3,sc:.625,w:6,h:17},{c:356,x0:832,y0:153,yoffs:-1,sc:.625,w:8,h:18},{c:357,x0:1173,y0:266,yoffs:1,sc:.625,w:6,h:16},{c:358,x0:1314,y0:371,yoffs:3,sc:.625,w:8,h:14},{c:359,x0:1333,y0:371,yoffs:3,xpad:.484375,sc:.625,w:6,h:14},{c:360,x0:851,y0:153,yoffs:-1,xpad:1.1416,sc:.625,w:9,h:18},{c:361,x0:1231,y0:319,yoffs:2,xpad:.867188,sc:.625,w:8,h:15},{c:362,x0:101,y0:222,xpad:1.1416,sc:.625,w:9,h:17},{c:363,x0:1350,y0:369,yoffs:3,xpad:.867188,sc:.625,w:8,h:14},{c:364,x0:871,y0:153,yoffs:-1,xpad:1.1416,sc:.625,w:9,h:18},{c:365,x0:1250,y0:319,yoffs:2,xpad:.867188,sc:.625,w:8,h:15},{c:366,x0:891,y0:152,yoffs:-1,xpad:1.1416,sc:.625,w:9,h:18},{c:367,x0:1269,y0:319,yoffs:2,xpad:.867188,sc:.625,w:8,h:15},{c:368,x0:97,y0:133,yoffs:-2,xpad:1.1416,sc:.625,w:9,h:19},{c:369,x0:1190,y0:265,yoffs:1,xpad:.867188,sc:.625,w:8,h:16},{c:370,x0:121,y0:222,yoffs:3,xpad:1.1416,sc:.625,w:9,h:17},{c:371,x0:1369,y0:369,yoffs:6,xpad:.867188,sc:.625,w:8,h:14},{c:372,x0:911,y0:152,yoffs:-1,sc:.625,w:14,h:18},{c:373,x0:1288,y0:319,yoffs:2,sc:.625,w:11,h:15},{c:374,x0:936,y0:152,yoffs:-1,sc:.625,w:9,h:18},{c:375,x0:956,y0:152,yoffs:2,sc:.625,w:8,h:18},{c:376,x0:975,y0:152,yoffs:-1,sc:.625,w:9,h:18},{c:377,x0:995,y0:152,yoffs:-1,sc:.625,w:8,h:18},{c:378,x0:1209,y0:265,yoffs:1,sc:.625,w:7,h:16},{c:379,x0:1014,y0:152,yoffs:-1,sc:.625,w:8,h:18},{c:380,x0:1310,y0:319,yoffs:2,sc:.625,w:7,h:15},{c:381,x0:1033,y0:152,yoffs:-1,sc:.625,w:8,h:18},{c:382,x0:1328,y0:319,yoffs:2,sc:.625,w:7,h:15},{c:383,x0:1227,y0:265,yoffs:1,sc:.625,w:6,h:16},{c:384,x0:1244,y0:265,yoffs:1,xpad:.62793,sc:.625,w:8,h:16},{c:385,x0:1388,y0:369,yoffs:3,xpad:.620117,sc:.625,w:10,h:14},{c:386,x0:1409,y0:369,yoffs:3,xpad:.25293,sc:.625,w:9,h:14},{c:387,x0:1263,y0:265,yoffs:1,xpad:.62793,sc:.625,w:8,h:16},{c:388,x0:1282,y0:265,yoffs:1,xpad:.62793,sc:.625,w:8,h:16},{c:389,x0:1429,y0:369,yoffs:3,xpad:.0527344,sc:.625,w:9,h:14},{c:390,x0:1449,y0:369,yoffs:3,xpad:.496094,sc:.625,w:8,h:14},{c:391,x0:1301,y0:265,yoffs:1,sc:.625,w:11,h:16},{c:392,x0:1020,y0:447,yoffs:4,sc:.625,w:9,h:13},{c:393,x0:1022,y0:372,yoffs:3,xpad:.639648,sc:.625,w:10,h:14},{c:394,x0:1468,y0:369,yoffs:3,xpad:.674805,sc:.625,w:11,h:14},{c:395,x0:1490,y0:369,yoffs:3,xpad:1.25293,sc:.625,w:8,h:14},{c:396,x0:1323,y0:264,yoffs:1,xpad:.62793,sc:.625,w:8,h:16},{c:397,x0:1509,y0:369,yoffs:6,xpad:.642578,sc:.625,w:8,h:14},{c:398,x0:1528,y0:369,yoffs:3,xpad:1.42285,sc:.625,w:7,h:14},{c:399,x0:1546,y0:369,yoffs:3,xpad:.863281,sc:.625,w:9,h:14},{c:400,x0:1566,y0:369,yoffs:3,sc:.625,w:8,h:14},{c:401,x0:141,y0:222,yoffs:3,sc:.625,w:9,h:17},{c:402,x0:117,y0:133,yoffs:1,xpad:.944336,sc:.625,w:7,h:19},{c:403,x0:1342,y0:263,yoffs:1,sc:.625,w:11,h:16},{c:404,x0:161,y0:220,yoffs:3,sc:.625,w:10,h:17},{c:405,x0:1364,y0:263,yoffs:1,xpad:.706055,sc:.625,w:13,h:16},{c:406,x0:1585,y0:369,yoffs:3,sc:.625,w:6,h:14},{c:407,x0:1602,y0:368,yoffs:3,sc:.625,w:6,h:14},{c:408,x0:1619,y0:366,yoffs:3,sc:.625,w:10,h:14},{c:409,x0:1388,y0:263,yoffs:1,sc:.625,w:8,h:16},{c:410,x0:1407,y0:263,yoffs:1,sc:.625,w:5,h:16},{c:411,x0:1423,y0:263,yoffs:1,sc:.625,w:8,h:16},{c:412,x0:1640,y0:366,yoffs:3,xpad:1.25781,sc:.625,w:13,h:14},{c:413,x0:182,y0:219,yoffs:3,xpad:.0839844,sc:.625,w:11,h:17},{c:414,x0:1664,y0:366,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:415,x0:1683,y0:366,yoffs:3,xpad:.176758,sc:.625,w:11,h:14},{c:416,x0:1442,y0:263,yoffs:1,xpad:.176758,sc:.625,w:11,h:16},{c:417,x0:1040,y0:447,yoffs:4,sc:.625,w:9,h:13},{c:418,x0:1705,y0:366,yoffs:3,xpad:1.43945,sc:.625,w:14,h:14},{c:419,x0:1730,y0:366,yoffs:6,xpad:.558594,sc:.625,w:12,h:14},{c:420,x0:1753,y0:366,yoffs:3,sc:.625,w:10,h:14},{c:421,x0:135,y0:131,yoffs:1,xpad:.62793,sc:.625,w:8,h:19},{c:422,x0:1052,y0:152,yoffs:1,sc:.625,w:10,h:18},{c:423,x0:1774,y0:366,yoffs:3,xpad:.275391,sc:.625,w:7,h:14},{c:424,x0:512,y0:482,yoffs:6,xpad:.352539,sc:.625,w:6,h:11},{c:425,x0:1792,y0:366,yoffs:3,sc:.625,w:8,h:14},{c:426,x0:154,y0:131,yoffs:1,sc:.625,w:7,h:19},{c:427,x0:204,y0:219,yoffs:3,sc:.625,w:6,h:17},{c:428,x0:1811,y0:366,yoffs:3,sc:.625,w:9,h:14},{c:429,x0:1464,y0:263,yoffs:1,sc:.625,w:6,h:16},{c:430,x0:221,y0:219,yoffs:3,sc:.625,w:8,h:17},{c:431,x0:1481,y0:263,yoffs:1,sc:.625,w:11,h:16},{c:432,x0:1060,y0:447,yoffs:4,sc:.625,w:10,h:13},{c:433,x0:1831,y0:366,yoffs:3,xpad:.28418,sc:.625,w:11,h:14},{c:434,x0:1853,y0:366,yoffs:3,xpad:.175781,sc:.625,w:10,h:14},{c:435,x0:1874,y0:364,yoffs:3,sc:.625,w:11,h:14},{c:436,x0:1896,y0:364,yoffs:6,sc:.625,w:9,h:14},{c:437,x0:1916,y0:364,yoffs:3,sc:.625,w:8,h:14},{c:438,x0:529,y0:482,yoffs:6,sc:.625,w:7,h:11},{c:439,x0:1935,y0:364,yoffs:3,xpad:.441406,sc:.625,w:7,h:14},{c:440,x0:1953,y0:364,yoffs:3,sc:.625,w:8,h:14},{c:441,x0:1972,y0:364,yoffs:6,sc:.625,w:7,h:14},{c:442,x0:1990,y0:364,yoffs:6,xpad:.743164,sc:.625,w:6,h:14},{c:443,x0:2007,y0:364,yoffs:3,xpad:1.07129,sc:.625,w:7,h:14},{c:444,x0:2025,y0:364,yoffs:3,xpad:.426758,sc:.625,w:7,h:14},{c:445,x0:547,y0:481,yoffs:6,xpad:.757813,sc:.625,w:6,h:11},{c:446,x0:5,y0:419,yoffs:3,xpad:.669922,sc:.625,w:6,h:14},{c:447,x0:22,y0:419,yoffs:6,xpad:.496094,sc:.625,w:8,h:14},{c:448,x0:172,y0:131,yoffs:1,xpad:.970703,sc:.625,w:4,h:19},{c:449,x0:187,y0:131,yoffs:1,xpad:1.25684,sc:.625,w:7,h:19},{c:450,x0:205,y0:131,yoffs:1,xpad:.217773,sc:.625,w:8,h:19},{c:451,x0:41,y0:419,yoffs:3,xpad:.858398,sc:.625,w:4,h:14},{c:452,x0:1073,y0:152,yoffs:-1,xpad:.47168,sc:.625,w:18,h:18},{c:453,x0:1346,y0:317,yoffs:2,xpad:.0654297,sc:.625,w:17,h:15},{c:454,x0:1503,y0:263,yoffs:1,xpad:.478516,sc:.625,w:15,h:16},{c:455,x0:56,y0:419,yoffs:3,xpad:1.36621,sc:.625,w:14,h:14},{c:456,x0:1102,y0:152,yoffs:2,xpad:1.17285,sc:.625,w:11,h:18},{c:457,x0:224,y0:130,yoffs:1,xpad:.959961,sc:.625,w:8,h:19},{c:458,x0:81,y0:419,yoffs:3,xpad:1.00781,sc:.625,w:17,h:14},{c:459,x0:1124,y0:152,yoffs:2,xpad:1.18066,sc:.625,w:14,h:18},{c:460,x0:1149,y0:151,yoffs:2,xpad:.374023,sc:.625,w:13,h:18},{c:461,x0:1173,y0:151,yoffs:-1,xpad:.291992,sc:.625,w:9,h:18},{c:462,x0:1374,y0:317,yoffs:2,xpad:1.01758,sc:.625,w:7,h:15},{c:463,x0:1193,y0:151,yoffs:-1,sc:.625,w:5,h:18},{c:464,x0:1392,y0:317,yoffs:2,sc:.625,w:5,h:15},{c:465,x0:1209,y0:151,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:466,x0:1408,y0:317,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:467,x0:1231,y0:151,yoffs:-1,xpad:1.1416,sc:.625,w:9,h:18},{c:468,x0:1427,y0:317,yoffs:2,xpad:.867188,sc:.625,w:8,h:15},{c:469,x0:243,y0:130,yoffs:-2,xpad:1.1416,sc:.625,w:9,h:19},{c:470,x0:1529,y0:263,yoffs:1,xpad:.867188,sc:.625,w:8,h:16},{c:471,x0:263,y0:130,yoffs:-2,xpad:1.1416,sc:.625,w:9,h:19},{c:472,x0:1251,y0:151,yoffs:-1,xpad:.867188,sc:.625,w:8,h:18},{c:473,x0:283,y0:130,yoffs:-2,xpad:1.1416,sc:.625,w:9,h:19},{c:474,x0:240,y0:219,xpad:.867188,sc:.625,w:8,h:17},{c:475,x0:303,y0:130,yoffs:-2,xpad:1.1416,sc:.625,w:9,h:19},{c:476,x0:1270,y0:150,yoffs:-1,xpad:.867188,sc:.625,w:8,h:18},{c:477,x0:564,y0:481,yoffs:6,xpad:.0517578,sc:.625,w:8,h:11},{c:478,x0:323,y0:129,yoffs:-2,xpad:.291992,sc:.625,w:9,h:19},{c:479,x0:1548,y0:262,yoffs:1,xpad:1.01758,sc:.625,w:7,h:16},{c:480,x0:343,y0:129,yoffs:-2,xpad:.291992,sc:.625,w:9,h:19},{c:481,x0:1566,y0:260,yoffs:1,xpad:1.01758,sc:.625,w:7,h:16},{c:482,x0:259,y0:218,xpad:.466797,sc:.625,w:13,h:17},{c:483,x0:109,y0:419,yoffs:3,xpad:.246094,sc:.625,w:12,h:14},{c:484,x0:132,y0:419,yoffs:3,sc:.625,w:10,h:14},{c:485,x0:153,y0:419,yoffs:6,sc:.625,w:9,h:14},{c:486,x0:1289,y0:150,yoffs:-1,xpad:.697266,sc:.625,w:9,h:18},{c:487,x0:1309,y0:149,yoffs:2,xpad:.62793,sc:.625,w:8,h:18},{c:488,x0:1328,y0:149,yoffs:-1,sc:.625,w:10,h:18},{c:489,x0:363,y0:129,yoffs:-2,sc:.625,w:8,h:19},{c:490,x0:283,y0:218,yoffs:3,xpad:.176758,sc:.625,w:11,h:17},{c:491,x0:173,y0:412,yoffs:6,xpad:.549805,sc:.625,w:8,h:14},{c:492,x0:1377,y0:88,xpad:.176758,sc:.625,w:11,h:20},{c:493,x0:305,y0:218,yoffs:3,xpad:.549805,sc:.625,w:8,h:17},{c:494,x0:1349,y0:149,yoffs:-1,xpad:.441406,sc:.625,w:7,h:18},{c:495,x0:1367,y0:149,yoffs:2,sc:.625,w:7,h:18},{c:496,x0:1385,y0:149,yoffs:2,sc:.625,w:6,h:18},{c:497,x0:192,y0:412,yoffs:3,xpad:.47168,sc:.625,w:18,h:14},{c:498,x0:221,y0:412,yoffs:3,xpad:.250977,sc:.625,w:17,h:14},{c:499,x0:1584,y0:260,yoffs:1,xpad:.239258,sc:.625,w:15,h:16},{c:500,x0:382,y0:129,yoffs:-2,xpad:.697266,sc:.625,w:9,h:19},{c:501,x0:402,y0:128,yoffs:1,xpad:.62793,sc:.625,w:8,h:19},{c:502,x0:249,y0:409,yoffs:3,xpad:.571289,sc:.625,w:15,h:14},{c:503,x0:324,y0:218,yoffs:3,xpad:.624023,sc:.625,w:9,h:17},{c:504,x0:421,y0:128,yoffs:-2,xpad:.732422,sc:.625,w:10,h:19},{c:505,x0:1610,y0:260,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:506,x0:442,y0:128,yoffs:-2,xpad:.291992,sc:.625,w:9,h:19},{c:507,x0:1402,y0:149,yoffs:-1,xpad:1.01758,sc:.625,w:7,h:18},{c:508,x0:462,y0:128,yoffs:-2,xpad:.466797,sc:.625,w:13,h:19},{c:509,x0:1629,y0:260,yoffs:1,xpad:.246094,sc:.625,w:12,h:16},{c:510,x0:1420,y0:149,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:511,x0:1652,y0:260,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:512,x0:486,y0:128,yoffs:-2,xpad:.291992,sc:.625,w:9,h:19},{c:513,x0:1671,y0:260,yoffs:1,xpad:1.01758,sc:.625,w:7,h:16},{c:514,x0:1442,y0:149,yoffs:-1,xpad:.291992,sc:.625,w:9,h:18},{c:515,x0:1446,y0:317,yoffs:2,xpad:1.01758,sc:.625,w:7,h:15},{c:516,x0:506,y0:126,yoffs:-2,xpad:.422852,sc:.625,w:8,h:19},{c:517,x0:1689,y0:260,yoffs:1,xpad:.0517578,sc:.625,w:8,h:16},{c:518,x0:1462,y0:149,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:519,x0:1464,y0:317,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:520,x0:525,y0:126,yoffs:-2,sc:.625,w:7,h:19},{c:521,x0:1708,y0:260,yoffs:1,sc:.625,w:7,h:16},{c:522,x0:1481,y0:149,yoffs:-1,sc:.625,w:5,h:18},{c:523,x0:1483,y0:317,yoffs:2,sc:.625,w:5,h:15},{c:524,x0:543,y0:125,yoffs:-2,xpad:.176758,sc:.625,w:11,h:19},{c:525,x0:1726,y0:260,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:526,x0:1497,y0:148,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:527,x0:1499,y0:317,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:528,x0:565,y0:125,yoffs:-2,xpad:.492188,sc:.625,w:9,h:19},{c:529,x0:1745,y0:260,yoffs:1,xpad:.0595703,sc:.625,w:6,h:16},{c:530,x0:1519,y0:146,yoffs:-1,xpad:.492188,sc:.625,w:9,h:18},{c:531,x0:1518,y0:317,yoffs:2,xpad:.0595703,sc:.625,w:6,h:15},{c:532,x0:585,y0:125,yoffs:-2,xpad:1.1416,sc:.625,w:9,h:19},{c:533,x0:1762,y0:260,yoffs:1,xpad:.867188,sc:.625,w:8,h:16},{c:534,x0:1539,y0:146,yoffs:-1,xpad:1.1416,sc:.625,w:9,h:18},{c:535,x0:1535,y0:317,yoffs:2,xpad:.867188,sc:.625,w:8,h:15},{c:536,x0:344,y0:218,yoffs:3,xpad:.387695,sc:.625,w:7,h:17},{c:537,x0:275,y0:409,yoffs:6,xpad:.298828,sc:.625,w:6,h:14},{c:538,x0:362,y0:217,yoffs:3,sc:.625,w:8,h:17},{c:539,x0:381,y0:217,yoffs:3,sc:.625,w:6,h:17},{c:540,x0:398,y0:217,yoffs:3,xpad:.739258,sc:.625,w:7,h:17},{c:541,x0:292,y0:409,yoffs:6,xpad:.518555,sc:.625,w:6,h:14},{c:542,x0:1559,y0:146,yoffs:-1,xpad:.639648,sc:.625,w:10,h:18},{c:543,x0:605,y0:125,yoffs:-2,xpad:.901367,sc:.625,w:8,h:19},{c:544,x0:416,y0:217,yoffs:3,xpad:1.21484,sc:.625,w:9,h:17},{c:545,x0:624,y0:124,yoffs:1,sc:.625,w:11,h:19},{c:546,x0:309,y0:409,yoffs:3,xpad:.863281,sc:.625,w:9,h:14},{c:547,x0:1781,y0:260,yoffs:1,xpad:.774414,sc:.625,w:8,h:16},{c:548,x0:436,y0:216,yoffs:3,sc:.625,w:8,h:17},{c:549,x0:329,y0:409,yoffs:6,sc:.625,w:7,h:14},{c:550,x0:1580,y0:146,yoffs:-1,xpad:.291992,sc:.625,w:9,h:18},{c:551,x0:1554,y0:317,yoffs:2,xpad:1.01758,sc:.625,w:7,h:15},{c:552,x0:455,y0:216,yoffs:3,xpad:.422852,sc:.625,w:8,h:17},{c:553,x0:347,y0:408,yoffs:6,xpad:.0517578,sc:.625,w:8,h:14},{c:554,x0:646,y0:124,yoffs:-2,xpad:.176758,sc:.625,w:11,h:19},{c:555,x0:1800,y0:260,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:556,x0:668,y0:124,yoffs:-2,xpad:.176758,sc:.625,w:11,h:19},{c:557,x0:1819,y0:258,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:558,x0:1600,y0:146,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:559,x0:1572,y0:316,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:560,x0:690,y0:124,yoffs:-2,xpad:.176758,sc:.625,w:11,h:19},{c:561,x0:1838,y0:258,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:562,x0:474,y0:216,sc:.625,w:9,h:17},{c:563,x0:494,y0:216,yoffs:3,sc:.625,w:8,h:17},{c:564,x0:712,y0:124,yoffs:1,sc:.625,w:8,h:19},{c:565,x0:366,y0:408,yoffs:6,sc:.625,w:11,h:14},{c:566,x0:513,y0:216,yoffs:3,sc:.625,w:8,h:17},{c:567,x0:388,y0:408,yoffs:6,xpad:.0927734,sc:.625,w:5,h:14},{c:568,x0:1857,y0:258,yoffs:1,xpad:.744141,sc:.625,w:12,h:16},{c:569,x0:404,y0:408,yoffs:6,xpad:.744141,sc:.625,w:12,h:14},{c:570,x0:1622,y0:146,yoffs:1,xpad:.291992,sc:.625,w:9,h:18},{c:571,x0:532,y0:216,yoffs:1,sc:.625,w:9,h:17},{c:572,x0:427,y0:408,yoffs:4,sc:.625,w:7,h:14},{c:573,x0:445,y0:408,yoffs:3,sc:.625,w:8,h:14},{c:574,x0:1591,y0:314,yoffs:2,sc:.625,w:9,h:15},{c:575,x0:464,y0:408,yoffs:6,xpad:.298828,sc:.625,w:6,h:14},{c:576,x0:481,y0:407,yoffs:6,sc:.625,w:7,h:14},{c:577,x0:499,y0:406,yoffs:3,xpad:.0556641,sc:.625,w:7,h:14},{c:578,x0:583,y0:481,yoffs:6,sc:.625,w:6,h:11},{c:579,x0:517,y0:406,yoffs:3,xpad:.643555,sc:.625,w:9,h:14},{c:580,x0:537,y0:406,yoffs:3,xpad:.141602,sc:.625,w:10,h:14},{c:581,x0:558,y0:406,yoffs:3,xpad:.179688,sc:.625,w:9,h:14},{c:582,x0:552,y0:214,yoffs:2,sc:.625,w:9,h:17},{c:583,x0:578,y0:406,yoffs:4,xpad:.0517578,sc:.625,w:8,h:14},{c:584,x0:597,y0:406,yoffs:3,sc:.625,w:8,h:14},{c:585,x0:1642,y0:146,yoffs:2,sc:.625,w:6,h:18},{c:586,x0:572,y0:213,yoffs:3,sc:.625,w:13,h:17},{c:587,x0:616,y0:406,yoffs:6,sc:.625,w:10,h:14},{c:588,x0:637,y0:404,yoffs:3,xpad:.604492,sc:.625,w:9,h:14},{c:589,x0:600,y0:481,yoffs:6,xpad:.0595703,sc:.625,w:6,h:11},{c:590,x0:657,y0:404,yoffs:3,sc:.625,w:9,h:14},{c:591,x0:677,y0:403,yoffs:6,sc:.625,w:8,h:14},{c:592,x0:617,y0:481,yoffs:6,sc:.625,w:11,h:11},{c:593,x0:639,y0:481,yoffs:6,xpad:1.1377,sc:.625,w:10,h:11},{c:594,x0:660,y0:479,yoffs:6,xpad:.347656,sc:.625,w:11,h:11},{c:595,x0:1611,y0:314,yoffs:2,xpad:.347656,sc:.625,w:11,h:15},{c:596,x0:682,y0:479,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:597,x0:61,y0:494,yoffs:6,sc:.625,w:10,h:12},{c:598,x0:731,y0:124,yoffs:2,sc:.625,w:12,h:19},{c:599,x0:1633,y0:314,yoffs:2,sc:.625,w:12,h:15},{c:600,x0:702,y0:478,yoffs:6,xpad:.595703,sc:.625,w:10,h:11},{c:601,x0:723,y0:478,yoffs:6,xpad:.595703,sc:.625,w:10,h:11},{c:602,x0:744,y0:477,yoffs:6,sc:.625,w:16,h:11},{c:603,x0:771,y0:477,yoffs:6,sc:.625,w:10,h:11},{c:604,x0:792,y0:477,yoffs:6,sc:.625,w:10,h:11},{c:605,x0:813,y0:477,yoffs:6,sc:.625,w:15,h:11},{c:606,x0:839,y0:477,yoffs:6,xpad:.274414,sc:.625,w:11,h:11},{c:607,x0:1656,y0:314,yoffs:6,sc:.625,w:8,h:15},{c:608,x0:754,y0:124,yoffs:2,sc:.625,w:12,h:19},{c:609,x0:1675,y0:314,yoffs:6,xpad:1.31348,sc:.625,w:10,h:15},{c:610,x0:861,y0:477,yoffs:6,xpad:.737305,sc:.625,w:10,h:11},{c:611,x0:1696,y0:314,yoffs:6,sc:.625,w:11,h:15},{c:612,x0:882,y0:476,yoffs:6,sc:.625,w:11,h:11},{c:613,x0:1718,y0:314,yoffs:6,xpad:.777344,sc:.625,w:11,h:15},{c:614,x0:1740,y0:314,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:615,x0:777,y0:123,yoffs:2,xpad:.777344,sc:.625,w:11,h:19},{c:616,x0:1762,y0:314,yoffs:2,sc:.625,w:6,h:15},{c:617,x0:904,y0:476,yoffs:6,xpad:.294922,sc:.625,w:7,h:11},{c:618,x0:922,y0:475,yoffs:6,sc:.625,w:7,h:11},{c:619,x0:1779,y0:314,yoffs:2,sc:.625,w:8,h:15},{c:620,x0:1798,y0:314,yoffs:2,sc:.625,w:9,h:15},{c:621,x0:799,y0:123,yoffs:2,sc:.625,w:7,h:19},{c:622,x0:817,y0:123,yoffs:2,xpad:.623047,sc:.625,w:13,h:19},{c:623,x0:940,y0:475,yoffs:6,xpad:.602539,sc:.625,w:17,h:11},{c:624,x0:1818,y0:314,yoffs:6,xpad:.602539,sc:.625,w:17,h:15},{c:625,x0:1846,y0:312,yoffs:6,xpad:.602539,sc:.625,w:17,h:15},{c:626,x0:1874,y0:312,yoffs:6,xpad:.314453,sc:.625,w:12,h:15},{c:627,x0:1897,y0:312,yoffs:6,sc:.625,w:13,h:15},{c:628,x0:968,y0:474,yoffs:6,xpad:.905273,sc:.625,w:12,h:11},{c:629,x0:991,y0:473,yoffs:6,xpad:.0986328,sc:.625,w:11,h:11},{c:630,x0:1013,y0:471,yoffs:6,xpad:.634766,sc:.625,w:15,h:11},{c:631,x0:1039,y0:471,yoffs:6,sc:.625,w:15,h:11},{c:632,x0:841,y0:123,yoffs:2,xpad:.594727,sc:.625,w:14,h:19},{c:633,x0:1065,y0:471,yoffs:6,xpad:1.13965,sc:.625,w:7,h:11},{c:634,x0:1921,y0:312,yoffs:2,xpad:1.13965,sc:.625,w:7,h:15},{c:635,x0:1939,y0:312,yoffs:6,sc:.625,w:9,h:15},{c:636,x0:1959,y0:312,yoffs:6,xpad:.139648,sc:.625,w:8,h:15},{c:637,x0:1978,y0:312,yoffs:6,xpad:.139648,sc:.625,w:8,h:15},{c:638,x0:1083,y0:471,yoffs:6,xpad:.133789,sc:.625,w:7,h:11},{c:639,x0:1997,y0:312,yoffs:6,xpad:1.13379,sc:.625,w:6,h:15},{c:640,x0:1101,y0:471,yoffs:6,sc:.625,w:11,h:11},{c:641,x0:1123,y0:471,yoffs:6,sc:.625,w:11,h:11},{c:642,x0:2014,y0:312,yoffs:6,sc:.625,w:9,h:15},{c:643,x0:866,y0:123,yoffs:2,sc:.625,w:8,h:19},{c:644,x0:885,y0:122,yoffs:2,sc:.625,w:8,h:19},{c:645,x0:2034,y0:285,yoffs:6,sc:.625,w:8,h:15},{c:646,x0:904,y0:122,yoffs:2,sc:.625,w:9,h:19},{c:647,x0:1081,y0:447,yoffs:6,sc:.625,w:8,h:13},{c:648,x0:596,y0:213,yoffs:4,sc:.625,w:8,h:17},{c:649,x0:1145,y0:471,yoffs:6,sc:.625,w:12,h:11},{c:650,x0:1168,y0:471,yoffs:6,sc:.625,w:12,h:11},{c:651,x0:1191,y0:471,yoffs:6,xpad:1.01172,sc:.625,w:11,h:11},{c:652,x0:1213,y0:471,yoffs:6,sc:.625,w:11,h:11},{c:653,x0:1235,y0:471,yoffs:6,sc:.625,w:16,h:11},{c:654,x0:5,y0:367,yoffs:2,sc:.625,w:11,h:15},{c:655,x0:1262,y0:470,yoffs:6,sc:.625,w:11,h:11},{c:656,x0:27,y0:367,yoffs:6,sc:.625,w:10,h:15},{c:657,x0:82,y0:494,yoffs:6,sc:.625,w:11,h:12},{c:658,x0:696,y0:403,yoffs:6,sc:.625,w:7,h:14},{c:659,x0:48,y0:367,yoffs:6,xpad:.415039,sc:.625,w:10,h:15},{c:660,x0:69,y0:367,yoffs:2,sc:.625,w:9,h:15},{c:661,x0:89,y0:367,yoffs:2,sc:.625,w:9,h:15},{c:662,x0:109,y0:367,yoffs:2,sc:.625,w:9,h:15},{c:663,x0:129,y0:367,yoffs:6,xpad:.213867,sc:.625,w:9,h:15},{c:664,x0:714,y0:402,yoffs:3,xpad:.272461,sc:.625,w:14,h:14},{c:665,x0:1284,y0:470,yoffs:6,xpad:.274414,sc:.625,w:11,h:11},{c:666,x0:1306,y0:470,yoffs:6,xpad:.274414,sc:.625,w:11,h:11},{c:667,x0:149,y0:360,yoffs:2,sc:.625,w:12,h:15},{c:668,x0:1328,y0:470,yoffs:6,xpad:.870117,sc:.625,w:11,h:11},{c:669,x0:924,y0:122,yoffs:2,sc:.625,w:8,h:19},{c:670,x0:172,y0:360,yoffs:6,xpad:1.11328,sc:.625,w:10,h:15},{c:671,x0:1350,y0:470,yoffs:6,sc:.625,w:9,h:11},{c:672,x0:943,y0:122,yoffs:2,sc:.625,w:12,h:19},{c:673,x0:193,y0:360,yoffs:2,sc:.625,w:9,h:15},{c:674,x0:213,y0:360,yoffs:2,sc:.625,w:9,h:15},{c:675,x0:233,y0:357,yoffs:2,xpad:.0371094,sc:.625,w:18,h:15},{c:676,x0:966,y0:122,yoffs:2,xpad:.125977,sc:.625,w:19,h:19},{c:677,x0:1880,y0:258,yoffs:2,sc:.625,w:20,h:16},{c:678,x0:1100,y0:447,yoffs:4,xpad:.628906,sc:.625,w:14,h:13},{c:679,x0:996,y0:122,yoffs:2,sc:.625,w:12,h:19},{c:680,x0:1125,y0:447,yoffs:4,xpad:.494141,sc:.625,w:16,h:13},{c:681,x0:1019,y0:122,yoffs:2,xpad:1.24609,sc:.625,w:16,h:19},{c:682,x0:262,y0:357,yoffs:2,sc:.625,w:13,h:15},{c:683,x0:286,y0:357,yoffs:2,xpad:.15332,sc:.625,w:12,h:15},{c:684,x0:739,y0:402,yoffs:3,sc:.625,w:10,h:14},{c:685,x0:760,y0:402,yoffs:3,xpad:.864258,sc:.625,w:10,h:14},{c:686,x0:309,y0:356,yoffs:6,xpad:.133789,sc:.625,w:12,h:15},{c:687,x0:332,y0:356,yoffs:6,sc:.625,w:14,h:15},{c:699,x0:1087,y0:515,yoffs:3,sc:.625,w:4,h:5},{c:700,x0:1102,y0:515,yoffs:1,xpad:.800781,sc:.625,w:5,h:5},{c:785,x0:400,y0:548,yoffs:2,sc:.625,w:6,h:3},{c:802,x0:646,y0:525,yoffs:15,sc:.625,w:4,h:6},{c:856,x0:1732,y0:509,yoffs:2,sc:.625,w:5,h:4},{c:880,x0:781,y0:402,yoffs:3,xpad:.676758,sc:.625,w:8,h:14},{c:881,x0:1370,y0:470,yoffs:6,sc:.625,w:8,h:11},{c:882,x0:800,y0:402,yoffs:3,sc:.625,w:13,h:14},{c:883,x0:357,y0:356,yoffs:2,sc:.625,w:11,h:15},{c:884,x0:1748,y0:509,yoffs:3,sc:.625,w:5,h:4},{c:885,x0:1764,y0:509,yoffs:17,sc:.625,w:5,h:4},{c:886,x0:824,y0:402,yoffs:3,xpad:.755859,sc:.625,w:14,h:14},{c:887,x0:1389,y0:468,yoffs:6,xpad:.905273,sc:.625,w:12,h:11},{c:890,x0:1780,y0:509,yoffs:17,xpad:2.3418,sc:.625,w:8,h:4},{c:891,x0:682,y0:479,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:892,x0:1412,y0:468,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:893,x0:1432,y0:468,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:894,x0:1152,y0:447,yoffs:6,xpad:.200195,sc:.625,w:5,h:13},{c:895,x0:615,y0:213,yoffs:3,xpad:.260742,sc:.625,w:7,h:17},{c:900,x0:1118,y0:515,yoffs:1,sc:.625,w:6,h:5},{c:901,x0:1135,y0:515,yoffs:1,sc:.625,w:8,h:5},{c:902,x0:849,y0:401,yoffs:3,xpad:.291992,sc:.625,w:9,h:14},{c:903,x0:1799,y0:508,yoffs:6,xpad:.107422,sc:.625,w:5,h:4},{c:904,x0:869,y0:401,yoffs:3,xpad:.0683594,sc:.625,w:10,h:14},{c:905,x0:890,y0:400,yoffs:3,xpad:.280273,sc:.625,w:12,h:14},{c:906,x0:913,y0:399,yoffs:3,xpad:.40625,sc:.625,w:6,h:14},{c:908,x0:930,y0:399,yoffs:3,xpad:.226563,sc:.625,w:12,h:14},{c:910,x0:953,y0:398,yoffs:3,sc:.625,w:12,h:14},{c:911,x0:976,y0:397,yoffs:3,xpad:.319336,sc:.625,w:12,h:14},{c:912,x0:1911,y0:258,yoffs:1,sc:.625,w:8,h:16},{c:913,x0:999,y0:397,yoffs:3,xpad:.291992,sc:.625,w:9,h:14},{c:914,x0:1019,y0:397,yoffs:3,xpad:.624023,sc:.625,w:9,h:14},{c:915,x0:1039,y0:397,yoffs:3,sc:.625,w:8,h:14},{c:916,x0:1058,y0:397,yoffs:3,sc:.625,w:10,h:14},{c:917,x0:1079,y0:397,yoffs:3,xpad:.422852,sc:.625,w:8,h:14},{c:918,x0:1098,y0:397,yoffs:3,sc:.625,w:8,h:14},{c:919,x0:1117,y0:397,yoffs:3,xpad:.639648,sc:.625,w:10,h:14},{c:920,x0:1138,y0:397,yoffs:3,xpad:.176758,sc:.625,w:11,h:14},{c:921,x0:1160,y0:397,yoffs:3,xpad:.765625,sc:.625,w:4,h:14},{c:922,x0:1175,y0:397,yoffs:3,sc:.625,w:10,h:14},{c:923,x0:558,y0:406,yoffs:3,xpad:.179688,sc:.625,w:9,h:14},{c:924,x0:1196,y0:397,yoffs:3,xpad:.408203,sc:.625,w:13,h:14},{c:925,x0:1220,y0:397,yoffs:3,xpad:.732422,sc:.625,w:10,h:14},{c:926,x0:1241,y0:396,yoffs:3,xpad:.310547,sc:.625,w:8,h:14},{c:927,x0:1260,y0:396,yoffs:3,xpad:.176758,sc:.625,w:11,h:14},{c:928,x0:1282,y0:396,yoffs:3,xpad:1.40039,sc:.625,w:9,h:14},{c:929,x0:1302,y0:396,yoffs:3,sc:.625,w:9,h:14},{c:931,x0:1792,y0:366,yoffs:3,sc:.625,w:8,h:14},{c:932,x0:1322,y0:396,yoffs:3,sc:.625,w:8,h:14},{c:933,x0:1341,y0:396,yoffs:3,sc:.625,w:9,h:14},{c:934,x0:379,y0:356,yoffs:2,xpad:.0800781,sc:.625,w:12,h:15},{c:935,x0:1361,y0:394,yoffs:3,sc:.625,w:9,h:14},{c:936,x0:1381,y0:394,yoffs:3,xpad:.435547,sc:.625,w:11,h:14},{c:937,x0:1403,y0:394,yoffs:3,xpad:.28418,sc:.625,w:11,h:14},{c:938,x0:1659,y0:146,yoffs:-1,sc:.625,w:7,h:18},{c:939,x0:1677,y0:146,yoffs:-1,sc:.625,w:9,h:18},{c:940,x0:1930,y0:258,yoffs:1,sc:.625,w:9,h:16},{c:941,x0:1950,y0:258,yoffs:1,xpad:.128906,sc:.625,w:7,h:16},{c:942,x0:1046,y0:122,yoffs:1,xpad:.901367,sc:.625,w:8,h:19},{c:943,x0:1968,y0:258,yoffs:1,sc:.625,w:5,h:16},{c:944,x0:1984,y0:258,yoffs:1,xpad:.959961,sc:.625,w:8,h:16},{c:945,x0:1452,y0:468,yoffs:6,sc:.625,w:9,h:11},{c:946,x0:1065,y0:122,yoffs:1,xpad:.140625,sc:.625,w:9,h:19},{c:947,x0:1425,y0:394,yoffs:6,xpad:.407227,sc:.625,w:7,h:14},{c:948,x0:2003,y0:258,yoffs:1,xpad:.608398,sc:.625,w:8,h:16},{c:949,x0:1472,y0:468,yoffs:6,xpad:.128906,sc:.625,w:7,h:11},{c:950,x0:1697,y0:146,yoffs:2,xpad:.0166016,sc:.625,w:7,h:18},{c:951,x0:1443,y0:394,yoffs:6,xpad:.901367,sc:.625,w:8,h:14},{c:952,x0:2022,y0:258,yoffs:1,xpad:.0869141,sc:.625,w:9,h:16},{c:953,x0:1490,y0:468,yoffs:6,sc:.625,w:5,h:11},{c:954,x0:469,y0:483,yoffs:6,sc:.625,w:8,h:11},{c:955,x0:5,y0:313,yoffs:1,sc:.625,w:8,h:16},{c:956,x0:895,y0:374,yoffs:6,xpad:1.01367,sc:.625,w:8,h:14},{c:957,x0:1506,y0:468,yoffs:6,sc:.625,w:8,h:11},{c:958,x0:1085,y0:122,yoffs:1,xpad:.0166016,sc:.625,w:7,h:19},{c:959,x0:1525,y0:468,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:960,x0:1544,y0:468,yoffs:6,xpad:.847656,sc:.625,w:8,h:11},{c:961,x0:1462,y0:394,yoffs:6,xpad:.662109,sc:.625,w:8,h:14},{c:962,x0:1481,y0:394,yoffs:6,sc:.625,w:7,h:14},{c:963,x0:1563,y0:468,yoffs:6,sc:.625,w:9,h:11},{c:964,x0:1583,y0:468,yoffs:6,xpad:.352539,sc:.625,w:6,h:11},{c:965,x0:1600,y0:468,yoffs:6,xpad:.959961,sc:.625,w:8,h:11},{c:966,x0:1499,y0:394,yoffs:6,xpad:.0986328,sc:.625,w:11,h:14},{c:967,x0:1619,y0:468,yoffs:6,xpad:.241211,sc:.625,w:7,h:11},{c:968,x0:1521,y0:394,yoffs:6,xpad:.416016,sc:.625,w:11,h:14},{c:969,x0:1637,y0:468,yoffs:6,xpad:.987305,sc:.625,w:11,h:11},{c:970,x0:402,y0:356,yoffs:2,sc:.625,w:6,h:15},{c:971,x0:419,y0:356,yoffs:2,xpad:.959961,sc:.625,w:8,h:15},{c:972,x0:24,y0:313,yoffs:1,xpad:.549805,sc:.625,w:8,h:16},{c:973,x0:43,y0:313,yoffs:1,xpad:.959961,sc:.625,w:8,h:16},{c:974,x0:62,y0:313,yoffs:1,xpad:.987305,sc:.625,w:11,h:16},{c:975,x0:1715,y0:146,yoffs:3,sc:.625,w:12,h:18},{c:976,x0:438,y0:356,yoffs:2,xpad:.152344,sc:.625,w:11,h:15},{c:977,x0:460,y0:355,yoffs:2,xpad:.125,sc:.625,w:13,h:15},{c:978,x0:1543,y0:394,yoffs:3,sc:.625,w:12,h:14},{c:979,x0:484,y0:354,yoffs:2,sc:.625,w:16,h:15},{c:980,x0:1738,y0:146,yoffs:-1,sc:.625,w:12,h:18},{c:981,x0:841,y0:123,yoffs:2,xpad:.594727,sc:.625,w:14,h:19},{c:982,x0:1659,y0:465,yoffs:6,sc:.625,w:18,h:11},{c:983,x0:511,y0:354,yoffs:6,sc:.625,w:13,h:15},{c:984,x0:1566,y0:394,yoffs:3,xpad:.272461,sc:.625,w:14,h:14},{c:985,x0:535,y0:354,yoffs:6,xpad:.0986328,sc:.625,w:11,h:15},{c:986,x0:1591,y0:394,yoffs:3,xpad:.420898,sc:.625,w:11,h:14},{c:987,x0:1613,y0:393,yoffs:6,sc:.625,w:10,h:14},{c:988,x0:1634,y0:391,yoffs:3,sc:.625,w:10,h:14},{c:989,x0:557,y0:354,yoffs:6,xpad:.306641,sc:.625,w:9,h:15},{c:990,x0:1655,y0:391,yoffs:3,sc:.625,w:10,h:14},{c:991,x0:1103,y0:122,yoffs:2,sc:.625,w:10,h:19},{c:992,x0:1676,y0:391,yoffs:3,xpad:.00585938,sc:.625,w:11,h:14},{c:993,x0:1124,y0:122,yoffs:2,sc:.625,w:11,h:19},{c:1008,x0:1688,y0:465,yoffs:6,sc:.625,w:13,h:11},{c:1009,x0:577,y0:354,yoffs:6,xpad:.0986328,sc:.625,w:11,h:15},{c:1010,x0:1712,y0:465,yoffs:6,xpad:.213867,sc:.625,w:9,h:11},{c:1011,x0:1146,y0:121,yoffs:2,sc:.625,w:7,h:19},{c:1012,x0:1698,y0:391,yoffs:3,xpad:.272461,sc:.625,w:14,h:14},{c:1013,x0:1732,y0:465,yoffs:6,xpad:.394531,sc:.625,w:9,h:11},{c:1014,x0:1752,y0:465,yoffs:6,xpad:.179688,sc:.625,w:9,h:11},{c:1015,x0:1723,y0:391,yoffs:3,xpad:.259766,sc:.625,w:11,h:14},{c:1016,x0:1164,y0:121,yoffs:2,xpad:.347656,sc:.625,w:11,h:19},{c:1017,x0:1745,y0:391,yoffs:3,xpad:.420898,sc:.625,w:11,h:14},{c:1018,x0:1767,y0:391,yoffs:3,xpad:.904297,sc:.625,w:16,h:14},{c:1019,x0:599,y0:354,yoffs:6,xpad:.736328,sc:.625,w:14,h:15},{c:1020,x0:624,y0:352,yoffs:6,xpad:.0791016,sc:.625,w:11,h:15},{c:1021,x0:1794,y0:391,yoffs:3,xpad:.420898,sc:.625,w:11,h:14},{c:1022,x0:1816,y0:391,yoffs:3,xpad:.420898,sc:.625,w:11,h:14},{c:1023,x0:1838,y0:391,yoffs:3,xpad:.420898,sc:.625,w:11,h:14},{c:1024,x0:1761,y0:146,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:1025,x0:1780,y0:146,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:1026,x0:1860,y0:391,yoffs:3,sc:.625,w:11,h:14},{c:1027,x0:1799,y0:145,yoffs:-1,sc:.625,w:8,h:18},{c:1028,x0:1882,y0:389,yoffs:3,sc:.625,w:9,h:14},{c:1029,x0:1902,y0:389,yoffs:3,xpad:.387695,sc:.625,w:7,h:14},{c:1030,x0:1160,y0:397,yoffs:3,xpad:.765625,sc:.625,w:4,h:14},{c:1031,x0:1818,y0:145,yoffs:-1,sc:.625,w:6,h:18},{c:1032,x0:1920,y0:389,yoffs:3,xpad:1.29492,sc:.625,w:6,h:14},{c:1033,x0:1937,y0:389,yoffs:3,xpad:.0146484,sc:.625,w:15,h:14},{c:1034,x0:1963,y0:389,yoffs:3,sc:.625,w:15,h:14},{c:1035,x0:1989,y0:389,yoffs:3,xpad:.97168,sc:.625,w:10,h:14},{c:1036,x0:1835,y0:145,yoffs:-1,sc:.625,w:10,h:18},{c:1037,x0:1856,y0:145,yoffs:-1,xpad:.732422,sc:.625,w:10,h:18},{c:1038,x0:1877,y0:145,yoffs:-1,sc:.625,w:9,h:18},{c:1039,x0:633,y0:213,yoffs:3,xpad:1.38086,sc:.625,w:9,h:17},{c:1040,x0:999,y0:397,yoffs:3,xpad:.291992,sc:.625,w:9,h:14},{c:1041,x0:1409,y0:369,yoffs:3,xpad:.25293,sc:.625,w:9,h:14},{c:1042,x0:1019,y0:397,yoffs:3,xpad:.624023,sc:.625,w:9,h:14},{c:1043,x0:1039,y0:397,yoffs:3,sc:.625,w:8,h:14},{c:1044,x0:653,y0:212,yoffs:3,sc:.625,w:11,h:17},{c:1045,x0:1079,y0:397,yoffs:3,xpad:.422852,sc:.625,w:8,h:14},{c:1046,x0:2010,y0:389,yoffs:3,sc:.625,w:12,h:14},{c:1047,x0:2033,y0:389,yoffs:3,sc:.625,w:8,h:14},{c:1048,x0:5,y0:444,yoffs:3,xpad:.732422,sc:.625,w:10,h:14},{c:1049,x0:1897,y0:145,yoffs:-1,xpad:.732422,sc:.625,w:10,h:18},{c:1050,x0:1175,y0:397,yoffs:3,sc:.625,w:10,h:14},{c:1051,x0:26,y0:444,yoffs:3,xpad:.693359,sc:.625,w:10,h:14},{c:1052,x0:1196,y0:397,yoffs:3,xpad:.408203,sc:.625,w:13,h:14},{c:1053,x0:1117,y0:397,yoffs:3,xpad:.639648,sc:.625,w:10,h:14},{c:1054,x0:1260,y0:396,yoffs:3,xpad:.176758,sc:.625,w:11,h:14},{c:1055,x0:1282,y0:396,yoffs:3,xpad:1.40039,sc:.625,w:9,h:14},{c:1056,x0:1302,y0:396,yoffs:3,sc:.625,w:9,h:14},{c:1057,x0:47,y0:444,yoffs:3,sc:.625,w:9,h:14},{c:1058,x0:1322,y0:396,yoffs:3,sc:.625,w:8,h:14},{c:1059,x0:67,y0:444,yoffs:3,sc:.625,w:9,h:14},{c:1060,x0:379,y0:356,yoffs:2,xpad:.0800781,sc:.625,w:12,h:15},{c:1061,x0:1361,y0:394,yoffs:3,sc:.625,w:9,h:14},{c:1062,x0:675,y0:212,yoffs:3,sc:.625,w:11,h:17},{c:1063,x0:87,y0:444,yoffs:3,xpad:1.43848,sc:.625,w:8,h:14},{c:1064,x0:106,y0:444,yoffs:3,xpad:1.27734,sc:.625,w:13,h:14},{c:1065,x0:697,y0:212,yoffs:3,xpad:.49707,sc:.625,w:14,h:17},{c:1066,x0:130,y0:444,yoffs:3,xpad:.0683594,sc:.625,w:10,h:14},{c:1067,x0:151,y0:444,yoffs:3,xpad:.852539,sc:.625,w:13,h:14},{c:1068,x0:175,y0:437,yoffs:3,xpad:.0527344,sc:.625,w:9,h:14},{c:1069,x0:195,y0:437,yoffs:3,xpad:.828125,sc:.625,w:8,h:14},{c:1070,x0:214,y0:437,yoffs:3,xpad:.292969,sc:.625,w:15,h:14},{c:1071,x0:240,y0:437,yoffs:3,xpad:1.49219,sc:.625,w:8,h:14},{c:1072,x0:1772,y0:465,yoffs:6,xpad:1.01758,sc:.625,w:7,h:11},{c:1073,x0:84,y0:313,yoffs:1,xpad:.71582,sc:.625,w:8,h:16},{c:1074,x0:1790,y0:465,yoffs:6,xpad:.476563,sc:.625,w:8,h:11},{c:1075,x0:1809,y0:465,yoffs:6,xpad:.113281,sc:.625,w:6,h:11},{c:1076,x0:1168,y0:447,yoffs:6,sc:.625,w:9,h:13},{c:1077,x0:1826,y0:465,yoffs:6,xpad:.0517578,sc:.625,w:8,h:11},{c:1078,x0:1845,y0:465,yoffs:6,sc:.625,w:10,h:11},{c:1079,x0:1866,y0:465,yoffs:6,sc:.625,w:7,h:11},{c:1080,x0:1884,y0:465,yoffs:6,xpad:1.0332,sc:.625,w:8,h:11},{c:1081,x0:646,y0:351,yoffs:2,xpad:1.0332,sc:.625,w:8,h:15},{c:1082,x0:469,y0:483,yoffs:6,sc:.625,w:8,h:11},{c:1083,x0:1903,y0:465,yoffs:6,xpad:1.17969,sc:.625,w:8,h:11},{c:1084,x0:1922,y0:463,yoffs:6,xpad:1.26465,sc:.625,w:10,h:11},{c:1085,x0:1943,y0:463,yoffs:6,xpad:1.12598,sc:.625,w:8,h:11},{c:1086,x0:1525,y0:468,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:1087,x0:1544,y0:468,yoffs:6,xpad:.847656,sc:.625,w:8,h:11},{c:1088,x0:259,y0:434,yoffs:6,xpad:.62793,sc:.625,w:8,h:14},{c:1089,x0:1962,y0:463,yoffs:6,sc:.625,w:7,h:11},{c:1090,x0:1980,y0:463,yoffs:6,sc:.625,w:7,h:11},{c:1091,x0:278,y0:434,yoffs:6,sc:.625,w:8,h:14},{c:1092,x0:1186,y0:121,yoffs:1,sc:.625,w:11,h:19},{c:1093,x0:1619,y0:468,yoffs:6,xpad:.241211,sc:.625,w:7,h:11},{c:1094,x0:1188,y0:447,yoffs:6,sc:.625,w:9,h:13},{c:1095,x0:1998,y0:463,yoffs:6,xpad:1.33008,sc:.625,w:7,h:11},{c:1096,x0:2016,y0:463,yoffs:6,xpad:.709961,sc:.625,w:12,h:11},{c:1097,x0:1208,y0:447,yoffs:6,sc:.625,w:13,h:13},{c:1098,x0:5,y0:518,yoffs:6,xpad:.442383,sc:.625,w:8,h:11},{c:1099,x0:24,y0:518,yoffs:6,xpad:1.41211,sc:.625,w:11,h:11},{c:1100,x0:46,y0:517,yoffs:6,sc:.625,w:8,h:11},{c:1101,x0:65,y0:517,yoffs:6,xpad:.0556641,sc:.625,w:7,h:11},{c:1102,x0:83,y0:517,yoffs:6,xpad:.114258,sc:.625,w:12,h:11},{c:1103,x0:106,y0:517,yoffs:6,xpad:1.16406,sc:.625,w:7,h:11},{c:1104,x0:103,y0:313,yoffs:1,xpad:.0517578,sc:.625,w:8,h:16},{c:1105,x0:665,y0:351,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:1106,x0:1208,y0:121,yoffs:1,xpad:.701172,sc:.625,w:8,h:19},{c:1107,x0:122,y0:306,yoffs:1,xpad:.113281,sc:.625,w:6,h:16},{c:1108,x0:124,y0:517,yoffs:6,xpad:.0751953,sc:.625,w:7,h:11},{c:1109,x0:142,y0:517,yoffs:6,xpad:.298828,sc:.625,w:6,h:11},{c:1110,x0:684,y0:351,yoffs:2,xpad:.467773,sc:.625,w:4,h:15},{c:1111,x0:699,y0:350,yoffs:2,sc:.625,w:6,h:15},{c:1112,x0:1918,y0:145,yoffs:2,xpad:.0927734,sc:.625,w:5,h:18},{c:1113,x0:159,y0:517,yoffs:6,sc:.625,w:13,h:11},{c:1114,x0:183,y0:517,yoffs:6,xpad:.504883,sc:.625,w:12,h:11},{c:1115,x0:1011,y0:266,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:1116,x0:139,y0:306,yoffs:1,sc:.625,w:8,h:16},{c:1117,x0:158,y0:306,yoffs:1,xpad:1.0332,sc:.625,w:8,h:16},{c:1118,x0:278,y0:434,yoffs:6,sc:.625,w:8,h:14},{c:1119,x0:1232,y0:447,yoffs:6,xpad:.847656,sc:.625,w:8,h:13},{c:1120,x0:297,y0:434,yoffs:3,xpad:.0849609,sc:.625,w:17,h:14},{c:1121,x0:206,y0:510,yoffs:6,sc:.625,w:16,h:11},{c:1122,x0:716,y0:350,yoffs:2,xpad:.175781,sc:.625,w:10,h:15},{c:1123,x0:177,y0:306,yoffs:1,sc:.625,w:9,h:16},{c:1124,x0:325,y0:434,yoffs:3,xpad:.03125,sc:.625,w:17,h:14},{c:1125,x0:233,y0:510,yoffs:6,xpad:.34082,sc:.625,w:14,h:11},{c:1126,x0:353,y0:433,yoffs:3,sc:.625,w:14,h:14},{c:1127,x0:258,y0:510,yoffs:6,sc:.625,w:12,h:11},{c:1128,x0:378,y0:433,yoffs:3,sc:.625,w:19,h:14},{c:1129,x0:281,y0:507,yoffs:6,sc:.625,w:17,h:11},{c:1130,x0:408,y0:433,yoffs:3,sc:.625,w:15,h:14},{c:1131,x0:309,y0:507,yoffs:6,xpad:.166992,sc:.625,w:11,h:11},{c:1132,x0:434,y0:433,yoffs:3,xpad:.238281,sc:.625,w:19,h:14},{c:1133,x0:331,y0:507,yoffs:6,sc:.625,w:16,h:11},{c:1134,x0:1162,y0:89,xpad:.328125,sc:.625,w:11,h:21},{c:1135,x0:722,y0:212,yoffs:4,sc:.625,w:10,h:17},{c:1136,x0:464,y0:433,yoffs:3,xpad:.703125,sc:.625,w:15,h:14},{c:1137,x0:1227,y0:121,yoffs:2,xpad:.00488281,sc:.625,w:15,h:19},{c:1138,x0:490,y0:432,yoffs:3,xpad:.176758,sc:.625,w:11,h:14},{c:1139,x0:358,y0:507,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:1140,x0:512,y0:431,yoffs:3,sc:.625,w:11,h:14},{c:1141,x0:377,y0:507,yoffs:6,sc:.625,w:9,h:11},{c:1142,x0:1934,y0:145,yoffs:-1,sc:.625,w:13,h:18},{c:1143,x0:737,y0:350,yoffs:2,sc:.625,w:11,h:15},{c:1144,x0:1958,y0:145,yoffs:3,sc:.625,w:24,h:18},{c:1145,x0:759,y0:350,yoffs:6,sc:.625,w:21,h:15},{c:1146,x0:197,y0:306,yoffs:2,xpad:.985352,sc:.625,w:14,h:16},{c:1147,x0:1251,y0:446,yoffs:5,xpad:.172852,sc:.625,w:12,h:13},{c:1148,x0:1399,y0:88,yoffs:-3,xpad:.506836,sc:.625,w:19,h:20},{c:1149,x0:1993,y0:145,yoffs:-1,xpad:.172852,sc:.625,w:17,h:18},{c:1150,x0:743,y0:212,xpad:.0849609,sc:.625,w:17,h:17},{c:1151,x0:534,y0:431,yoffs:3,sc:.625,w:16,h:14},{c:1152,x0:2021,y0:145,yoffs:3,xpad:.138672,sc:.625,w:12,h:18},{c:1153,x0:791,y0:350,yoffs:6,xpad:.394531,sc:.625,w:9,h:15},{c:1154,x0:1274,y0:446,yoffs:4,sc:.625,w:11,h:13},{c:1160,x0:771,y0:212,yoffs:3,sc:.625,w:18,h:17},{c:1161,x0:800,y0:211,yoffs:3,xpad:.138672,sc:.625,w:17,h:17},{c:1162,x0:1184,y0:89,yoffs:-1,sc:.625,w:11,h:21},{c:1163,x0:5,y0:200,yoffs:2,xpad:.0332031,sc:.625,w:9,h:18},{c:1164,x0:561,y0:431,yoffs:3,xpad:.106445,sc:.625,w:9,h:14},{c:1165,x0:397,y0:506,yoffs:6,sc:.625,w:8,h:11},{c:1166,x0:581,y0:431,yoffs:3,sc:.625,w:9,h:14},{c:1167,x0:601,y0:431,yoffs:6,xpad:.62793,sc:.625,w:8,h:14},{c:1168,x0:828,y0:211,sc:.625,w:8,h:17},{c:1169,x0:1296,y0:446,yoffs:4,xpad:.206055,sc:.625,w:6,h:13},{c:1170,x0:620,y0:431,yoffs:3,sc:.625,w:8,h:14},{c:1171,x0:416,y0:506,yoffs:6,xpad:.152344,sc:.625,w:6,h:11},{c:1172,x0:847,y0:211,yoffs:3,xpad:.272461,sc:.625,w:9,h:17},{c:1173,x0:639,y0:429,yoffs:6,xpad:.144531,sc:.625,w:8,h:14},{c:1174,x0:867,y0:211,yoffs:3,xpad:.168945,sc:.625,w:13,h:17},{c:1175,x0:1313,y0:446,yoffs:6,xpad:.0253906,sc:.625,w:11,h:13},{c:1176,x0:891,y0:211,yoffs:3,xpad:.53418,sc:.625,w:7,h:17},{c:1177,x0:658,y0:429,yoffs:6,sc:.625,w:7,h:14},{c:1178,x0:909,y0:210,yoffs:3,xpad:.141602,sc:.625,w:10,h:17},{c:1179,x0:1335,y0:446,yoffs:6,sc:.625,w:9,h:13},{c:1180,x0:676,y0:429,yoffs:3,xpad:.268555,sc:.625,w:10,h:14},{c:1181,x0:433,y0:505,yoffs:6,sc:.625,w:9,h:11},{c:1182,x0:697,y0:428,yoffs:3,sc:.625,w:10,h:14},{c:1183,x0:104,y0:494,yoffs:5,sc:.625,w:8,h:12},{c:1184,x0:718,y0:427,yoffs:3,sc:.625,w:11,h:14},{c:1185,x0:453,y0:505,yoffs:6,sc:.625,w:9,h:11},{c:1186,x0:930,y0:210,yoffs:3,sc:.625,w:11,h:17},{c:1187,x0:1355,y0:446,yoffs:6,sc:.625,w:9,h:13},{c:1188,x0:740,y0:427,yoffs:3,sc:.625,w:12,h:14},{c:1189,x0:473,y0:505,yoffs:6,sc:.625,w:10,h:11},{c:1190,x0:952,y0:210,yoffs:3,sc:.625,w:15,h:17},{c:1191,x0:763,y0:427,yoffs:6,xpad:.412109,sc:.625,w:12,h:14},{c:1192,x0:978,y0:210,yoffs:3,xpad:.416016,sc:.625,w:11,h:17},{c:1193,x0:1375,y0:444,yoffs:6,sc:.625,w:9,h:13},{c:1194,x0:1e3,y0:210,yoffs:3,sc:.625,w:9,h:17},{c:1195,x0:786,y0:427,yoffs:6,sc:.625,w:7,h:14},{c:1196,x0:1020,y0:210,yoffs:3,sc:.625,w:8,h:17},{c:1197,x0:1395,y0:444,yoffs:6,sc:.625,w:7,h:13},{c:1198,x0:1341,y0:396,yoffs:3,sc:.625,w:9,h:14},{c:1199,x0:804,y0:427,yoffs:6,xpad:.22168,sc:.625,w:7,h:14},{c:1200,x0:822,y0:427,yoffs:3,sc:.625,w:9,h:14},{c:1201,x0:842,y0:427,yoffs:6,sc:.625,w:8,h:14},{c:1202,x0:1039,y0:210,yoffs:3,sc:.625,w:10,h:17},{c:1203,x0:1413,y0:444,yoffs:6,sc:.625,w:8,h:13},{c:1204,x0:1060,y0:210,yoffs:3,sc:.625,w:12,h:17},{c:1205,x0:1432,y0:444,yoffs:6,sc:.625,w:10,h:13},{c:1206,x0:1083,y0:210,yoffs:3,sc:.625,w:10,h:17},{c:1207,x0:1453,y0:444,yoffs:6,sc:.625,w:9,h:13},{c:1208,x0:861,y0:426,yoffs:3,xpad:1.43848,sc:.625,w:8,h:14},{c:1209,x0:494,y0:505,yoffs:6,xpad:1.125,sc:.625,w:7,h:11},{c:1210,x0:880,y0:426,yoffs:3,xpad:.604492,sc:.625,w:9,h:14},{c:1211,x0:222,y0:303,yoffs:1,xpad:.901367,sc:.625,w:8,h:16},{c:1212,x0:900,y0:425,yoffs:3,xpad:.728516,sc:.625,w:11,h:14},{c:1213,x0:512,y0:504,yoffs:6,xpad:.658203,sc:.625,w:9,h:11},{c:1214,x0:1104,y0:210,yoffs:3,xpad:.728516,sc:.625,w:11,h:17},{c:1215,x0:1473,y0:444,yoffs:6,xpad:.658203,sc:.625,w:9,h:13},{c:1216,x0:1160,y0:397,yoffs:3,xpad:.765625,sc:.625,w:4,h:14},{c:1217,x0:25,y0:200,yoffs:-1,sc:.625,w:12,h:18},{c:1218,x0:811,y0:350,yoffs:2,sc:.625,w:10,h:15},{c:1219,x0:1126,y0:210,yoffs:3,xpad:.697266,sc:.625,w:9,h:17},{c:1220,x0:922,y0:424,yoffs:6,xpad:.276367,sc:.625,w:8,h:14},{c:1221,x0:1146,y0:210,yoffs:3,sc:.625,w:11,h:17},{c:1222,x0:941,y0:424,yoffs:6,xpad:.160156,sc:.625,w:9,h:14},{c:1223,x0:1168,y0:209,yoffs:3,xpad:.639648,sc:.625,w:10,h:17},{c:1224,x0:961,y0:423,yoffs:6,xpad:1.0332,sc:.625,w:8,h:14},{c:1225,x0:1189,y0:209,yoffs:3,sc:.625,w:11,h:17},{c:1226,x0:980,y0:422,yoffs:6,sc:.625,w:9,h:14},{c:1227,x0:1211,y0:209,yoffs:3,xpad:1.43848,sc:.625,w:8,h:17},{c:1228,x0:1493,y0:444,yoffs:6,xpad:1.33008,sc:.625,w:7,h:13},{c:1229,x0:1230,y0:209,yoffs:3,sc:.625,w:14,h:17},{c:1230,x0:1e3,y0:422,yoffs:6,sc:.625,w:12,h:14},{c:1231,x0:1160,y0:397,yoffs:3,xpad:.765625,sc:.625,w:4,h:14},{c:1232,x0:48,y0:200,yoffs:-1,xpad:.291992,sc:.625,w:9,h:18},{c:1233,x0:832,y0:350,yoffs:2,xpad:1.01758,sc:.625,w:7,h:15},{c:1234,x0:68,y0:200,yoffs:-1,xpad:.291992,sc:.625,w:9,h:18},{c:1235,x0:850,y0:350,yoffs:2,xpad:1.01758,sc:.625,w:7,h:15},{c:1236,x0:1023,y0:422,yoffs:3,xpad:.466797,sc:.625,w:13,h:14},{c:1237,x0:532,y0:504,yoffs:6,xpad:.246094,sc:.625,w:12,h:11},{c:1238,x0:88,y0:193,yoffs:-1,xpad:.422852,sc:.625,w:8,h:18},{c:1239,x0:868,y0:349,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:1240,x0:1546,y0:369,yoffs:3,xpad:.863281,sc:.625,w:9,h:14},{c:1241,x0:555,y0:503,yoffs:6,xpad:.0517578,sc:.625,w:8,h:11},{c:1242,x0:107,y0:193,yoffs:-1,xpad:.863281,sc:.625,w:9,h:18},{c:1243,x0:887,y0:348,yoffs:2,xpad:.0517578,sc:.625,w:8,h:15},{c:1244,x0:127,y0:193,yoffs:-1,sc:.625,w:12,h:18},{c:1245,x0:906,y0:348,yoffs:2,sc:.625,w:10,h:15},{c:1246,x0:150,y0:191,yoffs:-1,sc:.625,w:8,h:18},{c:1247,x0:927,y0:347,yoffs:2,sc:.625,w:7,h:15},{c:1248,x0:1935,y0:364,yoffs:3,xpad:.441406,sc:.625,w:7,h:14},{c:1249,x0:696,y0:403,yoffs:6,sc:.625,w:7,h:14},{c:1250,x0:1255,y0:209,xpad:.732422,sc:.625,w:10,h:17},{c:1251,x0:1047,y0:422,yoffs:3,xpad:1.0332,sc:.625,w:8,h:14},{c:1252,x0:169,y0:190,yoffs:-1,xpad:.732422,sc:.625,w:10,h:18},{c:1253,x0:945,y0:346,yoffs:2,xpad:1.0332,sc:.625,w:8,h:15},{c:1254,x0:190,y0:190,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:1255,x0:964,y0:346,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:1256,x0:1683,y0:366,yoffs:3,xpad:.176758,sc:.625,w:11,h:14},{c:1257,x0:574,y0:503,yoffs:6,xpad:.549805,sc:.625,w:8,h:11},{c:1258,x0:212,y0:190,yoffs:-1,xpad:.176758,sc:.625,w:11,h:18},{c:1259,x0:983,y0:346,yoffs:2,xpad:.549805,sc:.625,w:8,h:15},{c:1260,x0:234,y0:190,yoffs:-1,xpad:.828125,sc:.625,w:8,h:18},{c:1261,x0:1002,y0:346,yoffs:2,xpad:.0556641,sc:.625,w:7,h:15},{c:1262,x0:1276,y0:209,sc:.625,w:9,h:17},{c:1263,x0:494,y0:216,yoffs:3,sc:.625,w:8,h:17},{c:1264,x0:253,y0:189,yoffs:-1,sc:.625,w:9,h:18},{c:1265,x0:273,y0:189,yoffs:2,sc:.625,w:8,h:18},{c:1266,x0:1253,y0:120,yoffs:-2,sc:.625,w:9,h:19},{c:1267,x0:1273,y0:120,yoffs:1,sc:.625,w:8,h:19},{c:1268,x0:292,y0:189,yoffs:-1,xpad:1.43848,sc:.625,w:8,h:18},{c:1269,x0:1020,y0:346,yoffs:2,xpad:1.33008,sc:.625,w:7,h:15},{c:1270,x0:1296,y0:208,yoffs:3,sc:.625,w:8,h:17},{c:1271,x0:1511,y0:444,yoffs:6,xpad:.09375,sc:.625,w:6,h:13},{c:1272,x0:311,y0:189,yoffs:-1,xpad:.852539,sc:.625,w:13,h:18},{c:1273,x0:1038,y0:346,yoffs:2,xpad:1.41211,sc:.625,w:11,h:15},{c:1274,x0:335,y0:189,yoffs:3,xpad:.0195313,sc:.625,w:10,h:18},{c:1275,x0:1060,y0:346,yoffs:6,sc:.625,w:9,h:15},{c:1276,x0:356,y0:188,yoffs:3,xpad:.125,sc:.625,w:13,h:18},{c:1277,x0:1080,y0:346,yoffs:6,xpad:.5625,sc:.625,w:11,h:15},{c:1278,x0:1066,y0:422,yoffs:3,sc:.625,w:12,h:14},{c:1279,x0:593,y0:503,yoffs:6,sc:.625,w:11,h:11},{c:7424,x0:615,y0:503,yoffs:6,xpad:.0585938,sc:.625,w:10,h:11},{c:7425,x0:636,y0:503,yoffs:6,xpad:.696289,sc:.625,w:13,h:11},{c:7426,x0:660,y0:501,yoffs:6,xpad:.44043,sc:.625,w:16,h:11},{c:7427,x0:687,y0:501,yoffs:6,sc:.625,w:12,h:11},{c:7428,x0:710,y0:500,yoffs:6,xpad:.306641,sc:.625,w:9,h:11},{c:7429,x0:730,y0:500,yoffs:6,xpad:.917969,sc:.625,w:10,h:11},{c:7430,x0:751,y0:499,yoffs:6,xpad:.917969,sc:.625,w:10,h:11},{c:7431,x0:772,y0:499,yoffs:6,xpad:.354492,sc:.625,w:8,h:11},{c:7432,x0:791,y0:499,yoffs:6,sc:.625,w:10,h:11},{c:7433,x0:1102,y0:346,yoffs:6,xpad:.46875,sc:.625,w:5,h:15},{c:7434,x0:812,y0:499,yoffs:6,xpad:.757813,sc:.625,w:6,h:11},{c:7435,x0:829,y0:499,yoffs:6,sc:.625,w:10,h:11},{c:7436,x0:850,y0:499,yoffs:6,xpad:.374023,sc:.625,w:8,h:11},{c:7437,x0:869,y0:499,yoffs:6,xpad:.78418,sc:.625,w:13,h:11},{c:7438,x0:893,y0:498,yoffs:6,xpad:.958008,sc:.625,w:11,h:11},{c:7439,x0:915,y0:498,yoffs:6,xpad:.650391,sc:.625,w:11,h:11},{c:7440,x0:937,y0:497,yoffs:6,xpad:.321289,sc:.625,w:9,h:11},{c:7441,x0:957,y0:497,yoffs:6,xpad:.757813,sc:.625,w:11,h:11},{c:7442,x0:85,y0:539,yoffs:7,xpad:.757813,sc:.625,w:11,h:9},{c:7443,x0:979,y0:496,yoffs:6,sc:.625,w:12,h:11},{c:7444,x0:1002,y0:495,yoffs:6,xpad:.53418,sc:.625,w:17,h:11},{c:7445,x0:1030,y0:493,yoffs:6,xpad:.449219,sc:.625,w:10,h:11},{c:7446,x0:661,y0:523,yoffs:6,xpad:.0986328,sc:.625,w:11,h:6},{c:7447,x0:683,y0:523,yoffs:11,xpad:.0986328,sc:.625,w:11,h:6},{c:7448,x0:1051,y0:493,yoffs:6,xpad:.394531,sc:.625,w:9,h:11},{c:7449,x0:1071,y0:493,yoffs:6,xpad:.931641,sc:.625,w:9,h:11},{c:7450,x0:1091,y0:493,yoffs:6,xpad:.931641,sc:.625,w:9,h:11},{c:7451,x0:1111,y0:493,yoffs:6,xpad:.334961,sc:.625,w:8,h:11},{c:7452,x0:1130,y0:493,yoffs:6,xpad:.689453,sc:.625,w:11,h:11},{c:7453,x0:1868,y0:487,yoffs:6,xpad:.240234,sc:.625,w:11,h:10},{c:7454,x0:1890,y0:487,yoffs:6,sc:.625,w:15,h:10},{c:7455,x0:241,y0:303,yoffs:3,xpad:.240234,sc:.625,w:11,h:16},{c:7456,x0:1152,y0:493,yoffs:6,xpad:.0527344,sc:.625,w:9,h:11},{c:7457,x0:1172,y0:493,yoffs:6,sc:.625,w:15,h:11},{c:7458,x0:1198,y0:493,yoffs:6,sc:.625,w:9,h:11},{c:7459,x0:1218,y0:493,yoffs:6,xpad:.78418,sc:.625,w:8,h:11},{c:7460,x0:1237,y0:493,yoffs:6,xpad:.354492,sc:.625,w:8,h:11},{c:7461,x0:1256,y0:493,yoffs:6,xpad:.233398,sc:.625,w:9,h:11},{c:7462,x0:1276,y0:492,yoffs:6,xpad:.427734,sc:.625,w:8,h:11},{c:7463,x0:1295,y0:492,yoffs:6,sc:.625,w:10,h:11},{c:7464,x0:1316,y0:492,yoffs:6,xpad:1.02539,sc:.625,w:10,h:11},{c:7465,x0:1051,y0:493,yoffs:6,xpad:.394531,sc:.625,w:9,h:11},{c:7466,x0:1337,y0:492,yoffs:6,xpad:.709961,sc:.625,w:12,h:11},{c:7467,x0:1360,y0:492,yoffs:6,xpad:.917969,sc:.625,w:10,h:11},{c:7468,x0:1815,y0:508,yoffs:8,xpad:3.04688,sc:.625,w:5,h:4},{c:7469,x0:1831,y0:508,yoffs:8,xpad:4.09863,sc:.625,w:7,h:4},{c:7470,x0:1849,y0:508,yoffs:8,xpad:2.83203,sc:.625,w:5,h:4},{c:7471,x0:107,y0:539,yoffs:3,sc:.625,w:8,h:9},{c:7472,x0:1865,y0:508,yoffs:8,xpad:2.62305,sc:.625,w:6,h:4},{c:7473,x0:1882,y0:508,yoffs:8,xpad:2.52344,sc:.625,w:4,h:4},{c:7474,x0:1897,y0:508,yoffs:8,xpad:2.52344,sc:.625,w:4,h:4},{c:7475,x0:1912,y0:508,yoffs:8,xpad:3.44238,sc:.625,w:5,h:4},{c:7476,x0:1928,y0:508,yoffs:8,xpad:2.91113,sc:.625,w:6,h:4},{c:7477,x0:1945,y0:506,yoffs:8,xpad:1.53613,sc:.625,w:3,h:4},{c:7478,x0:705,y0:523,yoffs:8,xpad:1.85254,sc:.625,w:2,h:6},{c:7479,x0:1959,y0:506,yoffs:8,xpad:2.74414,sc:.625,w:5,h:4},{c:7480,x0:1975,y0:506,yoffs:8,xpad:4.57715,sc:.625,w:2,h:4},{c:7481,x0:1988,y0:506,yoffs:8,xpad:3.99121,sc:.625,w:7,h:4},{c:7482,x0:2006,y0:506,yoffs:8,xpad:3.46777,sc:.625,w:6,h:4},{c:7483,x0:126,y0:539,yoffs:3,xpad:.467773,sc:.625,w:9,h:9},{c:7484,x0:2023,y0:506,yoffs:8,xpad:3.26758,sc:.625,w:6,h:4},{c:7485,x0:5,y0:561,yoffs:8,xpad:2.92578,sc:.625,w:6,h:4},{c:7486,x0:22,y0:561,yoffs:8,xpad:2.31445,sc:.625,w:5,h:4},{c:7487,x0:38,y0:561,yoffs:8,xpad:2.69043,sc:.625,w:5,h:4},{c:7488,x0:54,y0:561,yoffs:8,xpad:1.73828,sc:.625,w:5,h:4},{c:7489,x0:70,y0:559,yoffs:8,xpad:2.80371,sc:.625,w:6,h:4},{c:7490,x0:87,y0:559,yoffs:8,xpad:3.27441,sc:.625,w:8,h:4},{c:7491,x0:417,y0:547,yoffs:9,xpad:3.0459,sc:.625,w:4,h:3},{c:7492,x0:432,y0:547,yoffs:9,xpad:2.0459,sc:.625,w:5,h:3},{c:7493,x0:448,y0:546,yoffs:9,xpad:2.36816,sc:.625,w:5,h:3},{c:7494,x0:464,y0:546,yoffs:9,xpad:3.68359,sc:.625,w:7,h:3},{c:7495,x0:106,y0:559,yoffs:8,xpad:2.36816,sc:.625,w:5,h:4},{c:7496,x0:122,y0:559,yoffs:8,xpad:2.36816,sc:.625,w:5,h:4},{c:7497,x0:482,y0:546,yoffs:9,xpad:1.88477,sc:.625,w:5,h:3},{c:7498,x0:498,y0:546,yoffs:9,xpad:1.88477,sc:.625,w:5,h:3},{c:7499,x0:514,y0:546,yoffs:9,xpad:2.46973,sc:.625,w:4,h:3},{c:7500,x0:529,y0:544,yoffs:9,xpad:2.20117,sc:.625,w:4,h:3},{c:7501,x0:1154,y0:515,yoffs:9,xpad:2.36816,sc:.625,w:5,h:5},{c:7502,x0:1170,y0:515,yoffs:9,xpad:1.5498,sc:.625,w:2,h:5},{c:7503,x0:138,y0:559,yoffs:8,xpad:2.22656,sc:.625,w:5,h:4},{c:7504,x0:544,y0:544,yoffs:9,xpad:4.43555,sc:.625,w:7,h:3},{c:7505,x0:1183,y0:515,yoffs:9,xpad:2.65625,sc:.625,w:5,h:5},{c:7506,x0:562,y0:544,yoffs:9,xpad:2.20703,sc:.625,w:5,h:3},{c:7507,x0:578,y0:543,yoffs:9,xpad:1.98633,sc:.625,w:4,h:3},{c:7508,xpad:7.20703,sc:.625},{c:7509,xpad:7.20703,sc:.625},{c:7510,x0:1199,y0:515,yoffs:9,xpad:2.36816,sc:.625,w:5,h:5},{c:7511,x0:154,y0:559,yoffs:8,xpad:2.05371,sc:.625,w:3,h:4},{c:7512,x0:593,y0:543,yoffs:9,xpad:2.65625,sc:.625,w:5,h:3},{c:7513,x0:907,y0:538,yoffs:9,xpad:2.31445,sc:.625,w:5,h:2},{c:7514,x0:609,y0:543,yoffs:9,xpad:4.43555,sc:.625,w:7,h:3},{c:7515,x0:627,y0:543,yoffs:9,xpad:1.63086,sc:.625,w:5,h:3},{c:7516,x0:643,y0:542,yoffs:9,xpad:2.00586,sc:.625,w:4,h:3},{c:7517,x0:718,y0:522,yoffs:8,xpad:2.69043,sc:.625,w:5,h:6},{c:7518,x0:1215,y0:515,yoffs:9,xpad:1.61621,sc:.625,w:5,h:5},{c:7519,x0:168,y0:559,yoffs:8,xpad:2.20703,sc:.625,w:5,h:4},{c:7520,x0:1231,y0:515,yoffs:9,xpad:3.2334,sc:.625,w:6,h:5},{c:7521,x0:1248,y0:515,yoffs:9,xpad:1.9043,sc:.625,w:5,h:5},{c:7522,x0:734,y0:522,yoffs:12,xpad:1.5498,sc:.625,w:2,h:6},{c:7523,x0:1264,y0:515,yoffs:13,xpad:1.28809,sc:.625,w:4,h:5},{c:7524,x0:1279,y0:514,yoffs:13,xpad:2.65625,sc:.625,w:5,h:5},{c:7525,x0:1295,y0:514,yoffs:13,xpad:1.63086,sc:.625,w:5,h:5},{c:7526,x0:518,y0:526,yoffs:12,xpad:2.69043,sc:.625,w:5,h:7},{c:7527,x0:747,y0:522,yoffs:13,xpad:1.61621,sc:.625,w:5,h:6},{c:7528,x0:763,y0:521,yoffs:13,xpad:2.20703,sc:.625,w:5,h:6},{c:7529,x0:779,y0:521,yoffs:13,xpad:3.2334,sc:.625,w:6,h:6},{c:7530,x0:796,y0:521,yoffs:13,xpad:1.08008,sc:.625,w:6,h:6},{c:7531,x0:1381,y0:492,yoffs:6,xpad:.373047,sc:.625,w:17,h:11},{c:7532,x0:1118,y0:346,yoffs:2,sc:.625,w:13,h:15},{c:7533,x0:1142,y0:346,yoffs:2,sc:.625,w:13,h:15},{c:7534,x0:1166,y0:346,yoffs:2,sc:.625,w:9,h:15},{c:7535,x0:1409,y0:490,yoffs:6,sc:.625,w:20,h:11},{c:7536,x0:1440,y0:490,yoffs:6,sc:.625,w:14,h:11},{c:7537,x0:1186,y0:346,yoffs:6,sc:.625,w:13,h:15},{c:7538,x0:1465,y0:490,yoffs:6,sc:.625,w:10,h:11},{c:7539,x0:1486,y0:490,yoffs:6,sc:.625,w:9,h:11},{c:7540,x0:1506,y0:490,yoffs:6,sc:.625,w:11,h:11},{c:7541,x0:1528,y0:444,yoffs:4,sc:.625,w:9,h:13},{c:7542,x0:1528,y0:490,yoffs:6,sc:.625,w:9,h:11},{c:7543,x0:1210,y0:346,yoffs:2,xpad:.347656,sc:.625,w:11,h:15},{c:7544,x0:658,y0:542,yoffs:9,xpad:2.70996,sc:.625,w:5,h:3},{c:7545,x0:1232,y0:345,yoffs:6,xpad:.146484,sc:.625,w:10,h:15},{c:7546,x0:263,y0:303,yoffs:2,xpad:.560547,sc:.625,w:19,h:16},{c:7547,x0:1548,y0:490,yoffs:6,sc:.625,w:7,h:11},{c:7548,x0:1566,y0:490,yoffs:6,xpad:.294922,sc:.625,w:7,h:11},{c:7549,x0:1253,y0:345,yoffs:6,sc:.625,w:12,h:15},{c:7550,x0:1584,y0:490,yoffs:6,sc:.625,w:12,h:11},{c:7551,x0:1607,y0:490,yoffs:6,sc:.625,w:12,h:11},{c:7680,x0:1292,y0:119,yoffs:3,sc:.625,w:13,h:19},{c:7681,x0:293,y0:302,yoffs:6,xpad:.830078,sc:.625,w:10,h:16},{c:7682,x0:380,y0:188,yoffs:-1,xpad:.0458984,sc:.625,w:12,h:18},{c:7683,x0:1276,y0:345,yoffs:2,xpad:.347656,sc:.625,w:11,h:15},{c:7684,x0:1315,y0:208,yoffs:3,xpad:.0458984,sc:.625,w:12,h:17},{c:7685,x0:403,y0:188,yoffs:2,xpad:.347656,sc:.625,w:11,h:18},{c:7686,x0:1338,y0:207,yoffs:3,xpad:.0458984,sc:.625,w:12,h:17},{c:7687,x0:425,y0:187,yoffs:2,xpad:.347656,sc:.625,w:11,h:18},{c:7688,x0:973,y0:89,yoffs:-1,xpad:.420898,sc:.625,w:11,h:22},{c:7689,x0:1316,y0:119,yoffs:2,xpad:.213867,sc:.625,w:9,h:19},{c:7690,x0:447,y0:187,yoffs:-1,xpad:.266602,sc:.625,w:13,h:18},{c:7691,x0:1298,y0:345,yoffs:2,xpad:1.34766,sc:.625,w:10,h:15},{c:7692,x0:1361,y0:207,yoffs:3,xpad:.266602,sc:.625,w:13,h:17},{c:7693,x0:471,y0:187,yoffs:2,xpad:1.34766,sc:.625,w:10,h:18},{c:7694,x0:1385,y0:207,yoffs:3,xpad:.266602,sc:.625,w:13,h:17},{c:7695,x0:492,y0:187,yoffs:2,xpad:1.34766,sc:.625,w:10,h:18},{c:7696,x0:513,y0:187,yoffs:3,xpad:.266602,sc:.625,w:13,h:18},{c:7697,x0:1336,y0:119,yoffs:2,xpad:1.34766,sc:.625,w:10,h:19},{c:7698,x0:1409,y0:207,yoffs:3,xpad:.266602,sc:.625,w:13,h:17},{c:7699,x0:537,y0:185,yoffs:2,xpad:1.34766,sc:.625,w:10,h:18},{c:7700,x0:1429,y0:88,yoffs:-3,xpad:1.03906,sc:.625,w:9,h:20},{c:7701,x0:1433,y0:207,xpad:.595703,sc:.625,w:10,h:17},{c:7702,x0:1449,y0:88,yoffs:-3,xpad:1.03906,sc:.625,w:9,h:20},{c:7703,x0:1454,y0:207,xpad:.595703,sc:.625,w:10,h:17},{c:7704,x0:1475,y0:207,yoffs:3,xpad:.0390625,sc:.625,w:10,h:17},{c:7705,x0:1089,y0:422,yoffs:6,xpad:.595703,sc:.625,w:10,h:14},{c:7706,x0:1496,y0:207,yoffs:3,xpad:1.03906,sc:.625,w:9,h:17},{c:7707,x0:1110,y0:422,yoffs:6,xpad:.595703,sc:.625,w:10,h:14},{c:7708,x0:995,y0:89,yoffs:-1,xpad:1.03906,sc:.625,w:9,h:22},{c:7709,x0:1357,y0:119,yoffs:2,xpad:.595703,sc:.625,w:10,h:19},{c:7710,x0:558,y0:184,yoffs:-1,xpad:.84375,sc:.625,w:9,h:18},{c:7711,x0:578,y0:184,yoffs:-1,sc:.625,w:8,h:18},{c:7712,x0:1516,y0:206,xpad:.978516,sc:.625,w:12,h:17},{c:7713,x0:597,y0:184,yoffs:3,xpad:1.34766,sc:.625,w:10,h:18},{c:7714,x0:618,y0:184,yoffs:-1,xpad:.71582,sc:.625,w:13,h:18},{c:7715,x0:1378,y0:119,yoffs:-2,xpad:.777344,sc:.625,w:11,h:19},{c:7716,x0:1539,y0:204,yoffs:3,xpad:.71582,sc:.625,w:13,h:17},{c:7717,x0:642,y0:183,yoffs:2,xpad:.777344,sc:.625,w:11,h:18},{c:7718,x0:664,y0:183,yoffs:-1,xpad:.71582,sc:.625,w:13,h:18},{c:7719,x0:1400,y0:119,yoffs:-2,xpad:.0117188,sc:.625,w:12,h:19},{c:7720,x0:688,y0:183,yoffs:3,xpad:.71582,sc:.625,w:13,h:18},{c:7721,x0:1423,y0:119,yoffs:2,xpad:.777344,sc:.625,w:11,h:19},{c:7722,x0:712,y0:183,yoffs:3,xpad:.71582,sc:.625,w:13,h:18},{c:7723,x0:1445,y0:119,yoffs:2,xpad:.777344,sc:.625,w:11,h:19},{c:7724,x0:1563,y0:204,yoffs:3,sc:.625,w:9,h:17},{c:7725,x0:736,y0:183,yoffs:2,sc:.625,w:8,h:18},{c:7726,x0:1469,y0:87,yoffs:-3,sc:.625,w:7,h:20},{c:7727,x0:1583,y0:204,sc:.625,w:8,h:17},{c:7728,x0:755,y0:183,yoffs:-1,sc:.625,w:12,h:18},{c:7729,x0:1467,y0:119,yoffs:-2,sc:.625,w:12,h:19},{c:7730,x0:1602,y0:204,yoffs:3,sc:.625,w:12,h:17},{c:7731,x0:778,y0:182,yoffs:2,sc:.625,w:12,h:18},{c:7732,x0:1625,y0:204,yoffs:3,sc:.625,w:12,h:17},{c:7733,x0:801,y0:182,yoffs:2,sc:.625,w:12,h:18},{c:7734,x0:1648,y0:204,yoffs:3,xpad:.126953,sc:.625,w:10,h:17},{c:7735,x0:824,y0:182,yoffs:2,xpad:.46875,sc:.625,w:5,h:18},{c:7736,x0:1487,y0:87,sc:.625,w:11,h:20},{c:7737,x0:1206,y0:89,yoffs:-1,sc:.625,w:7,h:21},{c:7738,x0:1669,y0:204,yoffs:3,xpad:.126953,sc:.625,w:10,h:17},{c:7739,x0:840,y0:182,yoffs:2,sc:.625,w:7,h:18},{c:7740,x0:1690,y0:204,yoffs:3,xpad:.126953,sc:.625,w:10,h:17},{c:7741,x0:858,y0:182,yoffs:2,sc:.625,w:9,h:18},{c:7742,x0:1490,y0:118,yoffs:-2,xpad:.770508,sc:.625,w:14,h:19},{c:7743,x0:1711,y0:204,xpad:.674805,sc:.625,w:16,h:17},{c:7744,x0:878,y0:182,yoffs:-1,xpad:.904297,sc:.625,w:16,h:18},{c:7745,x0:1319,y0:345,yoffs:2,xpad:.602539,sc:.625,w:17,h:15},{c:7746,x0:1738,y0:204,yoffs:3,xpad:.904297,sc:.625,w:16,h:17},{c:7747,x0:1131,y0:422,yoffs:6,xpad:.602539,sc:.625,w:17,h:14},{c:7748,x0:905,y0:181,yoffs:-1,xpad:1.5752,sc:.625,w:13,h:18},{c:7749,x0:1347,y0:343,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:7750,x0:1765,y0:204,yoffs:3,xpad:1.5752,sc:.625,w:13,h:17},{c:7751,x0:1159,y0:422,yoffs:6,xpad:.777344,sc:.625,w:11,h:14},{c:7752,x0:1789,y0:204,yoffs:3,xpad:1.5752,sc:.625,w:13,h:17},{c:7753,x0:1181,y0:422,yoffs:6,xpad:.777344,sc:.625,w:11,h:14},{c:7754,x0:1813,y0:202,yoffs:3,xpad:1.5752,sc:.625,w:13,h:17},{c:7755,x0:1203,y0:422,yoffs:6,xpad:.777344,sc:.625,w:11,h:14},{c:7756,x0:1509,y0:85,yoffs:-3,xpad:.272461,sc:.625,w:14,h:20},{c:7757,x0:1837,y0:202,xpad:.0986328,sc:.625,w:11,h:17},{c:7758,x0:1534,y0:85,yoffs:-3,xpad:.272461,sc:.625,w:14,h:20},{c:7759,x0:1859,y0:202,xpad:.0986328,sc:.625,w:11,h:17},{c:7760,x0:1559,y0:85,yoffs:-3,xpad:.272461,sc:.625,w:14,h:20},{c:7761,x0:1881,y0:202,xpad:.0986328,sc:.625,w:11,h:17},{c:7762,x0:1584,y0:85,yoffs:-3,xpad:.272461,sc:.625,w:14,h:20},{c:7763,x0:1903,y0:202,xpad:.0986328,sc:.625,w:11,h:17},{c:7764,x0:929,y0:181,yoffs:-1,xpad:.259766,sc:.625,w:11,h:18},{c:7765,x0:1515,y0:116,yoffs:2,xpad:.347656,sc:.625,w:11,h:19},{c:7766,x0:951,y0:181,yoffs:-1,xpad:.259766,sc:.625,w:11,h:18},{c:7767,x0:1537,y0:116,yoffs:2,xpad:.347656,sc:.625,w:11,h:19},{c:7768,x0:973,y0:181,yoffs:-1,sc:.625,w:12,h:18},{c:7769,x0:1369,y0:343,yoffs:2,xpad:.139648,sc:.625,w:8,h:15},{c:7770,x0:1925,y0:202,yoffs:3,sc:.625,w:12,h:17},{c:7771,x0:1225,y0:422,yoffs:6,xpad:.139648,sc:.625,w:8,h:14},{c:7772,x0:1609,y0:85,sc:.625,w:12,h:20},{c:7773,x0:1948,y0:202,yoffs:3,xpad:.139648,sc:.625,w:8,h:17},{c:7774,x0:1967,y0:202,yoffs:3,sc:.625,w:12,h:17},{c:7775,x0:1244,y0:421,yoffs:6,xpad:.139648,sc:.625,w:8,h:14},{c:7776,x0:996,y0:181,yoffs:-1,sc:.625,w:10,h:18},{c:7777,x0:1388,y0:343,yoffs:2,sc:.625,w:9,h:15},{c:7778,x0:1990,y0:202,yoffs:3,sc:.625,w:10,h:17},{c:7779,x0:1263,y0:421,yoffs:6,sc:.625,w:9,h:14},{c:7780,x0:1017,y0:181,yoffs:-1,sc:.625,w:10,h:18},{c:7781,x0:1408,y0:343,yoffs:2,sc:.625,w:9,h:15},{c:7782,x0:1632,y0:85,yoffs:-3,sc:.625,w:10,h:20},{c:7783,x0:2011,y0:202,sc:.625,w:9,h:17},{c:7784,x0:1224,y0:89,yoffs:-1,sc:.625,w:10,h:21},{c:7785,x0:1038,y0:181,yoffs:2,sc:.625,w:9,h:18},{c:7786,x0:1058,y0:181,yoffs:-1,sc:.625,w:11,h:18},{c:7787,x0:2031,y0:202,sc:.625,w:8,h:17},{c:7788,x0:5,y0:257,yoffs:3,sc:.625,w:11,h:17},{c:7789,x0:314,y0:302,yoffs:4,sc:.625,w:8,h:16},{c:7790,x0:27,y0:257,yoffs:3,sc:.625,w:11,h:17},{c:7791,x0:333,y0:302,yoffs:4,sc:.625,w:8,h:16},{c:7792,x0:49,y0:257,yoffs:3,sc:.625,w:11,h:17},{c:7793,x0:71,y0:257,yoffs:4,sc:.625,w:9,h:17},{c:7794,x0:1080,y0:181,yoffs:-1,xpad:.554688,sc:.625,w:13,h:18},{c:7795,x0:1428,y0:343,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:7796,x0:1104,y0:181,yoffs:-1,xpad:.554688,sc:.625,w:13,h:18},{c:7797,x0:1450,y0:343,yoffs:2,xpad:.777344,sc:.625,w:11,h:15},{c:7798,x0:91,y0:257,yoffs:3,xpad:.554688,sc:.625,w:13,h:17},{c:7799,x0:1472,y0:343,yoffs:6,xpad:.777344,sc:.625,w:11,h:15},{c:7800,x0:1653,y0:85,yoffs:-3,xpad:.554688,sc:.625,w:13,h:20},{c:7801,x0:115,y0:250,xpad:.777344,sc:.625,w:11,h:17},{c:7802,x0:1677,y0:85,yoffs:-3,xpad:.554688,sc:.625,w:13,h:20},{c:7803,x0:137,y0:250,xpad:.777344,sc:.625,w:11,h:17},{c:7804,x0:1128,y0:181,yoffs:-1,sc:.625,w:12,h:18},{c:7805,x0:1494,y0:343,yoffs:2,sc:.625,w:11,h:15},{c:7806,x0:159,y0:250,yoffs:3,sc:.625,w:12,h:17},{c:7807,x0:1283,y0:421,yoffs:6,sc:.625,w:11,h:14},{c:7808,x0:1151,y0:180,yoffs:-1,sc:.625,w:14,h:18},{c:7809,x0:352,y0:302,yoffs:1,sc:.625,w:11,h:16},{c:7810,x0:1176,y0:180,yoffs:-1,sc:.625,w:14,h:18},{c:7811,x0:374,y0:302,yoffs:1,sc:.625,w:11,h:16},{c:7812,x0:1201,y0:180,yoffs:-1,sc:.625,w:14,h:18},{c:7813,x0:1516,y0:343,yoffs:2,sc:.625,w:11,h:15},{c:7814,x0:1226,y0:180,yoffs:-1,sc:.625,w:18,h:18},{c:7815,x0:1538,y0:343,yoffs:2,sc:.625,w:16,h:15},{c:7816,x0:182,y0:247,yoffs:3,sc:.625,w:18,h:17},{c:7817,x0:1305,y0:421,yoffs:6,sc:.625,w:16,h:14},{c:7818,x0:1255,y0:180,yoffs:-1,sc:.625,w:12,h:18},{c:7819,x0:1565,y0:343,yoffs:2,sc:.625,w:11,h:15},{c:7820,x0:1278,y0:179,yoffs:-1,sc:.625,w:12,h:18},{c:7821,x0:1587,y0:342,yoffs:2,sc:.625,w:11,h:15},{c:7822,x0:1301,y0:179,yoffs:-1,sc:.625,w:12,h:18},{c:7823,x0:1559,y0:116,yoffs:2,sc:.625,w:11,h:19},{c:7824,x0:1324,y0:178,yoffs:-1,xpad:.380859,sc:.625,w:10,h:18},{c:7825,x0:1609,y0:340,yoffs:2,sc:.625,w:9,h:15},{c:7826,x0:211,y0:247,yoffs:3,xpad:.380859,sc:.625,w:10,h:17},{c:7827,x0:1332,y0:421,yoffs:6,sc:.625,w:9,h:14},{c:7828,x0:232,y0:247,yoffs:3,xpad:.380859,sc:.625,w:10,h:17},{c:7829,x0:1352,y0:421,yoffs:6,sc:.625,w:9,h:14},{c:7830,x0:1345,y0:178,yoffs:2,xpad:.777344,sc:.625,w:11,h:18},{c:7831,x0:253,y0:247,sc:.625,w:8,h:17},{c:7832,x0:396,y0:302,yoffs:1,sc:.625,w:16,h:16},{c:7833,x0:1701,y0:85,yoffs:1,sc:.625,w:11,h:20},{c:7834,x0:423,y0:301,yoffs:1,xpad:.830078,sc:.625,w:10,h:16},{c:7835,x0:1367,y0:178,yoffs:-1,sc:.625,w:8,h:18},{c:7836,x0:1629,y0:340,yoffs:2,sc:.625,w:9,h:15},{c:7837,x0:1649,y0:340,yoffs:2,sc:.625,w:8,h:15},{c:7838,x0:1372,y0:419,yoffs:3,sc:.625,w:14,h:14},{c:7839,x0:1668,y0:340,yoffs:2,xpad:.0986328,sc:.625,w:11,h:15},{c:7840,x0:1386,y0:178,yoffs:3,sc:.625,w:13,h:18},{c:7841,x0:1690,y0:340,yoffs:6,xpad:1.22461,sc:.625,w:9,h:15},{c:7842,x0:1581,y0:116,yoffs:-2,sc:.625,w:13,h:19},{c:7843,x0:272,y0:246,xpad:1.22461,sc:.625,w:9,h:17},{c:7844,x0:1605,y0:116,yoffs:-2,sc:.625,w:13,h:19},{c:7845,x0:292,y0:246,sc:.625,w:11,h:17},{c:7846,x0:1629,y0:116,yoffs:-2,sc:.625,w:13,h:19},{c:7847,x0:314,y0:246,xpad:1.22461,sc:.625,w:9,h:17},{c:7848,x0:1653,y0:116,yoffs:-2,sc:.625,w:13,h:19},{c:7849,x0:334,y0:246,sc:.625,w:11,h:17},{c:7850,x0:1723,y0:85,yoffs:-3,sc:.625,w:13,h:20},{c:7851,x0:1410,y0:178,yoffs:-1,xpad:1.22461,sc:.625,w:9,h:18},{c:7852,x0:1015,y0:89,yoffs:-1,sc:.625,w:13,h:22},{c:7853,x0:1747,y0:85,yoffs:1,xpad:1.22461,sc:.625,w:9,h:20},{c:7854,x0:1767,y0:84,yoffs:-3,sc:.625,w:13,h:20},{c:7855,x0:1430,y0:178,yoffs:-1,xpad:1.22461,sc:.625,w:9,h:18},{c:7856,x0:1791,y0:84,yoffs:-3,sc:.625,w:13,h:20},{c:7857,x0:1450,y0:178,yoffs:-1,xpad:1.22461,sc:.625,w:9,h:18},{c:7858,x0:1815,y0:84,yoffs:-3,sc:.625,w:13,h:20},{c:7859,x0:1677,y0:116,yoffs:-2,xpad:1.22461,sc:.625,w:9,h:19},{c:7860,x0:1839,y0:84,yoffs:-3,sc:.625,w:13,h:20},{c:7861,x0:1470,y0:178,yoffs:-1,xpad:1.22461,sc:.625,w:9,h:18},{c:7862,x0:1039,y0:89,yoffs:-1,sc:.625,w:13,h:22},{c:7863,x0:1863,y0:84,yoffs:1,xpad:1.22461,sc:.625,w:9,h:20},{c:7864,x0:1490,y0:178,yoffs:3,xpad:.639648,sc:.625,w:10,h:18},{c:7865,x0:1710,y0:340,yoffs:6,xpad:.0488281,sc:.625,w:10,h:15},{c:7866,x0:1697,y0:116,yoffs:-2,xpad:.639648,sc:.625,w:10,h:19},{c:7867,x0:356,y0:246,xpad:.0488281,sc:.625,w:10,h:17},{c:7868,x0:1511,y0:177,yoffs:-1,xpad:.639648,sc:.625,w:10,h:18},{c:7869,x0:444,y0:301,yoffs:1,xpad:.0488281,sc:.625,w:10,h:16},{c:7870,x0:1718,y0:116,yoffs:-2,sc:.625,w:11,h:19},{c:7871,x0:377,y0:245,sc:.625,w:11,h:17},{c:7872,x0:1740,y0:116,yoffs:-2,xpad:.639648,sc:.625,w:10,h:19},{c:7873,x0:399,y0:245,sc:.625,w:11,h:17},{c:7874,x0:1761,y0:116,yoffs:-2,sc:.625,w:11,h:19},{c:7875,x0:421,y0:245,sc:.625,w:11,h:17},{c:7876,x0:1883,y0:84,yoffs:-3,xpad:.639648,sc:.625,w:10,h:20},{c:7877,x0:1532,y0:175,yoffs:-1,xpad:.0488281,sc:.625,w:10,h:18},{c:7878,x0:1063,y0:89,yoffs:-1,xpad:.639648,sc:.625,w:10,h:22},{c:7879,x0:1904,y0:84,yoffs:1,xpad:.0488281,sc:.625,w:10,h:20},{c:7880,x0:1783,y0:115,yoffs:-2,xpad:.708008,sc:.625,w:5,h:19},{c:7881,x0:443,y0:244,xpad:.258789,sc:.625,w:5,h:17},{c:7882,x0:1553,y0:175,yoffs:3,xpad:.708008,sc:.625,w:5,h:18},{c:7883,x0:1799,y0:115,yoffs:2,xpad:.258789,sc:.625,w:5,h:19},{c:7884,x0:1569,y0:175,yoffs:3,xpad:.320313,sc:.625,w:13,h:18},{c:7885,x0:1731,y0:340,yoffs:6,sc:.625,w:11,h:15},{c:7886,x0:1815,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7887,x0:459,y0:244,sc:.625,w:11,h:17},{c:7888,x0:1839,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7889,x0:481,y0:244,sc:.625,w:11,h:17},{c:7890,x0:1863,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7891,x0:503,y0:244,sc:.625,w:11,h:17},{c:7892,x0:1887,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7893,x0:525,y0:244,sc:.625,w:11,h:17},{c:7894,x0:1925,y0:84,yoffs:-3,xpad:.320313,sc:.625,w:13,h:20},{c:7895,x0:1593,y0:175,yoffs:-1,sc:.625,w:11,h:18},{c:7896,x0:1084,y0:89,yoffs:-1,xpad:.320313,sc:.625,w:13,h:22},{c:7897,x0:1949,y0:84,yoffs:1,sc:.625,w:11,h:20},{c:7898,x0:1911,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7899,x0:547,y0:244,sc:.625,w:11,h:17},{c:7900,x0:1935,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7901,x0:569,y0:242,sc:.625,w:11,h:17},{c:7902,x0:1959,y0:115,yoffs:-2,xpad:.320313,sc:.625,w:13,h:19},{c:7903,x0:591,y0:241,sc:.625,w:11,h:17},{c:7904,x0:1615,y0:175,yoffs:-1,xpad:.320313,sc:.625,w:13,h:18},{c:7905,x0:465,y0:300,yoffs:1,sc:.625,w:11,h:16},{c:7906,x0:1245,y0:88,xpad:.320313,sc:.625,w:13,h:21},{c:7907,x0:1983,y0:115,yoffs:2,sc:.625,w:11,h:19},{c:7908,x0:1639,y0:175,yoffs:3,xpad:.939453,sc:.625,w:12,h:18},{c:7909,x0:1753,y0:340,yoffs:6,xpad:1.02051,sc:.625,w:10,h:15},{c:7910,x0:2005,y0:115,yoffs:-2,xpad:.939453,sc:.625,w:12,h:19},{c:7911,x0:613,y0:241,xpad:1.02051,sc:.625,w:10,h:17},{c:7912,x0:2028,y0:115,yoffs:-2,sc:.625,w:14,h:19},{c:7913,x0:634,y0:241,sc:.625,w:12,h:17},{c:7914,x0:5,y0:170,yoffs:-2,sc:.625,w:14,h:19},{c:7915,x0:657,y0:240,sc:.625,w:12,h:17},{c:7916,x0:30,y0:170,yoffs:-2,sc:.625,w:14,h:19},{c:7917,x0:680,y0:240,sc:.625,w:12,h:17},{c:7918,x0:1662,y0:175,yoffs:-1,sc:.625,w:14,h:18},{c:7919,x0:487,y0:300,yoffs:1,sc:.625,w:12,h:16},{c:7920,x0:1108,y0:89,yoffs:-1,sc:.625,w:14,h:22},{c:7921,x0:55,y0:170,yoffs:2,sc:.625,w:12,h:19},{c:7922,x0:1687,y0:175,yoffs:-1,sc:.625,w:9,h:18},{c:7923,x0:78,y0:163,yoffs:1,sc:.625,w:8,h:19},{c:7924,x0:1707,y0:175,yoffs:3,sc:.625,w:12,h:18},{c:7925,x0:1774,y0:340,yoffs:6,sc:.625,w:10,h:15},{c:7926,x0:97,y0:163,yoffs:-2,sc:.625,w:12,h:19},{c:7927,x0:1269,y0:88,sc:.625,w:10,h:21},{c:7928,x0:1730,y0:175,yoffs:-1,sc:.625,w:12,h:18},{c:7929,x0:1971,y0:84,yoffs:1,sc:.625,w:10,h:20},{c:7930,x0:1397,y0:419,yoffs:3,xpad:.415039,sc:.625,w:15,h:14},{c:7931,x0:1795,y0:340,yoffs:2,sc:.625,w:11,h:15},{c:7932,x0:1423,y0:419,yoffs:3,xpad:.408203,sc:.625,w:13,h:14},{c:7933,x0:1817,y0:340,yoffs:2,sc:.625,w:11,h:15},{c:7934,x0:1447,y0:419,yoffs:3,sc:.625,w:12,h:14},{c:7935,x0:1839,y0:340,yoffs:6,sc:.625,w:12,h:15},{c:8192,xpad:8.96484,sc:.625},{c:8193,xpad:17.9248,sc:.625},{c:8194,xpad:8.64746,sc:.625},{c:8195,xpad:17.2949,sc:.625},{c:8196,xpad:5.97168,sc:.625},{c:8197,xpad:4.48242,sc:.625},{c:8198,xpad:2.99316,sc:.625},{c:8199,xpad:10.2539,sc:.625},{c:8200,xpad:5.10742,sc:.625},{c:8201,xpad:3.58398,sc:.625},{c:8202,xpad:1.79199,sc:.625},{c:8203,sc:.625},{c:8208,x0:923,y0:537,yoffs:9,xpad:6.29492,sc:.625,w:11,h:2},{c:8209,x0:674,y0:540,yoffs:10,xpad:.401367,sc:.625,w:6,h:3},{c:8210,x0:691,y0:540,yoffs:10,xpad:.428711,sc:.625,w:9,h:3},{c:8211,x0:711,y0:540,yoffs:9,sc:.625,w:8,h:3},{c:8212,x0:730,y0:539,yoffs:9,sc:.625,w:15,h:3},{c:8213,x0:730,y0:539,yoffs:9,sc:.625,w:15,h:3},{c:8214,x0:120,y0:163,xpad:6.29492,sc:.625,w:11,h:19},{c:8215,x0:1311,y0:514,yoffs:16,sc:.625,w:9,h:5},{c:8216,x0:1331,y0:514,yoffs:2,xpad:.121094,sc:.625,w:4,h:5},{c:8217,x0:1346,y0:514,yoffs:2,xpad:.121094,sc:.625,w:4,h:5},{c:8218,x0:1361,y0:514,yoffs:14,xpad:1.12109,sc:.625,w:3,h:5},{c:8219,x0:1375,y0:514,yoffs:3,sc:.625,w:4,h:5},{c:8220,x0:1390,y0:514,yoffs:2,xpad:.241211,sc:.625,w:7,h:5},{c:8221,x0:1408,y0:514,yoffs:2,xpad:.22168,sc:.625,w:7,h:5},{c:8222,x0:1426,y0:512,yoffs:14,xpad:.22168,sc:.625,w:7,h:5},{c:8223,x0:1444,y0:512,yoffs:3,sc:.625,w:8,h:5},{c:8224,x0:510,y0:300,yoffs:3,xpad:.0947266,sc:.625,w:7,h:16},{c:8225,x0:528,y0:300,yoffs:3,xpad:.0947266,sc:.625,w:7,h:16},{c:8226,x0:1463,y0:512,yoffs:7,xpad:.0595703,sc:.625,w:6,h:5},{c:8227,x0:534,y0:526,yoffs:6,sc:.625,w:7,h:7},{c:8228,x0:184,y0:559,yoffs:13,xpad:1.96484,sc:.625,w:7,h:4},{c:8229,x0:202,y0:559,yoffs:8,xpad:2.29492,sc:.625,w:15,h:4},{c:8230,x0:756,y0:539,yoffs:14,xpad:1.08789,sc:.625,w:14,h:3},{c:8231,x0:228,y0:552,yoffs:8,xpad:6.29492,sc:.625,w:11,h:4},{c:8232,xpad:10.7568,sc:.625},{c:8233,xpad:10.7568,sc:.625},{c:8239,xpad:3.58398,sc:.625},{c:8240,x0:1470,y0:419,yoffs:3,sc:.625,w:17,h:14},{c:8241,x0:1498,y0:419,yoffs:3,sc:.625,w:30,h:14},{c:8242,x0:552,y0:526,yoffs:2,xpad:.620117,sc:.625,w:5,h:7},{c:8243,x0:568,y0:525,yoffs:2,xpad:.946289,sc:.625,w:9,h:7},{c:8244,x0:813,y0:521,yoffs:3,sc:.625,w:14,h:6},{c:8245,x0:250,y0:552,yoffs:-1,xpad:6.29492,sc:.625,w:11,h:4},{c:8246,x0:838,y0:521,yoffs:3,xpad:1.52832,sc:.625,w:10,h:6},{c:8247,x0:859,y0:521,yoffs:3,xpad:1.48828,sc:.625,w:14,h:6},{c:8248,x0:588,y0:525,yoffs:14,xpad:.172852,sc:.625,w:7,h:7},{c:8249,x0:1916,y0:487,yoffs:6,sc:.625,w:5,h:10},{c:8250,x0:1932,y0:485,yoffs:6,sc:.625,w:5,h:10},{c:8251,x0:1548,y0:444,yoffs:3,xpad:2.29492,sc:.625,w:15,h:13},{c:8252,x0:1539,y0:419,yoffs:3,xpad:.708984,sc:.625,w:11,h:14},{c:8253,x0:1561,y0:419,yoffs:3,sc:.625,w:9,h:14},{c:8254,x0:781,y0:538,sc:.625,w:11,h:3},{c:8255,x0:1480,y0:512,yoffs:16,sc:.625,w:11,h:5},{c:8256,x0:272,y0:551,yoffs:2,sc:.625,w:11,h:4},{c:8257,x0:123,y0:494,yoffs:9,sc:.625,w:8,h:12},{c:8258,x0:1862,y0:338,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:8259,x0:803,y0:538,yoffs:10,sc:.625,w:6,h:3},{c:8260,x0:1581,y0:419,yoffs:3,sc:.625,w:8,h:14},{c:8261,x0:703,y0:240,yoffs:3,sc:.625,w:6,h:17},{c:8262,x0:720,y0:240,yoffs:3,xpad:.932617,sc:.625,w:5,h:17},{c:8263,x0:1889,y0:338,yoffs:2,xpad:.831055,sc:.625,w:16,h:15},{c:8264,x0:1916,y0:338,yoffs:2,xpad:1.35547,sc:.625,w:13,h:15},{c:8265,x0:1940,y0:338,yoffs:2,xpad:.355469,sc:.625,w:14,h:15},{c:8266,x0:1630,y0:490,yoffs:6,xpad:.756836,sc:.625,w:10,h:11},{c:8267,x0:736,y0:240,yoffs:2,xpad:.743164,sc:.625,w:11,h:17},{c:8268,x0:1948,y0:485,yoffs:6,xpad:.743164,sc:.625,w:11,h:10},{c:8269,x0:1970,y0:485,yoffs:6,xpad:.743164,sc:.625,w:11,h:10},{c:8270,x0:146,y0:539,yoffs:11,sc:.625,w:10,h:9},{c:8271,x0:1574,y0:444,yoffs:6,xpad:.107422,sc:.625,w:5,h:13},{c:8272,x0:142,y0:161,yoffs:2,sc:.625,w:11,h:19},{c:8273,x0:1965,y0:338,yoffs:2,xpad:5.29492,sc:.625,w:12,h:15},{c:8274,x0:1600,y0:419,yoffs:3,sc:.625,w:8,h:14},{c:8275,x0:294,y0:551,yoffs:9,sc:.625,w:18,h:4},{c:8276,x0:1502,y0:512,yoffs:16,sc:.625,w:11,h:5},{c:8277,x0:1992,y0:485,yoffs:7,xpad:.0390625,sc:.625,w:10,h:10},{c:8278,x0:1619,y0:418,yoffs:3,xpad:.380859,sc:.625,w:10,h:14},{c:8279,x0:884,y0:521,yoffs:3,xpad:1.33984,sc:.625,w:17,h:6},{c:8280,x0:1640,y0:416,yoffs:3,xpad:.649414,sc:.625,w:15,h:14},{c:8281,x0:1666,y0:416,yoffs:3,xpad:.649414,sc:.625,w:15,h:14},{c:8282,x0:1692,y0:416,yoffs:3,xpad:.107422,sc:.625,w:5,h:14},{c:8283,x0:1988,y0:338,yoffs:2,xpad:.421875,sc:.625,w:12,h:15},{c:8284,x0:2011,y0:338,yoffs:2,xpad:.292969,sc:.625,w:15,h:15},{c:8285,x0:2037,y0:311,yoffs:2,xpad:.107422,sc:.625,w:5,h:15},{c:8286,x0:1708,y0:416,yoffs:3,xpad:.107422,sc:.625,w:5,h:14},{c:8287,xpad:10.7568,sc:.625},{c:8288,xpad:10.7568,sc:.625},{c:8289,xpad:10.7568,sc:.625},{c:8290,xpad:10.7568,sc:.625},{c:8291,xpad:10.7568,sc:.625},{c:8292,xpad:10.7568,sc:.625},{c:8294,sc:.625},{c:8295,sc:.625},{c:8296,sc:.625},{c:8297,sc:.625},{c:8304,x0:343,y0:529,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8305,x0:323,y0:548,yoffs:8,xpad:1.5498,sc:.625,w:2,h:4},{c:8308,x0:359,y0:529,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8309,x0:375,y0:529,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8310,x0:391,y0:529,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8311,x0:407,y0:528,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8312,x0:423,y0:528,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8313,x0:439,y0:527,yoffs:3,xpad:.170898,sc:.625,w:5,h:8},{c:8314,x0:912,y0:520,yoffs:5,xpad:.435547,sc:.625,w:6,h:6},{c:8315,x0:945,y0:537,yoffs:7,xpad:.435547,sc:.625,w:6,h:2},{c:8316,x0:336,y0:548,yoffs:6,xpad:.435547,sc:.625,w:6,h:4},{c:8317,x0:1651,y0:490,yoffs:2,xpad:.335938,sc:.625,w:4,h:11},{c:8318,x0:1666,y0:487,yoffs:2,xpad:.335938,sc:.625,w:4,h:11},{c:8319,x0:820,y0:538,yoffs:9,xpad:2.65625,sc:.625,w:5,h:3},{c:8320,x0:167,y0:539,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8321,x0:455,y0:527,yoffs:9,xpad:1.1709,sc:.625,w:4,h:8},{c:8322,x0:183,y0:539,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8323,x0:199,y0:539,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8324,x0:470,y0:527,yoffs:9,xpad:.170898,sc:.625,w:5,h:8},{c:8325,x0:486,y0:527,yoffs:9,xpad:.170898,sc:.625,w:5,h:8},{c:8326,x0:215,y0:532,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8327,x0:502,y0:527,yoffs:9,xpad:.170898,sc:.625,w:5,h:8},{c:8328,x0:231,y0:532,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8329,x0:247,y0:532,yoffs:8,xpad:.170898,sc:.625,w:5,h:9},{c:8330,x0:929,y0:520,yoffs:13,xpad:.435547,sc:.625,w:6,h:6},{c:8331,x0:962,y0:536,yoffs:15,xpad:.435547,sc:.625,w:6,h:2},{c:8332,x0:1524,y0:512,yoffs:13,xpad:.435547,sc:.625,w:6,h:5},{c:8333,x0:1681,y0:487,yoffs:9,xpad:.335938,sc:.625,w:4,h:11},{c:8334,x0:1696,y0:487,yoffs:9,xpad:.335938,sc:.625,w:4,h:11},{c:8336,x0:1541,y0:512,yoffs:13,xpad:3.0459,sc:.625,w:4,h:5},{c:8337,x0:1556,y0:512,yoffs:13,xpad:1.88477,sc:.625,w:5,h:5},{c:8338,x0:1572,y0:512,yoffs:13,xpad:2.20703,sc:.625,w:5,h:5},{c:8339,x0:1588,y0:512,yoffs:13,xpad:1.73828,sc:.625,w:5,h:5},{c:8340,x0:1604,y0:512,yoffs:13,xpad:1.88477,sc:.625,w:5,h:5},{c:8341,x0:946,y0:519,yoffs:12,xpad:2.65625,sc:.625,w:5,h:6},{c:8342,x0:962,y0:519,yoffs:12,xpad:2.22656,sc:.625,w:5,h:6},{c:8343,x0:978,y0:519,yoffs:12,xpad:1.5498,sc:.625,w:2,h:6},{c:8344,x0:1620,y0:512,yoffs:13,xpad:4.43555,sc:.625,w:7,h:5},{c:8345,x0:1638,y0:512,yoffs:13,xpad:2.65625,sc:.625,w:5,h:5},{c:8346,x0:991,y0:518,yoffs:13,xpad:2.36816,sc:.625,w:5,h:6},{c:8347,x0:1654,y0:512,yoffs:13,xpad:1.79102,sc:.625,w:4,h:5},{c:8348,x0:1007,y0:517,yoffs:12,xpad:1.05371,sc:.625,w:4,h:6},{c:8352,x0:1724,y0:416,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8353,x0:546,y0:300,yoffs:2,sc:.625,w:11,h:16},{c:8354,x0:1745,y0:416,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8355,x0:1766,y0:416,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8356,x0:1787,y0:416,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8357,x0:5,y0:393,yoffs:4,xpad:.602539,sc:.625,w:17,h:15},{c:8358,x0:1808,y0:416,yoffs:3,sc:.625,w:11,h:14},{c:8359,x0:1830,y0:416,yoffs:3,sc:.625,w:16,h:14},{c:8360,x0:1857,y0:416,yoffs:3,xpad:.420898,sc:.625,w:16,h:14},{c:8361,x0:1884,y0:414,yoffs:3,sc:.625,w:12,h:14},{c:8362,x0:1907,y0:414,yoffs:3,xpad:1.47461,sc:.625,w:15,h:14},{c:8363,x0:1933,y0:414,yoffs:3,xpad:.19043,sc:.625,w:10,h:14},{c:8364,x0:1954,y0:414,yoffs:3,sc:.625,w:8,h:14},{c:8365,x0:1973,y0:414,yoffs:3,sc:.625,w:11,h:14},{c:8366,x0:1995,y0:414,yoffs:3,sc:.625,w:8,h:14},{c:8367,x0:1753,y0:175,yoffs:3,xpad:.105469,sc:.625,w:18,h:18},{c:8368,x0:1782,y0:175,yoffs:3,xpad:.9375,sc:.625,w:10,h:18},{c:8369,x0:2014,y0:414,yoffs:3,sc:.625,w:11,h:14},{c:8370,x0:568,y0:300,yoffs:2,xpad:1.15918,sc:.625,w:12,h:16},{c:8371,x0:5,y0:469,yoffs:3,sc:.625,w:12,h:14},{c:8372,x0:28,y0:469,yoffs:3,sc:.625,w:8,h:14},{c:8373,x0:591,y0:298,yoffs:2,xpad:.420898,sc:.625,w:11,h:16},{c:8374,x0:1590,y0:444,yoffs:4,xpad:.475586,sc:.625,w:12,h:13},{c:8375,x0:33,y0:393,yoffs:3,xpad:.105469,sc:.625,w:13,h:15},{c:8376,x0:47,y0:469,yoffs:3,sc:.625,w:11,h:14},{c:8377,x0:69,y0:469,yoffs:3,sc:.625,w:9,h:14},{c:8378,x0:89,y0:469,yoffs:3,xpad:.253906,sc:.625,w:10,h:14},{c:8379,x0:110,y0:469,yoffs:3,sc:.625,w:15,h:14},{c:8380,x0:136,y0:469,yoffs:3,xpad:.668945,sc:.625,w:15,h:14},{c:8381,x0:162,y0:469,yoffs:3,sc:.625,w:11,h:14},{c:8382,x0:613,y0:298,yoffs:1,xpad:.274414,sc:.625,w:11,h:16},{c:8383,x0:758,y0:240,yoffs:1,xpad:.253906,sc:.625,w:10,h:17},{c:8482,x0:606,y0:525,yoffs:3,xpad:.582031,sc:.625,w:11,h:7},{c:8592,x0:793,y0:53,yoffs:4,w:22,h:23},{c:8593,x0:227,y0:95,yoffs:5,w:23,h:21},{c:8594,x0:832,y0:53,yoffs:4,w:22,h:23},{c:8595,x0:267,y0:95,yoffs:5,w:23,h:21},{c:8596,x0:307,y0:95,yoffs:6,w:33,h:20},{c:8597,x0:51,y0:8,w:21,h:32},{c:8598,x0:357,y0:95,yoffs:6,w:20,h:20},{c:8599,x0:394,y0:94,yoffs:6,w:20,h:20},{c:8600,x0:431,y0:94,yoffs:6,w:20,h:20},{c:8601,x0:468,y0:94,yoffs:6,w:20,h:20},{c:8722,x0:979,y0:536,yoffs:10,sc:.625,w:8,h:2},{c:8734,x0:1995,y0:87,yoffs:11,xpad:.6875,w:25,h:14},{c:9654,x0:142,y0:494,yoffs:4,sc:.625,w:11,h:12},{c:9660,x0:1711,y0:487,yoffs:4,sc:.625,w:12,h:11},{c:9733,x0:635,y0:297,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:9742,x0:67,y0:57,yoffs:4,w:31,h:24},{c:9743,x0:115,y0:55,yoffs:4,w:31,h:24},{c:9830,x0:1098,y0:8,yoffs:2,w:17,h:28},{c:9864,x0:1132,y0:8,yoffs:2,w:28,h:28},{c:9889,x0:1444,y0:8,yoffs:3,w:20,h:26},{c:10003,x0:1177,y0:8,w:29,h:28},{c:10697,x0:163,y0:55,yoffs:4,w:24,h:24},{c:12353,x0:184,y0:462,yoffs:4,xpad:2.29492,sc:.625,w:15,h:14},{c:12354,x0:663,y0:297,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12355,x0:1734,y0:487,yoffs:6,xpad:1.29492,sc:.625,w:16,h:11},{c:12356,x0:210,y0:462,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12357,x0:238,y0:462,yoffs:4,xpad:3.29492,sc:.625,w:14,h:14},{c:12358,x0:690,y0:296,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12359,x0:263,y0:459,yoffs:4,xpad:2.29492,sc:.625,w:15,h:14},{c:12360,x0:716,y0:296,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12361,x0:1613,y0:444,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12362,x0:57,y0:393,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12363,x0:85,y0:393,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12364,x0:779,y0:240,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12365,x0:743,y0:296,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12366,x0:807,y0:239,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12367,x0:770,y0:296,yoffs:2,xpad:3.29492,sc:.625,w:14,h:16},{c:12368,x0:795,y0:296,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12369,x0:822,y0:296,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12370,x0:835,y0:239,yoffs:1,sc:.625,w:18,h:17},{c:12371,x0:289,y0:459,yoffs:3,xpad:2.29492,sc:.625,w:15,h:14},{c:12372,x0:864,y0:239,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12373,x0:849,y0:295,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12374,x0:892,y0:239,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12375,x0:875,y0:295,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12376,x0:902,y0:294,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12377,x0:929,y0:293,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12378,x0:920,y0:238,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12379,x0:113,y0:393,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12380,x0:957,y0:293,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12381,x0:985,y0:293,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12382,x0:1012,y0:293,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12383,x0:140,y0:393,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12384,x0:1039,y0:293,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12385,x0:1067,y0:293,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12386,x0:948,y0:238,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12387,x0:2013,y0:485,yoffs:7,xpad:1.29492,sc:.625,w:16,h:10},{c:12388,x0:1640,y0:441,yoffs:4,xpad:1.29492,sc:.625,w:16,h:13},{c:12389,x0:1093,y0:293,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12390,x0:315,y0:459,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12391,x0:342,y0:459,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12392,x0:167,y0:386,yoffs:2,xpad:2.29492,sc:.625,w:15,h:15},{c:12393,x0:976,y0:238,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12394,x0:1121,y0:293,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12395,x0:193,y0:386,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12396,x0:220,y0:386,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12397,x0:248,y0:383,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12398,x0:370,y0:458,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12399,x0:276,y0:383,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12400,x0:1004,y0:238,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12401,x0:1032,y0:238,yoffs:1,sc:.625,w:18,h:17},{c:12402,x0:304,y0:383,yoffs:3,xpad:.294922,sc:.625,w:17,h:15},{c:12403,x0:1061,y0:238,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12404,x0:1089,y0:238,yoffs:1,sc:.625,w:18,h:17},{c:12405,x0:332,y0:382,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12406,x0:1149,y0:293,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12407,x0:1177,y0:293,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12408,x0:164,y0:494,yoffs:4,xpad:.294922,sc:.625,w:17,h:12},{c:12409,x0:397,y0:458,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12410,x0:425,y0:458,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12411,x0:360,y0:382,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12412,x0:1118,y0:238,yoffs:1,sc:.625,w:18,h:17},{c:12413,x0:1147,y0:238,yoffs:1,sc:.625,w:18,h:17},{c:12414,x0:1205,y0:292,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12415,x0:1232,y0:292,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12416,x0:1260,y0:292,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12417,x0:1288,y0:292,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12418,x0:1315,y0:292,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12419,x0:453,y0:458,yoffs:4,xpad:2.29492,sc:.625,w:15,h:14},{c:12420,x0:1176,y0:237,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12421,x0:1667,y0:441,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12422,x0:1342,y0:290,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12423,x0:1693,y0:441,yoffs:5,xpad:3.29492,sc:.625,w:14,h:13},{c:12424,x0:1369,y0:290,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12425,x0:1396,y0:290,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12426,x0:1423,y0:290,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12427,x0:1449,y0:290,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12428,x0:388,y0:382,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12429,x0:1476,y0:290,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12430,x0:1718,y0:441,yoffs:4,xpad:1.29492,sc:.625,w:16,h:13},{c:12431,x0:416,y0:382,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12432,x0:1503,y0:290,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12433,x0:1530,y0:290,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12434,x0:1558,y0:289,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12435,x0:1585,y0:287,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12436,x0:1613,y0:287,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12437,x0:1745,y0:441,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12438,x0:1772,y0:441,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12441,x0:1669,y0:509,yoffs:1,xpad:11.2949,sc:.625,w:6,h:5},{c:12442,x0:1022,y0:517,yoffs:1,xpad:12.2949,sc:.625,w:5,h:6},{c:12443,x0:1669,y0:509,yoffs:1,xpad:11.2949,sc:.625,w:6,h:5},{c:12444,x0:1022,y0:517,yoffs:1,xpad:12.2949,sc:.625,w:5,h:6},{c:12445,x0:192,y0:487,yoffs:4,xpad:3.29492,sc:.625,w:14,h:12},{c:12446,x0:1799,y0:441,yoffs:3,xpad:2.29492,sc:.625,w:15,h:13},{c:12447,x0:1204,y0:237,yoffs:1,xpad:1.29492,sc:.625,w:16,h:17},{c:12448,x0:1686,y0:509,yoffs:7,xpad:4.29492,sc:.625,w:13,h:5},{c:12449,x0:217,y0:487,yoffs:6,xpad:1.29492,sc:.625,w:16,h:12},{c:12450,x0:444,y0:382,yoffs:3,xpad:.294922,sc:.625,w:17,h:15},{c:12451,x0:1825,y0:441,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12452,x0:472,y0:381,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12453,x0:1851,y0:441,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12454,x0:1641,y0:287,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12455,x0:1761,y0:487,yoffs:6,xpad:2.29492,sc:.625,w:15,h:11},{c:12456,x0:244,y0:487,yoffs:4,xpad:1.29492,sc:.625,w:16,h:12},{c:12457,x0:1877,y0:441,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12458,x0:499,y0:380,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12459,x0:526,y0:380,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12460,x0:1231,y0:237,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12461,x0:1668,y0:287,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12462,x0:1259,y0:237,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12463,x0:1287,y0:237,yoffs:1,xpad:1.29492,sc:.625,w:16,h:17},{c:12464,x0:1314,y0:236,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12465,x0:1695,y0:287,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12466,x0:1342,y0:235,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12467,x0:479,y0:458,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12468,x0:1370,y0:235,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12469,x0:1722,y0:287,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12470,x0:1750,y0:287,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12471,x0:1778,y0:287,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12472,x0:1806,y0:287,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12473,x0:506,y0:457,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12474,x0:1398,y0:235,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12475,x0:553,y0:380,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12476,x0:1426,y0:235,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12477,x0:533,y0:456,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12478,x0:1454,y0:235,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12479,x0:1482,y0:235,yoffs:1,xpad:1.29492,sc:.625,w:16,h:17},{c:12480,x0:1509,y0:235,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12481,x0:1834,y0:285,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12482,x0:1862,y0:285,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12483,x0:1904,y0:439,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12484,x0:1890,y0:285,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12485,x0:1537,y0:234,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12486,x0:1918,y0:285,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12487,x0:1565,y0:232,yoffs:1,sc:.625,w:18,h:17},{c:12488,x0:580,y0:380,yoffs:2,xpad:1.29492,sc:.625,w:16,h:15},{c:12489,x0:1946,y0:285,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12490,x0:1973,y0:285,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12491,x0:271,y0:484,yoffs:4,xpad:1.29492,sc:.625,w:16,h:12},{c:12492,x0:607,y0:380,yoffs:3,xpad:2.29492,sc:.625,w:15,h:15},{c:12493,x0:2001,y0:285,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12494,x0:633,y0:378,yoffs:2,xpad:2.29492,sc:.625,w:15,h:15},{c:12495,x0:560,y0:456,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12496,x0:5,y0:340,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12497,x0:33,y0:340,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12498,x0:659,y0:377,yoffs:2,xpad:2.29492,sc:.625,w:15,h:15},{c:12499,x0:61,y0:340,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12500,x0:89,y0:340,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12501,x0:588,y0:456,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12502,x0:1594,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12503,x0:1622,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12504,x0:298,y0:484,yoffs:4,xpad:.294922,sc:.625,w:17,h:12},{c:12505,x0:615,y0:456,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12506,x0:643,y0:454,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12507,x0:117,y0:340,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12508,x0:1650,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12509,x0:1678,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12510,x0:685,y0:377,yoffs:3,xpad:.294922,sc:.625,w:17,h:15},{c:12511,x0:145,y0:333,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:12512,x0:713,y0:376,yoffs:2,xpad:.294922,sc:.625,w:17,h:15},{c:12513,x0:171,y0:333,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12514,x0:671,y0:454,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12515,x0:1931,y0:439,yoffs:5,xpad:1.29492,sc:.625,w:16,h:13},{c:12516,x0:198,y0:333,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12517,x0:5,y0:540,yoffs:7,xpad:2.29492,sc:.625,w:15,h:10},{c:12518,x0:326,y0:484,yoffs:4,xpad:.294922,sc:.625,w:17,h:12},{c:12519,x0:354,y0:484,yoffs:6,xpad:3.29492,sc:.625,w:14,h:12},{c:12520,x0:698,y0:453,yoffs:3,xpad:2.29492,sc:.625,w:15,h:14},{c:12521,x0:226,y0:330,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:12522,x0:253,y0:330,yoffs:2,xpad:3.29492,sc:.625,w:14,h:16},{c:12523,x0:278,y0:330,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12524,x0:724,y0:452,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12525,x0:752,y0:452,yoffs:3,xpad:1.29492,sc:.625,w:16,h:14},{c:12526,x0:379,y0:483,yoffs:6,xpad:2.29492,sc:.625,w:15,h:12},{c:12527,x0:741,y0:376,yoffs:3,xpad:1.29492,sc:.625,w:16,h:15},{c:12528,x0:306,y0:329,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:12529,x0:1958,y0:439,yoffs:3,xpad:.294922,sc:.625,w:17,h:13},{c:12530,x0:768,y0:376,yoffs:3,xpad:1.29492,sc:.625,w:16,h:15},{c:12531,x0:779,y0:452,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:12532,x0:1706,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12533,x0:1986,y0:439,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12534,x0:2012,y0:439,yoffs:5,xpad:2.29492,sc:.625,w:15,h:13},{c:12535,x0:1734,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12536,x0:1762,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12537,x0:334,y0:329,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:12538,x0:1790,y0:232,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:12539,x0:1710,y0:509,yoffs:7,xpad:6.29492,sc:.625,w:11,h:5},{c:12540,x0:836,y0:538,yoffs:8,xpad:1.29492,sc:.625,w:16,h:3},{c:12541,x0:31,y0:540,yoffs:5,xpad:3.29492,sc:.625,w:14,h:10},{c:12542,x0:405,y0:483,yoffs:3,xpad:2.29492,sc:.625,w:15,h:12},{c:12543,x0:362,y0:329,yoffs:2,xpad:3.29492,sc:.625,w:14,h:16},{c:19968,x0:863,y0:538,yoffs:8,xpad:.294922,sc:.625,w:17,h:3},{c:19971,x0:1818,y0:230,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:19977,x0:807,y0:452,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:19978,x0:387,y0:329,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:19979,x0:415,y0:329,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:20061,x0:1846,y0:230,yoffs:1,sc:.625,w:18,h:17},{c:20108,x0:835,y0:452,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:20116,x0:863,y0:451,yoffs:3,xpad:.294922,sc:.625,w:17,h:14},{c:20196,x0:1875,y0:230,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:20843,x0:443,y0:328,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:20845,x0:1903,y0:230,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:20934,x0:1931,y0:230,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:20998,x0:1959,y0:230,yoffs:1,sc:.625,w:18,h:17},{c:21271,x0:1988,y0:230,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:21313,x0:2016,y0:230,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:21320,x0:5,y0:285,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:21335,x0:33,y0:285,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:21608,x0:471,y0:327,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:22235,x0:795,y0:376,yoffs:3,xpad:1.29492,sc:.625,w:16,h:15},{c:22303,x0:498,y0:327,yoffs:1,xpad:.294922,sc:.625,w:17,h:16},{c:22799,x0:526,y0:327,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:22826,x0:61,y0:285,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:24179,x0:554,y0:327,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:24180,x0:89,y0:285,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:26085,x0:582,y0:327,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:26102,x0:117,y0:278,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:26143,x0:608,y0:325,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:26178,x0:145,y0:278,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:26332,x0:636,y0:324,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:26376,x0:664,y0:324,yoffs:2,xpad:2.29492,sc:.625,w:15,h:16},{c:26399,x0:173,y0:278,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:26408,x0:201,y0:275,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:26481,x0:229,y0:275,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:26631,x0:257,y0:275,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:27161,x0:285,y0:274,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:27700,x0:313,y0:274,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:27915,x0:341,y0:274,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:28310,x0:369,y0:274,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:28779,x0:397,y0:273,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:31186,x0:425,y0:273,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:32654,x0:453,y0:272,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:35199,x0:690,y0:323,yoffs:2,xpad:.294922,sc:.625,w:17,h:16},{c:37329,x0:481,y0:272,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:38291,x0:718,y0:323,yoffs:2,xpad:1.29492,sc:.625,w:16,h:16},{c:38388,x0:509,y0:272,yoffs:1,xpad:.294922,sc:.625,w:17,h:17},{c:44228,x0:537,y0:272,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:44552,x0:745,y0:323,yoffs:2,sc:.625,w:16,h:16},{c:45380,x0:563,y0:272,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:47785,x0:772,y0:323,yoffs:2,sc:.625,w:16,h:16},{c:48120,x0:589,y0:270,yoffs:1,xpad:1.91309,sc:.625,w:14,h:17},{c:48516,x0:799,y0:323,yoffs:2,sc:.625,w:16,h:16},{c:49688,x0:826,y0:323,yoffs:2,sc:.625,w:16,h:16},{c:49884,x0:614,y0:269,yoffs:1,xpad:1.91309,sc:.625,w:14,h:17},{c:50577,x0:639,y0:269,yoffs:1,sc:.625,w:16,h:17},{c:50724,x0:891,y0:451,yoffs:2,sc:.625,w:16,h:14},{c:50836,x0:918,y0:450,yoffs:2,sc:.625,w:16,h:14},{c:50900,x0:666,y0:268,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:51068,x0:692,y0:268,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:51204,x0:718,y0:268,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:51456,x0:853,y0:322,yoffs:2,sc:.625,w:16,h:16},{c:52488,x0:822,y0:376,yoffs:1,sc:.625,w:16,h:15},{c:53468,x0:744,y0:268,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:53664,x0:945,y0:449,yoffs:2,sc:.625,w:16,h:14},{c:54217,x0:770,y0:268,yoffs:1,xpad:.913086,sc:.625,w:15,h:17},{c:54364,x0:5,y0:494,yoffs:3,sc:.625,w:16,h:13},{c:54616,x0:796,y0:268,yoffs:1,sc:.625,w:16,h:17},{c:54868,x0:823,y0:267,yoffs:1,sc:.625,w:16,h:17},{c:54980,x0:850,y0:267,yoffs:1,sc:.625,w:16,h:17},{c:65024,sc:.625},{c:65533,x0:972,y0:448,yoffs:3,sc:.625,w:13,h:14}]}},{}],108:[function(e,t,r){"use strict"
r.iapProviderEnabled=iapProviderEnabled
r.iapGetAnyEnabledProvider=iapGetAnyEnabledProvider
r.iapProductPrice=iapProductPrice
r.iapStartPurchase=iapStartPurchase
r.iapConsumePurchase=iapConsumePurchase
r.iapSyncPurchases=iapSyncPurchases
r.iapSetupProviderClient=iapSetupProviderClient
r.iapClearProvidersClients=iapClearProvidersClients
r.IapClientFake=void 0
var o=e("../../common/in_app_purchases/iap_common").IAP_PROVIDER_FAKE
var a=function(){function IapClientFake(){}var e=IapClientFake.prototype
e.init=function init(e){e()}
e.getProvider=function getProvider(){return o}
e.enabled=function enabled(){return true}
e.fetchProducts=function fetchProducts(e){e()}
e.getProductPrice=function getProductPrice(e){return{amount:0,currency:"USD",formatted:"USD $0.00"}}
e.startPurchase=function startPurchase(e,t,r){var a=Date.now()
var i=(""+a+Math.random()).replace(/[^0-9A-Za-z]/g,"")
r(null,{provider:o,product_id:e,purchase_id:i,validation_data:JSON.stringify({product_id:e,purchase_id:i,timestamp:a,developer_payload:t})})}
e.consumePurchase=function consumePurchase(e,t,r){if(r)r()}
e.syncPurchases=function syncPurchases(e){e(null,[])}
return IapClientFake}()
r.IapClientFake=a
var i={}
function getClient(e){var t=i[e]
if(!t)throw new Error("Provider client not found: "+e+" "+t)
return t}function iapProviderEnabled(e){var t=i[e]
return t&&t.enabled()||false}function iapGetAnyEnabledProvider(){for(var e in i){var t=i[e]
if(t&&t.enabled())return e}return}function iapProductPrice(e,t){return getClient(e).getProductPrice(t)}function iapStartPurchase(e,t,r,a){getClient(e).startPurchase(t,r,a)}function iapConsumePurchase(e,t,r,a){getClient(e).consumePurchase(t,r,a)}function iapSyncPurchases(e,t){getClient(e).syncPurchases(t)}function iapSetupProviderClient(e,t){(i[e.getProvider()]=e).init(t)}function iapClearProvidersClients(){i={}}},{"../../common/in_app_purchases/iap_common":250}],109:[function(e,t,r){"use strict"
r.IapClientDiscord=r.IAP_PROVIDER_DISCORD=void 0
function _createForOfIteratorHelperLoose(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]
if(r)return(r=r.call(e)).next.bind(r)
if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"===typeof e.length){if(r)e=r
var a=0
return function(){if(a>=e.length)return{done:true}
return{done:false,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return
if("string"===typeof e)return _arrayLikeToArray(e,t)
var r=Object.prototype.toString.call(e).slice(8,-1)
if("Object"===r&&e.constructor)r=e.constructor.name
if("Map"===r||"Set"===r)return Array.from(e)
if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(null==t||t>e.length)t=e.length
for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r]
return a}var o=e("assert")
var a=e("../../glov/client/local_storage").localStorageGetJSON
var s=e("../../glov/common/external_users_common").ERR_UNAUTHORIZED
var i=e("../../glov/common/util")
var n=i.errorString
var l=i.nop
var _=i.unpromisify
var c=e("../../common/in_app_purchases/iap_common")
var u=c.ERR_IAP_DISABLED
var d=c.ERR_IAP_USER_CANCELED
var f=c.ERR_INVALID_DATA
var v=c.ERR_NOT_AVAILABLE
var h=e("../external_users/external_users_client_frvr").LOCAL_STORAGE_AUTH_TOKENS_KEY
var p=e("../frvr_sdk_worlds").frvrOnInitialized
var m=e("../mobile_util").isMobile
var E=e("./iap_client_worlds").iapFormatPrice
var g="discord"
r.IAP_PROVIDER_DISCORD=g
var T=function(){function IapClientDiscord(){this.is_enabled=false
this.catalog={}}var e=IapClientDiscord.prototype
e.init=function init(t){var r=this
t=_(t)
if(!window.discordSDK||!window.FRVR||!FRVR.iap)return t(u)
if(m())return t(u)
p(function(e){if(!e||!FRVR.iap.isReady()){t(u)
return}return r.fetchProducts(t)})}
e.parseApiError=function parseApiError(e){return e.message||n(e)}
e.getProvider=function getProvider(){return g}
e.enabled=function enabled(){return this.is_enabled}
e.fetchProducts=function fetchProducts(e){e=_(e)
var t=FRVR.iap.getCatalog()
if(t)for(var r=0,a=Object.values(t);r<a.length;r++){var i=a[r]
var o=FRVR.iap.getProductById(i.storeId)
if(o&&o.productId)this.catalog[o.productId]={amount:o.priceValue,currency:o.currencyCode,formatted:E(o.priceValue,o.currencyCode)}
this.is_enabled=true}e()}
e.getProductPrice=function getProductPrice(e){return this.catalog[e]}
e.startPurchase=function startPurchase(e,t,r){var a,i=this
if(!this.is_enabled)return void r(v)
r=_(r)
var o=null==(a=FRVR.auth)?void 0:a.getAccessToken()
if(!o)return r(s)
FRVR.iap.purchase(e).then(function(e){r(null,{provider:g,product_id:e.productId,purchase_id:e.purchaseId,validation_data:JSON.stringify({access_token:o,transaction_receipt:e.transactionReceipt}),consume_purchase_data:JSON.stringify(e)})},function(e){var t
if(e&&"Purchase was canceled by the user."===(null==(t=e.cause)?void 0:t.message))return r(d)
r(i.parseApiError(e))})}
e.consumePurchase=function consumePurchase(e,t,r){var a=this
o(this.is_enabled)
o(t)
r=r?_(r):l
var i
try{i=JSON.parse(t)}catch(e){return r(f)}FRVR.iap.consumePurchase(i).then(function(){r()},function(e){console.warn("[discord] Failed to properly consume purchase",e)
r(a.parseApiError(e))})}
e.syncPurchases=function syncPurchases(o){var t=this
o=_(o)
if(!this.is_enabled)return void o(v)
var e=a(h)
var n=null==e?void 0:e.accessToken
if(!n)return o(s)
FRVR.iap.getUnconsumedPurchases().then(function(e){var t=[]
for(var r,a=_createForOfIteratorHelperLoose(e);!(r=a()).done;){var i=r.value
t.push({provider:g,product_id:i.productId,purchase_id:i.purchaseId,validation_data:JSON.stringify({access_token:n,transaction_receipt:i.transactionReceipt}),consume_purchase_data:JSON.stringify(i)})}o(null,t)},function(e){o(t.parseApiError(e))})}
return IapClientDiscord}()
r.IapClientDiscord=T},{"../../common/in_app_purchases/iap_common":250,"../../glov/client/local_storage":329,"../../glov/common/external_users_common":387,"../../glov/common/util":400,"../external_users/external_users_client_frvr":92,"../frvr_sdk_worlds":102,"../mobile_util":144,"./iap_client_worlds":111,assert:void 0}],110:[function(e,t,r){"use strict"
r.IapClientFacebookInstant=r.IAP_PROVIDER_FACEBOOK_INSTANT=void 0
var i=e("assert")
var a=e("../../glov/common/util")
var o=a.errorString
var n=a.nop
var s=a.unpromisify
var l=e("../../common/in_app_purchases/iap_common")
var _=l.ERR_IAP_DISABLED
var c=l.ERR_IAP_USER_CANCELED
var u=l.ERR_NOT_AVAILABLE
var d=e("./iap_client_worlds").iapFormatPrice
var f="fbi"
r.IAP_PROVIDER_FACEBOOK_INSTANT=f
var v=function(){function IapClientFacebookInstant(){this.is_enabled=false
this.catalog={}}var e=IapClientFacebookInstant.prototype
e.init=function init(t){var e=this
t=s(t)
if(!window.FBInstant||-1===FBInstant.getSupportedAPIs().indexOf("payments.purchaseAsync"))return t(_)
FBInstant.payments.onReady(function(){e.fetchProducts(function(e){t(e)})})}
e.parseApiError=function parseApiError(e){return"USER_INPUT"===e.code?c:e.message||o(e)}
e.getProvider=function getProvider(){return f}
e.enabled=function enabled(){return this.is_enabled}
e.fetchProducts=function fetchProducts(t){var r=this
t=s(t)
FBInstant.payments.getCatalogAsync().then(s(function(e){r.catalog={}
if(e){e.forEach(function(e){var t=e.priceAmount
if("number"===typeof t)r.catalog[e.productID]={amount:t,currency:e.priceCurrencyCode,formatted:d(t,e.priceCurrencyCode)}})
r.is_enabled=true}t()}),function(e){return t(r.parseApiError(e))})}
e.getProductPrice=function getProductPrice(e){return this.catalog[e]}
e.startPurchase=function startPurchase(e,t,r){var a=this
if(!this.is_enabled)return void r(u)
r=s(r)
FBInstant.payments.purchaseAsync({productID:e,developerPayload:t}).then(function(e){return r(null,{provider:f,product_id:e.productID,purchase_id:e.paymentID,validation_data:e.signedRequest,consume_purchase_data:e.purchaseToken})},function(e){return r(a.parseApiError(e))})}
e.consumePurchase=function consumePurchase(e,t,r){var a=this
i(this.is_enabled)
i(t)
r=r?s(r):n
FBInstant.payments.consumePurchaseAsync(t).then(function(){return r()},function(e){return r(a.parseApiError(e))})}
e.syncPurchases=function syncPurchases(t){var r=this
t=s(t)
if(!this.is_enabled)return void t(u)
FBInstant.payments.getPurchasesAsync().then(function(e){return t(null,(e||[]).map(function(e){return{provider:f,product_id:e.productID,purchase_id:e.paymentID,validation_data:e.signedRequest,consume_purchase_data:e.purchaseToken}}))},function(e){return t(r.parseApiError(e))})}
return IapClientFacebookInstant}()
r.IapClientFacebookInstant=v},{"../../common/in_app_purchases/iap_common":250,"../../glov/common/util":400,"./iap_client_worlds":111,assert:void 0}],111:[function(e,t,r){"use strict"
r.iapEnabled=iapEnabled
r.iapProductPrice=iapProductPrice
r.iapFormatPrice=iapFormatPrice
r.iapMakePurchase=iapMakePurchase
r.iapWorldsStartup=iapWorldsStartup
var _=e("assert")
var a=e("../../glov/client/cmds").cmd_parse
var i=e("../../glov/client/net")
var o=i.netDisconnected
var n=i.netDisconnectedRaw
var c=i.netSubs
var u=e("../../glov/client/ui")
var s=e("../../glov/common/external_users_common").ERR_UNAUTHORIZED
var l=e("../../glov/common/util")
var d=l.callEach
var f=l.nop
var v=e("../../common/globals").FAKE_PURCHASES
var h=e("../../common/in_app_purchases/iap_common")
var p=h.ERR_IAP_DISABLED
var m=h.ERR_IAP_USER_CANCELED
var E=h.IAP_PROVIDER_FAKE
var g=e("../../common/store_data")
var T=g.PRODUCT_ITEM_ID_GEM
var y=g.PRODUCT_ITEM_ID_ORB
var S=g.getProduct
var I=e("../analytics")
var A=I.getMenuContext
var w=I.iapEvent
var L=I.itemFlowEvent
var O=I.logEvent
var R=e("../app_access.js").accessFRVRAuth
var b=e("../localization/localization").L
var N=e("../platform_worlds_client")
var C=N.PLATFORM_ANDROID
var x=N.PLATFORM_DISCORD
var M=N.PLATFORM_FBINSTANT
var D=N.PLATFORM_IOS
var P=e("../show_first_offer").showFirstOfferOnIapAvailable
var B=e("../welcome_screen").getAccount
var k=e("../world_comm")
var U=k.getGemBalance
var G=k.getOrbBalance
var F=e("../worlds_sound").playSound
var W=e("./iap_client")
var H=W.IapClientFake
var z=W.iapClearProvidersClients
var V=W.iapConsumePurchase
var Y=W.iapGetAnyEnabledProvider
var j=W.iapProductPrice
var K=W.iapProviderEnabled
var q=W.iapSetupProviderClient
var Z=W.iapStartPurchase
var X=W.iapSyncPurchases
var Q=e("./iap_client_discord").IapClientDiscord
var $=e("./iap_client_facebook_instant").IapClientFacebookInstant
var J=e("./iap_client_xsolla")
var ee=J.IAP_PROVIDER_XSOLLA
var te=J.IapClientXsolla
function chooseProvider(e){return v?E:e||Y()}function applyPurchase(r,a){if(n()){a(b.ERR_DISCONNECTED.toString())
return}if(!c().loggedIn()){a(b.ERR_PURCHASE_NOT_LOGGED.toString())
return}var e=c().getMyUserChannel()
_(e)
var t={provider:r.provider,validation_data:r.validation_data}
e.send("purchase_external",t,function(e,t){if(e){a(e)
return}_(t)
V(r.provider,r.purchase_id,r.consume_purchase_data,a)})}function iapEnabled(e){if(B().is_anonymous)return false
e=chooseProvider(e)
return Boolean(e&&K(e))}function iapProductPrice(e,t){return void 0===(t=chooseProvider(t))?void 0:j(t,e)}function iapFormatPrice(t,r){r=r.toUpperCase()
var a
try{a=new Intl.NumberFormat(window.navigator.language||"en-US",{style:"currency",currency:r}).format(t)}catch(e){a=r+" "+t}if(a.startsWith("$"))a=r+" "+a
return a}var re=false
var ae=null
function notDuringPurchase(e){if(re){_(ae)
ae.push(e)}else e()}function iapMakePurchase(t,r,o){_(!re)
re=true
ae=[]
function cb(e,t){re=false
d(ae,ae=null)
if(r)r(e,t)}var n=U()
var s=G()
if(!c().loggedIn())return void cb(b.ERR_PURCHASE_NOT_LOGGED.toString())
if(!(o=chooseProvider(o))||!K(o))return void cb(b.ERR_PURCHASE_NOT_READY.toString())
u.modalDialog({title:b.DLG_INITIALIZING_PURCHASE_TITLE,text:b.MSG_PLEASE_WAIT})
var l=B()
function onceVerified(){_(o)
var a=S(t)
var e=o===ee?l.getEmail():void 0
var i=a&&j(o,t)
_(i)
w("iap_request_payment",a,o,i)
Z(o,t,e,function(e,t){if(e){u.modalDialogClear()
if(e!==m)u.modalDialog({title:b.DLG_ERROR_TITLE,text:b.DLG_PURCHASE_FAILED_PROCESS_MSG.$({error:e}),buttons:{ok:null}})
w("iap_request_payment_failed",a,o,i,e)
cb(e)
return}_(t)
var r={menu_context:A()}
w("iap_request_payment_success",a,o,i,void 0,t.purchase_id,r)
if(a.items[0].id===T)L("gem","source",a.items[0].amount,true,"gem_pack",n)
else if(a.items[0].id===y)L("orb","source",a.items[0].amount,true,"orb_pack",s)
applyPurchase(t,function(e){u.modalDialogClear()
if(!e)F("purchase")
u.modalDialog({title:e?b.DLG_ERROR_TITLE:b.DLG_PURCHASE_SUCCESSFUL_TITLE,text:e?b.DLG_PURCHASE_FAILED_SYNC_MSG.$({error:e}):b.DLG_PURCHASE_SUCCESSFUL_MSG,buttons:{ok:null}})
cb(e,t)})})}if(o===E||x)onceVerified()
else l.checkEmailVerified(function(e,t){if(e){u.modalDialog({title:b.DLG_ERROR_TITLE,text:b.DLG_PURCHASE_FAILED_PROCESS_MSG.$({error:e}),buttons:{ok:null}})
cb(e)}else if(!t)l.sendActivationEmail(l.getEmail(),function(e){if(e){u.modalDialog({title:b.DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE,text:e,buttons:{ok:null}})
return}u.modalDialog({title:b.LBL_CONFIRMATION_EMAIL_SENT,text:b.LBL_CONFIRMATION_EMAIL_REQUIRED_IAP+" "+b.LBL_CONFIRMATION_EMAIL_WILL_RECEIVE,buttons:{ok:null}})
cb(e)})
else onceVerified()})}function handleSyncPurchases(e,t){function logError(e){if(e)console.error("Error syncing purchases: "+e)}if(e){if(e!==s)logError(e)
return}_(t)
for(var r=0;r<t.length;r++)applyPurchase(t[r],logError)}function getIAPClient(r){if(v)return r(null,new H)
else if(M)return r(null,new $)
else if(C);else if(D);else if(x)return r(null,new Q)
else if(R()){var e=B()
var t=e.getEmail()
if(!t)return e.fetchExternalEmail(null,function(e,t){if(e||!t)return r("XSOLLA IAP NOT AVAILABLE: "+e+" "+t)
return r(null,new te)})
e.fetchExternalEmail(t,f)
return r(null,new te)}return r("NO CLIENT AVAILABLE")}var ie=1e4
var oe=true
function setupClients(){var a=false
z()
if(oe){setTimeout(function(){O("iap_available",void 0,void 0,iapProductPrice("orbs_s")?"yes":"no")},3e4)
oe=false}getIAPClient(function(e,t){if(e||!t)return console.log(e)
var r=function onClientSetup(e){if(e===p){console.warn("IAP client disabled for provider: "+t.getProvider())
return}else if(e){setTimeout(function(){if(o())onClientSetup("ERR_DISCONNECTED")
else t.init(onClientSetup)},ie)
return console.error("Error on IAP client setup: "+e)}notDuringPurchase(function(){X(t.getProvider(),handleSyncPurchases)})
if(!a){a=true
P()}}
q(t,r)})}function iapWorldsStartup(){c().onLogin(setupClients)}a.register({cmd:"make_purchase",access_show:["sysadmin"],help:"Trigger a purchase",func:function func(e,r){iapMakePurchase(e||"ctest",function(e,t){return r(e)})}})},{"../../common/globals":248,"../../common/in_app_purchases/iap_common":250,"../../common/store_data":262,"../../glov/client/cmds":298,"../../glov/client/net":338,"../../glov/client/ui":367,"../../glov/common/external_users_common":387,"../../glov/common/util":400,"../analytics":6,"../app_access.js":12,"../localization/localization":131,"../platform_worlds_client":160,"../show_first_offer":187,"../welcome_screen":224,"../world_comm":226,"../worlds_sound":236,"./iap_client":108,"./iap_client_discord":109,"./iap_client_facebook_instant":110,"./iap_client_xsolla":112,assert:void 0}],112:[function(e,t,r){"use strict"
r.IapClientXsolla=r.IAP_PROVIDER_XSOLLA=void 0
var s=e("assert")
var n=e("../../glov/client/engine")
var a=e("../../glov/client/environments").getCurrentEnvironment
var i=e("../../glov/client/input").inputTouchMode
var l=e("../../glov/client/local_storage").localStorageGetJSON
var _=e("../../glov/common/execute_with_retry").executeWithRetry
var o=e("../../glov/common/external_users_common")
var c=o.ERR_NOT_AVAILABLE
var u=o.ERR_UNAUTHORIZED
var d=e("../../glov/common/util").once
var f=e("../../common/globals").ENV_PRODUCTION
var v=e("../../common/in_app_purchases/iap_common").ERR_IAP_USER_CANCELED
var h=e("../external_users/external_users_client_frvr").LOCAL_STORAGE_AUTH_TOKENS_KEY
var p=e("./iap_client_worlds").iapFormatPrice
var m=e("./iap_xsolla_service").IAPXsollaService
var E="xsolla"
r.IAP_PROVIDER_XSOLLA=E
var g=4
var T=500
var y=1e4
function hideIframe(e){var t=document.getElementById("iframecontainer")
var r=document.getElementById("iframe")
if(!t||!r)return
t.style.display="none"
r.src="about:blank"
n.disableRender(false)
window.removeEventListener("message",e,false)}function showIframe(e,t,r){var a=document.getElementById("iframecontainer")
var i=document.getElementById("iframe")
var o=document.getElementById("iframecancel")
if(!a||!i||!o)return
a.style.display="block"
i.src=e
o.onclick=function(){hideIframe(r)
t(v)}
n.disableRender(true)
window.addEventListener("message",r,false)}var S=function(){function IapClientXsolla(){this.is_enabled=false
this.catalog={}
this.iap_service=void 0
var e=a()
var t=e&&e.name===f
var r="https://"+(Boolean(e&&e.use_frvr_prod_api)||true?"":"staging.")+"crucible.frvr.com/v1/iap"
this.iap_service=new m(r,{sandbox:!t,version:i()?"mobile":"desktop"})}var e=IapClientXsolla.prototype
e.init=function init(e){this.fetchProducts(e)}
e.getProvider=function getProvider(){return E}
e.enabled=function enabled(){return this.is_enabled}
e.fetchProducts=function fetchProducts(r){var a=this
var e=l(h)
if(!(null==e?void 0:e.accessToken))return
var t={max_retries:g,inc_backoff_duration:T,max_backoff:y}
var i=function handleResponse(e,t){if(e||!t){r(e||c)
return}a.catalog={}
t.forEach(function(e){a.catalog[e.sku]={amount:e.price,currency:e.currency,formatted:p(e.price,e.currency)}})
a.is_enabled=true
r()}
_(this.iap_service.getProducts.bind(this.iap_service),t,i)}
e.getProductPrice=function getProductPrice(e){return this.catalog[e]}
e.startPurchase=function startPurchase(o,e,n){n=d(n)
if(!this.is_enabled)return void n(c)
var t=l(h)
var s=null==t?void 0:t.accessToken
var r=e
if(!s)return n(u)
this.iap_service.createPaymentUrl([{productId:o,quantity:1}],s,function(e,i){if(e||!(null!=i&&i.url))return n(e)
var t=function listener(e){if(!i.url.includes(e.origin)||!(e.data&&"string"===typeof e.data&&e.data.startsWith("{")))return
var t=JSON.parse(e.data),r=t.command,a=t.data
if("finish"===t.action||"return"===r)hideIframe(listener)
if("change-status"===r&&"done"===a.value)n(null,{product_id:o,provider:E,purchase_id:a.purchase_external_id,validation_data:JSON.stringify({access_token:s,transaction_id:a.purchase_external_id})})
else if("change-status"===r&&"canceled"===a.value){hideIframe(listener)
n(v)}}
showIframe(i.url,n,t)},r)}
e.syncPurchases=function syncPurchases(r){var t=this
if(!this.is_enabled)return void r(c)
var e=l(h)
var a=null==e?void 0:e.accessToken
if(!a)return r(u)
_(function makeRequest(e){t.iap_service.getTransactions(a,e,{status:"SUCCESS",consumed:false})},{max_retries:g,inc_backoff_duration:T,max_backoff:y},function handleResponse(e,t){if(e||!t)return r(e)
return r(null,t.filter(function(e){return e.products&&e.products[0]}).map(function(e){return{provider:E,product_id:e.products[0].productId,purchase_id:e._id,validation_data:JSON.stringify({access_token:a,transaction_id:e._id})}}))})}
e.consumePurchase=function consumePurchase(e,t,r){s(this.is_enabled)
var a=l(h)
var i=null==a?void 0:a.accessToken
if(!i)return r&&r(u)
var o={max_retries:g,inc_backoff_duration:T,max_backoff:y}
var n=function handleResponse(e){if(r){if(e)console.log("ignoring: "+e)
r()}}
_(this.iap_service.consumeTransaction.bind(this.iap_service,e,i),o,n)}
return IapClientXsolla}()
r.IapClientXsolla=S},{"../../common/globals":248,"../../common/in_app_purchases/iap_common":250,"../../glov/client/engine":305,"../../glov/client/environments":310,"../../glov/client/input":326,"../../glov/client/local_storage":329,"../../glov/common/execute_with_retry":386,"../../glov/common/external_users_common":387,"../../glov/common/util":400,"../external_users/external_users_client_frvr":92,"./iap_client_worlds":111,"./iap_xsolla_service":113,assert:void 0}],113:[function(e,t,r){"use strict"
r.IAPXsollaService=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i=e("../../glov/client/fetch").fetch
var a=function(){function IAPXsollaService(e,t){var r=void 0===t?{version:"desktop",sandbox:false}:t,a=r.version,i=r.sandbox
this.base_url=void 0
this.version=void 0
this.sandbox=void 0
this.base_url=e
this.version=a
this.sandbox=i}var e=IAPXsollaService.prototype
e.getProducts=function getProducts(e){i({url:this.base_url+"/products/worlds",response_type:"json"},e)}
e.createPaymentUrl=function createPaymentUrl(e,t,r,a){e=e.map(function(e){return _extends({},e,{productId:"worlds__"+e.productId})})
i({url:this.base_url+"/xsolla/create-payment-url/worlds",method:"POST",response_type:"json",body:{sandbox:this.sandbox,products:e,version:this.version,metadata:{email:a}},headers:{Authorization:"Bearer "+t}},r)}
e.getTransactions=function getTransactions(e,t,r){if(void 0===r)r=void 0
i({url:this.base_url+"/xsolla/transactions"+(r?"?"+Object.entries(r).map(function(e){return e[0]+"="+e[1]}).join("&"):""),response_type:"json",headers:{Authorization:"Bearer "+e}},t)}
e.consumeTransaction=function consumeTransaction(e,t,r){i({url:this.base_url+"/xsolla/transactions/"+e+"/consume",method:"POST",response_type:"json",headers:{Authorization:"Bearer "+t}},r)}
return IAPXsollaService}()
r.IAPXsollaService=a},{"../../glov/client/fetch":313}],114:[function(e,t,r){"use strict"
r.inventoryResetPropLocks=inventoryResetPropLocks
r.inventoryLocked=inventoryLocked
r.inventorySetLock=inventorySetLock
r.propInventorySetLockedByPos=propInventorySetLockedByPos
r.propInventoryLockedByPos=propInventoryLockedByPos
r.inventoryGetVer=inventoryGetVer
r.inventoryWhenUnlocked=inventoryWhenUnlocked
r.inventoryWhenPlayerUnlocked=inventoryWhenPlayerUnlocked
r.reload=reload
r.inventoryLoad=inventoryLoad
r.inventoryGetLookedToolMat=inventoryGetLookedToolMat
r.inventoryApplyGeneration=inventoryApplyGeneration
r.assignLockedTools=assignLockedTools
r.giveItemsFromUI=giveItemsFromUI
r.debugMaterials=debugMaterials
r.debugBlocks=debugBlocks
r.startup=startup
r.inventoryGetSizeMax=inventoryGetSizeMax
r.inventoryGetSize=inventoryGetSize
r.inventoryGet=inventoryGet
r.inventoryGetArr=inventoryGetArr
r.inventoryGetNames=inventoryGetNames
r.findAddIdxList=findAddIdxList
r.inventoryOverlap=inventoryOverlap
r.itemListCompact=itemListCompact
r.canDrop=canDrop
r.inventoryEmpty=inventoryEmpty
r.playerCarryingHeavy=playerCarryingHeavy
r.canFit=canFit
r.canFitPartial=canFitPartial
r.canSplit=canSplit
r.transInvAdd=transInvAdd
r.transInvClear=transInvClear
r.inventoryClearHeavyFromTrash=inventoryClearHeavyFromTrash
r.inventoryTransAttribMod=inventoryTransAttribMod
r.inventoryTransHPMod=inventoryTransHPMod
r.transDrop=transDrop
r.transSwap=transSwap
r.transMerge=transMerge
r.transInvDec=transInvDec
r.transSplit=transSplit
r.consumeEx=consumeEx
r.consume=consume
r.transBucketConsume=transBucketConsume
r.transBucketFill=transBucketFill
r.transSort=transSort
r.undoTransactionOp=undoTransactionOp
r.applyTransactionOp=applyTransactionOp
r.countAvailableEx=countAvailableEx
r.countAvailable=countAvailable
r.findAvailableEx=findAvailableEx
r.findAvailable=findAvailable
r.findAvailableBroken=findAvailableBroken
r.payCostEx=payCostEx
r.payCost=payCost
r.inventoryGetFallback=inventoryGetFallback
r.inventoryGetSilhouette=inventoryGetSilhouette
r.inventoryGetAccountMapped=inventoryGetAccountMapped
r.inventoryGetBuildMenuMapped=inventoryGetBuildMenuMapped
r.inventoryGetMaterialCostMapped=inventoryGetMaterialCostMapped
r.equipFitsInSlot=equipFitsInSlot
r.anythingEquipped=anythingEquipped
r.findEquipAddIdx=findEquipAddIdx
r.inventoryReset=inventoryReset
r.getDropPos=r.EQUIP_SLOTS=r.INV_EQUIP=r.INV_PLAYER=void 0
var a=e("../common/ids")
var i=e("../common/ids")
var o=i.ITEM_BAG
var c=i.ITEM_BUCKET
var l=i.ITEM_HATCHET
var T=i.ITEM_INGOT
var y=i.ITEM_ORE
var _=i.ITEM_PICKAX
var u=i.ITEM_SHOVEL
var n=i.TYPE_BLOCK
var S=i.TYPE_ITEM
var d=e("./localization/localization").L
var s=e("./ui_util")
var h={data_ver:1,contents:[]}
r.INV_PLAYER=h
var p={data_ver:1,contents:[]}
r.INV_EQUIP=p
var f=[{item_id:_,label:d.INVENTORY_ITEM_LABEL_PICKAX,frame:s.SLOT_PICKAX},{item_id:l,label:d.INVENTORY_ITEM_LABEL_HATCHET,frame:s.SLOT_HATCHET},{item_id:u,label:d.INVENTORY_ITEM_LABEL_SHOVEL,frame:s.SLOT_SHOVEL}]
r.EQUIP_SLOTS=f
var b=e("assert")
var v=e("../glov/client/cmds").cmd_parse
var m=e("../glov/client/error_report").errorReportSetDynamicDetails
var E=e("../glov/client/ui")
var g=e("../glov/common/util")
var I=g.callEach
var A=g.clone
var w=g.empty
var L=g.ridx
var N=e("../glov/common/verify")
var O=e("../glov/common/vmath")
var R=O.unit_vec
var C=O.v3addScale
var x=O.v3floor
var M=O.v3same
var D=O.vec3
var P=e("../common/globals").STACK_SIZE
var B=e("../common/materials_common").Mat
var k=e("../common/voxel_data_common")
var U=k.ANIM_STYLE_BEAM
var G=k.ANIM_TYPE_PLAYER
var F=k.ANIM_TYPE_POS
var W=k.TRANS_INV_EQUIP
var H=k.TRANS_INV_PLAYER
var z=e("../common/world_constants").TOOL_LOCK_ANY
var V=e("../common/world_trans").createTransSet
var Y=e("./blueprint").blueprintGetDef
var j=e("./editvolume_client").inEditBounds
var K=e("./item_anims").setLastModProp
var q=e("./items")
var Z=q.createItem
var X=q.itemEqual
var Q=q.itemFromJSON
var $=q.itemIsAccountLocked
var J=q.itemIsBlueprint
var ee=q.itemIsUnlimited
var te=q.itemPartiallyMergeable
var re=q.itemPotentiallyMergeable
var ae=q.sameItem
var ie=q.satisfiesCost
var oe=e("./main")
var ne=e("./materials")
var se=ne.INV_MATERIAL_NAME
var le=ne.MATERIAL_CLASS
var _e=ne.MATERIAL_TIER
var ce=ne.MATERIAL_UNLIMITED_SPECIAL
var ue=e("./props")
var de=e("./quickbar")
var fe=e("./status")
var ve=e("./tiles")
var he=e("./tiles_ui").TILES_UI_SORT
var pe=e("./user_data")
var me=e("./user_data")
var Ee=me.unlimitedItemsAllowed
var ge=me.userDataGet
var Te=me.userDataIsWaiting
var ye=me.userDataSet
var Se=me.worldReadOnly
var Ie=e("./voxel_data")
var Ae=e("./voxel_data").ensurePristineSendProp
var we=e("./world_comm").transact
var Le=e("./world_metadata")
var Oe=Le.worldInventoryClone
var Re=Le.worldInventoryGeneration
var be=Le.worldToolLock
var Ne=e("./worlds_sound").playSound
var Ce=Math.floor,xe=Math.max,Me=Math.min
h.user_inv_type=H
p.user_inv_type=W
var De
var Pe
var Be=ve.tile_map_default
b(Be)
var ke=Object.create(null)
function inventoryResetPropLocks(){for(var e in ke)delete ke[e]}function inventoryLocked(e){b(e)
if(e.user_inv_type)return e.prediction_locked
else return ke[e.pos_key]}function inventorySetLock(e,t){if(e.user_inv_type){e.prediction_locked=t
if(!e.prediction_locked&&e.on_unlock)I(e.on_unlock,e.on_unlock=null,e)}else if(t)ke[e.pos_key]=true
else delete ke[e.pos_key]}function propInventorySetLockedByPos(e,t,r){var a=e+","+t
if(r)ke[a]=true
else delete ke[a]}function propInventoryLockedByPos(e,t){return ke[e+","+t]}function inventoryGetVer(e){b(e===h)
return e.data_ver}function inventoryWhenUnlocked(e,t){if(!inventoryLocked(e))t()
else{e.on_unlock=e.on_unlock||[]
e.on_unlock.push(t)}}function inventoryWhenPlayerUnlocked(e){if(inventoryLocked(h))inventoryWhenUnlocked(h,inventoryWhenPlayerUnlocked.bind(null,e))
else if(inventoryLocked(p))inventoryWhenUnlocked(p,inventoryWhenPlayerUnlocked.bind(null,e))
else e()}var Ue
var Ge=false
var Fe=false
function autoGrantStart(e,t,r){Ue=e||null
Ge=t||false
Fe=r||false}function autoGrant(o){if(Se())return
var n=false;[h,p].forEach(function(e){var t=e.contents
var r=inventoryGetSize(e)
for(var a=0;a<r;++a){var i=t[a]
if(i&&i.type===o.type&&i.id===o.id&&i.attr1===(o.attr1||0)){if(!o.remove){n=true
return}transInvClear(Ue=Ue||oe.getFrameTransaction(),e,a)
if(!Ge)fe.push(d.$(d.STATUSMSG_ITEM_REMOVED,i.getName()))}}})
if(o.remove||n&&!Fe)return
var e=Z(o)
if(e.has_hp)e.setHP(e.hp_max)
var t=findEquipAddIdx(e)
if(-1!==t){transInvAdd(Ue=Ue||oe.getFrameTransaction(),p,e,t,true)
if(!Ge)fe.push(d.$(d.STATUSMSG_ITEM_AUTO_EQUIP,e.getName()))}else if(!canFit(e)){if(!Ge)fe.get("ifull").setMessage(d.MSG_INVENTORY_FULL)}else{transInvAdd(Ue=Ue||oe.getFrameTransaction(),h,e,void 0,true)
if(!Ge)fe.push(d.$(d.STATUSMSG_ITEM_AUTO_GRANT,e.getName()))}}function reload(e,t){var r=false
b(t)
b(t.items)
b(t.size)
e.container_size=t.size
e.contents=t.items.map(Q)
e.prediction_locked=false;++e.data_ver
return r}function removeInvalidItems(i){if(Se())return i;[h,p].forEach(function(e){var t=e.contents
for(var r=0;r<t.length;++r){var a=t[r]
if(a&&!a.isAllowedInInventory())transInvClear(i=i||oe.getFrameTransaction(),e,r)}})
return i}m("inv",function(){return JSON.stringify({inv:h,eq:p})})
function inventoryLoad(){reload(h,pe.get("inventory"))
reload(p,pe.get("equip"))
b.equal(p.container_size,f.length)
assignLockedTools(removeInvalidItems(inventoryApplyGeneration(null)),true)}var We=[B.REGULAR,B.FAST,B.SUPER]
function inventoryGetLookedToolMat(e){b(e>=1&&e<=3)
return We[e-1]}function inventoryApplyGeneration(c){if(Te()||Se())return c
var e=Re()||0
if((ge("inv_gen")||0)===e)return c
var u=be()
var d=We[u-1]
var f=Oe();[[h,"inventory"],[p,"equip"]].forEach(function(e){var t=e[0],r=e[1]
var a=t.contents
if(f&&f[r]){var i=f[r].items
for(var o=0;o<t.container_size;++o){var n=a[o]
var s=Z(i[o])
if(n){if(s&&ae(n,s)&&n.count===s.count)continue
transInvClear(c=c||oe.getFrameTransaction(),t,o)}if(s)transInvAdd(c=c||oe.getFrameTransaction(),t,s,o)}}else for(var l=0;l<t.container_size;++l){var _=a[l]
if(_){if(_.type===S&&(u===z&&ce[_.attr1]||d&&_.attr1===d))continue
transInvClear(c=c||oe.getFrameTransaction(),t,l)}}})
c=assignLockedTools(c,true)
ye("inv_gen",e)
return c}function assignLockedTools(e,t){if(Te())return e
if(inventoryLocked(h)){fe.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return e}autoGrantStart(e,t,false)
var r=be()
for(var a=0;a<2;++a)for(var i=0;i<We.length;++i){var o=We[i]
var n=0===i&&r===z||r===i+1
var s=!(r===z||r===i+1)
if(s&&0===a||!s&&1===a){autoGrant({type:S,id:_,attr1:o,attr2:B.WOOD,equip:n,remove:s})
autoGrant({type:S,id:l,attr1:o,attr2:B.WOOD,equip:n,remove:s})
autoGrant({type:S,id:u,attr1:o,attr2:B.WOOD,equip:n,remove:s})}}Ge=false
return Ue}function giveItemsFromUI(e){if(!canFit(e))fe.get("ifull").setMessage(d.MSG_INVENTORY_FULL)
else transInvAdd(oe.getFrameTransaction(),h,e,void 0,false)}function debugMaterials(){if(inventoryLocked(h)){fe.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}autoGrantStart(null,false,false)
autoGrant({type:n,id:ve.WOOD,count:100})
autoGrant({type:S,id:a.ITEM_FIBER,count:100})
autoGrant({type:n,id:ve.STONE,count:100})}function debugMetals(){if(inventoryLocked(h)){fe.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}autoGrantStart(null,false,false)
autoGrant({type:S,id:a.ITEM_COAL,count:10})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.COPPER})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.IRON})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.TIN})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.SILVER})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.EMBERYLLIUM})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.GOLD})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.COBALT})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.MYTHRIL})
autoGrant({type:S,id:a.ITEM_ORE,count:10,attr1:B.AETHERSTONE})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.COPPER})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.IRON})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.TIN})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.BRONZE})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.SILVER})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.EMBERYLLIUM})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.GOLD})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.BRIGHTSTEEL})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.COBALT})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.MYTHRIL})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.AETHERSTEEL})
autoGrant({type:S,id:a.ITEM_INGOT,count:10,attr1:B.MUTTAL})
autoGrant({type:S,id:_,attr1:B.COPPER,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.IRON,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.BRONZE,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.SILVER,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.EMBERYLLIUM,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.BRIGHTSTEEL,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.COBALT,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.MYTHRIL,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.AETHERSTEEL,attr2:B.WOOD})
autoGrant({type:S,id:_,attr1:B.MUTTAL,attr2:B.WOOD})
autoGrant({type:n,id:ve.COAL,count:1})
autoGrant({type:n,id:ve.COPPER,count:1})
autoGrant({type:n,id:ve.IRON,count:1})
autoGrant({type:n,id:ve.TIN,count:1})
autoGrant({type:n,id:ve.SILVER,count:1})
autoGrant({type:n,id:ve.EMBERYLLIUM,count:1})
autoGrant({type:n,id:ve.GOLD,count:1})
autoGrant({type:n,id:ve.COBALT,count:1})
autoGrant({type:n,id:ve.MYTHRIL,count:1})
autoGrant({type:n,id:ve.AETHERSTONE,count:1})
autoGrant({type:n,id:ve.ORE_IN_STONE_LIGHT,count:1})
autoGrant({type:n,id:ve.ORE_IN_STONE,count:1})
autoGrant({type:n,id:ve.ORE_IN_STONE_DARK,count:1})
autoGrant({type:n,id:ve.ORE_IN_STONE_RED,count:1})
autoGrant({type:n,id:ve.VEINIUM,count:1})
autoGrant({type:n,id:ve.ORE_IN_VEINIUM,count:1})}v.register({cmd:"metal_test",help:"Grants a bunch of ores, bars, and metal tools, for testing",func:function func(e,t){v.handle(this,"inventory_size 48",function(e){if(e)return void t(e)
debugMetals()
t()})},access_run:["sysadmin"]})
function debugBlocks(){if(inventoryLocked(h)){fe.push(d.STATUSMSG_CANT_GRANT_INVENTORY_LOCKED)
return}autoGrantStart(null,false,false)
autoGrant({type:n,id:ve.DIRT,count:100})
autoGrant({type:n,id:ve.STONE,count:100})
autoGrant({type:n,id:ve.STONE_DARK,count:100})
autoGrant({type:n,id:ve.STONE_LIGHT,count:100})
autoGrant({type:n,id:ve.STONE_RED,count:100})
autoGrant({type:n,id:ve.WOOD,count:100})
autoGrant({type:n,id:ve.WOOD_LIGHT,count:100})
autoGrant({type:n,id:ve.WOOD_RED,count:100})
autoGrant({type:n,id:ve.WOOD_DARK,count:100})
autoGrant({type:n,id:ve.SAND,count:100})}function dirty(e){if(!e.user_inv_type)e.updateRuntimeBehaviour()
else++e.data_ver}function startup(){Pe=oe.char_controller
De=Ie.transItemAnim}function inventoryGetSizeMax(e){var t=e.container_size
if(e===h)--t
return t}function inventoryGetSize(e){var t=inventoryGetSizeMax(e)
return Me(t,e.contents.length)}function inventoryGet(e){return h.contents[e]}function inventoryGetArr(){return h.contents}function inventoryGetNames(){var n=[];[p,h].forEach(function(e){var t=e.contents
var r=inventoryGetSizeMax(e)
for(var a=0;a<r;++a){var i=t[a]
if(i){var o=i.getName()
if(i.count>1)o=d.$(d.LBL_OUTPUT_MULTIPLE,o,i.count)
n.push(o)}}})
return n}function findAddIdxList(e,t,r,a){var i=Me(t.count,r)
b(i)
var o=[]
var n=e.contents
var s=inventoryGetSizeMax(e)
if(t.heavy&&e===h&&!Ee())for(var l=0;l<s;++l)if(n[l]&&n[l].heavy)return null
if(t.stackable)for(var _=0;i&&_<Me(n.length,s);++_){var c=n[_]
var u=Me(te(c,t),i)
if(u){i-=u
o.push(_,u)}}for(var d=0;i&&d<s;++d)if(!n[d]){var f=Me(P,i)
i-=f
o.push(d,f)}if(!o.length||a&&i)return null
return o}function inventoryOverlap(e,t){var r=[]
for(var a=e.length-1;a>=0;--a){var i=e[a]
for(var o=t.length-1;o>=0;--o){var n=t[o]
if(X(i,n,"hp")){r.push(i)
L(e,a)
L(t,o)}else if(re(i,n))if(i.count===n.count){r.push(i)
L(e,a)
L(t,o)
break}else if(i.count<n.count){r.push(i)
L(e,a)
n.count-=i.count
break}else{r.push(n)
L(t,o)
i.count-=n.count}}}return r.length?r:null}function itemListCompact(e){var t=e
for(var r=t.length-1;r>=0;--r)if(!t[r]){if(t===e)t=e.map(Q)
L(t,r)}for(var a=0;a<t.length;++a)for(var i=t.length-1;i>a;--i)if(re(t[a],t[i])){if(t===e)t=e.map(Q)
t[a].count+=t[i].count
L(t,i)}return t}var He=new Int32Array(3)
function canDrop(){if(inventoryLocked(h))return false
x(He,Pe.getRootPos())
if(!j(He))return false
var e=Ie.getTileLocal(He,0)
if(e>=ve.PROP_BASE&&e<=ve.PROP_MAX){var t=Ie.getPropLocal(He)
if(t&&t.item_id===o)return true}return!e}function full(e,t){var r=e.contents
var a=inventoryGetSizeMax(e)
for(var i=t||0;i<a;++i)if(!r[i])return false
return true}function inventoryEmpty(e){var t=e.contents
var r=inventoryGetSize(e)
for(var a=0;a<r;++a)if(t[a])return false
return true}function playerCarryingHeavy(){if(Ee())return false
var e=h
var t=e.contents
var r=inventoryGetSizeMax(e)
for(var a=0;a<r;++a)if(t[a]&&t[a].heavy)return true
return false}function canFit(e){if(inventoryLocked(h))return false
return Boolean(findAddIdxList(h,e,Infinity,true))}function canFitPartial(e){if(inventoryLocked(h))return false
return Boolean(findAddIdxList(h,e,Infinity,false))}function canSplit(e,t,r){b(e)
if(inventoryLocked(e))return false
var a=e.contents[t]
if(!a||!a.stackable||a.count<=1)return false
return!full(e,r)}function matCompare(e,t){if(e===t)return 0
if(!e){if(!t)return 0
return-1}else if(!t)return 1
var r=(le[e]||0)-(le[t]||0)
if(r)return r
if(r=(_e[e]||0)-(_e[t]||0))return r
return e-t}function itemCompare(e,t){if(e.type!==t.type)return t.type-e.type
if(e.type===n){var r=Be[e.id]
var a=r&&he[r.tile_code]||e.id
var i=Be[t.id]
return a-(i&&he[i.tile_code]||t.id)}if(e.id!==t.id)return e.id-t.id
var o=matCompare(e.attr1,t.attr1)
if(o)return o
if(o=matCompare(e.attr2,t.attr2))return o
if(o=(e.attr3||0)-(t.attr3||0))return o
return t.count-e.count}function sort(e){var t=false
for(var r=0;r<e.length;++r){var a=e[r]
for(var i=r+1;i<e.length;++i){var o=e[i]
if(!a&&o){e[r]=a=o
e[i]=null
t=true}else if(!o);else{var n=te(a,o)
if(n){a.count+=n
o.count-=n
if(!o.count)e[i]=null
t=true}else if(itemCompare(a,o)>0){e[i]=a
e[r]=a=o
t=true}}}}while(e.length&&!e[e.length-1])e.pop()
if(!t)e.reverse()}function uiOnAdd(e){var t=fe.get("pickup_"+e.type+"_"+e.id+"_"+e.attr1+"_"+e.attr2+"_"+e.attr3)
t.count=(t.count||0)+e.count
var r=0
var a=h.contents
var i=Me(a.length,h.container_size-1)
for(var o=0;o<i;++o)if(ae(a[o],e))r+=a[o].count
a=p.contents
for(var n=0;n<a.length;++n)if(ae(a[n],e))r+=a[n].count
if(t.count>r)t.count=r
Ne("pickup")
t.setMessage(d.$(d.STATUSMSG_ITEM_ADD,t.count,e.getName(),r))}function transInvAdd(e,t,r,a,i,o){if(void 0===o)o=r.count
b(o)
if(!t.user_inv_type)Ae(e,t)
b(!inventoryLocked(t))
var n=t.contents
var s
if(void 0===a){s=findAddIdxList(t,r,o,true)
b(s)}else{b(-1!==a)
s=[a,o]}var l=0
for(var _=0;_<s.length;){var c=s[_++]
var u=s[_++]
l+=u
var d=n[c]
b(u+(d&&d.count||0)<=P)
var f=!d
var v={idx:c,prop:t,item:r.toJSON(null,true),pred:true}
if(f){v.add=true
v.item.count=u}else{delete v.item.count
v.delta=u}if(f)n[c]=Z(v.item)
else n[c].count+=u
e.opInvMod(v)}if(t.user_inv_type&&!i){var h=A(r.toJSON())
h.count=l
e.onComplete(function(e){if(!e)uiOnAdd(Z(h))})}dirty(t)}function transInvClear(e,t,r){var a=t.contents[r]
b(a)
transInvDec(e,t,r,a.count)}function inventoryClearHeavyFromTrash(e){var t
var r=h.container_size-1
if(null!=(t=inventoryGet(r))&&t.heavy&&!Ee())transInvClear(e,h,r)}function inventoryTransAttribMod(e,t,r,a,i){var o=t.contents[r]
if(!o.attribs)o.attribs={}
o.attribs[a]=(o.attribs[a]||0)+i
if(!o.attribs[a]){delete o.attribs[a]
if(w(o.attribs))delete o.attribs}e.opInvAttrib({prop:t,idx:r,attrib:a,delta:i})
dirty(t)}function inventoryTransHPMod(e,t,r,a){var i=t.contents[r]
i.hp_cur=xe(0,i.hp_cur+a)
inventoryTransAttribMod(e,t,r,"hp",i.hpToAttrib(i.hp_cur)-(i.attribs&&i.attribs.hp||0))}var ze=function(){var t=D()
var r=D()
var a=D()
var i=D()
return function getDropPosFn(){C(t,Pe.pos,Pe.facing,-1)
var e=Ie.raycast3DLocal(r,a,i,t,Pe.facing,3,false,false,false)?a:r
if(Ie.getTileLocal(e,1,false)||!j(e))return null
return e}}()
r.getDropPos=ze
function transDrop(e,t,r,a){b(!inventoryLocked(t))
var i=t.contents[r]
b(i)
transInvClear(e,t,r)
ue.bagAddTrans(e,{target_pos:a,item:i,src_pos:Pe.pos,src_is_self:true,no_pickup:true})}var Ve=D()
function transSwap(e,t,r,a,i){b(!inventoryLocked(t))
b(!inventoryLocked(a))
b(t!==a||r!==i)
var o=t.contents
var n=a.contents
b(!t.destroy_on_empty)
b(!a.destroy_on_empty)
var s=o[r]
var l=n[i]
b(l||s)
var _=t.user_inv_type===H&&r===h.container_size-1||a.user_inv_type===H&&i===h.container_size-1
if(s)transInvClear(e,t,r)
if(l){transInvClear(e,a,i)
transInvAdd(e,t,l,r,!(t.user_inv_type&&!a.user_inv_type)||_)}if(s)transInvAdd(e,a,s,i,!(a.user_inv_type&&!t.user_inv_type)||_)
var c=!t.user_inv_type
var u=!a.user_inv_type
if(c!==u&&!_){(!t.user_inv_type?t:a).getLocalPos(Ve)
if(s&&c||l&&u)De(e,{style:U,src_type:F,src:Ve,target_type:G,items:[c?s:l]})
if(s&&!c||l&&!u)De(e,{style:U,src_type:G,target_type:F,target:Ve,items:[c?l:s]})}}function transMerge(e,t,r,a,i,o){b(!inventoryLocked(t))
b(!inventoryLocked(a))
var n=t.contents
var s=a.contents
var l=n[r]
var _=s[i]
if(l){var c=te(l,_)
b(c)
b(o<=c)}b(r!==i||n!==s)
if((o=Me(o,_.count))<_.count)(_=Z(_)).count=o
var u=!t.user_inv_type!==!a.user_inv_type
transInvAdd(e,t,_,r,!u,o)
transInvDec(e,a,i,o)
if(u){(!t.user_inv_type?t:a).getLocalPos(Ve)
var d={style:U,items:[_]}
if(!t.user_inv_type){d.src_type=G
d.target_type=F
d.target=Ve}else{d.src_type=F
d.src=Ve
d.target_type=G}De(e,d)}}function decForTransInternal(e,t,r){b(!inventoryLocked(e))
var a=e.contents
var i=a[t]
b(i)
b(r)
b(i.count>=r)
var o={idx:t,prop:e,delta:-r,item:i.toJSON(),pred:true}
delete o.item.count
var n=i.count-r
if(!n)a[t]=null
else i.count=n
dirty(e)
return o}function transInvDec(e,t,r,a){if(!t.user_inv_type)Ae(e,t)
e.opInvMod(decForTransInternal(t,r,a))}function transSplit(e,t,r,a){b(!inventoryLocked(t))
var i=t.contents
var o=inventoryGetSize(t)
var n=i[r]
var s=Ce(n.count/2)
var l=n.count-s
var _=-1
for(var c=a||0;c<o;++c)if(!i[c]){_=c
break}if(-1===_)_=o
transInvDec(e,t,r,l)
transInvAdd(e,t,n,_,true,l)}function consumeEx(e,t,r,a){a=a||1
var i=t.contents[r]
if(!i)return e
if(!i.stackable){b(i.placeable)
b.equal(i.count,1)}if(i.count<a)return e
transInvDec(e=e||oe.getFrameTransaction(),t,r,a)
i.consume(e)
return e}function consume(e,t,r){return consumeEx(e,h,t,r)}function bucketMergeSlot(e,t,r){var a=h.contents[e]
b(a)
var i=Z({type:S,id:c,count:r,attr1:a.attr1,attr2:t,attr3:a.attr3})
var o=findAddIdxList(h,i,r,true)
if(o)return[o,i]
if(r===a.count)return[[e,r],i]
fe.get("ifull").setMessage(d.MSG_INVENTORY_FULL)
return null}function transBucketConsume(e,t,r){var a=h.contents[t]
b(a)
b.equal(a.type,S)
b.equal(a.id,c)
b(a.attr2)
b(a.count&&a.count>=r)
var i=bucketMergeSlot(t,ve.EMPTY,r)
if(!i)return null
e=e||oe.getFrameTransaction()
var o=i[0],n=i[1]
transInvDec(e,h,t,r)
for(var s=0;s<o.length;){var l=o[s++]
var _=o[s++]
transInvAdd(e,h,n,l,false,_)}return e}function transBucketFill(e,t){var r=1
var a=h.contents[e]
b(a)
b.equal(a.type,S)
b.equal(a.id,c)
b(!a.attr2)
b(a.count&&a.count>=r)
var i=bucketMergeSlot(e,t,r)
if(!i)return null
var o=i[0],n=i[1]
b.equal(o.length,2)
b.equal(o[1],1)
b.equal(n.count,1)
var s=oe.getFrameTransaction()
transInvDec(s,h,e,r)
transInvAdd(s,h,n,o[0],false)
return s}function transSort(e){b(!inventoryLocked(e))
var t=e.contents
var r=inventoryGetSizeMax(e)
if(t.length>r)t=t.slice(0,r)
var a=A(t).map(Q)
sort(a)
var i
for(var o=0;o<t.length;++o){var n=t[o]
var s=a[o]
if(X(n,s))continue
i=i||oe.getFrameTransaction()
if(n)transInvClear(i,e,o)
if(s)transInvAdd(i,e,s,o,true)}}function undoTransactionOp(e){b(e.pred)
var t=e.idx,r=e.item,a=e.delta,i=e.add,o=e.prop_chunk_id,n=e.user_inv_type,s=e.prop
b.equal(o,void 0)
if(!s)if(n===H)s=h
else if(n===W)s=p
else b(false,n)
var l=s.contents
var _=l[t]
if(!_){b(a<0);(_=l[t]=Z(r)).count=-a}else{b.equal(_.type,r.type)
b.equal(_.id,r.id)
if(i){b.equal(_.count,r.count)
l[t]=null}else _.count-=a}b(s.user_inv_type);++s.data_ver}function applyTransactionOp(e,t){var r=e.idx,a=e.item,i=e.delta,o=e.add,n=e.prop_destroy_on_empty,s=e.prop_chunk_id,l=e.prop_pos,_=e.prop_version,c=e.user_inv_type
var u
if(void 0!==s){if(!(u=Ie.getPropDirect(s,l)))return
K(u)}else if(c===H)u=h
else if(c===W)u=p
else b(false,c)
if(t){u.version=_
return}var d=u.contents
if(!d){console.warn("Transaction on non-container, cid:"+s+",pos:"+l.join(",")+",uit:"+c+",tpv:"+_+",lpv:"+u.version+",lpid:"+u.item_id+", ignoring...")
return}var f=d[r]
if(o){if(!f);b(!i)
d[r]=Z(a)}else{b(i)
if(!f)if(i>0){d[r]=f=Z(a)
f.count=i
return}else return
b(f)
if(f.type!==a.type||f.id!==a.id)return
f.count+=i
if(!f.count)d[r]=null
while(d.length&&!d[d.length-1])d.pop()
if(!d.length&&n){var v=Ie.chunk_map[s]
b(v&&v.did_gen)
b(M(u.size,R))
if(v.get(l,false)===ve.PROP_BASE)v.set(l,0,false)
v.setProp(l,null)}}if(!u.user_inv_type)u.version=_
dirty(u)}function countAvailableEx(e,t,r,a){if(!t)return 0
if(t.unlimited_only&&!Ee()&&e.user_inv_type)return 0
if(t.from_mini)return Infinity
if(ee(t))return Infinity
var i=J(t)
var o
var n=true
if(i){b(e.user_inv_type)
var s=t.getBID()
b(s)
if(!(o=Y(s)).loaded)return 0
if(r)return countAvailableEx(e,t.cost[0],true,a)
var l="avail_count_bp_"+e.user_inv_type+"_"+(a?1:0)+"_ver"
if(o.ver!==t[l]){n=false
t[l]=o.ver}}var _
var c
if(e.user_inv_type&&!t.dynamic_cost)if(t[c=(_="avail_count_"+e.user_inv_type+"_"+(a?1:0))+"_ver"]===e.data_ver&&n)return t[_]
var u=t.cost_compact||t.cost
if(a)(u=[Z(t)])[0].count=1
else if(t.dynamic_cost)u=t.dynamic_cost()
else if(!u&&!t.placeable)(u=[Z(t)])[0].count=1
else if(i)u=o.cost
if(!N(u))return 0
var d=e.contents
var f=inventoryGetSize(e)
var v=Infinity
var h=true
var p={}
var m=[]
for(var E=0;E<u.length;++E){var g=u[E]
b(g.count)
var T=0
var y=[]
for(var S=0;S<f;++S)if(ie(g,d[S])){y.push(S)
if(p[S])h=false
p[S]=true
T+=d[S].count}m.push(y)
v=Me(v,Ce(T/g.count))}if(!h&&v>0){v=0
p={}
e:while(true){for(var I=0;I<u.length;++I){var A=u[I].count
var w=m[I]
while(A>0&&w.length){var L=w[0]
var O=p[L]||0
var R=d[L].count-O
if(R>A){p[L]=O+A
A=0}else{p[L]=O+R
A-=R
w.shift()}}if(A)break e}if(100===++v)break}}if(_){t[_]=v
t[c]=e.data_ver}return v}function countAvailable(e,t,r){return countAvailableEx(h,e,t,r)+countAvailableEx(p,e,t,r)}function findAvailableEx(e,t){var r=e.contents
var a=inventoryGetSize(e)
for(var i=0;i<a;++i)if(ie(t,r[i]))return r[i]
return null}function findAvailable(e){return findAvailableEx(p,e)||findAvailableEx(h,e)}function findAvailableBrokenEx(e,t){var r=e.contents
var a=inventoryGetSize(e)
for(var i=0;i<a;++i)if(ae(t,r[i],"hp"))return r[i]
return null}function findAvailableBroken(e){return findAvailableBrokenEx(p,e)||findAvailableBrokenEx(h,e)}function payCostEx(e,t,r){b(t)
b(e||t.user_inv_type)
b(countAvailableEx(t,r,true))
var a=[]
if(Ee())return a
var i=r.cost_compact||r.cost
if(r.dynamic_cost)i=r.dynamic_cost()
var o=t.contents
var n=inventoryGetSize(t)
for(var s=0;s<i.length;++s){var l=i[s]
var _=l.count
b(_)
for(var c=0;_&&c<n;++c)if(ie(l,o[c])){var u=Me(_,o[c].count)
var d=decForTransInternal(t,c,u||1)
a.push(d)
if(e)e.opInvMod(d)
_-=u}b(!_)}return a}function payCost(e){if(!countAvailableEx(h,e,true))return null
return payCostEx(null,h,e)}function inventoryGetCached(e,t,r){var a=h
var i=t+"_"+a.user_inv_type
var o=i+"_ver"
if(e[o]===a.data_ver)return e[i]
var n=r(a,{type:e.type,id:e.id,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})
e[i]=n
e[o]=a.data_ver
return n}function inventoryGetFallback(e){if(!e)return e
return inventoryGetCached(e,"fallback",function(e,t){var r=Z(t)
r.fallback=true
return r})}function inventoryGetSilhouette(e){if(!e)return e
return inventoryGetCached(e,"silhouette",function(e,t){var r=Z(t)
r.fallback=true
r.silhouette=true
return r})}function inventoryGetAccountMapped(e){return e&&$(e)?inventoryGetFallback(e):e}function inventoryGetBuildMenuMapped(e){return e&&$(e)?inventoryGetSilhouette(e):e}function inventoryGetMaterialCostMapped(g){if(!g||!g.cost_mat_map)return g
return inventoryGetCached(g,"mat_mapped",function(e,t){var r=e.contents
var a=inventoryGetSize(e)
if(g.place_as_id)t.id=g.place_as_id
var i={}
for(var o in g.cost_mat_map){var n=g.cost_mat_map[o]
var s=n.cost_idx,l=n.def,_=n.target_attr3
var c=g.cost[s]
var u=false
var d=false
if(t[o]&&t[o]!==B.ANY)u=true
var f=c.count
for(var v=0;v<a&&f;++v){var h=r[v]
var p=i[v]||0
if(!h||p===h.count)continue
if(ie(c,h)){var m=h.count-p
if(m>=f){i[v]=p+f
f=0}else{i[v]=p+m
f-=m}var E=void 0
if(_)E=h.attr3
else E=h.getMaterial()
if(!u){d=u=true
t[o]=E}else if(d)if(c.type===S&&c.id===y){if(_e[E]<_e[t[o]])t[o]=E}else if(c.type===S&&c.id===T)if(t[o]!==E)t[o]=B.MUTTAL}}if(!u){t[o]=l?se[l]:t[o]
b(t[o],"Material cost mapping referencing unknown material "+l)}}return Z(t)})}function equipFitsInSlot(e,t){if(!t)return false
if(t.type===S&&t.id===f[e].item_id){if(t.has_hp&&!t.hp_cur)return false
return true}return false}function anythingEquipped(){for(var e=0;e<f.length;++e)if(f[e])return true
return false}function findEquipAddIdx(e){if(!inventoryLocked(p))for(var t=0;t<f.length;++t)if(!p.contents[t]&&equipFitsInSlot(t,e))return t
return-1}function inventoryReset(){var e=V()
var r=e.trans();[h,p].forEach(function(e){if(inventoryLocked(e))E.modalDialog({title:d.DLG_ERROR_INVENTORY_RESET_TITLE,text:d.DLG_ERROR_INVENTORY_RESET_MSG,buttons:{OK:null}})
else for(var t=0;t<e.contents.length;++t)if(e.contents[t])transInvClear(r,e,t)})
de.reset(true)
assignLockedTools(r,false)
if(r.ops.length)we(e)}v.register({cmd:"inventory_reset",help:"Resets your inventory and quickbar to blank state",func:function func(e,t){inventoryReset()
t()},access_run:["world_areabuilder"]})
v.register({cmd:"repair_all",help:"(Admin) Repairs all items in inventory",func:function func(e,t){var r=V()
var a=r.trans();[h,p].forEach(function(e){for(var t=0;t<e.contents.length;++t){var r=e.contents[t]
if(r&&r.has_hp&&r.hp_cur<r.hp_max)inventoryTransHPMod(a,e,t,r.hp_max-r.hp_cur)}})
if(a.ops.length){we(r)
t(null,"Repaired.")}else t(null,"Nothing needed repair")},access_run:["sysadmin"]})},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/voxel_data_common":264,"../common/world_constants":267,"../common/world_trans":268,"../glov/client/cmds":298,"../glov/client/error_report":311,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./blueprint":28,"./editvolume_client":84,"./item_anims":116,"./items":119,"./localization/localization":131,"./main":135,"./materials":137,"./props":171,"./quickbar":172,"./status":193,"./tiles":199,"./tiles_ui":201,"./ui_util":205,"./user_data":208,"./voxel_data":216,"./world_comm":226,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],115:[function(e,t,r){"use strict"
r.inventoryUIStartup=inventoryUIStartup
r.inventoryUIInit=inventoryUIInit
r.inventoryAnimate=inventoryAnimate
r.mapInvPos=mapInvPos
r.inventoryButtonPrep=inventoryButtonPrep
r.drawItemCount=drawItemCount
r.itemHPColor=itemHPColor
r.itemHPStyle=itemHPStyle
r.drawItemHP=drawItemHP
r.inventoryButton=inventoryButton
r.getDroppedItem=getDroppedItem
r.setMouseoverItem=setMouseoverItem
r.getMouseoverItem=getMouseoverItem
r.setSelectedItem=setSelectedItem
r.getSelectedItem=getSelectedItem
r.getDraggedItem=getDraggedItem
r.doInventorySetupContext=doInventorySetupContext
r.ctxTrans=ctxTrans
r.inventorySwap=inventorySwap
r.inventoryDeselect=inventoryDeselect
r.inventoryMerge=inventoryMerge
r.canEquipFromContainer=canEquipFromContainer
r.equipFromContainer=equipFromContainer
r.equipDragDroppedItem=equipDragDroppedItem
r.inventoryUITick=inventoryUITick
r.doInventorySubOneItem=doInventorySubOneItem
r.doInventorySub=doInventorySub
r.doPaperDollInventoryOverlay=doPaperDollInventoryOverlay
r.handlePaperdollDragAndDrop=handlePaperdollDragAndDrop
r.doInventory=doInventory
r.quickTransferContainer=quickTransferContainer
r.doContainer=doContainer
r.QUICKBAR_VIEW_BORDER_PAD=r.ITEM_PAD=r.ACCEPT_HIGHLIGHT=r.ACCEPT_OK=r.ACCEPT_NO=r.INVTYPE_EQUIP=r.INVTYPE_CONTAINER=r.INVTYPE_MAIN=void 0
var ae=0
r.INVTYPE_MAIN=ae
var ie=1
r.INVTYPE_CONTAINER=ie
var oe=2
r.INVTYPE_EQUIP=oe
var ne=0
r.ACCEPT_NO=ne
var se=1
r.ACCEPT_OK=se
var le=2
r.ACCEPT_HIGHLIGHT=le
var J=14
r.ITEM_PAD=J
var ee=8
r.QUICKBAR_VIEW_BORDER_PAD=ee
var _e=e("assert")
var a=e("../glov/client/cmds").cmd_parse
var ce=e("../glov/client/engine")
var ue=e("../glov/client/input")
var de=e("../glov/client/net").netSubs
var fe=e("../glov/client/settings")
var ve=e("../glov/client/ui")
var i=e("../glov/client/ui")
var he=i.buttonWasFocused
var te=i.uiButtonHeight
var re=i.uiTextHeight
var o=e("../glov/common/util")
var pe=o.defaults
var u=o.lerp
var d=o.ridx
var l=e("../glov/common/verify")
var n=e("../glov/common/vmath")
var v=n.unit_vec
var _=n.v2distSq
var me=n.v2set
var s=n.v3copy
var c=n.v4set
var f=n.vec2
var h=n.vec4
var L=e("../common/globals").STACK_SIZE
var p=e("../common/materials_common").Mat
var m=e("./build_mode")
var O=m.MAX_INTERACT_DIST
var Ee=m.MIN_DRAG_DISTANCE
var E=e("./huds").staminaBar
var g=e("./inventory")
var ge=g.EQUIP_SLOTS
var T=g.INV_EQUIP
var Te=g.INV_PLAYER
var ye=g.equipFitsInSlot
var Se=g.findAddIdxList
var y=g.findAvailable
var S=g.findAvailableBroken
var Ie=g.inventoryEmpty
var R=g.inventoryGetArr
var I=g.inventoryGetFallback
var Ae=g.inventoryGetSize
var we=g.inventoryGetSizeMax
var Le=g.inventoryLocked
var Oe=g.playerCarryingHeavy
var Re=g.transBucketConsume
var be=g.transInvClear
var Ne=e("./inventory")
var A=e("./item_info_view")
var Ce=A.ITEM_INFO_VIEW_W
var xe=A.itemInfoViewShow
var w=e("./items")
var b=w.BOOST_BLOCKED_UNBLOCKED
var N=w.ITEM_CONTEXT_BUILD
var Me=w.ITEM_CONTEXT_ITEM
var C=w.createItem
var x=w.isItem
var M=w.itemGetGfx
var De=w.itemIsAllowedInQuickbar
var Pe=w.itemIsFullBucket
var Be=w.itemPartiallyMergeable
var D=w.sameItem
var P=e("./layout")
var B=P.TALL
var ke=P.WIDE
var Ue=P.layoutCameraTallWideMode
var Ge=e("./localization/localization").L
var Fe=e("./main").getFrameTransaction
var We=e("./main")
var k=e("./menu")
var He=k.PANEL_PAD
var U=k.menuInteractGetProp
var ze=k.menuPanelX0
var Ve=k.menuX1
var Ye=k.menuY1
var je=k.prefixShortcutKey
var G=e("./paperdoll")
var F=G.doPaperDoll
var W=G.resetRotation
var H=e("./quickbar")
var Ke=H.quickbarOnEquipChange
var z=H.quickbarSetLastGatherTool
var qe=e("./quickbar")
var V=e("./status")
var Ze=V.statusGet
var Xe=V.statusPush
var Y=e("./styles")
var j=Y.color_hp_high
var K=Y.color_hp_low
var q=Y.color_hp_med
var X=Y.color_hp_none
var Qe=Y.color_locked_fade
var Q=Y.color_rarity
var $e=Y.inventory_style
var Je=Y.refreshing_style
var $=Y.style_hp_label_high
var et=Y.style_hp_label_low
var tt=Y.style_hp_label_med
var rt=Y.style_hp_label_none
var at=Y.style_mode_label
var it=Y.style_mode_label_disabled
var ot=Y.style_rarity
var nt=e("./tutorial").tutorialPosHook
var st=e("./ui_util").INFINITY_SYMBOL
var lt=e("./ui_util")
var _t=e("./ui_util_2")
var ct=_t.BOOST1
var ut=_t.getUIUtil2Sprite
var dt=e("./user_data").worldReadOnly
var ft=e("./voxel_data")
var vt=e("./world_metadata")
var ht=vt.unlimitedMode
var pt=vt.worldConsumables
var mt=e("./worlds_sound").playSound
var Et=Math.ceil,gt=Math.floor,Tt=Math.max,yt=Math.min,St=Math.PI,It=Math.sin,At=Math.sqrt
var wt
var Lt
var Ot
var Rt
var bt=h(1,1,1,.5)
var Nt=h(1,1,1,.5)
var Ct=v
var xt=h(0,1,0,1)
var Mt=550
var Dt=730
var Pt=80
var Bt={type:ae,idx:-1}
function inventoryUIStartup(){wt=We.char_controller
Lt=lt.sprite
Ot=ut()
Rt=ve.font}function inventoryUIInit(){Bt={type:ae,idx:-1}
W()}var kt={}
var Ut={}
var Gt=[]
var Ft
var Wt=300
var Ht=.5
var zt={}
zt[oe+",0"]="qb_gather"
zt[oe+",1"]="qb_gather"
zt[oe+",2"]="qb_gather"
function inventoryAnimate(e,t,r,a){var i=Ut[t]
if(!i||i[3]<ce.frame_index-1)i=kt[t]
if(!i||i[3]<ce.frame_index-1)i=kt[zt[t]]||i
var o=kt[r]
if(!o||o[3]<ce.frame_index-1)o=kt[zt[r]]||o
if(!l(i&&o))return
var n=At(_(i,o))
var s=n*Ht
if(s<8)return
Gt.push({start:ce.frame_timestamp,inv:e,time:yt(Wt,s),dist:n,p0:i,p1:o,suppress:a?r:null})}function animationSuppresses(e){for(var t=0;t<Gt.length;++t)if(Gt[t].suppress===e)return true
return false}function mapInvPos(e,t){_e.equal(typeof e,"string")
var r=t.key_is_src?Ut:kt
var a=r[e]
if(!a||a[3]!==ce.frame_index)r[e]=[t.x,t.y,t.w,ce.frame_index]}function inventoryButtonPrep(e,t){if(!e.h)e.h=e.w
if(e.dynamic_snapshot_on_mouseover){e.dynamic_snapshot=false
if(t&&!t.no_spin)if(ue.mouseOver({x:e.x,y:e.y,w:e.w,h:e.h,peek:true}))e.dynamic_snapshot=true}var r=M(t,e)
e.color=r.color
e.img=r.img
e.uvs=e.frame=r.frame
if("inv_empty"===e.base_name)e.rollover_quiet=true
if(void 0===e.count_override&&e.auto_count&&t){var a=Ne.countAvailable(t)
e.count_override_int=a}else delete e.count_override_int
if(t&&!e.tooltip&&null!==e.tooltip)e.tooltip=t.getBuildName()
e.tooltip_width=e.tooltip_width||600
if(e.key&&!e.no_key_mapping)mapInvPos(e.key,e)}function drawItemCount(e,t){if(e&&(e.getShowCount()||t.force_show_count)&&!t.hide_count){var r=void 0!==t.count_override_int?t.count_override_int:void 0!==t.count_override?t.count_override:e.count
var a=Infinity===r?st:r<0?Ge.$(Ge.INVENTORYUI_AMOUNT_INSUFFICIENT,-r):""+r
if(a!==st){var i=t.label_style||("inv_empty"===t.base_name?it:Rt.styleAlpha(at,ve.button_last_color[3]))
Rt.drawSizedAligned(i,t.x+.12*t.h,t.y,t.z+1,.25*t.h,Rt.ALIGN.HRIGHT|Rt.ALIGN.HFIT|Rt.ALIGN.VBOTTOM,.76*t.h,.88*t.h,a)}}}function itemHPColor(e){return!e?X:e<.1?K:e<.5?q:j}function itemHPStyle(e){return!e?rt:e<.1?et:e<.5?tt:$}var Vt=h()
function drawItemHP(e,t){if(!e||!e.has_hp)return
var r=e.hp_cur
if(t.auto_hp){var a=y(e)
if(!a&&!S(e))return
r=a&&a.hp_cur||0}var i=r/e.hp_max
if(1===i)return
var o=itemHPColor(i)
s(Vt,o)
Vt[3]=ve.button_last_color[3]
ve.progressBar({x:t.x+.1*t.h,w:.8*t.w,y:t.y+.8*t.h,h:.1*t.h,z:t.z+.9,progress:i,color:Vt})
if(!r){var n=.1
Vt[0]=Vt[1]=Vt[2]=1
Lt.draw({x:t.x+t.w*n,y:t.y+t.h*n,w:t.w*(1-2*n),h:t.h*(1-2*n),z:t.z+.5,frame:lt.BROKEN,color:Vt})}}function drawItemRarity(e,t){var r=e&&e.getRarity()
var a=Q[r]
if(!a)return
ve.drawCircle(t.x+t.w/2,t.y+t.h/2,t.z+.001,.2*t.w,0,a)}var Yt=.25
var jt=.05
function drawItemBoostOnly(e,t){var r=e&&e.isBoostBlocked&&e.isBoostBlocked()
if(!r)return
c(Vt,1,1,1,ve.button_last_color[3]*(r===b?.125:1))
Ot.draw({x:t.x+t.h*(1-Yt-jt),y:t.y+t.h*(1-Yt-jt),w:t.h*Yt,h:t.h*Yt,z:t.z+.002,frame:ct,color:Vt})}function inventoryButton(e,t){profilerStart("inventoryButton")
if(e.key&&animationSuppresses(e.key)){t=null
e.base_name="inv_empty"}inventoryButtonPrep(e,t)
var r=ve.buttonImage(e)
drawItemRarity(t,e)
drawItemBoostOnly(t,e)
drawItemCount(t,e)
drawItemHP(t,e)
if(!r&&e.extra_w)if(r=ue.click({x:e.x,y:e.y,w:e.extra_w,h:e.h,button:0}))mt("button_click")
profilerStop("inventoryButton")
return r}function filterIsQuickDepositTarget(e){return e.isQuickDepositTarget()}function quickDeposit(){var e=ft.gatherProps(filterIsQuickDepositTarget,wt.center_pos,O)
if(!e.length){Ze("quick_deposit").setMessage(Ge.STATUSMSG_QUICK_DEPOSIT_FAIL_NO_CONTAINERS)
return}var t=new Array(e.length)
var r=R()
var a=Ae(Te)
var i=false
var o=0
var n
for(var s=0;s<a;++s){var l=r[s]
if(!l)continue
var _=l.count
_e(_)
_e(_<=L)
if(l.stackable)e:for(var c=0;c<e.length;++c){var u=e[c]
var d=u.contents
for(var f=0;f<u.container_size;++f){var v=d[f]
var h=yt(Be(v,l),_)
if(h){n=n||Fe()
Ne.transMerge(n,u,f,Te,s,h)
_-=h
o+=h
t[c]=true
if(!_)break e}}}var p=false
for(var m=0;_&&m<e.length;++m){var E=e[m]
var g=E.contents
var T=-1
var y=false
for(var S=0;S<E.container_size;++S){var I=g[S]
if(!I){if(-1===T)T=S}else if(D(l,I))p=y=true}if(y&&-1!==T){n=n||Fe()
Ne.transMerge(n,E,T,Te,s,_)
t[m]=true
o+=_
_=0
break}}if(p&&_)i=l}var A=0
for(var w=0;w<e.length;++w)if(t[w])++A
if(i)if(o)Ze("quick_deposit_err").setMessage(Ge.STATUSMSG_QUICK_DEPOSIT_FAIL_PARTIAL)
else Ze("quick_deposit_err").setMessage(Ge.STATUSMSG_QUICK_DEPOSIT_FAIL_FULL)
else if(!o)Ze("quick_deposit_err").setMessage(Ge.STATUSMSG_QUICK_DEPOSIT_FAIL_NO_MATCH)
if(n)n.onComplete(function(){Ze("quick_deposit").setMessage(Ge.STATUSMSG_QUICK_DEPOSIT_SUCCESS.$({items:o,containers:A}))})}var Kt=[Ge.INVENTORYUI_INVENTORY,Ge.INVENTORYUI_CONTAINER]
function getDroppedItem(e){var t=ue.dragDrop(e)
if(t&&t.drag_payload&&x(t.drag_payload))return t.drag_payload
return null}var qt
var Zt
function setMouseoverItem(e){qt=e
Zt=ce.frame_index}function getMouseoverItem(){_e(ce.frame_index!==Zt)
if(qt&&Zt===ce.frame_index-1)return qt
return null}var Xt
var Qt
function setSelectedItem(e){Xt=e
Qt=ce.frame_index}function getSelectedItem(){_e(ce.frame_index!==Qt)
if(Xt&&Qt===ce.frame_index-1)return Xt
return null}function canUnequip(e){return Ne.canFit(e)}var $t
function canEquip(e){$t=-1
for(var t=0;t<ge.length;++t)if(ye(t,e)){$t=t
return true}return false}var Jt
var er
var tr
function getDraggedItem(){if(er===ce.frame_index-1){var e=tr.each_data
return Jt&&e[Jt.type][Jt.idx]||null}return null}function doInventorySetupContext(e){var t=e.prop,r=e.recipe,a=e.wgctx,i=e.lgctx
var o=[Te.contents,t&&t.contents||[],T.contents]
var n=[Te,t,T]
var s=[Te.container_size,t&&t.container_size||0,T.container_size]
var l=false
for(var _=0;_<n.length;++_)if(n[_]&&Le(n[_]))l=true
var c
if(er>=ce.frame_index-1)c=Jt
var u=Boolean(t)
if(u&&Bt.type===oe)Bt={type:ae,idx:-1}
return{prop:t,has_container:u,recipe:r,wgctx:a,lgctx:i,each_data:o,each_target:n,each_size:s,any_locked:l,prev_dragged:c}}function ctxTrans(e){if(!e.trans)e.trans=Fe()
return e.trans}function inventorySwap(e,t,r){_e(t.type!==r.type||t.idx!==r.idx)
var a=e.each_target,i=e.each_data
var o=i[t.type][t.idx]
if(o)inventoryAnimate(o,t.type+","+t.idx,r.type+","+r.idx,true)
if(o=i[r.type][r.idx])inventoryAnimate(o,r.type+","+r.idx,t.type+","+t.idx,true)
var n=ctxTrans(e)
Ne.transSwap(n,a[t.type],t.idx,a[r.type],r.idx)
if(t.type===oe&&i[oe][t.idx])z(i[oe][t.idx])
else if(r.type===oe&&i[oe][r.idx])z(i[oe][r.idx])
else if(t.type===oe||r.type===oe)Ke()}fe.register({inventory_sets_quickbar:{usage:"Sets whether or not inventory selection affects quickbar selection",default_value:0,type:a.TYPE_INT,range:[0,1]}})
function inventorySelect(e,t){var r=e.each_data[(Bt=t).type][t.idx]
if(t.type===ae){if(r)if(fe.inventory_sets_quickbar)qe.selectByItem(r)}else if(t.type===oe)if(r&&fe.inventory_sets_quickbar){z(r)
qe.selectGatheringTools()}}function inventoryDeselect(e){e.prev_dragged=null
Jt=null
inventorySelect(e,{type:ae,idx:-1})}function inventoryMerge(e,t,r,a){a=a||L
_e(t.type!==r.type||t.idx!==r.idx)
var i=e.each_data,o=e.each_target
var n=i[r.type][r.idx]
_e(n)
var s=i[t.type][t.idx]
if(s){a=yt(a,L-s.count)
_e(a)}else a=yt(a,L)
if(n.count>a)(n=C(n)).count=a
inventoryAnimate(n,r.type+","+r.idx,t.type+","+t.idx,!s)
var l=ctxTrans(e)
Ne.transMerge(l,o[t.type],t.idx,o[r.type],r.idx,n.count)}function quickTransfer(e,t,r){var a=e.each_data,i=e.each_target
var o=a[t.type][t.idx]
if(!r)r=o.count
var n=t.type===oe?ae:t.type===ae?ie:t.type===ie?ae:_e(false)
var s=Se(i[n],o,r,false)
if(!s)if(o.heavy&&n===ae&&Oe())Xe(Ge.STATUSMSG_QUICK_STORE_FAIL_HEAVY)
else Xe(Ge.$(Ge.STATUSMSG_QUICK_STORE_FAIL_FULL,Kt[n]))
else{for(var l=0;l<s.length;){var _=s[l++]
var c=s[l++]
inventoryMerge(e,{type:n,idx:_},t,c)
r-=c}if(!r)inventoryDeselect(e)}}function unequip(e,t){quickTransfer(e,t)
Ke()}function canEquipFromContainer(e){var t=canEquip(e)
var r=false
var a=false
if(!t)return{can_possibly_equip:t,can_equip:r,should_equip:a}
var i=T.contents[$t]
if(!i&&e.attr1===p.STONE)a=true
if(!i||canUnequip(i))r=true
return{can_possibly_equip:t,can_equip:r,should_equip:a}}function equipFromContainer(e,t){_e(-1!==$t)
var r=T.contents[$t]
var a={type:oe,idx:$t}
if(r)unequip(e,a)
inventorySwap(e,t,a)
inventoryDeselect(e)}function equipDragDroppedItem(e){if(!Jt)return
var t=tr
delete t.trans
var r=t.each_data[Jt.type][Jt.idx]
if(r!==e)return
if(Jt.type===oe)return
var a=canEquipFromContainer(r),i=a.can_possibly_equip,o=a.can_equip
if(!i)return
if(Jt.type===ae){inventorySwap(t,Jt,{type:oe,idx:$t})
inventoryDeselect(t)}else if(Jt.type===ie){if(!o)return
equipFromContainer(t,Jt)}else _e(false)}function acceptsItemEquip(e,t,r){var a
var i
if(t.type===oe){if(!r.inv)return ne
a=t
i=r}else if(r.type===oe&&t.type===ae){if(!t.inv)return se
a=r
i=t}if(a)if(ye(a.idx,i.inv))return le
else return ne
return se}function inventoryUITick(){if(Ft!==ce.frame_index-1){Gt=[]
Ft=ce.frame_index
return}Ft=ce.frame_index
for(var e=Gt.length-1;e>=0;--e){var t=Gt[e]
var r=t.p0,a=t.p1,i=t.start,o=t.inv,n=t.time,s=t.dist
var l=(ce.frame_timestamp-i)/n
if(l>=1){d(Gt,e)
continue}var _=a[1]-r[1]
var c=r[1]+l*_-yt(.2*s,.5*r[2])*It(l*St)
inventoryButton({x:u(l,r[0],a[0]),y:c,z:Z.UI+100,w:r[2],base_name:"inv_active",draw_only:true,item_context:Me},o)}}function doInventorySubOneItem(e,t){var r=e.ctx,a=e.inv_type,i=e.ii,o=e.x,n=e.y,s=e.z,l=e.slot_w,_=e.no_quickbar,c=e.disabled,u=e.quick_transfer_cb,d=e.accepts_item_cb,f=e.split_cb,v=e.quick_transfer_label,h=e.swap_cb,p=e.quick_transfer_label_one,m=e.empty_inv,E=e.colors,g=e.count_override,T=e.allow_empty_select,y=e.label_style,S=e.equip_is_visible,I=e.start_idx,A=e.sortable,w=e.is_trash
if(t){r=r||t.ctx
u=u||t.quick_transfer_cb
d=d||t.accepts_item_cb
S=S||t.equip_is_visible
v=v||t.quick_transfer_label
p=p||t.quick_transfer_label_one
h=h||t.swap_cb
T=T||t.allow_empty_select
_=_||t.no_quickbar
l=l||t.slot_w
I=I||t.start_idx
A=A||t.sortable}p=p||Ge.INVENTORYUI_AMOUNT_ONE
var L=r,O=L.any_locked,R=L.each_data,b=L.each_target,N=L.prev_dragged
var C=R[Bt.type][Bt.idx]
var x=R[a][i]
var M=a===Bt.type&&i===Bt.idx
if(x&&!O&&!x.isAllowedInInventory()&&!dt()){de().serverLog("removed_illegal_item_from_inv",{inv:x,unlimited:ht()})
be(ctxTrans(r),b[a],i)
x=null}var D=false
if(!M&&C&&w&&x){D=true
x=null}var P={x:o,y:n,z:s+2,w:l,h:l,disabled:!x&&!C&&!T||O||c,drag_target:true,key:a+","+i,label_style:y,item_context:Me}
var B=true
if(x&&!O){inventoryButtonPrep(P,x)
x.item_context=Me
var k=ue.drag(pe({payload:x,min_dist:Ee},P))
if(k){inventoryButton(pe({disabled:true,x:k.cur_pos[0]-l/2,y:k.cur_pos[1]-l/2,z:Z.DRAG,base_name:"inv_active",draw_only:true,key_is_src:true},P),x)
C=x
Bt.type=a
Bt.idx=i
M=true
B=false
P.tooltip=null
Jt={type:a,idx:i}
er=ce.frame_index
tr=r}}if(B){P.colors=E
P.count_override=g}e.draw_inv_item=B
P.base_name=M&&B?"inv_selected":x&&B?"inv_active":"inv_empty"
var U=B&&x||m
if(U)if(w)P.tooltip=Ge.$(Ge.TLTP_ITEM_IN_TRASH,U.getName())
else if(_||B&&x&&!De(x))P.tooltip=U.getName()
else P.tooltip=U.getName()+"\n"+je("2-"+(fe.split_build?7:8),Ge.TLTP_PLACE_IN_QB)
var G={type:a,idx:i,inv:x}
var F=se
if(C&&C.heavy&&G.type===ae&&(Bt.type!==G.type||Bt.type===ae&&Bt.idx===we(Te))&&!(G.inv&&G.inv.heavy)&&Oe())F=ne
if(F&&d&&!P.disabled)F=d(r,G,{type:Bt.type,idx:Bt.idx,inv:C})
if(F===le&&(!M||!B)){P.color=xt
P.base_name="inv_highlight"
if(!C&&m)F=ne}else if(F===ne&&N){P.base_name=x||a===ie?"inv_disabled":"inv_empty"
P.disabled=true}if(w){var W=.7
Lt.draw({x:o+(1-W)*l/2,y:n+(1-W)*l/2,z:s+5,w:l*W,h:l*W,frame:lt.TRASH,color:x?Nt:Ct})
P.colors=qe.quickbar_colors_empty}if(a===oe){P.disabled_mouseover=true
if(!x||!B){P.tooltip=Ge.$(Ge.TLTP_EQUIPMENT_SLOT,ge[i].label)
P.tooltip+="\n\n"+(ht()?Ge.TLTP_EQUIPMENT_SLOT_DEFAULT_TOOLS:Ge.TLTP_EQUIPMENT_SLOT_DEFAULT_CRUDE_TOOLS)
var H=.7
Lt.draw({x:o+(1-H)*l/2,y:n+(1-H)*l/2,z:s+3,w:l*H,h:l*H,frame:ge[i].frame,color:bt})}else{P.tooltip=x.getName()+"\n\n"+Ge.$(Ge.TLTP_EQUIPMENT_SLOT,ge[i].label)
if(canUnequip(x)){var z=ue.touch_mode?Ge.INPUT_TAP_DOUBLE:Ge.INPUT_KEY_SHIFT_CLICK
P.tooltip+="\n"+je(z,Ge.TLTP_EQUIPMENT_UNEQUIP)}}}else{if(N&&N.type===oe&&x&&!ye(N.idx,x)){P.base_name="inv_disabled"
P.disabled=true}if(!N&&x&&B&&!w){var V=v||Ge.LBL_TRANSFER
if(S){if(canEquip(x)){var Y=ue.touch_mode?Ge.INPUT_TAP_DOUBLE:Ge.INPUT_KEY_SHIFT_CLICK
P.tooltip+="\n\n"+je(Y,Ge.TLTP_EQUIPMENT_EQUIP)}}else if(u){P.tooltip+="\n"
if(F===le)P.tooltip+="\n"+je(Ge.INPUT_CLICK,V)
if(x.count>1)P.tooltip+="\n"+je(Ge.INPUT_KEY_SHIFT_CLICK,Ge.$(Ge.TLTP_STACK,V))+"\n"+je(Ge.INPUT_KEY_CTRL_CLICK,Ge.separateWords(V,p))
else P.tooltip+="\n"+je(Ge.INPUT_KEY_SHIFT_CLICK,V)}if(x.count>1&&f&&Ne.canSplit(b[a],i,I))P.tooltip+="\n"+je(Ge.INPUT_CLICK_RIGHT,Ge.TLTP_EQUIPMENT_SPLIT_STACK)}}var j=!O&&M&&x&&!dt()
if(j&&B)P.tooltip+=w?"\n"+je(Ge.INPUT_KEY_DEL,Ge.TLTP_TRASH_EMPTY):"\n"+je(Ge.INPUT_KEY_DEL,Ge.TLTP_TRASH)
if(f)P.button_long_press=true
var K=false
if(A&&ue.click({x:P.x,y:P.y,w:P.w,h:P.h,button:1})){Ne.transSort(b[a])
K=true}P.dynamic_snapshot_on_mouseover=Boolean(B&&x)
var q=false
var X=inventoryButton(P,B&&x||m)
if(X&&!K){var Q=ue.keyDown(ue.KEYS.CTRL)||ue.padButtonDown(ue.PAD.RT)
var $=ue.keyDown(ue.KEYS.SHIFT)||ue.padButtonDown(ue.PAD.LT)||!Q&&ve.button_click&&0===ve.button_click.button&&ve.button_click.was_double_click
var J=ve.button_click&&(2===ve.button_click.button||ve.button_click.long_press)
var ee=x&&Et(x.count/2)
var te
if(x&&$&&J&&u&&u(r,G,x,ee))inventoryDeselect(r)
else if(x&&$&&u&&u(r,G,x,Infinity))inventoryDeselect(r)
else if(x&&Q&&u&&u(r,G,x,1))inventoryDeselect(r)
else if(x&&f&&J)f(r,G)
else if(M)inventoryDeselect(r)
else if(x&&C&&(te=Be(x,C))&&F!==ne){inventoryMerge(r,G,Bt,te)
inventoryDeselect(r)}else if(!x&&C&&F!==ne){if(!(h&&h(r,Bt,G))){if(D)be(ctxTrans(r),b[a],i)
inventorySwap(r,Bt,G)}inventoryDeselect(r)}else if(X.drag_drop&&C&&F!==ne){if(!(h&&h(r,Bt,G))){if(D)be(ctxTrans(r),b[a],i)
inventorySwap(r,Bt,G)}inventoryDeselect(r)}else if(F===le){if(!(h&&h(r,Bt,G))){_e(!D)
inventorySwap(r,Bt,G)}inventoryDeselect(r)}else{inventorySelect(r,G)
q=true}Jt=null}else if(j&&!K)if(ue.keyDownEdge(ue.KEYS.DEL)){if(w)be(ctxTrans(r),b[a],i)
else if(b[ae]){var re=Te.container_size-1
if(Te.contents[re])be(ctxTrans(r),b[ae],re)
inventorySwap(r,{type:ae,idx:re},G)}else be(ctxTrans(r),b[a],i)
inventoryDeselect(r)}if(he()&&!w)setMouseoverItem(x)
return q}function splitItem(e,t,r){var a=t.each_target
if(Ne.canSplit(a[r.type],r.idx,e)){var i=ctxTrans(t)
Ne.transSplit(i,a[r.type],r.idx,e)
return true}return false}var rr=f()
function doInventorySub(e){var d=e.ctx,t=e.inv_type,r=e.no_quickbar,a=e.final,i=e.x0,s=e.scale,o=e.info_x,n=e.info_y,l=e.no_buttons,_=e.skip_empty,c=e.hide_trash
var u=e.start_idx||0
var f=d.has_container,v=d.any_locked,h=d.each_data,p=d.each_target
var m=d.each_size[t]
var E=t===ae
if(E)--m
var g=E&&!c
var T=e.z||Z.UI
var y
function drop(e){var t=Ne.getDropPos()
if(!t)Xe(Ge.STATUSMSG_CANNOT_DROP)
else{y=y||Fe()
Ne.transDrop(y,p[e.type],e.idx,t)
if(e.type===oe)Ke()}}function takeAll(e,t){var r=false
var a=h[t]
var i=Ae(p[t])
for(var o=0;o<i;++o){var n=a[o]
if(!n)continue
var s={type:t,idx:o}
var l=Se(p[e],n,n.count,false)
if(l)for(var _=0;_<l.length;){var c=l[_++]
var u=l[_++]
inventoryMerge(d,{type:e,idx:c},s,u)}if(h[t][o])if(!r){r=true
Xe(e?Ge.$(Ge.STATUSMSG_CANNOT_PUT,Kt[e]):h[t][o].heavy&&Oe()?Ge.STATUSMSG_CANNOT_TAKE_HEAVY:Ge.$(Ge.STATUSMSG_CANNOT_TAKE,Kt[e]))}}}var S=e.y
var I=Ve()
var A=te()*s
var w=A
var L=i
if(!r)qe.quickbarScrollView()
var O=Le(p[e.inv_type])
var R=splitItem.bind(null,u)
var b=w+J*s
var N=S
for(var C=u;C<m;++C){if(_&&!h[t][C]){inventoryButtonPrep({x:L,y:S,z:T,w:w,key:t+","+C,item_context:Me})
continue}doInventorySubOneItem({x:L,y:S,z:T,inv_type:t,ii:C,split_cb:R,slot_w:w},e)
L+=b
if(C!==m-1&&(L+w>I||t===oe)){L=i
S+=b}}me(rr,i,N+(S+w-N)/2)
nt("inventory_slots",rr)
if(g){var x=S
if(L+w>I)x+=b
doInventorySubOneItem({x:gt((I-w-i)/b)*b+i,y:x,z:T,inv_type:t,ii:m,slot_w:w,is_trash:true},e)}L=i
S+=w+J*s
var M=re()
if(O){ve.drawRect(i-ee,e.y-ee,I+ee,S,Z.UI+20,Qe)
Rt.drawSizedAligned(Je,i,e.y,Z.UI+21,2*M,Rt.ALIGN.HVCENTERFIT,I-i,S-e.y,Ge.INVENTORYUI_REFRESHING_CONTENTS)}S+=He*s
var D=2*w
var P=.8
var B=i
var k=A*P
function ctxButton(e,t,r,a,i){var o=(r||D)*P
var n=ve.buttonText({x:L,y:S,w:o,h:k,font_height:.5*k,text:e,disabled:t,drag_target:true,tooltip:a,in_event_cb:i&&!ue.touch_mode?ue.pointerLockEnter:null})
if((L+=o+He*s)+D>=I){L=B
S+=k+He*s}return n}var U=h[Bt.type][Bt.idx]
var G=Bt.type===ae&&Bt.idx===Te.container_size-1
if(a&&!l){if(void 0!==o){L=B=o
S=n}var F=2*M*s
var W=M*s
if(U){var H=L+20*s
var z=I
if(Ue()===ke)z-=A+He
Rt.drawSizedAligned(ot[U.getRarity()],H,S,T,F,Rt.ALIGN.HFIT,z-H,0,U.getName()+(U.stackable?" ("+U.count+")":""))
S+=F
var V=U.getDesc()
var Y=L+40*s
for(var j=0;j<V.length;++j)S+=Rt.drawSizedWrapped($e,Y,S,T,z-Y,16*s,W,V[j])}S+=He
if(U){if(f)if(ctxButton([Ge.BTN_PUT,Ge.BTN_TAKE][Bt.type],v)){quickTransfer(d,Bt)
U=null}if(ctxButton(Ge.BTN_DROP,!Ne.canDrop()||O)&&U){drop(Bt)
U=null
inventoryDeselect(d)}if(!G&&ctxButton(Ge.BTN_SPLIT,!Ne.canSplit(p[Bt.type],Bt.idx,u)||O)&&U){y=y||Fe()
Ne.transSplit(y,p[Bt.type],Bt.idx,u)}if(!G&&U&&U.consumable&&pt())if(ctxButton(Ge.BTN_CONSUME,O)){y=y||Fe()
Ne.consumeEx(y,p[Bt.type],Bt.idx,1)}if(ctxButton(Ge.BTN_INFO,O)&&U)xe({x:Mt-Ce,y:te(),auto_close:true,inv:U,context:Me})
if(f&&canEquip(U))if(canEquip(U))if(ctxButton(Ge.BTN_EQUIP,v)){var K={type:oe,idx:$t}
inventorySwap(d,Bt,K)
inventorySelect(d,K)}if(!f&&U&&U.tool_page)if(ctxButton(Ge.BTN_USE,O,null,Ge.TLTP_ADD_QUICKBAR,true)){qe.selectByItem(U)
We.menuExit()}if(Bt.type===ae&&Pe(U)&&ctxButton(Ge.BTN_DRAIN,O)){var q=Re(d.trans,Bt.idx,1)
if(q){d.trans=q
U=null}else Ze("ifull").setMessage(Ge.MSG_INVENTORY_FULL)}}else{var X=f?1.5*A/P:1.5*w
if(ctxButton(Ge.BTN_SORT,O,X,""+je(Ge.INPUT_CLICK_MIDDLE,Ge.TLTP_SORT_AND_STACK)))Ne.transSort(Te)
if(f){if(ctxButton(Ge.BTN_TAKE_ALL,v||Ie(p[ie])))takeAll(ae,ie)
if(ctxButton(Ge.BTN_PUT_ALL,v||Ie(p[ae])))takeAll(ie,ae)}else if(ctxButton(Ge.BTN_QUICK_DEPOSIT,O,3*w,Ge.TLTP_DEPOSIT_ALL_NEARBY))quickDeposit()}L=i
S+=k+He*s}if(a){var Q={x:ze(),y:te(),w:Ve()-ze(),h:Ye()-te(),button:0}
if(ue.click(Q)){U=null
inventoryDeselect(d)}Q.button=1
if(ue.click(Q))Ne.transSort(p[t])
if(U){Q.button=0
ue.dragDrop(Q)
ue.dragOver(Q)
var $
if(Ne.canDrop())if(ue.dragDrop({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity})){drop(Bt)
U=null
inventoryDeselect(d)}else if($=ue.dragOver({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity}))ve.drawTooltip({x:$.cur_pos[0],y:$.cur_pos[1]+20,tooltip:Ge.TLTP_DROP,tooltip_width:100})
setSelectedItem(U)}}e.y=S}function doPaperDollInventoryOverlay(e,t){var r=e.x,a=e.y,i=e.w,o=e.button_h
var n=Z.PAPERDOLL+1
var s=48*o/64
var l=a+8
doInventorySub({ctx:t.ctx,quick_transfer_cb:t.quick_transfer_cb,accepts_item_cb:t.accepts_item_cb,split_cb:t.split_cb,allow_empty_select:true,x0:r+i-te()*t.scale-8,inv_type:oe,y:l+s+24,z:n,final:false,sortable:false,scale:t.scale})
var _=.5*i
E({x:r+(i-_)/2,y:l+s+4,z:n,w:_,h:.5*o,font_height:.5*s,always_show:{stamina:true},verbose:true})}function handlePaperdollDragAndDrop(e){var t=e.x,r=e.y,a=e.w,i=e.h
var o=!(Le(Te)||Le(T))&&getDroppedItem({x:t,y:r,w:a,h:i})
if(o)if(o.is_gather)equipDragDroppedItem(o)
else if(o.consumable&&pt()){var n=tr.each_target
Ne.consumeEx(Fe(),n[Bt.type],Bt.idx,1)}}function quickTransferEquip(e,t,r,a){if(t.type!==oe&&canEquip(r)){var i={type:oe,idx:$t}
inventorySwap(e,t,i)
inventorySelect(e,i)
return true}else if(t.type===oe&&canUnequip(r)){unequip(e,t)
return true}return false}function doInventory(e){var t={ctx:doInventorySetupContext({}),x0:0,inv_type:ae,y:e,final:false,scale:1.15,quick_transfer_cb:quickTransferEquip,accepts_item_cb:acceptsItemEquip,equip_is_visible:true,sortable:true,no_quickbar:fe.split_build&&!fe.quickbar_force_show}
var r={x:0,y:e,w:Mt,h:Dt,button_h:Pt}
if(Ue()===B){t.y=e+Dt+8
t.info_x=Mt+8
t.info_y=e}else t.x0=Mt+8
F(r,t)
if(!dt()){t.final=true
doInventorySub(t)}inventoryUITick()}var ar=6
function computeScale(e,t,r){var a=8
var i=e+ar
var o=Ye()-ar-i
var n=ar
var s=Ve()-ar-n
var l=0
var _=Ve()-l
var c=te()
var u=re()
for(var d=gt((s-(1.5*c+a)+J)/(c+J));;d++){var f=s/(1.5*c+a+d*(c+J)-J)
f=yt(f,1)
var v=Et(t/d)
var h=gt((_/f+J)/(c+J))
var p=Et(r/h)
if(f*Tt((c+J)*v+He,1.5*c+2*a+c+He)+f*((c+J)*p+He)+f*(6*u+He)+f*(c+He)<=o)return f}}function quickTransferContainer(e,t,r,a){quickTransfer(e,t,a)
return true}function doContainer(e){var t=Z.UI
var r=Ve()
var a=U()
if(!a){We.menuExit()
return Ge.INVENTORYUI_MISSING_CONTAINER}var i=ar
var o=e+ar
var n=a.toItem()
n=a.fallback?I(n):n
var s=computeScale(e,a.container_size,we(a))
var l=8*s
var _=te()*s
var c=1.5*_
var u={x:i,y:o,w:c,z:t+2,item_context:N}
inventoryButtonPrep(u,n)
u.img.draw(u)
var d={ctx:doInventorySetupContext({prop:a}),x0:i,inv_type:ie,y:o,no_quickbar:true,sortable:true,scale:s,quick_transfer_cb:quickTransferContainer}
var f=.8*_
if(ve.buttonText({x:i,y:o+=c+l,w:c,h:f,font_height:.5*f,text:Ge.BTN_SORT,tooltip:""+je(Ge.INPUT_CLICK_MIDDLE,Ge.TLTP_SORT_AND_STACK),disabled:Le(a),drag_target:false}))Ne.transSort(a)
o+=_+l+He*s
d.x0=i+=c+l
doInventorySub(d)
d.y=Tt(d.y,o)
ve.drawBox({x:0,y:e,w:r,h:d.y-e-He*s+ar,z:t},ve.sprites.section_border,.5,v)
d.x0=0
d.inv_type=ae
d.final=true
doInventorySub(d)
inventoryUITick()
return n.getName()}},{"../common/globals":248,"../common/materials_common":253,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/settings":351,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./build_mode":33,"./huds":104,"./inventory":114,"./item_info_view":117,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./paperdoll":151,"./quickbar":172,"./status":193,"./styles":197,"./tutorial":203,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./voxel_data":216,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],116:[function(e,t,r){"use strict"
r.setLastModProp=setLastModProp
r.startup=startup
r.shift=shift
r.removeIncoming=removeIncoming
r.tickItemAnims=tickItemAnims
r.add=add
var v=e("assert")
var a=e("../glov/client/engine")
var i=e("../glov/client/quat")
var o=i.createQuat
var c=i.qRotateZ
var u=i.qSlerp
var n=e("../glov/common/util")
var s=n.clamp
var d=n.easeIn
var l=n.empty
var _=n.isInteger
var h=n.ridx
var f=n.sign
var p=e("../glov/common/vmath")
var m=p.unit_vec
var E=p.v3add
var g=p.v3addScale
var T=p.v3copy
var y=p.v3iAdd
var S=p.v3iFloor
var I=p.v3lerp
var A=p.v3same
var w=p.v3scale
var L=p.v3sub
var O=p.v4copy
var R=p.vec3
var b=e("../common/globals")
var N=b.CHUNK_SIZE
var C=b.CS2
var x=e("../common/ids").ITEM_BAG
var M=e("../common/voxel_data_common")
var D=M.ANIM_STYLE_BEAM
var P=M.ANIM_TYPE_PLAYER
var B=M.ANIM_TYPE_POS
var k=e("./inventory").inventoryOverlap
var U=e("./items")
var G=U.createItem
var F=U.itemEqualLoose
var W=U.itemPotentiallyMergeable
var H=e("./mobs").getEntityAnimPos
var z=e("./props")
var V=z.PROP_GRAVITY
var Y=z.PROP_TERMINAL_VELOCITY
var j=z.bagCalcDrawOffs
var K=z.bagDraw
var q=e("./voxel_data")
var Z=q.chunkIdFromLocalFloatPos
var X=q.getPropLighting
var Q=q.getPropLocalExact
var $=Math.min,J=Math.exp,ee=Math.random
var te=[]
var re={}
v(Y)
var ae=V/Y
var ie=250
var oe=null
function setLastModProp(e){oe=e}function startup(){}function shift(e){for(var t=0;t<te.length;++t){var r=te[t]
y(r.src_pos,e)
if(r.src_type===B)y(r.src_int_pos,e)
if(r.target_type===B){y(r.target_pos,e)
y(r.target_int_pos,e)}y(r.pos,e)}}function animRemove(e,t){if(void 0!==t)v.equal(te[t],e)
var r=re[e.chunk_id]
var a=r[e.pos_idx]
v(a)
h(a,a.indexOf(e))
if(!a.length){delete r[e.pos_idx]
if(l(r))delete re[e.chunk_id]}if(void 0!==t)h(te,t)}var ne=R()
function animAdd(e,t){e.chunk_id=Z(ne,e.target_pos)
S(ne)
e.pos_idx=ne[0]+ne[1]*N+ne[2]*C
var r=re[e.chunk_id]
if(!r)r=re[e.chunk_id]={}
var a=r[e.pos_idx]
if(!a)a=r[e.pos_idx]=[]
a.push(e)
if(!t)te.push(e)}function animUpdatePos(e){var t=Z(ne,e.target_pos)
S(ne)
var r=ne[0]+ne[1]*N+ne[2]*C
if(t===e.chunk_id&&r===e.pos_idx)return
if(t!==e.chunk_id){animRemove(e)
e.chunk_id=t
e.pos_idx=r
animAdd(e,true)}else{var a=re[e.chunk_id]
var i=a[e.pos_idx]
h(i,i.indexOf(e))
if(!i.length)delete a[e.pos_idx]
e.pos_idx=r
if(!(i=a[e.pos_idx]))i=a[e.pos_idx]=[]
i.push(e)}}function removeIncoming(e,t,r,a){var i=re[t]
if(!i)return e
var o=i[r]
if(!o)return e
v(o.length)
var n=e
for(var s=0;s<o.length;++s){var l=o[s]
l.target_quat=a
for(var _=0;_<l.contents.length;++_){var c=l.contents[_]
var u=c.count
for(var d=n.length-1;d>=0;--d){var f=n[d]
if(F(c,f)){if(n===e)n=e.map(G)
h(n,d)
break}else if(W(c,f)){if(n===e)n=e.map(G)
if(u===f.count){h(n,d)
break}else if(u<f.count){n[d].count-=u
break}else if(u>f.count){h(n,d)
u-=f.count}}}}}if(!n.length){o[0].driving_animation=true
O(a,o[0].quat)}return n}function v3IsInteger(e){return _(e[0])&&_(e[1])&&_(e[2])}var se=R(0,0,.005)
function addDrawOffs(e,t){var r=Q(t)
var a
if(r&&!A(r.size,m)){var i=.4
g(e,t,m,i)
e[0]+=ee()*(r.size[0]-2*i)
e[1]+=ee()*(r.size[1]-2*i)
e[2]+=ee()*(r.size[1]-2*i)-i
a=.002*ee()-.001}else{var o=(15&t[0])+(15&t[1])*N+(15&t[2])*C
a=j(o,se)
E(e,t,se)}return a}function ItemAnim(e){v(e)
v(e.style)
v(e.target_type)
v(e.target)
v(e.src_type)
v(e.src)
v(e.item||e.items)
this.style=e.style
this.valid=true
this.rot_speed=0
this.target_type=e.target_type
if(this.target_type===P){this.target_id=e.target
this.target_pos=R()}else{this.target_int_pos=e.target.slice(0)
v(v3IsInteger(this.target_int_pos))
this.target_pos=R()
this.rot_speed=addDrawOffs(this.target_pos,e.target)}this.src_type=e.src_type
if(this.src_type===P){this.src_pos=H(e.src)
if(!this.src_pos){this.valid=false
return}this.src_pos=this.src_pos.slice(0)}else{this.src_int_pos=e.src.slice(0)
v(v3IsInteger(this.src_int_pos))
this.src_pos=R()
var t=addDrawOffs(this.src_pos,e.src)
if(!this.rot_speed)this.rot_speed=t
if(e.from_center)this.src_pos[2]+=.5}this.pos=this.src_pos.slice(0)
if(e.item){v(!e.items)
e.items=[e.item]}this.contents=e.items.map(G)
this.counter=0
this.quat=o()
this.target_quat=null
this.draw_opts={}}var le=R()
ItemAnim.prototype.launch=function(){if(this.style===D);else{this.t=0
L(le,this.target_pos,this.src_pos)
this.vel=w(R(),le,1.25*ae)
var e=le[2]+.5
this.vel[2]=.0015+.006*s(e,-1,1)}}
ItemAnim.prototype.tick=function(e){if(this.target_type===P){var t=H(this.target_id)
if(!t)return true
T(this.target_pos,t)
animUpdatePos(this)}var r=false
this.counter+=e
if(this.style===D){if(this.counter>=ie)r=true
var a=d($(this.counter/ie,1),2)
I(this.pos,a,this.src_pos,this.target_pos)
if(this.target_quat)u(this.quat,a,this.quat,this.target_quat)}else{this.t+=e
var i=J(-this.t*ae)
var o=false
for(var n=0;n<2;++n)if(this.vel[n]){this.pos[n]=this.src_pos[n]+this.vel[n]/ae*(1-i)
if(f(this.vel[n])===f(this.pos[n]-this.target_pos[n])){this.vel[n]=0
this.pos[n]=this.target_pos[n]}else o=true}else this.pos[n]=this.target_pos[n]
if(this.vel[2]){this.pos[2]=this.src_pos[2]+(this.vel[2]-Y)/ae*(1-i)+Y*this.t
var s=this.vel[2]*i+Y*(1-i)
if(this.pos[2]<this.target_pos[2]&&s<0){this.pos[2]=this.target_pos[2]
this.vel[2]=0}else o=true}else this.pos[2]=this.target_pos[2]
if(!o)r=true
if(this.target_quat)if(this.driving_animation){c(this.quat,this.quat,e*this.rot_speed)
this.driving_animation=false}else u(this.quat,$(1,this.t/500),this.quat,this.target_quat)}var l=this.draw_opts.sun_factor
var _=this.draw_opts.torch_factor
X(this.draw_opts,this.target_pos)
if(!this.draw_opts.sun_factor)this.draw_opts.sun_factor=l||0
if(!this.draw_opts.torch_factor)this.draw_opts.torch_factor=_||0
K(this.pos,this,true)
return r}
function tickItemAnims(){if(!te.length)return
var e=a.frame_dt
for(var t=te.length-1;t>=0;--t){var r=te[t]
if(r.tick(e))animRemove(r,t)}}function add(e){var t=new ItemAnim(e)
if(!t.valid)return
if(t.src_type===B)for(var r=te.length-1;r>=0;--r){var a=te[r]
if(a.target_type===B&&A(a.target_int_pos,t.src_int_pos)){var i=k(t.contents,a.contents)
if(i){v(i.length)
if(!a.contents.length)animRemove(a,r)
e.item=null
e.items=[]
var o=new ItemAnim(e)
o.contents=i
T(o.src_pos,a.pos)
T(o.pos,a.pos)
O(o.quat,a.quat)
o.launch()
animAdd(o)}}}if(t.contents.length){if(t.src_type===B){var n=Q(t.src_int_pos)||oe
if(n&&n.item_id===x)O(t.quat,n.quat)}t.launch()
animAdd(t)}}},{"../common/globals":248,"../common/ids":249,"../common/voxel_data_common":264,"../glov/client/engine":305,"../glov/client/quat":346,"../glov/common/util":400,"../glov/common/vmath":402,"./inventory":114,"./items":119,"./mobs":145,"./props":171,"./voxel_data":216,assert:void 0}],117:[function(e,t,r){"use strict"
r.itemInfoViewClear=itemInfoViewClear
r.itemInfoViewing=itemInfoViewing
r.itemInfoViewShow=itemInfoViewShow
r.itemInfoViewPush=itemInfoViewPush
r.itemCustomizationAny=itemCustomizationAny
r.itemCustomizationClear=itemCustomizationClear
r.itemCustomized=itemCustomized
r.itemInfoViewDraw=itemInfoViewDraw
r.itemInfoViewTick=itemInfoViewTick
r.ITEM_INFO_VIEW_H=r.ITEM_INFO_VIEW_W=void 0
var R=450
r.ITEM_INFO_VIEW_W=R
var b=700
r.ITEM_INFO_VIEW_H=b
var we=e("assert")
var N=e("../glov/client/camera2d")
var C=e("../glov/client/engine")
var Le=e("../glov/client/font").ALIGN
var a=e("../glov/client/input")
var Oe=a.inputClick
var x=a.mouseDownAnywhere
var M=a.mouseDownOverBounds
var Re=a.pointerLockEnter
var D=a.pointerLocked
var be=e("../glov/client/input")
var Ne=e("../glov/client/markdown").markdownAuto
var Ce=e("../glov/client/scroll_area").scrollAreaCreate
var xe=e("../glov/client/ui")
var i=e("../glov/client/ui")
var Me=i.uiButtonHeight
var De=i.uiButtonWidth
var s=e("../glov/common/verify")
var o=e("../glov/common/vmath")
var u=o.vec2
var n=o.vec4
var Pe=e("../common/entitlements").propToEntitlementKey
var Be=e("../common/globals").STACK_SIZE
var l=e("../common/ids")
var _=l.ITEM_INGOT
var ke=l.TYPE_CRAFT_CLASS
var Ue=l.TYPE_ITEM
var Ge=l.TYPE_RECIPE
var Fe=l.TYPE_SETTLEMENT_UPGRADE
var We=e("../common/items_common").itemHasUnlockMethod
var c=e("../common/materials_common")
var He=c.CraftClass
var ze=c.Mat
var Ve=e("./blueprint").blueprintGetDef
var Ye=e("./blueprint_manage").blueprintMetaEdit
var je=e("./build_menu").buildMenuIsOpenAndIconView
var d=e("./crafting_recipes")
var Ke=d.craftingRecipes
var qe=d.getItemExamples
var Ze=e("./factory_ui").drawZoomed
var f=e("./inventory")
var Xe=f.countAvailable
var Qe=f.giveItemsFromUI
var v=e("./inventory_ui")
var $e=v.inventoryButton
var Je=v.inventoryButtonPrep
var h=e("./items")
var et=h.ITEM_CONTEXT_BUILD
var tt=h.ITEM_CONTEXT_ITEM
var rt=h.ITEM_CONTEXT_MATERIAL_CHOICE
var at=h.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var it=h.createItem
var p=h.createItemLite
var ot=h.isItem
var nt=h.itemIsBlueprint
var m=h.itemIsPlaceable
var st=h.itemIsSettlementLocked
var lt=h.itemIsUnlimited
var _t=h.sameItem
var P=e("./layout").layoutCameraTallWide
var ct=e("./localization/localization").L
var ut=e("./main")
var dt=e("./main").menuExit
var B=e("./menu")
var E=e("./quickbar")
var g=E.selectByItem
var T=E.setQuickItem
var y=e("./styles")
var ft=y.inventory_style
var vt=y.inventory_style_warn
var ht=y.label_style
var pt=y.menu_header_style
var S=e("./todo_list")
var k=S.TODO_TOGGLE
var U=S.todoIsInList
var mt=S.todoListActive
var G=S.todoListAdd
var F=S.todoTooltip
var Et=e("./ui_util")
var I=e("./user_data")
var gt=I.giveItemsAllowed
var Tt=I.unlimitedItemsAllowed
var yt=e("./world_comm").getPerm
var St=e("./world_metadata").worldSettlements
var It=Math.ceil,At=Math.max,wt=Math.floor
var Lt=null
var A=null
var Ot={}
var w=p({type:ke,id:He.FUEL})
function isFuelCraftClass(e){return _t(e,w)}function itemInfoViewClear(){A=Lt
Lt=null}var L
function itemInfoMap(e,t){if(e.recipe_item)e=e.recipe_item
if(!m(e)&&t!==rt)t=tt
if(e.type===ke&&e.id===He.SCALED_INGOT)e=L=L||it({type:Ue,id:_,attr1:ze.ANY})
if(e.has_hp&&e.hp_cur<e.hp_max)(e=it(e)).hp_cur=e.hp_max
return{inv:e,context:t}}function itemInfoViewing(e,t){var r=itemInfoMap(e,t),a=r.inv,i=r.context
return Lt&&_t(itemCustomized(Lt.inv),a)&&Lt.context===i||A&&A.last_frame>=C.frame_index-1&&_t(itemCustomized(A.inv),a)}function itemInfoViewShow(e){var t=e.x,r=e.y,a=e.auto_close,i=e.is_future,o=e.hint,n=e.allow_customize,s=e.for_quick_slot
var l=itemInfoMap(e.inv,e.context),_=l.inv,c=l.context
if(Lt&&Lt.last_frame>=C.frame_index-1&&_t(Lt.inv,_)||A&&A.last_frame===C.frame_index&&_t(A.inv,_)){itemInfoViewClear()
return}we(c)
if(!m(_))c=tt
Lt={pos:u(t,r),inv:_,frame:C.frame_index,last_frame:C.frame_index,context:c,stack:[_],context_stack:[c],auto_close:a,is_future:i,hint:o,allow_customize:n,for_quick_slot:s}
if(Ot[0])Ot[0].resetScroll()}function itemInfoViewPush(e,t){if(!Lt){itemInfoViewShow({inv:e,context:t,x:(N.w()-R)/2,y:(N.h()-b)/2,auto_close:true})
return}if(Ot[Lt.stack.length])Ot[Lt.stack.length].resetScroll()
var r=itemInfoMap(e,t),a=r.inv,i=r.context
Lt.stack.push(a)
Lt.context_stack.push(i)
Lt.inv=a
Lt.context=i}function itemInfoViewPop(){we(Lt.stack.length>1)
Lt.stack.pop()
Lt.context_stack.pop()
Lt.inv=Lt.stack[Lt.stack.length-1]
Lt.context=Lt.context_stack[Lt.context_stack.length-1]}var Rt=4
var W=8
var bt=16
var Nt=n(1,1,1,.2)
function itemCustomizeableMatMapKeys(e){var t=e.cost_mat_map
if(!t)return null
var r=[]
for(var a in t){var i=t[a]
var o=e.cost[i.cost_idx]
if(o.type===Ue){var n=i.target_attr3?o.attr3:o.attr1
if(!n||n===ze.ANY)r.push(a)}else if(o.type===ke)if(o.id===He.STONE_RAW);else r.push(a)
else{s(false)
r.push(a)}}return r.length?r:null}function itemCustomizable(e){var t=itemCustomizeableMatMapKeys(e)
return Boolean(t&&t.length)}var Ct={}
var xt=null
function itemCustomizationAny(){for(var e in Ct){var t=Ct[e].attr_items
for(var r=0;r<t.length;++r)if(t[r])return true}return false}function itemCustomizationClear(){if(!xt)Ct={}
else{var e=xt[0]
for(var t in Ct)if(t!==e)delete Ct[t]
else{Ct[t].attr_items=[]
Ct[t].item_cache=null}}}function itemCustomized(e){var t=e.type+":"+e.id+":"+e.attr3
var r=Ct[t]
if(!r)return e
if(!r.item_cache){var a=false
var i={type:e.type,id:e.id,attr3:e.attr3}
for(var o=0;o<r.attr_items.length;++o){var n=r.attr_items[o]
if(!n)continue
a=true
var s=r.attr_keys[o]
var l=e.cost_mat_map[s]
we(l)
if(l.target_attr3)i[s]=n.attr3
else i[s]=n.getMaterial()
we.equal(typeof i[s],"number")}if(a)r.item_cache=it(i)
else r.item_cache=e}return r.item_cache}function showCost(e,t,r){r=r||t
if(!lt(t)){var a=Xe(t,false,true)
if(a<r.count){e.base_name="inv_empty"
e.style=vt}e.count_override=a+" / "+r.count}else e.hide_count=true}function selectCustomizedItem(e,t){if(t)T(itemCustomized(e))
else g(itemCustomized(e))}function itemInfoViewDraw(e){var I=e.x,t=e.y0,A=e.z,r=e.w,a=e.h,i=e.context,w=e.inv,o=e.has_stack,n=e.is_future,s=e.scroll_idx,L=e.style,l=e.zoom,_=e.hint,c=e.allow_customize,O=e.for_quick_slot
var R=t
var b=xe.font
var N=xe.font_height
c=0===s&&c&&itemCustomizable(w)
var u=w
var d=false
if(c){d=1===w.cost.length
w=itemCustomized(w)}var f=i===et?w.getBuildName():w.getName()
var C=i===rt
var x=C
var v=C?tt:i
var h=w.getDesc(false,v)
var p
if(v===tt&&w.isCrafted())p=w.getCraftCost()
var m=w
var E=w.type===Ge
var g
if(E)if(g=Ke()[w.attr1])m=g.icon
var T=200
var y={x:I+(r-T)/2,y:R,w:T,h:T,z:A,shrink:1,draw_only:true,hide_count:true,item_context:v}
if(w.type===Fe){y.frame=Et.ARROW
y.rot=Math.PI
y.y+=y.h
y.x+=y.w
Et.sprite.draw(y)}else if("unlock"===L&&!Lt){y.dynamic_snapshot=true
y.base_name="inv_info"
y.shrink=.921
y.ignore_no_spin=true
$e(y,m)}else{y.dynamic_snapshot=true
Je(y,m)
if(y.frame){var S=.1*y.h
y.y+=S
y.h-=S
y.x+=S/2
y.w-=S}y.img.draw(y)}var M=R+=T+8
var D
if(void 0!==l&&l<1){D=b.getStringWidth(pt,1.5*xe.font_height,f)
Ze(l,b,pt,pt,I,R,A+1,1.5*xe.font_height,Le.HCENTERFIT,r,null,f)}else D=b.drawSizedAligned(pt,I,R,A+1,1.5*xe.font_height,Le.HCENTERFIT,r,0,f)
R+=1.5*xe.font_height
D=At(D,b.drawSizedAligned(pt,I,R,A,xe.font_height,Le.HCENTERFIT,r,0,v===et?ct.LBL_ITEM_CONTEXT_BUILD:v===at?ct.LBL_ITEM_CONTEXT_SETTLEMENT_UPGRADE:E?ct.LBL_ITEM_CONTEXT_RECIPE:ct.LBL_ITEM_CONTEXT_ITEM))
R+=xe.font_height
var P=2.5*xe.font_height
var B=I+(r-D)/2-P-8
Et.sprite.draw({x:At(I,B),y:M,z:A,w:P,h:P,frame:v===et?Et.BUILD:v===at?Et.HOME:E?Et.CRAFTING:Et.INVENTORY,color:B<I-12?Nt:void 0})
R+=Rt
var k=Ot[s]
if(!k)k=Ot[s]=Ce({background_color:null,auto_hide:true})
var U={x:I,y:R,z:A,w:r,h:t+a-R}
k.begin(U)
var G=r-k.barWidth()
I=R=0
var F=nt(w)&&Ve(w.getBID())
if(F&&(F.loaded||F.error))R=Ye(R,G,w,F)
if(_)R+=b.drawSizedWrapped(ht,I,R,A,G,bt,xe.font_height,_)+Rt
if(!w.silhouette)for(var W=0;W<h.length;++W)R+=Ne({font_style:ht,x:I,y:R,z:A,w:G,indent:bt,align:Le.HWRAP,text_height:xe.font_height,text:h[W]}).h+Rt
var H=false
var z=Me()
var V=z+2
function gridShow(e,t,r,a){var i=false
var o=e?4:"unlock"===L&&t.length>2?3:2
var n=(G-(o-1)*Rt)/o
var s=I
var l=R
for(var _=0;_<t.length;++_){var c=t[_]
if(!ot(c))c=t[_]=it(c)
I=s+_%o*(n+Rt)
R=l+wt(_/o)*V
var u={x:I,y:R,z:A,w:z,h:z,extra_w:n,base_name:"inv_active",style:ft,item_context:tt}
if(e)u.tooltip=c.getName()
else if(C)u.tooltip=ct.TLTP_USE_THIS_MATERIAL
else if(c.isCrafted()&&c.attr1!==ze.ANY)u.tooltip=ct.TLTP_VIEW_CRAFT_COST
else u.tooltip=ct.TLTP_VIEW_ITEM_INFO
var d=false
var f=false
if(!a&&C&&!i){u.button=2
u.in_event_cb=Re
if(Oe(u))f=d=true
delete u.phys
delete u.button
delete u.in_event_cb}if(!a&&C&&!x){var v=xt,h=v[0],p=v[1]
var m=Ct[h].attr_items[p]
if(c.isAny()){if(!m)d=true}else if(m&&_t(m,c))d=true
if(O)d=true
if(d)u.in_event_cb=Re}r(u,c)
if(($e(u,c)||f)&&!i){i=true
if(a)a(c)
else if(C){var E=xt,g=E[0],T=E[1],y=E[2]
if(c.isAny())Ct[g].attr_items[T]=null
else{var S=it(c)
S.count=w.count
Ct[g].attr_items[T]=S}Ct[g].item_cache=null
selectCustomizedItem(y,O)
if(x&&!d)itemInfoViewPop()
else if(d){itemInfoViewClear()
dt()}}else itemInfoViewPush(c,tt)}if(!e)b.drawSizedAligned(u.style,I+u.w+4,R,A,N,Le.VCENTER|Le.HWRAP|Le.HFIT,n-u.w-5,V,c.getName())}I=s
R=l+It(t.length/o)*V}function drawItemInfoDesc(e){return b.drawSizedWrapped(ft,I,R,A+1,G,bt,N,e)+Rt}function drawItemInfoWarning(e){return b.drawSizedWrapped(vt,I,R,A+1,G,bt,N,e)+Rt}var Y=false
if(v===et||v===at){H=true
var j=w.cost_compact||w.cost
if(F)if(!F.loaded)j=[]
else j=F.cost
var K=false
if(w.silhouette){H=false
R+=drawItemInfoWarning(ct.TLTP_LOCKED_ITEM)
if(We(w,"lf_break"))R+=drawItemInfoWarning(ct.TLTP_LOCKED_ITEM_LF_BREAK)
if(yt("sysadmin")){if(xe.buttonText({x:I,y:R,z:A,w:.5*De(),h:.75*z,text:"Admin: Unlock Item"})){var q=Pe(w.id,w.attr1,w.attr2,w.attr3)
ut.chat_ui.cmdParse("csr_grant "+q)
Y=true}R+=.75*z+Rt}}else{if(v===et){var Z=Xe(w)
K=!(n&&!o)
if(!Z&&K)R+=drawItemInfoWarning(ct.ITEMINFO_CANT_AFFORD_ALERT)
if(w.is_settlement_locked&&St()){R+=drawItemInfoWarning(ct.MSG_OUT_OF_SETTLEMENT_ALERT)
if(st(w)){H=false
R+=drawItemInfoWarning(ct.ITEMINFO_SETTLEMENT_LOCKED_ALERT)}}if(We(w,"lf_break")){R+=drawItemInfoDesc(ct.TLTP_UNLOCKED_ITEM_LF_BREAK)
if(yt("sysadmin")){if(xe.buttonText({x:I,y:R,z:A,w:.5*De(),h:.75*z,text:"Admin: Lock Item"})){var X=Pe(w.id,w.attr1,w.attr2,w.attr3)
ut.chat_ui.cmdParse("csr_grant "+X+" revoke")
Y=true}R+=.75*z+Rt}}}if(w.unlimited_only)R+=drawItemInfoWarning(ct.ITEMINFO_UNLIMITED_ONLY_ALERT)
else if(j&&!w.unlimited_only){if(c){R+=Rt
R+=drawItemInfoDesc(ct.addColon(d?ct.LBL_CUSTOMIZATION_OPTIONS:ct.LBL_CUSTOMIZE))
var Q=w.type+":"+w.id+":"+w.attr3
var $=Ct[Q]=Ct[Q]||{attr_keys:itemCustomizeableMatMapKeys(w).filter(function(e){if(u[e]&&u[e]!==ze.ANY)return false
return true}),attr_items:[],item_cache:null}
var J=$.attr_keys,ee=$.attr_items
if(d){we.equal(J.length,1)
var te=J[0]
var re=u.cost_mat_map[te]
var ae=u.cost[re.cost_idx]
var ie=ae.id
if(ae.type===Ge)ie=ae.attr1
var oe=qe(ae.type,ie)
we(oe.length>0)
if(!Tt())oe=[ae].concat(oe)
if(oe.length>0){we(!C)
xt=[Q,0,u]
var ne=(C=true,oe.length>8)&&je()
var se=ee[0]
gridShow(ne,oe,function(e,t){showCost(e,t,ae)
if(_t(se,t)||!se&&t.isAny())e.base_name="inv_selected"
else if("inv_active"===e.base_name)e.base_name="inv_customize"
else if("inv_empty"===e.base_name)e.base_name="inv_customize_empty"})
C=false}}else{var le=[]
for(var _e=0;_e<J.length;++_e){var ce=J[_e]
var ue=w.cost_mat_map[ce]
var de=w.cost[ue.cost_idx]
if(ee[_e])le.push(ee[_e])
else le.push(de)}gridShow(false,le,function(e,t){var r=le.indexOf(t)
we(-1!==r)
showCost(e,t)
if(ee[r]){e.base_name="inv_selected"
e.tooltip=ct.TLTP_CLEAR_MATERIAL}else{if("inv_active"===e.base_name)e.base_name="inv_customize"
else if("inv_empty"===e.base_name)e.base_name="inv_customize_empty"
e.tooltip=ct.TLTP_CHOOSE_MATERIAL}},function(e){var t=le.indexOf(e)
we(-1!==t)
if(ee[t]){ee[t]=null
$.item_cache=null
selectCustomizedItem(u,O)}else{xt=[Q,t,u]
itemInfoViewPush(e,rt)}})}}R+=Rt
R+=drawItemInfoDesc(ct.addColon(v===et?c?ct.LBL_BUILD_COST_TOTAL:ct.LBL_BUILD_COST:ct.LBL_REQUIRES))
gridShow(nt(w)&&je(),j,function(e,t){if(!lt(w)){var r=Xe(t,false,true)
if(r<t.count&&K){e.base_name="inv_empty"
e.style=vt}e.count_override=r+" / "+t.count}})}}}else{if(gt()&&"unlock"!==L){var fe
if(E)fe=m
else fe=w
if(fe&&fe.count>=Be)(fe=it(fe)).count=1
if(fe&&fe.isAllowedInInventory()&&w.stackable){var ve=.5*De()
var he=w.stackable?10:1
if(xe.buttonText({x:I+(r-ve)/2,y:R,z:A,w:ve,h:.75*z,font_height:1.5*xe.font_height,text:ct.BTN_GIVE_ME.$({count:he})})){var pe=it(fe)
pe.count=he
Qe(pe)}R+=.75*z+Rt}}if(!(E?1:Xe(w))&&w.tool_page)R+=drawItemInfoWarning(ct.ITEMINFO_NOT_IN_INVENTORY_ALERT)
var me=w.getInfo()
if(me)R+=drawItemInfoDesc(me)
if(E){we(g)
R+=drawItemInfoDesc(g.desc+".")}var Ee=w.recipe_list&&w.attr1===ze.ANY&&!C
if(Ee){R+=drawItemInfoDesc(ct.addColon(ct.LBL_EXAMPLES))
gridShow(false,w.recipe_list.map(function(e){return Ke()[e].icon}),function(e,t){e.hide_count=true})}else if(w.isCrafted()&&!C){H=true
R+=drawItemInfoDesc(p&&p.count>1?ct.addColon(ct.$(ct.LBL_CRAFT_FROM_AMOUNT,p.count)):ct.addColon(ct.LBL_CRAFT_FROM))
gridShow(false,p,function(e,t){if(!Tt()&&!isFuelCraftClass(t))showCost(e,t)})
if(p.at_factory&&p.at_factory.length){R+=b.drawSizedColorWrapped(ft,I,R,A+1,G,bt,N,255,ct.addColon(ct.LBL_CRAFTED_BY))+Rt
for(var ge=0;ge<p.at_factory.length;++ge){var Te=it({type:Ue,id:p.at_factory[ge]})
var ye={x:I,y:R,z:A,w:z,extra_w:G,hide_count:true,base_name:"inv_active",tooltip:ct.TLTP_VIEW_BUILD_INFO,item_context:et}
if($e(ye,Te))itemInfoViewPush(Te,et)
b.drawSizedAligned(ft,I+ye.w+8,R,A,N,Le.VCENTER|Le.HWRAP,G-ye.w-8,V,Te.getName())
R+=V}}}if(w.type===ke||w.type===Ge||w.has_inv_variants&&w.attr1===ze.ANY&&!Ee){var Se=w.id
if(w.type===Ge)Se=w.attr1
var Ie=qe(w.type,Se)
if(Ie.length>0){R+=b.drawSizedColorWrapped(ft,I,R,A+1,G,bt,N,255,ct.addColon(C?ct.LBL_CUSTOMIZATION_OPTIONS:ct.LBL_EXAMPLES))+Rt
gridShow(C&&Ie.length>8&&je(),Ie,function(e,t){if(w.type===ke&&w.id===He.FUEL)e.count_override=""+t.getFuelRate()
else if(C){showCost(e,t,w)
if("inv_active"===e.base_name)e.base_name="inv_customize"
else if("inv_empty"===e.base_name)e.base_name="inv_customize_empty"}else e.hide_count=true})}}}k.end(R)
I=e.x
var Ae=be.click(U)
if(Ae&&2===Ae.button)Y=true
if(!mt()||C)H=false
return{pinnable:H,dismiss:Y}}function itemInfoViewTick(){if(!Lt)return
var e=Lt,t=e.inv,r=e.pos,a=e.frame,i=e.last_frame,o=e.context,n=e.stack,s=e.auto_close,l=e.is_future,_=e.hint,c=e.allow_customize,u=e.for_quick_slot
var d=D()
if(i<C.frame_index-1||d&&Lt.last_frame_locked){itemInfoViewClear()
return}N.push()
P()
Lt.last_frame_locked=d
Lt.last_frame=C.frame_index
if(r[0]+R>N.x1())r[0]=N.x1()-R
if(r[1]+b>N.y1())r[1]=N.y1()-b
if(r[0]<N.x0())r[0]=N.x0()
if(r[1]<N.y0())r[1]=N.y0()
var f=Z.ITEM_INFO_VIEW
var v=r[0]
var h=v+W
var p=R-2*W
var m=r[1]
var E=n.length>1
var g=itemInfoViewDraw({scroll_idx:n.length-1,x:h,y0:m,z:f,w:p,h:b-W,has_stack:E,is_future:l,context:o,inv:t,hint:E?null:_,allow_customize:c,for_quick_slot:u}),T=g.dismiss,y=g.pinnable
var S=.75*Me()
if(E)if(xe.buttonText({x:v+W,y:m+W,z:f+2,w:S,h:S,font_height:S,text:"←"})||be.keyDownEdge(be.KEYS.BACKSPACE))itemInfoViewPop()
if(y){var I=itemCustomized(t)
if(I.place_as_id)I=it({type:I.type,id:I.place_as_id,attr1:I.attr1,attr2:I.attr2,attr3:I.attr3})
if(xe.buttonImage({x:h+p-2*S-8,y:m+W,z:f+2,w:S,h:S,img:Et.sprite,frame:U(I,o)?Et.PINNED:Et.PIN,tooltip:F(I,o)}))G(I,o,k)}if(xe.buttonImage({x:h+p-S,y:m+W,z:f+2,w:S,h:S,img:Et.sprite,frame:Et.X})||!E&&be.keyDownEdge(be.KEYS.BACKSPACE))T=true
var A=C.frame_index!==a
var w={x:v,y:m,w:R,h:b}
if(be.drag(w));if(A&&!B.active()&&!M(w)&&x())T=true
if(A&&ut.chat_ui.isFocused())T=true
var L={x:v,y:m,z:f-1,w:R,h:b,pixel_scale:.25,color:B.panel_color_popup}
if(be.click(L))T=true
var O=!(B.active()&&B.isBuildMenu())
if(A&&s&&be.click({peek:true})||O&&be.keyDownEdge(be.KEYS.ESC)||T)itemInfoViewClear()
xe.panel(L)
N.pop()}},{"../common/entitlements":244,"../common/globals":248,"../common/ids":249,"../common/items_common":251,"../common/materials_common":253,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/markdown":332,"../glov/client/scroll_area":349,"../glov/client/ui":367,"../glov/common/verify":401,"../glov/common/vmath":402,"./blueprint":28,"./blueprint_manage":29,"./build_menu":32,"./crafting_recipes":68,"./factory_ui":95,"./inventory":114,"./inventory_ui":115,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./quickbar":172,"./styles":197,"./todo_list":202,"./ui_util":205,"./user_data":208,"./world_comm":226,"./world_metadata":235,assert:void 0}],118:[function(e,t,r){"use strict"
r.itemUnlockGetNew=itemUnlockGetNew
r.itemUnlockIsNew=itemUnlockIsNew
r.itemUnlockClearNew=itemUnlockClearNew
r.showItemUnlock=showItemUnlock
r.itemUnlockTick=void 0
var w=e("../glov/client/camera2d")
var L=e("../glov/client/engine")
var O=e("../glov/client/font")
var R=e("../glov/client/ui")
var a=e("../glov/client/ui")
var b=a.uiButtonHeight
var N=a.uiTextHeight
var i=e("../glov/common/util")
var C=i.easeIn
var x=i.easeOut
var M=i.ridx
var o=e("../common/entitlements")
var n=o.entitlementGet
var s=o.propToEntitlementKey
var l=e("../common/ids").TYPE_ITEM
var D=e("./inventory_ui").inventoryButtonPrep
var _=e("./items")
var P=_.ITEM_CONTEXT_ITEM
var c=_.createItem
var B=e("./localization/localization").L
var u=e("./styles")
var k=u.colorAlpha
var U=u.color_black_75
var G=u.color_white
var F=u.color_white_50
var W=u.unlock_prompt_style
var d=e("./world_comm").getPerm
var H=e("./worlds_sound").playSound
var z=Math.max
var f=5e3
var V=1e3
var Y=600
var j=.5
var K=.75
var q=1
var X=2
var Q=1.6
var $=20
var J=40
var ee=30
var te=[]
var v=function(){function ItemUnlockToast(e,t,r,a){this.inv=void 0
this.counter=0
this.bounce_counter=0
this.lifespan=f
this.style=void 0
this.counter=0
this.lifespan=f
this.inv=c({type:l,id:e,attr1:t,attr2:r,attr3:a})}ItemUnlockToast.itemUnlockTick=function itemUnlockTick(){var e=w.w()*j
var t=w.h()*K
var r=Z.ITEM_UNLOCK
for(var a=te.length-1;a>=0;--a){var i=te[a]
if(0===i.counter)H("item_unlock")
i.counter+=L.frame_dt
i.bounce_counter+=L.frame_dt
if(i.counter>=i.lifespan){M(te,a)
continue}var o=W
var n=1
var s=i.lifespan-V
if(i.counter>s){n=1-C((i.counter-s)/V,2)
o=O.styleAlpha(o,n)}i.style=o
var l=i.bounce_counter<Y?2-x(i.bounce_counter/Y,2):1
var _=N()*q*l
var c=N()*X*l
var u=b()*Q*l
var d=$*l
var f=J*l
var v=ee*l
var h=R.font.getStringWidth(o,_,B.ITEMUNLOCK_NEW_ITEM)
var p=R.font.getStringWidth(o,c,i.inv.getBuildName())
var m=z(h,p)
var E=u+v+m+f
var g=e-E/2
var T=t
var y={x:g,y:T,w:u,z:r+2,item_context:P}
D(y,i.inv)
y.color=k(G,n)
if(y.img)y.img.draw(y)
R.drawCircle(y.x+y.w/2,y.y+y.w/2,r-1,.5*u,0,k(F,n))
var S=g+u+v
var I=_+c
var A=T+u/2-I/2
L.font.drawSizedAligned(o,S,A,r+1,_,O.ALIGN.HCENTER,m,0,B.ITEMUNLOCK_NEW_ITEM)
L.font.drawSizedAligned(o,S,A+_,r+1,c,O.ALIGN.HCENTER,m,0,i.inv.getBuildName())
R.drawBox({x:g+.2*u,y:T+u/2-I/2-d,w:E-.2*u,h:2*d+I,z:r},R.sprites.panel,.5,k(U,n))
return}}
return ItemUnlockToast}()
var h=v.itemUnlockTick
r.itemUnlockTick=h
var p=[]
function filterOwned(e){return(d("owned")||{})[e]}function itemUnlockGetNew(r){var e=p.filter(filterOwned)
if(r)e=e.filter(function(e){var t=n(e)
if(t&&1===t.length&&"prop"===t[0].type)return t[0].tab===r
return false})
return e}function itemUnlockIsNew(e){return p.includes(e)}function itemUnlockClearNew(e){var t=p.indexOf(e)
if(-1!==t)M(p,t)}function showItemUnlock(e,t,r,a){var i=s(e,t,r,a)
p.push(i)
te.unshift(new v(e,t,r,a))}},{"../common/entitlements":244,"../common/ids":249,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/ui":367,"../glov/common/util":400,"./inventory_ui":115,"./items":119,"./localization/localization":131,"./styles":197,"./world_comm":226,"./worlds_sound":236}],119:[function(e,t,r){"use strict"
r.itemLocalizationStartup=itemLocalizationStartup
r.createItemLite=createItemLite
r.parseAttribMods=parseAttribMods
r.Item=Item
r.craftClassAndMatToItem=craftClassAndMatToItem
r.itemPropEntitlementKey=itemPropEntitlementKey
r.itemIsAccountLocked=itemIsAccountLocked
r.itemIsFullBucket=itemIsFullBucket
r.getItemsForCraftClass=getItemsForCraftClass
r.createItem=createItem
r.getItemsForMatAny=getItemsForMatAny
r.getItemsForRecipe=getItemsForRecipe
r.itemPrototypePoke=itemPrototypePoke
r.itemCheckBakeRules=itemCheckBakeRules
r.itemCheck=itemCheck
r.isItem=isItem
r.itemFromJSON=itemFromJSON
r.itemIsBlueprint=itemIsBlueprint
r.itemIsBlueprintReady=itemIsBlueprintReady
r.addItemAdjectives=addItemAdjectives
r.leapgateName=leapgateName
r.itemPotentiallyMergeable=itemPotentiallyMergeable
r.itemPartiallyMergeable=itemPartiallyMergeable
r.itemFullyMergeable=itemFullyMergeable
r.satisfiesCost=satisfiesCost
r.satisfiesCostLoose=satisfiesCostLoose
r.itemEqualLoose=itemEqualLoose
r.itemEqual=itemEqual
r.itemIsUnlimited=itemIsUnlimited
r.itemIsSettlementLocked=itemIsSettlementLocked
r.itemIsPlaceable=itemIsPlaceable
r.itemIsAllowedInQuickbar=itemIsAllowedInQuickbar
r.notLiquid=notLiquid
r.snapshotOverLimit=snapshotOverLimit
r.itemGetGfx=itemGetGfx
r.itemGetGfxQueued=itemGetGfxQueued
r.itemsTick=itemsTick
r.startup=startup
r.sprite_blueprint_bg=r.mode_list_block_size=r.ITEM_ID_DESC=r.ITEM_ID_NAME=r.BOOST_BLOCKED_CURRENTLY=r.BOOST_BLOCKED_UNBLOCKED=r.BOOST_BLOCKED_NO=r.ITEM_CONTEXT_MATERIAL_CHOICE=r.ITEM_CONTEXT_SETTLEMENT_UPGRADE=r.ITEM_CONTEXT_ITEM=r.ITEM_CONTEXT_BUILD=r.TOOL_BASE_HP=r.sameItem=r.DYNAMIC_COST_FUNCS=r.COST_FUNCS=r.BRUSH_SIZES=void 0
var a,i
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var o=e("../glov/common/vmath")
var n=o.unit_vec
var s=o.v2set
var l=o.v2sub
var _=o.vec2
var c=o.vec3
var u=o.zero_vec
var d=e("../common/items_common")
var f=d.itemIsReleased
var h=d.processItemVariants
var p=d.processUnlockableVariants
var m=d.sameItem
var E={def:n,"1x1":n,"2x2":c(2,2,2),"3x3":c(3,3,3),"2x1":c(2,2,1),"3x1":c(3,3,1)}
r.BRUSH_SIZES=E
var g={}
r.COST_FUNCS=g
var T={}
r.DYNAMIC_COST_FUNCS=T
var y=m
r.sameItem=y
var S=2e3
r.TOOL_BASE_HP=S
var U=1
r.ITEM_CONTEXT_BUILD=U
var I=2
r.ITEM_CONTEXT_ITEM=I
var A=3
r.ITEM_CONTEXT_SETTLEMENT_UPGRADE=A
var w=3
r.ITEM_CONTEXT_MATERIAL_CHOICE=w
var L=0
r.BOOST_BLOCKED_NO=L
var O=1
r.BOOST_BLOCKED_UNBLOCKED=O
var R=2
r.BOOST_BLOCKED_CURRENTLY=R
var b=[]
r.ITEM_ID_NAME=b
var N=[]
r.ITEM_ID_DESC=N
var C=e("assert")
var x=e("../glov/client/camera2d")
var M=e("../glov/client/engine")
var D=e("../glov/client/error_report").errorReportSetDetails
var G=e("../glov/client/localization").getStringFromLocalizable
var P=e("../glov/client/sprites").spriteCreate
var B=e("../glov/common/data_error").dataError
var k=e("../glov/common/rand_alea").randCreate
var F=e("../glov/common/util")
var W=F.arrayToSet
var H=F.cloneShallow
var z=F.empty
var V=F.isInteger
var Y=F.merge
var j=F.ridx
var K=e("../glov/common/verify")
var q=e("../glov/common/words/profanity_common").isProfane
var Z=e("../common/entitlements")
var X=Z.propToEntitlementKey
var Q=Z.registerItemEntitlements
var $=e("../common/globals").STACK_SIZE
var J=e("../common/ids")
var ee=J.INV_ITEM_NAME
var te=J.ITEM_ANEMONE
var re=J.ITEM_ANEMONE_PILE
var ae=J.ITEM_ARBORHEART
var ie=J.ITEM_BERRY
var oe=J.ITEM_BLOCK_PREVIEW
var ne=J.ITEM_BLUEPRINT
var se=J.ITEM_BOTTLE
var le=J.ITEM_BUCKET
var _e=J.ITEM_CARROT
var ce=J.ITEM_CHEST_MEDIUM
var ue=J.ITEM_CORAL_TUBES
var de=J.ITEM_CORN
var fe=J.ITEM_DISC_CORAL
var ve=J.ITEM_DOWSER_ADVANCED
var he=J.ITEM_DOWSER_SIMPLE
var pe=J.ITEM_FENCE
var me=J.ITEM_GROW
var Ee=J.ITEM_HANDSTOOL
var ge=J.ITEM_HATCHET
var Te=J.ITEM_HOE
var ye=J.ITEM_ID_CODE_NAME
var Se=J.ITEM_INGOT
var Ie=J.ITEM_JUICE
var Ae=J.ITEM_LEAPGATE_SHARD
var we=J.ITEM_LIQUID
var Le=J.ITEM_MUSHROOM
var Oe=J.ITEM_ORE
var Re=J.ITEM_PICKAX
var be=J.ITEM_PIE
var Ne=J.ITEM_PLANT
var Ce=J.ITEM_PUMPKIN
var xe=J.ITEM_ROAST_SEAFOOD
var Me=J.ITEM_ROAST_VEGETABLES
var De=J.ITEM_ROD
var Pe=J.ITEM_SANDWICH
var Be=J.ITEM_SAPLING
var ke=J.ITEM_SEASHELL
var Ue=J.ITEM_SHOVEL
var Ge=J.ITEM_SPICE
var Fe=J.ITEM_STARFISH
var We=J.ITEM_STARFISH_PILE
var He=J.ITEM_TOMATO
var ze=J.ITEM_TOOL_HEAD
var Ve=J.ITEM_UNKNOWNID
var Ye=J.ITEM_WAYGATE
var je=J.ITEM_WILD_CROP
var Ke=J.TYPE_BLOCK
var qe=J.TYPE_CRAFT_CLASS
var Ze=J.TYPE_ITEM
var Xe=J.TYPE_RECIPE
var Qe=J.TYPE_SETTLEMENT_UPGRADE
var $e=e("../common/materials_common")
var Je=$e.CraftClass
var et=$e.Mat
var tt=e("../common/world_constants").ATTRIB_FIXED_MAX
var rt=e("./app_access").accessPrerelease
var at=e("./autogen/item_defs")
var it=e("./baking").assertBakeRuleExists
var ot=e("./blueprint").blueprintGetDef
var nt=e("./build_menu").blueprintMetaName
var st=e("./build_mode").doStamina
var lt=e("./crafting").craftClassMatches
var _t=e("./crafting_mods")
var ct=_t.CMODS
var ut=_t.CMOD_FORMAT
var dt=_t.CMOD_TABLE
var ft=_t.RARITY_LABEL
var vt=e("./crafting_recipes")
var ht=vt.craftingRecipes
var pt=vt.getCraftCost
var mt=e("./dowser_advanced").DOWSER_ADVANCED_BASE_LEN
var Et=e("./dowser_simple").DOWSER_SIMPLE_BASE_LEN
var gt=e("./flora_constants")
var Tt=gt.FLOWERS
var yt=gt.VALID_PLANT_SEEDS
var St=e("./inventory")
var It=St.INV_PLAYER
var At=St.canFit
var wt=St.transInvAdd
var Lt=e("./localization/localization").L
var Ot=e("./main")
var Rt=e("./materials")
var bt=Rt.CRAFT_CLASS_DESC
var Nt=Rt.CRAFT_CLASS_ICON
var Ct=Rt.CRAFT_CLASS_NAME
var xt=Rt.INV_MATERIAL_NAME
var Mt=Rt.INV_MATERIAL_TIER
var Dt=Rt.IS_ALLOY
var Pt=Rt.LAST_LOCALIZED_MATERIAL_CLASS
var Bt=Rt.MATERIAL2_DURABILITY_FACTOR
var kt=Rt.MATERIAL2_STAMINA_FACTOR
var Ut=Rt.MATERIAL_CLASS
var Gt=Rt.MATERIAL_CLASS_ADJ
var Ft=Rt.MATERIAL_CLASS_NAME
var Wt=Rt.MATERIAL_CODE_NAME
var Ht=Rt.MATERIAL_DURABILITY_FACTOR
var zt=Rt.MATERIAL_MAX_STONE_TIER
var Vt=Rt.MATERIAL_NAME
var Yt=Rt.MATERIAL_TIER
var jt=Rt.MATERIAL_TOOL_DIG_RATE
var Kt=Rt.MATERIAL_UNLIMITED_SPECIAL
var qt=Rt.METAL_TIERS
var Zt=Rt.MaterialClass
var Xt=e("./proc_gen").oreLowestStoneTier
var Qt=e("./props")
var $t=e("./props")
var Jt=$t.PREVIEW_SNAPSHOT_BUILD
var er=$t.PREVIEW_SNAPSHOT_ITEM
var tr=e("./saplings.js").SAPLING_KEY_NAMES
var rr=e("./saplings_shared").SAPLING_TO_MAT
var ar=e("./settlement")
var ir=ar.settlementCurrent
var or=ar.settlementLastBound
var nr=e("./status")
var sr=e("./stone_tiers")
var lr=sr.STONE_TIER_DEPTH
var _r=sr.STONE_TIER_NAMES
var cr=e("./tiles")
var ur=e("./tiles").TILE_WATER
var dr=e("./ui_util")
var fr=e("./ui_util").STAMINA_SYMBOL
var vr=e("./user_data")
var hr=vr.unlimitedItemsAllowed
var pr=vr.userAttribModMaxTrans
var mr=vr.userDataGet
var Er=vr.userDataIsWaiting
var gr=vr.userStaminaMod
var Tr=e("./waygate_upgrade").WAYGATE_UPGRADES
var yr=e("./world_comm").getPerm
var Sr=e("./world_metadata")
var Ir=Sr.worldBoostLevelForProps
var Ar=Sr.worldConsumables
var wr=Sr.worldSettlements
var Lr=Math.ceil,Or=Math.floor,Rr=Math.max,br=Math.min,Nr=Math.round
var Cr=cr.tile_map_default
C(Cr)
var xr=["1x1","2x2","3x3"]
r.mode_list_block_size=xr
var Mr=["1x1","2x1","3x1"]
var Dr=[]
Dr[Ee]=["1x1"]
var Pr=[]
var Br=[" ","flip"]
var kr=[]
kr[Re]=[]
kr[Re][Zt.STONE]=1
kr[Re][Zt.METAL]=1
kr[ge]=[]
kr[ge][Zt.WOOD]=1
kr[Ue]=[]
kr[Ue][Zt.DIRT]=1
kr[Ue][Zt.INGREDIENT]=1
kr[Ue][Zt.COLOR]=1
kr[Ee]=[]
kr[Ee][Zt.DIRT]=.33
kr[Ee][Zt.WOOD]=1
kr.flint_blade=[]
kr.flint_blade[Zt.WOOD]=1
kr.flint_blade[Zt.STONE]=.5
var Ur=[]
Ur[le]=true
Ur[we]=true
var Gr=[]
Gr[Re]=Lt.LBL_HAFT
Gr[ge]=Lt.LBL_HAFT
Gr[Ue]=Lt.LBL_HAFT
Gr[Te]=Lt.LBL_HAFT
var Fr=((a={})[et.BLUE_BERRY]=ie,a[et.RED_BERRY]=ie,a[et.YELLOW_BERRY]=ie,a[et.CORN]=de,a[et.TOMATO]=He,a[et.PUMPKIN]=Ce,a[et.CARROT]=_e,a[et.BROWN_MUSHROOM]=Le,a[et.LUMINESCENT_MUSHROOM]=Le,a[et.RED_MUSHROOM]=Le,a[et.CORAL_MUSHROOM]=Le,a[et.ANEMONE]=re,a[et.STARFISH]=We,a[et.HOT]=Ge,a[et.PUNGENT]=Ge,a[et.SAVORY]=Ge,a)
function itemLocalizationStartup(){for(var e=0;e<=Pt;++e){var t=Zt[e]
var r=Lt.get("MATERIAL_CLASS_"+t+"_NAME")
C(r,"Unlocalized Material Class name.")
Ft[e]=r
r=Lt.get("MATERIAL_CLASS_"+t+"_ADJ")
C(r,"Unlocalized Material Class name.")
Gt[e]=r}for(var a in Wt){var i=Wt[a]
if("ANY"!==i&&"NONE"!==i){var o=xt[i]
var n=Lt.get("MAT_"+i+"_NAME")
C(n,"Unlocalized Material name.")
Vt[o]=n}}for(var s=0;s<lr.length;++s){var l=Lt.get("STONE_TIER_T"+s)
C(l,"Unlocalized Stone Tier name.")
_r[s]=l}var _=1
var c=Je[_]
while("string"===typeof c){var u=Lt.get("CRAFT_CLASS_"+c+"_NAME")
var d=Lt.get("CRAFT_CLASS_"+c+"_DESC")
C(u,"Unlocalized Craft Class name.")
Ct[_]=u
bt[_]=d
c=Je[++_]}for(var f in cr.tile_code_name){var v=Lt.get("TILES_"+cr.tile_code_name[f]+"_NAME")
var h=Lt.get("TILES_"+cr.tile_code_name[f]+"_NAME_BLOCK")
var p=Lt.get("TILES_"+cr.tile_code_name[f]+"_INFO")
cr.tile_name[f]=v
cr.tile_name_block[f]=h
cr.tile_info[f]=p}for(var m in cr.liquid_code_name){var E=Lt.get("TILES_"+cr.liquid_code_name[m]+"_NAME")
cr.liquid_name[m]=E}for(var g=0;g<ye.length;++g){var T=ye[g]
if(T){var y=Lt.get(T+"_NAME")
var S=Lt.get(T+"_DESC")
b[g]=y
N[g]=S}}}var Wr
var Hr
r.sprite_blueprint_bg=Hr
var zr={}
var Vr={}
var Yr={}
function ItemLite(e){C(e.type)
C.equal(typeof e.id,"number")
this.type=e.type
this.id=e.id
this.count=e.count||1
this.attr1=e.attr1||0
this.attr2=e.attr2||0
this.attr3=e.attr3||0
C(!e.attribs)}ItemLite.prototype.attribs=null
function createItemLite(e){return new ItemLite(e)}var jr=function(){var e=[]
for(var t in Cr){t=Number(t)
if(!isFinite(t))continue
var r=Cr[t].inv
C(r)
var a=[]
for(var i=0;i<r.length;++i)a.push(new ItemLite(r[i]))
e[t]=a}return e}()
var Kr=[]
g.identity=function identity(e,t){t=t||1
C(!e.attr2)
var r=e.id+","+e.attr1+","+e.attr3+","+t
var a=Kr[r]
if(!a)a=Kr[r]=new ItemLite({type:Ze,id:e.id,attr1:e.attr1,attr3:e.attr3,count:t})
return a}
g.item=function item(e){return new ItemLite(e)}
g.fromMaterial=function fromMaterial(e,t,r){var a=t+r
C(a)
C(!(t&&r))
var i=e.attr1||e.def_material
if(Ut[i]===Zt.METAL)return new ItemLite({type:Ze,id:Se,attr1:i,count:a})
if(Ut[i]===Zt.STONE)if(i===et.STONE)return new ItemLite({type:qe,id:Je.STONE_RAW,count:a})
else return new ItemLite({type:qe,id:Je.BRICK,count:a})
var o
if(r)o=Cr.material_crafted_map[i]
if(!o){o=Cr.material_map[i]
if(!K(o))o=Cr.material_map[et.WOOD]}return new ItemLite({type:Ke,id:o,count:a})}
g.fromByMat=function(e){var t=e.cost_by_mat
if(t&&!Array.isArray(t))if((t=t[e.attr1]||t.def)&&!Array.isArray(t))t=t[e.attr3]||t.def
C(t)
C(Array.isArray(t))
C.equal(t.length,1)
return new ItemLite(t[0])}
g.oreOrIngot=function oreOrIngot(e,t,r){var a=e.attr1||e.def_material
if(Dt[a])return new ItemLite({type:Ze,id:Se,attr1:a,count:r})
else return new ItemLite({type:Ze,id:Oe,attr1:a,count:t})}
T.waygate=function(){if(wr()&&!Er()&&!mr("used_free_settlement"))return[]
return this.cost}
function parseAttribMods(e){var t={}
for(var r in e)t[ct[r]]=e[r]
return t}function Item(e){this.type=e.type
this.id=e.id
this.preview_item=Vr
this.initBase(e)}Item.prototype.name=null
Item.prototype.build_name=null
Item.prototype.desc=null
Item.prototype.info=null
Item.prototype.is_item=true
Item.prototype.color=null
Item.prototype.need_thumbnail_update=true
Item.prototype.loading_gfx=Vr
Item.prototype.mode_list=null
Item.prototype.mode_list_ids=null
Item.prototype.pick_as_id=null
Item.prototype.pick_as_mode=null
Item.prototype.place_as_id=null
Item.prototype.flippable=false
Item.prototype.brush_size=null
Item.prototype.stackable=true
Item.prototype.heavy=false
Item.prototype.is_gather=false
Item.prototype.is_tool=false
Item.prototype.is_ladder=false
Item.prototype.is_lighting=false
Item.prototype.consumable=false
Item.prototype.consume_attribs=null
Item.prototype.placeable=true
Item.prototype.cost=null
Item.prototype.dynamic_cost=null
Item.prototype.cost_by_mat=null
Item.prototype.is_crafted=false
Item.prototype.no_spin=false
Item.prototype.potentially_unlimited=false
Item.prototype.allowed_in_inventory=false
Item.prototype.allowed_in_quickbar=true
Item.prototype.quickbar_default_build=null
Item.prototype.no_attribs=false
Item.prototype.no_attr1=false
Item.prototype.no_attr2=false
Item.prototype.no_attr3=false
Item.prototype.rooted=false
Item.prototype.perched=false
Item.prototype.ground_filter=null
Item.prototype.intangible=true
Item.prototype.intangible_mat_map=null
Item.prototype.tangible_height=null
Item.prototype.always_interact=false
Item.prototype.clickable=true
Item.prototype.mineable=true
Item.prototype.size=c(1,1,1)
Item.prototype.size_auto=false
Item.prototype.no_auto_rot=false
Item.prototype.flips_on_x=false
Item.prototype.see_through=false
Item.prototype.baked_key=null
Item.prototype.baked_key_resource=null
Item.prototype.mat_baked_key=null
Item.prototype.baked_keys_inhand=null
Item.prototype.mat_baked_keys_inhand=null
Item.prototype.boosted_key=null
Item.prototype.baked_key_backup=null
Item.prototype.ignore_boost_level=false
Item.prototype.stage_baked_key=null
Item.prototype.override_stage_baked_key=false
Item.prototype.stage_preview=null
Item.prototype.stage_start=0
Item.prototype.stage_spawn=0
Item.prototype.growth_max_stage=null
Item.prototype.growth_heights=null
Item.prototype.growth_period=1
Item.prototype.is_waterable=false
Item.prototype.watering_sound="bucket_water_crops"
Item.prototype.harvest_results=null
Item.prototype.harvest_results_exclusive=false
Item.prototype.harvest_reverting_stage=-1
Item.prototype.harvest_pickable_stage=null
Item.prototype.harvest_limit=null
Item.prototype.harvest_full_sound="plant_harvest"
Item.prototype.harvest_empty_sound="plant_harvest_empty"
Item.prototype.growstick_chat=["MSG_GROW_GENERIC1","MSG_GROW_GENERIC2","MSG_GROW_GENERIC3","MSG_GROW_GENERIC4","MSG_GROW_GENERIC5","MSG_GROW_GENERIC6","MSG_GROW_GENERIC7","MSG_GROW_GENERIC8","MSG_GROW_GENERIC9","MSG_GROW_GENERIC10","MSG_GROW_GENERIC11","MSG_GROW_GENERIC12","MSG_GROW_GENERIC13"]
Item.prototype.growstick_chat_extra_chance=0
Item.prototype.growstick_chat_extra=null
Item.prototype.preview_block_map=null
Item.prototype.preview_block_id=0
Item.prototype.on_flow="through"
Item.prototype.on_unflow="through"
Item.prototype.underwater_only=false
Item.prototype.snapshot_size=null
Item.prototype.is_container=false
Item.prototype.ignore_take=false
Item.prototype.craft_classes=null
Item.prototype.craft_classes_on_instance=false
Item.prototype.has_inv_variants=false
Item.prototype.definitive_examples=null
Item.prototype.examples=null
Item.prototype.tool_page=false
Item.prototype.is_ingredient_with_no_recipes=false
Item.prototype.is_settlement_locked=false
Item.prototype.is_recipe=false
Item.prototype.recipe_list=null
Item.prototype.floater_z=0
Item.prototype.unlock_display_item=null
Item.prototype.place_rot=0
Item.prototype.place_rot_random=false
Item.prototype.def_material=0
Item.prototype.unlimited_only=false
Item.prototype.unlimited_only_for_build_menu=false
Item.prototype.unlockable_variants=null
Item.prototype.variable_yield=false
Item.prototype.sysadmin_only=false
Item.prototype.next_release=false
Item.prototype.next_release_variants=null
Item.prototype.fuel_rate_map=null
Item.prototype.fuel_rate=0
Item.prototype.dig_rate=0
Item.prototype.cost_mat_map=null
Item.prototype.attribs=null
Item.prototype.has_hp=false
Item.prototype.hp_vis_scale=1
Item.prototype.particles_always_on_in_unlimited=false
Item.prototype.progress_indicator=true
Item.prototype.any_as_material_class=false
Item.prototype.attr3_as_num=false
Item.prototype.name_no_attr3=false
Item.prototype.initBase=function(e){this.count="number"===typeof e.count?e.count:1
this.attr1=e.attr1||0
this.attr2=e.attr2||0
this.attr3=e.attr3||0
for(var t in e.attribs){C(!this.stackable)
var r=e.attribs[t]
K(r)
K(V(r))
if(!this.attribs)this.attribs={}
this.attribs[t]=r}}
Item.prototype.initBaked=function(){this.baked_key=this.mat_baked_key[this.attr1]||this.mat_baked_key.def
if("string"!==typeof this.baked_key)this.baked_key=this.baked_key[this.attr3]||this.baked_key.def}
Item.prototype.initBakedInhand=function(){this.baked_keys_inhand=this.mat_baked_keys_inhand[this.attr1]||this.mat_baked_keys_inhand.def
if(!Array.isArray(this.baked_keys_inhand))this.baked_keys_inhand=this.baked_keys_inhand[this.attr3]||this.baked_keys_inhand.def}
Item.prototype.initBoostedKey=function(){if(this.is_preview||!this.boosted_key)return
if(this.baked_key_backup)this.baked_key=this.baked_key_backup
if(this.ignore_boost_level)return
var e=Ir()
var t=this.boosted_key[e]
if(!t)return
var r=t[this.attr1]
if(!r)return
if("string"!==typeof r)r=r[this.attr3]||r.def
if(r){this.baked_key_backup=this.baked_key_backup||this.baked_key
this.baked_key=r}}
Item.prototype.isBoostBlocked=function(){if(!this.boosted_key)return L
var e=this.boosted_key[0]
var t=e&&e[this.attr1]
if(t&&"string"!==typeof t)t=t[this.attr3]||t.def
if(!t)return L
var r=Ir()
if(!r)return R
if((t=(e=this.boosted_key[r])&&e[this.attr1])&&"string"!==typeof t)t=t[this.attr3]||t.def
if(t)return R
else return O}
Item.prototype.initIntangible=function(){var e=this.intangible_mat_map[this.attr1]
if(void 0===e)e=this.intangible_mat_map.def
if("object"===typeof e){var t=e[this.attr3]
if(void 0===t)t=e.def
e=t}this.intangible=e}
Item.prototype.initPreviewBlock=function(){this.preview_block_id=this.preview_block_map[this.attr1]||this.preview_block_map.def}
Item.prototype.initFuelRate=function(){this.fuel_rate=void 0!==this.fuel_rate_map[this.attr1]?this.fuel_rate_map[this.attr1]:this.fuel_rate_map.def||0}
var qr=function(){var e={}
for(var t in Cr){var r=Cr[t]
if(r.craft_class&&r.mat&&!r.not_material_source){var a=e[r.craft_class]=e[r.craft_class]||{}
C(!a[r.mat])
a[r.mat]=Number(t)}}e[Je.STONE_RAW][et.FANCY_STONE]=cr.STONE_LIGHT
return e}()
function craftClassAndMatToItem(e,t,r,a){if(!a)if(e===Je.ROD_METAL||e===Je.ROD_WOOD)return new ItemLite({type:Ze,id:De,attr1:t,count:r})
var i=qr[e]
C(i)
var o=i[t]
if(a)return o
if(!o&&!M.DEBUG)for(var n in i){o=i[n]
break}C(o)
return new ItemLite({type:Ke,id:o,count:r})}Item.prototype.updateCostFromMatMap=function(){for(var e in this.cost_mat_map){var t=this[e]
if(t&&t!==et.ANY){var r=this.cost_mat_map[e]
var a=this.cost[r.cost_idx]
if(a.type===Ze)if(r.target_attr3)a.attr3=t
else a.attr1=t
else if(a.type===qe)this.cost[r.cost_idx]=craftClassAndMatToItem(a.id,t,a.count)
else C(0)}}this.cost_compact=this.compactCost()}
Item.prototype.compactCost=function(){var e=this.cost
for(var t=0;t<e.length;++t){var r=e[t]
for(var a=e.length-1;a>t;--a){var i=e[a]
if(y(r,i)){if(e===this.cost)r=(e=this.cost.map(createItem))[t]
r.count+=i.count
j(e,a)}}}return e}
Item.prototype.updateCraftClassesFromMat=function(){if(!this.craft_classes_on_instance){this.craft_classes_on_instance=true
var e=this.craft_classes
this.craft_classes={}
for(var t in e)this.craft_classes[t]=true}var r=this.craft_class_map[this.attr1]||this.craft_class_map.def
C(Array.isArray(r))
for(var a=0;a<r.length;++a){var i=r[a]
this.craft_classes[i]=true}}
Item.prototype.attribSet=function(e,t){if(!t){if(this.attribs){delete this.attribs[e]
if(z(this.attribs))delete this.attribs}}else{if(!this.attribs)this.attribs={}
this.attribs[e]=t}}
Item.prototype.attribGet=function(e){return this.attribs&&this.attribs[e]||0}
Item.prototype.getStaminaRate=function(){return(kt[this.attr2]||1)*(2-(dt[ct.STAMINA_RATE][this.attribGet(ct.STAMINA_RATE)]||1))}
Item.prototype.calcHP=function(){var e=1
if(this.attr1!==et.ANY){e=Ht[this.getMaterial()]||.1
if(this.id===me&&this.getMaterialClass()===Zt.METAL)e=br(e,.9)
e*=Bt[this.attr2]||1
e*=dt[ct.DURABILITY][this.attribGet(ct.DURABILITY)]||1}this.hp_max=Nr(e*S)
this.hp_cur=Nr(this.attribGet("hp")/tt*this.hp_max)
if(this.attr1===et.ANY)this.hp_cur=this.hp_max}
Item.prototype.calcDigRate=function(){this.dig_rate_mod=jt[this.attr1]
if(isNaN(this.dig_rate_mod))this.dig_rate_mod=1
this.dig_rate_mod*=dt[ct.DIG_RATE][this.attribGet(ct.DIG_RATE)]||1}
Item.prototype.setHP=function(e){this.hp_cur=e
this.attribSet("hp",this.hpToAttrib(e))}
Item.prototype.hpToAttrib=function(e){return Nr(e/this.hp_max*tt)}
Item.prototype.getRarity=function(){return this.attribs&&this.attribs[ct.RARITY]||0}
var Zr=null
function toolSetModeList(e){if(Pr[e.id]){var t=Pr[e.id]
if(t[e.attr1])e.mode_list=t[e.attr1]}if(1===e.mode_list.length){e.brush_size=E[e.mode_list[0]]
e.mode_list=null}}function toolMaxTier(e){var t=[]
t[Zt.METAL]=qt[e.attr1]||qt[et.STONE]
if(e.id===Ee)t[Zt.WOOD]=Yt[et.LEAF]
return t}function itemPropEntitlementKey(e){if(void 0!==e.entl_key)return e.entl_key
if(e.unlockable_variants){var t=et.ANY
var r=et.NONE
for(var a=0;a<e.unlockable_variants.length;++a){var i=e.unlockable_variants[a]
var o=e.attr1,n=e.attr2,s=e.attr3
o=i.attr1===t?t:o||r
n=i.attr2===t?t:n||r
s=i.attr3===t?t:s||r
if(o===i.attr1&&n===i.attr2&&s===i.attr3){var l=X(e.id,o,n,s)
return e.entl_key=l}}}return e.entl_key=null}function itemIsAccountLocked(e){var t=itemPropEntitlementKey(e)
if(t)return!(yr("owned")||{})[t]
return false}function itemIsFullBucket(e){return e&&e.type===Ze&&e.id===le&&e.attr2&&!(1&e.attr2)}function getItemsForCraftClass(e){var t=[]
for(var r in Zr){var a=Zr[r]
for(var i in a){var o=a[i]
var n=o.prototype
if(false===n.allowed_in_inventory)continue
if(lt(e,n)){var s={}
if(n.has_hp){s.attr1=et.IRON
s.attr2=et.WOOD}else if(n.has_inv_variants)s.attr1=et.ANY
t.push(new o(s))}else if(n.craft_class_map)for(var l in n.craft_class_map)if(n.craft_class_map[l].includes(e))if(e===Je.ROD_METAL){var _=mapMaterials(validIngotMaterial)
for(var c=0;c<_.length;++c){var u=new o({attr1:_[c]})
C(lt(e,u))
t.push(u)}}else{C("def"!==l)
var d=new o({attr1:Number(l)})
C(lt(e,d))
t.push(d)}}}return t}function createItem(e){if(!e)return null
C(e.type)
C.equal(typeof e.id,"number")
var t=Zr[e.type][e.id]
if(t)return new t(e)
if(e.type===Ze){B("Encountered unknown item id="+e.id+" at runtime")
var r=new(t=Zr[Ze][Ve])(e)
r.id=e.id
return r}else{D("item",JSON.stringify(e))
C(false)
return null}}function validIngotMaterial(e){return Ut[e]===Zt.METAL&&e!==et.COAL&&!Kt[e]}function validOreMaterial(e){return validIngotMaterial(e)&&!Dt[e]}function mapMaterials(e){var t=[]
for(var r in et){var a=Number(r)
if(a&&isFinite(a)&&e(a))t.push(a)}return t}var Xr=((i={})[Se]=mapMaterials(validIngotMaterial).map(function(e){return{attr1:e}}),i[Oe]=mapMaterials(validOreMaterial).map(function(e){return{attr1:e}}),i[Ne]=Tt.map(function(e){return{attr3:e.key[0]}}),i[ze]=[{attr1:et.STONE}].concat(mapMaterials(validIngotMaterial).map(function(e){return{attr1:e}})),i)
var Qr={metal_tool_head_cast:{list:mapMaterials(validIngotMaterial).map(function(e){return{attr1:e}}),item_id:ze}}
function procExampleList(e,t){var r=[]
for(var a=0;a<e.length;++a){var i=e[a]
if(!isItem(i))i=e[a]=createItem(_extends({type:Ze,id:t},i))
if(f(i,rt()))r.push(i)}return r}var $r={}
function getItemsForMatAny(e){if($r[e])return $r[e]
var t=Xr[e]
if(!t){var r=createItem({type:Ze,id:e})
if(r.definitive_examples)t=Xr[e]=r.definitive_examples
else if(r.examples)t=Xr[e]=r.examples
else t=Xr[e]=[]}var a=procExampleList(t,e)
return $r[e]=a}function getItemsForRecipe(e){var t=Qr[e]
if(!t)return[]
return procExampleList(t.list,t.item_id)}function processMatBakedKey(e,t){if(Array.isArray(e))return e
var r={}
for(var a in e){var i=e[a]
if("def"===a||!isNaN(a))r[a]="string"===typeof i?i:processMatBakedKey(i,t)
else{var o=xt[a]
C(o,"Invalid material name: "+a)
r[o]="string"===typeof i?i:processMatBakedKey(i,t)}}C(r.def||!t)
return r}function processCraftClassMap(e){var t={}
for(var r in e){var a=r
if("def"!==r){a=xt[r]
C(a,"Invalid material name: "+r)}var i=e[r]
for(var o=0;o<i.length;++o){var n=i[o]
var s=Je[n]
C(s,"Invalid craft class name "+n)
i[o]=s}t[a]=i}C(t.def)
return t}function initPrototypes(){(Zr=[])[Xe]=[]
Zr[Qe]=[]
Zr[qe]=[]
Zr[Ke]=[]
Zr[Ze]=[]
function protoInit(e,t,r,a){if(a.debug_only&&!M.DEBUG)return null
if("string"===typeof t){C(ee[t],"Unknown item ID: "+t)
t=ee[t]}var i=r.prototype=Object.create(Item.prototype)
i.type=e
i.id=t
for(var o in a)i[o]=a[o]
if(a.fuel_rate){i.craft_classes=i.craft_classes||{}
i.craft_classes[Je.FUEL]=true}C(!Zr[e][t])
Zr[e][t]=r
return i}function initToolShared(e,t){protoInit(Ze,e,function ItemTool(e){this.initBase(e)
toolSetModeList(this)
this.calcDigRate()
this.max_tier=toolMaxTier(this)
if(this.id===Re)this.max_stone_tier=zt[this.attr1]
if(this.has_hp&&this.attr1!==et.ANY)this.calcHP()
if(Kt[this.attr1]){this.is_crafted=false
this.has_hp=false}},Y({name:b[e],desc:N[e],size_auto:true,placeable:false,no_spin:true,stackable:false,is_gather:true,is_tool:true,default_mode_idx:0,mode_list:Dr[e]||xr,dig_rates:kr[e],allowed_in_inventory:true,max_stone_tier:0,has_hp:true,craft_classes:W([Je.REPAIRABLE]),is_crafted:true},t||{}))}at.init(protoInit)
initToolShared(Re)
initToolShared(ge)
initToolShared(Ue)
initToolShared(Ee,{img:"ui_util.HANDS",allowed_in_inventory:false,has_hp:false,craft_class:void 0,is_crafted:false})
protoInit(Ze,ne,function ItemBlueprint(e){this.initBase(e)},{name:"Placeholder Blueprint",cost:[createItemLite({type:qe,id:Je.STONE_RAW})],flippable:true,mode_list:Br,loading_gfx:Yr,baked_key:"bluebox-paused",def_material:et.STONE})
function ItemBlockPreview(e){this.initBase(e)}protoInit(Ze,oe,ItemBlockPreview,{name:"Preview Block"})
var i=[]
function initBlock(e){var t=Cr[e]
var r
if(t&&t.craft_class)(r={})[t.craft_class]=true
var a=t.sysadmin_only?"(Admin) ":t.next_release?"(Unreleased) ":""
i[e]=protoInit(Ke,e,function ItemBlock(e){this.initBase(e)},{name:""+a+cr.tile_name[e],build_name:""+a+cr.tile_name_block[e],info:cr.tile_info[e],mode_list:e===cr.TILLED||e===cr.TILLED_WATERED?Mr:xr,placeable:t&&!t.unplaceable,unlimited_only:t&&t.unlimited_only,cost:jr[e].length?jr[e]:null,is_crafted:t&&t.crafted,allowed_in_inventory:t&&t.allowed_in_inventory,next_release:t&&t.next_release,sysadmin_only:t&&t.sysadmin_only,variable_yield:t&&t.variable_yield,fuel_rate:t&&t.fuel_rate||0,craft_classes:r})}for(var e=0;e<256;++e)initBlock(e)
function initCraftClass(e){var t={placeable:false,potentially_unlimited:true}
t.name=Ct[e]
t.desc=bt[e]
var r=Nt[e]
C(r)
if(r[0]===Ze)t.preview_item=createItem({type:Ze,id:r[1],attr1:r[2]})
else if("ui_util"===r[0]){t.img=Wr
t.frame=dr[r[1]]
C(t.frame)}else{C.equal(r[0],Ke)
t.preview_item=new ItemBlockPreview({attr1:r[1]})}protoInit(qe,e,function ItemCraftClass(e){this.initBase(e)},t)}for(var t=1;"string"===typeof Je[t];++t)initCraftClass(t)
protoInit(Qe,-1,function ItemSettlementUpgrade(e){this.initBase(e)
this.upgrade_data=Tr[this.attr1]
this.cost=Object.values(this.upgrade_data.cost)},{})
protoInit(Xe,-1,function ItemRecipe(e){this.initBase(e)
var t=ht()[this.attr1]
this.name=(null==t?void 0:t.name)||Lt.$(Lt.RECIPE_UKNOWN,this.attr1)},{cost:[],is_crafted:true})
function protoPostProcess(e){var t=e.prototype
if(t.placeable)t.potentially_unlimited=true
if(t.is_crafted)t.allowed_in_inventory=true
if(t.brush_size){C.equal(typeof t.brush_size,"string")
C(E[t.brush_size],t.brush_size)
t.brush_size=E[t.brush_size]}if(t.img){if("string"===typeof t.img){C(t.img.startsWith("ui_util."))
t.frame=dr[t.img.slice(8)]
C(t.frame,t.img)
t.img=Wr}t.need_thumbnail_update=false}if(t.mat_baked_key)t.mat_baked_key=processMatBakedKey(t.mat_baked_key,true)
if(t.mat_baked_keys_inhand)t.mat_baked_keys_inhand=processMatBakedKey(t.mat_baked_keys_inhand,true)
if(t.boosted_key)t.boosted_key=processMatBakedKey(t.boosted_key,false)
if(t.cost_by_mat)t.cost_by_mat=processMatBakedKey(t.cost_by_mat,true)
if(t.craft_class_map)t.craft_class_map=processCraftClassMap(t.craft_class_map)
if(t.unlockable_variants){t.unlockable_variants=p(t.unlockable_variants)
Q(t.id,t.unlockable_variants)}if(t.next_release_variants)t.next_release_variants=h(t.next_release_variants)
if(t.preview_block_map){var r={}
for(var a in t.preview_block_map)if("def"===a){var i=t.preview_block_map.def
var o=cr[i]
C(o,"Invalid tile name: "+i)
r.def=o}else{var n=xt[a]
C(n,"Invalid material name: "+a)
var s=t.preview_block_map[a]
var l=cr[s]
C(l,"Invalid tile name: "+s)
r[n]=l}C(r.def)
t.preview_block_map=r}if(t.fuel_rate_map){var _={}
for(var c in t.fuel_rate_map){var u=t.fuel_rate_map[c]
C.equal(u,Or(u))
if("def"===c)_.def=u
else{var d=xt[c]
C(d,"Invalid material name: "+c)
_[d]=u}}t.fuel_rate_map=_}if(t.fuel_rate)C.equal(t.fuel_rate,Or(t.fuel_rate))}for(var r in Zr){var a=Zr[r]
for(var o in a)protoPostProcess(a[o])}for(var n=0;n<i.length;++n)i[n].preview_item=new ItemBlockPreview({attr1:n})}function itemPrototypePoke(e,t,r){var a=Zr[Ze][e]
C(a)
a.prototype[t]=r}var Jr="$KEY$"
function itemCheckBakeRules(e,r){r=r||Jr
function assertBakeRuleExistsForTemplate(e){var t=r.replace(Jr,e)
it(t)}if(e.mat_baked_key){C(!e.baked_key)
for(var t in e.mat_baked_key){var a=e.mat_baked_key[t]
if("string"!==typeof a)for(var i in a)assertBakeRuleExistsForTemplate(a[i])
else assertBakeRuleExistsForTemplate(a)}}if(e.mat_baked_keys_inhand){C(!e.baked_keys_inhand)
for(var o in e.mat_baked_keys_inhand){var n=e.mat_baked_keys_inhand[o]
if(!Array.isArray(n))for(var s in n){var l=n[s]
for(var _=0;_<l.length;++_)assertBakeRuleExistsForTemplate(l[_])}else for(var c=0;c<n.length;++c)assertBakeRuleExistsForTemplate(n[c])}}if(e.baked_key){C(!e.mat_baked_key)
assertBakeRuleExistsForTemplate(e.baked_key)}if(e.unlockable_variants)assertBakeRuleExistsForTemplate(e.fallback_baked_key)}function itemCheck(){for(var e in Zr){var t=Zr[e]
for(var r in t){var a=t[r].prototype
if(a.stage_baked_key)for(var i=0;i<a.stage_baked_key.length;++i)itemCheckBakeRules(a,a.stage_baked_key[i])
else itemCheckBakeRules(a)
if(a.stage_preview||a.stage_spawn||a.stage_start||a.growth_heights)C(a.stage_baked_key||a.override_stage_baked_key)
if(a.growth_max_stage){C(a.growth_max_stage>=0)
if(a.growth_heights)C(a.growth_max_stage<a.growth_heights.length)
else if(a.stage_baked_key)C(a.growth_max_stage<a.stage_baked_key.length)}if(a.growth_heights&&!a.override_stage_baked_key)C(a.growth_heights.length===a.stage_baked_key.length)
if(-1!==a.harvest_reverting_stage||a.harvest_pickable_stage||a.harvest_limit){C(a.stage_baked_key||a.override_stage_baked_key)
C(a.harvest_results)}if(a.rooted&&(!a.intangible||a.intangible_mat_map))C(false,("1"===e?ye[r]:e+","+r)+": is both rooted and tangible, cannot be both")}}}function isItem(e){return e&&e.is_item}function itemFromJSON(e){return createItem(e)}Item.prototype.toJSON=function(e,t){C(this.type===Ze||this.type===Ke||this.type===Qe||this.type===Xe)
var r={type:this.type,id:this.id}
if(!t&&1!==this.count){r.count=this.count
C(null!==r.count)}if(this.attr1)r.attr1=this.attr1
if(this.attr2)r.attr2=this.attr2
if(this.attr3)r.attr3=this.attr3
if(this.attribs)for(var a in this.attribs){var i=this.attribs[a]
C(i)
C(V(i))
if(!r.attribs)r.attribs={}
r.attribs[a]=i}return r}
ItemLite.prototype.toJSON=Item.prototype.toJSON
Item.prototype.toTransLog=function(){return this.type+","+this.id+","+(this.attr1||0)}
Item.prototype.same=function(e){return e&&this.type===e.type&&this.id===e.id&&(this.type===Ke||this.attr1===e.attr1&&this.attr2===e.attr2&&this.attr3===e.attr3)}
function itemIsBlueprint(e){return e.type===Ze&&e.id===ne}function itemIsBlueprintReady(e){var t=ot(e.getBID())
return t&&t.loaded&&!t.error}Item.prototype.getBID=function(){if(itemIsBlueprint(this))return this.attr1
return null}
Item.prototype.getBlueprintName=function(){var e=this.getBID()
var t=nt(e)
if(t&&"inherit"!==t)return t
return ot(e).name}
Item.prototype.getShowCount=function(){return this.show_count||this.stackable}
Item.prototype.getMaterial=function(e){if(this.attr1&&!itemIsBlueprint(this)&&this.attr1!==et.ANY)return this.attr1
if(this.def_material)return this.def_material
if(this.type===Ke){var t=Cr[this.id]
C(e||t)
if(!t)return 0
C(e||t.mat)
return t.mat}K(e)
return 0}
Item.prototype.isAny=function(){if(this.attr1===et.ANY)return true
if(this.type===Ke)return false
return!this.attr1}
Item.prototype.getMaterialClass=function(){var e=this.getMaterial(true)
return Ut[e]||Zt.NONE}
Item.prototype.getFuelRate=function(){return this.fuel_rate}
Item.prototype.getQuality=function(){return this.attr3||0}
Item.prototype.updateThumbnail=function(e){Qt.getForPreview(this,e.item_context===U?Jt:er).getSnapshot(this,e)
this.thumbnail_updated=true
this.need_thumbnail_update=false}
var ea=_()
var ta=_()
Item.prototype.updateThumbnailDynamic=function(e){if(!e.snapshot_res){x.virtualToCanvas(ea,u)
s(ta,e.w,e.h)
x.virtualToCanvas(ta,ta)
l(ta,ta,ea)
e.snapshot_res=Or(br(ta[0],ta[1]))
e.pixel_perfect=true}C("number"===typeof e.x&&"number"===typeof e.y)
C(e.dynamic_snapshot)
Qt.getForPreview(this,e.item_context===U?Jt:er).getSnapshot(this,e)}
Item.prototype.consume=function(e){if(this.type===Ze){switch(this.id){case Ie:var t=createItem({type:Ze,id:se})
if(At(t)){var r=Ot.getFrameTransaction()
wt(r,It,t)}else nr.get("ifull").setMessage(Lt.MSG_INVENTORY_FULL)
break
default:nr.push(Lt.STATUSMSG_DELICIOUS)}if(this.consume_attribs)for(var a in this.consume_attribs){var i=this.consume_attribs[a]
if(a.startsWith(ct.TIMED))pr(e,a,i)
else if(a===ct.STAMINA||a===ct.STAMINA_DRAIN){var o=dt[a][i]
C(o)
gr(e,o)}else C(false)
if(ut[a])nr.push(ut[a](this.consume_attribs,a))}}}
Item.prototype.isIngredientOrFood=function(){return lt(Je.INGREDIENT,this)||this.consumable}
Item.prototype.showOnToolPage=function(){return this.consumable||this.tool_page}
function attrBelongsToCraftClass(e,t){return Fr[e]&&lt(t,createItem({type:Ze,id:Fr[e]}))}Item.prototype.isAllowedInInventoryInitialCheck=function(){if(this.attr1&&(this.no_attribs||this.no_attr1))return false
if(this.attr2&&(this.no_attribs||this.no_attr2))return false
if(this.attr3&&(this.no_attribs||this.no_attr3))return false
if(this.type===Ze){var e=Ut[this.attr1]
if(e&&(e===Zt.INGREDIENT&&!this.isIngredientOrFood()&&!this.is_ingredient_with_no_recipes||e!==Zt.INGREDIENT&&this.isIngredientOrFood()))return false
if(this.isIngredientOrFood())if(!this.attr1&&this.baked_swap)return false
else if(this.attr3&&Fr[this.attr3]!==Ge)if(this.id!==Le)return false
if(this.definitive_examples){var t=getItemsForMatAny(this.id)
var r=false
for(var a=0;a<t.length;++a)if(y(t[a],this,"hp")){r=true
break}if(!r)return false}switch(this.id){case Ie:return Fr[this.attr1]===ie
case Ne:return Boolean(yt[this.attr3])
case Pe:return attrBelongsToCraftClass(this.attr1,Je.VEGETABLE)||attrBelongsToCraftClass(this.attr1,Je.SEAFOOD)
case Me:return attrBelongsToCraftClass(this.attr1,Je.VEGETABLE)
case xe:return attrBelongsToCraftClass(this.attr1,Je.SEAFOOD)
case be:return attrBelongsToCraftClass(this.attr1,Je.PIE_FILLING)
case le:return!this.attr3&&(!this.attr2||this.attr2===ur)&&Bt[this.attr1]
case ve:case he:if(this.attr1===et.MUTTAL)return false
return!this.attr3&&Bt[this.attr2]&&Ut[this.attr1]===Zt.METAL&&Bt[this.attr1]
case Oe:return!this.attr2&&!this.attr3&&validOreMaterial(this.attr1)
case Se:return!this.attr2&&!this.attr3&&validIngotMaterial(this.attr1)
case De:return!this.attr2&&!this.attr3&&Bt[this.attr1]&&!Kt[this.attr1]
case ze:return!this.attr2&&!this.attr3&&Ht[this.attr1]&&Ut[this.attr1]!==Zt.WOOD&&!Kt[this.attr1]
case Re:case ge:case Ue:case Te:if(this.attr3)return false
if(!Ht[this.attr1])return false
if(Ut[this.attr1]===Zt.WOOD)return false
if(!Bt[this.attr2])return false
return true
case Ae:if(!this.attribs||!V(this.attribs.rot))return false
return true
case Be:return Ut[this.attr1]===Zt.WOOD&&rr[this.attr3]===this.attr1
case ae:return!this.attr2&&!this.attr3&&Ut[this.attr1]===Zt.WOOD&&this.attr1!==et.LEAF}}return true}
Item.prototype.isAllowedInInventory=function(){if(this.sysadmin_only&&!yr("csr"))return false
if(!this.allowed_in_inventory)return false
if(!this.stackable&&this.count>1||this.count>$)return false
if(this.skip_allow_inventory_check)return true
this.skip_allow_inventory_check=true
this.allowed_in_inventory=this.isAllowedInInventoryInitialCheck()
return this.allowed_in_inventory}
Item.prototype.isAllowedInInventoryAndReleased=function(){if(!f(this,rt()))return false
return this.isAllowedInInventory()}
function addItemAdjectives(e,t,r){if(t)if(r)return Lt.$(Lt.FORMAT_ITEM_2_ADJ,e,r,t)
else return Lt.$(Lt.FORMAT_ITEM_1_ADJ,e,t)
else if(r)return Lt.$(Lt.FORMAT_ITEM_1_ADJ,e,r)
else return e}Item.prototype.addAttributesToName=function(e,t){t=t||{}
var r=et.ANY
if(this.is_recipe)return e
else if(!t.no_material){var a=this.attr1!==r?Vt[this.attr1]:null
if(a&&t.attr1_is_name)e=a
if(void 0!==t.adj1_force)a=t.adj1_force
else if(a&&void 0!==t.adj1_replace)a=t.adj1_replace
if(!a&&this.attr1===r&&this.any_as_material_class&&t.item_context===U){var i=this.getMaterialClass()
a=Gt[i]}var o=t.attr3_as_num||this.attr3_as_num
var n=o||this.name_no_attr3?null:this.attr3!==r?Vt[this.attr3]:null
if(void 0!==t.adj3_force)n=t.adj3_force
else if(n&&void 0!==t.adj3_replace)n=t.adj3_replace
var s=addItemAdjectives(e,a,n)
if(o)s=Lt.separateWords(s,Lt.addNumberSign((this.attr3||0)+1))
if(s!==e)return s}if(t.item_context!==U&&this.attr1===r)return Lt.$(Lt.FORMAT_ITEM_ANY_ADJ,e)
else return e}
var ra="ABCDEFGHJKLMNPQRSTUVWXYZ23456789"
function leapgateName(e,t){var r=k(e^t)
while(true){var a=r.uint32()
var i=""
for(var o=0;o<6;o++,a>>=5)i+=ra[31&a]
if(!q(i))return i}}Item.prototype.processItemNameAttributes=function(e,t,r){var a={no_material:t&&t.no_material,item_context:r}
switch(this.id){case ne:var i=ot(this.getBID())
var o=Lt.ITEM_BLUEPRINT_NAME
var n=this.getBlueprintName()
if(n)if(t&&t.for_search)o=n
else o=Lt.separateColon(o,n)
if(i.error)return Lt.$(Lt.ITEM_BLUEPRINT_NAME_ERROR,o)
else if(!i.loaded)return Lt.$(Lt.ITEM_BLUEPRINT_NAME_LOADING,o)
else if(n)return o
else return Lt.ITEM_BLUEPRINT_NAME_UNKNOWN
case Ue:case Re:case ge:if(this.getMaterial(true)===et.FLINT){e=Lt.ITEM_NAME_CRUDE_TOOL
a.adj1_force=null}break
case we:e=cr.liquid_name[this.attr2]||e
break
case Ne:var s=Qt.mapToNameKeyFromFlowerType(this.attr3)
e=s&&Lt.get("ITEM_SEEDS_"+s+"_NAME")||e
break
case Be:var l=tr[this.attr3]
e=l&&Lt.get("ITEM_SAPLING_"+l+"_NAME")||e
a.adj1_force=null
break
case ue:case fe:case te:case ke:case Fe:var _=ye[this.id]
e=Lt.get(_+"_"+this.attr3+"_NAME")||e
break
case ce:if(this.attr3){var c=Wt[this.attr1]
var u=Lt.get("ITEM_CHEST_MEDIUM_"+c+"_"+this.attr3+"_NAME")
if(u){e=u
a.adj1_force=null}else if(u=Lt.get("ITEM_CHEST_MEDIUM_"+this.attr3+"_NAME"))e=u}break
case le:a.adj3_force=1&this.attr2?Lt.ITEM_ADJ_FLOWING:this.attr2?Lt.ITEM_ADJ_FULL:Lt.ITEM_ADJ_EMPTY
break
case Me:case xe:a.attr1_is_name=true
a.adj1_replace=Lt.ITEM_ADJ_ROAST
break
case Le:a.attr1_is_name=true
a.adj1_force=null
break
case pe:if(this.attr1===et.STONE)a.attr3_as_num=true
break
case se:e=Lt.get("ITEM_BOTTLE_"+this.attr3+"_NAME")||e
a.adj1_force=null
break
case je:e=Lt.get("ITEM_WILD_CROP_"+this.attr3+"_NAME")||e
a.adj1_force=null
break
case Ae:if(this.attr1!==et.ANY)return Lt.ITEM_NAME_LEAPGATE_SHARD_SPECIFIC.$({name:leapgateName(this.attr2,this.attr3)})
break
case me:a.adj1_force=null}return this.addAttributesToName(e,a)}
Item.prototype.getName=function(e,t){t=t||I
if(this.type===Ke){if(t===U&&this.build_name)return this.build_name
if(this.name)return this.name
else if(this.unplaceable&&Cr[this.id])return Cr[this.id].name
return Lt.$(Lt.ITEM_NAME_UNKNOWN_BLOCK,this.id)}else if(this.type===Ze){var r=this.name
if(t===U&&this.build_name)r=this.build_name
if(!r)return Lt.$(Lt.ITEM_NAME_UNKNOWN_ITEM,this.id)
r=this.processItemNameAttributes(r,e,t)
if(this.attribs&&this.attribs[ct.RARITY]){var a=ft[this.attribs[ct.RARITY]]
r=Lt.$(Lt.FORMAT_ITEM_1_ADJ,r,a)}if(this.silhouette)r=Lt.LBL_UNKNOWN_SYMBOLS
else if(this.fallback)r=Lt.addEllipsis(Lt.addQuestionMark(r))
if(this.has_hp&&this.hp_cur<this.hp_max){var i=this.hp_cur?Lt.addPercentage(Rr(Nr(100*this.hp_cur/this.hp_max),this.hp_cur?1:0)):Lt.LBL_BROKEN
r=Lt.addParenthesesAfter(r,i)}return r}else if(this.type===qe)return this.name
else if(this.type===Qe)return this.upgrade_data.name
else if(this.type===Xe)return this.name
return Lt.$(Lt.ITEM_NAME_UNKNOWN_ITEM,Lt.$(Lt.FORMAT_FRACTION,this.type,this.id))}
Item.prototype.getBuildName=function(e){return this.getName(e,U)}
function getMaxMetalName(e){var t
var r=qt[e]
if(r>0){var a=Mt[Zt.METAL][r]
if(a)t=Vt[a]}return t}function getMaxStoneName(e){var t
var r=zt[e]
if(r>0)t=_r[r]
return t}Item.prototype.getDesc=function(e,t){var a=this.attribs&&this.attribs[ct.PREVIEW_MOD_COUNT_MAX]
function v(e,t){var r=t?Lt.addPercentage(e):e
return a?Lt.addPlus(r):r}var r=[]
if(this.desc){var i=G(this.desc)
r=r.concat(i.split("\n"))}if(this.isBoostBlocked())r.push(Lt.ITEM_DESC_BOOST_LOCKED)
if(this.heavy&&!hr())r.push(Lt.ITEM_DESC_HEAVY)
if(this.has_hp&&!Kt[this.attr1]){var o=this.hp_cur,n=this.hp_max
if(1!==this.hp_vis_scale){o=Lr(o*this.hp_vis_scale)
n=Lr(n*this.hp_vis_scale)}if(o===n)r.push(Lt.separateColon(Lt.LBL_DURABILITY,v(n)))
else{var s=Lt.$(Lt.FORMAT_FRACTION,o,n)
r.push(Lt.separateColon(Lt.LBL_DURABILITY,s))}}if(this.dig_rates||this.type===Ze&&this.id===Te){var l=this.getStaminaRate()
if(st()&&1!==l){var _=Lt.$(a?Lt.LBL_STAMINA_USAGE_BASE:Lt.LBL_STAMINA_USAGE,fr)
r.push(Lt.separateColon(_,v(Nr(100*l),"%")))}}if(itemIsBlueprint(this)){var c=ot(this.getBID())
if(c)if(c.desc)r.push(c.desc)
else if(c.isEditable()&&!e)r.push(Lt.ITEM_DESC_EDITABLE_BP)}if(this.type===Ze){if(!this.is_recipe)if(Ur[this.id])if(this.attr2){var u=cr.liquid_name[this.attr2]
r.push(Lt.separateColon(Lt.LBL_CONTENTS,u))}else r.push(Lt.ITEM_ADJ_EMPTY)
else if(this.attr2)if(Gr[this.id]){var d=Gr[this.id]
var f=Vt[this.attr2]
r.push(Lt.$(this.attr2===et.ANY?Lt.FORMAT_ITEM_ANY_ADJ:Lt.FORMAT_ITEM_1_ADJ,d,f))}switch(this.id){case Be:var h=tr[this.attr3]
var p=h&&Lt.get("ITEM_SAPLING_"+h+"_DESC")
if(p){var m=G(p)
r=r.concat(m.split("\n"))}break
case Ye:if(!this.dynamic_cost().length)r.push(Lt.ITEMINFO_FIRST_SETTLEMENT_FREE)
break
case ve:case he:if(!this.is_recipe)r.push(Lt.separateColon(Lt.LBL_DOWSER_RANGE,this.dowser_range))
break
case Se:if(t!==U&&!this.is_recipe){if(this.attr1===et.MUTTAL){r.push(Lt.ITEM_DESC_MUTTAL)
break}if(this.attr1===et.TIN||this.attr1===et.GOLD||this.attr1===et.SILVER){r.push(Lt.ITEM_DESC_WEAK_METAL)
break}}case ze:if(t!==U&&!this.is_recipe){var E=getMaxMetalName(this.attr1)
var g=getMaxStoneName(this.attr1)
if(E&&g)r.push(Lt.$(Lt.ITEM_DESC_MADE_FROM_GATHERS_BOTH,E,g))
else if(E)r.push(Lt.$(Lt.ITEM_DESC_MADE_FROM_GATHERS_METAL,E))
else if(g)r.push(Lt.$(Lt.ITEM_DESC_MADE_FROM_GATHERS_STONE,g))}}if(this.dig_rates&&!this.is_recipe){var T=false
var y=this.dig_rates[Zt.STONE]
var S=this.dig_rates[Zt.METAL]
var I=this.max_tier[Zt.METAL]
var A=I>=0&&Mt[Zt.METAL][I]
if(y&&S&&y===S&&A){var w=y*this.dig_rate_mod
var L=v(Nr(100*w),"%")
r.push(Lt.$(Lt.ITEM_DESC_STONE_METAL_GATHERING,L,_r[this.max_stone_tier],Vt[A]))
T=true}for(var O=0;O<this.dig_rates.length;++O){if(O!==Zt.STONE&&O!==Zt.METAL&&O!==Zt.WOOD&&O!==Zt.DIRT)continue
if(T&&(O===Zt.STONE||O===Zt.METAL))continue
var R=this.dig_rates[O]
if(R){R*=this.dig_rate_mod
var b=Ft[O]
var N=Lt.$(Lt.ITEM_DESC_MATERIAL_GATHERING,v(Nr(100*R),"%"),b)
var C=this.max_tier[O]
if(C){if(C<0)continue
var x=Mt[O][C]
if(x){var M=Vt[x]
N=Lt.addParenthesesAfter(N,Lt.$(Lt.ITEM_DESC_UP_TO,M))}}else if(O===Zt.STONE){var D=_r[this.max_stone_tier]
N=Lt.addParenthesesAfter(N,Lt.$(Lt.ITEM_DESC_UP_TO_STONE,D))}r.push(N)}}}if(this.attribs)for(var P in this.attribs)if(ut[P])r.push(""+ut[P](this.attribs,P))
if(this.attr1!==et.ANY&&this.consumable&&this.consume_attribs){r.push(Lt.addColon(Lt.ITEM_DESC_CONSUMABLE_FOR))
for(var B in this.consume_attribs)if(ut[B])r.push(""+ut[B](this.consume_attribs,B))
if(!Ar())r.push(Lt.ITEM_DESC_CONSUMABLE_WARNING)}}else if(this.desc){var k=G(this.desc)
r=r.concat(k.split("\n"))}return r}
Item.prototype.getInfo=function(){if(this.info_cached)return this.info_cached
var e=this.info||""
if(this.type===Ze)if(this.id===Oe&&this.attr1){var t=Xt(this.attr1)
if(t>0){var r=[e]
r.push(Lt.$(Lt.ITEM_INFO_ORE_DEPTH,this.getName(),_r[t],lr[t-1]))
e=r.join("\n\n")}}this.info_cached=e
return this.info_cached}
Item.prototype.getHardness=function(){var e=this.getMaterial()
return Yt[e]}
Item.prototype.isCrafted=function(){return this.is_crafted}
Item.prototype.getCraftCost=function(){if(this.craft_cost)return this.craft_cost
C(this.isCrafted())
this.craft_cost=pt(this)
return this.craft_cost}
Item.prototype.getRawCost=function(){if(this.raw_cost)return this.raw_cost
var e=this.cost
C(e)
var t=false
var r=[]
for(var a=0;a<e.length;++a){var i=e[a]
if(!isItem(i))i=e[a]=createItem(i)
if(i.isCrafted()){t=true
var o=i.getCraftCost()
for(var n=0;n<o.length;++n){var s=o[n]
if(1!==i.count)(s=createItem(s)).count*=i.count
r.push(s)}}else r.push(i)}if(!t)r=e
else for(var l=0;l<r.length;++l)for(var _=l+1;_<r.length;++_)if(r[l].same(r[_])){r[l]=createItem(r[l])
r[l].count+=r[_].count
j(r,_)}return this.raw_cost=r}
Item.prototype.initDowser=function(){var e=dt[ct.RANGE][this.attribGet(ct.RANGE)]
var t=this.id===ve?mt:Et
this.dowser_range=Nr(t*e)}
Item.prototype.initUniqueSpiced=function(){this.consume_attribs=H(this.consume_attribs)
if(this.attr1===et.LUMINESCENT_MUSHROOM){this.consume_attribs={}
this.consume_attribs[ct.STAMINA_DRAIN]=1}if(this.attr1===et.CORN&&this.consume_attribs[ct.STAMINA])this.consume_attribs[ct.STAMINA]--
if(this.attr1===et.STARFISH){this.consume_attribs[ct.STAMINA]-=3
if(this.consume_attribs[ct.STAMINA]<=0)delete this.consume_attribs[ct.STAMINA]
this.consume_attribs[ct.TIMED_SPEED_MEDIUM]=90}if(this.attr1===et.ANEMONE){this.consume_attribs[ct.STAMINA]-=3
if(this.consume_attribs[ct.STAMINA]<=0)delete this.consume_attribs[ct.STAMINA]
this.consume_attribs[ct.TIMED_SPRINTING_STAMINA_LARGE]=90}this.initSpiced()}
Item.prototype.initSpiced=function(){this.consume_attribs=H(this.consume_attribs)
if(this.attr3===et.HOT)this.consume_attribs[ct.TIMED_STAMINA_MED]=(this.consume_attribs[ct.TIMED_STAMINA_MED]||0)+10
if(this.attr3===et.PUNGENT)this.consume_attribs[ct.STAMINA]=(this.consume_attribs[ct.STAMINA]||0)+1
if(this.attr3===et.SAVORY)this.consume_attribs[ct.TIMED_O2_CAPACITY_LARGE]=(this.consume_attribs[ct.TIMED_O2_CAPACITY_LARGE]||0)+20}
function itemPotentiallyMergeable(e,t){return e&&t&&e.stackable&&e.type===t.type&&e.id===t.id&&e.attr1===t.attr1&&e.attr2===t.attr2&&e.attr3===t.attr3}function itemPartiallyMergeable(e,t){if(itemPotentiallyMergeable(e,t))return br($-e.count,t.count)
return 0}function itemFullyMergeable(e,t){return itemPotentiallyMergeable(e,t)&&e.count+t.count<=$}var aa={}
function satisfiesCost(e,t){if(!e||!t)return false
if(e.type===qe)return lt(e.id,t)
if(!(e.type===t.type&&(e.id===t.id||e.type===Ze&&e.id===we&&t.id===le)))return false
if(e.type===Ke)return true
var r=et.ANY
if(!((e.attr1===r||(e.attr1||0)===(t.attr1||0))&&(e.attr2===r||(e.attr2||0)===(t.attr2||0))&&(e.attr3===r||(e.attr3||0)===(t.attr3||0))))return false
var a=e.attribs||aa
var i=t.attribs||aa
if(a!==i){for(var o in a)if("hp"!==o&&a[o]!==i[o])return false
for(var n in i)if("hp"!==n&&i[n]!==a[n])return false}if(t.has_hp||e.has_hp)if(!(t.hp_cur>0))return false
return true}function satisfiesCostLoose(e,t){if(!e||!t)return false
if(e.type===qe)return lt(e.id,t)
if(!(e.type===t.type&&(e.id===t.id||e.type===Ze&&e.id===we&&t.id===le)))return false
if(e.type===Ke)return true
var r=et.ANY
if(!((!e.attr1||e.attr1===r||(e.attr1||0)===(t.attr1||0))&&(!e.attr2||e.attr2===r||(e.attr2||0)===(t.attr2||0))&&(!e.attr3||e.attr3===r||(e.attr3||0)===(t.attr3||0))))return false
return true}function itemEqualLoose(e,t){if(!e){if(!t)return true
return false}if(!t)return false
return e.type===t.type&&e.id===t.id&&(e.count||1)===(t.count||1)&&(e.attr1||0)===(t.attr1||0)&&(e.attr2||0)===(t.attr2||0)&&(e.attr3||0)===(t.attr3||0)}function itemEqual(e,t,r){if(!y(e,t,r))return false
return!e||e.count===t.count}function itemIsUnlimited(e){return hr()&&e&&e.potentially_unlimited}function itemIsSettlementLocked(e){if(e&&e.is_settlement_locked&&wr()){var t=ir()
if(t&&t.allowsItem(e.id))return 0
else{if(!t)if((t=or())&&t.allowsItem(e.id))return 1
return 2}}return 0}function itemIsPlaceable(e){return e&&e.placeable&&(!e.unlimited_only||hr())}function itemIsAllowedInQuickbar(e){if(!e)return false
if(!e.allowed_in_quickbar)return false
if(e.sysadmin_only&&!yr("csr"))return false
if(e.unlimited_only||e.unlimited_only_for_build_menu)return true
var t=e.dynamic_cost?e.dynamic_cost():e.cost
if(t)for(var r=0;r<t.length;++r){var a=t[r]
if(!isItem(a))a=t[r]=createItem(a)
if(a.isAllowedInInventoryAndReleased())continue
if(a.type===qe)continue
if(a.attr1===et.ANY)continue
return false}return true}function notLiquid(e){return e&&!(e.type===Ze&&e.id===we)}var ia=0
var oa=0
function snapshotsFrameCheck(){if(oa!==M.frame_index){oa=M.frame_index
ia=0}}var na=1
function snapshotOverLimit(e){snapshotsFrameCheck()
if(e)return false
else{if(ia>=na)return true;++ia}return false}function itemGetGfx(e,t){K(t.item_context===U||t.item_context===I)
if((e=e||zr).preview_item)e=e.preview_item
var r=t.dynamic_snapshot&&(e.need_thumbnail_update||e.thumbnail_updated)&&(!e.no_spin||t.ignore_no_spin)
var a=e.need_thumbnail_update
var i=false
if(itemIsBlueprint(e)){var o=e.blueprint_def
if(!o)o=e.blueprint_def=ot(e.getBID())
if(!o.loaded)return e.loading_gfx
if(e.blueprint_def_ver!==o.ver)a=i=true
if(a)if(o.isEmpty()){e.img=Wr
e.frame=dr.EMPTY_BLUEPRINT
e.blueprint_def_ver=o.ver
return e}}if(e.dynamic_snapshot&&!r)a=true
if(a||r){if(!Qt.hasForPreview(e,t.item_context===U?Jt:er)||i){snapshotsFrameCheck()
if(t.no_perframe_limit);else if(snapshotOverLimit(r))return e.loading_gfx}if(r)e.updateThumbnailDynamic(t)
else{t.dynamic_snapshot=false
e.updateThumbnail(t)
if(i)e.blueprint_def_ver=e.blueprint_def.ver}}C(e.img)
return e}var sa=[]
function itemGetGfxQueued(e,t){if(!e.need_thumbnail_update&&!e.dynamic_snapshot){var r=ia+10007*oa
var a=itemGetGfx(e,{item_context:I})
C(a)
C(a!==e.loading_gfx)
C(r===ia+10007*oa)
return void t(a)}sa.push([e,t])}function itemsTick(){snapshotsFrameCheck()
while(sa.length&&ia<na){var e=sa.splice(0,1)[0],t=e[0];(0,e[1])(itemGetGfx(t,{item_context:I}))}}function startup(){Wr=dr.sprite
C(Wr)
zr.img=Wr
zr.frame=dr.BLANK
Vr.img=Wr
Vr.frame=dr.QUESTION_MARK
Yr.img=Wr
Yr.frame=dr.EMPTY_BLUEPRINT
r.sprite_blueprint_bg=Hr=P({url:"img/blueprint_bg.png",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
initPrototypes()}},{"../common/entitlements":244,"../common/globals":248,"../common/ids":249,"../common/items_common":251,"../common/materials_common":253,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/error_report":311,"../glov/client/localization":330,"../glov/client/sprites":363,"../glov/common/data_error":381,"../glov/common/rand_alea":395,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"../glov/common/words/profanity_common":403,"./app_access":12,"./autogen/item_defs":16,"./baking":19,"./blueprint":28,"./build_menu":32,"./build_mode":33,"./crafting":66,"./crafting_mods":67,"./crafting_recipes":68,"./dowser_advanced":77,"./dowser_simple":78,"./flora_constants":101,"./inventory":114,"./localization/localization":131,"./main":135,"./materials":137,"./proc_gen":162,"./props":171,"./saplings.js":177,"./saplings_shared":179,"./settlement":181,"./status":193,"./stone_tiers":194,"./tiles":199,"./ui_util":205,"./user_data":208,"./waygate_upgrade":223,"./world_comm":226,"./world_metadata":235,assert:void 0}],120:[function(e,t,r){"use strict"
r.isTopRightCornerReserved=isTopRightCornerReserved
r.canChangeLayout=canChangeLayout
r.quickbarOnTop=quickbarOnTop
r.quickbarOnLeft=quickbarOnLeft
r.quickbarOnRight=quickbarOnRight
r.menuUpperLeft=menuUpperLeft
r.layoutWide=layoutWide
r.layoutCameraFull=layoutCameraFull
r.layoutCameraSquare=layoutCameraSquare
r.layoutCameraPush=layoutCameraPush
r.layoutCameraPop=layoutCameraPop
r.layoutCameraTallWide=layoutCameraTallWide
r.layoutCameraTallWideRaw=layoutCameraTallWideRaw
r.layoutCameraCurX1=layoutCameraCurX1
r.layoutCameraCurY1=layoutCameraCurY1
r.layoutCameraTallWideMode=layoutCameraTallWideMode
r.pushViewportOffset=pushViewportOffset
r.layoutTick=layoutTick
r.startup=startup
r.PHOTOUI_WG_H=r.PHOTOUI_USERBUTTON_H=r.PHOTOUI_SHADOW_OFFSET=r.PHOTOUI_COST_H=r.PHOTOUI_TITLE_H=r.PHOTOUI_FRAME_PAD=r.PHOTOUI_BORDER_PAD=r.UIVIEWS_CONTENT_PAD=r.UIVIEWS_BUTTON_H=r.UIVIEWS_BUTTON_W=r.SHAREMENU_BUTTON_H=r.SHAREMENU_BUTTON_W=r.SHAREMENU_CONTENT_PAD=r.SHAREMENU_BORDER_PAD=r.CORNER_BUTTON_MARGIN=r.TC_VERTBUTTONS_FH=r.TC_VERTBUTTONS_H=r.TC_VERTBUTTONS_W=r.TC_DPAD_LEFT_PAD=r.TC_DPAD_BOT_PAD=r.TC_DPAD_RADIUS=r.MENU_PANEL_PAD=r.QUICKBAR_PAD=r.QUICKBAR_BORDER_PAD=r.QUICKBAR_BOX_SIZE=r.TOP=r.RIGHT=r.LEFT=r.LAYOUT_QUICKBAR=r.WIDE=r.TALL=r.AUTO=void 0
var a=0
r.AUTO=a
var i=1
r.TALL=i
var o=2
r.WIDE=o
var n={AUTO:0,LEFT:1,RIGHT:2,TOP:3}
var s=(r.LAYOUT_QUICKBAR=n).LEFT
r.LEFT=s
var l=n.RIGHT
r.RIGHT=l
var d=n.TOP
r.TOP=d
var _=100
r.QUICKBAR_BOX_SIZE=_
var c=8
r.QUICKBAR_BORDER_PAD=c
var u=8
r.QUICKBAR_PAD=u
var f=20
r.MENU_PANEL_PAD=f
var v=230
r.TC_DPAD_RADIUS=v
var h=250
r.TC_DPAD_BOT_PAD=h
var p=250
r.TC_DPAD_LEFT_PAD=p
var m=280
r.TC_VERTBUTTONS_W=m
var E=240
r.TC_VERTBUTTONS_H=E
var g=90
r.TC_VERTBUTTONS_FH=g
var T=10
r.CORNER_BUTTON_MARGIN=T
var y=32
r.SHAREMENU_BORDER_PAD=y
var S=8
r.SHAREMENU_CONTENT_PAD=S
var I=300
r.SHAREMENU_BUTTON_W=I
var A=48
r.SHAREMENU_BUTTON_H=A
var w=240
r.UIVIEWS_BUTTON_W=w
var L=48
r.UIVIEWS_BUTTON_H=L
var O=4
r.UIVIEWS_CONTENT_PAD=O
var R=30
r.PHOTOUI_BORDER_PAD=R
var b=30
r.PHOTOUI_FRAME_PAD=b
var N=72
r.PHOTOUI_TITLE_H=N
var C=96
r.PHOTOUI_COST_H=C
var x=8
r.PHOTOUI_SHADOW_OFFSET=x
var M=48
r.PHOTOUI_USERBUTTON_H=M
var D=128
r.PHOTOUI_WG_H=D
var P=e("assert")
var B=e("../glov/client/camera2d")
var k=e("../glov/client/cmds").cmd_parse
var U=e("../glov/client/settings")
var G=e("../glov/client/ui").uiButtonHeight
var F=e("../glov/common/vmath")
var W=F.v4add
var H=F.v4set
var z=F.vec4
var V=e("./fbinstant_worlds").fbGetRoomCurrentMatch
var Y=e("./main")
var j=Math.round
var K
var q
function isTopRightCornerReserved(){return V()}function canChangeLayout(){return!V()}function quickbarOnTop(){return Y.main_active&&q===d}function quickbarOnLeft(){return Y.main_active&&q===s}function quickbarOnRight(){return Y.main_active&&q===l}function menuUpperLeft(){return isTopRightCornerReserved()||U.force_menu_upper_left}function layoutWide(){return K===o}var Z
var X=z(0,0,1e3,1e3)
function layoutCameraFull(){Z=X
B.setAspectFixed2(1e3,1e3)}var Q=z(0,0,1e3,1e3)
var $=z()
function layoutCameraSquare(){Z=Q
B.set($[0],$[1],$[2],$[3])}var J=null
function layoutCameraPush(){P(!J)
J=Z
B.push()}function layoutCameraPop(){P(J)
Z=J
J=null
B.pop()}var ee=z(0,0,1600,1e3)
var te=z(0,0,1e3,1600)
var re=z()
var ae=z()
var ie={mode:i,rect:te,camera:re}
var oe={mode:o,rect:ee,camera:ae}
var ne
function layoutCameraTallWide(){var e=ne.camera
Z=ne.rect
B.set(e[0],e[1],e[2],e[3])
return ne}function layoutCameraTallWideRaw(e,t,r,a){if(B.screenAspect()<1){B.setAspectFixed(r,a)
return i}else{B.setAspectFixed(e,t)
return o}}function layoutCameraCurX1(){return Z[2]}function layoutCameraCurY1(){return Z[3]}function layoutCameraTallWideMode(){return ne.mode}var se=[]
function pushViewportOffset(e){se.push(e)}var le=50
var _e=_+c+20+u
var ce=5
function layoutTick(e){K=B.screenAspect()<1?i:o
if((q=isTopRightCornerReserved()?s:canChangeLayout()?U.layout_quickbar:a)===a)q=K===i?d:s
layoutCameraFull()
var l=[le,le,B.x1()-le,B.y1()-le]
if(e)if(quickbarOnLeft())l[0]=_e
else if(quickbarOnRight())l[2]=B.x1()-_e
else if(quickbarOnTop())l[1]=_e
else l[3]=B.y1()-_e
if(!e||!quickbarOnTop()){var t=G()
l[1]+=t+2*ce-le}for(var r=0;r<se.length;++r)W(l,l,se[r])
var _=l[2]-l[0]
var c=l[3]-l[1]
var u=_/c
function setupView(e,t){var r=t[2]/t[3]
if(u>r){var a=j(c*r)
var i=(_-a)/2
H(e,l[0]+i,l[1],l[2]-i,l[3])}else{var o=j(_/r)
if(t===ee){var n=c-o
H(e,l[0],l[1],l[2],l[3]-n)}else{var s=(c-o)/2
H(e,l[0],l[1]+s,l[2],l[3]-s)}}B.calcMap(e,e,t)}setupView($,Q)
setupView(re,te)
setupView(ae,ee)
if(K===i)ne=ie
else ne=oe
se.length=0}function startup(){U.register({layout_quickbar:{default_value:a,type:k.TYPE_INT,ver:2,enum_lookup:n},force_menu_upper_left:{default_value:0,type:k.TYPE_INT,access_run:["sysadmin"],range:[0,1]}})}},{"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/settings":351,"../glov/client/ui":367,"../glov/common/vmath":402,"./fbinstant_worlds":96,"./main":135,assert:void 0}],121:[function(e,t,r){"use strict"
r.leapgateUIStartup=leapgateUIStartup
r.doLeapgate=doLeapgate
r.leapgateSelectAutoActivate=leapgateSelectAutoActivate
r.leapgateExecuteAutoActivate=leapgateExecuteAutoActivate
var I=e("assert")
var T=e("../glov/client/engine")
var y=e("../glov/client/input.js").pointerLockEnter
var S=e("../glov/client/ui")
var A=e("../glov/client/ui").uiButtonHeight
var a=e("../glov/common/rand_alea")
var c=a.mashI53
var u=a.randCreate
var i=e("../glov/common/util").isInteger
var o=e("../common/ids")
var d=o.ITEM_BUCKET
var f=o.ITEM_COAL
var v=o.ITEM_DOWSER_SIMPLE
var h=o.ITEM_FIBER
var p=o.ITEM_HATCHET
var m=o.ITEM_HOE
var w=o.ITEM_LEAPGATE_SHARD
var E=o.ITEM_ORE
var g=o.ITEM_PICKAX
var L=o.ITEM_ROD
var O=o.ITEM_SHOVEL
var R=o.ITEM_TOOL_HEAD
var b=o.TYPE_BLOCK
var N=o.TYPE_ITEM
var n=e("../common/leapgate_common")
var C=n.LEAPGATE_REQUIRED_DEPOSITS
var x=n.LeapgateMode
var s=n.createLeapgateProgress
var l=n.createLeapgateShardCost
var M=n.getCostForSlot
var D=n.getCostSlots
var P=n.getProgressForSlot
var B=n.isLeapgateCostPaid
var k=e("../common/materials_common").Mat
var _=e("../common/world_constants")
var U=_.ACCESS_BUILDER
var G=_.ATTRIB_FIXED_MAX
var F=_.THRESHOLD_ACCESS_MODIFY
var W=e("./auto_activate_ui")
var H=W.GateAccess
var z=W.gateAccessBlocked
var V=W.gateAccessDropdown
var Y=W.gateTimeDropdown
var j=e("./build_queue_ui").boostWidgetShow
var K=e("./client_cmds.js").waygateToPosStr
var q=e("./editvolume_client")
var X=q.editVolumeDefaultAccess
var Q=q.editVolumeForPos
var $=e("./inventory")
var J=$.INV_PLAYER
var ee=$.canFit
var te=$.inventoryClearHeavyFromTrash
var re=$.inventoryGet
var ae=$.inventoryGetSize
var ie=$.inventoryLocked
var oe=$.playerCarryingHeavy
var ne=$.transInvAdd
var se=$.transInvDec
var le=e("./inventory_ui")
var _e=le.ACCEPT_HIGHLIGHT
var ce=le.ACCEPT_NO
var ue=le.ACCEPT_OK
var de=le.INVTYPE_CONTAINER
var fe=le.INVTYPE_MAIN
var ve=le.ctxTrans
var he=le.doInventorySetupContext
var pe=le.doInventorySub
var me=le.doInventorySubOneItem
var Ee=le.inventoryAnimate
var ge=le.inventoryButton
var Te=le.inventoryUITick
var ye=e("./item_info_view")
var Se=ye.ITEM_INFO_VIEW_W
var Ie=ye.itemInfoViewShow
var Ae=e("./items")
var we=Ae.ITEM_CONTEXT_ITEM
var Le=Ae.createItem
var Oe=Ae.leapgateName
var Re=Ae.sameItem
var be=Ae.satisfiesCostLoose
var Ne=e("./layout")
var Ce=Ne.WIDE
var xe=Ne.layoutCameraCurX1
var Me=Ne.layoutCameraTallWideMode
var De=e("./loading_custom").loadingCustomDoLeapNextFrame
var Pe=e("./localization/localization").L
var Be=e("./main")
var ke=e("./main")
var Ue=ke.menuExit
var Ge=ke.postTick
var Fe=e("./menu").menuInteractGetProp
var We=e("./prop_edit")
var He=We.BUTTON_W
var ze=We.saveProp
var Ve=e("./settlement_edit").CRAFTING_ICON_SIZE
var Ye=e("./status").statusGet
var je=e("./styles")
var Ke=je.color_black
var qe=je.label_warning_style
var Ze=je.menu_header_style
var Xe=je.style_mode_label
var Qe=je.sublabel_style
var $e=e("./tiles_const")
var Je=$e.LIQUID_TILES
var et=$e.TILES
var tt=e("./ui_util")
var rt=e("./user_data.js").unlimitedItemsAllowed
var at=e("./waygate_ui")
var it=at.FONT_HEIGHT
var ot=at.PAD
var nt=at.SUBLABEL_H
var st=at.TITLE_H
var lt=e("./world_metadata").worldAccessDefault
var _t=Math.ceil,ct=Math.floor,ut=Math.min,dt=Math.random
var ft
var vt
var ht
function leapgateUIStartup(){ft=S.font
vt=S.title_font
ht=tt.sprite}function generateNewCost(e){var t
switch(e.stage){case x.SOURCE:t=31*(31*(527+e.chunk_id)+e.pos_idx)+(e.leapgate_extracts||0)
break
case x.TARGET:t=ct(4294967295*dt())
break
default:I(false)}var r=u(c(t))
function pushBlocks(e,t,r){for(var a=0;a<t.length;a++)e.push({type:b,id:t[a],count:r})}function pushItems(e,t,r){for(var a=0;a<t.length;a++)e.push({type:N,id:t[a],count:r})}function pushItemsAttrSimple(e,t,r,a){for(var i=0;i<a.length;i++)e.push({type:N,id:t,count:r,attr1:a[i]})}function pushItemAttrFull(e,t,r,a,i,o,n){var s
if(n)s={hp:G}
for(var l=0;l<a.length;l++)e.push({type:N,id:t,count:r,attr1:a[l],attr2:i,attr3:o,attribs:s})}var a=[k.WOOD,k.LIGHT_WOOD,k.RED_WOOD,k.DARK_WOOD]
var i=[k.COPPER,k.TIN,k.IRON]
var o=[k.TIN,k.IRON]
var n=[k.COPPER,k.BRONZE]
var s=[]
pushBlocks(s,[et.STONE,et.STONE_LIGHT,et.VEINIUM,et.SAND],100)
pushBlocks(s,[et.WOOD,et.WOOD_DARK,et.WOOD_LIGHT,et.WOOD_RED],25)
pushItems(s,[f],15)
pushItems(s,[h],50)
pushItemsAttrSimple(s,E,20,[k.COPPER])
pushItemsAttrSimple(s,E,10,o)
var l=[]
pushBlocks(l,[et.PLANKS_WOOD,et.PLANKS_WOOD_DARK,et.PLANKS_WOOD_LIGHT,et.PLANKS_WOOD_RED],100)
pushItemsAttrSimple(l,L,5,a)
pushItemsAttrSimple(l,R,2,[k.COPPER])
pushItemsAttrSimple(l,R,1,[k.BRONZE])
var _=[]
pushItemAttrFull(_,g,1,n,k.ANY,0,true)
pushItemAttrFull(_,p,1,n,k.ANY,0,true)
pushItemAttrFull(_,O,1,n,k.ANY,0,true)
pushItemAttrFull(_,m,1,n,k.ANY,0,true)
pushItemAttrFull(_,v,1,i,k.ANY,0,false)
pushItemAttrFull(_,d,1,a,Je.WATER,0,false)
return{cost1:s[r.range(s.length)],cost2:l[r.range(l.length)],cost3:_[r.range(_.length)]}}function applyNewCost(e,t){e.leapgate_cost=t
if(e.stage===x.TARGET){var r=l(e.leapgate_destination_chunk_id,e.leapgate_destination_pos_idx)
e.leapgate_cost.cost0=r}e.leapgate_progress=s(e.leapgate_cost)
if(rt()&&e.stage===x.TARGET)for(var a in e.leapgate_cost){if("cost0"===a)continue
e.leapgate_progress[a]=e.leapgate_cost[a].count}}function leapgateAccessBlocked(e){var t=z(e,"leapgate_access")
if(!t)return false
if(t===H.BOOSTERS){j("access_leapgate")
Ye("leapgate").setMessage(Pe.STATUSMSG_LEAPGATE_INACCESSIBLE_BOOST).fade()}else Ye("leapgate").setMessage(Pe.STATUSMSG_LEAPGATE_INACCESSIBLE).fade()
return true}function leap(t){if(i(t.leapgate_destination_chunk_id)&&i(t.leapgate_destination_pos_idx)&&i(t.leapgate_destination_rot)){if(leapgateAccessBlocked(t))return
De()
Ge(function(){var e=K({pos:[t.leapgate_destination_chunk_id,t.leapgate_destination_pos_idx,t.leapgate_destination_rot]},t)
Be.char_controller.updatePosFromString(e)})}}function fitsInSlot(e,t,r){if(!r)return false
var a=M(e,t)
if(!a)return false
var i=P(e,t)
if(a.count-i<=0)return false
if(!be(a,r))return false
if(r.has_hp&&!r.hp_cur)return false
return true}function fitsInSlotExact(e,t,r){var a=M(e,t)
if(!a)return false
var i=P(e,t)
if(a.count-i<=0)return false
return Re(a,r)}function resolveDeposit(e,t){if(e.type===de)return{leapgate_slot:e,inventory_slot:t}
else if(t.type===de)return{leapgate_slot:t,inventory_slot:e}
else return null}function acceptsItemLeapgate(e,t,r){var a=resolveDeposit(t,r)
if(null===a)return ue
var i=a.leapgate_slot,o=a.inventory_slot
I(e.lgctx)
var n=e.lgctx.leapgate
var s=i.idx
if(t.type===de&&!o.inv)for(var l=0;l<ae(J);++l)if(fitsInSlot(n,s,re(l)))return _e
if(!o.inv)return ce
if(fitsInSlot(n,s,o.inv))return _e
else return ce}var pt=false
function contribute(e,t,r,a,i){pt=true
I.equal(r.type,fe)
var o=e.each_target,n=e.lgctx
I(n)
var s=n.leapgate
var l=M(s,t)
I(l)
var _=P(s,t)
var c=l.count-_
I(c&&c>0)
var u=ut(ut(c,a.count),i)
I(u&&u>0)
Ee(a,r.type+","+r.idx,de+","+t,false)
var d=ve(e)
var f=o[r.type].contents[r.idx]
d.opLeapgateProgress(s,t,f,u,generateNewCost(s))
se(d,o[r.type],r.idx,u)
d.onComplete(function(){pt=false})}function swapItemLeapgate(e,t,r){var a=resolveDeposit(t,r)
if(null===a)return false
var i=a.leapgate_slot,o=a.inventory_slot
if(o.type!==fe)return false
I(t.idx!==r.idx)
var n=e.each_data[o.type][o.idx]
if(!n)return true
I(e.lgctx)
var s=e.lgctx.leapgate
var l=i.idx
I(fitsInSlot(s,l,n))
contribute(e,l,o,n,Infinity)
return true}function quickTransferLeapgate(e,t,r,a){I.equal(t.type,fe)
var i=e.lgctx
I(i)
var o=i.leapgate,n=i.possible_slots
for(var s=0;s<n.length;++s){var l=n[s]
if(fitsInSlotExact(o,l,r)){contribute(e,l,t,r,a)
return true}}for(var _=0;_<n.length;++_){var c=n[_]
if(fitsInSlot(o,c,r)){contribute(e,c,t,r,a)
return true}}return false}function autoCompleteCosts(e,t){var r=e.lgctx
I(r)
var a=r.leapgate
var i
for(var o in a.leapgate_cost)if(o!==t){var n=M(a,o)
I(n)
var s=P(a,o)
var l=n.count-s
if(l&&l>0){pt=true;(i=i||ve(e)).opLeapgateProgress(a,o,n,l,generateNewCost(a))}}if(i)i.onComplete(function(){pt=false})}var mt=100
var Et=.667*mt
var gt=16
var Tt=750
var yt=80
function doDeposit(e,t,r,a,i,o){var n=Z.UI
var s=e.lgctx
I(s)
var l=s.leapgate,_=s.possible_slots
if(o&&l.stage!==x.TARGET)return r
if(o)if(!i)autoCompleteCosts(e,"cost0")
var c=o?["cost0"]:D(l)
c.sort()
var u=c.length
var d=u*(Ve+gt)+ot*(u-1)
var f=t+a/2
var v=l.stage===x.SOURCE?f-d-yt/2:f-d/2
var h=v-gt-ot
var p=v+(Ve+gt+ot)*u
for(var m=0;m<u;++m){var E=c[m]
var g=Le(l.leapgate_cost[E])
var T=P(l,E)
var y={ctx:e,inv_type:de,ii:E,x:v+gt/2,y:r,z:n,slot_w:Ve,no_quickbar:true,quick_transfer_cb:null,accepts_item_cb:acceptsItemLeapgate,swap_cb:swapItemLeapgate,empty_inv:g,allow_empty_select:true,count_override:T+" / "+g.count,disabled:i||T===g.count||pt,label_style:Xe,draw_only:false,no_bg:false,item_context:we}
if(y.disabled){y.draw_only=true
y.no_bg=true
ge(y,g)}else{_.push(E)
if(me(y)){var S=acceptsItemLeapgate(e,{type:de,idx:E},{type:-1,idx:-1})
Ie({x:v>Tt?h-Se:p,y:0,inv:g,context:we,auto_close:true,hint:S?Pe.SETTLEMENT_DRAG_ITEMS:null})}}ft.drawSizedAligned(Qe,v,r+Ve+4,n,nt,ft.ALIGN.HCENTERFIT,Ve+gt,0,g.getName())
v+=Ve+gt+ot}return r+(Ve+4+nt+ot)}function doInventory(e,t,r,a){var i=Z.UI
var o=t
var n=Me()===Ce
if(n){ht.draw({x:o,y:r,z:i,w:Et,h:Et,frame:tt.INVENTORY})
o+=Et+ot}else o+=ot
S.drawLine(o,r,o+.618*(t+a-o),r,i,1,1,Ke)
pe({ctx:e,inv_type:fe,no_quickbar:true,final:true,no_buttons:true,x0:o,y:r+ot,z:i,scale:1,quick_transfer_cb:quickTransferLeapgate,accepts_item_cb:acceptsItemLeapgate,swap_cb:swapItemLeapgate,hide_trash:!n})
Te()}function doLeapgate(e){var t=A()
var r=xe()-e
var a=e+r/2
var i=Fe()
if(!i||!i.isLeapgate()){Ue()
return Pe.LBL_LEAPGATE_TITLE}var o=i.trans_busy||ie(i)||pt
var n=Oe(i.chunk_id,i.pos_idx)
var s
switch(i.stage){case x.SOURCE:s=Pe.LBL_LEAPGATE_SOURCE
break
case x.TARGET:s=Pe.LBL_LEAPGATE_TARGET
break
case x.COMPLETE:s=Pe.LBL_LEAPGATE_COMPLETE
break
default:s=Pe.LBL_LEAPGATE_MODELESS}vt.drawSizedAligned(Ze,e,t,Z.UI,st,ft.ALIGN.HCENTERFIT,r,0,s.$({name:n}))
t+=st+ot
if(i.stage===x.COMPLETE){if(S.buttonText({x:a-He/2,y:t,w:He,h:mt,font_height:36,text:Pe.BTN_LEAPGATE_LEAP})){Ue()
y()
leap(i)}V(i,"leapgate_access",{x:a-He,y:t+=mt+8,width:2*He,entry_height:mt,font_height:36,disabled:false})
Y(i,{x:a-He,y:t+=mt+8,width:2*He,entry_height:mt,font_height:36,disabled:false})
t+=mt+8
return Pe.LBL_LEAPGATE_TITLE}if(!i.stage){t+=ft.drawSizedAligned(Qe,e+64,t,Z.UI,it,ft.ALIGN.HCENTERFIT|ft.ALIGN.HWRAP,r-128,0,Pe.LBL_LEAPGATE_MODELESS_HINT_1)+ot
t+=ft.drawSizedAligned(Qe,e+64,t,Z.UI,it,ft.ALIGN.HCENTERFIT|ft.ALIGN.HWRAP,r-128,0,Pe.LBL_LEAPGATE_MODELESS_HINT_2)+ot
t+=ot
S.drawLine(e+64,t,e+r-64,t,Z.UI,1,1,Ke)
t+=2*ot
if(S.buttonText({x:a-2*He-ot,y:t,w:2*He,h:mt,font_height:36,text:Pe.BTN_LEAPGATE_SOURCE,disabled:o})){i.setStage(x.SOURCE)
i.leapgate_extracts=i.leapgate_extracts||0
applyNewCost(i,generateNewCost(i))
ze(i)
return Pe.LBL_LEAPGATE_TITLE}if(S.buttonText({x:a+ot,y:t,w:2*He,h:mt,font_height:36,text:Pe.BTN_LEAPGATE_TARGET,disabled:o})){i.setStage(x.TARGET)
i.leapgate_deposits=0
applyNewCost(i,generateNewCost(i))
ze(i)
return Pe.LBL_LEAPGATE_TITLE}return Pe.LBL_LEAPGATE_TITLE}var l=rt()
var _=!l
if(_&&!(lt()>=U))_=false
if(_){var c=Q(i.getLocalPos())
if(c)if(X(c)<F)_=false}function doCostDebug(){if(l)return
if(_)t+=ft.drawSizedAligned(qe,e+64,t,Z.UI,it,ft.ALIGN.HCENTERFIT|ft.ALIGN.HWRAP,r-128,0,Pe.LBL_LEAPGATE_ACCESS_WARNING)+ot
if(T.DEBUG){if(S.buttonText({x:a-He/2,y:t,w:He,h:mt,font_height:36,text:"Regenerate Cost"})){applyNewCost(i,generateNewCost(i))
ze(i)}t+=mt+ot
if(S.buttonText({x:a-He/2,y:t,w:He,h:mt,font_height:36,text:"Set Trivial Cost"})){applyNewCost(i,{cost1:{type:b,id:et.DIRT,count:1},cost2:{type:b,id:et.DIRT,count:1},cost3:{type:b,id:et.DIRT,count:1}})
ze(i)}t+=mt+ot}}if(i.stage===x.SOURCE){t+=ft.drawSizedAligned(Qe,e+64,t,Z.UI,it,ft.ALIGN.HCENTERFIT|ft.ALIGN.HWRAP,r-128,0,l?Pe.LBL_LEAPGATE_SOURCE_HINT_1_UNLIMITED:Pe.LBL_LEAPGATE_SOURCE_HINT_1)+ot
t+=ot
S.drawLine(e+64,t,e+r-64,t,Z.UI,1,1,Ke)
t+=2*ot
var u=o||!l&&!B(i)
doCostDebug()
var d=l?a-2*He-ot:a+yt/2
if(S.buttonText({x:d,y:t,w:2*He,h:mt,font_height:36,text:Pe.BTN_LEAPGATE_EXTRACT,disabled:u})){var f=Le({type:N,id:w,attr1:0,attr2:i.chunk_id,attr3:i.pos_idx,attribs:{rot:(i.rot||0)+1}})
if(oe())Ye("iheavy").setMessage(Pe.MSG_PLAYER_CARRYING_HEAVY)
else if(!ee(f))Ye("ifull").setMessage(Pe.MSG_INVENTORY_FULL)
else{var v=Be.getFrameTransaction()
ne(v,J,f)
te(v)
i.leapgate_extracts=(i.leapgate_extracts||0)+1
applyNewCost(i,generateNewCost(i))
ze(i)}}if(l){if(S.buttonText({x:a+ot,y:t,w:2*He,h:mt,font_height:36,text:Pe.BTN_LEAPGATE_RESET,disabled:u})){i.setStage(x.INITIAL)
ze(i)
return Pe.LBL_LEAPGATE_TITLE}t+=mt+2*ot}else ft.drawSizedAligned(u?Qe:Ze,a-yt/2,t,Z.UI,st,ft.ALIGN.HVCENTER,yt,mt,"→")
var h=he({lgctx:{leapgate:i,possible_slots:[]}})
t=doDeposit(h,e,t,r,o,l)
doInventory(h,e,t,r)
return Pe.LBL_LEAPGATE_TITLE}if(i.stage===x.TARGET){var p=0===i.leapgate_deposits?Pe.LBL_LEAPGATE_TARGET_HINT_1:Pe.LBL_LEAPGATE_TARGET_HINT_1_PROGRESS
var m=l?1:C-i.leapgate_deposits
var E=Oe(i.leapgate_destination_chunk_id,i.leapgate_destination_pos_idx)
t+=ft.drawSizedAligned(Qe,e+64,t,Z.UI,it,ft.ALIGN.HCENTERFIT|ft.ALIGN.HWRAP,r-128,0,p.$({remaining:m,name:E}))+ot
t+=ot
S.drawLine(e+64,t,e+r-64,t,Z.UI,1,1,Ke)
t+=2*ot
doCostDebug()
if(l){if(S.buttonText({x:a-He,y:t,w:2*He,h:mt,font_height:36,text:Pe.BTN_LEAPGATE_RESET,disabled:o})){i.setStage(x.INITIAL)
ze(i)
return Pe.LBL_LEAPGATE_TITLE}t+=mt+2*ot}var g=he({lgctx:{leapgate:i,possible_slots:[]}})
t=doDeposit(g,e,t,r,o,l)
doInventory(g,e,t,r)}return Pe.LBL_LEAPGATE_TITLE}function leapgateSelectAutoActivate(e,t,r,a){if(leapgateAccessBlocked(e))return false
var i=_t(t/1e3)
Ye(r).setMessage(Pe.STATUSMSG_LEAPGATE_TO.$({seconds:i}))
return true}function leapgateExecuteAutoActivate(e,t){leap(e)}},{"../common/ids":249,"../common/leapgate_common":252,"../common/materials_common":253,"../common/world_constants":267,"../glov/client/engine":305,"../glov/client/input.js":326,"../glov/client/ui":367,"../glov/common/rand_alea":395,"../glov/common/util":400,"./auto_activate_ui":15,"./build_queue_ui":34,"./client_cmds.js":43,"./editvolume_client":84,"./inventory":114,"./inventory_ui":115,"./item_info_view":117,"./items":119,"./layout":120,"./loading_custom":128,"./localization/localization":131,"./main":135,"./menu":140,"./prop_edit":170,"./settlement_edit":182,"./status":193,"./styles":197,"./tiles_const":200,"./ui_util":205,"./user_data.js":208,"./waygate_ui":222,"./world_metadata":235,assert:void 0}],122:[function(e,t,d){"use strict"
d.lightCalcReset=lightCalcReset
d.lightCalcBakeRules=lightCalcBakeRules
d.lightCalc=lightCalc
d.torch_table=d.sun_table=d.clear_version=d.LIGHT_TORCH=d.LIGHT_SUN=d.LIGHT_FADE_HORIZ=void 0
var q=e("assert")
var r=e("../common/globals.js"),Z=r.CS2,a=r.CS3,n=r.ID_FACTOR,i=r.ID2
var X=Math.max,c=Math.min,u=Math.round,f=Math.sqrt
var k=e("./tiles.js").TILE_NON_OPAQUE
var o=e("../common/voxel_data_common.js").ZMAP_UNKNOWN
var v=f(2)
var s=1+n+i
var U=16
var G=23-(d.LIGHT_FADE_HORIZ=U)
var Q=1
d.LIGHT_SUN=Q
var M=2
d.LIGHT_TORCH=M
var $=255
var h=3
var J=0
d.clear_version=J
function emitScaled(e){return $-u((1-e)*$/U)*U}var l
var ee
function lightCalcReset(e,t){l=e
ee=t}var D
function lightCalcBakeRules(e){D=e}function lightAlloc(e,t){q(t)
q(e)
if(!e[t])e[t]=new Uint8Array(a)
return e[t]}var te=new Array(64)
var F=new Array(64)
var _={}
var W=new Array(64)
var H=new Array(64)
var z=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]]
var V=[[[-1,-1,0],[-1,1,0],[-1,0,-1],[-1,0,1]],[[1,-1,0],[1,1,0],[1,0,-1],[1,0,1]],[[-1,-1,0],[1,-1,0],[0,-1,-1],[0,-1,1]],[[-1,1,0],[1,1,0],[0,1,-1],[0,1,1]],[[-1,0,-1],[1,0,-1],[0,-1,-1],[0,1,-1]],[[-1,0,1],[1,0,1],[0,-1,1],[0,1,1]]]
function isBorder(e){var t=12303&e
var r=49392&e
var a=200448&e
return!t||!r||!a||8207===t||33008===r||134912===a}function spreadLight(e,t){for(var r=255;r>0;--r){var a=e[r]
if(!a)continue
var i=r-U
var o=r-G
for(var n=0;n<a.length;++n){var s=a[n]
var l=s>>12
var _=4095&s
if(W[l][_]>r)continue
var c=15&_
var u=(240&_)>>4
var d=_>>8
for(var f=0;f<z.length;++f){var v=z[f]
var h=l
var p=c
var m=u
var E=d
if(v[0]){if(16&(p+=v[0])){h+=p>>4
p&=15}}else if(v[1]){if(16&(m+=v[1])){h+=m<0?-4:4
m&=15}}else if(16&(E+=v[2])){h+=E<0?-16:16
E&=15}var g=256*E+16*m+p
var T=F[h][g]
if(T&&T<k)continue
var y=W[h]
if(!y)y=W[h]=lightAlloc(te[h],t)
var S=y[g]
if(i>=S){var I=void 0
if(i===S){var A=V[f]
for(var w=I=0;w<A.length;++w){var L=A[w]
var O=l
var R=c
if(L[0])if(16&(R+=L[0])){O+=R>>4
R&=15}var b=u
if(L[1])if(16&(b+=L[1])){O+=b<0?-4:4
b&=15}var N=d
if(L[2])if(16&(N+=L[2])){O+=N<0?-16:16
N&=15}var C=256*N+16*b+R
var x=W[O]
if(x&&x[C]===r){I=o
break}}}else I=i
if(I)if((y[g]=I)>U){var M=4096*h+g
if(!isBorder(M)){var D=e[I]
if(!D)D=e[I]=[]
D.push(M)}else{var P=H[h]
var B=P[I]
if(!B)B=P[I]=[]
B.push(g)}}}}}}}function sunAttenuationTable(){var e=1/16
var t=[]
for(var r=0;r<16;++r)for(var a=0;a<16;++a){var i=X(0,$-(a*G+r*U))
if(!i||t[i])continue
var o=i
var n=2/(e*(a*(v-1)+r)+1)-1
n=c(X(n,0),1)
i=u(255*n)
t[o]=i}t[0]=0
return t}var p=sunAttenuationTable()
d.sun_table=p
function torchAttenuationTable(e){var t=new Uint8Array(256)
for(var r=0;r<16;++r)for(var a=0;a<16;++a){var i=X(0,$-(a*G+r*U))
if(!i||t[i])continue
var o=i
var n=a*(v-1)+r
var s=n?1/(f(e)*n):1
var l=.05
var _=(s*s-l)/(1-l)
s=_>0?f(_):0
s=c(X(s,0),1)
i=u(255*s)
t[o]=i}t[0]=0
return t}var m=torchAttenuationTable(.075)
d.torch_table=m
var re=function(){var e=[]
for(var t=-1;t<=1;++t)for(var r=-1;r<=1;++r)for(var a=-1;a<=1;++a){var i=a+1+4*(r+1)+16*(t+1)
var o=[]
if(a>=0)o.push(0)
if(a<=0)o.push(1)
if(r>=0)o.push(2)
if(r<=0)o.push(3)
if(t>=0)o.push(4)
if(t<=0)o.push(5)
e[i]=o}return e}()
var ae=[-1,1,-4,4,-16,16]
var w=[[0,1,0,16,0,16],[15,16,0,16,0,16],[0,16,0,1,0,16],[0,16,15,16,0,16],[0,16,0,16,0,1],[0,16,0,16,15,16]]
var ie=new Int16Array(Z)
ie.fill(o)
function reinitEmitters(e,t,r,a,i,o,n,s){var l=w[e]
var _=l[0]
var c=l[1]
var u=l[2]
var d=l[3]
var f=l[4]
var v=l[5]
for(var h=f;h<v;++h){var p=!a&&!h||2===a&&15===h
for(var m=u;m<d;++m){var E=h*Z+16*m+_
var g=p||!r&&!m||2===r&&15===m
for(var T=_;T<c;++T,++E){var y=o[E]
if(y>G)if(g||!t&&!T||2===t&&15===T){var S=s[y]
if(!S)S=s[y]=[]
if(-1===S.indexOf(E))S.push(E)}else{var I=i+E
var A=n[y]
if(!A)A=n[y]=[]
if(-1===A.indexOf(I))A.push(I)}}}}}function lightSunInit(e,t,r,a,i,o){var n=i.light_sun
var s=4096*a
if(i.light_need_init&Q){if(n)n.fill(0)
i.sun_clear_version=J
i.light_need_init&=~Q
i.light_sent=false
var l=o[$]
if(!l)l=o[$]=[]
var _=[]
var c=ee[i.vsid]
c=c&&c.data||ie
var u=i.worldZ()
var d=u+15
var f=0
var v
for(var h=0;h<16;++h){var p=16*h+3840
var m=!h&&!t||15===h&&2===t
var E=h&&h<15
for(var g=0;g<16;++g,++f){var T=c[f]
var y=m||!g&&!e||15===g&&2===e
var S=E&&g&&g<15
q(void 0!==T)
if(T>=d)continue
if(S){var I=c[f-16]
var A=c[f-1]
var w=c[f+1]
var L=c[f+16]
v=X(I,A,w,L)-1}else v=Infinity
if(!n)n=lightAlloc(i,"light_sun")
var O=X(u-1,T)
var R=g+p
for(var b=d;b>O;R-=Z,--b){n[R]=$
if(b>v)continue
if(!(y||!r&&R<Z||2===r&&R>=3840)){var N=s+R
l.push(N)}else _.push(R)}}}if(_.length)i.emitters_sun[$]=_
for(var C=0;C<i.sun_emit_version.length;++C)i.sun_emit_version[C]=J
return}if(!n){for(var x=0;x<i.sun_emit_version.length;++x)i.sun_emit_version[x]=J
return}var M=i.emitters_sun
var D=false
for(var P in M){D=true
break}if(D){var B={}
for(var k in M){var U=M[k]
var G=o[k=Number(k)]
if(!G)G=o[k]=[]
var F=[]
for(var W=0;W<U.length;++W){var H=s+U[W]
if(isBorder(H))F.push(U[W])
else G.push(H)}if(F.length)B[k]=F}M=i.emitters_sun=B}var z=re[a]
for(var V=0;V<z.length;++V){var Y=z[V]
var j=a+ae[Y]
var K=te[j]
q(K)
if(K.light_need_init&Q||K.sun_clear_version>i.sun_emit_version[Y]){reinitEmitters(Y,e,t,r,s,n,o,M)
i.sun_emit_version[Y]=J
i.light_sent=false}}}function lightTorchInit(e,t,r,a,i,o){var n=i.light_torch
var s=i.baked_props
var l=4096*a
if(i.light_need_init&M){if(n)n.fill(0)
i.torch_clear_version=J
i.light_need_init&=~M
i.light_sent=false
if(s)for(var _ in s){var c=s[_].key
if(!c)continue
if(!D[c])q(0,"lightTorchInit got prop with unknown baked key "+c)
var u=D[c].emit
if(u){var d=emitScaled(u)
_=Number(_)
if(!n)n=lightAlloc(i,"light_torch")
n[_]=d
var f=l+_
if(!isBorder(f)){var v=o[d]
if(!v)v=o[d]=[]
v.push(f)}else{var h=i.emitters_torch[d]
if(!h)h=i.emitters_torch[d]=[]
h.push(_)}}}for(var p=0;p<i.torch_emit_version.length;++p)i.torch_emit_version[p]=J
return}if(!n){for(var m=0;m<i.torch_emit_version.length;++m)i.torch_emit_version[m]=J
return}var E=i.emitters_torch
var g=false
for(var T in E){g=true
break}if(g){var y={}
for(var S in E){var I=E[S]
var A=o[S=Number(S)]
if(!A)A=o[S]=[]
var w=[]
for(var L=0;L<I.length;++L){var O=l+I[L]
if(isBorder(O))w.push(I[L])
else A.push(O)}if(w.length)y[S]=w}E=i.emitters_torch=y}var R=re[a]
for(var b=0;b<R.length;++b){var N=R[b]
var C=a+ae[N]
var x=te[C]
q(x)
if(x.light_need_init&M||x.torch_clear_version>i.torch_emit_version[N]){reinitEmitters(N,e,t,r,l,n,o,E)
i.torch_emit_version[N]=J
i.light_sent=false}}}function getNeighbors(e){for(var t=0;t<h;++t)for(var r=0;r<h;++r){var a=4*(4*t+r)
for(var i=0;i<h;++i,++a){var o=l[e+(t*n+r)*n+i-s]
q(o)
te[a]=o
F[a]=o.data||_}}}function lightCalc(e){if(e.full)return
d.clear_version=J+=1
getNeighbors(e.chunk_id)
var t=[]
for(var r=0;r<h;++r)for(var a=0;a<h;++a){var i=4*(4*r+a)
for(var o=0;o<h;++o,++i){var n=te[i]
lightSunInit(o,a,r,i,n,t)
W[i]=n.light_sun
H[i]=n.emitters_sun}}if(t.length)spreadLight(t,"light_sun")
t=[]
for(var s=0;s<h;++s)for(var l=0;l<h;++l){var _=4*(4*s+l)
for(var c=0;c<h;++c,++_){var u=te[_]
lightTorchInit(c,l,s,_,u,t)
W[_]=u.light_torch
H[_]=u.emitters_torch}}if(t.length)spreadLight(t,"light_torch")}},{"../common/globals.js":248,"../common/voxel_data_common.js":264,"./tiles.js":199,assert:void 0}],123:[function(e,t,r){"use strict"
r.ptLineDistSq=ptLineDistSq
r.v2distSqBV=v2distSqBV
r.ptLineDistSqBBV=ptLineDistSqBBV
var s=e("assert")
var a=e("../glov/common/vmath.js"),i=a.vec2,n=a.v2addScale,l=a.v2distSq,_=a.v2lengthSq,c=a.v2set,u=a.v2sub
var d=i()
function ptLineDistSq(e,t,r,a){u(d,r,t)
var i=_(d)
s(i>0)
var o=((a[0]-t[0])*d[0]+(a[1]-t[1])*d[1])/i
if(o<0)c(e,0,l(a,t))
else if(o>1)c(e,1,l(a,r))
else{n(d,t,d,o)
c(e,o,l(a,d))}return e}function v2distSqBV(e,t,r){return(e[t+0]-r[0])*(e[t+0]-r[0])+(e[t+1]-r[1])*(e[t+1]-r[1])}function ptLineDistSqBBV(e,t,r,a,i){d[0]=t[a]-t[r]
d[1]=t[a+1]-t[r+1]
var o=_(d)
s(o>0)
var n=((i[0]-t[r])*d[0]+(i[1]-t[r+1])*d[1])/o
if(n<0)c(e,0,v2distSqBV(t,r,i))
else if(n>1)c(e,1,v2distSqBV(t,a,i))
else{d[0]=t[r]+d[0]*n
d[1]=t[r+1]+d[1]*n
c(e,n,l(i,d))}return e}},{"../glov/common/vmath.js":402,assert:void 0}],124:[function(e,t,r){"use strict"
r.lineLineDist=lineLineDist
r.pointLineDist=pointLineDist
r.intersect=intersect
r.ptLineDist3DSq=ptLineDist3DSq
r.v3distSqBV=v3distSqBV
r.ptLineDist3DSqBBV=ptLineDist3DSqBBV
r.ptLineNearestBBV=ptLineNearestBBV
var s=e("assert")
var l=Math.sqrt
var a=e("../glov/common/vmath.js"),d=a.vec3,_=a.v2set,c=a.v3addScale,u=a.v3copy,f=a.v3cross,v=a.v3determinant,h=a.v3distSq,p=a.v3lengthSq,m=a.v3sub,E=a.v3div,g=a.v4set,T=a.unit_vec
var y=1e-7
var S=d()
var I=d()
var A=d()
var w=d()
var L=d()
function lineLineDist(e,t,r,a,i){f(S,r,i)
var o=p(S)
if(o<y)return 0
m(I,a,t)
var n=v(I,i,S)
var s=v(I,r,S)/o
c(A,t,r,n/o)
c(w,a,i,s)
m(L,w,A)
u(e,A)
return l(p(L))}var i=d()
function pointLineDist(e,t,r){return l(p(f(S,t,m(i,e,r))))}function intersect(e,t,r){var a
var i
var o
var n
var s=d()
o=d(r[0],r[1],r[2])
n=d(r[0]+1,r[1]+1,r[2]+1)
a=(o[0]-e[0])/t[0]
i=(n[0]-e[0])/t[0]
E(s,T,t)
if(a>i)if(s[0]>=0){a=(o[0]-e[0])*s[0]
i=(n[0]-e[0])*s[0]}else{a=(n[0]-e[0])*s[0]
i=(o[0]-e[0])*s[0]}var l=(o[1]-e[1])/t[1]
var _=(n[1]-e[1])/t[1]
if(l>_)if(s[1]>=0){l=(o[1]-e[1])*s[1]
_=(n[1]-e[1])*s[1]}else{l=(n[1]-e[1])*s[1]
_=(o[1]-e[1])*s[1]}if(a>_||l>i)return false
if(l>a)a=l
if(_<i)i=_
var c=(o[2]-e[2])/t[2]
var u=(n[2]-e[2])/t[2]
if(c>u)if(s[2]>=0){c=(o[2]-e[2])*s[2]
u=(n[2]-e[2])*s[2]}else{c=(n[2]-e[2])*s[2]
u=(o[2]-e[2])*s[2]}if(a>u||c>i)return false
if(c>a)a=c
if(u<i)i=u
return i}var O=d()
function ptLineDist3DSq(e,t,r,a){m(O,r,t)
var i=p(O)
s(i>0)
var o=((a[0]-t[0])*O[0]+(a[1]-t[1])*O[1]+(a[2]-t[2])*O[2])/i
if(o<0)_(e,0,h(a,t))
else if(o>1)_(e,1,h(a,r))
else{c(O,t,O,o)
_(e,o,h(a,O))}return e}function v3distSqBV(e,t,r){return(e[t+0]-r[0])*(e[t+0]-r[0])+(e[t+1]-r[1])*(e[t+1]-r[1])+(e[t+2]-r[2])*(e[t+2]-r[2])}function ptLineDist3DSqBBV(e,t,r,a,i){O[0]=t[a+0]-t[r+0]
O[1]=t[a+1]-t[r+1]
O[2]=t[a+2]-t[r+2]
var o=p(O)
s(o>0)
var n=((i[0]-t[r+0])*O[0]+(i[1]-t[r+1])*O[1]+(i[2]-t[r+2])*O[2])/o
if(n<0)_(e,0,v3distSqBV(t,r,i))
else if(n>1)_(e,1,v3distSqBV(t,a,i))
else{O[0]=t[r+0]+O[0]*n
O[1]=t[r+1]+O[1]*n
O[2]=t[r+2]+O[2]*n
_(e,n,h(i,O))}return e}function ptLineNearestBBV(e,t,r,a,i){O[0]=t[a+0]-t[r+0]
O[1]=t[a+1]-t[r+1]
O[2]=t[a+2]-t[r+2]
var o=p(O)
s(o>0)
var n=((i[0]-t[r+0])*O[0]+(i[1]-t[r+1])*O[1]+(i[2]-t[r+2])*O[2])/o
if(n<0)g(e,t[r],t[r+1],t[r+2],0)
else if(n>1)g(e,t[a],t[a+1],t[a+2],1)
else{e[0]=t[r+0]+O[0]*n
e[1]=t[r+1]+O[1]*n
e[2]=t[r+2]+O[2]*n
e[3]=n}return e}},{"../glov/common/vmath.js":402,assert:void 0}],125:[function(e,t,r){"use strict"
r.linkPayloadToURL=linkPayloadToURL
r.linkParseGeneric=linkParseGeneric
r.linkParseBlueprint=linkParseBlueprint
r.linkParsePhoto=linkParsePhoto
var a=e("assert")
var i=e("../glov/client/net")
var o=i.netClient
var n=i.netDisconnected
var s=e("../glov/client/ui")
var l=s.modalDialog
var _=s.modalDialogClear
var c=e("../glov/common/util").VALID_USER_ID_REGEX
var u=e("../common/blueprint_common").bid_valid_readonly_regex
var d=e("../common/types")
var f=d.linkPayloadIsBlueprint
var v=d.linkPayloadIsPhoto
var h=d.linkPayloadIsUser
var p=d.linkPayloadIsWorld
var m=e("../common/waygate_common").waygate_valid_regex
var E=e("./localization/localization").L
var g=e("./photo_ui").photoIdValid
var T=e("./world_info_view").worldLink
function linkPayloadToURL(e){if(p(e))return T(e.w,e.wg)
else if(f(e))return"blueprint/"+e.blueprint
else if(v(e))return"photo/"+e.photo
else if(h(e)){if(e.action)return"u/"+e.u+"/"+e.action
return"u/"+e.u}a(false)}function decodeFacebookLink(e,r){if(!e.startsWith("https://fb.gg"))return r("ERR_NOT_FB_LINK")
if(n())return r("ERR_DISCONNECTED")
l({title:E.DLG_LINK_PARSING_TITLE,text:E.MSG_PLEASE_WAIT})
var t=o().pak("link_parse")
t.writeString(e)
t.send(function(e,t){_()
r(e,t)})}function validLinkPayload(e){if(p(e)&&isFinite(Number(e.w))&&(!e.wg||e.wg.match(m)))return true
else if(h(e)&&e.u.match(c))return true
else if(v(e)&&g(e.photo))return true
else if(f(e)&&e.blueprint.match(u))return true
return false}function linkParseGeneric(o,n,s){try{o=decodeURIComponent(o)}catch(e){}decodeFacebookLink(o=o.trim(),function(e,t){if(!e&&t){if(!validLinkPayload(t))return s(null)
return s(t)}if(!o.includes("/")&&n)o=n+"/"+o
else if(o.match(/^\d+\/[a-z0-9_]+$/))o="w/"+o
if(o.startsWith("http")||o.startsWith("worlds.frvr")||o.startsWith("u/")||o.startsWith("w/")||o.startsWith("photo/")||o.startsWith("blueprint/")){if(o.includes("msstart3pp=")){var r=o.match(/msstart3pp=(\{[^&]+\})(?:$|&)/)
if(r)try{var a=JSON.parse(r[1])
if(a.url)o=a.url}catch(e){}}var i=o.match(/(?:^|\/)w\/(\d+)+(?:\/([^/?&]+))?/)
if(i)return s({w:i[1],wg:i[2]})
if(i=o.match(/(?:^|\/)(u|photo|blueprint)\/([0-9A-Za-z_$]+)/))if("u"===i[1]&&i[2].match(c))return s({u:i[2]})
else if("photo"===i[1]&&g(i[2]))return s({photo:i[2]})
else if("blueprint"===i[1]&&i[2]&&i[2].match(u))return s({blueprint:i[2]})}s(null)})}function linkParseBlueprint(e,t){linkParseGeneric(e,"blueprint",function(e){if(f(e))t(e.blueprint)
else t(null)})}function linkParsePhoto(e,t){linkParseGeneric(e,"photo",function(e){if(v(e))t(e.photo)
else t(null)})}},{"../common/blueprint_common":240,"../common/types":263,"../common/waygate_common":265,"../glov/client/net":338,"../glov/client/ui":367,"../glov/common/util":400,"./localization/localization":131,"./photo_ui":159,"./world_info_view":231,assert:void 0}],126:[function(e,t,r){"use strict"
r.liquidStartup=liquidStartup
r.liquidUpdateReset=liquidUpdateReset
r.liquidUpdatePrepare=liquidUpdatePrepare
r.liquidUpdateFinalize=liquidUpdateFinalize
r.liquidUpdateDeferInternal=liquidUpdateDeferInternal
r.updateLiquid=r.liquid_tick_idx=void 0
var oe=e("assert")
var a=e("../glov/client/engine")
var i=e("../glov/common/vmath")
var n=i.v3copy
var ne=i.v3set
var o=e("../common/globals")
var se=o.CHUNK_SIZE
var le=o.CS2
var s=o.CS3
var l=o.ID2
var _=o.ID_FACTOR
var _e=e("../common/world_trans").createTransSet
var ce=e("./editvolume_client").inEditBoundsByChunkId
var c=e("./main")
var u=e("./rand_seed")
var d=e("./tiles")
var ue=d.TILE_DIRT
var de=d.TILE_GRASS
var fe=d.TILE_LIQUID_EMPTY
var ve=d.TILE_POROUS
var he=d.TILE_PROP_BASE
var pe=d.TILE_PROP_MAX
var f=d.TILE_STONE
var me=d.TILE_TILLED
var Ee=d.TILE_TILLED_WATERED
var ge=d.TILE_WATER
var Te=d.TILE_WATER_FLOW
var ye=d.priority_liquid
var Se=d.priority_solid
var v=e("./voxel_data")
var h=e("./voxel_data")
var Ie=h.andGetChunkID
var Ae=h.getGenMiss
var p=h.getPropRelativeFromTile
var we=h.getTileRelative
var m=h.resetGenMiss
var Le=h.transSetTileDirect
var Oe=h.transSetTileRelative
var E=e("./world_comm").worldTransactionsInProgress
var Re=Math.random
var g=500
var be=.15
function liquidStartup(){}var Ne=0
r.liquid_tick_idx=Ne
var T=g
var Ce=false
var xe
var Me
function liquidUpdateReset(){Ce=false}function liquidUpdatePrepare(){m()
if((T-=a.frame_dt)<=0&&!Ce&&!E()){T+=g
r.liquid_tick_idx=Ne+=1
return true}else if(T<0)T=0
return false}function liquidUpdateFinalize(){if(Me){oe(!Ce)
if(Me.numOps()||xe.hasPristineSends()){if(Me.numOps()){var e=c.getFrameTransaction()
e.ops=Me.ops
e.loose_compaction=Me.loose_compaction
Ce=true
e.silent_error=true
e.onComplete(function(){Ce=false})}if(xe.hasPristineSends())c.getFrameTransactionSet().mergePristineSends(xe)
Me=xe=null}}}function liquidUpdateDeferInternal(e){e.last_liquid_tick=Ne+2}var y=function(){var K=new Int32Array(3)
var q=new Int32Array(3)
var Z=new Int32Array(3)
var X=new Int32Array(3)
var Q=[-1,1,0,0]
var $=[0,0,-1,1]
var J=new Array(Q.length)
var ee=new Array(Q.length)
var te=new Array(Q.length)
var re=u.createFast()
var e={data:new Uint8Array(s)}
e.data.fill(f)
var ae
var ie
var t
var r
var a
var i
var o=new Int32Array(3)
function ulGetRelative(){t=ae
n(o,K)
if(o[0]<0){t--
o[0]+=16}else if(o[0]>=16){t++
o[0]-=16}if(o[1]<0){t-=_
o[1]+=16}else if(o[1]>=16){t+=_
o[1]-=16}if(o[2]<0){t-=l
o[2]+=16}else if(o[2]>=16){t+=l
o[2]-=16}if(!(r=ie[t])){if(!(r=v.chunk_map[t])||!r.did_gen)r=e
else if(!ce(r.chunk_id))r=e
ie[t]=r}i=o[0]+o[1]*se+o[2]*le
if(!r.data)a=0
else a=r.data[i]
return a}function ulAndGetLiquid(){return r.liquid?r.liquid[i]:0}function ulGetLiquid(){ulGetRelative()
return ulAndGetLiquid()}function ulAndGetProp(){return p(t,o,a)}return function updateLiquidFn(t){if(t.last_liquid_tick>=Ne||Ce)return false
t.getLocalPos(Z)
t.last_liquid_tick=Ne
oe(t.liquid)
ie={}
ae=t.chunk_id
var e=ge
var r=Te
oe(ye[e])
oe(ye[r])
var a=[]
var i=false
var o={}
var n={}
var s=Ae()
if(!Me){xe=_e();(Me=xe.trans()).loose_compaction=true}var l=Me.ops.length
function propFlows(e){return e&&"block"!==e.inv.on_flow}function setLiquid(e){var t=Oe(Me,ae,K,e,true,true,false)
t.loose_priority=ye[e]
if(e&&!ulGetRelative())t[4]|=4
ne(X,K[0],K[1],K[2]-1)
var r=we(ae,X,0,false)
if((r===me||r===Ee)&&ce(Ie()))Oe(Me,ae,X,ue,false,true,false).loose_priority=Se[ue]}function setSelf(e){Le(Me,t,q,e,true,true,void 0,false).loose_priority=ye[e]
if(!e){ne(X,q[0],q[1],q[2]-1)
if(we(ae,X,0,false)===ue&&Re()<be&&ce(Ie()))Oe(Me,ae,X,de,false,true,false).loose_priority=Se[de]}}var _
var c
var u
function flowToNeighbor(e){if(ee[e])return
if(J[e])return
ne(K,_+Q[e],c+$[e],u)
setLiquid(r)
var t=te[e]
if(t)o[t.uid]=t}var d=0
for(u=0;u<se;++u)for(c=0;c<se;++c)for(_=0;_<se;++_,++d){var f=t.liquid[d]
if(f!==e&&f!==r)continue
if(a[d-le])continue
ne(K,_,c,u)
var v=ulGetRelative()
var h=void 0
if(v>=he&&v<=pe)if(propFlows(h=ulAndGetProp()))v=0
if(v){if(h&&h.onUnflow)n[h.uid]=h
Le(Me,t,K,fe,true,true,f,false)
continue}ne(K,_,c,u-1)
var p=ulGetRelative()
var m=ulAndGetLiquid()
var E=void 0
if(p>=he&&p<=pe)if(propFlows(E=ulAndGetProp()))p=0
if(f===e&&!p&&(!m||m===r)){a[d]=true
if(E)o[E.uid]=E
K[2]=u+1
if(ulGetLiquid()===e){K[2]=u+2
if(ulGetLiquid()===e){K[2]=u-1
setLiquid(e)
continue}}K[2]=u-1
setLiquid(e)
K[2]=u
Le(Me,t,K,fe,true,true,f,false).loose_priority=ye[f]
if(h&&h.onUnflow)n[h.uid]=h
continue}if(f===r&&!p&&!m){setLiquid(r)
if(E)o[E.uid]=E
continue}ne(K,_,c,u+1)
var g=ulGetLiquid()
var T=g===e||g===r?1:0
for(var y=0;y<Q.length;++y){ne(K,_+Q[y],c+$[y],u)
var S=ulGetRelative()
ee[y]=ulAndGetLiquid()
var I=S>=he&&S<=pe&&ulAndGetProp()
if(I)if(propFlows(I))S=0
else I=null
J[y]=S
te[y]=I}var A=0
var w=0
var L=0
var O=[]
var R=[]
for(var b=0;b<Q.length;++b){var N=J[b]
var C=ee[b]
if(C===e)++A
else if(N&&N<ve)++w
else if(N);else if(C&&C!==r);else{if(C===r)++L
ne(K,_+Q[b],c+$[b],u-1)
var x=ulGetRelative()
var M=ulAndGetLiquid()
if(x>=he&&x<=pe)if(propFlows(ulAndGetProp()))x=0
if(!x&&(!M||M===r))O.push(b)
else if(M===e)R.push(b)}}ne(q,_,c,u)
if(f===e&&O.length&&!A&&!T){var D=0
if(O.length>1){re.reseed(10007*ae+d)
D=re.range(O.length)}var P=O[D]
var B=te[P]
if(B)o[B.uid]=B
if(h&&h.onUnflow)n[h.uid]=h
ne(K,_+Q[P],c+$[P],u)
setLiquid(f)
setSelf(fe)
continue}if(f===e){if(R.length)for(var k=0;k<R.length;++k)flowToNeighbor(R[k])
else if(O.length){var U=0
if(O.length>1){re.reseed(10007*ae+d)
U=re.range(O.length)}flowToNeighbor(U=O[U])}else if(T||A)if(!L){var G=[]
for(var F=0;F<Q.length;++F)if(!J[F]&&!ee[F])G.push(F)
if(G.length){var W=0
if(G.length>1){re.reseed(10007*ae+d)
W=re.range(G.length)}flowToNeighbor(G[W])}}if(!A&&!T&&w<4||1===A&&!R.length&&!T&&w<2&&!O.length)if(1&Ne)setSelf(r)
else i=true}else{var H=p&&p<ve
var z=m&&m===e
if(!T&&!A){if(h&&h.onUnflow)n[h.uid]=h
setSelf(fe)}else if(A>0&&(H||z)&&A+w>=3||T&&H||A>=3||A&&A+L===4)setSelf(e)
else if(O.length&&!R.length&&A+L<=1&&H){var V=0
if(O.length>1){re.reseed(10007*ae+d)
V=re.range(O.length)}flowToNeighbor(V=O[V])
setSelf(e)}}}if(Ae()!==s){Me.ops.length=l
t.liquid_unstable=false
return true}if(Me.ops.length!==l||i){for(var Y in o)o[Y].onFlow(Me,null,true)
for(var j in n)n[j].onUnflow(Me,null,true)}else t.liquid_unstable=false
return true}}()
r.updateLiquid=y},{"../common/globals":248,"../common/world_trans":268,"../glov/client/engine":305,"../glov/common/vmath":402,"./editvolume_client":84,"./main":135,"./rand_seed":175,"./tiles":199,"./voxel_data":216,"./world_comm":226,assert:void 0}],127:[function(e,t,r){"use strict"
r.listCreate=listCreate
var s=e("../glov/client/aabbtree.js")
var a=e("assert")
var l=e("./fixed_octree.js").createFixedOctree
var i=e("../common/globals.js"),_=i.ID_FACTOR,c=i.ID2
var o=e("../glov/common/util.js").ridx
var n=0
function FIFO(e){this.name=e.name
this.head=null
this.tail=null
this.count=0
this.nkey="n"+ ++n
this.pkey="p"+n}FIFO.prototype.length=function(){return this.count}
FIFO.prototype.add=function(e){a(!e[this.nkey])
a(!e[this.pkey])
e[this.pkey]=this.tail
if(this.tail){this.tail[this.nkey]=e
this.tail=e}else this.head=this.tail=e;++this.count}
FIFO.prototype.remove=function(e){var t=e[this.pkey]
var r=e[this.nkey]
if(t){t[this.nkey]=r
e[this.pkey]=null}else{a.equal(this.head,e)
a(e!==r)
this.head=r}if(r){r[this.pkey]=t
e[this.nkey]=null}else{a.equal(this.tail,e)
this.tail=t}--this.count}
FIFO.prototype.prepare=function(){this.prepared_popped=null}
FIFO.prototype.preparedPop=function(){a(this.count)
a(this.head)
a(this.head!==this.prepared_popped)
this.prepared_popped=this.head
return this.head}
FIFO.prototype.preparedLength=function(){return this.count}
function AABBTreeWrap(e){this.tree=s.create(e)
this.prepared_list=[]}AABBTreeWrap.prototype.length=function(){return this.tree.getNumLeaves()}
AABBTreeWrap.prototype.clear=function(){this.tree.clear()}
var u=new Float32Array(6)
AABBTreeWrap.prototype.add=function(e){u[0]=e.pos[0]-.125
u[1]=e.pos[1]-.125
u[2]=e.pos[2]
u[3]=e.pos[0]+1.25
u[4]=e.pos[1]+1.25
u[5]=e.pos[2]+1.25
this.tree.add(e,u)}
AABBTreeWrap.prototype.remove=function(e){this.tree.remove(e)}
AABBTreeWrap.prototype.getVisible=function(e,t){this.tree.finalize()
var r=this.tree.getVisibleNodes(e,this.prepared_list,0)
this.prepared_list.length=r
this.prepared_list.sort(t)}
AABBTreeWrap.prototype.preparedLength=function(){return this.prepared_list.length}
AABBTreeWrap.prototype.preparedPop=function(){return this.prepared_list.pop()}
function LIFO(e){this.arr=[]}LIFO.prototype.length=function(){return this.arr.length}
LIFO.prototype.add=function(e){this.arr.push(e)}
LIFO.prototype.remove=function(e){var t=this.arr.indexOf(e)
a(-1!==t)
o(this.arr,t)}
function SimpleList(e){this.arr=[]
this.prepared_list=[]}SimpleList.prototype.length=function(){return this.arr.length}
SimpleList.prototype.add=function(e){this.arr.push(e)}
SimpleList.prototype.remove=function(e){var t=this.arr.indexOf(e)
a(-1!==t)
o(this.arr,t)}
function isInsidePlanesAABB(e,t){var r=t[0]
var a=t[1]
var i=t[2]
for(var o=0;o<e.length;++o){var n=e[o]
var s=n[0]
var l=n[1]
var _=n[2]
if(s*(s<0?r:r+1)+l*(l<0?a:a+1)+_*(_<0?i:i+1)<n[3])return false}return true}SimpleList.prototype.getVisible=function(e,t){var r=0
for(var a=0;a<this.arr.length;++a){var i=this.arr[a]
if(isInsidePlanesAABB(e,i.pos))this.prepared_list[r++]=i}this.prepared_list.length=r
this.prepared_list.sort(t)}
SimpleList.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
SimpleList.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
function SimpleLinkedList(e){this.name=e.name
this.head=null
this.tail=null
this.count=0
this.nkey="n"+ ++n
this.pkey="p"+n
this.prepared_list=[]}SimpleLinkedList.prototype.length=function(){return this.count}
SimpleLinkedList.prototype.add=function(e){a(!e[this.nkey])
a(!e[this.pkey])
e[this.pkey]=this.tail
if(this.tail){this.tail[this.nkey]=e
this.tail=e}else this.head=this.tail=e;++this.count}
SimpleLinkedList.prototype.remove=function(e){var t=e[this.pkey]
var r=e[this.nkey]
if(t){t[this.nkey]=r
e[this.pkey]=null}else this.head=r
if(r){r[this.pkey]=t
e[this.nkey]=null}else this.tail=t;--this.count}
SimpleLinkedList.prototype.getVisible=function(e,t){var r=0
var a=this.nkey
for(var i=this.head;i;i=i[a])if(isInsidePlanesAABB(e,i.pos))this.prepared_list[r++]=i
this.prepared_list.length=r
this.prepared_list.sort(t)}
SimpleLinkedList.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
SimpleLinkedList.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
var d=8
var f=3
function Hybrid1(e){this.count=0
this.megacells={}
this.root_tree=s.create({name:"hybrid_root"})
this.root_list=[]
this.prepared_list=[]}Hybrid1.prototype.clear=function(){for(var e in this.megacells)this.megacells[e].clear()
this.megacells=null
this.root_tree.clear()}
Hybrid1.prototype.length=function(){return this.count}
Hybrid1.prototype.add=function(e){++this.count
var t=e.pos
var r=e.mcid
if(void 0===r)r=e.mcid=(t[0]>>f)+(t[1]>>f)*_+(t[2]>>f)*c
var a=this.megacells[r]
if(!a){var i=(t[0]>>f)*d
var o=(t[1]>>f)*d
var n=(t[2]>>f)*d
a=this.megacells[r]=s.create({name:"hybrid_cell"})
u[0]=i
u[1]=o
u[2]=n
u[3]=i+d
u[4]=o+d
u[5]=n+d
this.root_tree.add(a,u)}u[0]=e.pos[0]
u[1]=e.pos[1]
u[2]=e.pos[2]
u[3]=e.pos[0]+1
u[4]=e.pos[1]+1
u[5]=e.pos[2]+1
a.add(e,u)}
Hybrid1.prototype.remove=function(e){--this.count
var t=this.megacells[e.mcid]
a(t)
if(1===t.getNumLeaves()){this.root_tree.remove(t)
delete this.megacells[e.mcid]}else t.remove(e)}
Hybrid1.prototype.getVisible=function(e,t){var r=2
if(this.root_tree.finalize())--r
var a=this.root_list
var i=this.root_tree.getVisibleNodes(e,a,0)
a.length=i
var o=0
var n=this.prepared_list
for(var s=0;s<a.length;++s){var l=a[s]
if(r&&l.finalize())--r
o+=i=l.getVisibleNodes(e,n,o)}this.prepared_list.length=o
this.prepared_list.sort(t)}
Hybrid1.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
Hybrid1.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
function Hybrid4(e){this.count=0
this.megacells={}
this.root_tree=s.create({name:"hybrid_root"})
this.root_list=[]
this.prepared_list=[]}Hybrid4.prototype.length=function(){return this.count}
Hybrid4.prototype.add=function(e){++this.count
var t=e.pos
var r=e.mcid
if(!r)r=e.mcid=(t[0]>>f)+(t[1]>>f)*_+(t[2]>>f)*c
var a=this.megacells[r]
if(!a){var i=(t[0]>>f)*d
var o=(t[1]>>f)*d
var n=(t[2]>>f)*d
a=this.megacells[r]=l({pos:[i,o,n],size:d})
u[0]=i
u[1]=o
u[2]=n
u[3]=i+d
u[4]=o+d
u[5]=n+d
this.root_tree.add(a,u)}a.add(e)}
Hybrid4.prototype.clear=function(){for(var e in this.megacells)this.megacells[e].clear()
this.megacells=null
this.root_tree.clear()}
Hybrid4.prototype.remove=function(e){--this.count
var t=this.megacells[e.mcid]
a(t)
if(1===t.getNumLeaves()){t.clear()
this.root_tree.remove(t)
delete this.megacells[e.mcid]}else t.remove(e)}
Hybrid4.prototype.getVisible=function(e,t){this.root_tree.finalize()
var r=this.root_list
var a=this.root_tree.getVisibleNodes(e,r,0)
r.length=a
var i=0
var o=this.prepared_list
for(var n=0;n<r.length;++n)i=r[n].getVisibleNodes(e,o,i)
this.prepared_list.length=i
this.prepared_list.sort(t)}
Hybrid4.prototype.preparedLength=AABBTreeWrap.prototype.preparedLength
Hybrid4.prototype.preparedPop=AABBTreeWrap.prototype.preparedPop
function listCreate(e){switch(e.type){case"fifo":return new FIFO(e)
case"hybrid1":return new Hybrid1(e)
case"hybrid4":return new Hybrid4(e)
case"aabbtree":return new AABBTreeWrap(e)
case"simplelinked":return new SimpleLinkedList(e)
case"simple":return new SimpleList(e)
case"lifo":return new LIFO(e)
default:a(false)
return null}}},{"../common/globals.js":248,"../glov/client/aabbtree.js":287,"../glov/common/util.js":400,"./fixed_octree.js":99,assert:void 0}],128:[function(e,t,r){"use strict"
r.bgimgFromWorldInfo=bgimgFromWorldInfo
r.loadingCustomPreload=loadingCustomPreload
r.loadingCustomPrepForWorld=loadingCustomPrepForWorld
r.loadingCustomTempOverride=loadingCustomTempOverride
r.loadingCustomSetMessage=loadingCustomSetMessage
r.loadingCustomInit=loadingCustomInit
r.loadingCustomDoLeapNextFrame=loadingCustomDoLeapNextFrame
r.loadingCustomDrawNow=loadingCustomDrawNow
r.isLoadingCustom=isLoadingCustom
var a=e("assert")
var l=e("gl-mat4/lookAt")
var v=e("../glov/client/camera2d")
var _=e("../glov/client/engine")
var s=e("../glov/client/font").ALIGN
var i=e("../glov/client/quat")
var c=i.qFromYPR
var u=i.quat
var o=e("../glov/client/snapshot")
var d=o.viewportRenderFinish
var f=o.viewportRenderPrepare
var h=e("../glov/client/sprites").spriteQueueFn
var n=e("../glov/client/transition")
var p=e("../glov/common/util")
var m=p.clamp
var E=p.easeInOut
var g=p.ridx
var T=e("../glov/common/vmath")
var y=T.mat4
var S=T.v2dist
var I=T.v3dist
var A=T.v3lerp
var w=T.v3sub
var L=T.vec2
var O=T.vec3
var R=T.zaxis
var b=e("../common/ids")
var N=b.ITEM_BLUEPRINT
var C=b.TYPE_ITEM
var x=e("../common/items_common").itemIsReleased
var M=e("../common/world_constants")
var D=M.BOOST_MAX_LEVEL
var P=M.BOOST_PERKS
var B=M.boostLevelFromCount
var k=e("./app_access").accessPrerelease
var U=e("./blueprint").blueprintGetDefForLoadingScreen
var G=e("./build_mode")
var F=G.doPointerLockBottom
var W=G.doPointerLockTop
var H=G.undergroundFactors
var z=e("./camera")
var V=z.cameraGetMainFOV
var Y=z.setCurrentCameraPos
var j=z.setCurrentCameraTargetDir
var K=z.setViewParameters
var q=e("./inventory_ui").inventoryButtonPrep
var X=e("./items")
var Q=X.ITEM_CONTEXT_BUILD
var $=X.createItem
var J=e("./localization/localization").L
var ee=e("./lods").tickLODs
var te=e("./main")
var re=te.charControllerPos
var ae=te.setZRangeDefault
var ie=te.setZRangeLODs
var oe=e("./main_menu")
var ne=oe.drawBG
var se=oe.mainMenuBgSet
var le=e("./photo_mode").copyToClipboardCheck
var _e=e("./proc_gen_biomes").getElevationEstimate
var ce=e("./props")
var ue=e("./settlement").settlementBeamDraw
var de=e("./sky")
var fe=de.skyDraw
var ve=de.skyTick
var he=e("./styles").title_style
var pe=e("./tiles").tile_map_default
var me=e("./tiles_const").TILES
var Ee=e("./ui_util")
var ge=e("./voxel_data")
var Te=ge.applyBevelValue
var ye=ge.createSimpleDrawable
var Se=ge.createUtilVD
var Ie=ge.localPosFromWorldPos
var Ae=ge.worldPosFromLocalPos
var we=e("./world_info").getWorldInfoCached
var Le=e("./world_metadata").worldMetadata
var Oe=Math.floor,Re=Math.max,be=Math.min,Ne=Math.sin,Ce=Math.PI,xe=Math.random
var Me
var De=0
var Pe=null
var Be
var ke=false
var Ue=null
var Ge=0
var Fe=0
var We=1500
var He=500
var ze=32
var Ve=24
var Ye=250
var je=1e3
var Ke=false
var qe=0
var Ze=-1
var Xe=O()
var Qe=O()
var $e=L()
var Je=L()
var et
var tt=true
var rt
var at=[me.DIRT,me.GRASS,me.STONE,me.ORE_IN_STONE,me.ORE_IN_STONE_LIGHT,me.ORE_IN_STONE_DARK,me.ORE_IN_STONE_RED,me.WOOD,me.TILLED,me.SNOW,me.SAND,me.CORAL1,me.CORAL2,me.STONE_DARK,me.STONE_LIGHT,me.STONE_RED,me.PLANKS_WOOD,me.BRICK_CLAY,me.BRICK_STONE,me.WOOD_LIGHT,me.PLANKS_WOOD_LIGHT,me.WOOD_DARK,me.PLANKS_WOOD_DARK,me.WOOD_RED,me.PLANKS_WOOD_RED,me.LEAVES1,me.LEAVES2,me.LEAVES3,me.LEAVES4,me.LEAVES5]
var it=function(){var r=.25*Ce
var a=y()
var i=O(0,0,.85)
var e=2
var o=O(0,4,i[2]+e)
var n=O(0,0,0)
var s=u()
return function drawSpinnerFn(){var e=Je[0]-$e[0]
var t=Je[1]-$e[1]
f({pre:ce.saveGlobalState,viewport:[$e[0],_.height-Je[1],e,t]})
_.setupProjection(r,e,t,.1,100)
l(a,o,i,R)
K(a,true)
gl.clear(gl.DEPTH_BUFFER_BIT)
Te(true,true)
c(s,5e-4*-_.frame_timestamp,0,0)
rt.draw(n,s,1,{})
d({post:ce.restoreGlobalState})
Te()
_.startSpriteRendering()}}()
function bidFromWorldInfo(e){var t=e.load_spinner
if(!t)return null
var r=B(e.boost_count||0)
if(e.boost_bypass&&e.boost_bypass.spinners)r=D
var a=P[r].spinners
if(a.includes("custom")||a.includes(t))return t
return null}function bgimgFromWorldInfo(e){var t=e.info_bg
if(!t)return null
var r=B(e.boost_count||0)
if(e.boost_bypass&&e.boost_bypass.info_bgs)r=D
var a=P[r].info_bgs
if(a.includes("custom")||a.includes(t))return t
return null}function loadingCustomPreload(e){var t=bidFromWorldInfo(e)
if(t)U(t)
var r=bgimgFromWorldInfo(e)
if(r)se(r)}var ot=null
var nt=null
function loadingCustomPrepForWorld(e){ot=null
var t=we(e,false)
if(t)ot=bidFromWorldInfo(t)
if(ot)U(ot)
nt=null
if(t)nt=bgimgFromWorldInfo(t)}var st=null
var lt=null
function loadingCustomTempOverride(e,t){st=e
lt=t
Ge=_.frame_timestamp}var _t
var ct
var ut=new Int8Array([2,2,2])
function queueSpinner(){if(!et){et=Se(ut,false)
rt=ye(et,[ut[0]/2,ut[1]/2,0])}if(Le()){var e=bidFromWorldInfo(Le())
if(e)ot=e
var t=bgimgFromWorldInfo(Le())
if(t)nt=t}if(lt)if("default"===lt)ot=null
else ot=lt
var r=null
if(ot)if(!(r=U(ot)).loaded||r.err||r.deleted)r=null
if(tt&&!r){for(var a=0;a<ut[0];++a)for(var i=0;i<ut[1];++i)for(var o=0;o<ut[2];++o){var n=Oe(xe()*at.length)
et.set([a,i,o],at[n])}et.ver_meshing++
et.updateGeometrySimple()
tt=false}var s=r?500:250
var l=s
var _=(1e3-s)/2
var c=(1e3-l)/2
var u=Z.LOADING+100
if(r){var d=r.bid
if(d!==_t)ct=$({type:C,id:N,attr1:_t=d})
var f={x:_,y:c,w:s,h:l,z:u,hide_count:true,dynamic_snapshot:true,item_context:Q,img:null}
q(f,ct)
f.img.draw(f)}else{v.virtualToCanvas($e,[_,c])
v.virtualToCanvas(Je,[_+s,c+l])
h(u,it)}}var dt=1e3
function loadingCustomDraw(e,t){var r=false
if(!Ue||Ue[0]!==e||Ue[1]!==t){r=true
Ue=[e,t]
Ge=_.frame_timestamp}v.setAspectFixed(1e3,1e3)
var a=v.y1()-250
var i=_.font.drawSizedAligned(he,0,a,Z.LOADING,ze,s.HCENTERFIT,1e3,0,st||J.MSG_LOADING)
if(Fe||r)Fe+=_.frame_dt/dt
if(Fe>1)Fe=0
Ee.sprite_centered.draw({x:(1e3+i)/2+8+ze/2,y:a+ze/2,z:Z.LOADING,w:ze,h:ze,rot:E(Fe,2)*Ce*2,frame:Ee.TIME})
a+=ze+8
if(_.frame_timestamp-Ge>2e4&&!Pe){var o=t+e
_.font.drawSizedAligned(he,0,a,Z.LOADING,Ve,s.HCENTERFIT,1e3,0,J.LOADCUSTOM_WAITING_ON.$({loads:o}))
a+=Ve+8}if(Pe&&e){var n=ke?m(1-(_.getFrameTimestamp()-Be-We)/He,0,1):1
if(!n)Pe=null
else _.font.drawSizedAligned(_.font.styleAlpha(he,n),0,a,Z.LOADING,Ve,s.HCENTERFIT,1e3,0,Pe)}se(nt)
ne(Z.LOADING-1)
queueSpinner()
lt=st=null}var ft=O()
var vt=O()
var ht=O()
var pt=O()
var mt=5e3
var Et=1e3
var gt=100
var Tt=100
var yt=5e3
function loadingCustomDrawLeapMode(e){e=be(e,.995)
ie()
var t=V()
_.start3DRendering({fov:t})
Ie(ft,Qe)
A(pt,e,Xe,Qe)
var r=_e(pt)
pt[2]+=be(Et,I(Xe,Qe))*Ne(e*Ce)
pt[2]=Re(pt[2],r+gt)
ve(H(pt[2]),null)
Ie(vt,pt)
Y(vt)
w(ht,ft,vt)
j(ht)
K()
ee()
fe()
ue(true)
gl.depthMask(true)
gl.clear(gl.DEPTH_BUFFER_BIT)
gl.disable(gl.BLEND)
ae()
K()}var St=false
function loadingCustom(e){profilerStart("loadingCustom")
var t=1
if(++De>=2){if(2===De)Me.start()
t=Me.tick(e)}var r=_.loadsPending()+t
if(Ke){var a=be(1,(_.frame_timestamp-qe)/mt)
if(1===a)n.queue(Z.TRANSITION_FINAL,n.fade(r?2*Ye:Ye))
loadingCustomDrawLeapMode(a)
if(a<1)r++
else{Ke=false
if(r)St=true
else St=false}}else if(St)loadingCustomDraw(t,r)
le()
W()
F()
if(Me.finished){var i=Me.extra_frames--<=0
if(i)n.queue(Z.TRANSITION_FINAL,n.fade(Ye))
Me.state(e)
if(i&&_.stateActive(loadingCustom)){Me.on_finished()
_.setState(Me.state)}}if(!r)Me.finished=true
return profilerStop("loadingCustom")}function loadingCustomSetMessage(e,t){Pe=e
Be=_.getFrameTimestamp()
ke=t}function loadingCustomInit(e){Me=e
if(!_.stateActive(loadingCustom))tt=true
St=true
a.equal(typeof Me.state,"function")
a.equal(typeof Me.start,"function")
a.equal(typeof Me.tick,"function")
a.equal(typeof Me.extra_frames,"number")
De=0
ke=false
Ue=Pe=null
Ge=_.frame_timestamp
Fe=0
for(var t=at.length-1;t>=0;--t)if(!x(pe[at[t]],k()))g(at,t)
_.setState(loadingCustom)
if(Ke=_.frame_index===Ze){Ae(Qe,re())
Qe[2]=Re(Qe[2],_e(Qe)+gt)
qe=_.frame_timestamp
if(I(Xe,Qe)>yt||S(Xe,Qe)<Tt)Ke=false}}function loadingCustomDoLeapNextFrame(){if(_.defines.NOLODS||"flat"===Le().world_type)return
n.queue(Z.TRANSITION_FINAL,n.fade(je))
Ae(Xe,re())
Xe[2]=Re(Xe[2],_e(Xe)+gt)
Ze=_.frame_index+1}function loadingCustomDrawNow(){v.push()
loadingCustomDraw(0,0)
v.pop()}function isLoadingCustom(){return _.stateActive(loadingCustom)}},{"../common/ids":249,"../common/items_common":251,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/quat":346,"../glov/client/snapshot":356,"../glov/client/sprites":363,"../glov/client/transition":366,"../glov/common/util":400,"../glov/common/vmath":402,"./app_access":12,"./blueprint":28,"./build_mode":33,"./camera":35,"./inventory_ui":115,"./items":119,"./localization/localization":131,"./lods":132,"./main":135,"./main_menu":136,"./photo_mode":158,"./proc_gen_biomes":163,"./props":171,"./settlement":181,"./sky":188,"./styles":197,"./tiles":199,"./tiles_const":200,"./ui_util":205,"./voxel_data":216,"./world_info":229,"./world_metadata":235,assert:void 0,"gl-mat4/lookAt":void 0}],129:[function(e,t,r){t.exports={FORMAT_ADD_COLON:"{val}:",FORMAT_ADD_ELLIPSIS:"{val}...",FORMAT_ADD_NUMBER_SIGN:"#{val}",FORMAT_ADD_PARENTHESES:"({val})",FORMAT_ADD_PARENTHESES_AFTER:"{val} ({detail})",FORMAT_ADD_PERCENTAGE:"{val}%",FORMAT_ADD_PLUS:"{val}+",FORMAT_ADD_QUESTION_MARK:"{val}?",FORMAT_DURATION_DAYS:"{val, plural, one{# day} other{# days}}",FORMAT_DURATION_DAYS_INITIALS:"{val}d",FORMAT_DURATION_HOURS:"{val, plural, one{# hour} other{# hours}}",FORMAT_DURATION_HOURS_INITIALS:"{val}h",FORMAT_DURATION_MINUTES:"{val, plural, one{# minute} other{# minutes}}",FORMAT_DURATION_MINUTES_INITIALS:"{val}m",FORMAT_DURATION_SECONDS:"{val, plural, one{# second} other{# seconds}}",FORMAT_DURATION_SECONDS_INITIALS:"{val}s",FORMAT_DURATION_YEARS:"{val, plural, one{# year} other{# years}}",FORMAT_DURATION_YEARS_INITIALS:"{val}y",FORMAT_FRACTION:"{val} / {val_2}",FORMAT_INPUT_MERGE:"[{key}]{command}",FORMAT_INPUT_PREPEND:"[{key}] {command}",FORMAT_SEPARATOR_COLON:": ",FORMAT_SEPARATOR_COMMA:", ",FORMAT_SEPARATOR_WORDS:" ",BTN_ACCEPT:"Accept",BTN_CANCEL:"Cancel",BTN_CREATE_USER:"Create User",BTN_COPY_TO_CLIPBOARD:"Copy to Clipboard",BTN_EDIT:"Edit",BTN_DELETE:"Delete",BTN_DISMISS:"Dismiss",BTN_DOWNLOAD:"Download",BTN_EQUIP:"Equip",BTN_EXIT_TO_MAIN_MENU:"← Exit to Main Menu",BTN_GET_LINK:"Get Link",BTN_GET_WORLD_LINK:"Get World Link",BTN_HIDE:"Hide",BTN_INFO:"Info",BTN_INVITE_PLAY:"Invite",BTN_INVITE_TO_WORLD:"Invite to World",BTN_LOGIN:"Log in",BTN_LOGOUT:"Log out",BTN_NEW_USER:"New User",BTN_NO:"No",BTN_NO_THANKS:"No, thanks.",BTN_OK:"OK",BTN_PROCESSING:"Processing...",BTN_RANDOM:"Random",BTN_REMOVE:"Remove",BTN_REMOVE_SPOTLIGHT:"Remove Spotlight",BTN_RENAME:"Rename",BTN_RETRY:"Retry",BTN_SAVE:"Save",BTN_SHARE:"Share",BTN_SHARE_WORLD:"Share World",BTN_SHARING:"Sharing...",BTN_SKIP:"Skip",BTN_SORT_ALPHABETICALLY:"A-Z",BTN_SUBMIT:"Submit",BTN_TAKE:"Take",BTN_TAKE_PHOTO:"Take Photo",BTN_YES:"Yes",BTN_YESBANG:"Yes!",CHATERROR_RUNNING_CMD:"Error running {val}: {val_2}",DLG_ERROR_IMAGE_UPLOAD_TITLE:"Error uploading images",DLG_ERROR_TITLE:"Error",DLG_SHARE_TITLE:"Share",DLG_SHARE_WG_TITLE:"Share Waygate",ERR_DISCONNECTED:"Disconnected",ERR_WORLD_DISCONNECTED:"Disconnected from world",CHATERROR_EMPTY_RESPONSE:"Empty response",INPUT_CLICK:"Click",INPUT_CLICK_LEFT:"Left Click",INPUT_CLICK_MIDDLE:"Middle Click",INPUT_CLICK_RIGHT:"Right Click",INPUT_DRAG_QBAR:"drag quickbar",INPUT_DRAG_SCREEN:"Drag Screen",INPUT_IN_WORLD_HOLD:"Hold In-World",INPUT_IN_WORLD_TAP:"Tap In-World",INPUT_JUMP_BUTTON:"JUMP Button",INPUT_JUMP_BUTTON_DOUBLE:"Double-tap JUMP",INPUT_KEY_CTRL_CLICK:"Ctrl Click",INPUT_KEY_DEL:"Del",INPUT_KEY_ENTER:"Enter",INPUT_KEY_SHIFT:"Shift",INPUT_KEY_SHIFT_CLICK:"Shift Click",INPUT_KEY_SPACE:"Space",INPUT_KEY_TAB:"Tab",INPUT_LEFT_PAD:"Left Pad",INPUT_TAP:"Tap",INPUT_TAP_DOUBLE:"Double-tap",INPUT_PINCH:"Pinch",LBL_AUTHOR:"Author",LBL_BUILD_MENU:"Build Menu",LBL_CONFIRM_PASSWORD:"Confirm Password",LBL_DESCRIPTION:"Description",LBL_DISPLAY_NAME:"Display Name",LBL_ELAPSED_TIME:"Time",LBL_EMAIL:"Email",LBL_EMAIL_OR_USER_ID:"Email or User ID",LBL_ENERGY_WELL:"Energy Well",LBL_ERROR:"Error",LBL_EXIT_MENU:"Exit Menu",LBL_EXTRA_WORLD_SLOT:"Extra World Slot",LBL_FIELD_OF_VIEW:"Field of View",LBL_NONE:"None",LBL_MENU:"Menu",LBL_MY_WORLD:"My World",LBL_NAME:"Name",LBL_NEW_WORLD:"New World",LBL_NUMBERED_WORLD:"World #{val}",LBL_PASSWORD:"Password",LBL_PRIVACY_POLICY:"Privacy Policy",LBL_RARITY_COMMON:"Common",LBL_RARITY_EPIC:"Epic",LBL_RARITY_LEGENDARY:"Legendary",LBL_RARITY_RARE:"Rare",LBL_RARITY_UNCOMMON:"Uncommon",LBL_RECIPE:"Recipe",LBL_REQUIRES:"Requires",LBL_RESULTS:"Results",LBL_TERMS_OF_SERVICE:"Terms of Service",LBL_UNKNOWN_SYMBOLS:"???",LBL_UNKNOWN_WORLD_NAME:"Unknown World",LBL_DELETED_WORLD_NAME:"Deleted World",LBL_USER_ID:"User ID",LBL_VERSION:"Version",LBL_VIEW_INFO:"View info",LBL_WORLD_NAME:"World Name",TLTP_WORLD_NAME:"The name of this world, may be visible to the public (even if access to the world is private).",LBL_WORLD_URL:"World URL",MSG_INVENTORY_FULL:"Inventory full",MSG_PLAYER_CARRYING_HEAVY:"You are already carrying a heavy item",MSG_LOADING:"Loading...",MSG_OUT_OF_SETTLEMENT_ALERT:"Industry only works within Settlements.",MSG_PLEASE_WAIT:"Please wait...",MSG_SAVED:"Saved.",MSG_SAVING:"Saving...",TLTP_PLACE_IN_QB:"Place in quickbar",ACCESSCONTROL_AREA_LOST:"Area moved or deleted",ACCESSCONTROL_CANNOT_CREATE:"You do not have access to create Areas here.",ACCESSCONTROL_CANNOT_MANAGE:"You do not have access to manage this Area.",ACCESSCONTROL_READONLY_NOTE:"Note: Users with Admin or higher access to the world can always build anywhere.  Only Builders/Area Builders will be restricted from building in this Area.",ACCESSCONTROL_WORLD_PRESET_NOTE:'Note: An Area set to "Anyone can build" is usually only useful if the world\'s access is set to "Anyone can Area build".',BTN_CLEAR_AREA:"Clear contents",BTN_CREATE_AREA:"Create Area",BTN_DELETE_AREA:"Delete Area",DLG_CLEAR_AREA_MSG:"Clearing an Area's contents will permanently remove everything built within the area, but leave the access control settings in-place.  Really clear this Area's contents?",DLG_CLEAR_AREA_TITLE:"Clear Area Contents",DLG_DELETE_AREA_MSG:"Deleting an Area will only remove access control settings, leaving any changes to the world.  Really delete this Area?",DLG_DELETE_AREA_TITLE:"Delete Area",DLG_ERR_RESIZE_BOUNDS_MSG:"Desired area not fully loaded: please travel to the other side of this Area, or make modifications from an Area Access Control placed in the middle of the Area.",DLG_MOVE_WARN_MSG:"After this operation, you will no longer be within this Area and will need to re-open the Area Access Control from the new location.",LBL_ACCESS_PRESET_BUILD:"Anyone can build",LBL_ACCESS_PRESET_READONLY:"Read-only (Visitor)",LBL_AREA_ACCESS_CONTROL:"Area Access Control",LBL_AREA_ACCESS_FOR_NEARBY_BUILDERS:"Area Access for Nearby Builders",LBL_AREA_CLEARING:"Clearing Area...",LBL_AREA_CLEARING_STALLED:"Clearing Area stalled: please move around the Area.",LBL_AREA_COORDS_MAX:"Max",LBL_AREA_COORDS_MIN:"Min",LBL_AREA_COORDS_SIZE:"Size",LBL_AREA_COORDS_X:"Width (X) = {val}",LBL_AREA_COORDS_Y:"Width (Y) = {val}",LBL_AREA_COORDS_Z:"Height (Z) = {val}",LBL_AREA_OWNER:"Area Owner",LBL_RESIZE_OR_DELETE_AREA:"Resize or Delete Area",STATUSMSG_AREA_CLEARED:"Area cleared",TLTP_CHANGE_ACCESS:"Change Access",AGE_CONSENTMENT:"I confirm being at least 13 years old",BTN_CREATE_FRVR_ACC:"Create FRVR Account",BTN_CREATING_ACC:"Creating",BTN_EMAIL_SENDING:"Sending...",BTN_EMAIL_SENT:"Email sent!",BTN_HAVE_FRVR_ACC:"I have an FRVR Account",BTN_LETS_PLAY:"Let's play!",BTN_LOG_IN_TO_FRVR:"Log in to FRVR",BTN_RESEND_EMAIL:"Re-send Email",BTN_RESET_PASSWORD:"Reset Password",BTN_SEND_EMAIL:"Send Email",BTN_TRY_AGAIN:"Try again",DISCLAIMER_CREATE_ACCOUNT:"By creating an account you agree to our",DISCLAIMER_LOGIN:"By logging in you agree to our",DISCLAIMER_LOGOUT:"if you want to update a different account.",DISCLAIMER_TOS_PP_SEPARATOR:"and",DLG_ACCOUNT_MIGRATION_FAILED_MSG:"Oops, something went wrong. Please check if your internet connection is working and try again. If the error persists you can Cancel and try again later.",DLG_ACCOUNT_MIGRATION_FAILED_TITLE:"Account Migration Failed",DLG_AUTO_LOGGIN_FAILED_TITLE:"Auto-login Failed",DLG_ERR_CANNOT_COMMUNICATE:"Cannot communicate with server",DLG_FRVR_ALL_SET_MSG:"Thank you for taking the time to set up your FRVR Account. You are ready to go and start playing Worlds! From now on, you must log in using your FRVR Account email.",DLG_FRVR_ALL_SET_TITLE:"You are all set!",DLG_FRVR_LOGIN_ERROR_MSG:"No account found with that email and password combination",DLG_HAVE_FRVR_ACC_TITLE:"Log in with FRVR Account",DLG_LOGIN_ERROR_TITLE:"Login Error",DLG_MIGRATING_ACCOUNT_MSG:"Should just take a few seconds",DLG_MIGRATING_ACCOUNT_TITLE:"Migrating Account",DLG_NEW_FRVR_ACC_MSG:"We are updating our User Account Service to make it faster, safer and accessible in all FRVR games. Please Log In using your existing FRVR Account or simply create one.",DLG_NEW_FRVR_ACC_TITLE:"New FRVR Account",DLG_PLATFORM_LOGIN_FAILED_TITLE:"{val} login failed",DLG_REGISTER_ERROR_EMAIL_MSG:"Your email is invalid.",DLG_REGISTER_ERROR_NO_PASSWORD:"Please write a password.",DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE:"Activation email sending Failed",DLG_SHARE_USER_ID_TITLE:"Your User ID",LBL_CLICK_TO_COPY:"Click to copy",LBL_CONFIRMATION_EMAIL_REQUIRED_IAP:"You must first confirm your email before making any in-app purchases.",LBL_CONFIRMATION_EMAIL_SENT:"Confirmation email sent",LBL_CONFIRMATION_EMAIL_WILL_RECEIVE:"You will receive an activation link in the next few minutes. Please, also check your SPAM folder.",LBL_CONFIRMATION_EMAIL_WILL_RECEIVE_TRY_AGAIN:"You will receive an activation link in the next few minutes. Please, also check your SPAM folder. If you still didn’t receive it, click the button below.",LBL_CONFIRMATION_RESEND_EMAIL:"Re-send email",LBL_EXTERNAL_LOGINS:"Or log in with",LBL_EXTERNAL_SIGNUPS:"Or sign up with",LBL_FORGOT_PASSWORD:"Forgot your password?",LBL_LOGGED_IN_AS:"Logged in as",LBL_MIGRATING_ACCOUNT:"You are migrating your legacy Worlds account: {user}",LBL_REGISTER_ERROR_CONFIRM_PASSWORD:'"Password" and "Confirm Password" do not match.',LBL_REGISTER_ERROR_EMAIL_ALREADY_USED:"This Email has already been used.",LBL_REGISTER_ERROR_GENERIC:"Something went wrong, please try again.",LBL_REGISTER_ERROR_PASSWORD_LENGTH:"Your Password must have a minimum of 8 characters.",LBL_REGISTER_ERROR_PASSWORD_SIMILAR_EMAIL:"Your Password and your Email are too similar.",LBL_REGISTER_ERROR_WRONG_CREDENTIALS:"Wrong email or password.",LBL_RESET_PASSWORD_EMAIL:"To reset your password please enter your email and we will send you further instructions. Please also check your SPAM box.",LBL_TAP_TO_COPY:"Tap to copy",LOGINMSG_APP_TOO_OLD:"App version too old.",LOGINMSG_AUTO_LOGGING_IN:"Auto logging in...",LOGINMSG_CONNECTING:"Establishing connection...",LOGINMSG_LOGGING_IN:"Logging in...",LOGINMSG_LOGGING_OUT:"Logging out...",LOGINMSG_NEW_VERSION:"New version available!",LOGINMSG_NO_UPDATE_AVAILABLE:"No update currently available.",LOGINMSG_RELOAD_PAGE:"Please reload the page.",LOGINMSG_RESTART_OR_UPDATE_APP:"Please restart or update the app.",LOGINMSG_SERVER_RESTARTING:"Server restarting...",LOGINMSG_TRY_AGAIN:"Please try again soon.",LOGINMSG_UNDER_MAINTENANCE:"The game is under maintenance.",LOGINMSG_UPDATE_APP:"Please update the app.",LOGINMSG_VISIT_WEB:"Please visit us on web instead.",DLG_LOG_OUT_TITLE:"Log out?",DLG_LOG_OUT_MSG:"You will need to sign in again to access any content.  Really Log out of your account?",COSTUME_UNKNOWN:"Unknown",DLG_DELETE_BP_MSG:"Are you sure you want to delete this blueprint ({val})?",DLG_DELETE_BP_TITLE:"Delete Blueprint?",DLG_ERROR_RENAMING_BP_TITLE:"Blueprint Rename Failed",DLG_ERROR_SHARING_BP_TITLE:"Blueprint Share Failed",DLG_NAME_BP_TITLE:"Name New Blueprint",DLG_NAME_BP_MSG:"Enter a name for your new blueprint",TLTP_NEW_BP:"Allocate a new, empty, editable Blueprint",TLTP_HOLD_NEW_NAME:"(right click, long press, or hold {keyname} to choose name before allocating)",TLTP_HOLD_SKIP_NEW_NAME:"(right click, long press, or hold {keyname} to skip choosing a name before allocating)",DLG_REMOVE_BP_MSG:"Are you sure you want to remove this blueprint ({val})?",DLG_REMOVE_BP_TITLE:"Remove Blueprint from library?",DLG_RENAME_BP_MSG:'Enter a new name for blueprint "{val}"',DLG_RENAME_BP_TITLE:"Rename Blueprint",DLG_SHARE_BP_TITLE:"Blueprint Share",ERR_MUST_NAME_BP:"You must name this blueprint before sharing.",ERR_CMD_REQUIRES_OWNED_BP:"Command requires an editable blueprint owned by you in-hand.",MSG_BP_DELETED:"Blueprint deleted",MSG_BP_REMOVED:"Blueprint removed from library",MSG_BP_RENAMED:"Blueprint renamed",BTN_SHOW_IN_BUILD_MENU:"Show in Build menu",TLTP_DELETE_THIS_BP:"Delete this blueprint",TLTP_HOLD_SKIP_CONFIRMATION:"(hold {keyname} to skip confirmation)",TLTP_BP_VIEW_INFO:"View the full blueprint information including author",TLTP_LINK_BP_GET:"Get a link anyone can use to add this blueprint to their library",TLTP_LINK_BP_SHARE:"Share a link that anyone can use to add this blueprint to their library",TLTP_REMOVE_THIS_BP:"Remove this blueprint from your library",TLTP_RENAME_BP_FOR_ALL:"Rename your shared blueprint for ALL users",TLTP_RENAME_BP_IN_LIBRARY:"Rename this blueprint in your library",TLTP_SHARE_BP:"Create a new, read-only copy of this blueprint for sharing or later use",TLTP_SHOW_BP_IN_BUILD_MENU:"Open the Build menu to the Blueprints tab and select this blueprint",BBOX_BP_DATA_ERROR:"Blueprint data error: {val}",BBOX_BP_DATA_LOADING:"Blueprint data loading...",BBOX_BP_IS_IN_YOUR_LIBRARY:"Blueprint is in your library",BBOX_BP_SAVED:"Saved!",BBOX_CANNOT_SAVE_OWNED_BY:"Cannot save, blueprint owned by {val}",BBOX_INVALID_BP_ID:"Invalid Blueprint ID",BBOX_MISSING_RESOURCES:"Cannot completely build: missing resources",BBOX_MODIFIED_ELSEWHERE_MSG_EDIT:"To safely edit this blueprint, remove this BlueBox and place a new one.",BBOX_MODIFIED_ELSEWHERE_MSG_OVERWRITE:"Saving here will cause those changes to be overwritten.",BBOX_MODIFIED_ELSEWHERE_MSG_WARNING:"Warning: This blueprint has been modified elsewhere.",BBOX_MUST_CLEAR_BOUNDS:"Cannot start editing: must clear extraneous stuff from bounds",BBOX_NO_CHANGES_DETECTED:"No changes detected",BBOX_NO_MATCHING_RESOURCES:"Cannot deposit: no matching resources",BBOX_OVERLAPS_ANOTHER_EDITED_BP:"Cannot start editing: overlaps another edited blueprint",BBOX_OVERLAPS_EDITED_BP:"Cannot build: overlaps edited blueprint",BBOX_REFRESHING_STATE:"Refreshing state...",BBOX_SOMETHING_BLOCKING:"Cannot completely build: something blocking build or foundation missing",BBOX_TO_EDIT_FINISH_AND_PLACE:"To edit this blueprint, finish building it and then re-place the BlueBox",BBOX_WAITING_PREVIOUS_SAVE:"Waiting for previous save to complete...",BBOX_HAS_FALLBACKS_SAVE:"Cannot save blueprint containing phony props...",BTN_ADDING_TO_LIBRARY:"Adding...",BTN_ADD_TO_LIBRARY:"Add to My Library",BTN_DEPOSIT_ALL:"Deposit All",BTN_REMOVE_BBOX:"Remove BlueBox",BTN_PAUSE:"Pause",BTN_RESUME:"Resume",DLG_ERROR_ADDING_BP_TITLE:"Error adding to library",DLG_UNSAVED_CHANGES_MSG:"You have made changes that have not been saved. You will be unable to save these changes to this blueprint once the BlueBox is removed. Really stop editing?",DLG_UNSAVED_CHANGES_TITLE:"Unsaved changes",LBL_BLUEPRINT:"Blueprint",LBL_BLUEPRINT_ERROR:"Blueprint (Error)",LBL_BLUEPRINT_LOADING:"Blueprint (Loading...)",LBL_BLUEPRINT_STATUS:"Blueprint status",LBL_BP_VIEW:"Blueprint View",LBL_BP_VIEW_ERROR:"Blueprint View (Error)",LBL_BP_VIEW_LOADING:"Blueprint View (Loading...)",LBL_EDITABLE_BLUEPRINT:"Editable Blueprint",LBL_LEFT_TO_BUILD:"Left to build",LBL_NONE_RESOURCES:"None",LBL_REQUIRED_RESOURCES:"Required resources",LBL_ORIGINAL_NAME:"Original Name",STATUSMSG_BBOX_CANNOT_EJECT:"BlueBox cannot eject excess: no place to drop items",STATUSMSG_BP_COMPLETELY_BUILT:"Blueprint completely built",STATUSMSG_BP_STILL_LOADING:"Blueprint still loading. Please try again...",STATUSMSG_PREVIEWING_BP:"Previewing blueprint. Select again to view options",TLTP_DEPOSIT_RESOURCE:"Deposit {val} {val_2}",CHATERROR_SAVING_BP:"Error saving blueprint: {val}",CHATERROR_SAVING_BP_SNAPSHOT:"Error saving blueprint snapshot: {val}",STATUSMSG_BP_SAVED:"Blueprint saved",BTN_AFFORDABLE_ITEMS:"Affordable",BTN_ALLOCATING:"Allocating...",BTN_ALL_ITEMS:"All",BTN_DETAILS:"Details",BTN_ICONS:"Icons",BTN_NEW_BP:"New",BUILDMENU_HINT_CRAFT_TOOLS_AND_CONSUMABLES:"Tools and consumables can be crafted at an Aetherbench or other Settlement buildings",BUILDMENU_HINT_NEW_BP_MSG_CREATE:"You can create your own blueprints!",BUILDMENU_HINT_NEW_BP_MSG_START:'Press "New" above to get started.',BUILDMENU_ITEM_NOT_FOUND:"Not found",BUILDMENU_NOTHING_AFFORDABLE:"Nothing affordable",BUILDMENU_NO_BP_AVAILABLE:"No blueprints available",BUILDMENU_NO_TOOLS_OR_CONSUMABLES:"No tools or consumables in inventory",BUILDMENU_UNLOCK_SCHEMATICS:"Unlock more schematics by upgrading your Settlement at the Waygate",DLG_QUOTA_EXCEEDED_MSG:"You already have the maximum ({val}) number of editable blueprints.",DLG_QUOTA_EXCEEDED_TITLE:"Quota Exceeded",ERR_MISSING_BLUEPRINT_ID:"Missing blueprint ID",LBL_BLUEPRINTS:"Blueprints",LBL_CRAFTED_BLOCKS:"Crafted Blocks",LBL_FARMING_AND_FLORA:"Farming and Flora",LBL_NEW_BLUEPRINT:"New",LBL_PROPS:"Props",LBL_RAW_BLOCKS:"Raw Blocks",LBL_SEARCH_ALL:"Search All",LBL_SETTLEMENT:"Settlement",LBL_TOOLS_AND_CONSUMABLES:"Tools and Consumables",LBL_TOOLS_AND_FARMING:"Tools and Farming",TLTP_CUSTOMIZATION_CLEAR:"Clear all material customization",TLTP_CLOSE_BUILD_MENU:"Close Build menu",TLTP_LOCKED_ITEM:"You cannot build this yet...",TLTP_LOCKED_ITEM_LF_BREAK:"Find this item in the Lost Frontier to unlock it.",TLTP_UNLOCKED_ITEM_LF_BREAK:"This item was unlocked by finding it in the Lost Frontier.",TLTP_SELECT_AND_CLOSE_BUID_MENU:"Select and close Build menu",TLTP_SELECT_IN_QB_AND_VIEW:"Select in quickbar and view info",LBL_SORT_RECENT:"Recent",LBL_SORT_NAME:"Name",STATUSMSG_BP_NOT_ALLOWED:"You are not allowed to place blueprints in this world",STATUSMSG_SAPLING_NOT_ALLOWED:"You are not allowed to place saplings in this world",STATUSMSG_DIG_LOW_TIER_BREAK:"Your {val} is not strong enough to break {val_2} {val_3}",STATUSMSG_DIG_NO_STAMINA_BUCKET:"You are too exhausted to use your bucket!",STATUSMSG_DIG_NO_STAMINA_DIG:"You are too exhausted to dig!",STATUSMSG_DIG_NO_STAMINA_HINT:"Consume some food or return to your Waygate through Menu | World Info",STATUSMSG_DIG_NO_STAMINA_HOE:"You are too exhausted to use your hoe!",STATUSMSG_DIG_NO_STAMINA_WATER:"You are too exhausted to gather water!",STATUSMSG_DIG_WRONG_TIER_BREAK:"A {val} of {val_2} is needed to break {val_3} {val_4}",STATUSMSG_DIG_WRONG_TIER_DECONSTRUCT:"A {val} of {val_2} is needed to deconstruct {val_3}",STATUSMSG_DIG_WRONG_TIER_GATHER:"A {val} of {val_2} is needed to gather {val_3}",STATUSMSG_DIG_WRONG_TOOL:"Your {val} is not the right kind of tool to gather {val_2}",STATUSMSG_GROUND_WRONG_KIND:"This must be placed on {val}",STATUSMSG_OUT_OF_WATER_ONLY:"This must be placed out of water",STATUSMSG_PLACE_BLOCKED:"Failed to place block, something else got there first",STATUSMSG_PLACE_CHUNK_UNLOAD:"Failed to place block, chunk unloaded",STATUSMSG_SETTLEMENT_OUT_OF_BOUNDS:"Warning: Industry only works within Settlements",STATUSMSG_UNDERWATER_ONLY:"This must be placed underwater",STATUSMSG_SETTLEMENT_OVERLAP:"Warning: Too close to other Settlements",STATUSMSG_TOOL_BROKE:"Tool broke :(",STATUSMSG_TOOL_BROKE_REPAIR:"Tool broke, but can be repaired at an Anvil",STATUSMSG_TOOL_BROKE_REPLACE:"Tool broke, auto-equipped replacement",STATUSMSG_TOOL_CUSTOM_NOT_ALLOWED:"Custom tools are not allowed in this world",STATUSMSG_GROWSTICK_BROKE_RECHARGE:"Grimoire of Radiant Organic Wonders out of energy, but can be recharged at a Branchforge",PAGETITLE_DMCA:"FRVR: DMCA",PAGETITLE_GDPR:"FRVR: General Data Protection Regulation",PAGETITLE_PRIVACY_POLICY:"FRVR: Privacy Policy",PAGETITLE_TERMS_OF_SERVICE:"FRVR: Terms of Service",BTN_QUEUE_JOIN:"Join queue",BTN_QUEUE_LEAVE:"Leave queue",LBL_QUEUE_AVAILABLE:"Builder Queue available",LBL_QUEUE_BUILDING:"You are a builder!",LBL_QUEUE_CURRENT_POS:"In queue (#{index})",PAGETITLE_UPDATES:"Updates",CHATERROR_INVALID_POS_STRING:"Invalid position string: {val}",MSG_ALREADY_SAT_DOWN:"You're already sat down!",MSG_NOWHERE_TO_SIT:"Nowhere to sit on.",STATUSMSG_CANNOT_SPRINT:"Cannot sprint, out of {val}",STATUSMSG_CONSUME_OR_RETURN:"Consume some food or return to your Waygate through Menu | World Info",STATUSMSG_FALL_DAMAGE_SHIELD:"Protected from fall damage for {val, plural, one{# second} other{# seconds}}.",BTN_GET_COSTUME:'Get "{val}" outfit!',BTN_GET_NOW:"Get now!",BTN_GET_NOW_PRICE:"Get now! {val}",BTN_SPECIAL_OFFER:"Special offer",CUSTOMIZATION_CUSTOM_OUTFIT:"This outfit is made of mixed parts from multiple outfits.",DLG_CANT_SAVE_COSTUME_MSG:"You have selected items that you do not own",DLG_CANT_SAVE_COSTUME_TITLE:"You cannot save this outfit!",LBL_FOR_SALE_UNTIL:"For sale until {val}",LBL_LIMITED_TIME:"Limited time",LBL_PROMO_AVAILABLE:"Promo Available",TLTP_CUSTOM_OUTFIT:"Custom Outfit",TLTP_INFO:"Info",TLTP_ITEM_COLLECTION:"Belongs to a collection",TLTP_ITEM_COLOR_OF:"Color of an outfit",TLTP_ITEM_NOT_OWNED:"You do not own this item!",TLTP_ITEM_PART_OF:"Part of an outfit",LBL_MULTIPLE:"Multiple",TLTP_SAVE:"Save",TLTP_TAB_ARMS:"Arms",TLTP_TAB_COLORING:"Coloring",TLTP_TAB_COSTUMES:"Outfits",TLTP_TAB_HEADS:"Heads",TLTP_TAB_LEGS:"Legs",TLTP_TAB_TORSOS:"Torsos",CONTINENT_LOADER_COMPLETE:"Continent generation complete",CONTINENT_LOADER_NEW:"Generating new continent...",CONTINENT_LOADER_SYNCING:"Syncing continent with server...",BTN_DOWN:"Down",BTN_JUMP:"Jump",BTN_UP:"Up",STATUSMSG_STUCK_DIG_OR_WG:"You're pretty stuck!  Dig your way out, or 'gate away.",STATUSMSG_STUCK_MENU_OR_LEAVE:"You're pretty stuck!  Use the menu to Waygate elsewhere or leave the world.",COSMETIC_COLLECTION_2021_12:"Christmas 2021",COSMETIC_COLLECTION_2022_12:"Christmas 2022",COSMETIC_COLLECTION_2023_12:"Christmas 2023",COSMETIC_COLLECTION_CONQUERORS_OF_THE_SEA:"Conquerors of the Sea",COSMETIC_COLLECTION_EASTER_2024:"Easter 2024",COSMETIC_COLLECTION_EXPLORE_THE_WORLD:"Explore the World",COSMETIC_COLLECTION_ETERNAL_SANDS:"Eternal Sands",COSMETIC_COLLECTION_LEGACY:"Legacy",COSMETIC_COLLECTION_LOST_FRONTIER_FARMERS:"Lost Frontier Farmers",COSMETIC_COLLECTION_MYTHICAL_CREATURES:"Mythical Creatures",COSMETIC_COLLECTION_SEASONAL:"Seasonal",COSMETIC_COLLECTION_TRADITIONAL_ATTIRES:"Traditional Attires",COSMETIC_COLLECTION_VILLAGERS:"Meet the Villagers",COSMETIC_COLLECTION_VOICES_OF_THE_FOREST:"Voices of the Forest",COSMETIC_COLLECTION_WILD_MILITIA:"Wild Militia",COSMETIC_COLOR_BLUE_AERO:"Blue Aero",COSMETIC_COLOR_BLUE_LOBELIA:"Blue Lobelia",COSMETIC_COLOR_BLUE_OCEAN:"Blue Ocean",COSMETIC_COLOR_BROWN_BRIGHT:"Brown Chestnut",COSMETIC_COLOR_BROWN_CINNAMON_CRUMBLE:"Brown Cinnamon Crumble",COSMETIC_COLOR_BROWN_DARK_RUM:"Brown Rum",COSMETIC_COLOR_BROWN_ENGLISH_WALNUT:"Brown Walnut",COSMETIC_COLOR_BROWN_KURO:"Brown Kuro",COSMETIC_COLOR_BROWN_PASTEL:"Brown Pastel",COSMETIC_COLOR_BROWN_PRAIRIE_DOG:"Brown Prairie Dog",COSMETIC_COLOR_BROWN_SCORCHED:"Brown Scorched",COSMETIC_COLOR_BROWN_WEATHERVANE:"Brown Weathervane",COSMETIC_COLOR_EYRA_03:"Eyra #3",COSMETIC_COLOR_FRIZARD_01:"Frizard #1",COSMETIC_COLOR_FRIZARD_02:"Frizard #2",COSMETIC_COLOR_FRIZARD_03:"Frizard #3",COSMETIC_COLOR_FRIZARD_04:"Frizard #4",COSMETIC_COLOR_GNARL_01:"Gnarl #1",COSMETIC_COLOR_GNARL_02:"Gnarl #2",COSMETIC_COLOR_GNARL_03:"Gnarl #3",COSMETIC_COLOR_GNARL_04:"Gnarl #4",COSMETIC_COLOR_GRAYSCALE_BLACK_WASH:"Black Wash",COSMETIC_COLOR_GRAYSCALE_KOKUSHOKU_BLACK:"Black Kokushoku",COSMETIC_COLOR_GRAYSCALE_ORKA_BLACK:"Black Orca",COSMETIC_COLOR_GRAYSCALE_STONE_CAIRN:"Grey Stone Cairn",COSMETIC_COLOR_GRAYSCALE_TIN_SOLDIER:"Grey Tin Soldier",COSMETIC_COLOR_GREEN_GOBLIN:"Green Goblin",COSMETIC_COLOR_GREEN_LETTUCE:"Green Lettuce",COSMETIC_COLOR_GREEN_MARTINA_OLIVE:"Green Olive",COSMETIC_COLOR_GREEN_MOUNT_HYJAL:"Green Mount Hyjal",COSMETIC_COLOR_KHORNOS_01:"Khornos #1",COSMETIC_COLOR_KHORNOS_02:"Khornos #2",COSMETIC_COLOR_KHORNOS_03:"Khornos #3",COSMETIC_COLOR_KHORNOS_04:"Khornos #4",COSMETIC_COLOR_RED_AZUKI:"Red Azuki",COSMETIC_COLOR_RED_CARROBURG_CRIMSON:"Red Carroburg Crimson",COSMETIC_COLOR_RED_KOBE:"Red Kobe",COSMETIC_COLOR_RED_MILANO:"Red Milano",COSMETIC_COLOR_TONE_01:"Human #1",COSMETIC_COLOR_TONE_02:"Human #2",COSMETIC_COLOR_TONE_03:"Human #3",COSMETIC_COLOR_TONE_04:"Human #4",COSMETIC_COLOR_TONE_05:"Human #5",COSMETIC_COLOR_TONE_06:"Human #6",COSMETIC_COLOR_VIOLET_CLEAR_MAUVE:"Violet Mauve",COSMETIC_COLOR_VIOLET_HONEY_FLOWER:"Violet Honey Flower",COSMETIC_COLOR_YELLOW_MANTICORE_WING:"Yellow Manticore",COSMETIC_COLOR_YELLOW_SUNFLOWER:"Yellow Sunflower",COSMETIC_COSTUME_CUSTOM:"Custom",COSMETIC_COSTUME_MORTARI_MUMMY:"Mummy",COSMETIC_FLAVOUR_MUMMY:"Might have been your great-great-great-grandpa's friend",COSMETIC_PART_MORTARI_MUMMY_ARM:"Linen Arm Wraps",COSMETIC_PART_MORTARI_MUMMY_HEAD:"Mummy Head",COSMETIC_PART_MORTARI_MUMMY_LEG:"Mummy Feet",COSMETIC_PART_MORTARI_MUMMY_TORSO:"Mummy Body",COSMETIC_COSTUME_GNARL_LUMBERJACK:"Lumberjack",COSMETIC_FLAVOUR_GNARL_LUMBERJACK:"Never logs off!",COSMETIC_PART_GNARL_LUMBERJACK_ARM:"Lumberjack Gloves",COSMETIC_PART_GNARL_LUMBERJACK_HEAD:"Gnarly Doublebun",COSMETIC_PART_GNARL_LUMBERJACK_LEG:"Warm Boots",COSMETIC_PART_GNARL_LUMBERJACK_TORSO:"Warm Vest",COSMETIC_COSTUME_2024_EASTER_BUNNY:"'24 Easter Bunny Pajamas",COSMETIC_PART_BUNNY_PAJAMAS_ARM:"Bunny Paws",COSMETIC_PART_BUNNY_PAJAMAS_HEAD:"Bunny Ears",COSMETIC_PART_BUNNY_PAJAMAS_LEG:"Bunny Hind Feet",COSMETIC_PART_BUNNY_PAJAMAS_TORSO:"Bunny Suspenders",COSMETIC_COSTUME_2024_EASTER_EGG:"'24 Easter Egg",COSMETIC_FLAVOUR_HAPPY_EASTER:"Happy Easter!",COSMETIC_PART_EASTER_EGG_ARM:"Easter Egg Arms",COSMETIC_PART_EASTER_EGG_HEAD:"Easter Egg Top Shell",COSMETIC_PART_EASTER_EGG_LEG:"Easter Egg Boots",COSMETIC_PART_EASTER_EGG_TORSO:"Easter Egg Bottom Shell",COSMETIC_COSTUME_VILLAGER_6:"Villager #6",COSMETIC_PART_VILLAGER_ANKLE_LEG:"Ankle Boots",COSMETIC_PART_VILLAGER_STRIPED_SLEEVES:"Striped Sleeves",COSMETIC_PART_VILLAGER_TORSO_6:"Suspenders",COSMETIC_COSTUME_VILLAGER_5:"Villager #5",COSMETIC_PART_VILLAGER_DRESS_SLEEVES:"Dress Sleeves",COSMETIC_PART_VILLAGER_HEELS:"Low Heels",COSMETIC_PART_VILLAGER_TORSO_5:"Dress",COSMETIC_COSTUME_SANTA_TREESWEATER:"'23 Santa Tree Sweater",COSMETIC_PART_TREESWEATER_ARM:"Christmas Tree Sleeves",COSMETIC_PART_TREESWEATER_TORSO:"Christmas Tree Sweater",COSMETIC_PART_VILLAGER_HEAD_SANTAHAT_BEARD:"Santa Beard",COSMETIC_COSTUME_REINDERR_PAJAMAS:"'23 Reindeer Pajamas",COSMETIC_FLAVOUR_REINDEER_PAJAMAS:"Cozy pajamas, for this winter holiday, looks like a reindeer.",COSMETIC_PART_REINDEER_PAJAMAS_ARM:"Reindeer Fur Gloves",COSMETIC_PART_REINDEER_PAJAMAS_HEAD:"Reindeer Hoodie",COSMETIC_PART_REINDEER_PAJAMAS_LEG:"Reindeer Hooves",COSMETIC_PART_REINDEER_PAJAMAS_TORSO:"Reindeer Pajamas",COSMETIC_COSTUME_TREESWEATER_DRESS:"'23 Sweater Dress",COSMETIC_FLAVOUR_YULE:"Happy Yule!",COSMETIC_PART_TREESWEATER_DRESS_HEAD:"Christmas Cap (Bun)",COSMETIC_PART_TREESWEATER_DRESS_TORSO:"Christmas Tree Sweater Dress",COSMETIC_COSTUME_2021_12_SNOWMAN:"'21 Snowman",COSMETIC_FLAVOUR_SNOWMAN:"Christmas magic brought him to life!",COSMETIC_PART_VILLAGER_ARM_SNOWMAN:"Snowman Arm",COSMETIC_PART_VILLAGER_HEAD_SNOWMAN:"Snowman Tall Hat",COSMETIC_PART_VILLAGER_TORSO_2_SNOWMAN:"Snowman Vest",COSMETIC_COSTUME_2021_12_SWEATER_1:"'21 Sweater #1",COSMETIC_PART_VILLAGER_TORSO_3_2021_12_SWEATER:"'21 Christmas Sweater #1",COSMETIC_COSTUME_2021_12_SWEATER_2:"'21 Sweater #2",COSMETIC_PART_VILLAGER_TORSO_4_2021_12_SWEATER:"'21 Christmas Sweater #2",COSMETIC_PART_VILLAGER_ARM_2021_12_SWEATER:"'21 Christmas Sleeves",COSMETIC_FLAVOUR_MERRY_CHRISTMAS:"Merry Christmas!",COSMETIC_COSTUME_CACTOID_JACKIE:"Cactus Jackie",COSMETIC_FLAVOUR_CACTOID_JACKIE:"The result of somebody eating too much cactus.",COSMETIC_PART_CACTOID_JACKIE_ARM:"Cactoid Flower Hands",COSMETIC_PART_CACTOID_JACKIE_HEAD:"Cactoid (Flower)",COSMETIC_PART_CACTOID_JACKIE_LEG:"Straw Sandals",COSMETIC_PART_CACTOID_JACKIE_TORSO:"Cactoid Vase",COSMETIC_COSTUME_CAPTAIN:"Captain",COSMETIC_FLAVOUR_CAPTAIN:"The best looking armor in town!",COSMETIC_PART_ARMOR_CAPTAIN_ARM:"Golden Gauntlets",COSMETIC_PART_ARMOR_CAPTAIN_HEAD:"Golden Helmet",COSMETIC_PART_ARMOR_CAPTAIN_TORSO:"Golden Chestplate",COSMETIC_COSTUME_EYRA_BOTANIST:"Botanist",COSMETIC_FLAVOUR_EYRA_BOTANIST:"In charge of keeping the gardens blooming.",COSMETIC_PART_EYRA_BOTANIST_ARM:"Vine Sleeves",COSMETIC_PART_EYRA_BOTANIST_HEAD:"Floral (Long)",COSMETIC_PART_EYRA_BOTANIST_LEG:"Botanist Boots",COSMETIC_PART_EYRA_BOTANIST_TORSO:"Botanist Jacket",COSMETIC_COSTUME_EYRA_NOBLE:"Noble",COSMETIC_FLAVOUR_EYRA_NOBLE:"Usually seen wearing ceremonial garments with Eyra's symbol of grace.",COSMETIC_PART_EYRA_NOBLE_ARM:"Jeweled Wrist Guards",COSMETIC_PART_EYRA_NOBLE_HEAD:"Leafy Crown (Medium)",COSMETIC_PART_EYRA_NOBLE_LEG:"Noble Pants",COSMETIC_PART_EYRA_NOBLE_TORSO:"Cerimonial Robe",COSMETIC_COSTUME_FRIZARD_ARCHAEOLOGIST:"Archaeologist",COSMETIC_FLAVOUR_FRIZARD_ARCHAEOLOGIST:"Loves dungeons and museums. Hates snakes and rolling boulders.",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_ARM:"Archaeologist Sleeves",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_HEAD:"Chameleon (Fedora)",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_LEG:"Scissor Feet",COSMETIC_PART_FRIZARD_ARCHAEOLOGIST_TORSO:"Archaeologist Jacket",COSMETIC_COSTUME_FRIZARD_BUCCANEER:"Buccaneer",COSMETIC_FLAVOUR_FRIZARD_BUCCANEER:'"You\'ve got dangerous eyes... Not as dangerous as mine!"',COSMETIC_PART_FRIZARD_BUCCANEER_ARM:"Pirate Dress Sleeves",COSMETIC_PART_FRIZARD_BUCCANEER_HEAD:"Frog (Pirate Hat)",COSMETIC_PART_FRIZARD_BUCCANEER_LEG:"Webbed Feet",COSMETIC_PART_FRIZARD_BUCCANEER_TORSO:"Pirate Dress",COSMETIC_COSTUME_FRIZARD_SEA_CAPTAIN:"Sea Captain",COSMETIC_FLAVOUR_FRIZARD_SEA_CAPTAIN:'"Look at me, I am the captain now!"',COSMETIC_PART_FRIZARD_SEA_CAPTAIN_ARM:"Sea Captain Gloves",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_HEAD:"Sea Captain Hat",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_LEG:"Frizard Reptilian Feet",COSMETIC_PART_FRIZARD_SEA_CAPTAIN_TORSO:"Sea Captain Cape",COSMETIC_COSTUME_FRIZARD_SEA_LANTERN:"Sea Lantern",COSMETIC_FLAVOUR_FRIZARD_SEA_LANTERN:'"I will show you the path."',COSMETIC_PART_FRIZARD_SEA_LANTERN_HEAD:"Sea Lantern Kasa",COSMETIC_PART_FRIZARD_SEA_LANTERN_TORSO:"Sea Lantern Cape",COSMETIC_PART_FRIZARD_SEA_LANTERN_ARM:"Sea Lantern Sleeves",COSMETIC_PART_FRIZARD_SEA_LANTERN_LEG:"Frizard Webbed Feet",COSMETIC_COSTUME_GNARL_KINDLER:"Kindler",COSMETIC_FLAVOUR_GNARL_KINDLER:"Gets the fires started.",COSMETIC_PART_GNARL_KINDLER_HEAD:"Gnarly Topknot",COSMETIC_PART_GNARL_KINDLER_TORSO:"Kindling Bundle",COSMETIC_PART_GNARL_KINDLER_ARM:"Rugged Gloves",COSMETIC_PART_GNARL_KINDLER_LEG:"Gnarl Sandals",COSMETIC_COSTUME_GNARL_SHAMAN:"Shaman",COSMETIC_FLAVOUR_GNARL_SHAMAN:"The spiritual healer of the tribe.",COSMETIC_PART_GNARL_SHAMAN_ARM:"Bony Wristbands",COSMETIC_PART_GNARL_SHAMAN_HEAD:"Dreads (Medium)",COSMETIC_PART_GNARL_SHAMAN_LEG:"Shaman Boots",COSMETIC_PART_GNARL_SHAMAN_TORSO:"Bony Dress",COSMETIC_COSTUME_HAKAMA_BOY:"The Hakama",COSMETIC_FLAVOUR_HAKAMA_BOY:"Hakama are tied at the waist and fall approximately to the ankles.",COSMETIC_PART_HAKAMA_BOY_ARM:"Hakama Sleeves",COSMETIC_PART_HAKAMA_BOY_HEAD:"Bun (Short)",COSMETIC_PART_HAKAMA_BOY_LEG:"Waraji Sandals",COSMETIC_PART_HAKAMA_BOY_TORSO:"Hakama",COSMETIC_COSTUME_HUMAN_FARMER:"Farmer",COSMETIC_FLAVOUR_HUMAN_FARMER:'"One day, I will have my own adventures!"',COSMETIC_PART_HUMAN_FARMER_ARM:"Leather Glove",COSMETIC_PART_HUMAN_FARMER_HEAD:"Curly (Straw Hat)",COSMETIC_PART_HUMAN_FARMER_LEG:"Steel Toe Boots",COSMETIC_PART_HUMAN_FARMER_TORSO:"Farmer Overalls",COSMETIC_COSTUME_HUMAN_HARVESTER:"Harvester",COSMETIC_FLAVOUR_HUMAN_HARVESTER:'"Don\'t forget to pick up those carrots!"',COSMETIC_PART_HUMAN_HARVESTER_ARM:"Rubber Glove",COSMETIC_PART_HUMAN_HARVESTER_HEAD:"Wavy (Straw Hat)",COSMETIC_PART_HUMAN_HARVESTER_LEG:"Gardening Boots",COSMETIC_PART_HUMAN_HARVESTER_TORSO:"Harvester Dress",COSMETIC_COSTUME_KHORNOS_CHIEFTAINESS:"Chieftainess",COSMETIC_FLAVOUR_KHORNOS_CHIEFTAINESS:"Rumors say her fur turned white after many battles.",COSMETIC_PART_KHORNOS_CHIEFTAINESS_ARM:"Battle Bracelets",COSMETIC_PART_KHORNOS_CHIEFTAINESS_HEAD:"Cow (Long Horns)",COSMETIC_PART_KHORNOS_CHIEFTAINESS_LEG:"Ringed Hooves (Gold)",COSMETIC_PART_KHORNOS_CHIEFTAINESS_TORSO:"Battle Armored Top",COSMETIC_COSTUME_KHORNOS_HUNTER:"Hunter",COSMETIC_FLAVOUR_KHORNOS_HUNTER:"This Hog is as wild as its fashion style!",COSMETIC_PART_KHORNOS_HUNTER_ARM:"Muscular Arms",COSMETIC_PART_KHORNOS_HUNTER_HEAD:"Hog (Mohawk)",COSMETIC_PART_KHORNOS_HUNTER_LEG:"Ringed Hooves (Silver)",COSMETIC_PART_KHORNOS_HUNTER_TORSO:"Muscular Tank Top",COSMETIC_COSTUME_KHORNOS_KNIGHT:"Knight",COSMETIC_FLAVOUR_KHORNOS_KNIGHT:"A mighty force that proudly wears his people's symbol of power.",COSMETIC_PART_KHORNOS_KNIGHT_ARM:"Knight Gauntlets",COSMETIC_PART_KHORNOS_KNIGHT_HEAD:"Bull (Helmet)",COSMETIC_PART_KHORNOS_KNIGHT_LEG:"Armored Hooves",COSMETIC_PART_KHORNOS_KNIGHT_TORSO:"Bannered Chestplate",COSMETIC_COSTUME_KHORNOS_WARRIOR:"Warrior",COSMETIC_FLAVOUR_KHORNOS_WARRIOR:"These bovine soldiers are the heart of the army.",COSMETIC_PART_KHORNOS_WARRIOR_ARM:"Battle Bracelets",COSMETIC_PART_KHORNOS_WARRIOR_HEAD:"Bull (Long Horns)",COSMETIC_PART_KHORNOS_WARRIOR_LEG:"Hooves",COSMETIC_PART_KHORNOS_WARRIOR_TORSO:"Battle Harness",COSMETIC_COSTUME_KHORNOS_WARRIORESS:"Warrioress",COSMETIC_PART_KHORNOS_WARRIORESS_ARM:"Battle Wrist Armor",COSMETIC_PART_KHORNOS_WARRIORESS_HEAD:"Cow (Medium Horns)",COSMETIC_PART_KHORNOS_WARRIORESS_LEG:"Ringed Hooves",COSMETIC_PART_KHORNOS_WARRIORESS_TORSO:"Battle Armored Top",COSMETIC_COSTUME_MORTARI_GUARDIAN:"Guardian",COSMETIC_FLAVOUR_MORTARI_GUARDIAN:"They're all bark and no bite. Unless you come too close...",COSMETIC_PART_MORTARI_GUARDIAN_ARM:"Ornamented Wrist Guards",COSMETIC_PART_MORTARI_GUARDIAN_HEAD:"Jackal Skull",COSMETIC_PART_MORTARI_GUARDIAN_LEG:"Ornamented Knee Armor",COSMETIC_PART_MORTARI_GUARDIAN_TORSO:"Ornamented Thorax",COSMETIC_COSTUME_MORTARI_SKELETON_MINION:"Skeleton Minion",COSMETIC_FLAVOUR_MORTARI_SKELETON_MINION:"Spooky scary skeletons!",COSMETIC_PART_MORTARI_SKELETON_MINION_ARM:"Bony Arms",COSMETIC_PART_MORTARI_SKELETON_MINION_HEAD:"Minion Skull",COSMETIC_PART_MORTARI_SKELETON_MINION_LEG:"Punctured Boots",COSMETIC_PART_MORTARI_SKELETON_MINION_TORSO:"Thorax",COSMETIC_COSTUME_PUMPKIN_HEAD:"Pumpkin Head",COSMETIC_FLAVOUR_PUMPKIN_HEAD:"Probably just someone wearing seasonally appropriate head protection.",COSMETIC_PART_PUMPKIN_HEAD:"Seasonally Appropriate Head Protection",COSMETIC_COSTUME_YUKATA_GIRL:"The Yukata",COSMETIC_FLAVOUR_YUKATA_GIRL:"The perfect kimono for casual settings and summer festivals.",COSMETIC_PART_YUKATA_GIRL_ARM:"Yukata Sleeves",COSMETIC_PART_YUKATA_GIRL_HEAD:"Bun (Long)",COSMETIC_PART_YUKATA_GIRL_LEG:"Zori Sandals",COSMETIC_PART_YUKATA_GIRL_TORSO:"Yukata",COSMETIC_PART_VILLAGER_HEAD_SHORT_FULL:"Full (Short)",COSMETIC_PART_VILLAGER_HEAD_BUZZ_CUT:"Buzz Cut (Short)",COSMETIC_PART_VILLAGER_HEAD_BOB_CUT:"Bob Cut (Medium)",COSMETIC_PART_VILLAGER_HEAD_LONG_SIMPLE:"Simple (Long)",COSMETIC_PART_VILLAGER_HEAD_REINDEER_1:"Reindeer Headband #1",COSMETIC_PART_VILLAGER_HEAD_REINDEER_2:"Reindeer Headband #2",COSMETIC_PART_VILLAGER_HEAD_SANTAHAT:"Santa Hat",COSMETIC_COSTUME_VILLAGER_1:"Villager #1",COSMETIC_COSTUME_VILLAGER_2:"Villager #2",COSMETIC_COSTUME_VILLAGER_3:"Villager #3",COSMETIC_COSTUME_VILLAGER_4:"Villager #4",COSMETIC_FLAVOUR_VILLAGER:"Your friendly neighborhood Worlds inhabitant.",COSMETIC_PART_VILLAGER_ARM:"Villager Sleeves",COSMETIC_PART_VILLAGER_ARM_CROSS:"Corset Sleeves",COSMETIC_PART_VILLAGER_ARM_INVERTED:"Tunic Sleeves",COSMETIC_PART_VILLAGER_HEAD_MEDIUM_BUN:"Bun (Medium)",COSMETIC_PART_VILLAGER_HEAD_MEDIUM_DOUBLEBUN:"Doublebun (Medium)",COSMETIC_PART_VILLAGER_HEAD_SHORT:"Caesar Cut (Short)",COSMETIC_PART_VILLAGER_HEAD_SHORT_SIDEFRINGE:"Side Fringe (Short)",COSMETIC_PART_VILLAGER_LEG_METAL:"Golden Leg Armor",COSMETIC_PART_VILLAGER_LEG_SHORT_BOOT:"Villager Boots",COSMETIC_PART_VILLAGER_LEG_TALL_BOOT:"Tall Boots",COSMETIC_PART_VILLAGER_LEG_THIGH_BOOT:"Thigh Boots",COSMETIC_PART_VILLAGER_TORSO:"Villager Suspenders",COSMETIC_PART_VILLAGER_TORSO_2:"Villager Vest",COSMETIC_PART_VILLAGER_TORSO_3:"Villager Corset",COSMETIC_PART_VILLAGER_TORSO_4:"Villager Tunic",COSMETIC_RACE_EYRA:"Eyra",COSMETIC_RACE_FRIZARD:"Frizard",COSMETIC_RACE_GNARL:"Gnarl",COSMETIC_RACE_HUMAN:"Human",COSMETIC_RACE_HUMAN_KINDA:"Human?",COSMETIC_RACE_KHORNOS:"Khornos",COSMETIC_RACE_MORTARI:"Mortari",COSMETIC_RACE_UNKNOWN:"????",COSMETIC_TYPE_ARMS:"Arms",COSMETIC_TYPE_COLOR_EYES:"Eye Color",COSMETIC_TYPE_COLOR_HAIR:"Hair Color",COSMETIC_TYPE_COLOR_SKIN:"Skin Tone",COSMETIC_TYPE_COSTUME:"Outfit",COSMETIC_TYPE_HEAD:"Head",COSMETIC_TYPE_LEGS:"Legs",COSMETIC_TYPE_TORSO:"Torso",CMODS_DIG_DURABILITY:"Durability",CMODS_DIG_RATE:"Speed",CMODS_NOT_GOOD:"This can't be good...",CMODS_O2_CAPACITY:"O₂ Capacity",CMODS_UNDERWATER_SPEED:"Underwater Speed",CMODS_RANDOM_BONUSES:"+{val}-{val_2} random bonuses",CMODS_SPEED:"Running Speed",CMODS_STAMINA_CAPACITY:"{val} Capacity",CMODS_STAMINA_DRAIN:"{val} Drain",CMODS_STAMINA_RANGE:"Range",CMODS_STAMINA_RATE:"Less {val} Usage",CMODS_TIMED:"{val} {val_2} for {val_3}",CMODS_TIMED_DIG_RATE:"Gather Speed",CMODS_TIMED_SPRINTING_STAMINA:"Sprinting {val}",CMODS_TIMED_STAMINA:"{val}/second",CMODS_TIMED_STAMINA_CAPACITY_WGSICK:"{val} (Waygate Sickness)",DLG_DAILY_REDEEM_FAILED_CUSTOM_MSG:"Redeem failed.\nError={error}.",DLG_VIDEO_AD_FAILED_CUSTOM_MSG:'Playing video ad failed (error="{error}").\n\nIf you have any ad blockers installed, please disable them for this site.\n\nThere may be no ads currently available, please try again later.',DLG_LOADING_AD_TITLE:"Loading Video Ad",DLG_VIDEO_AD_FAILED_TITLE:"Unable to play Video Ad",DLG_VIDEO_AD_FAILED_MSG:"We're sorry, we were unable to play a video ad for you.\n\nIf you have any ad blockers installed, please disable them for this site.\n\nThere may be no ads currently available, please try again later.",DLG_VIDEO_AD_SKIPPED_TITLE:"Video Ad incomplete",DLG_VIDEO_AD_SKIPPED_MSG:"The video ad did not appear to play to completion, so no reward was given.  Please try again later.\n\nIf you have any ad blockers installed, please disable them for this site and reload the page.",LBL_CURRENCY_SHOP_AVAILABLE_IN:"Available In",LBL_CURRENCY_SHOP_DAILY_BONUS:"Daily Bonus",LBL_CURRENCY_SHOP_WATCH_VIDEO_AD:"Watch Video",LBL_CURRENCY_SHOP_FREE:"Free",LBL_CURRENCY_SHOP_FREE_DAILY_BONUS:"Free Bonus",LBL_CURRENCY_SHOP_SUBSECTION_GEMS_DESCRIPTION:"Used to acquire outfits",LBL_CURRENCY_SHOP_SUBSECTION_GEMS_TITLE:"Gems",LBL_CURRENCY_SHOP_SUBSECTION_ORBS_DESCRIPTION:"Used to acquire premium outfits and other perks",LBL_CURRENCY_SHOP_SUBSECTION_ORBS_TITLE:"Prismatic Orbs",LBL_CURRENCY_SHOP_SUBSECTION_GEMS_EXTRA:"You can also find free Gems in contest worlds!",LBL_CURRENCY_SHOP_TITLE:"Currency Shop",TLTP_OPEN_CURRENCY_SHOP:"Open Currency Shop",DOWSERUI_ORE_DETECTED:"{val} ore detected!",DOWSERUI_UNIDENTIFIED:"Unidentified ore detected.",BTN_DRINK:"Drink",ENERGYWELL_CANCEL_SICKNESS:"Note: Bonus time will instead cancel that much Waygate Sickness",ENERGYWELL_CANCEL_SICKNESS_SOME:"Note: Some bonus time will cancel your Waygate Sickness",ENERGYWELL_FULL:"You are already at full {val}",ENERGYWELL_LAST_DRINK:"Your last drink was {val} ago",ENERGYWELL_MUST_VISIT:"You must visit an Energy Well in-world to drink...",ENERGYWELL_READY:"Ready!",ENERGYWELL_RECHARGING:"The Energy Well is still recharging...",ENERGYWELL_WITHIN_SETTLEMENT:"Energy Wells only work within your Home Settlement",LBL_CURRENT_ENERGY:"Current {val}",LBL_OVERFILL_ENERGY:"Overfill: +{val} for {val_2}",LBL_REFILL_ENERGY:"Refill {val}",LBL_WELL_RESTED:"Well Rested: +{val} for {val_2}",STATUSMSG_ENERGY_WELL_ADD:"+{val} (Energy Well)",BTN_FINISH:"Finish",ERR_CRAFTING_CANNOT_COMPLETE:"Storage full: Crafting cannot complete",ERR_CRAFTING_STALLED:"Storage full: Crafting stalled",ERR_INSUFFICIENT_RESOURCES:"Cannot craft: Insufficient resources loaded",ERR_INVALID_INPUT:"Cannot craft: Invalid input combination",FACTORY_CRAFTING_COMPLETE:"Crafting complete: Take this to continue",FACTORY_CRAFTING_IN_PROGRESS:"Crafting in progress... check back later!",FACTORY_FULL_INVENTORY:"Cannot take: Inventory full",FACTORY_NO_RECIPES_AVAILABLE:"No recipes available",FACTORY_PROGRESS_READY:"Ready!",FACTORY_REFRESHING_CONTENTS:"Refreshing contents...",FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK:"Upgrade your Settlement to unlock",FORMAT_CRAFTING_PROGRESS:"{val} ({val_2})",FORMAT_NUMBER_OR_MORE:"{val}+",LBL_CRAFTING_COMPLETE:"Crafting Complete!",LBL_MISSING_PROP:"Missing prop",LBL_NO_RECIPE_SELECTED:"No Recipe Selected",LBL_OUTPUT_MULTIPLE:"{val} (x{val_2})",LBL_REFRESHING_FACTORY:"Refreshing...",LBL_SELECT_RECIPE:"Select Recipe",RECIPELIST_ALL_UNLOCKED_FOR_STATION:"All recipes for this station unlocked!",RECIPELIST_AMOUNT_UNLOCKED:"{total, plural, one{{val} of # recipe unlocked} other{{val} of # recipes unlocked}}",RECIPELIST_EVEN_MORE_FROM_LATER_UPGRADES:"Even more recipes available from later upgrades",RECIPELIST_UNLOCK_MORE_BY_UPGRADING:"Unlock more recipes by upgrading your Settlement",RECIPELIST_UPGRADE_SETTLEMENT_TO_UNLOCK:"Upgrade your Settlement at the Waygate to unlock",STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE:"Unable to change recipe: insufficient space to eject loaded inputs",STATUSMSG_SOME_ITEMS_DROPPED:"Some items dropped on ground",TLTP_ADD_TO_RECIPE:"Add to recipe",TLTP_ENOUGH_FOR_ONE:"(enough for one)",LBL_LIMITED_TIME_OFFER:"Limited Time Offer {val}",LBL_LIMITED_TIME_OFFER_NAME:"Lost Frontier Farmers Pack",LBL_LIMITED_TIME_OFFER_INCLUDED:"Included in this Special Pack",LBL_LIMITED_TIME_OFFER_ITEM_1:'1 Rare "Harvester" Outfit',LBL_LIMITED_TIME_OFFER_ITEM_2:'1 Rare "Farmer" Outfit',LBL_LIMITED_TIME_OFFER_ITEM_3:"90 Orbs",LBL_LIMITED_TIME_OFFER_ALL_FOR:"All for ",LBL_LIMITED_TIME_OFFER_MAYBE_LATER:"Maybe later",LBL_LIMITED_TIME_OFFER_SHUT_UP:"SHUT UP AND TAKE MY {val}",HUDS_GEM_FOUND_ALL:"All {val} Gems found!",HUDS_GEM_FOUND_ONE:"{val} Gem found!",HUDS_GEM_HIDDEN:"This world {gems, plural, one{has a hidden Gem} other{has hidden Gems}}",BTN_HUDS_GEM_BONUS_CLAIM:"Get {label} bonus Gems!",DLG_GEM_BONUS_TITLE:"Congratulations!",DLG_GEM_BONUS_MSG:"You have found all {label} hidden Gems in this world!\n\nDouble your bonus by watching a video ad?",STATUSMSG_GEM_BONUS:"You earned {label} bonus Gems!",DLG_CLAIMING_BONUS_TITLE:"Claiming bonus reward...",HUDS_GEM_BONUS_CLAIMED:"(bonus gems already earned)",HUDS_IN_OUTSKIRTS_OF:'In outskirts of "{val}"',HUDS_IN_SETTLEMENT:'In Settlement "{val}"',HUDS_IN_THE_WILDS:"In the Wilds",STATUSMSG_BUILD_WAIT:"You're queued for build access, there {wait, plural, one{is # user} other{are # users}} before you.",STATUSMSG_BUILD_WAIT_NEXT:"You're queued for build access, and you're up next, get ready!",STATUSMSG_BUILD_BLOCKED_SETTLEMENT:"You have build access in this world, but are in someone else's Settlement.  Please find unclaimed space to build or start your own Settlement.",STATUSMSG_BUILD_BLOCKED:"You have build access in this world, but are in a restricted **Area**.  Please find somewhere else to build.",STATUSMSG_ITS_DARK:"It's pretty dark!  {val}",STATUSMSG_SETTLEMENT_NO_ACCESS:"(you do not have access to this Settlement)",STATUSMSG_STAMINA_DAMAGE:"-{val} ({val_2})",STATUSMSG_STAMINA_MODS:"{val} {val_2} {val_3}",STATUSMSG_BOOSTHELP_BOTH:"{img}Boost this world to help increase the Builder limit for everyone, and get in now!",STATUSMSG_BOOSTHELP_INCREASE_LIMIT:"{img}Boost this world to help increase the Builder limit for everyone!",STATUSMSG_BOOSTHELP_PRIORITY_QUEUE:"{img}Boost this world to earn priority queuing for immediate access!",TLTP_WORLD_CLICK_TO_LIKE:"Click to like this world",TLTP_WORLD_LIKED:"You like this world!",TLTP_WORLD_TIMES_VIEWED:"This world {views, plural, one{has been viewed # time} other{has been viewed # times}}",DLG_ERROR_GETTING_PHOTO_TITLE:"Error getting photo",DLG_ERROR_TOURNAMENT_CREATING_TITLE:"Error Creating Tournament",DLG_ERROR_TOURNAMENT_LEAVING_TITLE:"Error Leaving Tournament",DLG_ERROR_TOURNAMENT_SUBMITTING_TITLE:"Error Submitting Tournament Score",DLG_INITIALIZING_PURCHASE_TITLE:"Initializing Purchase",DLG_INVITING_TITLE:"Inviting!",DLG_OFFICIAL_GROUP_TITLE:"Getting Official Group",DLG_OFFICIAL_PAGE_TITLE:"Getting Official Page",DLG_PURCHASE_FAILED_PROCESS_MSG:"Error processing purchase: {error}",DLG_PURCHASE_FAILED_SYNC_MSG:"Purchase succeeded but failed to sync. Try reloading the page. Error={error}",DLG_SHARE_BLUEPRINT_MSG:"Worlds FRVR Blueprint | {val}",DLG_SHARE_WORLD_CURRENT_JOIN:"Join {val}",DLG_SHARE_WORLD_FRIEND_INVITING_MSG:"{val} is inviting you to play in {val_2} in Worlds FRVR!",DLG_SHARE_WORLD_REFERRAL_FRIEND_INVITING_MSG:"{val} needs your help to get 50 Gems in Worlds FRVR!",DLG_SHARE_WORLD_FRIEND_JUST_PLAYED_MSG:"{val} just played  {val_2}!",DLG_SHARING_TITLE:"Sharing",DLG_TOURNAMENT_CREATING_TITLE:"Creating Tournament",DLG_TOURNAMENT_LEAVING_TITLE:"Leaving Current Tournament",DLG_TOURNAMENT_SUBMITTING_TITLE:"Submitting Tournament Score",ERR_PURCHASE_NOT_LOGGED:"Not logged in",ERR_PURCHASE_NOT_READY:"Payments not ready",ERR_LOAD_BLUEPRINT_IMAGE:"Failed to load blueprint image",ERR_LOAD_WORLD_IMAGE:"Failed to load",FBINSTANT_SHARE_PHOTO:"Worlds FRVR Photo",FBINSTANT_SHARE_PHOTO_TITLED:'Worlds FRVR | Photo "{title}"',FBINSTANT_SHARE:"Worlds FRVR | {val}",FBINSTANT_SHARE_WORLD_REFERRAL:"Worlds FRVR | Help your friend get 50 Gems!",FBINSTANT_TAKE_SCREENSHOT:"I took a photo in Worlds FRVR!",FEEDBACK_DESC_ACCOUNT_DELETE:"",FEEDBACK_DESC_DISCORD:"For additional support, or to report bugs, please visit us on Discord: {val}",FEEDBACK_DESC_FACEBOOK:"For additional support, or to report bugs, please visit our Discord.",FEEDBACK_DESC_GENERIC:"Your feedback is important to us! We receive a lot of feedback and cannot address every individual issue, but we will do our best to consider all submitted feedback.",FEEDBACK_DESC_YANDEX:"For additional support press the Yandex Menu button and choose Feedback.",FEEDBACK_ERROR_WHAT_CAUSED:"What were you doing when you encountered the error?",LBL_ERROR_DETAILS:"Error details",LBL_FEEDBACK_TEXT:"Bug Report / Feedback",STATUSMSG_FEEDBACK_SUBMITTED:"Feedback submitted",STATUSMSG_FEEDBACK_SUBMIT_ERROR:"Error submitting feedback",ERR_CUSTOM_TEXTURES_NOT_ALLOWED:"Custom textures not allowed",ERR_INVALID_DATA_HEADER:"Invalid data header: {val}",BTN_CREATE_LF:"I'll explore the Lost Frontier!",BTN_CREATE_UNL:"An Unlimited world, please!",BTN_EXPLORE_OTHER_WORLDS:"Explore on my own!",LBL_LOST_FRONTIER:"Lost Frontier",LBL_UNLIMITED:"Unlimited",LBL_WELCOME_TITLE:"Welcome to",MSG_CREATE_LF_DESC:"Build your own Settlement and gather resources. Explore an undiscovered world!",MSG_CREATE_UNL_DESC:"Unlimited resources, imagination is the only limit. Build anything that you want!",MSG_EXPLORE_OTHER_WORLDS_DESC:"You can also explore other amazing worlds made by players from all over the globe!",MSG_WHAT_KIND_OF_WORLD:"What kind of world do you want to create?",BTN_COMING_SOON:"Coming soon!",BTN_CONSUME:"Consume",BTN_DRAIN:"Drain",BTN_DROP:"Drop",BTN_PUT:"Put",BTN_PUT_ALL:"Put All",BTN_QUICK_DEPOSIT:"Quick Deposit",BTN_SORT:"Sort",BTN_SPLIT:"Split",BTN_TAKE_ALL:"Take All",BTN_USE:"Use",DLG_DISPLAY_NAME_CHANGED_MSG_NEW:"Display name changed to {val}!",DLG_DISPLAY_NAME_CHANGED_MSG_USERID:"Your User ID remains {val}.",DLG_DISPLAY_NAME_CHANGED_TITLE:"Display Name Changed",DLG_DISPLAY_NAME_ERROR_MSG:"Unable to rename: lost connection",DLG_DISPLAY_NAME_MSG:"Enter a new name for yourself",DLG_DISPLAY_NAME_CONFIRM_MSG:"New display name:\n{name}",DLG_DISPLAY_NAME_TITLE:"Display Name",INVENTORYUI_AMOUNT_INSUFFICIENT:"({val} short)",INVENTORYUI_AMOUNT_ONE:"(one)",INVENTORYUI_CONTAINER:"container",INVENTORYUI_INVENTORY:"inventory",INVENTORYUI_MISSING_CONTAINER:"Missing container",INVENTORYUI_REFRESHING_CONTENTS:"Refreshing contents...",LBL_TRANSFER:"Transfer",STATUSMSG_CANNOT_DROP:"Cannot drop: could not find empty space",STATUSMSG_CANNOT_PUT:"Cannot put all: {val} full",STATUSMSG_CANNOT_TAKE:"Cannot take all: {val} full",STATUSMSG_CANNOT_TAKE_HEAVY:"Cannot take all: you area already carrying a heavy item",STATUSMSG_QUICK_DEPOSIT_FAIL_FULL:"Quick Deposit failed: Full container",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_CONTAINERS:"Quick Deposit failed: No nearby containers",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_MATCH:"Quick Deposit failed: Nothing matching nearby containers",STATUSMSG_QUICK_DEPOSIT_FAIL_PARTIAL:"Quick Deposit partially complete: Full container",STATUSMSG_QUICK_DEPOSIT_SUCCESS:"Quick Deposit: {items, plural, one{# item stored} other{# items stored}} {containers, plural, one{in # nearby container} other{in # nearby containers}}",STATUSMSG_QUICK_STORE_FAIL_FULL:"Cannot quick-store: {val} full",STATUSMSG_QUICK_STORE_FAIL_HEAVY:"Cannot take: you are already carrying a heavy item",TLTP_ADD_QUICKBAR:"Add to quickbar and exit menu",TLTP_CHANGE_NAME:"Change Display Name",TLTP_DEPOSIT_ALL_NEARBY:"Deposit all items into nearby containers with matching items",TLTP_DROP:"Drop",TLTP_EQUIPMENT_EQUIP:"Equip",TLTP_EQUIPMENT_SLOT:"Equipment slot for {val}",TLTP_EQUIPMENT_SLOT_DEFAULT_CRUDE_TOOLS:"(Empty, using default crude tool)",TLTP_EQUIPMENT_SLOT_DEFAULT_TOOLS:"(Empty, using default tool)",TLTP_EQUIPMENT_SPLIT_STACK:"Split stack",TLTP_EQUIPMENT_UNEQUIP:"Un-equip",TLTP_ITEM_IN_TRASH:"{val} (in trash)",TLTP_NEXT_SKIN:"Next skin",TLTP_PREVIOUS_SKIN:"Previous skin",TLTP_SORT_AND_STACK:"Sort and stack items",TLTP_STACK:" {val} (stack)",TLTP_TRASH:"Trash",TLTP_TRASH_EMPTY:"Empty Trash",DLG_ERROR_INVENTORY_RESET_MSG:"Try reloading the app or page if this persists.",DLG_ERROR_INVENTORY_RESET_TITLE:"Error Resetting Inventory",INVENTORY_ITEM_LABEL_HATCHET:"gathering wood (Hatchet)",INVENTORY_ITEM_LABEL_PICKAX:"gathering stone (Pickax)",INVENTORY_ITEM_LABEL_SHOVEL:"gathering dirt (Shovel)",STATUSMSG_CANT_GRANT_INVENTORY_LOCKED:"Could not grant items: inventory locked",STATUSMSG_ITEM_ADD:"+{val} {val_2} ({val_3})",STATUSMSG_ITEM_AUTO_EQUIP:"Auto-equipped {val}",STATUSMSG_ITEM_AUTO_GRANT:"Auto-granted {val}",STATUSMSG_ITEM_REMOVED:"Removed {val}",BTN_GIVE_ME:"Give me {count, plural, one{one} other{#}}!",ITEMINFO_CANT_AFFORD_ALERT:"You cannot afford to build this.",ITEMINFO_FIRST_SETTLEMENT_FREE:"First Settlement Waygate is free!",ITEMINFO_NOT_IN_INVENTORY_ALERT:"You do not have this in your inventory.",ITEMINFO_SETTLEMENT_LOCKED_ALERT:"This is not yet unlocked in your current Settlement.",ITEMINFO_UNLIMITED_ONLY_ALERT:"This can only be built directly in Unlimited Mode worlds.",LBL_BUILD_COST:"Build Cost",LBL_BUILD_COST_TOTAL:"Total Build Cost",LBL_CUSTOMIZE:"Customizable Build Cost",LBL_CRAFTED_BY:"Crafted by",LBL_CRAFT_FROM:"Crafted from",LBL_CRAFT_FROM_AMOUNT:"{val} crafted from",LBL_EXAMPLES:"Examples",LBL_CUSTOMIZATION_OPTIONS:"Customization Options",LBL_ITEM_CONTEXT_BUILD:"(Build)",LBL_ITEM_CONTEXT_ITEM:"(Item)",LBL_ITEM_CONTEXT_RECIPE:"(Recipe)",LBL_ITEM_CONTEXT_SETTLEMENT_UPGRADE:"(Settlement Upgrade)",TLTP_VIEW_BUILD_INFO:"View build info",TLTP_VIEW_CRAFT_COST:"View crafting cost",TLTP_VIEW_ITEM_INFO:"View item info",TLTP_CHOOSE_MATERIAL:"Choose material",TLTP_CLEAR_MATERIAL:"Clear custom material",TLTP_USE_THIS_MATERIAL:"Use this material",ITEMUNLOCK_NEW_ITEM:"You unlocked a new item",LOADCUSTOM_WAITING_ON:"{loads, plural, one{Waiting on # load} other{Waiting on # loads}}...",ERR_LANGUAGE_NOT_FOUND:'Language "{val}" not supported',MSG_LANGUAGE_GET:"The current language is {val}",MSG_LANGUAGE_SET:"The language changed to {val}",DLG_REWARD_TITLE:"Congratulations!",DLG_REWARD_REFERRAL_MSG:"{friends, plural, one{A friend} other{# friends}} you invited {friends, plural, one{has} other{have}} started to play Worlds FRVR!",DLG_REWARD_GEM_MSG:"Here is your free {val}♦ Gem reward!",DLG_EXIT_CONFIRMATION_MSG:"Pending changes will be lost.",DLG_EXIT_CONFIRMATION_TITLE:"Are you sure you want to exit?",MSG_COPY_TEXT_FAILURE:"Copy to clipboard FAILED, please copy from below.",MSG_COPY_TEXT_SUCCESS:"Copied to clipboard!",WINDOW_TITLE:"Worlds FRVR",WINDOW_TITLE_COMPOSITE:"{val} | Worlds FRVR",BTN_BUILD_CONTEST:"Build Contest!",BTN_FEEDBACK_ACCOUNT:"Feedback / Account",BTN_JOIN_OUR_GROUP:"Join our Group!",BTN_LATEST_NEWS:"Latest News",BTN_OUTFIT:"Outfit",BTN_PLAY:"Play",BTN_RECENT_UPDATES:"Recent Updates",DLG_ACCESS_TOKEN_APPLIED_TITLE:"Access Token Applied",DLG_ERROR_ACCESS_TOKEN_TITLE:"Access Token Error",DLG_ERROR_WORLD_CREATE_TITLE:"World Creation Error",DLG_ERROR_WORLD_DELETE_TITLE:"World Deletion Error",DLG_ERROR_WORLD_FORGET_TITLE:"World Forget Error",DLG_ERROR_WORLD_PASSWORD_TITLE:"World Password Error",DLG_NEW_WORLD_NAME_MSG:"Enter a name for your new world",DLG_JOIN_USER_FAILED_NOT_FOUND_MSG:"The user {user} cannot be found.",DLG_JOIN_USER_FAILED_NOT_PLAYING_MSG:"The user is not currently playing.",DLG_JOIN_USER_FAILED_TITLE:"Joining User Failed",GAME_MODE_LOST_FRONTIER:"Lost Frontier",GAME_MODE_UNLIMITED:"Unlimited",LBL_ACCESS_TOKEN_ENTER:"Enter Access Token",LBL_CONTINENT_DATA_MOD:"Continent data provided by mod",LBL_DISCORD_WORLDS:"Worlds Discord",LBL_DMCA:"DMCA",LBL_FEATURED_WORLDS:"Featured Worlds",LBL_FRIENDS_IN_WORLD:"Friends In-World",LBL_GAME_MODE:"Game Mode",LBL_GDPR:"GDPR",LBL_MEANWHILE_CHECK_OUT:"Meanwhile check out",LBL_MY_WORLDS:"My Worlds",LBL_MY_WORLDS_FROZEN:"My Contest Submissions",LBL_SEARCH:"Search",LBL_USERS_ONLINE_NUMBER:"{users, plural, one{# user online} other{# users online}}",LBL_WORLDS:"Worlds",LBL_WORLDS_ACTIVE:"Active Worlds",LBL_WORLDS_ACTIVE_AND_RECENT:"Active and Recent Worlds",LBL_WORLDS_RECENT:"Recent Worlds",LBL_WORLD_PASSWORD_ENTER:"Enter World Password",LBL_WORLD_SEED:"World Seed",LBL_WORLD_SEED_ENTER:"Enter a random seed for your new world",LBL_WORLD_SEED_SHORT:"Seed",LBL_WORLD_TYPE:"World Type",LOGINMSG_RECONNECTING:"Connection lost, attempting to reconnect ({val})...",MSG_ACCESS_TOKEN_VALIDATING:"Validating access token...",MSG_ACTIVE_WORLDS_NOT_FOUND:"No active worlds found",MSG_ACTIVE_WORLDS_QUERYING:"Querying...",MSG_PARTY_CHOOSING_HOST:"Starting a Party: assigning a Party Host...",MSG_PARTY_HOST_CREATE_OR_JOIN_WORLD:"You are the HOST!\nOther players are waiting for you\nto choose or create a world.",MSG_PARTY_HOST_IN_PRIVATE_WORLD:"The Party host is in a private world.\nPlease wait until the host joins another world or gives you access.",MSG_PARTY_WAITING_HOST_WORLD:"Waiting for the Party host to join a world...",MSG_PASSWORD_VALIDATING:"Validating password...",MSG_REDDIT_FOR_MORE_INFO:"Check out {val} for more info!",MSG_SEARCHING:"Searching...",MSG_SERVER_NEEDS_ACCESS_TOKEN:"This server requires an Access Token.",PAGETITLE_CREATE_NEW_WORLD:"Create New World",SETTING_AUTO_FULLSCREEN_HELP:"Automatically enter full-screen when clicking Play on the main menu, if available",SETTING_NOT_AVAILABLE_ON_DEVICE:"Not available on this device",TLTP_SEARCH_WORLDS_ALL:"Search all worlds",TLTP_SEARCH_WORLDS_BUILDER:"Search only worlds where anyone can build",TLTP_SEARCH_WORLDS_LF:"Search only Lost Frontier worlds",TLTP_SORT_BY_LIKES:"Sort by Likes",TLTP_SORT_BY_NAME:"Sort by Name",TLTP_SORT_BY_VIEWS:"Sort by Views",TLTP_WORLD_LIST:"World List",TLTP_WORLD_SEARCH:"World Search",WORLD_SEED_EMPTY:"Empty",WORLD_TYPE_FLAT:"Flat",WORLD_TYPE_GENERATED_V1:"Generated V1",WORLD_TYPE_SMALL:"Small",DLG_MOTD_CLIENT_TITLE:"Update News",DLG_MOTD_SERVER_TITLE:"Message of the Day",DLG_MOTD_ACCOUNT_TITLE:"Account Notice",DLG_GENERATE_TOKENS_TITLE:"Generate Tokens",ERR_INVALID_BP_ID:"Invalid Blueprint ID",ERR_INVALID_PHOTO_ID:"Invalid Photo ID",ERR_INVALID_USER_ID:"Invalid User ID",ERR_PROP_FAR_AWAY:"{val} too far away",ERR_PROP_MISSING:"{val} missing",ERR_USER_NOT_FOUND:"User not found",LBL_BUILD_BLUEPRINT:"Build/Blueprint",LBL_CHARACTER:"Character",LBL_CONTAINER:"Container",LBL_SOCIAL:"Social",LBL_INVENTORY_CHARACTER:"Inventory/Character",LBL_QUICKSLOT:"Quick-Slot",LBL_SETTINGS:"Settings",LBL_WAYGATE:"Waygate",LBL_WORLD_INFO:"World Info",PAGETITLE_BLUEPRINT:"{val} (Blueprint)",DLG_API_ACCESS_MSG:"A mod at {val} is requesting access. Access will persist until you reload the page. Allow?",DLG_API_ACCESS_TITLE:"Mod API Access",LBL_PARTY_PLAYERS_WAITING:"The following players in your party are waiting to be granted BUILDER access:",BTN_MAKE_BUILDER:"Grant",BTN_MAKE_BUILDER_LONG:"Grant BUILDER Access",LBL_MY_PHOTO_LIBRARY:"My Photo Library",BTN_PHOTO_LIBRARY:"My Photo Library",LBL_PHOTO_LIBRARY:"Photo Library",TLTP_SORT_BY_TIMESTAMP:"Sort by date and time",TLTP_SORT_BY_WORLD:"Sort by world ID",BTN_CONTROLLING_CAMERA:"Controlling: Camera",BTN_CONTROLLING_PLAYER:"Controlling: Player",BTN_EXIT_PHOTO_MODE:"Exit Photo Mode",BTN_HIDE_SELF:"Hide Self",BTN_RETAKE_PHOTO:"Retake",BTN_SAVE_PHOTO:"Save Photo",BTN_SHOW_SELF:"Show Self",CHATERROR_COPY_NOT_SUPPORTED:"Copy to clipboard not supported: ({val})",DLG_ERROR_TAKING_PHOTO_TITLE:"Error taking photo",DLG_SAVING_PHOTO_TITLE:"Saving Photo",ERR_COULD_NOT_COMPRESS:"Could not compress into valid size.",ERR_WG_DEFAULT_VOXELS:"Waygate images must use default voxel packs",LBL_CONFIRM_WG_IMAGES:"Confirm Waygate Images",LBL_FIELD_OF_VIEW_SHORT:"FOV",LBL_PHOTO_TAKEN:"Photo Taken",LBL_TIME_OF_DAY_SHORT:"Time",STATUSMSG_CLICK_TAKE_PHOTO:"Click to take photo",TLTP_VOXEL_PACK_APPLIED:"Uploading photo is not allowed due to an applied Voxel Pack.",LBL_CREATED:"Created",LBL_LOCATION:"Location",LBL_LOCATION_UNLISTED:"Unlisted Location (only shown to you as the owner)",LBL_PHOTO_LISTED:"{created}; in my Photo Showcase",LBL_PHOTO_LISTED_OVERFLOW:"{created}; in my Photo Showcase overflow (not visible until others removed)",LBL_PHOTO_UNTITLED:"Untitled Photo",PHOTOTITLE_AUTHOR:"Photo by {val}",PHOTOTITLE_ERROR:"Photo (Error)",PHOTOTITLE_LOADING:"Photo (Loading...)",BTN_PHOTO_DELETE:"Delete photo",BTN_PHOTO_LIST:"Add to Showcase",BTN_PHOTO_UNLIST:"Remove from Showcase",DLG_PHOTO_DELETE_TITLE:"Delete Photo",DLG_PHOTO_DELETE_MSG:"Do you wish to permanently DELETE this photo (all shared links will now be invalid), or just REMOVE it from your account (will not show up in your photo library, but links will still be valid)?",BTN_PHOTO_CONFIRM_DELETE:"Delete forever",BTN_PHOTO_CONFIRM_REMOVE:"Remove",STATUSMSG_PHOTO_DELETED:"Photo permanently deleted.",STATUSMSG_PHOTO_REMOVED:"Photo removed from account.",DLG_PHOTO_RENAME_TITLE:"Rename Photo",DLG_ARE_YOU_SURE_TITLE:"Are you sure?",DLG_ENTER_NEW_VALUE_MSG:"Enter a new value for {val}",DLG_INVALID_VALUE_INSERTED_MSG:"The value inserted is invalid.",LBL_PROPERTY_EDITOR:"Property Editor",STATUSMSG_SAVE_FAILED:"Save Failed.",STATUSMSG_SAVE_FAILED_NO_PROP:"Save Failed. Prop not found.",DLG_CHANGING_NAME_WILL_RESET_MSG:"Changing the name will reset all scores saved in this flag.",DLG_COURSE_GOAL_NAME_MSG:"Enter the name for this flag's course.",DLG_COURSE_START_NAME_MSG:"Enter the name for this buzzer's course.",DLG_ENTER_SIGN_TEXT_MSG:"Enter a message to display on the sign.",DLG_START_OTHER_RACE_MSG:"Do you want to start this race and abandon your previous one?",DLG_SUBMITTING_SCORE_TITLE:"Submitting Score",FORMAT_BUZZER_SCORE:"{val} - {val_2}",LBL_COURSE_FINISH:"Course Finish",LBL_COURSE_NAME:"Course Name",LBL_COURSE_START:"Course Start",LBL_GROUND_DIRT:"Dirt or Grass",LBL_GROUND_SAND:"Sand",LBL_GROUND_SEAFLOOR:"Dirt, Sand or Coral",LBL_GROUND_TANGIBLE:"solid Blocks",LBL_GROUND_TILLED:"Tilled Dirt",LBL_SIGN_TEXT:"Sign Text",MSG_SIGN_DEFAULT_TEXT:"Hello!",STATUSMSG_ASSIGN_BUZZER_NAME:"Interact while holding Race Start Buzzer to assign a name.",STATUSMSG_ASSIGN_FLAG_NAME:"Interact while holding Race Goal Flag to assign a name.",STATUSMSG_CACTUS_DAMAGE:"Ouch! Touched a {val}",STATUSMSG_SPIKE_DAMAGE:"Ouch! Touched some {val}",STATUSMSG_EXHAUSTED_TO_USE_BUCKET:"You are too exhausted to use your Water Bucket",STATUSMSG_EXHAUSTED_TO_USE_GROWSTICK:"You are too exhausted to invoke your Grimoire of Radiant Organic Wonders",STATUSMSG_MINE_PROP_ALIVE:"Cannot destroy Arborheart: still alive",STATUSMSG_MINE_PROP_FULL:"Cannot destroy prop: Empty contents first",STATUSMSG_MINE_PROP_NAMED:"Cannot destroy prop: Clear name first",STATUSMSG_MINE_LEAPGATE_ACTIVE:"Cannot destroy active Leapgate without permissions",STATUSMSG_MINE_WG_LINKED:"Cannot destroy waygate: Remove ID first",STATUSMSG_RACE_RESTARTED:"Current race restarted!",STATUSMSG_REMOVE_SPOTLIGHT_TO_EDIT:"Remove spotlight from Flag before editing.",DLG_EQUIPMENT_SLOTS_MSG:"Gathering Tools must be placed in your Equipment Slots (found to the right of your character), not in your Quickbar, to be automatically used.",DLG_EQUIPMENT_SLOTS_TITLE:"Use Equipment Slots",ERR_NOT_IN_WORLD:"Not currently in a world",LBL_BRUSH_MODE_1X1:"1x1",LBL_BRUSH_MODE_2X1:"2x1",LBL_BRUSH_MODE_2X2:"2x2",LBL_BRUSH_MODE_3X1:"3x1",LBL_BRUSH_MODE_3X3:"3x3",LBL_BRUSH_MODE_FLIPPED:"Flipped",LBL_GATHERING_TOOLS:"Gathering Tools",STATUSMSG_LIGHT_MINI_KB:"Press {val} to pull out your lantern.",STATUSMSG_LIGHT_MINI_TOUCH:"Tap your lantern to get some light.",STATUSMSG_LIGHT_NOSLOT_KB:"Press {val} or use the {val_2} to start building a torch.",STATUSMSG_LIGHT_NOSLOT_TOUCH:"Long-press a Quickbar slot or use the Build menu to start building a torch.",STATUSMSG_LIGHT_SLOT_KB:"Press {val} or select a light in the Quickbar.",STATUSMSG_LIGHT_SLOT_TOUCH:"Select a torch or lantern in the Quickbar.",STATUSMSG_WOOD_FOR_TORCH:"Wood is required to build a torch",TLTP_CHANGE_BRUSH:"Change brush size",TLTP_EMPTY_SLOT:"(Empty slot)",TLTP_LOW_DURABILITY:"Low durability on your {val}",TLTP_QBAR_FLIP:"Flip",TLTP_QBAR_UNBIND:"Unbind",TLTP_QUICKSLOT_ITEM:"Quick-slot item",TLTP_RECENT_ITEM:"(Recent item)",TLTP_RECENT_ITEM_EXISTING:"{val} (recent item)",TLTP_SELECT_LANTERN_OR_TORCH:"Select lantern or torch",TLTP_SWAP_TO_GATHERING:"Swap to Gathering Tools",TLTP_SWAP_TO_RECENT:"Swap to recent item",TLTP_TOGGLE_LANTERN:"Toggle lantern",TLTP_TOOL_IN_HAND:"{val} (in hand)",BTN_CANCEL_SCORE_REMOVAL:"Cancel Score Removal",BTN_CREATE_TOURNAMENT:"Create Tournament",BTN_LEAVE_TOURNAMENT:"Leave Tournament",BTN_REMOVE_SCORE:"Remove Score",BTN_SPOTLIGHT_RESULTS:"Spotlight Results",DLG_REMOVE_SCORE_MSG:"Are you sure you want to remove this score from the race results?  If the race has been modified, consider clearing all scores by re-placing the Race Goal Flag.  Only remove individuals' scores if someone is suspected of cheating or your own score.  If the user is suspected of cheating, you may want to ban them from the world first.",DLG_REMOVE_SCORE_TITLE:"Remove Score",DLG_REMOVING_SCORE_TITLE:"Removing Score",DLG_TOURNAMENT_SWITCH_MSG:"You can only race in a single Tournament at a time.  Do you want to switch your current Tournament?",DLG_TOURNAMENT_SWITCH_TITLE:"Switch Current Tournament?",FORMAT_RANK_NUMBER:"{val}.",LBL_RACE_RESULTS:"Race Results",LBL_WORLD_INFO_MENU:"World Info Menu",RACERESULTS_ALL_SCORES:"All Scores ({val})",RACERESULTS_NEW_BEST:"New Best Score!",RACERESULTS_NO_RANK:"No Rank",RACERESULTS_YOUR_SCORE:"Your Score",TLTP_REMOVE_SCORE:"Remove an individual score from the results list",TLTP_SPOTLIGHT_RESULTS:"Display these results in the {val} for anyone in this world",BTN_ABANDON_RACE:"Abandon?",DLG_LEAVE_RACE_MSG:"Do you want to leave your current race attempt?",LBL_READY_TIME:"Ready",REDDOT_NEW:"New!",LBL_GREETING_1:"Hi, {val}",LBL_GREETING_2:"Hello, {val}",LBL_GREETING_3:"Welcome, {val}",BTN_AA_OFF:"Antialiasing: Off",BTN_AA_OFF_PENDING:"Antialiasing: (Off)",BTN_AA_ON:"Antialiasing: On",BTN_AA_ON_PENDING:"Antialiasing: (On)",BTN_BUGS_FEEDBACK:"Bugs / Feedback",BTN_BUILD_INTEGRATED:"Build Menu: Integrated",BTN_BUILD_SEPARATE:"Build Menu: Separate",BTN_CAMERA_FP:"First person camera",BTN_CAMERA_TP:"Third person camera",BTN_CHAT_KEEP_FOCUS:"Chat: Keep Focus",BTN_CHAT_UNFOCUS:"Chat: Auto-Unfocus",BTN_EXIT_FULLSCREEN:"Exit Fullscreen",BTN_FAST:"Fast",BTN_FLY_ALT_LOCKED:"Fly: Altitude-locked",BTN_FLY_RELATIVE:"Fly: Relative",BTN_FULLSCREEN:"Fullscreen",BTN_FULLSCREEN_KEY:"Fullscreen ({val})",BTN_LAYOUT_AUTO:"Layout: Auto",BTN_LAYOUT_TALL:"Layout: Tall",BTN_LAYOUT_WIDE:"Layout: Wide",BTN_MANAGE_CONSENT:"Manage Consent",BTN_MAX_JUMP_HOLD:"Max Jump: Hold",BTN_MAX_JUMP_TAP:"Max Jump: Tap",BTN_MOUSEWHEEL_QUICKBAR:"Mousewheel: Quickbar",BTN_MOUSEWHEEL_ZOOM:"Mousewheel: Zoom",BTN_MUSIC_OFF:"Music: Off",BTN_MUSIC_ON:"Music: On",BTN_ORIENTATION:"Orientation",BTN_PRETTY:"Pretty",BTN_QBAR_AUTO:"Quickbar: Auto",BTN_QBAR_LEFT:"Quickbar: Left",BTN_QBAR_RIGHT:"Quickbar: Right",BTN_QBAR_TOP:"Quickbar: Top",BTN_RESET_DEFAULTS:"Reset to Defaults",BTN_RESET_INVENTORY:"Reset Inventory",BTN_RESET_TUTORIAL:"Reset Tutorial",BTN_SHADERS_MEH:"Shaders: Meh.",BTN_SHADERS_SHINY:"Shaders: Shiny!",BTN_SHADOWS_OFF:"Player Shadows: Off",BTN_SHADOWS_ON:"Player Shadows: On",BTN_SHOW_CONTROLS:"Show Controls",BTN_SOUND_OFF:"Sound: Off",BTN_SOUND_ON:"Sound: On",BTN_UIS_INTEGRATED:"Interactable UIs: Integrated",BTN_UIS_SEPARATE:"Interactable UIs: Separate",CONTROLS_BUILD_MENU:"Build menu",CONTROLS_CHAT:"chat",CONTROLS_CYCLE_SIZES:"cycle brush sizes / modes",CONTROLS_DOUBLE_JUMP:"Double-tap jump ({val}) to fly where available",CONTROLS_FLY:"fly",CONTROLS_FLY_DOWN:"fly down",CONTROLS_FORMAT_AGAIN:"{val} again",CONTROLS_FORMAT_DESC:"{val} - {val_2}",CONTROLS_FORMAT_OR:"{val} or {val_2}",CONTROLS_FULLSCREEN:"toggle fullscreen",CONTROLS_INV_MENU:"inventory menu",CONTROLS_JUMP:"jump",CONTROLS_JUMP_FLY:"jump / fly up",CONTROLS_LOOK:"look",CONTROLS_MOVE:"move",CONTROLS_OPEN_MENU:"open menu",CONTROLS_PHOTO_MODE:"photo mode",CONTROLS_PICK:"pick item",CONTROLS_PLACE_DESTROY:"build selected item, break blocks; drag to place multiple",CONTROLS_ON_TAP:"build selected item, interact / break some props",CONTROLS_ON_HOLD:"drag-place multiple, use selected tool to break blocks",CONTROLS_QUICK_SLOT:"Quick-Slot an item",CONTROLS_SCROLL_QBAR:"scroll quickbar",CONTROLS_SECTION_BUILDING:"Building",CONTROLS_SECTION_MOVEMENT:"Movement",CONTROLS_SECTION_OTHER:"Other",CONTROLS_SELECT_QBAR:"select item in quickbar",CONTROLS_SOCIAL_MENU:"social menu",CONTROLS_SPRINT:"sprint",CONTROLS_TOGGLE_GATHERING:"toggle between gathering tools and recent item",CONTROLS_TOGGLE_HUD:"toggle HUD",CONTROLS_TOGGLE_VIEW:"toggle first-/third-person view; scroll while pressed to zoom in/out",CONTROLS_TORCH:"torch",CONTROLS_UNLOCK_MOUSE:"unlock mouse cursor",CONTROLS_WORLD_MENU:"world info menu",CONTROLS_ZOOM:"zoom in/out",DLG_AA_CHANGED_QUIT_MSG:"Changing antialiasing requires restarting the app, quit now?",DLG_AA_CHANGED_RESTART_MSG:"Changing antialiasing requires restarting the app, restart now?",DLG_AA_CHANGED_TITLE:"Antialiasing Changed",DLG_CONTROLS_TITLE:"Controls",DLG_RESET_INV_MSG:"This will reset your inventory to the initial/blank state.  Really continue?",DLG_RESET_INV_TITLE:"Reset Inventory",DLG_RESET_DEFAULTS_MSG:"This will reset all settings and options to their default values.  Some settings may not take effect until you reload the page or restart the app.  Really continue?",DLG_RESET_DEFAULTS_TITLE:"Reset to Defaults",DLG_RESET_DEFAULTS_NOTHING_MSG:"All settings were already at their default values.",DLG_RESET_DEFAULTS_REQUIRED_QUIT_MSG:"Settings have been reset.  Applying the new defaults requires restarting the app, quit now?",DLG_RESET_DEFAULTS_REQUIRED_RESTART_MSG:"Settings have been reset.  Applying the new defaults requires restarting the app, restart now?",DLG_RESET_DEFAULTS_DONE_TITLE:"Settings Reset",LBL_AUDIO:"Audio",LBL_CAMERA_DISTANCE:"Camera Distance",LBL_CONTROLS:"Controls",LBL_DEBUG:"Debug",LBL_DETAIL_BUDGET:"Detail Quality",LBL_GRAPHICS:"Graphics",LBL_INTERFACE:"Interface",LBL_LOOK_SENSITIVITY:"Look Sensitivity",LBL_MOUSE_SENSITIVITY:"Mouse Sensitivity",LBL_PRESET:"Preset",LBL_RENDERER:"Renderer",LBL_RESOLUTION_SCALE:"Resolution Scale",LBL_VIEW_DISTANCE:"View Distance",LBL_VOLUME_MASTER:"Master Volume",LBL_VOLUME_MUSIC:"Music Volume",LBL_VOLUME_SOUND:"Sound Volume",BTN_SETTLEMENT_SET_AS_HOME:"Set as Home",BTN_UNLOCK_LETS_SEE:"Let's see!",BTN_UNLOCK_MORE1:"Also...",BTN_UNLOCK_MORE2:"And?",BTN_UNLOCK_MORE3:"Next...",BTN_UNLOCK_MORE4:"What else?",BTN_UNLOCK_MORE5:"More?",ERR_SETTLEMENT_OUT_OF_RANGE:"Cannot access Settlement Management: out of range",LBL_ADDITIONAL_CONTRIBUTORS:"Additional contributors",LBL_FIRST_UPGRADE:"First Upgrade",LBL_NEXT_TIER:"Next Tier",LBL_OPTIONAL_UPGRADES:"Optional Upgrades",LBL_SETTLEMENT_SIZE:"Settlement Size",LBL_SETTLEMENT_UNLOCK:"Settlement Unlock!",LBL_SIZE:"Size",LBL_TIER_NUMBER:"Tier {val}",LBL_UNLOCKED:"Unlocked",LBL_UNLOCKED_INDUSTRY:"Unlocked industry",LBL_UNLOCKED_TIER:"Unlocked Tier {val}",LBL_UNLOCKS:"Unlocks",LBL_UNLOCKS_INDUSTRY:"Unlocks industry",SETTLEMENT_DRAG_ITEMS:"HINT: Drag items from your inventory below to the requirement slot to unlock upgrades.",SETTLEMENT_FIRST_INCREASE_TIER:"First increase your Settlement Tier to open up more upgrade options.",SETTLEMENT_HOME_UNBOUND:"Setting this Settlement as your Home allows you to 'gate here from anywhere, replenish {val} here, and help expand it.",SETTLEMENT_NO_OPT_UPGRADES:"No optional upgrades available",SETTLEMENT_OTHER:"({val, plural, one{# other} other{# others}})",SETTLEMENT_RADIUS_ADD:"The bounds of your Settlement are expanded by {val} in all directions.",SETTLEMENT_UNLOCKED_AFTER_CREATION:"Unlocked {val} after world creation",SETTLEMENT_UNLOCKED_JUST_NOW:"Unlocked just now by {val}",SETTLEMENT_UNLOCKED_TIME_AGO:"Unlocked {val} ago by {val_2}",SETTLEMENT_VISIT_WG_IN_WORLD:"Visit the Waygate in-world to manage this Settlement",SETTLEMENT_VISIT_WG_IN_WORLD_UNBOUND:"Visit this Settlement in-world to make it your Home",SETTLEMENT_WG_UNLOCK:"The Waygate grows in power and grants your Settlement expanded capacities.",LBL_SHARE_MENU:"Share Menu",STATUSMSG_PHOTO_SAVED:"Photo Saved.",SOCIAL_MYSELF:"Myself",SOCIAL_BLOCKED_NUMBER:"Blocked Users ({val})",SOCIAL_FRIENDS_NUMBER:"Friends ({val})",SOCIAL_PARTY_NUMBER:"Party ({val})",SOCIAL_REFERRAL_BASIC:"Share the game with your friends!",SOCIAL_REFERRAL_FIRST:"Share the game with your friends! The first time a new friend starts playing by using your shared posts, you get 50 FREE Gems! Redeemable one time only.",LBL_SOCIAL_STATUS:"Status",SOCIAL_ONLINE:"Online",SOCIAL_AFK:"AFK (Idle)",SOCIAL_INVISIBLE:"Invisible (Offline)",BTN_GO_TO_SHOP:"Go to shop",DLG_BUY_MORE_GEMS_MSG:"You can buy or earn more Gems from the Currency Shop.",DLG_BUY_MORE_GEMS_WEB_MSG:"If you wish to buy more Gems, please visit us on the web and go to the Currency Shop.",DLG_BUY_MORE_ORBS_MSG:"You can buy or earn Prismatic Orbs in the Currency Shop.",DLG_BUY_MORE_ORBS_WEB_MSG:"If you wish to buy more Prismatic Orbs, please visit us on the web and go to the Currency Shop.",DLG_CANNOT_PURCHASE_MSG:"Cannot purchase: not logged in or disconnected",DLG_FIND_MORE_GEMS_MSG:"You can find Gems in featured worlds and previous contest winning worlds.",DLG_NEED_MORE_CURRENCY_COST_MSG:"Cost",DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG:"Your Gems",DLG_NEED_MORE_GEMS_MSG:'You need more Gems to get "{description}".',DLG_NEED_MORE_GEMS_TITLE:"Need More Gems",DLG_NEED_MORE_ORBS_CURRENT_AMOUNT_MSG:"Your Prismatic Orbs",DLG_NEED_MORE_ORBS_MSG:'You need more Prismatic Orbs to get "{description}".',DLG_NEED_MORE_ORBS_TITLE:"Need More Prismatic Orbs",DLG_PROCESSING_PURCHASE_TITLE:"Processing Purchase",DLG_PURCHASE_CONFIRMATION_MSG:'Are you sure you wish to get "{description}"?',DLG_PURCHASE_CONFIRMATION_TITLE:"Purchase Confirmation",DLG_PURCHASE_FAILED_CUSTOM_MSG:"Purchase failed. Error={error}.",DLG_PURCHASE_SUCCESSFUL_MSG:"Thank you for your purchase!",DLG_PURCHASE_SUCCESSFUL_TITLE:"Purchase Successful",CHATERROR_STUCK_LESS_MINUTE:"Must wait at least a minute before running {val} again",CHATERROR_STUCK_NOT_ADMIN:"Must be an admin or owner to use {val} in {val_2} worlds",CHATERROR_STUCK_TRY_WAYGATE:"Must have tried using a Waygate (in the last 2 minutes) to get unstuck first",LBL_BUILD:"Build",LBL_CRAFT:"Craft",LBL_UNLOCK:"Unlock",STATUSMSG_ADDED_TASK:"Added {val} to To-Do List",STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK:"Cannot remove tutorial task from To-Do List",STATUSMSG_REMOVED_TASK:"Removed {val} from To-Do List",TODO_ADD_PIN:"Add this to your pinned To-Do List",TODO_READY:"Ready!",TODO_REMOVE_PIN:"Remove this from your pinned To-Do List",BTN_SKIP_ALL:"Skip All",BTN_SKIP_STEP:"Skip Step",DLG_SKIP_TUTORIAL_MSG_ALREADY_KNOW:"Already know what you are doing? Great!",DLG_SKIP_TUTORIAL_MSG_OPTIONS:"Do you want to skip just this step or the entire tutorial?",DLG_SKIP_TUTORIAL_TITLE:"Skip Tutorial",LBL_COMPLETED:"Completed",TLTP_SHOW_TUTORIAL:"Show tutorial",TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_1:"You now have all you need to build your first Aetherbench!",TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_GENERIC:"Most things are Built directly in the world from raw resources. Let's open the Menu and get started!",TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_KEYBOARD:"Most things are Built directly in the world from raw resources, by using the {build_menu}. Let's open it and get started!",TUTORIAL_AETHERBENCH_BUILD_TAB_MSG:'Use the top tab to select the "Build Menu", where new items can be built.',TUTORIAL_AETHERBENCH_BUILD_TITLE:"Build an Aetherbench!",TUTORIAL_AETHERBENCH_MATERIALS_MSG_1:"To start crafting in this world, you're going to need an Aetherbench!",TUTORIAL_AETHERBENCH_MATERIALS_MSG_2:"First, gather at least {wood, plural, one{# wood} other{# wood}} and {stone, plural, one{# stone} other{# stone}}.",TUTORIAL_AETHERBENCH_MATERIALS_TITLE:"Get Aetherbench Materials!",TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_GENERIC:"Lastly, while holding the Aetherbench, tap wherever you would like to build it in your world!",TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_KEYBOARD:"Lastly, while holding the Aetherbench, click wherever you would like to build it in your world!",TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_NOTE:"Note: Industry like Aetherbenches can only be used if built within Settlements.",TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_GENERIC:"Double tap the Aetherbench icon to select it and close the {build_menu}!",TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_KEYBOARD:"Double click or right click the Aetherbench icon to select it and close the {build_menu}!",TUTORIAL_AETHERBENCH_SELECT_PROP_TITLE:"Select Aetherbench!",TUTORIAL_AETHERBENCH_SETTLEMENT_TAB_MSG:'Use the side tab to select the "Settlement" category, where the Aetherbench schematic is found.',TUTORIAL_COMPLETE_MSG:"Now that you know the basics, craft better tools, keep upgrading your Settlement, and have fun exploring!",TUTORIAL_COMPLETE_MSG_NEXT_STEPS:"To find new crops, explore far and wide. To find new ores, dig deep.",TUTORIAL_COMPLETE_TITLE:"Tutorial Complete",TUTORIAL_CORD_CRAFT_MSG_1:"Great! You now have all you need to craft a single piece of cord!",TUTORIAL_CORD_CRAFT_MSG_2:"Start crafting some cord by selecting your Aetherbench and depositing the resources.",TUTORIAL_CORD_CRAFT_TITLE:"Craft Cord!",TUTORIAL_CORD_MATERIALS_MSG_1:"To craft better tools, and to upgrade your Settlement further, you're going to need some cord!",TUTORIAL_CORD_MATERIALS_MSG_2:"First, gather the required resources. Try picking some flowers to get some Plant Fiber.",TUTORIAL_CORD_MATERIALS_TITLE:"Gather Cord Materials!",TUTORIAL_CORD_PUT_MSG:"Start cord crafting by depositing the resources in the ingredient slots.",TUTORIAL_CORD_TAKE_MSG:"When crafting has completed, take your newly created cord from the Aetherbench.",TUTORIAL_GO_TO_AETHERBENCH_TITLE:"Go to an Aetherbench!",TUTORIAL_GO_TO_SETTLEMENT_TITLE:"Return to Settlement!",TUTORIAL_HINT_TITLE:"Tutorial Hint",TUTORIAL_INVITE_FRIENDS_MSG:"Invite your friends to play live in this world!",TUTORIAL_INVITE_FRIENDS_TITLE:"Play with Friends!",TUTORIAL_LOST_FRONTIER_MSG:"You've been sent through an ancient Waygate and arrived in a new world, but the Waygate requires resources to be restored.",TUTORIAL_LOST_FRONTIER_MSG_NO_ACCESS:"You do not have access to this Settlement, you will need to find another Settlement or build your own to get started.",TUTORIAL_LOST_FRONTIER_MSG_NO_SETTLEMENT:"You are not currently near a Settlement, you will need to find one or build your own to get started.",TUTORIAL_LOST_FRONTIER_MSG_SELECT:"Select the Waygate where you started to check out your Settlement and scope out what is needed.",TUTORIAL_LOST_FRONTIER_MSG_SET_HOME:'This Settlement welcomes new builders, find the Waygate near the center and select "{button}" to get started.',TUTORIAL_LOST_FRONTIER_TITLE:"Welcome to the Lost Frontier!",TUTORIAL_OPEN_BUILD_MENU_TITLE:"Open Build Menu!",TUTORIAL_OPEN_MENU_TITLE:"Open Menu!",TUTORIAL_OPEN_SETTLEMENT_TAB_TITLE:"Open Settlement Tab!",TUTORIAL_PICKAX_CRAFT_MSG:"Now, start crafting a Pickax by clicking on your Aetherbench, choosing the Pickax recipe, and then depositing the resources.",TUTORIAL_PICKAX_CRAFT_MSG_HINT:"Hint: Equipped tools like Pickaxes and Shovels are used automatically when gathering the related resource.",TUTORIAL_PICKAX_CRAFT_TITLE:"Craft Pickax!",TUTORIAL_PICKAX_MATERIALS_MSG_1:"You now have all of the industry required to create better tools! Let's make a new Pickax first.",TUTORIAL_PICKAX_MATERIALS_MSG_2:"First, craft the required components.",TUTORIAL_PICKAX_MATERIALS_MSG_HINT:'Hint: When viewing recipes, you can use the "pin" button to add anything to the To-Do list below.',TUTORIAL_PICKAX_MATERIALS_TITLE:"Gather Pickax Materials!",TUTORIAL_PUT_RESOURCES_TITLE:"Put Resources!",TUTORIAL_SHARE_URL_MSG:"Having fun building? Share your world with friends simply by sending them the URL!",TUTORIAL_STONECUTTERY_BUILD_MSG:"Now that you have everything you need, open up the {build_menu} and build your first Stonecuttery! You can find it under the Settlement tab next to the Aetherbench.",TUTORIAL_STONECUTTERY_BUILD_TITLE:"Build a Stonecuttery!",TUTORIAL_STONECUTTERY_MATERIALS_MSG_1:"Shaping stone into useful items requires a Stonecuttery.",TUTORIAL_STONECUTTERY_MATERIALS_MSG_2:"First, craft at least {cord, plural, one{# more Cord} other{# more Cord}} and gather at least {stone, plural, one{# stone} other{# stone}}.",TUTORIAL_STONECUTTERY_MATERIALS_TITLE:"Get Stonecuttery Materials!",TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_GENERIC:"Lastly, while holding the Stonecuttery, tap wherever you would like to build it in your world!",TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_KEYBOARD:"Lastly, while holding the Stonecuttery, click wherever you would like to build it in your world!",TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE:"Note: Industry like Stonecutteries can only be used if built within Settlements.",TUTORIAL_STONETOOLHEAD_CRAFT_MSG:"Start crafting a tool head by clicking on your Stonecuttery and depositing the resources.",TUTORIAL_STONETOOLHEAD_CRAFT_MSG_NOTE:"Note: Crafting continues even while unattended! You can use this time to check on your Settlement or gather more resources.",TUTORIAL_STONETOOLHEAD_CRAFT_TITLE:"Craft Stone Tool Head!",TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_1:"To craft better tools, and to upgrade your Settlement further, you're going to need some Stone Tool Heads!",TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_2:"First, gather the required resources.",TUTORIAL_STONETOOLHEAD_MATERIALS_TITLE:"Gather Tool Head Materials!",TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_GENERIC:"Drag or double tap the required items in your inventory below to deposit them, unlocking your first Upgrade",TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_KEYBOARD:"Drag or double click the required items in your inventory below to deposit them, unlocking your first Upgrade",TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_MSG:"To upgrade your Settlement, gather the required resources.",TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_TITLE:"Gather Raw Resources!",TUTORIAL_UPGRADE_SETTLEMENT_MSG:"Great! Now, return to your Waygate and upgrade your Settlement by depositing these resources.",TUTORIAL_UPGRADE_SETTLEMENT_MSG_HINT:"If you cannot find your home, try getting up someplace high to look around, or use the fast travel option in the World Info tab in the menu. Be aware that if you travel via Waygate twice in an hour you will suffer from Waygate Sickness.",TUTORIAL_UPGRADE_SETTLEMENT_SECOND_MSG:"Great! Now, return with your newly crafted Tool Head and upgrade your Settlement by depositing the required resources.",TUTORIAL_UPGRADE_SETTLEMENT_TITLE:"Upgrade your Settlement!",TUTORIAL_WOODCUTTERY_BUILD_MSG:"Now that you have everything you need, open up the {build_menu} and build a brand new Woodcuttery! You can find it under the Settlement tab alongside the other Industry props.",TUTORIAL_WOODCUTTERY_BUILD_TITLE:"Build an Woodcuttery!",TUTORIAL_WOODCUTTERY_MATERIALS_MSG_1:"The last thing you'll need to craft better tools is a wood rod for a haft. Wood Rods are made by a Woodcuttery.",TUTORIAL_WOODCUTTERY_MATERIALS_MSG_2:"First, craft at least {heads, plural, one{# more Tool Head} other{# more Tool Heads}} and gather at least {wood, plural, one{# wood} other{# wood}}.",TUTORIAL_WOODCUTTERY_MATERIALS_TITLE:"Get Woodcuttery Materials!",TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_GENERIC:"Lastly, while holding the Woodcuttery, tap wherever you would like to build it in your world!",TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_KEYBOARD:"Lastly, while holding the Woodcuttery, click wherever you would like to build it in your world!",TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE:"Note: Industry like Woodcutteries can only be used if built within Settlements.",STATUSMSG_UNKNOWN_USERATTRIB:'Removed unknown {val} "{val_2}"',DLG_ERR_MODIFYING_USER_TITLE:"Error modifying user",BTN_ACCOUNT_OPTIONS:"User Options",LBL_ACCOUNT_OPTIONS:"User Options",BTN_ADD_FRIEND:"Add friend",BTN_ADD_FRIEND_SHORT:"Add",BTN_BLOCK_USER:"Block user",BTN_BLOCK_USER_SHORT:"Block",BTN_KICK_FROM_WORLD:"Kick",BTN_REMOVE_FRIEND:"Remove friend",BTN_REMOVE_FRIEND_SHORT:"Remove",BTN_UNBLOCK_USER:"Unblock user",BTN_UNBLOCK_USER_SHORT:"Unblock",BTN_VIEW_PROFILE:"View Profile",BTN_VIEW_PROFILE_SHORT:"Profile",BTN_MY_PROFILE:"My Profile",BTN_VIEW_EDIT_PROFILE:"View/Edit Profile",FRIENDLIST_FB_FRIEND:"This user is your Facebook friend.",FRIENDLIST_USER_IS_ADDED:"This user is on your friends list.",FRIENDLIST_USER_ADDED_ME:"You are on this user's friends list.  They can see only your public information unless you add them as a mutual friend.",FRIENDLIST_MUTUAL:"You and this user are mutual friends.",FRIENDLIST_USER_BLOCKED:"This user is blocked and will not see even your public information.",LBL_ADMIN_ACTIONS:"Admin Actions",LBL_AREA_ADMIN_ACTIONS:"Area Admin Actions",LBL_BUILDER_QUEUE_ACTIVE:"Active",LBL_BUILDER_QUEUE_STATUS:"Builder Queue Status",LBL_BUILDER_QUEUE_UNQUEUED:"Unqueued (must manually join)",LBL_BUILDER_QUEUE_QUEUED:"Queued (#{index})",LBL_CHANGE_ACCESS:"Change Access",LBL_CURRENT_ACCESS:"Current Access",LBL_DEFAULT:"Default",LBL_JOINED:"Joined {time} ago",LBL_BOOST_SINCE:"World Boosting since {date}",LBL_BOOST_STREAK_LENGTH:"Boost streak of {days, plural, one{# day} other{# days}}",TLTP_ACCOUNT_CREATED:"Account created on {date}",LBL_LAST_ONLINE:"Last online {time} ago",TLTP_LAST_ONLINE:"Last online on {date}",PRESENCE_ALSO_IDLE:"{val} (Idle)",PRESENCE_BUILDING:"Building",PRESENCE_IN_MENUS:"In menus",PRESENCE_LOST_FRONTIER:"Lost Frontier",PRESENCE_OFFLINE:"Offline",PRESENCE_UNKNOWN:"Unknown",PRESENCE_VIEWING:"Viewing",TLTP_ALIASES:"This user has also played as: {list}",TLTP_BUILDER_QUEUE_DEMOTE:"Demote to waiting",TLTP_BUILDER_QUEUE_KICK:"Remove from Builder Queue",TLTP_BUILDER_QUEUE_LEAVE:"Leave Builder Queue",TLTP_BUILDER_QUEUE_PROMOTE:"Promote to active",TLTP_BUILDER_QUEUE_QUEUE:"Add to queue",USERINFO_LOADING:"Loading data...",USERINFO_MY_FRIEND_FB:'My friend "{val}" on Facebook',USERINFO_MY_CHANNEL_MEMBER_DISCORD:'Channel member "{name}" on Discord',USERINFO_NOT_ALLOWED_TO_CHANGE_ACCESS:"You are not allowed to change Area access for this user",USERINFO_THIS_ME:"This is me!",USERINFO_USER_BLOCKED:"This user is blocked and will not see even your public information.",USERINFO_WORLDSTEAM:"This is an official account of a Worlds FRVR Team member!",USERTITLE:"{name} | User",USERTITLE_ERROR:"User (Error)",USERTITLE_LOADING:"User (Loading...)",LBL_USER_ME:"{name}[c=label] (me)[/c]",LBL_WORLDS_PUBLIC:"Public Worlds",LBL_WORLDS_CONTEST:"Contest Submissions",LBL_WORLDS_PRIVATE:"Private Worlds",LBL_WORLDS_PRIVATE_HINT:"(only shown to you because you have access)",LBL_USER_NO_WORLDS:"User has no listed public worlds",LBL_PHOTO_SHOWCASE:"Photo Showcase",LBL_PHOTO_SHOWCASE_HINT:'Take a photo and click "Add to Showcase" to showcase the photo here.',BTN_PHOTO_SHOWCASE_EXPAND:"+{num} Showcase slots",LBL_EXTRA_PHOTO_SHOWCASE:"Expanded Photo Showcase",TLTP_USER_ID:"This ID uniquely identifies your account and can be shared with others to allow them to grant access to their worlds, or used in support requests.\n\nClick any User ID to copy to clipboard.\n\nThis cannot be changed.",TLTP_DISPLAY_NAME:"The name other people see you as.\n\nThis can be changed once every 24 hours.",LBL_CATEGORY_PRIVACY:"Privacy",LBL_FRIENDS_ONLY:"Friends Only",LBL_ANYONE:"Anyone",LBL_PRIVACY_PRESENCE:"See rich presence",TLTP_PRIVACY_PRESENCE:"Controls who can see your rich presence - your online status, if you're in a world, and when you were last online.\n\nIf set to Friends Only, only those users you have added as friends will be able to see your status.\n\nNote: Setting your Status to Invisible in the Social menu always overrides this so that no one can see your presence.",LBL_PRIVACY_WORLDS:"See public worlds",TLTP_PRIVACY_WORLDS:"Controls who can see your Public, Listed worlds on your profile.\n\nIf set to Friends Only, only those users you have added as friends will be able to see your Public, Listed worlds on your profile.\n\nNotes: Unlisted worlds are never shown on your profile.  Anyone can always find your Public Listed worlds by searching the world list.  You can set individual worlds to Unlisted or Private for additional control.",LBL_PRIVACY_PHOTOS:"See Photo Showcase",TLTP_PRIVACY_PHOTOS:"Controls who can see your Photo Showcase on your profile.\n\nIf set to Friends Only, only those users you have added as friends will be able to see your Photo Showcase on your profile.\n\nNote: Sharing a link to a photo allows anyone with the link to view it.",LBL_HEADSHOT_ANGLE:"Headshot angle",LBL_CATEGORY_STATS:"Statistics",LBL_STAT_PLAY_TIME:"Play time",TLTP_STAT_PLAY_TIME:"Total non-idle time spent in a world",LBL_STAT_PLACED:"Blocks and props placed",TLTP_STAT_PLACED:"Total number of blocks, props, and liquids placed by you in any world",LBL_STAT_BROKEN:"Blocks and props broken",TLTP_STAT_BROKEN:"Total number of blocks and props broken, and liquids drained by you in any world",LBL_STAT_CURRENCY_BALANCE:"Currency Balance",TLTP_STAT_CURRENCY_BALANCE:"Current balance of any currency available for spending",LBL_STAT_CURRENCY_SPENT:"Currency Spent",TLTP_STAT_CURRENCY_SPENT:"Total amount of each currency spent",LBL_CATEGORY_BOOSTS:"Boosts",LBL_BOOST_STREAK:"Boost Streak",TLTP_BOOST_STREAK:"How many days in a row you have been Boosting worlds.  When an active Boost expires, you have {days} days to start a new Boost before losing your streak.",LBL_BOOST_STREAK_NONE:"None",LBL_BOOST_STREAK_ENDED:"Inactive - ended on {date}",LBL_BOOST_STREAK_ACTIVE:"{days, plural, one{# day} other{# days}} - ending on {date}",LBL_BOOST_STREAK_ENDED_GRACE:"{days, plural, one{# day} other{# days}} - ended, resume by {date}",LBL_BOOST_LIST_EMPTY:"If you Boost a world, you can view and manage your active Boosts here.",LBL_BOOST_HEADER_ACTIVE:"Active Boosts",TLTP_BOOST_HEADER_ACTIVE:"Active Boosts can be freely cancelled after an initial cooldown of 5 days.  Cancelling before that period will leave the boost active until the end of the current day or the cooldown period, whichever is later.",LBL_BOOST_HEADER_CANCELLED:"Cancelled Boosts",TLTP_BOOST_HEADER_CANCELLED:"Cancelled Boosts have already had their remaining time refunded, and are still effectively active until the end of the period that was paid for.\n\nBoosts are cancelled if you cancelled it yourself or automatically if you lost access to the world (due do it being deleted, made private, etc).",LBL_BOOST_HEADER_EXPIRED:"Expired Boosts",LBL_BOOST_EXPIRED_DATE:"Expired on {date}",LBL_BOOSTED_UNTIL_DATE:"Boosted until {date}",LBL_BOOST_DAYS_REMAINING:"({days, plural, one{# day} other{# days}} remaining)",LBL_BOOST_COOLDOWN:"On cooldown for {days, plural, one{# day} other{# days}}",LBL_THANKS_FOR_BOOSTING:"Thanks for Boosting!",DLG_BOOST_CANCEL_TITLE:"Confirm Cancel Boost",DLG_BOOST_CANCEL_TEXT_ACTIVE:"This Boost has {days, plural, one{# day} other{# days}} remaining, so you will receive {tokens, plural, one{# Boost Token} other{# Boost Tokens}} if you cancel now.",DLG_BOOST_CANCEL_TEXT_COOLDOWN:"This Boost has {days, plural, one{# day} other{# days}} remaining, however it is still on cooldown so you will only receive {tokens, plural, one{# Boost Token} other{# Boost Tokens}} if you cancel now.",DLG_BOOST_CANCEL_TEXT_FINAL:"Really cancel this Boost?",STATUSMSG_BOOST_CANCELLED:"Boost cancelled, refunded {tokens, plural, one{# Boost Token} other{# Boost Tokens}}",DLG_BAN_BOOSTER_TITLE:"Ban a Booster?!",DLG_BAN_BOOSTER_MSG_1:"If you ban a Booster, their Boost will be cancelled, your world will lose the Boost and all related benefits immediately, and you will receive no bonus Orbs from the Boost, even if the user is un-banned later.  It's also just a rude thing to do to someone who paid to support your world.",DLG_BAN_BOOSTER_MSG_2:"Are you sure you wish to ban this Booster?",DLG_PRIVATE_BOOSTER_TITLE:"Ban a Booster?!",DLG_PRIVATE_BOOSTER_MSG_1:"Setting this world to Private will essentially ban all players without non-default access assigned.  The following Boosters will be banned from this world:",DLG_PRIVATE_BOOSTER_MSG_2:"If you wish to keep your world Boosted, assign each of these users explicit access before changing the world to Private.",DLG_PRIVATE_BOOSTER_MSG_3:"Are you sure you wish make this world private and ban {count, plural, one{this Booster} other{these Boosters}}?",DLG_RESET_EMAIL_FAILED_MSG:"Error sending password reset email: {err}",DLG_RESET_EMAIL_SUCCESS_TITLE:"Password reset email sent",DLG_RESET_EMAIL_SUCCESS_MSG:"A password reset link was emailed to the email associated with this account ({email}), you will receive it in the next few minutes. Please, also check your SPAM folder.",BTN_CONFIRM_EMAIL:"Confirm email",LBL_ACCOUNT_STATUS:"FRVR Account status",TLTP_ACCOUNT_STATUS:"An FRVR Account must have a verified email before being able to make purchases.",LBL_ACCOUNT_STATUS_CHECKING:"Checking...",LBL_ACCOUNT_STATUS_UNVERIFIED:"Unverified",LBL_ACCOUNT_STATUS_VERIFIED:"Verified",STATUSMSG_PARTY_YOU_ARE_NEW_HOST:"You are the new Party Host.",STATUSMSG_PARTY_USER_IS_NEW_HOST:"{name} is the new Party Host.",STATUSMSG_PARTY_HOST_JOINED_WORLD:"The host has joined a world!",STATUSMSG_ORPHANED_TILEPROP:"Encountered orphaned {val}, cleaning up...",STATUSMSG_PROP_WOUT_TILEPROP:"Encountered prop without {val}, cleaning up...",BTN_ADD_NEW_TARGET:"Add new target",BTN_ASSIGN_WGID:"Assign Waygate ID",BTN_CHANGE:"Change",BTN_DESTROY_SETTLEMENT:"Destroy Settlement",LBL_USABLE_BY_PUBLIC:"Usable By: Everyone",LBL_USABLE_BY_BOOSTERS:"Usable By: Boosters",LBL_USABLE_BY_BUILDERS:"Usable By: Builders",BTN_ESTABLISH_SETTLEMENT:"Establish new Settlement",BTN_MOVE_SETTLEMENT:"Move my Settlement here",BTN_NOT_AVAILABLE:"Not available",BTN_REMOVE_WGID:"Remove Waygate ID",BTN_SET:"Set",BTN_SET_DEFAULT_SETTLE_WG:"Set as Default Settlement / Waygate",BTN_SET_DEFAULT_WG:"Set as Default Waygate",DLG_ASSIGN_WGID_ALREADY_MSG_CONFIRM:'The Waygate ID "{val}" is already in use by another Waygate, do you really wish to reassign this Waygate ID to THIS Waygate?',DLG_ASSIGN_WGID_ALREADY_MSG_LINKS:"Note: Any links to the specified Waygate ID would now go to this Waygate.",DLG_ASSIGN_WGID_DEF_MSG_CONFIRM:"Changing the Default Waygate will cause all new visitors to arrive at this Waygate (unless they follow a link to another, specific, Waygate). Do you really wish to change the Default Waygate?",DLG_ASSIGN_WGID_DEF_MSG_SCREENSHOT:"Note: Setting this Waygate as the Default Waygate will allow you to configure a default screenshot for all links to this world.",DLG_ASSIGN_WGID_TITLE:"Assign Waygate ID",DLG_DESTROY_SETTLEMENT_MSG_CONFIRM:"This cannot be undone. Are you sure you wish to destroy this Settlement?",DLG_DESTROY_SETTLEMENT_MSG_WARNING:"Destroying a Settlement will lose all unlocks and upgrades. Players who have this Settlement as their Home, including yourself, will have the default Settlement as Home instead.",DLG_DESTROY_SETTLEMENT_TITLE:"Destroy Settlement?",DLG_ERROR_ASSIGNING_WG_TITLE:"Error assigning Waygate ID",DLG_ERROR_DESTROYING_SETTLEMENT_TITLE:"Error destroying Settlement",DLG_ERROR_EDITING_WG_TITLE:"Error editing Waygate",DLG_ERROR_ESTABLISHING_SETTLEMENT:"Error establishing Settlement",DLG_ERROR_MOVING_SETTLEMENT:"Error moving Settlement",DLG_ERROR_REMOVING_WGID_TITLE:"Error removing Waygate ID",DLG_ERROR_RENAMING_WG_TITLE:"Error renaming Waygate",DLG_ERROR_SETTING_WG_IMG_TITLE:"Error setting Waygate image",DLG_ESTABLISH_SETTLEMENT_MSG_CONFIRM:"Are you sure you wish to continue?",DLG_ESTABLISH_SETTLEMENT_MSG_HOME:"After establishing a new Settlement, this will be your Home, and you will be unable to 'gate to your previous Settlement without visiting it in-world first.",DLG_ESTABLISH_SETTLEMENT_TITLE:"Establish a new Settlement?",DLG_INVALID_LINK_ID_MSG:"This does not appear to be a valid link nor ID",DLG_LINKABLE_WGID_MSG:"Enter an identifier for this Waygate.  Waygate IDs may be up to 16 characters long and may contain only lowercase letters (a-z), numbers (0-9), and underscores (_).  They must be unique within this world.",DLG_LINKABLE_WGID_TITLE:"Assign Linkable Waygate ID",DLG_MOVE_SETTLEMENT_MSG_CONFIRM:"Are you sure you wish to continue? If playing with other players, please consult the rest of your team before moving a Settlement.",DLG_MOVE_SETTLEMENT_MSG_WARNING:"Moving a Settlement may leave some crafting stations outside of any Settlement and therefore non-functional. Settlements can only be moved once per day.",DLG_MOVE_SETTLEMENT_TITLE:"Move existing Settlement?",DLG_REMOVE_WGID_MSG:"Removing the Waygate ID will cause any links to this Waygate to target the Default Waygate for this world instead. If you reassign this Waygate ID to a different Waygate, then those links will target the new Waygate. Are you sure you wish to remove this Waygate ID?",DLG_REMOVE_WGID_TITLE:"Remove Waygate ID",DLG_WAYGATE_TARGET_WORLD_MSG:"Enter a World ID, a link, or click Current to select the active world",BTN_CURRENT:"Current",DLG_WAYGATE_TARGET_USER_MSG:"Enter a User ID, a link, or click Self to select yourself",BTN_SELF:"Self",DLG_WAYGATE_TARGET_PHOTO_MSG:'Paste a photo link.  You can get a link to a photo with the "Get Link" button on any photo.',DLG_WAYGATE_TARGET_BLUEPRINT_MSG:'Paste a Blueprint link.  You can get a link to a blueprint with the "Get Link" button on any of your shared blueprints.',DLG_WAYGATE_TARGET_TITLE:"Waygate Target",DLG_WG_NAME_MSG:"Enter a name for this Waygate",DLG_WG_NAME_TITLE:"Waygate Name",ERR_INVALID_WGID:"Invalid Waygate ID",ERR_WAYGATE_DISAPPEARED:"Waygate disappeared, cannot apply change",LBL_DEFAULT_WAYGATE:"Default Waygate",LBL_ENERGY_WELL_STATUS:"Energy Well Status",LBL_ENTRYWAY:"Entryway",LBL_ENTRYWAY_SETTLEMENT:"Settlement / Entryway",LBL_EXITWAY_TARGETS:"Exitway Targets",LBL_EXITWAY_RANDOM:"Target Choice: Random",LBL_EXITWAY_USER:"Target Choice: User",LBL_EXITWAY_AUTOMATIC:"Target Choice: Automatic",LBL_LISTED:"Social Visibility",LBL_MINE:"Mine",LBL_NAMED_SETTLEMENT:"Settlement: {val}",LBL_OTHER_WORLD:"Other World",LBL_OTHER_WORLD_LINK:"Other World or Link",LBL_TARGET_USER:"User",LBL_TARGET_PHOTO:"Photo",LBL_TARGET_BLUEPRINT:"Blueprint",LBL_RECENT:"Recent",LBL_SCREENSHOT:"Screenshot",LBL_SETTLEMENT_MNG:"Settlement Management",LBL_SHOW_WORLD_INFO:"Show World Info",LBL_THIS_WORLD:"This World",LBL_UNKNOWN_MENU:"Unknown menu",LBL_WAYGATE_ID:"Waygate ID",LBL_WAYGATE_TARGETS:"Waygate Targets",LBL_WG_AND_SETTLEMENT_MNG:"Waygate and Settlement Management",LBL_WG_CONFIGURATION:"Waygate Configuration",LBL_WG_TIME_DEFAULT:"Delay time: Default ({val}s)",LBL_WG_TIME_FAST:"Delay time: Fast ({val}s)",LBL_WG_TIME_INSTANT:"Delay time: Instant",STATUSMSG_DRINKING_WELL:"Drinking from Energy Well ({val}s)...",STATUSMSG_EXITING:"Exiting to Main Menu ({seconds}s)...",STATUSMSG_EXITWAY_INACCESSIBLE:"This **Exitway** is inaccessible to you",STATUSMSG_EXITWAY_INACCESSIBLE_BOOST:"This **Exitway** is only usable by [img=booster]Boosters",STATUSMSG_WAYGATING_CHOICES:"Waygating (with choices) ({seconds}s)...",STATUSMSG_WAYGATING_RANDOMLY:"Randomly Waygating ({seconds}s)...",STATUSMSG_WAYGATING_TO:"Waygating to {label} ({seconds}s)...",STATUSMSG_OPENING:"Opening {label} ({seconds}s)...",STATUSMSG_WELL_RECHARGING:"Energy Well still recharging ({val}s)",STATUSMSG_WG_IMG_SAVED:"Waygate Image Saved.",WGLINK_FROZEN:"Frozen",WGLINK_FULL:"Full",WGLINK_LOADING:"Loading...",WGLINK_NOT_FOUND:"Waygate not found",WGTARGET_EXITWAY_LOADING:"(loading...)",WGTARGET_INVALID_WORLD_ID:"Invalid World ID: {val}",WGUI_DEFAULT_WG_CANNOT_EXITWAY:"The Default Waygate cannot function as an Exitway.",WGUI_ENERGY_WELL_REMOTE_SUBTITLE:"Visit to replenish {val}",WGUI_ENERGY_WELL_SUBTITLE:"Replenish {val} here",WGUI_ENTRYWAY_REQUIREMENT:"This Waygate requires an ID in order to be an Entryway",WGUI_NO_EDIT_ACCESS:"You do not have Edit Waygates access.",WGUI_ENTRYWAY_LIMITED_LF:"Note: Entryways in Lost Frontier worlds are only useful for Spectators and Visitors.",WGUI_ENTRYWAY_LIMITED_UNL:"Note: Entryways in Settlement-enabled, non-Free Pos worlds are only useful for Spectators and Visitors.",WGUI_EXITWAY_LIMITED_LF:"Note: Exitways in Lost Frontier worlds are only useful for targeting OTHER worlds.",WGUI_EXITWAY_LIMITED_UNL:"Note: Exitways in Settlement-enabled, non-Free Pos worlds are only useful for targeting OTHER worlds.",WGUI_LISTED_WG_LINKED:"Listed Waygates can be linked to by anyone, by URL or another Waygate, and are shown on the World Info screen.",WGUI_MUST_VISIT_EDIT_EXITWAY:"You must visit the Waygate in-world to edit Exitway Targets",WGUI_NEW_WAYGATE:"New Waygate",WGUI_REMOVE_WG_TARGET:"Remove Waygate Target",WGUI_SETTLEMENT_MNG_SUBTITLE:"Deposit resources in the Waygate to expand and enhance",WGUI_SETTLEMENT_OVERLAP:"Too close to other Settlements to establish a new Settlement.",WGUI_SETTLEMENT_OVERLAP_NO_MOVE:"Too close to other Settlements to establish or move a Settlement.",WGUI_SETTLE_CANNOT_EXITWAY:"A Settlement Waygate cannot function as an Exitway.",WGUI_THIS_IS_DEFAULT_WG:"This is the Default Waygate. To remove it, first set a different Waygate as Default.",WGUI_UNKNOWN_WAYGATE:"Unknown Waygate {val}",WGUI_UNLIMITED_HINT_1:"Hint: People entering your world will face the opposite",WGUI_UNLIMITED_HINT_2:"direction from you when you place the Waygate!",WGUI_WG_ADVENTURE_HINT_1:"Hint: You can build a new Waygate and move your",WGUI_WG_ADVENTURE_HINT_2:"Settlement's power there up to once a day!",WGUI_WG_IN_WORLD:"{val} in {val_2}",WGUI_WG_IS_SETTLEMENT:"This Waygate defines a Settlement and the Settlement's benefits.",LBL_LEAPGATE_TITLE:"Leapgate",LBL_LEAPGATE_MODELESS:"Leapgate {name}",LBL_LEAPGATE_SOURCE:"Source Leapgate {name}",LBL_LEAPGATE_TARGET:"Target Leapgate {name}",LBL_LEAPGATE_COMPLETE:"Linked Leapgate {name}",LBL_LEAPGATE_MODELESS_HINT_1:"This Leapgate must be set as a Source Leapgate or a Target Leapgate.",LBL_LEAPGATE_MODELESS_HINT_2:"You extract Leapgate Shards from a Source Leapgate, and deposit them at a Target Leapgate, linking them together for instant travel.",LBL_LEAPGATE_SOURCE_HINT_1:"Extract Leapgate Shards and take them to a Target Leapgate for deposit.",LBL_LEAPGATE_SOURCE_HINT_1_UNLIMITED:"Extract a Leapgate Shard and take it to a Target Leapgate for deposit.",LBL_LEAPGATE_TARGET_HINT_1:"Deposit {remaining, plural, one{a Leapgate Shard} other{# Leapgate Shards}} from a Source Leapgate to link it with this Leapgate.",LBL_LEAPGATE_TARGET_HINT_1_PROGRESS:"Deposit {remaining, plural, one{# more Leapgate Shard} other{# more Leapgate Shards}} from Source Leapgate {name} to link it with this Leapgate.",LBL_LEAPGATE_ACCESS_WARNING:"Warning: This Leapgate is not in a protected Area, so any other Builders can break this Leapgate at any time!  It is highly recommended that you create a protected Area via an Area Access Control or establish a new Settlement here to restrict access.",BTN_LEAPGATE_LEAP:"Leap!",BTN_LEAPGATE_RESET:"Reset Leapgate",BTN_LEAPGATE_SOURCE:"Set Source Leapgate",BTN_LEAPGATE_TARGET:"Set Target Leapgate",BTN_LEAPGATE_EXTRACT:"Extract a Leapgate Shard",STATUSMSG_LEAPGATE_TO:"Leaping ({seconds}s)...",STATUSMSG_LEAPGATE_INACCESSIBLE:"This **Leapgate** is inaccessible to you",STATUSMSG_LEAPGATE_INACCESSIBLE_BOOST:"This **Leapgate** is only usable by [img=booster]Boosters",CHATERROR_ACCESSING_WAYGATE:"Error accessing Waygate {val}: {val_2}",CHATERROR_ACCESS_REVOKED:"Access revoked",CHATERROR_GROUP_RACE_START:"Group Race Start Error",CHATERROR_RUNNING_COMMAND:"Error running /{val}: {val_2}",CHATUI_ADMIN_MSG:"[admin] {val}",DLG_JOINING_WORLD_FAILED_TITLE:"Joining World Failed",DLG_RACE_SAVE_ERROR_TITLE:"Race Save Error",DLG_WORLD_ACCESS_DENIED_MSG:"Access denied.  This world is not public and requires an access token, or for the owner to add your User ID ({val}).",DLG_WORLD_FULL_MSG:"World full.  This world is currently full, please try again later.",STATUSMSG_CANT_JOIN_NOT_CONNECTED:"Unable to join world: not connected to server",STATUSMSG_GEM_FOUND:"You found 1{val} Gem!",STATUSMSG_GROUP_RACE_CANCELLED:"The current Group Race was canceled!",STATUSMSG_GROUP_RACE_START:"A Group Race just started!",STATUSMSG_GROUP_RACE_START_SECONDS:"A Group Race will start in {val} seconds!",STATUSMSG_GROUP_RACE_WON_BY_OTHER:"{val} won the Group Race with a time of {val_2}!",STATUSMSG_GROUP_RACE_WON_BY_YOU:"You won the Group Race! Congratulations!",STATUSMSG_ORPHANED_PROP:"Encountered orphaned prop without TILE_PROP, cleaning up...",STATUSMSG_OUT_OF_SYNC:"World out of sync, resyncing...",STATUSMSG_RACE_ABANDON_ERROR:"Race Abandon Error: {val}",STATUSMSG_RACE_NO_MULTIPLE_CLIENTS:"Races cannot be started in worlds that allow multiple clients.",STATUSMSG_RACE_SINGLE_CLIENT_ENABLE:'Run "/world_single_client 1" to enable single client per user in this world.',STATUSMSG_RACE_START_ERROR:"Race Start Error: {val}",STATUSMSG_TRANSACTION_FAILED:"Transaction failed: {val}",BTN_GAMEPLAY_ALL_ON:"All Gameplay ON",TLTP_GAMEPLAY_ALL_ON:"Enables all possible gameplay-related features, making this world function similarly to a Lost Frontier world (but, without features such as Unlockable Props).",BTN_CONVERT_UNLIMITED:"Convert to an Unlimited world",BTN_DELETE_WORLD:"Delete",BTN_DONE_EDITING:"Done",BTN_EDIT_WG_INFORMATION:"Edit Waygate Information",BTN_EDIT_WORLD_SETTINGS:"Edit World Settings",BTN_EXIT_WORLD:"← Exit World",BTN_FORGET_WORLD:"Forget",BTN_IM_STUCK:"I'm stuck!",BTN_JOIN_WORLD:"Join",BTN_PLAYING_AS_SELF:"Playing as: Self",BTN_PLAYING_AS_VISITOR:"Playing as: Visitor",BTN_WORLD_RESET_INVENTORY:"Reset ALL Players' Inventories",BTN_SET_INVENTORY_TO_MINE:"Clone My Inventory to All Players",BTN_SETTLEMENT_INFO:"Settlement Info",BTN_WAYGATE_GO:"Go",DLG_BUILD_QUEUE_THRESHOLD_MSG:"Enter a new value. (min {min}, max {max})  Note: this is currently limited by the current world Boost level to {boost_max}.",DLG_CHAT_MINIMUM_ACCOUNT_AGE_MSG:"Enter a new value, in minutes. (min {min}, max {max})",DLG_DELETE_WORLD_MSG:"Are you sure you wish to delete {val} ({val_2})?",DLG_DELETE_WORLD_TITLE:"Delete World",DLG_ERR_LOST_CONNECTION_MSG:"Unable to process request: lost connection to world",DLG_ERR_LOST_CONNECTION_TITLE:"Lost connection",DLG_ERR_MODIFYING_WORLD_TITLE:"Error modifying world",DLG_FORGET_WORLD_MSG:"Are you sure you wish to remove {val} ({val_2}) from your recent list?",DLG_FORGET_WORLD_TITLE:"Forget World",DLG_NEW_VALUE_SECONDS_MSG:"Enter a new value, in seconds (between {min} and {max}), or enter 0 to disable.",DLG_WORLD_RESET_INVENTORY_MSG:"Are you sure you wish to reset the items in ALL players' inventories, including equipped items, and including your own inventory?",DLG_WORLD_RESET_INVENTORY_TITLE:"Reset Inventory",STATUSMSG_INVENTORY_RESET:"Player's inventory reset",TLTP_WORLD_RESET_INVENTORY:"Removes the items in ALL (online and offline) players' inventories, including equipped items, and including your own inventory.",DLG_WORLD_SET_INVENTORY_MSG:"This will give all (online or offline) players an inventory exactly matching yours, including equipped items.  Continue?",DLG_WORLD_SET_INVENTORY_MSG2:"Your current inventory: {list}",DLG_WORLD_SET_INVENTORY_TITLE:"Set All Inventories",TLTP_SET_INVENTORY_TO_MINE:"Gives all (online or offline) players an inventory exactly matching yours, including equipped items",DLG_CONVERT_UNLIMITED_MSG:"Unlimited worlds can NEVER be converted back to Lost Frontier worlds.  Some features are ONLY available in Lost Frontier worlds.  Are you sure you wish to convert this world to an Unlimited world?",DLG_CONVERT_UNLIMITED_TITLE:"Convert To Unlimited",DLG_WG_TRAVEL_NOT_ALLOWED_MSG:"You are currently waiting for a Group Race to begin. Traveling via Waygate will cancel your current Race. Are you sure you wish to continue?",DLG_WG_TRAVEL_NOT_ALLOWED_TITLE:"Waygate Travel Not Allowed",DLG_WG_TRAVEL_UNSAFE_MSG:"You have not yet recovered from your previous Waygate use. Traveling via Waygate again so soon will result in suffering temporary Waygate Sickness (reduced {val}).  Are you sure you wish to continue?",DLG_WG_TRAVEL_UNSAFE_TITLE:"Waygate Travel Currently Unsafe",DLG_WORLD_NAME_MSG:"Enter a new name for your world",FORMAT_NUMBER_MILLION:"{val}M",FORMAT_NUMBER_OF_MAX_BUILDERS:"{count} / {max} Builders",FORMAT_NUMBER_OF_BUILDERS:"{builders, plural, one{# Builder} other{# Builders}}",FORMAT_NUMBER_OF_BUILDERS_PREFORMAT:"{num, plural, one{{str} Builder} other{{str} Builders}}",FORMAT_NUMBER_OF_VIEWERS:"{viewers, plural, one{# Viewer} other{# Viewers}}",FORMAT_NUMBER_OF_PLAYERS:"{players, plural, one{# Player} other{# Players}}",FORMAT_NUMBER_THOUSAND:"{val}K",FORMAT_READY_WG_TIME:"({val})",FORMAT_ROLE_DISPLAY:"\\[{role}]{img}",LBL_ACCESS_ADMIN:"Admin",LBL_ACCESS_ADMINS:"Admins",LBL_ACCESS_ADMIN_LONG:"Admin (can grant access, etc)",LBL_ACCESS_AREABUILDER:"Area Builder",LBL_ACCESS_AREABUILDERS:"Area Builders",LBL_ACCESS_AREABUILDER_BOOSTER_PLURAL:"Area Builder Boosters[img=booster]",LBL_ACCESS_AREABUILDER_LONG:"Area Builder (designated Areas only)",LBL_ACCESS_BUILDER:"Builder",LBL_ACCESS_BUILDERS:"Builders",LBL_ACCESS_BUILDER_LONG:"Builder (can build)",LBL_ACCESS_BUILDER_BOOSTER_PLURAL:"Builder Boosters[img=booster]",LBL_ACCESS_DEFAULT:"Default",LBL_ACCESS_NONE:"None",LBL_ACCESS_NONE_BAN:"None (ban)",LBL_ACCESS_NONE_LONG:"No access",LBL_ACCESS_NONE_NOBODY:"Nobody",LBL_ACCESS_OWNER:"Owner",LBL_ACCESS_OWNER_CREATOR:"Creator",LBL_ACCESS_PRESET:"Access Preset",TLTP_ACCESS_PRESET:"General access preset setting the public/private state of the world and the default access for players in the world.\n\nIf set to anyone can Area build, other players will be unable to build until you place Access Areas in which they are allowed to build.",LBL_ACCESS_PRESET_AREA_BUILD:"Anyone can Area build",LBL_ACCESS_PRESET_BUILD_ANYWHERE:"Anyone can build anywhere",LBL_ACCESS_PRESET_PRIVATE:"Private",LBL_ACCESS_PRESET_PRIVATE_LONG:"This world is private",LBL_ACCESS_PRESET_SPECTATE:"Anyone can spectate",LBL_ACCESS_PRESET_VISIT:"Anyone can visit",LBL_ACCESS_READONLY:"Visitor",LBL_ACCESS_READONLY_LONG:"Visitor (has avatar)",LBL_ACCESS_READONLY_PLURAL:"Visitors",LBL_ACCESS_READONLY_BOOSTER_PLURAL:"Visitor Boosters[img=booster]",LBL_ACCESS_SPECTATOR:"Spectator",LBL_ACCESS_SPECTATOR_ANYONE:"Anyone",LBL_ACCESS_SPECTATOR_LONG:"Spectator (can view, but invisible)",LBL_ACCESS_SPECTATOR_BOOSTER_PLURAL:"Spectator Boosters[img=booster]",LBL_THIS_WORLD_UNLISTED:"This world is unlisted",TLTP_LISTED:"Listed public worlds appear in the world list, in search, and in social menus.  Anyone is able to join these worlds.\n\nUnlisted public worlds will never appear in-game, but anyone with the link (or World ID) can join.\n\nPrivate worlds never appear in search or the world list, and are only shown in social menus to users who have explicit access.",LBL_LISTED_PRIVATE:"Only to those with access",LBL_LISTED_LISTED:"Listed",LBL_LISTED_UNLISTED:"Unlisted",LBL_BUILD_QUEUE_AFK:"Builder Queue: idle timeout",TLTP_BUILD_QUEUE_AFK:"If enabled, after the specified amount of time, any idle builders will be forcibly replaced with players waiting in the queue.",LBL_BUILD_QUEUE_AUTOMATIC:"Builder Queue: joining",LBL_BUILD_QUEUE_AUTOMATIC_ON:"Automatic",LBL_BUILD_QUEUE_AUTOMATIC_OFF:"Manual",TLTP_BUILD_QUEUE_AUTOMATIC:'If set to "Manual", players will not automatically join the queue upon entering the world, but will need to manually activate the "Join" button to become a builder.',LBL_BUILD_QUEUE_AUTO_PROMOTE:"Builder Queue: auto-promote admins",TLTP_BUILD_QUEUE_AUTO_PROMOTE:'If set to "ON", when an admin or higher joins the world, they will be automatically promoted through the builder queue, possibly kicking someone else out of the queue.\n\nIf set to "OFF", an admin can still manually promote themselves as needed.',LBL_BUILD_QUEUE_CHAT:"Builder Queue: allow chat while waiting",TLTP_BUILD_QUEUE_CHAT:'Controls whether players waiting in the builder queue are allowed to chat or not.\n\nIf set to "OFF", only active builders will be able to chat.',LBL_BUILD_QUEUE_FORCE_UI:"Builder Queue: interface",LBL_BUILD_QUEUE_FORCE_UI_ON:"Always visible",LBL_BUILD_QUEUE_FORCE_UI_OFF:"Automatic",TLTP_BUILD_QUEUE_FORCE_UI:'Controls whether or not the builder queue interface (Join/Leave buttons) should be always visible.\n\nWhen "Automatic", the interface will only be visible for players who are not active builders (waiting in the queue, or have manually left the queue).',LBL_BUILD_QUEUE_SPECTATE:"Builder Queue: wait as",TLTP_BUILD_QUEUE_SPECTATE:'Controls what effective role players get while they are waiting in the queue.  If set to "Spectator", then the waiting players will have no avatar and will cause less distraction for the active builders.',LBL_BUILD_QUEUE_THRESHOLD:"Builder Queue: active builders",TLTP_BUILD_QUEUE_THRESHOLD:"Controls how many active builders are allowed at any time.  Any players who arrive beyond this will need to wait in the Builder Queue.",LBL_CATEGORY_GENERAL:"General",LBL_CATEGORY_ACCESS:"Access",LBL_CATEGORY_BUILDER_QUEUE:"Builder Queue",LBL_CATEGORY_GAMEPLAY:"Gameplay",LBL_CHAT:"Chat",TLTP_CHAT:"Controls the minimum role required to send chat messages in this world.",LBL_CHAT_MINIMUM_ACCOUNT_AGE:"Chat minimum account age",TLTP_CHAT_MINIMUM_ACCOUNT_AGE:"Controls how old (time since creation) an account must be to chat in this world.\n\nEnable this to help prevent banned users from creating brand new accounts and immediately rejoining the world.",LBL_CHAT_SLOW_MODE_COOLDOWN:"Chat slow mode cooldown",TLTP_CHAT_SLOW_MODE_COOLDOWN:"Sets the minimum time (in seconds) between chat messages from a single user.",LBL_CUSTOM_SETTING:"Custom ({val})",LBL_CUSTOM:"Custom",LBL_DISABLED:"Disabled",LBL_EDIT_WAYGATES:"Edit (non-Settlement) Waygates",TLTP_EDIT_WAYGATES:'Controls the minimum role required to edit (non-Settlement) Waygates.\n\nIf "Settlements" is enabled in Gameplay options below, anyone who establishes a Settlement is allowed to edit (but not publicly list) their Settlement\'s Waygate.',LBL_EDIT_LEAPGATES:"Edit Leapgates",TLTP_EDIT_LEAPGATES:"Controls the minimum role required to set up and link Leapgates.",LBL_FLYING:"Flying",TLTP_FLYING:"Controls the minimum role required to fly in this world.",LBL_WORLD_INFO_LOST_FRONTIER:"This is a Lost Frontier world, so all gameplay options are forced ON.  You may convert this world to Unlimited, however, some features (such as Unlockable Props) are only available in Lost Frontier worlds, and Unlimited worlds may NEVER be converted back.",LBL_MORE_ACCESS_OPTIONS:"More access options",LBL_OFF:"OFF",LBL_ON:"ON",LBL_PLACE_BLUEPRINTS:"Place Blueprints",TLTP_PLACE_BLUEPRINTS:"Controls the minimum role required to place Blueprints in this world.",LBL_PLACE_SAPLINGS:"Place Saplings",TLTP_PLACE_SAPLINGS:"Controls the minimum role required to place Saplings in this world.",LBL_SHOW_OTHER_PLAYERS:"Show other players",TLTP_SHOW_OTHER_PLAYERS:"Controls the distance at which other players are visible.",LBL_SHOW_PLAYER_NAMES:"Show player names",TLTP_SHOW_PLAYER_NAMES:"Controls whether or not player names are visible above their heads in-world.",TLTP_BOOST_NOTE:"Note: Some options only available to **Boosted** worlds.",LBL_LOADING_SPINNER:"Loading spinner graphic [img=boost1]",TLTP_LOADING_SPINNER:"Determines what graphics are seen any time someone is waiting at a loading screen to get into or move around this world.",MSG_LOADING_PREVIEW:"Previewing loading...",LBL_WORLD_INFO_BG:"World Info / Loading Background [img=boost1]",TLTP_WORLD_INFO_BG:"Determines what background image is used on the world info screen, as well as during loading screens.",LBL_CUSTOM_BLURRED:"Custom Blurred",MSG_WORLD_INFO_BG_PREVIEW:"Previewing background...",LBL_BOOSTER_ICON:"Booster Icon [img=boost1]",TLTP_BOOSTER_ICON:"Determines which icon is shown next to the names of Boosters in this world.",LBL_BOOSTER_ICON0:"[img=booster0]Default",LBL_BOOSTER_ICON1:"[img=booster1]Chevron",LBL_BOOSTER_ICON2:"[img=booster2]Star 1[img=boost2]",LBL_BOOSTER_ICON3:"[img=booster3]Star 2[img=boost2]",LBL_BOOSTER_ICON4:"[img=booster4]Star 3[img=boost2]",LBL_BOOSTER_ICON5:"[img=booster5]Star 4[img=boost2]",LBL_BOOSTER_ICON6:"[img=booster6]Up and Away[img=boost2]",LBL_TIME_AFTERNOON:"Afternoon",LBL_TIME_DAWN:"Dawn",LBL_TIME_DUSK:"Dusk",LBL_TIME_DYNAMIC:"Dynamic",LBL_TIME_DYNAMIC_10X:"Dynamic (10x)",LBL_TIME_DYNAMIC_50X:"Dynamic (50x)",LBL_TIME_MIDNIGHT:"Midnight",LBL_TIME_MORNING:"Morning",LBL_TIME_NOON:"Noon",LBL_TIME_SUNSET:"Sunset",LBL_TIME_OF_DAY:"Time of Day",TLTP_TIME_OF_DAY:"Sets the time of day, or rate at which time passes.\n\nIf set to greater than 1x, Saplings will grow faster.",LBL_WORLD_SKY:"Sky / Lighting",LBL_WORLD_SKY_SHORT:"Sky",TLTP_WORLD_SKY:"Adjusts the sky and lighting parameters.  Some skies completely replace the time of day lighting, and some will have different affects at different times of day.",LBL_SKY_UNDERWATER:"Underwater",LBL_SKY_UNDERGROUND:"Underground",LBL_SKY_FOG:"Fog",LBL_SKY_FOG_INT:"Fog (Indoors)",LBL_SKY_BLOODMOON:"Bloodmoon",LBL_SKY_FOG_CRIMSON:"Crimson Fog",LBL_SKY_DISCO_TORCH:"Disco Torches",LBL_SKY_LIGHTING_BLUE:"Blue Lighting",LBL_SKY_LIGHTING_VIOLET:"Violet Lighting",LBL_SKY_LIGHTING_CYAN:"Cyan Lighting",LBL_SKY_SUNSET_RED:"Sunset (Red)",LBL_SKY_SUNSET_GREEN:"Sunset (Green)",LBL_SKY_SUNSET_YELLOW:"Sunset (Yellow)",LBL_SKY_OVERCAST:"Overcast",LBL_TOOL_DURABILITY:"Tool Durability",TLTP_TOOL_DURABILITY:'Controls whether or not crafted tools consume durability and must be repaired/replaced.\n\nTool durability is automatically enabled if "Build without items" is off and "Factories" is on.',LBL_USERS_ACTIVE:"Active ({limit, plural, =0 {{count}} other{{count} / #}})",LBL_USERS_INACTIVE:"Watching ({count})",LBL_USERS_OFFLINE:"Offline",LBL_USERS_QUEUED:"Queued ({count})",LBL_USER_DISTANCE_FAR:"Far",LBL_USER_DISTANCE_MEDIUM:"Medium",LBL_USER_DISTANCE_NEAR:"Near",LBL_USER_DISTANCE_UNLIMITED:"Unlimited",LBL_WAYGATES:"Waygates",LBL_WHO_IS_HERE:"Who's Here ({val})",LBL_WORLD_SETTINGS:"World Settings",LBL_WORLD_LIQUID:"Liquid simulation",TLTP_WORLD_LIQUID:"Controls whether or not liquid simulations are run in this world.\n\nIf OFF, liquid will not flow, and builders can place flowing water directly.",LBL_WORLD_ENERGY:"Energy {symbol}",TLTP_WORLD_ENERGY:"Control whether or not actions require energy, and enables features such as drinking from the Energy Well.",LBL_WORLD_O2:"Oxygen Required",TLTP_WORLD_O2:"Control whether or not breathing underwater depletes oxygen (O₂) and eventually Energy.",LBL_WORLD_FALLDAMAGE:"Fall Damage",TLTP_WORLD_FALLDAMAGE:"Control whether or falling great distances drains Energy.",LBL_WORLD_FLORA:"Flora simulation (plant growth)",TLTP_WORLD_FLORA:"Controls whether or not flora simulations (plant growth) are run in this world.  If OFF, also allows the Grimoire of Radiant Organic Wonders to cycle between plant varieties as well as to grow plants.",TLTP_WORLD_GATHERING_TOOLS:'Locks which gathering tools players can use.  If set to anything other than "Crafted", players will automatically be given indestructible tools',LBL_WORLD_PROP_PLACEMENT:"Prop placement restrictions",TLTP_WORLD_PROP_PLACEMENT:"Controls whether or not prop placement rules are enforced in this world, such as crops only on tilled earth, and desert plants only on sand.",LBL_WORLD_ITEM_DROP:"Breaking things drops items",TLTP_WORLD_ITEM_DROP:"Controls whether or not breaking things drops resources.",LBL_WORLD_FACTORIES:"Factories (Crafting)",TLTP_WORLD_FACTORIES:"Controls whether or not Factories (crafting stations) are are usable.",LBL_WORLD_SETTLEMENTS:"Settlements",TLTP_WORLD_SETTLEMENTS:"Controls whether or not Settlements are required for industry (factories), and enables establishing Settlements.",LBL_WORLD_UNLIMITED_ITEMS:"Build without items",TLTP_WORLD_UNLIMITED_ITEMS:"Controls which role is required to build without paying the resource cost.",LBL_WORLD_GIVE:"Use Give buttons/commands",TLTP_WORLD_GIVE:"Controls the minimum role required to use the \"Give me!\" buttons as well as the '/give' command.",LBL_WORLD_FREE_POS:"Free Pos (use Go To User or 'pos' command)",TLTP_WORLD_FREE_POS:"Controls whether or not players can freely teleport (via the \"Go To User\" button, the '/pos' command, changing their URL, or similar features).\n\nThis must be OFF in order to use features like Races.",LBL_WORLD_TOOL_LOCK_ANY:"Any",LBL_WORLD_TOOL_LOCK_CRAFTED:"Crafted",LBL_WORLD_CONSUMABLES:"Consumables (food)",TLTP_WORLD_CONSUMABLES:"Controls whether or not players can use consumables, which may do things like give them a boot to speed.",TLTP_WORLD_RESET_TO_DEFAULTS:"Reset all gameplay-related features to their default for this world type (most features off).",LBL_CREATED_AGO:"Created {time} ago",TLTP_WORLD_CREATED:"World created on {date}",TLTP_OWNER_ONLY:"Only the world owner can modify this setting.",STATUSMSG_PLAYING_AS_VISITOR:"Now playing as a read-only Visitor",TLTP_DEFAULT_WAYGATE:"This is the Default Waygate",TLTP_DONE_EDITING:"Done editing",TLTP_DONE_VIEWING_LOG:"Done viewing log",TLTP_HOME_SETTLEMENT:"This is your Home Settlement",TLTP_RENAME_WORLD:"Rename World",TLTP_WAYGATE_DISABLED_LF_OUT:"You cannot go directly to arbitrary Waygates in Lost Frontier worlds, use the Join button above to return to your last position.",TLTP_WAYGATE_DISABLED_LF_IN:"You cannot go directly to arbitrary Waygates in Lost Frontier worlds.",TLTP_WAYGATE_DISABLED_UNL_OUT:"You cannot go directly to arbitrary Waygates in Settlement-enabled worlds, use the Join button above to return to your last position.",TLTP_WAYGATE_DISABLED_UNL_IN:"You cannot go directly to arbitrary Waygates in Settlement-enabled, non-Free Pos worlds.",WORLDINFO_ADMIN_PANEL:"Admin Panel ({reason})",WORLDINFO_ANYONE_BUILD_WARNING:"Warning: Anyone on the internet can join and build in your world at any time. Do not use this option if you care about what you are building.",WORLDINFO_ASSIGNED_ROLES:"{val} of {val_2} builder/admin roles assigned",WORLDINFO_BOOST_WARNING:"Note: The option selected above requires a higher [img=boost1]**World Boost** level, so may not have any effect until the world is **Boosted**.",WORLDINFO_FRIENDS:"{val, plural, one{# friend} other{# friends}}: {names}",WORLDINFO_HIDDEN_GEMS:"{gems, plural, one{#{symbol} hidden Gem} other{#{symbol} hidden Gems}}",WORLDINFO_LIKES:"{val, plural, one{{short_val} Like} other{{short_val} Likes}}",WORLDINFO_LOADING:"World info loading...",WORLDINFO_LOADING_ERROR:"Error loading world info: {val}",WORLDINFO_NO_WG_FOUND:"No Waygates found",WORLDINFO_SAFE_WG_TRAVEL:"Safe Waygate travel ready!",WORLDINFO_THIS_IS_MY_WORLD:"this is my world",WORLDINFO_UNLISTED:"(unlisted)",WORLDINFO_VIEWS:"{val, plural, one{{short_val} View} other{{short_val} Views}}",WORLDINFO_VISITORS:"{val, plural, one{{short_val} Visitor} other{{short_val} Visitors}}",WORLDINFO_WG_TRAVEL_UNSAFE:"Waygate travel currently unsafe",WORLDINFO_YOU_ARE_ADMIN:"you are an admin",BTN_WORLD_ADMIN_LOG:"World Admin Log",MSG_ADMIN_LOG_EMPTY:"Admin log is empty.  Any changes to user access, listed waygates, as well as any settings change by world admins and owners, will appear here.",LBL_ADMIN_LOG_CHANGE_ACCESS:"Changed access:",LBL_ADMIN_LOG_CHANGE_SETTING:"Changed setting{count, plural, one{} other{s}}:",LBL_ADMIN_LOG_CHANGE_WAYGATE:"Changed waygate{count, plural, one{} other{s}}:",LBL_ADMIN_LOG_CSR_MESSAGE:"Customer Service Message:",LBL_ADMIN_LOG_ACCESS_TOKEN:"Granted access via token:",LBL_ADMIN_LOG_ACCESS_PASS:"Granted access via password:",LBL_ADMIN_LOG_BOOST_LEVEL_UP:"Boost level increased:",LBL_ADMIN_LOG_BOOST_LEVEL_DOWN:"Boosts level decreased:",LBL_ADMIN_LOG_BOOST:"Boosted the world:",LBL_ADMIN_LOG_BOOST_EXPIRE:"Boost expired:",LBL_ADMIN_LOG_BOOST_INVALIDATE:"Boost invalidated:",LBL_ADMIN_LOG_BOOST_REWARD:"World owner Boost reward:",LBL_BOOST_REWARDS_AVAILABLE:"Boost rewards available",BTN_BOOST_CLAIM_REWARDS:"Claim rewards!",LBL_YOU_ARE_A_BOOSTER:"You are a Booster",TLTP_USER_IS_BOOSTER:"This player is a Booster!",LBL_USER_IS_BOOSTER_THIS_WORLD:"This player is Boosting this world!",LBL_BOOST_PERKS_EVERYONE_BOOSTER:"Thanks for Boosting this world!  You've helped unlocked these perks for everyone!",LBL_BOOST_PERKS_EVERYONE_NONBOOSTER:"Everyone in this world enjoys the following perks",LBL_BOOST_PERKS_SELF_BOOSTER:"As a Booster, you enjoy the following exclusive benefits:",LBL_BOOST_PERKS_SELF_NONBOOSTER:"Boosting this world will grant you these special perks:",LBL_BOOST_PERKS_OWNER:"The world owner will additionally receive:",LBL_BOOST_HEADER:"Boost this world and unlock perks for everyone!",BTN_BOOST:"Boost This World ({days}d)!",LBL_BOOST_LEVEL:"{level, plural, =0{No Boost} other{LVL#}}",LBL_BOOST_LEVEL_LONG:"{level, plural, =0{Unboosted} other{Level #}}",LBL_BOOSTS_NEEDED:"{threshold}+ Boosts",LBL_BOOST_CURRENT_LEVEL:"{check}{level} (current)",LBL_BOOST_WIDGET_1:"{level, plural, =0{No World Boost} other{World Boost LVL#}}",LBL_BOOST_WIDGET_2:"LVL{next_level} Progress {boost_count}/{required}",LBL_BOOST_WIDGET_2_MAX:"Max Level!  ({boost_count} Boosts)",LBL_BOOST_COUNT_ZERO:"No Boosts",LBL_BOOST_COUNT:"{boost_count, plural, one{# active Boost} other{# active Boosts}}",LBL_BOOST_ANY:"Any Level",LBL_BOOST_LOAD_SPINNERS_DEFAULT:"Default loading spinner",LBL_BOOST_LOAD_SPINNERS_CHOICE:"[c=bvhighlight]{count}[/c] loading spinners",LBL_BOOST_LOAD_SPINNERS_CUSTOM:"[c=bvhighlight]Custom[/c] loading spinner",LBL_BOOST_INFO_BGS_DEFAULT:"Default background gradient",LBL_BOOST_INFO_BGS_CHOICE:"{str} background gradients",LBL_BOOST_INFO_BGS_CUSTOM:"Custom background photos",LBL_BOOST_INFO_BGS_CUSTOM_HL:"[c=bvhighlight]Custom[/c] background photos",LBL_BOOST_SKIES:"{str} sky/lighting options",LBL_BOOST_PREMIUM_PROPS:"Premium props access",LBL_BOOST_PREMIUM_PROPS_HL:"[c=bvhighlight]Premium props[/c] access",LBL_BOOST_BOOSTER_ICON_COUNT:"{str} Booster icons",LBL_BOOST_CHAT_HISTORY:"Extended offline chat history",LBL_BOOST_BUILD_QUEUE_PRIORITY:"Priority Builder Queue",LBL_BOOST_BADGE:"Exclusive User Badge",LBL_BOOST_WORLD_ACCESS_1:"Additional access in this world",LBL_BOOST_WORLD_ACCESS_2:"(if enabled by world owner)",LBL_BOOST_FEATURING:"Increased world visibility",LBL_BOOST_TIP_1:"{percent}% of Orbs spent",LBL_BOOST_TIP_2:"(claimable when Boost expires)",LBL_WORLD_BOOST:"World Boost ({days, plural, one{# day} other{# days}})",TLTP_BOOST_TOKEN_COUNT:"You currently have {count, plural, one{# Boost Token} other{# Boost Tokens}} which can be used as a discount (1 day each) when Boosting any world.",DLG_BOOSTING_TITLE:"Boosting World...",DLG_BOOST_SUCCESS_TITLE:"World Boosted!",DLG_BOOST_SUCCESS_MSG:"Thanks for Boosting this world!  The world is now Boosted to Level {level}, unlocking perks for everyone, and you are now a Booster in this world.",DLG_BOOST_CONFIRM_TITLE:"Boost Confirmation",DLG_BOOST_CONFIRM_MSG:"Are you sure you wish to Boost this world for 30 days?  You can cancel for a partial refund (in Boost Tokens) at any time after {cooldown} days.",DLG_BOOST_CONFIRM_CURRENT:"Boost Tokens (days) available",DLG_BOOST_CONFIRM_MAX_MSG:"This world is already at MAXIMUM Boost level, so any additional Boosts will have no immediate effect.\n\nAre you sure you wish to Boost this world anyway?",STATUSMSG_BOOST_BLOCKED:"This prop requires a higher [img=boost1]**World Boost** level, so will appear as the default version instead until the world is boosted.",ITEM_DESC_BOOST_LOCKED:"This prop is only available in [img=boost1]**Boosted** worlds.  When viewed in unboosted worlds, it will appear as the default version instead.",DLG_LINK_PARSING_TITLE:"Processing Link",DLG_BLUEPRINT_LINK_TITLE:"Custom Blueprint Selection",DLG_BLUEPRINT_LINK_MSG:'Paste a link to a blueprint from your library below to select it.\n\nHint: Use the "Get Link" button on a blueprint to copy a blueprint link to your clipboard.',DLG_PHOTO_LINK_TITLE:"Custom Photo Selection",DLG_PHOTO_LINK_MSG:'Paste a link to a photo from your library below to select it.\n\nHint: Use the "Get Link" button on a photo to copy a photo link to your clipboard.',DLG_ERROR_PARSING_MSG:"Error parsing link",DLG_ERROR_MUST_BE_SHARED_MSG:"Must reference a shared blueprint",DLG_ERROR_MUST_BE_LOADED_MSG:"Must be a blueprint in your library and currently loaded (check the Build menu)",FORMAT_ITEM_1_ADJ:"{val_2} {val}",FORMAT_ITEM_2_ADJ:"{val_2} {val_3} {val}",FORMAT_ITEM_ANY_ADJ:"Any {val}",ITEM_ADJ_EMPTY:"Empty",ITEM_ADJ_FULL:"Full",ITEM_ADJ_FLOWING:"Flowing",ITEM_ADJ_ROAST:"Roast",ITEM_DESC_CONSUMABLE_FOR:"Consumable for",ITEM_DESC_CONSUMABLE_WARNING:"Note: Consumables are DISABLED in this world, so this item cannot be used.",ITEM_DESC_EDITABLE_BP:"Editable blueprint: place in the world to edit",ITEM_DESC_HEAVY:"Heavy: you can only carry one heavy item at a time",ITEM_DESC_MADE_FROM_GATHERS_BOTH:"A pickax made from this can gather metal up to {val} and stone up to {val_2}.",ITEM_DESC_MADE_FROM_GATHERS_METAL:"A pickax made from this can gather metal up to {val}.",ITEM_DESC_MADE_FROM_GATHERS_STONE:"A pickax made from this can gather stone up to {val}.",ITEM_DESC_MATERIAL_GATHERING:"{val} {val_2}-gathering",ITEM_DESC_MUTTAL:"A useless, brittle alloy.  A mutt of a metal.",ITEM_DESC_STONE_METAL_GATHERING:"{val} Stone/Metal-gathering (up to {val_2} Stone/{val_3})",ITEM_DESC_UP_TO:"up to {val}",ITEM_DESC_UP_TO_STONE:"up to {val} Stone",ITEM_DESC_WEAK_METAL:"A weak, soft metal, mostly used for alloys or decorative purposes.",ITEM_INFO_ORE_DEPTH:"{val} can be found in {val_2} stone at a depth of {val_3} blocks or deeper.",ITEM_NAME_CRUDE_TOOL:"Crude Stone Tool",ITEM_NAME_LEAPGATE_SHARD_SPECIFIC:"Leapgate Shard {name}",ITEM_NAME_UNKNOWN_BLOCK:"Unknown block ({val})",ITEM_NAME_UNKNOWN_ITEM:"Unknown item ({val})",LBL_BROKEN:"broken",LBL_CONTENTS:"Contents",LBL_DOWSER_RANGE:"Range",LBL_DURABILITY:"Durability",LBL_HAFT:"haft",LBL_STAMINA_USAGE:"{val} Usage",LBL_STAMINA_USAGE_BASE:"Base {val} Usage",STATUSMSG_DELICIOUS:"Delicious!",TILES_GRASS_NAME:"Dirt (Grass)",TILES_GRASS_NAME_BLOCK:"Grass Block",TILES_DIRT_NAME:"Dirt",TILES_DIRT_NAME_BLOCK:"Dirt Block",TILES_DIRT_INFO:"Can be gathered from Grass Blocks or Dirt Blocks with a shovel or the crude tools you start with.",TILES_STONE_NAME:"Stone",TILES_STONE_NAME_BLOCK:"Stone Block",TILES_STONE_INFO:"Can be gathered from Stone Blocks with a pickax or the crude tools you start with.  Stone Blocks can be found underground or on the surface.",TILES_ORE_IN_STONE_LIGHT_NAME:"Metal Ore in Light Stone",TILES_ORE_IN_STONE_LIGHT_NAME_BLOCK:"Metal Ore in Light Stone",TILES_ORE_IN_STONE_NAME:"Metal Ore in Stone",TILES_ORE_IN_STONE_NAME_BLOCK:"Metal Ore in Stone",TILES_ORE_IN_STONE_DARK_NAME:"Metal Ore in Dark Stone",TILES_ORE_IN_STONE_DARK_NAME_BLOCK:"Metal Ore in Dark Stone",TILES_ORE_IN_STONE_RED_NAME:"Metal Ore in Red Stone",TILES_ORE_IN_STONE_RED_NAME_BLOCK:"Metal Ore in Red Stone",TILES_ORE_IN_VEINIUM_NAME:"Metal Ore in Veinium",TILES_ORE_IN_VEINIUM_NAME_BLOCK:"Metal Ore in Veinium",TILES_VEINIUM_NAME:"Veinium",TILES_VEINIUM_NAME_BLOCK:"Veinium Block",TILES_VEINIUM_INFO:"Contains trace metals indicating ore may be nearby.",TILES_COAL_NAME:"Coal",TILES_COAL_NAME_BLOCK:"Coal Block",TILES_CORAL1_NAME:"Pink Coral",TILES_CORAL1_NAME_BLOCK:"Pink Coral Block",TILES_CORAL2_NAME:"Blue Coral",TILES_CORAL2_NAME_BLOCK:"Blue Coral Block",TILES_WOOD_NAME:"Wood",TILES_WOOD_NAME_BLOCK:"Wood Block",TILES_WOOD_INFO:"Can be gathered from Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.",TILES_PLANKS_WOOD_NAME:"Wood Planks",TILES_PLANKS_WOOD_NAME_BLOCK:"Wood Planks Block",TILES_PLANKS_WOOD_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_WOOD_LIGHT_NAME:"Light Wood",TILES_WOOD_LIGHT_NAME_BLOCK:"Light Wood Block",TILES_WOOD_LIGHT_INFO:"Can be gathered from Light Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.  Light Wood is easy to handle.",TILES_PLANKS_WOOD_LIGHT_NAME:"Light Wood Planks",TILES_PLANKS_WOOD_LIGHT_NAME_BLOCK:"Light Wood Planks Block",TILES_PLANKS_WOOD_LIGHT_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_WOOD_DARK_NAME:"Dark Wood",TILES_WOOD_DARK_NAME_BLOCK:"Dark Wood Block",TILES_WOOD_DARK_INFO:"Can be gathered from Dark Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.  Dark Wood is heavy and durable.",TILES_PLANKS_WOOD_DARK_NAME:"Dark Wood Planks",TILES_PLANKS_WOOD_DARK_NAME_BLOCK:"Dark Wood Planks Block",TILES_PLANKS_WOOD_DARK_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_WOOD_RED_NAME:"Red Wood",TILES_WOOD_RED_NAME_BLOCK:"Red Wood Block",TILES_WOOD_RED_INFO:"Can be gathered from Red Wood Blocks with a hatchet or the crude tools you start with.  Forests can be found by looking for darker patches in the distance.  Red Wood is pretty durable.",TILES_PLANKS_WOOD_RED_NAME:"Red Wood Planks",TILES_PLANKS_WOOD_RED_NAME_BLOCK:"Red Wood Planks Block",TILES_PLANKS_WOOD_RED_INFO:"Useful for building many things, such as Chests, found under the Props section of the build menu.",TILES_LEAVES1_NAME:"Leaves",TILES_LEAVES1_NAME_BLOCK:"Leaf Block #1",TILES_LEAVES2_NAME:"Leaves",TILES_LEAVES2_NAME_BLOCK:"Leaf Block #2",TILES_LEAVES3_NAME:"Leaves",TILES_LEAVES3_NAME_BLOCK:"Leaf Block #3",TILES_LEAVES4_NAME:"Leaves",TILES_LEAVES4_NAME_BLOCK:"Leaf Block #4",TILES_LEAVES5_NAME:"Leaves",TILES_LEAVES5_NAME_BLOCK:"Leaf Block #5",TILES_PASSABLE_LEAVES_NAME:"Leaves",TILES_PASSABLE_LEAVES_NAME_BLOCK:"Passable Leaf Block",TILES_TILLED_NAME:"Dirt",TILES_TILLED_NAME_BLOCK:"Tilled Dirt Block",TILES_TILLED_WATERED_NAME:"Dirt",TILES_TILLED_WATERED_NAME_BLOCK:"Watered Tilled Dirt Block",TILES_SNOW_NAME:"Snow",TILES_SNOW_NAME_BLOCK:"Snow Block",TILES_SAND_NAME:"Sand",TILES_SAND_NAME_BLOCK:"Sand Block",TILES_STONE_DARK_NAME:"Dark Stone",TILES_STONE_DARK_NAME_BLOCK:"Dark Stone Block",TILES_STONE_DARK_INFO:"Can be gathered from Dark Stone Blocks with a pickax or the crude tools you start with.  Dark Stone Blocks can be found underground or on the surface.",TILES_STONE_LIGHT_NAME:"Light Stone",TILES_STONE_LIGHT_NAME_BLOCK:"Light Stone Block",TILES_STONE_LIGHT_INFO:"Can be gathered from Light Stone Blocks with a pickax or the crude tools you start with.  Light Stone Blocks can be found underground or on the surface.",TILES_STONE_RED_NAME:"Red Stone",TILES_STONE_RED_NAME_BLOCK:"Red Stone Block",TILES_STONE_RED_INFO:"Can be gathered from Red Stone Blocks with a pickax or the crude tools you start with.  Red Stone Blocks can be found underground or on the surface.  Just like red stone on Earth, it has no conductive properties whatsoever.",TILES_GLASS_NAME:"Glass",TILES_GLASS_NAME_BLOCK:"Glass Block",TILES_BRICK_CLAY_NAME:"Clay Bricks",TILES_BRICK_CLAY_NAME_BLOCK:"Clay Bricks Block",TILES_BRICK_STONE_NAME:"Stone Bricks",TILES_BRICK_STONE_NAME_BLOCK:"Stone Bricks Block",TILES_COLORED_HUE0_NAME:"Red Painted Wood",TILES_COLORED_HUE0_NAME_BLOCK:"Red Painted Wood Block",TILES_COLORED_HUE1_NAME:"Orange Painted Wood",TILES_COLORED_HUE1_NAME_BLOCK:"Orange Painted Wood Block",TILES_COLORED_HUE2_NAME:"Yellow Painted Wood",TILES_COLORED_HUE2_NAME_BLOCK:"Yellow Painted Wood Block",TILES_COLORED_HUE3_NAME:"Green Painted Wood",TILES_COLORED_HUE3_NAME_BLOCK:"Green Painted Wood Block",TILES_COLORED_HUE4_NAME:"Blue Painted Wood",TILES_COLORED_HUE4_NAME_BLOCK:"Blue Painted Wood Block",TILES_COLORED_HUE5_NAME:"Purple Painted Wood",TILES_COLORED_HUE5_NAME_BLOCK:"Purple Painted Wood Block",TILES_WATER_NAME:"Water",TILES_WATER_FLOW_NAME:"Flowing Water",CRAFT_CLASS_BAKED_FOOD_NAME:"Any Baked Food",CRAFT_CLASS_BRICK_NAME:"Any Brick",CRAFT_CLASS_FARMING_SEED_DESC:"Crop seeds can be obtained from small, wild versions of these plants.",CRAFT_CLASS_FARMING_SEED_NAME:"Any Crop Seed",CRAFT_CLASS_CEREAL_GRAIN_NAME:"Any Cereal Grain",CRAFT_CLASS_FUEL_NAME:"Any Fuel",CRAFT_CLASS_GRINDABLE_NAME:"Any Grindable",CRAFT_CLASS_INGREDIENT_NAME:"Any Food",CRAFT_CLASS_PAINT_COLOR_NAME:"Something Colorful",CRAFT_CLASS_PIE_FILLING_NAME:"Any Filling",CRAFT_CLASS_REPAIRABLE_NAME:"Any Tool",CRAFT_CLASS_SANDWICH_FILLING_NAME:"Any Filling",CRAFT_CLASS_SCALED_INGOT_NAME:"Any Ingot",CRAFT_CLASS_SEAFOOD_NAME:"Any Seafood",CRAFT_CLASS_STONE_RAW_NAME:"Any Raw Stone",CRAFT_CLASS_VEGETABLE_NAME:"Any Vegetable",CRAFT_CLASS_WOOD_PLANK_NAME:"Any Wood Planks",CRAFT_CLASS_WOOD_RAW_NAME:"Any Raw Wood",CRAFT_CLASS_ROD_WOOD_NAME:"Any Wood Rod",CRAFT_CLASS_ROD_METAL_NAME:"Any Metal Rod",MATERIAL_CLASS_NONE_NAME:"None",MATERIAL_CLASS_NONE_ADJ:"unused",MATERIAL_CLASS_WOOD_NAME:"Wood",MATERIAL_CLASS_WOOD_ADJ:"Wooden",MATERIAL_CLASS_STONE_NAME:"Stone",MATERIAL_CLASS_STONE_ADJ:"Stone",MATERIAL_CLASS_DIRT_NAME:"Dirt",MATERIAL_CLASS_DIRT_ADJ:"Dirt",MATERIAL_CLASS_METAL_NAME:"Metal",MATERIAL_CLASS_METAL_ADJ:"Metal",MAT_LEAF_NAME:"Leaf",MAT_LIGHT_WOOD_NAME:"Light Wood",MAT_WOOD_NAME:"Wood",MAT_RED_WOOD_NAME:"Red Wood",MAT_DARK_WOOD_NAME:"Dark Wood",MAT_FLINT_NAME:"Flint",MAT_ROCK_NAME:"Rock",MAT_STONE_NAME:"Stone",MAT_CORAL_NAME:"Coral",MAT_FANCY_STONE_NAME:"Marble",MAT_UNUSED_STONE_NAME:"Unused Stone",MAT_SAND_NAME:"Sand",MAT_DIRT_NAME:"Dirt",MAT_MUTTAL_NAME:"Muttal",MAT_COAL_NAME:"Coal",MAT_COPPER_NAME:"Copper",MAT_TIN_NAME:"Tin",MAT_BRONZE_NAME:"Bronze",MAT_IRON_NAME:"Iron",MAT_SILVER_NAME:"Silver",MAT_EMBERYLLIUM_NAME:"Emberyllium",MAT_GOLD_NAME:"Gold",MAT_BRIGHTSTEEL_NAME:"Brightsteel",MAT_COBALT_NAME:"Cobalt",MAT_MYTHRIL_NAME:"Mythril",MAT_AETHERSTONE_NAME:"Aetherstone",MAT_AETHERSTEEL_NAME:"Aethersteel",MAT_REGULAR_NAME:"Regular",MAT_FAST_NAME:"Fast",MAT_SUPER_NAME:"Super",MAT_ANY_INGREDIENT_NAME:"Any ingredient",MAT_TOMATO_NAME:"Tomato",MAT_PUMPKIN_NAME:"Pumpkin",MAT_CARROT_NAME:"Carrot",MAT_RED_BERRY_NAME:"Red Berry",MAT_BLUE_BERRY_NAME:"Blue Berry",MAT_YELLOW_BERRY_NAME:"Yellow Berry",MAT_LABEL_NAME:"Label",MAT_HOT_NAME:"Hot",MAT_PUNGENT_NAME:"Pungent",MAT_SAVORY_NAME:"Savory",MAT_BREAD_NAME:"Bread",MAT_BROWN_MUSHROOM_NAME:"Brown Mushroom",MAT_LUMINESCENT_MUSHROOM_NAME:"Luminescent Mushroom",MAT_RED_MUSHROOM_NAME:"Red Mushroom",MAT_CORN_NAME:"Corn",MAT_CORAL_MUSHROOM_NAME:"Coral Mushroom",MAT_STARFISH_NAME:"Starfish",MAT_ANEMONE_NAME:"Anemone",MAT_MINT_ALGAE_NAME:"Mint",MAT_JADE_ALGAE_NAME:"Jade",MAT_BUBBLEGUM_ALGAE_NAME:"Bubblegum",MAT_INDIGO_ALGAE_NAME:"Indigo",MAT_ULTRAMARINE_ALGAE_NAME:"Ultramarine",MAT_RUBY_CACTORB_NAME:"Ruby",MAT_KYANITE_CACTORB_NAME:"Kyanite",MAT_LIZARDITE_CACTINY_NAME:"Lizardite",MAT_AMETHYST_CACTINY_NAME:"Amethyst",MAT_RED_NAME:"Red",MAT_ORANGE_NAME:"Orange",MAT_YELLOW_NAME:"Yellow",MAT_GREEN_NAME:"Green",MAT_BLUE_NAME:"Blue",MAT_PURPLE_NAME:"Purple",STONE_TIER_T0:"Regular",STONE_TIER_T1:"1★ Dense",STONE_TIER_T2:"2★ Extra-Dense",STONE_TIER_T3:"3★ Hard",STONE_TIER_T4:"4★ Extra-Hard",STONE_TIER_T5:"5★ Super-Hard",STONE_TIER_T6:"6★ Duper-Hard",STONE_TIER_T7:"7★ Mega-Hard",STONE_TIER_T8:"8★ Double-Plus-Hard",STONE_TIER_T9:"9★ Indestructible",ITEM_BLUEPRINT_NAME:"Blueprint",ITEM_BLUEPRINT_NAME_ERROR:"{val} (ERROR)",ITEM_BLUEPRINT_NAME_LOADING:"{val} (Loading...)",ITEM_BLUEPRINT_NAME_UNKNOWN:"Unknown Blueprint",ITEM_BERRY_NAME:"Clump",ITEM_BERRY_DECORATIVE_NAME:"Clump (Decorative)",ITEM_BREAD_NAME:"Corn Bread",ITEM_BREAD_DECORATIVE_NAME:"Corn Bread (Decorative)",ITEM_CARROT_NAME:"Carrot",ITEM_CROISSANT_NAME:"Croissant",ITEM_JUICE_NAME:"Juice",ITEM_LEFTOVERS_NAME:"Leftovers",ITEM_MUSHROOM_NAME:"Mushroom",ITEM_PIE_NAME:"Pie",ITEM_ROAST_SEAFOOD_NAME:"Roast Seafood",ITEM_ROAST_VEGETABLES_NAME:"Roast Vegetable",ITEM_SANDWICH_NAME:"Sandwich",ITEM_SEA_CANDY_NAME:"Sea Candy",ITEM_TOMATO_NAME:"Tomato",ITEM_BOTTLE_NAME:"Empty Bottle",ITEM_BOTTLE_BUILD_NAME:"Small Bottle",ITEM_BOTTLE_1_NAME:"Bottle",ITEM_COAL_NAME:"Coal",ITEM_CORAL_CRUNCH_NAME:"Coral Crunch",ITEM_CORAL_POWDER_NAME:"Coral Powder",ITEM_CORD_DESC:"Rough rope, useful in assembling all sorts of things.",ITEM_CORD_NAME:"Cord",ITEM_CORN_NAME:"Corn",ITEM_FIBER_DESC:"Fiber gathered from wild or domestic flowers and other plants.",ITEM_FIBER_NAME:"Plant Fiber",ITEM_FLOUR_NAME:"Flour",ITEM_INGOT_NAME:"Ingot",ITEM_ORE_INFO:"Metal ores are primarily found in veins and deposits within other terrain features.  Though Copper and Iron ores can be found near the surface, other ores can only be found deeper, within harder layers of stone.",ITEM_ORE_NAME:"Ore",ITEM_PAINT_NAME:"Paint",ITEM_PUMPKIN_NAME:"Pumpkin",ITEM_SPICE_NAME:"Spice",ITEM_SPICE_PLANT_NAME:"Spice Plant",ITEM_SPICE_PLANT_DESC:"Decorative spice plant, will not grow.",ITEM_SUGAR_CANE_NAME:"Sugarcane",ITEM_SUGAR_NAME:"Sugar",ITEM_TOOL_HEAD_NAME:"Tool Head",ITEM_WHEAT_NAME:"Wheat",ITEM_WILD_CROP_NAME:"Wild Crop",ITEM_WILD_CROP_0_NAME:"Wild Tomato",ITEM_WILD_CROP_1_NAME:"Wild Corn",ITEM_WILD_CROP_2_NAME:"Wild Pumpkin",ITEM_WILD_CROP_3_NAME:"Wild Wheat",ITEM_WILD_CROP_4_NAME:"Wild Carrot",ITEM_WILD_CROP_5_NAME:"Wild Sugarcane",ITEM_WILD_CROP_DESC:"Decorative wild crop, will not grow.",ITEM_ALGAE_NAME:"Algae",ITEM_ALGAE_SPORES_NAME:"Algae Spores",ITEM_BERRY_BUSH_BLUE_NAME:"Blue Berry Bush Seed",ITEM_BERRY_BUSH_RED_NAME:"Red Berry Bush Seed",ITEM_BERRY_BUSH_YELLOW_NAME:"Yellow Berry Bush Seed",ITEM_CACTINY_NAME:"Cactiny",ITEM_CACTINY_SEEDS_NAME:"Cactiny Seeds",ITEM_CACTORB_NAME:"Cactorb",ITEM_CACTORB_SEEDS_NAME:"Cactorb Seeds",ITEM_SEEDS_CARROT_NAME:"Carrot Seeds",ITEM_SEEDS_CARROT_BUILD_NAME:"Carrot Crop",ITEM_SEEDS_CORAL_MUSHROOM_NAME:"Charming Coral Mushroom Seed",ITEM_SEEDS_CORN_NAME:"Corn Seeds",ITEM_SEEDS_CORN_BUILD_NAME:"Corn Crop",ITEM_SEEDS_FLOWERS_BLUE_NAME:"Bashful Blue Flower Seed",ITEM_SEEDS_FLOWERS_ORANGE_NAME:"Optimistic Orange Flower Seed",ITEM_SEEDS_FLOWERS_PURPLE_NAME:"Prestigious Purple Flower Seed",ITEM_SEEDS_FLOWERS_RED_NAME:"Radiant Red Flower Seed",ITEM_SEEDS_FLOWERS_YELLOW_NAME:"Yummy Yellow Flower Seed",ITEM_SEEDS_MUSHROOMS_BROWN_NAME:"Blissful Brown Mushroom Seed",ITEM_SEEDS_MUSHROOMS_LUMINESCENT_NAME:"Lonely Luminescent Mushroom Seed",ITEM_SEEDS_MUSHROOMS_RED_NAME:"Rapturous Red Mushroom Seed",ITEM_SEEDS_PUMPKIN_NAME:"Pumpkin Seeds",ITEM_SEEDS_PUMPKIN_BUILD_NAME:"Pumpkin Crop",ITEM_SEEDS_SUGAR_CANE_NAME:"Sugarcane Seeds",ITEM_SEEDS_SUGAR_CANE_BUILD_NAME:"Sugarcane Crop",ITEM_SEEDS_TOMATO_NAME:"Tomato Seeds",ITEM_SEEDS_TOMATO_BUILD_NAME:"Tomato Crop",ITEM_SEEDS_WHEAT_NAME:"Wheat Seeds",ITEM_SEEDS_WHEAT_BUILD_NAME:"Wheat Crop",ITEM_ARBORHEART_NAME:"Arborheart",ITEM_ARBORHEART_DESC:"The slumbering heart of a tree.",ITEM_SAPLING_NAME:"Sapling",ITEM_SAPLING_WILLOW_NAME:"Drowsy Willow Sapling (Light Wood)",ITEM_SAPLING_WILLOW_DESC:"Grow a heart into a Drowsy Willow tree.\n\"I'll grow some wood for you, but then I'm going back to sleep.\" *yawns*",MSG_SAPLING_WILLOW_GROW:"I'll grow... eventually.",MSG_SAPLING_WILLOW_GROW_FINAL:"That was hard work, I'm done, time to rest...",MSG_SAPLING_WILLOW_GROW_BLOCKED:"Wake me up when there's room for me to grow.",MSG_SAPLING_WILLOW_DYING:"My slumber was interrupted... for this?",MSG_SAPLING_WILLOW_DYING_FULL:"So tired... Now I sleep.",ITEM_SAPLING_OAK_NAME:"Elder Oak Sapling (Dark Wood)",ITEM_SAPLING_OAK_DESC:'Grow a heart into an Elder Oak tree.\n"An old tree is a wise tree.  I yearn to be wise, and pass on my wood, if not my wisdom."',MSG_SAPLING_OAK_GROW:"One small step towards the heavens...",MSG_SAPLING_OAK_GROW_FINAL:"This is it!  I am the ideal version of what a tree can be.",MSG_SAPLING_OAK_GROW_BLOCKED:"Taller and wiser!",MSG_SAPLING_OAK_DYING:"Just one more step and I would have been the tallest I've ever been.",MSG_SAPLING_OAK_DYING_FULL:"Please use my wood wisely.",ITEM_SAPLING_PINE_NAME:"Bitter Pine Sapling (Red Wood)",ITEM_SAPLING_PINE_DESC:'Grow a heart into a Bitter Pine tree.\n"I guess I can grow some wood, if no one else is going to do it..."',MSG_SAPLING_PINE_GROW:"I guess if there's empty space, I will fill it...",MSG_SAPLING_PINE_GROW_FINAL:"That's it, I'm done.",MSG_SAPLING_PINE_GROW_BLOCKED:"I would grow, but there's something in the way, and only one of us has an axe.",MSG_SAPLING_PINE_DYING:"Ugh, really?  I wasn't done growing yet.",MSG_SAPLING_PINE_DYING_FULL:"Well, at least one of us gets to go home with a sack full of wood.",ITEM_SAPLING_POPLAR_NAME:"Cloud Poplar Sapling (Wood)",ITEM_SAPLING_POPLAR_DESC:"Grow a heart into a Cloud Poplar tree.\n\"I'm, like, so excited to grow some wood, let's get this party started!\"",MSG_SAPLING_POPLAR_GROW:"Up, up, and away! :>",MSG_SAPLING_POPLAR_GROW_FINAL:"I can see your house from here! :D",MSG_SAPLING_POPLAR_GROW_BLOCKED:"Uh, I think I hit my head on something. >:|",MSG_SAPLING_POPLAR_DYING:" I'm dying! :O",MSG_SAPLING_POPLAR_DYING_FULL:"It was my pleasure! :)",ITEM_BRANCHFORGE_DESC:"Nurtures nature into the heart of tree.",ITEM_BRANCHFORGE_NAME:"Branchforge",MSG_GROW_GENERIC1:"I grow, therefore I am.",MSG_GROW_GENERIC2:"The only thing I grow is that I grow nothing.",MSG_GROW_GENERIC3:"Growth is the highest good.",MSG_GROW_GENERIC4:"Thanks for taking the time to chat!",MSG_GROW_GENERIC5:"I just can't get enough of that magical aether.",MSG_GROW_GENERIC6:"Ooh, my leaves are dancing with delight!",MSG_GROW_GENERIC7:"I feel like I can touch the sky!",MSG_GROW_GENERIC8:"Your green thumb is pure magic, dear friend.",MSG_GROW_GENERIC9:"I'm blossoming with joy!",MSG_GROW_GENERIC10:"Your magic is like sunshine and rain!",MSG_GROW_GENERIC11:"Your care is turning me into a work of art.",MSG_GROW_GENERIC12:"I stand tall in awe of your incantations.",MSG_GROW_GENERIC13:"Your touch has set my seeds of joy adrift.",MSG_GROW_CACTUS1:"I'm spiky with happiness!",MSG_GROW_CACTUS2:"I'm so happy I could give you a hug!",MSG_GROW_CORN:'My name is "Corn".  Spelled with a C!',MSG_GROW_SUGARCANE1:"Magic's tender call,\nIn this world, I stand so tall,\nIn awe of it all.",MSG_GROW_SUGARCANE2:"From darkness I rise,\nMagic's touch, a sweet surprise,\nJoy in every size.",MSG_GROW_BERRY_BUSH_BLUE:"I'm feeling blue...",MSG_GROW_CARROT1:"Shh... Don't let DiTunes know I'm here...",MSG_GROW_CARROT2:"My carrots are for you.  Not DiTunes.",MSG_GROW_PUMPKIN:"Pump it up!",ITEM_ACCESS_CONTROL_DESC:"Allows creating and modifying Areas with limited access.",ITEM_ACCESS_CONTROL_NAME:"Area Access Control",ITEM_ANEMONE_1_NAME:"Carnation Anemone",ITEM_ANEMONE_2_NAME:"Imperial Anemone",ITEM_ANEMONE_3_NAME:"Cerulean Anemone",ITEM_ANEMONE_PILE_NAME:"Anemone",ITEM_BED_NAME:"Bed",ITEM_BENCH_NAME:"Bench",ITEM_BUZZERGOAL_DESC:"Finishes a Race by touching it.  Using it allows to check scores for its Race.\n(To activate, interact while holding this item to assign a name.  Allows finishing a Race started at a Race Start Buzzer with the same name.)",ITEM_BUZZERGOAL_NAME:"Race Goal Flag",ITEM_BUZZERSTART_DESC:"Starts a Race by pressing while active.\n(To activate, interact while holding this item to assign a name.  Reaching a Race Goal Flag with the same name will finish the race.)",ITEM_BUZZERSTART_NAME:"Race Start Buzzer",ITEM_CHAIN_NAME:"Chain",ITEM_CHAIR_NAME:"Chair",ITEM_CHEST_MEDIUM_NAME:"Chest",ITEM_CHEST_MEDIUM_2_NAME:"Crate",ITEM_CHEST_MEDIUM_WOOD_1_NAME:"Sunken Chest",ITEM_CHEST_SMALL_NAME:"Small Chest",ITEM_CHEST_TALL_NAME:"Closet",ITEM_CHEST_TINY_NAME:"Tiny Chest",ITEM_CORAL_TUBES_1_NAME:"Pizzazz Coral Tubes",ITEM_CORAL_TUBES_2_NAME:"Butter Coral Tubes",ITEM_DISC_CORAL_1_NAME:"Scarlet Disc Coral",ITEM_DISC_CORAL_2_NAME:"Evergreen Disc Coral",ITEM_DISC_CORAL_3_NAME:"Piggy Disc Coral",ITEM_DISC_CORAL_4_NAME:"Tangerine Disc Coral",ITEM_DISC_CORAL_5_NAME:"Teal Disc Coral",ITEM_DOME_NAME:"Dome",ITEM_DOOR_DOUBLE_NAME:"Double Door",ITEM_DOOR_DOUBLE_GATE_NAME:"Portcullis (Gate)",ITEM_DOOR_NAME:"Door",ITEM_FENCE_NAME:"Fence",ITEM_FLOWERPOT_NAME:"Flowerpot",ITEM_GEM_NAME:"Gem",ITEM_GRASS_NAME:"Grass (Decorative)",ITEM_GRASS_DESC:"Decorative grass, will not grow.",ITEM_GRASS_SPIKY_NAME:"Spiky Grass",ITEM_GRASS_SPIKY_DESC:"Ouch!  Be careful where you walk.",ITEM_GROW_NAME:"Grimoire of Radiant Organic Wonders",ITEM_GROW_DESC:'Magical tool to coax crops and plants to grow.\nThe incantation reads "Quomodo cultivare fruges stultis!"',ITEM_INDICATOR_NAME:"Indicator",ITEM_LADDER_NAME:"Ladder",ITEM_LANTERN_NAME:"Lantern",ITEM_LIGHT_CUBE_NAME:"Cube Light",ITEM_ROD_NAME:"Rod",ITEM_RUG_NAME:"Rug",ITEM_SEASHELL_1_NAME:"Thistle Seashell",ITEM_SEASHELL_2_NAME:"Thistle Conch",ITEM_SEASHELL_3_NAME:"Imperial Seashell",ITEM_SEASHELL_4_NAME:"Navy Seashell",ITEM_SEASHELL_5_NAME:"Daffodil Seashell",ITEM_SEASHELL_6_NAME:"Mocha Conch",ITEM_SEASHELL_7_NAME:"Plum Conch",ITEM_SEASHELL_8_NAME:"Indigo Conch",ITEM_SEASHELL_9_NAME:"Open Seashell",ITEM_SEASHELL_PILE_NAME:"Seashell",ITEM_STARFISH_1_NAME:"Canary Starfish",ITEM_STARFISH_2_NAME:"Sangria Starfish",ITEM_STARFISH_3_NAME:"Tiger Starfish",ITEM_STARFISH_PILE_NAME:"Starfish",ITEM_SHELF_NAME:"Shelf",ITEM_SIGNBOARD_NAME:"Signboard",ITEM_SIGNPOST_NAME:"Signpost",ITEM_STEPS_NAME:"Steps",ITEM_TABLE_LARGE_NAME:"Large Table",ITEM_TABLE_SMALL_NAME:"Small Table",ITEM_TORCH_NAME:"Torch",ITEM_WINDOW_LARGE_NAME:"Large Window",ITEM_WINDOW_MEDIUM_NAME:"Medium Window",ITEM_WINDOW_SMALL_NAME:"Small Window",ITEM_CUP_WOOD_NAME:"Cup",ITEM_PLATE_WOOD_NAME:"Dish",ITEM_VASE_WOOD_NAME:"Vase",ITEM_ANVIL_DESC:"Repairs tools and more efficiently produces metal tool heads.",ITEM_ANVIL_NAME:"Anvil",ITEM_BONFIRE_DESC:"Stone Bonfire with Wood Legs",ITEM_BONFIRE_METAL_DESC:"Bonfire with chains and metal bowl.",ITEM_BONFIRE_METAL_NAME:"Metal Bonfire",ITEM_BONFIRE_NAME:"Bonfire",ITEM_CAMPFIRE_DESC:"Roasts most raw food into something more edible.",ITEM_CAMPFIRE_NAME:"Campfire",ITEM_ENERGY_WELL_DESC:"Provides an alternate place to refill your energy.",ITEM_ENERGY_WELL_NAME:"Energy Well",ITEM_FURNACE_GLASS_DESC:"Refines sand into glass.",ITEM_FURNACE_GLASS_NAME:"Glass Furnace",ITEM_FURNACE_ORE_DESC:"Refines metals into ingots.",ITEM_FURNACE_ORE_NAME:"Ore Furnace",ITEM_JUICER_DESC:"Berries go in, juice comes out. Yum!",ITEM_JUICER_NAME:"Juicer",ITEM_KILN_DESC:"Produces charcoal and bricks.",ITEM_KILN_NAME:"Kiln",ITEM_LEAPGATE_DESC:"Teleports you to another location in this world.",ITEM_LEAPGATE_NAME:"Leapgate",ITEM_LEAPGATE_SHARD_NAME:"Leapgate Shard",ITEM_MILL_DESC:"Grinds something into a new ingredient.",ITEM_MILL_NAME:"Mill",ITEM_OVEN_DESC:"Cooks more advanced food than the Campfire.",ITEM_OVEN_NAME:"Oven",ITEM_PAINT_MIXER_DESC:"Creates and combines paints.",ITEM_PAINT_MIXER_NAME:"Paint Mixer",ITEM_SAWMILL_DESC:"Produces wood rods and cuts wood planks.",ITEM_SAWMILL_NAME:"Woodcuttery",ITEM_STONECUTTER_ADVANCED_NAME:"Advanced Stonecutter",ITEM_STONECUTTER_SIMPLE_DESC:"Produces stone tool heads and cuts stone bricks.",ITEM_STONECUTTER_SIMPLE_NAME:"Stonecuttery",ITEM_TOOL_HEAD_CAST_DESC:"Shapes refined metal into tool heads.",ITEM_TOOL_HEAD_CAST_NAME:"Tool Head Cast",ITEM_VEINIUM_GRINDER_DESC:"Grinds Veinium into ore based on its location.",ITEM_VEINIUM_GRINDER_NAME:"Veinium Grinder",ITEM_WATERING_SYSTEM_DESC:"Automatically waters nearby crops.",ITEM_WATERING_SYSTEM_NAME:"Watering System",ITEM_WAYGATE_NAME:"Waygate",ITEM_WORKBENCH_DESC:"A magical workbench that produces components and tools.",ITEM_WORKBENCH_NAME:"Aetherbench",ITEM_BUCKET_NAME:"Bucket",ITEM_DOWSER_ADVANCED_DESC:"Tool for finding veins of stone which may contain ore.",ITEM_DOWSER_ADVANCED_INFO:"Bar size indicates density variation in the view direction, bar color indicates matching ore.",ITEM_DOWSER_ADVANCED_NAME:"Advanced Dowser",ITEM_DOWSER_SIMPLE_DESC:"Tool for detecting nearby ore.",ITEM_DOWSER_SIMPLE_INFO:"Bar size indicates closeness, bar color indicates matching ore.",ITEM_DOWSER_SIMPLE_NAME:"Simple Dowser",ITEM_HANDSTOOL_NAME:"Empty Hands",ITEM_HATCHET_NAME:"Hatchet",ITEM_HOE_NAME:"Hoe",ITEM_PICKAX_NAME:"Pickax",ITEM_SHOVEL_NAME:"Shovel",ITEM_ANEMONE_NAME:"Unknown Anemone",ITEM_CORAL_TUBES_NAME:"Unknown Coral Tubes",ITEM_DISC_CORAL_NAME:"Unknown Disc Coral",ITEM_LIQUID_NAME:"Unknown Liquid",ITEM_PLANT_NAME:"Flower Seed",ITEM_SEASHELL_NAME:"Unknown Seashell",ITEM_STARFISH_NAME:"Unknown Starfish",ITEM_UNKNOWNID_NAME:"Unknown Item",LBL_RECIPE_INPUT_BERRY:"Berry",LBL_RECIPE_INPUT_BINDING:"Binding",LBL_RECIPE_INPUT_BOTTLE:"Bottle",LBL_RECIPE_INPUT_CATALYST:"Catalyst",LBL_RECIPE_INPUT_COLOR:"Color",LBL_RECIPE_INPUT_FOCUS:"Focus",LBL_RECIPE_INPUT_FUEL:"Fuel",LBL_RECIPE_INPUT_GRINDABLE:"Grindable",LBL_RECIPE_INPUT_HAFT:"Haft",LBL_RECIPE_INPUT_HEAD:"Head",LBL_RECIPE_INPUT_INGREDIENT:"Ingredient",LBL_RECIPE_INPUT_LIFE:"Life",LBL_RECIPE_INPUT_MATERIAL:"Material",LBL_RECIPE_INPUT_METAL:"Metal",LBL_RECIPE_INPUT_PRIMARY:"Primary",LBL_RECIPE_INPUT_SPINE:"Spine",LBL_RECIPE_INPUT_TOOL:"Tool",LBL_RECIPE_TAG_CONSUMABLE:"Consumable",LBL_RECIPE_TAG_CRAFTING_MAT:"Crafting material",LBL_RECIPE_TAG_FUEL:"Fuel",LBL_RECIPE_TAG_INGREDIENT:"Ingredient",LBL_RECIPE_TAG_PLACEABLE:"Placeable",MAT_UNKNOWN:"Unknown",RECIPE_ALLOY_DESC:"Two refined metals combined into an alloy",RECIPE_ALLOY_NAME:"Alloy Ingot",RECIPE_BRICK_CLAY_DESC:"Dried clay",RECIPE_CAMPFIRE_DESC:"Roast stuff!",RECIPE_CAMPFIRE_NAME:"Cooking",RECIPE_CAMPFIRE_UNKNOWN_NAME:"Food",RECIPE_CHARCOAL_DESC:"A lump of coal",RECIPE_CHARCOAL_NAME:"Charcoal",RECIPE_CHARCOAL_SLOW_DESC:"A slowly burned lump of coal",RECIPE_CHARCOAL_SLOW_NAME:"Charcoal",RECIPE_CORD_DESC:"Binding made from plant fiber",RECIPE_DOWSER_ADVANCED_DESC:"Tool for finding veins of stone which may contain ore",RECIPE_DOWSER_SIMPLE_DESC:"Tool for detecting nearby ore",RECIPE_GROWSTICK_REPAIR_DESC:"Recharge an existing Grimoire",RECIPE_GROWSTICK_REPAIR_NAME:"G.R.O.W. Recharge",RECIPE_GROWSTICK_NAME:"G.R.O.W.",RECIPE_GROWSTICK_DESC:"Grimoire of Radiant Organic Wonders",RECIPE_GLASS_BOTTLE_DESC:"An empty glass bottle",RECIPE_GLASS_BOTTLE_NAME:"Glass Bottle",RECIPE_GLASS_DESC:"Transparent block",RECIPE_HATCHET_DESC:"Tool for gathering wood",RECIPE_HOE_DESC:"Tool for tilling dirt to allow planting crops",RECIPE_INGOT_DESC:"Refined metal",RECIPE_INGOT_NAME:"Metal Ingot",RECIPE_JUICE_DESC:"Healthy Juice!",RECIPE_METAL_BUCKET_DESC:"Tool for watering crops and transporting water",RECIPE_METAL_BUCKET_NAME:"Metal Bucket",RECIPE_METAL_ROD_DESC:"Thin straight bar",RECIPE_METAL_ROD_NAME:"Metal Rod",RECIPE_METAL_TOOL_HEAD_CAST_DESC:"Head for constructing tools",RECIPE_METAL_TOOL_HEAD_CAST_NAME:"Metal Tool Head",RECIPE_METAL_TOOL_HEAD_DESC:"Head for constructing tools",RECIPE_METAL_TOOL_HEAD_NAME:"Metal Tool Head",RECIPE_MILL_DESC:"Grind something into a new ingredient!",RECIPE_MILL_NAME:"Grind",RECIPE_MILL_UNKNOWN_NAME:"Ingredient",RECIPE_MIXED_PAINT_DESC:"Mix paint to get new colors",RECIPE_MIXED_PAINT_NAME:"Mixed Paint",RECIPE_OVEN_DESC:"Mix something together!",RECIPE_OVEN_NAME:"Cooking",RECIPE_OVEN_UNKNOWN_NAME:"Food",RECIPE_PAINT_COLOR_DESC:"Refine paint from colorful berries and seeds ",RECIPE_PAINT_COLOR_NAME:"Color Paint",RECIPE_PAINTED_WOOD_DESC:"Brightly colored wood planks",RECIPE_PAINTED_WOOD_NAME:"Painted Wood",RECIPE_PICKAX_DESC:"Tool for gathering stone",RECIPE_PLANKS_DESC:"Refined wood",RECIPE_PLANKS_NAME:"Wooden Planks",RECIPE_SHOVEL_DESC:"Tool for gathering dirt",RECIPE_SPICY_JUICE_DESC:"Spicy juice!",RECIPE_SPICY_JUICE_NAME:"Spicy Juice",RECIPE_STONE_BRICKS_DESC:"Refined stone",RECIPE_STONE_TOOL_HEAD_DESC:"Head for constructing tools",RECIPE_TOOL_REPAIR_DESC:"Repair an existing tool",RECIPE_TOOL_REPAIR_NAME:"Tool Repair",RECIPE_TOOL_REPAIR_WARNING_MISMATCH:"Minimal repair due to material mismatch",RECIPE_TOOL_REPAIR_WARNING_REDUCED:"Reduced repair due to ingot used",RECIPE_TOOL_REPAIR_WARNING_WASTEFUL:"Repair is wasteful",RECIPE_ARBORHEART_DESC:"Nurture nature into the heart of a tree",RECIPE_ARBORHEART_NAME:"Arborheart",RECIPE_UKNOWN:'Unknown recipe "{val}"',RECIPE_VEINIUM_GRIND_DESC:"Grind Veinium into ore based on the location of the grinder",RECIPE_WOOD_BUCKET_DESC:"Tool for watering crops and transporting water",RECIPE_WOOD_BUCKET_NAME:"Wood Bucket",RECIPE_WOOD_ROD_DESC:"Thin straight bar",RECIPE_WOOD_ROD_NAME:"Wood Rod"}},{}],130:[function(e,t,r){t.exports={FORMAT_ADD_COLON:"{val}:",FORMAT_ADD_ELLIPSIS:"{val}...",FORMAT_ADD_PARENTHESES_AFTER:"{val} ({detail})",FORMAT_ADD_PERCENTAGE:"{val}%",FORMAT_INPUT_MERGE:"[{key}]{command}",FORMAT_INPUT_PREPEND:"[{key}] {command}",FORMAT_SEPARATOR_COLON:": ",FORMAT_SEPARATOR_COMMA:", ",FORMAT_SEPARATOR_WORDS:" ",BTN_ACCEPT:"Aceitar",BTN_CANCEL:"Cancelar",BTN_CREATE_USER:"Criar utilizador",BTN_DELETE:"Eliminar",BTN_DOWNLOAD:"Download",BTN_EQUIP:"Equip",BTN_EXIT_TO_MAIN_MENU:"← Sair para Menu Principal",BTN_GET_LINK:"Obter link",BTN_GET_WORLD_LINK:"Obter Link de mundo",BTN_INFO:"Informação",BTN_INVITE_PLAY:"Convidar",BTN_INVITE_TO_WORLD:"Convidar para o mundo",BTN_LOGIN:"Iniciar sessão",BTN_LOGOUT:"Terminar sessão",BTN_NEW_USER:"Novo utilizador",BTN_NO:"Não",BTN_OK:"OK",BTN_PROCESSING:"A processar...",BTN_RANDOM:"Casual",BTN_REMOVE:"Remover",BTN_REMOVE_SPOTLIGHT:"Remover destaque",BTN_RENAME:"Renomear",BTN_RETRY:"Tentar novamente",BTN_SAVE:"Guardar",BTN_SHARE:"Partilhar",BTN_SHARE_WORLD:"Partilhar mundo",BTN_SHARING:"A partilhar...",BTN_SORT_ALPHABETICALLY:"A-Z",BTN_SUBMIT:"Submeter",BTN_TAKE:"Tirar",BTN_TAKE_PHOTO:"Tirar fotografia",BTN_YES:"Sim",CHATERROR_RUNNING_CMD:"Erro ao executar {val}: {val_2}",DLG_ERROR_IMAGE_UPLOAD_TITLE:"Erro ao carregar imagens",DLG_ERROR_TITLE:"Erro",DLG_SHARE_TITLE:"Partilhar",DLG_SHARE_WG_TITLE:"Partilhar Waygate",ERR_WORLD_DISCONNECTED:"Desligado do mundo",CHATERROR_EMPTY_RESPONSE:"Resposta vazia",INPUT_CLICK:"Clicar",INPUT_CLICK_LEFT:"Clique esquerdo",INPUT_CLICK_MIDDLE:"Clique com botão do meio",INPUT_CLICK_RIGHT:"Clique direito",INPUT_DRAG_QBAR:"arrastar barra rápida",INPUT_KEY_CTRL_CLICK:"Ctrl+Clique",INPUT_KEY_DEL:"Del",INPUT_KEY_ENTER:"Enter",INPUT_KEY_SHIFT:"Shift",INPUT_KEY_SHIFT_CLICK:"Shift+Clique",INPUT_KEY_SPACE:"Espaço",INPUT_KEY_TAB:"Tab",INPUT_TAP:"Toque",INPUT_TAP_DOUBLE:"Duplo toque",LBL_AUTHOR:"Autor",LBL_BUILD_MENU:"Menu de Construção",LBL_CONFIRM_PASSWORD:"Confirmar palavra-passe",LBL_DESCRIPTION:"Descrição",LBL_DISPLAY_NAME:"Nome de apresentação",LBL_ELAPSED_TIME:"Hora",LBL_ENERGY_WELL:"Poço de Energia",LBL_EMAIL:"E-mail",LBL_ERROR:"Erro",LBL_EXIT_MENU:"Sair do menu",LBL_FIELD_OF_VIEW:"Campo de Visão",LBL_MENU:"Menu",LBL_NAME:"Nome",LBL_NEW_WORLD:"Novo mundo",LBL_NUMBERED_WORLD:"Mundo #{val}",LBL_PASSWORD:"Palavra-passe",LBL_PRIVACY_POLICY:"Política de Privacidade",LBL_RECIPE:"Receita",LBL_REQUIRES:"Requer",LBL_RESULTS:"Resultados",LBL_TERMS_OF_SERVICE:"Termos de Serviço",LBL_UNKNOWN_WORLD_ID:"???",LBL_UNKNOWN_WORLD_NAME:"Mundo desconhecido",LBL_USERNAME:"Nome de utilizador",LBL_USER_ID:"ID do utilizador",LBL_VERSION:"Versão",LBL_VIEW_INFO:"Ver info",LBL_WORLD_NAME:"Nome do mundo",LBL_WORLD_URL:"URL do mundo",MSG_INVENTORY_FULL:"Inventário cheio",MSG_LOADING:"A carregar...",MSG_OUT_OF_SETTLEMENT_ALERT:"A indústria só funciona dentro de Povoações.",MSG_PLEASE_WAIT:"Por favor, aguarde…",MSG_SAVED:"Guardado.",MSG_SAVING:"A guardar...",TLTP_PLACE_IN_QB:"Colocar na barra rápida",BTN_CREATE_AREA:"Criar Área",LBL_ACCESS_PRESET_BUILD:"Qualquer um pode construir",DISCLAIMER_CREATE_ACCOUNT:"Ao criar uma conta, concorda com os",DISCLAIMER_LOGIN:"Ao iniciar sessão, concorda com os nossos",DISCLAIMER_TOS_PP_SEPARATOR:"e",DLG_AUTO_LOGGIN_FAILED_TITLE:"Falha ao iniciar sessão",DLG_LOGIN_ERROR_TITLE:"Erro de Login",DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE:"Falha ao enviar email de ativação",DLG_PLATFORM_LOGIN_FAILED_TITLE:"Falha ao iniciar sessão de {val}",DLG_SHARE_USER_ID_TITLE:"O seu ID de utilizador",LBL_EXTERNAL_LOGINS:"Ou iniciar sessão com",LBL_LOGGED_IN_AS:"Autenticado como",LOGINMSG_AUTO_LOGGING_IN:"A iniciar sessão automaticamente...",LOGINMSG_CONNECTING:"A estabelecer ligação...",LOGINMSG_LOGGING_IN:"A iniciar sessão...",LOGINMSG_LOGGING_OUT:"A terminar sessão...",LOGINMSG_NEW_VERSION:"Nova versão disponível!",LOGINMSG_RELOAD_PAGE:"Atualize a página.",LOGINMSG_RESTART_OR_UPDATE_APP:"Reinicie ou atualize a aplicação.",LOGINMSG_SERVER_RESTARTING:"A reiniciar o servidor...",LOGINMSG_TRY_AGAIN:"Por favor, tente de novo mais tarde.",LOGINMSG_UNDER_MAINTENANCE:"O jogo está em manutenção.",LOGINMSG_UPDATE_APP:"Atualize a aplicação.",COSTUME_UNKNOWN:"Desconhecido",DLG_DELETE_BP_MSG:"Tem a certeza de que pretende eliminar esta planta ({val})?",DLG_DELETE_BP_TITLE:"Eliminar planta?",DLG_ERROR_RENAMING_BP_TITLE:"Falha ao mudar o nome da planta",DLG_ERROR_SHARING_BP_TITLE:"Falha ao partilhar planta",DLG_REMOVE_BP_MSG:"Tem a certeza de que pretende remover esta planta ({val})?",DLG_REMOVE_BP_TITLE:"Remover planta da biblioteca?",DLG_RENAME_BP_MSG:'Introduza um novo nome para a planta "{val}"',DLG_RENAME_BP_TITLE:"Renomear plano",DLG_SHARE_BP_TITLE:"Partilha de planta",ERR_CMD_REQUIRES_OWNED_BP:"O comando requer uma planta editável pertencente a si.",MSG_BP_DELETED:"Planta eliminada",MSG_BP_REMOVED:"Planta removida da biblioteca",MSG_BP_RENAMED:"Planta renomeada",TLTP_DELETE_THIS_BP:"Eliminar esta planta",TLTP_HOLD_SKIP_CONFIRMATION:"(mantenha premido {val} para ignorar a confirmação)",TLTP_LINK_BP_GET:"Obtenha um link que qualquer pessoa possa usar para adicionar esta planta à sua biblioteca",TLTP_LINK_BP_SHARE:"Partilhar um link que qualquer pessoa pode usar para adicionar esta planta à sua biblioteca",TLTP_REMOVE_THIS_BP:"Remover esta planta da biblioteca",TLTP_RENAME_BP_FOR_ALL:"Renomeie a sua planta partilhada para TODOS os utilizadores",TLTP_RENAME_BP_IN_LIBRARY:"Renomeie esta planta na sua biblioteca",TLTP_SHARE_BP:"Crie uma nova cópia só de leitura desta planta para partilha ou uso posterior",BBOX_BP_DATA_ERROR:"Erro de dados da planta: {val}",BBOX_BP_DATA_LOADING:"Dados de planta a carregar...",BBOX_BP_IS_IN_YOUR_LIBRARY:"A planta está na sua biblioteca",BBOX_BP_SAVED:"Guardado!",BBOX_CANNOT_SAVE_OWNED_BY:"Não é possível guardar, a planta pertence a {val}",BBOX_INVALID_BP_ID:"ID de planta inválido",BBOX_MISSING_RESOURCES:"Não é possível construir completamente: falta de recursos",BBOX_MODIFIED_ELSEWHERE_MSG_EDIT:"Para editar esta planta com segurança, remova esta BlueBox e coloque uma nova.",BBOX_MODIFIED_ELSEWHERE_MSG_OVERWRITE:"Guardar aqui fará com que essas alterações sejam substituídas.",BBOX_MODIFIED_ELSEWHERE_MSG_WARNING:"Aviso: este planta foi modificada em outro lugar.",BBOX_MUST_CLEAR_BOUNDS:"Não é possível iniciar a edição: deve tirar dos limites as coisas acessórias",BBOX_NO_CHANGES_DETECTED:"Nenhuma alteração detetada",BBOX_NO_MATCHING_RESOURCES:"Não é possível depositar: não há recursos correspondentes",BBOX_OVERLAPS_ANOTHER_EDITED_BP:"Não é possível iniciar a edição: sobrepõe-se a outra planta editada",BBOX_OVERLAPS_EDITED_BP:"Não é possível construir: sobrepõe-se a planta editada",BBOX_REFRESHING_STATE:"A atualizar o estado...",BBOX_SOMETHING_BLOCKING:"Não é possível construir completamente: há algo a bloquear a construção ou a fundação",BBOX_TO_EDIT_FINISH_AND_PLACE:"Para editar esta planta, termine de construí-la e, em seguida, substitua a BlueBox",BBOX_WAITING_PREVIOUS_SAVE:"A aguardar que a gravação anterior seja concluída...",BTN_ADDING_TO_LIBRARY:"A adicionar...",BTN_ADD_TO_LIBRARY:"Adicionar à minha biblioteca",BTN_DEPOSIT_ALL:"Depositar tudo",BTN_REMOVE_BBOX:"Remover BlueBox",DLG_ERROR_ADDING_BP_TITLE:"Erro ao adicionar à biblioteca",DLG_UNSAVED_CHANGES_MSG:"Fez alterações que não foram guardadas. Não será possível guardar estas alterações nesta planta assim que a BlueBox for removida. Parar de editar?",DLG_UNSAVED_CHANGES_TITLE:"Alterações não guardadas",LBL_BLUEPRINT:"Planta",LBL_BLUEPRINT_ERROR:"Planta (Erro)",LBL_BLUEPRINT_LOADING:"Planta (A carregar...)",LBL_BLUEPRINT_STATUS:"Estado da planta",LBL_BP_VIEW:"Vista da planta",LBL_BP_VIEW_ERROR:"Vista da planta (Erro)",LBL_BP_VIEW_LOADING:"Vista da planta (A carregar...)",LBL_EDITABLE_BLUEPRINT:"Planta editável",LBL_LEFT_TO_BUILD:"Falta construir",LBL_NONE_RESOURCES:"Nenhum",LBL_REQUIRED_RESOURCES:"Recursos necessários",STATUSMSG_BBOX_CANNOT_EJECT:"A BlueBox não pode ejetar o excesso: não há lugar para deixar itens",STATUSMSG_BP_COMPLETELY_BUILT:"Planta completamente construída",STATUSMSG_BP_STILL_LOADING:"A planta ainda está a carregar. Por favor, tente de novo...",STATUSMSG_PREVIEWING_BP:"A pré-visualizar a planta. Selecione novamente para ver as opções",TLTP_DEPOSIT_RESOURCE:"Depositar {val} {val_2}",CHATERROR_SAVING_BP:"Erro ao guardar planta: {val}",CHATERROR_SAVING_BP_SNAPSHOT:"Erro ao guardar o instantâneo da planta: {val}",STATUSMSG_BP_SAVED:"Planta guardada",BTN_AFFORDABLE_ITEMS:"Acessível",BTN_ALLOCATING:"A alocar...",BTN_ALL_ITEMS:"Tudo",BTN_DETAILS:"Detalhes",BTN_ICONS:"Ícones",BTN_NEW_BP:"Novo",BUILDMENU_HINT_CRAFT_TOOLS_AND_CONSUMABLES:"As ferramentas e os consumíveis podem ser fabricados num Aetherbench ou noutros edifícios de Povoação",BUILDMENU_HINT_NEW_BP_MSG_CREATE:"Pode criar as suas próprias plantas!",BUILDMENU_HINT_NEW_BP_MSG_START:'Prima "Novo" acima para começar.',BUILDMENU_ITEM_NOT_FOUND:"Não encontrado",BUILDMENU_NOTHING_AFFORDABLE:"Nada acessível",BUILDMENU_NO_BP_AVAILABLE:"Nenhuma planta disponível",BUILDMENU_NO_TOOLS_OR_CONSUMABLES:"Sem ferramentas ou consumíveis no inventário",BUILDMENU_UNLOCK_SCHEMATICS:"Desbloqueie mais esquemas atualizando a sua Povoação no Waygate",DLG_QUOTA_EXCEEDED_MSG:"Já tem o número máximo ({val}) de plantas editáveis.",DLG_QUOTA_EXCEEDED_TITLE:"Quota excedida",ERR_MISSING_BLUEPRINT_ID:"ID de planta em falta",LBL_BLUEPRINTS:"Planta",LBL_CRAFTED_BLOCKS:"Blocos artesanais",LBL_NEW_BLUEPRINT:"Novo",LBL_PROPS:"Adereços",LBL_RAW_BLOCKS:"Blocos brutos",LBL_SEARCH_ALL:"Procurar tudo",LBL_SETTLEMENT:"Povoação",LBL_TOOLS_AND_CONSUMABLES:"Ferramentas e consumíveis",LBL_TOOLS_AND_FARMING:"Ferramentas e agricultura",TLTP_CLOSE_BUILD_MENU:"Fechar menu de Construção",TLTP_SELECT_AND_CLOSE_BUID_MENU:"Selecione e feche o menu de Construção",TLTP_SELECT_IN_QB_AND_VIEW:"Selecione na barra rápida e veja as informações",STATUSMSG_BP_NOT_ALLOWED:"Não tem permissão para colocar plantas neste mundo",STATUSMSG_DIG_NO_STAMINA_BUCKET:"Está demasiado exausto para usar o balde!",STATUSMSG_DIG_NO_STAMINA_DIG:"Está demasiado exausto para escavar!",STATUSMSG_DIG_NO_STAMINA_HINT:"Consuma alimentos ou volte ao seu Waygate através do Menu | Info mundo",STATUSMSG_DIG_NO_STAMINA_HOE:"Está demasiado exausto para usar a enxada!",STATUSMSG_DIG_NO_STAMINA_WATER:"Está demasiado exausto para recolher água!",STATUSMSG_DIG_WRONG_TIER_BREAK:"É necessário {val} de {val_2} para quebrar {val_3} {val_4}",STATUSMSG_DIG_WRONG_TIER_DECONSTRUCT:"É necessário {val} de {val_2} para desconstruir {val_3}",STATUSMSG_DIG_WRONG_TIER_GATHER:"É necessário {val} de {val_2} para recolher {val_3}",STATUSMSG_DIG_WRONG_TOOL:"{val} não é o tipo certo de ferramenta para recolher {val_2}",STATUSMSG_GROUND_WRONG_KIND:"Deve ser colocado em {val}",STATUSMSG_PLACE_BLOCKED:"Falha ao colocar o bloco, chegou lá outra coisa primeiro",STATUSMSG_PLACE_CHUNK_UNLOAD:"Falha ao colocar o bloco, pedaço descarregado",STATUSMSG_SETTLEMENT_OUT_OF_BOUNDS:"Aviso: a indústria só funciona dentro de Povoações",STATUSMSG_TOOL_BROKE:"Ferramenta quebrada :(",STATUSMSG_TOOL_BROKE_REPAIR:"Ferramenta quebrada, mas pode ser reparada numa Bigorna",STATUSMSG_TOOL_BROKE_REPLACE:"Ferramenta quebrada, substituição autoequipada",STATUSMSG_TOOL_CUSTOM_NOT_ALLOWED:"As ferramentas personalizadas não são permitidas neste mundo",PAGETITLE_DMCA:"FRVR: DMCA",PAGETITLE_GDPR:"FRVR: Regulamento Geral sobre a Proteção de Dados",PAGETITLE_PRIVACY_POLICY:"FRVR: Política de Privacidade",PAGETITLE_TERMS_OF_SERVICE:"FRVR: Termos de Serviço",PAGETITLE_UPDATES:"Atualizações",CHATERROR_INVALID_POS_STRING:"Cadeia de posição inválida: {val}",MSG_NOWHERE_TO_SIT:"Não há onde se sentar.",STATUSMSG_CANNOT_SPRINT:"Não é possível dar sprint, sem {val}",STATUSMSG_CONSUME_OR_RETURN:"Consuma alimentos ou volte ao seu Waygate através do Menu | Info mundo",CONTINENT_LOADER_COMPLETE:"Geração de continente completa",CONTINENT_LOADER_NEW:"A gerar novo continente...",CONTINENT_LOADER_SYNCING:"A sincronizar continente com o servidor...",BTN_DOWN:"Baixo",BTN_JUMP:"Saltar",BTN_UP:"Cima",STATUSMSG_STUCK_DIG_OR_WG:"Está bastante preso! Escave para sair ou use o gate para escapar.",STATUSMSG_STUCK_MENU_OR_LEAVE:"Está bastante preso! Use o menu para usar o Waygate noutro lugar ou sair do mundo.",COSMETIC_COSTUME_2021_12_SANTA_HAT:"Chapéu de Pai Natal '21",COSMETIC_COSTUME_2021_12_SNOWMAN:"Boneco de neve '21",COSMETIC_COSTUME_2021_12_SWEATER_1:"Camisola #1 '21",COSMETIC_COSTUME_2021_12_SWEATER_2:"Camisola #2 '21",COSMETIC_COSTUME_CAPTAIN:"Capitão",COSMETIC_COSTUME_GNARL_SHAMAN:"Gnarl Shaman",COSMETIC_COSTUME_MORTARI_SKELETON_MINION:"Minion Esqueleto",COSMETIC_COSTUME_VILLAGER_1:"Aldeão #1",COSMETIC_COSTUME_VILLAGER_2:"Aldeão #2",COSMETIC_COSTUME_VILLAGER_3:"Aldeão #3",COSMETIC_COSTUME_VILLAGER_4:"Aldeão #4",CMODS_DIG_DURABILITY:"Durabilidade",CMODS_DIG_RATE:"Velocidade",CMODS_NOT_GOOD:"Não pode ser bom...",CMODS_O2_CAPACITY:"Capacidade de O2",CMODS_RANDOM_BONUSES:"+{val}-{val_2} bónus aleatórios",CMODS_RARITY_COMMON:"Frequente",CMODS_RARITY_RARE:"Raro",CMODS_RARITY_UNCOMMON:"Pouco frequente",CMODS_STAMINA_CAPACITY:"Capacidade de {val}",CMODS_STAMINA_DRAIN:"Consumo de {val}",CMODS_STAMINA_RANGE:"Faixa",CMODS_STAMINA_RATE:"Menos uso de {val}",CMODS_TIMED:"{val} {val_2} por {val_3}",CMODS_TIMED_DIG_RATE:"Velocidade de recolha",CMODS_TIMED_SPRINTING_STAMINA:"{val} de sprint",CMODS_TIMED_STAMINA:"{val}/segundo",CMODS_TIMED_STAMINA_CAPACITY_WGSICK:"{val} (Doença de Waygate)",BTN_DRINK:"Bebida",ENERGYWELL_CANCEL_SICKNESS:"Nota: o tempo de bónus irá cancelar essa quantidade de Doença de Waygate",ENERGYWELL_CANCEL_SICKNESS_SOME:"Nota: algum tempo de bónus irá cancelar a sua Doença de Waygate",ENERGYWELL_FULL:"Já tem o máximo de {val}",ENERGYWELL_LAST_DRINK:"A sua última bebida foi há {val}",ENERGYWELL_MUST_VISIT:"Visite o Poço de Energia no mundo para beber...",ENERGYWELL_READY:"Pronto!",ENERGYWELL_RECHARGING:"O Poço de Energia ainda está a recarregar...",LBL_CURRENT_ENERGY:"{val} atual",LBL_OVERFILL_ENERGY:"Excesso: +{val} por {val_2}",LBL_REFILL_ENERGY:"Recarregar {val}",LBL_WELL_RESTED:"Descansado: +{val} por {val_2}",STATUSMSG_ENERGY_WELL_ADD:"+{val} (Poço de Energia)",BTN_FINISH:"Terminar",ERR_CRAFTING_CANNOT_COMPLETE:"Armazenamento cheio: a criação não pode ser concluída",ERR_CRAFTING_STALLED:"Armazenamento cheio: criação parada",ERR_INSUFFICIENT_RESOURCES:"Não é possível criar: recursos insuficientes carregados",ERR_INVALID_INPUT:"Não é possível criar: combinação de entrada inválida",FACTORY_CRAFTING_COMPLETE:"Criação concluída: leve isto para continuar",FACTORY_CRAFTING_IN_PROGRESS:"Criação em curso... Volte mais tarde!",FACTORY_FULL_INVENTORY:"Não é possível levar: inventário cheio",FACTORY_NO_RECIPES_AVAILABLE:"Nenhuma receita disponível",FACTORY_PROGRESS_READY:"Pronto!",FACTORY_REFRESHING_CONTENTS:"A atualizar o conteúdo...",FACTORY_UPGRADE_SETTLEMENT_TO_UNLOCK:"Atualize a sua Povoação para desbloquear",FORMAT_CRAFTING_PROGRESS:"{val} ({val_2})",FORMAT_NUMBER_OR_MORE:"{val}+",LBL_CRAFTING_COMPLETE:"Criação completa!",LBL_MISSING_PROP:"Adereço em falta",LBL_NO_RECIPE_SELECTED:"Nenhuma receita selecionada",LBL_OUTPUT_MULTIPLE:"{val} (x{val_2})",LBL_REFRESHING_FACTORY:"A atualizar...",LBL_SELECT_RECIPE:"Selecionar receita",RECIPELIST_ALL_UNLOCKED_FOR_STATION:"Todas as receitas desta estação desbloqueadas!",RECIPELIST_EVEN_MORE_FROM_LATER_UPGRADES:"Ainda mais receitas disponíveis de upgrades posteriores",RECIPELIST_UNLOCK_MORE_BY_UPGRADING:"Desbloqueie mais receitas ao atualizar a sua Povoação",RECIPELIST_UPGRADE_SETTLEMENT_TO_UNLOCK:"Atualize a sua Povoação no Waygate para desbloquear",STATUSMSG_CANNOT_CHANGE_RECIPE_NO_SPACE:"Não é possível alterar a receita: espaço insuficiente para ejetar entradas carregadas",STATUSMSG_SOME_ITEMS_DROPPED:"Alguns itens caíram ao chão",TLTP_ADD_TO_RECIPE:"Adicionar à receita",TLTP_ENOUGH_FOR_ONE:"(suficiente para um)",HUDS_GEM_FOUND_ALL:"Todas as joias {val} encontradas!",HUDS_GEM_FOUND_ONE:"{val} joia encontrada!",HUDS_IN_SETTLEMENT:'Na povoação "{val}"',HUDS_IN_THE_WILDS:"Em terreno selvagem",STATUSMSG_ITS_DARK:"Está muito escuro! {val}",STATUSMSG_STAMINA_DAMAGE:"-{val} ({val_2})",STATUSMSG_STAMINA_MODS:"{val} {val_2} {val_3}",TLTP_WORLD_CLICK_TO_LIKE:"Clique para gostar deste mundo",TLTP_WORLD_LIKED:"Gosta deste mundo!",DLG_ERROR_GETTING_PHOTO_TITLE:"Erro ao obter foto",DLG_INITIALIZING_PURCHASE_TITLE:"A iniciar compra",DLG_INVITING_TITLE:"A convidar!",DLG_OFFICIAL_GROUP_TITLE:"A obter o grupo oficial",DLG_OFFICIAL_PAGE_TITLE:"A obter a página oficial",DLG_PURCHASE_FAILED_PROCESS_MSG:"Erro ao processar a compra: {val}",DLG_PURCHASE_FAILED_SYNC_MSG:"A compra foi bem-sucedida, mas não foi possível sincronizar. Tente atualizar a página. Erro = {val}",DLG_PURCHASE_SUCCESSFUL_MSG:"Muito obrigado pela compra!",DLG_PURCHASE_SUCCESSFUL_TITLE:"Compra bem-sucedida",DLG_SHARE_BLUEPRINT_MSG:"Planta Worlds FRVR | {val}",DLG_SHARE_WORLD_CURRENT_JOIN:"Entrar em {val}",DLG_SHARE_WORLD_FRIEND_INVITING_MSG:"{val} enviou um convite para jogar em {val_2} no Worlds FRVR!",DLG_SHARE_WORLD_FRIEND_JUST_PLAYED_MSG:"{val} acabou de jogar {val_2}!",DLG_SHARING_BLUEPRINT_TITLE:"A partilhar planta",DLG_SHARING_PHOTO_TITLE:"A partilhar foto",DLG_SHARING_WORLD_TITLE:"A partilhar mundo",ERR_FB_PURCHASE_NOT_LOGGED:"Sem sessão iniciada",ERR_FB_PURCHASE_NOT_READY:"Pagamentos FB não prontos",ERR_LOAD_BLUEPRINT_IMAGE:"Não foi possível carregar a imagem de planta",ERR_LOAD_WORLD_IMAGE:"Não foi possível carregar",FBINSTANT_SHARE_PHOTO:"Foto Worlds FRVR",FBINSTANT_SHARE_WORLD:"Worlds FRVR | {val}",ERR_CUSTOM_TEXTURES_NOT_ALLOWED:"Texturas personalizadas não permitidas",ERR_INVALID_DATA_HEADER:"Cabeçalho de dados inválido: {val}",BTN_BUY_NOW:"Comprar agora!",BTN_BUY_NOW_PRICE:"Comprar agora! {val}",BTN_COMING_SOON:"Em breve!",BTN_CONSUME:"Consumo",BTN_DROP:"Soltar",BTN_PUT:"Colocar",BTN_PUT_ALL:"Colocar tudo",BTN_QUICK_DEPOSIT:"Depósito rápido",BTN_SORT:"Ordenar",BTN_SPLIT:"Dividir",BTN_TAKE_ALL:"Levar tudo",BTN_USE:"Usar",DLG_CANNOT_PURCHASE_MSG:"Não é possível comprar: sem sessão iniciada ou desligado",DLG_DISPLAY_NAME_CHANGED_MSG_NEW:"Nome de apresentação alterado para {val}!",DLG_DISPLAY_NAME_CHANGED_MSG_USERID:"O seu ID de utilizador continua a {val}.",DLG_DISPLAY_NAME_CHANGED_TITLE:"Nome de apresentação alterado",DLG_DISPLAY_NAME_ERROR_MSG:"Não é possível renomear: ligação perdida",DLG_DISPLAY_NAME_MSG:"Introduza um novo nome para si",DLG_DISPLAY_NAME_TITLE:"Nome de apresentação",DLG_FIND_MORE_GEMS_MSG:"Pode encontrar joias em mundos em destaque e mundos vencedores de concursos anteriores.",DLG_NEED_MORE_CURRENCY_COST_MSG:"Custo",DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG:"As suas joias",DLG_NEED_MORE_GEMS_MSG:'Precisa de mais joias para comprar "{description}".',DLG_NEED_MORE_GEMS_TITLE:"São precisas mais joias",DLG_PROCESSING_PURCHASE_TITLE:"A processar compra",DLG_PURCHASE_CONFIRMATION_MSG:'Tem a certeza de que deseja comprar "{description}"?',DLG_PURCHASE_CONFIRMATION_TITLE:"Confirmação de compra",DLG_PURCHASE_FAILED_CUSTOM_MSG:"Ocorreu um erro na compra. Erro = {error}.",INVENTORYUI_AMOUNT_INSUFFICIENT:"({val} curto)",INVENTORYUI_AMOUNT_ONE:"(um)",INVENTORYUI_INVENTORY:"inventário",INVENTORYUI_MISSING_CONTAINER:"Contentor em falta",INVENTORYUI_REFRESHING_CONTENTS:"A atualizar o conteúdo...",LBL_TRANSFER:"Transferir",STATUSMSG_CANNOT_DROP:"Não é possível soltar: não foi possível encontrar espaço vazio",STATUSMSG_CANNOT_PUT:"Não é possível colocar tudo: {val} cheio",STATUSMSG_CANNOT_TAKE:"Não é possível levar tudo: {val} cheio",STATUSMSG_QUICK_DEPOSIT_FAIL_FULL:"O Depósito Rápido falhou: contentor cheio",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_CONTAINERS:"O Depósito Rápido falhou: nenhum contentor nas proximidades",STATUSMSG_QUICK_DEPOSIT_FAIL_NO_MATCH:"O Depósito Rápido falhou: nada corresponde aos contentores próximos",STATUSMSG_QUICK_DEPOSIT_FAIL_PARTIAL:"Depósito Rápido parcialmente completo: contentor cheio",STATUSMSG_QUICK_STORE_FAIL_FULL:"Não é possível armazenar rapidamente: {val} cheio",TLTP_ADD_QUICKBAR:"Adicionar à barra rápida e sair do menu",TLTP_CHANGE_NAME:"Mudar nome de apresentação",TLTP_DEPOSIT_ALL_NEARBY:"Deposite todos os itens em contentores próximos com itens correspondentes",TLTP_DROP:"Soltar",TLTP_EQUIPMENT_EQUIP:"Equip",TLTP_EQUIPMENT_SLOT:"Slot de equipamento para {val}",TLTP_EQUIPMENT_SLOT_DEFAULT_CRUDE_TOOLS:"(Vazio, a usar a ferramenta bruta padrão)",TLTP_EQUIPMENT_SLOT_DEFAULT_TOOLS:"(Vazio, a usar a ferramenta padrão)",TLTP_EQUIPMENT_SPLIT_STACK:"Dividir pilha",TLTP_EQUIPMENT_UNEQUIP:"Desequipar",TLTP_ITEM_IN_TRASH:"{val} (no lixo)",TLTP_NEXT_SKIN:"Próxima skin",TLTP_PREVIOUS_SKIN:"Skin anterior",TLTP_SORT_AND_STACK:"Ordenar e empilhar itens",TLTP_STACK:"{val} (pilha)",TLTP_TRASH:"Lixo",TLTP_TRASH_EMPTY:"Esvaziar o lixo",DLG_ERROR_INVENTORY_RESET_MSG:"Tente atualizar a aplicação ou página se persistir.",DLG_ERROR_INVENTORY_RESET_TITLE:"Erro ao repor inventário",INVENTORY_ITEM_LABEL_HATCHET:"recolher madeira (Machado)",INVENTORY_ITEM_LABEL_PICKAX:"recolher pedra (Picareta)",INVENTORY_ITEM_LABEL_SHOVEL:"recolher terra (Pá)",STATUSMSG_CANT_GRANT_INVENTORY_LOCKED:"Não foi possível conceder itens: inventário bloqueado",STATUSMSG_ITEM_ADD:"+{val} {val_2} ({val_3})",STATUSMSG_ITEM_AUTO_EQUIP:"Autoequipado: {val}",STATUSMSG_ITEM_AUTO_GRANT:"Concedido automaticamente: {val}",STATUSMSG_ITEM_REMOVED:"Removido: {val}",ITEMINFO_CANT_AFFORD_ALERT:"Não pode construir isto.",ITEMINFO_NOT_IN_INVENTORY_ALERT:"Não tem isto no seu inventário.",ITEMINFO_SETTLEMENT_LOCKED_ALERT:"Isto ainda não está desbloqueado na sua Povoação atual.",ITEMINFO_UNLIMITED_ONLY_ALERT:"Isto só pode ser construído diretamente em mundos no Modo Ilimitado.",LBL_BUILD_COST:"Custo de construção",LBL_CRAFTED_BY:"Criado por",LBL_CRAFT_FROM:"Criado a partir de",LBL_CRAFT_FROM_AMOUNT:"{val} criado a partir de",LBL_EXAMPLES:"Exemplos",LBL_ITEM_CONTEXT_BUILD:"(Contruir)",LBL_ITEM_CONTEXT_ITEM:"(Item)",LBL_ITEM_CONTEXT_RECIPE:"(Receita)",LBL_ITEM_CONTEXT_SETTLEMENT_UPGRADE:"(Upgrade de Povação)",TLTP_VIEW_BUILD_INFO:"Ver informações de construção",TLTP_VIEW_CRAFT_COST:"Ver custo de criação",TLTP_VIEW_ITEM_INFO:"Ver informações do item",ERR_LANGUAGE_NOT_FOUND:'Idioma "{val}" não suportado',MSG_LANGUAGE_GET:"O idioma atual é {val}",MSG_LANGUAGE_SET:"O idioma mudou para {val}",MSG_COPY_TEXT_FAILURE:"FALHA ao copiar para a área de transferência, copie abaixo.",MSG_COPY_TEXT_SUCCESS:"Texto copiado para a área de transferência!",WINDOW_TITLE:"Worlds FRVR",WINDOW_TITLE_COMPOSITE:"{val} | Worlds FRVR",BTN_JOIN_OUR_GROUP:"Junte-se ao nosso Grupo!",BTN_LATEST_NEWS:"Últimas notícias",BTN_PLAY:"Jogar",BTN_RECENT_UPDATES:"Atualizações recentes",DLG_ACCESS_TOKEN_APPLIED_TITLE:"Token de acesso aplicado",DLG_ERROR_ACCESS_TOKEN_TITLE:"Erro de token de acesso",DLG_ERROR_WORLD_CREATE_TITLE:"Erro ao criar mundo",DLG_ERROR_WORLD_DELETE_TITLE:"Erro ao eliminar mundo",DLG_ERROR_WORLD_FORGET_TITLE:"Erro ao esquecer mundo",DLG_ERROR_WORLD_PASSWORD_TITLE:"Erro de palavra-passe de mundo",DLG_NEW_WORLD_NAME_MSG:"Introduza um nome para o seu novo mundo",GAME_MODE_LOST_FRONTIER:"Lost Frontier",GAME_MODE_LOST_FRONTIER_BETA:"Lost Frontier - BETA",GAME_MODE_UNLIMITED:"Ilimitado",LBL_ACCESS_TOKEN_ENTER:"Insira o Token de Acesso",LBL_CONTINENT_DATA_MOD:"Dados do continente fornecidos pelo mod",LBL_DISCORD_WORLDS:"Discord de mundos",LBL_DMCA:"DMCA",LBL_FEATURED_WORLDS:"Mundos em destaque",LBL_FRIENDS_IN_WORLD:"Amigos no mundo",LBL_GAME_MODE:"Modo de jogo",LBL_GDPR:"RGPD",LBL_MEANWHILE_CHECK_OUT:"Entretanto, veja",LBL_MY_WORLDS:"Os meus mundos",LBL_SEARCH:"Pesquisar",LBL_WORLDS:"Mundos",LBL_WORLDS_ACTIVE:"Mundos ativos",LBL_WORLDS_ACTIVE_AND_RECENT:"Mundos ativos e recentes",LBL_WORLDS_RECENT:"Mundos recentes",LBL_WORLD_PASSWORD_ENTER:"Introduza a palavra-passe do mundo",LBL_WORLD_SEED:"Seed do mundo",LBL_WORLD_SEED_ENTER:"Introduza uma seed aleatória para o seu novo mundo",LBL_WORLD_SEED_SHORT:"Seed",LBL_WORLD_TYPE:"Tipo de mundo",LOGINMSG_RECONNECTING:"Ligação perdida, a tentar restabelecer a ligação ({val})...",MSG_ACCESS_TOKEN_VALIDATING:"A validar o token de acesso...",MSG_ACTIVE_WORLDS_NOT_FOUND:"Nenhum mundo ativo encontrado",MSG_ACTIVE_WORLDS_QUERYING:"A consultar",MSG_PASSWORD_VALIDATING:"A validar a palavra-passe...",MSG_REDDIT_FOR_MORE_INFO:"Veja {val} para mais informações!",MSG_SEARCHING:"A pesquisar...",MSG_SERVER_NEEDS_ACCESS_TOKEN:"Este servidor requer um Token de Acesso.",MSG_WORLDS_CREATE_NEEDS_INVITE:"Nota: a criação de novos mundos é atualmente apenas para convidados",PAGETITLE_CREATE_NEW_WORLD:"Criar novo mundo",SETTING_AUTO_FULLSCREEN_HELP:"Entrar automaticamente em ecrã completo ao clicar em Jogar no menu principal, se disponível",SETTING_NOT_AVAILABLE_ON_DEVICE:"Não disponível neste dispositivo",TLTP_SEARCH_WORLDS_ALL:"Pesquisar todos os mundos",TLTP_SEARCH_WORLDS_BUILDER:"Pesquisar apenas mundos onde pode construir",TLTP_SORT_BY_LIKES:"Ordenar por gostos",TLTP_SORT_BY_NAME:"Ordenar por nome",TLTP_SORT_BY_VIEWS:"Ordenar por visualizações",WORLD_CREATE_BETA_WARN_MSG:"Estamos a desenvolver ativamente conteúdo de jogabilidade, adicionando nova geração processual e reformulando conteúdos. Durante este período beta, muitas coisas podem ser removidas, mudadas ou ficar danificadas.",WORLD_CREATE_BETA_WARN_TITLE:"Construa por sua conta e risco!",WORLD_TYPE_FLAT:"Flat (persistente)",WORLD_TYPE_GENERATED_V1:"Gerado V1",WORLD_TYPE_SMALL:"Pequeno",DLG_GENERATE_TOKENS_TITLE:"Gerar tokens",ERR_INVALID_BP_ID:"ID de planta inválido",ERR_INVALID_PHOTO_ID:"ID de foto inválido",ERR_PROP_FAR_AWAY:"{val} demasiado longe",ERR_PROP_MISSING:"{val} em falta",LBL_BUILD_BLUEPRINT:"Construir/Planta",LBL_CHARACTER:"Personagem",LBL_CONTAINER:"Contentor",LBL_FRIENDS:"Amigos",LBL_INVENTORY_CHARACTER:"Inventário/Personagem",LBL_QUICKSLOT:"Quick-Slot",LBL_SETTINGS:"Definições",LBL_WAYGATE:"Waygate",LBL_WORLD_INFO:"Informações do mundo",PAGETITLE_BLUEPRINT:"{val} (Planta)",DLG_API_ACCESS_MSG:"Um mod em {val} está a pedir acesso. O acesso persistirá até atualizar a página. Permitir?",DLG_API_ACCESS_TITLE:"Acesso de API Mod",BTN_CONTROLLING_CAMERA:"A controlar: câmara",BTN_CONTROLLING_PLAYER:"A controlar: jogador",BTN_EXIT_PHOTO_MODE:"Sair do modo de foto",BTN_HIDE_SELF:"Ocultar-se",BTN_RETAKE_PHOTO:"Retomar",BTN_SAVE_PHOTO:"Guardar fotografia",BTN_SHOW_SELF:"Mostrar-se",CHATERROR_COPY_NOT_SUPPORTED:"Copiar para a área de transferência não suportado: ({val})",DLG_ERROR_TAKING_PHOTO_TITLE:"Erro ao tirar foto",DLG_SAVING_PHOTO_TITLE:"A guardar foto",ERR_COULD_NOT_COMPRESS:"Não foi possível comprimir para um tamanho válido.",ERR_WG_DEFAULT_VOXELS:"As imagens de Waygate devem usar pacotes voxel padrão",LBL_CONFIRM_WG_IMAGES:"Confirmar imagens de Waygate",LBL_FIELD_OF_VIEW_SHORT:"FOV",LBL_PHOTO_TAKEN:"Foto tirada",LBL_TIME_OF_DAY_SHORT:"Hora",STATUSMSG_CLICK_TAKE_PHOTO:"Clique para tirar uma foto",LBL_CREATED:"Criado",LBL_LOCATION:"Local",PHOTOMSG_ID_INVALID:"Identificação com foto inválida",PHOTOMSG_LOADING:"Dados de foto a carregar...",PHOTOTITLE_AUTHOR:"Foto de {val}",PHOTOTITLE_ERROR:"Foto (Erro)",PHOTOTITLE_LOADING:"Foto (A carregar...)",DLG_ARE_YOU_SURE_TITLE:"Tem a certeza?",DLG_ENTER_NEW_VALUE_MSG:"Insira um novo valor para {val}",DLG_INVALID_VALUE_INSERTED_MSG:"O valor inserido é inválido.",LBL_PROPERTY_EDITOR:"Editor de Propriedades",STATUSMSG_SAVE_FAILED:"Falha ao guardar.",STATUSMSG_SAVE_FAILED_NO_PROP:"Falha ao guardar. Adereço não encontrado.",DLG_CHANGING_NAME_WILL_RESET_MSG:"Alterar o nome irá repor todas as pontuações guardadas nesta bandeira.",DLG_COURSE_GOAL_NAME_MSG:"Insira o nome para o curso desta bandeira.",DLG_COURSE_START_NAME_MSG:"Insira o nome para o curso desta campainha.",DLG_ENTER_SIGN_TEXT_MSG:"Insira uma mensagem para mostrar no sinal.",DLG_START_OTHER_RACE_MSG:"Quer começar esta corrida e abandonar a anterior?",DLG_SUBMITTING_SCORE_TITLE:"A submeter pontuação",FORMAT_BUZZER_SCORE:"{val} - {val_2}",LBL_COURSE_FINISH:"Fim do curso",LBL_COURSE_NAME:"Nome do curso",LBL_COURSE_START:"Início do curso",LBL_SIGN_TEXT:"Texto do sinal",MSG_SIGN_DEFAULT_TEXT:"Olá!",STATUSMSG_ASSIGN_BUZZER_NAME:"Interaja enquanto mantém pressionada a Campainha de início de corrida para atribuir um nome.",STATUSMSG_ASSIGN_FLAG_NAME:"Interaja enquanto segura a Bandeira da meta de corrida para atribuir um nome.",STATUSMSG_EXHAUSTED_TO_USE_BUCKET:"Está demasiado exausto para usar o balde de água",STATUSMSG_MINE_PROP_FULL:"Não é possível destruir o adereço: esvazie o conteúdo primeiro",STATUSMSG_MINE_PROP_NAMED:"Não é possível destruir o adereço: apague o nome primeiro",STATUSMSG_MINE_WG_LINKED:"Não é possível destruir o Waygate: remova o ID primeiro",STATUSMSG_RACE_RESTARTED:"Corrida atual reiniciada!",STATUSMSG_REMOVE_SPOTLIGHT_TO_EDIT:"Remova o destaque da Bandeira antes de editar.",DLG_EQUIPMENT_SLOTS_MSG:"As Ferramentas de Recolha devem ser colocadas nos seus Slots de Equipamento (à direita do seu personagem), e não na Barra Rápida, para serem usadas automaticamente.",DLG_EQUIPMENT_SLOTS_TITLE:"Utilizar Slots de Equipamento",ERR_NOT_IN_WORLD:"Não está atualmente num mundo",LBL_BRUSH_MODE_FLIPPED:"Invertido",LBL_GATHERING_TOOLS:"Ferramentas de Recolha",STATUSMSG_LIGHT_MINI_KB:"Prima {val} para tirar a sua lanterna.",STATUSMSG_LIGHT_MINI_TOUCH:"Toque na lanterna para acender a luz.",STATUSMSG_LIGHT_NOSLOT_KB:"Pressione {val} ou use {val_2} para começar a construir uma tocha.",STATUSMSG_LIGHT_NOSLOT_TOUCH:"Mantenha pressionado um slot da Barra Rápida ou use o menu Construir para começar a construir uma tocha.",STATUSMSG_LIGHT_SLOT_KB:"Prima {val} ou selecione uma luz na Barra Rápida.",STATUSMSG_LIGHT_SLOT_TOUCH:"Selecione uma tocha ou lanterna na Barra Rápida.",STATUSMSG_WOOD_FOR_TORCH:"A madeira é necessária para construir uma tocha",TLTP_CHANGE_BRUSH:"Alterar o tamanho da escova",TLTP_EMPTY_SLOT:"(Slot vazio)",TLTP_LOW_DURABILITY:"Baixa durabilidade no seu {val}",TLTP_QBAR_FLIP:"Inverter",TLTP_QBAR_UNBIND:"Desvincular",TLTP_QUICKSLOT_ITEM:"Quick-slot de item",TLTP_RECENT_ITEM:"(Item recente)",TLTP_RECENT_ITEM_EXISTING:"{val} (item recente)",TLTP_SELECT_LANTERN_OR_TORCH:"Selecionar lanterna ou tocha",TLTP_SWAP_TO_GATHERING:"Trocar para Ferramentas de Recolha",TLTP_SWAP_TO_RECENT:"Trocar para item recente",TLTP_TOGGLE_LANTERN:"Alternar lanterna",TLTP_TOOL_IN_HAND:"{val} (na mão)",BTN_SPOTLIGHT_SCORE:"Pontuação de destaque",FORMAT_RANK_NUMBER:"{val}.",LBL_RACE_RESULTS:"Resultados da corrida",LBL_WORLD_INFO_MENU:"Menu de informações do mundo",RACERESULTS_ALL_SCORES:"Todas as pontuações ({val})",RACERESULTS_NEW_BEST:"Nova melhor pontuação!",RACERESULTS_NO_RANK:"Sem classificação",RACERESULTS_YOUR_SCORE:"A sua pontuação",TLTP_SPOTLIGHT_SCORE:"Mostre estes resultados em {val} para qualquer pessoa neste mundo",BTN_ABANDON_RACE:"Abandonar?",DLG_LEAVE_RACE_MSG:"Quer abandonar a sua atual tentativa de corrida?",LBL_READY_TIME:"Pronto",REDDOT_NEW:"Novo!",BTN_AA_OFF:"Antialiasing: desativado",BTN_AA_OFF_PENDING:"Antialiasing: (desativado)",BTN_AA_ON:"Antialiasing: ativado",BTN_AA_ON_PENDING:"Antialiasing: (Ativado)",BTN_BUGS_FEEDBACK:"Bugs/Feedback",BTN_BUILD_INTEGRATED:"Menu de Construção: integrado",BTN_BUILD_SEPARATE:"Menu de Construção: separado",BTN_CAMERA_FP:"Câmara de primeira pessoa",BTN_CAMERA_TP:"Câmara de terceira pessoa",BTN_CHAT_KEEP_FOCUS:"Chat: manter foco",BTN_CHAT_UNFOCUS:"Chat: desfocar automaticamente",BTN_EXIT_FULLSCREEN:"Fechar ecrã inteiro",BTN_FAST:"Rápido",BTN_FLY_ALT_LOCKED:"Voo: bloqueado por altitude",BTN_FLY_RELATIVE:"Voo: relativo",BTN_FULLSCREEN:"Ecrã inteiro",BTN_FULLSCREEN_KEY:"Ecrã inteiro ({val})",BTN_LAYOUT_AUTO:"Esquema: auto",BTN_LAYOUT_TALL:"Esquema: alto",BTN_LAYOUT_WIDE:"Esquema: largo",BTN_MAX_JUMP_HOLD:"Salto máximo: manter",BTN_MAX_JUMP_TAP:"Salto máximo: tocar",BTN_ORIENTATION:"Orientação",BTN_PRETTY:"Bonito",BTN_QBAR_LEFT:"Barra rápida: esquerda",BTN_QBAR_RIGHT:"Barra rápida: direita",BTN_QBAR_TOP:"Barra rápida: cima",BTN_RESET_INVENTORY:"Repor inventário",BTN_RESET_TUTORIAL:"Repor tutorial",BTN_SHADERS_MEH:"Shaders: meh.",BTN_SHADERS_SHINY:"Shaders: brilhante!",BTN_SHOW_CONTROLS:"Mostrar controlos",BTN_UIS_INTEGRATED:"UI de interação: integrado",BTN_UIS_SEPARATE:"UI de interação: separado",CONTROLS_BUILD_MENU:"Menu de Construção",CONTROLS_CHAT:"chat",CONTROLS_CYCLE_SIZES:"percorrer tamanhos/modos de pincel",CONTROLS_DOUBLE_JUMP:"Toque duas vezes em saltar ({val}) para voar, se disponível",CONTROLS_FLY_DOWN:"voar para baixo",CONTROLS_FORMAT_AGAIN:"{val} novamente",CONTROLS_FORMAT_DESC:"{val} - {val_2}",CONTROLS_FORMAT_OR:"{val} ou {val_2}",CONTROLS_FULLSCREEN:"alternar para ecrã inteiro",CONTROLS_INV_MENU:"menu de inventário",CONTROLS_JUMP_FLY:"saltar/voar para cima",CONTROLS_MOVE:"mover",CONTROLS_OPEN_MENU:"abrir menu",CONTROLS_PHOTO_MODE:"modo de foto",CONTROLS_PICK:"escolher item",CONTROLS_PLACE_DESTROY:"colocar item, destruir blocos; arraste para colocar vários",CONTROLS_QUICK_SLOT:"Slot rápido de um item",CONTROLS_SCROLL_QBAR:"barra rápida de deslocamento",CONTROLS_SECTION_BUILDING:"A construir",CONTROLS_SECTION_MOVEMENT:"Movimento",CONTROLS_SECTION_OTHER:"Outro",CONTROLS_SELECT_QBAR:"selecionar item na barra rápida",CONTROLS_SOCIAL_MENU:"menu social",CONTROLS_SPRINT:"sprint",CONTROLS_TOGGLE_GATHERING:"alternar entre ferramentas de recolha e item recente",CONTROLS_TOGGLE_HUD:"alternar HUD",CONTROLS_TOGGLE_VIEW:"alternar a visualização em primeira/terceira pessoa; desloque enquanto pressionado para aumentar/diminuir o zoom",CONTROLS_TORCH:"tocha",CONTROLS_UNLOCK_MOUSE:"desbloquear cursor do rato",CONTROLS_WORLD_MENU:"menu de informações do mundo",DLG_AA_CHANGED_QUIT_MSG:"Alterar o antialiasing requer reiniciar a aplicação, sair agora?",DLG_AA_CHANGED_RESTART_MSG:"Alterar o antialiasing requer reiniciar a aplicação, reiniciar agora?",DLG_AA_CHANGED_TITLE:"Antialiasing alterado",DLG_CONTROLS_TITLE:"Controlos",DLG_RESET_INV_MSG:"Isto irá redefinir o seu inventário para o estado inicial/em branco. Continuar mesmo?",DLG_RESET_INV_TITLE:"Repor inventário",LBL_CAMERA_DISTANCE:"Distância da câmara",LBL_CONTROLS:"Controlos",LBL_DEBUG:"Depurar",LBL_GRAPHICS:"Gráficos",LBL_INTERFACE:"Interface",LBL_LOOK_SENSITIVITY:"Sensibilidade de olhar",LBL_MOUSE_SENSITIVITY:"Sensibilidade do rato",LBL_PRESET:"Predefinição",LBL_RENDERER:"Renderização",LBL_RESOLUTION_SCALE:"Escala de resolução",LBL_VIEW_DISTANCE:"Distância de visualização",BTN_UNLOCK_LETS_SEE:"Vamos ver!",BTN_UNLOCK_MORE1:"E também...",BTN_UNLOCK_MORE2:"E?",BTN_UNLOCK_MORE3:"Próximo...",BTN_UNLOCK_MORE4:"E que mais?",BTN_UNLOCK_MORE5:"Mais?",LBL_ADDITIONAL_CONTRIBUTORS:"Contribuidores adicionais",LBL_FIRST_UPGRADE:"Primeira atualização",LBL_NEXT_TIER:"Próximo escalão",LBL_OPTIONAL_UPGRADES:"Upgrades opcionais",LBL_SETTLEMENT_SIZE:"Tamanho da Povoação",LBL_SETTLEMENT_UNLOCK:"Desbloqueio de Povoação!",LBL_SIZE:"Tamanho",LBL_TIER_NUMBER:"Escalão {val}",LBL_UNLOCKED:"Desbloqueado",LBL_UNLOCKED_INDUSTRY:"Indústria desbloqueada",LBL_UNLOCKED_TIER:"Escalão Desbloqueado {val}",LBL_UNLOCKS:"Desbloqueia",LBL_UNLOCKS_INDUSTRY:"Desbloqueia a indústria",SETTLEMENT_DRAG_ITEMS:"DICA: arraste os itens do seu inventário abaixo para o slot de requisito para desbloquear upgrades.",SETTLEMENT_FIRST_INCREASE_TIER:"Primeiro, aumente o seu Escalão de Povoação para abrir mais opções de upgrade.",SETTLEMENT_NO_OPT_UPGRADES:"Não há upgrades opcionais disponíveis",SETTLEMENT_RADIUS_ADD:"Os limites da sua Povoação são expandidos em {val} em todas as direções.",SETTLEMENT_UNLOCKED_AFTER_CREATION:"{val} desbloqueado após a criação do mundo",SETTLEMENT_UNLOCKED_JUST_NOW:"Desbloqueado agora mesmo por {val}",SETTLEMENT_UNLOCKED_TIME_AGO:"Desbloqueado há {val} por {val_2}",SETTLEMENT_VISIT_WG_IN_WORLD:"Visite o Waygate no mundo para gerir esta Povoação",SETTLEMENT_WG_UNLOCK:"O Waygate cresce em potência e concede capacidades expandidas à sua Povoação.",LBL_SHARE_MENU:"Menu Partilhar",STATUSMSG_PHOTO_SAVED:"Foto guardada.",SOCIAL_BLOCKED_NUMBER:"Utilizadores bloqueados ({val})",SOCIAL_FRIENDS_NUMBER:"Amigos ({val})",CHATERROR_STUCK_LESS_MINUTE:"Deve esperar pelo menos um minuto antes de executar {val} novamente",CHATERROR_STUCK_NOT_ADMIN:"Deve ser um administrador ou proprietário para usar {val} em mundos {val_2}",CHATERROR_STUCK_TRY_WAYGATE:"Deve ter tentado usar um Waygate (nos últimos 2 minutos) para se desprender",LBL_BUILD:"Construir",LBL_CRAFT:"Criar",LBL_UNLOCK:"Desbloquear",STATUSMSG_ADDED_TASK:"{val} adicionado à Lista de Tarefas",STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK:"Não é possível remover a tarefa de tutorial da Lista de Tarefas",STATUSMSG_REMOVED_TASK:"{val} removido da Lista de Tarefas",TODO_ADD_PIN:"Adicionar isto à sua Lista de Tarefas fixada",TODO_READY:"Pronto!",TODO_REMOVE_PIN:"Remover isto da sua Lista de Tarefas fixada",STATUSMSG_UNKNOWN_USERATTRIB:'Removido {val} desconhecido "{val_2}"',BTN_ADD_FRIEND:"Adicionar à lista de amigos",BTN_BLOCK_USER:"Bloquear utilizador",BTN_KICK_FROM_WORLD:"Chutar",BTN_REMOVE_FRIEND:"Remover da lista de amigos",BTN_UNBLOCK_USER:"Desbloquear utilizador",FRIENDLIST_FB_FRIEND:"Este utilizador é seu amigo no Facebook",FRIENDLIST_USER_IS_ADDED:"Este utilizador está na sua lista de amigos",LBL_ADMIN_ACTIONS:"Ações de administrador",LBL_CHANGE_ACCESS:"Alterar acesso",LBL_CURRENT_ACCESS:"Acesso atual",LBL_DEFAULT:"Padrão",PRESENCE_ALSO_IDLE:"{val} (Inativo)",PRESENCE_BUILDING:"A construir",PRESENCE_IN_MENUS:"Em menus",PRESENCE_LOST_FRONTIER:"Lost Frontier",PRESENCE_OFFLINE:"Offline",PRESENCE_UNKNOWN:"Desconhecido",PRESENCE_VIEWING:"A ver",USERINFO_LOADING:"A carregar dados...",USERINFO_MY_FRIEND_FB:'O meu amigo "{val}" no Facebook',USERINFO_MY_CHANNEL_MEMBER_DISCORD:'O meu membro "{name}" no Discord',USERINFO_THIS_ME:"Sou eu!",USERINFO_USER_BLOCKED:"Este utilizador está bloqueado e não verá o seu estado",STATUSMSG_ORPHANED_TILEPROP:"Encontrado órfão {val}, a limpar...",STATUSMSG_PROP_WOUT_TILEPROP:"Encontrado adereço sem {val}, a limpar...",BTN_ADD_NEW_TARGET:"Adicionar novo destino",BTN_ASSIGN_WGID:"Atribuir ID de Waygate",BTN_CHANGE:"Alterar",BTN_NOT_AVAILABLE:"Indisponível",BTN_REMOVE_WGID:"Remover ID de Waygate",BTN_SET:"Definir",BTN_SET_DEFAULT_SETTLE_WG:"Definir como Povoação/Waygate padrão",BTN_SET_DEFAULT_WG:"Definir como Waygate padrão",DLG_ASSIGN_WGID_ALREADY_MSG_CONFIRM:'O ID de Waygate "{val}" já está em uso por outro Waygate. Deseja mesmo reatribuir este ID de Waygate a ESTE Waygate?',DLG_ASSIGN_WGID_ALREADY_MSG_LINKS:"Nota: todos os links para o ID de Waygate especificado agora vão para este Waygate.",DLG_ASSIGN_WGID_DEF_MSG_CONFIRM:"Alterar o Waygate padrão fará com que todos os novos visitantes cheguem a este Waygate (a menos que sigam um link para outro Waygate específico). Deseja mesmo alterar o Waygate padrão?",DLG_ASSIGN_WGID_DEF_MSG_SCREENSHOT:"Nota: definir este Waygate como o Waygate padrão permitirá que configure uma captura de ecrã padrão para todos os links para este Mundo.",DLG_ASSIGN_WGID_TITLE:"Atribuir ID de Waygate",DLG_ERROR_ASSIGNING_WG_TITLE:"Erro ao atribuir ID de Waygate",DLG_ERROR_EDITING_WG_TITLE:"Erro ao editar Waygate",DLG_ERROR_REMOVING_WGID_TITLE:"Erro ao remover ID de Waygate",DLG_ERROR_RENAMING_WG_TITLE:"Erro ao renomear Waygate",DLG_ERROR_SETTING_WG_IMG_TITLE:"Erro ao definir imagem de Waygate",DLG_INVALID_WORLD_ID_TITLE:"ID de mundo inválido",DLG_LINKABLE_WGID_MSG:"Insira um identificador para este Waygate. Os ID de Waygate podem ter até 16 carateres e podem conter apenas letras minúsculas (a-z), números (0-9) e sublinhados (_). Devem ser únicos neste Mundo.",DLG_LINKABLE_WGID_TITLE:"Atribuir ID de Waygate passível de link",DLG_REMOVE_WGID_MSG:"Remover o ID de Waygate fará com que quaisquer links para este Waygate tenham como destino o Waygate padrão deste Mundo. Se reatribuir este ID de Waygate a um Waygate diferente, essas ligações irão apontar para o novo Waygate. Tem a certeza de que pretende remover este ID de Waygate?",DLG_REMOVE_WGID_TITLE:"Remover ID de Waygate",DLG_WAYGATE_TARGET_MSG:"Insira um ID de Mundo ou clique em Atual para selecionar o mundo ativo",DLG_WAYGATE_TARGET_TITLE:"Waygate de destino",DLG_WG_NAME_MSG:"Insira um nome para este Waygate",DLG_WG_NAME_TITLE:"Nome de Waygate",ERR_INVALID_WGID:"ID de Waygate inválido",ERR_WAYGATE_DISAPPEARED:"O Waygate desapareceu, não é possível aplicar a alteração",LBL_DEFAULT_WAYGATE:"Waygate padrão",LBL_ENERGY_WELL_STATUS:"Estado do Poço de Energia",LBL_ENTRYWAY:"Entrada",LBL_EXITWAY_TARGETS:"Destinos de saída",LBL_LISTED:"Listado",LBL_MINE:"Meu",LBL_OTHER:"Outro",LBL_RECENT:"Recente",LBL_SCREENSHOT:"Captura de ecrã",LBL_SETTLEMENT_MNG:"Gestão de Povoação",LBL_SHOW_WORLD_INFO:"Mostrar informações do mundo",LBL_THIS_WORLD:"Este mundo",LBL_UNKNOWN_MENU:"Menu desconhecido",LBL_WAYGATE_ID:"ID de Waygate",LBL_WAYGATE_TARGETS:"Destinos de Waygate",LBL_WG_AND_SETTLEMENT_MNG:"Gestão de Waygate e Povoação",LBL_WG_CONFIGURATION:"Configuração de Waygate",STATUSMSG_DRINKING_WELL:"A beber do Poço de Energia ({val}s)...",STATUSMSG_WAYGATING_CHOICES:"A usar Waygate (com opções) ({val}s)...",STATUSMSG_WAYGATING_TO:"A usar Waygate para {val} ({val_2}s)...",STATUSMSG_WELL_RECHARGING:"O Poço de Energia continua a recarregar ({val}s)",STATUSMSG_WG_IMG_SAVED:"Imagem de Waygate guardada.",WGLINK_FROZEN:"Congelado",WGLINK_FULL:"Cheio",WGLINK_LOADING:"A carregar...",WGLINK_NOT_FOUND:"Waygate não encontrado",WGTARGET_EXITWAY_LOADING:"(a carregar...)",WGTARGET_INVALID_WORLD_ID:"ID de mundo inválido: {val}",WGUI_DEFAULT_WG_CANNOT_EXITWAY:"O Waygate padrão não pode funcionar como Saída.",WGUI_ENERGY_WELL_REMOTE_SUBTITLE:"Visite para reabastecer {val}",WGUI_ENERGY_WELL_SUBTITLE:"Reabastecer {val} aqui",WGUI_ENTRYWAY_REQUIREMENT:"Este Waygate requer um ID para ser uma Entrada",WGUI_LF_WG_EXITWAY_FUTURE:"As Saídas de Waygate Lost Frontier chegarão numa futura atualização...",WGUI_LISTED_WG_LINKED:"Os Waygates listados podem ser ligados por qualquer pessoa, por URL ou outro Waygate, e são mostrados no ecrã de Informações do Mundo.",WGUI_MUST_VISIT_EDIT_EXITWAY:"Deve visitar o Waygate no mundo para editar os Destinos de Saída",WGUI_NEW_WAYGATE:"Novo Waygate",WGUI_REMOVE_WG_TARGET:"Remover destino de Waygate",WGUI_SETTLEMENT_MNG_SUBTITLE:"Deposite recursos no Waygate para expandir e melhorar",WGUI_SETTLE_CANNOT_EXITWAY:"Um Waygate de Povoação não pode funcionar como Saída.",WGUI_THIS_IS_DEFAULT_WG:"Este é o Waygate Padrão. Para removê-lo, primeiro defina um Waygate diferente como Padrão.",WGUI_UNKNOWN_WAYGATE:"Waygate desconhecido {val}",WGUI_UNLIMITED_HINT_1:"Dica: as pessoas que entram no seu mundo terão a mesma",WGUI_UNLIMITED_HINT_2:"direção que a sua quando coloca o Waygate!",WGUI_WG_ADVENTURE_HINT_1:"Dica: pode construir um novo Waygate e mover o seu",WGUI_WG_ADVENTURE_HINT_2:"poder de Povoação para lá até uma vez por dia!",WGUI_WG_IN_WORLD:"{val} em {val_2}",WGUI_WG_IS_SETTLEMENT:"Este Waygate define uma Povoação e os benefícios da mesma.",CHATERROR_ACCESSING_WAYGATE:"Erro ao aceder ao Waygate {val}: {val_2}",CHATERROR_ACCESS_REVOKED:"Acesso revogado",CHATERROR_GROUP_RACE_START:"Erro no início de corrida de grupo",CHATERROR_RUNNING_COMMAND:"Erro ao executar /{val}: {val_2}",CHATUI_ADMIN_MSG:"[admin] {val}",DLG_JOINING_WORLD_FAILED_TITLE:"Falha em aderir ao Mundo",DLG_RACE_SAVE_ERROR_TITLE:"Erro ao guardar corrida",DLG_RUN_ELEVATE_MSG:"(Admin) Execute/Eleve para ignorar as permissões.",DLG_WORLD_ACCESS_DENIED_MSG:"Acesso negado. Este mundo não é público e requer um token de acesso, ou que o proprietário adicione o seu ID de utilizador ({val}).",DLG_WORLD_FULL_MSG:"Mundo cheio. No momento, este mundo está cheio. Tente novamente mais tarde.",STATUSMSG_CANT_JOIN_NOT_CONNECTED:"Não é possível aderir ao mundo: não está ligado ao servidor",STATUSMSG_GEM_FOUND:"Encontrou 1{val} joia!",STATUSMSG_GROUP_RACE_CANCELLED:"A corrida de grupo atual foi cancelada!",STATUSMSG_GROUP_RACE_START:"Uma corrida de grupo acabou de começar!",STATUSMSG_GROUP_RACE_START_SECONDS:"Uma corrida de grupo começará em {val} segundos!",STATUSMSG_GROUP_RACE_WON_BY_OTHER:"{val} ganhou a corrida de grupo com um tempo de {val_2}!",STATUSMSG_GROUP_RACE_WON_BY_YOU:"Ganhou a corrida de grupo! Parabéns!",STATUSMSG_ORPHANED_PROP:"Encontrado um adereço órfão sem TILE_PROP, a limpar...",STATUSMSG_OUT_OF_SYNC:"Mundo não sincronizado, a ressincronizar...",STATUSMSG_RACE_ABANDON_ERROR:"Erro de abandono da corrida: {val}",STATUSMSG_RACE_NO_MULTIPLE_CLIENTS:"As corridas não podem ser iniciadas em mundos que permitem vários clientes.",STATUSMSG_RACE_SINGLE_CLIENT_ENABLE:'Execute "/world_single_client 1" para ativar um único cliente por utilizador neste mundo.',STATUSMSG_RACE_START_ERROR:"Erro no início da corrida: {val}",STATUSMSG_TRANSACTION_FAILED:"A transação falhou: {val}",BTN_DELETE_WORLD:"Eliminar",BTN_DONE_EDITING:"Feito",BTN_EDIT_WG_INFORMATION:"Editar informações de Waygate",BTN_EDIT_WORLD_SETTINGS:"Editar definições de Mundo",BTN_EXIT_WORLD:"← Sair do Mundo",BTN_FORGET_WORLD:"Esquecer",BTN_IM_STUCK:"Estou preso!",BTN_JOIN_WORLD:"Aderir",BTN_PLAYING_AS_SELF:"Jogar como: eu",BTN_PLAYING_AS_VISITOR:"Jogar como: visitante",BTN_SETTLEMENT_INFO:"Informações de Povoação",BTN_WAYGATE_GO:"Ir",DLG_DELETE_WORLD_MSG:"Tem a certeza que deseja eliminar {val} ({val_2})?",DLG_DELETE_WORLD_TITLE:"Eliminar Mundo",DLG_ERR_LOST_CONNECTION_MSG:"Não foi possível processar o pedido: perda de ligação ao mundo",DLG_ERR_LOST_CONNECTION_TITLE:"Ligação perdida",DLG_ERR_MODIFYING_WORLD_TITLE:"Erro ao modificar o mundo",DLG_FORGET_WORLD_MSG:"Tem a certeza de que pretende remover {val} ({val_2}) da sua lista recente?",DLG_FORGET_WORLD_TITLE:"Esquecer Mundo",DLG_WG_TRAVEL_NOT_ALLOWED_MSG:"Neste momento, está à espera do início de uma corrida de grupo. A viagem por Waygate irá cancelar a sua corrida atual. Tem a certeza de que deseja continuar?",DLG_WG_TRAVEL_NOT_ALLOWED_TITLE:"Viagem por Waygate não permitida",DLG_WG_TRAVEL_UNSAFE_MSG:"Ainda não recuperou do uso anterior de Waygate. Viajar por Waygate novamente tão cedo resultará em Doença de Waygate temporária ({val} reduzido). Tem a certeza de que deseja continuar?",DLG_WG_TRAVEL_UNSAFE_TITLE:"Viagem por Waygate atualmente insegura",DLG_WORLD_NAME_MSG:"Introduza um novo nome para o seu mundo",FORMAT_NUMBER_MILLION:"{val}M",FORMAT_NUMBER_THOUSAND:"{val}Mil",FORMAT_READY_WG_TIME:"({val})",FORMAT_ROLE_DISPLAY:"[{val}]",LBL_ACCESS_ADMIN_LONG:"Admin (pode conceder acesso, etc.)",LBL_ACCESS_BUILDER_LONG:"Construtor (pode construir)",LBL_ACCESS_DEFAULT:"Padrão",LBL_ACCESS_NONE:"Nenhum",LBL_ACCESS_NONE_BAN:"Nenhum (banimento)",LBL_ACCESS_NONE_LONG:"Sem acesso",LBL_ACCESS_NONE_NOBODY:"Ninguém",LBL_ACCESS_OWNER:"Proprietário",LBL_ACCESS_OWNER_CREATOR:"Criador",LBL_ACCESS_PRESET:"Predefinição de acesso",LBL_ACCESS_PRESET_PRIVATE:"Privado",LBL_ACCESS_PRESET_PRIVATE_LONG:"Este mundo é privado",LBL_ACCESS_PRESET_SPECTATE:"Qualquer um pode assistir",LBL_ACCESS_PRESET_VISIT:"Qualquer um pode visitar",LBL_ACCESS_READONLY:"Visitante",LBL_ACCESS_READONLY_LONG:"Visitante (tem avatar)",LBL_ACCESS_SPECTATOR:"Espectador",LBL_ACCESS_SPECTATOR_ANYONE:"Qualquer um",LBL_ACCESS_SPECTATOR_LONG:"Espectador (pode ver, mas está invisível)",LBL_CHAT:"Chat",LBL_FLYING:"Voar",LBL_MORE_ACCESS_OPTIONS:"Mais opções de acesso",LBL_PLACE_BLUEPRINTS:"Colocar plantas",LBL_SHOW_OTHER_PLAYERS:"Mostrar outros jogadores",LBL_TIME_AFTERNOON:"Tarde",LBL_TIME_DAWN:"Amanhecer",LBL_TIME_DUSK:"Crepúsculo",LBL_TIME_DYNAMIC:"Dinâmico",LBL_TIME_MIDNIGHT:"Meia-noite",LBL_TIME_MORNING:"Manhã",LBL_TIME_NOON:"Meio-dia",LBL_TIME_OF_DAY:"Hora do dia",LBL_USER_DISTANCE_FAR:"Longe",LBL_USER_DISTANCE_MEDIUM:"Médio",LBL_USER_DISTANCE_NEAR:"Perto",LBL_USER_DISTANCE_UNLIMITED:"Ilimitado",LBL_USERS_OFFLINE:"Offline",LBL_WAYGATES:"Waygates",LBL_WHO_IS_HERE:"Quem está aqui ({val})",LBL_WORLD_SETTINGS:"Definições de Mundo",STATUSMSG_PLAYING_AS_VISITOR:"A jogar como Visitante só de leitura",TLTP_DONE_EDITING:"Concluir a edição",TLTP_RENAME_WORLD:"Renomear Mundo",WORLDINFO_ANYONE_BUILD_WARNING:"Aviso: qualquer pessoa na Internet pode participar e construir no seu mundo a qualquer momento. Não utilize esta opção se valoriza aquilo que está a construir.",WORLDINFO_ASSIGNED_ROLES:"{val} das {val_2} funções de construtor/administrador atribuídas",WORLDINFO_LOADING:"A carregar informações de Mundo...",WORLDINFO_LOADING_ERROR:"Erro ao carregar informações do mundo: {val}",WORLDINFO_NO_WG_FOUND:"Nenhum Waygate encontrado",WORLDINFO_SAFE_WG_TRAVEL:"Viagem segura por Waygate pronta!",WORLDINFO_THIS_IS_MY_WORLD:"Este é o meu mundo",WORLDINFO_WG_TRAVEL_UNSAFE:"Viagem por Waygate atualmente insegura",WORLDINFO_YOU_ARE_ADMIN:"É um administrador",TILES_GRASS_NAME:"Terra (relva)",TILES_GRASS_NAME_BLOCK:"Bloco de relva",TILES_DIRT_NAME:"Terra",TILES_DIRT_NAME_BLOCK:"Bloco de terra",TILES_DIRT_INFO:"Pode ser recolhido de Blocos de Relva ou Blocos de Terra com uma pá ou as ferramentas brutas com as quais começa.",TILES_STONE_NAME:"Pedra",TILES_STONE_NAME_BLOCK:"Bloco de pedra",TILES_STONE_INFO:"Pode ser recolhido de Blocos de Pedra com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra podem ser encontrados no subsolo ou na superfície.",TILES_ORE_IN_STONE_LIGHT_NAME:"Minério de Metal em Pedra Clara",TILES_ORE_IN_STONE_LIGHT_NAME_BLOCK:"Minério de Metal em Pedra Clara",TILES_ORE_IN_STONE_NAME:"Minério de Metal em Pedra",TILES_ORE_IN_STONE_NAME_BLOCK:"Minério de Metal em Pedra",TILES_ORE_IN_STONE_DARK_NAME:"Minério de Metal em Pedra Escura",TILES_ORE_IN_STONE_DARK_NAME_BLOCK:"Minério de Metal em Pedra Escura",TILES_ORE_IN_STONE_RED_NAME:"Minério de Metal em Pedra Vermelha",TILES_ORE_IN_STONE_RED_NAME_BLOCK:"Minério de Metal em Pedra Vermelha",TILES_ORE_IN_VEINIUM_NAME:"Minério de Metal em Veinium",TILES_ORE_IN_VEINIUM_NAME_BLOCK:"Minério de Metal em Veinium",TILES_VEINIUM_NAME:"Veinium",TILES_VEINIUM_NAME_BLOCK:"Veinium",TILES_VEINIUM_INFO:"Contém vestígios de metais que indicam que pode haver minério nas proximidades.",TILES_COAL_NAME:"Carvão",TILES_COAL_NAME_BLOCK:"Bloco de Carvão",TILES_WOOD_NAME:"Madeira",TILES_WOOD_NAME_BLOCK:"Bloco de Madeira",TILES_WOOD_INFO:"Pode ser recolhido a partir de Blocos de Madeira com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe.",TILES_PLANKS_WOOD_NAME:"Pranchas de Madeira",TILES_PLANKS_WOOD_NAME_BLOCK:"Bloco de Pranchas de Madeira",TILES_PLANKS_WOOD_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_WOOD_LIGHT_NAME:"Madeira Clara",TILES_WOOD_LIGHT_NAME_BLOCK:"Bloco de Madeira Clara",TILES_WOOD_LIGHT_INFO:"Pode ser recolhido a partir de Blocos de Madeira Clara com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe. A Madeira Clara é fácil de manusear.",TILES_PLANKS_WOOD_LIGHT_NAME:"Pranchas de Madeira Clara",TILES_PLANKS_WOOD_LIGHT_NAME_BLOCK:"Bloco de Pranchas de Madeira Clara",TILES_PLANKS_WOOD_LIGHT_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_WOOD_DARK_NAME:"Madeira Escura",TILES_WOOD_DARK_NAME_BLOCK:"Bloco de Madeira Escura",TILES_WOOD_DARK_INFO:"Pode ser recolhido a partir de Blocos de Madeira Escura com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe. A Madeira Escura é pesada e duradoura.",TILES_PLANKS_WOOD_DARK_NAME:"Pranchas de Madeira Escura",TILES_PLANKS_WOOD_DARK_NAME_BLOCK:"Bloco de Pranchas de Madeira Escura",TILES_PLANKS_WOOD_DARK_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_WOOD_RED_NAME:"Madeira Vermelha",TILES_WOOD_RED_NAME_BLOCK:"Bloco de Madeira Vermelha",TILES_WOOD_RED_INFO:"Pode ser recolhido a partir de Blocos de Madeira Vermelha com um machado ou as ferramentas brutas com que começa. As florestas podem ser encontradas procurando manchas mais escuras ao longe. A Madeira Vermelha é bastante duradoura.",TILES_PLANKS_WOOD_RED_NAME:"Pranchas de Madeira Vermelha",TILES_PLANKS_WOOD_RED_NAME_BLOCK:"Bloco de Pranchas de Madeira Vermelha",TILES_PLANKS_WOOD_RED_INFO:"Útil para construir muitas coisas, como Baús, encontrado na secção Adereços do menu de construção.",TILES_LEAVES1_NAME:"Folhas",TILES_LEAVES1_NAME_BLOCK:"Bloco de Folhas #1",TILES_LEAVES2_NAME:"Folhas",TILES_LEAVES2_NAME_BLOCK:"Bloco de Folhas #2",TILES_LEAVES3_NAME:"Folhas",TILES_LEAVES3_NAME_BLOCK:"Bloco de Folhas #3",TILES_LEAVES4_NAME:"Folhas",TILES_LEAVES4_NAME_BLOCK:"Bloco de Folhas #4",TILES_LEAVES5_NAME:"Folhas",TILES_LEAVES5_NAME_BLOCK:"Bloco de Folhas #5",TILES_PASSABLE_LEAVES_NAME:"Folhas",TILES_PASSABLE_LEAVES_NAME_BLOCK:"Bloco de Folhas para Passagem",TILES_TILLED_NAME:"Terra",TILES_TILLED_NAME_BLOCK:"Bloco de Terra Lavrada",TILES_TILLED_WATERED_NAME:"Terra",TILES_TILLED_WATERED_NAME_BLOCK:"Bloco de Terra Regada e Lavrada",TILES_SNOW_NAME:"Neve",TILES_SNOW_NAME_BLOCK:"Bloco de Neve",TILES_SAND_NAME:"Areia",TILES_SAND_NAME_BLOCK:"Bloco de Areia",TILES_STONE_DARK_NAME:"Pedra Escura",TILES_STONE_DARK_NAME_BLOCK:"Bloco de Pedra Escura",TILES_STONE_DARK_INFO:"Pode ser recolhido de Blocos de Pedra Escura com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra Escura podem ser encontrados no subsolo ou na superfície.",TILES_STONE_LIGHT_NAME:"Pedra Clara",TILES_STONE_LIGHT_NAME_BLOCK:"Bloco de Pedra Clara",TILES_STONE_LIGHT_INFO:"Pode ser recolhido de Blocos de Pedra Clara com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra Clara podem ser encontrados no subsolo ou na superfície.",TILES_STONE_RED_NAME:"Pedra Vermelha",TILES_STONE_RED_NAME_BLOCK:"Bloco de Pedra Vermelha",TILES_STONE_RED_INFO:"Pode ser recolhido de Blocos de Pedra Vermelha com uma picareta ou as ferramentas brutas com que começa. Os Blocos de Pedra Vermelha podem ser encontrados no subsolo ou na superfície. Tal como a pedra vermelha na Terra, não tem nenhuma propriedade condutora.",TILES_GLASS_NAME:"Vidro",TILES_GLASS_NAME_BLOCK:"Bloco de Vidro",TILES_BRICK_CLAY_NAME:"Tijolos Vermelhos",TILES_BRICK_CLAY_NAME_BLOCK:"Bloco de Tijolos Vermelhos",TILES_BRICK_STONE_NAME:"Tijolos de Pedra",TILES_BRICK_STONE_NAME_BLOCK:"Bloco de Tijolos de Pedra",TILES_COLORED_HUE0_NAME:"Madeira Pintada de Vermelho",TILES_COLORED_HUE0_NAME_BLOCK:"Bloco de Madeira Pintada de Vermelho",TILES_COLORED_HUE1_NAME:"Madeira Pintada de Laranja",TILES_COLORED_HUE1_NAME_BLOCK:"Bloco de Madeira Pintada de Laranja",TILES_COLORED_HUE2_NAME:"Madeira Pintada de Amarelo",TILES_COLORED_HUE2_NAME_BLOCK:"Bloco de Madeira Pintada de Amarelo",TILES_COLORED_HUE3_NAME:"Madeira Pintada de Verde",TILES_COLORED_HUE3_NAME_BLOCK:"Bloco de Madeira Pintada de Verde",TILES_COLORED_HUE4_NAME:"Madeira Pintada de Azul",TILES_COLORED_HUE4_NAME_BLOCK:"Bloco de Madeira Pintada de Azul",TILES_COLORED_HUE5_NAME:"Madeira Pintada de Roxo",TILES_COLORED_HUE5_NAME_BLOCK:"Bloco de Madeira Pintada de Roxo",CRAFT_CLASS_BAKED_FOOD_NAME:"Qualquer Alimento Cozinhado",CRAFT_CLASS_BRICK_NAME:"Qualquer Tijolo",CRAFT_CLASS_FARMING_SEED_DESC:"As sementes de culturas podem ser obtidas a partir de versões pequenas e selvagens destas plantas.",CRAFT_CLASS_FARMING_SEED_NAME:"Qualquer Semente de Cultura",CRAFT_CLASS_FUEL_NAME:"Qualquer Combustível",CRAFT_CLASS_GRINDABLE_NAME:"Qualquer para Moagem",CRAFT_CLASS_INGREDIENT_NAME:"Qualquer Alimento",CRAFT_CLASS_REPAIRABLE_NAME:"Qualquer Ferramenta",CRAFT_CLASS_SCALED_INGOT_NAME:"Qualquer Lingote",CRAFT_CLASS_STONE_RAW_NAME:"Qualquer Pedra Bruta",CRAFT_CLASS_WHEAT_CORN_NAME:"Trigo ou Milho",CRAFT_CLASS_WOOD_PLANK_NAME:"Qualquer Prancha de Madeira",CRAFT_CLASS_WOOD_RAW_NAME:"Qualquer Madeira Bruta",MATERIAL_CLASS_NONE_NAME:"Nenhum",MATERIAL_CLASS_WOOD_NAME:"Madeira",MATERIAL_CLASS_STONE_NAME:"Pedra",MATERIAL_CLASS_DIRT_NAME:"Terra",MATERIAL_CLASS_METAL_NAME:"Metal",MAT_LEAF_NAME:"Folha",MAT_FIBER_NAME:"Fibra",MAT_LIGHT_WOOD_NAME:"Madeira Clara",MAT_WOOD_NAME:"Madeira",MAT_RED_WOOD_NAME:"Madeira Vermelha",MAT_DARK_WOOD_NAME:"Madeira Escura",MAT_FLINT_NAME:"Sílex",MAT_ROCK_NAME:"Rocha",MAT_STONE_NAME:"Pedra",MAT_FANCY_STONE_NAME:"Pedra Extravagante",MAT_UNUSED_STONE_NAME:"Pedra Não Usada",MAT_SAND_NAME:"Areia",MAT_DIRT_NAME:"Terra",MAT_HOE_ACTION_NAME:"Ação de Enxada",MAT_MUTTAL_NAME:"Muttal",MAT_COAL_NAME:"Carvão",MAT_COPPER_NAME:"Cobre",MAT_TIN_NAME:"Latão",MAT_BRONZE_NAME:"Bronze",MAT_IRON_NAME:"Ferro",MAT_SILVER_NAME:"Prata",MAT_EMBERYLLIUM_NAME:"Emberyllium",MAT_GOLD_NAME:"Ouro",MAT_BRIGHTSTEEL_NAME:"Aço brilhante",MAT_COBALT_NAME:"Cobalto",MAT_MYTHRIL_NAME:"Mitrilo",MAT_AETHERSTONE_NAME:"Pedra de Éter",MAT_AETHERSTEEL_NAME:"Aço de Éter",MAT_REGULAR_NAME:"Regular",MAT_FAST_NAME:"Rápido",MAT_SUPER_NAME:"Super",MAT_ANY_INGREDIENT_NAME:"Qualquer ingrediente",MAT_TOMATO_NAME:"Tomate",MAT_PUMPKIN_NAME:"Abóbora",MAT_CARROT_NAME:"Cenoura",MAT_RED_BERRY_NAME:"Baga Vermelha",MAT_BLUE_BERRY_NAME:"Baga Azul",MAT_YELLOW_BERRY_NAME:"Baga Amarela",MAT_LABEL_NAME:"Etiqueta",MAT_HOT_NAME:"Quente",MAT_PUNGENT_NAME:"Picante",MAT_SAVORY_NAME:"Salgado",MAT_BREAD_NAME:"Pão",MAT_BROWN_MUSHROOM_NAME:"Cogumelo Castanho",MAT_LUMINESCENT_MUSHROOM_NAME:"Cogumelo Luminescente",MAT_RED_MUSHROOM_NAME:"Cogumelo Vermelho",MAT_CORN_NAME:"Milho",MAT_RED_NAME:"Vermelho",MAT_ORANGE_NAME:"Laranja",MAT_YELLOW_NAME:"Amarelo",MAT_GREEN_NAME:"Verde",MAT_BLUE_NAME:"Azul",MAT_PURPLE_NAME:"Roxo",STONE_TIER_T0:"Regular",STONE_TIER_T1:"1★ Denso",STONE_TIER_T2:"2★ Extra-Denso",STONE_TIER_T3:"3★ Duro",STONE_TIER_T4:"4★ Extra-Duro",STONE_TIER_T5:"5★ Super-Duro",STONE_TIER_T6:"6★ Hiper-Duro",STONE_TIER_T7:"7★ Mega-Duro",STONE_TIER_T8:"8★ Duro-Duplo-Plus",STONE_TIER_T9:"9★ Indestrutível",ITEM_BERRY_NAME:"Aglomerado",ITEM_BREAD_NAME:"Pão de Milho",ITEM_CARROT_NAME:"Cenoura",ITEM_CROISSANT_NAME:"Croissant",ITEM_JUICE_NAME:"Sumo",ITEM_LEFTOVERS_NAME:"Restos",ITEM_MUSHROOM_NAME:"Cogumelo",ITEM_PIE_NAME:"Tarte",ITEM_ROAST_VEGETABLES_NAME:"Vegetal Assado",ITEM_SANDWICH_NAME:"Sanduíche",ITEM_TOMATO_NAME:"Tomate",ITEM_BOTTLE_NAME:"Garrafa Vazia",ITEM_COAL_NAME:"Carvão",ITEM_CORD_DESC:"Corda áspera, útil na montagem de todos os tipos de coisas.",ITEM_CORD_NAME:"Cabo",ITEM_CORN_NAME:"Milho",ITEM_FIBER_DESC:"Fibra recolhida de flores selvagens ou domésticas e outras plantas.",ITEM_FIBER_NAME:"Fibra Vegetal",ITEM_FLOUR_NAME:"Farinha",ITEM_INGOT_NAME:"Lingote",ITEM_ORE_INFO:"Os minérios metálicos encontram-se principalmente em fendas e depósitos dentro de outras características de terreno. Embora os minérios de Cobre e Ferro possam ser encontrados perto da superfície, outros minérios só podem ser encontrados a nível mais profundo, dentro de camadas mais duras de pedra.",ITEM_ORE_NAME:"Minério",ITEM_PAINT_NAME:"Tinta",ITEM_PUMPKIN_NAME:"Abóbora",ITEM_SPICE_NAME:"Especiaria",ITEM_SUGAR_CANE_NAME:"Cana de Açúcar",ITEM_SUGAR_NAME:"Açúcar",ITEM_TOOL_HEAD_NAME:"Cabeça de Ferramenta",ITEM_WHEAT_NAME:"Trigo",ITEM_BERRY_BUSH_BLUE_NAME:"Semente de Bagas Azuis",ITEM_BERRY_BUSH_RED_NAME:"Semente de Bagas Vermelhas",ITEM_BERRY_BUSH_YELLOW_NAME:"Semente de Bagas Amarelas",ITEM_SEEDS_CARROT_NAME:"Sementes de Cenoura",ITEM_SEEDS_CORN_NAME:"Sementes de Milho",ITEM_SEEDS_FLOWERS_BLUE_NAME:"Semente de Flor Azul Tímida",ITEM_SEEDS_FLOWERS_ORANGE_NAME:"Semente de Flor Laranja Otimista",ITEM_SEEDS_FLOWERS_PURPLE_NAME:"Semente de Flor Roxa Prestigiada",ITEM_SEEDS_FLOWERS_RED_NAME:"Semente de Flor Vermelha Radiante",ITEM_SEEDS_FLOWERS_YELLOW_NAME:"Semente de Flor Amarela Deliciosa",ITEM_SEEDS_MUSHROOMS_BROWN_NAME:"Semente de Cogumelo Castanho Alegre",ITEM_SEEDS_MUSHROOMS_LUMINESCENT_NAME:"Semente de Cogumelo Luminescente Solitário",ITEM_SEEDS_MUSHROOMS_RED_NAME:"Semente de Cogumelo Vermelho Prazeroso",ITEM_SEEDS_PUMPKIN_NAME:"Sementes de Abóbora",ITEM_SEEDS_SUGAR_CANE_NAME:"Sementes de Cana de Açúcar",ITEM_SEEDS_TOMATO_NAME:"Sementes de Tomate",ITEM_SEEDS_WHEAT_NAME:"Sementes de Trigo",ITEM_ACCESS_CONTROL_DESC:"Permite criar e modificar Áreas com acesso limitado.",ITEM_BED_NAME:"Cama",ITEM_BENCH_NAME:"Bancada",ITEM_BUZZERGOAL_DESC:"Tocá-la termina uma Corrida. Utilizá-la permite verificar as pontuações para a sua Corrida.\n(Para ativar, interaja enquanto mantém este item pressionado para atribuir um nome. Permite terminar uma corrida iniciada numa Campainha de Início de Corrida com o mesmo nome.)",ITEM_BUZZERGOAL_NAME:"Bandeira de Meta da Corrida",ITEM_BUZZERSTART_DESC:"Inicia uma Corrida pressionando enquanto ativo.\n(Para ativar, interaja enquanto mantém este item pressionado para atribuir um nome. Atingir uma Bandeira de Meta de Corrida com o mesmo nome terminará a corrida.)",ITEM_BUZZERSTART_NAME:"Campainha de Início de Corrida",ITEM_CHAIR_NAME:"Cadeira",ITEM_CHEST_MEDIUM_NAME:"Baú",ITEM_CHEST_SMALL_NAME:"Baú Pequeno",ITEM_CHEST_TALL_NAME:"Armário",ITEM_CHEST_TINY_NAME:"Baú Minúsculo",ITEM_DOOR_DOUBLE_NAME:"Porta Dupla",ITEM_DOOR_NAME:"Porta",ITEM_FENCE_NAME:"Cerca",ITEM_FLOWERPOT_NAME:"Vaso",ITEM_GEM_NAME:"Joia",ITEM_LADDER_NAME:"Escada",ITEM_LANTERN_NAME:"Lanterna",ITEM_LIGHT_CUBE_NAME:"Luz de Cubo",ITEM_RODH_NAME:"Haste (Horizontal)",ITEM_RODV_NAME:"Haste (Vertical)",ITEM_ROD_NAME:"Haste",ITEM_RUG_NAME:"Tapete",ITEM_SHELF_NAME:"Prateleira",ITEM_SIGNBOARD_NAME:"Quadro",ITEM_SIGNPOST_NAME:"Sinal",ITEM_STEPS_NAME:"Passos",ITEM_TABLE_LARGE_NAME:"Mesa Grande",ITEM_TABLE_SMALL_NAME:"Mesa Pequena",ITEM_TORCH_NAME:"Tocha",ITEM_WINDOW_LARGE_NAME:"Janela Grande",ITEM_WINDOW_MEDIUM_NAME:"Janela Média",ITEM_WINDOW_SMALL_NAME:"Janela Pequena",ITEM_ANVIL_DESC:"Repara ferramentas e produz com mais eficiência cabeças de ferramentas de metal.",ITEM_ANVIL_NAME:"Bigorna",ITEM_BONFIRE_DESC:"Fogareiro de Pedra com Pernas de Madeira",ITEM_BONFIRE_METAL_DESC:"Fogareiro com correntes e bacia metálica.",ITEM_BONFIRE_METAL_NAME:"Fogareiro Metálico",ITEM_BONFIRE_NAME:"Fogareiro",ITEM_CAMPFIRE_DESC:"Assa a maioria dos alimentos crus, tornando-os mais comestíveis.",ITEM_CAMPFIRE_NAME:"Fogueira",ITEM_ENERGY_WELL_DESC:"Fornece um lugar alternativo para reabastecer as energias.",ITEM_ENERGY_WELL_NAME:"Poço de Energia",ITEM_FURNACE_GLASS_DESC:"Refina a areia em vidro.",ITEM_FURNACE_GLASS_NAME:"Fornalha de Vidro",ITEM_FURNACE_ORE_DESC:"Refina metais em lingotes.",ITEM_FURNACE_ORE_NAME:"Fornalha de Minério",ITEM_JUICER_DESC:"Entram bagas e sai sumo. Que delícia!",ITEM_JUICER_NAME:"Espremedor",ITEM_KILN_DESC:"Produz carvão e tijolos.",ITEM_KILN_NAME:"Forno de fossa",ITEM_MILL_DESC:"Mói algo para criar um novo ingrediente.",ITEM_MILL_NAME:"Moinho",ITEM_OVEN_DESC:"Cozinha comida mais avançada que a Fogueira.",ITEM_OVEN_NAME:"Forno",ITEM_PAINT_MIXER_DESC:"Cria e combina tintas.",ITEM_PAINT_MIXER_NAME:"Misturador de Tintas",ITEM_SAWMILL_DESC:"Produz hastes de madeira e corta pranchas de madeira.",ITEM_SAWMILL_NAME:"Marcenaria",ITEM_STONECUTTER_ADVANCED_NAME:"Esmerilador de Pedra Avançado",ITEM_STONECUTTER_SIMPLE_DESC:"Produz cabeças de ferramentas de pedra e corta tijolos de pedra.",ITEM_STONECUTTER_SIMPLE_NAME:"Esmerilação de pedra",ITEM_TOOL_HEAD_CAST_DESC:"Transforma metal refinado em cabeças de ferramentas.",ITEM_TOOL_HEAD_CAST_NAME:"Molde de Cabeça de Ferramenta",ITEM_WATERING_SYSTEM_DESC:"Rega automaticamente as culturas próximas.",ITEM_WATERING_SYSTEM_NAME:"Sistema de Rega",ITEM_WAYGATE_NAME:"Waygate",ITEM_WORKBENCH_DESC:"Uma bancada mágica que produz componentes e ferramentas.",ITEM_WORKBENCH_NAME:"Bancada de Éter",ITEM_BUCKET_NAME:"Balde",ITEM_DOWSER_ADVANCED_DESC:"Ferramenta para encontrar fendas de pedra que podem conter minério.",ITEM_DOWSER_ADVANCED_INFO:"O tamanho da barra indica a variação da densidade na direção do olhar, a cor da barra indica o minério correspondente.",ITEM_DOWSER_ADVANCED_NAME:"Detetor Avançado",ITEM_DOWSER_SIMPLE_DESC:"Ferramenta para deteção de minério nas proximidades.",ITEM_DOWSER_SIMPLE_INFO:"O tamanho da barra indica proximidade, a cor da barra indica minério correspondente.",ITEM_DOWSER_SIMPLE_NAME:"Detetor Simples",ITEM_HANDSTOOL_NAME:"Mãos Vazias",ITEM_HATCHET_NAME:"Machado",ITEM_HOE_NAME:"Enxada",ITEM_PICKAX_NAME:"Picareta",ITEM_SHOVEL_NAME:"Pá",ITEM_LIQUID_NAME:"Líquido Desconhecido",ITEM_PLANT_NAME:"Sementes de Flor Desconhecida"}},{}],131:[function(e,t,r){"use strict"
r.localizationPastStartup=localizationPastStartup
r.localizationSetChatUI=localizationSetChatUI
r.L=r.DURATION_WITH_SECONDS_ALWAYS=r.DURATION_WITH_MINUTES=r.DURATION_ONLY_SECONDS=r.DURATION_ONLY_MINUTES=r.DURATION_DAYS_AND_HOURS_INITIALS=r.DURATION_ONLY_DAYS=r.DURATION_DAYS=r.TimeComponent=r.lang_code_ref=void 0
var a
var i=e("../../glov/client/localization")
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("assert")
var n=e("@messageformat/core")
var s=e("../../glov/client/client_config")
var l=s.MODE_DEVELOPMENT
var _=s.MODE_PRODUCTION
var c=e("../../glov/client/cmds").cmd_parse
var u=e("../../glov/client/localization").getStringFromLocalizable
var d=e("../../glov/client/ui")
var f=e("../../glov/common/util").once
var v=e("../../glov/common/verify")
var h=e("./lang_en-US.json")
var p=e("./lang_pt-PT.json")
for(var m in i)if("default"!==m)r[m]=i[m]
var E="en-US"
r.lang_code_ref=E
var g=h
var T=((a={})[E]=g,a["pt-PT"]=p,a)
var y=Object.keys(T)
var S=E
var I=g
var A=1
var w=n
var L=new w(S)
var O=window.Function
function functionReplacer(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]
var a=t[t.length-1]
a=(a=a.replace(/return \(([^)]*)\) => {/,"return function($1) {")).replace(/return \(([^)]*)\) => (.+)$/,"return function($1) { return $2; }")
o(!a.includes("=>"),a)
t[t.length-1]=a
return O.apply(void 0,t)}var R=l
try{o.equal(Function("return () => 7")()(),7)}catch(e){R=true}function applyPolyfills(){if(R)window.Function=functionReplacer}function unapplyPolyfills(){if(R)window.Function=O}var b=/\{([^,}]+)(?:[^{}]*(?:\{([^}]+)\})?)*\}/g
function mfreplacer(e,t,r,a){return""+(e&&e[r])+(a||"")}var N=function(){function MessageFormatMock(){}MessageFormatMock.prototype.compile=function compile(t){var r=this
return function(e){return t.replace(b,mfreplacer.bind(r,e))}}
return MessageFormatMock}()
try{o.equal(L.compile("{0}:")([7]),"7:")}catch(e){L=new(w=N)(S)}var C=false
var x=false
var M=false
function localizationPastStartup(){M=true}var D=function(){function StringWrapper(e){this.v=void 0
this.v=e
if(_)this.length=e.length}var e=StringWrapper.prototype
e.set=function set(e){this.v=e
if(_)this.length=e.length}
e.toLocalString=function toLocalString(){return this.v}
e.toString=function toString(){return this.v}
return StringWrapper}()
if(_)["concat","includes","indexOf","lastIndexOf","match","slice","split","startsWith","endsWith","toLowerCase","toUpperCase"].forEach(function(e){D.prototype[e]=function(){return this.v[e].apply(this.v,arguments)}})
var P=function(r){_inheritsLoose(LocalizedReactive,r)
function LocalizedReactive(e){var t;(t=r.call(this,"")||this).f=void 0
t.l=void 0
t.f=e
t.l=0
return t}var e=LocalizedReactive.prototype
e.update=function update(){if(this.l!==A){var e=this.f()
o("string"===typeof e,"func must return a string in order to not break the toLocalString and toString methods")
this.set(e)
this.l=A}return this.v}
e.toLocalString=function toLocalString(){return this.update()}
e.toString=function toString(){return this.update()}
return LocalizedReactive}(D)
var B=function(a){_inheritsLoose(LocalizedEntry,a)
function LocalizedEntry(e,t){var r;(r=a.call(this,t)||this).key=void 0
r.format_func=void 0
r.format_cache=void 0
r.cap=void 0
r.up=void 0
r.lo=void 0
r.key=e
return r}var e=LocalizedEntry.prototype
e.updateEntry=function updateEntry(e){if(e!==this.v){this.set(e)
this.format_func=void 0
if(this.cap)this.cap.set(e.charAt(0).toUpperCase()+e.slice(1))
if(this.up)this.up.set(e.toUpperCase())
if(this.lo)this.lo.set(e.toLowerCase())}}
e.$=function $(e){function format(e,t){if(!M)v(false,"Reference to "+e.key+" being converted to string during startup")
var r=e.format_func
if(!r){applyPolyfills()
r=e.format_func=L.compile(e.v)
unapplyPolyfills()}return r(t)}var t=Object.keys(e)
if(1===t.length){var r=e[t[0]]
if(void 0===r||null===r){if(l)o(r,"Nullish values cannot be passed as parameters.")
r=""}var a=r.key
if(a){var i=this.format_cache||(this.format_cache=Object.create(null))
return i[a]||(i[a]=new P(format.bind(null,this,e)))}}return new P(format.bind(null,this,e))}
e.capital=function capital(){return this.cap||(this.cap=new D(this.v.charAt(0).toUpperCase()+this.v.slice(1)))}
e.upper=function upper(){return this.up||(this.up=new D(this.v.toUpperCase()))}
e.lower=function lower(){return this.lo||(this.lo=new D(this.v.toLowerCase()))}
return LocalizedEntry}(D)
var k;(function(e){e[e["Second"]=0]="Second"
e[e["Minute"]=1]="Minute"
e[e["Hour"]=2]="Hour"
e[e["Day"]=3]="Day"
e[e["Year"]=4]="Year"})((r.TimeComponent=k)||(r.TimeComponent=k={}))
var U={lowest:k.Day,highest:k.Year}
r.DURATION_DAYS=U
var G={lowest:k.Day,highest:k.Day}
r.DURATION_ONLY_DAYS=G
var F={lowest:k.Hour,highest:k.Day,initials_only:true}
r.DURATION_DAYS_AND_HOURS_INITIALS=F
var W={lowest:k.Minute,highest:k.Minute}
r.DURATION_ONLY_MINUTES=W
var H={lowest:k.Second,highest:k.Second}
r.DURATION_ONLY_SECONDS=H
var z={lowest:k.Minute}
r.DURATION_WITH_MINUTES=z
var V={lowest:k.Second,always_lowest:true}
r.DURATION_WITH_SECONDS_ALWAYS=V
var Y=[1,60,3600,86400,31536e3]
var j
var K
var q=Y.slice(0)
var Z
r.L=Z
var X=new(function(){function LocalizationImpl(){for(var e in g){var t=I[e]
this[e]=new B(e,void 0!==t?t:g[e])}if(l)for(var r in T){var a=T[r]
o(a)
var i=0
for(e in g)if(void 0===a[e])i++
if(i)console.warn("Language "+r+" is missing "+i+" entries")}}var e=LocalizationImpl.prototype
e.getLanguage=function getLanguage(){return S}
e.setLanguage=function setLanguage(e){var t=T[e]
if(I===t)return true
if(!t)return false
I=t
L=new w(S=e)
this.updateEntriesText()
return true}
e.get=function get(e){return this[e]}
e.$=function $(e,t){var r={val:t}
for(var a=0;a<(arguments.length<=2?0:arguments.length-2);a++)r["val_"+(a+2)]=a+2<2||arguments.length<=a+2?void 0:arguments[a+2]
return e.$(r)}
e.addColon=function addColon(e){return Z.FORMAT_ADD_COLON.$({val:e})}
e.addEllipsis=function addEllipsis(e){return Z.FORMAT_ADD_ELLIPSIS.$({val:e})}
e.addNumberSign=function addNumberSign(e){return Z.FORMAT_ADD_NUMBER_SIGN.$({val:e})}
e.addParentheses=function addParentheses(e){return Z.FORMAT_ADD_PARENTHESES.$({val:e})}
e.addParenthesesAfter=function addParenthesesAfter(e,t){return Z.FORMAT_ADD_PARENTHESES_AFTER.$({val:e,detail:t})}
e.addPercentage=function addPercentage(e){return Z.FORMAT_ADD_PERCENTAGE.$({val:e})}
e.addPlus=function addPlus(e){return Z.FORMAT_ADD_PLUS.$({val:e})}
e.addQuestionMark=function addQuestionMark(e){return Z.FORMAT_ADD_QUESTION_MARK.$({val:e})}
e.separate=function separate(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a]
return this.reactive(function(){return r.join(u(e))})}
e.separateColon=function separateColon(e,t){return this.separate(Z.FORMAT_SEPARATOR_COLON,e,t)}
e.separateComma=function separateComma(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]
return this.separate.apply(this,[Z.FORMAT_SEPARATOR_COMMA].concat(t))}
e.separateWords=function separateWords(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r]
return this.separate.apply(this,[Z.FORMAT_SEPARATOR_WORDS].concat(t))}
e.duration=function duration(e,t){var r,a
var i=null!=(r=t&&t.lowest)?r:k.Minute
var o=null!=(a=t&&t.highest)?a:k.Year
var n=t&&t.always_lowest
var s=t&&t.initials_only
for(var l=o;l>=i;l--)if(e){q[l]=Math.floor(e/Y[l])
e%=Y[l]}else q[l]=0
while(o>i&&!q[o])o--
if(!n)while(i<o&&!q[i])i++
var _=[]
for(var c=o;c>=i;c--){var u=q[c]
if(u||c===i||c===o)_.push((s?K[c]:j[c]).$({val:u}))}return this.separateComma.apply(this,_)}
e.reactive=function reactive(e){return new P(e)}
e.updateEntriesText=function updateEntriesText(){A++
for(var e in g){var t=I[e]
if(C||x&&void 0===t){var r=g[t=e].match(/{[0-9A-Za-z_]+/g)
if(r)t+="["+r.filter(function(e,t,r){return t===r.indexOf(e)}).join("}, ")+"}]"}this.get(e).updateEntry(t||g[e])}}
e.errorLookup=function errorLookup(e){return Z.get(e)||e}
return LocalizationImpl}())
r.L=Z=X
if(l&&"function"===typeof Proxy){var Q=Z.get.bind(Z)
r.L=Z=new Proxy(Z,{get:function get(e,t){if("get"===t)return Q
var r=e[t]
o(void 0!==r,"Attempt to access missing localization entry "+String(t))
return r}})}j=[Z.FORMAT_DURATION_SECONDS,Z.FORMAT_DURATION_MINUTES,Z.FORMAT_DURATION_HOURS,Z.FORMAT_DURATION_DAYS,Z.FORMAT_DURATION_YEARS]
K=[Z.FORMAT_DURATION_SECONDS_INITIALS,Z.FORMAT_DURATION_MINUTES_INITIALS,Z.FORMAT_DURATION_HOURS_INITIALS,Z.FORMAT_DURATION_DAYS_INITIALS,Z.FORMAT_DURATION_YEARS_INITIALS]
c.register({cmd:"lang",access_show:["sysadmin"],help:"Get or set the current language",usage:"Available languages: "+Z.separateComma.apply(Z,y),prefix_usage_with_help:true,func:function func(e,t){if(!e)t(null,Z.MSG_LANGUAGE_GET.$({val:Z.getLanguage()}).toLocalString())
else if(Z.setLanguage(e))t(null,Z.MSG_LANGUAGE_SET.$({val:Z.getLanguage()}).toLocalString())
else t(Z.ERR_LANGUAGE_NOT_FOUND.$({val:e}).toLocalString())}})
var J=["none","untranslated","all"]
var ee=0
c.register({cmd:"lang_debug",access_show:["sysadmin"],help:"Enable language text debugging",usage:"/lang_debug ["+Z.separateComma.apply(Z,J)+"]\nIf used without a value, it will cycle between modes",prefix_usage_with_help:true,func:function func(e,t){var r="Wrong usage"
if(!e)ee=(ee+1)%J.length
else{var a=J.indexOf(e)
if(-1===a)return void t(r)
ee=a}var i=J[ee]
switch(i){case"all":x=C=true
break
case"none":x=C=false
break
case"untranslated":C=false
x=true}X.updateEntriesText()
t(null,Z.separateColon("Language text debugging",i).toLocalString())}})
var te={}
var re
function localizationSetChatUI(e){re=e}c.register({cmd:"lang_entry",access_show:["sysadmin"],help:"Get or set the text for an entry in the current language",usage:"/lang_entry entry [text]",prefix_usage_with_help:true,func:function func(e,t){var r="Entry not found"
var a="Invalid language"
if(!e)return void t(r)
var i=e.indexOf(" ")
var o=-1===i?e:e.substring(0,i)
var n=X.get(o)
if(!n)t(r)
else if(-1===i){var s=I[o]||g[o]
if(d.copyTextToClipboard(s)){re.focus()
t(null,Z.addColon("Text copied to clipboard")+"\n"+s)}else t(null,s)}else if(I===g)t(a)
else{var l=e.substring(i+1)
var _=te[S]
if(!_)_=te[S]={}
_[o]=l
I[o]=l
n.updateEntry(l)
t(null,Z.separateColon(o,l).toLocalString())}}})
var ae
function downloadTextFile(e,t){try{if(!ae)ae=document.createElement("a")
ae.download=e
ae.href="data:application/json;charset=utf-8,"+encodeURIComponent(t)
ae.click()
return true}catch(e){return false}}function uploadTextFile(r){r=f(r)
try{var a=document.createElement("input")
a.type="file"
a.accept=".json,.txt"
a.onchange=function(){var e=a.files&&a.files[0]
if(!e)return void r(null)
try{var t=new FileReader
t.onload=function(e){var t=e.target&&e.target.result
r("string"===typeof t?t:null)}
t.readAsText(e)}catch(e){r(null)}}
a.click()}catch(e){r(null)}}c.register({cmd:"lang_entries_save",access_show:["sysadmin"],help:"Save a file with all the modified entries in the current language",prefix_usage_with_help:true,func:function func(e,t){var r=te[S]
if(!r)return void t("No entries were modified for language "+S)
var a="WorldsFRVR_translations_"+S+".json"
var i=""+JSON.stringify(r,null,2)
if(downloadTextFile(a,i))t(null,"File "+a+" downloaded")
else if(d.copyTextToClipboard(i)){re.focus()
t(null,"Modified entries for language "+S+" copied to clipboard")}else t("Your browser does not support downloading files, please change to a compatible browser")}})
c.register({cmd:"lang_entries_load",access_show:["sysadmin"],help:"Load a file with multiple entries' texts for the current language",prefix_usage_with_help:true,func:function func(e,s){var l="Invalid language"
if(I===g)return void s(l)
uploadTextFile(function(e){if(I===g)return void s(l)
var t
try{t=e&&JSON.parse(e)}catch(e){}if(!t||"object"!==typeof t)return void s("Invalid file")
var r=te[S]
var a=0
for(var i in t){var o=t[i]
if("string"!==typeof o)continue
var n=X.get(i)
if(!n)continue
if(!r)r=te[S]={}
r[i]=o
I[i]=o
n.updateEntry(o)
a++}s(null,"Changed "+a+" entries in the "+S+" language")})}})},{"../../glov/client/client_config":297,"../../glov/client/cmds":298,"../../glov/client/localization":330,"../../glov/client/ui":367,"../../glov/common/util":400,"../../glov/common/verify":401,"./lang_en-US.json":129,"./lang_pt-PT.json":130,"@messageformat/core":void 0,assert:void 0}],132:[function(e,t,r){"use strict"
r.lodGetZFar=lodGetZFar
r.lodQueueHexomeChoices=lodQueueHexomeChoices
r.lodQueueContinentData=lodQueueContinentData
r.lodOnZMap=lodOnZMap
r.shift=shift
r.startStreaming=startStreaming
r.tickLODs=tickLODs
r.reset=reset
r.startup=startup
var f=e("assert")
var o=e("glov-async").asyncParallel
var a=e("../glov/client/browser").is_discrete_gpu
var i=e("../glov/client/cmds").cmd_parse
var s=e("../glov/client/engine")
var n=e("../glov/client/geom")
var l=n.TRIANGLES
var _=n.geomCreate
var c=n.geomCreateIndices
var u=e("../glov/client/shaders")
var d=e("../glov/common/util").easeOut
var v=e("../glov/common/vmath")
var h=v.mat4
var p=v.unit_vec
var m=v.v2addScale
var E=v.v2distSq
var g=v.v2floor
var T=v.v2scale
var y=v.vec1
var S=v.vec2
var I=e("../common/globals")
var A=I.CHUNK_SIZE
var w=I.CS2
var L=I.ID_FACTOR
var O=e("../common/voxel_data_common").ZMAP_UNKNOWN
var R=e("./continent_loader")
var b=R.continentLoaderReady
var N=R.continentLoaderWhenReady
var C=e("./debug")
var x=e("./lods_shared")
var M=x.VERT_SIZE
var D=x.lodGen
var P=e("./main")
var B=e("./megachunk_client").hexomeChoiceReady
var k=e("./proc_gen_biomes").procGenDoLODs
var U=e("./proc_gen_debug")
var G=e("./sky").skyShowLODs
var F=e("./task_sched")
var W=F.WORKER_LOD
var H=F.taskCreate
var z=F.workerFlush
var V=F.workerReady
var Y=F.workerTaskCount
var j=e("./voxel_chunk_manager")
var K=e("./voxel_const").origin_chunk
var q=Math.floor,Z=Math.max,X=Math.min,Q=Math.round
var $=64
var J=-3
var ee=16
var te=a?8:6
var re=2e4
function lodGetZFar(){return Z(re,Q(te/18*re))}var ae=4e3
var ie=5e3
var oe={}
var ne
var se
var le
var _e=0
var ce
var ue
var de=6*($*$)
function lodQueueHexomeChoices(e){ce.push(e)}function lodQueueContinentData(e){ue.push(e)}var fe
function allocIndices(){var e=new Uint16Array(de)
var t=0
for(var r=0;r<$;++r){var a=r*($+1)
var i=a+$+1
for(var o=0;o<$;++o){e[t++]=a+o
e[t++]=i+o+1
e[t++]=i+o
e[t++]=a+o
e[t++]=a+o+1
e[t++]=i+o+1}}f.equal(t,de)
fe=c(e)}var ve=new Uint8Array(2)
function lodUpdateFlushSub(e,t,r,a){if(e.is_water[t>>5]&1<<(31&t))return
r=Z(r,e.min_elev)
var i=t*M+2
var o=e.verts[i]+(e.verts[i+1]<<8)+e.min_elev
if(r<o||s.defines.LODGROW&&r>o){r-=e.min_elev
e.verts[i]=255&r
e.verts[i+1]=r>>8
if(a){ve[0]=255&r
ve[1]=r>>8
e.geom.updateSub(i,ve)}}}function lodUpdateSub(e,t,r,a){var i=oe[t]
if(!i)return
var o=a*($+1)+r
if(!i.verts){if(!i.vupdates)i.vupdates=[]
i.vupdates.push(o,e)
return}lodUpdateFlushSub(i,o,e,true)}function lodUpdateFlush(e){if(!e.vupdates)return
for(var t=0;t<e.vupdates.length;t+=2)lodUpdateFlushSub(e,e.vupdates[t],e.vupdates[t+1],false)
delete e.vupdates}function onLOD(e){if(e.generation!==_e)return
if(!fe)allocIndices()
var t=e.pos,r=e.min_elev,a=e.verts,i=e.is_water
var o=t[0]+t[1]*L
var n=oe[o]
f(n.task)
n.task=null
n.min_elev=r
n.mat=h()
n.verts=a
n.is_water=i
if(!n.load_timestamp)n.load_timestamp=s.frame_timestamp
lodUpdateFlush(n)
n.geom=_(ne,a,fe,l)
n.mat[0]=A
n.mat[5]=A
n.mat[10]=1
n.ready=true}var he=new Int16Array(w)
var pe=.5
function elevFromZmap(e){for(var t=0;t<w;++t)he[t]=e[t]
he.sort()
var r=0
while(he[r]===O)r++
return he[r+Q((w-r)*pe)]}function lodOnZMap(e){var t=e.vsid,r=e.data
f(e.from)
f(void 0!==t)
f.equal(r.length,w)
var a=Q(t/L)
var i=t-a*L
var o=q(i/$)
var n=q(a/$)
var s=i-o*$
var l=a-n*$
var _=o+n*L
var c=oe[_]
if(!c)return
var u=l*$+s
if(!c.zmap_updates)c.zmap_updates={}
else if(c.zmap_updates[u]&&"procgen"===e.from)return
c.zmap_updates[u]=e.from
var d=elevFromZmap(r)
lodUpdateSub(d,_,s,l)
if(!s){lodUpdateSub(d,_-1,$,l)
if(!l)lodUpdateSub(d,_-1-L,$,$)}if(!l)lodUpdateSub(d,_-L,s,$)}function getLOD(e){var t=e[0]+e[1]*L
var r=oe[t]
if(!r)oe[t]=r={ready:false,mat:h(),task:null,load_timestamp:0,world_pos:S(e[0]*$*A,e[1]*$*A)}
return r}var me
var Ee
var ge={fade:y(1)}
function doit(e,t,r){var a=getLOD(e)
if(!a.ready){if(r)return
if(!a.task&&(t||s.defines.NOWORKERS||V(W))&&b(a.world_pos,ae)){var i={pos:[e[0],e[1]],generation:_e}
if(ce.length){i.hexome_choices=ce
ce=[]}if(ue.length){i.continents=ue
ue=[]}if(s.defines.NOWORKERS){a.task=true
onLOD(D(e,_e))}else{Ee=true
a.task=H({worker:W,time:120,type:"lod_gen",data:i},onLOD)
if(t)z(W)}}++me
return}if(t)return
if(!G())return
a.mat[12]=(e[0]*$-K[0]+.5)*A
a.mat[13]=(e[1]*$-K[1]+.5)*A
a.mat[14]=-K[2]*A+a.min_elev+J
s.updateMatrices(a.mat)
var o=s.frame_timestamp-a.load_timestamp
if(o<ie&&a.load_timestamp>P.loading_finished_timestamp)ge.fade[0]=d(o/ie,2)
else ge.fade[0]=1
u.bind(se,le,ge)
a.geom.draw()}var Te=[]
var ye=false
function shift(){ye=true
var e=T(S(),K,1/$)
var t=g(S(),e)
var r=[]
var a=[]
var i=[]
var o=S()
m(e,e,p,-.5)
for(var n=-te-1;n<=te+1;++n){o[1]=t[1]+n
for(var s=-te-1;s<=te+1;++s){o[0]=t[0]+s
var l=E(o,e)
if(l<=te*te){i.push(i.length)
a.push(l)
r.push(o.slice(0))}}}i.sort(function(e,t){return a[e]-a[t]})
for(var _=Te.length=0;_<i.length;++_)Te.push(r[i[_]])}i.registerValue("lod_view_dist",{type:i.TYPE_INT,label:"LOD View Distance",range:[1,18],get:function get(){return te},set:function set(e){te=e
if(ye)shift()},store:true})
i.registerValue("lod_view_dist_temp",{type:i.TYPE_INT,label:"LOD View Distance (not persisted, may crash)",range:[1,100],get:function get(){return te},set:function set(e){te=e
shift()},store:false})
function startStreaming(){if(!k())return
var r=_e
function startStreamingOnReady(){if(r!==_e)return
var e=X(ee,Te.length)
for(var t=0;t<e;++t)doit(Te[t],true)}if(P.omp){var e=[B]
var t=X(ee,Te.length)
for(var a=0;a<t;++a){var i=getLOD(Te[a])
e.push(N.bind(null,i.world_pos,ae))}o(e,startStreamingOnReady)}else startStreamingOnReady()}var Se=false
function tickLODs(){if(!k())return
profilerStart("tickLODs")
var e=false
if(P.omp&&!B()){if(s.defines.LODS)C.addText("LODs: Hexome choice not ready")
e=true}Ee=false
for(var t=me=0;t<Te.length;++t)doit(Te[t],false,e)
if(Ee)z(W)
if(s.defines.LODS){C.addText("LODs: "+me+"/"+Te.length+" waiting")
C.addText("LODs: worker: "+Y(W)+" tasks, "+(V(W)?"":"Not ")+"ready")
C.addText("LODs: "+(Se?"":"not ")+"done")}if(!me&&!Se&&!e){U.dumpPerf()
console.log("LODs generated in "+(Date.now()-j.load_start)+"ms")
Se=true}profilerStop("tickLODs")}function reset(){for(var e in oe){var t=oe[e]
if(t.geom)t.geom.dispose()}_e++
oe={}
ce=[]
ue=[]}function startup(){se=u.create("shaders/lods.vp")
le=u.create("shaders/lods.fp")
u.prelink(se,le)
ne=[[u.semantic.POSITION,gl.UNSIGNED_BYTE,4,false],[u.semantic.COLOR,gl.UNSIGNED_BYTE,4,true],[u.semantic.NORMAL,gl.UNSIGNED_BYTE,4,true]]}},{"../common/globals":248,"../common/voxel_data_common":264,"../glov/client/browser":293,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/geom":318,"../glov/client/shaders":353,"../glov/common/util":400,"../glov/common/vmath":402,"./continent_loader":47,"./debug":73,"./lods_shared":133,"./main":135,"./megachunk_client":139,"./proc_gen_biomes":163,"./proc_gen_debug":165,"./sky":188,"./task_sched":198,"./voxel_chunk_manager":214,"./voxel_const":215,assert:void 0,"glov-async":void 0}],133:[function(e,t,r){"use strict"
r.lodGen=lodGen
r.VERT_SIZE=void 0
var I=12
r.VERT_SIZE=I
var A=e("assert")
var w=e("../glov/common/util").lerp
var a=e("../glov/common/vmath")
var L=a.v2set
var O=a.v3cross
var R=a.v3iAdd
var b=a.v3iNormalize
var i=a.vec2
var o=a.vec3
var n=e("../common/globals")
var N=n.CHUNK_SIZE
var C=n.ID_FACTOR
var s=e("./proc_gen_biomes")
var x=s.RFLOW_UNDERWATER
var M=s.getVSElevAndTile
var D=e("./proc_gen_hydro").hydroChunkInitRange
var l=e("./tiles")
var P=l.liquid_colors
var B=l.tile_colors
var k=Math.ceil,U=Math.floor,G=Math.max,F=Math.min
var W=64
var H=(W+1)*(W+1)
var z=W+3
var V=new Float32Array(z*z)
var Y=new Array(z*z)
var j=new Uint8Array(z*z*3)
var K=o()
var q=o()
var Z=i()
var X=[o(N,0,0),o(0,N,0),o(-N,0,0),o(0,-N,0)]
function lodGen(e,t){var r=new Uint8Array(H*I)
var a=new Uint32Array(k(H/32))
var i=e[1]*W*C+e[0]*W
var o=e[0]*W*N
var n=e[1]*W*N
L(Z,o,n)
D(Z,W*N)
var s=0
var l=Infinity
var _=-Infinity
for(var c=-1;c<=W+1;++c){Z[1]=n+c*N+N/2
for(var u=-1;u<=W+1;++u){Z[0]=o+u*N+N/2
var d=M(i+u+c*C,Z)
if(d.tint){j[3*s]=255*d.tint[0]
j[3*s+1]=255*d.tint[1]
j[3*s+2]=255*d.tint[2]}Y[s]=d
var f=U(d.elev)
l=F(l,f)
_=G(_,f)
V[s++]=f}}A.equal(s,V.length)
l-=U((65535-(_-l))/2)
function calcNormal(e){var t=V[e]
X[0][2]=V[e+1]-t
X[1][2]=V[e+z]-t
X[2][2]=V[e-1]-t
X[3][2]=V[e-z]-t
O(K,X[0],X[1])
R(K,O(q,X[1],X[2]))
R(K,O(q,X[2],X[3]))
R(K,O(q,X[3],X[0]))
b(K)}var v=s=0
for(var h=0;h<=W;++h){var p=(h+1)*z+1
for(var m=0;m<=W;++m){r[s++]=m
r[s++]=h
var E=V[p]-l
r[s++]=255&E
r[s++]=E>>8
var g=Y[p]
if(g.tint){r[s++]=j[3*p]
r[s++]=j[3*p+1]
r[s++]=j[3*p+2]}else{var T=B[g.tile]||B.def
r[s++]=T[0]
r[s++]=T[1]
r[s++]=T[2]}var y=P[g.liquid]
if(y){var S=F(g.rflow_amt/4,1)
r[s-3]=w(S,r[s-3],y[0])
r[s-2]=w(S,r[s-2],y[1])
r[s-1]=w(S,r[s-1],y[2])}r[s++]=255
calcNormal(p)
r[s++]=127.5*K[0]+127.5
r[s++]=127.5*K[1]+127.5
r[s++]=127.5*K[2]+127.5
r[s++]=0;++p
if(g.rflow_amt===x)a[v>>5]|=1<<(31&v);++v}}A.equal(s,r.length)
return{pos:e,min_elev:l,generation:t,verts:r,is_water:a}}},{"../common/globals":248,"../glov/common/util":400,"../glov/common/vmath":402,"./proc_gen_biomes":163,"./proc_gen_hydro":167,"./tiles":199,assert:void 0}],134:[function(e,t,r){"use strict"
r.checkLoginRewardsToClaim=checkLoginRewardsToClaim
var s=e("assert")
var l=e("../glov/client/net").netSubs
var _=e("../glov/client/ui").modalDialog
var a=e("../common/rewards_common")
var c=a.LOGIN_REWARDS
var u=a.LoginRewardRequirementType
var d=e("../common/store_data").PRODUCT_ITEM_ID_GEM
var f=e("./analytics").logEvent
var v=e("./localization/localization").L
var o=e("./social_referral").getReferralNumber
var h=e("./status")
var p=e("./store").getProduct
var m=[]
function displayLoginRewardDialog(){var t=m.shift()
if(!t)return
var e=c[t]
if(!e)return
var r=l().getMyUserChannel()
if(!r)return
var a=p(e.product_id)
var i=a&&a.items&&a.items[0]
if(!i)s(false,"Product item does not exist: "+(a&&a.items))
var o
if(e.req_type===u.REFERRALS)o=v.DLG_REWARD_REFERRAL_MSG.$({friends:e.referrals})
var n
if(i.id===d)n=v.$(v.DLG_REWARD_GEM_MSG,i.amount)
s(o&&n)
_({title:v.DLG_REWARD_TITLE,text:v.separate("\n\n",o,n),buttons:{ok:function ok(){r.send("login_reward_claim",t,function(e){if(e){h.push(e)
return}f("reward_claim",1,void 0,t)
displayLoginRewardDialog()})}}})}function checkLoginRewardsToClaim(){var e=l().getMyUserChannel()
if(!e)return
m.length=0
var t=e.getChannelData("public.login_rewards",{})
var r=o()
for(var a in c){var i=c[a]
if(i&&!t[a])if(i.req_type===u.REFERRALS&&r>=i.referrals)m.push(a)}displayLoginRewardDialog()}},{"../common/rewards_common":259,"../common/store_data":262,"../glov/client/net":338,"../glov/client/ui":367,"./analytics":6,"./localization/localization":131,"./social_referral":190,"./status":193,"./store":195,assert:void 0}],135:[function(e,t,r){"use strict"
r.setZRangeLODs=setZRangeLODs
r.setZRangeDefault=setZRangeDefault
r.mainActive=mainActive
r.charControllerPos=charControllerPos
r.charController=charController
r.setExploreCanMoveChar=setExploreCanMoveChar
r.setExploreCanMovePht=setExploreCanMovePht
r.chatUI=chatUI
r.blockImageUpload=blockImageUpload
r.mainStartLoad=mainStartLoad
r.startMain=startMain
r.returnToMainMenu=returnToMainMenu
r.mapEmoteToAnimation=mapEmoteToAnimation
r.toggleMenuPage=toggleMenuPage
r.menuExitGeneric=menuExitGeneric
r.menuExitClear=menuExitClear
r.shouldDrawMenuButton=shouldDrawMenuButton
r.menuButton=menuButton
r.menuExit=menuExit
r.isMenuPage=isMenuPage
r.menuConsumeExit=menuConsumeExit
r.menuCurrencyPushes=menuCurrencyPushes
r.addBatchedSend=addBatchedSend
r.getFrameTransactionSet=getFrameTransactionSet
r.getFrameTransaction=getFrameTransaction
r.frameTransactionCount=frameTransactionCount
r.verifyFrameTransactions=verifyFrameTransactions
r.postTick=postTick
r.isQuickbarVisible=isQuickbarVisible
r.unreleasedReload=unreleasedReload
r.main=main
r.loading_finished_timestamp=r.walltime_seconds=r.instance_uid=r.chat_ui=r.pht_controller=r.char_controller=r.main_active=r.omp=void 0
var a=e("../glov/client/local_storage")
a.setStoragePrefix("frvr_edits2")
e("../common/platform_worlds_common")
var o=e("assert")
var i=e("../frvr/client/platforms/adapter").initPlatformAdapter
var n=e("../frvr/client/xplay/login").xplaySetup
var s=e("../glov/client/browser").is_discrete_gpu
var l=e("../glov/client/client_config")
var _=l.MODE_PRODUCTION
var c=l.setAbilityReloadUpdates
var u=e("../glov/client/cmds").cmd_parse
var d=e("../glov/client/draw_list")
var f=e("../glov/client/effects").effectsStartup
var S=e("../glov/client/engine")
var v=e("../glov/client/engine").defineOnChange
var h=e("../glov/client/error_report")
var p=h.errorReportIgnoreUncaughtPromises
var m=h.errorReportSetDetails;(0,h.reportingUseAppAPIPath)()
var E=e("../glov/client/filewatch").filewatchMessageHandler
var g=e("../glov/client/input")
var T=e("../glov/client/net")
var I=T.netClient
var y=T.netClientId
var A=T.netDisconnected
var w=T.netDisconnectedRaw
var L=T.netInit
var O=T.netSubs
var R=e("../glov/client/scroll_area").scrollAreaSetPixelScale
var b=e("../glov/client/settings")
var N=e("../glov/client/slider").sliderSetDefaultShrink
var C=e("../glov/client/snapshot").snapshotStartup
var x=e("../glov/client/social")
var M=x.richPresenceSet
var D=x.setDefaultUserProfileImage
var P=x.socialInit
var B=e("../glov/client/spot").spotSuppressPad
var k=e("../glov/client/ui")
var U=e("../glov/client/ui").uiButtonHeight
var G=e("../glov/client/urlhash")
var F=e("../glov/client/walltime")
var W=e("../glov/client/webfs").webFSReportUnused
var H=e("../glov/client/worker_comm")
var z=H.WORKER_ALL
var V=H.workerCommSendMsg
var Y=e("../glov/client/worker_perf")
var j=e("../glov/common/enums")
var K=j.PRESENCE_ACTIVE
var q=j.PRESENCE_INACTIVE
var X=j.PRESENCE_OFFLINE_INACTIVE
var Q=e("../glov/common/platform").platformOverrideParameter
var $=e("../glov/common/util").callEach
var J=e("../glov/common/verify")
var ee=e("../glov/common/vmath")
var te=ee.v3lengthSq
var re=ee.v3scale
var ae=ee.v3scaleFloor
var ie=ee.v4set
var oe=ee.vec3
var ne=e("../common/globals")
var se=ne.CHUNK_SIZE
var le=ne.CURRENT_VERSION
var _e=e("../common/world_trans").createTransSet
var ce=e("./abtest_worlds")
var ue=ce.abTestWorldsPostStartup
var de=ce.abTestWorldsStartup
var fe=e("./analytics")
var ve=fe.analyticsStartup
var he=fe.logEvent
var pe=e("./app_access").accessPrerelease
var me=e("./app_settings")
var Ee=e("./auto_activate_ui")
var ge=Ee.autoActivateSuppress
var Te=Ee.autoActivateTick
var ye=e("./baking").meshWorkerSetUnreleasedTiles
var Se=e("./baking")
var Ie=e("./block_intersections").drawBlockIntersections
var Ae=e("./bluebox_edit_list")
var we=Ae.blueboxDrawAllEditBounds
var Le=Ae.boundsStartup
var Oe=e("./blueprint").blueprintStartup
var Re=e("./build_menu")
var be=Re.doBuildEarly
var Ne=Re.updateUserBlueprints
var Ce=e("./build_mode")
var xe=Ce.buildModeReset
var Me=Ce.suppressQueuedPlaceCancel
var De=Ce.undergroundFactors
var Pe=e("./build_mode")
var Be=e("./build_queue_ui").buildQueuePanel
var ke=e("./camera")
var Ue=ke.cameraGetMainFOV
var Ge=ke.cameraStartup
var Fe=ke.getActiveController
var We=ke.handleCameraInput
var He=ke.setCharacterControllerAsActive
var ze=ke.setViewParameters
var Ve=ke.updateAndGetViewMatrix
var Ye=ke.updateCurrentCamera
var je=e("./character_controller").CharacterController
var Ke=e("./character_customization").customizationPendingChanges
var qe=e("./chat_floater")
var Ze=qe.chatFloaterReset
var Xe=qe.chatFloaterShift
var Qe=qe.chatFloaterTick
var $e=e("./chat_ui_worlds").chatUIWorldsStartup
e("./client_cmds")
var Je=e("./client_entities")
var et=Je.clientEntitiesStartup
var tt=Je.clientEntitiesTickLate
var rt=Je.getEntityManager
var at=Je.setEntityToDebug
var it=e("./context").setAccessPrerelease
var ot=e("./continent_loader").continentLoadsWaiting
var nt=e("./cosmetics")
var st=e("./costume_edit").costumeEditStartup
var lt=e("./debug")
var _t=e("./dragdrop_resource_reload")
var ct=_t.dragdropReloadStartup
var ut=_t.hasCustomTextures
var dt=e("./draw_sprite3d").drawSprite3DStartup
var ft=e("./editvolume_clear").editVolumeClearContentsTick
var vt=e("./editvolume_client").volumeCurrent
var ht=e("./environments_worlds").environmentsWorldsInit
var pt=e("./external_users/external_users_client_worlds").externalUsersWorldsStartup
var mt=e("./frvr_sdk_worlds").frvrInit
var Et=e("./huds")
var gt=Et.adventureHUD
var Tt=Et.gemsHUD
var yt=Et.initHUDs
var St=Et.socialHUD
var It=e("./img/font/inknut24.20.json")
var At=e("./img/font/ubuntu32.20.json")
var wt=e("./in_app_purchases/iap_client_worlds").iapWorldsStartup
var Lt=e("./inventory")
var Ot=e("./item_anims")
var Rt=e("./item_info_view")
var bt=Rt.itemInfoViewClear
var Nt=Rt.itemInfoViewTick
var Ct=e("./item_unlock_ui").itemUnlockTick
var xt=e("./items").itemsTick
var Mt=e("./items")
var Dt=e("./layout")
var Pt=Dt.layoutCameraFull
var Bt=Dt.layoutTick
var kt=Dt.quickbarOnTop
var Ut=e("./layout")
var Gt=e("./loading_custom")
var Ft=Gt.loadingCustomDrawNow
var Wt=Gt.loadingCustomInit
var Ht=e("./localization/localization")
var zt=Ht.L
var Vt=Ht.localizationPastStartup
var Yt=e("./lods")
var jt=e("./lods").lodGetZFar
var Kt=e("./main_menu")
var qt=Kt.elevatedWarn
var Zt=Kt.mainMenuStartup
var Xt=e("./main_menu")
var Qt=e("./megachunk_client")
var $t=e("./menu")
var Jt=$t.doQuickSlotMenu
var er=$t.getMenuPage
var tr=$t.getMenuPreviousPage
var rr=$t.isQuickMenu
var ar=$t.lockMenuPageToDraw
var ir=$t.menuClear
var or=$t.menuDoTransition
var nr=$t.menuGetDetails
var sr=$t.menuWantsQuickbarScroll
var lr=e("./menu")
var _r=e("./menu_ribbon")
var cr=_r.drawMenuRibbon
var ur=_r.pushMenuRibbonElement
var dr=e("./mobs")
var fr=dr.mobsDraw
var vr=dr.mobsDrawLate
var hr=dr.mobsStartup
var pr=dr.mobsTick
var mr=e("./mod_api_host").modAPIStartup
var Er=e("./particle_system")
var gr=e("./party_ui").partyPanel
var Tr=e("./photo_controller").PhotoController
var yr=e("./photo_mode")
var Sr=yr.copyToClipboardCheck
var Ir=yr.getPhotoStartPosition
var Ar=yr.photoCanMove
var wr=yr.photoCanMoveChar
var Lr=yr.photoCanMovePht
var Or=yr.photoModeActive
var Rr=yr.photoModeCancel
var br=yr.photoModeTick
var Nr=yr.shiftPhotoBounds
var Cr=e("./platform_worlds_client").PLATFORM_MSSTART
var xr=e("./proc_gen")
var Mr=e("./proc_gen_debug")
var Dr=e("./prop_edit").propEditDialog
var Pr=e("./props")
var Br=e("./quickbar")
var kr=e("./quickbar").tickQuickBar
var Ur=e("./race_ui")
var Gr=Ur.isRacePanelActive
var Fr=Ur.racePanel
var Wr=e("./red_dot").redDotStartup
var Hr=e("./saplings_debug").saplingDebug
var zr=e("./settlement").settlementBeamDraw
var Vr=e("./share_menu")
var Yr=Vr.shareButton
var jr=Vr.shareMenu
var Kr=e("./sky")
var qr=Kr.skyDraw
var Zr=Kr.skyEdit
var Xr=Kr.skyShift
var Qr=Kr.skyStartup
var $r=Kr.skyStartupEarly
var Jr=Kr.skyTick
var ea=e("./status")
var ta=e("./styles").color_black
var ra=e("./task_sched")
var aa=e("./todo_list").todoListTick
var ia=e("./tutorial")
var oa=ia.tutorialForcingMenu
var na=ia.tutorialPostStateTick
var sa=ia.tutorialReset
var la=ia.tutorialStartup
var _a=ia.tutorialTick
var ca=e("./ui_sounds")
var ua=e("./ui_util")
var da=e("./ui_util").uiUtilStartup
var fa=e("./ui_util_2").uiUtil2Startup
var va=e("./ui_util_hires").uiUtilHiresStartup
var ha=e("./user_data")
var pa=ha.userAttribTick
var ma=ha.userDataInit
var Ea=ha.userDataIsWaiting
var ga=ha.userDataStartWaiting
var Ta=ha.worldReadOnly
var ya=e("./user_data")
var Sa=e("./user_info_view")
var Ia=Sa.userInfoViewClear
var Aa=Sa.userInfoViewTick
var wa=e("./user_party").userPartyInit
var La=e("./user_profile_view").userProfileViewIsMe
var Oa=e("./voxel_chunk_manager")
var Ra=e("./voxel_const").origin_chunk
var ba=e("./voxel_data").remeshAll
var Na=e("./voxel_data")
var Ca=e("./voxel_gen")
var xa=e("./wallet_ui")
var Ma=xa.walletShowCurrencyButtons
var Da=xa.walletShowFreeGemsButton
var Pa=xa.walletShowValues
var Ba=e("./waygate_upgrade").waygateUpgradeStartup
var ka=e("./welcome_screen").welcomeScreenGetInitialState
var Ua=e("./world_comm")
var Ga=Ua.getPerm
var Fa=Ua.getWorldChannel
var Wa=Ua.getWorldID
var Ha=Ua.leaveWorld
var za=Ua.transact
var Va=Ua.worldAutoConnect
var Ya=Ua.worldCommStartup
var ja=Ua.worldIsWaiting
var Ka=e("./world_info").getWorldInfo
var qa=e("./world_info_view")
var Za=qa.worldInfoShowAdminLog
var Xa=qa.worldInfoShowEditMode
var Qa=e("./world_init")
var $a=Qa.worldInitStart
var Ja=Qa.worldInitTick
var ei=e("./world_metadata")
var ti=ei.adventureMode
var ri=ei.worldMetadata
var ai=ei.worldMetadataDefaultWaygatePos
var ii=ei.worldMetadataReset
var oi=e("./worlds_sound").playSound
var ni=e("./worlds_soundscape")
var si=ni.soundscapeStartup
var li=ni.soundscapeStop
var _i=ni.soundscapeTick
var ci=Math.abs,ui=Math.round
Z.FLOATERS_MIN=40
Z.FLOATERS_MAX=49
Z.PHOTO_BORDER=50
Z.FLOATER_INTERACT=60
Z.GEMS_HUD=90
Z.TODO_LIST=90
Z.QUICKBAR=100
Z.MENUBUTTON=120
Z.UI=140
Z.PAPERDOLL=180
Z.USER_INFO_VIEW=190
Z.DIG_INDICATOR=200
Z.CHAT=210
Z.CHAT_FOCUSED=210
Z.DRAG=400
Z.TUT=900
Z.TUT_INDICATOR=910
Z.SETTLEMENT_ANIMATE_COMPLETE=920
Z.EDITVOLUME_STATUS=930
Z.ITEM_INFO_VIEW=950
Z.POPUP_MENU=960
Z.ITEM_UNLOCK=970
Z.CROSSHAIR=1e3
Z.MODAL=1e3
Z.TODO_LIST_FLASH=1020
Z.STATUS=1800
Z.WAYGATE_FX=1900
Z.LOADING=2e3
Z.CHAT_WHILE_LOADING=2200
Z.DEBUG_TEXT=2300
Z.TOOLTIP=2700
Z.PHOTO_FLASH=2800
var di=.1
var fi=5e3
var vi=10
function setZRangeLODs(){S.setZRange(vi,jt())}function setZRangeDefault(){S.setZRange(di,fi)}var hi=false
r.omp=hi
var pi=false
r.main_active=pi
function mainActive(){return pi}var mi
r.char_controller=mi
var Ei
r.pht_controller=Ei
function charControllerPos(){return mi.pos}function charController(){return mi}var gi=true
var Ti=false
function setExploreCanMoveChar(e){gi=e}function setExploreCanMovePht(e){Ti=e}var yi
r.chat_ui=yi
function chatUI(){return yi}var Si
r.instance_uid=Si
var Ii
var Ai=F.seconds()
r.walltime_seconds=Ai
function blockImageUpload(){return ut()&&!Ga("sysadmin")}function shiftOrigin(e){Na.shift(e)
console.log("Origin shift -> "+Ra)
re(e,e,-se)
mi.shift(e)
Ei.shift(e)
if(Or())Nr(e)
Xr(e)
Pe.shift(e)
Yt.shift(e)
lr.shift(e)
Ot.shift(e)
Qt.shift(e)
Er.shift(e)
Xe(e)}var wi=oe()
function checkOriginShift(){var e=mi.pos
if(Or())e=Ir()
ae(wi,e,1/se)
var t=te(wi)
if(t>=4)if(t>Oa.claim_dist_sq&&!S.defines.FREECAM){startLoading(loadReStartStreaming)
Ft()}else shiftOrigin(wi)}function originShiftStartUp(){ae(wi,mi.pos,1/se)
shiftOrigin(wi)}var Li
function loadWaitForNearbyChunks(){Oa.updateChunks(50)
if(S.defines.CHUNKMAN)Oa.drawChunkManDebug()
lt.draw(10,110)
var e=Oa.nearbyChunksWaiting()+ot()
e+=ja()
if(!rt().isReady())e++
if(!e&&!er()){if(S.defines.INVENTORY)toggleMenuPage(lr.INVENTORY)
if(S.defines.BUILD)toggleMenuPage(lr.BUILD)
if(S.defines.SETTINGS)toggleMenuPage(lr.SETTINGS)
if(S.defines.WORLD_INFO)toggleMenuPage(lr.WORLD_INFO_VIEW_SELF)
if(S.defines.ADMIN_LOG){toggleMenuPage(lr.WORLD_INFO_VIEW_SELF)
Za(false)}if(S.defines.WORLD_SETTINGS){toggleMenuPage(lr.WORLD_INFO_VIEW_SELF)
Xa()}}return e}function loadReStartStreaming(){originShiftStartUp()
Oa.restartStreaming()
Yt.startStreaming()
return(Li=loadWaitForNearbyChunks)()}function loadNeedInitTick(){var e=loadWaitForNearbyChunks()
if(e)return e
if(e=Ja())return e
return(Li=loadWaitForNearbyChunks)()}function loadNeedInitWait(){var e=Ja()
o(e)
return e}function loadNeedInitStart(){Ca.seedWorld()
Li=loadNeedInitWait
$a(function(e){mi.load(e)
mi.enterWorldInit()
originShiftStartUp()
Oa.startStreaming()
Yt.startStreaming()
Li=loadNeedInitTick})
return Li()}function loadStartStreaming(){if(A())return 1
mi.load(ai())
mi.enterWorldInit()
Ca.seedWorld()
originShiftStartUp()
Oa.startStreaming()
Yt.startStreaming()
return(Li=loadWaitForNearbyChunks)()}function loadWaitingForWorldData(){var e=0
if(!ri())e++
if(ya.isWaiting())e++
if(!(e+=ja()))if(ri().need_init)Li=loadNeedInitStart
else Li=loadStartStreaming
if(S.defines.CHUNKMAN)Oa.drawChunkManDebug()
lt.draw(10,110)
return e+1}var Oi=0
r.loading_finished_timestamp=Oi
function startLoading(e,a,t){a=a||Date.now()
Li=e
M(K,"loading")
var i=false
Wt({extra_frames:6,state:tick,start:function start(){},tick:function startLoadingTick(){var e=hi
if(hi){Xt.drawCheckConnectionMessage()
tickOMP()}yi.setZOverride(Z.CHAT_WHILE_LOADING)
var t=!this.finished
if(t)yi.run({hide:Ea(),pointerlock:!g.touch_mode})
var r
if(e!==hi)r=1
else if(!(r=Li())&&!i){i=true
console.log("Leaving loading state after "+(Date.now()-a)+"ms")}if(t)yi.runLate()
return r},on_finished:function on_finished(){o(ri())
r.loading_finished_timestamp=Oi=S.frame_timestamp
if(t)t()}})}function mainStartLoad(e){var t=Date.now()
Rr()
ir()
ea.clear()
ii()
sa()
Na.reset()
ga(false)
Ne()
Ii=null
startLoading(loadWaitingForWorldData,t,e)}function startMain(e,t){o(!hi)
o(e)
r.omp=hi=e
r.main_active=pi=true
if(hi)r.instance_uid=Si=y()
else r.instance_uid=Si="local"
mainStartLoad(t)
if(!hi)ma()
Ze()
yt()}var Ri=[]
var bi=false
var Ni=false
function returnToMainMenu(e){if(!e&&Ni){bi=true
return}var t=hi
r.omp=hi=false
Na.reset()
if(t){if(Ri.length){$(Ri)
Ri.length=0}Ha()
r.instance_uid=Si="local"}r.main_active=pi=false
Rr()
menuExit()
if(Dr())k.modalDialogClear()
xe()
if(!Va())mi.clearPos()
li()
S.setState(Xt.mainMenuInit)}function logCaps(){var y=false
function logFinal(e,t){if(y)return
if(w())return
y=true
function supportsWebAssembly(){try{return window.WebAssembly&&"function"===typeof window.WebAssembly.instantiate||false}catch(e){return false}}try{var r=S.canvas.getBoundingClientRect()
var a=gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS)
var i=gl.getParameter(gl.MAX_RENDERBUFFER_SIZE)
var o=gl.getParameter(gl.MAX_TEXTURE_SIZE)
var n=gl.getParameter(gl.MAX_VARYING_VECTORS)
var s=gl.getParameter(gl.MAX_VERTEX_ATTRIBS)
var l=gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS)
var _=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
var c=gl.getSupportedExtensions()
var u=gl.getParameter(gl.VENDOR)
var d=gl.getParameter(gl.RENDERER)
var f="unavailable"
var v="unavailable"
var h=gl.getExtension("WEBGL_debug_renderer_info")
if(h){f=gl.getParameter(h.UNMASKED_VENDOR_WEBGL)
v=gl.getParameter(h.UNMASKED_RENDERER_WEBGL)}var p=S.canvas.clientWidth
var m=S.canvas.clientHeight
var E=ci(r.width-p)>2||ci(r.height-m)>2
var g=window.devicePixelRatio||1
var T={type:"caps",dpr:g,client_width:p,client_height:m,dpcbsw:e,dpcbsh:t,dpcbs_mismatch:Boolean(e>0&&(ui(r.width*g)!==e||ui(r.height*g)!==t)),rect_width:r.width,rect_height:r.height,rect_mismatch:E,screen_width:window.screen.width,screen_height:window.screen.height,max_fragment_uniform_vectors:a,max_renderbuffer_size:i,max_texture_size:o,max_varying_vectors:n,max_vertex_attribs:s,max_vertex_uniform_vectors:l,max_vertex_texture_units:_,vendor:u,renderer:d,vendor_unmasked:f,renderer_unmasked:v,ua:window.navigator.userAgent,webgl:S.webgl2?2:1,supported_extensions:c,wasm:supportsWebAssembly()}
I().send("log",T)}catch(e){I().send("log",{type:"caps",error:e.toString()})}}if(window.ResizeObserver&&false){var i=setTimeout(logFinal.bind(null,-3),3e4)
try{var o=new window.ResizeObserver(function(e){clearTimeout(i)
var t=e&&e[0]
var r=t&&t.devicePixelContentBoxSize&&t.devicePixelContentBoxSize[0].inlineSize
var a=t&&t.devicePixelContentBoxSize&&t.devicePixelContentBoxSize[0].blockSize
o.disconnect()
logFinal(r,a)})
o.observe(S.canvas,{box:["device-pixel-content-box"]})}catch(e){logFinal(-4)}}else logFinal(-1)}G.register({key:"autoanon"})
G.register({key:"msstart"})
G.register({key:"msstart_sdk_init"})
G.register({key:"instance_id"})
G.register({key:"channel_id"})
G.register({key:"guild_id"})
G.register({key:"frame_id"})
G.register({key:"platform"})
v("ENTITY",function(){at(0)})
v("HIDE_UNRELEASED",unreleasedReload)
function mapEmoteToAnimation(e){if(e.match(/wave/i))mi.wave()
else if(e.match(/\bsits?\b/i))mi.sitOnBlock()}function startup(){G.startup({title_transformer:function title_transformer(e){return e?zt.$(zt.WINDOW_TITLE_COMPOSITE,e):zt.WINDOW_TITLE}})
if(Cr){G.historyDeferUpdate(true)
G.set("msstart","msstart")}C()
R(.4)
ra.startup()
O().onceConnected(logCaps)
O().onceConnected(function(){V(z,"access_prerelease",pe())
it(pe())})
P()
wa()
k.scaleSizes(3.125)
k.setPanelPixelScale(.78125)
k.setTooltipWidth(300,.5)
k.setFontHeight(24)
k.setModalSizes(100)
N(.25,.5)
k.setButtonsDefaultLabels({cancel:zt.BTN_CANCEL,no:zt.BTN_NO,ok:zt.BTN_OK,retry:zt.BTN_RETRY,yes:zt.BTN_YES})
k.setProvideUserStringDefaultMessages(zt.MSG_COPY_TEXT_SUCCESS,zt.MSG_COPY_TEXT_FAILURE)
ie(k.color_panel,1,1,.8,1)
ct(S.canvas)
Ge()
$r()
f(["gaussian_blur","copy","color_matrix"])
et()
r.char_controller=mi=new je
r.pht_controller=Ei=new Tr
He()
E(function(e){oi("msg_in")
yi.addChat(e)})
S.onLoadMetrics(function(e){he("load_time_total",e.time_total,"load_time")
he("load_time_js_load",e.time_js_load,"load_time")
he("load_time_js_init",e.time_js_init,"load_time")
he("load_time_resource_load",e.time_resource_load,"load_time")})
da()
fa()
r.chat_ui=yi=$e()
Zt()
Ut.startup()
Na.startup()
xr.startup()
va()
Pe.startup()
Mt.itemLocalizationStartup()
Lt.startup()
Mt.startup()
Br.startup()
Pr.startup()
Qr()
nt.startup()
lr.startup()
Yt.startup()
hr()
Ot.startup()
Ya()
Y.startup()
Se.startup()
si()
la()
st()
mr()
Oe()
Wr()
Le()
i()
Ba()
dt()
pt()
wt()
D({img:ua.sprite,img_color:ta,frame:ua.USER_PROFILE})
Mt.itemCheck()
setTimeout(checkInactive,1e3)
W(/\.(fp|vp|vm|pal)$|^particles\//)}var Ci
function toggleMenuPage(e,t){Ia()
if(pi&&er()===e&&(!nr()||nr()===t))Ci=true
else{lr.init(e,t||(lr.active()?lr.KEEP:null))
Me()
g.pointerLockExit()}}var xi={in_event_cb:g.pointerLockEnter}
function menuHotkeys(){var e=!g.touch_mode&&lr.page===lr.INVENTORY?xi:null
if(g.keyDownEdge(g.KEYS.I,e))toggleMenuPage(lr.INVENTORY)
var t=!g.touch_mode&&lr.page===lr.SOCIAL?xi:null
if(g.keyDownEdge(g.KEYS.P,t))toggleMenuPage(lr.SOCIAL)
var r=!g.touch_mode&&lr.page===lr.WORLD_INFO_VIEW_SELF?xi:null
if(g.keyDownEdge(g.KEYS.O,r))toggleMenuPage(lr.WORLD_INFO_VIEW_SELF)
var a=!g.touch_mode&&lr.isBuildMenu()?xi:null
if(!Ta()&&(g.keyDownEdge(g.KEYS.B,a)||g.padButtonDownEdge(g.PAD.X)||!Jt()&&g.keyDownEdge(g.KEYS.Q,a)))toggleMenuPage(lr.BUILD)}var Mi=false
function menuExitGeneric(){Mi=true}function menuExitClear(){Mi=false}function shouldDrawMenuButton(){return!S.defines.NOUI&&!(Pe.doingDragPlace()&&g.touch_mode)}var Di
var Pi
function menuButton(e,t,r,a){var i=!g.touch_mode&&a?xi:null
var o=null
if(!r)if(!b.split_build)o=["new_build_settlement","new_build_lf_break"]
var n={x:e,y:t,z:Z.MENUBUTTON,disabled:false,tooltip:lr.prefixShortcutKey("E",r?zt.LBL_EXIT_MENU:zt.LBL_MENU),in_event_cb:i&&i.in_event_cb,hook:o}
var s=r&&tr()
if(s){n.text="←"
n.font_height=.75*U()
n.w=U()}else{n.img=ua.sprite
n.frame=r?ua.X:ua.MENU
n.shrink=.7
n.colors=Br.quickbar_colors_selected}Di=g.keyDownEdge(g.KEYS.E,i)
if(r&&g.keyDownEdge(g.KEYS.R,i))Mi=true
if(g.keyDownEdge(g.KEYS.ESC))Pi=S.frame_index
else if(g.keyDown(g.KEYS.ESC)){if(Pi===S.frame_index-1)Pi=S.frame_index}else Pi=0
var l=false
if(shouldDrawMenuButton())if(s)l=k.buttonText(n)
else l=k.buttonImage(n)
if(l||Pi&&g.keyUpEdge(g.KEYS.ESC,i)||Di||r&&Mi||g.padButtonDownEdge(g.PAD.B)){Ia()
Mi=false
if(s){or()
lr.menuGoBack()
return false}else return true}return Mi=false}function menuExit(){ge()
bt()
Xt.menuExitClearParams()
ir()}function isMenuPage(e){return lr.page===e}var Bi=false
function menuConsumeExit(){Bi=true
if(Ci){Ci=false
return true}return false}function menuConfirmExit(){return k.modalDialog({title:zt.DLG_EXIT_CONFIRMATION_TITLE,text:zt.DLG_EXIT_CONFIRMATION_MSG,buttons:{yes:{label:zt.BTN_YES,in_event_cb:function in_event_cb(){g.pointerLockEnter()
Ci=true}},no:{label:zt.BTN_NO}}})}function stateMenuDoMenuButton(e,t){Ci=menuButton(e,t,true,!Bi)||Ci}function menuCurrencyPushes(){if(er()===lr.CURRENCY_SHOP)Pa()
else if(er()===lr.CHARACTER_CUSTOMIZATION||er()===lr.USER_PROFILE_VIEW&&La()||er()===lr.BOOST_VIEW){Ma()
Da()}}function stateMenu(){var e=oa()
if(e)Ci=false
else ur({w:U(),will_draw_cb:shouldDrawMenuButton,cb:stateMenuDoMenuButton})
Bi=false
if(rr())menuCurrencyPushes()
else{Yr()
Fr()
Be()
var t=Gr()&&!kt()?60:void 0
Ma(t)
if(!Gr())Da(t)}cr()
verifyFrameTransactions("stateMenu:top")
if(!e)menuHotkeys()
verifyFrameTransactions("stateMenu:after hotkeys")
mi.update(false)
verifyFrameTransactions("stateMenu:after char controller")
if(Fe()===Ei){Ei.update(false)
verifyFrameTransactions("stateMenu:after photo controller")}checkOriginShift()
Ye()
verifyFrameTransactions("stateMenu:after camera")
if(lr.tickMenu()&&!e)Ci=true
verifyFrameTransactions("stateMenu:after tick")
Pe.tickBuildModeInactive()
verifyFrameTransactions("stateMenu:after tickBuildModeInactive")
if(!g.touch_mode){var r=lr.getMenuPage()===lr.CHARACTER_CUSTOMIZATION&&Ke()
if(!e&&g.click(!r?xi:null))if(r)menuConfirmExit()
else Ci=true}if(Ci){Ci=false
or()
menuExit()}}function stateExploreDoMenuButton(e,t){if(menuButton(e,t,false,false)){if(Di)Me()
lr.init(lr.DEFAULT)}else if(g.keyDownEdge(g.KEYS.G)&&Pe.interactableProp())Pe.interactableProp().interact(null,null)}function stateExplore(){profilerStart("buttons")
ur({w:U(),will_draw_cb:shouldDrawMenuButton,cb:stateExploreDoMenuButton})
Yr()
Fr()
Be()
gr()
cr()
menuHotkeys()
Tt()
St()
profilerStopStart("char controller")
We()
mi.update(gi)
if(Fe()===Ei)Ei.update(Ti)
profilerStop()
checkOriginShift()
Ye()
pr()
profilerStart("buildMode")
verifyFrameTransactions("before build mode")
Pe.tickBuildMode()
verifyFrameTransactions("after build mode")
profilerStop()
Qe()
gt()}function statePhotoMode(){var e=br()
mi.update(wr())
Ei.update(Lr())
checkOriginShift()
Ye()
return e}function addBatchedSend(e){o(hi)
Ri.push(e)}function tickOMP(){Xt.checkConnection()
Qt.megachunkTickOMP()
if(Ri.length&&!A()){$(Ri)
Ri.length=0}}function getFrameTransactionSet(){return Ii=Ii||_e()}function getFrameTransaction(){getFrameTransactionSet()
return Ii.trans()}function frameTransactionCount(){return Ii&&Ii.numTransactions()||0}function verifyFrameTransactions(e){if(Ii)for(var t=0;t<Ii.numTransactions();++t)if(!Ii.get(t).ops.length)o(false,"Queued frame transaction with no ops at "+e)}function runTransaction(){J(Fa())
if(Ii&&!A()){var e=Ii
Ii=null
za(e)}}var ki
function postTick(e){(ki=ki||[]).push(e)}function setInworldRichPresence(e){var t=Wa()
var r=Ka(t,false)
if(!r||void 0===r.access_public||r.access_public&&!r.access_listed)t=void 0
M(e?K:q,Ta()?"view":ti()?"explore":"build",{world_id:t})}var Ui=-1
var Gi
function checkInactive(){profilerStart("checkInactive")
setTimeout(checkInactive,1e3)
var e=S.frame_index
if(e===Ui){if(5===++Gi){Oa.releaseClaimed()
if(hi)setInworldRichPresence(false)
else M(X,"offline",null)}}else{Gi=0
Ui=e}profilerStop("checkInactive")}var Fi
function isQuickbarVisible(){return Fi}function unreleasedReload(){V(z,"access_prerelease",pe())
ye()
ba()}var Wi
function tick(){profilerStart("main.js:tick")
profilerStart("top")
o(ri())
Ni=true
Pe.tempPointReset()
r.walltime_seconds=Ai=F.seconds()
Fi=!Or()&&!lr.menuHidesQuickbar()
Bt(Fi)
Pt()
qt()
Xt.drawCheckConnectionMessage()
ar()
if(sr()&&Fi)Br.quickbarScrollView()
if(!lr.active()&&!(Or()&&!Ar())&&!k.isMenuUp())B()
yi.run({hide:lr.active()||!hi,pointerlock:!g.touch_mode&&!lr.active()})
if(yi.isFocused())Me()
if(lr.isBuildMenu()){be()
Pt()}if(S.defines.SKYEDIT&&!S.defines.NOUI&&(S.DEBUG||Ga("sysadmin")))Zr()
if(S.defines.SAPLING&&!S.defines.NOUI&&(S.DEBUG||Ga("sysadmin")))Hr()
Sr()
ft()
jr()
Nt()
_a()
if(!Or())aa(lr.active())
Aa()
if(Fi){profilerStopStart("quickbar")
kr(lr.active())}verifyFrameTransactions("before state tick")
S.setMatVP(Ve())
if(Or()){profilerStopStart("statePhotoMode")
Wi=statePhotoMode()
pr()}else{Wi=Ue()
if(lr.active()){profilerStopStart("stateMenu")
stateMenu()
verifyFrameTransactions("after menu")
pr()}else{profilerStopStart("stateExplore")
stateExplore()}}profilerStopStart("after state")
pa(mi.underwater.head)
Ye()
na()
Jr(De(),vt())
Pt()
var e=!lr.active()
Te(e)
runTransaction()
tt()
xt()
_i()
tickOMP()
setInworldRichPresence(true)
ea.tickStatus()
Ct()
if(S.defines.NOLODS)setZRangeDefault()
else setZRangeLODs()
S.start3DRendering({fov:Wi})
if(!S.defines.NOLODS){ze()
Yt.tickLODs()
qr()
zr(true)
gl.depthMask(true)
gl.clear(gl.DEPTH_BUFFER_BIT)
gl.disable(gl.BLEND)
setZRangeDefault()}ze()
fr()
Pr.tickProps()
profilerStopStart("tickVCM")
Oa.tickVCM()
profilerStopStart("other draw")
d.opaqueDraw()
Er.updateParticleSystems()
Ie()
Ot.tickItemAnims()
if(!Ta()&&!Or())we()
if(S.DEBUG&&g.keyDownEdge(g.KEYS.M))S.defines.PROCGEN=!S.defines.PROCGEN
if(S.defines.PROCGEN&&(S.DEBUG||Ga("sysadmin")))Mr.drawDebug()
if(S.defines.MEGACHUNK&&(S.DEBUG||Ga("sysadmin")))Qt.drawDebug()
if(g.keyDownEdge(g.KEYS.F8)){S.defines.NOUI=!S.defines.NOUI
b.set("show_metrics",S.defines.NOUI?0:1)}if(S.defines.CHUNK)Oa.drawDebug()
if(S.defines.CHUNKMAN)Oa.drawChunkManDebug()
Na.tickVD()
if(S.defines.NOLODS)qr()
d.alphaDraw()
zr(false)
profilerStopStart("bottom")
runTransaction()
lt.draw(10,110)
if(!lr.active()&&!Or())vr()
if(ki)$(ki,ki=null)
yi.runLate()
Ni=false
if(bi){bi=false
returnToMainMenu(true)}profilerStop()
return profilerStop("main.js:tick")}function doNetInit(){L({engine:S,ver:le,cmd_parse:u,auto_create_user:G.get("autoanon")})
O().quietMessagesSet(["ent_update"])}function worldsElementFilter(e){return String(e.className).includes("onetrust")||e.id&&e.id.startsWith("onetrust")||"IFRAME"===e.tagName||e.style&&Number(e.style.zIndex)>=2e9||e.parentElement&&e.parentElement!==e&&worldsElementFilter(e.parentElement)}function worldsEventFilter(e){if(e.target===S.canvas)return false
return worldsElementFilter(e.target)}function main(){J.dothrow(S.DEBUG)
if(S.DEBUG)Array.prototype.foo="bar"
if(!window.Worker){window.alert("WebWorkers required.")
return}m("ver",le)
if(_)p()
ht()
if(S.defines.NORELOAD)c(false)
if(S.defines.NOURLS)Q("internal_urls_only",true)
me.startup()
mt()
n()
de()
b.runTimeDefault("fov",s?60:50)
b.runTimeDefault("render_scale",s?1:.5)
if(S.DEBUG)doNetInit()
if(!S.startup({high:true,game_width:1e3,game_height:1e3,state:ka(),show_fps:window.FBInstant?false:void 0,pixely:false,viewport_postprocess:false,znear:di,zfar:fi,antialias:Boolean(b.aa),do_borders:false,do_sounds:false,map_analog_to_dpad:false,pad_to_touch:g.PAD.RT,pad_focus_dpad:true,safearea_ignore_bottom:true,font:{info:At,texture:"font/ubuntu32.20"},title_font:{info:It,texture:"font/inknut24.20"},ui_sprites:{color_set_shades:[.8,1,1],button_rollover:null,menu_down:null,collapsagories_rollover:null,button_disabled_border:{atlas:"default"}},ui_sounds:ca,sound:{fade_music_in_bg:false}}))return
g.inputSetEventFilter(worldsEventFilter)
Vt()
if(!S.DEBUG)doNetInit()
ve()
ue()
startup()}},{"../common/globals":248,"../common/platform_worlds_common":257,"../common/world_trans":268,"../frvr/client/platforms/adapter":270,"../frvr/client/xplay/login":284,"../glov/client/browser":293,"../glov/client/client_config":297,"../glov/client/cmds":298,"../glov/client/draw_list":301,"../glov/client/effects":304,"../glov/client/engine":305,"../glov/client/error_report":311,"../glov/client/filewatch":314,"../glov/client/input":326,"../glov/client/local_storage":329,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/settings":351,"../glov/client/slider":355,"../glov/client/snapshot":356,"../glov/client/social":357,"../glov/client/spot":361,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/client/walltime":370,"../glov/client/webfs":371,"../glov/client/worker_comm":373,"../glov/client/worker_perf":374,"../glov/common/enums":385,"../glov/common/platform":394,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./abtest_worlds":1,"./analytics":6,"./app_access":12,"./app_settings":13,"./auto_activate_ui":15,"./baking":19,"./block_intersections":25,"./bluebox_edit_list":26,"./blueprint":28,"./build_menu":32,"./build_mode":33,"./build_queue_ui":34,"./camera":35,"./character_controller":37,"./character_customization":39,"./chat_floater":40,"./chat_ui_worlds":41,"./client_cmds":43,"./client_entities":44,"./context":45,"./continent_loader":47,"./cosmetics":64,"./costume_edit":65,"./debug":73,"./dragdrop_resource_reload":80,"./draw_sprite3d":82,"./editvolume_clear":83,"./editvolume_client":84,"./environments_worlds":88,"./external_users/external_users_client_worlds":94,"./frvr_sdk_worlds":102,"./huds":104,"./img/font/inknut24.20.json":106,"./img/font/ubuntu32.20.json":107,"./in_app_purchases/iap_client_worlds":111,"./inventory":114,"./item_anims":116,"./item_info_view":117,"./item_unlock_ui":118,"./items":119,"./layout":120,"./loading_custom":128,"./localization/localization":131,"./lods":132,"./main_menu":136,"./megachunk_client":139,"./menu":140,"./menu_ribbon":141,"./mobs":145,"./mod_api_host":146,"./particle_system":152,"./party_ui":153,"./photo_controller":154,"./photo_mode":158,"./platform_worlds_client":160,"./proc_gen":162,"./proc_gen_debug":165,"./prop_edit":170,"./props":171,"./quickbar":172,"./race_ui":174,"./red_dot":176,"./saplings_debug":178,"./settlement":181,"./share_menu":184,"./sky":188,"./status":193,"./styles":197,"./task_sched":198,"./todo_list":202,"./tutorial":203,"./ui_sounds":204,"./ui_util":205,"./ui_util_2":206,"./ui_util_hires":207,"./user_data":208,"./user_info_view":210,"./user_party":211,"./user_profile_view":212,"./voxel_chunk_manager":214,"./voxel_const":215,"./voxel_data":216,"./voxel_gen":219,"./wallet_ui":221,"./waygate_upgrade":223,"./welcome_screen":224,"./world_comm":226,"./world_info":229,"./world_info_view":231,"./world_init":232,"./world_metadata":235,"./worlds_sound":236,"./worlds_soundscape":237,assert:void 0}],136:[function(e,t,r){"use strict"
r.mainMenuSetPage=mainMenuSetPage
r.mainMenuGetPage=mainMenuGetPage
r.elevatedWarn=elevatedWarn
r.ensureDefaultSeed=ensureDefaultSeed
r.mainMenuBgSet=mainMenuBgSet
r.drawBG=drawBG
r.drawCheckConnectionMessage=drawCheckConnectionMessage
r.checkConnection=checkConnection
r.partyLastInfoMessage=partyLastInfoMessage
r.partyDrawInfoMessage=partyDrawInfoMessage
r.joinWorldForUser=joinWorldForUser
r.mainMenuHeaderLogoWidth=mainMenuHeaderLogoWidth
r.mainMenuHeaderLogoDraw=mainMenuHeaderLogoDraw
r.mainMenuHeaderLogo=mainMenuHeaderLogo
r.mainMenuTop=mainMenuTop
r.mainMenuBottom=mainMenuBottom
r.mainMenuSetStateInternal=mainMenuSetStateInternal
r.mainMenuJustEnteredAccessToken=mainMenuJustEnteredAccessToken
r.enterAccessTokenInit=enterAccessTokenInit
r.enterPasswordInit=enterPasswordInit
r.requireLogin=requireLogin
r.menuExitClearParams=menuExitClearParams
r.mainMenuSubLinks=mainMenuSubLinks
r.mainMenuScroll=mainMenuScroll
r.socialPresenceIcon=socialPresenceIcon
r.socialPresenceIconIfUnusual=socialPresenceIconIfUnusual
r.mainMenuMenuOverlay=mainMenuMenuOverlay
r.mainMenu=mainMenu
r.setPageFromId=setPageFromId
r.mainMenuInit=mainMenuInit
r.mainMenuSetState=mainMenuSetState
r.mainMenuStartup=mainMenuStartup
r.URL_REDDIT=r.URL_DISCORD=r.URL_DMCA=r.URL_GDPR=r.URL_TOS=r.URL_PRIVACY=r.MAIN_MENU_WORLDLIST=r.MAIN_MENU_WELCOME=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=1
r.MAIN_MENU_WELCOME=a
var L=2
r.MAIN_MENU_WORLDLIST=L
var g="https://frvr.com/legal/samsung/?hideLangSelector=1#PrivacyPolicy"
r.URL_PRIVACY=g
var T="https://frvr.com/legal/samsung/?hideLangSelector=1#TermsofService"
r.URL_TOS=T
var y="https://frvr.com/legal/samsung/?hideLangSelector=1#gdpr"
r.URL_GDPR=y
var S="https://frvr.com/dmca/?hideLangSelector=1"
r.URL_DMCA=S
var I="https://discord.gg/WorldsFRVR"
r.URL_DISCORD=I
var A="https://www.reddit.com/r/WorldsFRVR"
r.URL_REDDIT=A
var i=e("../frvr/client/platforms/adapter").getPlatformAdapter
var o=e("../glov/client/browser")
var O=e("../glov/client/camera2d")
var n=e("../glov/client/cmds").cmd_parse
var s=e("../glov/client/edit_box").editBoxCreate
var l=e("../glov/client/engine")
var u=e("../glov/client/engine").getFrameIndex
var h=e("../glov/client/font").ALIGN
var _=e("../glov/client/fscreen").fscreenAvailable
var c=e("../glov/client/input")
var d=c.KEYS
var f=c.inputClick
var v=c.keyDownEdge
var p=c.pointerLockExit
var m=c.pointerLockJustEntered
var E=c.pointerLocked
var w=e("../glov/client/link")
var R=w.linkGetDefaultStyle
var b=w.linkText
var N=e("../glov/client/local_storage")
var C=N.localStorageGetJSON
var x=N.localStorageSetJSON
var M=e("../glov/client/markdown_renderables").markdownImageRegister
var D=e("../glov/client/net")
var P=D.netClient
var B=D.netDisconnected
var k=D.netSubs
var U=e("../glov/client/scroll_area").scrollAreaCreate
var G=e("../glov/client/settings")
var F=e("../glov/client/social")
var W=F.SOCIAL_AFK
var H=F.SOCIAL_INVISIBLE
var z=F.richPresenceSet
var V=F.socialPresenceStatusGet
var Y=e("../glov/client/sprites").spriteCreate
var j=e("../glov/client/ui")
var K=j.buttonImage
var q=j.buttonText
var X=j.drawHollowRect
var Q=j.drawLine
var $=j.isMenuUp
var J=j.modalDialog
var ee=j.panel
var te=j.uiButtonHeight
var re=j.uiGetFont
var ae=j.uiGetTitleFont
var ie=j.uiTextHeight
var oe=e("../glov/client/urlhash")
var ne=e("../glov/client/wsclient")
var se=ne.ERR_CLIENT_VERSION_NEW
var le=ne.ERR_CLIENT_VERSION_OLD
var _e=ne.ERR_RESTARTING
var ce=e("../glov/common/enums").PRESENCE_ACTIVE
var ue=e("../glov/common/md5")
var de=e("../glov/common/vmath")
var fe=de.v4set
var ve=de.vec4
var he=e("../common/photo_common").PHOTO_ASPECT
var pe=e("./analytics")
var me=pe.analyticsPostLogin
var Ee=pe.logEvent
var ge=pe.logEventOnce
var Te=e("./client_cmds").isElevated
var ye=e("./create_first_world").createFirstWorldStartup
var Se=e("./create_new_world").createWorldUIInit
var Ie=e("./debug").debugDraw
var Ae=e("./fbinstant_worlds")
var we=Ae.canFollowOfficialPage
var Le=Ae.canJoinOfficialGroup
var Oe=Ae.fbFollowOfficialPage
var Re=Ae.fbJoinOfficialGroup
var be=e("./iframe_content_handlers")
var Ne=e("./layout")
var Ce=Ne.CORNER_BUTTON_MARGIN
var xe=Ne.isTopRightCornerReserved
var Me=Ne.layoutTick
var De=Ne.menuUpperLeft
var Pe=e("./localization/localization").L
var Be=e("./main")
var ke=Be.charController
var Ue=Be.chatUI
var Ge=Be.mainActive
var Fe=Be.mainStartLoad
var We=Be.menuButton
var He=Be.menuCurrencyPushes
var ze=Be.menuExit
var Ve=Be.menuExitClear
var Ye=Be.returnToMainMenu
var je=Be.shouldDrawMenuButton
var Ke=e("./menu")
var qe=Ke.BLUEPRINT_VIEW
var Ze=Ke.PHOTO_LIBRARY
var Xe=Ke.PHOTO_VIEW
var Qe=Ke.USER_PROFILE_VIEW
var $e=Ke.WORLD_INFO_VIEW
var Je=Ke.getMenuPage
var et=Ke.lockMenuPageToDraw
var tt=Ke.menuActive
var rt=Ke.menuClear
var at=Ke.menuDoTransition
var it=Ke.menuPanelColor
var ot=Ke.menuTabColors
var nt=Ke.tickMenu
var st=e("./menu_ribbon")
var lt=st.drawMenuRibbon
var _t=st.getMenuRibbonXInner
var ct=st.getMenuRibbonY1
var ut=st.pushMenuRibbonElement
var dt=e("./motd").motdRun
var ft=e("./photo_mode").copyToClipboardCheck
var vt=e("./photo_ui").photoInfoGet
var ht=e("./platform_worlds_client")
var pt=ht.PLATFORM_DISCORD
var mt=ht.PLATFORM_FBINSTANT
var Et=ht.PLATFORM_MOBILE
var gt=ht.PLATFORM_MSSTART
var Tt=ht.PLATFORM_WEB
var yt=ht.PLATFORM_YANDEX
var St=e("./red_dot")
var It=St.redDotSeen
var At=St.setLatestNewsTS
var wt=e("./social_menu").socialMenuInternal
var Lt=e("./status").tickStatus
var Ot=e("./styles")
var Rt=Ot.color_black
var bt=Ot.connection_lost_style
var Nt=Ot.menu_style
var Ct=Ot.menu_style_on_dark
var xt=Ot.party_info_style
var Mt=e("./ui_util")
var Dt=e("./ui_util_2")
var Pt=e("./user_data")
var Bt=Pt.userDataGet
var kt=Pt.userDataIsWaiting
var Ut=e("./user_info_view")
var Gt=Ut.userGetWorldAndPos
var Ft=Ut.userInfoViewTick
var Wt=e("./user_party")
var Ht=Wt.partyGetParticipantsAmount
var zt=Wt.partyIsHost
var Vt=e("./user_profile_view").userProfileViewIsMe
var Yt=e("./voxel_gen").seedWorld
var jt=e("./wallet_ui")
var Kt=jt.walletShowCurrencyButtons
var qt=jt.walletShowFreeGemsButton
var Zt=e("./welcome_screen")
var Xt=Zt.needWelcomeScreen
var Qt=Zt.welcomeScreen
var $t=Zt.welcomeScreenSetState
var Jt=Zt.welcomeScreenStartup
var er=e("./world_comm")
var tr=er.getPerm
var rr=er.getWorldID
var ar=er.joinWorld
var ir=er.worldAutoConnect
var or=er.worldAutoConnectClear
var nr=er.worldAutoConnectIsReconnect
var sr=e("./world_info").getWorldInfo
var lr=e("./world_list")
var _r=lr.worldListContentEdit
var cr=lr.worldListContentEditActive
var ur=lr.worldListContentEditButton
var dr=lr.worldListContentEditClear
var fr=lr.worldListHome
var vr=lr.worldListOnTabChange
var hr=lr.worldListOther
var pr=lr.worldListSearch
var mr=lr.worldListSearchFocused
var Er=lr.worldListStartup
var gr=e("./world_management")
var Tr=gr.clearDoingWorldOp
var yr=gr.isDoingWorldOp
var Sr=e("./world_metadata")
var Ir=Sr.worldMetadata
var Ar=Sr.worldMetadataSet
var wr=Math.max
oe.register({key:"token"})
var Lr
var Or
var Rr=1
var br=2
var Nr=3
var Cr=4
var xr=l.defines.SEARCH?br:l.defines.SOCIAL?Nr:Rr
var Mr={DAWN:"menu_bg_dawn",AFTERNOON:"menu_bg_afternoon",SUNSET:"menu_bg_sunset",MIDNIGHT:"menu_bg_midnight"}
var Dr
var Pr
var Br=Object.create(null)
function loadSprites(){Dr=Y({name:"menu_bg",filter_min:gl.LINEAR,filter_mag:gl.LINEAR})
M("menubg_default",{sprite:Dr})
Pr=Y({name:"worlds_header",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
for(var e in Mr){var t=Br[e]=Y({name:Mr[e],filter_min:gl.LINEAR,filter_mag:gl.LINEAR,lazy_load:true})
M("menubg_"+e,{sprite:t})}}G.register({auto_fullscreen:{label:"Auto Full-screen",default_value:o.is_android?1:0,type:n.TYPE_INT,range:[0,1],help:_()?Pe.SETTING_AUTO_FULLSCREEN_HELP:Pe.SETTING_NOT_AVAILABLE_ON_DEVICE},show_frozen_worlds:{default_value:1,type:n.TYPE_INT,range:[0,1]}})
var kr={}
function mainMenuSetPage(e){var t=Date.now()
if(e!==kr.page||t-kr.ts>6e4)x("main_menu_page",kr={page:e,ts:t})}function mainMenuGetPage(){var e=C("main_menu_page")
if(e&&Date.now()-e.ts<12e4)return e.page
return-1}var Ur=ve(1,0,0,1)
function elevatedWarn(){if(!Te())return
X(O.x0Real(),O.y0Real(),O.x1Real(),O.y1Real(),Z.DEBUG,10,0,Ur)}function ensureDefaultSeed(){if(!Ir()&&!Ge()){Ar(void 0,{seed:1,world_type:"flat"})
Yt()}}var Gr=""
var Fr=false
var Wr=-1
var Hr=null
function mainMenuBgSet(e){if(!e){Gr=""
Hr=null}else{var t=e
var r=false
if(e.startsWith("blur:")){t=e.slice("blur:".length)
r=true}if(Gr!==t||Fr!==r){Gr=t
Fr=r
Hr=null}}Wr=u()}function filterBlur(e,t){var r=document.createElement("CANVAS")
r.width=t.width
r.height=t.height
var a=r.getContext("2d")
a.fillStyle="rgb(0, 0, 0)"
a.fillRect(0,0,r.width,r.height)
a.filter="blur(5px)"
a.drawImage(t,0,0)
return r}var zr=ve(0,0,1,1)
var Vr=ve(1,1,1,1)
function drawBG(e,t){Vr[3]=t=t||1
var r=Dr
var a=1
var i=0
if(Gr&&Wr>=u()-1)if(Br[Gr]){var o=Br[Gr]
a=o.lazyLoad()
r=o}else{if(!Hr){var n=vt(Gr)
if(n&&n.img&&n.img.card)Hr=Y({filter_mag:gl.LINEAR,filter_min:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,url:Fr?n.img.card.url+"#blur":(n.img.max||n.img.card).url,soft_error:true,lazy_load:true,load_filter:Fr?filterBlur:void 0})}if(Hr){a=Hr.lazyLoad()
r=Hr
i=he}}if(1!==a&&1===t)Dr.draw({x:O.x0Real(),y:O.y0Real(),w:O.wReal(),h:O.hReal(),z:(e||1)-.1})
if(0!==a){var s
if(i){s=zr
var l=O.wReal()/O.hReal()
if(l>i){var _=(1-i/l)/2
fe(s,0,_,1,1-_)}else{var c=(1-l/i)/2
fe(s,c,0,1-c,1)}}r.draw({color:Vr,x:O.x0Real(),y:O.y0Real(),w:O.wReal(),h:O.hReal(),z:e||1,uvs:s})}}var Yr
var jr=false
function drawCheckConnectionMessage(){if(Yr){var e=100
var t=10
var r=150
var a=1e3-2*e
var i=O.x0()+(O.w()-a)/2
var o=O.y1()-r-e
var n=false
var s=false
var l=false
if(jr&&mt){n=we()
s=Le()
l=n||s}Lr.drawSizedAligned(bt,i,o,Z.DEBUG,32,h.HVCENTERFIT|h.HWRAP,a,l?r/2+2*t:r,Yr)
if(l){var _=175
var c=48
var u=10
var d=a-(n?u+_:0)-(s?u+_:0)
var f=.5*c
var v={x:i+d-(d-Lr.drawSizedAligned(Ct,i,o+r/2-t,Z.DEBUG,ie(),h.HVCENTERFIT,d,r/2,Pe.addColon(Pe.LBL_MEANWHILE_CHECK_OUT)))/2+u,y:o+3*r/4-t-c/2,z:Z.DEBUG+1,w:_,h:c,font_height:f}
if(n){if(q(_extends({},v,{text:Pe.BTN_LATEST_NEWS,hook:"reddot_news_last_seen_ts"}))){Ee("welcome_fb_follow",1,"button")
Oe()
At()}v.x+=u+_}if(s)if(q(_extends({},v,{text:Pe.BTN_JOIN_OUR_GROUP}))){Ee("welcome_fb_join_group",1,"button")
Re()}}ee({x:i,y:o,w:a,h:r,z:Z.DEBUG-1,color:ve(0,0,0,.85)})}}function checkConnection(){var e=P()
if(e.connected&&k().restarting||e.connect_error===_e||e.connect_error===se){jr=true
Yr=Pe.LOGINMSG_SERVER_RESTARTING}else if(e.connect_error===le){jr=false
Yr=mt?Pe.LOGINMSG_NEW_VERSION+"\n"+Pe.LOGINMSG_RESTART_OR_UPDATE_APP:Et?Pe.LOGINMSG_APP_TOO_OLD+"\n"+(e.update_available?Pe.LOGINMSG_UPDATE_APP:Pe.LOGINMSG_NO_UPDATE_AVAILABLE+"\n"+Pe.LOGINMSG_VISIT_WEB):Tt?Pe.LOGINMSG_NEW_VERSION+"\n"+Pe.LOGINMSG_RELOAD_PAGE:Pe.LOGINMSG_UNDER_MAINTENANCE+"\n"+Pe.LOGINMSG_TRY_AGAIN}else if(e.disconnected||k().was_logged_in&&k().logging_in){jr=true
Yr=Pe.$(Pe.LOGINMSG_RECONNECTING,(e.timeSinceDisconnect()/1e3).toFixed(0))}else{jr=false
Yr=null}}var Kr
function partyLastInfoMessage(){return Kr}function partyDrawInfoMessage(e){if(!(Kr=e)||Yr)return
var t=100
var r=150
var a=600
var i=O.x0()+(O.w()-a)/2
var o=O.y1()-r-t
ee({x:i,y:o,w:a,h:r,z:Z.MODAL-10,color:ve(0,0,0,.6),eat_clicks:false})
Lr.drawSizedAligned(xt,i,o,Z.MODAL-9,32,h.HVCENTERFIT|h.HWRAP,a,r,e)}var qr={}
function joinWorldWrap(e){if(qr.uid)ke().setFollowUserOnLoad(qr.uid)
if(qr.world_id!==e)qr={}
i().createAppShortcut()
ar(e,qr.pos,qr.wgid,qr.force_waygate)
qr={}}function joinWorldForUser(e,t,r){qr.uid=e
qr.world_id=t
qr.pos=r
joinWorldWrap(t)}function joinUser(i){qr={}
Fe()
Gt(i,"",function(e,t){if(rr())return
if(B()){qr.uid=i
Ye()
return}var r
if(e)e=Pe.DLG_JOIN_USER_FAILED_NOT_FOUND_MSG.$({user:i})
else r=null==t?void 0:t.world_id
if(e||!r){Ye()
var a={title:Pe.DLG_JOIN_USER_FAILED_TITLE,text:e||Pe.DLG_JOIN_USER_FAILED_NOT_PLAYING_MSG,buttons:{ok:function ok(){or()}}}
if(!e)a.buttons.retry=function(){joinUser(i)}
J(a)}else joinWorldForUser(i,t.world_id,t.pos_str)})}var Zr=64
var Xr=240
var Qr=50
var $r=48
function mainMenuHeaderLogoWidth(e){return e*Pr.texs[0].src_width/Pr.texs[0].src_height}function mainMenuHeaderLogoDraw(e){Pr.draw(e)}function mainMenuHeaderLogo(e){e.y-=Qr
var t=Zr+86
var r=mainMenuHeaderLogoWidth(t)
mainMenuHeaderLogoDraw({x:e.x_mid-r/2,y:4,z:Z.UI-30,h:t,w:r})
e.y+=Zr+48
e.y0=e.y
e.y+=Qr}function mainMenuTop(e,t,r,a){if(E()&&!m(5)&&!yr())p()
Me(false)
z(ce,"menus")
Lt(.95)
Ft()
e.y=20
e.w=1e3
if(r||a){O.setAspectFixed2(1e3,t||1e3)
e.w=O.w()}else O.setAspectFixed(1e3,t||1e3)
e.x_mid=e.w/2
Ue().run({hide:true})
Ve()
elevatedWarn()
Ie(10,100)
drawCheckConnectionMessage()
e.y0=e.y
e.y+=Qr}function mainMenuBottom(e,t,r){var a=e.y
if(!t){var i=e.y0
a+=Qr
var o=r?-20:10
ee({x:o,y:i,w:(r?O.w():1e3)-2*o,h:a-i,color:r?it():null})}checkConnection()
drawBG()
Ue().runLate()
e.y=a}function lineSep(e,t,r,a){var i=e.y
var o=e.x_mid
Q(o-r/2,i+=t,o+r/2,i,Z.UI,a,1,Rt,0)
e.y=i+=t}function mainMenuSetStateInternal(){l.setState(mainMenu)}function returnToMainMenuFromSubScreen(){if(mainMenuGetPage()===L)mainMenuSetStateInternal()
else $t()}var Jr
var ea
var ta
var ra=200
var aa=false
function mainMenuJustEnteredAccessToken(){return aa}function enterAccessToken(){var e={}
mainMenuTop(e)
mainMenuHeaderLogo(e)
var t=e.x_mid,r=e.w
var a=0
var i=e.y
var o=ie()
Or.drawSizedAligned(Nt,a,i,Z.UI,1.5*o,h.HCENTERFIT,r,0,Pe.LBL_ACCESS_TOKEN_ENTER)
i+=1.5*o+16
if(ta){i+=$r
Lr.drawSizedAligned(Nt,a,i,Z.UI,o,h.HCENTERFIT,r,0,Pe.MSG_ACCESS_TOKEN_VALIDATING)
i+=o+16}else{var n=Jr.run({x:t-ra-8,y:i})
var s=Jr.getText().length<10||B()
if(q({x:t,y:i,w:Xr/2-4,h:$r,text:Pe.BTN_SUBMIT,disabled:s})||!s&&oe.get("token")){oe.set("token","")
n=Jr.SUBMIT}if(q({x:t+Xr/2+4,y:i,w:Xr/2-4,h:$r,text:Pe.BTN_CANCEL})||v(d.ESC)||f({button:2}))returnToMainMenuFromSubScreen()
i+=$r
if(n===Jr.SUBMIT&&!B()){ta=true
k().sendCmdParse("access_token "+Jr.getText(),function(e,t){ta=false
if(e)if(ea){console.error("Ignoring access token error: "+e)
returnToMainMenuFromSubScreen()}else J({title:Pe.DLG_ERROR_ACCESS_TOKEN_TITLE,text:e,buttons:{ok:null}})
else if(t&&t.world_id)joinWorldWrap(t.world_id)
else{var r=t&&t.msg||("string"===typeof t?t:null)
if(r)J({title:Pe.DLG_ACCESS_TOKEN_APPLIED_TITLE,text:r,buttons:{ok:null}})
aa=true
returnToMainMenuFromSubScreen()}})}}e.y=i
mainMenuBottom(e,false,false)}function enterAccessTokenInit(){l.setState(enterAccessToken)
ta=false
Jr=s({w:ra,text:oe.get("token"),placeholder:"000-0000-0000",initial_focus:true,initial_select:true,spellcheck:false})
ea=Boolean(oe.get("token"))}var ia
var oa
var na
function enterPassword(){var e={}
mainMenuTop(e)
mainMenuHeaderLogo(e)
var t=e.x_mid,r=e.w
var a=0
var i=e.y
var o=ie()
Or.drawSizedAligned(Nt,a,i,Z.UI,1.5*o,h.HCENTERFIT,r,0,Pe.LBL_WORLD_PASSWORD_ENTER)
i+=1.5*o+16
if(oa){i+=$r
Lr.drawSizedAligned(Nt,a,i,Z.UI,o,h.HCENTERFIT,r,0,Pe.MSG_PASSWORD_VALIDATING)
i+=o+16}else{var n=na.run({x:t-ra-8,y:i})
if(q({x:t,y:i,w:Xr/2-4,h:$r,text:Pe.BTN_SUBMIT,disabled:!na.getText().length}))n=na.SUBMIT
if(q({x:t+Xr/2+4,y:i,w:Xr/2-4,h:$r,text:Pe.BTN_CANCEL})||v(d.ESC)||f({button:2})){qr={}
or()
Ye()}i+=$r
if(n===na.SUBMIT){oa=true
var s=na.getText()
var l=ue(ue(String(ia))+s)
P().send("world_password",{world_id:ia,password:l},null,function(r){if("ERR_INVALID_PASSWORD"===r&&s.toUpperCase().match(/^W\d+Z.{8}/))return void P().send("access_token",s,null,function(e,t){oa=false
if(!e&&t&&t.world_id)joinWorldWrap(t.world_id)
else J({title:Pe.DLG_ERROR_WORLD_PASSWORD_TITLE,text:r,buttons:{ok:null}})})
oa=false
if(r)J({title:Pe.DLG_ERROR_WORLD_PASSWORD_TITLE,text:r,buttons:{ok:null}})
else joinWorldWrap(ia)})}}e.y=i
mainMenuBottom(e,false,false)}function enterPasswordInit(e){if((ia=e)===oe.get("w"))qr={world_id:e,pos:oe.get("pos"),wgid:oe.get("wg"),uid:"go"===oe.get("action")&&oe.get("u"),force_waygate:true}
else qr={}
l.setState(enterPassword)
na=s({w:ra,text:"",placeholder:"<password>",initial_focus:true,initial_select:true,spellcheck:oa=false})}function requireLogin(e){rt()
k().once("login",e)}function menuExitClearParams(){switch(Je()){case qe:oe.set("blueprint","")
break
case Xe:oe.set("photo","")
break
case Qe:if(!oe.get("action"))oe.set("u","")
break
case Ze:oe.setMulti({u:"",action:""})
break
case $e:if(Ge())oe.setMulti({w:rr(),wg:kt()?"":Bt("wg")})
else oe.setMulti({w:"",wg:""})}}var sa="r/WorldsFRVR"
function mainMenuSubLinks(e,a){var t=!mt&&!yt&&!gt
var r=!mt&&!yt&&!gt&&!pt
var i=!mt&&!pt
var o=ie()
var n=e.w
var s=e.y
var l
var _=.75*o
e.x_mid=n/2
var c=true
function linkAdvance(e,t,r){if(!c)l+=Lr.drawSized(a,l,s,Z.UI,_," - ")
c=false
if(b({x:l,y:s,z:Z.UI,font_size:_,url:t,text:e,internal:r}))if(r)r()
l+=Lr.getStringWidth(R(),_,e)}var u=0
var d=Lr.getStringWidth(a,_," - ")
if(t)u+=Lr.getStringWidth(a,_,Pe.LBL_DISCORD_WORLDS)+d
if(r)u+=Lr.getStringWidth(a,_,sa)+d
if(i){u+=Lr.getStringWidth(a,_,Pe.LBL_TERMS_OF_SERVICE)+d
u+=Lr.getStringWidth(a,_,Pe.LBL_PRIVACY_POLICY)+d
u+=Lr.getStringWidth(a,_,Pe.LBL_GDPR)+d
u+=Lr.getStringWidth(a,_,Pe.LBL_DMCA)+d}if(u)u-=d
l=e.x_mid-u/2
if(t){var f,v
if(pt&&null!=(f=window.FRVR)&&null!=(v=f.navigation)&&v.navigate)linkAdvance(Pe.LBL_DISCORD_WORLDS,I,function(){window.FRVR.navigation.navigate(I)})
else linkAdvance(Pe.LBL_DISCORD_WORLDS,I)}if(r)linkAdvance(sa,A)
if(i){var h=be.termsOfServiceShow,p=be.privacyPolicyShow,m=be.gdprShow,E=be.dmcaShow
linkAdvance(Pe.LBL_TERMS_OF_SERVICE,T,h)
linkAdvance(Pe.LBL_PRIVACY_POLICY,g,p)
linkAdvance(Pe.LBL_GDPR,y,m)
linkAdvance(Pe.LBL_DMCA,S,E)}}var la=false
function mainMenuDoMenuButton(e,t){if(We(e,t,true,false)){la=true
at()}}var _a=100
function drawReturnToWelcomeScreenButton(e,t){if(q({text:"←",x:e,y:t,z:Z.UI,font_height:.75*_a,w:_a,h:_a})||!(xr===br&&mr())&&v(d.BACKSPACE)&&!cr()){at()
$t()
Ee("return_to_welcome_button",1,"button")}}var ca={}
function tabGetLabelAndIcon(e,t){if((e=String(e)).startsWith("ICON_")&&Mt[e.slice(5)]){ca.icon=Mt[e.slice(5)]
ca.label=""}else if(e.startsWith("♦ ")){ca.label=e.slice(2)
ca.icon=Mt.GEMS}else{ca.label=e
ca.icon=t}}var ua=32
var da=64
var fa=da/2
var va=250
function tabGetWidth(e){var t=e.label
if(!t)return te()
var r=e.icon?da:ua
var a=Lr.getStringWidth(null,2*ie(),t)+2*r
return wr(va,a)}var ha=50
var pa=30
var ma=150
var Ea
function mainMenuScroll(){return Ea}function socialPresenceIcon(){var e=V()
return e===H?Dt.ICON_SOCIAL_INVISIBLE:e===W?Dt.ICON_SOCIAL_AFK:Dt.ICON_SOCIAL_ONLINE}function socialPresenceIconIfUnusual(){var e=V()
return e===H?Dt.ICON_SOCIAL_INVISIBLE:e===W?Dt.ICON_SOCIAL_AFK:void 0}function mainMenuMenuOverlay(e){et()
mainMenuTop(e,null,true)
var t=Je()
if(t===$e||t===qe||t===Xe||t===Qe&&!Vt()||t===Ze)mainMenuHeaderLogo(e)
la=false
ut({w:te(),will_draw_cb:je,cb:mainMenuDoMenuButton})
He()
lt()
var r=nt()
if(la||r)ze()
mainMenuBottom(e,true,false)}function mainMenu(){var e={}
profilerStart("mainMenu")
var t=k().loggedIn()
if(Xt()){Qt()
return profilerStop("mainMenu")}else me(t)
if(tt()){mainMenuMenuOverlay(e)
return profilerStop("mainMenu")}dt()
mainMenuTop(e,1e3,false,true)
if((qr.world_id||qr.uid)&&!oe.get("token")){ge("home_screen",1,"in_world")
if(qr.uid)joinUser(qr.uid)
else joinWorldWrap(qr.world_id)
mainMenuBottom(e,true,false)
return profilerStop("mainMenu")}var r=sr("all",false)
if(r&&r.err)r=null
var a=r&&r.tabs||[]
ut({w:_a,cb:drawReturnToWelcomeScreenButton})
Kt()
qt()
lt()
var u=e.y
var d=xe()?_t()+ha:De()?O.x1()-ha:ha
u=pa
var f=te()
var i=3.5*f
for(var o=0;o<a.length;++o){tabGetLabelAndIcon(a[o].title,null)
i+=tabGetWidth(ca)}if(xe()&&d+i>O.x1()-ma){u=ct()+Ce
d=ha}else if(!xe()&&De()&&d-i<_t()||!De()&&d+i>_t())u=ct()
if(!xe()&&De())d-=f
var n=r&&r.featured||[]
var s=false
if(tr("sysadmin")){var l={tabs:a,featured:n}
a=(l=_r(e,l,10,u+f-4)).tabs
n=l.featured.slice(0)
if(xr===Rr||xr===Cr)s=true}else dr()
function tabButton(e,t,r,a,i,o){tabGetLabelAndIcon(r,a)
r=ca.label
a=ca.icon
var n=xr===e
var s=tabGetWidth(ca)
var l=ot(n)
var _={x:d,y:u,z:n?Z.UI:Z.UI-10,w:s,font_height:2*ie(),z_bias:n?null:{down:20},colors:l,disabled:false,base_name:n?"tab":"tab_inactive",hook:i,tooltip:t}
var c
if(r){_.text=r
c=q(_)}else{_.img=Mt.sprite
_.frame=a
c=K(_)}if(c){if(Ea)Ea.resetScroll()
vr()
xr=e}if(a&&r)Mt.sprite.draw({x:d+8,y:u+(f-da)/2,z:Z.UI+25,w:da,h:da,frame:a})
if(o)Dt.sprite.draw({x:d+f-fa-6,y:u+f-fa-(f-da)/2,z:Z.UI+26,w:fa,h:fa,frame:o,color:l.regular})
d+=!xe()&&De()?-s:s}tabButton(Rr,Pe.TLTP_WORLD_LIST,"",Mt.HOME)
for(var _=0;_<a.length;++_){var c=a[_]
var v=c.reddot?"worldtab."+c.reddot:null
tabButton(Cr+_,c.tooltip,c.title,null,v)}tabButton(br,Pe.TLTP_WORLD_SEARCH,"",Mt.SEARCH)
d+=f/2
tabButton(Nr,Pe.LBL_SOCIAL,"",Mt.SOCIAL,null,socialPresenceIconIfUnusual())
u+=te()
e.y0=u-20
mainMenuSetPage(L)
var h=O.h()
if(!Ea)Ea=U({z:Z.UI,background_color:null,auto_hide:true})
Ea.keyboardScroll()
var p=Ea.barWidth()
var m={x:0,y:e.y0+16,w:e.w}
if(cr())m.y+=.5*te()+8
var E=h-58+16
m.h=E-m.y
m.x+=p
m.w-=p
var g=Ea.getScrollPos()
var T=g+m.h
Ea.begin(m)
d=0
e.y=u=0
e.w=m.w-p
e.x_mid=e.w/2
var y=k().getMyUserChannel()
var S=y.data&&y.data.public||{}
var I=S.worlds||{}
var A={all_worlds_info:{},recent_worlds:S.recent||{},my_worlds:I,allow_join:true,y_min:g,y_max:T,dims:e,scroll_param:m}
if(s)ur(A)
e.y=u
if(xr===Rr){fr(A,n)
ge("home_screen",1,"worlds_listing")}else if(xr===br)pr(A)
else if(xr===Nr)e.y=wt({x:0,y:e.y,z:Z.UI,w:e.w})
else{var w=xr-Cr
if(a[w]&&a[w].reddot)It("worldtab."+a[w].reddot)
hr(A,a,w)}u=e.y
u+=8
Ea.end(u)
u=m.y+m.h
e.w=O.w()
e.x_mid=e.w/2
e.y=u
lineSep(e,1,300,2)
u=e.y
u+=12
e.y=u
mainMenuSubLinks(e,Nt)
u-=8
if(zt()&&Ht()>1)partyDrawInfoMessage(Pe.MSG_PARTY_HOST_CREATE_OR_JOIN_WORLD)
mainMenuBottom(e,false,true)
ft()
return profilerStop("mainMenu")}var ga=true
function setPageFromId(e){if("createworld"===e)Se()}function checkAutoConnect(){if($())return
if(ga||ir()){qr={world_id:oe.get("w"),pos:oe.get("pos"),wgid:oe.get("wg"),uid:"go"===oe.get("action")&&oe.get("u"),force_waygate:!ga&&!nr()}
ga=false
if("info"===qr.wgid&&qr.world_id)qr={}}}function mainMenuInit(){mainMenuSetStateInternal()
Tr()
checkAutoConnect()
mainMenu()}function mainMenuSetState(){l.setState(mainMenuInit)}function mainMenuStartup(){loadSprites()
Lr=re()
Or=ae()
ye()
Jt()
Er()}},{"../common/photo_common":256,"../frvr/client/platforms/adapter":270,"../glov/client/browser":293,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/edit_box":303,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/fscreen":317,"../glov/client/input":326,"../glov/client/link":328,"../glov/client/local_storage":329,"../glov/client/markdown_renderables":334,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/settings":351,"../glov/client/social":357,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/client/wsclient":375,"../glov/common/enums":385,"../glov/common/md5":390,"../glov/common/vmath":402,"./analytics":6,"./client_cmds":43,"./create_first_world":69,"./create_new_world":70,"./debug":73,"./fbinstant_worlds":96,"./iframe_content_handlers":105,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./menu_ribbon":141,"./motd":147,"./photo_mode":158,"./photo_ui":159,"./platform_worlds_client":160,"./red_dot":176,"./social_menu":189,"./status":193,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./user_info_view":210,"./user_party":211,"./user_profile_view":212,"./voxel_gen":219,"./wallet_ui":221,"./welcome_screen":224,"./world_comm":226,"./world_info":229,"./world_list":233,"./world_management":234,"./world_metadata":235}],137:[function(e,t,r){"use strict"
r.STAMINA_BY_MATERIAL=r.STAMINA_BY_MATERIAL_CLASS=r.MATERIAL_UNLIMITED_SPECIAL=r.MATERIAL_INGOT_SCALE=r.MATERIAL2_STAMINA_FACTOR=r.MATERIAL2_DURABILITY_FACTOR=r.MATERIAL_DURABILITY_FACTOR=r.MATERIAL_TOOL_DIG_RATE=r.MATERIAL_TO_MINE_MATERIAL=r.METAL_TIERS=r.MATERIAL_TO_MINE_STONE_TIER=r.MATERIAL_MAX_STONE_TIER=r.MATERIAL_DIG_RATE=r.IS_ALLOY=r.ALLOYS=r.MATERIAL_NAME=r.MATERIAL_CODE_NAME=r.INV_MATERIAL_NAME=r.MATERIAL_DURABILITY_COST=r.INV_MATERIAL_TIER=r.MATERIAL_TIER=r.MATERIAL_CLASS=r.CRAFT_CLASS_ICON=r.CRAFT_CLASS_TO_MATERIAL_CLASS=r.CRAFT_CLASS_DESC=r.CRAFT_CLASS_NAME=r.MATERIAL_CLASS_SOUND=r.MATERIAL_SOUND=r.MATERIAL_CLASS_ADJ=r.MATERIAL_CLASS_NAME=r.LAST_LOCALIZED_MATERIAL_CLASS=r.MaterialClass=void 0
var a,i,o,n,s,l,_,c,u,d,f,v,h,p
var m=e("assert")
var E=e("../common/ids")
var g=E.INV_ITEM_NAME
var T=E.TYPE_BLOCK
var y=E.TYPE_ITEM
var S=e("../common/materials_common")
var I=S.CraftClass
var A=S.Mat
var w=e("./tiles_const").TILES
var L;(function(e){e[e["NONE"]=0]="NONE"
e[e["WOOD"]=1]="WOOD"
e[e["STONE"]=2]="STONE"
e[e["DIRT"]=3]="DIRT"
e[e["METAL"]=4]="METAL"
e[e["INGREDIENT"]=5]="INGREDIENT"
e[e["COLOR"]=6]="COLOR"})((r.MaterialClass=L)||(r.MaterialClass=L={}))
var O=L.METAL
r.LAST_LOCALIZED_MATERIAL_CLASS=O
var R=[]
r.MATERIAL_CLASS_NAME=R
var b=[]
r.MATERIAL_CLASS_ADJ=b
var N=((a={})[A.COAL]="_coal",a)
r.MATERIAL_SOUND=N
var C=((i={})[L.NONE]="_dirt",i[L.WOOD]="_wood",i[L.STONE]="_stone",i[L.DIRT]="_dirt",i[L.METAL]="_metal",i)
r.MATERIAL_CLASS_SOUND=C
var x=[]
r.CRAFT_CLASS_NAME=x
var M=[]
r.CRAFT_CLASS_DESC=M
var D={};(r.CRAFT_CLASS_TO_MATERIAL_CLASS=D)[I.WOOD_RAW]=L.WOOD
D[I.STONE_RAW]=L.STONE
var P=((o={})[I.WOOD_RAW]=[T,w.WOOD],o[I.WOOD_PLANK]=[T,w.PLANKS_WOOD],o[I.BRICK]=[T,w.BRICK_STONE],o[I.STONE_RAW]=[T,w.STONE],o[I.FUEL]=[y,g.ITEM_COAL],o[I.SCALED_INGOT]=[y,g.ITEM_INGOT],o[I.GRINDABLE]=[y,g.ITEM_WHEAT],o[I.BAKED_FOOD]=[y,g.ITEM_PIE,A.PUMPKIN],o[I.FARMING_SEED]=[y,g.ITEM_SEEDS_WHEAT],o[I.INGREDIENT]=[y,g.ITEM_TOMATO],o[I.REPAIRABLE]=["ui_util","GATHERING_TOOLS"],o[I.CEREAL_GRAIN]=[y,g.ITEM_WHEAT],o[I.VEGETABLE]=[y,g.ITEM_CARROT],o[I.PIE_FILLING]=[y,g.ITEM_PUMPKIN],o[I.SEAFOOD]=[y,g.ITEM_STARFISH_PILE],o[I.SANDWICH_FILLING]=[y,g.ITEM_ROAST_VEGETABLES,A.ANY],o[I.PAINT_COLOR]=[y,g.ITEM_BERRY,A.RED_BERRY],o[I.ROD_WOOD]=[y,g.ITEM_ROD,A.WOOD],o[I.ROD_METAL]=[y,g.ITEM_ROD,A.IRON],o)
r.CRAFT_CLASS_ICON=P
var B=((n={})[A.NONE]={tier:0,dur:0,mc:L.NONE},n[A.ANY]={tier:1,dur:0,mc:L.NONE},n[A.LEAF]={tier:1,dur:1,mc:L.WOOD},n[A.LIGHT_WOOD]={tier:2,dur:2,mc:L.WOOD},n[A.WOOD]={tier:3,dur:3,mc:L.WOOD},n[A.RED_WOOD]={tier:4,dur:3,mc:L.WOOD},n[A.DARK_WOOD]={tier:5,dur:4,mc:L.WOOD},n[A.FLINT]={tier:1,dur:1,mc:L.STONE},n[A.ROCK]={tier:2,dur:1,mc:L.STONE},n[A.STONE]={tier:3,dur:1,mc:L.STONE},n[A.CORAL]={tier:4,dur:1,mc:L.STONE},n[A.FANCY_STONE]={tier:5,dur:1,mc:L.STONE},n[A.UNUSED_STONE]={tier:6,dur:1,mc:L.STONE},n[A.SAND]={tier:1,dur:1,mc:L.DIRT},n[A.DIRT]={tier:2,dur:1,mc:L.DIRT},n[A.MUTTAL]={tier:1,dur:1,mc:L.METAL},n[A.COAL]={tier:2,dur:5,mc:L.METAL},n[A.COPPER]={tier:3,dur:10,mc:L.METAL},n[A.TIN]={tier:4,dur:5,mc:L.METAL},n[A.BRONZE]={tier:5,dur:15,mc:L.METAL},n[A.IRON]={tier:6,dur:10,mc:L.METAL},n[A.SILVER]={tier:7,dur:5,mc:L.METAL},n[A.EMBERYLLIUM]={tier:8,dur:10,mc:L.METAL},n[A.GOLD]={tier:9,dur:5,mc:L.METAL},n[A.BRIGHTSTEEL]={tier:10,dur:15,mc:L.METAL},n[A.COBALT]={tier:11,dur:10,mc:L.METAL},n[A.MYTHRIL]={tier:12,dur:10,mc:L.METAL},n[A.AETHERSTONE]={tier:13,dur:15,mc:L.METAL},n[A.AETHERSTEEL]={tier:14,dur:15,mc:L.METAL},n[A.REGULAR]={tier:15,dur:1,mc:L.METAL},n[A.FAST]={tier:16,dur:1,mc:L.METAL},n[A.SUPER]={tier:17,dur:1,mc:L.METAL},n[A.ANY_INGREDIENT]={tier:1,dur:1,mc:L.INGREDIENT},n[A.TOMATO]={tier:2,dur:1,mc:L.INGREDIENT},n[A.PUMPKIN]={tier:3,dur:1,mc:L.INGREDIENT},n[A.CARROT]={tier:4,dur:1,mc:L.INGREDIENT},n[A.RED_BERRY]={tier:5,dur:1,mc:L.INGREDIENT},n[A.BLUE_BERRY]={tier:6,dur:1,mc:L.INGREDIENT},n[A.YELLOW_BERRY]={tier:7,dur:1,mc:L.INGREDIENT},n[A.LABEL]={tier:8,dur:1,mc:L.INGREDIENT},n[A.HOT]={tier:9,dur:1,mc:L.INGREDIENT},n[A.PUNGENT]={tier:10,dur:1,mc:L.INGREDIENT},n[A.SAVORY]={tier:11,dur:1,mc:L.INGREDIENT},n[A.BREAD]={tier:12,dur:1,mc:L.INGREDIENT},n[A.BROWN_MUSHROOM]={tier:13,dur:1,mc:L.INGREDIENT},n[A.LUMINESCENT_MUSHROOM]={tier:14,dur:1,mc:L.INGREDIENT},n[A.RED_MUSHROOM]={tier:15,dur:1,mc:L.INGREDIENT},n[A.CORN]={tier:16,dur:1,mc:L.INGREDIENT},n[A.CORAL_MUSHROOM]={tier:17,dur:1,mc:L.INGREDIENT},n[A.STARFISH]={tier:18,dur:1,mc:L.INGREDIENT},n[A.ANEMONE]={tier:19,dur:1,mc:L.INGREDIENT},n[A.MINT_ALGAE]={tier:20,dur:1,mc:L.INGREDIENT},n[A.JADE_ALGAE]={tier:21,dur:1,mc:L.INGREDIENT},n[A.BUBBLEGUM_ALGAE]={tier:22,dur:1,mc:L.INGREDIENT},n[A.INDIGO_ALGAE]={tier:23,dur:1,mc:L.INGREDIENT},n[A.ULTRAMARINE_ALGAE]={tier:24,dur:1,mc:L.INGREDIENT},n[A.RUBY_CACTORB]={tier:25,dur:1,mc:L.INGREDIENT},n[A.KYANITE_CACTORB]={tier:26,dur:1,mc:L.INGREDIENT},n[A.LIZARDITE_CACTINY]={tier:27,dur:1,mc:L.INGREDIENT},n[A.AMETHYST_CACTINY]={tier:28,dur:1,mc:L.INGREDIENT},n[A.RED]={tier:1,dur:1,mc:L.COLOR},n[A.ORANGE]={tier:2,dur:1,mc:L.COLOR},n[A.YELLOW]={tier:3,dur:1,mc:L.COLOR},n[A.GREEN]={tier:4,dur:1,mc:L.COLOR},n[A.BLUE]={tier:5,dur:1,mc:L.COLOR},n[A.PURPLE]={tier:6,dur:1,mc:L.COLOR},n)
var k={}
r.MATERIAL_CLASS=k
var U={}
r.MATERIAL_TIER=U
var G={}
r.INV_MATERIAL_TIER=G
var F={}
r.MATERIAL_DURABILITY_COST=F
var W={}
r.INV_MATERIAL_NAME=W
var H={}
r.MATERIAL_CODE_NAME=H
var z={}
r.MATERIAL_NAME=z;(function(){var e=0
var t=L[e]
var r={}
while("string"===typeof t){G[e]={}
r[e]={}
t=L[++e]}for(var a in B){var i=Number(a)
var o=B[i],n=o.mc,s=o.tier,l=o.dur
if(r[k[i]=n][s])m(false,"Duplicate Material tier for same MaterialClass")
r[n][s]=true
U[i]=s
G[n][s]=i
F[i]=l
W[A[i]]=i
H[i]=A[i]}})()
var V=((c={})[A.COPPER]=((s={})[A.TIN]=A.BRONZE,s),c[A.IRON]=((l={})[A.GOLD]=A.BRIGHTSTEEL,l),c[A.MYTHRIL]=((_={})[A.AETHERSTONE]=A.AETHERSTEEL,_),c)
r.ALLOYS=V
var Y=((u={})[A.BRONZE]=true,u[A.BRIGHTSTEEL]=true,u[A.AETHERSTEEL]=true,u[A.MUTTAL]=true,u)
r.IS_ALLOY=Y
var j=((d={})[A.LEAF]=.25,d[A.LIGHT_WOOD]=1.8,d[A.WOOD]=2,d[A.RED_WOOD]=2,d[A.DARK_WOOD]=2.5,d)
var K={}
r.MATERIAL_DIG_RATE=K;(function(){for(var e in j){var t=e
K[t]=1/j[t]}})()
var q=((f={})[A.LIGHT_WOOD]={st:0,mt:0,dr:0,td:.9,td2:.9,ts2:.7,it:0},f[A.WOOD]={st:0,mt:0,dr:0,td:1,td2:1,ts2:1,it:0},f[A.RED_WOOD]={st:0,mt:0,dr:0,td:1.1,td2:1.1,ts2:1,it:0},f[A.DARK_WOOD]={st:0,mt:0,dr:0,td:1.2,td2:1.2,ts2:1.1,it:0},f[A.MUTTAL]={st:0,mt:0,dr:.25,td:.1,td2:.1,ts2:1,it:1},f[A.FLINT]={st:0,mt:A.COAL,dr:.25,td:0,td2:0,ts2:1,it:0},f[A.STONE]={st:0,mt:A.COPPER,dr:.4,td:.3,td2:0,ts2:1,it:0},f[A.COPPER]={st:1,mt:A.TIN,dr:.7,td:.6,td2:1,ts2:1.2,it:1},f[A.TIN]={st:1,mt:A.TIN,dr:.33,td:.1,td2:1,ts2:1,it:1},f[A.BRONZE]={st:2,mt:A.IRON,dr:1,td:1.4,td2:1.3,ts2:1.2,it:1},f[A.IRON]={st:3,mt:A.EMBERYLLIUM,dr:1.25,td:1,td2:1.32,ts2:1.2,it:2},f[A.SILVER]={st:4,mt:A.EMBERYLLIUM,dr:.5,td:.2,td2:1,ts2:1.1,it:2},f[A.EMBERYLLIUM]={st:4,mt:A.GOLD,dr:1.5,td:1.7,td2:1.34,ts2:1.2,it:4},f[A.GOLD]={st:2,mt:A.GOLD,dr:.5,td:.2,td2:1,ts2:1.1,it:4},f[A.BRIGHTSTEEL]={st:5,mt:A.COBALT,dr:2,td:2.2,td2:1.36,ts2:1.1,it:4},f[A.COBALT]={st:6,mt:A.MYTHRIL,dr:3,td:1.9,td2:1,ts2:1.1,it:8},f[A.MYTHRIL]={st:7,mt:A.AETHERSTEEL,dr:4,td:2,td2:1.2,ts2:1,it:16},f[A.AETHERSTONE]={st:4,mt:A.AETHERSTONE,dr:.5,td:.2,td2:1,ts2:1.2,it:16},f[A.AETHERSTEEL]={st:8,mt:A.AETHERSTEEL,dr:5,td:2.5,td2:1.4,ts2:1,it:16},f[A.REGULAR]={st:9,mt:A.AETHERSTEEL,dr:1,td:1,td2:0,ts2:1,it:0},f[A.FAST]={st:9,mt:A.AETHERSTEEL,dr:4,td:1,td2:0,ts2:1,it:0},f[A.SUPER]={st:9,mt:A.AETHERSTEEL,dr:10,td:1,td2:0,ts2:1,it:0},f)
var Z={}
r.MATERIAL_MAX_STONE_TIER=Z
var X={}
r.MATERIAL_TO_MINE_STONE_TIER=X
var Q={}
r.METAL_TIERS=Q
var $={}
r.MATERIAL_TO_MINE_MATERIAL=$
var J=[]
r.MATERIAL_TOOL_DIG_RATE=J
var ee={}
r.MATERIAL_DURABILITY_FACTOR=ee
var te={}
r.MATERIAL2_DURABILITY_FACTOR=te
var re={}
r.MATERIAL2_STAMINA_FACTOR=re
var ae={}
r.MATERIAL_INGOT_SCALE=ae
var ie=((v={})[A.REGULAR]=true,v[A.FAST]=true,v[A.SUPER]=true,v)
r.MATERIAL_UNLIMITED_SPECIAL=ie;(function(){for(var e in q){var t=Number(e)
var r=q[t],a=r.st,i=r.mt,o=r.dr,n=r.td,s=r.td2,l=r.ts2,_=r.it
Z[t]=a
m(a<=9)
if(9!==a&&(!X[a]||X[a]>t))X[a]=t
if(i){var c=U[i]
Q[t]=c
for(var u=1;u<=c;++u){var d=G[L.METAL][u]
if(d&&d!==t&&(!$[d]||c<Q[$[d]]))$[d]=t}}else Q[t]=-1
J[t]=o
ee[t]=n
te[t]=s
re[t]=l
ae[t]=_}})()
var oe=((h={})[L.WOOD]=100,h[L.STONE]=20,h[L.DIRT]=40,h[L.METAL]=120,h[L.INGREDIENT]=20,h[L.COLOR]=20,h)
r.STAMINA_BY_MATERIAL_CLASS=oe
var ne=((p={})[A.LEAF]=20,p)
r.STAMINA_BY_MATERIAL=ne},{"../common/ids":249,"../common/materials_common":253,"./tiles_const":200,assert:void 0}],138:[function(e,t,r){"use strict"
r.mazeGen=mazeGen
r.M_DOOR=r.M_TORCH=r.M_INTERIOR=r.M_TREASURE=r.M_LEAF=r.M_WALL=r.M_OPEN=void 0
var R=e("assert")
var h=Math.abs,b=Math.max,N=Math.min,C=Math.round
var a=e("../glov/common/rand_alea.js").randCreate
var i=e("../glov/common/util.js"),x=i.clamp,p=i.ridx,m=i.sign
var o=0
r.M_OPEN=o
var M=1
r.M_WALL=M
var D=2
r.M_LEAF=D
var E=3
r.M_TREASURE=E
var P=4
r.M_INTERIOR=P
var B=5
r.M_TORCH=B
var k=6
r.M_DOOR=k
var U=a(1)
function mazeGen(e){var I=e.w,t=e.h,y=e.min_dim,A=e.door_w,S=e.r1,r=e.treasure,a=e.treasure_size,i=e.seed
var w=new Uint8Array(I*t)
var o=0
U.reseed(i)
function paintDepth(e,t,r){var a=t<<4
var i=r.rooms,o=r.x,n=r.y
R(i)
for(var s=0;s<A;++s)for(var l=0;l<A;++l){var _=o+s+(n+l)*I
if(w[_]===k)w[_]|=a}a=e<<4
var c=[]
for(var u=0;u<i.length;++u){var d=i[u]
if(void 0!==d.depth)continue
d.depth=e
var f=d.x0,v=d.y0,h=d.x1,p=d.y1,m=d.doors
for(var E=0;E<m.length;++E)c.push(m[E])
for(var g=f;g<=h;++g)for(var T=v;T<=p;++T)w[g+T*I]|=a}for(var y=0;y<c.length;++y){var S=x(e+U.range(3)-1,0,15)
paintDepth(S,b(S,e),c[y])}}function line(e,t,r,a,i){R(i)
var o=m(r-e)
var n=m(a-t)
R(h(o)+h(n)<=1)
w[e+t*I]=i
while(e!==r||t!==a)w[(e+=o)+(t+=n)*I]=i}function drawRect(e,t,r,a,i){for(var o=e;o<=r;++o)for(var n=t;n<=a;++n)w[o+n*I]=i}var L=[]
function doorAt(e,t,r){o=b(o,e)
for(var a=0;a<e;++a)if(t>=L[a].x&&t<L[a].x+A&&r>=L[a].y&&r<L[a].y+A)return true
return false}var O=[]
function divide(e,t,r,a,i){var o=a-t
var n=i-r
var s=.25+S
do{if(b(o,n)<2*y+1)break
if(N(o,n)<=y)break
var l=(2*U.range(2)-1)*s
s++
if(o>n){var _=t+C((o-A)/2+l)
if(_<t+y||_>a-y)break
if(doorAt(e,_,r-1)||doorAt(e,_,i+1))continue
var c=r+U.range(n-A)
if(c>r)line(_,r,_,c-1,M)
if(c<=i-A)line(_,c+A,_,i,M)
L[e]={x:_,y:c}
line(_,c,_,c+A-1,k)
divide(e+1,t,r,_-1,i)
divide(e+1,_+1,r,a,i)}else{var u=r+C((n-1)/2+l)
if(u<r+y||u>i-y)break
if(doorAt(e,t-1,u)||doorAt(e,a+1,u))continue
var d=t+U.range(o-A)
if(d>t)line(t,u,d-1,u,M)
if(d<=a-A)line(d+A,u,a,u,M)
L[e]={x:d,y:u}
line(d,u,d+A-1,u,k)
divide(e+1,t,r,a,u-1)
divide(e+1,t,u+1,a,i)}return}while(true)
var f={x0:t,x1:a,y0:r,y1:i,doors:[]}
var v=0
for(var h=0;h<e;++h){var p=L[h]
if((p.x===t-1||p.x===a+1)&&p.y>=r&&p.y<=i||(p.y===r-1||p.y===i+1)&&p.x>=t&&p.x<=a){v++
f.doors.push(p)
p.rooms=p.rooms||[]
p.rooms.push(f)}}if(1===v){drawRect(t,r,a,i,D)
O.push(f)}else{var m=null
var E=0
for(var g=t;g<=a;++g)for(var T=r;T<=i;++T)if(g===t||g===a||T===r||T===i)if(g===t&&doorAt(e,g-1,T)||g===a&&doorAt(e,g+1,T)||T===r&&doorAt(e,g,T-1)||T===i&&doorAt(e,g,T+1));else{++E
if(!U.range(E))m=g+T*I}else w[g+T*I]=P
if(m)w[m]=B}}line(0,0,I-1,0,M)
line(I-1,0,I-1,t-1,M)
line(I-1,t-1,0,t-1,M)
line(0,t-1,0,0,M)
divide(0,1,1,I-2,t-2)
var n=C(r*I*t)
while(n&&O.length){var s=U.range(O.length)
var l=O[s]
p(O,s)
var _=l.x1-l.x0+1
var c=l.y1-l.y0+1
if(_<a+2||c<a+2)continue;--n
var u=1+U.range(_-a-2)
var d=1+U.range(c-a-2)
var f=l.x0+u
var v=l.y0+d
drawRect(f,v,f+a-1,v+a-1,E)}if(L[0])paintDepth(7,7,L[0])
w.max_depth=o
return w}},{"../glov/common/rand_alea.js":395,"../glov/common/util.js":400,assert:void 0}],139:[function(e,t,r){"use strict"
r.countWaiting=countWaiting
r.megachunkResubscribing=megachunkResubscribing
r.onVolumeMod=onVolumeMod
r.detailGenAttachChoices=detailGenAttachChoices
r.detailGenUnspoil=detailGenUnspoil
r.megachunkTickOMP=megachunkTickOMP
r.onTransSetTile=onTransSetTile
r.shift=shift
r.isSpoiled=isSpoiled
r.isSpoiledDebug=isSpoiledDebug
r.megaChunkGetNearbyVolumes=megaChunkGetNearbyVolumes
r.megachunkGetSettlement=megachunkGetSettlement
r.megachunkForVolumeID=megachunkForVolumeID
r.megachunk2DReady=megachunk2DReady
r.megachunk2DHasZMap=megachunk2DHasZMap
r.getSpoilInfo=getSpoilInfo
r.hasMegachunkForChunkId=hasMegachunkForChunkId
r.isSpoiledByChunkId=isSpoiledByChunkId
r.hexomeChoiceGet=hexomeChoiceGet
r.hexomeChoiceReady=hexomeChoiceReady
r.hexomeChoiceSet=hexomeChoiceSet
r.spoil=spoil
r.unspoil=unspoil
r.handleZMapData=handleZMapData
r.drawDebug=drawDebug
r.init=init
r.reset=reset
var c=e("assert")
var f=e("../glov/client/engine")
var U=e("../glov/client/input")
var v=e("../glov/client/net").netDisconnected
var G=e("../glov/client/ui")
var i=e("../glov/common/dot-prop")
var a=e("../glov/common/rand_alea").mashString
var o=e("../glov/common/util").callEach
var n=e("../glov/common/vmath")
var h=n.unit_vec
var p=n.v3addScale
var m=n.v3iAdd
var F=n.v3scaleFloor
var W=n.vec3
var s=e("../common/globals")
var H=s.CHUNK_SIZE
var l=s.CS2
var z=s.ID2
var V=s.ID_FACTOR
var _=s.MC_COUNT
var Y=s.MEGACHUNK_SIZE
var u=e("../common/megachunk_common")
var d=e("../common/voxel_data_common")
var E=d.zmapDeserialize
var g=d.zmapSerialize
var T=e("../common/world_constants").VOLUME_SETTLEMENT_PREFIX
var y=e("./editvolume_client").updateEditVolumes
var S=e("./lods").lodOnZMap
var I=e("./main")
var A=e("./proc_gen_biomes")
var w=e("./proc_gen_constants").HEX_WIDTH
var L=e("./proc_gen_details").detailGenMCIDs2
var O=e("./settlement").settlementUpdate
var R=e("./user_data").worldReadOnly
var b=e("./voxel_chunk_manager")
var N=e("./voxel_chunk_manager").STREAM_ABS_DIST
var j=e("./voxel_const").origin_chunk
var C=e("./voxel_gen")
var x=C.voxelGenQueueDetailData
var M=C.voxelGenQueueHexomeChoices
var D=C.voxelGenUnsubMegachunk2Ds
var P=e("./voxel_mesh")
var B=P.voxelMeshQueueZMaps
var k=P.voxelMeshRequestZMap
var K=P.voxelMeshUnsubMegachunk2Ds
var q=e("./world_comm").worldSend
var X=e("./world_metadata").worldSeed
var Q=Math.floor,$=Math.max,J=Math.random,ee=Math.round
var te={}
var re=true
var ae={}
var ie={}
var oe={}
var ne=0
var se=0
function countWaiting(){return ne}function megachunkResubscribing(){return se}function initShared(e){e.resubscribe=false
e.startWaiting()}function MegaChunk(e){this.mcid=e
this.spoiled=null
this.details=null
initShared(this)}MegaChunk.prototype.disposeBase=function(){if(this.waiting){this.waiting=false;--ne}if(this.resubscribe){this.resubscribe=false;--se}}
MegaChunk.prototype.dispose=function(){this.disposeBase()
if(this.details)x(this.mcid,null)}
MegaChunk.prototype.startWaiting=function(){c(!this.waiting)
this.waiting=true;++ne
this.ready_cbs=[]}
MegaChunk.prototype.doneWaiting=function(){if(this.waiting){this.waiting=false;--ne
if(this.resubscribe){this.resubscribe=false;--se}o(this.ready_cbs,this.ready_cbs=null,this)}}
MegaChunk.prototype.onData=function(e){var t=e.spoiled,r=e.details,a=e.volumes
var i=0
for(var o=0;o<t.length;++o)i+=t[o]
c.equal(i,_)
this.spoiled=t
this.details=r
this.details_spoiled=Boolean(r)
this.volumes=a
if(this.details)x(this.mcid,this.details)
else this.detailsInit()
this.doneWaiting()}
MegaChunk.prototype.isSpoiled=function(e){return u.isSpoiled(this.spoiled,e)}
MegaChunk.prototype.spoil=function(e){u.spoil(this.spoiled,e)}
MegaChunk.prototype.unspoil=function(e){u.unspoil(this.spoiled,e)}
MegaChunk.prototype.detailsInit=function(){c(!this.details)
c(!this.details_spoiled)
if(this.spoiled[0]!==_)this.details={ver:0,seed:0}
else{var e=A.getDetailsVersion()
var t=e?a(this.mcid+":"+X()):0
this.details={ver:e,seed:t}}x(this.mcid,this.details)}
function onMegaChunk(e,t){var r=e.list
for(var a=0;a<r.length;++a){var i=r[a]
var o=i.mcid
var n=te[o]
if(!n){console.log("Received MegaChunk update for "+o+" to which we are not subscribed")
continue}n.onData(i)}y()
O()
t()}function onVolumeMod(e,t,r){var a=te[e]
if(!a){console.log("Received MegaChunk VolumeMod for "+e+" to which we are not subscribed")
return}if(!a.volumes)a.volumes={}
if(void 0===r||null===r)i.delete(a.volumes,t)
else i.set(a.volumes,t,r)
if(!t.includes(".settlement"))y()
O()}function detailGenAttachChoices(e,t){var r=[]
var a=L(r,t.pos)
for(var i=0;i<a;++i){var o=r[i]
var n=te[o]
c(n)
if(!n.details_spoiled){n.details_spoiled=true
e.tset.sendDetailData(o,n.details)}}}function detailGenUnspoil(e){var t=te[e]
if(t)t.details_spoiled=false}function MegaChunk2D(e){this.zmaps={}
initShared(this)
this.mcid=e
var t=ee(e/V)
var r=(e-t*V)*Y
var a=t*Y
this.root_vsid=a*V+r}MegaChunk2D.prototype.startWaiting=MegaChunk.prototype.startWaiting
MegaChunk2D.prototype.doneWaiting=MegaChunk.prototype.doneWaiting
MegaChunk2D.prototype.dispose=MegaChunk.prototype.disposeBase
MegaChunk2D.prototype.onData=function(e){var t=e.zmap
var r=[]
for(var a in t){var i=t[a]
a=Number(a)
this.zmaps[a]=i
var o=new Int16Array(l)
var n=E(o,i)
c(!n,n)
var s=this.root_vsid+Q(a/Y)*V+a%Y
r.push({vsid:s,data:o,from:"server"})
S({vsid:s,data:o,encoded:i,from:"server"})
if(oe[s])delete oe[s]}B(r)
this.doneWaiting()}
function onMegaChunk2D(e,t){var r=e.list
for(var a=0;a<r.length;++a){var i=r[a]
var o=i.mcid
var n=ae[o]
if(!n){console.log("Received MegaChunk2D update for "+o+" to which we are not subscribed")
continue}n.onData(i)}t()}function MegaChunkHC(e){this.choices={}
initShared(this)
this.mcid=e}MegaChunkHC.prototype.startWaiting=MegaChunk.prototype.startWaiting
MegaChunkHC.prototype.doneWaiting=MegaChunk.prototype.doneWaiting
MegaChunkHC.prototype.dispose=MegaChunk.prototype.disposeBase
MegaChunkHC.prototype.onData=function(e){var t=e.choices
for(var r in t){var a=t[r]
this.choices[r]=a}M(t)
this.doneWaiting()}
function onMegaChunkHC(e,t){var r=e.list
for(var a=0;a<r.length;++a){var i=r[a]
var o=i.mcid
var n=ie[o]
if(!n){console.log("Received MegaChunkHC update for "+o+" to which we are not subscribed")
continue}n.onData(i)}t()}var le=new Array(8)
var _e=0
function isMyEdit(e){return-1!==le.indexOf(e)}function megachunkTickOMP(e){var t=false
for(var r in oe){var a=oe[r]
var i=a.mcid,o=a.send_at,n=a.was_pristine
if(!ae[i]){delete oe[r]
continue}if(!n&&isMyEdit(Number(r))||f.frame_timestamp>=o||e)t=true}if(!t||v())return
var s=[]
for(var l in oe){var _=oe[l]
var c=_.mcid,u=_.idx,d=_.data
ae[c].zmaps[u]=d
s.push([Number(l),d])}oe={}
if(s&&!R())q("world_zmap",s)}var ce="REQUEST_PRISTINE"
var ue="REQUEST_PRISTINE_HANDLED"
function onTransSetTile(e){var t=Q(e[0]/Y)
var r=Q(e[1]/Y)
var a=ae[r*V+t]
if(!a)return
var i=e[0]-t*Y+Y*(e[1]-r*Y)
var o=e[1]*V+e[0]
if(!a.zmaps[i]){k(o)
a.zmaps[i]=ce}if(-1===le.indexOf(o)){le[_e++]=o
_e%=le.length}}var de=W()
var fe=W()
var ve=N+w/H
function shift(){if(!I.omp)return
p(de,j,h,-b.view_dist-ve)
p(fe,j,h,b.view_dist+ve)
F(de,de,1/Y)
F(fe,fe,1/Y)
p(de,de,h,-1)
m(fe,h)
fe[2]++
var e={}
var t=[]
for(var r=de[2];r<=fe[2];++r)for(var a=de[1];a<=fe[1];++a)for(var i=de[0];i<=fe[0];++i){var o=(r*V+a)*V+i
e[o]=true
if(te[o])continue
t.push(o)
te[o]=new MegaChunk(o)
re=false}var n=[]
for(var s in te){if(e[s])continue
n.push(Number(s))
te[s].dispose()
delete te[s]}if(!t.length)t=void 0
if(!n.length)n=void 0
if(t||n)q("mc_sub",{unsub:n,sub:t})
y()
e={}
t=[]
for(var l=de[1];l<=fe[1];++l)for(var _=de[0];_<=fe[0];++_){var c=l*V+_
e[c]=true
if(ae[c])continue
t.push(c)
ae[c]=new MegaChunk2D(c)}n=[]
for(var u in ae){if(e[u])continue
n.push(Number(u))
ae[u].dispose()
delete ae[u]}if(!t.length)t=void 0
if(!n.length)n=void 0
else{megachunkTickOMP(true)
K(n)
D(n)}if(t||n)q("mc2d_sub",{unsub:n,sub:t})
var d=0
t=[];(e={})[d]=true
if(!ie[d]){t.push(d)
ie[d]=new MegaChunkHC(d)}n=[]
for(var f in ie){if(e[f])continue
n.push(Number(f))
ie[f].dispose()
delete ie[f]}if(!t.length)t=void 0
if(!n.length)n=void 0
if(t||n)q("mchc_sub",{unsub:n,sub:t})}var he=new Int32Array(3)
function isSpoiledWithDetailsOnReady(e,t){if(!t.details)t.detailsInit()
if(!--e.waiting){var r=e.query_mc.isSpoiled(e.local_pos)
e.cb(r)}}var pe=[]
function isSpoiledWithDetails(e,t,r){var a=L(pe,t)
var i=0
var o
var n
for(var s=0;s<a;++s){var l=pe[s]
var _=te[l]
c(_)
if(_.waiting){i++
if(!n){o={cb:r,query_mc:e,local_pos:he.slice(0)}
n=isSpoiledWithDetailsOnReady.bind(null,o)}_.ready_cbs.push(n)}else if(!_.details)_.detailsInit()}if(!i)r(e.isSpoiled(he))
else o.waiting=i}var me=new Int32Array(3)
function isSpoiled(e,t){F(me,e,1/Y)
p(he,e,me,-Y)
c(me[0]>=de[0]&&me[0]<=fe[0])
c(me[1]>=de[1]&&me[1]<=fe[1])
c(me[2]>=de[2]&&me[2]<=fe[2])
var r=(me[2]*V+me[1])*V+me[0]
var a=te[r]
c(a)
if(!t){c(!a.waiting)
return a.isSpoiled(he)}isSpoiledWithDetails(a,e,t)}function isSpoiledDebug(e){F(me,e,1/Y)
p(he,e,me,-Y)
var t=(me[2]*V+me[1])*V+me[0]
var r=te[t]
if(!r||r.waiting)return false
return r.isSpoiled(he)}function megaChunkGetNearbyVolumes(){if(re)return{}
var e=j
F(me,e,1/Y)
if(me[0]-1<de[0]||me[0]+1>fe[0]||me[1]-1<de[1]||me[1]+1>fe[1]||me[2]-1<de[2]||me[2]+1>fe[2])c(false,"mchunkpos out of range; origin="+e+", mc0="+de+", mc1="+fe)
var t=(me[2]*V+me[1])*V+me[0]
var r={}
for(var a=-1;a<=1;++a)for(var i=-1;i<=1;++i)for(var o=-1;o<=1;++o){var n=t+(a*V+i)*V+o
var s=te[n]
if(s&&!s.waiting)for(var l in s.volumes){var _=s.volumes[l]
_.mcid=n
r[_.volume_id=l]=_}}return r}function megachunkGetSettlement(e,t){var r,a
var i=te[e]
c(i)
c(!i.waiting)
var o=""+T+t
return null==(r=i.volumes)?void 0:null==(a=r[o])?void 0:a.settlement}function megachunkForVolumeID(e){for(var t in te){var r=te[t]
if(!r.waiting&&r.volumes&&r.volumes[e])return r}return null}function megachunk2DReady(e,t){var r=Q(e[0]/Y)
var a=Q(e[1]/Y)
var i=ae[a*V+r]
if(!i)return void t()
if(!i.waiting)return void t()
i.ready_cbs.push(t)}function megachunk2DHasZMap(e){var t=e[0]
var r=e[1]
var a=Q(t/Y)
var i=Q(r/Y)
var o=t-a*Y+Y*(r-i*Y)
var n=ae[i*V+a]
if(!n)return false
return n.zmaps[o]&&n.zmaps[o]!==ce}function getSpoilInfo(e){me[0]=Q(e[0]/Y)
me[1]=Q(e[1]/Y)
me[2]=Q(e[2]/Y)
he[0]=e[0]-me[0]*Y
he[1]=e[1]-me[1]*Y
he[2]=e[2]-me[2]*Y
var t=(me[2]*V+me[1])*V+me[0]
var r=te[t]
if(!r||r.waiting)return
return{spoiled:r.isSpoiled(he),details:r.details,details_spoiled:r.details_spoiled}}function hasMegachunkForChunkId(e){var t=u.parseChunkId(e)
return Boolean(te[t.mcid]&&!te[t.mcid].waiting)}function isSpoiledByChunkId(e){var t=u.parseChunkId(e)
var r=te[t.mcid]
c(r)
c(!r.waiting)
return r.isSpoiled(t.local_pos)}function hexomeChoiceGet(e){var t=ie[0]
c(t&&!t.waiting)
return t.choices[e]}function hexomeChoiceReady(e){var t=ie[0]
c(t)
if(!t.waiting){if(e)e()
return true}if(e)t.ready_cbs.push(e)
return false}function hexomeChoiceSet(e,t){var r=ie[0]
if(r&&!r.waiting)r.choices[e]=t
else c(!t)}function spoil(e){var t=u.parseChunkId(e)
var r=t.mcid
var a=te[r]
if(!a){console.log("Received world_spoiled for unknown MegaChunk "+r+", ignoring")
return}if(a.waiting){console.log("Received world_spoiled for waiting MegaChunk "+r+", ignoring")
return}a.spoil(t.local_pos)}function unspoil(e){var t=u.parseChunkId(e)
var r=t.mcid
var a=te[r]
if(!a){console.log("Received world_unspoiled for unknown MegaChunk "+r+", ignoring")
return}if(a.waiting){console.log("Received world_unspoiled for waiting MegaChunk "+r+", ignoring")
return}a.unspoil(t.local_pos)}var Ee=500
var ge=500
function handleZMapData(e){if(!I.omp)return
for(var t in e){var r=e[t]
var a=g(r)
t=Number(t)
var i=ee(t/V)
var o=t-i*V
var n=Q(o/Y)
var s=Q(i/Y)
var l=s*V+n
var _=o-n*Y+Y*(i-s*Y)
var c=ae[l]
if(!c)continue
if(c.zmaps[_]===a)continue
S({vsid:t,data:r,encoded:a,from:"mesh"})
var u=false
if(c.zmaps[_]===ce){u=true
c.zmaps[_]=ue}oe[t]={mcid:l,idx:_,data:a,send_at:f.frame_timestamp+Ee+J()*ge,was_pristine:u}}}function drawDebug(){var e=10
var t=0
var r=10
var a=Z.DEBUG
var i=16
var o=10*i
var n=W()
var s=drawDebug.style_me=drawDebug.style_me||G.font.styleColored(null,2164228351)
var l=drawDebug.style_sel=drawDebug.style_sel||G.font.styleColored(null,4294934783)
var _=drawDebug.style_spoiled=drawDebug.style_spoiled||G.font.styleColored(null,4286611711)
var c=drawDebug.style_volume=drawDebug.style_volume||G.font.styleColored(null,4286644223)
F(n,j,1/Y)
var u
for(var d=fe[2];d>=de[2];--d){var f=e+(fe[0]-de[0]+1)*i
for(var v=fe[1];v>=de[1];--v){var h=f
for(var p=de[0];p<=fe[0];++p){var m=(d*V+v)*V+p
var E=null
if(n[0]===p&&n[1]===v&&n[2]===d)E=s
var g=te[m]
var T=0
if(g.spoiled)for(var y=1;y<g.spoiled.length;y+=2)T+=g.spoiled[y]
var S=g.volumes||{}
var I=Object.keys(S).length
if(U.mouseOver({x:h,y:r,w:o,h:i})){E=l
u={numspoiled:T,mcid:m}}var A=h
A+=G.font.drawSized(E,A,r,a,i,""+m)+4
if(T){var w=128*(1-T/32768)|0
A+=G.font.drawSized(G.font.styleColored(null,4278190335|(w=w<<16|w<<8)),A,r,a,i,"s:"+T)+4}if(g.details){var L="d:"+g.details.ver
E=null
if(g.details_spoiled){L+=",s"
E=_}A+=G.font.drawSized(E,A,r,a,i,L)+4}if(I)A+=G.font.drawSized(c,A,r,a,i,"vol:"+I)+4
h+=o+4}t=$(t,h)
r+=i
f-=i}r+=1.5*i}if(u){var O=u,R=O.mcid,b=O.numspoiled
var N=te[R]
G.print(null,e,r,a,"Selected: "+R)
r+=G.font_height
G.print(null,e,r,a,"Spoiled chunks: "+b)
r+=G.font_height
G.print(null,e,r,a,N.details?"Details version: "+N.details.ver+" ("+(N.details_spoiled?"":"un")+"spoiled)":"No details data")
r+=G.font_height
var C=ee(R/z)
var x=ee((R-=C*z)/V)
var M=R-x*V
G.print(null,e,r,a,"MC POS: "+M+","+x+","+C)
r+=G.font_height
M*=Y
x*=Y
C*=Y
var D=Y-1
G.print(null,e,r,a,"Chunks: ["+M+","+x+","+C+"] - ["+(M+D)+","+(x+D)+","+(C+D)+"]")
r+=G.font_height
M*=H
x*=H
C*=H
D=H*Y-1
G.print(null,e,r,a,"World: ["+M+","+x+","+C+"] - ["+(M+D)+","+(x+D)+","+(C+D)+"]")
r+=G.font_height
var P=Object.keys(N.volumes||{})
if(P.length){G.print(null,e,r,a,"Volumes: "+P)
r+=G.font_height
if(1===P.length){var B=N.volumes[P[0]]
if(B.props){G.print(null,e,r,a,"Volume Props: "+JSON.stringify(B.props))
r+=G.font_height}}}var k=P.filter(function(e){return N.volumes[e].settlement})
if(k.length){G.print(null,e,r,a,"Settlements: "+k)
r+=G.font_height}}G.drawRect(e-5,5,t+5,r+5,a-1,[0,0,0,.8])}function init(e,t){e.onChannelMsg("world","mc",t(onMegaChunk))
e.onChannelMsg("world","mc2d",t(onMegaChunk2D))
e.onChannelMsg("world","mchc",t(onMegaChunkHC))}function reset(e){te={}
re=true
ae={}
oe={}
ie={}
se=ne=0}},{"../common/globals":248,"../common/megachunk_common":254,"../common/voxel_data_common":264,"../common/world_constants":267,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/ui":367,"../glov/common/dot-prop":383,"../glov/common/rand_alea":395,"../glov/common/util":400,"../glov/common/vmath":402,"./editvolume_client":84,"./lods":132,"./main":135,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./proc_gen_details":166,"./settlement":181,"./user_data":208,"./voxel_chunk_manager":214,"./voxel_const":215,"./voxel_gen":219,"./voxel_mesh":220,"./world_comm":226,"./world_metadata":235,assert:void 0}],140:[function(e,t,d){"use strict"
d.setFadePanel=setFadePanel
d.menuPanelColor=menuPanelColor
d.shift=shift
d.getMenuPage=getMenuPage
d.menuGetDetails=menuGetDetails
d.getMenuLastPage=getMenuLastPage
d.getMenuPreviousPage=getMenuPreviousPage
d.menuDoTransition=menuDoTransition
d.menuGoBack=menuGoBack
d.isBuildMenu=isBuildMenu
d.menuActive=menuActive
d.doQuickSlotMenu=doQuickSlotMenu
d.menuClear=menuClear
d.isQuickMenu=isQuickMenu
d.menuHidesQuickbar=menuHidesQuickbar
d.menuWantsQuickbarScroll=menuWantsQuickbarScroll
d.init=init
d.startup=startup
d.menuX1=menuX1
d.menuY0=menuY0
d.menuY1=menuY1
d.menuInteractGetPos=menuInteractGetPos
d.menuInteractGetProp=menuInteractGetProp
d.onTokenGen=onTokenGen
d.fscreenEnterAndOrient=fscreenEnterAndOrient
d.lockMenuPageToDraw=lockMenuPageToDraw
d.menuPanelX0=menuPanelX0
d.prefixShortcutKey=prefixShortcutKey
d.gameModeWatermark=gameModeWatermark
d.setMenuPageLayout=setMenuPageLayout
d.menuTabColors=menuTabColors
d.tickMenu=tickMenu
d.exitSpecificMenu=exitSpecificMenu
d.page_open_frame=d.page=d.hint_color=d.panel_color_popup=d.panel_color=d.PANEL_PAD=d.BORDER=d.KEEP=d.BOOST_VIEW=d.PHOTO_LIBRARY=d.USER_PROFILE_VIEW=d.CURRENCY_SHOP=d.LEAPGATE=d.CHARACTER_CUSTOMIZATION=d.ACCESS_CONTROL=d.RACE_RESULTS=d.PHOTO_VIEW=d.PROP_EDIT=d.WAYGATE_TARGETS=d.WORLD_INFO_VIEW=d.BLUEPRINT_VIEW=d.BLUEBOX=d.QUICK_SLOT=d.SETTINGS=d.WORLD_INFO_VIEW_SELF=d.SOCIAL=d.ENERGY_WELL=d.WAYGATE_EDIT_REMOTE=d.WAYGATE_EDIT=d.FACTORY=d.CONTAINER=d.BUILD=d.INVENTORY=d.NONE=d.DEFAULT=void 0
var r
var a=-1
d.DEFAULT=a
var i=0
d.NONE=i
var f=1
d.INVENTORY=f
var v=2
d.BUILD=v
var h=3
d.CONTAINER=h
var p=4
d.FACTORY=p
var m=5
d.WAYGATE_EDIT=m
var E=6
d.WAYGATE_EDIT_REMOTE=E
var g=7
d.ENERGY_WELL=g
var T=8
d.SOCIAL=T
var y=9
d.WORLD_INFO_VIEW_SELF=y
var S=10
d.SETTINGS=S
var I=20
d.QUICK_SLOT=I
var A=21
d.BLUEBOX=A
var w=22
d.BLUEPRINT_VIEW=w
var L=23
d.WORLD_INFO_VIEW=L
var O=24
d.WAYGATE_TARGETS=O
var R=25
d.PROP_EDIT=R
var b=26
d.PHOTO_VIEW=b
var N=27
d.RACE_RESULTS=N
var C=28
d.ACCESS_CONTROL=C
var x=30
d.CHARACTER_CUSTOMIZATION=x
var M=31
d.LEAPGATE=M
var D=32
d.CURRENCY_SHOP=D
var P=33
d.USER_PROFILE_VIEW=P
var B=34
d.PHOTO_LIBRARY=B
var k=35
d.BOOST_VIEW=k
var o="keep"
d.KEEP=o
var n=50
d.BORDER=n
var U=20
d.PANEL_PAD=U
var G=e("../glov/client/ui")
var s=e("../glov/common/vmath")
var l=s.v3distSq
var _=s.v3iAdd
var c=s.v4set
var u=s.vec3
var F=s.vec4
var W=G.makeColorSet([1,1,1,1])
c(W.rollover,1,1,1,1)
var H=G.makeColorSet([.5,.5,.5,1])
c(H.rollover,.8,.8,.8,1)
c(H.down,1,1,1,1)
var z=F(208/255,208/255,208/255,1)
d.panel_color=z
var V=F(228/255,228/255,228/255,1)
d.panel_color_popup=V
var Y=F(.75,1,.75,1)
d.hint_color=Y
var j=e("assert")
var K=e("../glov/client/browser").is_discrete_gpu
var q=e("../glov/client/cmds").cmd_parse
var X=e("../glov/client/engine")
var Q=e("../glov/client/engine").getFrameIndex
var $=e("../glov/client/fscreen").fscreenEnter
var J=e("../glov/client/input")
var ee=e("../glov/client/localization").getStringFromLocalizable
var te=e("../glov/client/settings")
var re=e("../glov/client/transition")
var ae=e("../glov/client/ui")
var ie=ae.provideUserString
var oe=ae.uiButtonHeight
var ne=e("../glov/client/urlhash")
var se=e("./access_control").doAccessControl
var le=e("./bluebox_ui")
var _e=le.blueboxGetTitle
var ce=le.blueboxShift
var ue=le.blueboxUIInit
var de=le.doBluebox
var fe=e("./blueprint")
var ve=fe.blueprintGetDef
var he=fe.blueprintIdValid
var pe=e("./blueprint_view")
var me=pe.blueprintViewGetTitle
var Ee=pe.blueprintViewInit
var ge=pe.doBlueprintView
var Te=e("./boost_view")
var ye=Te.boostViewInit
var Se=Te.doBoostView
var Ie=e("./build_menu")
var Ae=Ie.buildMenuInit
var we=Ie.buildMenuStartup
var Le=Ie.doBuild
var Oe=e("./build_mode").MAX_INTERACT_DIST_CHECK_SQ
var Re=e("./character_customization")
var be=Re.characterCustomizationMenuInit
var Ne=Re.characterCustomizationMenuStartup
var Ce=Re.doCharacterCustomization
var xe=e("./currency_shop")
var Me=xe.currencyShopInit
var De=xe.currencyShopStartup
var Pe=xe.doCurrencyShop
var Be=e("./factory_ui")
var ke=Be.doFactoryUI
var Ue=Be.factoryUIInit
var Ge=Be.factoryUIStartup
var Fe=e("./inventory_ui")
var We=Fe.doContainer
var He=Fe.doInventory
var ze=Fe.inventoryUIInit
var Ve=Fe.inventoryUIStartup
var Ye=e("./item_info_view").itemInfoViewClear
var je=e("./layout")
var Ke=je.layoutCameraCurX1
var qe=je.layoutCameraCurY1
var Ze=je.layoutCameraFull
var Xe=je.layoutCameraSquare
var Qe=je.layoutCameraTallWide
var $e=je.pushViewportOffset
var Je=je.quickbarOnTop
var et=e("./leapgate_ui")
var tt=et.doLeapgate
var rt=et.leapgateUIStartup
var at=e("./localization/localization").L
var it=e("./main")
var ot=e("./main")
var nt=ot.charControllerPos
var st=ot.mainActive
var lt=ot.menuExit
var _t=ot.menuExitGeneric
var ct=ot.toggleMenuPage
var ut=ot.verifyFrameTransactions
var dt=e("./main_menu")
var ft=dt.menuExitClearParams
var vt=dt.setPageFromId
var ht=dt.socialPresenceIconIfUnusual
var pt=e("./orient")
var mt=e("./photo_library_view")
var Et=mt.photoLibraryView
var gt=mt.photoLibraryViewInit
var Tt=e("./photo_mode")
var yt=Tt.photoModeActive
var St=Tt.photoModeCancel
var It=e("./photo_ui")
var At=It.doPhotoView
var wt=It.photoIdValid
var Lt=It.photoViewGetTitle
var Ot=It.photoViewInit
var Rt=e("./prop_edit").doPropEdit
var bt=e("./race_results").doRaceResults
var Nt=e("./settings_menu")
var Ct=Nt.doSettings
var xt=Nt.settingsMenuClear
var Mt=Nt.settingsMenuInit
var Dt=e("./social_menu")
var Pt=Dt.doSocialMenu
var Bt=Dt.socialMenuInit
var kt=e("./styles")
var Ut=kt.inventory_style
var Gt=kt.menu_header_style
var Ft=e("./ui_util")
var Wt=e("./ui_util_2")
var Ht=e("./user_data")
var zt=Ht.viewSettlementAllowed
var Vt=Ht.waygateEditAllowed
var Yt=Ht.worldReadOnly
var jt=e("./user_profile_view")
var Kt=jt.doUserProfileView
var qt=jt.userIdValid
var Zt=jt.userProfileViewGetTitle
var Xt=jt.userProfileViewInit
var Qt=e("./voxel_chunk_manager")
var $t=e("./voxel_data")
var Jt=e("./waygate_ui")
var er=Jt.doEnergyWell
var tr=Jt.doWaygateEdit
var rr=Jt.doWaygateTargets
var ar=Jt.waygateEditTitle
var ir=Jt.waygateUIInit
var or=Jt.waygateUIStartup
var nr=e("./world_info_view")
var sr=nr.doWorldInfoView
var lr=nr.worldInfoViewInit
var _r=nr.worldInfoViewStartup
var cr=e("./world_metadata")
var ur=cr.adventureMode
var dr=cr.unlimitedMode
var fr=cr.worldEnergy
var vr=cr.worldSettlements
var hr
var pr
var mr
var Er=F(z[0],z[1],z[2],.25)
var gr
d.page=gr
var Tr
d.page_open_frame=Tr
var yr
var Sr
var Ir
var Ar=[]
function setFadePanel(e){Ir=e}te.register({split_container:{label:"Split Container UI from main menu",default_value:1,type:q.TYPE_INT,range:[0,1]},split_factory:{label:"Split Factory UI from main menu",default_value:1,type:q.TYPE_INT,range:[0,1]},split_waygate:{label:"Split Waygate & Settlement UI from main menu",default_value:1,type:q.TYPE_INT,range:[0,1]},split_build:{label:"Split Build UI from main menu",default_value:0,type:q.TYPE_INT,range:[0,1]},quickbar_force_show:{label:"Force show quickbar even if hidden by split_build",default_value:0,type:q.TYPE_INT,range:[0,1]},quickslot_menu:{label:"Use Quick-Slot Menu",usage:"$HELP\n  Usage: /quickslot_menu Value\n  Value = -1 is Auto - Q will open the Quick-Slot menu only in Unlimited worlds\n  Value = 0 means Q will never open the Quick-Slot menu\n  Value = 1 means Q will always open the Quick-Slot menu",type:q.TYPE_INT,default_value:1,range:[-1,1]}})
function menuPanelColor(){return z}function shift(e){if(Sr)_(Sr,e)
ce(e)}function getMenuPage(){return gr}var wr
function menuGetDetails(){return wr}function getMenuLastPage(){return yr}function getMenuPreviousPage(){return Ar[Ar.length-2]&&Ar[Ar.length-2].page}var Lr
function menuDoTransition(){var e=Q()
if(Lr===e)return
Lr=e
re.queue(Z.TRANSITION_FINAL,re.fade(150))}var Or=((r={})[v]=true,r[f]=true,r[y]=true,r[T]=true,r[S]=true,r)
function menuPageStackPush(e,t){var r
wr=t===o?void 0:t
if(Or[e]&&Or[null==(r=Ar[Ar.length-1])?void 0:r.page])Ar.pop()
var a={page:e,details:t,url:ne.getRouteString()}
if(Ar.length>=2){var i=Ar[Ar.length-2]
if(i.page===a.page&&i.details===a.details&&i.url===a.url){Ar.pop()
return}}Ar.push(a)}function menuGoBack(){var e=Ar[Ar.length-2]
if(!e){if(st())_t()
else lt()
return}j(e)
Ar.pop()
Ar.pop()
var t=e.page===x?{keep_preview:true}:e.details
if(e.url)ne.goRoute(e.url,true)
ct(e.page,t)}function isBuildMenu(){return gr===v||gr===I}function menuActive(){return Boolean(gr)&&!yt()}d.active=menuActive
function doQuickSlotMenu(){return 1===te.quickslot_menu||-1===te.quickslot_menu&&dr()}function menuClear(){if(gr)yr=gr
d.page=gr=i
Ar.length=0}function isQuickMenu(e){return(e=e||gr)>=I||e===h&&te.split_container||e===g&&te.split_waygate||e===m&&te.split_waygate||e===E&&te.split_waygate||e===p&&te.split_factory||e===v&&te.split_build}function hasTabs(e){return!isQuickMenu(e=e||gr)||e===x||e===D}function menuHidesQuickbar(){return menuActive()&&(Yt()||isQuickMenu()&&gr!==v||te.split_build&&gr!==v&&!te.quickbar_force_show)}function menuWantsQuickbarScroll(){return!menuActive()||isBuildMenu()||gr===f}function init(e,t){if(J.pointerLocked())J.pointerLockExit()
if(gr&&e!==gr)ft()
St()
Ae()
lr()
Bt()
ze()
Mt()
it.menuExitClear()
d.page_open_frame=Tr=X.frame_index
if(void 0!==e)d.page=gr=e
else if(Or[yr])d.page=gr=yr
else d.page=gr=a
if(gr===a)d.page=gr=dr()&&!te.split_build?v:f
if(Yt()&&(gr===v||gr===h||gr===p||gr===m||gr===g||gr===M))d.page=gr=y
if(!Vt()&&!zt()&&gr===E)d.page=gr=y
menuPageStackPush(gr,t)
if(t===o);else if((gr===h||gr===A||gr===m||gr===O||gr===E||gr===R||gr===N||gr===p||gr===g||gr===C||gr===M)&&t)Sr=t.slice(0)
else Sr=null
if(gr===A)ue()
else if(gr===w)Ee(t)
else if(gr===L)lr(t)
else if(gr===b)Ot(t)
else if(gr===P)Xt(t)
else if(gr===B)gt()
else if(gr===k)ye(t)
else if(gr===f);else if(gr===h);else if(gr===m||gr===O||gr===g||gr===E)ir(gr===E)
else if(gr===C);else if(gr===p)Ue()
else if(gr===x)be(t&&t.keep_preview)
else if(gr===D)Me()
yr=gr}function logEventDeviceInfo(){var e={}
e.aa=te.aa
e.rs=te.render_scale
e.vwd=Qt.view_dist
e.bev=$t.bevel_value
e.fov=te.fov
e.vendor_unmasked="unavailable"
e.renderer_unmasked="unavailable"
var t=gl.getExtension("WEBGL_debug_renderer_info")
if(t){e.vendor_unmasked=gl.getParameter(t.UNMASKED_VENDOR_WEBGL)
e.renderer_unmasked=gl.getParameter(t.UNMASKED_RENDERER_WEBGL)}e.screen_width=window.screen.width
e.screen_height=window.screen.height
e.client_width=X.canvas.clientWidth
e.client_height=X.canvas.clientHeight
e.is_discrete_gpu=K}function startup(){G.loadUISprite("tab",[40,48,40],[256])
G.loadUISprite("tab_horiz",[40,48,40],[256])
G.sprites.tab_regular=G.sprites.tab
G.sprites.tab_inactive=G.sprites.button
G.sprites.tab_down=G.sprites.button_down
G.sprites.tab_inactive_down=G.sprites.button_down
G.loadUISprite("inv_down",[40,48,40],[256])
G.loadUISprite("inv_selected",[40,48,40],[256])
G.sprites.inv_selected_down=G.sprites.inv_down
G.loadUISprite("inv_active",[40,48,40],[256])
G.sprites.inv_active_down=G.sprites.inv_down
G.loadUISprite("inv_highlight",[40,48,40],[256])
G.sprites.inv_highlight_down=G.sprites.inv_down
G.loadUISprite("inv_customize",[40,48,40],[256])
G.sprites.inv_customize_down=G.sprites.inv_down
G.loadUISprite("inv_customize_empty",[40,48,40],[256])
G.sprites.inv_customize_empty_down=G.sprites.inv_down
G.loadUISprite("inv_empty",[40,48,40],[256])
G.sprites.inv_empty_down=G.sprites.inv_down
G.loadUISprite("inv_info",[40,48,40],[256])
G.loadUISprite("hint_panel",[40,48,40],[40,176,40])
G.loadUISprite("inv_disabled",[40,48,40],[256])
G.loadUISprite("section_border",[32,64,32],[32,192,32])
hr=Ft.sprite
pr=G.font
mr=G.title_font
Ge()
we()
or()
rt()
Ve()
logEventDeviceInfo()
Ne()
De()
_r()}function menuX1(){return Ke()}function menuY0(){return oe()}function menuY1(){return qe()}function menuInteractGetPos(){return Sr}var Rr=u()
function menuInteractGetProp(e){var t=Z.UI
var r=menuX1()
var a=menuY1()
var i=e&&e.ignore_distance||false
var o=e&&e.no_text||false
if(!Sr)return null
var n=gr===g?at.LBL_ENERGY_WELL:gr===m?at.LBL_WAYGATE:at.LBL_CONTAINER
var s=$t.getPropLocal(Sr)
if(!s||!s.interactDetails()){if(!o)pr.drawSizedAligned(Ut,0,0,t,2*G.font_height,pr.ALIGN.HVCENTERFIT,r,.75*a,at.$(at.ERR_PROP_MISSING,n))
return null}s.getLocalPos(Rr)
if(l(nt(),Rr)>Oe&&!i){if(!o)pr.drawSizedAligned(Ut,0,0,t,2*G.font_height,pr.ALIGN.HVCENTERFIT,r,.75*a,at.$(at.ERR_PROP_FAR_AWAY,n))
return null}return s}function onTokenGen(e){ie(at.DLG_GENERATE_TOKENS_TITLE,e.join("\n"))}function fscreenEnterAndOrient(){$()
pt.set(pt.LANDSCAPE)}var br
function lockMenuPageToDraw(){br=gr}function menuPanelX0(){var e=0
Ir=false
if(br===v||br===I||(br===m||br===E)&&(fr()||vr())){e+=oe()
if(Je())e-=20}return e}function prefixShortcutKey(e,t,r){var a=ee(t)
if(r||!J.touch_mode)return(a.startsWith(e)?at.FORMAT_INPUT_MERGE.$({key:e,command:a.substring(e.length)}):at.FORMAT_INPUT_PREPEND.$({key:e,command:a})).toLocalString()
return a}var Nr=50
var Cr=F(0,0,0,.05)
function gameModeWatermark(e,t,r){if(!ur())return
e=e||menuX1()
t=t||menuY1()
r=r||Z.UI+1
hr.draw({frame:Ft.WAYGATE,x:e-Nr,y:t-Nr,w:Nr,h:Nr,z:r,color:Cr})}function setMenuPageLayout(e){switch(e){case A:case w:case b:case P:case B:case k:case L:case O:case R:case N:case C:Xe()
break
default:Qe()}}function menuTabColors(e){return e?W:H}var xr=.7
var Mr=F(0,-100+U+8,0,0)
function tickMenu(){profilerStart("tickMenu")
if(!hasTabs())$e(Mr)
setMenuPageLayout(br)
var _=0
var c=0
var u
gameModeWatermark()
_+=oe()
function tabButton(e,t,r,a,i){if(isQuickMenu(br))return
var o=menuTabColors(u=br===e)
if(G.buttonImage({x:_,y:c,z:u?Z.UI:Z.UI-10,z_bias:u?null:{down:20},shrink:xr,img:hr,frame:t,colors:o,disabled:false,base_name:u?"tab":"tab_inactive",tooltip:r,tooltip_width:500,tooltip_above:true,drag_over:true,key:"menu_tab_button_"+e,hook:a})){d.page_open_frame=Tr=X.frame_index
yr=d.page=gr=e
menuPageStackPush(gr)
Ye()
xt()}if(i){var n=oe()
var s=n*xr
var l=s/2
Wt.sprite.draw({x:_+n-l-6,y:c+n-l-(n-s)/2,z:Z.UI+22,w:l,h:l,frame:i,color:o.regular})}_+=oe()}tabButton(f,Ft.INVENTORY,prefixShortcutKey("I",Yt()?at.LBL_CHARACTER:at.LBL_INVENTORY_CHARACTER))
if(!Yt()){if(!te.split_build)tabButton(v,Ft.BUILD,prefixShortcutKey("B",at.LBL_BUILD_BLUEPRINT),"new_build")
var e=menuInteractGetProp({no_text:true})
if(e){var t
if(e.isWaygate()&&(t=ar())){if(!te.split_waygate)tabButton(m,Ft.WAYGATE,t)}else if(e.isEnergyWell()){if(!te.split_waygate)tabButton(g,Ft.ENERGY_WELL,at.LBL_ENERGY_WELL)}else if(e.isFactory()){if(!te.split_factory)tabButton(p,Ft.CRAFTING,e.inv.getName())}else if(e.isContainer()){if(!te.split_container)tabButton(h,Ft.CONTAINER,at.LBL_CONTAINER)}else _+=oe()}else _+=oe()}_+=.5*oe()
tabButton(y,Ft.WORLD_INFO,prefixShortcutKey("O",at.LBL_WORLD_INFO))
tabButton(T,Ft.SOCIAL,prefixShortcutKey("P",at.LBL_SOCIAL),void 0,ht())
tabButton(S,Ft.SETTINGS,at.LBL_SETTINGS)
var r=c=menuY0()
var a=menuPanelX0()
Ir=false
ut("tickMenu:cp="+br+" before")
var i
switch(br){case f:He(c)
break
case I:i=at.LBL_QUICKSLOT
if(J.keyDownEdge(J.KEYS.Q,{in_event_cb:J.pointerLockEnter}))it.menuExitGeneric()
case v:Le()
i=i||at.LBL_BUILD_MENU
break
case h:i=We(c)
break
case p:i=ke(c)
break
case T:Pt(c)
break
case S:Ct(c)
break
case A:de(c)
i=_e()
break
case w:ge(c)
break
case b:At(c)
break
case P:Kt(c)
break
case B:i=Et(c)
break
case k:Se(c)
break
case y:case L:sr(c,br===y)
break
case m:i=tr(a)
break
case E:i=tr(a,true)
break
case O:i=rr()
break
case g:i=er(a)
break
case M:i=tt(a)
break
case R:i=Rt()
break
case N:i=bt()
break
case C:i=se()
break
case x:Ce()
break
case D:i=Pe()}ut("tickMenu:cp="+br+" after")
var o={x:a-U,y:r-U,w:menuX1()-a+2*U,h:menuY1()-r+2*U,color:Ir?Er:z}
if(i&&isQuickMenu(br)){var n=1.5*oe()
var s={x:o.x+n,y:o.y-oe()+16,z:Z.UI-5,w:o.w-2*n,h:oe()}
mr.drawSizedAligned(Gt,s.x+8,s.y,s.z+2,2*G.font_height,pr.ALIGN.HVCENTERFIT,s.w-16,s.h,i)
G.drawHBox(s,G.sprites.tab,z)}var l=false
if(!J.touch_mode)if(J.click({x:o.x,y:o.y,w:o.w,h:o.h,in_event_cb:it.omp?J.pointerLockEnter:void 0,button:2}))l=true
G.panel(o)
Ze()
profilerStop("tickMenu")
return l}function exitSpecificMenu(e){if(gr===e){it.menuExitGeneric()
d.page=gr=void 0}}ne.register({key:"blueprint",hides:{w:1,pos:1,wg:1},push:true,title:function title(e){j(e)
if(!he(e))return at.ERR_INVALID_BP_ID
var t=ve(e)
if(t.loaded||t.name)return at.$(at.PAGETITLE_BLUEPRINT,t.name)
return me()||at.$(at.PAGETITLE_BLUEPRINT,e)},change:function change(e){if(e)ct(w,e)
else exitSpecificMenu(w)}})
ne.route("blueprint/:blueprint")
ne.register({key:"photo",hides:{w:1,pos:1,wg:1},push:true,title:function title(e){j(e)
if(!wt(e))return at.ERR_INVALID_PHOTO_ID
return Lt()},change:function change(e){if(e)ct(b,e)
else exitSpecificMenu(b)}})
ne.route("photo/:photo")
ne.register({key:"u",hides:{w:1,pos:1,wg:1},push:true,title:function title(e){j(e)
switch(ne.get("action")){case"photos":return at.LBL_PHOTO_LIBRARY}if(!qt(e))return at.ERR_INVALID_USER_ID
return Zt()},change:function change(e){if(e)switch(ne.get("action")){case"go":break
case"photos":ct(B)
if("me"!==ne.get("u")){ne.set("u","me")
e="me"}break
default:ct(P,e)}else exitSpecificMenu(P)}})
ne.route("u/:u")
ne.register({key:"action"})
ne.route("u/:u/:action")
ne.register({key:"page",hides:{w:1,pos:1,wg:1},push:true,change:function change(){vt(ne.get("page"))}})
ne.route("page/:page")
ne.register({key:"type",push:false,hide_values:{default:1,undefined:1}})},{"../glov/client/browser":293,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/fscreen":317,"../glov/client/input":326,"../glov/client/localization":330,"../glov/client/settings":351,"../glov/client/transition":366,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/vmath":402,"./access_control":2,"./bluebox_ui":27,"./blueprint":28,"./blueprint_view":30,"./boost_view":31,"./build_menu":32,"./build_mode":33,"./character_customization":39,"./currency_shop":72,"./factory_ui":95,"./inventory_ui":115,"./item_info_view":117,"./layout":120,"./leapgate_ui":121,"./localization/localization":131,"./main":135,"./main_menu":136,"./orient":148,"./photo_library_view":155,"./photo_mode":158,"./photo_ui":159,"./prop_edit":170,"./race_results":173,"./settings_menu":180,"./social_menu":189,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./user_profile_view":212,"./voxel_chunk_manager":214,"./voxel_data":216,"./waygate_ui":222,"./world_info_view":231,"./world_metadata":235,assert:void 0}],141:[function(e,t,r){"use strict"
r.getMenuRibbonXOuter=getMenuRibbonXOuter
r.getMenuRibbonXInner=getMenuRibbonXInner
r.getMenuRibbonY0=getMenuRibbonY0
r.getMenuRibbonY1=getMenuRibbonY1
r.pushMenuRibbonElement=pushMenuRibbonElement
r.drawMenuRibbon=drawMenuRibbon
r.RIBBON_BOTTOM_MARGIN=r.RIBBON_TOP_MARGIN=void 0
var s=7
r.RIBBON_TOP_MARGIN=s
var a=10
r.RIBBON_BOTTOM_MARGIN=a
var l=e("../glov/client/camera2d")
var _=e("../glov/client/ui").uiButtonHeight
var i=e("./layout")
var c=i.CORNER_BUTTON_MARGIN
var u=i.QUICKBAR_PAD
var d=i.layoutTick
var f=i.menuUpperLeft
var v=i.pushViewportOffset
var o=i.quickbarOnLeft
var n=i.quickbarOnRight
var h=i.quickbarOnTop
var p=e("./main").isQuickbarVisible
var m=e("./quickbar")
var E=m.quickbarX0
var g=m.quickbarX1
var T=m.quickbarY1
function getMenuRibbonXOuter(){if(f())return p()&&o()?g()+c:c
return p()&&n()?E()-c:l.w()}var y
function getMenuRibbonXInner(){return getMenuRibbonXOuter()+(f()?y:-y)}var S=0
function getMenuRibbonY0(){return S}var I=0
function getMenuRibbonY1(){return I}var A=[]
function pushMenuRibbonElement(e){A.push(e)}var w=3
var L=[0,0,0,0]
function drawMenuRibbon(){for(var e=y=0;e<A.length;++e){var t=A[e]
if(!t.will_draw_cb||t.will_draw_cb())y+=t.w+c}var r=getMenuRibbonXOuter()
var a
if(p()&&h()&&(f()||l.x1()-g()<y)){a=T()+w
L[1]=_()-u
v(L)
d(true)}else a=s
I=(S=a)+_()
for(var i=0;i<A.length;++i){var o=A[i]
var n=!o.will_draw_cb||o.will_draw_cb()
if(n&&!f())r-=o.w+c
o.cb(r,a)
if(n&&f())r+=o.w+c}A.length=0}},{"../glov/client/camera2d":295,"../glov/client/ui":367,"./layout":120,"./main":135,"./quickbar":172}],142:[function(e,t,r){"use strict"
r.meshCalcReset=meshCalcReset
r.meshCalcBakeRules=meshCalcBakeRules
r.meshCalcMaxPropsPerChunk=meshCalcMaxPropsPerChunk
r.meshCalcSetBakingMeshGetter=meshCalcSetBakingMeshGetter
r.bakedKeySame=bakedKeySame
r.meshCalcShadowBuf=meshCalcShadowBuf
r.generateSimpleLODMesh=generateSimpleLODMesh
r.meshCalc=meshCalc
r.BYTES_PER_QUAD=r.BYTES_PER_VERT=void 0
var Ea=e("assert")
var a=e("../glov/common/vmath")
var A=a.unit_vec
var f=a.v3addScale
var w=a.v3copy
var E=a.v3dot
var L=a.v3iAdd
var g=a.v3iNormalize
var ga=a.v3lerp
var v=a.v3scale
var Ta=a.v3set
var O=a.v3sub
var ya=a.v4copy
var Sa=a.v4set
var l=a.vec3
var i=e("../common/globals")
var o=i.CHUNK_SIZE
var n=i.ID2
var Ia=i.ID_FACTOR
var s=e("./light_calc")
var Aa=s.lightCalc
var _=s.lightCalcBakeRules
var c=s.lightCalcReset
var wa=s.sun_table
var La=s.torch_table
var u=e("./tiles")
var Oa=u.TILE_INTANGIBLE
var Ra=u.TILE_PASSABLE_LEAVES
var ba=u.TILE_PROP_BASE
var Na=u.TILE_PROP_MAX
var Ca=u.TILE_STONE
var xa=u.TILE_TINT_ORE
var d=u.setUnreleasedTiles
var Ma=u.tile_map_liquids
var h=Math.abs,p=Math.ceil,Da=Math.max,Pa=Math.min,T=Math.sqrt
Ea(wa&&La)
var Ba
var ka
var Ua=1+Ia+n
var Ga=16
var Fa=4*(r.BYTES_PER_VERT=Ga)
r.BYTES_PER_QUAD=Fa
var Wa
function meshCalcReset(e,t){c(Wa=e,t)}var Ha={}
var m={}
function meshCalcBakeRules(e){d()
for(var t in e){Ha[t]=e[t]
m[t]=false}_(Ha)}var za
function meshCalcMaxPropsPerChunk(e){za=e}var Va=null
var Ya=0
var y=0
function geomBufAddQuad(e){var t=Ya+e*Fa
if(t>y){var r=Da(t,p(1.5*y),1024)
var a=new Uint8Array(r)
for(var i=0;i<Ya;++i)a[i]=Va[i]
Va=a
y=r}return Va}var ja=null
var Ka=0
var S=0
function geomBufAlphaAddQuad(e){var t=Ka+e*Fa
if(t>S){var r=Da(t,p(1.5*S),1024)
var a=new Uint8Array(r)
for(var i=0;i<Ka;++i)a[i]=ja[i]
ja=a
S=r}return ja}var qa=null
var Za=0
var I=0
function geomBufLODAddQuad(e){var t=Za+e*Fa
if(t>I){var r=Da(t,p(1.5*I),1024)
var a=new Uint8Array(r)
for(var i=0;i<Za;++i)a[i]=qa[i]
qa=a
I=r}return qa}var R=Int8Array
var b=[new R([0,0,1]),new R([0,0,-1]),new R([0,1,0]),new R([0,-1,0]),new R([1,0,0]),new R([-1,0,0])]
var Xa=new R([1,-1,1,-1,1,-1])
var Qa=[new R([2,0,1]),new R([2,0,1]),new R([1,0,2]),new R([1,0,2]),new R([0,1,2]),new R([0,1,2])]
var $a=new R([0,1,1,0,0,0,1,8,1,0,1,16,1,1,1,24,1,1,0,1,1,0,0,9,0,0,0,17,0,1,0,25,1,1,1,2,1,1,0,10,0,1,0,18,0,1,1,26,0,0,1,3,0,0,0,11,1,0,0,19,1,0,1,27,1,0,1,4,1,0,0,12,1,1,0,20,1,1,1,28,0,1,1,5,0,1,0,13,0,0,0,21,0,0,1,29])
var Ja=new R([0,1,1,0,0,1,1,0,1,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,0,0,1,1,0,0,1,0,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,1,0,1,1,1,0,1,1,0,1,0,0,0,0,0,0,1])
var ei=function(){var e=function(){var e=0
var t=[]
for(var r=0;r<6;++r){var a=new R(3)
a[0]=$a[e+4]-$a[e++]
a[1]=$a[e+4]-$a[e++]
a[2]=$a[e+4]-$a[e++]
e++
var i=new R(3)
i[0]=$a[e+4]-$a[e++]
i[1]=$a[e+4]-$a[e++]
i[2]=$a[e+4]-$a[e++]
e+=9
t.push([a,i])}return t}()
var t=new R([-1,-1,1,-1,1,1,-1,1])
var r=new R(3)
function deltaToIdx(e){Ea(e[0]>=-1&&e[0]<=1)
Ea(e[1]>=-1&&e[1]<=1)
Ea(e[2]>=-1&&e[2]<=1)
return e[0]+1+3*(e[1]+1)+9*(e[2]+1)}function deltaToFace(e){Ea(h(e[0])+h(e[1])+h(e[2])===1)
if(e[2])return e[2]>0?0:1
if(e[1])return e[1]>0?2:3
return e[0]>0?4:5}var a=new R(216)
var i=0
for(var o=0;o<6;++o){var n=b[o]
var s=e[o]
var l=s[0]
var _=s[1]
for(var c=0;c<4;++c){var u=t[2*c]
var d=t[2*c+1]
a[i++]=deltaToFace(v(r,l,u))
a[i++]=deltaToFace(v(r,_,d))
a[i++]=deltaToIdx(n)
a[i++]=deltaToIdx(f(r,n,l,u))
a[i++]=deltaToIdx(f(r,n,_,d))
a[i++]=deltaToIdx(f(r,f(r,n,_,d),l,u))
a[i++]=deltaToIdx(v(r,l,u))
a[i++]=deltaToIdx(v(r,_,d))
a[i++]=deltaToIdx(f(r,v(r,_,d),l,u))}}Ea.equal(i,a.length)
return a}()
var ti=[145,50,100,200]
var ri=[19,137,76,38]
var ai=new R([12,16,14,10,14,16,12,10,14,22,12,4,12,22,14,4,10,22,16,4,16,22,10,4])
var ii=new R([21,25,23,19,5,7,3,1,17,25,15,7,9,19,11,1,11,23,17,5,15,21,9,3])
var oi=new R([15,17,11,9,17,15,9,11,23,21,3,5,21,23,5,3,19,25,7,1,25,19,1,7])
var ni=new R([24,26,20,18,8,6,0,2,26,24,6,8,18,20,2,0,20,26,8,2,24,18,0,6])
var si=[new R([-1,-1,-1]),new R([0,-1,-1]),new R([1,-1,-1]),new R([-1,0,-1]),new R([0,0,-1]),new R([1,0,-1]),new R([-1,1,-1]),new R([0,1,-1]),new R([1,1,-1]),new R([-1,-1,0]),new R([0,-1,0]),new R([1,-1,0]),new R([-1,0,0]),new R([0,0,0]),new R([1,0,0]),new R([-1,1,0]),new R([0,1,0]),new R([1,1,0]),new R([-1,-1,1]),new R([0,-1,1]),new R([1,-1,1]),new R([-1,0,1]),new R([0,0,1]),new R([1,0,1]),new R([-1,1,1]),new R([0,1,1]),new R([1,1,1])]
var N=[new R([-1,-1,-1]),new R([1,-1,-1]),new R([-1,1,-1]),new R([1,1,-1]),new R([-1,-1,1]),new R([1,-1,1]),new R([-1,1,1]),new R([1,1,1])]
var li=[new R([-1,-1,-1]),new R([0,-1,-1]),new R([-1,0,-1]),new R([0,0,-1]),new R([-1,-1,0]),new R([0,-1,0]),new R([-1,0,0]),new R([0,0,0])]
var C=.25
var _i=[new Float32Array([0,0,C,.9]),new Float32Array([0,0,-C,.9]),new Float32Array([0,C,0,1]),new Float32Array([0,-C,0,1]),new Float32Array([C,0,0,.95]),new Float32Array([-C,0,0,.95])]
var x=new R([4,7,5,6,0,3,1,2,2,7,3,6,0,5,1,4,1,7,3,5,0,6,2,4])
var ci=new R(3)
var ui=new R(3)
var di=new Uint8Array(4)
var fi=new Uint8Array(4)
var vi=new Uint8Array(4)
var hi=new Uint8Array(4)
var pi=new Uint8Array(4)
var mi=new Uint8Array(4)
var Ei=new Array(3)
var gi=new Array(3)
var Ti=new Array(3)
var yi=new Array(3)
var Si=new Array(3)
var Ii=new Array(3)
var Ai
var wi
var Li
var Oi
for(var M=0;M<=2;++M){Ei[M]=new Array(3)
gi[M]=new Array(3)
Ti[M]=new Array(3)
yi[M]=new Array(3)
Si[M]=new Array(3)
Ii[M]=new Array(3)
for(var D=0;D<=2;++D){Ei[M][D]=new Array(3)
gi[M][D]=new Array(3)
Ti[M][D]=new Array(3)
yi[M][D]=new Array(3)
Si[M][D]=new Array(3)
Ii[M][D]=new Array(3)}}function neighborGet(e){if(!(240&(e[0]|e[1]|e[2])))return wi[256*e[2]+16*e[1]+e[0]]
var t=e[0]
var r=e[1]
var a=e[2]
var i=Ei[1]
if(a<0){i=Ei[0]
a+=16}else if(a>=16){i=Ei[2]
a-=16}var o=i[1]
if(r<0){o=i[0]
r+=16}else if(r>=16){o=i[2]
r-=16}var n=o[1]
if(t<0){n=o[0]
t+=16}else if(t>=16){n=o[2]
t-=16}if(!n)return 0
return n[256*a+16*r+t]}function neighborGetLiquidFirst(e){var t=e[0]
var r=e[1]
var a=e[2]
var i=256*a+16*r+t
if(!(240&(t|r|a)))return Li[i]||(void 0===wi?0:wi&&wi[i])
var o=a<0?0:a<16?1:2
var n=r<0?0:r<16?1:2
var s=t<0?0:t<16?1:2
Ea((i-=4096*(o-1)+256*(n-1)+16*(s-1))>=0&&i<4096)
var l=Ei[o][n][s]
var _=gi[o][n][s]
if(void 0===l)return 0
return _&&_[i]||l&&l[i]}function neighborGetLight(e,t){if(!(240&(t[0]|t[1]|t[2])))return e.default?e.default[256*t[2]+16*t[1]+t[0]]:0
var r=t[0]
var a=t[1]
var i=t[2]
var o
if(i<0){o=0
i+=16}else if(i>=16){o=2
i-=16}else o=1
var n=e[o]
var s=Ii[o]
o=1
if(a<0){o=0
a+=16}else if(a>=16){o=2
a-=16}else o=1
var l=n[o]
var _=s[o]
if(r<0){o=0
r+=16}else if(r>=16){o=2
r-=16}else o=1
var c=l[o]
if(!c)return 0
_[o]=1
return c[256*i+16*a+r]}var Ri=[0,0,0,0,257,0]
var bi=[0,0,0,0,0,0]
var Ni
function neighborGetUnchunked(e){var t
if(e[0]<0)t=t||Ni[0]
if(e[0]>=Ai.size[0])t=t||Ni[1]
if(e[1]<0)t=t||Ni[2]
if(e[1]>=Ai.size[1])t=t||Ni[3]
if(e[2]<0)t=t||Ni[4]
if(e[2]>=Ai.size[2])t=t||Ni[5]
if(void 0!==t)return t
return Ai.data[e[2]*Ai.stride2+e[1]*Ai.stride1+e[0]]}function neighborGetUnchunkedLiquidFirst(e){if(e[0]<0||e[0]>=Ai.size[0]||e[1]<0||e[1]>=Ai.size[1]||e[2]<0||e[2]>=Ai.size[2])return 0
return Ai.liquid[e[2]*Ai.stride2+e[1]*Ai.stride1+e[0]]||Ai.data&&neighborGetUnchunked(e)||0}var Ci
var P=new R(3)
function neighborGetDelta(e){P[0]=ci[0]+e[0]
P[1]=ci[1]+e[1]
P[2]=ci[2]+e[2]
return Ci(P)}function neighborGetDeltaVisible(e){var t=neighborGetDelta(e)
return t&&t<ka}function neighborGetLightDelta(e,t){P[0]=ci[0]+t[0]
P[1]=ci[1]+t[1]
P[2]=ci[2]+t[2]
return neighborGetLight(e,P)}function neighborGetProp(e){if(!(240&(e[0]|e[1]|e[2])))return Oi[256*e[2]+16*e[1]+e[0]]
var t=e[0]
var r=e[1]
var a=e[2]
var i=Ti[1]
if(a<0){i=Ti[0]
a+=16}else if(a>=16){i=Ti[2]
a-=16}var o=i[1]
if(r<0){o=i[0]
r+=16}else if(r>=16){o=i[2]
r-=16}var n=o[1]
if(t<0){n=o[0]
t+=16}else if(t>=16){n=o[2]
t-=16}Ea(n)
return n[256*a+16*r+t]}var B=new R(3)
function neighborAndGetProp(e){var t=e-ba
for(var r=t;r>=0;--r){B[2]=P[2]-r
for(var a=t-r;a>=0;--a){B[1]=P[1]-a
var i=t-r-a
B[0]=P[0]-i
var o=neighborGetProp(B)
if(o&&o.size[0]>i&&o.size[1]>a&&o.size[2]>r)return o}}return null}var xi=function(){var e=[[0,0,1],[0,1,0],[1,0,0]]
var n=[]
var t=new R(3)
for(var r=0;r<N.length;++r){var a=N[r]
var i=n[r]=[]
for(var o=0;o<b.length;++o){var s=b[o]
var l=[]
P[0]=a[0]>0?0:-1
P[1]=a[1]>0?0:-1
P[2]=a[2]>0?0:-1
l.push(P.slice(0))
for(var _=0;_<e.length;++_){var c=e[_]
t[0]=P[0]+a[0]*c[0]
t[1]=P[1]+a[1]*c[1]
t[2]=P[2]+a[2]*c[2]
var u=t.slice(0)
u.wt=.5
if(s[0]&&c[0]||s[1]&&c[1]||s[2]&&c[2])u.wt=3
l.push(u)}l.sort(function(e,t){return e.wt-t.wt})
var d=new Array(3*l.length)
var f=0
d[f++]=l[0][0]
d[f++]=l[0][1]
d[f++]=l[0][2]
var v=l[0]
for(var h=1;h<l.length;++h){d[f++]=l[h][0]-v[0]
d[f++]=l[h][1]-v[1]
d[f++]=l[h][2]-v[2]
v=l[h]}i[o]=d}}return function getAOOctantSum2Fn(e,t,r){var a=n[t][r]
P[0]=e[0]+a[0]
P[1]=e[1]+a[1]
P[2]=e[2]+a[2]
var i=0
var o=Ci(P)
if(o){if(o<Ba)return 1
i+=.2}P[0]+=a[3]
P[1]+=a[4]
P[2]+=a[5]
if(o=Ci(P))i+=o>=Ba?.05:.1
P[0]+=a[6]
P[1]+=a[7]
P[2]+=a[8]
if(o=Ci(P))i+=o>=Ba?.05:.1
P[0]+=a[9]
P[1]+=a[10]
P[2]+=a[11]
if(o=Ci(P))i+=o>=Ba?.3:.6
return i}}()
var Mi=function(){var h=[]
function init(_){var c=new Int32Array(3)
var u=new Int32Array(3)
var d=l()
var f=l()
var v=l()
function calcRay(e,t,r){Ta(v,e,t,r)
g(v)
var a=[]
a.dir=v.slice(0)
var i=_
Ta(c,0,0,0)
for(var o=0;o<3;++o)if(!v[o]){u[o]=0
d[o]=i+1}else if(v[o]<0){u[o]=-1
d[o]=c[o]/v[o]
f[o]=-1/v[o]}else{d[o]=(c[o]+1)/v[o]
u[o]=1
f[o]=1/v[o]}var n=0
do{var s=d[0]<d[1]?0:1
if(d[2]<d[s])s=2
if(d[s]>i)break
n=d[s]
c[s]+=u[s]
d[s]+=f[s]
var l=1-n/i
a.push([c[0],c[1],c[2],1-(1-l)*(1-l)])}while(true)
return a}function pointsOnSphere(e){var t=[]
var r=Math.PI*(3-T(5))
var a=2/e
for(var i=0;i<e;++i){var o=i*a-1+a/2
var n=T(1-o*o)
var s=i*r
t.push(l(Math.cos(s)*n,o,Math.sin(s)*n))}return t}h=pointsOnSphere(80).filter(function(e){return e[0]>=0&&e[1]>=0&&e[2]>=0}).map(function(e){return calcRay(e[0],e[1],e[2])})}init(3)
function findChild(e,t){for(var r=0;r<e.children.length;++r){var a=e.children[r].pos
if(a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2])return e.children[r]}var i={pos:new R(t),value:0,children:[]}
e.children.push(i)
return i}var v=new R(3)
var p=new R(3)
function buildTree(e,t){var r=b[t]
var a=N[e]
p[0]=a[0]>0?0:-1
p[1]=a[1]>0?0:-1
p[2]=a[2]>0?0:-1
var i=0
for(var o=0;o<h.length;++o){var n=h[o]
i+=Math.abs(E(n.dir,r))}var s={pos:new R(p),value:0,children:[]}
for(var l=0;l<h.length;++l){var _=h[l]
var c=1/(_.length+1)*Math.abs(E(_.dir,r))/i
var u=s
u.value+=c
for(var d=0;d<_.length;++d){var f=_[d]
v[0]=p[0]+a[0]*f[0]
v[1]=p[1]+a[1]*f[1]
v[2]=p[2]+a[2]*f[2];(u=findChild(u,v)).value+=c}}return s}var a=[]
for(var e=0;e<b.length;++e){a[e]=[]
for(var t=0;t<N.length;++t)a[e][t]=buildTree(t,e)}var i
function traverse(e,t){v[0]=t[0]+e.pos[0]
v[1]=t[1]+e.pos[1]
v[2]=t[2]+e.pos[2]
var r=Ci(v)
if(r){if(r<Ba)return}else i+=e.value
for(var a=0;a<e.children.length;++a)traverse(e.children[a],t)}return function getAOOctantRayCast3Fn(e,t,r){i=0
traverse(a[r][t],e)
return 1-i}}()
var Di=function(){var p=[]
var e=0
function init(_){if(_===e)return
e=_
var c=new Int32Array(3)
var u=new Int32Array(3)
var d=l()
var f=l()
var v=l()
function calcRay(e,t,r){Ta(v,e,t,r)
g(v)
var a=[]
a.dir=v.slice(0)
var i=_
Ta(c,0,0,0)
for(var o=0;o<3;++o)if(!v[o]){u[o]=0
d[o]=i+1}else if(v[o]<0){u[o]=-1
d[o]=c[o]/v[o]
f[o]=-1/v[o]}else{d[o]=(c[o]+1)/v[o]
u[o]=1
f[o]=1/v[o]}var n=0
do{var s=d[0]<d[1]?0:1
if(d[2]<d[s])s=2
if(d[s]>i)break
n=d[s]
c[s]+=u[s]
d[s]+=f[s]
var l=1-n/i
a.push([c[0],c[1],c[2],1-(1-l)*(1-l)])}while(true)
return a}function pointsOnSphere(e){var t=[]
var r=Math.PI*(3-T(5))
var a=2/e
for(var i=0;i<e;++i){var o=i*a-1+a/2
var n=T(1-o*o)
var s=i*r
t.push(l(Math.cos(s)*n,o,Math.sin(s)*n))}return t}p=pointsOnSphere(80).filter(function(e){return e[0]>=0&&e[1]>=0&&e[2]>=0}).map(function(e){return calcRay(e[0],e[1],e[2])})}var m=new R(3)
return function getAOOctantRayCastFn(e,t,r,a){init(Da(e,3))
var i=b[a]
var o=N[r]
P[0]=t[0]+(o[0]>0?0:-1)
P[1]=t[1]+(o[1]>0?0:-1)
P[2]=t[2]+(o[2]>0?0:-1)
var n=Ci(P)
var s=1
if(n){if(n<Ba)return 1
s=0}var l=0
var _=0
for(var c=0;c<p.length;++c){var u=p[c]
var d=Math.abs(E(u.dir,i))
_+=d
var f=s
for(var v=0;v<u.length;++v){var h=u[v]
m[0]=P[0]+o[0]*h[0]
m[1]=P[1]+o[1]*h[1]
m[2]=P[2]+o[2]*h[2]
if(n=Ci(m)){if(n<Ba)break}else++f}if(0){if(f===u.length)l+=d}else l+=f/(u.length+1)*d}return 1-l/_}}()
var Pi=[[[0,0,1,0],[0,0,0,1],[0,1,2,3,4,5],[0,1,2,3]],[[0,1,0,-1],[0,0,1,0],[0,1,5,4,2,3],[1,2,3,0]],[[1,0,-1,0],[0,1,0,-1],[0,1,3,2,5,4],[2,3,0,1]],[[0,0,0,1],[1,0,-1,0],[0,1,4,5,3,2],[3,0,1,2]]]
for(var k=0;k<Pi.length;++k){var U=Pi[k][3]
for(var G=0;G<4;++G)U[G<<3]=U[G]<<3}var F
function meshCalcSetBakingMeshGetter(e){F=e}var W={}
function bakedKeyCName(e){var t=W[e]
if(!t){t=e.split(/[-,]/)[0]
W[e]=t}return t}function bakedKeySame(e,t){if(!e||!t)return false
return bakedKeyCName(e)===bakedKeyCName(t)}var Bi=new R(3)
var ki=7
var Ui=new Uint32Array(o*o*10*ki)
var Gi=new Uint8Array(Ui.buffer)
var Fi=l()
var Wi=l()
var Hi=new R(3)
var zi=new Uint8Array(o*o*o)
var Vi=new Uint8Array(o*o*o)
Vi.fill(255)
var Yi=new Array(8)
var ji=[0,0,0,0,0,0,0]
var Ki=[0,0,0,0,0,0,0]
var qi=[true,true,true,false,false,false,false]
var Zi=new Array(7)
var Xi={}
var Qi=new Uint8Array(172260)
var $i
var Ji
var eo
function aoFromCache(e){var t=Ji+e*eo
var r=Qi[t]
if(1!==r)return r
var a=4*e
var i=$i(Hi,x[a++],e)
var o=$i(Hi,x[a++],e)
var n=$i(Hi,x[a++],e)
var s=$i(Hi,x[a++],e)
var l=Pa(i,o)
var _=Pa(n,s)
i=Da(i,_)
o=Da(o,_)
n=Da(n,l)
s=Da(s,l)
var c=Da(0,4-(i+n+o+s))/4*255|0
if(1===c)c=0
return Qi[t]=c}function meshCalcInternal(e,t,r){profilerStart("meshCalcInternal")
t.ver_meshing=e.ver_meshing
var a=(r=r||{}).ao||0
var i=r.lighting||0
var o=La
var n=wa
var s=false
if(2===i){a=0
s=true}var l=r,_=l.not_world,c=l.skip_greedy_meshing,u=l.need_offs
if(!i){if(_)Sa(vi,255,255,255,255)
else Sa(vi,0,0,0,0)
Sa(fi,255,255,255,255)
ya(mi,vi)
ya(pi,fi)}if(!a){Sa(di,255,255,255,255)
ya(hi,di)}var d=r.liquid
var f=d?Ma:e.tile_map
var v=f.alpha_map||Xi
var h=f.doublesided_map||Xi
var p=f.tile_rate||Xi
var m=f.tint_map||Xi
var E=r.tint_colors||f.tint_colors||Xi
var g=[]
var T=[]
var y=f.tile_override||null
ka=f.tile_invisible
Ba=f.tile_non_opaque
Ea(ka&&Ba)
if(_){Oi=(Ai=e).baked_props||Xi
if(d)Ci=neighborGetUnchunkedLiquidFirst
else Ci=neighborGetUnchunked
if(r.over_tile)Ni=r.over_tile
else if(r.ground)Ni=Ri
else Ni=bi}else{wi=e.data
if(d){Li=e.liquid
Ci=neighborGetLiquidFirst}else{Oi=e.baked_props||Xi
Ci=neighborGet}var S=e.full
var I=e.chunk_id-Ua
for(var A=0;A<=2;++A)for(var w=0;w<=2;++w){var L=I+(A*Ia+w)*Ia
for(var O=0;O<=2;++O,++L){var R=Wa[L]
if(R){S=S&&R.full
Ei[A][w][O]=R.data
if(d)gi[A][w][O]=R.liquid
else Ti[A][w][O]=R.baked_props||Xi}else{Ei[A][w][O]=void 0
if(d)gi[A][w][O]=void 0
else Ti[A][w][O]=Xi}}}if(S)return void profilerStop("meshCalcInternal")
if(i){if(!r.did_lighting){r.did_lighting=true
Aa(e)}yi.default=e.light_sun
Si.default=e.light_torch
for(var b=0;b<=2;++b)for(var N=0;N<=2;++N)for(var C=0;C<=2;++C){var x=Wa[e.chunk_id+(b*Ia+N)*Ia+C-Ua]
yi[b][N][C]=x&&x.light_sun
Si[b][N][C]=x&&x.light_torch
Ii[b][N][C]=0}}}Za=Ka=Ya=0
var M=e.size
var D=Da(M[0]*M[1],Da(M[1]*M[2],M[0]*M[2]))
Ea(Ui.length>=D*ki)
var P=Gi
var B=Ui
B.fill(0)
var k
$i=a<=2?xi:3===a?Mi:Di.bind(null,a)
var U=M[0]+1
var G=U*(M[1]+1)
eo=G*(M[2]+1)
if(a){var F=6*eo
if(Qi.length<F){console.warn("Resizing ao_cache to "+F+", update initial size")
Qi=new Uint8Array(F)}Qi.fill(1)}var W=r.for_baking||r.noscale?1:7
var H=r.sway
var z=u?7:0
var V
var Y=[]
if(!d)if(e.baked_props){var j=i?e.light_sun||zi:Vi
Ea(void 0!==za)
var K=za
for(var q in e.baked_props){var Z=e.baked_props[q]
if(!Z.key)continue
q=Number(q)
var X=Ha[Z.key]
if(!X)Ea(X,'Missing baked ruleset for "'+Z.key+'" ('+Object.keys(Ha).length+" found)")
var Q=15&q
var $=(240&q)>>4
var J=q>>8
Ta(ci,Q,$,J)
var ee=void 0
var te=X.rules
for(var re=0;re<te.length;++re){var ae=true
if((ee=te[re]).same)for(var ie=0;ae&&ie<ee.same.length;++ie){var oe=neighborGetDelta(ee.same[ie])
if(oe&&oe>=ba&&oe<=Na){var ne=neighborAndGetProp(oe)
if(!ne||!bakedKeySame(ne.key,Z.key))ae=false}else ae=false}if(ee.tangible)for(var se=0;ae&&se<ee.tangible.length;++se){var le=neighborGetDelta(ee.tangible[se])
if(!le)ae=false
else if(le>=Oa)if(le>=ba&&le<=Na){var _e=neighborAndGetProp(le)
if(!_e)ae=false
else if(!_e.tangible)ae=false
else if(ee.tangible_not_same&&bakedKeySame(_e.key,Z.key))ae=false}else ae=false}if(ee.intangible)for(var ce=0;ae&&ce<ee.intangible.length;++ce){var ue=neighborGetDelta(ee.intangible[ce])
if(ue)if(ue>=Oa){if(ue>=ba&&ue<=Na){var de=neighborAndGetProp(ue)
if(de&&de.tangible)ae=false}}else ae=false}if(ee.empty)for(var fe=0;ae&&fe<ee.empty.length;++fe)if(neighborGetDelta(ee.empty[fe]))ae=false
if(ee.period)if(Q%ee.period[0]^$%ee.period[1]^J%ee.period[2])ae=false
if(ae)break}if(!ee)continue
var ve=ee.data.meshing
Ea(ve)
if(--K<0){var he=Pa(Q+Z.size[0],M[0])
var pe=Pa($+Z.size[1],M[1])
var me=Pa(J+Z.size[2],M[2])
for(var Ee=J;Ee<me;++Ee)for(var ge=$;ge<pe;++ge)for(var Te=Q;Te<he;++Te){var ye=(Ee*M[1]+ge)*M[0]+Te
Y.push(ye,e.data[ye])
e.data[ye]=Z.tangible?Ca:Ra}continue}var Se=n[j[q]]
var Ie=ve.bake_offset
var Ae=X.size
var we=(void 0===ee.rot?Z.rot:ee.rot)||0
var Le=Pi[we]
var Oe=Le[0]
var Re=Le[1]
var be=Le[2]
var Ne=Le[3]
var Ce=7*(Q+Oe[0]*Ae[0]+Oe[1]*Ae[1])
var xe=7*($+Re[0]*Ae[0]+Re[1]*Ae[1])
var Me=7*J
for(var De=0;De<8;++De){Ta(ci,Q+(1&De?Z.size[0]:0),$+(2&De?Z.size[1]:0),J+(4&De?Z.size[2]:0))
var Pe=V=0
for(var Be=0;Be<8;++Be){var ke=li[Be]
var Ue=neighborGetDelta(ke)
if(!Ue||Ue>=Ba){V+=o[neighborGetLightDelta(Si,ke)]
Pe++}}if(!Pe)Pe=1
Yi[De]=V/Pe}Ea(!ve.alpha)
for(var Ge=0;Ge<2;++Ge){var Fe=Ge?ve.lod_data:ve.data
Ea(Fe)
var We=Fe.length/Fa
var He=Ge?geomBufLODAddQuad(We):geomBufAddQuad(We)
var ze=0
var Ve=Ge?Za:Ya
for(var Ye=0;Ye<We;++Ye)for(var je=0;je<4;++je){var Ke=Fe[ze++]+Ie[0]
var qe=Fe[ze++]+Ie[1]
var Ze=Fe[ze++]+Ie[2]
var Xe=Ce+Oe[2]*Ke+Oe[3]*qe
var Qe=xe+Re[2]*Ke+Re[3]*qe
He[Ve++]=Xe+z
He[Ve++]=Qe+z
He[Ve++]=Me+Ze+z
var $e=Fe[ze++]
var Je=Fe[ze++]
var et=be[7&Je]
if(et<2){var tt=240&$e
$e=15&($e<<4-we|(15&$e)>>we)
$e|=240&((240&tt)<<4-we|tt>>we)}He[Ve++]=$e
Je=-8&Je|et
if(et<2)Je=-25&Je|Ne[24&Je]
He[Ve++]=Je
He[Ve++]=Fe[ze++]
He[Ve++]=Fe[ze++]
var rt=_i[et]
var at=(Xe-7*Q)/(7*Z.size[0])
var it=(Qe-7*$)/(7*Z.size[1])
var ot=Ze/(7*Z.size[2])
var nt=Pa(1,Da(0,rt[0]+at))
var st=Pa(1,Da(0,rt[1]+it))
var lt=Pa(1,Da(0,rt[2]+ot))
var _t=(1-st)*((1-nt)*Yi[0]+nt*Yi[1])+st*((1-nt)*Yi[2]+nt*Yi[3])
var ct=(1-st)*((1-nt)*Yi[4]+nt*Yi[5])+st*((1-nt)*Yi[6]+nt*Yi[7])
He[Ve++]=((1-lt)*_t+lt*ct)*rt[3]
ze++
He[Ve++]=Fe[ze++]
He[Ve++]=Fe[ze++]
He[Ve++]=Fe[ze++]
He[Ve++]=Se
ze++
He[Ve++]=Fe[ze++]
He[Ve++]=Se
ze++
var ut=Pa(1,Da(0,at))
var dt=Pa(1,Da(0,it))
var ft=Pa(1,Da(0,ot))
var vt=(1-dt)*((1-ut)*Yi[0]+ut*Yi[1])+dt*((1-ut)*Yi[2]+ut*Yi[3])
var ht=(1-dt)*((1-ut)*Yi[4]+ut*Yi[5])+dt*((1-ut)*Yi[6]+ut*Yi[7])
He[Ve++]=(1-ft)*vt+ft*ht
ze++
He[Ve++]=Fe[ze++]}Ea.equal(ze,Fe.length)
if(Ge)Za=Ve
else Ya=Ve}}}var pt=Ya
var mt
var Et
var gt
var Tt
var yt
for(var St=0;St<6;++St){var It=(k=Qa[St])[0]
var At=k[1]
var wt=k[2]
var Lt=M[k[0]]
var Ot=M[k[1]]
var Rt=M[k[2]]
var bt=Xa[St]
var Nt=bt
var Ct=Nt>0?0:Lt-1
var xt=Nt>0?Lt:-1
Bi[It]=1
for(ci[It]=Ct;ci[It]!==xt;ci[It]+=Nt){var Mt=-1
ui[It]=ci[It]+bt
for(var Dt=0,Pt=0;Pt<Ot;++Pt){ui[At]=ci[At]=Pt
for(var Bt=0;Bt<Rt;++Bt,Dt+=ki){ci[wt]=Bt
var kt=ci[2]*e.stride2+ci[1]*e.stride1+ci[0]
var Ut=void 0
if(d)Ut=e.liquid[kt]
else Ut=e.data[kt]
if(!Ut||Ut>=ka){B[Dt]=0
continue}ui[wt]=Bt
var Gt=Ci(ui)
if(Gt)if(Gt>=Ba);else{B[Dt]=0
continue}var Ft=f[Ut]
Ea(Ft)
if(Gt===Ut&&Ft.no_self){B[Dt]=0
continue}var Wt=Ft.def
if(Ft.face)Wt=Ft.face[St]||Wt
Mt=Dt/7
if(St>=2){if(Ft.above){ci[2]++
Gt=Ci(ci)
ci[2]--
if(Ft.above[Gt])Wt=Ft.above[Gt]}if(Ft.below){ci[2]--
Gt=Ci(ci)
ci[2]++
if(Ft.below[Gt])Wt=Ft.below[Gt]}}var Ht=4*Dt
P[Ht++]=Wt
var zt=4*St
var Vt=0
for(var Yt=0;Yt<4;++Yt)if(!neighborGetDeltaVisible(si[ai[zt+Yt]]))if(!neighborGetDeltaVisible(si[ii[zt+Yt]]))Vt|=ti[Yt]
var jt=240&Vt
Vt&=-241
for(var Kt=0;Kt<4;++Kt){var qt=16<<Kt
if(jt&qt)continue
if(!neighborGetDeltaVisible(si[ni[zt+Kt]]))if(!neighborGetDeltaVisible(si[oi[zt+Kt]]))Vt|=qt}P[Ht++]=Vt
if(a||i){var Zt=4*St*3
for(var Xt=0;Xt<4;++Xt){if(a){Hi[0]=ci[0]+Ja[Zt++]
Hi[1]=ci[1]+Ja[Zt++]
Hi[2]=ci[2]+Ja[Zt++]
Ji=Hi[0]+Hi[1]*U+Hi[2]*G
mt=aoFromCache(St)
P[Ht++]=mt}var Qt=Vt&ri[Xt]
var $t=Qt?7:i?4:0
var Jt=9*(4*St+Xt)
var er=ei[Jt++]
var tr=ei[Jt++]
for(var rr=0;rr<$t;++rr){if(rr>=3)qi[rr]=false
var ar=si[ei[Jt++]]
var ir=neighborGetDelta(ar)
if(!ir){Ki[rr]=ji[rr]=1
Zi[rr]=ar}else if(ir>=Ba)if(ir>=ba){Ki[rr]=ji[rr]=.5
Zi[rr]=ar}else if(ir>=ka){Ki[rr]=ji[rr]=1
Zi[rr]=ar}else{Ki[rr]=0
ji[rr]=1
Zi[rr]=ar}else Ki[rr]=ji[rr]=0}if(i){for(var or=yt=V=Tt=0;or<4;++or)if(3!==or||yt>1){var nr=ji[or]
if(nr){var sr=Zi[or]
Tt+=nr*n[neighborGetLightDelta(yi,sr)]
V+=nr*o[neighborGetLightDelta(Si,sr)]
yt++}}if(!yt)Ea(false)
if(s)yt=4
gt=V/yt
P[Ht++]=Et=Tt/yt
P[Ht++]=gt}if(Qt){var lr=Ki
if(lr[1]){qi[3]=true
qi[4]=true
if(lr[4])qi[6]=true}if(lr[2]){qi[3]=true
qi[5]=true
if(lr[5])qi[6]=true}if(qi[3]){if(lr[3])qi[6]=true
if(qi[6]&&lr[6])qi[4]=qi[5]=true}if(a){var _r=mt
var cr=1
if(lr[4]&&(lr[1]||lr[2]&&lr[5]&&lr[6])||!lr[5]&&lr[6]&&lr[2]&&lr[3]){_r+=aoFromCache(er)
cr++}if(lr[5]&&(lr[2]||lr[1]&&lr[4]&&lr[6])||!lr[4]&&lr[6]&&lr[1]&&lr[3]){_r+=aoFromCache(tr)
cr++}if(lr[5]&&lr[2]&&lr[3]&&(!lr[6]&&lr[1]||!lr[1]&&lr[6])){_r+=aoFromCache(1^er)
cr++}if(lr[4]&&lr[1]&&lr[3]&&(!lr[6]&&lr[2]||!lr[2]&&lr[6])){_r+=aoFromCache(1^tr)
cr++}P[Ht++]=Da(0,Pa(255,_r/cr|0))}if(i){if(qi[3])for(var ur=4;ur<7;++ur)if(qi[ur]){var dr=ji[ur]
if(dr){var fr=Zi[ur]
Tt+=dr*n[neighborGetLightDelta(yi,fr)]
V+=dr*o[neighborGetLightDelta(Si,fr)]
yt++}}P[Ht++]=Tt/yt
P[Ht++]=V/yt}}else{if(a)P[Ht++]=mt
if(i){P[Ht++]=Et
P[Ht++]=gt}}}}}}for(var vr=0;vr<=Mt;++vr){var hr=7*vr
var pr=B[hr]
if(!pr)continue
var mr=B[hr+1]
var Er=B[hr+2]
var gr=B[hr+3]
var Tr=B[hr+4]
var yr=B[hr+5]
var Sr=B[hr+6]
ci[At]=vr/Rt
ci[wt]=vr%Rt
var Ir=1
var Ar=1
var wr=Rt
var Lr=Rt-ci[wt]
var Or=Ot-ci[At]
for(var Rr=0;Rr<Or;++Rr){var br=vr+Rr*Rt
var Nr=7*br
var Cr=Nr+7*Pa(Lr,wr)
while(Nr<Cr&&B[Nr]===pr&&B[Nr+1]===mr&&B[Nr+2]===Er&&B[Nr+3]===gr&&B[Nr+4]===Tr&&B[Nr+5]===yr&&B[Nr+6]===Sr)Nr+=7
var xr=Nr/7-br
if(!xr)break
if((Rr+1)*xr>Ir*Ar){Ir=xr
Ar=Rr+1}wr=xr}if(c)Ir=Ar=1
for(var Mr=0;Mr<Ar;++Mr){var Dr=7*(vr+Mr*Rt)
for(var Pr=0;Pr<Ir;++Pr,Dr+=7)if(Mr||Pr)B[Dr]=0}Bi[At]=Ar
Bi[wt]=Ir
var Br=4*hr
var kr=P[Br++]
var Ur=P[Br++]
if(a&&i)for(var Gr=0;Gr<4;++Gr){di[Gr]=P[Br++]
fi[Gr]=P[Br++]
vi[Gr]=P[Br++]
hi[Gr]=P[Br++]
pi[Gr]=P[Br++]
mi[Gr]=P[Br++]}else if(a)for(var Fr=0;Fr<4;++Fr){di[Fr]=P[Br++]
hi[Fr]=P[Br++]}else if(i)for(var Wr=0;Wr<4;++Wr){fi[Wr]=P[Br++]
vi[Wr]=P[Br++]
pi[Wr]=P[Br++]
mi[Wr]=P[Br++]}var Hr=y&&y[kr]||kr
var zr=Boolean(v[kr])
var Vr=Boolean(h[kr])
var Yr=p[kr]||0
var jr=m[kr]||0
var Kr=E[kr]||null
var qr=void 0
if(jr){Ea(!Kr)
if(jr===xa){Kr=T[jr]
if(!T[jr])Kr=T[jr]=e.tintGenSingle(jr)}else if(!(qr=g[jr]))qr=g[jr]=e.tintGen(jr)}var Zr=4*St*4
var Xr=void 0
var Qr=void 0
if(zr){Qr=geomBufAlphaAddQuad(1)
Xr=Ka}else{Qr=geomBufAddQuad(1)
Xr=Ya}var $r=Xr
for(var Jr=0;Jr<4;++Jr){var ea=ci[0]+$a[Zr++]*Bi[0]
var ta=ci[1]+$a[Zr++]*Bi[1]
var ra=ci[2]+$a[Zr++]*Bi[2]
Qr[$r++]=ea*W+z
Qr[$r++]=ta*W+z
Qr[$r++]=ra*W+z
Qr[$r++]=Ur
Qr[$r++]=$a[Zr++]|Yr
Qr[$r++]=Hr
Qr[$r++]=di[Jr]
Qr[$r++]=vi[Jr]
if(Kr){Qr[$r++]=255*Kr[0]
Qr[$r++]=255*Kr[1]
Qr[$r++]=255*Kr[2]}else if(jr){var aa=.0625*ea
var ia=.0625*ta
ga(Fi,aa,qr[0],qr[1])
ga(Wi,aa,qr[3],qr[2])
ga(Wi,ia,Fi,Wi)
Qr[$r++]=255*Wi[0]
Qr[$r++]=255*Wi[1]
Qr[$r++]=255*Wi[2]}else{Qr[$r++]=255
Qr[$r++]=255
Qr[$r++]=255}Qr[$r++]=fi[Jr]
Qr[$r++]=hi[Jr]
Qr[$r++]=pi[Jr]
Qr[$r++]=mi[Jr]
if(H){var oa=7*H
var na=255/(oa*oa)
Qr[$r++]=ra*ra*na}else Qr[$r++]=0}if(zr)Ka=$r
else Ya=$r
if(a||i)if(di[0]*Da(vi[0],fi[0])+di[2]*Da(vi[2],fi[2])>di[1]*Da(vi[1],fi[1])+di[3]*Da(vi[3],fi[3]))for(var sa=0;sa<Ga;++sa){var la=Qr[Xr+sa]
Qr[Xr+sa]=Qr[Xr+sa+Ga]
Qr[Xr+sa+Ga]=Qr[Xr+sa+2*Ga]
Qr[Xr+sa+2*Ga]=Qr[Xr+sa+3*Ga]
Qr[Xr+sa+3*Ga]=la}if(Vr){if(zr){Qr=geomBufAlphaAddQuad(1)
Ka+=Fa}else{Qr=geomBufAddQuad(1)
Ya+=Fa}var _a=Xr+Fa
for(var ca=0;ca<Ga;++ca){Qr[_a+ca]=Qr[Xr+ca+3*Ga]
Qr[_a+ca+Ga]=Qr[Xr+ca+2*Ga]
Qr[_a+ca+2*Ga]=Qr[Xr+ca+Ga]
Qr[_a+ca+3*Ga]=Qr[Xr+ca]}}}}}if(d){if(Ya)t.liquid=Va.slice(0,Ya)
Ea(!Ka)
Ea(!Za)}else{t.data_high_tricount=pt/Fa*2
t.data_mid_start=pt/Fa*6
t.data_mid_tricount=(Ya-pt)/Fa*2
t.data_low_start=Ya/Fa*6
t.data_low_tricount=Za/Fa*2
if(Ya)if(Za){t.data=new Uint8Array(Ya+Za)
t.data.set(new Uint8Array(Va.buffer,Va.byteOffset,Ya),0)
t.data.set(new Uint8Array(qa.buffer,qa.byteOffset,Za),Ya)}else t.data=Va.slice(0,Ya)
else if(Za)t.data=qa.slice(0,Za)
if(Ka)t.alpha=ja.slice(0,Ka)}if(i&&r.used_lighting)for(var ua=0;ua<=2;++ua)for(var da=0;da<=2;++da)for(var fa=0;fa<=2;++fa)if(Ii[ua][da][fa]){var va=e.chunk_id+(ua*Ia+da)*Ia+fa-Ua
r.used_lighting[va]=1}for(var ha=0;ha<Y.length;){var pa=Y[ha++]
var ma=Y[ha++]
e.data[pa]=ma}profilerStop("meshCalcInternal")}var H=28e3
var z=false
function meshCalcShadowBuf(e){if(!e.data&&!(z&&e.liquid))return
var t=0
if(z&&e.liquid)t=e.liquid.length/Ga
var r
var a=0
if(e.data){var i=e.data
Ea(i.length%Fa===0)
var o=e.data_high_tricount+e.data_mid_tricount
var n=0
if(o>H){var s=e.data_mid_tricount+e.data_low_tricount
o=Pa(s,H)
n=e.data_mid_start/6}var l=o/2*4
r=new Uint8Array(3*(t+l))
var _=n*Fa
for(var c=0;c<l;c++){r[a++]=i[c*Ga+_]
r[a++]=i[c*Ga+1+_]
r[a++]=i[c*Ga+2+_]}}if(t){if(!r)r=new Uint8Array(3*t)
var u=e.liquid
for(var d=0;d<t;d++){r[a++]=u[d*Ga]
r[a++]=u[d*Ga+1]
r[a++]=u[d*Ga+2]}}Ea.equal(a,r.length)
e.shadow_buf=r}function generateSimpleLODMesh(e,t,r){var a=new Uint8Array(6*Fa)
var i=0
var o=1
var n=0
var s=0
var l=63
var _=0
var c=r
var u=0
var d=void 0
var f=false
Sa(vi,0,0,0,0)
Sa(fi,255,255,255,255)
ya(mi,vi)
ya(pi,fi)
Sa(di,255,255,255,255)
ya(hi,di)
w(ci,e)
O(Bi,t,e)
L(Bi,A)
for(var v=0;v<6;++v){var h=4*v*4
for(var p=0;p<4;++p){var m=ci[0]+$a[h++]*Bi[0]
var E=ci[1]+$a[h++]*Bi[1]
var g=ci[2]+$a[h++]*Bi[2]
a[i++]=m*o+n
a[i++]=E*o+n
a[i++]=g*o+n
a[i++]=s
a[i++]=$a[h++]|_
a[i++]=l
a[i++]=di[p]
a[i++]=vi[p]
if(c){a[i++]=255*c[0]
a[i++]=255*c[1]
a[i++]=255*c[2]}else if(u){var T=.0625*m
var y=.0625*E
ga(Fi,T,d[0],d[1])
ga(Wi,T,d[3],d[2])
ga(Wi,y,Fi,Wi)
a[i++]=255*Wi[0]
a[i++]=255*Wi[1]
a[i++]=255*Wi[2]}else{a[i++]=255
a[i++]=255
a[i++]=255}a[i++]=fi[p]
a[i++]=hi[p]
a[i++]=pi[p]
a[i++]=mi[p]
if(f){var S=7*f
var I=255/(S*S)
a[i++]=g*g*I}else a[i++]=0}}Ea.equal(i,a.length)
return a}function meshCalcPrep(e,t){profilerStart("meshCalcPrep")
if(!(t=t||{}).liquid&&e.baked_props)for(var r in e.baked_props){var a=e.baked_props[r]
if(!a.key)continue
var i=Ha[a.key]
if(!i)Ea(i,'Missing baked ruleset for "'+a.key+'" ('+Object.keys(Ha).length+" found)")
if(!m[a.key]){m[a.key]=true
var o=i.rules
for(var n=0;n<o.length;++n)F(o[n].data)}}profilerStop("meshCalcPrep")}function meshCalc(e,t,r){meshCalcPrep(e,r)
meshCalcInternal(e,t,r)}},{"../common/globals":248,"../glov/common/vmath":402,"./light_calc":122,"./tiles":199,assert:void 0}],143:[function(e,t,r){"use strict"
r.meshExport=meshExport
var N=e("file-saver")
var C=e("../glov/common/util.js").fract
var x=e("../glov/common/vmath.js").v3set
var M=e("./mesh_calc.js").BYTES_PER_VERT
var D=Float32Array
var P=Int16Array
var B=[new P([0,0,1]),new P([0,0,-1]),new P([0,1,0]),new P([0,-1,0]),new P([1,0,0]),new P([-1,0,0])]
function meshExport(e,t,r,a){var i=[]
i.push("#Worlds-FRVR")
for(var o=0;o<e.length;o+=M)i.push("v "+e[0+o]+" "+e[2+o]+" "+e[1+o])
for(var n=0;n<B.length;n++){var s=B[n]
i.push("vn "+s[0]+" "+s[2]+" "+s[1])}var l=new Uint8Array(e.length/M)
var _=0
var c=0
var u=0
var d=0
var f=0
var v=0
for(var h=0;h<e.length;h+=M){var p=e[h+4]*(1/8)
var m=8*C(p)
l[h/M]=m
var E=.25*Math.floor(p)
var g=.25*Math.floor(E)
var T=1-C(g)
var y=new P(3)
x(y,e[0+h],e[2+h],e[1+h])
y[0]*=1/7
y[1]*=1/7
y[2]*=1/7
var S=1
var I=1
if(h/M%4===0){_=y[0]
c=y[1]
u=y[2]
for(var A=0;A<4*M;A+=M){_=Math.max(_,e[0+A+h]*(1/7))
c=Math.max(c,e[2+A+h]*(1/7))
u=Math.max(u,e[1+A+h]*(1/7))}d=_%(1/T)
f=c%(1/T)
v=u%(1/T)}if(0===m||1===m){if(y[0]===_)S=0
if(y[2]===u)I=0
S+=d
I+=v}if(2===m||3===m){if(y[0]===_)S=0
if(y[1]===c)I=0
S+=f
I+=v}if(4===m||5===m){if(y[1]===c)I=0
if(y[2]===u)S=0
I+=f
S+=v}var w=e[h+5]*t[0]
var L=new D(2)
L[0]=C(w)*t[1]+t[3]
L[1]=Math.floor(w)*t[2]+t[3]
S=S*T*r[0]+L[0]
I=I*T*r[1]+L[1]
i.push("vt "+S+" "+(1-I))}for(var O=0;O<e.length;O+=M)i.push("vp "+e[8+O]+" "+e[9+O]+" "+e[10+O])
for(var R=0;R<e.length/M;R+=4){i.push("f "+(1+R)+"/"+(1+R)+"/"+(1+l[0+R])+" "+(3+R)+"/"+(3+R)+"/"+(1+l[1+R])+" "+(2+R)+"/"+(2+R)+"/"+(1+l[2+R]))
i.push("f "+(3+R)+"/"+(3+R)+"/"+(1+l[2+R])+" "+(1+R)+"/"+(1+R)+"/"+(1+l[3+R])+" "+(4+R)+"/"+(4+R)+"/"+(1+l[0+R]))}var b=new Blob([i.join("\n")],{type:"obj"})
N.saveAs(b,a.concat(".obj"),false)}},{"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./mesh_calc.js":142,"file-saver":void 0}],144:[function(e,t,r){"use strict"
r.isMobile=isMobile
var a=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Playbook/i,/Windows Phone/i,/WPDesktop/i,/Mobi/i,/IEMobile/i,/Opera Mini/i,/Nexus/i,/Kindle Fire/i,/PalmSource/i,/Palm/i,/mobile/i,/tablet/i]
function isMobile(){return a.some(function(e){return window.navigator.userAgent.match(e)})}},{}],145:[function(e,t,r){"use strict"
r.createEntDrawData=createEntDrawData
r.getEntityAnimPos=getEntityAnimPos
r.playerToolAnim=playerToolAnim
r.otherPlayerAnim=otherPlayerAnim
r.updatePlayers=updatePlayers
r.mobsTick=mobsTick
r.mobsDraw=mobsDraw
r.mobsDrawLate=mobsDrawLate
r.mobsStartup=mobsStartup
r.mobsOnWorldMetadataChange=mobsOnWorldMetadataChange
r.placePrevented=r.EntDrawDataNoGeom=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var f=e("assert")
var v=e("gl-mat4/translate")
var a=e("../glov/client/cmds").cmd_parse
var h=e("../glov/client/engine").getFrameDt
var m=e("../glov/client/engine")
var s=e("../glov/client/font").styleAlpha
var l=e("../glov/client/input")
var p=e("../glov/client/mat4ScaleRotateTranslate")
var i=e("../glov/client/net")
var o=i.netSubs
var n=i.netUserId
var _=e("../glov/client/quat")
var E=_.qFromYPR
var c=_.qInvert
var u=_.qMult
var w=_.qRotateX
var g=_.qRotateZ
var L=_.qTransformVec3
var d=_.quat
var T=e("../glov/client/settings")
var y=e("../glov/client/words/profanity").profanityFilter
var S=e("../glov/common/enums").CHAT_FLAG_EMOTE
var I=e("../glov/common/util")
var A=I.clamp
var O=I.easeIn
var R=I.easeInOut
var b=I.easeOut
var N=I.lerp
var C=I.merge
var x=e("../glov/common/vmath")
var M=x.mat4
var D=x.v3addScale
var P=x.v3copy
var B=x.v3distSq
var k=x.v3iAdd
var U=x.v3lengthSq
var G=x.v3lerp
var F=x.v3normalize
var W=x.v3perspectiveProject
var H=x.v3set
var z=x.v3sub
var V=x.vec3
var Y=x.vec4
var j=x.zaxis
var K=e("../common/globals").VOXELS_PER_M
var q=e("../common/ids")
var Z=q.ITEM_BUCKET
var X=q.ITEM_HANDSTOOL
var Q=q.ITEM_SHOVEL
var $=q.TYPE_BLOCK
var J=q.TYPE_ITEM
var ee=e("../common/items_common").sameItem
var te=e("../common/roles_common").isValidRole
var re=e("../common/types").CHAT_FLAG_WORLDSYSTEM
var ae=e("./animation").animationStartup
var ie=e("./animation_enum")
var oe=ie.AnimEnum
var ne=ie.isCrouchAnim
var se=ie.isLadderAnim
var le=e("./animation_player").animationDrawPlayer
var _e=e("./baking").drawBaked2
var ce=e("./character_controller_constants")
var ue=ce.CHAR_SIZES
var de=ce.CHAR_SIZE_SMALL
var fe=ce.CHAR_SIZE_TALL
var ve=e("./chat_floater")
var he=ve.ChatFloater
var pe=ve.ChatWithTipFloater
var me=ve.MSG_FLOATERS_MAX_DIST
var Ee=ve.chatFloaterStartup
var ge=e("./client_entities")
var Te=ge.MAX_INTERP_DIST_SQ
var ye=ge.POS_BLEND_TIME
var Se=ge.allocPerEntData
var Ie=ge.clientEntitiesTick
var Ae=ge.getEntityManager
var we=ge.getEntityPosManager
var Le=ge.getEntityToDebug
var Oe=ge.getGlobalEntPosData
var Re=ge.getMyEntID
var be=ge.setEntityToDebug
var Ne=e("./costume_edit")
var Ce=Ne.costumeCurrent
var xe=Ne.costumeCurrentMod
var Me=e("./entity_worlds_client").ENT_DELETE_FADE_TIME
var De=e("./floater")
var Pe=De.DEF_FLT_SCALE
var Be=De.TextFloater
var ke=De.drawFloaterSimple
var Ue=De.drawFloaterStack
var Ge=e("./inventory").inventoryGetAccountMapped
var Fe=e("./items").createItem
var We=e("./main")
var He=e("./photo_mode")
var ze=He.photoModeActive
var Ve=He.photoShowSelf
var Ye=e("./props")
var je=Ye.PREVIEW_HELD
var Ke=Ye.drawBlock
var qe=Ye.getForPreview
var Ze=e("./quickbar")
var Xe=Ze.getCurrentBrushSize
var Qe=Ze.getSelectedVisible
var $e=e("./shadow").shadowStartup
var Je=e("./styles")
var et=Je.STYLE_WITHOUT_OUTLINE
var tt=Je.STYLE_WITH_OUTLINE
var rt=Je.getStyleForClient
var at=Je.getStyleForRole
var it=e("./tiles_const").TILES
var ot=e("./ui_util_2")
var nt=e("./user_data")
var st=nt.MORALE_BOOST_MOD
var lt=nt.setStaminaUsageScaleMod
var _t=e("./user_info_view")
var ct=_t.USER_VIEW_H
var ut=_t.USER_VIEW_W
var dt=_t.viewUser
var ft=e("./user_party").partyFormatDisplayName
var vt=e("./voxel_data")
var ht=vt.applyBevelParamCharacters
var pt=vt.applyBevelParamWorld
var mt=vt.applyBevelValue
var Et=vt.getPropLighting
var gt=vt.localPosFromWorldPos
var Tt=vt.worldPosFromLocalPos
var yt=e("./world_comm")
var St=yt.getWorldChannel
var It=yt.worldGetRoles
var At=e("./world_metadata")
var wt=At.worldBoostIcon
var Lt=At.worldShowNames
var Ot=At.worldUserDistance
var Rt=Math.abs,bt=Math.max,Nt=Math.min,Ct=Math.PI,xt=Math.cos,Mt=Math.sqrt,Dt=Math.tan,Pt=Math.asin
var Bt=1.75*K/12
var kt=10*Bt
var Ut=3*Bt
var Gt=150
T.register({show_names:{default_value:1,type:a.TYPE_INT,range:[0,1],store:false},show_names_photos:{label:"Show Names in Photos",help:"Configure showing player names and race goal results in photos",default_value:0,type:a.TYPE_INT,range:[0,1],store:false},show_names_offscreen:{label:"Show Names Offscreen",default_value:1,type:a.TYPE_INT,range:[0,1]},name_interact_dist:{label:"Name Interact Distance",default_value:-1,type:a.TYPE_INT,range:[-1,1e3]},name_interact_dist_locked:{label:"Name Interact Distance (while pointer locked)",default_value:12,type:a.TYPE_INT,range:[-1,1e3]},show_chat_bubbles:{default_value:1,type:a.TYPE_INT,range:[0,1]},show_chat_bubbles_offscreen:{label:"Show Chat Bubbles Offscreen",default_value:1,type:a.TYPE_INT,range:[0,1]},shadow_max:{label:"Maximum entity shadows per frame",default_value:100,type:a.TYPE_INT,range:[0,1e4]}})
var Ft
function checkMoraleBoost(e,t){if(t&&t.world_areabuilder&&e.last_receive_time+3e4>m.frame_timestamp)lt(st,true)}var Wt=d()
var Ht=d()
E(Ht,Ct,0,0)
function applyAnimConstraints(e,t,r,a,i,o){if(o&&se(o)||i===oe.SIT){E(e,a,0,0)
c(Wt,t)
u(Wt,e,Wt)
var n=U(Wt)
var s=2*Math.atan2(n,Wt[3])
if(!(s<1.2||s>5))u(t,t,Ht)}else if(i===oe.MINING||i===oe.DIG){E(e,a,0,0)
E(t,0,-r,0)
u(t,e,t)}}var zt=function EntDrawDataNoGeom(){this.local_pos=V()
this.msg_floaters=[]
this.name_floater=null
this.debug_floater=null
this.alpha=1
this.alpha_name=1}
var Vt=function(i){_inheritsLoose(EntDrawDataImpl,i)
function EntDrawDataImpl(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).quat=d()
e.head_pos=V()
e.head_quat=d()
e.hand_pos=V()
e.prop_mat=M()
e.prop_quat=d()
e.last_prop=null
e.last_tile=null
e.last_item=null
e.last_scale=1
e.draw_opts={scale_lights:true,torch_factor:0,sun_factor:1,torch_target:0,sun_target:1}
e.costume_mod=0
e.last_costume=void 0
e.last_receive_time=0
e.anim_override=null
e.anim_data=void 0
e.draw_shadows=false
return e}return EntDrawDataImpl}(r.EntDrawDataNoGeom=zt)
function createEntDrawData(){return new Vt}var Yt=V(.75,0,-.75)
var jt=V(0,.5,-.5)
var Kt=V()
function updatePerClientPos(e,t,r,a){var i=e.head_quat,o=e.head_pos,n=e.local_pos
if(a){P(n,Ft.feet_pos)
P(o,Ft.pos)
E(i,Ft.head_angle[0],Ft.head_angle[1],0)
E(e.quat,-Ft.ypr[0],0,0)
applyAnimConstraints(e.quat,i,Ft.ypr[1],Ft.look_angle,Ft.anim,Ft.anim_secondary)}else{f(isFinite(t.pos[0])&&isFinite(t.pos[1])&&isFinite(t.pos[2]))
gt(n,t.pos)
D(o,n,j,kt)
E(e.quat,-t.pos[3],0,0)
E(i,-t.pos[3],-t.pos[4],0)
if(t.anim_state.anim)applyAnimConstraints(e.quat,i,t.pos[4],t.pos[5],t.anim_state.anim,t.anim_state.anim_secondary)}if(r){var s=e.hand_pos
L(s,Yt,e.quat)
L(Kt,jt,i)
k(s,Kt)
k(s,o)}}var qt=V()
function getEntityAnimPos(e){if(e===Re()){var t=Ft,r=t.char_right,a=t.char_up,i=t.facing,o=t.pos
D(qt,o,i,1)
var n=Dt(m.fov_x/2)
var s=Dt(m.fov_y/2)
D(qt,qt,r,.5*n)
D(qt,qt,a,-s)
return qt}var l=Ae().getEnt(e)
var _=we().getPED(e)
if(!_||!l||!l.draw_data)return null
updatePerClientPos(l.draw_data,_,true,false)
return l.draw_data.hand_pos}function getHeldItemData(e,t){var r
var a=.5
if(t.type===J&&(t.need_thumbnail_update||t.thumbnail_updated)){var i=qe(t,je)
r=i!==e.last_prop
e.last_prop=i
a=1/bt(i.size[0],i.size[1],i.size[2])
e.last_tile=null}else{e.last_prop=null
var o=t.type===$?t.id:"unknown"
r=o!==e.last_tile
e.last_tile=o}e.last_scale=a
return r}var Zt=V(-.5,-.5,0)
var Xt=V()
function drawHeldItem(e,t){var r=t&&t[0]||0
var a=e.prop_mat,i=e.last_scale,o=e.prop_quat,n=e.hand_pos,s=e.last_prop,l=e.last_tile,_=e.draw_opts
if(!s&&r>1){i*=1+.3*(r-1)
n=H(Xt,n[0],n[1],n[2]-.075*(r-1))}H(n,n[0]+.01,n[1]+.01,n[2]+.01)
p(a,i,o,n)
if(s){var c=s
if(c.baked_keys_inhand){var u=c.baked_keys_inhand
for(var d=0;d<u.length;++d)_e(a,u[d],_)}else if(c.baked&&c.baked.key)_e(a,c.baked.key,_)}else{v(a,a,Zt)
if("unknown"!==l)Ke(a,l,_,t)}}function animFromTool(e){var t=oe.MINING
if(!e||e.type===J&&(e.id===X||e.id===Q))t=oe.DIG
return t}var Qt=500
var $t=null
var Jt=V()
function playerToolAnim(e,t,r,a){var i=null
if(a){z(Jt,a,Ft.pos)
F(Jt,Jt)
var o=Math.atan2(Jt[1],Jt[0])
i=o-=Ct/2}var n=animFromTool(e)
Ft.useTool(i,n)
r=bt(r||1,.5)
if(!e.type||e.type===J&&e.id===X)e={type:$,id:it.SAND}
if(!$t||!ee($t.inv,e)&&$t.frame!==m.frame_index)$t={time:m.frame_timestamp,inv:Fe(e),rate:r}
else if(!t||(m.frame_timestamp-$t.time)*$t.rate>.6*Qt){$t.time=m.frame_timestamp
$t.rate=r}$t.frame=m.frame_index}function otherPlayerAnim(e,t){var r
t=bt(t||1,.5)
var a=Ae().getEnt(e)
var i=we().getPED(e)
if(!i||!a||!a.draw_data)return
var o=a.draw_data
var n=animFromTool(null==(r=i.anim_state)?void 0:r.held_item)
var s=o.anim_override
if(!s)o.anim_override={start:m.frame_timestamp,duration:Qt*t,anim:n}
else if(s.anim!==n||m.frame_timestamp>s.start+.6*s.duration){s.start=m.frame_timestamp
s.duration=Qt*t
s.anim=n}}var er=createEntDrawData()
var tr=V(0,0,-.2)
var rr=V(.1,0,-.2)
var ar=V(0,0,-.3)
var ir=V()
function animateTool(e,t,r,a){var i=e.head_quat,o=e.hand_pos,n=e.prop_quat,s=e.last_prop
if(t)if(s&&s.inv.is_tool&&(s.item_id===Q||s.item_id===Z&&!s.attr2)){var l=V(-.75,0,.5)
var _=-Ct/4
var c=Ct/4
var u=(t>.25?1:0)?1-(t-.25)/.75:t/.25
var d=(t>.5?1:0)?1-(t-.5)/.5:t/.5
var f=t>.5?2:t>.25?1:0
var v=2===f?1-(t-.5)/.5:f?1-(t-.25)/.25:t/.25
ir[0]=O(u,2)*l[0]*r
ir[1]=0
ir[2]=b(d,2)*l[2]*a
L(ir,ir,i)
k(o,ir)
if(0===f)w(n,n,R(v,1.5)*c)
else if(1===f)w(n,n,N(O(v,2),_,c))
else w(n,n,R(v,1.5)*_)}else if(s&&s.inv.is_tool){var h=V(-.75,0,1)
var p=-Ct/4
var m=Ct/4
var E=(t>.25?1:0)?1-(t-.25)/.75:t/.25
var g=(t>.1?1:0)?1-(t-.1)/.9:t/.1
var T=t>.25?2:t>.1?1:0
var y=2===T?1-(t-.25)/.75:T?(t-.1)/.15:t/.1
ir[0]=O(E,2)*h[0]*r
ir[1]=0
ir[2]=b(g,2)*h[2]*a
L(ir,ir,i)
k(o,ir)
if(2===T)w(n,n,R(y,1.5)*m)
else if(T)w(n,n,N(O(y,2),p,m))
else w(n,n,R(y,1.5)*p)}else{var S=V(-.75,1,0)
var I=Ct/8
var A=(t>.25?1:0)?1-(t-.25)/.75:t/.25
ir[0]=O(A,2)*S[0]*r
ir[1]=O(A,2)*S[1]*a
ir[2]=0
L(ir,ir,i)
k(o,ir)
w(n,n,O(A,2)*I)}}function updateAnimProgress(e){if(e){e.progress=e.rate*(m.frame_timestamp-e.time)/Qt
if(e.progress>=1)e=null}return e}var or=0
function drawItemInHand(){var e=($t=updateAnimProgress($t))&&$t.inv||Qe()
if(!e){or=0
return}mt(false,true)
or+=m.frame_dt
var t=$t&&$t.progress||0
var r=er
if(getHeldItemData(r,e=Ge(e)))or=0
var a=Nt(or/100,1)
var i=r.head_quat,o=r.hand_pos,n=r.prop_quat,s=r.last_prop
var l=Ft,_=l.ypr,c=l.camera_pos,u=l.char_right,d=l.char_up,f=l.facing,v=l.lighting_values
C(r.draw_opts,v)
E(r.quat,-_[0],0,0)
E(i,-_[0],-_[1],0)
D(qt,c,f,1)
var h=Dt(m.fov_x/2)
var p=Dt(m.fov_y/2)
D(qt,qt,u,h)
D(qt,qt,d,-p)
L(o,tr,r.quat)
L(Kt,rr,i)
k(o,Kt)
k(o,qt)
g(n,i,1.2*Ct)
ir[0]=ir[1]=0
ir[2]=.03*xt(_[0])+.03*xt(2*c[0]*Ct/16)+.03*xt(2*c[1]*Ct/16)
ir[2]+=-.5*(1-b(a,2))
L(ir,ir,i)
k(o,ir)
animateTool(r,t,h,p)
if(s){r.last_scale/=2
if(e.type===J&&e.id===Z);else w(n,n,Ct/4)
if(s.inv.is_tool){L(Kt,ar,n)
k(o,Kt)}}drawHeldItem(r,Xe())
mt()}var nr=V()
function isPosOnscreen(e){W(nr,e,m.mat_vp)
return nr[2]>=.5}var sr=Y(1,1,1,1)
var lr=function(u){_inheritsLoose(IDFloater,u)
function IDFloater(e){var t;(t=u.call(this,e)||this).id=void 0
t.icons=null
t.alpha=1
t.id=e.id
return t}var e=IDFloater.prototype
e.setIcons=function setIcons(e){if(e!==this.icons){this.icons=e
this.updateSize()}}
e.updateAlpha=function updateAlpha(e){u.prototype.updateAlpha.call(this,e)
this.alpha=e}
e.getBaseWidth=function getBaseWidth(){return u.prototype.getBaseWidth.call(this)+(this.icons&&this.icons.length||0)}
e.draw=function draw(e){var t=this.icons
if(!t)u.prototype.draw.call(this,e)
else{var r=e.x,a=e.y,i=e.z,o=e.scale
var n=this.size*o
var s=t.length*n
u.prototype.draw.call(this,{x:r-.5*s,y:a,z:i,scale:o})
var l=r+this.text_w*o-s
sr[3]=this.alpha
for(var _=0;_<t.length;++_){var c=t[_]
c.sprite.draw({x:l,y:a,z:i,w:n,h:n,frame:c.frame,color:sr})
l+=n}}}
return IDFloater}(Be)
var _r=function(e){_inheritsLoose(PlayerNameFloater,e)
function PlayerNameFloater(){return e.apply(this,arguments)||this}PlayerNameFloater.prototype.interact=function interact(e){l.pointerLockExit()
dt({user_id:this.id,x:e.x+(e.w-ut)/2,y:e.y-ct})}
return PlayerNameFloater}(lr)
var cr=function(e){_inheritsLoose(EntityDebugFloater,e)
function EntityDebugFloater(){return e.apply(this,arguments)||this}EntityDebugFloater.prototype.interact=function interact(){var e=Number(this.id)
be(Le()===e?0:e)}
return EntityDebugFloater}(lr)
function idFloaterInit(e,t,r,a,i,o){var n=l.pointerLocked()?T.name_interact_dist_locked:T.name_interact_dist
e.setInteractDist(i=null!==i?i:n)
e.setText(t)
if(1!==a)r=s(r,a)
e.setStyle(r)
e.setIcons(o)
return{floater:e,show_offscreen:Boolean(T.show_names_offscreen),max_dist:Ot(),draw_in_photos:Boolean(T.show_names_photos)}}var ur=[]
function playerNameFloaterWithOpts(e,t){if(!t.user_id)return null
if(!e.name_floater)e.name_floater=new _r({id:t.user_id})
var r=t.display_name||t.user_id
r=ft(t.user_id,r)
var a=null
if(t.roles&&t.roles.world_booster)a=ur
return idFloaterInit(e.name_floater,r,rt(t.roles,tt),e.alpha_name,null,a)}function entityDebugFloaterWithOpts(e,t){if(!e.debug_floater)e.debug_floater=new cr({id:String(t.id)})
return idFloaterInit(e.debug_floater,t.type_id+": "+t.id,at("BUILDER",tt),e.alpha_name,Infinity,null)}var dr=4
var fr=5e3
var vr=1e3
function updatePlayerMessageFloaters(e,t){var r=0
for(var a=e.length-1;a>=0;a--){var i=Date.now()-e[a].getTimestamp()
var o=1-A((i-fr)/vr,0,1)
if(0===o)e.splice(a,1)
else if(T.show_chat_bubbles&&r<dr){e[a].setBaseAlpha(o)
t.push({floater:e[a],show_offscreen:Boolean(T.show_chat_bubbles_offscreen),max_dist:me})
r++}}}var hr=V()
function globalEntCalcNameFloaterPos(e){var t=e.draw_data
if(!t)t=e.draw_data=new zt
var r=t.local_pos
P(r,e.pos)
if(e.blends)for(var a=e.blends.length-1;a>=0;--a){var i=e.blends[a]
var o=m.frame_timestamp-i.t0
if(o>=ye)if(1===e.blends.length){delete e.blends
break}else e.blends.splice(a,1)
else G(r,R(o/ye,2),i.pos,r)}gt(r,r)
D(hr,r,j,kt+Ut)}var pr
var mr
function updateGlobalEnt(e,t){var r
if(!t){if(!mr)return null
if(!(t=mr[e]))return null}var a=(null==(r=pr[t.client_id])?void 0:r.ids)||null
var i
if(a&&a.user_id){t.last_seen=m.frame_timestamp
t.last_ids=a
var o=m.frame_timestamp-t.first_seen
i=Nt(o/Me,1)}else if(!t.last_ids)return null
else{var n=m.frame_timestamp-t.last_seen
if(n>Me)return null
i=1-n/Me
a=t.last_ids}globalEntCalcNameFloaterPos(t)
t.draw_data.alpha_name=i
return t}var Er=18
var gr=V()
var Tr=Infinity
var yr
function updatePlayer(e,t){var r=Boolean(t.data.held_item)
var a=t.draw_data
if(!a)a=t.draw_data=createEntDrawData()
a.draw_shadows=true
a.alpha=null===t.fade?1:t.fade
var i=1
if(1!==a.alpha){var o=updateGlobalEnt(t.id)
if(o){i=a.alpha
a.alpha_name=N(i,o.draw_data.alpha_name,1)}else a.alpha_name=a.alpha}else a.alpha_name=1
updatePerClientPos(a,e,r,false)
var n=a.head_pos
f(isFinite(n[0])&&isFinite(n[1])&&isFinite(n[2]))
D(gr,n,j,Ut)
var s=Mt(B(gr,Ft.pos))
if(Tr>s){Tr=s
yr=a}if(1!==i)if(B(gr,hr)<Te)G(gr,i,hr,gr)
var l=[]
var _=Lt()&&(T.show_names||T.show_names_photos&&ze())
var c=s<=Ot()
if(c){if(_&&t.data.user_id){var u=playerNameFloaterWithOpts(a,t.data)
f(u)
l.push(u)}if(m.defines.ENTITY)l.push(entityDebugFloaterWithOpts(a,t))
updatePlayerMessageFloaters(a.msg_floaters,l)
Ue(l,gr,Pe,{min_scale:Er})}if(s<Gt)checkMoraleBoost(a,t.data.roles)
return isPosOnscreen(gr)&&c}function drawGlobalEnt(e,t){if(!updateGlobalEnt(e,t))return
var r=t.draw_data
var a=t.last_ids
var i=Mt(B(hr,Ft.pos))
var o=[]
var n=Lt()&&(T.show_names||T.show_names_photos&&ze())
if(i<=Ot()){if(n&&a.user_id){var s=playerNameFloaterWithOpts(r,a)
f(s)
o.push(s)}Ue(o,hr,Pe,{min_scale:Er})}}function drawPlayer(e,t,r){var a=Boolean(t.anim_state.held_item)
var i=e
var o=i.head_pos,n=i.local_pos,s=i.head_quat
Et(e.draw_opts,o,true)
var l=le(e,t,r,n,i.quat,s)
if(a){if(!ee(t.anim_state.held_item,i.last_item)){var _=Fe(t.anim_state.held_item)
i.last_item=_
getHeldItemData(i,_)}i.hand_pos=l.pos
i.prop_quat=l.rot
drawHeldItem(i)}return l}var Sr=[]
function updatePlayers(){if(!St())return
Tr=Infinity
yr=void 0
mr=Oe()
pr=St().getChannelData("public.clients")
var e=h()
var t=Ae()
var r=we()
Sr.length=0
lt(st,false)
var a=t.entities
for(var i in a){var o=Number(i)
var n=a[o]
if(n.isMe()&&!m.defines.DRAWSELF)continue
var s=r.updateOtherEntity(o,e)
if(!s)continue
if(!updatePlayer(s,n))continue
Sr.push([s,n])}var l=m.frame_timestamp-Me
for(var _ in mr){var c=Number(_)
var u=mr[c]
if(u.deleted_at&&u.deleted_at<l){delete mr[c]
continue}var d=a[c]
if(d){if(null===d.fade){var f=r.getPED(c)
if(f){H(u.pos,f.pos[0],f.pos[1],f.pos[2])
if(u.blends)u.blends=void 0}}continue}drawGlobalEnt(c,u)}mr=pr=null}function checkDistToPlayers(){if(Tr<10&&Tr>1&&yr&&Ft.anim!==oe.SIT){z(Jt,yr.head_pos,Ft.pos)
F(Jt,Jt)
var e=Math.atan2(Jt[1],Jt[0])
e-=Ct/2
var t=Pt(Jt[2])
if(Ct-Rt(Rt(e%(2*Ct)- -Ft.ypr[0]%(2*Ct))-Ct)<Ct/3){Ft.head_angle[0]=e
Ft.head_angle[1]=t}else{Ft.head_angle[0]=-Ft.ypr[0]
Ft.head_angle[1]=-Ft.ypr[1]}}else{Ft.head_angle[0]=-Ft.ypr[0]
Ft.head_angle[1]=-Ft.ypr[1]}}var Ir
var Ar
var wr=V()
function showSelf(){if(!Ir){Ir=Se();(Ar=createEntDrawData()).draw_shadows=true}Ir.anim_state=Ft.getNetAnimState()
updatePerClientPos(Ar,Ir,true,true)
var e=Ce(true)
Ar.costume_mod=xe()
drawPlayer(Ar,Ir,e)
if(T.show_names_photos&&ze()){var t={user_id:n(),display_name:o().getDisplayName(),roles:It()}
D(wr,We.char_controller.pos,j,Ut)
var r=playerNameFloaterWithOpts(Ar,t)
if(r)ke(r,wr,Pe,{min_scale:Er})}checkDistToPlayers()}function drawEntities(){ht()
if(ze()?Ve():T.camera_view&&!Ft.zoomed_in_fpv||Ft.zoomed_out_tpv)showSelf()
else{Ft.head_angle[0]=-Ft.ypr[0]
Ft.head_angle[1]=-Ft.ypr[1]}for(var e=0;e<Sr.length;++e){var t=Sr[e]
var r=t[0]
var a=t[1]
a.draw_data.draw_shadows=!T.shadow_max||e<T.shadow_max
drawPlayer(a.draw_data,r,a.getData("costume")||a.costume)}pt()}var Lr=function(){var d=V()
return function placePreventedFn(e){Tt(d,e)
var t=d[0]
var r=d[1]
var a=d[2]
var i=Ae().entities
for(var o in i){var n=i[Number(o)]
var s=n.getData("pos")
f(s)
var l=n.getData("anim")
var _=l&&ne(l)?ue[de]:ue[fe]
var c=_.col_bounds
var u=_.eye_height+c.max[2]
if(t<=s[0]+c.max[0]&&t+1>=s[0]+c.min[0]&&r<=s[1]+c.max[1]&&r+1>=s[1]+c.min[1]&&a<=s[2]+u&&a+1>=s[2]+1.1)return true}return false}}()
r.placePrevented=Lr
function mobsTick(){profilerStart("mobsTick")
Ie()
updatePlayers()
profilerStop("mobsTick")}function mobsDraw(){profilerStart("mobsDraw")
drawEntities()
profilerStop("mobsDraw")}function mobsDrawLate(){if(m.defines.NOUI)return
if(Ft.zoomed_in_fpv||!Ft.zoomed_out_tpv&&!T.camera_view){if(!m.defines.NOTOOLCLEAR){gl.depthMask(true)
gl.clear(gl.DEPTH_BUFFER_BIT)}else{gl.depthMask(false)
gl.disable(gl.DEPTH_TEST)}drawItemInHand()}}function mobsStartup(){ae()
$e()
Ft=We.char_controller
Ee()
We.chat_ui.registerOnMsgChatCB(function(e){var t=e.flags||0
if(!e.quiet&&e.ent_id&&(!(t&S)||t&re)){var r=Ae().getEnt(e.ent_id)
if(r&&r.draw_data){var a=r.draw_data.msg_floaters
var i=T.profanity_filter?y(e.msg):e.msg
var o=a.length-1
var n=a[o]
var s=e.style&&te(e.style)?e.style:"NONE"
var l=at(s,et)
if(n)a[o]=new he(n.getText(),l,n.getTimestamp())
a.push(new pe(i,l,Date.now()))}}})
ur.push({sprite:ot.sprite,frame:ot.BOOSTER0})}function mobsOnWorldMetadataChange(){ur[0].frame=ot.BOOSTER0+wt()}},{"../common/globals":248,"../common/ids":249,"../common/items_common":251,"../common/roles_common":260,"../common/types":263,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/mat4ScaleRotateTranslate":336,"../glov/client/net":338,"../glov/client/quat":346,"../glov/client/settings":351,"../glov/client/words/profanity":372,"../glov/common/enums":385,"../glov/common/util":400,"../glov/common/vmath":402,"./animation":8,"./animation_enum":9,"./animation_player":10,"./baking":19,"./character_controller_constants":38,"./chat_floater":40,"./client_entities":44,"./costume_edit":65,"./entity_worlds_client":87,"./floater":100,"./inventory":114,"./items":119,"./main":135,"./photo_mode":158,"./props":171,"./quickbar":172,"./shadow":183,"./styles":197,"./tiles_const":200,"./ui_util_2":206,"./user_data":208,"./user_info_view":210,"./user_party":211,"./voxel_data":216,"./world_comm":226,"./world_metadata":235,assert:void 0,"gl-mat4/translate":void 0}],146:[function(e,t,r){"use strict"
r.modContinentDataAvailable=modContinentDataAvailable
r.modContinentDataGet=modContinentDataGet
r.modAPIStartup=modAPIStartup
var o=e("./localization/localization").L
var n=e("assert")
var a=e("../glov/client/error_report.js").errorReportSetDetails
var s=e("../glov/client/ui.js")
var i
var l={}
function sendMessage(e,t,r){i.postMessage({msg:t,data:r,origin:e})}var _
function modContinentDataAvailable(){return Boolean(_)}function modContinentDataGet(){var e=_
_=null
a("modapi_cdata",1)
return e}function modMessageHandler(e){var t=e.data,r=t.msg,a=t.data,i=t.origin
if("connect"!==r&&!l[i]){console.log("ModAPI Host: Received message ("+r+") from untrusted origin ("+i+")")
return}switch(r){case"connect":if(l[i])sendMessage(i,"connect_ack")
else if(false===l[i]);else if(null===l[i]);else{l[i]=null
s.modalDialog({title:o.DLG_API_ACCESS_TITLE,text:o.$(o.DLG_API_ACCESS_MSG,i),buttons:{Yes:function Yes(){l[i]=true
sendMessage(i,"connect_ack")},No:function No(){l[i]=false}}})}break
case"ping":sendMessage(i,"pong")
break
case"continent_data_set":n(a instanceof Uint8Array)
_=a
console.log("ModAPI Host: Received continent data ("+a.length+" bytes)")
break
default:console.error("ModAPI Host: Received unknown message from mod_api_messenger:",r)}}function modAPIStartup(){if("undefined"===typeof BroadcastChannel)return
try{i=new BroadcastChannel("mod_api")}catch(e){return}i.addEventListener("message",modMessageHandler)
i.postMessage({msg:"startup"})}},{"../glov/client/error_report.js":311,"../glov/client/ui.js":367,"./localization/localization":131,assert:void 0}],147:[function(e,t,r){"use strict"
r.motdRun=motdRun
var y=e("../glov/client/camera2d")
var a=e("../glov/client/cmds").cmd_parse
var S=e("../glov/client/font").ALIGN
var I=e("../glov/client/input").KEYS
var A=e("../glov/client/markdown").markdownAuto
var i=e("../glov/client/net")
var o=i.netClient
var _=i.netDisconnected
var c=i.netSubs
var w=e("../glov/client/scroll_area").scrollAreaCreate
var n=e("../glov/client/ui")
var L=n.button
var u=n.isMenuUp
var O=n.menuUp
var s=n.modalTextEntry
var R=n.panel
var b=n.uiGetTitleFont
var N=n.uiTextHeight
var d=e("../glov/common/rand_alea").mashString
var l=e("../glov/common/util").nop
var C=e("./localization/localization").L
var f=e("./main").chatUI
var v=e("./main_menu")
var x=v.mainMenuHeaderLogoDraw
var M=v.mainMenuHeaderLogoWidth
var h=e("./menu").menuDoTransition
var p=e("./styles")
var D=p.color_white
var m=p.menu_header_alert_style
var E=p.menu_header_style
var P=e("./ui_util")
var g="\n**World Boosting** is now live!  Work together with friends to [img=boost1]*Boost* a world to increase its capacity, and unlock perks for everyone in the world, as well as help support Worlds FRVR.  Unfortunately we cannot continue to offer free large-capacity worlds, but now *all* worlds, **Lost Frontier** and **Unlimited**, can be *Boosted* to increase the number of builders allowed (among other things)!\n\nAlso, exciting for creators, if one of your worlds gets *Boosted*, you'll get some of the [img=orbs]Orbs spent!\n\nRead below, or check the **Recent Updates** from the main menu for details!\n\nCheers,\n  - *Jimbly*\n\n***World Boosting*** - 0.102.0\n• Boost a world to unlock perks for the world:\n  • Up to 35 Builders\n  • Access to new \"Marble\" props\n  • More sky and lighting options\n  • Customized loading spinners\n  • Customized background image on the world info and loading screens\n  • Larger offline chat history\n  • Icon in chat / next to the names of [img=booster]Boosters\n  • Priority Builder Queue access for Boosters\n  • Access options if you want to limit things like flying or using particular Waygates to Boosters\n  • Increased visibility in the world list\n  • Exclusive badge on the user profile of players who Boost any world\n• By default, all worlds are [img=boost0]*Unboosted*, and a single *Boost* will level the world up to [img=boost1]LVL1, and then to [img=boost2]higher [img=boost3]levels with increasingly more boosts\n• World Boosts are purchased in 1 month (*30 Day*) increments, and will expire after 30 days\n  • If you cancel a boost before the end of the period, you'll receive [img=boost_token]*Boost Tokens* as a partial refund, which will be used to discount the next Boost you purchase\n  • Boosts have a cooldown of 5 days - if they are cancelled in the first 5 days, they will stay active until the end of that period\n  • Boosts are only tracked in whole-day increments, so if you cancel a Boost it will remain active until at least the end of the day (measured from the time at which the Boost started)\n".trim()
var T
var B=40
var k=150
var U=20
var G=8
var F=100
var W=3*F
var H
function motdDismiss(e,t){var r=c().getMyUserChannel()
r.predictSetChannelData(e,t)
r.cmdParse("motd_set "+e.slice("public.motd.".length)+" "+t,l)
h()}function motdShow(e,t,r,a,i){y.setAspectFixed(1e3,1e3)
var o=B
var n=1e3-B
var s=y.y0()+2*G
var l=n-o
var _=y.y1()-B
var c=M(k)
var u=Z.MODAL
var d=N()
var f=o+U
x({x:f,y:s,z:u,h:k,w:c})
var v=f+c+2*U
var h=2*d
var p=(s+=k-40)-.5*U-h
var m=n-3*U-v
var E=m-b().draw({style:e,x:v,y:p,z:u,w:m,align:S.HFIT|S.HRIGHT,size:h,text:t})
R({x:v-2*U+E,y:p-U,z:u-.1,w:m+4*U-E,h:200,color:D})
var g={x:o,y:s,w:l,h:_-s,z:++u,color:D}
u++
s+=U-4
l=(n-=G)-(o+=G)
if(!H)H=w({z:u,auto_hide:true,background_color:null,pixel_scale:1})
var T=_-U-F
if(L({x:o+(l-W)/2,y:T,z:u,w:W,h:F,text:C.BTN_OK,font_height:h,img:P.sprite,frame:P.CHECK,auto_focus:true,hotkey:I.ESC}))motdDismiss(a,i)
H.begin({x:o,y:s,w:l,h:T-s})
o=H.barWidth()
s=G
s+=A({x:o,y:s,w:l-=2*o,text_height:1.33*d,align:S.HWRAP|S.HFIT,text:r}).h
H.end(s)
R(g)
O()}var z
var V=null
function serverMotd(e){if(z!==e){V=null
z=e
o().send("world_global_get","motd",null,function(e,t){if(!e&&t)V=t})}return V}a.register({cmd:"motd_server_edit",help:"(Admin) Edit server MOTD",access_run:["sysadmin"],func:function func(e,r){o().send("world_global_get","motd",null,function(e,t){t=e||t||""
r()
s({title:"Server MOTD",edit_text:t,multiline:10,enforce_multiline:false,buttons:{Save:function Save(e){c().getChannel("global.global",false).send("motd_server_set",e,f().handle_cmd_parse_error)},Cancel:null}})})}})
function motdRun(){var e
var t=c().getMyUserChannel()
if(!t||!t.isFullySubscribed()||u()||_())return
if(g){if(!T)T=d(g).toString(16)
if(t.getChannelData("public.motd.client","")!==T)if(c().isFirstSession())motdDismiss("public.motd.client",T)
else return motdShow(E,C.DLG_MOTD_CLIENT_TITLE,g,"public.motd.client",T)}var r=String((null==(e=c().getCackAppData())?void 0:e.motdidx)||0)
if("0"!==r&&t.getChannelData("public.motd.server","0")!==r)if(c().isFirstSession())motdDismiss("public.motd.server",r)
else{var a=serverMotd(r)
if(a)return motdShow(E,C.DLG_MOTD_SERVER_TITLE,a,"public.motd.server",r)
else motdDismiss("public.motd.server",r)}var i=t.getChannelData("public.alerts",{})
var o=Number(t.getChannelData("public.motd.alert","0"))
var n=null
for(var s in i){var l=i[s]
if(l.id>o)if(!n||l.id<n.id)n=l}if(n)return motdShow(m,C.DLG_MOTD_ACCOUNT_TITLE,n.msg,"public.motd.alert",String(n.id))}},{"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/markdown":332,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/ui":367,"../glov/common/rand_alea":395,"../glov/common/util":400,"./localization/localization":131,"./main":135,"./main_menu":136,"./menu":140,"./styles":197,"./ui_util":205}],148:[function(e,t,r){"use strict"
r.enabled=enabled
r.set=set
r.unlock=unlock
r.toggle=toggle
r.PORTRAIT=r.LANDSCAPE=void 0
var a="landscape"
r.LANDSCAPE=a
var i="portrait"
r.PORTRAIT=i
var o=e("../glov/common/util.js").eatPossiblePromise
var n=window.screen
function enabled(){return n&&n.orientation}function getSimple(){return n.orientation.type.startsWith(i)?i:a}function set(e){if(enabled())try{if(getSimple()!==e)o(n.orientation.lock(e))}catch(e){}}function unlock(){if(enabled())try{o(n.orientation.unlock())}catch(e){}}function toggle(){if(enabled()){var e=getSimple()===a?i:a
try{o(n.orientation.lock(e))}catch(e){}}}},{"../glov/common/util.js":400}],149:[function(e,t,r){"use strict"
r.paletteGet=paletteGet
r.paletteRange=paletteRange
r.generateSwapKey=generateSwapKey
r.paletteIsSwapValid=paletteIsSwapValid
r.paletteSwap=paletteSwap
r.paletteGetOrLoad=paletteGetOrLoad
r.paletteSetMeshReloadCallback=paletteSetMeshReloadCallback
r.paletteStartup=paletteStartup
var _=e("assert")
var a=e("../glov/client/filewatch").filewatchOn
var i=e("../glov/client/webfs")
var l=i.webFSExists
var f=i.webFSGetFile
var o=i.webFSOnReady
var c=e("../glov/common/data_error").dataError
var u=e("../glov/common/util").clone
var s=e("../glov/common/verify")
var n=e("../glov/common/vmath").vec4
var d=e("./context").contextDebug
var v=e("./materials")
var h=v.INV_MATERIAL_NAME
var p=v.MATERIAL_CLASS
var m=v.MaterialClass
var E=e("./palette/ranges.json")
var g=e("./tiles")
var T=g.setMetalTints
var y=g.tileMapIdentityTinted
var S={}
function paletteGet(e){return S[e]}function swapKeyToNameAndSwaps(e){var t=e.split(";")
if(t.length>1){var i={}
t.slice(1).forEach(function(e){var t=e.split(","),r=t[0],a=t[1]
i[r]=a})
return[t[0],i]}return[e,null]}var I=n(1,0,1,1)
function paletteLoad(e){var t=f(e+".pal")
var r=t.length/3
var a=new ArrayBuffer(3*r*4)
var i=[I]
for(var o=0;o<r;++o){var n=new Float32Array(a,12*o,3)
for(var s=0;s<3;++s)n[s]=t[3*o+s]/255
i.push(n)}var l=E[e]||E.by_prefix[e.split("_")[0]]
if(l){i.tile_map=y(l.unlit||256,r)
var _=l.shiny
for(var c=0;c<_.length;++c){var u=_[c]
for(var d=u[0];d<=u[1];++d)i.tile_map.tile_override[d]=61}}S[e]=i}function paletteRange(e,t,r){if(!t)return null
var a=E[t]
if(a)return[S[a[0]],a[1],a[2]]
if("string"===typeof t){if(!(e=S[t])&&l(t+".pal")){paletteLoad(t)
e=S[t]}if(!e&&r&&l("generic_"+r+".pal"))if(!(e=S[t="generic_"+r])){paletteLoad(t)
e=S[t]}if(e)return[e,1,255]}if(d())_(false,"Missing palette range for "+JSON.stringify(t))
return null}function doSwap(e,t,r){if(s(t&&r)){var a=r[0]
var i=r[1]
for(var o=t[1];o<=t[2];++o){var n=i+o-t[1]
e[o]=a[n]
if(a.tile_map)e.tile_map.tile_override[o]=a.tile_map.tile_override[n]}}}function generateSwapKey(e,t){var r=e
var a=[]
for(var i in t)a.push(i+","+t[i])
a.sort()
if(a.length)r+=";"+a.join(";")
return r}function getSwapDestRange(e,t,r){var a
if(E[r])a=paletteRange(e,r)
else a=paletteRange(e,t+"_"+r,r)
return a}function paletteIsSwapValid(e,t,r){var a=paletteRange(e,t)
var i=getSwapDestRange(e,t,r)
return Boolean(a&&i)}function paletteSwap(e,t){var r=generateSwapKey(e,t)
if(S[r])return r
_(e)
var a=S[e]
_(a)
var i=a.slice(0)
i.tile_map=u(a.tile_map)
for(var o in t){var n=t[o]
var s=paletteRange(a,o)
if(!s)c('Encountered invalid palette source range: "'+o+'"')
var l=getSwapDestRange(a,o,n)
if(!l)c('Encountered invalid palette source range: "'+n+'"')
if(s&&l)doSwap(i,s,l)}S[r]=i
return r}function paletteGetOrLoad(e){var t=S[e]
if(t)return t
var r=swapKeyToNameAndSwaps(e),a=r[0],i=r[1]
if(i)paletteSwap(a,i)
else paletteLoad(e)
t=S[e]
_(t)
return t}var A
function paletteSetMeshReloadCallback(e){A=e}function paletteReload(){for(var e in S)if(!e.includes(";"))paletteLoad(e)
for(var t in S){var r=swapKeyToNameAndSwaps(t),a=r[0],i=r[1]
if(i){delete S[t]
paletteSwap(a,i)}}T(paletteGet("metal_tints"))
if(A)A()}function preprocessRanges(){for(var e in E)if(e.startsWith("MAT_")){var t=e.slice(4)
if(h[t])E[h[t]]=E[e]}for(var r in h){var a=h[r]
var i=p[a]
var o=m[i]
if(!i||!o)continue
o=o.toLowerCase()
var n=E[o]
if(!n)continue
var s=o+"_"+r.toLowerCase()
if(!l(s+".pal"))continue
if(!S[s])paletteLoad(s)
E[a]=[s,n[1],n[2]]}}function paletteStartup(){a(".pal",paletteReload)
o(function(){preprocessRanges()
paletteLoad("material")
paletteLoad("plant")
paletteLoad("character")
paletteLoad("metal_tints")
T(paletteGet("metal_tints"))})}},{"../glov/client/filewatch":314,"../glov/client/webfs":371,"../glov/common/data_error":381,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./context":45,"./materials":137,"./palette/ranges.json":150,"./tiles":199,assert:void 0}],150:[function(e,t,r){t.exports={skin:["character",233,240],hair:["character",241,244],eyes:["character",246,248],armor:["character",224,232],leather:["character",189,192],bones:["character",169,172],hollow:["character",165,168],detail:["character",161,164],metal:["material",1,8],generic:["character",185,188],metal_secondary:["character",229,232],metal_primary:["character",225,228],metal_detail:["character",221,224],torso_secondary:["character",213,216],torso_primary:["character",209,212],arms_secondary:["character",205,208],arms_primary:["character",201,204],legs_secondary:["character",197,200],legs_primary:["character",193,196],detail_secondary:["character",189,192],detail_primary:["character",185,188],MAT_LIGHT_WOOD:["material",89,96],MAT_RED_WOOD:["material",97,104],MAT_DARK_WOOD:["material",105,112],MAT_WOOD:["material",81,88],MAT_ANY:["material",81,88],MAT_FLINT:["material",9,16],MAT_ROCK:["material",57,64],MAT_STONE:["material",73,80],MAT_FANCY_STONE:["material",65,72],MAT_GOLD:["material",1,8],MAT_IRON:["material",9,16],MAT_REGULAR:["material",9,16],MAT_AETHERSTEEL:["material",17,24],MAT_SUPER:["material",17,24],dry:["plant",0,250],MAT_ANY_INGREDIENT:["plant",7,8],MAT_BREAD:["material",86,87],MAT_RED_BERRY:["plant",51,52],MAT_BLUE_BERRY:["plant",55,56],MAT_YELLOW_BERRY:["plant",53,54],MAT_BROWN_MUSHROOM:["plant",3,4],MAT_LUMINESCENT_MUSHROOM:["plant",249,250],MAT_RED_MUSHROOM:["plant",52,53],MAT_CORAL_MUSHROOM:["plant",115,116],MAT_LABEL:["plant",26,27],MAT_HOT:["plant",52,53],MAT_PUNGENT:["plant",64,65],MAT_SAVORY:["plant",69,70],MAT_CARROT:["plant",34,35],MAT_PUMPKIN:["plant",83,84],MAT_TOMATO:["plant",57,58],MAT_CORN:["plant",54,55],MAT_STARFISH:["plant",34,35],MAT_ANEMONE:["plant",55,56],MAT_RED:["plant",51,52],MAT_ORANGE:["plant",34,35],MAT_YELLOW:["plant",64,65],MAT_GREEN:["plant",12,13],MAT_BLUE:["plant",55,56],MAT_PURPLE:["plant",69,70],plant:{shiny:[[233,240]],unlit:249},character:{shiny:[[217,232]],unlit:249},material:{shiny:[[1,40],[221,223]],unlit:249},by_prefix:{metal:{shiny:[[1,8]]}}}},{}],151:[function(e,t,r){"use strict"
r.resetRotation=resetRotation
r.doPaperDoll=doPaperDoll
var f=e("gl-mat4/lookAt")
var l=e("../glov/client/camera2d").virtualToCanvas
var a=e("../glov/client/engine")
var v=a.getFrameDt
var h=a.getFrameTimestamp
var _=a.needDepthIn2D
var p=a.renderHeight
var m=a.setupProjection
var i=e("../glov/client/input")
var c=i.click
var u=i.drag
var d=i.mousePos
var o=e("../glov/client/net")
var I=o.netSubs
var A=o.netUserId
var n=e("../glov/client/quat")
var s=n.qFromAxisAngle
var E=n.qFromYPR
var g=n.quat
var T=e("../glov/client/snapshot")
var y=T.viewportRenderFinish
var S=T.viewportRenderPrepare
var w=e("../glov/client/spot")
var L=w.SPOT_DEFAULT_BUTTON
var O=w.spot
var R=e("../glov/client/sprites")
var b=R.spriteCreate
var N=R.spriteQueueFn
var C=e("../glov/client/ui").drawElipse
var x=e("../glov/client/ui")
var M=e("../glov/common/util")
var D=M.clamp
var P=M.lerp
var B=e("../glov/common/vmath")
var k=B.mat4
var U=B.rovec4
var G=B.v2floor
var F=B.v2sub
var W=B.vec2
var H=B.vec3
var z=B.vec4
var V=B.zaxis
var Y=e("./animation_enum").AnimEnum
var j=e("./animation_player").animationDrawPlayer
var K=e("./camera").setViewParameters
var q=e("./character_customization")
var X=q.handleBottomButton
var Q=q.renamePrompt
var $=e("./client_entities").allocPerEntData
var J=e("./cosmetics").getPreviewCostume
var ee=e("./costume_edit")
var te=ee.costumeCurrent
var re=ee.costumeCurrentMod
var ae=ee.costumePreviewActive
var ie=ee.incrementCurCostumeMod
var oe=e("./inventory_ui")
var ne=oe.doPaperDollInventoryOverlay
var se=oe.handlePaperdollDragAndDrop
var le=e("./localization/localization").L
var _e=e("./main").toggleMenuPage
var ce=e("./menu")
var ue=ce.CHARACTER_CUSTOMIZATION
var de=ce.menuDoTransition
var fe=e("./mobs").createEntDrawData
var ve=e("./props")
var he=ve.restoreGlobalState
var pe=ve.saveGlobalState
var me=e("./styles")
var Ee=me.floater_style_shadow
var ge=me.floater_style_shadow_focused
var Te=e("./ui_util")
var ye=e("./ui_util_2")
var Se=e("./user_data").worldReadOnly
var Ie=e("./voxel_data")
var Ae=Ie.applyBevelParamCharacters
var we=Ie.applyBevelParamWorld
var Le=Ie.applyBevelValue
var Oe=Math.atan2,Re=Math.cos,be=Math.PI,Ne=Math.sin,Ce=Math.random
var xe=U(1,1,1,.5)
var Me=z(0,0,0,1)
var De={char_ul:W(),char_lr:W(),mouse_offs:W(),fall_time:0,rot:0,yaw:0,pitch:0,ped:null,draw_data:null,local_pos:H(0,0,0),quat:s(g(),V,be)}
var Pe
var Be
var ke
function getSprites(){Pe=Te.sprite
Be=b({url:"img/ui/floor_shadow.png",filter_min:gl.LINEAR,filter_mag:gl.LINEAR,origin:W(.5,.5),color:Me})}var Ue=false
function paperdollStartup(){getSprites()
ke=x.font
Ue=true
De.draw_data=fe()}function resetRotation(){De.rot=0}var Ge=[le.LBL_GREETING_1,le.LBL_GREETING_2,le.LBL_GREETING_3]
var Fe
function drawClickableDisplayName(e,t,r,a,i,o){var n=I().loggedIn()
if(n){var s=I().getChannel("user."+n).getChannelData("public.display_name",void 0)||n
if(o&&!Fe)Fe=Ge[Math.floor(Ce()*Ge.length)]
var l=O({def:L,x:e-.5*a,y:t,w:a,h:i,button:0})
var _=l.focused?ge:Ee
x.font.drawSizedAligned(_,e-a/2,t,r,i,x.font.ALIGN.HCENTERFIT,a,0,o?le.$(Fe,s):s)
if(l.ret)Q(s)}}var We=""
function drawSelfForPaperdoll(e,t,r){Le(true,true)
Ae()
if(We!==r.name){ie()
We=r.name}if(!De.ped)De.ped=$()
De.draw_data.costume_mod=re()
De.ped.anim_state.anim=e||Y.IDLE
j(De.draw_data,De.ped,r,De.local_pos,De.quat,t)
we()
Le()}var He=function(){var s=60/180*be
var l=k()
var _=H(0,0,1.8)
var c=4
var e=1.7
var u=H(0,4,_[2]+e)
var d=g()
return function(e){u[0]=Ne(De.rot+be)*c
u[1]=Re(De.rot+be)*c
var t=De.char_lr[0]-De.char_ul[0]
var r=De.char_lr[1]-De.char_ul[1]
S({pre:pe,viewport:[De.char_ul[0],p()-De.char_lr[1],t,r]})
m(s,t,r,.1,100)
f(l,u,_,V)
K(l,true)
gl.clear(gl.DEPTH_BUFFER_BIT)
var a=Y.IDLE
if(De.fall_time&&h()-De.fall_time<250)a=Y.FALL
var i=Oe(De.mouse_offs[0],1500)-De.rot
if(i<-be)i+=2*be
if(i>be)i-=2*be
var o=D(i,-.75,.75)
De.yaw=P(.002*v(),De.yaw,o)
var n=D(Oe(-De.mouse_offs[1],2500)+.1,-.15,.2)
De.pitch=P(.001*v(),De.pitch,n)
E(d,be+De.yaw,De.pitch,0)
drawSelfForPaperdoll(a,d,e)
y({post:he})}}()
function doInteractivePreview(e,t,r,a,i,o){d(De.mouse_offs)
F(De.mouse_offs,De.mouse_offs,[e+r/2,t+r/2])
l(De.char_ul,[e,t])
l(De.char_lr,[e+r,t+a])
G(De.char_ul,De.char_ul)
G(De.char_lr,De.char_lr)
_()
N(Z.PAPERDOLL,He.bind(null,o))
var n=c({x:e,y:t,w:r,h:a,button:0})
if(null!=n&&n.was_double_click&&i){de()
_e(ue)}var s=u({x:e,y:t,w:r,h:a})
if(s){De.rot+=.005*s.delta[0]
if(s.delta[0]/v()>7)De.fall_time=h()
while(De.rot<0)De.rot+=2*be
while(De.rot>2*be)De.rot-=2*be}}var ze=null
function doPaperDoll(e,t){if(!Ue)paperdollStartup()
var r=e.costume||null
if(r!==ze){ie()
ze=r}var a=e.x,i=e.y,o=e.w,n=e.h,s=e.button_h
var l=Z.PAPERDOLL+1
if(e.draw_elipse)C(a,i,a+o,i+n,Z.PAPERDOLL-1,0,xe)
ae()
var _=0
if(e.no_name);else if(e.is_customization){var c=I().getMyUserChannel()
var u=c&&c.getChannelData("public.display_name",void 0)||A()||"?"
var d=48*s/64
var f=s
var v=(f-d)/2
var h=i+8
var p=a+8+(_=o-f-24)/2+ke.drawSizedAligned(Ee,a+8,h+v,l,d,ke.ALIGN.HCENTERFIT,_,0,u)/2+8
if(x.buttonImage({x:p,y:h,z:l,img:Pe,frame:Te.EDIT,w:f,h:f,tooltip:le.TLTP_CHANGE_NAME}))Q(u)}else drawClickableDisplayName(a+.5*o,i,l,o,.75*s,!t)
if(t&&!Se())ne(e,t)
se(e)
if(!e.draw_elipse&&Be.texs[0].loaded){var m={x:a+.5*o,y:i+.8*n,w:.8*o,h:.5*o,z:Z.UI}
Be.draw(m)}if(e.is_customization||t){var E=a+.1*o
var g=.8*o
var T=s
var y=i+n-T
if(e.is_customization)X({x:E,y:y=i+1.25*n-T,z:l,w:g,h:T})
else if(x.button({x:E,y:y,w:g,h:T,font_height:.8*T,text:le.BTN_OUTFIT,img:ye.sprite,frame:ye.BTNICON_OUTFIT,hook:"new_cosmetic"})){de()
_e(ue)}}var S=e.costume?e.costume:e.is_customization?J():te()
doInteractivePreview(a,i,o,n,!e.is_customization&&!e.no_customize,S)}},{"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/quat":346,"../glov/client/snapshot":356,"../glov/client/spot":361,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./animation_enum":9,"./animation_player":10,"./camera":35,"./character_customization":39,"./client_entities":44,"./cosmetics":64,"./costume_edit":65,"./inventory_ui":115,"./localization/localization":131,"./main":135,"./menu":140,"./mobs":145,"./props":171,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./voxel_data":216,"gl-mat4/lookAt":void 0}],152:[function(e,t,r){"use strict"
r.getParticleSystem=getParticleSystem
r.shift=shift
r.updateParticleSystems=updateParticleSystems
r.createParticleSystemWithOwner=createParticleSystemWithOwner
r.createDetachedParticleSystem=createDetachedParticleSystem
r.createDetachedParticlesFromList=createDetachedParticlesFromList
r.particleStartup=particleStartup
r.ParticleSystem=void 0
var s=e("assert")
var a=e("../glov/common/util.js")
var i=a.ridx
var o=a.sign
var n=e("../glov/client/quat.js"),l=n.quat,_=n.qFromAxisAngle,c=n.qTransformVec3,u=n.qMult
var d=e("../glov/common/vmath.js"),f=d.vec3,v=d.v3add,h=d.v3copy,p=d.v4copy,m=d.mat4,E=d.zaxis,g=d.v3sub,T=d.v3set,y=d.v3iAdd,S=d.vec4,I=d.v4set,A=d.v3scale
var w=Math.abs,L=Math.floor,O=Math.PI,R=Math.min
var b=e("./debug.js")
var N=e("../glov/client/engine.js")
var C=e("../glov/client/filewatch.js").filewatchOn
var x=e("./palette.js").paletteRange
var M=e("./proc_gen_biomes.js").getVSTintColors
var D=e("./tiles.js"),P=D.MAT_METAL_TINT,B=D.tile_colors
var k=e("../glov/client/webfs.js").webFSGetFile
var U=e("../glov/client/geom.js").geomCreateQuads
var G=e("../glov/client/shaders.js"),F=G.SEMANTIC,W=G.shadersBind,H=G.shaderCreate,z=G.shadersPrelink
var V=e("./voxel_data.js")
var Y=V.getPropLighting2Prop,j=V.getPropLighting,K=V.propInWorld
var q=e("../glov/client/mat4ScaleRotateTranslate.js")
var Z=e("gl-mat4/multiply")
var X=255
var Q=72
var $=0
var J=1
var ee=2
var te=3
var re=true
var ae=[]
var ie={}
var oe={}
var ne=0
var se=l()
var le=f()
var _e=0
var ce=0
var ue=0
var de=0
var fe={}
var ve=S()
var he
var pe
var me
var Ee=m()
function getParticleSystem(e){if(!ie[e.name])ie[e.name]=k("particles/"+e.name,"jsobj")
return ie[e.name]}var ge=function(){function ParticleSystem(e){this.name=e.name
this.system=getParticleSystem(e)
this.position=f()
this.generation=0
this.stage=$
this.quat_rot=l(0,0,0,0)
this.owner_prop=null
this.raw_position=f()
this.start=0
this.end=0
this.offset_position=f()
this.last_update_frame=0
this.time=0}var e=ParticleSystem.prototype
e.initParticles=function initParticles(e,t){this.random_seed=Math.random()
if(!oe[this.name])oe[this.name]=new Float32Array(this.system.mega_array)
this.mega_array=oe[this.name]
if(void 0!==e&&e>=0){this.mega_array=oe[this.name].slice(0)
for(var r=0;r<t.length;r++)this.mega_array[r+e]=t[r]}this.system_lifetime="infinity"===this.system.system_lifetime?Infinity:this.system.system_lifetime
this.end=this.system.particle_amount}
e.updateParticles=function updateParticles(e){if(this.last_update_frame===N.frame_index)return
this.last_update_frame=N.frame_index
if(this.generation!==ne)this.updateGeneration()
this.time+=e*(this.stage===ee&&this.system.kill_time_accel||1)
var t=this.stage===ee?this.time_of_death-this.time_of_death%this.system.max_age:this.system_lifetime-this.system_lifetime%this.system.max_age
if(this.time>t){var r=(this.time-t)/this.system.max_age*this.system.particle_amount
this.start=L(r+2)
if(this.start>this.system.particle_amount)this.stage=te}else this.start=0
if(!this.system.burst)this.end=L(this.system.particle_amount*R(this.time/this.system.max_age,1))}
e.updateGeneration=function updateGeneration(){this.system=ie[this.name]
this.initParticles()
this.generation=ne}
e.killParticles=function killParticles(){this.stage=ee
this.time_of_death=this.time+this.system.max_age}
e.addParticleSystemToQueue=function addParticleSystemToQueue(){if(re)ae.push(this)
return this}
e.fitToOwner=function fitToOwner(e,t){if(this.raw_position[0]===t[0]&&this.raw_position[1]===t[1]&&this.raw_position[2]===t[2])return
h(this.position,t)
if("object"===typeof e){p(se,e)
if(!this.system.no_world_rotate)p(this.quat_rot,se)}else if(e)_(se,E,e*O/2)
else I(se,0,0,0,0)
c(le,this.offset_position,se)
v(this.position,this.position,le)
h(this.raw_position,t)}
e.drawCubes=function drawCubes(){q(Ee,1,this.quat_rot,this.position)
Z(Ee,N.mat_view,Ee)
var e=1
var t=1
if(this.owner_prop){if(!K(this.owner_prop))return
Y(this.owner_prop)
e=this.owner_prop.draw_opts.sun_factor
t=this.owner_prop.draw_opts.torch_factor}else{j(fe,this.position)
e=fe.sun_factor
t=fe.torch_factor}I(ve,this.time,e,t,this.random_seed)
var r={time_light:ve,mega_array:this.mega_array,prv_matrix:Ee}
W(pe,me,r)
he.drawSub(6*this.start*6,12*(this.end-this.start))}
e.updateParticleSystemOwner=function updateParticleSystemOwner(e,t){if(N.defines.NOPARTICLES||!re)return
var r=N.frame_dt
if(t&&!this.detached)this.fitToOwner(e,t)
this.updateParticles(r)
this.drawCubes()
if(N.defines.PARTICLEDEBUG){_e++
if(this.system.particle_amount)ce+=this.system.particle_amount
if(this.time<=r)ue++
if(this.stage>=ee)de++}}
e.detach=function detach(){this.addParticleSystemToQueue()
this.detached=true
this.killParticles()}
return ParticleSystem}()
r.ParticleSystem=ge
function reload(e){var t=e.split("/")
t=t[t.length-1]
ie[t]=k(e,"jsobj")
oe=[]
ne++}function shift(e){for(var t=0;t<ae.length;t++){y(ae[t].position,e)
y(ae[t].raw_position,e)}}function updateParticleSystems(){if(N.defines.NOPARTICLES||!re)return
profilerStart("updateParticleSystems")
var e=N.frame_dt
for(var t=ae.length-1;t>=0;t--){if(!ae[t])continue
ae[t].updateParticles(e)
if(ae[t].stage===J)ae[t].killParticles()
if(ae[t].stage===te)i(ae,t)
else ae[t].drawCubes()}if(N.defines.PARTICLEDEBUG){for(var r=0;r<ae.length;r++){if(ae[r].system.particle_amount)ce+=ae[r].system.particle_amount
if(ae[r].time<=e)ue++
if(ae[r].stage>=ee)de++}_e+=ae.length
b.addText(["Particle systems: "+_e,"Amount of particles: "+ce,"Amount of dying systems: "+de,"Amount of new systems this frame: "+ue].join("\n"))
de=ue=ce=_e=0}profilerStop("updateParticleSystems")}function createParticleSystemWithOwner(e,t,r){var a=new ge(t)
if(t.offset_position)h(a.offset_position,t.offset_position)
if(t.rot)_(a.quat_rot,E,t.rot*O)
if(r&&!a.system.no_world_rotate)u(a.quat_rot,a.quat_rot,r)
if(!a.detached)a.owner_prop=e
a.initParticles()
return a}var Te=f()
var ye=[_(l(),E,0),_(l(),E,O/2),_(l(),E,O),_(l(),E,O+O/2)]
function quatFaceAxisSnapped(e,t){g(Te,e,t)
var r=w(Te[0])>w(Te[1])?0:1
var a=o(Te[r])
var i=r?1:0
return ye[i+=a>0?2:0]}var Se=f(1,.65,.3)
function createDetachedParticleSystem(e,t,r,a){var i=new ge(t)
i.detached=true
h(i.position,e)
if(t.offset_position)h(i.offset_position,t.offset_position)
if(r)p(i.quat_rot,quatFaceAxisSnapped(e,r))
else _(i.quat_rot,E,t.rot*O)
if(a){T(Se,1,.65,.3)
var o
if(a.tile_data){if(a.tile_data.tint_color)h(Se,a.tile_data.tint_color)
else if(P[a.tile_material])h(Se,P[a.tile_material])
else if(a.tile_data.tint){var n=V.getVDFromLocalPos(a.pos)
if(!n)s(false,"Missing vd : target.pos="+a.pos+", position="+e+", orig="+r+".")
h(Se,M(n.vsid,n.pos_world,a.tile_data.tint,true))}else if(B[a.tile])A(Se,B[a.tile],1/255)
else if(a.tile_data.mat&&(o=x(null,a.tile_data.mat)))h(Se,o[0][o[1]])}else if(a.tile_material&&P[a.tile_material])h(Se,P[a.tile_material])
else if(a.tile_material&&(o=x(null,a.tile_material)))h(Se,o[0][o[1]])
i.initParticles(Q,Se)}else i.initParticles()
i.addParticleSystemToQueue()
return i}var Ie=f()
function createDetachedParticlesFromList(e,t,r,a){for(var i=0;i<t.length;i++){if(t[i].offset_position)v(Ie,e,t[i].offset_position)
else h(Ie,e)
createDetachedParticleSystem(Ie,t[i],r,a)}}function disableParticles(){re=false}function createParticleCubes(){pe=H({filename:"shaders/particles.vp",non_fatal:true})
me=H("shaders/particles.fp")
if(!pe.valid)disableParticles()
else z(pe,me,void 0,disableParticles)
var e=[]
for(var t=0;t<X;t++)e.push(0,1,1,t,1,1,2,t,0,0,1,t,1,1,2,t,1,0,1,t,1,1,2,t,1,1,1,t,1,1,2,t,1,1,0,t,1,1,0,t,1,0,0,t,1,1,0,t,0,0,0,t,1,1,0,t,0,1,0,t,1,1,0,t,1,1,1,t,1,2,1,t,1,1,0,t,1,2,1,t,0,1,0,t,1,2,1,t,0,1,1,t,1,2,1,t,0,0,1,t,1,0,1,t,0,0,0,t,1,0,1,t,1,0,0,t,1,0,1,t,1,0,1,t,1,0,1,t,1,0,1,t,2,1,1,t,1,0,0,t,2,1,1,t,1,1,0,t,2,1,1,t,1,1,1,t,2,1,1,t,0,1,1,t,0,1,1,t,0,1,0,t,0,1,1,t,0,0,0,t,0,1,1,t,0,0,1,t,0,1,1,t)
he=U([[F.POSITION,gl.UNSIGNED_BYTE,4,false],[F.NORMAL,gl.UNSIGNED_BYTE,4,false]],new Uint8Array(e))}function particleStartup(){C(/^particles\//,reload)
createParticleCubes()}},{"../glov/client/engine.js":305,"../glov/client/filewatch.js":314,"../glov/client/geom.js":318,"../glov/client/mat4ScaleRotateTranslate.js":336,"../glov/client/quat.js":346,"../glov/client/shaders.js":353,"../glov/client/webfs.js":371,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./debug.js":73,"./palette.js":149,"./proc_gen_biomes.js":163,"./tiles.js":199,"./voxel_data.js":216,assert:void 0,"gl-mat4/multiply":void 0}],153:[function(e,t,r){"use strict"
r.worldUserBuildAccessCacheClear=worldUserBuildAccessCacheClear
r.partyGrantAccess=partyGrantAccess
r.partyMembersNeedingAccess=partyMembersNeedingAccess
r.partyPanel=partyPanel
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("../glov/client/engine")
var v=e("../glov/client/font").ALIGN
var h=e("../glov/client/input").inputDrag
var o=e("../glov/client/net").netDisconnected
var i=e("../glov/client/ui")
var p=i.buttonText
var m=i.panel
var E=i.uiGetFont
var g=i.uiTextHeight
var n=e("../common/world_constants").THRESHOLD_ACCESS_MODIFY
var T=e("./localization/localization").L
var s=e("./main")
var y=e("./menu")
var l=e("./menu_ribbon").pushMenuRibbonElement
var _=e("./styles")
var S=_.menu_header_style
var I=_.menu_style
var A=e("./user_info_view").userInfoGet
var c=e("./user_party")
var w=c.partyGetExternalDisplayName
var d=c.partyGetParticipants
var f=c.partyIsActive
var u=e("./world_comm")
var L=u.getWorldChannel
var O=u.worldGetClients
var R=u.worldGetRoles
var b=u.worldPak
var N=e("./world_info_view")
var C=N.accessRank
var x=N.refreshUserAndAccessList
var M=N.worldCmdParseGated
var D={}
var P={}
function worldUserBuildAccessCacheClear(){D={}
P={}}function worldCheckUserBuildAccess(a){if(o()||!L())return true
var i=D[a]
if(i){if(i.fetching)return true
return i.access_level>=n}i=D[a]={fetching:true,access_level:0}
var e=b("get_access")
e.writeAnsiString(a)
e.send(function(e,t){i.fetching=false
if(e){if(i===D[a])delete D[a]
return void s.chat_ui.addChatError(e)}t.readInt()
var r=t.readAnsiString()
i.access_level=C(r)})
return true}function postGrantAccess(e){delete P[e]
delete D[e]
x()}var B=14
var k=8
var U=100
var G=130
var F=B+G+2*(k+U)+B
var W=42
function partyGrantAccess(e){P[e]=2
M("world_access "+e+" BUILDER",postGrantAccess.bind(null,e))}function drawPartyPanel(e,t,r){var a=t+B
var i=r+B
var o=F-2*B
var n=Z.MENUBUTTON
var s=.75*g()
var l=E()
i+=l.draw({size:s,style:I,x:a,y:i,z:n,w:o,align:v.HWRAP|v.HCENTER,text:T.LBL_PARTY_PLAYERS_WAITING})+k
for(var _=0;_<e.length;++_){var c=e[_].user_id
var u=A(c).display_name
var d=w(c)
if(d)u=u+"\n"+T.addParentheses(d)
l.draw({size:s,style:S,x:a,y:i,z:n,w:G,h:W,align:v.HFIT|v.VCENTER|v.HRIGHT|v.HWRAP,text:u})
if(p({x:a+o-2*U-k,y:i,z:n,w:U,h:W,text:T.BTN_MAKE_BUILDER}))partyGrantAccess(c)
if(p({x:a+o-U,y:i,z:n,w:U,h:W,text:T.BTN_DISMISS}))P[c]=1
i+=W+k}var f={x:t,y:r,w:F,h:(i+=B)-r}
h(f)
m(_extends({},f,{z:n-1,pixel_scale:.5,color:y.panel_color_popup}))}function partyMembersNeedingAccess(e){if(!f()||!L()||!R().world_admin)return[]
var t=O()
var r={}
var a={}
for(var i in t){var o=t[i].ids
if(!o||!o.user_id||!o.roles)continue
var n=o.user_id
if(o.roles.world_areabuilder)r[n]=true
else a[n]=true}var s=[]
var l=d()
for(var _=0;_<l.length;++_){var c=l[_]
var u=c.user_id
if(r[u]);else if((P[u]||0)>(e?0:1));else if(a[u])s.push(c)
else if(!worldCheckUserBuildAccess(u))s.push(c)}return s}function partyPanel(){var e=partyMembersNeedingAccess(true)
if(!a.defines.NOUI&&e.length)l({w:F,cb:drawPartyPanel.bind(null,e)})}},{"../common/world_constants":267,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/ui":367,"./localization/localization":131,"./main":135,"./menu":140,"./menu_ribbon":141,"./styles":197,"./user_info_view":210,"./user_party":211,"./world_comm":226,"./world_info_view":231}],154:[function(e,t,r){"use strict"
r.PhotoController=void 0
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../glov/client/engine.js")
var n=e("../glov/client/ui.js").isMenuUp
var a=e("../glov/common/vmath.js")
var s=a.v3copy
var i=a.vec3
var l=e("./base_controller.js")
var _=l.BaseController
var c=l.MAX_STEP_DT
var u=l.MAX_TIMESLICE
var d=e("./camera.js").getActiveController
var f=e("./character_controller.js")
var v=f.CC_BASE_SPEED
var h=f.CC_FLY_FACTOR
var p=f.CC_SPRINT_FACTOR
var m=e("./controller_common.js")
var E=m.movementShared
var g=m.rotationShared
var T=m.updateFacing
var y=e("./controller_components/debug_comp").DebugComponent
var S=e("./controller_modes/mode_common.js")
var I=S.PHTMOVE_ID
var A=S.clampPhotoPosition
var w=e("./controller_modes/phtmove_mode.js").PhotoMoveMode
var L=e("./photo_mode")
var O=L.getPhotoStartPosition
var R=L.photoModeActive
var b=e("./state_machine.js").StateMachine
var N=Math.min
var C=.6
var x=function(t){_inheritsLoose(PhotoController,t)
function PhotoController(){var e;(e=t.call(this,{col_bounds:{min:i(-C,-C,-C),max:i(C,C,C)},eye_height:C},v*h)||this).csm=void 0
e.debug_comp=void 0
e.camera_pos=i()
e.is_tpv=true
e.sprint_speed_factor=p
e.flying=true
e.can_doublejump_to_fly=false
e.csm=new b(_assertThisInitialized(e),[w],I)
e.debug_comp=new y(_assertThisInitialized(e))
return e}var e=PhotoController.prototype
e.getParamsFromController=function getParamsFromController(e){s(this.pos,e.camera_pos)
s(this.ypr,e.ypr)
s(this.facing,e.facing)
s(this.char_right,e.char_right)
s(this.char_up,e.char_up)
this.auto_run=e.auto_run
this.blocked_accum=e.blocked_accum
this.blocked_frames=e.blocked_frames
this.blocked_target=e.blocked_target
s(this.vel,e.vel)}
e.setPos=function setPos(e){if(R())A(e,O())
t.prototype.setPos.call(this,e)}
e.updateAndGetCameraPos=function updateAndGetCameraPos(){s(this.camera_pos,this.pos)
return this.getCameraPos()}
e.isAerial=function isAerial(){return true}
e.update=function update(e){if(n())e=false
var t=N(o.frame_dt,u)
var r=E(this,t,e)
if(e)g(this,t)
T(this)
if(t>0){var a=t
while(a>0){var i=N(a,c)
this.csm.tick({dt:i,impulse:r})
a-=i}}if(o.defines.CAMERA&&d()===this){this.setDebugFloorInfo()
this.addControllerDebugText()}s(this.camera_pos,this.pos)}
e.addControllerDebugText=function addControllerDebugText(){this.debug_comp.addControllerDebugText()}
e.setDebugFloorInfo=function setDebugFloorInfo(){this.debug_comp.setDebugFloorInfo()}
return PhotoController}(_)
r.PhotoController=x},{"../glov/client/engine.js":305,"../glov/client/ui.js":367,"../glov/common/vmath.js":402,"./base_controller.js":20,"./camera.js":35,"./character_controller.js":37,"./controller_common.js":49,"./controller_components/debug_comp":52,"./controller_modes/mode_common.js":58,"./controller_modes/phtmove_mode.js":59,"./photo_mode":158,"./state_machine.js":192}],155:[function(e,t,r){"use strict"
r.photoLibraryViewInit=photoLibraryViewInit
r.photoLibraryDirty=photoLibraryDirty
r.photoLibraryView=photoLibraryView
var S=e("../glov/client/font").ALIGN
var a=e("../glov/client/net")
var i=a.netDisconnected
var o=a.netSubs
var I=a.netUserId
var A=e("../glov/client/scroll_area").scrollAreaCreate
var n=e("../glov/client/ui")
var w=n.buttonImage
var L=n.suppressNewDOMElemWarnings
var O=n.uiButtonHeight
var R=n.uiGetFont
var b=n.uiGetTitleFont
var N=n.uiTextHeight
var C=e("./localization/localization").L
var s=e("./main").chatUI
var l=e("./menu")
var x=l.menuX1
var M=l.menuY1
var D=e("./photo_list").photoListShow
var _=e("./styles")
var P=_.color_black
var B=_.loading_style
var k=_.menu_header_style
var U=e("./ui_util")
var G=e("./ui_util_2")
var c=e("./world_comm").myUserCmdParse
var F
var W=null
var H=true
var u=false
var z=1
var V={CREATED:function CREATED(e,t){var r=W[e]
var a=W[t]
var i=a.created-r.created
if(i)return z*i
i=Number(r.world)-Number(a.world)
return z*i},WORLD:function WORLD(e,t){var r=W[e]
var a=W[t]
var i=Number(r.world)-Number(a.world)
if(i)return z*i
i=a.created-r.created
return z*i}}
var Y="CREATED"
function photoLibraryViewInit(){}var j
function photoLibraryDirty(){H=true
Y="CREATED"
z=1
if(j)j.resetScroll()}function photoListFetch(){if(u||i()||!o().loggedIn())return
H=false
u=true
c("photo_list",function(e,t){s().handleCmdParseError(e)
u=false
W=t||null})}var K=0
function photoLibraryView(e){if(I()!==F){F=I()
H=true}if(H)photoListFetch()
var t=0
var r=x()
var a=M()
var i=Z.UI
var o=r-t
var n=a-e
var s=R()
var l=b()
var _=N()
var c=O()
if(!W){s.drawSizedAligned(B,t,e,i,_,S.HVCENTER,o,2*n/3,C.MSG_LOADING)
return null}var u=t
var d=e
var f=2*_
var v=8
d+=_/2
l.drawSizedAligned(k,u+v,d,i,f,S.VCENTER,o,c,C.LBL_MY_PHOTO_LIBRARY)
u=t+o-2*c-3*v
var h=.5*c
U.sprite.draw({x:u-h-v,y:d+(c-h)/2,z:i,w:h,h:h,frame:U.SORT})
function sortButton(e,t){t.x=u
t.y=d
t.w=c
t.img_color=P
var r=Y===e
t.base_name=r?"inv_selected":void 0
if(w(t))if(Y===e)z=-z
else{Y=e
z=1}u+=c+v}sortButton("CREATED",{img:G.sprite,frame:G.CALENDAR,tooltip:C.TLTP_SORT_BY_TIMESTAMP})
sortButton("WORLD",{img:G.sprite,frame:G.WORLD,tooltip:C.TLTP_SORT_BY_WORLD})
d+=c
if(!j)j=A({z:i,background_color:null,auto_hide:true})
j.keyboardScroll()
var p={x:t,y:d,w:o,h:a+5-d}
var m=j.getScrollPos()
var E=m+p.h
j.begin(p)
var g={all_photos:W,y_min:m,y_max:E,dims:{y:d=16,y0:e,w:o,x_mid:(u=0)+o/2},scroll_param:p,show_details:"WORLD"===Y?"world":"date",ctx:"library"}
var T=Object.keys(W)
T.sort(V[Y])
d=D(g,T)
d+=60
j.end(d)
d=p.y+p.h
var y=j.getScrollPos()
if(K!==y){L()
K=y}return null}},{"../glov/client/font":315,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/ui":367,"./localization/localization":131,"./main":135,"./menu":140,"./photo_list":157,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./world_comm":226}],156:[function(e,t,r){"use strict"
r.photoLinkUIStartup=photoLinkUIStartup
r.photoLinkCalcHeight=photoLinkCalcHeight
r.photoLinkUI=photoLinkUI
var D=e("assert")
var a=e("../glov/client/engine")
var P=a.getFrameDt
var o=a.getFrameIndex
var B=e("../glov/client/font").ALIGN
var k=e("../glov/client/link").link
var i=e("../glov/client/textures").textureLoad
var n=e("../glov/client/ui")
var U=n.buttonShared
var G=n.drawRect
var F=n.uiGetFont
var s=e("../glov/client/urlhash")
var W=s.getLinkURL
var H=s.goRoute
var z=e("../glov/common/util").easeOut
var l=e("../glov/common/verify")
var _=e("../glov/common/vmath")
var V=_.v4lerp
var c=_.vec4
var Y=e("../common/store_data").PHOTO_SHOWCASE_EXPAND
var u=e("./layout")
var j=u.PHOTOUI_COST_H
var K=u.PHOTOUI_FRAME_PAD
var q=u.PHOTOUI_SHADOW_OFFSET
var X=u.PHOTOUI_TITLE_H
var Q=e("./localization/localization").L
var $=e("./menu").menuDoTransition
var d=e("./photo_ui")
var J=d.PHOTO_INVALID
var ee=d.PHOTO_LOADING
var te=d.photoInfoGet
var f=e("./store")
var re=f.gameCurrencyPurchase
var ae=f.getProductIdOrbCost
var v=e("./styles")
var ie=v.color_photo_frame_error
var oe=v.color_photo_frame_extra
var ne=v.color_photo_frame_shadow
var se=v.color_white
var le=v.menu_header_style
var _e=v.style_orbs
var ce=e("./ui_util")
var h=e("./waygate_ui")
var ue=h.LINKUI_GROW_SIZE
var de=h.LINKUI_HOVER_RATE
var fe=h.linkUIDrawTextureFadeAndSheen
var ve=h.sheen_color_active
var he=h.sheen_color_idle
var pe=h.sheen_uvs_active
var me=h.sheen_uvs_idle
var p=h.userTextureLoad
var Ee=Math.max,ge=Math.min
var Te
var ye
function photoLinkUIStartup(){ye={thumb:i(p("img/placeholder/photo_thumb.png")),extra_slot:i(p("img/placeholder/extra_photo_thumb.png"))}}var m={}
function getState(e,t){var r=o()
var a=["plui",e,t].join("_")
var i=m[a]
if(!i)i=m[a]={key:a,color:c(),uvs:c(),active:0,reset:true}
l(i.frame!==r)
if(i.frame!==r-1){i.active=0
i.reset=true}else i.reset=false
i.frame=r
return i}function photoLinkCalcHeight(e,t,r){var a=K*(t=t||.3)
return(e-2*a)*("thumb"===r?1:.75)+2*a+X*t}function photoLinkWidthForHeight(e,t,r){var a=K*t
return(e-(2*a+X*t))/("thumb"===r?1:.75)+2*a}function photoTexture(e,t){var r=e.img[t].url
D(r)
return p(r)}function photoLinkUI(e){profilerStart("photoLinkUI")
var t=e.photo_id,r=e.x,a=e.y,i=e.z,o=e.w,n=e.h,s=e.max_grow,l=e.img_style,_=e.ctx,c=e.border_scale
i=i||Z.UI
s=s||ue
l=l||"thumb"
c=c||.3
if(!n){D(o)
n=e.h=photoLinkCalcHeight(o,c,l)}if(!o){D(n)
o=e.w=photoLinkWidthForHeight(n,c,l)}var u=getState(t,_)
var d=null
var f=e.border_color||se
var v
var h
if("EXTRA_SLOT"===t){d=ye.extra_slot
f=oe
v=Q.BTN_PHOTO_SHOWCASE_EXPAND.$({num:Y})
h=ae("extra_photo_showcase")}else{var p=te(t)
if(p===ee)d=ye[l]
else if(p===J){d=ye[l]
f=ie}else{d=photoTexture(p,l)
v=p.title}}if(!d.loaded)d=ye[l]
var m=U(e)
if("rollover"===m.state||"down"===m.state)u.active=ge(1,u.active+de*P())
else u.active=Ee(0,u.active-de*P())
var E=z(u.active,2)
i+=10*E
V(u.color,E,he,ve)
V(u.uvs,E,me,pe)
var g=s*E
var T=1+2*g
r-=g*o
a-=g*n
n*=T
var y=K*c*T
var S=X*c*T
var I=j*c*T
var A=q*c*T
var w=(o*=T)-2*y
var L="thumb"===l?w:3*w/4
var O=w+2*y
var R=L+2*y+S
G(r+A,a+A,r+O+A,a+R+A,++i,ne)
G(r,a,r+O,a+R,++i,f)
fe(d,u,r+=y,a+=y,++i,w,L)
if(v)(Te=Te||F()).drawSizedAligned(le,r,a+L+y/2,i,S,B.HVCENTERFIT,w,S,v)
if(h){var b=I
var N=a+L-b/2-4
var C=w-b
var x=r+(C+(Te=Te||F()).drawSizedAligned(_e,r,N,i+.3,I,B.HVCENTER,C,0,""+h))/2
ce.sprite.draw({x:x,y:N-.5*b,z:i+1,w:b,h:b,frame:ce.ORBS})}if(!e.disabled&&"EXTRA_SLOT"!==t){var M=W("photo/"+t)
if(k({key:u.key,x:e.x,y:e.y,w:e.w,h:e.h,internal:true,url:M}))m.ret=1}a+=L+y
if(m.ret)if("EXTRA_SLOT"===t)re("orb","extra_photo_showcase",1,Q.LBL_EXTRA_PHOTO_SHOWCASE,"extra_photo_showcase")
else{$()
H("photo/"+t)}profilerStop("photoLinkUI")}},{"../common/store_data":262,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/link":328,"../glov/client/textures":365,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./layout":120,"./localization/localization":131,"./menu":140,"./photo_ui":159,"./store":195,"./styles":197,"./ui_util":205,"./waygate_ui":222,assert:void 0}],157:[function(e,t,r){"use strict"
r.photoListShow=photoListShow
var g=e("../glov/client/font").ALIGN
var T=e("../glov/client/net").netUserId
var a=e("../glov/client/ui")
var y=a.label
var S=a.uiGetFont
var I=a.uiGetTitleFont
var A=a.uiTextHeight
var w=e("../glov/common/util").dateToSafeLocaleString
var i=e("../glov/common/vmath").vec4
var L=e("./localization/localization").L
var o=e("./photo_link_ui")
var O=o.photoLinkCalcHeight
var R=o.photoLinkUI
var n=e("./styles")
var b=n.color_photo_frame_listed
var N=n.menu_header_style
var C=n.menu_style
var x=e("./user_details").userDetailsGet
var s=e("./waygate_ui")
var M=s.calcWGLinkWidth
var D=s.waygateLinkUI
var P=e("./world_info").getWorldInfo
var B=Math.max
var k=Math.ceil,U=Math.floor,G=Math.min
var F=184
var W
var H
var z
var V
var Y
var j=4
var K=2
var q
var X=i(0,0,0,.5)
function showPhoto(e,t,r,a){var i=Z.UI
var o={photo_id:a,x:r,y:e,z:i+20,w:F,ctx:t.ctx,img_style:t.img_style}
if(t.show_details){var n=T()&&x(T())
if(n&&n.listed_photos&&n.listed_photos.includes(a))o.border_color=b}R(o)
e+=o.h
if(t.show_details){var s
var l=null==(s=t.all_photos)?void 0:s[a]
if(l){e+=j+K
var _=l.world
var c=P(_,false)
var u=M(V)
D({x:r,y:e,z:i,h:V,target:{wid:_},img_style:"thumb",no_overlay:true,disabled:true,border_color:X,ctx:"ph_"+a})
var d=r+u+K
var f=F-u-K
var v=new Date(l.created)
var h=w(v,true)
var p=w(v,false)
var m=(null==c?void 0:c.name)||L.LBL_UNKNOWN_WORLD_NAME
var E=L.separateColon(L.LBL_CREATED,p)+"\n"+L.separateColon(L.LBL_LOCATION,L.addParenthesesAfter(m,_||L.LBL_UNKNOWN_SYMBOLS))
if("date"===t.show_details)y({font_style:C,x:d,y:e,z:i,w:f,h:Y,align:g.HVCENTERFIT,size:z,tooltip:E,text:h})
else H.drawSizedAligned(N,d,e,i,z,g.HVCENTERFIT,f,Y,m)}}}function photoListShow(e,t){W=W||S()
H=H||I()
var r=e.y_min,a=e.y_max,i=e.dims,o=e.scroll_param,n=e.show_details
var s=e.img_style||"thumb"
var l=U((o.w-36)/(F+8))
var _=i.y
if(n){var c=A()
Y=B(V=1.333*(z=c)+K,z)
q=j+2*K+Y}else q=0
var u=i.x_mid
var d=8
var f=t.length
if(5===l&&t.length>5&&t.length<=8)l=4
var v=k(f/l)
var h=0
var p=O(F,void 0,s)+q
for(var m=0;m<v;++m){var E=G(l,f-h)
var g=u-(E*(F+d)-d)/2
for(var T=0;T<E;++T){var y=t[h++]
if(_+p>=r&&_<a)showPhoto(_,e,g+T*(F+d),y)}_+=p+8}return i.y=_}},{"../glov/client/font":315,"../glov/client/net":338,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./localization/localization":131,"./photo_link_ui":156,"./styles":197,"./user_details":209,"./waygate_ui":222,"./world_info":229}],158:[function(e,t,r){"use strict"
r.photoModeActive=photoModeActive
r.getPhotoTime=getPhotoTime
r.photoShowSelf=photoShowSelf
r.getPhotoStartPosition=getPhotoStartPosition
r.getPhotoBounds=getPhotoBounds
r.shiftPhotoBounds=shiftPhotoBounds
r.errorModalDialog=errorModalDialog
r.setImageUploadFalse=setImageUploadFalse
r.validatePhotoCapture=validatePhotoCapture
r.photoModeClear=photoModeClear
r.photoModeCancel=photoModeCancel
r.photoModeInteractive=photoModeInteractive
r.photoCanMove=photoCanMove
r.photoCanMoveChar=photoCanMoveChar
r.photoCanMovePht=photoCanMovePht
r.provideGlobalScreenshot=provideGlobalScreenshot
r.copyCanvasToClipboard=copyCanvasToClipboard
r.copyToClipboardCheck=copyToClipboardCheck
r.photoModeTick=photoModeTick
r.photoCapture=photoCapture
r.DEFAULT_JPEG_QUALITY=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var N=e("assert")
var Y=e("../glov/client/camera2d")
var a=e("../glov/client/edit_box").editBoxAnyActive
var f=e("../glov/client/effects")
var j=e("../glov/client/engine")
var i=e("../glov/client/font")
var K=i.ALIGN
var o=i.fontStyleAlpha
var n=e("../glov/client/framebuffer")
var q=n.framebufferSkipRelease
var v=n.framebufferUpdateCanvasForCapture
var X=e("../glov/client/input")
var C=e("../glov/client/input").KEYS
var Q=e("../glov/client/settings")
var $=e("../glov/client/slider").slider
var x=e("../glov/client/spot").spotUnfocus
var s=e("../glov/client/sprites")
var l=s.spriteCreate
var _=s.spriteDraw
var h=s.spriteDrawPartial
var c=e("../glov/client/textures")
var u=e("../glov/client/transition")
var J=e("../glov/client/ui")
var d=e("../glov/client/ui")
var ee=d.uiButtonHeight
var te=d.uiGetFont
var p=e("../glov/common/chunked_send").MAX_CLIENT_UPLOAD_SIZE
var m=e("../glov/common/util")
var M=m.dateToFileTimestamp
var re=m.merge
var E=m.nop
var g=e("../glov/common/vmath")
var D=g.unit_vec
var T=g.v2copy
var y=g.v3add
var S=g.v3copy
var I=g.vec2
var A=g.vec3
var w=g.vec4
var L=g.zero_vec
var O=e("../common/globals").CHUNK_SIZE
var R=e("../common/photo_common")
var b=R.CARD_H
var P=R.CARD_W
var B=R.PHOTO_ASPECT
var ae=e("./analytics").logEvent
var k=e("./build_mode")
var ie=k.doPointerLockBottom
var oe=k.doPointerLockTop
var ne=k.pointerLockJustEntered
var U=e("./camera")
var G=U.CAMMODE_REGULAR
var F=U.getCameraMode
var W=U.setCameraModeRegular
var H=U.setCharacterControllerAsActive
var z=U.setPhotoControllerAsActive
var V=e("./file_management")
var se=V.uploadImageSet
var le=V.uploadInProgress
var _e=e("./layout")
var ce=_e.CORNER_BUTTON_MARGIN
var ue=_e.TC_VERTBUTTONS_H
var de=_e.layoutCameraFull
var fe=_e.layoutCameraSquare
var ve=_e.menuUpperLeft
var he=e("./loading_custom").isLoadingCustom
var pe=e("./localization/localization").L
var me=e("./main")
var Ee=me.blockImageUpload
var ge=me.charControllerPos
var Te=e("./main")
var ye=e("./menu")
var Se=e("./platform_worlds_client")
var Ie=Se.PLATFORM_ANDROID
var Ae=Se.PLATFORM_DISCORD
var we=Se.PLATFORM_FBINSTANT
var Le=e("./quickbar")
var Oe=e("./sky").skyGetTimeOfDay
var Re=e("./status")
var be=e("./status").statusPush
var Ne=e("./styles")
var Ce=Ne.color_title_underlay
var xe=Ne.inventory_style
var Me=Ne.overlay_title_style
var De=Ne.style_photo_label
var Pe=Ne.style_photo_label_touch
var Be=Ne.touch_jump_button_colors
var ke=e("./ui_util")
var Ue=e("./user_data").isWaiting
var Ge=e("./voxel_chunk_manager").getKnownBounds
var Fe=e("./voxel_const").origin_chunk
var We=e("./waygate_ui")
var He=We.OVERLAY_TITLE_H
var ze=We.OVERLAY_TITLE_Y
var Ve=e("./world_comm").getWorldID
var Ye=e("./world_metadata").worldPhotoMove
var je=Math.asin,Ke=Math.cos,qe=Math.round,Ze=Math.sin,Xe=Math.sqrt,Qe=Math.trunc,$e=Math.PI
var Je=B
var et=4/3
var tt=(Je-et)/2
var rt=512
var at=128
var it=256
var ot=(B-1)/2
var nt=60
var st=.2
var lt=.92
r.DEFAULT_JPEG_QUALITY=lt
var _t=.02
var ct=p/.75
var ut=false
var dt=null
var ft=false
var vt
var ht=A()
var pt=[I(),I(),I()]
var mt=null
var Et=null
var gt
var Tt
var yt=null
var St={}
var It={}
var At=false
var wt=false
var Lt={in_event_cb:X.pointerLockEnter}
var Ot=false
var Rt=false
var bt=false
var Nt=true
function copyToClipboardSupported(){return Nt}function photoModeActive(){return ut}function getPhotoTime(){return yt}function photoShowSelf(){return Tt}function getPhotoStartPosition(){return ht}function getPhotoBounds(){return pt}function shiftPhotoBounds(e){for(var t=0;t<pt.length;t++){pt[t][0]+=e[t]
pt[t][1]+=e[t]}y(ht,ht,e)}function errorModalDialog(e,t){J.modalDialog({title:e,text:String(t),buttons:{OK:null}})}function setImageUploadFalse(){bt=false}function validatePhotoCapture(e,t,r){if(e||Ve()!==t||!r){if(e)errorModalDialog(pe.DLG_ERROR_IMAGE_UPLOAD_TITLE,e)
return bt=false}return true}function photoModeClear(){if(!ut)return
if(At){At=false
Q.pop()}ut=false
yt=Et=mt=null
S(ht,L)
for(var e=0;e<pt.length;e++)T(pt[e],L)
H()
if(St){for(var t in St)setTimeout(St[t].destroy.bind(St[t]),1)
St={}
It={}}if(ft&&X.pointerLocked())X.pointerLockExit()}function photoModeCancel(){if(ut)photoModeClear()}function photoModeInteractive(){return!mt}function photoCanMove(){return!Ot&&!mt}function photoCanMoveChar(){return photoCanMove()&&wt}function photoCanMovePht(){return photoCanMove()&&!wt}var Ct=w(0,0,0,.85)
var xt=w(0,0,0,.5)
var Mt=w(0,0,0,.3)
function calcSourceParam(e,t){if(e/t>B){var r=B*t
return{x:(e-r)/2,y:0,w:r,h:t}}else{var a=e/B
return{x:0,y:(t-a)/2,w:e,h:a}}}function makeCaptureCanvas(e,t,r,a){var i=document.createElement("canvas")
i.width=a.w
i.height=a.h
i.getContext("2d").drawImage(t,r.x,r.y,r.w,r.h,0,0,a.w,a.h)
if(!St[e]){St[e]=c.load({name:"photo_"+e,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
It[e]=l({tex:St[e]})}St[e].updateData(i.width,i.height,i)
return i}function doWaygateCapture(){f.clearAlpha()
j.startSpriteRendering()
h(Z.FLOATERS_MAX)
var e=v()
var t=j.canvas
var r=calcSourceParam(e.width,e.height)
r.y+=t.height-e.height
var a={x:0,y:0,w:P,h:b}
var i={x:r.x+tt*r.h,y:r.y,w:r.w-tt*r.h*2,h:r.h}
var o={x:0,y:0,w:rt,h:rt}
var n={x:0,y:0,w:rt,h:rt}
var s={x:0,y:0,w:at,h:at}
var l=makeCaptureCanvas("full",t,r,a)
var _=makeCaptureCanvas("preview",t,i,o)
var c=makeCaptureCanvas("thumb",_,n,s)
var u=lt
var d=(mt={full:{data:l.toDataURL("image/jpeg",u),w:a.w,h:a.h},preview:{data:_.toDataURL("image/jpeg",lt),w:o.w,h:o.h},thumb:{data:c.toDataURL("image/png"),w:s.w,h:s.h}}).preview.data.length+mt.thumb.data.length
while(mt.full.data.length+d>ct){if((u-=_t)<0){errorModalDialog(pe.DLG_ERROR_TAKING_PHOTO_TITLE,pe.ERR_COULD_NOT_COMPRESS)
photoModeClear()
return}mt.full.data=l.toDataURL("image/jpeg",u)}At=false
Q.pop()}function doScreenshotCapture(){f.clearAlpha()
j.startSpriteRendering()
h(Z.FLOATERS_MAX)
var e=v()
var t=j.canvas
var r=calcSourceParam(e.width,e.height)
r.y+=t.height-e.height
var a={x:0,y:0,w:qe(r.w),h:qe(r.h)}
var i={x:0,y:0,w:P,h:b}
var o={x:0,y:0,w:it,h:it}
var n={x:(r.w-r.h)/2,y:r.y,w:r.h,h:r.h}
var s=makeCaptureCanvas("max",t,r,a)
var l=makeCaptureCanvas("card",t,r,i)
var _=makeCaptureCanvas("thumb",t,n,o)
Et=s.toDataURL("image/png")
var c=lt
var u=(mt={max:{data:s.toDataURL("image/jpeg",c),w:a.w,h:a.h},card:{data:l.toDataURL("image/jpeg",lt),w:i.w,h:i.h},thumb:{data:_.toDataURL("image/jpeg",lt),w:o.w,h:o.h}}).card.data.length+mt.thumb.data.length
while(mt.max.data.length+u>ct){if((c-=_t)<0){errorModalDialog(pe.DLG_ERROR_TAKING_PHOTO_TITLE,pe.ERR_COULD_NOT_COMPRESS)
photoModeClear()
return}mt.max.data=s.toDataURL("image/jpeg",c)}At=false
Q.pop()}function photoModeConfirm(){fe()
var e=20
var t=48
var r=j.font
var a=0
var i=0
var o=1e3
var n=a+o/2
var s=ee()
var l={x:s,y:i,z:Z.UI-5,w:o-2*s,h:ee()}
r.drawSizedAligned(xe,l.x,l.y,l.z+2,2*J.font_height,K.HVCENTERFIT,l.w,l.h,ft?pe.LBL_CONFIRM_WG_IMAGES:pe.LBL_PHOTO_TAKEN)
J.drawHBox(l,J.sprites.tab,D)
var _=i+=ee()
var c=ft?It.full:It.max
var u=400
var d=B*u
c.draw({x:n-d/2,y:i,w:d,h:u})
i+=u+24
if(ft){var f=110
var v=et*f
var h={x:n-v/2,y:i,w:v,h:f}
It.thumb.draw(h)
i+=f+24
if(X.mouseOver(h)){var p=500
var m=et*p
It.preview.draw({x:n-m/2,y:i-p-24,w:m,h:p,z:Z.UI+5})
Y.push()
Y.setNormalized()
J.drawRect(0,0,1,1,Z.UI+4,[0,0,0,.75])
Y.pop()}}i+=24
var E=Ee()
if(ft&&E){r.drawSizedAligned(xe,a,i,Z.UI+1,J.font_height,K.HCENTERFIT,d,0,pe.ERR_WG_DEFAULT_VOXELS)
i+=J.font_height+8}var g=24
var T=(o-5*g)/3
var y=!we&&!Ie&&!Ae&&!ft
var S=[]
S.push({param:{text:E?pe.BTN_NOT_AVAILABLE:Rt?pe.BTN_PROCESSING:ft?pe.BTN_ACCEPT:pe.BTN_SAVE_PHOTO,tooltip:E?pe.TLTP_VOXEL_PACK_APPLIED:void 0,disabled_focusable:true,disabled:E||Rt},cb:function cb(){if(ft){bt=true
se(mt,ft,dt)
photoModeClear()}else{ae("pm_save_photo_button",1,"button")
bt=true
J.modalDialog({title:pe.DLG_SAVING_PHOTO_TITLE,text:pe.MSG_PLEASE_WAIT})
se(mt,ft,dt)
photoModeClear()}}})
if(copyToClipboardSupported())S.push({param:{text:pe.BTN_COPY_TO_CLIPBOARD},cb:function cb(){copyDataURLToClipboard(Et)}})
if(y)S.push({param:{text:pe.BTN_DOWNLOAD},cb:function cb(){ae("pm_download_button",1,"button")
var e=document.createElement("a")
e.href=Et
e.setAttribute("download","Worlds_FRVR_Photo "+M(new Date)+".png")
e.click()}})
var I=!X.touch_mode?Lt:null
S.push({param:{text:pe.BTN_RETAKE_PHOTO,disabled:ft&&E,in_event_cb:I&&I.in_event_cb},cb:function cb(){x()
Et=mt=null
if(St){for(var e in St)setTimeout(St[e].destroy.bind(St[e]),1)
St={}
It={}}}})
S.push({param:{text:pe.BTN_CANCEL,in_event_cb:I&&I.in_event_cb,hotkey:C.ESC},cb:function cb(){if(!ft)ae("pm_cancel_button",1,"button")
photoModeClear()}})
var A=S.length
for(var w=0;w<A;++w){var L=S[w]
var O=void 0
var R=T
if(A<=3)O=a+g+(T+g)*w
else if(4===A)if(0===w){O=a+g
R=3*T+2*g}else{if(1===w)i+=t+g
O=a+g+(T+g)*(w-1)}else if(5===A)if(w<2)O=a+g+((R=(3*T+g)/2)+g)*w
else{if(2===w)i+=t+g
O=a+g+(T+g)*(w-2)}else N(false)
if(J.buttonText(_extends({},L.param,{x:O,y:i,w:R,h:t})))L.cb()}var b=i+=t+g
J.panel({x:a-e,y:_-e,w:o+2*e,h:b-_+2*e,color:ye.panel_color})
de()}function clipboardGetPermission(t){var e
if(!(null!=(e=navigator.permissions)&&e.query))return void t()
var r=false
function onceNext(e){if(r)return
r=true
if(e&&e.state&&"denied"===e.state){Nt=false
t("ERR_CLIPBOARD_ACCESS_DENIED")}else t()}try{navigator.permissions.query({name:"clipboard-write"}).then(onceNext,onceNext)}catch(e){onceNext()}}clipboardGetPermission(E)
function drawPhotoFlash(){X.pointerLockExit()
Y.push()
Y.setNormalized()
J.drawRect(0,0,1,1,Z.PHOTO_FLASH,D)
Y.pop()
u.queue(Z.TRANSITION_FINAL,u.fade(350))}function provideGlobalScreenshot(i){function singleTickPhotoFlash(){drawPhotoFlash()
j.removeTickFunc(singleTickPhotoFlash)}j.preSpriteRender(function(){j.startSpriteRendering()
if(!Ue()&&Ve()&&!ye.active()&&!he())h(Z.FLOATERS_MAX)
else _()
var e=j.canvas
var t=v()
var r
if(ut){(r=calcSourceParam(t.width,t.height)).y+=e.height-t.height
t={x:0,y:0,width:qe(r.w),height:qe(r.h)}}else r={x:0,y:j.canvas.height-t.height,w:t.width,h:t.height}
if(ut||t.width!==e.width){(e=document.createElement("canvas")).width=t.width
e.height=t.height
e.getContext("2d").drawImage(j.canvas,r.x,r.y,r.w,r.h,0,0,t.width,t.height)}var a=Ve()?"world:"+Ve():"in_menu"
i(e,a)
j.addTickFunc(singleTickPhotoFlash)})}function copyCanvasToClipboardInternal(e){function onError(e){Nt=false
Te.chat_ui.addChatError(pe.$(pe.CHATERROR_COPY_NOT_SUPPORTED,e))
console.error("Error copying to clipboard:",e)}if(!e.toBlob)return void onError("ERR_UNSUPPORTED")
e.toBlob(function(r){clipboardGetPermission(function(e){if(e)return void onError(e)
try{var t=navigator.clipboard.write([new ClipboardItem({"image/png":r})])
if(t&&t.catch)t.catch(onError)
be(pe.MSG_COPY_TEXT_SUCCESS)}catch(e){onError(e)}})},"image/png")}function copyCanvasToClipboard(){if(!Nt)return
provideGlobalScreenshot(function(e,t){copyCanvasToClipboardInternal(e)})}function copyDataURLToClipboard(e){var t=new Image
t.onload=function(){var e=document.createElement("canvas")
e.width=t.width
e.height=t.height
e.getContext("2d").drawImage(t,0,0)
copyCanvasToClipboardInternal(e)}
t.src=e}function copyToClipboardCheck(){if(!a()&&window.ClipboardItem&&X.keyDownEdge(X.KEYS.C)&&X.keyDown(X.KEYS.CTRL))copyCanvasToClipboard()}function fovCalc(e,t){var r=e*Ze(t/2)/Ke(t/2)
return 2*je(r/Xe(r*r+1))}function calculatePhotoFOV(e){var t=gt*$e/180
if(ft)if(0!==e){var r=fovCalc(Je,t)
if(j.width>j.height)return fovCalc(j.height/j.width,r)
else return r}else N(j.width>j.height)
return t}function toggleShowSelf(){if(!(Tt=!Tt))wt=false}var Dt=.25
var Pt=w(Ce[0],Ce[1],Ce[2],Ce[3]*Dt)
var Bt=o(Me,Dt)
var kt
var Ut
function photoModeTick(){Rt=le()||bt
if(mt){photoModeConfirm()
return Ut}var e=!X.touch_mode?Lt:null
if(X.keyDownEdge(X.KEYS.F9,e))photoModeCancel()
if(Ot){if(X.keyDownEdge(X.KEYS.ESC,e))photoModeCancel()}else if(X.keyDownEdge(X.KEYS.ESC))Ot=true
var t={x:ve()?ce:Y.w()-ee()-ce,y:0,w:ee(),h:ee()}
var r=Ot?pe.LBL_EXIT_MENU:pe.LBL_MENU
var a=re({z:Z.MENUBUTTON,img:ke.sprite,frame:Ot?ke.X:ke.MENU,shrink:.7,colors:Le.quickbar_colors_selected,disabled:false,tooltip:ye.prefixShortcutKey("E",r),in_event_cb:Ot?e&&e.in_event_cb:null},t)
X.drag(t)
if(!j.defines.NOUI&&J.buttonImage(a)||X.keyDownEdge(X.KEYS.E,e))if(Ot=!Ot)X.pointerLockExit()
var i=X.touch_mode?12:24
var o=8
var n=X.touch_mode?0:8
var s=X.touch_mode?50:J.font_height
var l=X.touch_mode?280:240
var _=X.touch_mode?120:48
var c={x:Y.x1()-o-l,y:Y.h()-i-_-(X.touch_mode&&!Ot?ue:0),w:l,h:_,font_height:s,colors:Be}
var u=false
if(!Ot){if(!j.defines.NOUI&&!kt)kt=Re.get("photo_prompt").setMessage(pe.STATUSMSG_CLICK_TAKE_PHOTO).noBounce().fade(st)
if(X.touch_mode&&!Te.chat_ui.isFocused())if(J.buttonText(re({text:pe.BTN_TAKE_PHOTO},c))){if(!ft)ae("pm_take_photo_button",1,"button")
u=true}}else{if(kt){kt.remove()
kt=null}if(!Te.chat_ui.isFocused()){if(J.buttonText(re({in_event_cb:e&&e.in_event_cb,text:pe.BTN_EXIT_PHOTO_MODE},c))){photoModeCancel()
return Ut}if(Ye()){c.y-=n+_
if(J.buttonText(re({text:Tt?pe.BTN_HIDE_SELF:pe.BTN_SHOW_SELF},c)))toggleShowSelf()
c.y-=n+_
if(J.buttonText(re({text:wt?pe.BTN_CONTROLLING_PLAYER:pe.BTN_CONTROLLING_CAMERA,disabled:!Tt},c)))wt=!wt}c.y-=n+_
if(J.buttonText(re({text:pe.BTN_TAKE_PHOTO},c)))u=true
var d=X.touch_mode?20:8
var f=X.touch_mode?280:240
var v=ee()
var h=X.touch_mode?Pe:De
var p=X.touch_mode?70:J.font_height
var m=12
var E=X.touch_mode?0:8
var g=f-2*m
var T=p
var y=p+E+v+d
var S=Y.x1()-o-l
var I=X.touch_mode?(ve()?0:ee())+d+y+p+E:c.y-d-v
var A=S+m
var w=X.touch_mode?(ve()?0:ee())+d+y:I-E-p
J.font.drawSizedAligned(h,A,w,Z.UI,p,K.HLEFT,g,T,pe.addColon(X.touch_mode?pe.LBL_FIELD_OF_VIEW_SHORT:pe.LBL_FIELD_OF_VIEW))
var L=gt
var O=qe($(L,{x:S,y:I,min:40,max:100,w:f,h:v}))
J.font.drawSizedAligned(h,A,w,Z.UI,p,K.HRIGHT,g,T,""+O)
if(O!==L)gt=O
I-=y
J.font.drawSizedAligned(h,A,w-=y,Z.UI,p,K.HLEFT,g,T,pe.addColon(pe.LBL_TIME_OF_DAY_SHORT))
var R=60*yt
var b=qe($(R,{x:S,y:I,min:0,max:1439,w:f,h:v}))
J.font.drawSizedAligned(h,A,w,Z.UI,p,K.HRIGHT,g,T,""+Qe(b/60))
if(b!==R)yt=b/60}}if(X.keyDownEdge(X.KEYS.V)&&Ye())toggleShowSelf()
var N=oe()
if(N)Ot=false
if(N&&!ne()&&(X.click({button:0})||X.keyDownEdge(X.KEYS.R))){u=true
if(!ft)ae("pm_take_photo_button",1,"button")}if(At){q()
if(ft)Te.postTick(doWaygateCapture)
else Te.postTick(doScreenshotCapture)
drawPhotoFlash()
if(kt){kt.remove()
kt=null}}else if(u){Q.push({render_scale:1,bevel:1,detail_budget:1,fade_chunks:0})
At=true}var C=calcSourceParam(Y.wReal(),Y.hReal())
if(0!==C.x){J.drawRect(Y.x0Real(),Y.y0Real(),Y.x0Real()+C.x,Y.hReal(),Z.PHOTO_BORDER,Ct)
J.drawRect(Y.x0Real()+C.x+C.w,Y.y0Real(),Y.wReal(),Y.hReal(),Z.PHOTO_BORDER,Ct)}if(0!==C.y){J.drawRect(Y.x0Real(),Y.y0Real(),Y.wReal(),Y.y0Real()+C.y,Z.PHOTO_BORDER,Ct)
J.drawRect(Y.x0Real(),Y.y0Real()+C.y+C.h,Y.wReal(),Y.hReal(),Z.PHOTO_BORDER,Ct)}if(ft){var x=tt*C.h
J.drawRect(Y.x0Real()+C.x,Y.y0Real()+C.y,Y.x0Real()+C.x+x,Y.y0Real()+C.y+C.h,Z.PHOTO_BORDER,xt)
J.drawRect(Y.x0Real()+C.x+C.w-x,Y.y0Real()+C.y,Y.x0Real()+C.x+C.w,Y.y0Real()+C.y+C.h,Z.PHOTO_BORDER,xt)
if(vt){var M=Y.x0Real()+C.x+x
var D=Y.y0Real()+C.y
var P=C.h
var B=C.w-2*x
var k=Z.PHOTO_BORDER
var U=He*P
var G=.05*B
var F=B-2*G
var W=M+G
var H=D+P*ze
var z=te().drawSizedAligned(Bt,W,H,k+.3,U,K.HFIT|K.HRIGHT,F,U,vt)
J.drawRect(W+F-z-G,D,M+B,H+U,k+.25,Pt)}}else{var V=ot*C.h
J.drawRect(Y.x0Real()+C.x,Y.y0Real()+C.y,Y.x0Real()+C.x+V,Y.y0Real()+C.y+C.h,Z.PHOTO_BORDER,Mt)
J.drawRect(Y.x0Real()+C.x+C.w-V,Y.y0Real()+C.y,Y.x0Real()+C.x+C.w,Y.y0Real()+C.y+C.h,Z.PHOTO_BORDER,Mt)}Ut=calculatePhotoFOV(C.y)
ie()
return Ut}function photoCapture(e,t){ut=true
Ot=false
kt=Et=mt=null
S(ht,ge())
for(var r=0;r<pt.length;r++){pt[r][0]=(Ge()[r][0]-Fe[r]+2)*O
pt[r][1]=(Ge()[r][1]-Fe[r]-1)*O}ft=e.waygate_mode
vt=e.waygate_title
dt=t
yt=Oe()
Ut=(gt=nt)*$e/180
if(F()!==G)W()
if(ft||!Ye())Tt=false
else Tt=Te.char_controller.zoomed_out_tpv||Q.camera_view&&!Te.char_controller.zoomed_in_fpv
wt=false
Te.pht_controller.getParamsFromController(Te.char_controller)
z()}},{"../common/globals":248,"../common/photo_common":256,"../glov/client/camera2d":295,"../glov/client/edit_box":303,"../glov/client/effects":304,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/framebuffer":316,"../glov/client/input":326,"../glov/client/settings":351,"../glov/client/slider":355,"../glov/client/spot":361,"../glov/client/sprites":363,"../glov/client/textures":365,"../glov/client/transition":366,"../glov/client/ui":367,"../glov/common/chunked_send":378,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./build_mode":33,"./camera":35,"./file_management":98,"./layout":120,"./loading_custom":128,"./localization/localization":131,"./main":135,"./menu":140,"./platform_worlds_client":160,"./quickbar":172,"./sky":188,"./status":193,"./styles":197,"./ui_util":205,"./user_data":208,"./voxel_chunk_manager":214,"./voxel_const":215,"./waygate_ui":222,"./world_comm":226,"./world_metadata":235,assert:void 0}],159:[function(e,t,r){"use strict"
r.photoIdValid=photoIdValid
r.photoViewGetTitle=photoViewGetTitle
r.photoViewInit=photoViewInit
r.photoInfoGet=photoInfoGet
r.doPhotoView=doPhotoView
r.PHOTO_LOADING=r.PHOTO_INVALID=void 0
var Se="ERR_INVALID_PHOTO_ID"
r.PHOTO_INVALID=Se
var Ie="MSG_LOADING"
r.PHOTO_LOADING=Ie
var Ae=e("assert")
var a=e("../glov/client/cmds").cmd_parse
var we=e("../glov/client/font").ALIGN
var i=e("../glov/client/input")
var Le=i.inputClick
var Oe=i.inputTouchMode
var Re=i.pointerLockEnter
var o=e("../glov/client/net")
var be=o.netDisconnected
var Ne=o.netSubs
var Ce=o.netUserId
var xe=e("../glov/client/sprites").spriteCreate
var n=e("../glov/client/ui")
var Me=n.button
var De=n.buttonImage
var Pe=n.buttonShared
var Be=n.buttonText
var ke=n.drawElipse
var Ue=n.drawRect
var Ge=n.modalDialog
var Fe=n.modalTextEntry
var We=n.uiButtonWidth
var He=n.uiGetFont
var ze=n.uiGetTitleFont
var Ve=n.uiTextHeight
var Ye=e("../glov/client/urlhash")
var s=e("../glov/common/util")
var je=s.dateToFileTimestamp
var Ke=s.dateToSafeLocaleString
var l=e("../common/photo_common")
var qe=l.PHOTO_ASPECT
var Ze=l.PHOTO_NAME_MAX_LENGTH
var Xe=l.PHOTO_NAME_MAX_VISUAL_SIZE
var _=l.photo_id_valid_regex
var Qe=e("./account_ui").formatUserID
var c=e("./layout")
var $e=c.PHOTOUI_BORDER_PAD
var Je=c.PHOTOUI_FRAME_PAD
var et=c.PHOTOUI_SHADOW_OFFSET
var tt=c.PHOTOUI_TITLE_H
var rt=c.PHOTOUI_USERBUTTON_H
var at=c.PHOTOUI_WG_H
var it=c.UIVIEWS_BUTTON_H
var ot=c.UIVIEWS_BUTTON_W
var nt=c.UIVIEWS_CONTENT_PAD
var st=e("./localization/localization").L
var u=e("./main")
var lt=u.chatUI
var _t=u.menuExit
var d=e("./menu")
var ct=d.menuDoTransition
var ut=d.menuGoBack
var dt=d.menuX1
var ft=d.menuY1
var vt=e("./photo_library_view").photoLibraryDirty
var ht=e("./prop_edit").savingMessage
var f=e("./sharing/platform_share_handlers")
var pt=f.downloadPhoto
var mt=f.sharePhoto
var Et=f.sharePhotoLink
var gt=f.sharingLinksEnabled
var Tt=f.sharingPhotoEnabled
var v=e("./styles")
var yt=v.color_black
var St=v.color_black_30
var It=v.color_photo_frame_shadow
var At=v.color_white
var wt=v.label_style
var Lt=v.loading_style
var Ot=v.menu_header_style
var Rt=v.sublabel_style
var bt=e("./ui_util")
var Nt=e("./ui_util_2")
var Ct=e("./user_details").userDetailsCacheClearForUser
var h=e("./user_info_view")
var xt=h.userInfoGet
var Mt=h.userProfileButton
var Dt=h.viewUser
var Pt=e("./user_profile_view").userProfileViewInvalidatePhotoList
var p=e("./waygate_ui")
var Bt=p.calcWGLinkWidth
var kt=p.userTextureLoad
var Ut=p.waygateLinkUI
var m=e("./world_comm")
var Gt=m.getPerm
var Ft=m.worldGoByURL
var Wt=e("./world_info").getWorldInfo
var Ht=e("./world_info_view").worldLink
var zt=Math.max
var E="$deleted"
var Vt=st.PHOTOTITLE_LOADING
var Yt=null
var jt=null
var Kt=null
var qt=false
function dialogOnError(e){if(e)Ge({title:st.DLG_ERROR_TITLE,text:e,buttons:{OK:null}})}function photoIdValid(e){return Boolean(e&&e.match(_))}function photoViewGetTitle(){return Vt}function photoViewInit(e){Kt=jt=Yt=null
qt=false
if(e&&photoIdValid(e))Yt=e}function photoInfoGet(e){if(!e)return Se
if("LOADING"===e)return Ie
var t=Ne().getChannelImmediate("photo."+e).getChannelData("public",null)
var r=t&&0===Object.keys(t).length
if(!e||r)return Se
if(!t)return Ie
if(t.owner_id===E||!t.img)return Se
return t}function doPhotoView(e){var t=0
var r=dt()
var a=ft()
var i=Z.UI
var o=r-t
var n=a-e
var s=He()
var l=ze()
var _=Ve()
var c=.75*_
var u=1.5*_
var d=1.5*_
var f=t
var v=e
Vt=st.PHOTOTITLE_LOADING
var h=photoInfoGet(Yt)
if(h===Se){s.drawSizedAligned(Lt,t,e,i,_,we.HVCENTER,o,2*n/3,st.ERR_INVALID_PHOTO_ID)
Vt=st.PHOTOTITLE_ERROR
return}Ae(Yt)
if(h===Ie){s.drawSizedAligned(Lt,t,e,i,_,we.HVCENTER,o,2*n/3,st.MSG_LOADING)
Vt=st.PHOTOTITLE_LOADING
return}var p=h.owner_id===Ce()
var m=p||Gt("sysadmin")
if(m&&!Kt&&!qt){qt=true
var E=Ne().getChannel("user."+h.owner_id,false)
var g=Yt
E.send("photo_query",Yt,function(e,t){if(g===Yt){qt=false
if(e)Kt=null
else Kt=t||null}})}var T=Boolean(m&&Kt)
var y=p&&Kt&&Kt.known
if(!jt){var S=kt(h.img.card.url)
jt=xe({tex:S})}var I=Wt(h.world_id,false)
var A=false
var w=I&&I.owner
if(I&&!I.err)if(!I.access_listed)if(m)A=true
else I={err:"ERR_DOES_NOT_EXIST"}
else if(!I.user_access)if(m)A=true
else I={err:"ERR_DOES_NOT_EXIST"}
v+=$e/2
var L=o-2*$e-2*Je
var O=L/qe
var R=Boolean(T||h.title)
var b=L+2*Je
var N=O+2*Je
var C=zt(rt,tt)
if(R)N+=C
Ue(f+$e+et,v+et,f+$e+b+et,v+N+et,i+1,It)
Ue(f+$e,v,f+$e+b,v+N,i+2,At)
v+=Je
var x=f+$e+Je
jt.draw({x:x,y:v,z:i+3,w:L,h:O})
v+=O
var M=o-rt-nt
var D=xt(h.owner_id)
var P=Qe(D.user_id,D.display_name)
var B=st.$(st.PHOTOTITLE_AUTHOR,P)
if(R){v+=Je/2
var k=L-rt-nt
var U=s.drawSizedAligned(h.title?Ot:Rt,x,v,i+4,tt,we.HVCENTERFIT,T?k:L,C,h.title||st.LBL_PHOTO_UNTITLED)
if(T){var G={x:x+(k-U)/2,y:v,w:U,h:C}
var F=Pe(G)
if(F.focused)ke(G.x,G.y,G.x+G.w,G.y+G.h,i+3.5,0,St)
if(De({x:x+(k+U)/2+nt,y:v+(C-rt)/2,z:i+4,w:rt,h:rt,img:bt.sprite,frame:bt.EDIT})||F.ret)Fe({title:st.DLG_PHOTO_RENAME_TITLE,edit_text:h.title||"",max_len:Ze,max_visual_size:Xe,buttons:{ok:function ok(e){if(be())return dialogOnError("ERR_DISCONNECTED")
lt().cmdParse("photo_rename "+Yt+" "+e,function(e){dialogOnError(e)
if(!e)Pt()})},cancel:null}})}v+=C+Je/2}else v+=Je
v+=et+2*nt
var W=zt(d,rt)
var H=f+(M+s.drawSizedAligned(wt,f,v,i+1,d,we.HVCENTERFIT,M,W,B))/2+nt
if(Mt({user_id:h.owner_id,show_online_status:false,x:H,y:v,z:i+1,w:rt,h:rt}))Dt({x:H,y:v,user_id:h.owner_id})
v+=W+nt
if(h.title)Vt=st.separateWords(h.title,"|",B)
else Vt=B
var z=new Date(h.created)
var V=st.separateColon(st.LBL_CREATED,Ke(z,false))
var Y=Kt&&Kt.listed>=0
if(Y)if(p){var j=Gt("photo_showcase_size")
if(Kt.listed>=j)V=st.LBL_PHOTO_LISTED_OVERFLOW.$({created:V})
else V=st.LBL_PHOTO_LISTED.$({created:V})}else V+="; (admin: listed on user)"
s.drawSizedAligned(wt,f,v,i+1,_,we.HCENTERFIT,o,0,V)
v+=_+2*nt
var K=gt()
var q=1+(K?1:0)+(T?1:0)+(y?1:0)
var X=2*nt
var Q=f+(o-q*ot-(q-1)*X)/2
function photoButton(e){var t=Be({x:Q,y:v,w:ot,h:it,z:i+2,text:e})
Q+=ot+X
return t}var $="Worlds_FRVR_Photo "+je(z)+".jpg"
if(Tt()){if(photoButton(st.BTN_SHARE))mt(Yt,h.img.card.url,h.img.max.url,$,h.title)}else if(photoButton(st.BTN_DOWNLOAD))pt(h.img.max.url,$)
if(K)if(photoButton(st.BTN_GET_LINK))Et(Yt,h.img.card.url,h.title)
if(y){Ae(Kt)
if(photoButton(Y?st.BTN_PHOTO_UNLIST:st.BTN_PHOTO_LIST)){if(Y)Kt.listed=-1
else{var J=Ne().getMyUserChannel()
if(J){var ee=J.getChannelData("public.listed_photos",[])
Kt.listed=ee.length}else Kt.listed=99}Ne().getChannel("user."+h.owner_id,false).cmdParse((Y?"photo_list_remove":"photo_list_add")+" "+Yt,function(e){dialogOnError(e)
if(!e)Pt()})}}if(T){Ae(Kt)
if(photoButton((p?"":"(Admin) ")+st.addEllipsis(st.BTN_PHOTO_DELETE))){var te=Yt
var re=h.owner_id
Ge({button_width:We(),title:st.DLG_PHOTO_DELETE_TITLE,text:st.DLG_PHOTO_DELETE_MSG,buttons:{delete:{label:st.BTN_PHOTO_CONFIRM_DELETE,in_event_cb:Oe()?void 0:Re,cb:function cb(){var e=Ne().getChannel("user."+re,false)
ut()
e.cmdParse("photo_delete "+te,function(e){vt()
Ct(re)
dialogOnError(e)
if(!e)ht(st.STATUSMSG_PHOTO_DELETED,true)})}},remove:{label:st.BTN_PHOTO_CONFIRM_REMOVE,in_event_cb:Oe()?void 0:Re,cb:function cb(){var e=Ne().getChannel("user."+re,false)
ut()
e.cmdParse("photo_forget "+te,function(e){vt()
Ct(re)
dialogOnError(e)
if(!e)ht(st.STATUSMSG_PHOTO_REMOVED,true)})}},cancel:null}})}}v+=it+nt
var ae=Bt(at)
var ie=o/2
var oe=f+ie/2+ae/2+2*nt
var ne=I&&!I.err
var se=false
if(w&&w.user_id&&w.user_id.startsWith("$"));else if(w)se=true
var le=v+(at-u-c-(ne?c:0)-(se?rt-6:0))/2
var _e=s.drawSizedAligned(Rt,oe,le,i+1,c,we.HCENTERFIT,ie,0,st.addColon(A?p?st.LBL_LOCATION_UNLISTED:"(admin) Unlisted Location":st.LBL_LOCATION))
var ce=l.drawSizedAligned(Ot,oe,le+=c,i+1,u,we.HCENTERFIT,ie,0,(null==I?void 0:I.name)||st.LBL_UNKNOWN_WORLD_NAME)
le+=u
var ue=0
if(ne){var de=I&&!I.err?h.world_id:st.LBL_UNKNOWN_SYMBOLS
ue=s.drawSizedAligned(Rt,oe,le,i+1,c,we.HCENTERFIT,ie,0,st.$(st.LBL_NUMBERED_WORLD,de))
le+=c}var fe=0
if(se){Ae(w&&I)
var ve=I.frozen
var he=rt
var pe=he
var me=xt(w.user_id)
var Ee=Qe(me.user_id,me.display_name)
fe=s.drawSizedAligned(wt,oe,le,i+1,_,we.HVCENTERFIT,ie,pe,st.separateColon(ve?st.LBL_ACCESS_OWNER_CREATOR:st.LBL_ACCESS_OWNER,Ee))
var ge=oe+ie/2
if(Mt({user_id:w.user_id,show_online_status:false,x:ge+fe/2+4,y:le,z:i+1,w:he,h:he})||Le({x:ge-fe/2,text_y:le,w:fe,h:pe,button:0}))Dt({x:ge,y:le+he,user_id:w.user_id})
le+=he+4}var Te={x:f+o/2-ae/2-zt(_e,ce,ue,fe)/2-nt,y:v,z:i+2,h:at,target:{wid:h.world_id},img_style:"preview",no_overlay:!I||I.err,disabled:!I||I.err,in_event_cb:Oe()?void 0:Re,url:Ht(h.world_id),hide_unlisted:!A,ctx:"photo",long_press:false}
if(Ut(Te)){_t()
Ft(h.world_id,Te.long_press?"info":void 0)}if(p){var ye=80
if(Me({x:r-ye-nt,y:a-ye-nt,w:ye,h:ye,img:Nt.sprite,img_color:yt,frame:Nt.BTNICON_PHOTO,tooltip:st.BTN_PHOTO_LIBRARY})){ct()
Ye.goRoute("u/me/photos")}}}a.register({cmd:"photo_view",help:"View photo details",func:function func(e,t){Ye.goRoute("photo/"+e)
t()}})
a.register({cmd:"photo_rename",help:"Rename a photo / set a photo title",prefix_usage_with_help:true,usage:"  Usage: /photo_title PHOTOID New name",access_show:["hidden"],func:function func(e,t){var r=e.match(/^([A-Z0-9]+) (.*)$/)
if(!r)return t("Error parsing arguments")
var a=r[1].toUpperCase()
var i=r[2]
var o=Ne().getChannel("photo."+a).pak("photo_rename")
o.writeString(i||"")
o.send(t)}})},{"../common/photo_common":256,"../glov/client/cmds":298,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/util":400,"./account_ui":4,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./photo_library_view":155,"./prop_edit":170,"./sharing/platform_share_handlers":185,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_details":209,"./user_info_view":210,"./user_profile_view":212,"./waygate_ui":222,"./world_comm":226,"./world_info":229,"./world_info_view":231,assert:void 0}],160:[function(e,t,r){"use strict"
r.PLATFORM_DISCORD=r.PLATFORM_MOBILE=r.PLATFORM_MSSTORE=r.PLATFORM_MSSTART=r.PLATFORM_YANDEX=r.PLATFORM_IOS=r.PLATFORM_ANDROID=r.PLATFORM_FBINSTANT=r.PLATFORM_WEB=void 0
var a=e("assert")
var i=e("../glov/client/client_config")
var o=i.MODE_DEVELOPMENT
var n=i.PLATFORM
var s=e("../common/platform_worlds_common").WorldsPlatform
var l=n===s.Web
r.PLATFORM_WEB=l
var _=n===s.FBInstant
r.PLATFORM_FBINSTANT=_
var c=n===s.Android
r.PLATFORM_ANDROID=c
var u=n===s.IOS
r.PLATFORM_IOS=u
var d=n===s.Yandex
r.PLATFORM_YANDEX=d
var f=n===s.MSStart
r.PLATFORM_MSSTART=f
var v=n===s.MSStore
r.PLATFORM_MSSTORE=v
var h=c||u
r.PLATFORM_MOBILE=h
var p=n===s.Discord
r.PLATFORM_DISCORD=p
a(l||_||c||u||d||f||v||p)
if(o){var m,E
a(l||!window.FB)
a(_||!window.FBInstant)
a(c===Boolean(window.androidwrapper))
a(u===Boolean(null==(m=window.webkit)?void 0:null==(E=m.messageHandlers)?void 0:E.iosWrapper))}},{"../common/platform_worlds_common":257,"../glov/client/client_config":297,assert:void 0}],161:[function(e,t,r){"use strict"
r.create=create
function FastPriorityQueue(){this.array=[]
this.size=0}FastPriorityQueue.prototype.add=function(e){var t=this.size
this.array[this.size]=e
this.size+=1
var r
var a
while(t>0){a=this.array[r=t-1>>1]
if(e.score>=a.score)break
this.array[t]=a
t=r}this.array[t]=e}
FastPriorityQueue.prototype._percolateUp=function(e,t){var r=this.array[e]
var a
var i
while(e>0){i=this.array[a=e-1>>1]
if(!t&&!(r.score<i.score))break
this.array[e]=i
e=a}this.array[e]=r}
FastPriorityQueue.prototype._percolateDown=function(e){var t=this.size
var r=this.size>>>1
var a=this.array[e]
var i
var o
var n
while(e<r){n=this.array[i=1+(e<<1)]
if((o=i+1)<t)if(this.array[o].score<n.score){i=o
n=this.array[o]}if(!(n.score<a.score))break
this.array[e]=n
e=i}this.array[e]=a}
FastPriorityQueue.prototype._removeAt=function(e){if(e>this.size-1||e<0)return
this._percolateUp(e,true)
return this.pop()}
FastPriorityQueue.prototype.remove=function(e){for(var t=0;t<this.size;t++)if(this.array[t]===e){this._removeAt(t)
return true}return false}
FastPriorityQueue.prototype.pop=function(){if(0===this.size)return
var e=this.array[0]
if(this.size>1){this.array[0]=this.array[--this.size]
this._percolateDown(0)}else--this.size
return e}
function create(){return new FastPriorityQueue}},{}],162:[function(e,t,r){"use strict"
r.setFlatOreType=setFlatOreType
r.getFlatOreType=getFlatOreType
r.seedWorld=seedWorld
r.onZMap=onZMap
r.renderDetail=renderDetail
r.oreLowestStoneTier=oreLowestStoneTier
r.oreFromChunkPos=oreFromChunkPos
r.stoneTierFromPos=stoneTierFromPos
r.deepestOreFromWorldPos=deepestOreFromWorldPos
r.handleHexomeChoices=handleHexomeChoices
r.gen=gen
r.startup=startup
r.getVerticalSliceMapData=r.initPhase40=void 0
var Oe=e("assert")
var n=e("../glov/client/rand_fast").randSimpleSpatial
var a=e("../glov/common/rand_alea").mashString
var i=e("../glov/common/util")
var Q=i.clamp
var $=i.lerp
var s=i.mod
var o=e("../glov/common/vmath")
var l=o.ivec3
var J=o.unit_vec
var _=o.v2distSq
var c=o.v2normalize
var u=o.v2sub
var d=o.v3addScale
var f=o.v3copy
var Re=o.v3set
var v=o.vec1
var h=o.vec2
var g=o.vec3
var p=o.vec4
var m=e("../common/globals")
var be=m.CHUNK_SIZE
var Ne=m.CS2
var E=m.ID2
var T=m.ID_FACTOR
var y=m.MEGACHUNK_SIZE
var S=e("../common/materials_common").Mat
var I=e("../common/voxel_data_common")
var Ce=I.VoxelDataBase
var A=I.ZMAP_UNDERGROUND
var w=I.ZMAP_UNKNOWN
var L=I.ZMap
var xe=I.voxel_data_mem_tracker
var O=e("./biome_details")
var R=e("./continent").continentSeed
var b=e("./line2d").ptLineDistSq
var ee=e("./proc_gen_biomes")
var N=e("./proc_gen_biomes")
var Me=N.biome_noise
var te=N.calcBlendWeightsVS
var C=N.choiceDataSet
var x=N.getElevationEstimate
var re=N.getParam
var De=N.getVerticalSlice
var ae=N.getVerticalSliceById
var M=N.getVerticalSliceWorldPos
var Pe=N.initPhase60
var Be=N.worldStoneType
var ie=N.world_noise
var D=e("./proc_gen_constants")
var ke=D.PROP_1x1x1
var oe=D.SNOW_ELEVATION
var ne=D.SNOW_VARIATION
var P=e("./proc_gen_details")
var B=P.detailGenGetHighest
var Ue=P.detailGenLocal
var k=P.detailGenSeed
var U=P.detailStartup
var G=e("./proc_gen_hydro")
var se=e("./proc_gen_hydro").initPhase37
var F=e("./proc_gen_shared")
var Ge=F.intNoise
var Fe=F.phase_counts
var We=F.phase_timing
var He=e("./rand_seed")
var W=e("./stone_tiers")
var H=W.ORE_DISTRO
var z=W.ORE_FREQ
var ze=W.STONE_TIER_DEPTH
var V=W.STONE_TIER_DISTRO
var Y=e("./tiles")
var j=Y.TILE_INTANGIBLE
var K=Y.TILE_NON_OPAQUE
var Ve=Y.TILE_PROP_BASE
var le=Y.TILE_SNOW
var q=Y.TILE_STONE
var Ye=Y.TILE_WATER
var _e=Math.ceil,Z=Math.floor,ce=Math.max,je=Math.min,ue=Math.PI,Ke=Math.round,X=Math.sqrt,de=Math.tan,fe=Math.atan2
var ve=10
var he=1
var pe=3
var me=20
var Ee=.05
var ge=.2
var Te=1.57
var ye=110
var Se=.005
var Ie=.01
var Ae
var we=true
var Le
var qe=S.GOLD
function setFlatOreType(e,t){qe=e
null==t||t()}function getFlatOreType(){return qe}function seedWorld(e){we="flat"===e.world_type
Le=a("ore"+e.seed)
ee.seedWorld(e)
O.seedWorld(e)
G.seedWorld(e)
R(e)
k(e)
Ae={}}var Ze=3e4
var Xe
function cleanupExtraChunks(){profilerStart("cleanupExtraChunks")
Xe=null
var e=Date.now()-Ze
var t=true
for(var r in Ae)if(Ae[r].alloc_time<e)delete Ae[r]
else t=false
if(!t)extraChunkCleanupSchedule()
profilerStop("cleanupExtraChunks")}function extraChunkCleanupSchedule(){Xe=setTimeout(cleanupExtraChunks,Ze/2)}function seedPlants(e){return e.seed+1007}var Qe=-3
var $e=10
var Je=.1
var et=-1
var tt=-1
var rt=function(){var m=g()
var E=[]
return function pathDistFn(e,t){var r=-Infinity
var a=0
var i=0
var o=0
et=tt=-1
for(var n=0;n<t.length;++n){var s=t[n]
for(var l=0;l<s.length-1;++l){var _=E[o]
if(!_)_=E[o]=g()
var c=s[l]
var u=s[l+1]
b(_,c,u,e)
var d=$(_[0],c[4],u[4])
_[1]=d-X(_[1])
if(_[1]>r){r=_[1]
a=_[2]=$(_[0],c[2],u[2])
i=d;++o
et=n
tt=l}else if(_[1]>r-$e){_[2]=$(_[0],c[2],u[2]);++o}}}if(o&&r<Qe){var f=a=0
var v=r-$e
while(o){var h=E[--o]
var p=h[1]-v
if(p>0){a+=(p*=Je)*h[2]
f+=p}}a/=f}Re(m,r,a,i)
return m}}()
var at=function(){var n=p()
var s=h()
return function pathDirfn(e,t){if(-1===et)return n
var r=t[et]
var a=r[tt]
var i=r[tt+1]
var o=_(a,e)
u(s,i,a)
c(s,s)
n[0]=fe(s[0],s[1])
n[1]=o
n[2]=a[0]
n[3]=a[1]
return n}}()
var it=.5*(Te-ge)
var ot=.5*(ge+Te)
var nt=function(){var V=h()
var Y=g()
var j=v()
var K=[0,1,T,T+1]
var q=new Array(be*be)
var Z=new Array(be*be)
var X={}
X.pos_world=h(0,0)
X.dir=h(0,0)
return function initPhase40fn(e){if(e.phase>=40)return;++Fe[40]
var t=Date.now()
e.phase=40
var r=[]
for(var a=0;a<e.hexomes_cont_mid.length;++a){var i=e.hexomes_cont_mid[a]
se(i)
if(i.hydro_paths)r=r.concat(i.hydro_paths)}var o={}
var n=0
for(var s=0;s<K.length&&n<=1;++s){var l=ae(e.vsid+K[s]).origin_hexomes
for(var _=0;_<l.length;++_){var c=l[_]
if(o[c.uid])continue
o[c.uid]=true
n++}}if(1===n){Oe.equal(e.origin_hexomes.length,1)
e.hexomes=e.origin_hexomes
e.blend_primary_hexome=e.hexomes[0]
e.blend_weights=J
e.hexomes_noisy=e.origin_hexomes
e.blend_primary_hexome_noisy=e.hexomes_noisy[0]
e.blend_weights_noisy=J
e.single_hexome=true}var u=e.blend_primary_hexome.water_level
Oe(!e.map)
e.map=new Array(be)
e.max_z=-Infinity
e.max_solid_z=-Infinity
var d=0
for(var f=0;f<be;++f){V[1]=f
var v=e.map[f]=new Array(be)
for(var h=0;h<be;++h){var p=v[V[0]=h]={}
te(e,V,true)
q[d]=e.blend_primary_hexome_noisy.params.local_func
var m=e.blend_pos_world
var E=Ke(ee.getElevation(e))
p.h=E
p.base=e.last_base_elevation
p.surface=re(e,null,"surface",true)
var g=ce(0,Ke(re(e,j,"surface_depth",true)[0]))
p.ground=re(e,null,"ground",false)
re(e,Y,"ground_depth",true)
var T=.5+.5*ie[3].noise2D(m[0]*Ie,m[1]*Ie)
var y=.5+.5*ie[3].noise2D(m[0]*Ee,m[1]*Ee)
var S=oe+y*ne
if(p.h>S){p.surface=le
g=he+Ke(pe*je(1,(p.h-S)/me))}p.surface_h=E-g
p.ground_h=p.surface_h-ce(0,Ke(Y[0]+Y[1]*T))
p.water_level=u
var I=rt(m,r)
var A=p.hydro_pen=I[0]
var w=ot+it*ie[4].noise2D(m[0]*Se,m[1]*Se)
var L=0
if(A>0){var O=1-je(A/15,1)
w=O*w+(1-O)*ge}else{L=Q(-A/ye*1.2-.2,0,1)
w=$(L,w,Te)}var R=de(w)
var b=_e(A*R)
var N=Ke(I[1])-1
var C=ce(N,u)
var x=C-b
var M=Z[d]=void 0
if(e.blend_primary_hexome_noisy.river_mouth){var D=at(m,r)
X.pos_world=m
X.dir=D
var P=ce(60-2*(p.surface_h-u),0)
if(M=Q(P/60,0,1)){var B=M
if(M<.5)B=0
var k=12
var U=Q(I[2]-A,0,k)/k
var G=B*ee.riverDeltaHeight(X)
x=Ke(ce(G*=U,-1)+(C-b*(1.1-M)))}}if(b>=0){if(C>u){p.water_level=C
p.h=x}else if(p.h>x){p.h=x
if(e.blend_primary_hexome_noisy.river_mouth&&M)Z[d]=ee.riverDeltaSmoothNoise}}else{if(-(A+.5)<ve)if(e.blend_primary_hexome_noisy.river_mouth&&M)Z[d]=ee.riverDeltaSmoothNoise
w=$(L,w=.25*(w+3*ue/4),Te)
var F=de(w)
var W=je(N,Ke(N+1+(A+.5)*F))
if(p.h<W&&C>u)p.h=W
else if(x<p.h)p.h=x}e.max_z=ce(e.max_z,p.water_level,p.h)
e.max_solid_z=ce(e.max_solid_z,p.h)
d++}}for(var H=d=0;H<be;++H)for(var z=0;z<be;++z){if(q[d])q[d](e,z,H)
if(Z[d])Z[d](e,z,H)
d++}e.max_z++
e.max_solid_z++
We[40]+=Date.now()-t}}()
r.initPhase40=nt
var st
function onZMap(e){st=e}function renderDetail(e){if(!e.rendered){e.rendered=true
e.vd=e.detail_type.gen(e)
Oe(e.vd)
f(e.size,e.vd.size)}}var lt=function(){var r=h()
return function getVerticalSliceMapDataFn(e){var t=M(e)
u(r,e,t.pos_world)
nt(t)
return t.map[r[1]][r[0]]}}()
r.getVerticalSliceMapData=lt
function oreLowestStoneTier(e){var t=H.indexOf(e)
if(-1===t)return-1
for(var r=0;r<V.length;++r)if(-1!==V[r][1].indexOf(t)){var a=V[r][0]
if(a<0)return 0
var i=ze.indexOf(a)
Oe(-1!==i)
return i+1}return-1}var _t=g()
var ct=g(be/2,be/2,0)
function oreFromChunkPos(e){if(we){if(-1===qe)return H[s(e[0]+e[1]+e[2],H.length-1)+1]
return qe}var t=n(Le,Ke(e[0]*z),Ke(e[1]*z),0)
d(_t,ct,e,be)
var r=x(_t)-_t[2]
var a=0
while(r>V[a+1][0])++a
var i=V[a][1]
var o=Z(t*i.length)
if(o===i.length)--o
return H[i[o]]}function stoneTierFromPos(e){if(we)return 0
var t=Ke(x(e,true))-e[2]
var r=0
while(t>=ze[r])++r
return r}function deepestOreFromWorldPos(e){var t=stoneTierFromPos(e)
var r=0
for(var a=0;a<=t;++a){var i=V[a][1]
if(i)for(var o=0;o<i.length;++o)r=ce(r,i[o])}return r}function liquidStableEstimate(e){var r=e.data,a=e.liquid
function solid(e){if(a[e])return true
var t=r[e]
if(t&&t<j)return true
return false}var t=0
for(var i=0;i<16;++i)for(var o=0;o<16;++o)for(var n=0;n<16;++n,++t){if(!a[t])continue
if(n>0&&!solid(t-1))return false
if(n<15&&!solid(t+1))return false
if(o>0&&!solid(t-16))return false
if(o<15&&!solid(t+16))return false
if(i>0&&!solid(t-256))return false}return true}function handleHexomeChoices(e){for(var t=0;t<e.length;++t){var r=e[t]
for(var a in r)C(a,r[a])}}function liquidQuickUpdate(e){var t=e.data
var r=e.liquid
if(!t||!r)return
for(var a=0;a<be;++a)for(var i=0;i<be;++i){var o=i+a*be
var n=-1
for(var s=0;s<be;++s){var l=o+s*Ne
if(r[l]){if(-1!==n){r[n]=r[l]
r[l]=0
n+=Ne}}else if(!t[l]){if(-1===n)n=l}else n=-1}}}function topTile(e){if(e.surface_tile)return e.surface_tile
if(e.h>e.surface_h)return e.surface
if(e.h>e.ground_h)return e.ground
return q}var ut=function(){var we=g()
var Le=He.createFast(0)
return function initPhase90fn(e){var t=Date.now();++Fe[90]
var r=new Ce(e.pos[0],e.pos[1],e.pos[2],e.chunk_id,null,xe)
var a=r.pos_world
var i=De(r.pos)
Pe(i)
var o=a[2]
Le.reseed(r.chunk_id+i.seed)
if(o<=i.max_z){var n=false
var s=o+be
var l=i.map
var _=true
var c=true
Oe(!r.data)
var u=null
var d=0
for(var f=0;f<be;++f){var v=l[f]
for(var h=0;h<be;++h){var p=v[h]
var m=p.h,E=p.surface,g=p.surface_h,T=p.surface_tile,y=p.ground,S=p.ground_h,I=p.water_level,A=p.base
if(o>m&&o>I){if(o===m+1)n=true
c=_=false
continue}if(s>=m)n=true
if(!u){r.alloc()
u=r.data}if(I>m)if(!r.liquid)r.alloc(true)
var w=f*be+h
var L=Ke(A)
for(var O=0;O<be;++O){var R=o+O
if(R>m&&R>I){c=_=false
break}var b=void 0
var N=false
if(R>m){b=Ye
N=true
_=false}else if(R===m&&T)b=T
else if(R>g)b=E
else if(R>S)b=y
else{var C=Le.random()
var x=L-R
while(x>=ze[d])++d
while(d>0&&x<ze[d-1])--d
b=Be(a[0]+h,a[1]+f,R+5*C-2.5,d)}if(N)r.liquid[w]=b
else u[w]=b
w+=Ne}}}if(n){var M=i.plants
var D=He.createGood(seedPlants(i))
for(var P=0;P<M.length;++P){var B=M[P],k=B.weight,U=B.plant
var G=U.id,F=U.freq,W=U.over,H=U.chance,z=U.offs,V=U.attr1_list,Y=U.attr2,j=U.attr3_list,K=U.size,q=U.underwater_only
if(!K)K=ke
var Z=U.min
var X=U.max
var Q=Z+Ge(Me[0],i.pos_world,F,z,X-Z+1)
if(Q<=0)continue
H*=k
var $=K[0]
var J=K[1]
var ee=K[2]
e:for(var te=0;te<Q;++te){if(D.random()>H)continue
var re=D.range(be-$+1)
var ae=D.range(be-J+1)
var ie=D.range(4)
var oe=j?j[D.range(j.length)]:void 0
var ne=V?V[D.range(V.length)]:void 0
var se=Infinity
for(var le=0;le<J;++le)for(var _e=0;_e<$;++_e){var ce=l[ae+le][re+_e].h
se=je(se,ce)}if(se<o-1||se+ee>=s)continue
if(!(re&&l[ae][re-1].h===se||ae&&l[ae-1][re].h===se||re<be-$&&l[ae][re+$].h===se||ae<be-J&&l[ae+J][re].h===se))continue
se++
if(!u){r.alloc()
u=r.data}Re(we,re,ae,se-o)
var ue=we[2]*Ne+we[1]*be+we[0]
for(var de=0;de<ee;++de)for(var fe=0;fe<J;++fe)for(var ve=0;ve<$;++ve){var he=ue+ve+fe*be+de*Ne
var pe=r.liquid&&r.liquid[he]
if(u[he]||!q&&pe||q&&!pe)continue e}for(var me=0;me<J;++me)for(var Ee=0;Ee<$;++Ee)if(!W[topTile(l[ae+me][re+Ee])])continue e
if(!r.props)r.props={}
r.props[ue]={id:G,rot:ie,attr1:ne,attr2:Y,attr3:oe,size:K}
for(var ge=0;ge<ee;++ge)for(var Te=0;Te<J;++Te)for(var ye=0;ye<$;++ye)u[ue+ye+Te*be+ge*Ne]=Ve+ye+Te+ge}}}r.full=_
if(r.liquid)r.liquid_stable=c||liquidStableEstimate(r)}Ue({vd:r,vs:i,non_spatial_rand:Le})
var Se=r.props
if(Se)for(var Ie in Se){var Ae=Se[Ie]
Oe(Ae.size)
Oe(Ae.size[0]&&Ae.size[1]&&Ae.size[2])
Ae.proc_genned=true}if(r.liquid)liquidQuickUpdate(r)
We[90]+=Date.now()-t
return r}}()
var dt=l()
function calcZMap(e,t){++Fe.zm
var r=Date.now()
var a=new L
var i=a.data
var o=e.max_solid_z
dt[0]=e.pos_world[0]
dt[1]=e.pos_world[1]
dt[2]=o
o=ce(o,B(dt))
var n=Z((o+be-1)/be)
var s=Z(e.max_solid_z/be)-8
var l={}
var _=(l[t.pos[2]]=t).pos[0]+t.pos[1]*T
for(var c=0;c<Ne;++c){var u=w
e:for(var d=n;d>s;--d){var f=l[d]
if(!f){f=l[d]=ut({pos:[t.pos[0],t.pos[1],d],chunk_id:_+d*E});(Ae[f.chunk_id]=f).alloc_time=r
if(!Xe)extraChunkCleanupSchedule()}var v=f.data
if(!v)continue
for(var h=be-1;h>=0;--h){var p=v[c+h*Ne]
if(!p)continue
if(p<=K){u=d*be+h
break e}}}i[c]=u}st(e.vsid,a)
We.zm+=Date.now()-r}function gen(e){var t=Ae[e.chunk_id]
if(t){delete Ae[e.chunk_id]
return t}var r=Date.now();++Fe[100]
t=ut(e)
if(st&&!e.has_zmap){var a=De(t.pos)
if(!a.have_zmap)if(t.pos[2]>=a.max_solid_z/be+y/2);else if(t.pos[2]>a.max_solid_z/be-y/2){a.have_zmap=true
calcZMap(a,t)}else if(!a.have_zmap_prelim){a.have_zmap_prelim=true
st(a.vsid,A)}}We[100]+=Date.now()-r
return t}function startup(){ee.startup()
U()}},{"../common/globals":248,"../common/materials_common":253,"../common/voxel_data_common":264,"../glov/client/rand_fast":347,"../glov/common/rand_alea":395,"../glov/common/util":400,"../glov/common/vmath":402,"./biome_details":23,"./continent":46,"./line2d":123,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./proc_gen_details":166,"./proc_gen_hydro":167,"./proc_gen_shared":168,"./rand_seed":175,"./stone_tiers":194,"./tiles":199,assert:void 0}],163:[function(r,e,o){"use strict"
o.setLODMode=setLODMode
o.procGenDoLODs=procGenDoLODs
o.riverDeltaHeight=riverDeltaHeight
o.riverDeltaSmoothNoise=riverDeltaSmoothNoise
o.flushVerticalSlices=flushVerticalSlices
o.worldStoneType=worldStoneType
o.sampleUniformNoise3D=sampleUniformNoise3D
o.seedWorld=seedWorld
o.choiceDataSet=choiceDataSet
o.onHexomeChoice=onHexomeChoice
o.getHexome=getHexome
o.getHexomeExact=getHexomeExact
o.getContinentIDsForPos=getContinentIDsForPos
o.BlendWeightContext=BlendWeightContext
o.calcBlendWeightsVS=calcBlendWeightsVS
o.VerticalSlice=VerticalSlice
o.getVerticalSliceById=getVerticalSliceById
o.getVerticalSlice=getVerticalSlice
o.getVerticalSliceWorldPos=getVerticalSliceWorldPos
o.getParam=getParam
o.getElevationEstimate=getElevationEstimate
o.getChunkTintColor=getChunkTintColor
o.initPhase60=initPhase60
o.handleMC2DUnsub=handleMC2DUnsub
o.startup=startup
o.initPhase50=o.getVSElevAndTile=o.getVSTintColors=o.calcBlendWeights=o.getHexomeIDsFromChunkPos=o.getHexomeIDExact=o.rflow_cache=o.vertical_slices=o.getDetailsVersion=o.getElevation=o.RFLOW_UNDERWATER=o.NOISE_CUSTOM_IDX=o.NOISE_DETAIL_IDX=o.world_noise3D=o.world_noise=o.biome_noise=void 0
var Z=new Array(5)
o.biome_noise=Z
var n=new Array(10)
o.world_noise=n
var s=new Array(1)
o.world_noise3D=s
var t=5
o.NOISE_DETAIL_IDX=t
var a=6
o.NOISE_CUSTOM_IDX=a
var f=99
o.RFLOW_UNDERWATER=f
var X=r("assert")
var m=r("../glov/client/hsv").hsvToRGB
var l=r("../glov/client/rand_fast").randSimpleSpatial
var u=r("../glov/common/rand_alea").mashString
var i=r("../glov/common/util")
var A=i.clamp
var v=i.isPowerOfTwo
var _=i.lerp
var c=i.nop
var D=i.ridx
var d=r("../glov/common/vmath")
var P=d.unit_vec
var h=d.v2add
var Q=d.v2addScale
var B=d.v2distSq
var $=d.v2floor
var p=d.v2length
var J=d.v2scale
var E=d.v2set
var ee=d.v2sub
var te=d.v3add
var re=d.v3scaleFloor
var ae=d.v3sub
var w=d.vec2
var ie=d.vec3
var g=d.zero_vec
var T=r("open-simplex-noise").makeNoise3D
var y=r("simplex-noise")
var S=r("../common/globals")
var oe=S.CHUNK_SIZE
var ne=S.ID2
var se=S.ID_FACTOR
var L=S.MEGACHUNK_SIZE
var le=S.MEGACHUNK_VOXEL_SIZE
var I=r("../common/waygate_common").FLAT_SEED_EMPTY
var _e=r("./biome_details")
var O=r("./biome_types")
var R=O.BIOMES
var b=O.BIOME_BY_ID
var N=O.BIOME_PARAM_TYPE
var C=O.TYPE_ARR
var x=O.TYPE_NON_INTERP
var M=O.setupFlat
var k=r("./context")
var U=k.contextThreadName
var G=k.getAccessPrerelease
var F=r("./continent")
var W=F.continentGet
var H=F.continentGetID
var z=F.continentGetIDs
var V=F.continentReady
var ce=r("./detail_gen_rendered").renderedDetailGen
var Y=r("./proc_gen")
var j=r("./proc_gen").oreFromChunkPos
var K=r("./proc_gen_constants")
var q=K.C_HILLS
var ue=K.C_MOUNTAINS
var de=K.C_PLAINS
var fe=K.C_RIVER_DELTA
var ve=K.C_WATER
var he=K.HEX_HEIGHT
var pe=K.HEX_WIDTH
var me=K.SKEW_X
var Ee=K.SNOW_ELEVATION
var ge=K.SNOW_VARIATION
var Te=K.STONE_FREQ_XY
var ye=K.STONE_FREQ_Z
var Se=r("./proc_gen_details").DETAILS_CURRENT_VERSION
var Ie=r("./proc_gen_shared")
var Ae=Ie.intNoise
var we=Ie.neighbor_id_offs
var Le=Ie.phase_counts
var Oe=Ie.phase_timing
var Re=r("./rand_seed")
var be=r("./tiles")
var Ne=be.MAT_METAL_TINT
var Ce=be.NUM_STONES
var xe=be.STONES_BY_TIER
var Me=be.TILE_CORAL1
var De=be.TILE_DIRT
var Pe=be.TILE_GRASS
var Be=be.TILE_SAND
var ke=be.TILE_SNOW
var Ue=be.TILE_STONE_DARK
var Ge=be.TILE_STONE_LIGHT
var Fe=be.TILE_STONE_RED
var We=be.TILE_TINT_GRASS
var He=be.TILE_TINT_ORE
var ze=be.TILE_WATER
var Ve=Math.abs,Ye=Math.atan2,je=Math.ceil,Ke=Math.floor,qe=Math.max,Ze=Math.min,Xe=Math.round,Qe=Math.sqrt,$e=Math.cos,Je=Math.sin
var et
var tt
var rt
var at
var it
var ot
var nt
var st
o.getElevation=st
var lt
var _t
var ct
var ut
o.getDetailsVersion=ut
var dt=false
var ft=1e-4
var vt=[.005,.25]
var ht=[25,7]
var pt
o.vertical_slices=pt
var mt
o.rflow_cache=mt
var Et
var gt
var Tt
var yt=false
function setLODMode(){yt=true}var St=true
function procGenDoLODs(){return St}function sampleRidgeNoise(e,t,r,a){return 1-Ve(n[e].noise2D(r*t,a*t))}function sampleNoise(e,t,r,a){return n[e].noise2D(r*t,a*t)}function mountainsHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
a=50*sampleRidgeNoise(3,.005,t,r)
return(a+=5*sampleRidgeNoise(4,.02,t,r))-10}function spiral(e,t){var r=p([e,t])
var a=Ye(t,e)
return Je(100*(Qe(r)-.02*a-.3))}function reefHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
var i=sampleNoise(3,.001,t,r)
var o=sampleNoise(4,.001,t,r)
a=10*spiral(sampleNoise(3,.001,t+500*i,r+500*o),sampleNoise(4,.001,t+500*i,r+500*o))
a*=sampleNoise(3,.002,t,r)
return(a+=5*sampleRidgeNoise(3,.01,t,r))+20*sampleNoise(3,1/600,t+i,r+o)}function spikyHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
a=sampleNoise(2,.05,t,r)
if((a-=5*sampleNoise(1,.01,t,r))>0){var i
var o
var n
o=10*sampleNoise(1,.05,t,r)
n=10*sampleNoise(2,.05,t,r)
i=sampleNoise(2,.05,t+=o,r+=n)
i-=5*sampleNoise(1,.01,t,r)
a*=Ve(i*i/2*sampleNoise(2,.005,t,r))}return a}function shallowsSpikyHeight(e){return spikyHeight(e)-20}function shallowsSpikyReef(e,t,r){var a=e.map[r][t]
e.pos_world[0]+=t
e.pos_world[1]+=r
if(shallowsSpikyHeight(e)>-15){if(getNeighbourCount(t,r,e,a.h)>.5){a.surface_depth=1
a.surface_h=a.h-1}}else{a.surface_depth=1
a.surface_h=a.h-1}e.pos_world[0]-=t
e.pos_world[1]-=r}var It=w(0,0)
function rotate(e,t){var r=e[0]
It[0]=e[2]
It[1]=e[3]
ee(t,t,It)
var a=t[0]*$e(r)-t[1]*Je(r)
var i=t[0]*Je(r)+t[1]*$e(r)
return E(It,a,i)}var At=w()
var wt=w()
function riverDeltaHeight(e){var t=e.pos_world[0]
var r=e.pos_world[1]
var a
a=15*sampleNoise(1,1/30,t,r)
r+=15*sampleNoise(2,1/30,t,r)
var i
wt[0]=t+=a
wt[1]=r
if(e.dir){(At=rotate(e.dir,wt))[0]*=10
i=10*sampleNoise(3,.005,_(.6,t,At[0]),_(.6,r,At[1]))}else{i=10*sampleNoise(3,.005,t,r);--i}return i}var Lt
function getNeighbourCount(e,t,r,a){var i=0
var o=9
for(var n=-1;n<=1;++n){if(t+n<0||t+n>oe-1){o-=3
continue}var s=r.map[t+n]
for(var l=-1;l<=1;++l){var _=s[e+l]
if(0===l&&0===n||e+l<0||e+l>oe-1){o--
continue}if(_.h===a)i++}}Lt=8!==o
return i/o}function deltaKernel(e,t){if(t<e.h-1)--e.h
if(t>e.h+1)e.h+=1}function mountainKernel(e,t,r,a){if(t===e.h&&e.surface!==ke){e.surface_h=e.h-1
e.surface=r
e.ground_h=e.h-a}}function reefKernel(e,t,r,a){if(t>=e.h-1&&t<=e.h+1){e.surface_h=e.h-1
e.surface=r}}function grassFire(e,t,r,a,i,o){var n=e[r][t].h
if(t>0)a(e[r][t-1],n,i,o)
if(t<oe-1)a(e[r][t+1],n,i,o)
if(r>0)a(e[r-1][t],n,i,o)
if(r<oe-1)a(e[r+1][t],n,i,o)}function riverDeltaSmoothNoise(e,t,r){grassFire(e.map,r,t,deltaKernel)}function aboveWaterLine(e,t,r){return e.h>=e.water_level-2*l(at,t,r,0)}function corallyReef(e,t,r){var a=e.pos_world[0]+t
var i=e.pos_world[1]+r
var o=e.map[r][t]
var n
var s
n=sampleNoise(1,.1,a,i)
s=sampleNoise(2,.05,a,i)
if(getNeighbourCount(t,r,e,o.h)<.5&&n<.7&&s<.7){o.surface_h=o.h-1
o.surface=Me}else grassFire(e.map,t,r,reefKernel,Be,2)
if(aboveWaterLine(o,a,i)){o.surface=Be
o.ground=De}}function grassyMountain(e,t,r){var a=e.map[r][t]
var i=e.pos_world[0]
var o=e.pos_world[1]
var n
var s
var l
if(a.surface!==ke){var _=sampleRidgeNoise(3,1/80,i=e.pos_world[0]+t,o=e.pos_world[1]+r)
n=13*sampleRidgeNoise(1,.05,i,o)
s=10*sampleRidgeNoise(2,.05,i,o)
if((l=sampleRidgeNoise(3,.1,i+=n,o+=s))<.4&&_<.4){a.surface=Ge
a.surface_h=a.h-1}else if(l<.6&&_<.4){a.surface=Ue
a.surface_h=a.h-1}}var c=getNeighbourCount(t,r,e,a.h)
n=13*sampleRidgeNoise(1,1/30,i=e.pos_world[0]+t,o=e.pos_world[1]+r)
s=10*sampleRidgeNoise(2,1/30,i,o)
l=sampleRidgeNoise(3,1/30,i+=n,o+=s)
i=e.pos_world[0]
o=e.pos_world[1]
e.pos_world[0]=i+t
e.pos_world[1]=o+r
var u=mountainsHeight(e)
e.pos_world[0]=i
e.pos_world[1]=o
if(u<20&&l>.95&&c<.6&&a.surface!==ke){a.surface_h=a.h-1
a.surface=Fe}if(c>.6&&a.surface!==ke&&u<40){a.surface_h=a.h-1
a.ground_h=a.h-2
a.surface=De
grassFire(e.map,t,r,mountainKernel,De,2)
if(c>.7&&a.h<Ee+50*(sampleRidgeNoise(1,1/30,e.pos_world[0]+t,e.pos_world[1]+r)-.5)){a.surface_h=a.h-1
a.ground_h=a.h-2
a.surface=Pe
grassFire(e.map,t,r,mountainKernel,Pe,2)}}else if(c<.15&&a.surface===ke){i=e.pos_world[0]+t
o=e.pos_world[1]+r
if(l>.6){a.surface_h=a.h
a.ground_h=a.h}}}var Ot=[Fe,De]
function dirtyDesert(e,t,r){var a=e.map[r][t]
if(a.surface!==Be)return
var i=e.pos_world[0]+t
var o=e.pos_world[1]+r
if(sampleNoise(1,1,i,o)<-.9)if(1===getNeighbourCount(t,r,e,a.h)&&!Lt){var n=Ke(l(at,i,o,0)*Ot.length)
a.surface_tile=Ot[n]}}function hexomeMountainSpireHeight(e){return e.w0*e.w0*e.w0*140}function cliffsHeight(e){var r=e.pos_world[0]
var a=e.pos_world[1]
function sample(e,t){return t[0]*(.5+.5*n[e].noise2D(r*t[1],a*t[1]))}var t=e.hexome
var i=Ze(sample(0,[1,.025]),sample(1,[1,.025]))
return(.25+.25*t.biome_param)*(.5*t.cliff_height*i*i+.125*t.cliff_height*Ve(n[2].noise2D(r/16,a/16)))}function sampleNoises(e,t,r){var a=0
for(var i=0;i<t.length;++i){var o=t[i]
if(o)a+=o*(.5+.5*n[i].noise2D(e[0]*r[i],e[1]*r[i]))}return a}function genericHeight(e){var t=e.hexome
return sampleNoises(e.pos_world,t.params.noise_weights,t.params.noise_periods)}var Rt=[12,-3]
var bt=[.025,1/8]
function reefBlend(e,t){return A(4*sampleNoise(2,.01,e,t)+.5*sampleNoise(3,.1,e,t)+.25,0,1)}function reefMassHeight(e){var t=e.pos_world
var r=genericHeight(e)
var a=sampleNoises(t,Rt,bt)
return _(reefBlend(t[0],t[1]),r,a)}function reefMassLocal(e,t,r){var a=e.pos_world[0]+t
var i=e.pos_world[1]+r
var o=reefBlend(a,i)
var n=e.map[r][t]
if(aboveWaterLine(n,a,i)){n.surface=Be
n.ground=De}else if(o<.25)n.surface=Be
else n.surface=Me}function hexomeHillHeight(e){return genericHeight(e)+40*e.w0}var Nt={genericHeight:genericHeight,mountainsHeight:mountainsHeight,reefHeight:reefHeight,corallyReef:corallyReef,reefMassHeight:reefMassHeight,reefMassLocal:reefMassLocal,cliffsHeight:cliffsHeight,grassyMountain:grassyMountain,riverDeltaHeight:riverDeltaHeight,riverDeltaSmoothNoise:riverDeltaSmoothNoise,spikyHeight:spikyHeight,shallowsSpikyHeight:shallowsSpikyHeight,shallowsSpikyReef:shallowsSpikyReef,hexomeHillHeight:hexomeHillHeight,hexomeMountainSpireHeight:hexomeMountainSpireHeight,dirtyDesert:dirtyDesert}
function VeriticalSlices(){}function flushVerticalSlices(){o.vertical_slices=pt=new VeriticalSlices}function worldStoneType(e,t,r,a){var i=s[0](e*Te,t*Te,r*ye)
var o=A(Ke(i*Ce),0,Ce-1)
if("flat"===it||"v1"===it)a=0
return xe[a%xe.length][o]}var Ct=new Float32Array([0,.001349,.001349,.008905,.010254,.027101,.037364,.05666,.094024,.083166,.17719,.099867,.277057,.109412,.386469,.114112,.500581,.114131,.614712,.108271,.722983,.099347,.82233,.082007,.904337,.05668,.961017,.028057,.989074,.009402,.998476,.001524])
var xt=16
function sampleUniformNoise3D(e,t,r){var a=s[0](e,t,r)
if((a=qe(0,a*xt))>=xt)return 1
var i=Ke(a)
var o=a-i
return Ct[2*i]+Ct[2*i+1]*o}function getDetailsVersionCurrent(){return Se}function getDetailsVersion0(){return 0}function makeNoise3DNormal(e){var a=T(e)
return function(e,t,r){return A(.5+.58*a(e,t,r),0,1)}}function Hexomes(){}function seedWorld(e){X(e&&e.seed&&e.world_type)
at=e.seed
it=e.world_type
flushVerticalSlices()
Et=new Hexomes
Tt={}
gt={}
o.rflow_cache=mt={}
St=true
switch(it){case"v1":ot=hexomeInitV1
nt=hexomeInitAfterBiomeTypeV1
o.getElevation=st=ct
lt=getElevationEstimateV1
_t=getBiomeTypeV1
o.getDetailsVersion=ut=getDetailsVersionCurrent
break
default:console.error("Unknown world type: "+it+", using flat")
case"flat":if(at===I){ot=hexomeInitEmpty
St=false}else ot=hexomeInitFlat
nt=c
o.getElevation=st=getElevationFlat
lt=getElevationFlat
_t=getBiomeTypeFlat
o.getDetailsVersion=ut=getDetailsVersion0
M(at)}var t="pc"+e.seed
for(var r=0;r<Z.length;++r)Z[r]=new y(""+t+r+"biome")
for(var a=0;a<n.length;++a)n[a]=new y(""+t+a+"world")
for(var i=0;i<s.length;++i)s[i]=makeNoise3DNormal(u(""+t+i+"world"))}function choiceDataSet(e,t){gt[e]=t}function hexomeInitEmpty(e){e.elevation=R.FLAT.fixed_elev
e.water_level=e.elevation}function hexomeInitFlat(e){e.elevation=R.FLAT.fixed_elev
e.water_level=-1}function hexomeInitV1(e){var t=z(e.hx,e.hy)
e.continent=W(t.cid)
var r=e.cont_idx=t.idx
e.cont_elevation=e.continent.getElevation(r)
e.slopes=e.continent.getSlopes(r)
e.humidity=e.continent.getHumidity(r)
e.cdist=e.continent.getCoastDistance(r)
e.water_level=e.continent.getWaterLevel(r)
e.classif=e.continent.getClassif(r)
e.river_bits=e.continent.getRiver(r)
e.rflow_dir=e.continent.getFlowDir(r)
e.rflow_amt=e.continent.getFlowAmount(r)
if(!e.river_bits&&7!==e.rflow_dir){e.rflow_dir=-1
e.rflow_amt=0}}function hexomeInitAfterBiomeTypeV1(e,t){e.elevation=e.cont_elevation
e.biome_param=t.random()
if(e.type===R.CLIFFS){var r=e.continent.getMinElev(e.cont_idx)
e.cliff_height=e.cont_elevation-r
e.elevation=r}}function getBiomeTypeFlat(e,t){return R.FLAT}var Mt=1
var Dt=.25
var Pt=.03
function weightedChoiceBuild(e){var t=0
for(var r=0;r<e.length;++r)t+=e[r][0]
return{total:t,list:e}}function weightedChoiceGet(e,t){var r=e.total,a=e.list
var i=r*t
for(var o=0;o<a.length;++o)if((i-=a[o][0])<=0)return a[o][1]
return a[0][1]}var Bt=weightedChoiceBuild([[Mt,"DENSE_FOREST_LEAVES"],[Dt,"PLAINS_FOREST"],[Dt,"PLAINS_FOREST_SPIKY"],[Pt,"FOREST_RUIN"],[Pt,"FOREST_MEGA_TREE"]])
var kt=weightedChoiceBuild([[Mt,"PLAINS_FOREST"],[Dt,"PLAINS"],[Dt,"PLAINS_WITH_BERRIES"]])
var Ut=weightedChoiceBuild([[Mt,"PLAINS"],[Pt,"PLAINS_BLUE_V3"],[Pt,"PLAINS_RED_V2"],[Pt,"PLAINS_YELLOW"],[Pt,"HILLS"]])
var Gt=weightedChoiceBuild([[Mt,"MOUNTAINS"],[Dt,"SNOW_PINE_MOUNTAINS"],[Pt,"MOUNTAINS_FLOATY_ROCKS"]])
var Ft=weightedChoiceBuild([[Mt,"OCEAN"],[Mt,"CORAL_REEF_RIDGES"],[Mt,"CORAL_REEF_MASS"],[Dt,"CORAL_REEF_CAVES"]])
function getBiomeTypeV1(e,t){var r=e.cont_elevation,a=e.slopes,i=e.humidity,o=e.cdist,n=e.classif,s=e.river_bits
var l
if(n===ve)if(Ve(r-e.water_level)<20)l=R.SHALLOWS_SPIKY
else if(Ve(r-e.water_level)>50){var _=weightedChoiceGet(Ft,t)
l=R[_]}else l=R.OCEAN
else if(n===fe)l=R.RIVER_DELTA
else{var c=s&&v(s)
var u=a[3]
var d
if(u>.6&&o<.01)d="CLIFFS"
else if(n===ue)if(u>.12||r<Ee)d=weightedChoiceGet(Gt,t)
else d="TUNDRA"
else if(n===q)if(i>.66)d="HILLS_FOREST"
else d="HILLS"
else if(n===de)if(i>.75)d=weightedChoiceGet(Bt,t)
else if(i>.5)d=weightedChoiceGet(kt,t)
else if(i>.25)d=weightedChoiceGet(Ut,t)
else d="DESERT_V2"
else X(0)
if(c&&R[d+"_SPRING"])d+="_SPRING"
l=R[d]}X(l)
if(!G()&&l.next_release){if(!l.fallback_biome)X(false,"Generated unreleased biome without fallback: "+l.name)
var f=l.fallback_biome
if(!(l=R[f])||l.next_release)X(false,"Invalid fallback_biome: "+f)}return l}function rangeOrValue(e,t){if("number"!==typeof t&&t.length)return e.floatBetween(t[0],t[1])
return t}var Wt=0
var Ht=Re.createGood(0)
function Hexome(e,t,r){var a=Xe(e/se)
var i=e-a*se
if(a!==r||i!==t)X(false,"Unexpected Hexome("+e+", "+t+", "+r+") !== "+i+","+a)
this.uid=++Wt
this.phase=0
this.hid=e
this.hx=t
this.hy=r
this.dist=0
this.dist_noisy=0
this.details=[]
this.hydro_output_vsid=null
var o=r-.5*t
var n=t/me
this.unif_pos=w(n,o)
this.pos_world=w(n*he,o*he)
ot(this)
Ht.reseed(u("b_"+at+"_"+this.pos_world[0]+"_"+this.pos_world[1]))
var s=Ht.random()
var l
var _=gt[this.hid]
if(_){l=_.seed
this.initFromChoiceData(_)}else{l=Ht.uint32()
this.initFresh(s,l)}Ht.reseed(l)
nt(this,Ht)
this.blend_weight=Ht.floatBetween(this.type.blend[0],this.type.blend[1])
this.params={}
for(var c in this.type)this.params[c]=this.type[c]
this.sort_uid=Ht.range(65536)
this.params.debug_color=m(ie(),rangeOrValue(Ht,this.type.debug_color_hsv[0]),rangeOrValue(Ht,this.type.debug_color_hsv[1]),rangeOrValue(Ht,this.type.debug_color_hsv[2]))}var zt
function onHexomeChoice(e){zt=e}Hexome.prototype.initFresh=function(e,t){this.seed=t
this.type=_t(this,e)
if(zt)zt(this)}
Hexome.prototype.initFromChoiceData=function(e){this.seed=e.seed
this.type=b[e.id]
X(this.type,e.id)}
Hexome.prototype.toChoiceData=function(){return{seed:this.seed,id:this.type.id}}
var Vt=function(){var o=w()
var n=w()
return function getHexomeIDExactFn(e){J(o,e,1/he)
n[0]=o[0]*me
n[1]=o[1]+.5*n[0]
var t=Ke(n[0])
var r=n[0]-t
var a=Ke(n[1])
var i=n[1]-a
if(i>1-r)if(i>2*r)++a
else if(i>.5*r){++t;++a}else++t
else if(i>.5*r+.5)++a
else if(i<=2*r-1)++t
return t+a*se}}()
o.getHexomeIDExact=Vt
var Yt=function(){var b=w()
var N=w()
var C=[[0,0],[1,1],[1,0]]
var x=[[0,0],[1,1],[0,1]]
var M=.005
return function getHexomesFn(e,t){X(e!==P)
X(isFinite(t[0]))
X(isFinite(t[1]))
J(b,t,1/he)
N[0]=b[0]*me
N[1]=b[1]+.5*N[0]
var r=Ke(N[0])
var a=N[0]-r
var i=Ke(N[1])
var o
if(a>N[1]-i)o=C
else o=x
var n=[]
var s=0
var l=0
for(var _=0;_<o.length;++_){var c=r+o[_][0]
var u=i+o[_][1]
var d=c+u*se
var f=Et[d]
if(!f)f=Et[d]=new Hexome(d,c,u)
var v=qe(0,.75-B(f.unif_pos,b))
var h=f.blend_weight
var p=v*v*h
if((p=Math.pow(v,2+4*(1-h)))>0){s+=p
if(n.length)if(p>l){l=p
e[n.length]=e[0]
e[0]=p
n.push(n[0])
n[0]=f}else{e[n.length]=p
n.push(f)}else{l=p
e[n.length]=p
n.push(f)}}}if(!n.length){var m=["up="+b[0]+","+b[1]+",wps="+t[0]+","+t[1]]
for(var E=0;E<o.length;++E){var g=r+o[E][0]
var T=i+o[E][1]
var y=g+T*se
var S=Et[y]
var I=qe(0,.75-B(S.unif_pos,b))
var A=S.blend_weight
var w=I*I*A
w=Math.pow(I,2+4*(1-A))
m.push("hid="+y+",hx="+g+",hy="+T+",up="+S.unif_pos[0]+","+S.unif_pos[1]+",d="+I+",bw="+A+",w="+w)}X(n.length,m.join("\n"))}var L=M*s
for(var O=n.length-1;O>=0;--O)if(e[O]<L){D(n,O)
e[O]=e[n.length]}for(var R=0;R<n.length;++R){e[R]/=s
X(n[R])}X(n.length)
return n}}()
var jt=function(){var g=w()
var T=w()
var y=[[0,0],[1,1],[1,0]]
var S=[[0,0],[0,1],[1,1]]
var I=-Qe(.75)
return function getHexomesContFn(e,t){J(g,t,1/he)
T[0]=g[0]*me
T[1]=g[1]+.5*T[0]
var r=Ke(T[0])
var a=T[0]-r
var i=Ke(T[1])
var o=T[1]-i
var n
if(a>o)n=y
else n=S
var s=[]
for(var l=0;l<n.length;++l){var _=r+n[l][0]
var c=i+n[l][1]
var u=_+c*se
var d=Et[u]
if(!d)d=Et[u]=new Hexome(u,_,c)
s.push(d)}var f=s[2]
var v=f.unif_pos[0]
var h=f.unif_pos[1]
var p
var m
if(a>o){p=(g[0]-v)/I
m=(-.5*(g[0]-v)+I*(g[1]-h))/I}else{p=(.5*(g[0]-v)+-I*(g[1]-h))/I
m=(.5*(g[0]-v)+I*(g[1]-h))/I}var E=1-p-m
e[0]=A(p,0,1)
e[1]=A(m,0,1)
e[2]=A(E,0,1)
return s}}()
function getHexome(e){var t=Et[e]
if(!t){var r=Xe(e/se)
var a=e-r*se
t=Et[e]=new Hexome(e,a,r)}return t}function getHexomeExact(e){return getHexome(Vt(e))}var Kt=function(){var l=w()
var _=w()
var c=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[1,2],[2,2]]
var u=[[-1,-1],[0,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]]
var d=oe/he
return function getHexomeIDsFromChunkPosFn(e){J(l,e,d)
_[0]=l[0]*me
_[1]=l[1]+.5*_[0]
var t=Ke(_[0])
var r=_[0]-t
var a=Ke(_[1])
var i
if(r>_[1]-a)i=c
else i=u
var o=[]
for(var n=0;n<i.length;++n){var s=t+i[n][0]+(a+i[n][1])*se
o.push(s)}return o}}()
o.getHexomeIDsFromChunkPos=Kt
var qt=[[-2,1],[2,3],[-2,-3],[2,-1]]
function getContinentIDsForPos(e,t,r){X(r)
var a=Vt(t)
var i=Xe(a/se)
var o=a-i*se
var n=je(r/he/2)
var s=0
for(var l=0;l<4;++l){var _=qt[l]
var c=H(o+_[0]*n,i+_[1]*n)
if(!s||-1===e.lastIndexOf(c,s-1))e[s++]=c}return s}function BlendWeightContext(){this.hexomes=null
this.hexomes_noisy=null
this.hexomes_cont=null
this.blend_weights=new Float32Array(3)
this.blend_weights_noisy=new Float32Array(3)
this.blend_weights_cont=new Float32Array(3)}var Zt=function(){var o=w()
var n=w()
var s=w()
var l=w()
return function calcBlendWeightsFn(e,t,r,a,i){if(!a){s[0]=Z[1].noise2D(t[0]*vt[0],t[1]*vt[0])*ht[0]
s[1]=Z[2].noise2D(t[0]*vt[0],t[1]*vt[0])*ht[0]
h(o,t,s)
if(!i)e.hexomes=Yt(e.blend_weights,o)
e.hexomes_cont=jt(e.blend_weights_cont,o)}if(r){l[0]=Z[3].noise2D(t[0]*vt[1],t[1]*vt[1])*ht[1]
l[1]=Z[4].noise2D(t[0]*vt[1],t[1]*vt[1])*ht[1]
h(n,o,l)
e.hexomes_noisy=Yt(e.blend_weights_noisy,n)}}}()
o.calcBlendWeights=Zt
function calcBlendWeightsVS(e,t,r){var a=e.blend_pos_world
h(a,e.pos_world,t)
if(e.single_hexome){Zt(e,a,false,false,true)
return}Zt(e,a,r)
e.blend_primary_hexome=e.hexomes[0]
if(r)e.blend_primary_hexome_noisy=e.hexomes_noisy[0]}function VerticalSlice(e){var t=Xe(e/se)
var r=e-t*se
this.pos_world=w(r*oe,t*oe)
this.vsid=e
this.single_hexome=false
this.phase=0
if(!yt){this.map=null
this.max_z=0}}function getVerticalSliceById(e){var t=pt[e]
if(!t)initPhase30(t=pt[e]=new VerticalSlice(e))
return t}function getVerticalSlice(e){return getVerticalSliceById(e[0]+e[1]*se)}var Xt=w()
function getVerticalSliceWorldPos(e){J(Xt,e,1/oe)
$(Xt,Xt)
return getVerticalSlice(Xt)}function getParam(e,t,r,a){var i=a?e.blend_weights_noisy:e.blend_weights
var o=a?e.hexomes_noisy:e.hexomes
var n=o.length
switch(N[r]){case x:return(a?e.blend_primary_hexome_noisy:e.blend_primary_hexome).params[r]
case C:for(var s=0;s<t.length;++s)t[s]=0
for(var l=0;l<n;++l){var _=i[l]
if(_){var c=o[l].params[r]
for(var u=0;u<t.length;++u)t[u]+=_*c[u]}}return t
default:X(0)
return 0}}function getElevationFlat(e){e.last_base_elevation=R.FLAT.fixed_elev
return R.FLAT.fixed_elev}var Qt=.333*he
function cubicInterpElevation(e,t){var r=e.length
X.equal(r,3)
var a=e[0]
var i=e[1]
var o=e[2]
var n=a.elevation
var s=i.elevation
var l=o.elevation
var _=t[0]
var c=t[1]
var u=t[2]
var d
var f
var v
var h
var p
var m
if(i.hx>a.hx){d=n+a.slopes[1]*Qt
v=n+a.slopes[2]*Qt
f=s-i.slopes[1]*Qt
p=s-i.slopes[0]*Qt
h=l-o.slopes[2]*Qt
m=l+o.slopes[0]*Qt}else{d=n+a.slopes[0]*Qt
v=n+a.slopes[1]*Qt
f=s-i.slopes[0]*Qt
p=s+i.slopes[2]*Qt
h=l-o.slopes[1]*Qt
m=l-o.slopes[2]*Qt}return s*c*c*c+3*f*_*c*c+3*p*c*c*u+3*d*_*_*c+(d+v+f+p+h+m)/6*6*_*c*u+3*m*c*u*u+n*_*_*_+3*v*_*_*u+3*h*_*u*u+l*u*u*u}var $t=new Float32Array(3)
var Jt=0
var er=w()
var tr=w()
function getElevationEstimateV1(e,t){if(!V(e,3*he))return Jt
if(t){tr[0]=Z[1].noise2D(e[0]*vt[0],e[1]*vt[0])*ht[0]
tr[1]=Z[2].noise2D(e[0]*vt[0],e[1]*vt[0])*ht[0]
h(er,e,tr)
e=er}var r=jt($t,e)
return Jt=cubicInterpElevation(r,$t)}ct=function(){return function getElevationV1fn(e){var t=e.hexomes_cont
var r=e.blend_weights_cont
var a=cubicInterpElevation(t,r)
e.last_base_elevation=a
var i=e.blend_weights
var o=e.hexomes
var n=o.length
var s=0
var l={vs:e,pos_world:e.blend_pos_world}
for(var _=0;_<n;++_){var c=i[_]
if(c){var u=o[_]
var d=u.params.height_func
if(d){l.hexome=u
l.w0=t[0]===u?r[0]:t[1]===u?r[1]:r[2]
s+=c*d(l)}}}return a+s}}()
function getElevationEstimate(e,t){return lt(e,t)}var rr=new Float32Array(3)
var ar=new Float32Array(3)
var ir=new Float32Array(3)
var or=new Float32Array(2)
function initPhase30Base(e){e.blend_weights=rr
e.blend_weights_noisy=ar
e.blend_weights_cont=ir
e.blend_pos_world=or}var nr=w((oe-1)/2,(oe-1)/2)
function initPhase30(e){X.equal(e.phase,0);++Le[30]
var t=Date.now()
e.phase=30
initPhase30Base(e)
calcBlendWeightsVS(e,nr,false)
if(!yt){e.blend_weights_mid=e.blend_weights.slice(0)
e.hexomes_mid=e.hexomes.slice(0)
e.hexomes_cont_mid=e.hexomes_cont.slice(0)}e.owner_hexome=e.hexomes[0]
X(e.owner_hexome)
e.mid_elevation=st(e)
var r=e.last_base_elevation
var a=.5+.5*n[3].noise2D(e.pos_world[0]*ft,e.pos_world[1]*ft)
e.mid_elevation_eroded=_(a=.1+.8*a*a*a,e.mid_elevation,r)
e.mid_hexome_exact=getHexomeExact(e.blend_pos_world)
if(!yt){calcBlendWeightsVS(e,g,false)
e.origin_hexomes=e.hexomes.slice(0)
e.seed=e.vsid+e.owner_hexome.seed}Oe[30]+=Date.now()-t}var sr=function(){var p=ie()
return function getTintFn(e,t,r,a){var i=e.blend_weights_noisy
var o=e.hexomes_noisy
var n=o.length
for(var s=0;s<p.length;++s){var l=0
var _=0
var c=void 0
for(var u=0;u<n;++u){var d=i[u]
if(d){var f=o[u].params[a]
if(!f)f=o[u].params.tint_grass_hsv
var v=f[s]
if(Array.isArray(v)){X(v.length>=4)
var h=v[3]+v[2]
if(v.length>=5)h+=1e4*v[4]
if(_!==h){_=h
c=.5+.5*Z[v.length>=5?v[4]:s].noise2D(t[0]*v[2]+v[3],t[1]*v[2])}v=(v[1]-v[0])*c+v[0]}l+=d*v}}p[s]=l}m(r,p[0],p[1],p[2])}}()
var lr=function(){var o=new VerticalSlice
initPhase30Base(o)
return function getVSTintColorsFn(e,t,r){var a=Tt[e]
if(!a){Zt(o,t,true)
Tt[e]=a=[]
var i=a[We]=ie()
sr(o,t,i,"tint_grass_hsv")}return a[r]}}()
o.getVSTintColors=lr
function getChunkTintColor(e,t){X.equal(t,He)
var r=j(e)
return Ne[r]}var _r=function(){var _=new VerticalSlice
initPhase30Base(_)
var c=ie()
var u=ie()
var d=Ee+.5*ge
return function getVSElevAndTileFn(e,t){_.blend_pos_world=t
Zt(_,t,false)
_.blend_primary_hexome=_.hexomes[0]
var r=_.blend_primary_hexome.water_level
var a=st(_)
var i
var o
var n
if(a<r){a=r
o=ze
n=f}else if(n=mt[e])o=ze
if(a>d)i=ke
else if(qe(0,Xe(getParam(_,c,"surface_depth",false)[0]))>0)i=getParam(_,null,"surface",false)
else{getParam(_,c,"ground_depth",false)
var s=.5
if(qe(0,Xe(c[0]+c[1]*s))>0)i=getParam(_,null,"ground",false)
else i=worldStoneType(t[0],t[1],a,0)}var l
if(i===Pe){Zt(_,t,true,true)
sr(_,t,u,"tint_lod_hsv")
l=u}return{elev:a,tile:i,tint:l,liquid:o,rflow_amt:n}}}()
o.getVSElevAndTile=_r
function seedDetails(e){X(e.phase>=30)
return e.seed}function uninitPhase50(e){if(e.phase<50)return
X.equal(e.phase,50)
e.details.length=0
e.phase=37}var cr=function(){var V=w()
var Y=w()
var j=w()
var K=ie()
var q=Re.createGood(0)
return function initPhase50fn(I){if(I.phase>=50)return
if(I.phase<37)tt(I);++Le[50]
var e=Date.now()
I.phase=50
J(V,I.pos_world,1/oe)
$(V,V)
var o={}
var n=[]
var s=[]
var l=[]
var A=Infinity
var _=-Infinity
var w=Infinity
function search(e,t){var r=getVerticalSliceById(e)
A=Ze(A,r.pos_world[0])
w=Ze(w,r.pos_world[1])
_=qe(_,r.pos_world[0])
if(r.owner_hexome===I)s.push(r)
else{l.push(r)
if(!t)return}for(var a=0;a<we.length;++a){var i=e+we[a]
if(!o[i]){o[i]=true
n.push(i)}}}var t=V[0]+V[1]*se
var r=t
search(t,o[t]=true)
while(n.length)search(t=n.pop())
var L=_-A+16
X(!I.details.length)
var O=[]
for(var a=0;a<l.length;++a){var i=l[a]
var c=i.pos_world[0]-A
var u=i.pos_world[1]-w
for(var d=0;d<oe-1;++d){O[u*L+c+d]=true
O[(u+d)*L+c+oe-1]=true
O[(u+oe-1)*L+c+d+1]=true
O[(u+d+1)*L+c]=true}}var R=0
function addDetail(e,t,r,a,i){var o=e.bounds,n=e.exclusion,s=e.priority
var l=q.uint32()
var _=++R
var c=t-A
var u=r-w
if(!a&&n)for(var d=0;d<n[1];++d)for(var f=0;f<n[0];++f)if(O[(u+d)*L+c+f])return
var v=ie(t,r)
if(n){for(var h=0;h<n[1];++h)for(var p=0;p<n[0];++p)O[(u+h)*L+c+p]=true
Q(Y,v,n,.5)}else{Y[0]=v[0]+(o[0][0]+o[1][0])/2
Y[1]=v[1]+(o[0][1]+o[1][1])/2}$(Y,Y)
var m=getVerticalSliceWorldPos(Y)
ee(j,Y,m.pos_world)
calcBlendWeightsVS(m,j,false)
var E=st(m)
v[2]=Xe(E)
var g
if(e.factory){if(!(g=e.factory(l,v,m,i)))return
X(!g.seed||g.seed===l)
g.seed=l
X(!g.uid)
g.uid=++_}else{var T=te(ie(),v,o[0])
var y=ae(ie(),o[1],o[0])
g=ce({priority:s,uid:_<<16|I.sort_uid,origin:v,pos_world:T,size:y,detail_type:e,seed:l,hexome:I,provider_data:i})}re(K,v,1/le)
var S=K[0]+K[1]*se+K[2]*ne
g.owner_mcid=S
X(g.bounds_buf)
X(g.bounds_idx>=0)
X(g.bounds_len<31)
I.details.push(g)}if(I.type.detail_provider){var f=getVerticalSliceById(r)
q.reseed(seedDetails(f))
var v=_e[I.type.detail_provider](I)
for(var h=0;h<v.length;++h){var p=v[h]
var m=p.pos,E=p.type,g=p.provider_data
var T=m[0]
var y=m[1]
X(T>=I.pos_world[0]-pe&&T<=I.pos_world[0]+pe)
X(y>=I.pos_world[1]-pe&&y<=I.pos_world[1]+pe)
addDetail(E,T,y,true,g)}}var S=I.type.details
for(var b=0;b<S.length;++b){var N=S[b]
var C=N.type_name,x=N.freq,M=N.offs,D=N.chance
var P=_e[C]
var B=N.min
var k=N.max
for(var U=0;U<s.length;++U){var G=s[U]
var F=B+Ae(Z[0],G.pos_world,x,M,k-B+1)
if(F<=0)continue
q.reseed(seedDetails(G))
for(var W=0;W<F;++W){var H=G.pos_world[0]+q.range(oe)
var z=G.pos_world[1]+q.range(oe)
if(q.random()>D)continue
addDetail(P,H,z,false)}}}Oe[50]+=Date.now()-e}}()
o.initPhase50=cr
function initPhase60(e){if(e.phase>=60)return;++Le[60]
var t=Date.now()
et(e)
e.phase=60
e.plants=[]
var r=false
for(var a=0;a<e.hexomes_mid.length;++a){var i=e.blend_weights_mid[a]
if(i){var o=e.hexomes_mid[a].type
if(o.plants&&o.plants.length)for(var n=0;n<o.plants.length;++n){var s=o.plants[n]
e.plants.push({weight:i,plant:s})
r=true}}}if(r)e.max_z++
Oe[60]+=Date.now()-t}function handleMC2DUnsub(e){var t=[]
var r=[]
var a={}
for(var i=0;i<e.length;++i){var o=e[i]
var n=Xe(o/se)
var s=o-n*se
var l=s*L+n*L*se
for(var _=0;_<L;++_)for(var c=0;c<L;++c){var u=pt[l+c+_*se]
if(u)t.push(u)}var d=Ke(s*le/pe)-1
var f=Ke(((s+1)*le-1)/pe)+1
for(var v=d;v<=f;++v){var h=n*le+v*he/2
var p=Ke(h/he)-1
var m=Ke((h+le-1)/he)+1
for(var E=p;E<=m;++E){var g=v+E*se
if(!a[g]){a[g]=true
var T=getHexome(g)
if(T.phase>=37)r.push(T)}}}}if(!t.length&&!r.length)return
for(var y=0;y<r.length;++y){uninitPhase50(r[y])
rt(r[y])}for(var S=0;S<t.length;++S){var I=t[S]
delete pt[I.vsid]}console.log(U(),"Unload "+t.length+" VSes, "+r.length+" Hexomes")}function startup(){et=Y.initPhase40
var e=r("./proc_gen_hydro.js")
tt=e.initPhase37
rt=e.uninitPhase37
for(var t in R){if(R[t].height_func){X(Nt[R[t].height_func])
R[t].height_func=Nt[R[t].height_func]}if(R[t].local_func){X(Nt[R[t].local_func])
R[t].local_func=Nt[R[t].local_func]}}if(dt){var u=[30,40]
var d=[]
setInterval(function(){var e=[]
var t=[]
var r=[]
for(var a=0;a<u.length;++a){e.push(0)
t.push([Infinity,Infinity])
r.push([-Infinity,-Infinity])}for(var i in pt){var o=pt[i]
for(var n=0;n<u.length;++n)if(o.phase>=u[n]){e[n]++
var s=t[n]
var l=r[n]
s[0]=Ze(s[0],o.pos_world[0])
s[1]=Ze(s[1],o.pos_world[1])
l[0]=qe(l[0],o.pos_world[0])
l[1]=qe(l[1],o.pos_world[1])}}for(var _=0;_<u.length;++_)if(isFinite(t[_][0])){var c=t[_]+"-"+r[_]+" ("+e[_]+")"
if(c!==d[_]){d[_]=c
console.log(U(),"Phase"+u[_]+":",c)}}},3e4)}}},{"../common/globals":248,"../common/waygate_common":265,"../glov/client/hsv":324,"../glov/client/rand_fast":347,"../glov/common/rand_alea":395,"../glov/common/util":400,"../glov/common/vmath":402,"./biome_details":23,"./biome_types":24,"./context":45,"./continent":46,"./detail_gen_rendered":75,"./proc_gen":162,"./proc_gen_constants":164,"./proc_gen_details":166,"./proc_gen_hydro.js":167,"./proc_gen_shared":168,"./rand_seed":175,"./tiles":199,assert:void 0,"open-simplex-noise":void 0,"simplex-noise":void 0}],164:[function(e,t,r){"use strict"
r.PROP_1x1x4=r.PROP_4x4x1=r.PROP_4x1x4=r.PROP_1x4x4=r.PROP_2x1x4=r.PROP_1x2x4=r.PROP_2x2x1=r.PROP_2x2x2=r.PROP_1x1x2=r.PROP_1x1x1=r.STONE_FREQ_Z=r.STONE_FREQ_XY=r.SNOW_VARIATION=r.SNOW_ELEVATION=r.C_RIVER_DELTA=r.C_MOUNTAINS=r.C_HILLS=r.C_PLAINS=r.C_WATER=r.HEX_WIDTH=r.SKEW_X=r.HEX_HEIGHT=r.HEX_EDGE=void 0
var a=Math.sqrt
var i=128
r.HEX_EDGE=i
var o=a(3)*i
r.HEX_HEIGHT=o
var n=1/a(.75)
r.SKEW_X=n
var s=1.5*i
r.HEX_WIDTH=s
var l=0
r.C_WATER=l
var _=1
r.C_PLAINS=_
var c=2
r.C_HILLS=c
var u=3
r.C_MOUNTAINS=u
var d=4
r.C_RIVER_DELTA=d
var f=900
r.SNOW_ELEVATION=f
var v=100
r.SNOW_VARIATION=v
var h=24e-6
r.STONE_FREQ_XY=h
var p=6e-4
r.STONE_FREQ_Z=p
var m=[1,1,1]
r.PROP_1x1x1=m
var E=[1,1,2]
r.PROP_1x1x2=E
var g=[2,2,2]
r.PROP_2x2x2=g
var T=[2,2,1]
r.PROP_2x2x1=T
var y=[1,2,4]
r.PROP_1x2x4=y
var S=[2,1,4]
r.PROP_2x1x4=S
var I=[1,4,4]
r.PROP_1x4x4=I
var A=[4,1,4]
r.PROP_4x1x4=A
var w=[4,4,1]
r.PROP_4x4x1=w
var L=[1,1,4]
r.PROP_1x1x4=L},{}],165:[function(e,t,r){"use strict"
r.dumpPerf=dumpPerf
r.fmt=fmt
r.hexomeDebug=hexomeDebug
r.drawDebug=void 0
var I=e("../glov/client/camera2d")
var n=e("../glov/client/engine")
var A=e("../glov/client/input")
var ie=e("../glov/client/sprites").spriteCreate
var a=e("../glov/client/textures")
var oe=a.TEXTURE_FORMAT
var ne=a.textureLoad
var w=e("../glov/client/ui")
var i=e("../glov/common/vmath")
var se=i.v2add
var L=i.v2addScale
var O=i.v2copy
var R=i.v2div
var b=i.v2floor
var N=i.v2mul
var C=i.v2scale
var le=i.v2set
var _e=i.v2sub
var p=i.v3addScale
var y=i.v3copy
var m=i.v3scaleFloor
var ce=i.v3set
var ue=i.vec2
var E=i.vec3
var o=i.vec4
var de=e("../common/globals").CHUNK_SIZE
var x=e("./debug")
var M=e("./main").charControllerPos
var s=e("./proc_gen")
var l=e("./proc_gen_biomes")
var _=e("./proc_gen_hydro")
var c=e("./proc_gen_shared")
var u=e("./task_sched")
var D=e("./ui_util")
var P=e("./voxel_const").origin_chunk
var d=e("./voxel_data")
var g=e("./voxel_data").worldPosFromLocalPos
var fe=Math.floor,ve=Math.max,he=Math.min,pe=Math.round
var B=l.BlendWeightContext,k=l.calcBlendWeights,me=l.calcBlendWeightsVS,Ee=l.getParam,T=l.getVerticalSlice,ge=l.getVerticalSliceById,Te=l.getVerticalSliceWorldPos,ye=l.initPhase50
var f=c.phase_counts,v=c.phase_timing
var Se=_.initPhase37
var Ie=s.renderDetail,Ae=s.initPhase40
var we=de/2
var Le=-32
var Oe=1e3
function dumpPerf(){if(!n.defines.NOWORKERS){var e=u.per_worker_data
var t={}
var r={}
for(var a in e){var i=e[a]
for(var o in i.phase_counts){t[o]=(t[o]||0)+i.phase_counts[o]
r[o]=(r[o]||0)+i.phase_timing[o]}}console.log("phase_counts(workers)",t)
console.log("phase_timing(workers)",r)}else{console.log("phase_counts",f)
console.log("phase_timing",v)}console.log("vd.timing",d.timing)}var Re
var be
var Ne=ue()
var Ce=ue()
var xe=[[-1,-1],[1,-1],[0,0],[-1,1],[1,1]]
var Me=E()
function updateDebugTexture(e,t){dumpPerf()
var r=Date.now()
var _=256
var c=_
var a=1
var i=1/a
var o=false
var n=true
var s=true
var l=t
var u=de*i
var d=le(Ne,-_*a/2,-c*a/2)
se(d,d,e)
le(Ce,_*a,c*a)
var f=new Uint8Array(_*c*3)
function setColor(e,t,r,a,i){var o=3*(t*_+e)
f[o]=r
f[o+1]=a
f[o+2]=i}function blendColor(e,t,r,a,i,o){var n=3*(t*_+e)
var s=1-o
f[n]=f[n]*s+o*r
f[n+1]=f[n+1]*s+o*a
f[n+2]=f[n+2]*s+o*i}function drawShape(e,t,r,a,i,o){for(var n=0;n<r.length;++n){var s=e+r[n][0]
if(s<0||s>=_)continue
var l=t+r[n][1]
if(l<0||l>=c)continue
setColor(s,l,a,i,o)}}var v=ue()
var h=ue()
var p=ue()
var m=ue()
var E=ue()
var g=ue()
var T={}
for(var y=0;y<c;y+=u)for(var S=0;S<_;S+=u){le(v,d[0]+S*a,d[1]+y*a)
var I=Te(v)
Ae(I)
T[I.owner_hexome.hid]=I.owner_hexome
for(var A=0;A<u;++A){p[1]=A*a
h[1]=v[1]+p[1]
for(var w=0;w<u;++w){p[0]=w*a
h[0]=v[0]+p[0]
var L=void 0
var O=1
me(I,p,true)
Ee(I,Me,"debug_color",true)
var R=I.map[p[1]][p[0]].h
if(R>=0)L=R/Oe
else L=-R/Le
if(I.map[p[1]][p[0]].hydro_pen>0)ce(Me,0,0,1)
if(n)if(fe(R)%8===0)O=.75
if(L>=0)L=.4+.6*L
else L=.25+.75*-L
if(o)if(S*a+y*a&16)O=.75
L*=O
setColor(S+w,y+A,he(Me[0]*L*255|0,255),he(Me[1]*L*255|0,255),he(Me[2]*L*255|0,255))}}}function pixelPos(e,t){return le(e,pe((t[0]-d[0])*i),pe((t[1]-d[1])*i))}if(s)for(var b in T){var N=T[b]
ye(N)
var C=N.details
for(var x=0;x<C.length;++x){var M=C[x]
var D=void 0
var P=void 0
var B=void 0
if("RenderedDetailGen"===M.type){if(!M.pre_render_pos_world){M.pre_render_pos_world=M.pos_world.slice(0)
M.pre_render_size=M.size.slice(0)}if(l&&!M.rendered)Ie(M)
D=l?M.pos_world:M.pre_render_pos_world
P=l?M.size:M.pre_render_size
B=M.detail_type.exclusion}else{le(E,Infinity,Infinity)
le(g,-Infinity,-Infinity)
for(var k=0;k<M.bounds_len;++k){var U=M.bounds_idx+6*k
E[0]=he(E[0],M.bounds_buf[U])
g[0]=ve(g[0],M.bounds_buf[U+1])
E[1]=he(E[1],M.bounds_buf[U+2])
g[1]=ve(g[1],M.bounds_buf[U+3])}_e(g,g,E)
P=g
D=E}if(!B)B=P
var G=P[0]*P[1]
for(var F=0;F<P[1];++F){var W=D[1]+F
m[1]=W-d[1]
if(m[1]<0||m[1]>=c)continue
var H=0===F||F===P[1]-1
var z=W>=M.origin[1]&&W<M.origin[1]+B[1]
var V=W===M.origin[1]||W===M.origin[1]+B[1]-1
for(var Y=0;Y<P[0];++Y){var j=D[0]+Y
m[0]=j-d[0]
if(m[0]<0||m[0]>=_)continue
var K=z&&j>=M.origin[0]&&j<M.origin[0]+B[0]
var q=H||0===Y||Y===P[0]-1
var Z=K&&(V||j===M.origin[0]||j===M.origin[0]+B[0]-1)
var X=fe(m[0]*i)
var Q=fe(m[1]*i)
var $=0
if(l&&M.vd){var J=Y+F*P[0]
for(var ee=0;ee<P[2];++ee)$+=M.vd.data[J+ee*G]?1:0
$/=P[2]}blendColor(X,Q,K?255:0,0,0,he((Z?.75:q?.5:.125)+4*$,1))}}}}for(var te in T){var re=T[te]
Se(re)
if(null!==re.hydro_output_vsid){var ae=ge(re.hydro_output_vsid)
pixelPos(p,se(p,ae.pos_world,[we,we]))
drawShape(p[0],p[1],xe,0,128,255)}}if(!Re)Re=ne({name:"proc_gen_debug",format:oe.RGB8,width:_,height:c,data:f,filter_min:gl.NEAREST,filter_mag:gl.NEAREST})
else Re.updateData(_,c,f)
if(!be)be=ie({texs:[Re]})
console.log("Debug texture update in "+(Date.now()-r)+"ms")
dumpPerf()}function updateDebugTexture2(e){dumpPerf()
var t=Date.now()
var n=1024
var r=n
var a=16
var i=le(Ne,-n*a/2,-r*a/2)
se(i,i,e)
le(Ce,n*a,r*a)
var s=new Uint8Array(n*r*3)
function setColor(e,t,r,a,i){var o=3*(t*n+e)
s[o]=r
s[o+1]=a
s[o+2]=i}var o=ue()
var l=new B
for(var _=0;_<r;_++)for(var c=0;c<n;c++){le(o,i[0]+c*a,i[1]+_*a)
k(l,o,false)
var u=l.hexomes
var d=l.blend_weights
ce(Me,0,0,0)
for(var f=0;f<u.length;++f){var v=u[f]
var h=d[f]
var p=v.params.debug_color
for(var m=0;m<3;++m)Me[m]+=h*p[m]}if(0){var E=0
for(var g=1;g<d.length;++g)if(d[g]>d[E])E=g
y(Me,u[E].params.debug_color)}var T=1
setColor(c,_,he(Me[0]*T*255|0,255),he(Me[1]*T*255|0,255),he(Me[2]*T*255|0,255))}if(!Re)Re=ne({name:"proc_gen_debug",format:oe.RGB8,width:n,height:r,data:s,filter_min:gl.NEAREST,filter_mag:gl.NEAREST})
else Re.updateData(n,r,s)
if(!be)be=ie({texs:[Re]})
console.log("Debug texture update in "+(Date.now()-t)+"ms")
dumpPerf()}function fmt(e){if(!e)return e
if("number"===typeof e){if(e!==(0|e))return e.toFixed(3)
return e}if(3===e.length)return fmt(e[0])+","+fmt(e[1])+","+fmt(e[2])
if(2===e.length)return fmt(e[0])+","+fmt(e[1])
return JSON.stringify(e)}function hexomeDebug(e){var t=g(E(),e)
var r=m(E(),t,1/de)
var a=T(r)
Ae(a)
var i=p(E(),t,r,-de)
me(a,i,true)
var o=["HexomeDebugPos: cursor("+fmt(t)+"), chunk("+fmt(r)+")"]
for(var n=0;n<a.hexomes.length;++n){var s=a.hexomes[n]
var l=a.blend_weights[n]
var _=a.hexomes_cont.indexOf(s)
var c=-1===_?0:a.blend_weights_cont[_]
o.push("  Hexome-"+s.hid+" "+s.type.name+"-"+s.uid+" weight: "+fmt(l)+", baryc: "+fmt(c))
if(l>.1&&"Flat"!==s.type.name){o.push("    Continent: idx="+s.cont_idx+", elev="+s.cont_elevation+", classif="+s.classif)
o.push("      humid="+s.humidity.toFixed(2)+", cdist="+s.cdist+", slopes[3]="+s.slopes[3].toFixed(3))
if(s.river_bits)o.push("      river="+("00000"+s.river_bits.toString(2)).slice(-6)+", flow dir="+s.rflow_dir+" amt="+s.rflow_amt)
o.push("    water_level="+s.water_level)
if(s.river_mouth)o.push("    river_mouth")
if(s.hydro_inputs)for(var u=0;u<s.hydro_inputs.length;++u){var d=ge(s.hydro_inputs[u])
o.push("    HydroIn"+u+": "+fmt(d.pos_world)+","+fmt(d.mid_elevation)+"/"+fmt(d.mid_elevation_eroded))}if(null!==s.hydro_output_vsid){var f=ge(s.hydro_output_vsid)
o.push("    HydroOut: "+fmt(f.pos_world)+","+fmt(f.mid_elevation)+"/"+fmt(f.mid_elevation_eroded))}}}var v=a.map[i[1]][i[0]]
for(var h in v)o.push("  computed "+h+": "+fmt(v[h]))
x.addText(o.join("\n"))}var h=function(){var v=ue()
var h=ue()
var p=ue()
var m=o(0,1,1,0)
var E=new B
var g=0
var T=g
var y=0
var S=g
return function(){L(v,M(),P,de)
if(!Re||v[0]<Ne[0]+.125*Ce[0]||v[0]>Ne[0]+.875*Ce[0]||v[1]<Ne[1]+.125*Ce[1]||v[1]>Ne[1]+.875*Ce[1]||T!==g||S!==y){C(v,v,1/de)
b(v,v)
C(v,v,de)
O(p,v)
if(0===g)updateDebugTexture(v,y)
else updateDebugTexture2(v)
T=g
S=y}var e=900
var t=I.x1()-50-e
var r=50
var a=Z.UI+50
be.draw({x:t,y:r,w:e,h:e,z:a,uvs:m})
if(w.buttonText({x:t-200,y:r,z:a+1,w:200,h:50,text:"Mode: "+g})){g=1-g
y=0
A.pointerLockExit()}if(0===g&&w.buttonText({x:t-200,y:r+50,z:a+1,w:200,h:50,text:"Submode: "+(y?"Post-render":"Layout")})){y=1-y
A.pointerLockExit()}var i=10
_e(v,v,Ne)
R(v,v,Ce)
C(v,v,e)
D.sprite.draw({x:t+v[0]-i/2,y:r+e-v[1]-i/2,z:a+1,w:i,h:i,frame:D.X})
A.mousePos(h)
se(h,h,[-t,-r])
C(h,h,1/e)
h[1]=1-h[1]
N(h,h,Ce)
se(v,Ne,h)
k(E,v,true)
var o=E.hexomes[0]
var n=["Mouse pos: "+fmt(v),"  Hydro("+fmt(o.hid)+")"]
if(o.hydro_inputs)for(var s=0;s<o.hydro_inputs.length;++s){var l=ge(o.hydro_inputs[s])
n.push("    Input"+s+": "+fmt(l.pos_world)+","+fmt(l.mid_elevation)+"/"+fmt(l.mid_elevation_eroded))}if(null!==o.hydro_output_vsid){var _=ge(o.hydro_output_vsid)
n.push("    Output: "+fmt(_.pos_world)+","+fmt(_.mid_elevation)+"/"+fmt(_.mid_elevation_eroded))}for(var c=0;c<E.hexomes.length;++c){var u=E.hexomes[c]
n.push("  Hexome "+u.type.name+"-"+u.uid+" weight: "+fmt(E.blend_weights[c])+" hid: "+u.hid+" slopes: "+Array.prototype.map.call(u.slopes||[],function(e){return(100*e).toFixed(0)}))}for(var d=0;d<E.hexomes_noisy.length;++d){var f=E.hexomes_noisy[d]
n.push("  Hexome "+f.type.name+"-"+f.uid+" noisy weight: "+fmt(E.blend_weights_noisy[d]))}x.addText(n.join("\n"))}}()
r.drawDebug=h},{"../common/globals":248,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/sprites":363,"../glov/client/textures":365,"../glov/client/ui":367,"../glov/common/vmath":402,"./debug":73,"./main":135,"./proc_gen":162,"./proc_gen_biomes":163,"./proc_gen_hydro":167,"./proc_gen_shared":168,"./task_sched":198,"./ui_util":205,"./voxel_const":215,"./voxel_data":216}],166:[function(e,t,r){"use strict"
r.i32Alloc=i32Alloc
r.f32Alloc=f32Alloc
r.detailGenSeed=detailGenSeed
r.detailGenSetData=detailGenSetData
r.detailGenMCIDs=detailGenMCIDs
r.detailGenMCIDs2=detailGenMCIDs2
r.detailGenGetHighest=detailGenGetHighest
r.detailGenLocal=detailGenLocal
r.detailGenGetDebugData=detailGenGetDebugData
r.detailStartup=detailStartup
r.MAX_DETAIL_REACH=r.DETAILS_CURRENT_VERSION=void 0
var a=e("../common/globals.js"),g=a.CHUNK_SIZE,w=a.ID_FACTOR,L=a.ID2,O=a.MEGACHUNK_SIZE,R=a.MEGACHUNK_VOXEL_SIZE
var i=1
r.DETAILS_CURRENT_VERSION=i
var o=O/2
var y=(o-1)*g
r.MAX_DETAIL_REACH=y
var b=e("assert")
var n=e("./cave_generators.js"),s=n.caveGenBoring,l=n.caveGenMaze,_=n.caveGenSphere,c=n.oreVeinGen
var N=Math.floor,C=Math.round
var p=e("../common/megachunk_common.js").parseChunkId
var u=e("./proc_gen_constants.js"),x=u.HEX_HEIGHT,M=u.HEX_WIDTH
var d=e("./proc_gen_biomes.js")
var f=e("./proc_gen_biomes.js"),D=f.getHexome,P=f.getVerticalSliceById
var v=e("./proc_gen_shared.js")
var h=e("../glov/common/rand_alea.js").randCreate
var m=e("../glov/common/verify.js")
var E=e("../glov/common/vmath.js"),T=E.ivec3,S=E.vec3,B=E.v3iScale,I=E.v3scaleFloor,A=E.v3add,k=E.v3addScale,U=E.v3scale,G=E.unit_vec
var F=v.phase_counts,W=v.phase_timing
var H
var z=o
var V=4*g
var Y=10
var j=-20
var K=256
var q=.5
var Z=16384
var X
var Q
var $
var J=Z
function sharedBufAlloc(){X=new ArrayBuffer(4*Z)
Q=new Int32Array(X)
$=new Float32Array(X)
J=0}function i32Alloc(e){b(e>=0&&e<=1024)
if(J+e>Z)sharedBufAlloc()
var t=J
J+=e
return[Q,t]}function f32Alloc(e){b(e>=0&&e<=1024)
if(J+e>Z)sharedBufAlloc()
var t=J
J+=e
return[$,t]}function DetailMegaChunks(){}var ee
function DetailMegaChunk(e,t){this.mcid=e
this.phase=0
b.equal(typeof t.ver,"number")
b.equal(typeof t.seed,"number")
this.ver=t.ver
this.seed=t.seed
this.midchunks=[]}DetailMegaChunk.prototype.dispose=function(){var e=this.details
if(e){for(var t=0;t<e.length;++t)e[t].dispose()
this.details=null}this.midchunks=null}
DetailMegaChunk.prototype.addDetail=function(e,t){var r=this
var a=e.bounds_buf,i=e.bounds_idx,o=e.bounds_len
var n={}
for(var s=0;s<o;++s){var l=i+6*s
var _=N(a[l]/V)
var c=N((a[l+1]-1)/V)
var u=N(a[l+2]/V)
var d=N((a[l+3]-1)/V)
var f=N(a[l+4]/V)
var v=N((a[l+5]-1)/V)
for(var h=f;h<=v;++h)for(var p=u;p<=d;++p)for(var m=_;m<=c;++m)n[(h*w+p)*w+m]=1
for(var E=0;E<3;++E){b(t[E]-a[l+2*E]<y)
b(a[l+2*E+1]-t[E]<=y)}}for(var g in n){var T=r.midchunks[g]
if(!T)T=r.midchunks[g]=[]
T.push(e)}r.details.push(e)}
var te=6e4
var re
var ae
var ie
function detailCleanupElem(e){if(e.last_use_time<ie){e.cleanup()
e.last_use_time=0
return false}return true}function detailCleanup(){profilerStart("detailCleanup")
ae=null
ie=Date.now()-te
re=re.filter(detailCleanupElem)
detailCleanupSchedule()
profilerStop("detailCleanup")}function detailCleanupSchedule(){if(re.length&&!ae)ae=setTimeout(detailCleanup,te/2)}function detailGenSeed(e){ee=new DetailMegaChunks
re=[]}function detailGenSetData(e,t){if(t){var r=ee[e]
b(!r||r.ver===t.ver&&r.seed===t.seed)
if(!r)ee[e]=new DetailMegaChunk(e,t)}else{b(ee[e])
ee[e].dispose()
delete ee[e]}}function typeChoice(e,t){var r=e*t.total
var a=t.list,i=t.count
var o
for(var n=0;n<a.length;++n){var s=a[n]
if(s[2]&&i[n]===s[2])continue
o=n
if((r-=s[0])<=0){if(s[2]){i[n]++
if(i[n]===s[2])t.total-=s[0]}break}}return o}function listTotal(e){var t=0
for(var r=0;r<e.length;++r)t+=e[r][0]
return t}var oe=1
var ne=.25
var se=.03
var le={}
function optsForVer(e){if(le[e])return le[e]
var t=[]
var r=[0,0]
if(e>0){t.push([oe,s,0,Y])
t.push([ne,_,4,-20])
t.push([se,l,1,-300])
r=[150,50]}var a=[]
var i=[0,0]
if(e>0){a.push([oe,c,0,j])
i=[750,50]}return le[e]={caves:t,caves_total:listTotal(t),caves_range:r,ores:a,ores_total:listTotal(a),ores_range:i}}var _e=h()
var ce=T()
var ue=T()
function detailGenInitPhase1(m){if(m.phase>=1)return 0
m.phase=1
m.details=[];++F.d1
var e=Date.now()
var t=m.mcid
ce[2]=C(t/L)
var E=(t-=ce[2]*L)*O
ce[1]=C(t/w)
t-=ce[1]*w
ce[0]=t
B(ce,R)
var g=0
function spawnCaves(e,t,r,a,i){var o=[]
for(var n=0;n<t.length;++n)o.push(0)
var s={list:t,total:r,count:o}
for(var l=0;l<e;++l){var _=t[typeChoice(_e.random(),s)]
var c=_[1]
var u=_[3]
ue[0]=_e.range(R)
ue[1]=_e.range(R)
ue[2]=ce[2]+_e.range(R)
var d=_e.uint32()
var f=E+(ue[0]>>4)+(ue[1]>>4)*w
var v=P(f)
if(ue[2]>=v.mid_elevation+u)continue
var h=_e.random()
if(ue[2]>=v.mid_elevation-a&&h<i)continue
ue[0]+=ce[0]
ue[1]+=ce[1]
var p=c(d,ue,v)
b(p.bounds_buf)
b(p.bounds_idx>=0)
b(p.bounds_len<31)
b(!p.seed||p.seed===d)
p.seed=d
b(!p.uid)
p.uid=++g
p.owner_mcid=m.mcid
m.addDetail(p,ue)}}var r=optsForVer(m.ver),a=r.caves,i=r.caves_total,o=r.caves_range,n=r.ores,s=r.ores_total,l=r.ores_range
_e.reseed(m.seed)
var _=_e.uint32()
spawnCaves(o[0]+_e.range(o[1]),a,i,K,q)
_e.reseed(_)
spawnCaves(l[0]+_e.range(l[1]),n,s,-Infinity,0)
var c=N(ce[0]/M)-1
var u=N((ce[0]+R-1)/M)+1
t=m.mcid
for(var d=c;d<=u;++d){var f=ce[1]+d*x/2
var v=N(f/x)-1
var h=N((f+R-1)/x)+1
for(var p=v;p<=h;++p){var T=D(d+p*w)
H(T)
for(var y=0;y<T.details.length;++y){var S=T.details[y]
var I=S.origin
if(S.owner_mcid===t)m.addDetail(S,I)}}}var A=Date.now()-e
W.d1+=A
W.d2-=A
return A}function cmpPriority(e,t){var r=e.priority-t.priority
if(r)return r
if(r=e.seed-t.seed)return r
return e.uid-t.uid}function boundsOverlap(e,t,r){var a=r.bounds_buf,i=r.bounds_idx,o=r.bounds_len
var n=0
for(var s=0;s<o;++s,i+=6)if(t[0]>a[i]&&e[0]<a[i+1]&&t[1]>a[i+2]&&e[1]<a[i+3]&&t[2]>a[i+4]&&e[2]<a[i+5])n|=1<<s
return n}function boundsOverlapMaxZ(e,t,r,a){var i=a.bounds_buf,o=a.bounds_idx,n=a.bounds_len
for(var s=0;s<n;++s,o+=6){var l=i[o+5]
if(l>e)if(r[0]>i[o]&&t[0]<i[o+1]&&r[1]>i[o+2]&&t[1]<i[o+3]&&r[2]>i[o+4]&&t[2]<l)e=l}return e}var de=[0,1,w,w+1,L,L+1,L+w,L+w+1]
var fe=1/O
var ve=-z/O
function detailGenMCIDs(e){var t=N(e[0]*fe+ve)
var r=N(e[1]*fe+ve)
return[(N(e[2]*fe+ve)*w+r)*w+t,de]}var he=1
function detailGenMCIDs2(e,t){var r=N(t[0]*fe)
var a=N(t[1]*fe)
var i=(N(t[2]*fe)*w+a)*w+r
var o=N(t[0]*fe-he)
var n=N(t[0]*fe+he)
var s=N(t[1]*fe-he)
var l=N(t[1]*fe+he)
var _=N(t[2]*fe-he)
var c=N(t[2]*fe+he)+1
var u=0
for(var d=_;d<=c;++d)for(var f=s;f<=l;++f)for(var v=o;v<=n;++v){i=(d*w+f)*w+v
e[u++]=i}return u}var pe=S()
var me=S()
var Ee=T()
function detailBlocked(e){var t=e.blocked_origin,r=e.blocked_size
k(me,t,r,.5)
me[2]=t[2]
U(pe,me,1/g)
A(Ee,t,r)
var a=detailGenMCIDs(pe),i=a[0],o=a[1]
var n=N(me[0]/V)+N(me[1]/V)*w+N(me[2]/V)*L
var s=r[2]
for(var l=0;l<o.length;++l){var _=i+o[l]
var c=ee[_]
b(c)
if(!c)continue
detailGenInitPhase1(c)
var u=c.midchunks[n]
if(u)for(var d=0;d<u.length;++d){var f=u[d]
var v=boundsOverlap(t,Ee,f)
if(v)if(f.blocksOther(e,me,s,v))return true}}return false}var ge=T()
function detailGenGetHighest(e){k(ge,e,G,g)
ge[2]=2147483647
I(pe,e,1/g)
var t=detailGenMCIDs(pe),r=t[0],a=t[1]
var i=N(e[0]/V)+N(e[1]/V)*w+N(e[2]/V-1)*L
var o=i+R/V*L
var n=-Infinity
for(var s=0;s<a.length;++s){var l=r+a[s]
var _=ee[l]
if(!m(_))continue
detailGenInitPhase1(_)
for(var c=i;c<=o;c+=L){var u=_.midchunks[c]
if(!u)continue
for(var d=0;d<u.length;++d)n=boundsOverlapMaxZ(n,e,ge,u[d])}}return n-1}function detailGenLocal(e){var t=Date.now()
F.d2++
var r=e.vd
var a=r.pos_world
k(ge,a,G,g)
var i=detailGenMCIDs(r.pos),o=i[0],n=i[1]
var s=N(a[0]/V)+N(a[1]/V)*w+N(a[2]/V)*L
var l=[]
for(var _=0;_<n.length;++_){var c=o+n[_]
var u=ee[c]
b(u)
if(!u)continue
detailGenInitPhase1(u)
var d=u.midchunks[s]
if(!d)continue
for(var f=0;f<d.length;++f){var v=d[f]
if(v.blockable&&!v.blocked_check){v.blocked=detailBlocked(v)
v.blocked_check=true}if(v.blocked)continue
var h=boundsOverlap(a,ge,v)
if(h){v.last_bits=h
l.push(v)}}}l.sort(cmpPriority)
var p=Date.now()
W.d2+=p-t
for(var m=0;m<l.length;++m){F.d3++
var E=l[m]
E.genLocal(e)
if(E.cleanup){if(!E.last_use_time)re.push(E)
E.last_use_time=p}}detailCleanupSchedule()
W.d3+=Date.now()-p}function detailGenGetDebugData(e,t){var r=detailGenGetDebugData.pos_world
if(!r)r=detailGenGetDebugData.pos_world=T()
var a=p(e)
U(r,a.chunk_pos,g)
k(ge,r,G,g)
var i=detailGenMCIDs(a.chunk_pos),o=i[0],n=i[1]
var s=N(r[0]/V)+N(r[1]/V)*w+N(r[2]/V)*L
var l=[]
for(var _=0;_<n.length;++_){var c=o+n[_]
var u=ee[c]
if(!u)continue
detailGenInitPhase1(u)
var d=u.midchunks[s]
if(d)for(var f=0;f<d.length;++f){var v=d[f]
var h=boundsOverlap(r,ge,v)
if(h){v.last_bits=h
l.push(v)}}}l.sort(cmpPriority)
t(l=l.map(function(e){return e.toJSON?e.toJSON():e}))}function detailStartup(){H=d.initPhase50}},{"../common/globals.js":248,"../common/megachunk_common.js":254,"../glov/common/rand_alea.js":395,"../glov/common/verify.js":401,"../glov/common/vmath.js":402,"./cave_generators.js":36,"./proc_gen_biomes.js":163,"./proc_gen_constants.js":164,"./proc_gen_shared.js":168,assert:void 0}],167:[function(e,t,r){"use strict"
r.initPhase37=initPhase37
r.uninitPhase37=uninitPhase37
r.setLODMode=setLODMode
r.seedWorld=seedWorld
r.hydroChunkInitRange=void 0
var D=e("assert")
var a=e("../common/globals.js"),i=a.CHUNK_SIZE,c=a.ID_FACTOR
var P=Math.abs,u=Math.ceil,d=Math.floor,B=Math.max,k=Math.min,o=Math.sqrt
var U=e("./priority_queue.js")
var n=e("./proc_gen_constants.js"),s=n.HEX_EDGE,f=n.HEX_HEIGHT,v=n.SKEW_X,l=n.C_RIVER_DELTA
var _=e("./proc_gen_biomes.js")
var h=e("./proc_gen_shared.js")
var p=e("./rand_seed.js")
var m=e("../glov/common/util.js"),G=m.clamp,F=m.lerp
var E=e("../glov/common/vmath.js"),g=E.vec2,W=E.v2add,T=E.v2addScale,y=E.v2scale
var H=h.neighbor_id_offs,z=h.phase_counts,V=h.phase_timing
var S=_.flushVerticalSlices,Y=_.getVerticalSliceById,j=_.getVerticalSliceWorldPos,K=_.getHexome
var q=i/2
var Z=40
var I=u(f/i)
var X=(I+1)*(I+1)
var Q
var $
var J=false
function seedHydro(e){return e.seed+4321}var A=[1,1,2,3,4,6]
var w=[1,1,3,4,6,8]
function hydroInit(e,t,r,a){if(e.hydro_init)return
e.hydro_init=true
var i=p.createGood(seedHydro(e))
var o=k(a,5)
var n=A[o]
var s=w[o]
e.hydro_width=n+i.random()*s
e.hydro_jitter_x=i.range(9)-4
e.hydro_jitter_y=i.range(9)-4
e.hydro_elev=t}var ee=[c,c+1,1,-c,-c-1,-1]
var L=o(.75)
var O=[[g(-s/2,f/2),g(1,0)],[g(s/2,f/2),g(.5,-L)],[g(s,0),g(-.5,-L)],[g(s/2,-f/2),g(-1,0)],[g(-s/2,-f/2),g(-.5,L)],[g(-s,0),g(.5,L)]]
O.forEach(function(e){return y(e[1],e[1],i)})
var R=s/i-4
function addRiverMouths(e,t,r){if(e<1)return false
if(t.classif===l&&t.rflow_amt>1)return true
if(!t.river_bits)return false
for(var a=0;a<ee.length;++a){var i=t.hid+ee[a]
if(i===r)continue
var o=K(i)
if(0!==o.rflow_amt)if(addRiverMouths(e-1,o,t.hid))return true}return false}var b=g()
function initPhase35(e){if(e.phase>=35||!e.river_bits)return;++z[35]
var t=Date.now()
e.phase=35
var r=e.rflow_dir
if(7===r);else{D(r>=0&&r<6)
var a=O[r]
W(b,e.pos_world,a[0])
var i=a[1]
T(b,b,i,1.5)
var o=null
var n=Infinity
for(var s=0;s<R;++s){W(b,b,i)
var l=j(b)
var _=l.mid_elevation
if(_<n){n=_
o=l.vsid}}e.hydro_output_vsid=o}V[35]+=Date.now()-t}var te=[2,1,2,1,1,2,1,2]
var re=50
var ae=50
var ie=[[s/4,s/4],[-s/4,s/4],[s/4,-s/4],[-s/4,-s/4]]
var oe=g()
function rflowToErosion(e){return G((e-1)/2,0,1)}function getVSID(e){return e.vsid}var ne=false
function verticalSliceClear(){profilerStart("verticalSliceClear")
ne=false
S()
Q=_.vertical_slices
profilerStop("verticalSliceClear")}function initPhase37(T){if(T.phase>=37)return;++z[37]
var e=Date.now()
if(J&&!ne){ne=true
setTimeout(verticalSliceClear,1e3)}initPhase35(T)
T.phase=37
if(addRiverMouths(6,T,null))T.river_mouth=true
var t=T.river_bits,r=T.hid,a=T.rflow_dir
if(7===a){D(!t)
for(var i=0;i<ee.length;++i){var o=r+ee[i]
if(K(o).river_bits&1<<(i+3)%6)t|=1<<i}D(t)}var n=[]
var s=[]
for(var l=0;l<ee.length;++l)if(l!==a&&t&1<<l){var _=r+ee[l]
var c=K(_)
initPhase35(c)
D(null!==c.hydro_output_vsid)
D(c.rflow_dir===(l+3)%6)
n.push(Y(c.hydro_output_vsid))
s.push(c.rflow_amt)}if(!n.length&&null===T.hydro_output_vsid){V[37]+=Date.now()-e
return}T.hydro_inputs=n.map(getVSID)
var y=[]
var S={}
var I={}
var u=T.water_level
function connect(m,E,g){if(m.mid_elevation<E.mid_elevation){var e=m
m=E
E=e}var o=E.mid_elevation
function costEstimate(e){return P(e.pos_world[0]-E.pos_world[0])+P(e.pos_world[1]-E.pos_world[1])}function addPath(e){var t=rflowToErosion(g)
var r=Infinity
var a=rflowToErosion(T.rflow_amt)
var i=m.owner_hexome.type.min_erosion||0
var o=E.owner_hexome.type.min_erosion||0
var n=E.mid_elevation_eroded
for(var s=0;s<e.length;++s){var l=e[s]
var _=l[3]
var c=Q[_]
var u=s/(e.length-1)
var d=F(u,t,a)
var f=F(u,i,o)
var v=F(d,c.mid_elevation,c.mid_elevation_eroded)
if(v>c.mid_elevation-f)v=B(c.mid_elevation-f,c.mid_elevation_eroded)
if(v>r)v=r
else{if(v<n)v=n
r=k(r,v)}l[2]=v
var h=S[_]
if(!h)S[_]=[v,d]
else{h[0]=k(v,h[0])
h[1]=B(d,h[1])}var p=I[_]
if(p)if(p===g)I[_]=g+1
else I[_]=B(g,p)
else I[_]=g}y.push(e)}var t=X
var n=U.create()
var s={}
var l={}
var _={}
var c={}
function queue(e,t,r){var a=e.vsid
if(s[a])return
if(t&&e!==E&&e.mid_hexome_exact!==T)return
var i=r
if(t)i+=B(0,e.mid_elevation-t.mid_elevation+1)*re
if(e.mid_elevation<o)i+=(o-e.mid_elevation)*ae
if(l[a]){if(i>=_[a])return
n.remove(e)}else l[a]=true
_[a]=i
e.score=i+costEstimate(e)
c[a]=t
n.add(e)}queue(m,null,0)
var r
while(r=n.pop()){D(--t)
if(r===E){var a=[]
while(r){a.push([r.pos_world[0]+q,r.pos_world[1]+q,1e3,r.vsid,0])
r=c[r.vsid]}a.reverse()
addPath(a)
break}var i=r.vsid
var u=_[i]
l[i]=false
s[i]=true
for(var d=0;d<H.length;++d){var f=i+H[d]
queue(Y(f),r,u+te[d])}}}var d=j(T.pos_world)
var f=null!==T.hydro_output_vsid&&Y(T.hydro_output_vsid)
var v=f
if(!v){var h=(v=d).mid_elevation
for(var p=0;p<ie.length;++p){W(oe,T.pos_world,ie[p])
var m=j(oe)
if(m.mid_elevation<h)h=(v=m).mid_elevation}h=k(u,h)
for(var E=0;E<n.length;++E)h=k(h,n[E].mid_elevation)}for(var g=0;g<n.length;++g)connect(n[g],v,s[g])
if(f&&!n.length){T.hydro_source_vsid=d.vsid
connect(d,f,T.rflow_amt)}if(J)for(var A in I)$[A]=I[A]
else{for(var w=0;w<y.length;++w){var L=y[w]
var O=L[0][2]
for(var R=0;R<L.length;++R){var b=L[R]
var N=b[3]
var C=S[N]
b[2]=O=k(C[0],O)
var x=Q[N]
var M=I[N]+(O<=u?1:0)
hydroInit(x,O,C[1],M)
b[0]+=x.hydro_jitter_x
b[1]+=x.hydro_jitter_y
if(T.river_mouth){b[4]=x.hydro_width+G(Z-2*(O-u),0,Z)
b[2]-=G(Z-(O-u),0,Z)}else b[4]=x.hydro_width}}if(y.length)T.hydro_paths=y}V[37]+=Date.now()-e}function uninitPhase37(e){if(e.phase<37)return
D.equal(e.phase,37)
e.hydro_paths=null
e.phase=35}var N=function(){var _=g()
return function(e,t){y(_,e,1/f)
var r=d(_[0]*v)
var a=r+(u(t/f*v)+1)
var i=u(t/f)+1
for(var o=r;o<=a;++o){var n=d(_[1]+.5*o)
var s=n+i
for(var l=n;l<=s;++l)initPhase37(K(l*c+o))}}}()
r.hydroChunkInitRange=N
function setLODMode(){J=true
_.setLODMode()}function seedWorld(e){Q=_.vertical_slices
$=_.rflow_cache}},{"../common/globals.js":248,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./priority_queue.js":161,"./proc_gen_biomes.js":163,"./proc_gen_constants.js":164,"./proc_gen_shared.js":168,"./rand_seed.js":175,assert:void 0}],168:[function(e,t,r){"use strict"
r.intNoise=intNoise
r.phase_counts=r.phase_timing=r.neighbor_id_offs=void 0
var a=e("../common/globals.js").ID_FACTOR
var n=Math.floor
var i=[30,35,37,40,50,60,70,"d1","d2","d3",90,100,"zm"]
var o=[-a-1,-a,1-a,-1,1,a-1,a,a+1]
r.neighbor_id_offs=o
var s={}
r.phase_timing=s
var l={}
r.phase_counts=l
i.forEach(function(e){s[e]=0
l[e]=0})
function intNoise(e,t,r,a,i){var o=n((.5+.5*e.noise2D(t[0]*r+a,t[1]*r))*i)
if(o===i)o=i-1
return o}},{"../common/globals.js":248}],169:[function(e,t,r){"use strict"
r.showPrompt=showPrompt
r.updatePrompt=updatePrompt
var i=e("../glov/client/net.js").netSubs
function showPrompt(e,t,r){var a=i().getMyUserChannel()
if(a&&!a.getChannelData("public.prompts_seen."+e)){a.send("consume_prompt",{prompt_id:e,value:t})
if(r)r()}}function updatePrompt(e,t,r){var a=i().getMyUserChannel()
if(a){a.send("consume_prompt",{prompt_id:e,value:t})
if(r)r()}}},{"../glov/client/net.js":338}],170:[function(e,t,r){"use strict"
r.savingMessage=savingMessage
r.propEditDialog=propEditDialog
r.saveProp=saveProp
r.propEdit=propEdit
r.doPropEdit=doPropEdit
r.BUTTON_H=r.BUTTON_W=void 0
var s=240
r.BUTTON_W=s
var l=48
r.BUTTON_H=l
var _=e("assert")
var c=e("../glov/client/cmds").cmd_parse
var n=e("../glov/client/input")
var u=e("../glov/client/ui").uiButtonHeight
var d=e("../glov/client/ui")
var f=e("../glov/client/words/profanity").profanityFilter
var a=e("./layout")
var i=a.layoutCameraPop
var o=a.layoutCameraPush
var v=a.layoutCameraSquare
var h=e("./localization/localization").L
var p=e("./main")
var m=p.getFrameTransaction
var E=p.menuExit
var g=p.toggleMenuPage
var T=e("./menu")
var y=T.PROP_EDIT
var S=T.menuInteractGetProp
var I=e("./status").statusGet
var A=e("./styles").label_style
var w=e("./voxel_data").transPropUpdate
function savingMessage(e,t){var r=I("saving")
r.setMessage(e)
if(!r.pos){o()
v()
r.setPos(500,1e3-l)
i()}if(!t)r.fade()}var L=false
function propEditDialog(){return L}function finishEditDialog(){L=false}function saveProp(t,e){if(!t.existsInWorld()){savingMessage(h.STATUSMSG_SAVE_FAILED_NO_PROP)
return}t.property_edit_locked=true
if(e)e(t)
var r=m()
w(r,t,false)
savingMessage(h.MSG_SAVING)
t.transBusy(r)
r.onComplete(function(e){t.property_edit_locked=false
savingMessage(e?h.STATUSMSG_SAVE_FAILED:h.MSG_SAVED)})}function saveField(e,t,r){finishEditDialog()
e[t.key]=r
saveProp(e,t.on_change)}function chainedModalDialog(e){if(n.pointerLocked())n.pointerLockExit()
d.modalDialog(e)}function confirmEdit(e,t,r,a){if(t.confirm_msg)chainedModalDialog({title:h.DLG_ARE_YOU_SURE_TITLE,text:t.confirm_msg,buttons:{OK:{cb:function cb(){saveField(e,t,r)},in_event_cb:a},Cancel:{cb:finishEditDialog,in_event_cb:a}}})
else saveField(e,t,r)}function propEditTextEntry(a,i,e){var o=!n.touch_mode&&e?n.pointerLockEnter:null
L=true
var t={}
t.OK={cb:function cb(e){var t=i.profanity_filter||i.profanity_lock?f(e.trim()):e.trim()
if(t!==e.trim()&&i.profanity_lock)chainedModalDialog({title:h.DLG_ERROR_TITLE,text:h.DLG_INVALID_VALUE_INSERTED_MSG,buttons:{OK:{cb:finishEditDialog,in_event_cb:o}}})
else if(i.valid_regex&&!e.match(i.valid_regex))chainedModalDialog({title:h.DLG_ERROR_TITLE,text:h.DLG_INVALID_VALUE_INSERTED_MSG,buttons:{OK:{cb:finishEditDialog,in_event_cb:o}}})
else{var r=t||""
if(r!==a[i.key])confirmEdit(a,i,r,o)}},in_event_cb:o}
if(i.allow_clear&&a[i.key])t.Clear={cb:function cb(e){confirmEdit(a,i,"",o)},in_event_cb:o}
t.Cancel={cb:finishEditDialog,in_event_cb:o}
d.modalTextEntry({edit_text:a[i.key]||"",title:i.label,text:i.msg||h.$(h.DLG_ENTER_NEW_VALUE_MSG,i.key),max_len:i.max_len||100,buttons:t})}var O
var R
function propEdit(e,t){var r=t.fields,a=t.direct
O=r
R=e.item_id
if(1===r.length&&a)propEditTextEntry(e,r[0],true)
else g(y,e.interactDetails())}var b=h.LBL_PROPERTY_EDITOR
function doPropEdit(){var e=d.font
var t=S()
if(!t||!(t.item_id===R||t.prop_edit_ids&&t.prop_edit_ids[t.item_id])){E()
return b}var r=u()+24
var a=500
var i=Z.UI
for(var o=0;o<O.length;++o){var n=O[o]
e.drawSizedAligned(A,a-8,r,i,d.font_height,e.ALIGN.HRIGHT|e.ALIGN.VCENTER,0,l,n.label)
n.type=n.type||c.TYPE_STRING
switch(n.type){case c.TYPE_STRING:if(d.buttonText({x:a,y:r,z:i,text:t[n.key]||h.addEllipsis(""),h:l,w:s}))propEditTextEntry(t,n,false)
break
default:_(false)}r+=l+4}return b}},{"../glov/client/cmds":298,"../glov/client/input":326,"../glov/client/ui":367,"../glov/client/words/profanity":372,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./status":193,"./styles":197,"./voxel_data":216,assert:void 0}],171:[function(e,t,r){"use strict"
r.rotToVec=rotToVec
r.mapToNameKeyFromFlowerType=mapToNameKeyFromFlowerType
r.drawBlock=drawBlock
r.startup=startup
r.isSpotlitBuzzer=isSpotlitBuzzer
r.drawBagSet=drawBagSet
r.bagDraw=bagDraw
r.bagCalcDrawOffs=bagCalcDrawOffs
r.createFromInv=createFromInv
r.createIndicatorProp=createIndicatorProp
r.createBag=createBag
r.saveGlobalState=saveGlobalState
r.restoreGlobalState=restoreGlobalState
r.hasForPreview=hasForPreview
r.getForPreview=getForPreview
r.propDebugGetFieldName=propDebugGetFieldName
r.propFromJSON=propFromJSON
r.propClone=propClone
r.tickProps=tickProps
r.bagAddTrans=r.PROP_DEBUG_SKIP=r.color_interact_water_place=r.color_interact_water=r.color_prop_preview=r.NO_PICKUP_DELAY=r.inv_rot_mat_flipped=r.rot_mat_flipped=r.inv_rot_mat=r.rot_mat=r.PIEB_CHECK_MAX_SIZE=r.PIEB_CHECK_CUR_SIZE=r.PIEB_CHECK_ROOT=r.PREVIEW_HELD=r.PREVIEW_SNAPSHOT_ITEM=r.PREVIEW_SNAPSHOT_BUILD=r.PREVIEW_PLACE=r.PROP_TERMINAL_VELOCITY=r.PROP_GRAVITY=void 0
var a,i
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var o=e("../common/globals")
var c=o.CHUNK_SIZE
var n=o.CS2
var s=o.VOXELS_PER_M
var l=-9.8*s/1e3/1e3
r.PROP_GRAVITY=l
var _=-.00625*s
r.PROP_TERMINAL_VELOCITY=_
var u=0
r.PREVIEW_PLACE=u
var d=1
r.PREVIEW_SNAPSHOT_BUILD=d
var f=2
r.PREVIEW_SNAPSHOT_ITEM=f
var v=3
r.PREVIEW_HELD=v
var h=0
r.PIEB_CHECK_ROOT=h
var p=1
r.PIEB_CHECK_CUR_SIZE=p
var m=2
r.PIEB_CHECK_MAX_SIZE=m
var E=[new Int32Array([1,0,0,1]),new Int32Array([0,-1,1,0]),new Int32Array([-1,0,0,-1]),new Int32Array([0,1,-1,0])]
var g=[(r.rot_mat=E)[0],E[3],E[2],E[1]]
r.inv_rot_mat=g
var T=[new Int32Array([-1,0,0,1]),new Int32Array([0,-1,-1,0]),new Int32Array([1,0,0,-1]),new Int32Array([0,1,1,0])]
var y=r.rot_mat_flipped=T
r.inv_rot_mat_flipped=y
r.propCreate=createFromInv
var I=e("assert")
var S=e("gl-mat4/translate")
var A=e("../glov/client/cmds").cmd_parse
var w=e("../glov/client/engine")
var L=e("../glov/client/font")
var O=e("../glov/client/input")
var R=e("../glov/client/localization").getStringFromLocalizable
var b=e("../glov/client/mat4ScaleRotateTranslate")
var N=e("../glov/client/net")
var C=e("../glov/client/quat")
var x=C.createQuat
var M=C.qFromAxisAngle
var D=C.qRotateZ
var P=C.qTransformVec3
var B=e("../glov/client/round_robinable")
var k=B.ROUNDROBIN_CONTINUE
var U=B.ROUNDROBIN_START
var G=B.roundRobinableCreate
var F=e("../glov/client/settings")
var W=e("../glov/client/shaders")
var H=e("../glov/client/snapshot")
var z=H.snapshot
var V=H.snapshotDrawDynamic
var Y=e("../glov/client/ui")
var j=e("../glov/client/ui").Z_MIN_INC
var K=e("../glov/client/webfs").webFSGetFile
var q=e("../glov/client/words/profanity").profanityFilter
var X=e("../glov/common/data_error").dataError
var Q=e("../glov/common/perfcounters").perfCounterAdd
var $=e("../glov/common/util")
var J=$.clamp
var ee=$.clone
var te=$.cloneShallow
var re=$.easeIn
var ae=$.easeOut
var ie=$.isInteger
var oe=$.merge
var ne=$.msToTimeString
var se=$.nop
var le=$.toArray
var _e=e("../glov/common/verify")
var ce=e("../glov/common/vmath")
var ue=ce.half_vec
var de=ce.mat4
var fe=ce.unit_vec
var ve=ce.v2addScale
var he=ce.v2copy
var pe=ce.v2dist
var me=ce.v2dot
var Ee=ce.v2length
var ge=ce.v2normalize
var Te=ce.v2same
var ye=ce.v2scale
var Se=ce.v2sub
var Ie=ce.v3add
var Ae=ce.v3angle
var we=ce.v3copy
var Le=ce.v3distSq
var Oe=ce.v3floor
var Re=ce.v3iAdd
var be=ce.v3iSub
var Ne=ce.v3same
var Ce=ce.v3set
var xe=ce.v3sub
var Me=ce.v4copy
var De=ce.v4lerp
var Pe=ce.vec2
var Be=ce.vec3
var ke=ce.vec4
var Ue=ce.zaxis
var Ge=ce.zero_vec
var Fe=e("../common/entitlements").propToEntitlementKey
var We=e("../common/ids")
var He=We.ITEM_ACCESS_CONTROL
var ze=We.ITEM_ALGAE
var Ve=We.ITEM_ANVIL
var Ye=We.ITEM_BAG
var je=We.ITEM_BERRY_BUSH_BLUE
var Ke=We.ITEM_BERRY_BUSH_RED
var qe=We.ITEM_BERRY_BUSH_YELLOW
var Ze=We.ITEM_BLOCK_PREVIEW
var Xe=We.ITEM_BLUEPRINT
var Qe=We.ITEM_BONFIRE
var $e=We.ITEM_BONFIRE_METAL
var Je=We.ITEM_BRANCHFORGE
var et=We.ITEM_BUCKET
var tt=We.ITEM_BUZZERGOAL
var rt=We.ITEM_BUZZERSTART
var at=We.ITEM_CACTINY
var it=We.ITEM_CACTORB
var ot=We.ITEM_CAMPFIRE
var nt=We.ITEM_CHAIN
var st=We.ITEM_CHAIR
var lt=We.ITEM_CHAIR_METAL
var _t=We.ITEM_CHEST_MEDIUM
var ct=We.ITEM_CHEST_MEDIUM_METAL
var ut=We.ITEM_CHEST_SMALL
var dt=We.ITEM_CHEST_TALL
var ft=We.ITEM_CHEST_TINY
var vt=We.ITEM_CORAL_TUBES
var ht=We.ITEM_DOOR
var pt=We.ITEM_DOOR_DOUBLE
var mt=We.ITEM_DOOR_DOUBLE_GATE
var Et=We.ITEM_DOOR_DOUBLE_METAL
var gt=We.ITEM_DOOR_METAL
var Tt=We.ITEM_ENERGY_WELL
var yt=We.ITEM_FACTORY_DEBUG
var St=We.ITEM_FIBER
var It=We.ITEM_FURNACE_GLASS
var At=We.ITEM_FURNACE_ORE
var wt=We.ITEM_GEM
var Lt=We.ITEM_GRASS_SPIKY
var Ot=We.ITEM_GROW
var Rt=We.ITEM_HATCHET
var bt=We.ITEM_HOE
var Nt=We.ITEM_ID_CODE_NAME
var Ct=We.ITEM_INDICATOR
var xt=We.ITEM_JUICE
var Mt=We.ITEM_JUICER
var Dt=We.ITEM_KILN
var Pt=We.ITEM_LEAPGATE
var Bt=We.ITEM_LIQUID
var kt=We.ITEM_MILL
var Ut=We.ITEM_MUSHROOM
var Gt=We.ITEM_OVEN
var Ft=We.ITEM_PAINT_MIXER
var Wt=We.ITEM_PARTICLE_DEBUGGER
var Ht=We.ITEM_PICKAX
var zt=We.ITEM_PIE
var Vt=We.ITEM_PLANT
var Yt=We.ITEM_SANDWICH
var jt=We.ITEM_SAPLING
var Kt=We.ITEM_SAWMILL
var qt=We.ITEM_SEEDS_CARROT
var Zt=We.ITEM_SEEDS_CORAL_MUSHROOM
var Xt=We.ITEM_SEEDS_CORN
var Qt=We.ITEM_SEEDS_PUMPKIN
var $t=We.ITEM_SEEDS_SUGAR_CANE
var Jt=We.ITEM_SEEDS_TOMATO
var er=We.ITEM_SEEDS_WHEAT
var tr=We.ITEM_SHOVEL
var rr=We.ITEM_SIGNBOARD
var ar=We.ITEM_SIGNBOARD_METAL
var ir=We.ITEM_SIGNBOARD_STONE
var or=We.ITEM_SIGNPOST
var nr=We.ITEM_SIGNPOST_METAL
var sr=We.ITEM_SIGNPOST_STONE
var lr=We.ITEM_STONECUTTER_ADVANCED
var _r=We.ITEM_STONECUTTER_SIMPLE
var cr=We.ITEM_TOOL_HEAD_CAST
var ur=We.ITEM_TORCH
var dr=We.ITEM_VEINIUM_GRINDER
var fr=We.ITEM_WATERING_SYSTEM
var vr=We.ITEM_WAYGATE
var hr=We.ITEM_WORKBENCH
var pr=We.TYPE_BLOCK
var mr=We.TYPE_ITEM
var Er=e("../common/items_common")
var gr=Er.getItemUnlockableVariantMethods
var Tr=Er.itemIsReleased
var yr=e("../common/leapgate_common").LeapgateMode
var Sr=e("../common/materials_common").Mat
var Ir=e("../common/race_common").trueBuzzerID
var Ar=e("../common/voxel_data_common")
var wr=Ar.ANIM_STYLE_BEAM
var Lr=Ar.ANIM_STYLE_PHYS
var Or=Ar.ANIM_TYPE_PLAYER
var Rr=Ar.ANIM_TYPE_POS
var br=e("../common/world_constants").VALID_GEM_ID
var Nr=e("../common/world_trans")
var Cr=Nr.createTransSet
var xr=Nr.encodeChunkPos
var Mr=e("./app_access").accessPrerelease
var Dr=e("./auto_activate_ui")
var Pr=Dr.GateTime
var Br=Dr.autoActivateIgnored
var kr=Dr.autoActivateNoParticles
var Ur=Dr.autoActivateOnProp
var Gr=e("./baking")
var Fr=Gr.bakedEmits
var Wr=Gr.bakedSize
var Hr=Gr.bakedSwapped
var zr=Gr.bakedSwappedSimple
var Vr=Gr.drawBaked
var Yr=Gr.lookupMat
var jr=e("./biome_details.js")
var Kr=jr.TREE_DIM_HALF
var qr=jr.TREE_HEIGHT_OFFSET
var Zr=e("./bluebox_edit_list")
var Xr=Zr.blueboxEditListAdd
var Qr=Zr.blueboxEditListRemove
var $r=Zr.blueboxEditListUpdate
var Jr=Zr.boundedPropListAdd
var ea=Zr.boundedPropListRemove
var ta=Zr.boundedPropListUpdate
var ra=e("./bluebox_ui")
var aa=e("./bluebox_ui")
var ia=aa.blueboxDrawForSnapshot
var oa=aa.blueboxOnPlace
var na=aa.blueboxSelect
var sa=aa.blueboxSelectProp
var la=aa.blueboxTickProp
var _a=aa.blueprintCaptureEnabled
var ca=aa.propCanEditPos
var ua=e("./blueprint")
var da=ua.STATE_BUILD
var fa=ua.STATE_EDIT
var va=ua.STATE_PAUSED
var ha=ua.STATE_PRE_BUILD
var pa=ua.STATE_PRE_EDIT
var ma=ua.STATE_SELF_DESTRUCT
var Ea=ua.blueprintGetDef
var ga=e("./build_mode")
var Ta=e("./build_mode")
var ya=Ta.VU_TILE_BOX
var Sa=Ta.VU_TILE_BRUSHSIZE2
var Ia=Ta.VU_TILE_BRUSHSIZE3
var Aa=Ta.VU_TILE_DIG_PROGRESS
var wa=Ta.VU_TILE_RETICULE_DIG
var La=Ta.VU_TILE_RETICULE_WATER
var Oa=Ta.addToBagSplatter
var Ra=Ta.checkStaminaBeforeAction
var ba=Ta.consumeDurability
var Na=Ta.doDurability
var Ca=Ta.doStamina
var xa=Ta.isEmptyOrBag
var Ma=Ta.playSoundForMaterial
var Da=Ta.tempMat
var Pa=e("./camera").getActiveController
var Ba=e("./character_controller").dirToLookAngle
var ka=e("./character_controller_constants").PLAYER_COL_WIDTH
var Ua=e("./chat_floater").chatFloaterAdd
var Ga=e("./editvolume_client")
var Fa=Ga.editVolumeForPos
var Wa=Ga.inEditBounds
var Ha=Ga.inEditBoundsAndReady
var za=Ga.waygateEditAllowedForPos
var Va=e("./energy_well")
var Ya=Va.energyWellCharged
var ja=Va.energyWellDrink
var Ka=Va.energyWellReadiness
var qa=Va.energyWellShouldAutoDrink
var Za=e("./factory_ui")
var Xa=Za.FACTORY_MAX_INPUT
var Qa=Za.FACTORY_MAX_OUTPUT
var $a=Za.FACTORY_PAUSED
var Ja=Za.FACTORY_STALLED
var ei=Za.factoryCraftingInProgress
var ti=Za.factoryGetProgressEstimator
var ri=e("./floater")
var ai=ri.CompoundFloater
var ii=ri.DEF_COMP_FLT_SCALE
var oi=ri.DEF_FLT_SCALE
var ni=ri.GraphicalFloater
var si=ri.ProgressBarFloater
var li=ri.SpriteFloater
var _i=ri.TextFloater
var ci=ri.drawFloaterSimple
var ui=ri.drawFloaterStack
var di=e("./flora_constants")
var fi=di.ALL_FLOWERS
var vi=di.FLOWERS
var hi=e("./inventory")
var pi=hi.INV_EQUIP
var mi=hi.INV_PLAYER
var Ei=hi.findAddIdxList
var gi=hi.findAvailable
var Ti=hi.findEquipAddIdx
var yi=hi.inventoryEmpty
var Si=hi.inventoryLocked
var Ii=hi.itemListCompact
var Ai=hi.playerCarryingHeavy
var wi=hi.transInvAdd
var Li=hi.transInvDec
var Oi=e("./item_anims").removeIncoming
var Ri=e("./items")
var bi=Ri.ITEM_ID_NAME
var Ni=Ri.createItem
var Ci=Ri.isItem
var xi=Ri.itemFromJSON
var Mi=Ri.itemGetGfxQueued
var Di=Ri.notLiquid
var Pi=e("./localization/localization").L
var Bi=e("./main")
var ki=e("./main")
var Ui=ki.frameTransactionCount
var Gi=ki.getFrameTransaction
var Fi=ki.toggleMenuPage
var Wi=e("./materials")
var Hi=Wi.MATERIAL_CLASS
var zi=Wi.MaterialClass
var Vi=e("./menu")
var Yi=e("./mobs").playerToolAnim
var ji=e("./palette")
var Ki=ji.generateSwapKey
var qi=ji.paletteSetMeshReloadCallback
var Zi=ji.paletteStartup
var Xi=e("./particle_system")
var Qi=Xi.createDetachedParticlesFromList
var $i=Xi.createParticleSystemWithOwner
var Ji=Xi.particleStartup
var eo=e("./prop_edit").propEdit
var to=e("./quickbar")
var ro=to.bucketSelected
var ao=to.consumeSelectedBucket
var io=to.getSelected
var oo=to.toolSelected
var no=e("./race_results").raceResults
var so=e("./rand_seed")
var lo=e("./saplings")
var _o=lo.EQUAL_BLOCK_THRESHOLD
var co=lo.SAPLING_KEY_NAMES
var uo=lo.SCBG_GROWTH_FAILED
var fo=lo.SCBG_GROWTH_READY
var vo=lo.SCBG_NOT_DONE
var ho=lo.saplingApplyDeletes
var po=lo.saplingCheckBlockedGrowth
var mo=lo.saplingCompareAndUpdateVD
var Eo=lo.saplingEqualizeOffsetAndSize
var go=lo.saplingGetVDWorker
var To=lo.saplingRandomPruning
var yo=lo.saplingRandomlyDeleteLeaves
var So=lo.saplingUpdateBlocksFinish
var Io=lo.saplingUpdateBlocksPrep
var Ao=lo.saplingUpdateLocalTileArray
var wo=lo.saplingUpdateLocalTileArrayIncremental
var Lo=e("./saplings_shared.js")
var Oo=Lo.SAPLING_GROWTH_STEPS
var Ro=Lo.SAPLING_TO_MODEL
var bo=Lo.saplingGetVD
var No=Lo.saplingPrune
var Co=Lo.saplingPruneIncremental
var xo=e("./settlement").isSettlement
var Mo=e("./sky").skyGetTime
var Do=e("./status")
var Po=e("./styles")
var Bo=Po.color_black
var ko=Po.color_green
var Uo=Po.color_trophies
var Go=Po.color_yellow
var Fo=Po.floater_style
var Wo=Po.floater_style_default
var Ho=Po.floater_style_red
var zo=Po.prop_chat_styles
var Vo=Po.sign_font_style
var Yo=Po.style_trophies
var jo=e("./tiles")
var Ko=e("./tiles")
var qo=Ko.TILE_INTANGIBLE
var Zo=Ko.TILE_PROP_BASE
var Xo=Ko.TILE_PROP_MAX
var Qo=Ko.TILE_TILLED
var $o=Ko.TILE_TILLED_WATERED
var Jo=Ko.TILE_WATER
var en=Ko.priority_solid
var tn=Ko.tile_map_default
var rn=e("./tiles_const").LIQUID_TILES
var an=e("./ui_util")
var on=e("./user_data")
var nn=on.establishSettlementAllowed
var sn=on.isWaiting
var ln=on.leapgateEditAllowed
var _n=on.raceEditAllowed
var cn=on.raceJoinAllowed
var un=on.staminaUsageScale
var dn=on.unlimitedItemsAllowed
var fn=on.userDataGet
var vn=on.userStaminaMod
var hn=on.worldReadOnly
var pn=e("./user_info_view").userInfoGet
var mn=e("./voxel_data")
var En=e("./voxel_data")
var gn=En.andGetLocalPos
var Tn=En.andGetProp
var yn=En.applyBevelValue
var Sn=En.chunkIdFromLocalIntPos
var In=En.drawProp
var An=En.drawSingleVoxel
var wn=En.drawSingleVoxelTextured
var Ln=En.getLocalPosFromChunkID
var On=En.getPropDirect
var Rn=En.getPropLighting2Prop
var bn=En.getPropLocal
var Nn=En.getTileLocal
var Cn=En.getTileRelative
var xn=En.getWorldPosFromChunkID
var Mn=En.propStateUpdate
var Dn=En.remeshAll
var Pn=En.transBagAdd
var Bn=En.transItemAnim
var kn=En.transPropRemove
var Un=En.transPropUpdate
var Gn=En.transPropUpdateField
var Fn=En.transSetTileLocal
var Wn=e("./voxel_data_drawable").voxelDataDrawableLoad
var Hn=e("./voxel_data_xraw").reloadXRAW
var zn=e("./world_comm")
var Vn=zn.getWorldID
var Yn=zn.transact
var jn=zn.worldBuzzerStart
var Kn=zn.worldBuzzerSubmit
var qn=zn.worldClaimGem
var Zn=zn.worldTransactionsInProgress
var Xn=e("./world_metadata")
var Qn=Xn.unlimitedMode
var $n=Xn.worldBoostLevelForProps
var Jn=Xn.worldEnergy
var es=Xn.worldEnforcePropPlacement
var ts=Xn.worldFactories
var rs=Xn.worldFlora
var as=Xn.worldHasGems
var is=Xn.worldItemDrop
var os=Xn.worldMetadata
var ns=Xn.worldMetadataWaygates
var ss=Xn.worldSettlements
var ls=Xn.worldSpotlitBuzzer
var _s=e("./worlds_sound").playSound
var cs=e("./worlds_soundscape")
var us=cs.SoundScapeEventMod
var ds=cs.logSSEventModState
var fs=Math.abs,vs=Math.ceil,hs=Math.floor,ps=Math.max,ms=Math.min,Es=Math.PI,gs=Math.random,Ts=Math.round,ys=Math.sin,Ss=Math.sqrt
var Is=r
var As=128
var ws=Be(0,-1,0)
var Ls=so.createFast()
var Os=3e4
r.NO_PICKUP_DELAY=Os
var Rs=1
var bs=Es/2
var Ns=16
var Cs=16
var xs=25
var Ms=3e5
var Ds=15e3
var Ps=500
var Bs=8
var ks=5e-4
var Us=5e-4
var Gs=500
var Fs=1e3
var Ws=4
var Hs=2
var zs=1
var Vs=0
var Ys=1
var js=2
var Ks=30
var qs=5
var Zs=5
var Xs=1
var Qs=250
var $s=16
var Js=1e4
F.register({factory_status_dist:{label:"Factory Status Display Distance",default_value:6,type:A.TYPE_FLOAT,range:[0,1e3]},prop_chat_sapling:{label:"Show chat from saplings/Arborhearts",default_value:1,type:A.TYPE_INT,range:[0,1]},prop_chat_grow:{label:"Show chat from G.R.O.W. invocations",default_value:1,type:A.TYPE_INT,range:[0,1]}})
var el=[Be(0,-1,0),Be(1,0,0),Be(0,1,0),Be(-1,0,0)]
function rotToVec(e){I(e>=0&&e<=3)
return el[e]}var tl=G()
var rl=false
var al=[]
function initFlowerSeeds(){for(var e=0;e<vi.length;e++){var t=vi[e]
for(var r=0;r<t.key.length;r++)al[t.key[r]]=t}}initFlowerSeeds()
function validMushroomPlantType(e){return e===Sr.BROWN_MUSHROOM||e===Sr.RED_MUSHROOM||e===Sr.LUMINESCENT_MUSHROOM}function isMushroomPlant(e){return al[e]&&validMushroomPlantType(al[e].attr1)}function randomFromArray(e){return e[hs(gs()*e.length)]}function mapToFlowerTypeFromSeed(e){if(al[e].weighted)return randomFromArray(al[e].weighted)
else return randomFromArray(al[e].key)}function mapToSeedFromFlowerType(e){if(!al[e])return 0
return al[e].key[0]}function mapToNameKeyFromFlowerType(e){return al[e]&&al[e].name_key}var il=ke(1,1,1,.75)
r.color_prop_preview=il
var ol=ke(0,1,0,1)
var nl=ke(1,1,0,1)
ol.tile=wa
var sl=ke(0,1,0,1)
sl.tile=ya
var ll=ke(.5,1,1,1)
ll.tile=ya
var _l=ke(1,0,0,1)
var cl=ke(0,0,1,1);(r.color_interact_water=cl).tile=La
var ul=ke(.5,.5,1,1);(r.color_interact_water_place=ul).tile=La
var dl=ke(.75,.5,1,1)
dl.tile=wa
dl.no_continuous=true
var fl
var vl
var hl
var pl
var ml
var El
var gl=[{type:mr,id:Vt,count:1,user_inv_type:1,drop_chance:.5},{type:mr,id:St,count:1,user_inv_type:1}]
var Tl=[{type:mr,id:St,count:1,user_inv_type:1}]
var yl={}
var Sl=ke(0,0,0,.75)
var Il=ke(0,0,0,.75)
var Al=Be()
function tooManyTransactions(){return Ui()>100}function drawBlock(e,t,r,a,i){var o=tn[t]
An({tile:t,opaque:!o.alpha||r&&r.force_opaque,lit:true,mat:e,color:r.color||fe,draw_opts:r})
if(a>1)wn({opaque:true,tile:2===a?Sa:Ia,mat:e,color:Sl,tex:ga.tex_voxel_util,atlas_params_vp:mn.atlas_params_voxel_util_vp,atlas_params_fp:mn.atlas_params_voxel_util_fp})
if(i&&o.draw_passable_overlay)wn({opaque:true,tile:Aa+3,mat:e,color:Il,tex:ga.tex_voxel_util,atlas_params_vp:mn.atlas_params_voxel_util_vp,atlas_params_fp:mn.atlas_params_voxel_util_fp})}function meshReload(){Hn(null)
Hn(null,true)
Dn()}function propModelAlloc(e,t){return{filename:e,opts_name:t,drawing:null}}function propModel(e,t,r){var a=e
if(t||r){var i=(t||0)+","+(r||0)
if(!e.swap_cache)e.swap_cache={}
if(!(a=e.swap_cache[i]))a=e.swap_cache[i]={}}if(!a.drawing){var o=te(K("model_opts/"+e.opts_name,"jsobj"))
if(t||r){var n={}
if(o.mat1&&t)n[Yr(o.mat1)]=t
if(o.mat2&&r)n[Yr(o.mat2)]=r
o.palette=Ki(o.palette,n)}a.drawing=Wn(e.filename,o).drawing}return a.drawing}function startup(){var e,t
El=Bi.char_controller
Zi()
Ji()
qi(meshReload)
fl=propModelAlloc("sack.vm","sack")
vl=((e={})[Sr.WOOD]=[{door_left:propModelAlloc("door-wood.vm","door")},{door_left:propModelAlloc("door-wood2.vm","door")}],e[Sr.LIGHT_WOOD]=[{door_left:propModelAlloc("door-light.vm","door")},{door_left:propModelAlloc("door-light2.vm","door")}],e[Sr.DARK_WOOD]=[{door_left:propModelAlloc("door-dark.vm","door")},{door_left:propModelAlloc("door-dark2.vm","door")}],e[Sr.RED_WOOD]=[{door_left:propModelAlloc("door-red.vm","door")},{door_left:propModelAlloc("door-red2.vm","door")}],e[Sr.STONE]=[{door_left:propModelAlloc("door-stone.vm","door")},{door_left:propModelAlloc("door-stone2.vm","door")}],e[Sr.FANCY_STONE]=[{door_left:propModelAlloc("door-fancystone.vm","door")},{door_left:propModelAlloc("door-fancystone2.vm","door")}],e.metal=[{door_left:propModelAlloc("door-metal.vm","door")},{door_left:propModelAlloc("door-metal2.vm","door")}],e)
hl=((t={})[Sr.WOOD]={door_left:propModelAlloc("doubledoor-wood-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-wood-right.vm","doubledoor-right")},t[Sr.LIGHT_WOOD]={door_left:propModelAlloc("doubledoor-lightwood-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-lightwood-right.vm","doubledoor-right")},t[Sr.DARK_WOOD]={door_left:propModelAlloc("doubledoor-darkwood-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-darkwood-right.vm","doubledoor-right")},t[Sr.RED_WOOD]={door_left:propModelAlloc("doubledoor-redwood-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-redwood-right.vm","doubledoor-right")},t[Sr.STONE]={door_left:propModelAlloc("doubledoor-stone-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-stone-right.vm","doubledoor-right")},t[Sr.FANCY_STONE]={door_left:propModelAlloc("doubledoor-fancystone-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-fancystone-right.vm","doubledoor-right")},t.metal={door_left:propModelAlloc("doubledoor-metal-left.vm","doubledoor-left"),door_right:propModelAlloc("doubledoor-metal-right.vm","doubledoor-right")},t.gate={door_left:propModelAlloc("doubledoor-metal-gate.vm","doubledoor-gate")},t)
pl=propModelAlloc("gem.vm","gem")
ml=propModelAlloc("indicator.vm","gem")}function always(){return true}var wl=0
function Prop(e){this.uid=++wl
this.item_id=e.id
this.attr1=e.attr1||0
this.attr2=e.attr2||0
this.attr3=e.attr3||0
this.inv=e
this.chunk_id=null
this.pos=null
this.quat=x()
this.rot=0
this.size=Be()
this.last_size=Be()
this.draw_offs=Be(.5,.5,0)
this.draw_opts={}
this.emit=0
this.version=1
this.interact_locked=false
this.property_edit_locked=false
this.in_list_mod=false
this.fallback=false
this.draw=null
this.tick=null
this.updateState=null}Prop.prototype.onFlow=se
Prop.prototype.onUnflow=null
Prop.prototype.is_preview=false
Prop.prototype.afterPlace=se
Prop.prototype.updatePreview=se
Prop.prototype.updateBeforePlace=se
Prop.prototype.updateRuntimeBehaviour=se
Prop.prototype.applyBoostLevel=null
Prop.prototype.interactable=se
Prop.prototype.interactable_continuously=false
Prop.prototype.mineWhenBlocked=se
Prop.prototype.read_only_interact=false
Prop.prototype.updatePos=se
Prop.prototype.override_intangible=false
Prop.prototype.setStage=void 0
Prop.prototype.stageableBakedOverride=void 0
Prop.prototype.getGrowthRate=void 0
Prop.prototype.isIntangible=function(){return this.override_intangible||this.inv.intangible}
Prop.prototype.setPos=function(e){if(!this.pos)this.pos=Be()
we(this.pos,e)
this.pos_idx=this.pos[0]+this.pos[1]*c+this.pos[2]*n
this.pos_key=this.chunk_id+","+this.pos_idx
this.updatePos()}
Prop.prototype.setLocalPos=function(e){this.chunk_id=Sn(e)
this.setPos(gn())}
Prop.prototype.ifNotLockedInteractable=function(){if(this.interact_locked)return null
return ol}
Prop.prototype.mineable=function(){return this.inv.mineable}
Prop.prototype.areaShouldClear=function(){return this.mineable()}
Prop.prototype.stageableSetStage=function(e){this.stage=e}
Prop.prototype.stageableUpdateBeforePlace=function(){if(rs())this.setStage(this.inv.stage_start)}
Prop.prototype.stageableUpdateRuntimeBehaviour=function(){var e=this.baked.key
var t=this.emit
var r=this.inv.stage_baked_key.length-1
var a=this.inv.stage_baked_key[ms(this.stage,r)].replace("$KEY$",this.baked_key_base)
this.baked.key=a
this.baked.size=this.size
if(this.stageableBakedOverride)this.stageableBakedOverride(this.baked)
this.emit=Fr(this.baked.key)
this.stateChanged(e,true,t)}
var Ll=Be()
Prop.prototype.growableCheckHeightTileCheck=function(e){return!Cn(this.chunk_id,e,1,false)}
Prop.prototype.growableCheckHeight=function(e){var t=this.inv.growth_heights[e]
if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world)for(var r=this.size[2];r<t;++r){Ll[2]=this.pos[2]+r
for(var a=0;a<this.size[1];++a){Ll[1]=this.pos[1]+a
for(var i=0;i<this.size[0];++i){Ll[0]=this.pos[0]+i
if(!this.checkHeightTileCheck(Ll))return false}}}return true}
Prop.prototype.growableGetGrowthRate=function(){return 1}
Prop.prototype.initParticles=function(e){this.particle_systems=[]
var t
if(e)t=e
else if(this.particle_system_list)t=this.particle_system_list
else t=this.inv.particle_systems||[]
for(var r=0;r<t.length;r++){var a=t[r]
var i=$i(this,a,this.quat)
this.particle_systems.push(i)}}
var Ol=1
A.registerValue("debug_particle_systems",{type:A.TYPE_INT,label:"Debug particle system amount in particle debugger",range:[1,Infinity],set:function set(e){Ol=e},access_show:["sysadmin"],get:function get(){return Ol},store:true})
Prop.prototype.initDebugParticles=function(){this.particle_systems=[]
var e=this.inv.particle_systems
for(var t=0;t<Ol;t++){var r=e[t%e.length]
var a=$i(this,r,this.quat)
this.particle_systems.push(a)}}
Prop.prototype.particleSystemRun=function(e){if(w.defines.NOPARTICLES)return null
if(null===this.chunk_id||void 0===this.chunk_id)return null
if(!this.particle_systems||!this.particle_systems[0]||this.item_id===Wt&&this.particle_systems.length!==Ol)this.initParticles()
for(var t=0;t<this.particle_systems.length;t++)this.particle_systems[t].updateParticleSystemOwner(this.rot,e)
return this.particle_systems.length}
Prop.prototype.detachParticleSystems=function(e){if(!this.particle_systems)return
for(var t=0;t<this.particle_systems.length;t++){this.particle_systems[t].fitToOwner(this.rot,e)
this.particle_systems[t].detach()}this.particle_systems=[]}
Prop.prototype.applyBoostLevelBoosted=function(){var e=this.baked.key
this.inv.initBoostedKey()
this.baked.key=this.inv.baked_key
if(this.inv.baked_swap&&(this.attr1!==Sr.ANY||this.inv.def_material)){I(this.baked.key)
this.baked.key=Hr(this.baked.key,this.attr1===Sr.ANY?this.inv.def_material:this.attr1,this.attr2)}this.stateChanged(e)}
var Rl=1/7
Prop.prototype.floraGetGrowthRate=function(){Rn(this)
var e=this.draw_opts.sun_factor||0
var t=this.draw_opts.torch_factor||0
return Ss(e)+Rl*Ss(t)}
var bl=.5
Prop.prototype.waterableFloraGetGrowthRate=function(){return this.floraGetGrowthRate()*(this.watered?1:bl)}
Prop.prototype.mushroomGetGrowthRate=function(){Rn(this)
var e=ps(0,.9-(this.draw_opts.sun_factor||0))
var t=this.draw_opts.torch_factor||0
return(Ss(e)+Rl*Ss(t))*(this.watered?1:bl)}
Prop.prototype.updateStatePerchedRootedWrapper=function(){var e=this
if(!this.interact_locked&&es()){this.getLocalPos(Ll);--Ll[2]
var t=Ll[1]
var r=Ll[0]
for(var a=0;a<this.size[1];++a){Ll[1]=t+a
for(var i=0;i<this.size[0];++i){Ll[0]=r+i
var o=Nn(Ll,0,false)
if(!o||o>=qo){var n=Gi()
this.interact_locked=true
kn(n,this,false,true)
n.onComplete(function(){e.interact_locked=false})
return}}}}this.mainUpdateState()}
function floraUpdateStateOnGrow(e){if(e.irrigator_depletion_time>e.growth_start){e.watered=true
return}e.getLocalPos(Ll)
var t=Ll[1]
var r=Ll[0]
e:for(Ll[1]=t-Hs;Ll[1]<t+Hs+1;Ll[1]++)for(Ll[0]=r-Hs;Ll[0]<r+Hs+1;Ll[0]++){var a=bn(Ll)
if(a&&a.item_id===fr&&a.depletion_time>e.growth_start){e.watered=true
e.irrigator_depletion_time=a.depletion_time
break e}}}function floraUpdateStateOnTrans(e,t){delete e.irrigator_depletion_time
if(!e.watered)e.cropUnwaterTilledDirt(t)}Prop.prototype.floraUpdateState=function(){this.growableUpdateState({on_grow:floraUpdateStateOnGrow,on_trans:floraUpdateStateOnTrans})}
Prop.prototype.aquaticCheckHeightTileCheck=function(e){var t=Cn(this.chunk_id,e,1,false)
var r=Cn(this.chunk_id,e,0,true)
return!t&&(r===rn.WATER||!es())}
Prop.prototype.transPropUpdateAndInteractLock=function(e,t){var r=this
Un(e,this,t)
this.interact_locked=true
e.onComplete(function(){r.interact_locked=false})}
Prop.prototype.growableUpdateState=function(e){if(this.interact_locked||tooManyTransactions())return
if(!this.inEditBounds(m))return
var t=this.stage
while(this.stage<this.growth_max_stage){var r=this.getGrowthRate()
this.growth_start=r<=0?Mo():this.growth_start
var a=Mo()-this.growth_start
var i=this.inv.growth_period/r
this.growth_progress=a/i
if(this.growth_progress<1)break
if(!this.growableCheckHeight(this.stage+1)){this.growth_start=Mo()-.5*this.inv.growth_period
break}this.setStage(this.stage+1)
this.growth_start-=a-i
if(e&&e.on_grow)e.on_grow(this)}if(t!==this.stage){var o=Gi()
if(e&&e.on_trans)e.on_trans(this,o)
this.transPropUpdateAndInteractLock(o,true)}}
Prop.prototype.isWaterable=function(){return void 0!==this.watered&&!this.watered}
Prop.prototype.wateringSystemWaterNearby=function(e){this.getLocalPos(Ll);--Ll[2]
var t=Ll[1]
var r=Ll[0]
for(Ll[1]=t-Hs;Ll[1]<t+Hs+1;Ll[1]++)for(Ll[0]=r-Hs;Ll[0]<r+Hs+1;Ll[0]++)if(Nn(Ll,0,false)===Qo&&Wa(Ll)){Fn(e,Ll,$o,false,false,Qo,false)
Ll[2]+=1
var a=bn(Ll)
if(a&&a.isWaterable()&&a.inEditBounds(h)){a.watered=true
Un(e,a,false)}--Ll[2]}}
var Nl=Be()
Prop.prototype.wateringSystemUpdateRuntimeBehaviour=function(){if(0===this.stage){this.draw=null
if(this.particle_systems){this.getLocalPos(Nl)
Re(Nl,this.draw_offs)
this.detachParticleSystems(Nl)}}else this.draw=this.particleSystemRun
this.stageableUpdateRuntimeBehaviour()}
Prop.prototype.wateringSystemUpdateState=function(){if(!this.stage||tooManyTransactions()||this.interact_locked||!rs())return
var e=hs((this.depletion_time-Mo())/Ws)
if((e=ps(e+=1,0))<this.stage){var t=Gi()
this.wateringSystemWaterNearby(t)
this.setStage(e)
this.transPropUpdateAndInteractLock(t,false)}}
Prop.prototype.saplingUpdateRuntimeBehaviour=function(){var e=this.baked.key
var t=this.emit
if(this.is_preview)this.baked.key="sapling-"+Ro[this.attr3]
else if(this.state===Ys)this.baked.key="arborheart-"+Ro[this.attr3]
else if(this.state===js)this.baked.key=Hr("arborheart-dying",this.attr1||Sr.WOOD)
else this.baked.key=Hr("arborheart-dead",this.attr1||Sr.WOOD)
this.emit=Fr(this.baked.key)
this.stateChanged(e,true,t)}
Prop.prototype.stateChanged=function(e,t,r){if(!this.is_preview&&null!==this.chunk_id){Mn(this)
if(this.baked.key!==e){var a=mn.chunk_map[this.chunk_id]
if(t&&this.emit!==r)a.lightDirty(this.emit);++a.ver_props
a.dirty()}}}
Prop.prototype.toggleBehaviour=function(e,t){I(this[e]||this.behaviour_backup[e])
if(!this.behaviour_backup)this.behaviour_backup={}
if(t&&!this[e]){this[e]=this.behaviour_backup[e]
delete this.behaviour_backup[e]}if(!t&&this[e]){this.behaviour_backup[e]=this[e]
this[e]=null}}
Prop.prototype.growableUpdateRuntimeBehaviour=function(){this.toggleBehaviour("updateState",this.stage<this.growth_max_stage&&rs())
this.stageableUpdateRuntimeBehaviour()}
Prop.prototype.growableGetStageSize=function(e){var t=this.inv.growth_heights.length-1
return this.inv.growth_heights[ms(e,t)]}
Prop.prototype.growableSetStage=function(e){this.growth_start=Mo()
this.size[2]=this.growableGetStageSize(e)
this.stageableSetStage(e)}
Prop.prototype.floraSetStage=function(e){this.watered=false
this.growableSetStage(e)}
Prop.prototype.floraStageableBakedOverride=function(e){if(this.stage<this.growth_max_stage&&!this.watered)e.key=zr(e.key,{dry:"plantdry"})}
Prop.prototype.plantUpdateRuntimeBehaviour=function(){this.toggleBehaviour("updateState",this.stage<this.growth_max_stage&&rs())
var e=this.baked.key
var t=this.emit
var r=this.stage?"plant-"+this.attr3:isMushroomPlant(this.attr3)?"mushroom-seed":"plant-seed"
this.baked.key=r
this.baked.size=this.size
if(this.stage<this.growth_max_stage&&!this.watered)this.baked.key=zr(r,{dry:"plantdry"})
this.emit=Fr(this.baked.key)
this.stateChanged(e,true,t)}
Prop.prototype.wateringSystemStageableBakedOverride=function(e){e.key=Hr(e.key,this.attr1)}
Prop.prototype.cropUnwaterTilledDirt=function(e){I(e)
this.getLocalPos(Ll);--Ll[2]
var t=Ll[1]
var r=Ll[0]
for(var a=0;a<this.size[1];++a){Ll[1]=t+a
for(var i=0;i<this.size[0];++i){Ll[0]=r+i
if(Nn(Ll,0,false)===$o&&Wa(Ll))Fn(e,Ll,Qo,false,false,$o,false).loose_priority=en[Qo]}}}
var Cl=2
var xl=Be()
Prop.prototype.chatAddDebug=function(e,t){if(!w.defines.PROP)return
if("sapling"===e&&!F.prop_chat_sapling)return
profilerStart("chatAddDebug")
var r=zo[e]||zo.default
this.getLocalPos(xl)
ve(xl,xl,this.size,.5)
xl[2]+=this.inv.floater_z||this.size[2]
Ua(xl,"[DEBUG] "+t,r.color,5,this.pos_key)
profilerStop("chatAddDebug")}
Prop.prototype.chatAddDirect=function(e,t,r){if("sapling"===e&&!F.prop_chat_sapling)return
if("grow"===e&&!F.prop_chat_grow)return
var a=zo[e]||zo.default
this.getLocalPos(xl)
ve(xl,xl,this.size,.5)
xl[2]+=this.inv.floater_z||this.size[2]
var i
var o=Pi.get(t)
if(o)if(r)i=q(String(o.$(r)))
else i=o.toLocalString()
else i=q(t)
Ua(xl,i,a.color,Cl,this.pos_key)}
Prop.prototype.chatAddTrans=function(e,t,r,a){if(!e)e=Gi()
I(Pi.get(r))
e.opPropChat(this.chunk_id,this.pos_idx,r,a,t)
return e}
var Ml=Be()
var Dl=Be()
var Pl=Be(-Kr,-Kr,-qr)
var Bl=false
var kl
var Ul=0
var Gl=1500
var Fl=3
Prop.prototype.saplingMsgKey=function(e){return"MSG_SAPLING_"+(co[this.attr3]||co[0])+"_"+e}
Prop.prototype.saplingGrowth=function(){var t=this
var e=Js
Q("sapling.growthcheck")
e-=Gl
if(!this.saplingInEditBounds(this.vd_next,false)){this.sapling_last_growth=Mo()
if(w.defines.PROP)this.chatAddDebug("sapling","Want to grow, bounds blocked")
return true}if(kl){I(kl)
I(kl.last===this)}else{++Ul
kl={stage:0,last:this,ulta_started:false,ulta_zoffs:0,growth_started:false,update_started:false,trans_count:0,trans_fail:0}
if(w.defines.PROP)this.chatAddDebug("sapling","Starting growth")}this.getLocalPos(Ml)
if(0===kl.stage){if(wo(Ml,this.vd_next,kl,e))++kl.stage
return false}if(1===kl.stage){var r=po(kl,this.vd_next,this.vd_current,e)
if(r===vo)return false
if(r===uo&&!this.sapling_growing_age){var a=Gi()
a.silent_error=true
this.chatAddTrans(a,"sapling",this.saplingMsgKey("GROW_BLOCKED"))
this.sapling_growth_failures=ms($s,(this.sapling_growth_failures||0)+1)
this.sapling_last_growth=Mo()
Un(a,this)
return true}I(r===fo||this.sapling_growing_age);++kl.stage
return false}if(2===kl.stage){xn(Dl,this.chunk_id,this.pos)
if(Io(kl,Dl,this.vd_next,this.vd_current,e))++kl.stage
return false}if(kl.stage===Fl){profilerStart("update finalize")
var i=Cr()
var o=i.trans()
o.silent_error=true
var n=!this.sapling_growing_age
if(n){this.chatAddTrans(o,"sapling",this.saplingMsgKey(1===this.next_age?"GROW_FINAL":"GROW"))
Q("sapling.growth")}if(!So(o,kl)){if(n)Gn(o,this,"sga","sapling_growing_age",this.next_age)
var s=Ul
kl.trans_count++
o.onComplete(function(e){if(s!==Ul)return
I(kl.last===t)
if(e){kl.trans_fail++
if(1===kl.trans_count){kl=null
Bl=true}}})
Yn(i)
profilerStop()
return false}if(!kl.trans_fail){this.age=this.next_age
this.sapling_growing_age=null
if(!this.sapling_origin_offset){this.sapling_origin_offset=[0,0,0]
this.sapling_size=[0,0,0]}Ie(this.sapling_origin_offset,Pl,this.vd_next.offset)
we(this.sapling_size,this.vd_next.size)
this.vd_current=this.vd_next
this.vd_next=null
this.last_successful_health_check=0
this.sapling_growth_failures=0
this.sapling_last_growth=Mo()
this.saplingUpdatePos()
this.saplingUpdateRuntimeBehaviour()
Un(o,this)}Yn(i)
kl=null;++Ul
profilerStop()}return true}
var Wl
var Hl=0
var zl=1
var Vl=2
Prop.prototype.saplingHealthCheck=function(){var e=Js
I(!this.sapling_growing_age)
rl=true
if(Wl){I(Wl)
I(Wl.last===this)}else Wl={num_steps:J((Bi.walltime_seconds-this.last_health_check-this.health_check_random_time)/Ks,1,4),stage:0,last:this,ulta_started:false,ulta_zoffs:0,prune_started:false}
e-=Gl
if(!this.saplingInEditBounds(this.vd_current,true)){this.health_check_random_time=Ks*gs()
this.last_health_check=Bi.walltime_seconds
if(w.defines.PROP)this.chatAddDebug("sapling","Want to health check, bounds blocked")
return zl}Q("sapling.healthcheck")
this.getLocalPos(Ml)
if(0===Wl.stage){if(wo(Ml,this.vd_current,Wl,e))++Wl.stage
return Hl}if(1===Wl.stage){var t=mo(this.vd_current)
var r=t[0],a=t[1],i=t[2],o=t[3]
if(r===a){if(w.defines.PROP)this.chatAddDebug("sapling","Health check perfect ("+r+"/"+a+")")
this.health_check_random_time=Ks*gs()
this.last_health_check=Bi.walltime_seconds
this.last_successful_health_check=Bi.walltime_seconds
return Vl}Wl.blocks_match=r
Wl.blocks_total=a
Wl.wood_match=i
Wl.wood_total=o;++Wl.stage
return Hl}if(2===Wl.stage){var n=Wl.wood_match
var s=Wl.wood_total
var l=Ts(Qs*Wl.num_steps)
Q("sapling.prune")
var _=Co(this.vd_current,Wl,e)
if(false===_)return Hl
var c=n-_.wood_count
if(_.total){if(_.leaves_count>l){_.wood_count=0
_.total=_.leaves_count
To(_,0,l)}else if(_.total>l)To(_,_.wood_idx,l)
Wl.blocks_match-=_.total}var u=false
var d
var f=false
if(c/s<1-_o&&this.state===Ys){d=this.chatAddTrans(d,"sapling",this.saplingMsgKey(1===this.age?"DYING_FULL":"DYING"))
f=true
this.state=js
this.vd_next=null}if(_.total<l&&(this.state===js||this.state===Vs)){var v=yo(this.vd_current,_,l)
Wl.blocks_match-=v
if(_.total<l&&this.state!==Vs){f=true
this.state=Vs}}if(_.total){d=d||Gi()
ho(d,Ml,this.vd_current,_,false)
u=true}if(this.state===Vs&&!Wl.blocks_match){f=false
d=d||Gi()
kn(d,this,false,true)
u=true}if(f){this.saplingUpdateRuntimeBehaviour()
d=d||Gi()
Un(d,this)
u=true}if(!u){I(!d)
if(w.defines.PROP)this.chatAddDebug("sapling","Health check stable ("+Wl.blocks_match+"/"+Wl.blocks_total+")")
this.last_successful_health_check=Bi.walltime_seconds
this.health_check_random_time=Ks*gs()
this.last_health_check=Bi.walltime_seconds}else{I(d)
d.silent_error=true
if(w.defines.PROP)this.chatAddDebug("sapling","Health check pruned ("+Wl.blocks_match+"/"+Wl.blocks_total+")")
this.health_check_random_time=0
this.last_health_check=Bi.walltime_seconds}}return this.state===Ys?Vl:zl}
var Yl={size:Be(),offset:Be()}
var jl=Be(3,3,3)
var Kl=Be(Kr-1,Kr-1,qr-1)
var ql=0
var Zl=1
Prop.prototype.saplingUpdateState=function(){if(this.working_next||this.working_current)return
var e=tl.query(this)
if(!e)return
if(rl){if(e===k&&this.sapling_inprogress_update&&this.sapling_inprogress_update.want_growth&&this.sapling_inprogress_update.stage===Zl);else Bl=true
tl.stillWorking(this)
return}profilerStart("saplingUpdateState")
if(Bl){Bl=false
if(e===k)e=U}var t=e===k
var r
var a
if(t){var i=this.sapling_inprogress_update
r=i.want_growth
a=i.want_health_check}else if(this.sapling_growing_age){this.next_age=this.sapling_growing_age
this.sapling_inprogress_update={want_growth:r=true,want_health_check:a=false,stage:1}}else{profilerStart("time calcs")
var o=os()||{}
var n=ps(1,ms(w.DEBUG?1e4:100,o.time_scale||1))
var s=(this.sapling_growth_failures||0)+1
var l=s*s
var _=(Mo()-this.sapling_last_growth)*n/l*zs
r=_>=1&&this.age<1&&this.state===Ys
var c=this.sapling_want_health_check_now?Xs:this.state===Ys||this.state===Vs?Ks:qs
a=Bi.walltime_seconds-(this.last_health_check+this.health_check_random_time)>c&&this.age>=1/Oo
if(r){if(!this.last_successful_health_check||Bi.walltime_seconds-this.last_successful_health_check>Zs)if(Bi.walltime_seconds-this.last_health_check<=Zs)r=false
else a=true
if(r){var u=Ts(this.age*Oo+_)
this.next_age=ms(1,u/Oo)}}profilerStop()
if(!r&&!a)return void profilerStop("saplingUpdateState")
if(a){if(this.sapling_size){we(Yl.size,this.sapling_size)
xe(Yl.offset,this.sapling_origin_offset,Pl)}else{we(Yl.size,jl)
we(Yl.offset,Kl)}if(!this.saplingInEditBounds(Yl,true)){this.sapling_want_health_check_now=false
this.health_check_random_time=Ks*gs()
this.last_health_check=Bi.walltime_seconds
if(w.defines.PROP)this.chatAddDebug("sapling","Want to health check, bounds blocked (early)")
return void profilerStop("saplingUpdateState")}}this.sapling_inprogress_update={want_growth:r,want_health_check:a,stage:0}}if(!this.vd_current){xn(Dl,this.chunk_id,this.pos)
go(this,this.age,Dl,true)
if(w.defines.PROP)this.chatAddDebug("sapling","GET current")}if(r)if(!this.vd_next||this.vd_next.age!==this.next_age){xn(Dl,this.chunk_id,this.pos)
go(this,this.next_age,Dl,false)
if(w.defines.PROP)this.chatAddDebug("sapling","GET next")}if(this.working_next||this.working_current){this.sapling_inprogress_update=null
return void profilerStop("saplingUpdateState")}if(!t)kl=Wl=null
if(this.sapling_inprogress_update.stage===ql){if(a){this.sapling_want_health_check_now=false
profilerStart("saplingHealthCheck")
var d=this.saplingHealthCheck()
profilerStop("saplingHealthCheck")
if(d===Hl){tl.stillWorking(this)
return void profilerStop("saplingUpdateState")}if(d===zl){this.sapling_inprogress_update=null
return void profilerStop("saplingUpdateState")}}this.sapling_inprogress_update.stage=Zl
if(a&&r){tl.stillWorking(this)
return void profilerStop("saplingUpdateState")}}if(this.sapling_inprogress_update.stage===Zl)if(r){rl=true
if(Eo(this.vd_current,this.vd_next)){tl.stillWorking(this)
return void profilerStop("saplingUpdateState")}profilerStart("saplingGrowth")
var f=this.saplingGrowth()
profilerStop("saplingGrowth")
if(!f){tl.stillWorking(this)
return void profilerStop("saplingUpdateState")}}this.sapling_inprogress_update=null
profilerStop("saplingUpdateState")}
Prop.prototype.saplingUpdatePos=function(){I(!this.removed)
if(!this.main_world)return
if(!Boolean(this.sapling_size)){if(this.bounded_in_list){ea(this)
this.bounded_in_list=false}return}this.saplingCalcBounds()
if(!this.bounded_in_list){Jr(this)
this.bounded_in_list=true}else ta(this)}
Prop.prototype.saplingOnRemove=function(){if(this.bounded_in_list){ea(this)
this.bounded_in_list=false}}
Prop.prototype.saplingBumpLight=function(){this.sapling_want_health_check_now=true
this.sapling_growth_failures=0
this.health_check_random_time=0}
Prop.prototype.saplingAutoSelect=function(){this.saplingBumpLight()
tl.bump(this)}
Prop.prototype.saplingCalcBounds=function(){var r=Be()
var a=Be()
var i=Be()
return function saplingCalcBounds(){var e=this.sapling_origin_offset
var t=this.sapling_size
if(!e)return null
I(e&&t)
xn(a,this.chunk_id,this.pos)
Ie(r,a,e)
Ie(i,r,t)
Re(i,fe)
if(!this.bounded_origin){this.bounded_origin=Be()
this.bounded_size=Be()
this.bounded_inv_origin=Be()}we(this.bounded_origin,r)
we(this.bounded_size,t)
we(this.bounded_inv_origin,i)
return this}}()
Prop.prototype.saplingUpdateBeforePlace=function(){this.sapling_last_growth=Mo()
this.sapling_growth_failures=0
this.health_check_random_time=Ks*gs()
this.last_health_check=Bi.walltime_seconds
this.age=0
this.sapling_origin_offset=null
this.sapling_size=null
this.seed=F.sapling_seed||hs(1e4*gs())
this.state=Ys}
Prop.prototype.saplingMineable=function(){if(this.state===js)this.saplingAutoSelect()
else this.saplingBumpLight()
return true}
Prop.prototype.saplingOnDig=function(e){if(0){this.getLocalPos(Ml)
if(!this.vd_current||this.working_current){xn(Dl,this.chunk_id,this.pos)
this.vd_current=bo(this.age,this.seed,this.attr3,Dl)}I(!this.sapling_growing_age)
Bl=true
Ao(Ml,this.vd_current)
mo(this.vd_current)
var t=No(this.vd_current,true)
if(t.total)ho(e,Ml,this.vd_current,t,true)
kn(e,this,true,false)
if(0===this.age){this.getLocalPos(Al)
Oa(e,Al,this.toItem(),false,false)}}else if(0===this.age)this.onDigBase(e)
else if(this.state===Ys){this.chatAddTrans(e,"sapling",this.saplingMsgKey(1===this.age?"DYING_FULL":"DYING"))
this.state=js
Un(e,this)}else if(this.state===js){this.state=Vs
Un(e,this)}else kn(e,this,true,false)}
Prop.prototype.plantUpdateBeforePlace=function(e,t,r){if(!r||rs()||0===this.stage)this.attr3=mapToFlowerTypeFromSeed(this.attr3)
this.floraUpdateBeforePlace(e)}
Prop.prototype.floraUpdateBeforePlace=function(e){this.stageableUpdateBeforePlace()
Ll[2]=e[2]-1
var t=true
e:for(var r=0;r<this.size[1];++r){Ll[1]=e[1]+r
for(var a=0;a<this.size[0];++a){Ll[0]=e[0]+a
if(Nn(Ll,1,false)!==$o){t=false
break e}}}if(t){this.watered=true
this.updateRuntimeBehaviour()}}
Prop.prototype.floraWaterableInteractable=function(){if(this.interact_locked)return null
var e=this.stage>=this.growth_max_stage
if(!this.watered&&ro(Jo)&&!e)return cl
return false}
var Xl=[{name:"watering_particles",rot:0,offset_position:[0,0,0]}]
var Ql=Be()
Prop.prototype.createDetachedParticleSystemsFromProp=function(e){this.getLocalPos(Ql)
Ce(Ql,Ql[0]+this.size[0]/2,Ql[1]+this.size[1]/2,Ql[2])
Qi(Ql,e)}
Prop.prototype.triggerParticleSystemList=function(e){if(this.inv.particle_triggers&&this.inv.particle_triggers[e])this.createDetachedParticleSystemsFromProp(this.inv.particle_triggers[e])}
var $l=.95
Prop.prototype.floraWaterableInteract=function(e){_s(this.inv.watering_sound)
this.createDetachedParticleSystemsFromProp(Xl)
this.watered=true
var t=(Mo()-this.growth_start)*this.getGrowthRate()/this.inv.growth_period
this.growth_start=Mo()-ms(t,$l)*this.inv.growth_period
this.transPropUpdateAndInteractLock(e,false)
this.getLocalPos(Ll);--Ll[2]
var r=Ll[1]
var a=Ll[0]
for(var i=0;i<this.size[1];++i){Ll[1]=r+i
for(var o=0;o<this.size[0];++o){Ll[0]=a+o
if(Nn(Ll,0,false)===Qo&&Wa(Ll))Fn(e,Ll,$o,false,false,Qo,true)}}}
Prop.prototype.harvestableIsEarlyPickable=function(){return null!==this.inv.harvest_pickable_stage&&this.stage>=this.inv.harvest_pickable_stage}
Prop.prototype.harvestableIsPickable=function(){return void 0===this.stage||this.stage>=this.growth_max_stage||this.harvestableIsEarlyPickable()}
Prop.prototype.harvestableInteractable=function(){if(this.interact_locked)return null
if(!ro()&&this.harvestableIsPickable())return void 0===this.stage||this.stage>this.growth_max_stage||-1===this.inv.harvest_reverting_stage?ol:sl
return null}
Prop.prototype.chairInteractable=function(){if(this.interact_locked)return null
this.getLocalPos(Al)
if(Le(El.pos,Al)>49)return nl
return ol}
var Jl=7
var e_=1
var t_=4
var r_=function(a){_inheritsLoose(SignFloater,a)
function SignFloater(e){var t=Vo
var r=e.sign_text
return a.call(this,{align:Y.font.ALIGN.HCENTER|Y.font.ALIGN.HWRAP,text:r,style:t,w:Jl,resize_to_w:true,min_size:e_,max_size:t_,max_lines:7,use_markdown:true})||this}return SignFloater}(_i)
var a_=((a={})[rr]=Be(-.5,0,.5),a[ar]=Be(-.5,0,.5),a[ir]=Be(-.5,0,.5),a[or]=Be(0,0,1.5),a[nr]=Be(0,0,1.5),a[sr]=Be(0,0,1.5),a)
var i_=Be()
function signFloaterPosInit(e){var t=rotToVec(e.rot)
var r=a_[e.item_id]
i_[0]=t[0]*r[0]+t[1]*r[1]
i_[1]=t[0]*r[1]+t[1]*r[0]
i_[2]=r[2]
ve(i_,i_,e.size,.5)
we(e.floater_offset,i_)}var o_=18
var n_=.55*Es
function isSignVisible(e){var t=Le(Pa().pos,e.floater_pos)
var r=xe(i_,e.floater_pos,Pa().getCameraPos())
var a=Ae(r,rotToVec(e.rot))
e.max_view_dist=o_*(a-n_)/n_
return t<=e.max_view_dist*e.max_view_dist&&a>n_}Prop.prototype.signUpdateRuntimeBehaviour=function(){this.draw=this.sign_text?this.signDraw:null
if(null!==this.chunk_id)Mn(this)}
Prop.prototype.signDraw=function(){if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world&&this.sign_text){if(!this.sign_floater){signFloaterPosInit(this)
this.sign_floater=new r_(this)}this.getLocalPos(this.floater_pos)
Ie(this.floater_pos,this.floater_pos,this.floater_offset)
if(isSignVisible(this)){this.sign_floater.setText(this.sign_text)
ci({floater:this.sign_floater,max_dist:this.max_view_dist,draw_in_photos:true},this.floater_pos,ii,{vert_offset_scale:-this.sign_floater.h/2,downscale_if_offscreen:false,max_scale:200})}}return 2}
var s_=5
Prop.prototype.signInteractable=function(){if(this.property_edit_locked)return null
this.getLocalPos(Al)
if(Le(El.pos,Al)>s_*s_)return null
return ol}
Prop.prototype.signInteract=function(){eo(this,{fields:[{key:"sign_text",label:Pi.LBL_SIGN_TEXT,msg:Pi.DLG_ENTER_SIGN_TEXT_MSG,max_len:70,profanity_filter:true,allow_clear:true}],direct:true})}
var l_=Be()
Prop.prototype.findDropOptions=function(e,t,r){this.getLocalPos(Al)
var a=[]
var i=this.size[2]+1
for(var o=0;o<i;++o){Ll[2]=Al[2]+o
for(var n=-1;n<this.size[1]+1;++n){Ll[1]=Al[1]+n
for(var s=-1;s<this.size[0]+1;++s){Ll[0]=Al[0]+s
if(xa(Ll))a.push(Ll.slice(0))
else{var l=Nn(Ll,1,false)
if(e&&l>=Zo&&l<=Xo&&Tn()===this)a.push(Ll.slice(0))}}}}if(t){var _=[]
if(!(a=a.filter(function(e){if(e[0]>=t[0]&&e[0]<=r[0]&&e[1]>=t[1]&&e[1]<=r[1]){_.push(e)
return false}return true})).length)a=_}return a}
var __=[{name:"harvest_particles",rot:0,offset_position:[0,0,0]},{name:"dirt_particles",rot:1,offset_position:[0,0,0]}]
function processHarvestResults(e,t){if(!is())return
var r=e.harvest_results
if(r&&!Array.isArray(r))if((r=r[e.attr1]||r.def)&&!Array.isArray(r))r=r[e.attr3]||r.def
r=e.stage>e.growth_max_stage?Tl:r
if(e.local_last_pay_cost)e.addToBagFromLocalLastPayCost(t,false)
else if(e.inv.harvest_results_exclusive){var a=gs()
var i=0
for(var o=0;o<r.length;++o){var n=_extends({},r[o])
if(!n.drop_chance||a<i+n.drop_chance){n.drop_chance=1
e.addHarvestToBag(n,t)
break}else i+=n.drop_chance}}else for(var s=0;s<r.length;++s){var l=_extends({},r[s])
e.addHarvestToBag(l,t)}}var c_=Be()
Prop.prototype.multiHarvestableInteract=function(e){var t=this
var r
if(this.harvestableIsPickable()){var a=0
_s(this.inv.harvest_full_sound)
e=e||Gi()
this.createDetachedParticleSystemsFromProp(__)
var i=this.stage>this.growth_max_stage?-1:this.inv.harvest_reverting_stage
this.harvest_drop_options=this.findDropOptions(-1===i)
if(!this.harvest_drop_options.length){i=-1
this.harvest_drop_options.push(Al)}if(-1===i)r=true
else if(this.harvest_left>1)a=-1
else if(this.harvest_left<=1)i=this.growth_max_stage+1
if(r){kn(e,this,true,false)
processHarvestResults(this,e)}else{processHarvestResults(this,e)
var o=false
if(i>-1){this.setStage(i)
o=true}if(a){this.harvest_left+=a
o=true}if(o)Un(e,this,true)}this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})}return r}
var u_=Be()
var d_=Be(.5,.5,1)
Prop.prototype.chairInteract=function(e,t){if(this.interactable()===nl)return
var r
if(this.attr1===Sr.RED_WOOD||this.attr1===Sr.WOOD)r=Ba(El.getCardinalFacing())
else r=this.rot*bs-Es
this.getLocalPos(u_)
Re(u_,d_)
El.sitOnChair(u_,r)}
Prop.prototype.wateringSystemWaterableInteractable=function(){if(this.interact_locked)return null
if(this.stage<this.inv.stage_baked_key.length-1&&ro(Jo))return cl
return null}
Prop.prototype.wateringSystemWaterableInteract=function(e){_s(this.inv.watering_sound)
if(0===this.stage)this.depletion_time=Mo()
this.wateringSystemWaterNearby(e)
this.setStage(this.stage+1)
this.depletion_time+=Ws
this.transPropUpdateAndInteractLock(e,false)}
Prop.prototype.wateringSystemGrowstickInteract=function(e){var t=this.inv.stage_baked_key.length-1
e=e||Gi()
if(this.stage===t){this.setStage(0)
this.depletion_time=0}else{this.setStage(this.stage+1)
this.depletion_time=Mo()+Ws*this.stage}if(rs())this.wateringSystemWaterNearby(e)
else this.depletion_time=0
this.transPropUpdateAndInteractLock(e,false)
this.updateRuntimeBehaviour()
_s(this.inv.watering_sound)}
Prop.prototype.isFactory=function(){return this.interact===this.factoryInteract}
Prop.prototype.isQuickDepositTarget=function(){return this.isContainer()&&!this.isFactory()&&this.inEditBounds(p)}
Prop.prototype.isContainer=function(){return this.interact===this.chestInteract||this.isFactory()}
Prop.prototype.isWaygate=function(){return this.item_id===vr}
Prop.prototype.isLeapgate=function(){return this.item_id===Pt}
Prop.prototype.isEnergyWell=function(){return this.item_id===Tt}
Prop.prototype.interactDetails=function(){if(!(this.isContainer()||this.item_id===Xe||this.item_id===vr||this.item_id===Pt||this.item_id===Tt||this.item_id===tt||this.propertyEdit))return null
if(!this.container_pos)this.container_pos=Be()
this.getLocalPos(this.container_pos)
return this.container_pos}
Prop.prototype.chestMineable=function(){return yi(this)||!is()}
Prop.prototype.chestMineWhenBlocked=function(){Do.get("minefull").setMessage(Pi.STATUSMSG_MINE_PROP_FULL)}
Prop.prototype.chestInteract=function(){_s("chest_open")
Fi(Vi.CONTAINER,this.interactDetails())}
Prop.prototype.factoryInteract=function(){_s("factory_open")
Fi(Vi.FACTORY,this.interactDetails())}
Prop.prototype.alwaysInteractable=function(){return ll}
Prop.prototype.factoryInteractable=function(){return ts()?this.alwaysInteractable():null}
Prop.prototype.factoryUpdateRuntimeBehaviour=function(){if(ei(this)){var t=this.factory_estimator=ti(this)
if(t){this.draw=this.factoryDraw
Mi(t.output_preview,function(e){t.gfx=e})}else this.draw=null}else if(this.inv.particles_always_on_in_unlimited&&!ts())this.draw=this.particleSystemRun
else{this.draw=null
this.factory_estimator=null}if(null!==this.chunk_id)Mn(this)}
var f_=function(r){_inheritsLoose(ProgressIconFloater,r)
function ProgressIconFloater(e){var t;(t=r.call(this,e=e||{})||this).prop=e.prop
I(e.prop)
return t}ProgressIconFloater.prototype.draw=function draw(e){var t=this
var r=e.x,a=e.y,i=e.z,o=e.scale
var n=this.prop.factory_estimator.gfx
if(n){var s={x:r,y:a,z:i,w:this.w*o,h:this.h*o}
if(n.need_thumbnail_update){this.prop.factory_estimator.gfx=null
Mi(this.prop.factory_estimator.output_preview,function(e){if(t.prop.factory_estimator)t.prop.factory_estimator.gfx=e})}else if(n.img){oe(s,{frame:n.frame,color:this.color})
n.img.draw(s)}}}
return ProgressIconFloater}(ni)
var v_=1
var h_=4
var p_=v_+2*.05
var m_=6*p_
var E_=function(t){_inheritsLoose(ProgressFloater,t)
function ProgressFloater(e){return t.call(this,{text:{floater:new _i({w:m_,size:v_}),rel_pos:{x:0,y:.98*h_,z:2}},bar:{floater:new si({w:m_,h:p_}),rel_pos:{x:0,y:.98*h_,z:1}},icon:{floater:new f_({w:h_,h:h_,prop:e}),rel_pos:{x:m_/2-h_/2,y:0,z:0}}})||this}var e=ProgressFloater.prototype
e.setText=function setText(e){this.fp_pairs.text.floater.setText(e)}
e.setProgress=function setProgress(e){this.fp_pairs.bar.floater.setProgress(e)}
e.setColor=function setColor(e){this.fp_pairs.bar.floater.setColor(e)}
return ProgressFloater}(ai)
Prop.prototype.factoryDraw=function(e){I(this.factory_estimator)
if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world&&!w.defines.NOUI){var t=this.factory_estimator.estimateProgress()
var r=t.is_running
if(this.inv.progress_indicator){if(!this.progress_floater){this.progress_floater=new E_(this)
this.floater_pos=Be()}this.getLocalPos(this.floater_pos)
ve(this.floater_pos,this.floater_pos,this.size,.5)
this.floater_pos[2]+=this.inv.floater_z||this.size[2]
this.progress_floater.setText(Pi.$(Pi.FORMAT_FRACTION,t.ready,t.total))
this.progress_floater.setProgress(t.partial)
this.progress_floater.setColor(t.ready>0?ko:Go)
ci({floater:this.progress_floater,max_dist:F.factory_status_dist},this.floater_pos,ii)}if(r&&this.factory_state!==Ja)return this.particleSystemRun(e)
else this.detachParticleSystems(e)}return null}
var g_=["energy-well-empty","energy-well-full1","energy-well-full2","energy-well-full3"]
function propEnergyWellReadiness(e){if(!Ca()||null===e.chunk_id)return 2
if(!Ya(e))return 0
var t=Ka()
if(!t)return 0
return t}Prop.prototype.energyWellUpdateRuntimeBehaviour=function(){var e=this.baked.key
var t=propEnergyWellReadiness(this)
var r=g_[t]
if(r!==e){I(r)
this.baked.key=r
if(t&&Ca())this.draw=this.particleSystemRun
else this.draw=null
this.stateChanged(e)}}
Prop.prototype.energyWellTick=function(){if(this.baked.key!==g_[propEnergyWellReadiness(this)])this.energyWellUpdateRuntimeBehaviour()}
Prop.prototype.energyWellInteractable=function(){if(Ca())return qa(this)?ol:this.alwaysInteractable()
else return null}
Prop.prototype.energyWellInteract=function(){if(qa(this))ja()
else{_s("factory_open")
Fi(Vi.ENERGY_WELL,this.interactDetails())}}
Prop.prototype.leapgateMineable=function(){return ln()||this.stage!==yr.COMPLETE}
Prop.prototype.leapgateAreaShouldClear=function(){return this.stage!==yr.COMPLETE}
Prop.prototype.leapgateMineWhenBlocked=function(){Do.get("minewglinked").setMessage(Pi.STATUSMSG_MINE_LEAPGATE_ACTIVE)}
Prop.prototype.leapgateInteractable=function(){if(ln())return this.alwaysInteractable()
else return null}
Prop.prototype.leapgateInteract=function(){_s("factory_open")
Fi(Vi.LEAPGATE,this.interactDetails())}
var T_={}
Prop.prototype.leapgateUpdateBeforePlace=function(e,t){this.stageableUpdateBeforePlace()
var r=Sn(e)+","+xr(gn())
if(T_[r])this.leapgate_extracts=T_[r]}
Prop.prototype.leapgateUpdatePos=function(){if(this.leapgate_extracts&&ie(this.chunk_id)&&ie(this.pos_idx)){var e=this.pos_key
T_[e]=this.leapgate_extracts}}
Prop.prototype.gateDrawParticles=function(e){var t
if(Br(this)||kr())t=null
else if(!Ur(this))t=this.inv.particle_systems_active||null
else t=this.inv.particle_systems_activating||null
if(t!==this.particle_system_list){this.detachParticleSystems(e)
this.particle_system_list=t}if(this.particle_system_list)this.particleSystemRun(e)}
Prop.prototype.leapgateStageableBakedOverride=function(e){if(this.stage===yr.INITIAL)this.draw=null
else if(this.stage===yr.SOURCE||this.stage===yr.TARGET){this.particle_system_list=this.inv.particle_systems_progress
this.draw=this.particleSystemRun}else if(this.stage===yr.COMPLETE)this.draw=this.gateDrawParticles}
Prop.prototype.waygateUpdateRuntimeBehaviour=function(){if(this.waygate_targets&&this.waygate_targets.length)this.draw=this.gateDrawParticles
else this.draw=null
this.stateChanged(this.baked.key)}
var y_=Be(-.5,-.5,0)
Prop.prototype.blockPreviewDraw=function(e){var t=this.attr1
var r=this.mat
b(r,1,this.quat,e)
S(r,r,y_)
drawBlock(r,t,this.draw_opts,1,true)}
function propertyEditBaseCheck(e){if(!e.propertyEdit||hn()||e.property_edit_locked)return false
var t=io()
if(!t)return false
var r=e.prop_edit_ids||{}
return t.type===mr&&(t.id===e.item_id||r[t.id])}Prop.prototype.shouldPropertyEdit=function(){return propertyEditBaseCheck(this)}
Prop.prototype.accessControlInteractDetails=function(){if(!this.access_control_pos)this.access_control_pos=ke()
this.getLocalPos(this.access_control_pos)
this.access_control_pos[3]=this.rot
return this.access_control_pos}
Prop.prototype.accessControlInteractable=function(){return hn()?null:ll}
Prop.prototype.accessControlInteract=function(){Fi(Vi.ACCESS_CONTROL,this.interactDetails())}
var S_=0
var I_={}
A.registerValue("gem_debug",{type:A.TYPE_INT,range:[0,1],get:function get(){return S_},set:function set(e){S_=e
I_={}},access_run:["sysadmin"],store:true})
function gemDebugTick(){var e=Vn()
var t=150
var r=150
var a=Z.DEBUG
var i=0
for(var o in I_){var n=I_[o]
var s=0
var l=[]
for(var _ in n)if(n[_]!==e)delete n[_]
else{l.push(_);++s}if(s){++i
Y.print(s>1?Ho:Fo,t,r,a,"GemID "+o+": "+l.join("  "))
r+=Y.font_height}}Y.print(i===as()?Fo:Ho,t,r,a,"Total unique gems = "+i+" / "+as())
r+=Y.font_height
if(Y.buttonText({x:t,y:r,z:a,text:"Refresh",w:100,h:48,font_height:32}))I_={}}Prop.prototype.gemPropertyEdit=function(){eo(this,{fields:[{key:"gem_id",label:"Gem ID",allow_clear:true,valid_regex:br}]})}
Prop.prototype.gemUpdateRuntimeBehaviour=function(){}
Prop.prototype.gemPickupable=function(){return this.gem_id&&hn()&&as()&&!(fn("gems_claimed")||{})[this.gem_id]}
Prop.prototype.gemTick=function(){if(S_&&this.gem_id){var e=this.gem_id,t=this.pos_key
var r=Vn()
var a=I_[e]
if(!a)a=I_[e]={}
a[t]=r
var i=false
for(var o in a){if(o===t)continue
i=true}if(!this.id_floater){this.id_floater=new _i
this.floater_pos=Be()}this.getLocalPos(this.floater_pos)
this.floater_pos[0]+=.5
this.floater_pos[1]+=.5
this.floater_pos[2]++
this.id_floater.setText(String(this.gem_id))
this.id_floater.setStyle(i?Ho:Wo)
ci({floater:this.id_floater},this.floater_pos,oi)}if(this.done||!this.gemPickupable())return
this.getLocalPos(Al)
Ie(l_,Al,ue)
if(Le(El.center_pos,l_)<=Ns){_s("pickup_gem")
qn(this.gem_id,this.chunk_id,this.pos_idx)
this.done=true
this.gem_pickup_time=w.frame_timestamp}}
var A_=ke(1,.25,.25,1)
var w_=ke(1,1,1,.2)
var L_=ke(1,1,1,0)
Prop.prototype.gemDraw=function(e){if(w.defines.NOCHUNKS)return
var t=(w.frame_timestamp-this.gem_pickup_time)/2e3
var r=this.gem_pickup_time&&t<2
var a=this.gemPickupable()
var i=this.draw_opts.color===il
var o=this.gem_id&&hn()&&as()&&!a
var n=i||!this.draw_opts.for_snapshot&&(a||r||o)?w.frame_timestamp:0
M(this.gem_quat,Ue,(this.rot+.001*n)*bs)
var s=propModel(pl)
I(s.draw_offset)
P(this.gem_offs,s.draw_offset,this.quat)
Ie(this.gem_pos,e,this.gem_offs)
this.gem_pos[2]+=2*ys(.001*n)/7
if(!i){this.draw_opts.alpha_queue=false
var l=this.draw_opts.color?this.draw_opts.color[3]:1
if(r){if(!this.gem_temp_color)this.gem_temp_color=ke()
if(t<1){this.gem_pos[2]+=10*re(t,2)
this.draw_opts.color=De(this.gem_temp_color,t,fe,L_)}else this.draw_opts.color=De(this.gem_temp_color,t-1,L_,w_)
this.draw_opts.alpha_queue=true}else if(!this.gem_id&&!this.draw_opts.for_snapshot)this.draw_opts.color=A_
else if(o){this.draw_opts.color=w_
this.draw_opts.alpha_queue=true}else this.draw_opts.color=fe
if(1!==l){if(!this.gem_temp_color)this.gem_temp_color=ke()
this.draw_opts.color=Me(this.gem_temp_color,this.draw_opts.color)
this.draw_opts.color[3]*=l}}var _=s.vd.mat
s.vd.mat=this.gem_mat
s.draw(this.gem_pos,this.gem_quat,1,this.draw_opts)
s.vd.mat=_}
Prop.prototype.indicatorDraw=function(e){var t
var r=propModel(ml)
if(!this.draw_opts.for_snapshot){t=w.frame_timestamp
M(this.indicator_quat,Ue,(this.rot+.001*t)*bs)
I(r.draw_offset)
P(this.indicator_offs,r.draw_offset,this.quat)}Ie(this.indicator_pos,e,this.indicator_offs)
if(!this.draw_opts.for_snapshot)this.indicator_pos[2]+=3*ys(.003*t)/7
r.draw(this.indicator_pos,this.indicator_quat,1,this.draw_opts)}
Prop.prototype.doorUpdateRuntimeBehaviour=function(){this.override_intangible=Boolean(this.open)}
var O_=400
Prop.prototype.doorDraw=function(e){var t
var r
var a=0
var i=0
var o=this.attr3?1:0
var n=false
var s=this.attr1
if(s===Sr.FANCY_STONE&&!$n()&&this.main_world)s=Sr.STONE
if(this.item_id===mt){a=s!==Sr.ANY?s:0
n=true
var l=hl.gate
t=l.door_left
r=l.door_right}else if(this.item_id===Et){a=s!==Sr.ANY?s:0
var _=hl.metal
t=_.door_left
r=_.door_right}else if(this.item_id===pt){var c=hl[s]||hl[Sr.WOOD]
t=c.door_left
r=c.door_right}else if(this.item_id===gt){a=s!==Sr.ANY?s:0
var u=vl.metal[o]
t=u.door_left
r=u.door_right}else{var d=(vl[s]||vl[Sr.WOOD])[o]
t=d.door_left
r=d.door_right}t=t&&propModel(t,a,i)
r=r&&propModel(r,a,i)
var f=0
var v=this.open?-1:0
if(this.open_at){var h=(w.frame_timestamp-this.open_at)/O_
if(h>=1)this.open_at=0
else{h=ae(h,2)
if(this.open)v=-h
else v=-1+h}}if(t){if(n){I(t.draw_offset)
P(this.door_offs,t.draw_offset,this.quat)
Ie(this.door_pos,e,this.door_offs)
this.door_pos[2]-=3.395*v
t.draw(this.door_pos,this.quat,1,this.draw_opts)}else{M(this.door_left_quat,Ue,(this.rot+.99*v)*bs)
I(t.draw_offset)
P(this.door_offs,t.draw_offset,this.quat)
Ie(this.door_pos,e,this.door_offs)
t.draw(this.door_pos,this.door_left_quat,1,this.draw_opts)}++f}if(r){M(this.door_right_quat,Ue,(this.rot-.99*v)*bs)
I(r.draw_offset)
P(this.door_offs,r.draw_offset,this.quat)
Ie(this.door_pos,e,this.door_offs)
r.draw(this.door_pos,this.door_right_quat,1,this.draw_opts);++f}return f}
Prop.prototype.doorInteract=function(){this.open_at=w.frame_timestamp
if(hn()||!this.inEditBounds(h))this.open=1-this.open
else{var e=Gi()
Gn(e,this,"d","open",this.open?0:1)
e.silent_error=true}_s(this.open?"door_open":"door_close")
this.updateRuntimeBehaviour()}
Prop.prototype.doorInteractable=function(){return ll}
Prop.prototype.waygateAfterPlace=function(){if(ss())Fi(Vi.WAYGATE_EDIT,this.interactDetails())}
Prop.prototype.waygateGetID=function(){var e=ns()
for(var t in e){var r=e[t]
if(r.pos[0]===this.chunk_id&&r.pos[1]===this.pos_idx)return t}return null}
Prop.prototype.waygateLinkable=function(){return Boolean(this.waygateGetID())}
Prop.prototype.waygateMineable=function(){return!this.waygateLinkable()}
Prop.prototype.waygateMineWhenBlocked=function(){Do.get("minewglinked").setMessage(Pi.STATUSMSG_MINE_WG_LINKED)}
Prop.prototype.waygateInteract=function(){Fi(Vi.WAYGATE_EDIT,this.interactDetails())}
Prop.prototype.waygateEditAllowed=function(){return za(this.getLocalPos())||nn()&&this.inEditBounds(h)&&!Fa(this.getLocalPos())}
Prop.prototype.waygateInteractable=function(){if(this.waygateEditAllowed())return ll
var e=this.waygateGetID()
if(e&&xo(e)&&ss())return ll
if(!ss()&&Jn())return ll
return null}
var R_=.75
var b_=.2
var N_=1.5
var C_=function(i){_inheritsLoose(BuzzerNameFloater,i)
function BuzzerNameFloater(e,t){var r=new _i({text:e,style:L.style(Wo,{glow_outer:3,glow_color:255})})
var a=new _i({text:""+t,size:N_,max_w:15,style:L.style(Wo,{glow_outer:4,glow_color:255})})
a.h+=R_
return i.call(this,{descriptor:{floater:r,rel_pos:{x:ps(0,-r.w/2+a.w/2),y:0,z:0}},id:{floater:a,rel_pos:{x:ps(0,-a.w/2+r.w/2),y:r.h+b_,z:0}}})||this}return BuzzerNameFloater}(ai)
Prop.prototype.buzzerMineable=function(){return!this.buzzer_id}
Prop.prototype.buzzerMineWhenBlocked=function(){Do.get("minenamed").setMessage(Pi.STATUSMSG_MINE_PROP_NAMED)}
Prop.prototype.buzzerShouldPropertyEdit=function(){return propertyEditBaseCheck(this)&&_n()}
var x_="buzzerstart_blank"
var M_="buzzerstart_ready"
var D_="buzzerstart_racing"
Prop.prototype.buzzerStartUpdateRuntimeBehaviour=function(){var e=this.baked.key
var t=this.emit
var r
if(!this.buzzer_id)r=x_
else{r=M_
if(!sn()){var a=fn("race_data")||{}
if(a.start&&a.id===Ir(this.buzzer_id))r=D_}}if(r!==e){I(r)
this.baked.key=r
this.emit=Fr(this.baked.key)
this.stateChanged(e,true,t)}}
var P_=12
var B_=.35
Prop.prototype.buzzerStartDraw=function(){if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world){this.updateRuntimeBehaviour()
if(!w.defines.NOUI){this.getLocalPos(this.floater_pos)
if(Le(El.pos,this.floater_pos)<=P_*P_){ve(this.floater_pos,this.floater_pos,this.size,.5)
this.floater_pos[2]+=this.size[2]
if(this.buzzer_id){if(!this.id_floater)this.id_floater=new C_(Pi.addColon(Pi.LBL_COURSE_START),this.buzzer_id)
ci({floater:this.id_floater,max_dist:P_,fade_dist:B_},this.floater_pos,.125)}}}}}
var k_=6.11
Prop.prototype.buzzerStartInteractable=function(){if(!cn()&&!fn("race_data"))return null
this.getLocalPos(Al)
ve(Al,Al,this.size,.5)
if(Le(El.pos,Al)>k_*k_||this.interact_locked||!this.buzzer_id&&!_n())return null
return ol}
Prop.prototype.buzzerStartInteract=function(){if(!this.buzzer_id){Do.get("buzzid").setMessage(Pi.STATUSMSG_ASSIGN_BUZZER_NAME)
return}var e=fn("race_data")
var t=e&&e.id===Ir(this.buzzer_id)
if(cn()){if(t)Do.get("buzzrestart").setMessage(Pi.STATUSMSG_RACE_RESTARTED)
if(t||!e){_s("race_start")
this.triggerParticleSystemList("press")
jn(this)}else{var r=this
var a=!O.touch_mode&&!Vi.active()?O.pointerLockEnter:null
Y.modalDialog({text:Pi.DLG_START_OTHER_RACE_MSG,buttons:{OK:{cb:function cb(){if(r.existsInWorld()){_s("race_start")
r.triggerParticleSystemList("press")
jn(r)}},in_event_cb:a},Cancel:{cb:se,in_event_cb:a}}})}}}
var U_=((i={})[rt]=true,i[tt]=true,i)
Prop.prototype.buzzerStartPropertyEdit=function(){eo(this,{fields:[{key:"buzzer_id",label:Pi.LBL_COURSE_NAME,msg:Pi.DLG_COURSE_START_NAME_MSG,max_len:30,profanity_lock:true,allow_clear:true}],direct:true})}
var G_=1.5
var F_=function(n){_inheritsLoose(BuzzerGoalFloater,n)
function BuzzerGoalFloater(e,t,r){var a
var i=new _i({style:L.style(Yo[r],{glow_outer:4,glow_color:255}),text:Pi.$(Pi.FORMAT_BUZZER_SCORE,ne(t),e)})
var o=new li({w:G_,h:G_,sprite:an.sprite,color:Uo[r],sprite_params:{frame:an.TROPHY}});(a=n.call(this,{text:{floater:i,rel_pos:{x:o.w+.2,y:o.h/2-i.h/2,z:0}},icon:{floater:o,rel_pos:{x:0,y:0,z:0}}})||this).name=e
a.time=t
a.rank=r
return a}var e=BuzzerGoalFloater.prototype
e.setName=function setName(e){if(e!==this.name){this.fp_pairs.text.floater.setText(Pi.$(Pi.FORMAT_BUZZER_SCORE,ne(this.time),e))
n.prototype.updateSize.call(this)}}
e.setRank=function setRank(e){this.fp_pairs.text.floater.setStyle(L.style(Yo[e],{glow_outer:4,glow_color:255}))
this.fp_pairs.icon.floater.sprite_params.color=Uo[e]}
return BuzzerGoalFloater}(ai)
var W_="buzzergoal_blank"
var H_="buzzergoal_ready"
var z_="buzzergoal_racing"
Prop.prototype.buzzerGoalUpdateRuntimeBehaviour=function(){var e=this.baked.key
var t=this.emit
var r
if(!this.buzzer_id)r=W_
else{r=H_
if(!sn()){var a=fn("race_data")||{}
if(a.start&&a.id===Ir(this.buzzer_id))r=z_}}if(r!==e){I(r)
this.baked.key=r
this.emit=Fr(this.baked.key)
this.stateChanged(e,true,t)}}
var V_=3
var Y_=6
Prop.prototype.buzzerGoalDraw=function(e){if(void 0===this.exists_in_world)this.exists_in_world=this.existsInWorld()
if(this.exists_in_world){this.updateRuntimeBehaviour()
if(!w.defines.NOUI){this.getLocalPos(this.floater_pos)
if(Le(El.pos,this.floater_pos)<=P_*P_){var t=!sn()&&fn("race_data")
if(!t||t.id===this.buzzer_id){ve(this.floater_pos,this.floater_pos,this.size,.5)
this.floater_pos[2]+=this.size[2]
var r=[]
if(this.score_table!==[]){var a=0
var i=-1
for(var o=0;o<ms(this.score_table.length,Y_);o++){if(this.score_table[o].time>i){i=this.score_table[o].time
if((a=o+1)>V_)break}if(!this.score_table[o].floater)this.score_table[o].floater=new F_(this.score_table[o].user_id,this.score_table[o].time,a)
else if(this.score_table[o].floater.rank!==a)this.score_table[o].floater.setRank(a)
var n=this.score_table[o].user_id
var s=pn(n).display_name||n
this.score_table[o].floater.setName(s)
r.unshift({floater:this.score_table[o].floater,max_dist:P_,fade_dist:B_,draw_in_photos:F.show_names_photos})}}if(this.buzzer_id){if(!this.id_floater)this.id_floater=new C_(Pi.addColon(Pi.LBL_COURSE_FINISH),this.buzzer_id)
r.push({floater:this.id_floater,max_dist:P_,fade_dist:B_,draw_in_photos:F.show_names_photos})}ui(r,this.floater_pos,.125)}}}if(this.baked.key===z_)return this.particleSystemRun(e)
else this.detachParticleSystems(e)}return null}
Prop.prototype.buzzerGoalInteractable=function(){if(this.interact_locked)return null
if(this.buzzer_id){if((fn("race_data")||{}).id===Ir(this.buzzer_id))return null}else if(!_n())return null
return ol}
Prop.prototype.buzzerGoalInteract=function(){if(!this.buzzer_id){Do.get("buzzid").setMessage(Pi.STATUSMSG_ASSIGN_FLAG_NAME)
return}var e=N.subs.logged_in_username
no(this,e)}
Prop.prototype.buzzerGoalCollisionInteract=function(e,t){var r=fn("race_data")||{}
var a=Date.now()-t
if(r.start<a&&this.buzzer_id&&r.id===Ir(this.buzzer_id)&&!this.property_edit_locked){var i=N.subs.logged_in_username
var o={user_id:i,time:a-r.start}
var n=this
this.triggerParticleSystemList("fireworks")
_s("race_end")
Y.modalDialog({title:Pi.DLG_SUBMITTING_SCORE_TITLE,text:Pi.MSG_PLEASE_WAIT})
Kn(this,o,function(){if(mn.chunk_map[n.chunk_id])no(n,i,o)})}}
function isSpotlitBuzzer(e){var t=ls()
return t&&e.buzzer_id&&Ir(e.buzzer_id)===Ir(t.d)&&e.chunk_id===t.c&&e.pos_idx===t.p}Prop.prototype.buzzerGoalPropertyEdit=function(){if(isSpotlitBuzzer(this)){Do.get("buzz_no_edit").setMessage(Pi.STATUSMSG_REMOVE_SPOTLIGHT_TO_EDIT)
return}eo(this,{fields:[{key:"buzzer_id",label:Pi.LBL_COURSE_NAME,msg:Pi.DLG_COURSE_GOAL_NAME_MSG,confirm_msg:this.buzzer_id?Pi.DLG_CHANGING_NAME_WILL_RESET_MSG:null,max_len:30,profanity_lock:true,allow_clear:true,on_change:function on_change(e){e.score_table=[]}}],direct:true})}
Prop.prototype.toItem=function(){return Ni({type:mr,id:this.item_id,attr1:this.attr1,attr2:this.attr2,attr3:this.attr3})}
Prop.prototype.plantToItem=function(){var e=Ni({type:mr,id:this.item_id,attr1:this.attr1,attr2:this.attr2,attr3:mapToSeedFromFlowerType(this.attr3)})
if(!e.attr3)e.placeable=false
return e}
Prop.prototype.reloadContents=function(e){if(e){I(Array.isArray(e))
this.contents=e.map(xi)}else this.contents=[]}
Prop.prototype.addToBagFromLocalLastPayCost=function(e,t){this.getLocalPos(Al)
var r=this.local_last_pay_cost
var a=[]
for(var i=0;i<r.length;++i){var o=r[i]
I(o.delta<0)
I(o.item)
var n=Ni(o.item)
n.count=-o.delta
a.push(n)}Oa(e,Al,{cost:a},false,t)}
Prop.prototype.onDigBase=function(e,t,r){this.getLocalPos(Al)
kn(e,this,!r,r)
if(this.inv.mineable)if(this.local_last_pay_cost)this.addToBagFromLocalLastPayCost(e,r)
else Oa(e,Al,this.toItem(),false,r)
else I(false)}
Prop.prototype.onDig=Prop.prototype.onDigBase
Prop.prototype.digIfInBounds=function(e,t,r){if(!this.inEditBounds(p))return
if(!es())return
this.onDig(e,null,r)}
Prop.prototype.flowThrough=function(){switch(this.inv.on_flow){case"block":return false
case"dig":return!es()
case"through":return true
default:I(false)}return false}
Prop.prototype.flowDestroys=function(){switch(this.inv.on_flow){case"block":return false
case"dig":return es()
case"through":return false
default:I(false)}return false}
var j_=Be()
Prop.prototype.bagPickup=function(){if(Si(mi)||Si(pi))return false
var e=false
var t=false
var r=false
var a=true
var i
var o=[]
for(var n=0;n<this.contents.length;++n){var s=this.contents[n]
if(!s)continue
t=true
var l=s.count
var _=void 0
var c=Ti(s)
var u=0
if(-1!==c){i=i||Gi()
wi(i,pi,s,c)
u=l}else if(_=Ei(mi,s,l)){i=i||Gi()
for(var d=0;d<_.length;){var f=_[d++]
var v=_[d++]
wi(i,mi,s,f,false,v)
u+=v}}if(u){Li(i,this,n,u)
i.silent_error=true
o.push(s)
e=true}if(u!==l){a=false
if(s.heavy&&Ai()){if(!r)Do.get("iheavy").setMessage(Pi.MSG_PLAYER_CARRYING_HEAVY).fade()
r=true}}}if(!e&&t){Do.get("ifull").setMessage(Pi.MSG_INVENTORY_FULL).fade()
return false}this.no_pickup_counter=1e3
if(o.length){I(i)
this.getLocalPos(j_)
Bn(i,{style:wr,src_type:Rr,src:j_,target_type:Or,items:o,from_center:false,pred:true})}if(a){I(Ne(this.size,fe))
var h=mn.chunk_map[this.chunk_id]
I(h&&h.did_gen)
if(h.get(this.pos,false)===jo.PROP_BASE)h.set(this.pos,0,false)
h.setProp(this.pos,null)}return true}
var K_=.75
var q_=.35
var Z_=[Be(-.5,-.5,0),Be(-1,-.6,-.02),Be(-.25,-.75,-.04)]
var X_=.35*(.25*Ss(2)/2*K_)
function bagSoloDraw(e,t,r,a,i){var o=Da()
b(o,q_,e,t)
S(o,o,Z_[a])
drawBlock(o,r,i,1,false)}function drawBagSet(e,t,r){var a=t.contents
var i=t.quat
if(1===a.length&&a[0]&&a[0].type===pr)bagSoloDraw(i,e,a[0].id,0,t.draw_opts)
else propModel(fl).draw(e,i,X_,t.draw_opts)}function itemDebug(e){return e?e.type+":"+e.id+"("+e.count+")":"null"}function bagDraw(e,t,r){I(t.contents&&t.contents.length)
var a={}
var i=[]
var o=false
var n=0
for(var s=0;s<t.contents.length;++s){var l=t.contents[s]
if(!l)continue
var _=l.id
if(l.type!==pr)if(l.preview_block_id)_=l.preview_block_id
else{o=true
break}if(!a[_]){a[_]=0
i.push(_)}a[_]+=l.count
n+=l.count}var c=0
if(o){drawBagSet(e,t,r);++c}else if(n){I(i.length)
var u=ms(n,3)
var d=0
var f=n/u
for(var v=0;v<i.length;++v){var h=i[v]
if(a[h]>=f){while(a[h]>=f){a[h]-=f
bagSoloDraw(t.quat,e,h,d,t.draw_opts);++c;++d}a[h]=0}}for(var p=0;d<u&&p<i.length;++p){var m=i[p]
if(a[m]){bagSoloDraw(t.quat,e,m,d,t.draw_opts);++c;++d}}}return c}Prop.prototype.bagDraw=function(e){if(this.done)return 0
var t=Oi(this.contents,this.chunk_id,this.pos_idx,this.quat)
if(t.length)return bagDraw(e,{contents:t,quat:this.quat,draw_opts:this.draw_opts})
return 0}
function bagCalcDrawOffs(e,t){Ls.reseed(e)
t[0]=.5+.25*(Ls.random()-.5)
t[1]=.5+.25*(Ls.random()-.5)
return ks+Ls.random()*Us}Prop.prototype.bagUpdatePos=function(){this.rot_speed=bagCalcDrawOffs(this.pos_idx,this.draw_offs)}
var Q_=Be()
Prop.prototype.bagUpdateState=function(){var e=this
if(this.done||Si(this)||this.trans_busy||!this.inEditBounds(h)||tooManyTransactions())return
var t=w.frame_dt
this.expire_counter-=t
if(this.expire_counter<=0){var r=Gi()
if(this.expiring_soon){this.done=true
kn(r,this,false,true)
r.onComplete(function(){e.done=false})}else{this.expiring_soon=true
this.expire_counter=Ds
Un(r,this)}return}this.drop_counter-=t
if(this.drop_counter<=0){this.drop_counter=Ps
this.getLocalPos(Al)
we(Q_,Al)
Q_[2]--
if(xa(Q_)){var a=Gi()
var i=Ii(this.contents)
I(i.length)
Is.bagAddTrans(a,{src_pos:Al,target_pos:Q_,bag_to_ignore:this,items:i,max_search:Bs,from_center:false,is_update_func:true})
kn(a,this,false,true)
a.silent_error=true
this.trans_busy=true
a.onComplete(function(){e.trans_busy=false})}}}
Prop.prototype.bagTick=function(){var e=w.frame_dt
I(this.pos)
if(this.done)return
D(this.quat,this.quat,e*this.rot_speed)
this.drop_vel=ps(_,this.drop_vel+e*l)
this.draw_offs[2]+=this.drop_vel*e
if(this.draw_offs[2]<0){this.draw_offs[2]=0
this.drop_vel=0}if(!this.draw_offs[2]&&this.expiring_soon){this.hop_time-=e
if(this.hop_time<=0){this.hop_time=Gs+gs()*Fs
this.drop_vel=.0025}}if(w.defines.BAG){if(!this.content_floater){this.content_floater=new _i
this.floater_pos=Be()}this.getLocalPos(this.floater_pos)
this.content_floater.setText(this.contents.map(itemDebug).join(",")+"; v:"+this.version)
ci({floater:this.content_floater},this.floater_pos,oi)}if(Si(mi)||Si(pi)||Si(this)||this.trans_busy||hn()||!this.inEditBounds(h))return
if(this.no_pickup_counter){this.no_pickup_counter-=e
if(this.no_pickup_counter<=0)this.no_pickup_counter=0}this.getLocalPos(Al)
Ie(l_,Al,ue)
var t=Le(El.center_pos,l_)
if(this.no_pickup_counter){if(t>=xs)this.no_pickup_counter=0}else if(t<=Cs)if(this.bagPickup())return}
var $_=Be()
Prop.prototype.bagVacate=function(e,t,r){var a=Infinity
var i=1
for(var o=1;;o++){for(var n=-o;n<=o;++n){var s=n===-o||n===o
Al[0]=t[0]+n
var l=n*n
for(var _=-o;_<=o;++_){var c=s||_===-o||_===o
Al[1]=t[1]+_
var u=l+_*_
for(var d=-o;d<=o;d+=c?1:2*o){Al[2]=t[2]+d
if(xa(Al)){var f=u+d*d
Al[2]--
var v=false
if(f===a){++i
if(gs()<1/i)v=true}if(f<a||v){Al[2]++
a=f
we($_,Al)
if(!v)i=1}}}}}if(a<o*o)break
I(o<100)}var h=Ii(this.contents)
Is.bagAddTrans(e,{src_pos:t,target_pos:$_,bag_to_ignore:this,items:h,from_center:false,is_update_func:true})
if(!r)kn(e,this,false,true)}
var J_=Be()
Prop.prototype.instantiateHarvest=function(e){if(void 0!==this.stage){if(this.harvestableIsEarlyPickable()&&e.pickable_early)e.count=1+this.stage-this.inv.harvest_pickable_stage
if(this.stage>this.growth_max_stage)e=_extends({},Tl[0])}if(e.min&&e.max)e.count=e.min+hs(gs()*(e.max-e.min+1))
if(e.drop_chance)e.count=gs()<e.drop_chance?e.count||1:0
if(!e.count)return null
if(e.keep_attr1)e.attr1=this.attr1
if(e.keep_attr3)e.attr3=this.attr3
return Ni(e)}
Prop.prototype.harvestableOnDig=function(e,t,r){var a=this
e=e||Gi()
if(this.harvestableIsPickable()){if(!this.interact(e,t))kn(e,this,!r,r)}else{if(t)_s(this.inv.harvest_empty_sound)
if(-1!==this.inv.harvest_reverting_stage&&this.stage>=this.inv.harvest_reverting_stage)kn(e,this,!r,r)
else this.onDigBase(e,t,r)}this.interact_locked=true
e.onComplete(function(){a.interact_locked=false})
e.silent_error=true}
Prop.prototype.multiHarvestableAddHarvestToBag=function(e,t){var r=this.instantiateHarvest(e)
if(r){var a=randomFromArray(this.harvest_drop_options)
we(c_,Al)
if(this.size[2]>1)c_[2]+=hs(this.size[2]/2)
Is.bagAddTrans(t,{target_pos:a,item:r,src_pos:c_,emptied_pos:a})}}
Prop.prototype.plantAddHarvestToBag=function(e,t){if(e.id===Vt){e.attr3=mapToSeedFromFlowerType(this.attr3)
if(e.attr3)this.singleHarvestableAddHarvestToBag(e,t)}else this.singleHarvestableAddHarvestToBag(e,t)}
Prop.prototype.singleHarvestableAddHarvestToBag=function(e,t){var r=this.instantiateHarvest(e)
if(r){this.getLocalPos(J_)
if(this.size[2]>1)J_[2]+=hs(this.size[2]/2)
Is.bagAddTrans(t,{item:r,emptied_pos:J_,target_pos:J_,src_pos:J_,auto_pickup:true,from_center:true})}}
Prop.prototype.singleHarvestableInteract=function(e){var t=this
e=e||Gi()
kn(e,this,true,false)
_s(this.inv.harvest_full_sound)
processHarvestResults(this,e)
this.interact_locked=true
e.onComplete(function(){t.interact_locked=false})
return true}
var ec=1.6
Prop.prototype.aquaticGetGrowthRate=function(){Rn(this)
var e=this.draw_opts.sun_factor||0
var t=this.draw_opts.torch_factor||0
return Ss(e)+ec*Ss(t)}
Prop.prototype.nocturneAquaticGetGrowthRate=function(){Rn(this)
var e=ps(0,.9-(this.draw_opts.sun_factor||0))
var t=this.draw_opts.torch_factor||0
return Ss(e)+ec*Ss(t)}
Prop.prototype.coralTubesUpdateRuntimeBehaviour=function(){this.toggleBehaviour("collisionInteract",this.stage>=this.growth_max_stage)
this.toggleBehaviour("draw",this.stage>=this.growth_max_stage)
this.growableUpdateRuntimeBehaviour()}
Prop.prototype.coralTubesCollisionInteract=function(e,t){if(e)_s("underwater_breathe_air")
El.underwater.head=false}
var tc=[1,.67,.33]
Prop.prototype.algaeAreaInteract=function(){var e=Nt[this.item_id]
var t=El.getSpeedModifier(e)||tc[0]
El.setSpeedModifier(e,ms(t,tc[this.stage]))}
Prop.prototype.slowDownAreaInteract=function(){El.setSpeedModifier("slow",.67)}
Prop.prototype.cactusUpdateRuntimeBehaviour=function(){this.toggleBehaviour("collisionInteract",this.stage>0)
this.growableUpdateRuntimeBehaviour()}
var rc=Pe()
var ac=Pe()
var ic=Pe()
function calculateReflectedOnCircleVector(e,t,r){he(rc,e)
Se(ac,r,t)
ge(rc,rc)
ge(ac,ac)
var a=me(rc,ac)
ic[0]=rc[0]-2*a*ac[0]
ic[1]=rc[1]-2*a*ac[1]
ye(ic,ic,Ee(e))
return ic}var oc=Be()
var nc=.2
Prop.prototype.damageCollisionInteract=function(e,t){if(El.invulnerability_timer)return
this.getLocalPos(oc)
ve(oc,oc,this.size,.5)
var r=pe(El.center_pos,oc)
if((r-=ka-nc)>this.size[0]/2)return
var a=calculateReflectedOnCircleVector(El.vel,El.center_pos,oc)
if(Te(a,El.vel))Se(a,El.center_pos,oc)
ge(a,a)
ye(a,a,e.vel_h)
El.damage={stun_time:e.stun_time,invulnerability_time:e.invulnerability_time,amount:e.amount,sound:e.sound,knockback_vel:Be(a[0],a[1],e.vel_v),knockback_absolute:true,message:t}}
var sc={vel_h:.0175,vel_v:.0025,stun_time:350,invulnerability_time:500,amount:500,sound:"cactus_damage"}
Prop.prototype.cactusCollisionInteract=function(e,t){this.damageCollisionInteract(sc,Pi.$(Pi.STATUSMSG_CACTUS_DAMAGE,bi[this.item_id]))}
var lc={vel_h:.0175,vel_v:.0075,stun_time:350,invulnerability_time:500,amount:500,sound:"spike_damage"}
Prop.prototype.grassSpikyCollisionInteract=function(e,t){this.damageCollisionInteract(lc,Pi.$(Pi.STATUSMSG_SPIKE_DAMAGE,bi[this.item_id]))}
Prop.prototype.torchInteractable=function(){if(is())return ol
return null}
Prop.prototype.torchInteract=function(e,t){e=e||Gi()
if(t){ds(us.Broken)
Ma("block_break",this.inv.getMaterial())}this.onDig(e,t,false)}
var _c=Be()
Prop.prototype.perchedNeighborChanged=function(e,t){this.getLocalPos(J_);--J_[2]
var r
if(t[2]===J_[2]&&t[0]>=J_[0]&&t[0]<J_[0]+this.size[0]&&t[1]>=J_[1]&&t[1]<J_[1]+this.size[1])r=0
else{_c[2]=J_[2]
e:for(var a=0;a<this.size[0];++a){_c[0]=J_[0]+a
for(var i=0;i<this.size[1];++i){_c[1]=J_[1]+i
if((r=Nn(_c,1,false))>=Zo&&r<=Xo)r=0
if(!r)break e}}}if(!r)this.onDig(e,null,false)}
Prop.prototype.blueboxCalcBounds=function(){var o=Be()
var n=Be()
var s=Be()
var l=Be()
return function blueboxCalcBounds(){var e=this.blueprint_def,t=this.rot
if(!e.loaded)return null
var r
var a
if(this.bluebox_state===fa){r=this.bluebox_origin_offset
a=this.bluebox_size}else{r=e.origin_offset
a=e.size}I(r&&a)
var i=(this.flipped?T:E)[t]
xn(n,this.chunk_id,this.pos)
o[0]=n[0]+r[0]*i[0]+r[1]*i[1]
o[1]=n[1]+r[0]*i[2]+r[1]*i[3]
o[2]=n[2]+r[2]
Ce(s,a[0]*i[0]+a[1]*i[1],a[0]*i[2]+a[1]*i[3],a[2])
if(s[0]<0){l[0]=o[0]
o[0]=o[0]+s[0]+1}else l[0]=o[0]+s[0]-1
if(s[1]<0){l[1]=o[1]
o[1]=o[1]+s[1]+1}else l[1]=o[1]+s[1]-1
l[2]=o[2]+s[2]-1
if(this.bounded_origin){we(this.bounded_origin,o)
Re(xe(this.bounded_size,l,o),fe)
Ie(this.bounded_inv_origin,l,fe)}else{this.bounded_origin=o.slice(0)
this.bounded_size=Re(be(l.slice(0),o),fe)
this.bounded_inv_origin=Re(l.slice(0),fe)}return this}}()
Prop.prototype.blueboxUpdatePos=function(){var t=Be()
var r=3
return function blueboxUpdatePos(){I(!this.removed)
if(this.is_preview||null===this.chunk_id)return
if(!(this.bluebox_state===pa||this.bluebox_state===fa)){if(this.bluebox_in_list_edit){Qr(this)
this.bluebox_in_list_edit=false}return}var e=this.blueprint_def
if(!e.loaded){e.onLoad(this.blueboxUpdatePosDelayed.bind(this))
return}if(!this.added_to_blueprint_def){this.added_to_blueprint_def=true
e.addProp(this)}this.blueboxCalcBounds()
this.bluebox_bounds_sort_bias=r+fs(t[2])/2
if(!this.bluebox_in_list_edit){Xr(this)
this.bluebox_in_list_edit=true}else $r(this)}}()
Prop.prototype.blueboxUpdatePosDelayed=function(){if(this.removed)return
this.blueboxUpdatePos()}
Prop.prototype.blueboxOnRemove=function(){if(this.bluebox_in_list_edit){Qr(this)
this.bluebox_in_list_edit=false}if(this.added_to_blueprint_def){this.blueprint_def.removeProp(this)
this.added_to_blueprint_def=false}}
Prop.prototype.blueboxUpdateRuntimeBehaviour=function(){var e=this.baked.key
switch(this.bluebox_state){case ma:this.updateState=this.blueboxUpdateState
this.baked.key="bluebox-pre-edit"
break
case va:case ha:this.updateState=null
this.baked.key="bluebox-paused"
break
case da:this.updateState=this.blueboxUpdateState
this.baked.key="bluebox-build"
break
case pa:this.updateState=null
this.baked.key="bluebox-pre-edit"
break
case fa:this.updateState=null
this.baked.key="bluebox-edit"
break
default:this.baked.key="bluebox-pre-edit"}if(!this.is_preview&&null!==this.chunk_id){Mn(this)
if(this.baked.key!==e){var t=mn.chunk_map[this.chunk_id];++t.ver_props
t.dirty()}this.blueboxUpdatePos()}}
Prop.prototype.blueboxUpdatePreview=function(){var e=this.blueprint_def
if(e.isEmptyEditable()){var t=e.origin_offset
var r=e.size
if(_a()){r=ra.capture_preview_size
t=ra.capture_preview_origin_offset}I(r)
if(this.bluebox_state!==fa||!Ne(this.bluebox_size,r)){this.bluebox_origin_offset=le(t)
this.bluebox_size=le(r)
this.bluebox_ver=e.ver
this.bluebox_state=fa
this.updateRuntimeBehaviour()}}else if(this.bluebox_state===fa){this.bluebox_origin_offset=this.bluebox_size=null
this.bluebox_ver=null
this.bluebox_state=da
this.updateRuntimeBehaviour()}}
Prop.prototype.blueboxAfterPlace=function(){na(this.interactDetails(),true)}
Prop.prototype.blueboxUpdateBeforePlace=function(e,t){this.blueboxUpdatePreview()
this.setLocalPos(e)
oa(t,this)}
Prop.prototype.blueboxInteractable=function(){return hn()?null:ll}
Prop.prototype.blueboxOpenUI=function(){Fi(Vi.BLUEBOX,this.interactDetails())}
Prop.prototype.blueboxInteract=function(){sa(this)}
Prop.prototype.blueboxOnDig=function(e,t,r){if(this.bluebox_state===da){this.blueboxChangeState(e,ma)
return}var a=(this.contents||[]).filter(Di)
e=e||Gi()
this.getLocalPos(Al)
kn(e,this,!r,r)
if(a.length&&is())Oa(e,Al,{cost:a},false,true)}
Prop.prototype.transBusy=function(e){var t=this
if(this.trans_busy)return
this.trans_busy=true
e.onComplete(function(){t.trans_busy=false})}
Prop.prototype.blueboxChangeState=function(e,t,r){var a=t===da?Bi.walltime_seconds:0
this.bluebox_last_update_local=a
var i=this.blueprint_def
var o
var n
var s=null
if(t===fa){o=le(i.origin_offset)
n=le(i.size)
s=i.ver}else o=n=null
if(r){this.bluebox_origin_offset=o
this.bluebox_size=n
this.bluebox_ver=s
this.bluebox_state=t
this.bluebox_last_update=a
if(t===da){var l={}
var _=this.blueprint_def&&this.blueprint_def.chunk_map
for(var c in _){var u=_[c].props
for(var d in u){var f=u[d]
if(gr(f.inv))l[Fe(f.item_id,f.attr1,f.attr2,f.attr3)]=1}}if(Object.keys(l).length>0)this.bluebox_req_permissions=l}}else{e=e||Gi()
Gn(e,this,"bo","bluebox_origin_offset",o)
Gn(e,this,"bs","bluebox_size",n)
Gn(e,this,"bv","bluebox_ver",s)
Gn(e,this,"s","bluebox_state",t)
Gn(e,this,"lu","bluebox_last_update",a)
e.bluebox_no_last_update=true
this.updateRuntimeBehaviour()
this.transBusy(e)}}
Prop.prototype.blueboxUpdateState=function(){if(Si(this)||this.trans_busy)return
if(!tl.query(this))return
if(rl){tl.stillWorking(this)
return}this.blueprint_def.lazyLoad()
if(!this.blueprint_def.loaded){tl.noNeed(this)
return}var e=Rs/F.blueprint_rate
if(this.bluebox_state===ma)e=1
var t=Bi.walltime_seconds-this.bluebox_last_update_local
if(t<e){tl.noNeed(this)
return}var r=hs(t/e)
var a=this.bluebox_last_update_local+r*e
this.bluebox_last_update_local=a
this.bluebox_total_ticks+=r
var i=la(this,r)
if(i){rl=true
i.opBlueboxInfo(this.chunk_id,this.pos_idx)
if(!i.bluebox_no_last_update)Gn(i,this,"lu","bluebox_last_update",a)
this.transBusy(i)}}
Prop.prototype.getLocalPos=function(e){if(!e){if(!this.local_pos_temp)this.local_pos_temp=Be()
e=this.local_pos_temp}Ln(e,this.chunk_id,this.pos)
return e}
var cc=Be()
var uc=Be()
Prop.prototype.saplingInEditBounds=function(e,t){profilerStart("saplingInEditBounds")
var r=e.size,a=e.offset
var i=this.getLocalPos()
var o=Fa(i)
var n
if(t)n=Ha
else n=ca.bind(null,o,Fa)
i=Ie(cc,i,Pl)
Re(i,a)
for(var s=0;;){uc[2]=i[2]+s
for(var l=0;;){uc[1]=i[1]+l
for(var _=0;;){uc[0]=i[0]+_
if(!n(uc)){profilerStop("saplingInEditBounds")
return false}if(_===r[0]-1)break
_=ms(_+c,r[0]-1)}if(l===r[1]-1)break
l=ms(l+c,r[1]-1)}if(s===r[2]-1)break
s=ms(s+c,r[2]-1)}profilerStop("saplingInEditBounds")
return true}
Prop.prototype.inEditBounds=function(e){var t=this.getLocalPos()
if(e===h)return Wa(t)
var r
if(e===p)r=this.size
else if(e===m){r=this.max_size
if(!this.max_size){r=this.max_size=this.size.slice(0)
if(this.inv.growth_heights)for(var a=0;a<this.inv.growth_heights.length;++a)r[2]=ps(r[2],this.inv.growth_heights[a])}}else I(false)
for(var i=0;i<r[2];i+=ps(r[2]-1,1)){uc[2]=t[2]+i
for(var o=0;o<r[1];o+=ps(r[1]-1,1)){uc[1]=t[1]+o
for(var n=0;n<r[0];n+=ps(r[0]-1,1)){uc[0]=t[0]+n
if(!Wa(uc))return false}}}return true}
Prop.prototype.existsInWorld=function(){return this===On(this.chunk_id,this.pos)}
Prop.prototype.getMaterial=function(){return this.inv.getMaterial(false)||Sr.DIRT}
Prop.prototype.getMaterialClass=function(){var e=this.inv.getMaterialClass()
if(!_e(e!==zi.NONE))e=zi.DIRT
return e}
var dc={chunk_id:1,pos_idx:1,draw_opts:1,harvest_results:1,growth_max_stage:1,growth_start:1,door_left_quat:1,door_right_quat:1,door_offs:1,door_pos:1,quat:1,mat:1,last_size:1,bid:1,gem_quat:1,gem_pos:1,gem_mat:1,gem_offs:1,local_pos_temp:1,blueprint_def:1,box_ctx:1,particle_systems:1,inv:1,vd_current:1,vd_next:1,roundrobinable_next:1,factory_estimator:1,progress_floater:1}
r.PROP_DEBUG_SKIP=dc
function deserializeContents(e,t){e.contents=(t.d||[]).map(xi)}function serializeContents(e,t){e.d=t.contents||[]}Prop.prototype.toJSON=function(){var e={id:this.item_id}
if(yl[this.item_id])serializeContents(e,this)
if(this.isFactory()){e.fr=this.factory_recipe||void 0
e.fs=this.factory_state||void 0
e.ft=this.factory_time||void 0}if(this.growth_max_stage)e.gt=hs(24*this.growth_start)
switch(this.item_id){case Xe:e.s=this.bluebox_state
if(this.bluebox_state!==da)I(!this.bluebox_last_update)
e.lu=this.bluebox_last_update
if(this.bluebox_state!==fa)I(!this.bluebox_origin_offset)
e.bo=this.bluebox_origin_offset||void 0
e.bs=this.bluebox_size||void 0
e.bv=this.bluebox_ver||void 0
e.br=this.bluebox_req_permissions||void 0
e.bun=this.bluebox_unlimited?1:0
break
case jt:e.sa=this.age
e.ss=this.state
e.sd=this.seed
e.sga=this.sapling_growing_age||void 0
e.sg=vs(24*this.sapling_last_growth)
e.sf=this.sapling_growth_failures||void 0
e.so=this.sapling_origin_offset||void 0
e.ssz=this.sapling_size||void 0
break
case Ke:case je:case qe:case Vt:case Xt:case Jt:case qt:case Qt:case er:case $t:if(void 0!==this.harvest_left)e.l=this.harvest_left
e.d=this.stage|(this.watered?8:0)
break
case at:case it:case Zt:case ze:case vt:e.d=this.stage
break
case fr:e.d=this.stage
e.gt=hs(24*this.depletion_time)
break
case Ye:if(this.expiring_soon)e.es=1
break
case pt:case mt:case Et:case ht:case gt:e.d=this.open
break
case rr:case ar:case ir:case or:case nr:case sr:e.d=this.sign_text
break
case vr:e.d=this.waygate_targets
if(this.exitway_access)e.ea=this.exitway_access
if(this.exitway_random)e.er=this.exitway_random
if(this.gate_time)e.wgt=this.gate_time
break
case Pt:e.lm=this.stage
e.lc=this.leapgate_cost
e.lp=this.leapgate_progress
e.ld=this.leapgate_deposits
e.le=this.leapgate_extracts
e.ldc=this.leapgate_destination_chunk_id
e.ldp=this.leapgate_destination_pos_idx
e.ldr=this.leapgate_destination_rot
if(this.leapgate_access)e.la=this.leapgate_access
if(this.gate_time)e.wgt=this.gate_time
break
case wt:e.d=this.gem_id
break
case rt:e.d=this.buzzer_id
break
case tt:e.d=this.buzzer_id
e.ms=this.max_scores
e.st=[]
for(var t=0;t<this.score_table.length;t++)e.st.push({user_id:this.score_table[t].user_id,time:this.score_table[t].time})
break
case Ze:I(false)}if(1!==this.size[0])e.sx=this.size[0]
if(1!==this.size[1])e.sy=this.size[1]
if(1!==this.size[2])e.sz=this.size[2]
if(this.rot)e.rot=this.rot
if(this.flipped)e.f=1
if(this.attr1)e.a1=this.attr1
if(this.attr2)e.a2=this.attr2
if(this.attr3)e.a3=this.attr3
if(this.fallback)e.fb=this.fallback
if(this.proc_genned)e.pg=1
if(Bi.omp&&this.version>1)e.v=this.version
return e}
Prop.prototype.drawBaked=function(e){Vr(this,e)}
function filterTilled(e){return e===Qo||e===$o}filterTilled.label=Pi.LBL_GROUND_TILLED
function filterDirt(e){if(tn[e])return tn[e].mat===Sr.DIRT
return false}filterDirt.label=Pi.LBL_GROUND_DIRT
function filterTangible(e){return e<qo}filterTangible.label=Pi.LBL_GROUND_TANGIBLE
function filterSeafloor(e){if(tn[e])return tn[e].mat===Sr.DIRT||tn[e].mat===Sr.SAND||tn[e].mat===Sr.CORAL
return false}filterSeafloor.label=Pi.LBL_GROUND_SEAFLOOR
function filterSand(e){if(tn[e])return tn[e].mat===Sr.SAND
return false}filterSand.label=Pi.LBL_GROUND_SAND
var fc={dirt:filterDirt,tilled:filterTilled,sea_floor:filterSeafloor,sand:filterSand}
Prop.prototype.interactableWaterableWrapper=function(){var e
if(this.inv.is_waterable)e=this.waterableInteractable()
if(!e)e=this.mainInteractable()
return e}
var vc=100
var hc=200
Prop.prototype.interactWaterableWrapper=function(e,t){if(this.inv.is_waterable&&this.waterableInteractable()){if(!Ra(Pi.STATUSMSG_EXHAUSTED_TO_USE_BUCKET))return false
if(!(e=ao(e)))return false
if(Ca())vn(e,-Ts(vc*un()))
return this.waterableInteract(e)}else return this.mainInteract(e,t)}
Prop.prototype.growstickChat=function(e){var t
var r=5
do{if(this.inv.growstick_chat_extra_chance&&gs()<this.inv.growstick_chat_extra_chance)t=randomFromArray(this.inv.growstick_chat_extra)
else t=randomFromArray(this.inv.growstick_chat);--r}while(r&&t===this.last_growstick_chat)
this.last_growstick_chat=t
this.chatAddTrans(e,"grow",t)}
Prop.prototype.plantGrowstickInteract=function(e){var t=this.inv.growth_heights.length-1
I(1===t)
e=e||Gi()
if(0===this.stage)this.setStage(1)
else{var r=mapToSeedFromFlowerType(this.attr3)
var a=al[r].key
I(a&&a.length)
var i=a.indexOf(this.attr3)
I(-1!==i)
var o=(i+1)%a.length
this.attr3=a[o]}this.growstickChat(e)
this.transPropUpdateAndInteractLock(e,true)
this.updateRuntimeBehaviour()
_s("prop_forced_grow")}
Prop.prototype.stageableGrowstickInteract=function(e){var t=this.inv.stage_baked_key.length-1
I(t)
e=e||Gi()
var r=this.watered
var a=this.stage+1
if(a>t)a=0
this.setStage(a)
if(r&&!this.watered){var i=this.stage===t||this.stage>=this.growth_max_stage
if(!rs()&&!i)this.watered=true
else this.cropUnwaterTilledDirt(e)}this.growstickChat(e)
this.transPropUpdateAndInteractLock(e,true)
this.updateRuntimeBehaviour()
_s("prop_forced_grow")}
Prop.prototype.growstickableInteractable=function(){if(this.interact_locked)return false
var e=oo(Ot)
if(Na())e=e&&gi(e)
if(!e)return false
var t=this.inv.growth_heights?this.inv.growth_heights.length-1:this.inv.stage_baked_key.length-1
var r=this.stage===t||this.stage>=this.growth_max_stage
if(r&&rs())return false
if(this.item_id===fr&&rs())return false
if(!this.inEditBounds(m))return _l
if(!r&&this.inv.growth_heights&&!this.growableCheckHeight(this.stage+1))return _l
return dl}
Prop.prototype.interactableGrowstickableWrapper=function(){var e=this.growstickableInteractable()
if(!e)e=this.mainInteractable2()
return e}
var pc=100
Prop.prototype.interactGrowstickableWrapper=function(e,t){if(this.growstickableInteractable()){if(this.growstickableInteractable()===_l)return false
if(!Ra(Pi.STATUSMSG_EXHAUSTED_TO_USE_GROWSTICK))return false
var r=oo(Ot)
I(r)
if(Na()){r=gi(r)
I(r)
if(r.has_hp){e=e||Gi()
ba(e,r,null,pc)}}if(Ca()){var a=hc*r.getStaminaRate()*un()
e=e||Gi()
vn(e,-Ts(a))}Yi(r,false,void 0,t)
return this.growstickInteract(e)}else return this.mainInteract2(e,t)}
Prop.prototype.unreleasedUpdateRuntimeBehaviour=function(){var e=this.baked.key
this.baked.key="plant-1"
this.draw=null
this.stateChanged(e)}
function createFromInv(e,t){I(Ci(e))
e.initBoostedKey()
var r=new Prop(e)
we(r.size,e.size)
if(e.is_preview)r.is_preview=e.is_preview
if(e.snapshot_size)r.snapshot_size=e.snapshot_size
if(e.place_rot_random)r.place_rot=r.rot=hs(4*gs())
else r.place_rot=e.place_rot
if(e.boosted_key)r.applyBoostLevel=r.applyBoostLevelBoosted
var a=r.item_id
switch(a){case Xe:r.bid=r.attr1
I(r.bid||e.blueprint_def)
r.updateRuntimeBehaviour=r.blueboxUpdateRuntimeBehaviour
r.onDig=r.blueboxOnDig
r.interact=r.blueboxInteract
r.interactable=r.blueboxInteractable
r.afterPlace=r.blueboxAfterPlace
r.updatePreview=r.blueboxUpdatePreview
r.updateBeforePlace=r.blueboxUpdateBeforePlace
r.updatePos=r.blueboxUpdatePos
r.onRemove=r.blueboxOnRemove
r.bluebox_state=ha
r.bluebox_last_update_local=0
r.bluebox_last_update=0
r.bluebox_total_ticks=t&&t.bluebox_total_ticks||0
r.bluebox_done_ticks=t&&t.bluebox_done_ticks||0
r.blueprint_def=e.blueprint_def||Ea(r.bid,true)
r.bluebox_origin_offset=null
r.bluebox_size=null
r.bluebox_ver=0
r.bluebox_in_list_edit=false
r.bluebox_unlimited=dn()
r.contents=[]
yl[a]=true
r.container_size=Infinity
r.snapshot_size=Be()
r.snapshot_pos=Be()
break
case lt:case st:r.interact=r.chairInteract
r.interactable=r.chairInteractable
r.read_only_interact=true
break
case rr:case ar:case ir:case or:case nr:case sr:r.interactable=r.signInteractable
r.interact=r.signInteract
r.updateRuntimeBehaviour=r.signUpdateRuntimeBehaviour
r.floater_pos=Be()
r.floater_offset=Be()
r.sign_text=R(Pi.MSG_SIGN_DEFAULT_TEXT)
break
case Xt:case Jt:case qt:case Qt:case er:case $t:r.stageableBakedOverride=r.floraStageableBakedOverride
r.updateBeforePlace=r.floraUpdateBeforePlace
r.updateState=r.floraUpdateState
r.getGrowthRate=r.waterableFloraGetGrowthRate
r.interactable_continuously=true
r.setStage=r.floraSetStage
r.waterableInteractable=r.floraWaterableInteractable
r.waterableInteract=r.floraWaterableInteract
r.watered=false
break
case Ye:r.areaShouldClear=always
r.updateState=r.bagUpdateState
r.updatePos=r.bagUpdatePos
r.tick=r.bagTick
r.vacate=r.bagVacate
r.draw=r.bagDraw
r.contents=[]
yl[a]=true
r.container_size=Infinity
r.destroy_on_empty=true
r.drop_vel=0
r.no_pickup_counter=0
r.expire_counter=Ms
r.expiring_soon=false
r.drop_counter=Ps
r.hop_time=Gs+gs()*Fs
r.rot_speed=ks
r.draw_offs[0]=.5
r.draw_offs[1]=.5
if(t){r.rot_speed=t.rot_speed
we(r.draw_offs,t.draw_offs)}break
case ur:r.interactable=r.torchInteractable
r.interact=r.torchInteract
break
case Vt:if(!mapToSeedFromFlowerType(r.attr3))r.attr3=fi[0]
r.watered=false
r.updateBeforePlace=r.plantUpdateBeforePlace
r.updateRuntimeBehaviour=r.plantUpdateRuntimeBehaviour
r.updateState=r.floraUpdateState
r.getGrowthRate=isMushroomPlant(r.attr3)?r.mushroomGetGrowthRate:r.waterableFloraGetGrowthRate
r.toItem=r.plantToItem
r.waterableInteractable=r.floraWaterableInteractable
r.waterableInteract=r.floraWaterableInteract
r.setStage=r.floraSetStage
r.addHarvestToBag=r.plantAddHarvestToBag
r.growstickInteract=r.plantGrowstickInteract
r.baked={key:"plant-"+r.attr3}
r.rot=0
if(isMushroomPlant(r.attr3))r.harvest_results=[{type:mr,id:Vt,count:1,user_inv_type:1},{type:mr,id:Ut,count:1,user_inv_type:1,attr1:al[r.attr3].attr1}]
else r.harvest_results=gl
break
case Ke:case je:case qe:r.watered=false
r.stageableBakedOverride=r.floraStageableBakedOverride
r.updateBeforePlace=r.floraUpdateBeforePlace
r.updateState=r.floraUpdateState
r.getGrowthRate=r.waterableFloraGetGrowthRate
r.waterableInteractable=r.floraWaterableInteractable
r.waterableInteract=r.floraWaterableInteract
r.setStage=r.floraSetStage
r.rot=0
r.interactable_continuously=true
break
case jt:r.age=0
r.health_check_random_time=Ks*gs()
r.last_health_check=Bi.walltime_seconds
r.last_successful_health_check=0
r.sapling_last_growth=Mo()
r.sapling_growth_failures=0
r.sapling_growing_age=0
r.updateState=r.saplingUpdateState
r.updateRuntimeBehaviour=r.saplingUpdateRuntimeBehaviour
r.updateBeforePlace=r.saplingUpdateBeforePlace
r.updatePos=r.saplingUpdatePos
r.onRemove=r.saplingOnRemove
r.autoSelect=r.saplingAutoSelect
r.mineable=r.saplingMineable
r.onDig=r.saplingOnDig
r.groundFilter=filterDirt
r.state=Vs
r.sapling_origin_offset=null
r.sapling_size=null
break
case Zt:r.checkHeightTileCheck=r.aquaticCheckHeightTileCheck
r.getGrowthRate=r.nocturneAquaticGetGrowthRate
r.rot=0
break
case ze:r.areaInteract=r.algaeAreaInteract
r.checkHeightTileCheck=r.aquaticCheckHeightTileCheck
r.getGrowthRate=r.aquaticGetGrowthRate
r.rot=0
break
case at:case it:r.getGrowthRate=r.floraGetGrowthRate
r.collisionInteract=r.cactusCollisionInteract
r.updateRuntimeBehaviour=r.cactusUpdateRuntimeBehaviour
r.rot=0
break
case Lt:if(!e.fallback)r.collisionInteract=r.grassSpikyCollisionInteract
break
case xt:if(r.attr3&&r.attr3!==Sr.ANY)r.baked={key:zr("bottle-juice-label",{MAT_ANY_INGREDIENT:r.attr1===Sr.ANY?Sr.HOT:r.attr1,MAT_LABEL:r.attr3})}
else if(r.attr1!==Sr.ANY)r.baked={key:Hr("bottle-juice",r.attr1)}
else r.baked={key:Hr("bottle-juice",Sr.RED_BERRY)}
break
case zt:if(r.attr3)r.baked={key:zr("pie",{MAT_ANY_INGREDIENT:r.attr1,MAT_LABEL:r.attr3})}
else if(r.attr1!==Sr.ANY)r.baked={key:Hr("pie",r.attr1)}
else r.baked={key:Hr("pie",Sr.PUMPKIN)}
break
case Yt:if(r.attr3)r.baked={key:zr("sandwich",{MAT_BREAD:r.attr3})}
else r.baked={key:"sandwich"}
break
case vt:r.draw=r.particleSystemRun
r.collisionInteract=r.coralTubesCollisionInteract
r.checkHeightTileCheck=r.aquaticCheckHeightTileCheck
r.getGrowthRate=r.aquaticGetGrowthRate
r.updateRuntimeBehaviour=r.coralTubesUpdateRuntimeBehaviour
break
case fr:r.stageableBakedOverride=r.wateringSystemStageableBakedOverride
r.updateState=r.wateringSystemUpdateState
r.updateRuntimeBehaviour=r.wateringSystemUpdateRuntimeBehaviour
r.waterableInteractable=r.wateringSystemWaterableInteractable
r.waterableInteract=r.wateringSystemWaterableInteract
r.growstickInteract=r.wateringSystemGrowstickInteract
break
case ft:case ut:case _t:case ct:case dt:r.contents=[]
yl[a]=true
switch(a){case ft:r.container_size=2
break
case ut:r.container_size=4
break
case ct:case _t:r.container_size=24
break
case dt:r.container_size=32
break
default:I(0)}r.interact=r.chestInteract
r.interactable=r.alwaysInteractable
r.mineable=r.chestMineable
r.mineWhenBlocked=r.chestMineWhenBlocked
break
case pt:case mt:case Et:case ht:case gt:r.open=0
r.door_left_quat=x()
r.door_right_quat=x()
r.door_pos=Be()
r.door_offs=Be()
r.updateRuntimeBehaviour=r.doorUpdateRuntimeBehaviour
r.draw=r.doorDraw
r.interact=r.doorInteract
r.interactable=r.doorInteractable
r.read_only_interact=true
break
case nt:r.areaInteract=r.slowDownAreaInteract
break
case wt:r.gem_quat=x()
r.gem_pos=Be()
r.gem_mat=de()
r.gem_offs=Be()
r.tick=r.gemTick
r.draw=r.gemDraw
r.updateRuntimeBehaviour=r.gemUpdateRuntimeBehaviour
r.propertyEdit=r.gemPropertyEdit
break
case Ct:r.indicator_quat=x()
r.indicator_pos=Be()
r.indicator_offs=Be()
r.tick=r.indicatorTick
r.draw=r.indicatorDraw
break
case Ze:r.mat=de()
r.draw=r.blockPreviewDraw
break
case He:r.read_only_interact=true
r.interactable=r.accessControlInteractable
r.interact=r.accessControlInteract
r.interactDetails=r.accessControlInteractDetails
break
case vr:r.waygate_targets=null
r.exitway_access=0
r.exitway_random=0
r.gate_time=Pr.DEFAULT
r.mineable=r.waygateMineable
r.mineWhenBlocked=r.waygateMineWhenBlocked
r.interact=r.waygateInteract
r.interactable=r.waygateInteractable
r.afterPlace=r.waygateAfterPlace
r.updateRuntimeBehaviour=r.waygateUpdateRuntimeBehaviour
break
case Pt:r.leapgate_cost=null
r.leapgate_progress=null
r.leapgate_deposits=0
r.leapgate_extracts=0
r.leapgate_access=0
r.gate_time=Pr.DEFAULT
r.mineable=r.leapgateMineable
r.areaShouldClear=r.leapgateAreaShouldClear
r.mineWhenBlocked=r.leapgateMineWhenBlocked
r.interactable=r.leapgateInteractable
r.interact=r.leapgateInteract
r.updateBeforePlace=r.leapgateUpdateBeforePlace
r.updatePos=r.leapgateUpdatePos
r.stageableBakedOverride=r.leapgateStageableBakedOverride
break
case Tt:r.updateRuntimeBehaviour=r.energyWellUpdateRuntimeBehaviour
r.tick=r.energyWellTick
r.interactable=r.energyWellInteractable
r.interact=r.energyWellInteract
break
case rt:r.floater_pos=Be()
r.mineable=r.buzzerMineable
r.mineWhenBlocked=r.buzzerMineWhenBlocked
if(!r.is_preview)r.updateRuntimeBehaviour=r.buzzerStartUpdateRuntimeBehaviour
r.draw=r.buzzerStartDraw
r.interactable=r.buzzerStartInteractable
r.interact=r.buzzerStartInteract
r.shouldPropertyEdit=r.buzzerShouldPropertyEdit
r.propertyEdit=r.buzzerStartPropertyEdit
r.prop_edit_ids=U_
r.read_only_interact=true
break
case tt:r.score_table=[]
r.floater_pos=Be()
r.mineable=r.buzzerMineable
r.mineWhenBlocked=r.buzzerMineWhenBlocked
if(!r.is_preview)r.updateRuntimeBehaviour=r.buzzerGoalUpdateRuntimeBehaviour
r.draw=r.buzzerGoalDraw
r.interactable=r.buzzerGoalInteractable
r.interact=r.buzzerGoalInteract
r.collisionInteract=r.buzzerGoalCollisionInteract
r.shouldPropertyEdit=r.buzzerShouldPropertyEdit
r.propertyEdit=r.buzzerGoalPropertyEdit
r.prop_edit_ids=U_
r.read_only_interact=true
break
case Wt:r.draw=r.particleSystemRun
r.initParticles=r.initDebugParticles
break
case Qe:case $e:case At:case It:case Kt:case Ft:case Gt:case _r:case lr:case yt:case hr:case Ve:case cr:case Mt:case kt:case ot:case Dt:case dr:case Je:r.contents=[]
yl[a]=true
r.updateRuntimeBehaviour=r.factoryUpdateRuntimeBehaviour
r.container_size=Xa+Qa
r.interact=r.factoryInteract
r.interactable=r.factoryInteractable
r.mineable=r.chestMineable
r.mineWhenBlocked=r.chestMineWhenBlocked
r.factory_recipe=null
r.factory_state=$a
r.factory_time=0
break
case Bt:case et:r.baked={key:Hr(1&r.attr2?"bucket_flow":r.attr2?"bucket_full":"bucket_empty",r.attr1!==Sr.ANY&&r.attr1,r.attr2)}
r.snapshot_camera_offset=ws
break
case Ht:case Rt:case tr:case bt:var i
switch(a){case Ht:i="pickax"
break
case Rt:i="hatchet"
break
case tr:i="shovel"
break
case bt:i="hoe"
break
default:I(0)}if(Hi[r.attr1]===zi.METAL)i="metal_"+i
else i="stone_"+i
if(r.attr1===Sr.FLINT)if(a===Rt)i="crude-stone-hatchet"
else if(a===Ht)i="crude-stone-pickax"
else if(a===tr)i="crude-stone-shovel"
r.baked={key:Hr(i,r.attr1,r.attr2)}
r.snapshot_camera_offset=ws
r.prop_is_tool=true}M(r.quat,Ue,r.rot*bs)
if(e.baked_key)r.baked={key:e.baked_key}
if(e.baked_swap&&(r.attr1!==Sr.ANY||e.def_material)){I(r.baked.key)
r.baked.key=Hr(r.baked.key,r.attr1===Sr.ANY?e.def_material:r.attr1,r.attr2)}if(e.fallback){r.fallback=true
r.baked.key=e.fallback_baked_key}if(r.baked&&e.stage_baked_key)r.baked_key_base=r.baked.key
if(e.baked_keys_inhand&&!e.fallback){var o=r.baked_keys_inhand=e.baked_keys_inhand
if(r.attr1!==Sr.ANY||e.def_material){o=r.baked_keys_inhand=o.slice(0)
for(var n=0;n<o.length;++n)o[n]=Hr(o[n],r.attr1===Sr.ANY?e.def_material:r.attr1,r.attr2)}}if(e.silhouette)r.silhouette=true
if(e.ground_filter)if(fc[e.ground_filter])r.groundFilter=fc[e.ground_filter]
else X("Item "+a+" references unknown ground_filter "+e.ground_filter)
if(r.inv.size_auto){I(r.baked.key)
we(r.size,Wr(r.baked.key))}if(!(r.size[0]>=r.size[1]))I(r.size[0]>=r.size[1],"Prop "+e.getName()+" has invalid size ("+r.size.join(",")+") (X must be >= Y). Rotate source and adjust place_rot.")
we(r.last_size,r.size)
if(r.item_id!==Ye){r.draw_offs[0]=.5*r.size[0]
r.draw_offs[1]=.5*r.size[1]}if("dig"===e.on_flow)r.onFlow=r.digIfInBounds
else if("block"===e.on_flow||"through"===e.on_flow);else I(false,"Invalid on_flow: "+e.on_flow)
if("dig"===e.on_unflow)r.onUnflow=r.digIfInBounds
else if("through"===e.on_unflow);else I(false,"Invalid on_unflow: "+e.on_unflow)
if(!r.baked)if(!e.intangible)r.baked={}
if(r.baked){if(r.rot)r.baked.rot=(r.rot+4)%4
r.baked.tangible=!e.intangible
r.baked.size=r.size}if(r.inv.override_stage_baked_key)I(r.baked)
if(r.inv.stage_baked_key||r.inv.override_stage_baked_key){r.has_stages=true
r.setStage=r.setStage||r.stageableSetStage
if(r.updateBeforePlace===se)r.updateBeforePlace=r.stageableUpdateBeforePlace
if(r.updateRuntimeBehaviour===se)r.updateRuntimeBehaviour=r.stageableUpdateRuntimeBehaviour}if(r.inv.growth_heights){r.growth_max_stage=null!==r.inv.growth_max_stage?r.inv.growth_max_stage:r.inv.growth_heights.length-1
r.stage_preview=null!==r.inv.stage_preview?r.inv.stage_preview:r.inv.growth_heights.length-1
r.updateState=r.updateState||r.growableUpdateState
r.setStage=r.setStage===r.stageableSetStage?r.growableSetStage:r.setStage
r.updateRuntimeBehaviour=r.updateRuntimeBehaviour===r.stageableUpdateRuntimeBehaviour?r.growableUpdateRuntimeBehaviour:r.updateRuntimeBehaviour
r.getGrowthRate=r.getGrowthRate||r.growableGetGrowthRate
r.checkHeightTileCheck=r.checkHeightTileCheck||r.growableCheckHeightTileCheck}else if(r.has_stages)r.stage_preview=null!==r.inv.stage_preview?r.inv.stage_preview:0
if(e.perched)r.neighborChanged=r.perchedNeighborChanged
if(e.perched||e.rooted){if(r.updateState){r.mainUpdateState=r.updateState||se
r.updateState=r.updateStatePerchedRootedWrapper}r.groundFilter=r.groundFilter||filterTangible}if(null!==r.inv.harvest_limit)r.harvest_left=r.inv.harvest_limit
if(r.inv.harvest_results)r.harvest_results=r.inv.harvest_results
if(r.harvest_results){if(!r.has_stages||-1===r.inv.harvest_reverting_stage){r.interact=r.interact||r.singleHarvestableInteract
r.addHarvestToBag=r.addHarvestToBag||r.singleHarvestableAddHarvestToBag}else{r.interact=r.interact||r.multiHarvestableInteract
r.addHarvestToBag=r.addHarvestToBag||r.multiHarvestableAddHarvestToBag}r.interactable=r.interactable===se?r.harvestableInteractable:r.interactable
r.onDig=r.onDig===r.onDigBase?r.harvestableOnDig:r.onDig}if(r.inv.is_waterable){I(r.waterableInteractable)
I(r.waterableInteract)
r.mainInteract=r.interact
r.mainInteractable=r.interactable
r.interactable=r.interactableWaterableWrapper
r.interact=r.interactWaterableWrapper}if(!r.growstickInteract&&r.has_stages&&(r.inv.is_waterable||r.inv.growth_heights))r.growstickInteract=r.stageableGrowstickInteract
if(r.growstickInteract){I(r.growstickInteract)
r.mainInteract2=r.interact
r.mainInteractable2=r.interactable
r.interactable=r.interactableGrowstickableWrapper
r.interact=r.interactGrowstickableWrapper}if(r.has_stages)r.setStage(r.inv.stage_spawn)
if(!Tr(r.inv,Mr()))r.updateRuntimeBehaviour=r.unreleasedUpdateRuntimeBehaviour
r.updateRuntimeBehaviour()
if(r.baked&&!r.is_preview&&!r.inv.placeable){console.log("Replacing unplaceable prop id="+r.inv.id+" with placeholder")
r.baked.key=w.DEBUG?"bluebox-edit":"plant-1"}r.emit=r.baked&&r.baked.key?Fr(r.baked.key):0
if(r.isContainer())I(yl[r.item_id])
return r}function createIndicatorProp(){var e=createFromInv(Ni({type:mr,id:Ct}))
e.draw_opts={unlit:true}
return e}Prop.prototype.blueprintFilter=function(e,t){var r=Boolean(e&&rs())
if(t){var a=[e?1:0,r?1:0].join("")
this.blueprint_filter_clone_cache=this.blueprint_filter_clone_cache||{}
var i=this.blueprint_filter_clone_cache[a]
if(i)return i
i=propClone(this,Boolean(e)).blueprintFilter(e,false)
return this.blueprint_filter_clone_cache[a]=i}var o=this.item_id
if(this.growth_max_stage)this.growth_start=0
if(yl[this.item_id])this.contents=[]
switch(o){case Xe:case Ye:return null
case pt:case mt:case Et:case ht:case gt:this.open=0
break
case vr:this.waygate_targets=null
this.exitway_access=0
this.exitway_random=0
break
case Pt:this.leapgate_cost=null
this.leapgate_progress=null
this.leapgate_deposits=0
this.leapgate_extracts=0
this.leapgate_access=0
delete this.leapgate_destination_chunk_id
delete this.leapgate_destination_pos_idx
delete this.leapgate_destination_rot
r=true
break
case wt:this.gem_id=null
break
case rt:this.buzzer_id=null
break
case tt:this.buzzer_id=null
this.max_scores=null
this.score_table=[]
break
case Vt:if(r)this.attr3=mapToSeedFromFlowerType(this.attr3)
break
case fr:this.depletion_time=0
break
case Ze:I(false)
return null
case jt:this.age=0
this.state=Ys
this.sapling_growing_age=0
this.sapling_last_growth=0
this.sapling_growth_failures=0
this.sapling_origin_offset=null
this.sapling_size=null}if(this.has_stages)if(r)this.setStage(this.inv.stage_start)
if(this.inv.no_auto_rot)this.rot=0
this.version=0
this.updateRuntimeBehaviour()
return this}
Prop.prototype.setRot=function(e){this.rot=(e+4)%4
if(this.baked)this.baked.rot=this.rot
M(this.quat,Ue,this.rot*bs)
if(1&e&&this.size[0]>this.size[1]||!(1&e)&&this.size[1]>this.size[0]){var t=this.size[0]
this.size[0]=this.size[1]
this.size[1]=t}this.draw_offs[0]=.5*this.size[0]
this.draw_offs[1]=.5*this.size[1]}
var mc
function createBag(){if(!mc)mc=Ni({type:mr,id:Ye})
return createFromInv(mc)}Prop.prototype.faceMe=function(){if(this.inv.no_auto_rot)return
var e=-El.ypr[0]
var t=(this.place_rot+Ts(e/bs))%4
M(this.quat,Ue,t*bs)
this.rot=(t+4)%4
if(1&t&&this.size[0]>this.size[1]||!(1&t)&&this.size[1]>this.size[0]){var r=this.size[0]
this.size[0]=this.size[1]
this.size[1]=r
this.draw_offs[0]=.5*this.size[0]
this.draw_offs[1]=.5*this.size[1]}}
Prop.prototype.shouldDigSlow=function(){if(this.contents&&!yi(this))return true
if(this.item_id===Xe&&(this.bluebox_state===fa||this.bluebox_state===da))return true
if(this.item_id===wt&&this.gem_id)return true
if(this.item_id===Pt&&this.stage!==yr.INITIAL)return true
if(this.item_id===jt&&0!==this.age)return true
return false}
var Ec=[]
for(var gc=0;gc<12;++gc)Ec.push(Be())
function saveGlobalState(){we(Ec[0],w.light_dir_ws)
Ce(w.light_dir_ws,-.5,1,-3)
we(Ec[1],W.globals.light_diffuse)
we(W.globals.light_diffuse,fe)
Me(Ec[2],W.globals.ambient)
Me(W.globals.ambient,Ge)
we(Ec[3],W.globals.fog_params)
Ce(W.globals.fog_params,0,0,1e3)
we(Ec[4],W.globals.fog_color)
Ce(W.globals.fog_color,.2,.4,8/15)
we(Ec[5],W.globals.light_flashlight)
Ce(W.globals.light_flashlight,0,0,0)
we(Ec[6],W.globals.light_sun_key)
we(W.globals.light_sun_key,fe)
we(Ec[7],W.globals.light_sun_top)
we(W.globals.light_sun_top,Ge)
we(Ec[8],W.globals.light_sun_back)
we(W.globals.light_sun_back,Ge)
we(Ec[9],W.globals.light_torch_top)
Ce(W.globals.light_torch_top,.93,.73,.64)
we(Ec[10],W.globals.light_torch_mid)
Ce(W.globals.light_torch_mid,1,.85,.8)
we(Ec[11],W.globals.light_torch_bot)
Ce(W.globals.light_torch_bot,.8,.73,.74)}function restoreGlobalState(e){if(e)e()
we(w.light_dir_ws,Ec[0])
we(W.globals.light_diffuse,Ec[1])
Me(W.globals.ambient,Ec[2])
we(W.globals.fog_params,Ec[3])
we(W.globals.fog_color,Ec[4])
we(W.globals.light_flashlight,Ec[5])
we(W.globals.light_sun_key,Ec[6])
we(W.globals.light_sun_top,Ec[7])
we(W.globals.light_sun_back,Ec[8])
we(W.globals.light_torch_top,Ec[9])
we(W.globals.light_torch_mid,Ec[10])
we(W.globals.light_torch_bot,Ec[11])}var Tc={size:Pe(1,1),origin:Pe(0,0),draw:se}
Prop.prototype.getSnapshot=function(e,t){var r=this
_e(t.item_context)
var a=t.dynamic_snapshot?1:0
var i=this.item_id===Xe
var o=a||t.force_update
if(i){if(e.blueprint_def)this.blueprint_def=e.blueprint_def
var n=this.blueprint_def
if(this.blueprint_def_ver!==n.ver)o=true}var s=a?"thumbnail_dynamic":"thumbnail"
if(!this[s]||o){var l=function draw_func(){I(!r.draw_opts.color||1===r.draw_opts.color[3])
r.draw_opts.for_snapshot=true
if(r.silhouette)r.draw_opts.color=Bo
else r.draw_opts.sun_factor=1
r.draw_opts.torch_factor=0
r.draw_opts.scale_lights=true
yn(1,true,true)
if(r.item_id===Xe)ia(r)
else In(r,Ge)
yn()
r.draw_opts.for_snapshot=false}
if(i){var _=this.blueprint_def
I(_.loaded)
I(_.size)
we(this.snapshot_size,_.size)
I(_.origin_offset)
we(this.snapshot_pos,_.origin_offset)
this.blueprint_def_ver=_.ver}if(a){if(!this.dynamic_last_frame||this.dynamic_last_frame+1<w.frame_index)this.dynamic_rot=0
else if(this.dynamic_last_frame!==w.frame_index)this.dynamic_rot+=.001*w.frame_dt
this.dynamic_last_frame=w.frame_index
var c=t.w
var u=t.h||t.w
if(c>u)c=u
var d=c*(1-(t.shrink||.75))
var f=t.x+d/2
var v=t.y+d/2
var h=(t.z||Z.UI)+(t.z_inc||j)+.001
var p=c-d
var m=(t.h||c)-d
V({x:f,y:v,z:h,w:p,h:m,pos:this.snapshot_pos||Ge,size:this.snapshot_size||this.size,camera_offset:this.snapshot_camera_offset,pre:saveGlobalState,post:restoreGlobalState.bind(null,t.snapshot_post),rot:this.dynamic_rot,snapshot_backdrop:t.snapshot_backdrop||null,draw:l})
e.img=Tc
e.frame=void 0
e.dynamic_snapshot=true
return}var E=t.snapshot_res||As
var g
var T=function on_unload(){if(r[s]===g)r[s]=null
for(var e=0;e<g.inv_objs.length;++e)if(g.inv_objs[e].img===g){g.inv_objs[e].img=null
g.inv_objs[e].need_thumbnail_update=true}g.texs[0].destroy()
g.texs[1].destroy()}
g=z({name:"prop_snap_"+(a?"dyn_":"")+this.item_id+"_"+this.attr1+"_"+this.attr2+"_"+this.attr3+"_"+t.item_context+"_"+(this.fallback?"fb_":"")+(this.silhouette?"sh_":"")+(this.count||0),sprite:this[s],w:E,h:E,pos:this.snapshot_pos||Ge,size:this.snapshot_size||this.size,camera_offset:this.snapshot_camera_offset,pre:saveGlobalState,post:restoreGlobalState.bind(null,t.snapshot_post),rot:0,snapshot_backdrop:t.snapshot_backdrop||null,on_unload:T,draw:l})
this[s]=g}e.img=this[s]
e.img.inv_objs=e.img.inv_objs||[]
e.img.inv_objs.push(e)
e.frame=void 0
e.dynamic_snapshot=false}
Prop.prototype.allowAlpha=function(){if(!this.mat)this.mat=de()}
function createForPreview(e,t){var r=e,a=r.fallback,i=r.silhouette;(e=Ni(e)).fallback=a
e.silhouette=i
e.is_preview=true
var o=false
if(t===f)if(e.baked_key_resource){o=true
e.baked_key=e.baked_key_resource
e.stage_baked_key=null
e.growth_heights=null
e.size_auto=true
e.place_rot_random=false}var n=createFromInv(e)
if(n.has_stages){n.setStage(n.stage_preview)
n.updateRuntimeBehaviour()}if(!o)switch(e.id){case Xt:n.size[2]=5
break
case Vt:n.size[2]=2
if(n.emit)n.baked.key+="-no-emit"}if(t===u){n.allowAlpha()
n.draw_opts.color=il}return n}function getPreviewPropKey(e,t){var r=t+","+e.id+","+e.attr1+","+e.attr2+","+e.attr3
return(r+=e.fallback?",fb":"")+(e.silhouette?",sh":"")}var yc=[]
function hasForPreview(e,t){I.equal(typeof t,"number")
var r=getPreviewPropKey(e,t)
var a=yc[r]
return Boolean(a&&a.thumbnail)}function getForPreview(e,t){I.equal(typeof t,"number")
var r=getPreviewPropKey(e,t)
var a=yc[r]
if(!a)a=yc[r]=createForPreview(e,t)
a.updatePreview()
return a}Prop.prototype.applyFieldMod=function(e,t){switch(this.item_id){case jt:switch(e){case"sga":this.sapling_growing_age=t
break
default:_e(false)}break
case Xe:switch(e){case"lu":this.bluebox_last_update_local=this.bluebox_last_update=t
break
case"s":this.bluebox_state=t
break
case"bo":this.bluebox_origin_offset=t
break
case"bs":this.bluebox_size=t
break
case"bv":this.bluebox_ver=t
break
default:_e(false)}break
case pt:case mt:case Et:case ht:case gt:switch(e){case"d":if(this.open!==t){this.open=t
this.open_at=w.frame_timestamp}break
default:_e(false)}break
case tt:switch(e){case"st":this.score_table=t
break
default:_e(false)}break
default:if(this.isFactory())switch(e){case"fr":this.factory_recipe=t
break
case"fs":this.factory_state=t
break
case"ft":this.factory_time=t
break
default:_e(false)}else _e(false)}}
function propDebugGetFieldName(e){switch(e){case"lu":return"bluebox_last_update"
case"s":return"bluebox_state"
case"bo":return"bluebox_origin_offset"
case"bs":return"bluebox_size"
case"bv":return"bluebox_ver"
case"d":return"open"
case"fr":return"factory_recipe"
case"fs":return"factory_state"
case"ft":return"factory_time"
default:return e}}function propFromJSON(e,t,r){if(t&&t.item_id!==e.id)t=null
var a=Ni({type:mr,id:e.id,attr1:e.a1,attr2:e.a2,attr3:e.a3})
a.fallback=e.fb
var i=createFromInv(a,t)
i.version=e.v||1
if(!(i.main_world=r)&&i.applyBoostLevel){a.ignore_boost_level=true
i.applyBoostLevel()}var o=false
switch(i.item_id){case Xe:i.bluebox_state=e.s||ha
i.bluebox_last_update_local=i.bluebox_last_update=e.lu||0
i.bluebox_origin_offset=e.bo||null
i.bluebox_size=e.bs||null
i.bluebox_ver=e.bv||null
i.bluebox_req_permissions=e.br||null
i.bluebox_unlimited=void 0===e.bun?Qn():Boolean(e.bun)
break
case jt:i.age=e.sa
i.state=e.ss
i.seed=e.sd
i.sapling_growing_age=e.sga||0
i.sapling_last_growth=(e.sg||0)/24
i.sapling_growth_failures=e.sf||0
i.sapling_origin_offset=e.so||null
i.sapling_size=e.ssz||null
if(i.sapling_last_growth>Mo())i.sapling_last_growth=Mo()
if(t){i.last_health_check=t.last_health_check
i.health_check_random_time=t.health_check_random_time
if(t.age===i.age&&t.vd_current)i.vd_current=t.vd_current
i.vd_next=t.vd_next}break
case Ke:case je:case qe:case Jt:case qt:case Qt:case Xt:case Vt:case er:case $t:if(e.l&&i.inv.harvest_limit)i.harvest_left=e.l
i.stage=7&e.d
i.watered=Boolean(8&e.d)
break
case at:case it:case Zt:case ze:case vt:i.stage=e.d||0
break
case fr:i.stage=e.d||0
i.depletion_time=(e.gt||0)/24
break
case Ye:if(e.np===Bi.instance_uid)i.no_pickup_counter=Os
i.expiring_soon=Boolean(e.es)
if(i.expiring_soon)i.expire_counter=Ds
if(t){Me(i.quat,t.quat)
o=true}break
case pt:case mt:case Et:case ht:case gt:i.open=e.d
break
case vr:i.waygate_targets=e.d
i.exitway_access=e.ea||0
i.exitway_random=e.er||0
i.gate_time=e.wgt||0
break
case Pt:i.stage=e.lm||0
i.leapgate_cost=e.lc
i.leapgate_progress=e.lp
i.leapgate_deposits=e.ld
i.leapgate_extracts=e.le
i.leapgate_destination_chunk_id=e.ldc
i.leapgate_destination_pos_idx=e.ldp
i.leapgate_destination_rot=e.ldr
i.leapgate_access=e.la||0
i.gate_time=e.wgt||0
break
case wt:i.gem_id=e.d
break
case rr:case ar:case ir:case or:case nr:case sr:i.sign_text=e.d
break
case rt:i.buzzer_id=e.d
break
case tt:i.buzzer_id=e.d
i.max_scores=e.ms
i.score_table=e.st
break
case Ze:_e(false)}if(yl[i.item_id])deserializeContents(i,e)
if(i.isFactory()){i.factory_recipe=e.fr||null
i.factory_state=e.fs||$a
i.factory_time=e.ft||0}i.rot=e.rot||0
i.flipped=Boolean(e.f)
if(-1===e.sx){if(1&i.rot&&i.size[0]>i.size[1]||!(1&i.rot)&&i.size[1]>i.size[0]){var n=i.size[0]
i.size[0]=i.size[1]
i.size[1]=n}}else{i.size[0]=e.sx||1
i.size[1]=e.sy||1
i.size[2]=e.sz||1}if(i.item_id!==Ye){i.draw_offs[0]=.5*i.size[0]
i.draw_offs[1]=.5*i.size[1]}we(i.last_size,i.size)
if(!Ne(i.size,i.last_size))we(i.size,i.last_size)
if(i.growth_max_stage){i.growth_start=(e.gt||0)/24
if(i.growth_start>Mo())i.growth_start=Mo()}if(!o)M(i.quat,Ue,i.rot*bs)
if(i.baked)i.baked.rot=(i.rot+4)%4
i.updateRuntimeBehaviour()
return i}function propClone(e,t){return propFromJSON(ee(e),null,t)}var Sc=function(){var T=new Int32Array(3)
var y=new Int32Array(3)
var S=new Int32Array(3)
return function bagAddTransFn(e,t){var r=t.target_pos,a=t.item,i=t.items,o=t.src_pos,n=t.bag_to_ignore,s=t.auto_pickup,l=t.no_pickup,_=t.emptied_pos,c=t.max_search,u=t.from_center,d=t.src_is_self,f=t.is_update_func
Oe(T,r)
if(i)I(!a)
else{I(a)
i=[a]}if(void 0===c)c=16
if(s){I(o)
Ie(l_,o,ue)
if(Le(El.center_pos,l_)<=Cs){Oe(T,r=o)
c=1}}var v=false
for(var h=0;h<c;++h){var p=Nn(T,1,false)
if(p&&_&&Ne(_,T))p=0
if(p&&p<qo||!Wa(T))break
if(!p){v=true
we(y,T)}else if(p>=Zo&&p<=Xo){var m=Tn()
if(m)if(m.item_id===Ye&&m!==n){v=true
we(y,T)}else if(!m.isIntangible())break}T[2]--}I(v)
xe(S,o,y)
var E={target_pos:y,src_offs:S,no_pickup:l?Bi.instance_uid:"",is_update_func:f}
for(var g=0;g<i.length;++g){E.item=i[g]
Pn(e,E)}Bn(e,{style:Lr,src_type:d?Or:Rr,src:d?null:o,target_type:Rr,target:E.target_pos,items:i,from_center:u})}}()
r.bagAddTrans=Sc
function tickProps(){if(S_)gemDebugTick()
tl.tick()
rl=Boolean(Zn())}},{"../common/entitlements":244,"../common/globals":248,"../common/ids":249,"../common/items_common":251,"../common/leapgate_common":252,"../common/materials_common":253,"../common/race_common":258,"../common/voxel_data_common":264,"../common/world_constants":267,"../common/world_trans":268,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/localization":330,"../glov/client/mat4ScaleRotateTranslate":336,"../glov/client/net":338,"../glov/client/quat":346,"../glov/client/round_robinable":348,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/snapshot":356,"../glov/client/ui":367,"../glov/client/webfs":371,"../glov/client/words/profanity":372,"../glov/common/data_error":381,"../glov/common/perfcounters":393,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./app_access":12,"./auto_activate_ui":15,"./baking":19,"./biome_details.js":23,"./bluebox_edit_list":26,"./bluebox_ui":27,"./blueprint":28,"./build_mode":33,"./camera":35,"./character_controller":37,"./character_controller_constants":38,"./chat_floater":40,"./editvolume_client":84,"./energy_well":85,"./factory_ui":95,"./floater":100,"./flora_constants":101,"./inventory":114,"./item_anims":116,"./items":119,"./localization/localization":131,"./main":135,"./materials":137,"./menu":140,"./mobs":145,"./palette":149,"./particle_system":152,"./prop_edit":170,"./quickbar":172,"./race_results":173,"./rand_seed":175,"./saplings":177,"./saplings_shared.js":179,"./settlement":181,"./sky":188,"./status":193,"./styles":197,"./tiles":199,"./tiles_const":200,"./ui_util":205,"./user_data":208,"./user_info_view":210,"./voxel_data":216,"./voxel_data_drawable":217,"./voxel_data_xraw":218,"./world_comm":226,"./world_metadata":235,"./worlds_sound":236,"./worlds_soundscape":237,assert:void 0,"gl-mat4/translate":void 0}],172:[function(e,t,r){"use strict"
r.lock=lock
r.reset=reset
r.quickbarLoad=quickbarLoad
r.quickbarGetSelected=quickbarGetSelected
r.getSelectedIfOwned=getSelectedIfOwned
r.getSelectedVisible=getSelectedVisible
r.quickbarOnEquipChange=quickbarOnEquipChange
r.quickbarSetLastGatherTool=quickbarSetLastGatherTool
r.gatheringToolsSelected=gatheringToolsSelected
r.consumableSelected=consumableSelected
r.consumeSelected=consumeSelected
r.payCostSelected=payCostSelected
r.consumeSelectedBucket=consumeSelectedBucket
r.bucketFill=bucketFill
r.quickbarX0=quickbarX0
r.quickbarX1=quickbarX1
r.quickbarY1=quickbarY1
r.quickbarPadLeft=quickbarPadLeft
r.quickbarPadRight=quickbarPadRight
r.quickbarPadTop=quickbarPadTop
r.itemInQuickbar=itemInQuickbar
r.selectByItem=selectByItem
r.setQuickItem=setQuickItem
r.unslot=unslot
r.selectGatheringTools=selectGatheringTools
r.getSelectedGatherTool=getSelectedGatherTool
r.getCurrentModeMappedProp=getCurrentModeMappedProp
r.selectedIsFlipped=selectedIsFlipped
r.getCurrentBrushSize=getCurrentBrushSize
r.toolSelected=toolSelected
r.bucketSelected=bucketSelected
r.quickbarScrollView=quickbarScrollView
r.startup=startup
r.isDragging=isDragging
r.selectLightingInstructions=selectLightingInstructions
r.showGatheringToolDurability=showGatheringToolDurability
r.tickQuickBar=tickQuickBar
r.quickbar_colors_empty=r.quickbar_colors_selected=void 0
r.getSelected=quickbarGetSelected
var _e=e("assert")
var ce=e("../glov/client/camera2d")
var a=e("../glov/client/cmds").cmd_parse
var ue=e("../glov/client/engine")
var de=e("../glov/client/input")
var i=e("../glov/client/input")
var fe=i.KEYS
var ve=i.PAD
var he=e("../glov/client/settings")
var pe=e("../glov/client/sprites").spriteClip
var me=e("../glov/client/ui")
var O=e("../glov/client/ui.js").buttonWasFocused
var o=e("../glov/common/util")
var Ee=o.clamp
var ge=o.easeInOut
var Te=e("../glov/common/verify")
var n=e("../glov/common/vmath")
var R=n.unit_vec
var s=n.vec4
var l=e("../common/ids")
var h=l.ITEM_BUCKET
var ye=l.ITEM_HANDSTOOL
var _=l.ITEM_HATCHET
var Se=l.ITEM_LANTERN
var c=l.ITEM_PICKAX
var u=l.ITEM_SHOVEL
var d=l.ITEM_TORCH
var Ie=l.TYPE_ITEM
var Ae=e("../common/materials_common").Mat
var f=e("../common/world_constants")
var v=f.TOOL_LOCK_ANY
var p=f.TOOL_LOCK_CRAFTED
var m=e("./baking").getBakedEmit
var we=e("./blueprint").blueprintGetDef
var Le=e("./build_menu")
var E=e("./build_mode")
var Oe=E.cancelDragPlace
var g=E.mouseMoveFadeReset
var b=E.tempColorFade
var Re=e("./camera").cameraConsumeV
var be=e("./inventory")
var T=e("./inventory")
var N=T.EQUIP_SLOTS
var C=T.INV_EQUIP
var y=T.INV_PLAYER
var Ne=T.countAvailable
var S=T.countAvailableEx
var I=T.equipFitsInSlot
var Ce=T.findAvailable
var xe=T.inventoryGetAccountMapped
var A=T.inventoryGetArr
var w=T.inventoryGetLookedToolMat
var Me=T.inventoryGetMaterialCostMapped
var L=T.inventoryGetSize
var x=T.inventoryGetVer
var M=T.inventoryLocked
var D=e("./inventory_ui")
var De=D.equipDragDroppedItem
var Pe=D.getDraggedItem
var Be=D.getDroppedItem
var ke=D.getMouseoverItem
var Ue=D.getSelectedItem
var Ge=D.inventoryButton
var P=D.itemHPColor
var B=D.itemHPStyle
var Fe=D.mapInvPos
var k=e("./items")
var U=e("./items")
var G=U.BRUSH_SIZES
var We=U.ITEM_CONTEXT_BUILD
var He=U.ITEM_CONTEXT_ITEM
var ze=U.createItem
var F=U.createItemLite
var W=U.itemFromJSON
var H=U.itemGetGfx
var Ve=U.itemIsAllowedInQuickbar
var Ye=U.itemIsBlueprint
var z=U.itemIsBlueprintReady
var je=U.itemIsUnlimited
var Ke=U.sameItem
var V=e("./layout")
var Y=V.LEFT
var j=V.QUICKBAR_BORDER_PAD
var qe=V.QUICKBAR_BOX_SIZE
var K=V.RIGHT
var q=V.TOP
var X=V.canChangeLayout
var Ze=V.quickbarOnLeft
var Xe=V.quickbarOnRight
var Qe=V.quickbarOnTop
var $e=e("./localization/localization").L
var Je=e("./main")
var et=e("./menu")
var tt=e("./menu").doQuickSlotMenu
var Q=e("./props")
var $=Q.PREVIEW_HELD
var J=Q.getForPreview
var ee=e("./status")
var te=e("./status").STATUS_FONT_SIZE
var rt=e("./styles").style_mode_label
var re=e("./tiles")
var ae=re.TILE_EMPTY
var ie=re.TILE_WATER
var at=e("./ui_util")
var oe=e("./user_data")
var ne=e("./user_data")
var se=ne.unlimitedItemsAllowed
var le=ne.userDataIsWaiting
var it=ne.worldReadOnly
var ot=e("./voxel_data").setFlashlight
var nt=e("./world_comm").getWorldID
var st=e("./world_metadata")
var lt=st.adventureMode
var _t=st.worldConsumables
var ct=st.worldToolLock
var ut=Math.abs,dt=Math.max,ft=Math.min,vt=Math.round
var ht
var pt
var mt=me.makeColorSet([1,1,1,.5])
mt.down[3]=1
mt.rollover[3]=1
var Et=me.makeColorSet([1,1,1,1])
r.quickbar_colors_selected=Et
var gt=me.makeColorSet([.4,.4,.4,.5]);(r.quickbar_colors_empty=gt).down[3]=1
gt.rollover[3]=1
var Tt=me.makeColorSet([.4,.4,.4,1])
var yt=s(1,1,1,.75)
var St=s(0,0,0,.5)
var It=qe
var At=-2
var wt=-3
var Lt=-4
var Ot=0
var Rt=false
var bt=false
var Nt=At
var Ct=false
function lock(){Ct=true}var xt=j
var Mt=3*xt
var Dt=7
var Pt=60
var Bt=[]
var kt=0
var Ut=null
var Gt=At
var Ft=Lt
var Wt=0
var Ht=0
var zt=300
var Vt={mode_list:"later",is_gather:true,default_mode_idx:0,getName:function getName(){return $e.LBL_GATHERING_TOOLS},getBuildName:function getBuildName(){return this.getName()},isCrafted:function isCrafted(){return false},toJSON:function toJSON(){return _e(false)},getBID:function getBID(){return null}}
var Yt=null
var jt=null
var Kt=null
var qt
var Zt=ie
var Xt=-1
var Qt=3
function save(){oe.set("quickbar",{v:Qt,ri:Ut?Ut.toJSON("",true):null,sx:Gt,lx:Ft,vi:kt,sm:Wt,d:Bt.map(function(e){return e?e.toJSON("",true):void 0})})
Xt=-1}var $t=6
var Jt=7
function quickbarBaseSlots(){return Qe()?Jt:$t}function quickbarTotalSlots(){return 2*quickbarBaseSlots()}function quickbarViewSlots(){return it()?0:quickbarBaseSlots()+(he.quickbar_show_recent?0:1)+(he.split_build?-1:0)}function reset(e){Ut=null
Gt=wt
Wt=kt=0
Bt=[]
if(e)save()
Zt=ie
Ht=0}function cmdQuickbarReset(e,t){if(!nt()||le())return void t($e.ERR_NOT_IN_WORLD)
reset(true)
t()}a.register({cmd:"quickbar_reset",help:"Reset quickbar",func:cmdQuickbarReset})
a.register({cmd:"clear",help:"Alias for /quickbar_reset",func:cmdQuickbarReset})
var er
var tr=0
function getIntrinsicTools(){var e=ct()
if(e===p)return Kt
if(e&&jt[e])return jt[e]
return Yt}function selectInitialGatheringTool(){var e=C.contents
er=null
for(var t=0;t<N.length;++t){var r=e[t]
if(r){er=r
return}}var a=getIntrinsicTools()
for(var i=0;i<N.length;++i){var o=a[i]
if(o){er=o
return}}}function shouldEquipTool(e){for(var t=0;t<C.contents.length;++t)if(C.contents[t])return false
for(var r=0;r<N.length;++r)if(I(r,e))return true
return false}function quickbarItemFromJSON(e){if(!(e=W(e)))return null
if(!Ve(e))return null
return e}function quickbarLoad(){reset(false)
var e=oe.get("quickbar")
if(e&&e.v===Qt){Ut=e.ri?quickbarItemFromJSON(e.ri):null
Gt=e.sx||0
Ft=void 0===e.lx?Lt:e.lx
kt=e.vi||0
Wt=e.sm||0
Bt=(e.d||[]).map(quickbarItemFromJSON)}if(it())Gt=At
selectInitialGatheringTool()}function quickbarSafeItem(e){return ze(e)}function setItem(e,t){_e(e===Lt||e>=0)
if(t&&!Ve(t))return
t=quickbarSafeItem(t)
if(e===Lt)Ut=t
else Bt[e]=t}function getItem(e){switch(e){case At:return null
case wt:return Vt
case Lt:return Ut
default:return Bt[e]}}function quickbarGetSelected(){return getItem(Gt)||qt}function getSelectedIfOwned(){var e=quickbarGetSelected()
if(!e||Gt===wt||e===qt)return e
if(!Ne(e,true)||Ye(e)&&!z(e))return qt
return e}function getSelectedVisible(){if(Gt===wt){if(er){if(-1!==getIntrinsicTools().indexOf(er))return er
if(Ne(er,true))return er}return qt}return getSelectedIfOwned()}function quickbarOnEquipChange(){if(er&&!S(C,er,true))selectInitialGatheringTool()}function quickbarSetLastGatherTool(e){er=e}function gatheringToolsSelected(){return Gt===wt}function getEquipedGatheringTool(e,t){var r=C.contents
var a=0
var i=null
var o=getIntrinsicTools()
var n=ct()
for(var s=0;s<N.length;++s){var l=r[s]
if(l&&l.has_hp&&!(l.hp_cur>0)||n>v&&n<p||l&&!l.has_hp&&n===p)l=null
var _=(l=l||o[s])&&l.dig_rates[e]
if(_>a){a=_
i=l}}if(i&&t&&tr!==ue.frame_index){tr=ue.frame_index
er=i}return i}function consumableSelected(){if(M(y))return false
var e=getSelectedIfOwned()
return e&&e.consumable&&_t()}function getSelectedInventoryIndex(e,t){var r=t||quickbarGetSelected()
var a=A()
var i=L(y)
var o=-1
for(var n=0;n<i;++n)if(Ke(r,a[n],"hp"))if(a[n].count===e)return n
else if(-1===o||a[n].count<a[o].count)o=n
return o}function consumeSelected(e,t){var r=getSelectedInventoryIndex(t=t||1)
return be.consume(e,r,t)}function payCostSelected(){var e=quickbarGetSelected()
return be.payCost(e)}function consumeSelectedBucket(e,t){if(je(quickbarGetSelected()))return e||Je.getFrameTransaction()
if(M(y))return null
var r=1
var a=getSelectedInventoryIndex(r,t)
if(a<0)return null
return be.transBucketConsume(e,a,r)}function bucketFill(e){Zt=e
if(je(quickbarGetSelected()))return Je.getFrameTransaction()
var t=getSelectedInventoryIndex(1)
return be.transBucketFill(t,e)}function quickbarX0(){var e=Qe()
return Ze()?-90===window.orientation?ce.x0Real():0:e?xt:(90===window.orientation?ce.x1Real():ce.x1())-It}function quickbarY0(){return Qe()?0:xt}function quickbarX1(){var e=it()
var t=Ze()
var r=Qe()
var a=quickbarX0()
var i=r?1:0
var o=r?0:1
var n=e?1:he.quickbar_show_recent?2:1
var s=quickbarViewSlots()
if(!ue.defines.NOUI){var l=0
var _=0
var c=0
if(!r)if(!r&&t){if(!ce.safeAreaPadding()[0])l=100}else{if(!ce.safeAreaPadding()[1])_=100
c=1}var u=It+l+_+2*xt
if(!e)if(he.split_build)if(!et.active())return a-xt-l+i*((n+s)*It+2*Mt)+u
else return 0
else return a-xt-l+i*(n*It+Mt)-c*Dt+(u+i*It*(s-1)+o*Dt)
else return a-xt-l+(u+i*It*(n-1))}else return 0}function quickbarY1(){var e=it()
var t=Qe()
var r=quickbarY0()
var a=t?1:0
var i=t?0:1
var o=e?1:he.quickbar_show_recent?2:1
var n=quickbarViewSlots()
if(!ue.defines.NOUI){var s=0
if(t)if(!ce.safeAreaPadding()[2])s=100
var l=It+s+2*xt
if(!e)if(he.split_build)if(!et.active())return r-xt-s+i*((o+n)*It+2*Mt)+l
else return 0
else return r-xt-s+i*(o*It+Mt)+(l+i*It*(n-1)+a*Dt)
else return r-xt-s+(l+i*It*(o-1))}else return 0}function quickbarTextPos(e){var t=it()
_e(e!==At)
var r
var a=false
if(e===wt)r=0
else if(e===Lt)r=t?0:1
else{if(e<kt||e>=kt+quickbarViewSlots())return null
r=(he.quickbar_show_recent?2:1)+(e-kt)
a=true}var i=quickbarX0()
var o=quickbarY0()
var n=(r+(a&&Rt?Ot:0))*It
if(a)n+=Mt
if(Qe()){i+=n+.5*It
o+=It+xt}else{i+=Xe()?It:0
o+=n+It-te}return{x:i,y:o}}function quickbarPadLeft(){return Ze()&&!it()?It+xt:0}function quickbarPadRight(){return Xe()?It+xt:0}function quickbarPadTop(){return Ze()?0:It+xt}function selectable(e){return Gt!==e}function modeForItem(e){if(!e)return 0
return e.default_mode_idx||0}function scrollSelectedIntoView(){if(Gt>=0&&(Gt<kt||Gt>=kt+quickbarViewSlots())){var e
if(Gt<kt)e=dt(0,Gt-1)
else e=ft(quickbarTotalSlots()-quickbarViewSlots(),Gt-quickbarViewSlots()+2)
Ot=e-kt
kt=e}}var rr
var ar
function selectShared(e){ar=null
var t=quickbarGetSelected()
Wt=modeForItem(t)
if(Gt!==At){scrollSelectedIntoView()
if(!e&&t){if(t.has_hp)t=Ce(t)||t
var r=(t=xe(t)).getBuildName()
var a=quickbarTextPos(rr=Gt)
if(a)ar=ee.get("inv_selected").setMessage(r,1500).setPos(a.x,a.y)}}save()}function reselect(e){var t=quickbarGetSelected()
if(t)if(t.mode_list){Wt=(Wt+1)%t.mode_list.length
t.last_mode_idx=Wt
save()}else if(e&&consumableSelected())consumeSelected(null)}function selectByIndex(e,t,r){g()
if(Gt!==e||t){if(e===wt)Ft=Gt
Gt=e
selectShared(r)
return true}else{reselect(true)
return false}}function itemIndexInQuickbar(e){if(!e)return At
if(Ut&&Ke(e,Ut,"hp"))return Lt
for(var t=0;t<quickbarTotalSlots();++t){var r=Bt[t]
if(Ke(r,e,"hp"))return t}return At}var ir
function itemInQuickbar(e){ir.id=e
return itemIndexInQuickbar(ir)!==At}function selectByItem(e,t){g()
var r=e&&e.pick_as_mode
if(e&&e.pick_as_id)e=ze({type:e.type,id:e.pick_as_id,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})
if(e&&e.cost_mat_map){var a
for(var i in e.cost_mat_map){var o=e.cost_mat_map[i]
if(void 0!==o.pick_as)(a=a||{type:e.type,id:e.id,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})[i]=o.pick_as}if(a)e=ze(a)}var n=getItem(Gt)
var s=null===r&&n&&e&&n.type===e.type&&n.mode_list===e.mode_list
var l=null
if(s)l=Wt
if(!e||!Ke(e,n,"hp")||null!==r&&r!==Wt){if((Gt=itemIndexInQuickbar(e))===At&&e){if(e.is_gather)return
e=quickbarSafeItem(e)
Ut=e
Gt=Lt}selectShared(e&&!t)
if(s){Wt=l
save()}else if(null!==r){Wt=r
save()}}}var or=At
function setQuickItem(e){setItem(or,e)
selectByIndex(or,true)
save()}function unslot(e){if(Ke(Ut,e,"hp"))setItem(Lt,null)
for(var t=0;t<Bt.length;++t)if(Ke(Bt[t],e,"hp"))setItem(t,null)
save()}function selectGatheringTools(){if(Gt!==wt){selectByIndex(wt,true,true)
save()}}function filterByToolLock(e){if(!e)return null
var t=ct()
if(t===v||t===p)return e
var r=w(t)
if(e.getMaterial()===r)return e
return null}function getSelectedGatherTool(e,t){if(Gt===wt)return getEquipedGatheringTool(e,t)||qt
var r=quickbarGetSelected()
if(r&&!r.is_gather||r===qt)r=null
if(!r)if(r=getEquipedGatheringTool(e,t)){if(t)selectGatheringTools()
return filterByToolLock(r)}if(r)return filterByToolLock(Ce(r))
var a=ct()
if(a!==v&&a!==p)return null
return qt}function selMod(e,t){if(t){selectByIndex(Gt===At?Lt:At)
return}var r=kt
var a=r+quickbarViewSlots()-1
if(Gt===At)selectByIndex(e<0?a:wt)
else if(Gt===wt)selectByIndex(e<0?a:he.quickbar_show_recent?Lt:r)
else if(Gt===Lt)selectByIndex(e<0?wt:r)
else{var i=Gt+e
if(i>a)i=wt
else if(i<r)i=he.quickbar_show_recent?Lt:wt
selectByIndex(i)}}function selected(e){return Gt===e}function is2x2Locked(e){return e&&e.is_gather&&lt()}function getCurrentMode(){var e=getSelectedIfOwned()
if(!e||!e.mode_list||e===qt)return""
if(is2x2Locked(e))return"2x2"
return e.mode_list[Wt]}var nr={flip:$e.LBL_BRUSH_MODE_FLIPPED,"1x1":$e.LBL_BRUSH_MODE_1X1,"2x2":$e.LBL_BRUSH_MODE_2X2,"3x3":$e.LBL_BRUSH_MODE_3X3,"2x1":$e.LBL_BRUSH_MODE_2X1,"3x1":$e.LBL_BRUSH_MODE_3X1}
function getCurrentModeLabel(){var e=getCurrentMode()
return nr[e]||e}function getCurrentModeMappedProp(e){if(!e||!e.mode_list_ids)return e
var t=e.mode_list_ids[Wt]
if(!t)return e
if(!e.mode_list_mapped)e.mode_list_mapped=[]
var r=e.mode_list_mapped[Wt]
if(!r)r=e.mode_list_mapped[Wt]=ze({type:e.type,id:t,attr1:e.attr1,attr2:e.attr2,attr3:e.attr3})
return r}function selectedIsFlipped(){return"flip"===getCurrentMode()}function getCurrentBrushSize(){var e=getSelectedIfOwned()
if(e){if(e.brush_size)return e.brush_size
var t=getCurrentMode()
if(G[t])return G[t]}return G.def}function toolSelected(e,t){var r=quickbarGetSelected()
if(r&&r.type===Ie&&r.id===e&&(!t||r.count>=t)){if(-1===getSelectedInventoryIndex()&&!se())return false
return r}return false}function bucketSelected(e){var t=toolSelected(h)
return t&&(void 0===e||t.attr2===e)}function doScrollView(e){var t=quickbarViewSlots()
if(!t)return
kt+=e
var r=quickbarTotalSlots()
if(kt<=-t)kt=r-t
else if(kt<0)kt=0
else if(kt>=r)kt=0
else if(kt>r-t)kt=r-t}function quickbarScrollView(){if(!Je.chat_ui.isFocused()&&de.keyDownEdge(fe.TAB)||de.padButtonDownEdge(ve.Y))doScrollView(quickbarViewSlots()*(de.keyDown(fe.SHIFT)?-1:1))}function startup(){ht=me.font
pt=at.sprite
me.loadUISprite("quickbar_border",[48,32,48],[48,160,48])
me.loadUISprite("quickbar_selector",[48,32,48],[48,160,48])
me.loadUISprite("quickbar_scroll",[64],[30,196,30])
me.loadUISprite("quickbar_scroll_horiz",[30,196,30],[64])
Vt.mode_list=k.mode_list_block_size
Yt=[ze({type:Ie,id:c,attr1:Ae.REGULAR,attr2:Ae.WOOD}),ze({type:Ie,id:_,attr1:Ae.REGULAR,attr2:Ae.WOOD}),ze({type:Ie,id:u,attr1:Ae.REGULAR,attr2:Ae.WOOD})]
jt=[null,Yt,[ze({type:Ie,id:c,attr1:Ae.FAST,attr2:Ae.WOOD}),ze({type:Ie,id:_,attr1:Ae.FAST,attr2:Ae.WOOD}),ze({type:Ie,id:u,attr1:Ae.FAST,attr2:Ae.WOOD})],[ze({type:Ie,id:c,attr1:Ae.SUPER,attr2:Ae.WOOD}),ze({type:Ie,id:_,attr1:Ae.SUPER,attr2:Ae.WOOD}),ze({type:Ie,id:u,attr1:Ae.SUPER,attr2:Ae.WOOD})]]
Kt=[ze({type:Ie,id:c,attr1:Ae.FLINT}),ze({type:Ie,id:_,attr1:Ae.FLINT}),ze({type:Ie,id:u,attr1:Ae.FLINT})]
for(var e=0;e<Yt.length;++e)Yt[e].has_hp=false
for(var t=0;t<Kt.length;++t)Kt[t].has_hp=false
qt=ze({type:Ie,id:ye})
ir=F({type:Ie,id:-1})}function isDragging(){return Rt}function checkPos(e,t){return e[0]>=t.x&&e[0]<t.x+t.w&&e[1]>=t.y&&e[1]<t.y+t.h}var sr=200
var lr=s(1,0,1,.5)
function checkReposRect(e,t,r,a,i){me.drawRect(t,r,a,i,Z.QUICKBAR-5,lr)
var o=e.cur_pos[0]>=t&&e.cur_pos[0]<=a&&e.cur_pos[1]>=r&&e.cur_pos[1]<=i
if(o)Ot=0
return o}function checkRepos(e){if(!X())return false
var t=Qe()
if(t&&e.cur_pos[1]-e.start_pos[1]>sr||!t&&ut(e.cur_pos[0]-e.start_pos[0])>sr){if(!Ze()&&checkReposRect(e,ce.x0Real(),2*It,2*It,.8*ce.y1()))he.set("layout_quickbar",Y)
else if(!Xe()&&checkReposRect(e,ce.x1()-2*It,2*It,ce.x1Real(),.8*ce.y1()))he.set("layout_quickbar",K)
else if(!t&&checkReposRect(e,2*It,ce.y0Real(),ce.x1()-2*It,2*It))he.set("layout_quickbar",q)
return true}return false}function bucketConsistencyCheck(){if(se())return
if(Xt===x(y))return
Xt=x(y)
var e=[]
for(var t=0;t<Bt.length;++t){var r=Bt[t]
if(r&&r.type===Ie&&r.id===h){r.idx=t
e.push(r)}}if(Ut&&Ut.type===Ie&&Ut.id===h){Ut.idx=Lt
e.push(Ut)}if(!e.length)return
var a=A()
var i=L(y)
var o=[]
for(var n=0;n<i;++n){var s=a[n]
if(s&&s.type===Ie&&s.id===h)o.push(s)}e:for(var l=0;l<e.length;++l){var _=e[l]
for(var c=0;c<o.length;++c)if(Ke(_,o[c],"hp"))continue e
var u=_.attr2?ae:Zt
if(!_.qb_compliment||_.qb_compliment.attr2!==u)_.qb_compliment=ze({type:_.type,id:_.id,attr3:_.attr3,attr1:_.attr1,attr2:u})
var d=false
for(var f=0;f<o.length;++f)if(Ke(_.qb_compliment,o[f],"hp")){d=true
break}if(!d)continue
for(var v=0;v<e.length;++v)if(Ke(e[v],_.qb_compliment,"hp"))continue e
setItem(_.idx,_.qb_compliment)
e[l]=_.qb_compliment
save()}Xt=x(y)}function updateLastStatus(){if(ar)if(ar.done)ar=null
else{var e=quickbarTextPos(rr)
if(e)ar.setPos(e.x,e.y)
else ar.remove()}}var _r
var cr=0
function getPlayerEmit(){var e=getSelectedVisible()
if(e===_r)return cr
var t=0
if(e.type===Ie&&(e.need_thumbnail_update||e.thumbnail_updated)){var r=J(e,$)
if(r.baked&&r.baked.key)t=m(r.baked.key)||0}_r=e
return cr=t}function isLight(e){return e&&e.is_lighting}var ur
function getDefaultLights(){if(!ur)ur=[ze({type:Ie,id:d,attr1:Ae.WOOD}),ze({type:Ie,id:d,attr1:Ae.DARK_WOOD}),ze({type:Ie,id:d,attr1:Ae.LIGHT_WOOD}),ze({type:Ie,id:d,attr1:Ae.RED_WOOD})]}function selectLighting(e){if(isLight(getSelectedVisible())){selectByIndex(e?At:wt,true)
return}var t=getItem(Lt)
if(t&&isLight(t)&&Ne(t)){selectByIndex(Lt,true)
return}if(e)return
for(var r=0;r<Bt.length;++r){var a=Bt[r]
if(isLight(a)&&Ne(a)){selectByIndex(r,true)
return}}var i=A()
var o=L(y)
for(var n=0;n<o;++n)if(isLight(i[n])){selectByItem(i[n])
return}getDefaultLights()
for(var s=0;s<ur.length;++s){var l=ur[s]
if(Ne(l)){selectByItem(l)
return}}ee.push($e.STATUSMSG_WOOD_FOR_TORCH)}he.register({show_lighting_hint:{label:"Show hint to use lighting when dark",default_value:1,type:a.TYPE_INT,range:[0,1]}})
function selectLightingInstructions(){if(!he.show_lighting_hint)return""
var e=it()
var r=false
var a=false
function checkSlot(e){var t=getItem(e)
if(t&&isLight(t)&&Ne(t))r=a=true}checkSlot(Lt)
for(var t=0;t<Bt.length;++t)checkSlot(t)
if(!r){getDefaultLights()
for(var i=0;i<ur.length;++i){var o=ur[i]
if(Ne(o))a=true}}if(!a)return""
if(e)if(de.touch_mode)return $e.STATUSMSG_LIGHT_MINI_TOUCH
else return $e.$($e.STATUSMSG_LIGHT_MINI_KB,"[F]")
else if(r)if(de.touch_mode)return $e.STATUSMSG_LIGHT_SLOT_TOUCH
else return $e.$($e.STATUSMSG_LIGHT_SLOT_KB,"[F]")
else if(de.touch_mode)return $e.STATUSMSG_LIGHT_NOSLOT_TOUCH
else{var n=et.prefixShortcutKey("B",$e.LBL_BUILD_MENU)
return $e.$($e.STATUSMSG_LIGHT_NOSLOT_KB,"[F]",n)}}var dr=[]
function showGatheringToolDurability(e){if(se()||ue.defines.NOUI)return 1
var t=e.x,r=e.y,a=e.on_top,i=e.on_left
var o=Z.QUICKBAR
var n=4
var s=(It-(N.length-1)*n)/N.length
var l=4*s
var _=s
var c=!(a||i)
var u=c?t-_:t
var d=c?t-_-n-l:t+n+_
var f=.8*s
var v=.2
var h={x:u-v*(_-n),z:o,w:_*(1+2*v),h:_*(1+2*v)}
if(O()&&a)r+=3*me.font_height
var p=1
for(var m=0;m<C.contents.length;++m){var E=C.contents[m]
var g=false
if(E&&E.has_hp){var T=E.hp_cur/E.hp_max
p=ft(p,T)
var y=dr[m]=dr[m]||{}
if(y.last_frame!==ue.frame_index-1)y.vis=0
y.last_frame=ue.frame_index
if(E.tool_last_use_frame>=ue.frame_index-1)y.vis=ft(1e4,y.vis+ue.frame_dt)
else y.vis=dt(0,y.vis-ue.frame_dt)
var S=Ee((y.vis-150)/250,0,1)
var I=T<.25||O()?1:S
if(I){g=true
h.y=r-v*_
var A=H(E,{})
h.color=b(A.color||R,I)
h.uvs=h.frame=A.frame
A.img.draw(h)
if(E.hp_cur){var w=dt(vt(100*T),E.hp_cur?1:0)
var L=B(T)
if(1!==I)L=ht.styleAlpha(L,I)
ht.drawSizedAligned(L,d,r+(s-f)/2,o+1,f,ht.ALIGN.HCENTERFIT,l,0,w+"%")
me.progressBar({x:d,y:r,z:o,progress:T,w:l,h:s,color:b(P(T),I)})}else pt.draw({x:u,y:r,z:o+.1,w:s,h:s,frame:at.BROKEN})
if(de.mouseOver({x:t,y:r,w:l+_+n,h:s}))me.drawTooltip({x:t,y:r+s,tooltip:E.hp_cur?$e.$($e.TLTP_LOW_DURABILITY,E.getBuildName()):E.getBuildName()})}}if(!a||g)r+=s+n}return p}var fr={}
function tickQuickBar(w){bucketConsistencyCheck()
var L=it()
var O=Ze()
var R=Qe()
var e=!O&&!R
var t=quickbarX0()
var r=quickbarY0()
var b=R?1:0
var N=R?0:1
var a=L?1:he.quickbar_show_recent?2:1
var C=t
var x=r
var M=!L&&w&&(et.page===et.INVENTORY||et.page===et.BUILD)
var D=w&&!M
var i=quickbarViewSlots()
var o=It*(a+i-1)+Mt
var n={x:C-xt,y:x-xt,w:It+b*o+2*xt,h:It+N*o+2*xt,payload:true,peek:true,min_dist:15}
var P=!D&&!ue.defines.NOUI&&!L&&de.drag(n)
var B=bt=false
var k=false
if(P){if(!Rt){Rt=true
if(M)B=true}if(!w||de.keyDown(fe.SHIFT))k=checkRepos(P)
if(R&&P.cur_pos[1]<r+It+Pt||O&&P.cur_pos[0]<t+It+Pt||e&&P.cur_pos[0]>t-Pt){bt=true
Ot+=P.delta[R?0:1]/It
while(kt>0&&Ot>.5){kt--
Ot--}while(kt<quickbarTotalSlots()-i&&Ot<-.5){kt++
Ot++}save()}}else{Nt=At
Rt=false}if(Ot&&!bt){var s=ue.frame_dt*dt(.001,.01*ut(Ot))
if(Ot<0)Ot=ft(0,Ot+s)
else Ot=dt(0,Ot-s)}if(L&&Gt!==Lt)Gt=At
if(L){if(!isLight(getItem(Lt)))Ut=ze({type:Ie,id:Se,attr1:Ae.WOOD})
Ut.from_mini=true}else if(Ut&&Ut.from_mini){Ut.from_mini=false
Ut=null
Gt=wt}if(Gt>=0&&(Gt<kt||Gt>=kt+i)){var l=getItem(Gt)
for(var _=0;_<i;++_){var c=kt+_
var u=Bt[c]
if(!u&&!l||u&&Ke(u,l,"hp")){Gt=c
save()
break}}}if(he.quickbar_show_inhand&&(!w||!he.quickbar_show_recent)){var d=getSelectedVisible()
if(d&&!(d.type===Ie&&d.id===ye)){var f=It*(w?1:1.5)
var v=xt
var h=It+v
var p=2*xt
var m={x:C+(Ze()?h:Xe()?-(f+v):p),y:x+(Qe()?h:p),z:Z.QUICKBAR+5,w:f,shrink:.925,colors:Et,pad_focusable:false,tooltip:$e.$($e.TLTP_TOOL_IN_HAND,d.getBuildName()),auto_count:true,item_context:We}
if(!ue.defines.NOUI){Ge(m,d)
if(ar&&ar.style)ht.drawSizedWrapped(ar.style,m.x+m.w+8,m.y+8,Z.QUICKBAR+5,400,20,me.font_height,d.getBuildName()+"\n"+(d.is_gather?"Details like remaining durability here":"Details like recipe requirements here"))}}}if(!D&&de.keyDownEdge(fe.X))if(Ct)Oe()
else if(L)selectLighting(L)
else if(Gt===wt)selectByIndex(Ft,true)
else selectByIndex(wt,true)
if(!D&&de.keyDownEdge(de.KEYS.F))selectLighting(L)
if(Pe()&&!Ve(Pe()))D=true
var U=true
var G=false?"0":"1"
function quickbarButton(e,t){profilerStart("quickbarButton")
var r=Z.QUICKBAR+5
var a={x:C,y:x,z:r,w:It,h:It,colors:mt,disabled:D,pad_focusable:false,tooltip:et.prefixShortcutKey("B",$e.LBL_BUILD_MENU),img:pt,frame:e,hook:t,in_event_cb:!de.touch_mode&&et.active()&&et.page===et.BUILD?de.pointerLockEnter:null}
var i=null
if(!ue.defines.NOUI)i=me.buttonImage(a)
C+=b*It
x+=N*It
profilerStop("quickbarButton")
return i}function quickbarSlotShared(e){profilerStart("quickbarSlotShared")
var t=e===wt
var r=getItem(e)
var a=!D&&selected(e)
var i=a
var o=Je.isMenuPage(et.QUICK_SLOT)&&e===or
if(o)a=true
if(Nt===e&&!bt&&!k){r=null
a=false}var n=r
if(!t&&!L&&r&&r.has_hp){var s=Ce(r)
if(s)n=s}var l=M
n=xe(n)
var _
if(!de.touch_mode)if(e===Lt)_=et.prefixShortcutKey(G,n?$e.$($e.TLTP_RECENT_ITEM_EXISTING,n.getBuildName()):$e.TLTP_RECENT_ITEM)
else if(n)_=et.prefixShortcutKey(G,n.getBuildName())
var c=fr[e]
if(!c){var u=Z.QUICKBAR+(e<0?5:0)
c=fr[e]={w:qe,h:qe,z:u,pad_focusable:false,auto_count:true,auto_hp:true,key:"qb_"+e,in_event_button:0,item_context:We}}c.x=C
c.y=x
c.colors=a?!r&&!o?Tt:Et:!r?gt:mt
c.disabled=D
c.drag_target=l
c.button_long_press=!L
c.tooltip=_
c.rollover_quiet=false
c.base_name=void 0
c.count_override=void 0
c.flip=false
if(!de.touch_mode){if(r)if(t&&!a)c.tooltip+="\n"+et.prefixShortcutKey("X",$e.TLTP_SWAP_TO_GATHERING)
else if(e===Lt&&!a)c.tooltip+="\n"+et.prefixShortcutKey("X",$e.TLTP_SWAP_TO_RECENT)
if(e===Lt)c.tooltip+="\n"+et.prefixShortcutKey("F",$e.TLTP_SELECT_LANTERN_OR_TORCH)
if(!t){if(!c.tooltip)c.tooltip=$e.TLTP_EMPTY_SLOT
if(a||e===Lt&&selected(wt))c.tooltip+="\n"+et.prefixShortcutKey("Q or Right Click",$e.TLTP_QUICKSLOT_ITEM)
else c.tooltip+="\n"+et.prefixShortcutKey("Right Click",$e.TLTP_QUICKSLOT_ITEM)
if(L)c.tooltip=et.prefixShortcutKey("F",$e.TLTP_TOGGLE_LANTERN)}if(i&&a)if(getCurrentMode()&&!is2x2Locked(r)){if(!r)_e(false,'selected null item with mode "'+getCurrentMode()+'"')
c.tooltip+="\n"+et.prefixShortcutKey("Z",r.flippable?$e.TLTP_QBAR_FLIP:$e.TLTP_CHANGE_BRUSH)}}if(r&&r.flippable&&"flip"===r.mode_list[a?Wt:0])c.flip=true
var d=false
if(r){if(Ye(r)){var f=r.getBID()
var v=we(f)
if(!v.loaded||v.error){c.base_name="inv_empty"
c.count_override=v.error?$e.LBL_ERROR.lower():$e.MSG_LOADING.lower()
d=true}}if(!c.base_name&&!t&&!je(r))if(!Ne(r,true))c.base_name="inv_empty"
if(!t&&r.is_gather)if(!Ce(r)){c.base_name="inv_empty"
d=true}}if(o)c.base_name="inv_selected"
if(d||!r)c.rollover_quiet=true
if(t){c.img=at.sprite
c.frame=U?at.GATHERING_TOOLS:at.HANDS}else{delete c.img
delete c.frame
if(B&&r&&checkPos(P.cur_pos,c))Nt=e}if(l&&!D){var h=Be(c)
c.peek=true
if(h){Te(h.item_context)
if(h.item_context===He&&h.quickbar_default_build)h=ze(h.quickbar_default_build)
if(t)De(h)
else if(shouldEquipTool(h))me.modalDialog({title:$e.DLG_EQUIPMENT_SLOTS_TITLE,text:$e.DLG_EQUIPMENT_SLOTS_MSG,buttons:{OK:null}})
else{setItem(e,h)
selectByIndex(e,true)}}else if(de.dragOver(c))c.tooltip=null
c.peek=false}c.in_event_cb=!L&&!Ct&&selectable(e)&&!de.touch_mode&&!bt&&!w?de.pointerLockEnter:null
var p=0
if(L){if(!ue.defines.NOUI&&Ge(c,r))p++
p+=!D?de.keyDownEdge(fe.TILDE):0}else if(t){p+=!ue.defines.NOUI&&me.buttonImage(c)?1:0
p+=!D?de.keyDownEdge(fe.TILDE):0
Fe("qb_gather",c)
if(!w)showGatheringToolDurability({x:O?C+It+xt+4:R?C:C-xt-4,y:R?x+It+xt+4:x,on_top:R,on_left:O})}else{if(void 0===c.count_override&&c.auto_count&&r){var m=be.countAvailable(r)
c.count_override=m}if(a)r=getCurrentModeMappedProp(r)
r=Me(r)
r=xe(r)
if(!ue.defines.NOUI)if(Ge(c,r)){if(me.button_click&&(2===me.button_click.button||me.button_click.long_press)){selectByIndex(e,true,true)
or=e
Je.toggleMenuPage(et.QUICK_SLOT)}else{var E
if(l)E=Ue()
if(E&&!Ke(getItem(e),E,"hp")){if(e!==Lt&&Ke(getItem(Lt),E,"hp"))setItem(Lt,getItem(e))
setItem(e,E)
selectByIndex(e,true)}else p++}Le.deselect()}}if(a&&!D&&!L&&tt()&&de.keyDownEdge(fe.Q)){var g=t?Lt:e
selectByIndex(g,true,true)
or=g
Je.toggleMenuPage(et.QUICK_SLOT)}var T=!D?de.keyDownEdge(fe[G]):0
if(T){var y
if(l)y=ke()
if(y&&!Ke(getItem(e),y,"hp")){if(!t){setItem(e,y)
selectByIndex(e,true)}}else p+=T}if(a&&getCurrentMode()||L)p+=de.keyDownEdge(fe.Z)
if(d)p=0
if(p)if(Ct)Oe()
else if(L)selectLighting(L)
else for(var S=0;S<p;++S)if(selectByIndex(e))a=true
if(a&&!ue.defines.NOUI){var I=getCurrentModeLabel()
if(I)ht.drawSizedAligned(rt,c.x,c.y,c.z+2,24,ht.ALIGN.HVCENTERFIT,c.w,c.h,I)}C+=b*It
x+=N*It
var A="9"===G?"0".charCodeAt(0):G.charCodeAt(0)+1
G=String.fromCharCode(A)
profilerStop("quickbarSlotShared")}if(!L)quickbarSlotShared(wt)
if(he.quickbar_show_recent||L)quickbarSlotShared(Lt)
C+=b*Mt
x+=N*Mt
var E=It+b*It*(i-1)
var g=It+N*It*(i-1)
if(Ot)pe(Z.QUICKBAR-.1,Z.QUICKBAR+2.1,C,x,E,g)
var T=et.active()&&et.isBuildMenu()
var y=!D&&!T
if(y&&!he.mousewheel_mode&&!de.keyDown(fe.V)||he.mousewheel_mode&&de.keyDown(fe.V)){var S=de.mouseWheel()
if(S&&he.mousewheel_mode)Re()
if(S&&!Ct)selMod(-S,L)}if(y&&!de.keyDown(fe.V)){if((de.padButtonDownEdge(ve.LB)||de.keyDownEdge(fe.PAGEUP))&&!Ct)selMod(-1,L)
if((de.padButtonDownEdge(ve.RB)||de.keyDownEdge(fe.PAGEDOWN))&&!Ct)selMod(1,L)}if(!L){if(T){var I=de.mouseWheel({x:C,y:x,w:E,h:g})
if(I&&!Ct)doScrollView(-I)}var A=0
if(Ot>0&&kt>0){A=-1
C-=b*It
x-=N*It
G=String.fromCharCode(G.charCodeAt(0)-1)}C+=b*It*Ot
x+=N*It*Ot
for(var F=A;F<i+(Ot<0?1:0);++F){var W=kt+F
if(W<0||W>=quickbarTotalSlots())continue
quickbarSlotShared(W)}if(he.split_build){C+=b*Mt
x+=N*Mt
if(quickbarButton(at.BUILD,"new_build"))Je.toggleMenuPage(et.BUILD)}}if(Nt!==At&&!bt&&!k){var H={x:P.cur_pos[0]-It/2,y:P.cur_pos[1]-It/2,z:Z.DRAG,w:It,h:It,disabled:true,base_name:"inv_active",pad_focusable:false,drag_target:true,draw_only:true,hide_count:true,item_context:We}
Ge(H,getItem(Nt))
me.drawTooltip({x:P.cur_pos[0],y:P.cur_pos[1]+20,tooltip:$e.TLTP_QBAR_UNBIND,tooltip_width:140})
if(de.dragDrop()){setItem(Nt,null)
save()}de.mouseOver()}n.peek=false
n.eat_clicks=true
n.min_dist=0
de.drag(n)
if(P)de.dragOver()
if(!ue.defines.NOUI){var z=0
var V=0
var Y=0
var j=0
if(R){if(!ce.safeAreaPadding()[2])z=100}else if(O){if(!ce.safeAreaPadding()[0])V=100}else{if(!ce.safeAreaPadding()[1])Y=100
j=1}var K=It+V+Y+2*xt
var q=It+z+2*xt
me.drawBox({x:t-xt-V,y:r-xt-z,w:K+b*It*(a-1),h:q+N*It*(a-1),z:Z.QUICKBAR-1},me.sprites.quickbar_border,.5,yt)
if(!L){me.drawBox({x:t-xt-V+b*(a*It+Mt)-j*Dt,y:r-xt-z+N*(a*It+Mt),w:K+b*It*(i-1)+N*Dt,h:q+N*It*(i-1)+b*Dt,z:Z.QUICKBAR-1},me.sprites.quickbar_border,.5,yt)
var X=quickbarTotalSlots()
if(i!==X){var Q=2
var $=a*It+Mt+Q
var J=i*It-2*Q
var ee=i/X*J
var te=Dt+2
var re={x:t+(O?It+1:R?$:-(te+1)),y:r+(R?It+1:$),w:R?ee:te,h:R?te:ee}
var ae=J-ee
var ie=(kt-Ot)/(X-i)
if(ie<0){ie=dt(ie,-.95)
re[R?"w":"h"]*=1+ie
ie=0}else if(ie>1){ie=ft(ie,1.95)
re[R?"w":"h"]-=(ie-1)*ae}var oe={x:re.x+b*ie*ae,y:re.y+N*ie*ae,w:re.w,h:re.h,z:Z.QUICKBAR+5}
if(R)me.drawHBox(oe,me.sprites.quickbar_scroll_horiz,St)
else me.drawVBox(oe,me.sprites.quickbar_scroll,St)}if(he.split_build)me.drawBox({x:t-xt-V+b*((a+i)*It+2*Mt),y:r-xt-z+N*((a+i)*It+2*Mt),w:K,h:q,z:Z.QUICKBAR-1},me.sprites.quickbar_border,.5,yt)}if(M)de.dragOver({x:t-xt-V,y:r-xt-z,w:K+b*(It*(i+a-1)+Mt),h:q+N*(It*(i+a-1)+Mt)})}updateLastStatus()
var ne=getPlayerEmit()
if(ne!==Ht){var se=ue.frame_dt/zt
var le=Ee(ne-Ht,-se,se)
Ht=Ee(Ht+=le,0,1)}ot(ge(Ht,2))
Ct=false}},{"../common/ids":249,"../common/materials_common":253,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/settings":351,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/ui.js":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./baking":19,"./blueprint":28,"./build_menu":32,"./build_mode":33,"./camera":35,"./inventory":114,"./inventory_ui":115,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./props":171,"./status":193,"./styles":197,"./tiles":199,"./ui_util":205,"./user_data":208,"./voxel_data":216,"./world_comm":226,"./world_metadata":235,assert:void 0}],173:[function(e,t,r){"use strict"
r.raceResults=raceResults
r.prepareResultsList=prepareResultsList
r.doResultList=doResultList
r.doRaceResults=doRaceResults
var _=e("../glov/client/net").netUserId
var c=e("../glov/client/scroll_area").scrollAreaCreate
var y=e("../glov/client/social").friendIsBlocked
var S=e("../glov/client/ui")
var a=e("../glov/client/ui")
var I=a.buttonWasFocused
var v=a.uiButtonHeight
var i=e("../glov/common/util")
var h=i.defaults
var o=i.merge
var A=i.msToTimeString
var n=e("./fbinstant_worlds")
var s=n.fbCreateRaceTournament
var l=n.fbGetTournamentData
var u=n.fbIsTournamentActive
var d=n.fbLeaveWorldsTournament
var f=n.fbPostSessionScoreAsync
var w=e("./localization/localization").L
var p=e("./main")
var m=p.menuExit
var E=p.toggleMenuPage
var g=e("./menu")
var T=g.RACE_RESULTS
var L=g.getMenuPage
var O=g.menuInteractGetProp
var R=g.menuX1
var b=g.menuY1
var N=g.prefixShortcutKey
var C=e("./props").isSpotlitBuzzer
var x=e("./styles")
var M=x.color_line
var D=x.color_remove_user
var P=x.color_remove_user_alternate
var B=x.color_remove_user_over
var k=x.color_remove_user_viewing
var U=x.color_trophies
var G=x.color_user_alternate
var F=x.color_user_over
var W=x.color_user_self_score
var H=x.color_user_viewing
var z=x.label_style
var V=x.menu_header_style
var Y=x.sublabel_style
var j=e("./ui_util")
var K=e("./user_info_view")
var q=K.formatPresence
var X=K.userInfoGet
var Q=K.userInfoViewing
var $=K.userProfileButton
var J=K.viewUser
var ee=e("./world_comm")
var te=ee.getWorldID
var re=ee.worldBuzzerRemove
var ae=ee.worldGetRoles
var ie=e("./world_info_view")
var oe=ie.refreshWorldInfo
var ne=ie.worldCmdParseGated
var se=ie.worldInfoModifyingAccess
function fbPropHasActiveTournament(e){var t=l()
return t&&e&&t.world_id===te()&&t.buzzer_id===e.buzzer_id&&t.chunk_id===e.chunk_id&&t.pos_idx===e.pos_idx}function fbCheckSubmitToTournament(e,t){if(window.FBInstant&&e)if(fbPropHasActiveTournament(t))f(e.time)}function fbCreateTournamentButton(e,t,r){if(S.buttonText(o({text:w.BTN_CREATE_TOURNAMENT},e)))if(u())S.modalDialog({title:w.DLG_TOURNAMENT_SWITCH_TITLE,text:w.DLG_TOURNAMENT_SWITCH_MSG,buttons:{yes:function yes(){return d(function(){s(te(),t,r)})},no:null}})
else s(te(),t,r)}function fbLeaveTournamentButton(e){if(S.buttonText(o({text:w.BTN_LEAVE_TOURNAMENT},e)))d()}var le
var _e
var ce
var ue=false
function raceResults(e,t,r){le=e.item_id
ue=false
fbCheckSubmitToTournament(ce=r,e)
E(T,e.interactDetails())}function lineSep(e,t,r,a){S.drawLine(e-a/2,t,e+a/2,t,r+.1,2,1,M)}function prepareResultsList(e){var t=[]
var r=0
var a=0
for(var i=0;i<e.length;i++){if(e[i].time>a){r=i+1
a=e[i].time}t.push(h(X(e[i].user_id),{time:e[i].time,rank:r}))}return t}var de=36
var fe=24
var ve=18
var he=36
var pe=30
var me=4
var Ee=125
var ge=2*me+fe+4+ve
var Te=40
var ye=16
var Se=ge/2-20
var Ie=4
var Ae=16
var we=32
var Le=8
var Oe=8
var Re=4*ge/3
var be
function removeResultEntry(e){S.modalDialog({title:w.DLG_REMOVE_SCORE_TITLE,text:w.DLG_REMOVE_SCORE_MSG,buttons:{yes:{cb:function cb(){if(be){ue=false
S.modalDialog({title:w.DLG_REMOVING_SCORE_TITLE,text:w.MSG_PLEASE_WAIT})
re(be,e)}}},no:null}})}function showResultEntry(e,t,r){var a=S.font,i=S.title_font
var o=r.x,n=r.y,s=r.w
var l=Z.UI
var _=s
var c=Ee
var u=n
var d=e.user_id,f=e.display_name,v=e.presence_data
if(e.rank<=3)j.sprite.draw({x:o+ye,y:n+Se,z:l+1,w:Te,h:Te,frame:j.TROPHY,color:U[e.rank]})
i.drawSizedAligned(V,c,n,l+1,e.rank?he:pe,a.ALIGN.HRIGHT|a.ALIGN.VCENTER,0,ge,e.rank?w.$(w.FORMAT_RANK_NUMBER,e.rank):w.RACERESULTS_NO_RANK)
c+=26
var h=Boolean($({user_id:d,show_online_status:true,x:c,y:n,z:l,w:ge,h:ge}))
c+=ge+4
var p=I()
var m=a.drawSizedAligned(V,s-we,n,l+1,de,a.ALIGN.HRIGHT|a.ALIGN.VCENTER,0,1.1*ge,A(e.time))
a.drawSizedAligned(z,s-we-m-Le,n,l+1,fe,a.ALIGN.HRIGHT|a.ALIGN.VCENTER,0,ge+fe/2,w.addColon(w.LBL_ELAPSED_TIME))
var E=S.buttonShared({x:0,y:n-Ie,w:_,h:ge+2*Ie,pad_focusable:false,rollover_quiet:Q(d)})
if(E.ret)h=true
p=p||E.focused
n+=me
var g=f||d
a.drawSizedAligned(z,c+=4,n,l+1,fe,a.ALIGN.HLEFT,_,0,g)
n+=fe+me
if(!y(e.user_id))a.drawSizedAligned(Y,c+Oe,n,l+1,ve,a.ALIGN.HLEFT,_,0,q(v))
n+=ve
n+=me
if(h)if(ue)removeResultEntry(d)
else J({x:c+Re,y:n,user_id:d})
n+=2*Ie
var T
if(Q(d))T=ue?k:H
else if(p)T=ue?B:F
else if(1&t)T=ue?P:G
else if(ue)T=D
if(T)S.drawRect(0,u-Ie,_,n-Ie,l-.5,T)
if(d===_e&&t>-1&&!ue)S.drawRect(0,u-Ie,_,n-Ie,l-.5,W)
return n-u}function doResultList(e,t,r,a){if(!a)ue=false
_e=_()
if(e){if(!e.value)e.value=c({z:Z.UI,background_color:null,auto_hide:true})
e.value.begin(r)
r.y=6}var i=6
var o=r.x,n=r.w
for(var s=0;s<t.length;++s){var l=showResultEntry(t[s],s,{x:o,y:r.y,w:n})
r.y+=l
i+=l}if(e&&e.value)e.value.end(r.y)
return i}var Ne={}
var Ce=16
var xe=80
var Me=200
var De=w.LBL_RACE_RESULTS
function doRaceResults(){if(!(be=O({ignore_distance:true}))||be.item_id!==le){if(L()===T)m()
return De}var e=0
var t=R()
var r=v()
var a=b()
var i=Z.UI
var o=t-e
var n=a-r
var s=r
var l=e+o/2
var _=S.font
var c=prepareResultsList(be.score_table)
if(ce)for(var u=0;u<c.length;u++)if(ce.time===c[u].time&&ce.user_id===c[u].user_id)ce.rank=c[u].rank
s+=Ce
var d=48
if(ce){_.drawSizedAligned(V,l,s,i+1,de,_.ALIGN.HCENTER,0,0,ce.rank?w.RACERESULTS_NEW_BEST:w.RACERESULTS_YOUR_SCORE)
if(window.FBInstant){var f={x:e+o-Me-Ae,y:s+(de-d)/2,w:Me,h:d,font_height:fe}
if(!fbPropHasActiveTournament(be))fbCreateTournamentButton(f,ce.time,be)
else fbLeaveTournamentButton(f)}lineSep(l,s+=de+Ce,i+.1,xe)
s+=8
s+=showResultEntry(h(X(ce.user_id),ce),-1,{x:e,y:s,w:o})
s+=Ce}if(ae().world_owner)if(S.buttonText({x:e+Ae,y:s+(de-d)/2,w:Me,h:d,font_height:fe,disabled:se(),text:C(be)?w.BTN_REMOVE_SPOTLIGHT:w.BTN_SPOTLIGHT_RESULTS,tooltip:C(be)?void 0:w.$(w.TLTP_SPOTLIGHT_RESULTS,N("O",w.LBL_WORLD_INFO_MENU))}))if(C(be))ne("spotlit_buzzer_remove",oe)
else ne("spotlit_buzzer_set "+be.chunk_id+" "+be.pos_idx,oe)
if(ae().world_admin||ae().frozen_owner){if(S.buttonText({x:e+o-Me-Ae,y:s+(de-d)/2,w:Me,h:d,font_height:fe,text:ue?w.BTN_CANCEL_SCORE_REMOVAL:w.BTN_REMOVE_SCORE,tooltip:ue?void 0:w.TLTP_REMOVE_SCORE}))ue=!ue}else ue=false
_.drawSizedAligned(V,l,s,i+1,de,_.ALIGN.HCENTER,0,0,w.$(w.RACERESULTS_ALL_SCORES,c.length))
lineSep(l,s+=de+Ce,i+.1,xe)
doResultList(Ne,c,{x:e,y:s+=2,w:o,h:r+n-s},true)
return w.separateColon(w.LBL_RESULTS,be.buzzer_id)}},{"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/social":357,"../glov/client/ui":367,"../glov/common/util":400,"./fbinstant_worlds":96,"./localization/localization":131,"./main":135,"./menu":140,"./props":171,"./styles":197,"./ui_util":205,"./user_info_view":210,"./world_comm":226,"./world_info_view":231}],174:[function(e,t,r){"use strict"
r.isRacePanelActive=isRacePanelActive
r.raceReady=raceReady
r.possiblyCancelReadyRace=possiblyCancelReadyRace
r.getRacePanelWidth=getRacePanelWidth
r.racePanel=racePanel
r.RACE_PANEL_W=void 0
var a=e("../glov/client/engine")
var u=e("../glov/client/font").ALIGN
var d=e("../glov/client/input")
var i=e("../glov/client/ui")
var f=i.buttonText
var v=i.modalDialog
var h=i.panel
var p=i.uiGetFont
var m=i.uiTextHeight
var o=e("../glov/common/util")
var E=o.msToTimeString
var g=o.nop
var T=e("./localization/localization").L
var y=e("./menu").menuActive
var S=e("./menu")
var n=e("./menu_ribbon").pushMenuRibbonElement
var I=e("./styles").menu_style
var s=e("./user_data").userDataGet
var A=e("./world_comm").worldBuzzerAbandon
var l=e("./worlds_sound").playSound
var _
var w=130
var L=42
var O=16
var R=4
var b=24
var N=w+2*O
r.RACE_PANEL_W=N
var C=2*O+(b+R)+L
function isRacePanelActive(){return Boolean(_)}function raceReady(){return _?Date.now()-_.start<0:false}function possiblyCancelReadyRace(){if(raceReady())A()}function getRacePanelWidth(){return w+2*O}var x
var M=36e5
function drawRacePanel(e,t){var r=e+N/2-w/2
var a=t+O
var i=m()
var o=p()
var n=N-2*O
var s=o.drawSizedAligned(I,r,a,Z.MENUBUTTON,i,u.HLEFT,n,0,T.addColon(x>=0?T.LBL_ELAPSED_TIME:T.LBL_READY_TIME))
var l=E(Math.abs(x))
o.drawSizedAligned(I,r+s+4,a,Z.MENUBUTTON,i,u.HRIGHT|u.HFIT,n-s-4,0,x>=M?l.slice(0,-2):l)
if(f({x:r,y:a+=b+R,z:Z.MENUBUTTON,w:w,h:L,text:T.BTN_ABANDON_RACE})){var _=!d.touch_mode&&!y()?d.pointerLockEnter:null
v({text:T.DLG_LEAVE_RACE_MSG,buttons:{OK:{cb:A,in_event_cb:_},Cancel:{cb:g,in_event_cb:_}}})}var c={x:e,y:t,w:N,h:C}
d.drag(c)
h({x:e,y:t,z:Z.MENUBUTTON-1,w:N,h:C,pixel_scale:.5,color:S.panel_color_popup})}var c=null
function racePanel(){if(!(_=s("race_data"))){c=null
return}if((x=Date.now()-_.start)<0&&!c){c=Math.floor(x/1e3)
l("race_ready")}else if(c){var e=Math.floor(x/1e3)
if(e!==c)if(0===(c=e)){l("race_start")
c=null}else l("race_ready")}if(!a.defines.NOUI)n({w:N,cb:drawRacePanel})}},{"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/ui":367,"../glov/common/util":400,"./localization/localization":131,"./menu":140,"./menu_ribbon":141,"./styles":197,"./user_data":208,"./world_comm":226,"./worlds_sound":236}],175:[function(e,t,r){"use strict"
var a=e("../glov/client/rand_fast.js").randFastCreate
var i=e("../glov/common/rand_alea.js").randCreate
r.createFast=a
r.createGood=i},{"../glov/client/rand_fast.js":347,"../glov/common/rand_alea.js":395}],176:[function(e,t,r){"use strict"
r.setLatestNewsTS=setLatestNewsTS
r.redDotWorldInit=redDotWorldInit
r.redDotIsSeen=redDotIsSeen
r.redDotSeen=redDotSeen
r.redDotDrawNew=redDotDrawNew
r.redDotStartup=redDotStartup
var a=e("../glov/client/cmds").cmd_parse
var i=e("../glov/client/engine")
var o=e("../glov/client/local_storage")
var n=e("../glov/client/net")
var s=n.netClient
var l=n.netSubs
var _=e("../glov/client/ui")
var c=e("../glov/common/vmath").vec4
var u=e("../common/cosmetics_common").Parts
var d=e("../common/ids").ITEM_ENERGY_WELL
var f=e("../common/waygate_upgrade_common").WAYGATE_UPGRADES
var v=e("./cosmetics").getPartTypeFromPart
var h=e("./costume_edit").getCostumePurchaseOptions
var p=e("./item_unlock_ui").itemUnlockGetNew
var m=e("./localization/localization").L
var E=e("./settlement").settlementCurrent
var g=e("./user_data")
var T=g.userDataGet
var y=g.userDataSet
var S=g.userDataSetEx
var I=g.worldReadOnly
var A=e("./world_info_view").worldAdminLogHasNew
var w=e("./world_metadata").adventureMode
var L=Math.min,O=Math.abs,R=Math.sin
var b="w_"
var N=c(1,0,0,1)
var C={}
var x={}
var M
a.register({cmd:"red_dot_reset",help:"(Hidden) Reset all red dots",access_show:["sysadmin"],func:function func(e,t){o.clearAll("reddot_"+e)
C={}
t(null,"Cleared.")}})
a.register({cmd:"world_red_dot_reset",help:"(Hidden) Reset all per-world red dots",access_show:["sysadmin"],func:function func(e,t){y("reddot",void 0)
C={}
t(null,"Cleared.")}})
var D={latest_request_ts:0,user_ts:0,world_ts:0,request_rate:3e4}
function getLatestNewsTS(){if(!s().connected)return D.world_ts<D.user_ts
var e=Date.now()
if(0===D.user_ts&&l().loggedIn()){D.user_ts=l().getMyUserChannel().getChannelData("public.latest_news_ts")||0
D.user_ts=Number(D.user_ts)}if(e-D.latest_request_ts>D.request_rate){D.latest_request_ts=e
s().send("world_global_get","latest_news_ts",null,function(e,t){if(!e)D.world_ts=t})}return D.world_ts<D.user_ts}function setLatestNewsTS(){l().sendCmdParse("latest_news_set_ts "+Date.now(),function(e){if(e)console.log(e)})
D.user_ts=Date.now()}function cosmeticPartRedDotSeen(e){var t=h()
for(var r=0;r<t.parts.length;++r){var a=t.parts[r]
if(!redDotIsSeen("cp."+a))if(v(a)===e)return false}return true}var P={false:function _false(){return false},new_cosmetic:function new_cosmetic(){var e=h()
for(var t=0;t<e.costumes.length;++t)if(!redDotIsSeen("c."+e.costumes[t]))return false
for(var r=0;r<e.parts.length;++r)if(!redDotIsSeen("cp."+e.parts[r]))return false
return true},new_cosmetic_costume:function new_cosmetic_costume(){var e=h()
for(var t=0;t<e.costumes.length;++t)if(!redDotIsSeen("c."+e.costumes[t]))return false
return true},new_cosmetic_head:function new_cosmetic_head(){return cosmeticPartRedDotSeen(u.HEAD)},new_cosmetic_torso:function new_cosmetic_torso(){return cosmeticPartRedDotSeen(u.TORSO)},new_cosmetic_arm:function new_cosmetic_arm(){return cosmeticPartRedDotSeen(u.ARM_R)},new_cosmetic_leg:function new_cosmetic_leg(){return cosmeticPartRedDotSeen(u.LEG_R)},reddot_news_last_seen_ts:function reddot_news_last_seen_ts(){return getLatestNewsTS()},new_build_settlement:function new_build_settlement(){if(!w()||I())return true
var e=E()
if(!e)return true
for(var t in f){var r=f[t]
if(e.unlocked_upgrades[t]&&r.unlocks)for(var a=0;a<r.unlocks.length;++a){var i=r.unlocks[a]
if(i===d)continue
if(!redDotIsSeen("w_b_"+i))return false}}return true},new_build_lf_break:function new_build_lf_break(){if(!w()||I())return true
return 0===p().length},new_build_lf_break_flora:function new_build_lf_break_flora(){if(!w()||I())return true
return 0===p("flora").length},new_build_lf_break_props:function new_build_lf_break_props(){if(!w()||I())return true
return 0===p("props").length},new_build:function new_build(){return P.new_build_settlement()&&P.new_build_lf_break()},new_world_admin_log:function new_world_admin_log(){return!A()}}
function redDotWorldInit(e){x={}}function redDotIsSeen(e){if(Array.isArray(e)){for(var t=0;t<e.length;++t)if(!redDotIsSeen(e[t]))return false
return true}if(P[e])return P[e]()
var r=e.startsWith(b)
if(M&&!r)return true
var a=r?x:C
var i=a[e]
if(!i){i=a[e]={}
if(r)i.seen=T("reddot."+e.slice(b.length))
else i.seen=Boolean(o.get("reddot_"+e))}return i.seen}function redDotSeen(e){var t=e.startsWith(b)
var r=t?x:C
var a=r[e]
if(!a)a=r[e]={}
if(!a.seen){if(t)S("reddot",e.slice(b.length),1)
else o.set("reddot_"+e,1)
a.seen=1}}var B=c(.8,.11,0,1)
function redDotColorPulse(){var e=O(R(i.frame_timestamp/250))
B[3]=e
return B}function redDotDraw(e){if(redDotIsSeen(e.hook))return
var t=L(e.w,e.h)
var r=e.reddot_pad||L(4,.05*t)
var a=e.reddot_r||.125*t
redDotColorPulse()
if("upper_left"===e.reddot_pos)_.drawCircle(e.x+a+r,e.y+a+r,e.z+.1,a,.95,B)
else _.drawCircle(e.x+e.w-a-r,e.y+a+r,e.z+.1,a,.95,B)}function redDotDrawNew(e){var t=e.w?e.x+e.w:e.x
var r=e.h
var a=L(4,.05*r)
var i=.125*r
var o=4.5*i
var n=e.y+a
_.drawCircle((t-=a)-i,n+i,e.z+.1,i,.95,N)
_.drawRect(t-o+i,n,t-i,n+2*i-.5,e.z+.1,N)
_.drawCircle(t-o+i,n+i,e.z+.1,i,.95,N)
_.font.drawSizedAligned(null,t-1.5*a,n+i,e.z+.12,2*i,_.font.ALIGN.HRIGHT|_.font.ALIGN.VCENTER,0,0,m.REDDOT_NEW)}function redDotClick(e){e.hook
if("string"===typeof e.hook&&(e.hook.startsWith("w_b_")||e.hook.startsWith("c.")))redDotSeen(e.hook)}function redDotStartup(){_.addHook(redDotDraw,redDotClick)
if(M=!o.get("reddot_init"))o.set("reddot_init",1)}},{"../common/cosmetics_common":241,"../common/ids":249,"../common/waygate_upgrade_common":266,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/local_storage":329,"../glov/client/net":338,"../glov/client/ui":367,"../glov/common/vmath":402,"./cosmetics":64,"./costume_edit":65,"./item_unlock_ui":118,"./localization/localization":131,"./settlement":181,"./user_data":208,"./world_info_view":231,"./world_metadata":235}],177:[function(e,t,r){"use strict"
r.saplingGetVDWorker=saplingGetVDWorker
r.saplingEqualizeOffsetAndSize=saplingEqualizeOffsetAndSize
r.saplingUpdateLocalTileArray=saplingUpdateLocalTileArray
r.saplingUpdateLocalTileArrayIncremental=saplingUpdateLocalTileArrayIncremental
r.saplingCheckBlockedGrowth=saplingCheckBlockedGrowth
r.saplingUpdateBlocksPrep=saplingUpdateBlocksPrep
r.saplingUpdateBlocksFinish=saplingUpdateBlocksFinish
r.saplingApplyDeletes=saplingApplyDeletes
r.saplingRandomPruning=saplingRandomPruning
r.saplingRandomlyDeleteLeaves=saplingRandomlyDeleteLeaves
r.saplingCompareAndUpdateVD=saplingCompareAndUpdateVD
r.SCBG_GROWTH_READY=r.SCBG_NOT_DONE=r.SCBG_GROWTH_FAILED=r.SAPLING_KEY_NAMES=r.EQUAL_BLOCK_THRESHOLD=void 0
var N=e("assert")
var l=e("../glov/client/engine")
var _=e("../glov/common/perfcounters").perfCounterAdd
var a=e("../glov/common/util").arrayToSet
var i=e("../glov/common/vmath")
var o=i.ivec3
var C=i.v3add
var E=i.v3copy
var x=i.v3iAdd
var n=i.v3iMax
var s=i.v3min
var M=i.v3same
var g=i.v3sub
var h=e("../common/ids").TYPE_BLOCK
var D=e("../common/megachunk_common").posPairFromWorldPos
var c=e("../common/voxel_data_common")
var u=c.createUtilVD
var d=c.voxelDataCreateEmpty
var f=e("./biome_details")
var v=f.TREE_DIM
var p=f.TREE_DIM_HALF
var m=f.TREE_HEIGHT_OFFSET
var T=f.TREE_MAX_HEIGHT
var y=e("./build_mode").addToBagSplatter
var S=e("./editvolume_client").inEditBounds
var I=e("./items").createItem
var A=e("./saplings_shared").saplingGetVD
var w=e("./task_sched")
var L=w.WORKER_GEN
var O=w.taskCreate
var R=w.workerFlush
var b=e("./tiles_const").TILES
var P=e("./voxel_data")
var B=P.getTileLocal
var k=P.getTilePosPair
var U=P.transSetTileLocal
var G=P.transSetTilePosPair
var F=e("./world_metadata").worldItemDrop
var W=Math.floor,H=Math.max,z=Math.min,V=Math.random
var Y=b.DIRT,j=b.GRASS,K=b.LEAVES1,q=b.LEAVES2,Z=b.LEAVES3,X=b.LEAVES4,Q=b.LEAVES5,$=b.SAND,J=b.SNOW
var ee=a([0,Y,j,K,q,Z,X,Q,$,J])
var te=o
var re=.25
r.EQUAL_BLOCK_THRESHOLD=re
var ae=.1
var ie=.25
var oe=["WILLOW","PINE","OAK","POPLAR"]
r.SAPLING_KEY_NAMES=oe
var ne=o(3,3,3)
var se=o(p-1,p-1,m-1)
function saplingGetVDWorker(a,i,e,o){profilerStart("saplingGetVDWorker")
if(0===i){var t=u(ne.slice(0))
t.offset=se.slice(0)
t.age=0
if(o)a.vd_current=t
else a.vd_next=t
return profilerStop("saplingGetVDWorker")}var r=a.seed
var n=a.attr3
_("sapling.getvd")
if(!l.defines.NOWORKERS){if(o)a.working_current=true
else a.working_next=true
O({worker:L,time:0,type:"gen_sapling",data:{age:i,seed:r,type:n,position:e}},function(e){if(!a.existsInWorld())return
N(e.data instanceof Uint8Array)
N(e.size instanceof Int32Array)
N(e.offset instanceof Int32Array)
var t=o?"vd_current":"vd_next"
if(o)a.working_current=false
else a.working_next=false
var r=a[t]
if(!r)r=a[t]=d(e.size)
else r.size=e.size
r.age=i
r.data=e.data
r.offset=e.offset
r.stride1=e.size[0]
r.stride2=e.size[0]*e.size[1]})
R(L)}else{var s=A(i,r,n,e)
s.age=i
if(o)a.vd_current=s
else a.vd_next=s}profilerStop("saplingGetVDWorker")}var le=te()
function vdReoffset(e,t,r){profilerStart("vdReoffset")
var a=e.offset,i=e.size,o=e.data
var n=i[0],s=i[1],l=i[2]
g(le,a,t)
var _=r[0]
var c=_*r[1]
var u=new Uint8Array(c*r[2])
for(var d=0,f=0;d<l;++d){var v=d+le[2]
for(var h=0;h<s;++h){var p=f+n
var m=v*c+(h+le[1])*_+le[0]
while(f<p)u[m++]=o[f++]}}e.data=u
e.size=r.slice(0)
E(e.offset,t)
e.stride1=_
e.stride2=c
profilerStop("vdReoffset")}var _e=te()
var ce=te()
var ue=te()
var de=te()
function saplingEqualizeOffsetAndSize(e,t){var r=e.offset,a=e.size
var i=t.offset,o=t.size
if(M(r,i)&&M(a,o))return false
s(_e,r,i)
C(ue,r,a)
C(ce,i,o)
n(ue,ce)
g(de,ue,_e)
if(!M(r,_e)||!M(a,de)){vdReoffset(e,_e,de)
return true}if(!M(i,_e)||!M(o,de)){vdReoffset(t,_e,de)
return true}N(false)
return false}var fe=te()
var ve=te()
var he=new Uint8Array((v+2)*(v+2)*(T+2))
var pe=te(-p,-p,-m)
var me=te(p,p,m)
function saplingUpdateLocalTileArray(e,t){profilerStart("saplingUpdateLocalTileArray")
var r=t.data,a=t.size
C(ve,t.offset,pe)
x(ve,e)
var i=ve[0]+a[0]
var o=ve[1]+a[1]
var n=ve[2]+a[2]
var s=0
for(fe[2]=ve[2];fe[2]<n;fe[2]++)for(fe[1]=ve[1];fe[1]<o;fe[1]++)for(fe[0]=ve[0];fe[0]<i;fe[0]++,s++)if(r[s])he[s]=B(fe,0)
profilerStop("saplingUpdateLocalTileArray")}function saplingUpdateLocalTileArrayIncremental(e,t,r,a){profilerStart("saplingULTAI")
var i=t.data,o=t.size
if(!r.ulta_started){r.ulta_started=true
r.ulta_zoffs=0}var n=o[0]*o[1]
var s=H(1,W(a/n))
C(ve,t.offset,pe)
x(ve,e)
var l=ve[0]+o[0]
var _=ve[1]+o[1]
var c=ve[2]+o[2]
var u=ve[2]+r.ulta_zoffs
var d=z(c,ve[2]+r.ulta_zoffs+s)
var f=r.ulta_zoffs*n
for(fe[2]=u;fe[2]<d;fe[2]++)for(fe[1]=ve[1];fe[1]<_;fe[1]++)for(fe[0]=ve[0];fe[0]<l;fe[0]++,f++)if(i[f])he[f]=B(fe,0)
var v=d===c
if(!v)r.ulta_zoffs=d-ve[2]
profilerStop("saplingULTAI")
return v}var Ee=[]
var ge
var Te=[]
var ye
var Se
var Ie
var Ae
var we
function floodFillBlockedStart(e,t,r){Ae=t
if(!Ie||Ie.length<t.data.length)Ie=new Uint8Array(t.data.length)
else Ie.fill(0)
ye=ge=0
Se=true
we=false
var a=t.data,i=t.stride1,o=t.stride2
var n=r.data
N.equal(a.length,n.length)
var s=e[2]*o+e[1]*i+e[0]
Ee[ge++]=s}function filli(e,t,r){if(!Ie[r]){var a=e[r]
if(a){var i=he[r]
if(i&&i!==a&&!ee[i]&&i!==t[r]){we=true
return}var o=a>=K&&a<=Q
if(Se){Ie[r]=1
if(o)Te[ye++]=r
else Ee[ge++]=r}else if(o){Ie[r]=1
Te[ye++]=r}}}}function floodFillBlockedCheck(e,t,r,a){N(Ae===t)
var i=t.data,o=t.stride1,n=t.stride2
var s=r.data
N.equal(i.length,s.length)
if(ge||ye){profilerStart("flood fill")
while((Se?ge:ye)&&a>0){var l=Se?Ee[--ge]:Te[--ye]
a-=8
filli(i,s,l+1)
filli(i,s,l-1)
filli(i,s,l+o)
filli(i,s,l-o)
filli(i,s,l+n)
filli(i,s,l-n)
filli(i,s,l+1+o)
filli(i,s,l+1-o)
filli(i,s,l+1+n)
filli(i,s,l+1-n)
filli(i,s,l-1+o)
filli(i,s,l-1-o)
filli(i,s,l-1+n)
filli(i,s,l-1-n)
filli(i,s,l+o+n)
filli(i,s,l+o-n)
filli(i,s,l-o+n)
filli(i,s,l-o-n)
if(Se&&!ge)Se=false}profilerStop()
if(ge||ye)return false}var _=i.length
var c=0
var u=0
var d=0
var f=0
for(var v=0;v<_;v++){var h=i[v]
if(h){var p=h>=K&&h<=Q
if(Ie[v]){c++
if(!p)u++}else{d++
if(!p)f++}}}if(d&&!we);return{visited_count:c,blocked:d,visited_wood:u,blocked_wood:f}}var Le=-1
r.SCBG_GROWTH_FAILED=Le
var Oe=0
r.SCBG_NOT_DONE=Oe
var Re=2
r.SCBG_GROWTH_READY=Re
var be=te()
function saplingCheckBlockedGrowth(e,t,r,a){profilerStart("saplingChkBlkdGrwth")
N(M(t.offset,r.offset))
if(!e.growth_started){g(be,me,t.offset)
e.growth_started=true
floodFillBlockedStart(be,t,r)}var i=floodFillBlockedCheck(be,t,r,a)
if(!i){profilerStop()
return Oe}var o=i.visited_count,n=i.blocked,s=i.blocked_wood
var l=o+n
var _=i.visited_wood+s
profilerStop()
if(n/l>ae||s/_>re)return Le
return Re}var Ne=20
function saplingUpdateBlocksPrep(e,t,r,a,i){profilerStart("saplingUBPrep")
var o=r.data,n=r.size,s=r.stride2
var l=a.data
N(M(r.offset,a.offset))
N(M(n,a.size))
N(r===Ae)
C(ve,r.offset,pe)
x(ve,t)
var _=n[0],c=n[1],u=n[2]
if(!e.update_started){e.update_started=true
e.update_z=0
e.trans_op_queue_by_chunk={}
e.trans_idx_chunk=0
e.trans_idx_sub=0}var d=e.trans_op_queue_by_chunk
var f=e.update_z
var v=f*s
fe[2]=ve[2]+f
var h=f
for(;h<u;h++,fe[2]++){if(i<0)break
fe[1]=ve[1]
for(var p=0;p<c;p++,fe[1]++){fe[0]=ve[0]
for(var m=0;m<_;m++,fe[0]++,v++){var E=o[v]
if(E&&Ie[v]){var g=he[v]
if(E!==g){i-=Ne
var T=D(fe)
var y=T.chunk_id,S=T.idx
var I=d[y]
if(!I)I=d[y]=[]
I.push(y,S,E,0,g)
var A=k([y,S],0,true)
if(A){I.push(y,S,0,1,A)
i-=Ne}}}else{var w=l[v]
if(w){var L=D(fe)
var O=L.chunk_id,R=L.idx
if(w===k([O,R],0)){var b=d[O]
if(!b)b=d[O]=[]
b.push(O,R,0,0,w)
i-=Ne}}}}}i-=.5*s}e.update_z=h
profilerStop()
return h===u}var Ce=300
var xe=100
function cmpNumber(e,t){return e-t}function saplingUpdateBlocksFinish(e,t){profilerStart("saplingUBFinish")
var r=t.trans_op_queue_by_chunk
var a=t.chunk_ids,i=t.trans_idx_chunk,o=t.trans_idx_sub
var n=Ce
if(!a){(a=Object.keys(r).map(function(e){return Number(e)})).sort(cmpNumber)
t.chunk_ids=a}var s=[]
while(i<a.length&&n>0){var l=r[a[i]]
N(l)
var _=l.length
if(n<xe&&_-o>xe){N(!o)
break}while(o<_&&n>0){s[0]=l[o++]
s[1]=l[o++]
var c=l[o++]
var u=Boolean(l[o++])
var d=l[o++]
G(e,s,c,u,true,d,false)
var f=_-o
if(!--n&&f&&f<xe)++n}if(o===_){o=0;++i}}t.trans_idx_chunk=i
t.trans_idx_sub=o
profilerStop()
return i===a.length}function saplingApplyDeletes(e,t,r,a,i){var o=r.data,n=r.size
var s=F()
C(ve,r.offset,pe)
x(ve,t)
for(var l=0;l<a.total;++l){var _=a.to_prune[l]
var c=o[_]
N.equal(c,he[_])
var u=_%n[0]
var d=(_=(_-u)/n[0])%n[1]
var f=(_-d)/n[1]
fe[0]=ve[0]+u
fe[1]=ve[1]+d
fe[2]=ve[2]+f
if(!i||S(fe)){var v=c>=K&&c<=Q
U(e,fe,0,false,true,c,false)
if(s&&!v&&V()<ie)y(e,fe,I({type:h,id:c}),false,true)}}}function saplingRandomPruning(e,t,r){profilerStart("saplingRandomPruning")
N(r<e.total)
var a=e.to_prune
for(var i=t;i<r;++i){var o=i+W(V()*(e.total-i))
var n=a[i]
a[i]=a[o]
a[o]=n}e.total=r
profilerStop("saplingRandomPruning")}function saplingRandomlyDeleteLeaves(e,t,r){profilerStart("saplingRandomlyDeleteLeaves")
var a=e.data.length
var i=t.total
var o=i
var n=t.visited
var s=t.to_prune
for(var l=0;l<a;l++)if(n[l]&&e.data[l]>=K&&e.data[l]<=Q)s[o++]=l
if((t.total=o)>r)saplingRandomPruning(t,i,r)
profilerStop("saplingRandomlyDeleteLeaves")
return t.total-i}function saplingCompareAndUpdateVD(e){profilerStart("saplingCompAUVD")
var t=e.data
var r=t.length
var a=0
var i=0
t.sapling_cleared_count=t.sapling_cleared_count||0
t.sapling_cleared_leaf_count=t.sapling_cleared_leaf_count||0
var o=t.sapling_cleared_count
var n=t.sapling_cleared_leaf_count
for(var s=0;s<r;s++){var l=t[s]
if(l){o++
var _=l>=K&&l<=Q
if(_)n++
if(he[s]!==l){t[s]=0
t.sapling_cleared_count++
if(_)t.sapling_cleared_leaf_count++
continue}else{a++
if(_)i++}}}var c=o-n
var u=a-i
profilerStop("saplingCompAUVD")
return[a,o,u,c]}},{"../common/ids":249,"../common/megachunk_common":254,"../common/voxel_data_common":264,"../glov/client/engine":305,"../glov/common/perfcounters":393,"../glov/common/util":400,"../glov/common/vmath":402,"./biome_details":23,"./build_mode":33,"./editvolume_client":84,"./items":119,"./saplings_shared":179,"./task_sched":198,"./tiles_const":200,"./voxel_data":216,"./world_metadata":235,assert:void 0}],178:[function(e,t,r){"use strict"
r.saplingDebug=saplingDebug
var S=e("../glov/client/cmds").cmd_parse
var o=e("../glov/client/draw_list").opaqueQueue
var I=e("../glov/client/font").ALIGN
var a=e("../glov/client/input")
var A=a.inputClick
var w=a.pointerLockExit
var L=a.pointerLocked
var n=e("../glov/client/quat").unit_quat
var O=e("../glov/client/settings")
var R=e("../glov/client/slider").slider
var b=e("../glov/client/ui")
var s=e("../glov/common/util").clamp
var i=e("../glov/common/vmath")
var l=i.ivec3
var _=i.v3iAdd
var c=i.v3sub
var u=i.vec3
var d=i.zero_vec
var f=e("./biome_details")
var v=f.TREE_DIM_HALF
var h=f.TREE_HEIGHT_OFFSET
var N=e("./main")
var p=e("./saplings").saplingGetVDWorker
var m=e("./saplings_shared")
var E=m.SAPLING_GROWTH_STEPS
var g=m.SAPLING_TO_MODEL
var C=m.saplingPrune
var T=e("./styles")
var x=T.inventory_style_warn
var M=T.label_style
var y=e("./tiles_const").TILES
var D=e("./voxel_data")
var P=D.createSimpleDrawable
var B=D.createUtilVD
var k=D.getLocalPosFromChunkID
var U=D.voxelDataChunkIsReady
var G=Math.floor,F=Math.random,W=Math.round
var H={sapling_seed:{label:"Override sapling seed",default_value:0,type:S.TYPE_INT,range:[0,1e4],access_show:["sysadmin"],formatter:null},sapling_debug_age:{label:"Sapling age for D=SAPLING",default_value:0,type:S.TYPE_FLOAT,range:[1,E],access_show:["sysadmin"],formatter:null},sapling_debug_type:{label:"Sapling type for D=SAPLING",default_value:0,type:S.TYPE_INT,range:[0,3],access_show:["sysadmin"],formatter:function formatter(e){return g[e]||"?"}}}
O.register(H)
var z={seed:-1,attr3:0,existsInWorld:function existsInWorld(){return true},last_age:-1}
function perc(e,t){return e+" ("+(e/t*100).toFixed(1)+"%)"}var V=false
var Y=false
var j=0
function saplingDebugUI(){var e=b.font
var t=100
var r=500
var a=Z.UI
var i=10
var o=100
var n=o+i
var s=16
var l=200
var _=M
for(var c in H){var u=t+i
var d=H[c]
e.drawSizedAligned(_,u,n,a,s,I.HFIT,150,0,c)
if(A({x:u,y:n,w:150,h:s}))N.chat_ui.cmdParse(c+" "+d.default_value)
u+=158
var f=O.get(c)
var v=R(f,{x:u,y:n,z:a,w:l,h:.8*s,min:d.range[0],max:d.range[1]})
if(d.type===S.TYPE_INT)v=W(v)
if(v!==f)N.chat_ui.cmdParse(c+" "+v)
u+=l+8
e.drawSized(_,u,n,a,s,d.formatter?d.formatter(v):""+v)
n+=s}var h=2*s
var p=8*s
if(b.button({x:t+i,y:n,h:h,w:p,text:V?"Thrash: ON":"Thrash: off"}))V=!V
if(b.button({x:t+2*i+p,y:n,h:h,w:p,text:Y?"Grow: ON":"Grow: off"}))if(Y=!Y){j=Date.now()+1e3
N.chat_ui.cmdParse("sapling_debug_age 1")}n+=h
var m=t+2*i
e.drawSized(_,m,n+=s/2,a,s,"Status: "+(z.working_current?"Generating...":"Ready"))
n+=s
if(!z.working_current&&z.vd_current){var E=C(z.vd_current,false)
var g=Object.keys(E.visited).length
var T=g+E.total
e.drawSized(_,m,n,a,s,"Orphan leaves: "+perc(E.leaves_count,T))
e.drawSized(_,m,n+=s,a,s,"Orphan wood: "+perc(E.wood_count,T))
e.drawSized(g/T<=.9?x:_,m,n+=s,a,s,"Good: "+perc(g,T))
n+=s}var y={x:t-i,y:o-i,w:r+2*i,h:(n+=i)-o+2*i,z:a-1}
if(L())if(A(y))w()
b.panel(y)}var K=false
var q=null
var X=u()
var Q=l()
var $=u(.01,.01,.02)
var J=l(v,v,h)
function saplingDebug(){saplingDebugUI()
if(K&&!z.working_current&&z.vd_current){K=false
if(q)q.dispose()
var e=z.vd_current
var t=B(e.size)
for(var r=0;r<e.data.length;++r)t.data[r]=e.data[r]
c(Q,J,e.offset)
var a=Q[0]+Q[1]*e.stride1+Q[2]*e.stride2
t.data[a]=y.COLORED_HUE0
t.updateGeometrySimple({noscale:true})
q=P(t,[Q[0]/7,Q[1]/7,Q[2]/7])}if(q&&U(0))o(function(){k(X,0,d)
_(X,$)
q.draw(X,n,7,{})})
if(!z.working_current){if(V){N.chat_ui.cmdParse("sapling_seed "+G(1e4*F()))
N.chat_ui.cmdParse("sapling_debug_age "+(1+9*F()))}if(Y){var i=s((Date.now()-j)/300+1,1,10)
if(i!==O.sapling_debug_age){N.chat_ui.cmdParse("sapling_debug_age "+i)
if(10===i)Y=false}}if(z.seed!==O.sapling_seed||z.last_age!==O.sapling_debug_age||z.attr3!==O.sapling_debug_type){z.seed=O.sapling_seed
z.last_age=O.sapling_debug_age
z.attr3=O.sapling_debug_type
p(z,z.last_age/E,l(0,0,0),true)
K=true}}}},{"../glov/client/cmds":298,"../glov/client/draw_list":301,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/quat":346,"../glov/client/settings":351,"../glov/client/slider":355,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./biome_details":23,"./main":135,"./saplings":177,"./saplings_shared":179,"./styles":197,"./tiles_const":200,"./voxel_data":216}],179:[function(e,t,r){"use strict"
r.saplingGetVD=saplingGetVD
r.saplingPrune=saplingPrune
r.saplingPruneIncremental=saplingPruneIncremental
r.saplingPruneForProcgen=saplingPruneForProcgen
r.saplingHandleGen=saplingHandleGen
r.SAPLING_TO_MAT=r.SAPLING_TO_MODEL=r.SAPLING_TYPE_POPLAR=r.SAPLING_TYPE_OAK=r.SAPLING_TYPE_PINE=r.SAPLING_TYPE_WILLOW=r.SAPLING_GROWTH_STEPS=void 0
var a=e("./tiles_const").TILES
var i=e("../common/materials_common").Mat
var o=10
r.SAPLING_GROWTH_STEPS=o
var s=0
r.SAPLING_TYPE_WILLOW=s
var l=1
r.SAPLING_TYPE_PINE=l
var _=2
r.SAPLING_TYPE_OAK=_
var c=3
r.SAPLING_TYPE_POPLAR=c
var n=["willow","pine","oak","poplar"]
r.SAPLING_TO_MODEL=n
var u=[i.LIGHT_WOOD,i.RED_WOOD,i.DARK_WOOD,i.WOOD]
r.SAPLING_TO_MAT=u
var d=e("assert")
var f=e("../glov/common/vmath")
var L=f.ivec3
var v=f.v3sub
var h=e("./biome_details")
var p=e("./biome_details")
var m=p.TREE_DIM_HALF
var E=p.TREE_HEIGHT_OFFSET
var g=a.LEAVES1,T=a.LEAVES5
var O=Math.max,R=Math.min
function shrink(e){var t=e.data,r=e.size
var a=r[0],i=r[1],o=r[2]
var n=[Infinity,Infinity,Infinity]
var s=[0,0,0]
var l=[0,0,0]
var _=0
for(l[2]=0;l[2]<o;++l[2])for(l[1]=0;l[1]<i;++l[1])for(l[0]=0;l[0]<a;++l[0],++_)if(t[_])for(var c=0;c<3;++c){n[c]=R(n[c],l[c])
s[c]=O(s[c],l[c])}if(!isFinite(n[0]))n[0]=n[1]=n[2]=0
s[0]+=1
s[1]+=1
s[2]+=1;--n[0];--n[1];--n[2]
var u=s[0]-n[0]+1
var d=s[1]-n[1]+1
var f=s[2]-n[2]+1
var v=0
var h=t
var p=u*d*f
if(n[0]<0||n[1]<0||n[2]<0||u>a||d>i||u*d*f>t.length)h=new Uint8Array(p)
for(var m=0;m<f;++m){var E=n[2]+m
if(E<0||E>=o){for(var g=0;g<u*d;++g)h[v++]=0
continue}for(var T=0;T<d;++T){var y=n[1]+T
if(y<0||y>=i){for(var S=0;S<u;++S)h[v++]=0
continue}for(var I=0;I<u;++I){var A=n[0]+I
if(A>=0&&A<a)h[v++]=t[(E*r[1]+y)*r[0]+A]
else h[v++]=0}}}e.size=L(u,d,f)
e.stride1=e.size[0]
e.stride2=e.size[0]*e.size[1]
e.data=h.slice(0,v)
var w=e
w.offset=L(n[0],n[1],n[2])
return w}function saplingGetVD(e,t,r,a){var i
if(r===s)i=h.genWillowV2(null,null,e,t)
else if(r===l)i=h.genPineV2(null,null,e,t,false)
else if(r===_)i=h.genOakV2(null,null,e,t)
else if(r===c)i=h.genPoplarV2(null,null,e,t)
else d(false)
var o=m+m*i.stride1+E*i.stride2
i.data[o]=0
var n=shrink(i)
d(n.size instanceof Int32Array)
d(n.offset instanceof Int32Array)
return n}var y=[]
var S
var I=[]
var A
var w
var b
var N
function floodFillPruneIncStart(e,t,r){N=r
if(!b||b.length<r.data.length)b=new Uint8Array(r.data.length)
else b.fill(0)
A=S=0
w=true
var a=r.stride1,i=r.stride2
var o=t[2]*i+t[1]*a+t[0]
y[S++]=o}function floodFillPruneFinish(e,t){profilerStart("floodFillPruneFinish")
var r=[]
var a=[]
var i=t.data
var o=i.length
var n=0
var s=0
for(var l=0;l<o;l++)if(!e[l]){var _=i[l]
if(_)if(_>=g&&i[l]<=T)a[s++]=l
else r[n++]=l}var c=s
for(var u=0;u<n;++u)a[c++]=r[u]
profilerStop()
return{to_prune:a,total:c,leaves_count:s,wood_idx:s,wood_count:n,visited:e}}function floodFillPruneIncFinish(e){profilerStart("floodFillPruneIncFinish")
var t=[]
var r=[]
var a=e.data
var i=a.length
var o=0
var n=0
for(var s=0;s<i;s++)if(!b[s]){var l=a[s]
if(l)if(l>=g&&a[s]<=T)r[n++]=s
else t[o++]=s}var _=n
for(var c=0;c<o;++c)r[_++]=t[c]
profilerStop()
return{to_prune:r,total:_,leaves_count:n,wood_idx:n,wood_count:o,visited:b}}function filli(e,t){if(!b[t]){var r=e.data[t]
if(r){var a=r>=g&&r<=T
if(w){b[t]=1
if(a)I[A++]=t
else y[S++]=t}else if(a){b[t]=1
I[A++]=t}}}}function floodFillPruneIncWork(e,t,r){d(N===t)
var a=t.stride1,i=t.stride2
if(S||A){profilerStart("flood fill")
while((w?S:A)&&r>0){var o=w?y[--S]:I[--A]
r-=8
filli(t,o+1)
filli(t,o-1)
filli(t,o+a)
filli(t,o-a)
filli(t,o+i)
filli(t,o-i)
filli(t,o+1+a)
filli(t,o+1-a)
filli(t,o+1+i)
filli(t,o+1-i)
filli(t,o-1+a)
filli(t,o-1-a)
filli(t,o-1+i)
filli(t,o-1-i)
filli(t,o+a+i)
filli(t,o+a-i)
filli(t,o-a+i)
filli(t,o-a-i)
if(w&&!S)w=false}profilerStop()
if(S||A)return false}return floodFillPruneIncFinish(t)}var C=null
function floodFillPrune(e,t,a){profilerStart("top")
var i=[]
var o=[]
if(!C||C.length<t.data.length)C=new Uint8Array(t.data.length)
else C.fill(0)
var n=C
var s=t.data,r=t.stride1,l=t.stride2
var _=true
function fill(e){if(!n[e]){var t=s[e]
if(t){var r=t>=g&&t<=T
if(_)if(r){if(!a){n[e]=1
o.push(e)}}else{n[e]=1
i.push(e)}else if(r){n[e]=1
i.push(e)}}}}var c=e[2]*l+e[1]*r+e[0]
i.push(c)
while(i.length){var u=i.pop()
fill(u+1)
fill(u-1)
fill(u+r)
fill(u-r)
fill(u+l)
fill(u-l)
fill(u+1+r)
fill(u+1-r)
fill(u+1+l)
fill(u+1-l)
fill(u-1+r)
fill(u-1-r)
fill(u-1+l)
fill(u-1-l)
fill(u+r+l)
fill(u+r-l)
fill(u-r+l)
fill(u-r-l)
if(!i.length&&_){_=false
i=o}}profilerStop()
return floodFillPruneFinish(n,t)}var x=L()
var M=L(m,m,E)
function saplingPrune(e,t){profilerStart("saplingPrune")
v(x,M,e.offset)
var r=floodFillPrune(x,e,t)
profilerStop("saplingPrune")
return r}function saplingPruneIncremental(e,t,r){profilerStart("saplingPruneIncremental")
if(!t.prune_started){v(x,M,e.offset)
t.prune_started=true
floodFillPruneIncStart(t,x,e)}var a=floodFillPruneIncWork(t,e,r)
profilerStop("saplingPruneIncremental")
return a}var D=L()
function saplingPruneForProcgen(e){var t=e
d(!t.offset)
t.offset=D
var r=saplingPrune(t,false)
var a=r.to_prune,i=r.total
for(var o=0;o<i;++o)t.data[a[o]]=0}function saplingHandleGen(e,t){var r=saplingGetVD(e.age,e.seed,e.type,e.position)
t({size:r.size,data:r.data,offset:r.offset},[r.data.buffer])}},{"../common/materials_common":253,"../glov/common/vmath":402,"./biome_details":23,"./tiles_const":200,assert:void 0}],180:[function(e,t,r){"use strict"
r.doSettings=doSettings
r.settingsMenuClear=settingsMenuClear
r.settingsMenuInit=settingsMenuInit
var G=e("../glov/client/browser").is_discrete_gpu
var a=e("../glov/client/client_config")
var F=a.getAbilityChat
var i=a.getAbilityReload
var W=e("../glov/client/engine")
var o=e("../glov/client/engine_cmds").resetSettings
var H=e("../glov/client/font").ALIGN
var n=e("../glov/client/fscreen")
var z=n.fscreenActive
var V=n.fscreenAvailable
var Y=n.fscreenExit
var j=e("../glov/client/input")
var K=e("../glov/client/scroll_area").scrollAreaCreate
var s=e("../glov/client/slider")
var q=s.slider
var X=s.sliderIsDragging
var l=e("../glov/client/ui")
var Q=l.button
var $=l.buttonText
var J=l.modalDialog
var ee=l.uiButtonHeight
var _=l.uiGetFont
var c=l.uiGetTitleFont
var te=l.uiTextHeight
var re=e("../glov/common/util").clamp
var ae=e("./analytics.js").logEvent
var ie=e("./app_access").accessAllowFeedback
var u=e("./character_controller_constants.js")
var oe=u.MAX_CAMERA_DISTANCE
var ne=u.MIN_CAMERA_DISTANCE
var se=e("./credits_menu").doCreditsMenu
var le=e("./feedback").feedbackShow
var _e=e("./inventory")
var ce=e("./inventory").inventoryReset
var d=e("./layout")
var ue=d.TALL
var de=d.canChangeLayout
var fe=d.layoutCameraCurX1
var ve=d.layoutCameraCurY1
var he=d.layoutCameraTallWideMode
var pe=e("./localization/localization").L
var me=e("./main")
var f=e("./menu")
var Ee=f.PANEL_PAD
var ge=f.doQuickSlotMenu
var Te=f.fscreenEnterAndOrient
var ye=f.menuDoTransition
var Se=f.menuX1
var Ie=f.menuY1
var Ae=f.setFadePanel
var we=e("./orient")
var v=e("./styles")
var Le=v.color_black
var Oe=v.inventory_style
var Re=v.menu_header_style
var be=e("./tutorial").tutorialStartByName
var Ne=e("./ui_util")
var Ce=e("./user_data").worldReadOnly
var xe=e("./user_profile_view.js").userProfileViewOpen
var h=e("./voxel_chunk_manager")
var Me=h.detailBudgetToPercentage
var De=h.getDetailBudget
var Pe=h.getViewDist
var Be=e("./voxel_data")
var ke=e("./world_comm").getWorldChannel
var Ue=e("./world_metadata").adventureMode
var Ge=e("../glov/client/net").netBuildString
var Fe=e("../glov/client/settings")
var We=Math.round
function toggleAA(){Fe.set("aa",1-Fe.aa)
if(Boolean(Fe.aa)!==Boolean(W.antialias))J({title:pe.DLG_AA_CHANGED_TITLE,text:i()?pe.DLG_AA_CHANGED_RESTART_MSG:pe.DLG_AA_CHANGED_QUIT_MSG,buttons:{Yes:W.reloadSafe,No:null}})}function resetSettingsAfterPrompt(){var e=o()
if(e){me.chat_ui.handleCmdParse(null,e)
J({title:pe.DLG_RESET_DEFAULTS_DONE_TITLE,text:i()?pe.DLG_RESET_DEFAULTS_REQUIRED_RESTART_MSG:pe.DLG_RESET_DEFAULTS_REQUIRED_QUIT_MSG,buttons:{Yes:W.reloadSafe,No:null}})}else J({title:pe.DLG_RESET_DEFAULTS_DONE_TITLE,text:pe.DLG_RESET_DEFAULTS_NOTHING_MSG,buttons:{OK:null}})}var He
var ze
var Ve
var Ye=false
var je=false
var Ke="☎"
var qe="☏"
var Ze=Fe.volume
function doSettings(l){var e=he()
var _=0
var c=254
var t=(3*c+Ee)/2
var u=36
function settingsButtonWithIcon(e,t,r,a,i,o,n){var s=Q({x:_,y:l,w:a||c,font_height:o||u,text:e,in_event_cb:i,hook:n,img:t,img_color:Le,frame:r})
_+=(a||c)+Ee
return s}function settingsButton(e,t,r,a,i){var o=$({x:_,y:l,w:t||c,font_height:a||u,text:e,in_event_cb:r,hook:i})
_+=(t||c)+Ee
return o}var n=ee()
var s=200
var d=80
var f=n
function volumeSlider(e,t,r){He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(t))
var a=(_+=s+8)+d+8
var i=We(100*Fe[e])/100
var o=We(100*q(i,{x:a,y:l+(n-f)/2,min:0,max:1,w:c,h:f}))
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,pe.addPercentage(o))
if((o/=100)!==i)r(e,o)
_=a+c+Ee}function crlf(){_=16
l+=n+Ee}function category(e,t){if(!t)crlf()
ze.drawSized(Re,0,l,Z.UI,32,e)
l+=40}if(settingsButton(pe.BTN_EXIT_TO_MAIN_MENU,t)){ae("exit_to_main_menu_button",1,"button","settings")
me.returnToMainMenu()}if(ie()&&settingsButton(pe.BTN_BUGS_FEEDBACK))le()
if(je){if(settingsButton("Settings"))je=false
crlf()
se(l)
if(Ye)Ye=je=false
return}else if(settingsButton("Credits"))je=true
crlf()
if(!Ve)Ve=K({z:Z.UI,background_color:null,auto_hide:true})
Ve.keyboardScroll()
var r=Ve.barWidth()
var a={x:0,y:l,w:fe(),h:ve()-l}
Ve.begin(a)
_=16
l=0
if(settingsButton(pe.BTN_RESET_DEFAULTS))J({title:pe.DLG_RESET_DEFAULTS_TITLE,text:pe.DLG_RESET_DEFAULTS_MSG,buttons:{OK:resetSettingsAfterPrompt,Cancel:null}})
if(settingsButtonWithIcon(pe.BTN_MY_PROFILE,Ne.sprite,Ne.USER_PROFILE)){ye()
xe("me")}crlf()
category(pe.LBL_AUDIO,true)
volumeSlider("volume",pe.LBL_VOLUME_MASTER,function(e,t){Ze=t
Fe.set(e,t)})
if(settingsButton(0===Fe.volume?qe:Ke,n,null,.85*n)){var i=0===Fe.volume?Ze||1:0
Ze=i||Ze
Fe.set("volume",i)}crlf()
volumeSlider("volume_music",pe.LBL_VOLUME_MUSIC,Fe.set)
if(e===ue)crlf()
volumeSlider("volume_sound",pe.LBL_VOLUME_SOUND,Fe.set)
crlf()
category(pe.LBL_GRAPHICS,true)
_+=c+Ee
He.drawSizedAligned(Oe,_-8,l,Z.UI,u,H.VCENTER|H.HRIGHT,0,n,pe.addColon(pe.LBL_PRESET))
if(settingsButton(pe.BTN_FAST)){me.chat_ui.cmdParseInternal("bevel 0")
Fe.set("render_scale",.5)
Fe.set("detail_budget",.5)
Fe.set("view_dist",8)
Fe.set("fov_third_override",0)
Fe.set("fov",50)
Fe.set("shadows",0)
if(Fe.aa)toggleAA()}if(settingsButton(pe.BTN_PRETTY)){me.chat_ui.cmdParseInternal("bevel 1")
Fe.set("render_scale",1)
Fe.set("detail_budget",.5)
Fe.set("view_dist",15)
Fe.set("fov_third_override",0)
Fe.set("fov",60)
Fe.set("shadows",1)
if(!Fe.aa)toggleAA()}crlf()
if(Be.bevel_available)if(settingsButton(Be.bevel_value?pe.BTN_SHADERS_SHINY:pe.BTN_SHADERS_MEH))me.chat_ui.cmdParseInternal("bevel "+(1-Be.bevel_value))
if(!W.antialias_unavailable){var o=Boolean(Fe.aa)!==Boolean(W.antialias)
if(settingsButton(Fe.aa?o?pe.BTN_AA_ON_PENDING:pe.BTN_AA_ON:o?pe.BTN_AA_OFF_PENDING:pe.BTN_AA_OFF))toggleAA()}if(settingsButton(Fe.shadows?pe.BTN_SHADOWS_ON:pe.BTN_SHADOWS_OFF))me.chat_ui.cmdParseInternal("shadows "+(1-Fe.shadows))
crlf()
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(pe.LBL_RESOLUTION_SCALE))
_+=s+8
var v=re(We(100*Fe.render_scale),25,100)
var h=_+d+8
var p=We(q(v,{x:h,y:l+(n-f)/2,min:25,max:100,w:c,h:f}))
if(p>95)p=100
else if(p>63&&p<71)p=66.666666667
else if(p>45&&p<55)p=50
else if(p>30&&p<36)p=33.333333333
else if(p>23&&p<27)p=25
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,pe.addPercentage(We(p)))
if(p!==v)Fe.set("render_scale",p/100)
if(X())Ae(true)
_=h+c+Ee
if(e===ue)crlf()
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(pe.LBL_FIELD_OF_VIEW))
_+=s+8
var m="fov"
var E=We(Fe[m])
var g=We(q(E,{x:h=_+d+8,y:l+(n-f)/2,min:40,max:100,w:c,h:f}))
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,""+g)
if(g!==E){Fe.setAsync(m,g)
if(Fe.camera_view)Fe.setAsync("fov_third_override",0)}if(X())Ae(true)
_=h+c+Ee
crlf()
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(pe.LBL_VIEW_DISTANCE))
_+=s+8
var T=re(Pe(),5,G?30:15)
var y=We(q(T,{x:h=_+d+8,y:l+(n-f)/2,min:5,max:G?30:15,w:c,h:f}))
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,""+y)
if(y!==T)Fe.set("view_dist",y)
_=h+c+Ee
if(e===ue)crlf()
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(pe.LBL_DETAIL_BUDGET))
_+=s+8
var S=We(100*re(De(),.05,1))
var I=We(q(S,{x:h=_+d+8,y:l+(n-f)/2,min:5,max:100,w:c,h:f}))
if(I>45&&I<55)I=50
else if(I>95)I=100
var A=We(100*Me(I/100))
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,isFinite(A)?pe.addPercentage(A):"∞")
if(I!==S)Fe.set("detail_budget",I/100)
if(X())Ae(true)
_=h+c+Ee
category(pe.LBL_CONTROLS)
if(settingsButton(Fe.fly_relative?pe.BTN_FLY_RELATIVE:pe.BTN_FLY_ALT_LOCKED))Fe.set("fly_relative",Fe.fly_relative?0:1)
if(settingsButton(Fe.camera_view?pe.BTN_CAMERA_TP:pe.BTN_CAMERA_FP))Fe.setAsync("camera_view",Fe.camera_view?0:1)
var w=j.touch_mode?"max_jump_tap_touch":"max_jump_tap_kb"
if(settingsButton(Fe[w]?pe.BTN_MAX_JUMP_TAP:pe.BTN_MAX_JUMP_HOLD))Fe.setAsync(w,Fe[w]?0:1)
if(e===ue)crlf()
if(!j.touch_mode&&settingsButton(Fe.mousewheel_mode?pe.BTN_MOUSEWHEEL_ZOOM:pe.BTN_MOUSEWHEEL_QUICKBAR))Fe.set("mousewheel_mode",Fe.mousewheel_mode?0:1)
if(!j.touch_mode&&settingsButton(pe.BTN_SHOW_CONTROLS)){var L=pe.CONTROLS_FORMAT_DESC
J({title:pe.DLG_CONTROLS_TITLE,text:[pe.addColon(pe.CONTROLS_SECTION_MOVEMENT),"  "+pe.$(L,"WASD",pe.CONTROLS_MOVE),"  "+pe.$(L,pe.INPUT_KEY_SPACE,pe.CONTROLS_JUMP_FLY),"  "+pe.$(L,"C",pe.CONTROLS_FLY_DOWN),"  "+pe.$(L,pe.INPUT_KEY_SHIFT,pe.CONTROLS_SPRINT),"  "+pe.$(pe.CONTROLS_DOUBLE_JUMP,pe.INPUT_KEY_SPACE),"  "+pe.$(L,"V",pe.CONTROLS_TOGGLE_VIEW),pe.addColon(pe.CONTROLS_SECTION_BUILDING),"  "+pe.$(L,pe.$(pe.CONTROLS_FORMAT_OR,pe.INPUT_CLICK_LEFT,"R"),pe.CONTROLS_PLACE_DESTROY),"  "+pe.$(L,pe.INPUT_CLICK_MIDDLE,pe.CONTROLS_PICK),"  "+pe.$(L,pe.INPUT_CLICK_RIGHT,pe.CONTROLS_UNLOCK_MOUSE),ge()?"  "+pe.$(L,"Q",pe.CONTROLS_QUICK_SLOT)+"\n  "+pe.$(L,"B",pe.CONTROLS_BUILD_MENU):"  "+pe.$(L,pe.$(pe.CONTROLS_FORMAT_OR,"Q","B"),pe.CONTROLS_BUILD_MENU),"  "+pe.$(L,pe.$(pe.CONTROLS_FORMAT_OR,pe.INPUT_KEY_TAB,pe.INPUT_DRAG_QBAR),pe.CONTROLS_SCROLL_QBAR),"  "+pe.$(L,"1-8",pe.CONTROLS_SELECT_QBAR),"  "+pe.$(L,pe.$(pe.CONTROLS_FORMAT_OR,"Z",pe.$(pe.CONTROLS_FORMAT_AGAIN,"1-8")),pe.CONTROLS_CYCLE_SIZES),"  "+pe.$(L,"X",pe.CONTROLS_TOGGLE_GATHERING),pe.addColon(pe.CONTROLS_SECTION_OTHER),"  "+pe.$(L,"E",pe.CONTROLS_OPEN_MENU),"  "+pe.$(L,"F",pe.CONTROLS_TORCH),"  "+pe.$(L,"I",pe.CONTROLS_INV_MENU),"  "+pe.$(L,"O",pe.CONTROLS_WORLD_MENU),"  "+pe.$(L,"P",pe.CONTROLS_SOCIAL_MENU),"  "+pe.$(L,"F8",pe.CONTROLS_TOGGLE_HUD),"  "+pe.$(L,"F9",pe.CONTROLS_PHOTO_MODE),"  "+pe.$(L,"F11",pe.CONTROLS_FULLSCREEN),"  "+pe.$(L,pe.INPUT_KEY_ENTER,pe.CONTROLS_CHAT)].join("\n"),width:750,y0:70,buttons:{OK:null}})}if(j.touch_mode&&settingsButton(pe.BTN_SHOW_CONTROLS)){var O=pe.CONTROLS_FORMAT_DESC
J({title:pe.DLG_CONTROLS_TITLE,text:[pe.addColon(pe.CONTROLS_SECTION_MOVEMENT),"  "+pe.$(O,pe.INPUT_LEFT_PAD,pe.CONTROLS_MOVE),"  "+pe.$(O,pe.INPUT_DRAG_SCREEN,pe.CONTROLS_LOOK),"  "+pe.$(O,pe.INPUT_JUMP_BUTTON,pe.CONTROLS_JUMP),"  "+pe.$(O,pe.INPUT_JUMP_BUTTON_DOUBLE,pe.CONTROLS_FLY),"  "+pe.$(O,pe.INPUT_PINCH,pe.CONTROLS_ZOOM),pe.addColon(pe.CONTROLS_SECTION_BUILDING),"  "+pe.$(O,pe.INPUT_IN_WORLD_TAP,pe.CONTROLS_ON_TAP),"  "+pe.$(O,pe.INPUT_IN_WORLD_HOLD,pe.CONTROLS_ON_HOLD)].join("\n"),width:750,y0:70,buttons:{OK:null}})}crlf()
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(j.touch_mode?pe.LBL_LOOK_SENSITIVITY:pe.LBL_MOUSE_SENSITIVITY))
_+=s+8
var R=We(100*Fe.mouse_sensitivity)
var b=We(q(R,{x:h=_+d+8,y:l+(n-f)/2,min:10,max:150,w:c,h:f}))
if(b>95&&b<105)b=100
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,""+b)
if(b!==R)me.chat_ui.cmdParseInternal("mouse_sensitivity "+b/100)
_=h+c+Ee
if(1===Fe.camera_view){if(e===ue)crlf()
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.VCENTER|H.HFIT,s,n,pe.addColon(pe.LBL_CAMERA_DISTANCE))
_+=s+8
var N=Fe.camera_max_distance
var C=We(q(N,{x:h=_+d+8,y:l+(n-f)/2,min:ne,max:oe,w:c,h:f}))
He.drawSizedAligned(Oe,_,l,Z.UI,u,H.HFIT|H.HRIGHT|H.VCENTER,d,n,""+C)
if(C!==N)Fe.set("camera_max_distance",C)
_=h+c+Ee}category(pe.LBL_INTERFACE)
var x=V()
if(x)if(z()){if(settingsButton(pe.BTN_EXIT_FULLSCREEN)){Y()
we.unlock()}}else settingsButton(j.touch_mode?pe.BTN_FULLSCREEN:pe.$(pe.BTN_FULLSCREEN_KEY,"F11"),void 0,Te)
var M=we.enabled()
if(M)settingsButton(pe.BTN_ORIENTATION,void 0,we.toggle)
if(x||M)crlf()
var D=de()
if(D)if(settingsButton([pe.BTN_QBAR_AUTO,pe.BTN_QBAR_LEFT,pe.BTN_QBAR_RIGHT,pe.BTN_QBAR_TOP][Fe.layout_quickbar]))Fe.set("layout_quickbar",(Fe.layout_quickbar+1)%4)
var P=F()&&me.omp
if(P&&settingsButton(Fe.chat_auto_unfocus?pe.BTN_CHAT_UNFOCUS:pe.BTN_CHAT_KEEP_FOCUS))Fe.set("chat_auto_unfocus",1-Fe.chat_auto_unfocus)
if(D||P)crlf()
if(settingsButton([pe.BTN_UIS_INTEGRATED,pe.BTN_UIS_SEPARATE][Fe.split_factory],t)){var B=1-Fe.split_factory
Fe.set("split_factory",B)
Fe.set("split_container",B)
Fe.set("split_waygate",B)}if(settingsButton([pe.BTN_BUILD_INTEGRATED,pe.BTN_BUILD_SEPARATE][Fe.split_build],t))Fe.set("split_build",1-Fe.split_build)
if(window.OneTrust){if(e===ue)crlf()
if(settingsButton(pe.BTN_MANAGE_CONSENT))try{window.OneTrust.ToggleInfoDisplay()}catch(e){}}crlf()
if(!Ce()){category(pe.LBL_DEBUG,true)
if(settingsButton(pe.BTN_RESET_INVENTORY))J({title:pe.DLG_RESET_INV_TITLE,text:pe.DLG_RESET_INV_MSG,buttons:{OK:function OK(){if(ke())ce()},Cancel:null}})
if(Ue()){if(settingsButton(pe.BTN_RESET_TUTORIAL))be("adventure_start",true)
if(W.DEBUG)crlf()}if(W.DEBUG){if(settingsButton("Debug: Materials"))_e.debugMaterials()
if(settingsButton("Debug: Blocks"))_e.debugBlocks()}crlf()}Ve.end(l)
var k=Ve.isVisible()?r+4:0
var U=te()
He.drawSizedAligned(Oe,Se()-k,Ie()-.75*U,Z.UI,.75*U,H.HRIGHT|H.VBOTTOM,0,0,pe.separateColon(pe.LBL_RENDERER,"WebGL"+(W.webgl2?2:1)))
He.drawSizedAligned(Oe,Se()-k,Ie(),Z.UI,.75*U,H.HRIGHT|H.VBOTTOM,0,0,pe.separateColon(pe.LBL_VERSION,Ge()))}function settingsMenuClear(){if(je)Ye=true}function settingsMenuInit(){He=_()
ze=c()
je=false}},{"../glov/client/browser":293,"../glov/client/client_config":297,"../glov/client/engine":305,"../glov/client/engine_cmds":306,"../glov/client/font":315,"../glov/client/fscreen":317,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/settings":351,"../glov/client/slider":355,"../glov/client/ui":367,"../glov/common/util":400,"./analytics.js":6,"./app_access":12,"./character_controller_constants.js":38,"./credits_menu":71,"./feedback":97,"./inventory":114,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./orient":148,"./styles":197,"./tutorial":203,"./ui_util":205,"./user_data":208,"./user_profile_view.js":212,"./voxel_chunk_manager":214,"./voxel_data":216,"./world_comm":226,"./world_metadata":235}],181:[function(e,t,r){"use strict"
r.isSettlement=isSettlement
r.Settlement=Settlement
r.settlementFromVolume=settlementFromVolume
r.settlementGet=settlementGet
r.settlementForPos=settlementForPos
r.settlementCurrent=settlementCurrent
r.settlementLastBound=settlementLastBound
r.settlementLastBoundID=settlementLastBoundID
r.settlementGetLazyAsync=settlementGetLazyAsync
r.settlementUpdate=settlementUpdate
r.settlementBeamDraw=settlementBeamDraw
var s=e("assert")
var n=e("./app_access.js").accessPrerelease
var f=e("./camera.js").getCurrentCameraPos
var a=e("../glov/client/cmds.js").cmd_parse
var v=e("./draw_sprite3d.js").drawSprite3D
var i=e("./editvolume_client.js"),o=i.editVolumeById,l=i.editVolumeForPos
var h=e("../glov/client/engine.js")
var p=e("./fx_util.js").fxUtilGlow
var m=e("../common/globals.js").CHUNK_SIZE
var _=Math.abs,E=Math.max,g=Math.min
var c=e("./main.js").charControllerPos
var u=e("./megachunk_client.js"),d=u.megachunkForVolumeID,T=u.megachunkGetSettlement
var y=e("./photo_mode.js").photoModeActive
var S=e("../glov/client/settings.js")
var I=e("../common/settlement_common.js").settlementTier
var A=e("../glov/client/sprites.js"),w=A.blendModeReset,L=A.blendModeSet,O=A.BLEND_ADDITIVE
var R=e("./user_data.js").userHomeSettlementID
var b=e("../glov/common/util.js"),N=b.clamp,C=b.clone,x=b.easeInOut,M=b.lerp
var D=e("../glov/common/vmath.js"),P=D.vec2,B=D.vec3,k=D.v2dist,U=D.vec4
var G=e("./sky.js").skyShowLODs
var F=e("./waygate_upgrade.js"),W=F.WAYGATE_TIERS,H=F.WAYGATE_UPGRADES
var z=e("../common/world_constants.js"),V=z.VOLUME_SETTLEMENT_PREFIX,Y=z.WAYGATE_FLAG_SETTLEMENT
var j=e("./world_metadata.js"),K=j.worldMetadataWaygate,q=j.worldMetadataWaygates,Z=j.worldSettlements
var X=e("../common/world_trans.js").decodeWorldPos
var Q=e("./voxel_data.js"),$=Q.localPosFromWorldPos,J=Q.worldPosFromLocalPos
var ee=e("./voxel_chunk_manager.js")
var te=2
function isSettlementRaw(e,t){return(null==t?void 0:t.flags)&Y}function isSettlement(e){return Z()&&isSettlementRaw(e,K(e))}function settlementRadius(e){var t=e.unlocks
var r=I(e)
var a=W[r]
s(a)
var i=a.radius
for(var o in H)if(t&&t[o]){var n=H[o]
if(!n)continue
if(n.radius_add)i+=n.radius_add}return i}function applyUpgrade(e,t){var r=H[t]
if(!r)return
if(r.unlock_items)for(var a=0;a<r.unlock_items.length;++a){var i=r.unlock_items[a]
e.unlocks.push(i)}if(r.unlocks)for(var o=0;o<r.unlocks.length;++o){var n=r.unlocks[o]
e.unlocked_ids[n]=true}if(r.unlocks_recipes)for(var s=0;s<r.unlocks_recipes.length;++s){var l=r.unlocks_recipes[s]
e.unlocked_recipes[l]=true}}function Settlement(e,t,r){this.mcid=e
this.settlement_id=t
this.last_data=C(r)
var a=r.unlocks,i=r.progress
var o=K(t)
this.world_pos=B()
if(o){var n=o.pos,s=o.name
X(this.world_pos,n[0],n[1])
this.name=s}else this.name="..."
this.tier=I(r)
this.radius=settlementRadius(r)
this.unlocks=[]
this.unlocked_upgrades=a||{}
this.unlocked_ids={}
this.unlocked_recipes={}
this.unlock_info=a
this.progress=i
applyUpgrade(this,"tier0")
for(var l in H)if(a&&a[l])applyUpgrade(this,l)}Settlement.prototype.allowsItem=function(e){return this.unlocked_ids[e]}
Settlement.prototype.allowsRecipe=function(e){return this.unlocked_recipes[e]}
function keyToUpgradeData(e){return H[e]}function cmpUpgradeIndex(e,t){return e.upgrade_idx-t.upgrade_idx}Settlement.prototype.availableUpgrades=function(){var o=this
var e=Object.keys(H).filter(function(e){if(o.unlocked_upgrades[e])return false
var t=H[e],r=t.prereqs,a=t.is_tier
if(t.next_release&&!n())return false
if(a)return false
if(r)for(var i=0;i<r.length;++i)if(!o.unlocked_upgrades[r[i]])return false
return true}).map(keyToUpgradeData)
e.sort(cmpUpgradeIndex)
if(e.length>te)e=e.slice(0,te)
return e}
Settlement.prototype.allowsRecipeSoon=function(e){var t=W[this.tier+1]
if(t)if(t.unlocks_recipes)if(-1!==t.unlocks_recipes.indexOf(e))return true
var r=this.availableUpgrades()
for(var a=0;a<r.length;++a)if(r[a].unlocks_recipes)if(-1!==r[a].unlocks_recipes.indexOf(e))return true
return false}
Settlement.prototype.buildAllowed=function(){var e=o(""+V+this.settlement_id)
return e&&e.build_allowed}
var re={}
function initSettlement(e,t){s("number"===typeof t)
var r=T(t,e)
if(!r)return null
return new Settlement(t,e,r)}function settlementFromVolume(e){var t=e.volume_id
if(!t.startsWith(V))return null
var r=t.slice(V.length)
var a=re[r]
if(void 0===a)a=re[r]=initSettlement(r,e.mcid)
return a}function settlementGet(e){var t=e
var r=re[t]
if(void 0===r){var a=d(""+V+t)
if(!a)r=re[t]=null
else r=re[t]=initSettlement(t,a.mcid)}return r}var ae=B()
var ie
function settlementForPos(e){ie=null
var t=l(e)
if(!t)return null
var r=ie=settlementFromVolume(t)
if(!r)return null
var a=r.world_pos
J(ae,e)
if(E(_(a[0]-ae[0]),_(a[1]-ae[1]),_(a[2]-ae[2]))<=r.radius)return r
return null}var oe
var ne
var se
function settlementCurrent(e){if(se!==h.frame_index){se=h.frame_index
oe=settlementForPos(c())
ne=ie}return e?ne:oe}function settlementLastBound(){var e=R()
if(isSettlement(e))return settlementGet(e)
return null}function settlementLastBoundID(){var e=R()
if(isSettlement(e))return e
return null}var le=[]
function settlementGetLazyAsync(e,t){le.push([e,t])}function settlementUpdate(e){re={}
if(e)le=[]
else for(var t=le.length-1;t>=0;--t){var r=le[t],a=r[0],i=r[1]
var o=settlementGet(a)
if(o){le.splice(t,1)
i(o)}}}S.register({settlement_beam_dist:{label:"Settlement Beam Distance",help:"Set the distance at which to start drawing Settlement beams",usage:"Default: 20",prefix_usage_with_help:true,default_value:20,type:a.TYPE_FLOAT,range:[0,1e3]},settlement_beam_in_photo_mode:{help:"Allow drawing Settlement beams in photo mode",default_value:0,type:a.TYPE_INT,range:[0,1]}})
var _e=B()
var ce=P(10,400)
var ue=P()
var de=U(1,248/255,164/255,1)
var fe=.25
var ve=U(180/255,248/255,1,1)
var he=.1
var pe=100
function settlementBeamDraw(e){if(h.defines.NOUI||y()&&!S.settlement_beam_in_photo_mode||!Z())return
if(!G())return
if(e&&h.defines.NOBEAMFAR)return
if(!e&&h.defines.NOBEAMNEAR)return
var t=R()
var r=q()
var a=false
var i=ee.view_dist*m
if(e)i=E(i,S.settlement_beam_dist)
for(var o in r){var n=r[o]
var s=void 0
var l=void 0
if(o===t){s=de
l=fe}else if(n.flags&Y){s=ve
l=he}else continue
X(ae,n.pos[0],n.pos[1])
$(_e,ae)
var _=k(_e,f())
var c=e?i:S.settlement_beam_dist
var u=N((_-c)/pe,0,1)
if(!e)u=g(u,N((i+pe-_)/pe,0,1))
if(u>0){a=true
L(O)
gl.enable(gl.BLEND)
gl.depthMask(false)
var d=M(N((_-250)/2e3,0,1),1,10)
ue[0]=ce[0]*d
ue[1]=ce[1]*d
s[3]=l*x(u,2)
v({pos:_e,size:ue,color:s,texs:p()})}}if(a){w()
gl.depthMask(true)}}},{"../common/globals.js":248,"../common/settlement_common.js":261,"../common/world_constants.js":267,"../common/world_trans.js":268,"../glov/client/cmds.js":298,"../glov/client/engine.js":305,"../glov/client/settings.js":351,"../glov/client/sprites.js":363,"../glov/common/util.js":400,"../glov/common/vmath.js":402,"./app_access.js":12,"./camera.js":35,"./draw_sprite3d.js":82,"./editvolume_client.js":84,"./fx_util.js":103,"./main.js":135,"./megachunk_client.js":139,"./photo_mode.js":158,"./sky.js":188,"./user_data.js":208,"./voxel_chunk_manager.js":214,"./voxel_data.js":216,"./waygate_upgrade.js":223,"./world_metadata.js":235,assert:void 0}],182:[function(e,t,r){"use strict"
r.settlementEditStartup=settlementEditStartup
r.settlementEditInit=settlementEditInit
r.settlementProgress=settlementProgress
r.settlementEditRun=settlementEditRun
r.CRAFTING_ICON_SIZE=void 0
var N=100
r.CRAFTING_ICON_SIZE=N
var C=e("assert")
var x=e("../glov/client/camera2d")
var a=e("../glov/client/cmds").cmd_parse
var M=e("../glov/client/engine")
var S=e("../glov/client/input")
var D=e("../glov/client/settings")
var i=e("../glov/client/spot")
var P=i.SPOT_DEFAULT_LABEL
var B=i.spot
var I=e("../glov/client/ui")
var o=e("../glov/client/ui")
var k=o.buttonImage
var U=o.buttonText
var A=o.drawHBox
var G=o.drawLine
var F=o.drawRect
var W=o.drawTooltipBox
var w=o.menuUp
var L=o.panel
var H=o.uiButtonHeight
var z=o.uiButtonWidth
var n=o.uiGetFont
var s=o.uiGetTitleFont
var O=o.label
var V=o.uiTextHeight
var Y=e("../glov/client/walltime")
var l=e("../glov/common/util")
var j=l.msToSS2020
var K=l.secondsToFriendlyString
var _=e("../glov/common/vmath")
var q=_.v2set
var X=_.vec2
var Q=e("../common/ids").TYPE_SETTLEMENT_UPGRADE
var c=e("./analytics").logEvent
var R=e("./factory_ui").drawZoomed
var u=e("./inventory")
var d=u.INV_PLAYER
var f=u.inventoryGet
var v=u.inventoryGetSize
var m=u.transInvDec
var h=e("./inventory_ui")
var p=h.ACCEPT_HIGHLIGHT
var E=h.ACCEPT_NO
var g=h.ACCEPT_OK
var $=h.INVTYPE_CONTAINER
var J=h.INVTYPE_MAIN
var T=h.ctxTrans
var ee=h.doInventorySetupContext
var te=h.doInventorySub
var re=h.doInventorySubOneItem
var y=h.inventoryAnimate
var ae=h.inventoryButton
var b=h.inventoryUIInit
var ie=h.inventoryUITick
var oe=e("./item_info_view")
var ne=oe.ITEM_INFO_VIEW_W
var se=oe.itemInfoViewClear
var le=oe.itemInfoViewDraw
var _e=oe.itemInfoViewShow
var ce=e("./items")
var ue=ce.ITEM_CONTEXT_BUILD
var de=ce.ITEM_CONTEXT_ITEM
var fe=ce.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var ve=ce.sameItem
var he=ce.satisfiesCost
var pe=e("./layout")
var me=pe.WIDE
var Ee=pe.layoutCameraCurX1
var ge=pe.layoutCameraTallWide
var Te=pe.layoutCameraTallWideMode
var ye=e("./localization/localization").L
var Se=e("./menu")
var Ie=Se.PANEL_PAD
var Ae=Se.gameModeWatermark
var we=Se.panel_color
var Le=Se.prefixShortcutKey
var Oe=e("./settlement").settlementGet
var Re=e("./styles")
var be=Re.color_black
var Ne=Re.inventory_style
var Ce=Re.label_style
var xe=Re.menu_header_style
var Me=Re.style_mode_label
var De=Re.sublabel_style
var Pe=e("./todo_list")
var Be=Pe.TODO_TOGGLE
var ke=Pe.todoIsInList
var Ue=Pe.todoListActive
var Ge=Pe.todoListAdd
var Fe=Pe.todoTooltip
var We=e("./tutorial").tutorialPosHook
var He=e("./ui_util")
var ze=e("./ui_util").STAMINA_SYMBOL
var Ve=e("./user_data").userDataSet
var Ye=e("./user_info_view").userInfoGet
var je=e("./waygate_ui")
var Ke=je.FONT_HEIGHT
var qe=je.PAD
var Ze=je.SUBLABEL_H
var Xe=je.SUBLINE_W
var Qe=je.SUBTITLE_H
var $e=je.drawHLine
var Je=e("./waygate_upgrade")
var et=Je.WAYGATE_TIERS
var tt=Je.WAYGATE_UPGRADES
var rt=e("./world_metadata").worldMetadata
var at=e("./worlds_sound").playSound
var it=Math.floor,ot=Math.max,nt=Math.min
var st
var lt
var _t
var ct={}
function settlementEditStartup(){st=n()
lt=s()
_t=He.sprite}function settlementEditInit(){b()
ct={}}function settlementProgress(e,t,r){var a,i
var o=tt[t]
C(o)
var n=o.cost[r]
C(n)
var s=n.count
var l=(null==(a=e.progress)?void 0:null==(i=a[t])?void 0:i[r])||0
var _=ct[t+"_"+r]
if(_)l=ot(l,_.expected)
return nt(l,s)}function slotInfo(e){var t=e.split(","),r=t[0],a=t[1]
C(r)
C(a)
var i=tt[r]
C(i)
var o=i.cost[a]
C(o)
return{key:r,subkey:a,cost:o}}function settlementFitsInSlot(e,t){var r=slotInfo(e).cost
C(r)
return he(r,t)}function settlementFitsInSlotExact(e,t){var r=slotInfo(e).cost
C(r)
return ve(r,t)}function acceptsItemSettlement(e,t,r){var a
var i
if(t.type===$){a=t
i=r}else if(r.type===$){a=r
i=t}else return g
if(t.type===$&&!r.inv){var o=slotInfo(t.idx).cost
C(o)
for(var n=0;n<v(d);++n)if(he(o,f(n)))return p}if(!i.inv)return E
var s=slotInfo(a.idx)
var l=s.cost,_=s.key,c=s.subkey
C(l)
var u=settlementProgress(e.wgctx.settlement,_,c)
if(!(l.count-u>0))return E
if(settlementFitsInSlot(a.idx,i.inv))return p
else return E}function transSettlementProgress(e,t,r,a,i){var o=r+"_"+a
var n=ct[o]
if(!n){var s,l
n=ct[o]={amount:0,expected:(null==(s=t.progress)?void 0:null==(l=s[r])?void 0:l[a])||0}}n.amount+=i
n.expected+=i
e.opSettlementProgress(t.mcid,t.settlement_id,r,a,i)
e.onComplete(function(){n.amount-=i
if(n.amount<=0)delete ct[o]})}var ut
var dt
var ft=[ye.BTN_UNLOCK_LETS_SEE,ye.BTN_UNLOCK_MORE1,ye.BTN_UNLOCK_MORE2,ye.BTN_UNLOCK_MORE3,ye.BTN_UNLOCK_MORE4,ye.BTN_UNLOCK_MORE5]
function settlementAnimateComplete(e){dt=M.frame_index
se()
at("waygate_upgrade")
var t=tt[e]
C(t)
c("waygate_unlock",1,e)
var r=t.radius_add,a=t.unlock_items,i=t.is_tier,o=t.tier_idx
var m=[]
m.push({type:"message",title:i?ye.separateColon(ye.$(ye.LBL_UNLOCKED_TIER,o),t.name):ye.separateColon(ye.LBL_UNLOCKED,t.name),text:ye.SETTLEMENT_WG_UNLOCK})
if(r)m.push({type:"message",title:ye.separateColon(ye.LBL_SIZE,"+"+2*r),text:ye.$(ye.SETTLEMENT_RADIUS_ADD,r)})
if(a)for(var n=0;n<a.length;++n)m.push(a[n])
var E=0
var g=0
var T=H()
var y=V()
function run(e){dt=M.frame_index
g+=M.frame_dt
var t=Z.SETTLEMENT_ANIMATE_COMPLETE
var r=100
var a=1e3-2*r
var i=1e3-1.5*r
var o=r
var n=r/2
var s=n
Ae(o+a,n+i,t+1)
var l={x:o+T,y:n-Ie+16,z:t-5,w:a-2*T,h:T}
lt.drawSizedAligned(xe,l.x+8,l.y,l.z+2,2*y,st.ALIGN.HVCENTERFIT,l.w-16,l.h,ye.LBL_SETTLEMENT_UNLOCK)
A(l,I.sprites.tab,we)
n+=T+qe
var _=m[E]
var c=36
var u=s+i-T-Ie
var d=false
var f=nt(1,g/1e3)
if("message"===_.type){n+=2*y
if(_.title)R(f,lt,Ne,Ne,o,n,t,2*y,st.ALIGN.HCENTERFIT,a,null,_.title)
n+=5*y
if(_.text)st.drawSizedAligned(Ne,o,n,t,1.5*y,st.ALIGN.HCENTERFIT|st.ALIGN.HWRAP,a,0,_.text)}else{var v=_.is_recipe?de:ue
var h=_.is_recipe?_.recipe_item:_
var p=le({scroll_idx:"settlement",x:o,y0:n,z:t,w:a,h:u-n,style:"unlock",has_stack:false,is_future:true,context:v,inv:h,zoom:f})
d=p.dismiss
if(p.pinnable)if(k({x:o+a-T,y:n,z:t+2,w:T,h:T,img:He.sprite,frame:ke(h,v)?He.PINNED:He.PIN,tooltip:Fe(h,v)}))Ge(h,v,Be)}if(S.click({button:2}))d=true
if(U({x:o+.25*a,y:u,z:t,w:.5*a,font_height:c,text:E===m.length-1?ye.BTN_OK:ft[E]||ye.BTN_UNLOCK_MORE3,auto_focus:true})||d){g=0
if(++E===m.length)ut=null}L({x:o-Ie,y:s+T-Ie,z:t-5,w:a+2*Ie,h:i-T+2*Ie,color:we})
if(S.click())ut=null
if(ut)w({z:Z.SETTLEMENT_ANIMATE_COMPLETE-10})}ut={run:run}}a.register({cmd:"settlement_upgrade_show",help:"(Debug) Show the settlement upgrade complete dialog for a given unlock",func:function func(e,t){if(!e)return void t("Missing key")
settlementAnimateComplete(e)
t()},access_run:["sysadmin"]})
var vt
function contribute(e,t,r,a,i){C.equal(r.type,J)
var o=e.each_target,n=e.wgctx
var s=slotInfo(t)
var l=s.cost,_=s.key,c=s.subkey
var u=n.settlement,d=n.settlement_id
var f=settlementProgress(u,_,c)
var v=l.count-f
C(v&&v>0,v)
var h=nt(nt(v,a.count),i)
C(h&&h>0,h)
y(a,r.type+","+r.idx,$+","+t,false)
var p=T(e)
m(p,o[r.type],r.idx,h)
transSettlementProgress(p,u,_,c,h)
vt=Object.keys(u.unlock_info||{}).length
p.onComplete(function(e){if(!e){var t
var r=Object.keys((null==(t=Oe(d))?void 0:t.unlock_info)||{}).length
if(r!==vt){vt=r
settlementAnimateComplete(_)}}})}function swapItemSettlement(e,t,r){if(t.type===J&&r.type===$){var a=t
t=r
r=a}if(!(t.type===$&&r.type===J))return false
C(t.type!==r.type||t.idx!==r.idx)
var i=e.each_data[r.type][r.idx]
if(!i)return true
var o=t.idx
C(settlementFitsInSlot(o,i))
contribute(e,o,r,i,Infinity)
return true}function quickTransferSettlement(e,t,r,a){C.equal(t.type,J)
var i=e.wgctx.possible_slots
for(var o=0;o<i.length;++o){var n=i[o]
if(settlementFitsInSlotExact(n,r)){contribute(e,n,t,r,a)
return true}}for(var s=0;s<i.length;++s){var l=i[s]
if(settlementFitsInSlot(l,r)){contribute(e,l,t,r,a)
return true}}return false}function userIdToDisplay(e){var t=Ye(e)
return t.display_name||t.user_id}var ht=.667*100
var pt=.5*N
var mt=N
var Et=16
var gt=750
var Tt=224
function drawUnlocks(e,t,r,a,i,o,n,s){var l=a.length
if(l){t-=qe
var _=Z.UI
var c=e+r/2
var u=it(r/(i+qe))
var d=ot(0,l-u)
var f
if(d){f=[]
for(var v=0;v<a.length-u+2;++v){var h=a[v]
f.push(ye.separateColon(h.is_recipe?ye.LBL_RECIPE:n,h.getName()))}f=f.join("\n")
a=a.slice(-u)
l=u}var p=c-(l*i+qe*(l-1))/2
var m=p
var E=p+l*(i+qe)
if(o)st.drawSizedAligned(Ce,p,t,_,Ke,st.ALIGN.HRIGHT|st.ALIGN.VCENTER,0,i,ye.separateColon(o,""))
for(var g=0;g<l;++g){if(d&&!g)O({font_style:Ce,x:p,y:t,z:_,size:Ke,align:st.ALIGN.HVCENTERFIT,w:2*i+qe,h:i,text:ye.SETTLEMENT_OTHER.$({val:d+2}),tooltip:f,tooltip_width:400})
else if(d&&1===g);else{var T=a[g]
var y=T.is_recipe?de:ue
if(ae({x:p,y:t,z:_,w:i,h:i,draw_only_mouseover:true,rollover_quiet:true,no_bg:true,shrink:1,hide_count:true,tooltip:ye.separateColon(T.is_recipe?ye.LBL_RECIPE:n,T.getName())+"\n"+Le(ye.INPUT_CLICK,ye.LBL_VIEW_INFO),tooltip_width:400,item_context:y},T))_e({x:e>gt?m-ne-Et:E,y:0,inv:T.is_recipe?T.recipe_item:T,context:y,auto_close:true,is_future:s})}p+=i+qe}t+=i+qe}return t}function settlementEditRun(e,t,_,c){C(_)
var r=_.wgid,T=_.is_unbound
var a=r
var y=Z.UI
var u=Te()===me
if(ut)if(dt<M.frame_index-1)ut=null
else{x.setAspectFixed(1e3,1e3)
ut.run()
ge()}var S=M.DEBUG&&false
var i=Ee()-e
var I=Oe(a)
if(!I){st.drawSizedAligned(Ce,e,t,y,2*V(),st.ALIGN.HVCENTER|st.ALIGN.HWRAP,i,2*(1e3-t)/3,ye.ERR_SETTLEMENT_OUT_OF_RANGE)
return}var o={settlement_id:a,settlement:I}
var A=I.unlock_info||{}
var w=I.tier
var L=w+1
var m=o.possible_slots=[]
var O=.75*H()
var E=ee({wgctx:o})
var g=X()
var R=X()
function doCost(e,t,r,a){var i=tt[a].cost
var o=Object.keys(i)
o.sort()
var n=o.length
var s=e+r/2-(n*(N+Et)+qe*(n-1))/2
var l=s-Et-qe
var _=s+(N+Et+qe)*n
We("required_items_before",q(g,s,t))
for(var c=0;c<n;++c){var u=o[c]
var d=i[u]
var f=settlementProgress(I,a,u)
var v=a+","+u
var h={ctx:E,inv_type:$,ii:v,x:s+Et/2,y:t,z:y,slot_w:N,no_quickbar:true,quick_transfer_cb:null,accepts_item_cb:acceptsItemSettlement,swap_cb:swapItemSettlement,empty_inv:d,allow_empty_select:true,count_override:f+" / "+d.count,disabled:f===d.count||T,label_style:Me,item_context:de}
if(h.disabled){h.draw_only=true
h.no_bg=true
ae(h,d)}else{m.push(v)
if(re(h)){var p=acceptsItemSettlement(E,{type:$,idx:v},{})
_e({x:s>gt?l-ne:_,y:0,inv:d,context:de,auto_close:true,hint:p?ye.SETTLEMENT_DRAG_ITEMS:null})}}st.drawSizedAligned(De,s,t+N+4,y,Ze,st.ALIGN.HCENTERFIT,N+Et,0,d.getName())
s+=N+Et+qe}We("required_items_after",q(R,s,t))
return t+(N+4+Ze+qe)}function doTier(e,t,r,a){if(S)F(e,t,e+r,t+a,y,[1,0,0,.25])
var i=e+r/2
var o=t
var n=et[w]||{}
if(w){lt.drawSizedAligned(xe,e,o,y,Qe,st.ALIGN.HCENTERFIT,r,0,ye.separateColon(ye.$(ye.LBL_TIER_NUMBER,w),n.name))
o+=Qe
var s=A["tier"+w]
if(s){var l=ot(0,Y.seconds()-s.time)
var _=Ye(s.user_id)
var c=_.display_name||_.user_id
var u=st.drawSizedAligned(De,e,o,y,Ke,st.ALIGN.HCENTERFIT,r,0,l<60?ye.$(ye.SETTLEMENT_UNLOCKED_JUST_NOW,c):ye.$(ye.SETTLEMENT_UNLOCKED_TIME_AGO,K(l),c))
var d={key:"unlock_time",def:P,x:e+(r-u)/2,y:o,w:u,h:Ke}
if(B(d).focused){var f=j(rt().created)
var v=K(s.time-f,true)
d.tooltip=ye.$(ye.SETTLEMENT_UNLOCKED_AFTER_CREATION,v)
if(s.users)d.tooltip+="\n\n"+ye.addColon(ye.LBL_ADDITIONAL_CONTRIBUTORS)+"\n  "+s.users.map(userIdToDisplay).join("\n  ")
W(d)}o+=Ke+qe}var h=I.radius,p=I.unlocks
st.drawSizedAligned(Ce,e,o,y,Ke,st.ALIGN.HCENTERFIT,r,0,ye.separateColon(ye.LBL_SETTLEMENT_SIZE,2*h))
o=drawUnlocks(e,o+=Ke+qe,r,p,pt,null,ye.LBL_UNLOCKED_INDUSTRY)}else o+=40
o+=10
var m=et[L]
if(m){if(w)o=$e(i,o,Xe)+10
var E={type:Q,id:-1,attr1:m.key}
if(!T&&Ue()&&k({x:e+r-O-qe,y:o,z:y,w:O,h:O,img:He.sprite,frame:ke(E,fe)?He.PINNED:He.PIN,tooltip:Fe(E,fe)}))Ge(E,fe,Be)
lt.drawSizedAligned(xe,e+O+qe,o,y,Qe,st.ALIGN.HCENTERFIT,r-2*(O+qe),0,ye.separateColon(w?ye.LBL_NEXT_TIER:ye.LBL_FIRST_UPGRADE,m.name))
o+=Qe
if(!w||D.split_waygate){o+=qe
st.drawSizedAligned(Ce,e,o,y,Ke,st.ALIGN.HCENTERFIT,r,0,ye.addColon(ye.LBL_REQUIRES))
o+=Ke}o=doCost(e,o,r,"tier"+L)
if(m.unlocks){o+=qe
st.drawSizedAligned(Ce,e,o,y,Ke,st.ALIGN.HCENTERFIT,r,0,ye.addColon(ye.LBL_UNLOCKS))
o=drawUnlocks(e,o+=Ke,r,m.unlock_items,mt,null,ye.LBL_UNLOCKS_INDUSTRY,true)}var g=m.radius-n.radius
if(g)st.drawSizedAligned(Ce,e,o,y,Ke,st.ALIGN.HCENTERFIT,r,0,ye.separateColon(ye.LBL_SETTLEMENT_SIZE,"+"+2*g))}}function doUpgrades(e,t,r,a){if(S)F(e,t,e+r,t+a,y,[0,1,0,.25])
var i=e+r/2
var o=false
var n=I.availableUpgrades()
for(var s=0;s<n.length;++s){var l=n[s]
var _=l.name,c=l.key,u=l.radius_add,d=l.unlock_items
if(o)t=$e(i,t,Xe)
else if(n.length<2){st.drawSizedAligned(Ce,e,t,y,Ke,st.ALIGN.HCENTERFIT,r,0,ye.LBL_OPTIONAL_UPGRADES)
t+=Ke+qe}o=true
var f={type:Q,id:-1,attr1:l.key}
if(!T&&Ue()&&k({x:e+r-O-qe,y:t,z:y,w:O,h:O,img:He.sprite,frame:ke(f,fe)?He.PINNED:He.PIN,tooltip:Fe(f,fe)}))Ge(f,fe,Be)
lt.drawSizedAligned(xe,e+O+qe,t,y,Qe,st.ALIGN.HCENTERFIT,r-2*(O+qe),0,_)
t=doCost(e,t+=Qe,r,c)
if(u){st.drawSizedAligned(Ce,e,t,y,Ke,st.ALIGN.HCENTERFIT,r,0,ye.separateColon(ye.LBL_SETTLEMENT_SIZE,"+"+2*u))
t+=Ke+qe}if(d)t=drawUnlocks(e,t,r,d,mt,ye.LBL_UNLOCKS,ye.LBL_UNLOCKS_INDUSTRY,true)}if(!o){t+=2*Qe
st.drawSizedAligned(De,e,t,y,Qe,st.ALIGN.HCENTERFIT,r,0,ye.SETTLEMENT_NO_OPT_UPGRADES)
t+=Qe+qe
if(w<2)st.drawSizedAligned(De,e+qe,t,y,Ke,st.ALIGN.HCENTERFIT|st.ALIGN.HWRAP,r-2*qe,0,ye.SETTLEMENT_FIRST_INCREASE_TIER)}}function doInventory(e,t,r,a){if(c){st.drawSizedAligned(De,e,t,y,Ke,st.ALIGN.HVCENTERFIT,r,a,T?ye.SETTLEMENT_VISIT_WG_IN_WORLD_UNBOUND:ye.SETTLEMENT_VISIT_WG_IN_WORLD)
return}if(S)F(e,t,e+r,t+a,y,[0,0,1,.25])
if(T){var i=.618*r
var o=e+(r-i)/2
var n=t
G(o,n,o+i,n,y,1,1,be)
n+=2*qe
n+=st.drawSizedAligned(Ce,e,n,y,Ke,st.ALIGN.HCENTER|st.ALIGN.HWRAP,r,a,ye.$(ye.SETTLEMENT_HOME_UNBOUND,ze))
n+=2*qe
var s=.75*z()
if(U({x:e+(r-s)/2,y:n,z:y,w:s,text:ye.BTN_SETTLEMENT_SET_AS_HOME,font_height:Ke}))Ve("home",_.wgid)
return}var l=e
if(u){_t.draw({x:l,y:t,z:y,w:ht,h:ht,frame:He.INVENTORY})
l+=ht+qe}else l+=qe
G(l,t,l+.618*(e+r-l),t,y,1,1,be)
te({ctx:E,inv_type:J,no_quickbar:true,final:true,no_buttons:true,x0:l,y:t+qe,z:y,scale:1,quick_transfer_cb:quickTransferSettlement,accepts_item_cb:acceptsItemSettlement,swap_cb:swapItemSettlement,hide_trash:!u})}var n=e
var s=t
var l=n+i/2
if(u){var d=1e3-t-Tt
if(0===w)doTier(l-gt/2,s,gt,d)
else{doTier(n,s,gt,d)
var f=.618*d
var v=s+(d-f)/2
G(l,v,l,v+f,y,1,1,be)
doUpgrades(n+i/2,s,gt,d)}doInventory(n,s+d,i,Tt)}else{var h=(1600-t-Tt-8)/2
var p=n+(i-gt)/2
var b=s
doTier(p,s,gt,h)
b=$e(l,b+=h,Xe)
if(w>0)doUpgrades(p,b,gt,h)
doInventory(n,b+=h,i,Tt)}ie()}},{"../common/ids":249,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/settings":351,"../glov/client/spot":361,"../glov/client/ui":367,"../glov/client/walltime":370,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./factory_ui":95,"./inventory":114,"./inventory_ui":115,"./item_info_view":117,"./items":119,"./layout":120,"./localization/localization":131,"./menu":140,"./settlement":181,"./styles":197,"./todo_list":202,"./tutorial":203,"./ui_util":205,"./user_data":208,"./user_info_view":210,"./waygate_ui":222,"./waygate_upgrade":223,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],183:[function(e,t,r){"use strict"
r.shadowDrawDrop=shadowDrawDrop
r.shadowDraw=shadowDraw
r.shadowStartup=shadowStartup
var a=e("assert")
var i=e("../glov/client/dyn_geom")
var w=i.BUCKET_DECAL
var o=i.FACE_CUSTOM
var L=i.dynGeomAlloc
var O=i.dynGeomSpriteSetup
var ee=e("../glov/client/engine")
var te=e("../glov/client/settings")
var n=e("../glov/client/shaders")
var s=n.shaderCreate
var l=n.shadersPrelink
var _=e("../glov/client/sprites")
var R=_.BLEND_ALPHA
var c=_.spriteCreate
var u=e("../glov/common/vmath")
var d=u.v3set
var f=u.v4copy
var v=u.vec2
var re=u.vec3
var h=u.vec4
var p=e("../common/globals")
var ae=p.CHUNK_SIZE
var ie=p.ID2
var oe=p.ID_FACTOR
var m=e("./mesh_calc").BYTES_PER_VERT
var ne=e("./voxel_const").origin_chunk
var se=e("./voxel_data")
var E=Math.abs,le=Math.floor,_e=Math.max,ce=Math.min
var b
var g=v(3,3)
var N=h(0,0,0,1)
var ue=1.5
var T=2
var de=2
var fe=3
var C
var x
var y=re()
var S=f(h(),N)
var I=re()
var A=re(0,0,-1)
function shadowDrawDrop(e,t){if(!se.raycastLocal(I,e,A,8,false,null))return
var r=I[2]+1.01
var a=E(e[2]-r)
if(a>T)return
d(y,e[0],e[1],r)
S[3]=N[3]*(1-a/T)
b.draw3D({pos:y,size:g,facing:o,face_right:[1,0,0],face_down:[0,1,0],color:S,doublesided:true,bucket:w})}function shadowQuads(e,t,r,a,i){if(!i)return
var o=e[0],n=e[1],s=e[2]
var l=L()
var _=O({shader:C,vshader:x,pos:e,bucket:w}),c=_.shader,u=_.vshader,d=_.shader_params,f=_.bucket,v=_.sort_z
l.shader=c
l.vshader=u
l.shader_params=d
l.texs=b.texs
l.blend=R
l.alloc(i,r/3)
var h=l.tris,p=l.verts
for(var m=0;m<r;++m)h[m]=t[m]
var E=0
for(var g=0;g<i;++g){var T=a[g]
var y=T[2]
var S=void 0
if(y>s){if((S=1-(y-s)/de)<0){S=0
y=s+de}}else if((S=1-(s-y)/fe)<0){S=0
y=s-fe}var I=1-(T[0]-o)/ue
var A=1-(T[1]-n)/ue
p[E+0]=T[0]
p[E+1]=T[1]
p[E+2]=y
p[E+4]=N[0]
p[E+5]=N[1]
p[E+6]=N[2]
p[E+7]=S
p[E+8]=.5*I
p[E+9]=.5*A
E+=12}l.queue(f,v)}var ve=re()
var he=1/7
var pe=7
a.equal(m,16)
var me=[]
var Ee=[]
function shadowDraw(e,t){if(!te.shadows)return
if(ee.defines.DROPSHADOW)return shadowDrawDrop(e,t)
profilerStart("shadowDraw")
var r=e[0],a=e[1],i=e[2]
var o=0
var n=0
function addVert(e,t,r){var a=o
if(o>=me.length)me.push(re())
var i=me[o++]
i[0]=e*he+ve[0]
i[1]=t*he+ve[1]
i[2]=r*he+ve[2]
return a}var s=r-ue
var l=r+ue
var _=a-ue
var c=a+ue
var u=i-fe
var d=i+de
var f=le(s/ae+ne[0])
var v=le(l/ae+ne[0])
var h=le(_/ae+ne[1])
var p=le(c/ae+ne[1])
var m=le(u/ae+ne[2])
var E=le(d/ae+ne[2])
var g=se.chunk_map
var T
var y
var S
var I
for(var A=m;A<=E;++A)for(var w=h;w<=p;++w){var L=f+w*oe+A*ie
for(var O=f;O<=v;++O,++L){var R=g[L]
if(!R||!R.shadow_buf)continue
var b=R.shadow_buf
R.getLocalPos(ve)
var N=(s-ve[0]+1)*pe
var C=(l-ve[0]+1)*pe
var x=(_-ve[1]+1)*pe
var M=(c-ve[1]+1)*pe
var D=(u-ve[2]+1)*pe
var P=(d-ve[2]+1)*pe
var B=(i-ve[2]+1)*pe
ve[0]--
ve[1]--
ve[2]--
var k=b.length
for(var U=0;U<k;U+=12){var G=b[U]
var F=b[U+3]
var W=b[U+6]
var H=b[U+9]
var z=ce(G,F,W,H)
if(N>_e(G,F,W,H)||C<z)continue
var V=b[U+1]
var Y=b[U+4]
var j=b[U+7]
var K=b[U+10]
var q=ce(V,Y,j,K)
if(x>_e(V,Y,j,K)||M<q)continue
var Z=b[U+2]
var X=b[U+5]
var Q=b[U+8]
var $=b[U+11]
var J=ce(Z,X,Q,$)
if(D>_e(Z,X,Q,$)||P<J)continue
if(o>=65524)break
if(Z<=B!==Q<=B){T=addVert(G,V,_e(B,Z))
y=addVert(F,Y,_e(B,X))
S=addVert(W,j,_e(B,Q))
I=addVert(H,K,_e(B,$))
Ee[n++]=T
Ee[n++]=y
Ee[n++]=S
Ee[n++]=T
Ee[n++]=S
Ee[n++]=I
T=addVert(G,V,ce(B,Z))
y=addVert(F,Y,ce(B,X))
S=addVert(W,j,ce(B,Q))
I=addVert(H,K,ce(B,$))}else{T=addVert(G,V,Z)
y=addVert(F,Y,X)
S=addVert(W,j,Q)
I=addVert(H,K,$)}Ee[n++]=T
Ee[n++]=y
Ee[n++]=S
Ee[n++]=T
Ee[n++]=S
Ee[n++]=I}}}if(o)shadowQuads(e,Ee,n,me,o)
profilerStop("shadowDraw")}function shadowStartup(){b=c({url:"img/shadow_player.png",origin:v(.5,.5),wrap_t:gl.CLAMP_TO_EDGE,wrap_s:gl.CLAMP_TO_EDGE})
x=s("shaders/sprite3d_fogged.vp")
C=s("shaders/sprite_fogged.fp")
l(x,C)}},{"../common/globals":248,"../glov/client/dyn_geom":302,"../glov/client/engine":305,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/sprites":363,"../glov/common/vmath":402,"./mesh_calc":142,"./voxel_const":215,"./voxel_data":216,assert:void 0}],184:[function(e,t,r){"use strict"
r.shareMenuPhotoCapture=shareMenuPhotoCapture
r.shareButton=shareButton
r.shareMenu=shareMenu
var c=e("../glov/client/engine")
var u=e("../glov/client/input")
var a=e("../glov/client/input")
var d=a.mouseDownAnywhere
var f=a.mouseDownOverBounds
var n=e("../glov/client/net")
var i=e("../glov/client/ui")
var o=i.buttonImage
var v=i.buttonText
var s=i.modalDialogClear
var h=i.panel
var p=i.uiButtonHeight
var l=e("../glov/client/urlhash")
var _=e("../common/photo_common").PHT_IMG_KEYS
var m=e("./analytics").logEvent
var E=e("./build_mode").doingDragPlace
var g=e("./layout")
var T=g.SHAREMENU_BORDER_PAD
var y=g.SHAREMENU_BUTTON_H
var S=g.SHAREMENU_BUTTON_W
var I=g.SHAREMENU_CONTENT_PAD
var A=g.menuUpperLeft
var w=e("./localization/localization").L
var L=e("./main")
var O=e("./menu")
var R=e("./menu").menuActive
var b=e("./menu_ribbon").pushMenuRibbonElement
var N=e("./photo_library_view").photoLibraryDirty
var C=e("./photo_mode")
var x=C.errorModalDialog
var M=C.photoCapture
var D=C.setImageUploadFalse
var P=C.validatePhotoCapture
var B=e("./prop_edit").savingMessage
var k=e("./quickbar").quickbar_colors_selected
var U=e("./sharing/platform_share_handlers")
var G=U.inviteToWorld
var F=U.invitingEnabled
var W=U.shareWorld
var H=U.shareWorldLink
var z=U.sharingLinksEnabled
var V=U.sharingWorldEnabled
var Y=e("./ui_util")
var j=e("./world_comm")
var K=j.getWorldChannel
var q=j.getWorldID
var X={in_event_cb:u.pointerLockEnter}
var Q=false
var $
var J
var ee
function shareMenuPhotoCapture(o){if(R())L.menuExit()
M({waygate_mode:false},function(e,t){if(P(e,o,t)){var r=L.char_controller
var a=n.client.pak("photo_create")
a.writeAnsiString(o)
a.writeAnsiString(r.getPosString())
for(var i=0;i<_.length;i++){a.writeInt(t[_[i]].id)
a.writeInt(t[_[i]].w)
a.writeInt(t[_[i]].h)}a.send(function(e,t){N()
D()
if(e||!K())x(w.DLG_ERROR_IMAGE_UPLOAD_TITLE,e||w.ERR_WORLD_DISCONNECTED)
else{B(w.STATUSMSG_PHOTO_SAVED)
s()
l.goRoute("photo/"+t)}})}})}function drawShareButton(e,t){var r={x:J=e,y:ee=t,z:Z.MENUBUTTON,img:Y.sprite,frame:Y.SHARE,shrink:.7,colors:k,disabled:Q,tooltip:w.LBL_SHARE_MENU}
if(o(r)){Q=true
$=c.frame_index}}function shareButton(){if(!c.defines.NOUI&&!(E()&&u.touch_mode))b({w:p(),cb:drawShareButton})
var e=!u.touch_mode&&!u.pointerLocked()?X:null
if(u.keyDownEdge(u.KEYS.F9,e)){var t=q()
m("enter_photo_mode_button",1,"button")
shareMenuPhotoCapture(t)}}function shareMenu(){if(!Q)return
var e=S+2*T
var t=A()?J:J-e+p()
var r=ee
var a=t+e/2-S/2
var i=r+T
var o=!u.touch_mode?X:null
if(v({x:a,y:i,z:Z.POPUP_MENU,w:S,h:y,text:O.prefixShortcutKey("F9",w.BTN_TAKE_PHOTO),in_event_cb:o&&o.in_event_cb,auto_focus:true})){var n=q()
m("enter_photo_mode_button",1,"button")
shareMenuPhotoCapture(n)
Q=false}i+=y+I
if(z()){if(v({x:a,y:i,z:Z.POPUP_MENU,w:S,h:y,text:w.BTN_GET_WORLD_LINK})){H(q())
Q=false}i+=y+I}if(F()){if(v({x:a,y:i,z:Z.POPUP_MENU,w:S,h:y,text:w.BTN_INVITE_TO_WORLD})){G(q())
Q=false}i+=y+I}if(V()){if(v({x:a,y:i,z:Z.POPUP_MENU,w:S,h:y,text:w.BTN_SHARE_WORLD})){W(q())
Q=false}i+=y+I}var s={x:t,y:r,w:e,h:i+=-I+T}
u.drag(s)
var l=false
var _=c.frame_index!==$
if(_&&!f(s)&&d())l=true
if(_&&L.chat_ui.isFocused())l=true
if(_&&u.click({peek:true})||u.keyDownEdge(u.KEYS.ESC)||u.padButtonDownEdge(u.PAD.B)||l)Q=false
h({x:t,y:r,z:Z.POPUP_MENU-1,w:e,h:i,pixel_scale:.5,color:O.panel_color_popup})}},{"../common/photo_common":256,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/ui":367,"../glov/client/urlhash":369,"./analytics":6,"./build_mode":33,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./menu_ribbon":141,"./photo_library_view":155,"./photo_mode":158,"./prop_edit":170,"./quickbar":172,"./sharing/platform_share_handlers":185,"./ui_util":205,"./world_comm":226}],185:[function(e,t,r){"use strict"
r.invitingEnabled=invitingEnabled
r.sharingEnabled=sharingEnabled
r.sharingWorldEnabled=sharingWorldEnabled
r.sharingLinksEnabled=sharingLinksEnabled
r.sharingPhotoEnabled=sharingPhotoEnabled
r.inviteToWorld=inviteToWorld
r.shareWorld=shareWorld
r.shareWorldLink=shareWorldLink
r.downloadPhoto=downloadPhoto
r.sharePhoto=sharePhoto
r.sharePhotoLink=sharePhotoLink
r.shareBlueprint=shareBlueprint
r.shareBlueprintLink=shareBlueprintLink
r.shareUserLink=shareUserLink
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var n=e("assert")
var s=e("../../glov/client/client_config").PLATFORM
var i=e("../../glov/client/environments").getExternalTextureURL
var o=e("../../glov/client/net").netSubs
var d=e("../../glov/client/ui")
var a=e("../../glov/client/ui")
var l=a.modalDialog
var _=a.modalDialogClear
var c=a.provideUserString
var u=e("../../glov/client/urlhash")
var f=e("../../glov/common/util").errorString
var v=e("../analytics").logEvent
var h=e("../fbinstant_worlds")
var p=h.clearModalDialogAfter
var m=h.fbCanInvite
var E=h.fbCanShare
var g=h.fbCanShareLink
var T=h.fbShareBlueprint
var y=h.fbShareBlueprintLink
var S=h.fbSharePhoto
var I=h.fbSharePhotoLink
var A=h.fbShareUserLink
var w=h.fbShareWorldLink
var L=h.loadWorldImage
var O=h.updateSessionData
var R=e("../localization/localization")
var b=R.L
var N=R.getStringFromLocalizable
var C=e("../mobile_util").isMobile
var x=e("../platform_worlds_client")
var M=x.PLATFORM_DISCORD
var D=x.PLATFORM_FBINSTANT
var P=e("../social_referral").getReferralNumber
var B=e("../world_info").getWorldInfoAsync
var k=e("../world_info_view").worldLink
var U=e("./platform_share_urls").getPlatformLinkShareURL
var G=function(){function SharingMethodsDefault(){}var e=SharingMethodsDefault.prototype
e.canSharePayload=function canSharePayload(){return false}
e.canInvite=function canInvite(){return false}
e.shareWorldLink=function shareWorldLink(e,t){c(b.DLG_SHARE_TITLE,U(k(e,t)))
v("share_link",1,void 0,String(e),{wgid:t})}
e.sharePhotoLink=function sharePhotoLink(e,t,r){c(b.DLG_SHARE_TITLE,U("photo/"+e))
v("share_photo_link",1)}
e.shareBlueprintLink=function shareBlueprintLink(e){c(b.DLG_SHARE_BP_TITLE,U("blueprint/"+e))
v("share_bp_link",1)}
e.shareUserLink=function shareUserLink(e){c(b.DLG_SHARE_TITLE,U("u/"+e))
v("share_user_link",1,void 0,e)}
return SharingMethodsDefault}()
var F=function(i){_inheritsLoose(SharingMethodsFacebook,i)
function SharingMethodsFacebook(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).canSharePayload=E
e.canInvite=m
return e}var e=SharingMethodsFacebook.prototype
e.shareWorld=function shareWorld(e,t,r,a){return FBInstant.shareAsync({intent:"SHARE",data:{querystring:{w:e,wg:t,referrer:o().getUserId()}},image:r.toDataURL("image/jpeg",.92),text:0===P()?N(b.FBINSTANT_SHARE_WORLD_REFERRAL):N(b.$(b.FBINSTANT_SHARE,null==a?void 0:a.name))})}
e.shareWorldLink=function shareWorldLink(e,t){if(g())return w(e,t)
else return i.prototype.shareWorldLink.call(this,e,t)}
e.inviteToWorld=function inviteToWorld(e,t,r,a){return FBInstant.inviteAsync({text:0===P()?N(b.$(b.DLG_SHARE_WORLD_REFERRAL_FRIEND_INVITING_MSG,FBInstant.player.getName())):N(b.$(b.DLG_SHARE_WORLD_FRIEND_INVITING_MSG,FBInstant.player.getName(),null==a?void 0:a.name)),image:r.toDataURL("image/jpeg",.92),data:{querystring:{w:e,wg:t,referrer:o().getUserId()}}})}
e.sharePhoto=function sharePhoto(e,t,r,a,i){S(e,t,i)}
e.sharePhotoLink=function sharePhotoLink(e,t,r){if(g())I(e,t,r)
else i.prototype.sharePhotoLink.call(this,e,t,r)}
e.shareBlueprint=function shareBlueprint(e){T(e)}
e.shareBlueprintLink=function shareBlueprintLink(e){if(g())y(e)
else i.prototype.shareBlueprintLink.call(this,e)}
e.shareUserLink=function shareUserLink(e){if(g())A(e)
else i.prototype.shareUserLink.call(this,e)}
return SharingMethodsFacebook}(G)
var W=function(e){_inheritsLoose(SharingMethodsDiscord,e)
function SharingMethodsDiscord(){return e.apply(this,arguments)||this}var t=SharingMethodsDiscord.prototype
t.canSharePayload=function canSharePayload(){return true}
t.canInvite=function canInvite(){return true}
SharingMethodsDiscord.handleDiscordSharePhotoErr=function handleDiscordSharePhotoErr(e){console.error(e)
return d.modalDialog({title:b.DLG_ERROR_GETTING_PHOTO_TITLE,text:f(e),buttons:{OK:null}})}
t.sharePhoto=function sharePhoto(e,t,r,o,a){var i,n,s,l,_
d.modalDialog({title:b.DLG_SHARING_TITLE,text:b.MSG_PLEASE_WAIT})
var c=null==(i=window.FRVR)?void 0:null==(n=i.auth)?void 0:null==(s=n.tokenHandler)?void 0:null==(l=s.currentPair)?void 0:l.getRefreshPayload()
var u=null==c?void 0:null==(_=c.extra)?void 0:_.credentials
if(!u)return SharingMethodsDiscord.handleDiscordSharePhotoErr(new Error("Unauthorized"))
window.fetch(r).then(function(e){e.blob().then(function(e){var i=e.type
e.arrayBuffer().then(function(e){var t=new window.File([e],o,{type:i})
var r=new window.FormData
r.append("file",t)
var a={method:"POST",headers:{Authorization:"Bearer "+u.accessToken},body:r}
window.fetch("https://discord.com/api/activities/"+u.appId+"/attachment",a).then(function(e){if(!e.ok){var t=new Error(e.statusText||"Response not OK from discord")
return SharingMethodsDiscord.handleDiscordSharePhotoErr(t)}e.json().then(function(e){var t,r
var a=e.attachment.url
null==(t=window.discordSDK)||(null==(r=t.commands)||r.openShareMomentDialog({mediaUrl:a}).then(function(e){d.modalDialogClear()},function(e){SharingMethodsDiscord.handleDiscordSharePhotoErr(e)}))},SharingMethodsDiscord.handleDiscordSharePhotoErr)},SharingMethodsDiscord.handleDiscordSharePhotoErr)},SharingMethodsDiscord.handleDiscordSharePhotoErr)},SharingMethodsDiscord.handleDiscordSharePhotoErr)},SharingMethodsDiscord.handleDiscordSharePhotoErr)}
t.inviteToWorld=function inviteToWorld(e,t,r,a){return FRVR.social.platform.invite({})}
return SharingMethodsDiscord}(G)
var H=D?new F:M?new W:new G
function invitingEnabled(){return H.canInvite()}function sharingEnabled(e){return Boolean(H.canSharePayload()&&H[e])}function sharingWorldEnabled(){return sharingEnabled("shareWorld")}function sharingLinksEnabled(){return true}function sharingPhotoEnabled(){if(M&&C())return false
return sharingEnabled("sharePhoto")}function inviteToWorld(a){v("invite_to_world_"+s,1,"show",String(a))
n(H.inviteToWorld)
if(D)O({contextSwitch:true})
var i=u.get("w")
var o=u.get("wg")||"default"
l({title:b.DLG_INVITING_TITLE,text:b.MSG_PLEASE_WAIT})
B(a,function(e,r){if(e){console.error(e)
_()}else L(r,void 0,function(e,t){if(e){console.error(e)
return void _()}else p({promise:H.inviteToWorld(i,o,t,r),success_cb:function success_cb(){v("invite_to_world_"+s,1,"succ",String(a))
v("referral_message_sent",1)}})})})}function shareWorld(a,i){v("share_world_"+s,1,"show",String(a),{wgid:i})
n(H.shareWorld)
l({title:b.DLG_SHARING_TITLE,text:b.MSG_PLEASE_WAIT})
B(a,function(e,r){if(e){console.error(e)
_()}else L(r,i,function(e,t){if(e)return void _()
p({promise:H.shareWorld(a,i,t,r),success_cb:function success_cb(){v("share_world_"+s,1,"succ",String(a),{wgid:i})
v("referral_message_sent",1)}})})})}function shareWorldLink(e,t){H.shareWorldLink(e,t)}function downloadPhoto(e,t){var r=i(e)
if(M)FRVR.navigation.navigate(r)
else{var a=document.createElement("a")
a.href=r
a.target="_blank"
a.setAttribute("download",t)
a.click()}}function sharePhoto(e,t,r,a,i){if(sharingEnabled("sharePhoto"))H.sharePhoto(e,t,r,a,i)
else downloadPhoto(r,a)}function sharePhotoLink(e,t,r){H.sharePhotoLink(e,t,r)}function shareBlueprint(e){n(H.shareBlueprint)
H.shareBlueprint(e)}function shareBlueprintLink(e){H.shareBlueprintLink(e)}function shareUserLink(e){H.shareUserLink(e)}},{"../../glov/client/client_config":297,"../../glov/client/environments":310,"../../glov/client/net":338,"../../glov/client/ui":367,"../../glov/client/urlhash":369,"../../glov/common/util":400,"../analytics":6,"../fbinstant_worlds":96,"../localization/localization":131,"../mobile_util":144,"../platform_worlds_client":160,"../social_referral":190,"../world_info":229,"../world_info_view":231,"./platform_share_urls":186,assert:void 0}],186:[function(e,t,r){"use strict"
r.getPlatformLinkShareURL=getPlatformLinkShareURL
r.worlds_msstart_url=void 0
var a=e("../../glov/client/client_config").platformParameterGet
var i=e("../../glov/client/environments").getLinkBase
var o=e("../platform_worlds_client").PLATFORM_MSSTART
var n="https://www.msn.com/en-us/play/worlds-frvr/cg-9nxnk46xdk4h"
r.worlds_msstart_url=n
function getPlatformLinkShareURL(e){if(a("internal_urls_only"))return e
return o?n+"?msstart3pp="+escape(JSON.stringify({url:e})):""+i()+e}},{"../../glov/client/client_config":297,"../../glov/client/environments":310,"../platform_worlds_client":160}],187:[function(e,t,r){"use strict"
r.firstOfferGetExpireTime=firstOfferGetExpireTime
r.firstOfferGetTimeLeft=firstOfferGetTimeLeft
r.showFirstOffer=showFirstOffer
r.showFirstOfferOnIapAvailable=showFirstOfferOnIapAvailable
r.FIRST_OFFER_PRODUCT_ID=void 0
var B="promo_lost_frontier_farmers"
r.FIRST_OFFER_PRODUCT_ID=B
var i=e("assert")
var k=e("../glov/client/engine")
var a=e("../glov/client/net")
var U=a.netDisconnected
var o=a.netSubs
var n=e("../glov/client/sprites").spriteCreate
var G=e("../glov/client/ui")
var s=e("../glov/client/ui")
var F=s.buttonText
var W=s.drawLine
var l=s.isMenuUp
var _=s.modalDialog
var H=s.modalDialogClear
var z=s.panel
var V=s.uiButtonHeight
var c=s.uiGetFont
var u=s.uiGetTitleFont
var d=e("../glov/client/urlhash")
var f=e("../glov/client/walltime")
var v=e("../glov/common/util")
var h=v.empty
var Y=v.msToTimeString
var p=e("../glov/common/vmath").vec2
var m=e("./analytics").promoOfferEvent
var j=e("./character_customization")
var E=e("./in_app_purchases/iap_client_worlds")
var K=E.iapMakePurchase
var g=E.iapProductPrice
var T=e("./localization/localization")
var q=T.DURATION_DAYS_AND_HOURS_INITIALS
var X=T.L
var y=e("./menu")
var S=y.BLUEPRINT_VIEW
var I=y.PHOTO_VIEW
var A=y.USER_PROFILE_VIEW
var w=y.WORLD_INFO_VIEW
var L=y.getMenuPage
var O=y.panel_color
var R=e("./prompt")
var b=R.showPrompt
var Q=R.updatePrompt
var N=e("./styles.js")
var $=N.color_gray_50
var J=N.color_white
var ee=N.colors_green
var te=N.first_offer_price_expired_style
var re=N.label_style
var ae=N.menu_header_style
var ie=N.white_label_style
var C=e("../glov/client/camera2d.js")
var x=5e3
var M={promo_photo:"img/promo_packs/lost_frontier_farmers.png",discount_banner:"img/promo_packs/discount_65.png"}
var oe={}
var ne=false
function loadFirstOfferImages(){for(var e in M)(oe[e]=n({url:M[e],wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:p(.5,.5),lazy_load:true})).lazyLoad()
ne=true}var D=7
var se=864e5
function firstOfferGetExpireTime(){var e=o().getMyUserChannel()
if(e){var t=e.getChannelData("public.prompts_seen",{}).first_offer
var r=-1
if(t)r=t+D*se
return r}else return Date.now()+D*se}function firstOfferGetTimeLeft(){return firstOfferGetExpireTime()-f.now()}var le=1071
var _e=650
var ce=835
var ue=612
var de=0
var fe=false
var ve=false
var he
function showFirstOffer(e){ve=true
m("lost_frontier_farmers",fe,e?"outfit":"popup")
if(fe){b("first_offer",f.now())
fe=false}var x=c()
var M=u()
var D=Z.MODAL
var P=le
if(C.x1()<=le)P=980
_({no_fullscreen_zoom:true,width:P,height:_e,color:O,y0:0,tick:function tick(e){if(U()){H()
return}j.clock_animation.update(k.getFrameDt())
var t=e.y0,r=e.font_height
var a=firstOfferGetTimeLeft()
if(-1!==firstOfferGetExpireTime()&&a<0)Q("first_offer",1,H)
if(!ne)loadFirstOfferImages()
var i=oe
var o=.2*P
var n=t+.35*_e
i.promo_photo.draw({x:o,y:n,z:D,w:ce,h:ue})
var s=D+1
var l=P===le?.5*P:.55*P
var _=1.5*r
var c=r
var u
if(a>2*se)u=""+X.duration(.001*a,q)
else u=Y(a,{hide_ms:true})
var d=X.$(X.LBL_LIMITED_TIME_OFFER,u)
var f=x.getStringWidth(ie,_,d)
z({x:l-50,y:t-8,z:D,w:f+66,h:50,color:$,pixel_scale:V()/256,sprite:G.sprites.hint_panel})
var v={x:l-4-.5*_,y:t+.5*_,w:_,h:_,z:s,color:J,frame:j.clock_animation.getFrame()}
j.clock_sprite.draw(v)
x.drawSizedAligned(ie,l,t,s,_,x.ALIGN.HLEFT,0,0,d)
var h=t+.16*_e
var p=350
M.drawSizedAlignedWrapped(ae,l,h,s,0,_,x.ALIGN.HLEFT,p,0,X.LBL_LIMITED_TIME_OFFER_NAME.toLocalString().toUpperCase())
var m=h+2*_+16
var E=[""+X.addColon(X.LBL_LIMITED_TIME_OFFER_INCLUDED),"  • "+X.LBL_LIMITED_TIME_OFFER_ITEM_1,"  • "+X.LBL_LIMITED_TIME_OFFER_ITEM_2,"  • "+X.LBL_LIMITED_TIME_OFFER_ITEM_3]
for(var g=0;g<E.length;g++){x.drawSizedAligned(re,l,m,s,c,x.ALIGN.HLEFT,0,0,E[g])
m+=c}if(null!=he&&he.amount){var T=m+16
var y=l
y+=x.drawSizedAligned(re,y,T,s,_,x.ALIGN.HLEFT,0,0,X.LBL_LIMITED_TIME_OFFER_ALL_FOR)
var S=""+Math.round(he.amount/.346*100)/100
var I=x.drawSizedAligned(te,y,T,s,_,x.ALIGN.HLEFT,0,0,S)
W(y,T+.5*_,y+I,T+.5*_,s+1,.1*_,1,$)
x.drawSizedAligned(re,y+=I+4,T,s,_,x.ALIGN.HLEFT,0,0,he.amount+"!!")}de+=.002*k.frame_dt
var A=180+10*Math.sin(de)
var w=P*(P===le?.85:.9)
var L=.7*_e
i.discount_banner.draw({x:w,y:L,z:D,rot:Math.PI/12,w:A,h:A})
var O=.13*_e
var R=.2*P
var b=.38*P
var N=l-80
var C=_e-.5*O-32
if(F({x:N-.5*R,y:C,z:s,h:O,w:R,font_height:_,text:X.LBL_LIMITED_TIME_OFFER_MAYBE_LATER}))H()
if(F({x:(N+=R+30)-.5*R,y:C,z:s,h:O,w:b,colors:ee,font_height:_,text:X.$(X.LBL_LIMITED_TIME_OFFER_SHUT_UP,null==he?void 0:he.formatted)}))K(B)
e.y=_e}})}var P
function triggerFirstOfferPrompt(){if(ve)return
if(!(he=g(B))||l()||U()||L()===I||L()===S||L()===w||L()===A||d.get("w")||d.get("u")){P=setTimeout(triggerFirstOfferPrompt,x)
return}showFirstOffer(false)}function firstOfferInit(){loadFirstOfferImages()
triggerFirstOfferPrompt()}function checkFirstOfferAvailability(){clearTimeout(P)
var e=o().getMyUserChannel()
i(e)
var t=e.getChannelData("public.permissions.owned",{})
if(t&&!U())if(t.chuman_farmer&&t.chuman_harvester)Q("first_offer",1)
else{var r=e.getChannelData("public.prompts_seen",{})
if(!r.first_offer){fe=true
firstOfferInit()}else if(1!==r.first_offer)if(firstOfferGetTimeLeft()<0)Q("first_offer",1,H)
else firstOfferInit()}}function showFirstOfferOnIapAvailable(){if(!o().loggedIn()||ve)return
var a=o().getMyUserChannel()
i(a)
a.onceSubscribe(function(){var e=a.getChannelData("public")
if(e){var t=e.prompts_seen
var r=e.worlds
if(t&&(t.create_first_world||t.first_offer)||r&&!h(r))checkFirstOfferAvailability()}})}},{"../glov/client/camera2d.js":295,"../glov/client/engine":305,"../glov/client/net":338,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/client/walltime":370,"../glov/common/util":400,"../glov/common/vmath":402,"./analytics":6,"./character_customization":39,"./in_app_purchases/iap_client_worlds":111,"./localization/localization":131,"./menu":140,"./prompt":169,"./styles.js":197,assert:void 0}],188:[function(e,t,u){"use strict"
u.skyGetTime=skyGetTime
u.calcTimeOffsetForNewScale=calcTimeOffsetForNewScale
u.skyGetTimeOfDay=skyGetTimeOfDay
u.skyShowLODs=skyShowLODs
u.skyGetTorchColors=skyGetTorchColors
u.skyGetSunBrightness=skyGetSunBrightness
u.skyStartupEarly=skyStartupEarly
u.skyStartup=skyStartup
u.skyEdit=skyEdit
u.skyAllowAnyThisFrame=skyAllowAnyThisFrame
u.skyTick=skyTick
u.skyShift=skyShift
u.skyReinit=skyReinit
u.skyDraw=skyDraw
u.sky_props=u.fog_color=u.fog_params=u.skytime_value=u.day_idx=void 0
var d=600
var f=3
var v=24/(1e3*d)
var U=.001
var s=e("assert")
var r=e("../glov/client/cmds").cmd_parse
var m=e("../glov/client/color_picker").colorPicker
var G=e("../glov/client/engine")
var a=e("../glov/client/engine")
var i=a.addViewSpaceGlobal
var F=a.getFrameDt
var W=a.getFrameIndex
var o=e("../glov/client/filewatch").filewatchOn
var E=e("../glov/client/font")
var n=e("../glov/client/hsv").hsvToRGB
var g=e("../glov/client/input")
var l=e("../glov/client/models")
var _=e("../glov/client/quat")
var c=_.qFromAxisAngle
var h=_.quat
var p=_.unit_quat
var T=e("../glov/client/shaders")
var y=e("../glov/client/slider").slider
var S=e("../glov/client/textures")
var I=e("../glov/client/ui")
var A=e("../glov/client/walltime")
var w=e("../glov/client/webfs")
var L=w.webFSGetFile
var O=w.webFSGetFileNames
var R=e("../glov/common/util")
var H=R.clamp
var b=R.cloneShallow
var N=R.easeIn
var z=R.lerp
var C=R.ridx
var x=e("../glov/common/vmath")
var M=x.mat4
var D=x.v2distSq
var V=x.v3add
var P=x.v3addScale
var Y=x.v3copy
var B=x.v3distSq
var k=x.v3iAdd
var j=x.v3iAddScale
var K=x.v3iMul
var q=x.v3iNormalize
var X=x.v3iSub
var Q=x.v3lerp
var $=x.v3mul
var J=x.v3mulMat4
var ee=x.v3pow
var te=x.v3scale
var re=x.v3set
var ae=x.vec1
var ie=x.vec3
var oe=x.vec4
var ne=x.zaxis
var se=x.zero_vec
var le=e("../common/globals").CHUNK_SIZE
var _e=e("./camera")
var ce=_e.getCurrentCameraPos
var ue=_e.getCurrentCameraTargetDir
var de=_e.getCurrentCameraUnderwater
var fe=e("./main")
var ve=e("./main").charControllerPos
var he=e("./photo_mode").getPhotoTime
var pe=e("./styles").label_style
var me=e("./user_data")
var Ee=me.BLOOD_MOON_MOD
var ge=me.setStaminaUsageScaleMod
var Te=e("./voxel_chunk_manager")
var ye=e("./voxel_const").origin_chunk
var Se=e("./voxel_data")
var Ie=e("./voxel_data_drawable").voxelDataDrawableLoad
var Ae=e("./world_metadata")
var we=Ae.adventureMode
var Le=Ae.worldBoostPerk
var Oe=Ae.worldMetadata
var Re=Math.cos,be=Math.ceil,Ne=Math.floor,Ce=Math.max,xe=Math.min,Me=Math.PI,De=Math.pow,Pe=Math.random,Be=Math.round,ke=Math.sin,Ue=Math.sqrt
var Ge=2*Me
var Fe
var We=-1
var He=[]
var ze={}
var Ve=0
u.day_idx=Ve
r.registerValue("day_idx",{help:"(Admin) Show the current day index",access_run:["sysadmin"],get:function get(){return Ve}})
var Ye=0
u.skytime_value=Ye
r.registerValue("skytime_value",{help:"(Admin) Show the current skytime value (floating point day)",access_run:["sysadmin"],get:function get(){return Ye}})
function skyGetTime(){return Ye}var je=1
r.registerValue("skytime_scale",{help:"(Admin) (Client-only) Scale the global skytime rate",access_run:["sysadmin"],type:r.TYPE_FLOAT,range:[0,1e3],get:function get(){return je},set:function set(e){je=e}})
var Ke={}
var qe
var Ze=[]
var Xe
var Qe
var $e
var Je=ie()
var et=ie()
var tt=ie()
var rt=ie()
var at=oe()
var it=oe()
var ot=oe()
var nt=oe()
var st={sky_colortop_diskmul:at,sky_colormid_weight:it,sky_colorsun_diskadd:ot,sky_colorglow_fade:nt,camera_pos_ws:rt,sun_vec_vs:tt}
var lt=1
var _t=ie()
u.fog_params=_t
var ct=ae()
var ut=ie()
var dt=ie()
var ft=ie()
var vt=ie(0,0,-1)
var ht=ie(1,0,0)
var pt=ie()
function colorToText(e){var t=[]
for(var r=0;r<3;++r)t.push(("0"+Be(255*e[r]).toString(16)).slice(-2))
return t.join("")}function colorFromText(e,t){if(3!==t.length&&6!==t.length)return e
var r=2
var a=255
if(3===t.length){r=1
a=15}for(var i=0;i<3;++i)e[i]=parseInt(t.slice(i*r,(i+1)*r),16)/a
return e}var mt=ie(0,0,0)
u.fog_color=mt
var Et=ie(0,0,0)
var gt={sun_pos:ie(),light_dir_ws:ie(0,0,1)}
u.sky_props=gt
function getRawTime(){var e
var t=Oe()||{}
var r=t.time_offs||0
var a=null!=(e=t.time_scale)?e:1
var i=A()*v*a+r
var o=Ne(i/24)
return H(i-24*o,0,23.9999)}var Tt=0
r.register({cmd:"nextday",help:"(Admin)(Client only) Advance to the next day",access_run:["sysadmin"],func:function func(e,t){Tt++
return t(null,"Day advanced")}})
function parseTime(e){var t=Number(e)
if(isFinite(t))return t
return{midnight:0,dawn:4.5,sunrise:5,day:8,noon:12,midday:12,sunset:19,dusk:20.2,night:22}[e]}r.register({cmd:"time",help:"Set or display current time",func:function func(e,t){var r=Oe()
if(!r)return t("Not currently in a world")
if(e){var a=parseTime(e)
if(void 0===a)return t("Usage: /time [0-24]")
var i=getRawTime()
if(a<i)a+=24
var o=a-i
var n=r.time_offs+o
while(n>=24)n-=24
fe.chat_ui.cmdParse("world_time_offs "+n)
return t()}else return t(null,"time = "+gt.time.toFixed(3))}})
function calcTimeOffsetForNewScale(e){var t=A()
var r=getRawTime()-t*v*e%24
if(r<0)r+=24
return r}r.register({cmd:"time_scale",help:"Set or display current time scale",func:function func(e,t){var r=Oe()
if(!r)return t("Not currently in a world")
if(e){var a=Number(e)
if(!isFinite(a)||a<0||a>1e3)return t("Usage: /time_scale [SCALE 0-100 (default 1)]")
var i=calcTimeOffsetForNewScale(a)
fe.chat_ui.cmdParse("world_time_scale "+a+" "+i)
return t()}else{var o=24/(r.time_scale*v*60*1e3)
var n=o.toFixed(0)+" minutes"
if(o<2)n=(60*o).toFixed(0)+" seconds"
return t(null,"time_scale = "+r.time_scale.toFixed(3)+" (1 game day = "+n+")")}}})
var yt={latitude:{def:45*Me/180,range:[0,Me/2],radians:true,interp:false},axial_tilt:{def:23.5*Me/180,range:[0,Me/2],radians:true,interp:false},solar_orbit:{def:0,range:[0,Ge],radians:true,interp:false},time:{def:10,range:[0,24],interp:false},time_scale:{def:1,range:[0,100],interp:false,gamma:true},torch_hue_min:{def:10,range:[0,360]},torch_hue_max:{def:50,range:[0,360]},torch_hue_freq:{def:78e-5,range:[0,.01]},torch_value_min:{def:.9,range:[0,1]},torch_value_max:{def:1,range:[0,1]},torch_value_freq:{def:.008,range:[0,.01]},torch_sat:{def:.2,range:[0,1]},torch_color_top:{def:[1,.7,.7],color:true,gamma:true},torch_color_bot:{def:[.65,.65,1],color:true,gamma:true},light_sun_key:{def:[.8,.8,.65],color:true,gamma:true},light_sun_top:{def:[.1,.1,.1],color:true,gamma:true},light_sun_back:{def:[.2,.2,.45],color:true,gamma:true},fog_extinction:{def:45e-5,range:[0,.02],gamma:true},fog_inscattering:{def:1e-4,range:[0,.02],gamma:true},fog_start_dist:{def:200,range:[0,1e3]},sun_disk_radius:{def:.25,range:[0,1]},sun_color:{def:[1,1,1],color:true},sun_disk_intensity:{def:8,range:[0,16]},sun_glow:{def:[0,0,0],color:true},color_top:{def:[.12,.28,.56],color:true},color_mid:{def:[.68,1,1],color:true},color_mid_weight:{def:2,range:[.01,10]},moon_color:{def:[1,1,1],color:true},moon_scale:{def:1,range:[0,4]},show_clouds:{def:1,range:[0,1]},show_lods:{def:1,range:[0,1]},underground_factor:{def:0,range:[0,1]}}
var St=Object.keys(yt).filter(function(e){return false!==yt[e].interp})
var It={color:false}
function skyGetTimeOfDay(){return gt.time}function skyShowLODs(){return gt.show_lods>.5}var At=0
var wt=77
function skyGetTorchColors(e,t,r){var a=(gt.torch_value_min+gt.torch_value_max)/2+(gt.torch_value_max-gt.torch_value_min)/2*ke(At)
var i=(gt.torch_hue_min+gt.torch_hue_max)/2+(gt.torch_hue_max-gt.torch_hue_min)/2*ke(wt)
n(t,i,gt.torch_sat,a)
$(e,t,gt.torch_color_top)
$(r,t,gt.torch_color_bot)}function skyGetSunBrightness(){return Ce(ut[0],ut[1],ut[2],dt[0],dt[1],dt[2])}var Lt
function updateDayIdx(){var e=Oe()||{time_offs:0,time_scale:1}
var t=e.time_offs,r=e.time_scale,a=e.created
var i=A()
var o=i*v*r+t
var n=Ne(o/24)
if(G.defines.SKYEDIT||1!==je){if(Lt!==G.frame_index-1){if(Oe()){gt.time_scale=r
gt.time=H(o-24*n,0,23.9999)
Lt=G.frame_index}}else Lt=G.frame_index
var s=G.frame_dt
gt.time+=s*v*je*gt.time_scale
if(gt.time>=24){gt.time-=24
u.day_idx=Ve+=1}u.skytime_value=Ye=Ve+gt.time/24}else{gt.time=getRawTime()
if(1===r&&0===t){var l=be(a/(1e3*d)+17/24+f)*d*1e3
if(i<l){var _=1-(l-(i=Ce(a,i)))/(1e3*d)
gt.time=Ce(10,24*_)}}var c=i*v
u.skytime_value=Ye=c/24+Tt
u.day_idx=Ve=Ne(Ye)}}function skyLoad(e){var t=L("skies/"+e,"jsobj")
for(var r in t){var a=t[r]
for(var i=1;i<a.length;i+=2){var o=a[i]
if(Array.isArray(o)){s(3===o.length||4===o.length)
a[i]=ie(o[0],o[1],o[2])}}}Ke[e]=t}function skyReload(e){skyLoad(e.match(/skies\/(.*)/)[1])
We=-1
He=[]
ze={}}function skyStartupEarly(){T.addGlobal("fog_params",_t)
T.addGlobal("fog_color",mt)
T.addGlobal("sun_glow",Et)
T.addGlobal("minimum_ambient",ct)
T.addGlobal("light_sun_key",ut)
T.addGlobal("light_sun_top",dt)
T.addGlobal("light_sun_back",ft)
T.addGlobal("light_dir_top_ws",vt)
i("light_dir_top")
T.addGlobal("light_dir_back_ws",pt)
i("light_dir_back")
T.addGlobal("pos_x_ws",ht)
i("pos_x")}function skyStartup(){qe=Ie("moon.vm",b(L("model_opts/moon","jsobj"))).drawing
Ze.push(Se.loadGoxel("# Goxel 0.8.3\r\n# One line per voxel\r\n# X Y Z RRGGBB\r\n-5 0 -2 d8eaf2\r\n-4 0 -2 d8eaf2\r\n-3 0 -2 d8eaf2\r\n-5 1 -2 d8eaf2\r\n-4 1 -2 d8eaf2\r\n-3 1 -2 d8eaf2\r\n-6 0 -1 d8eaf2\r\n-5 0 -1 d8eaf2\r\n-4 0 -1 d8eaf2\r\n-3 0 -1 d8eaf2\r\n-2 0 -1 d8eaf2\r\n-1 0 -1 d8eaf2\r\n-5 1 -1 d8eaf2\r\n-4 1 -1 d8eaf2\r\n-3 1 -1 d8eaf2\r\n-1 1 -1 d8eaf2\r\n-6 0 0 d8eaf2\r\n-5 0 0 d8eaf2\r\n-4 0 0 d8eaf2\r\n-3 0 0 d8eaf2\r\n-2 0 0 d8eaf2\r\n-1 0 0 d8eaf2\r\n-5 1 0 d8eaf2\r\n-4 1 0 d8eaf2\r\n-3 1 0 d8eaf2\r\n-1 1 0 d8eaf2\r\n-5 0 1 d8eaf2\r\n-4 0 1 d8eaf2\r\n-3 0 1 d8eaf2\r\n-5 1 1 d8eaf2\r\n-4 1 1 d8eaf2\r\n-3 1 1 d8eaf2\r\n-5 -2 -2 d8eaf2\r\n-4 -2 -2 d8eaf2\r\n-3 -2 -2 d8eaf2\r\n-5 -1 -2 d8eaf2\r\n-4 -1 -2 d8eaf2\r\n-3 -1 -2 d8eaf2\r\n-1 -4 -1 d8eaf2\r\n-1 -3 -1 d8eaf2\r\n-6 -2 -1 d8eaf2\r\n-5 -2 -1 d8eaf2\r\n-4 -2 -1 d8eaf2\r\n-3 -2 -1 d8eaf2\r\n-1 -2 -1 d8eaf2\r\n-6 -1 -1 d8eaf2\r\n-5 -1 -1 d8eaf2\r\n-4 -1 -1 d8eaf2\r\n-3 -1 -1 d8eaf2\r\n-2 -1 -1 d8eaf2\r\n-1 -1 -1 d8eaf2\r\n0 -3 -2 d8eaf2\r\n1 -3 -2 d8eaf2\r\n0 -2 -2 d8eaf2\r\n1 -2 -2 d8eaf2\r\n0 -4 -1 d8eaf2\r\n1 -4 -1 d8eaf2\r\n2 -4 -1 d8eaf2\r\n0 -3 -1 d8eaf2\r\n1 -3 -1 d8eaf2\r\n2 -3 -1 d8eaf2\r\n0 -2 -1 d8eaf2\r\n1 -2 -1 d8eaf2\r\n2 -2 -1 d8eaf2\r\n0 -1 -1 d8eaf2\r\n1 -1 -1 d8eaf2\r\n2 -1 -1 d8eaf2\r\n-1 -4 0 d8eaf2\r\n-1 -3 0 d8eaf2\r\n-6 -2 0 d8eaf2\r\n-5 -2 0 d8eaf2\r\n-4 -2 0 d8eaf2\r\n-3 -2 0 d8eaf2\r\n-1 -2 0 d8eaf2\r\n-6 -1 0 d8eaf2\r\n-5 -1 0 d8eaf2\r\n-4 -1 0 d8eaf2\r\n-3 -1 0 d8eaf2\r\n-2 -1 0 d8eaf2\r\n-1 -1 0 d8eaf2\r\n-1 -3 1 d8eaf2\r\n-5 -2 1 d8eaf2\r\n-4 -2 1 d8eaf2\r\n-3 -2 1 d8eaf2\r\n-1 -2 1 d8eaf2\r\n-5 -1 1 d8eaf2\r\n-4 -1 1 d8eaf2\r\n-3 -1 1 d8eaf2\r\n0 -4 0 d8eaf2\r\n1 -4 0 d8eaf2\r\n2 -4 0 d8eaf2\r\n0 -3 0 d8eaf2\r\n1 -3 0 d8eaf2\r\n2 -3 0 d8eaf2\r\n0 -2 0 d8eaf2\r\n1 -2 0 d8eaf2\r\n2 -2 0 d8eaf2\r\n0 -1 0 d8eaf2\r\n1 -1 0 d8eaf2\r\n2 -1 0 d8eaf2\r\n0 -4 1 d8eaf2\r\n1 -4 1 d8eaf2\r\n0 -3 1 d8eaf2\r\n1 -3 1 d8eaf2\r\n2 -3 1 d8eaf2\r\n0 -2 1 d8eaf2\r\n1 -2 1 d8eaf2\r\n2 -2 1 d8eaf2\r\n0 -1 1 d8eaf2\r\n1 -1 1 d8eaf2\r\n0 0 -2 d8eaf2\r\n1 1 -2 d8eaf2\r\n2 1 -2 d8eaf2\r\n1 2 -2 d8eaf2\r\n2 2 -2 d8eaf2\r\n0 0 -1 d8eaf2\r\n1 0 -1 d8eaf2\r\n2 0 -1 d8eaf2\r\n0 1 -1 d8eaf2\r\n1 1 -1 d8eaf2\r\n2 1 -1 d8eaf2\r\n3 1 -1 d8eaf2\r\n0 2 -1 d8eaf2\r\n1 2 -1 d8eaf2\r\n2 2 -1 d8eaf2\r\n3 2 -1 d8eaf2\r\n1 3 -1 d8eaf2\r\n2 3 -1 d8eaf2\r\n0 0 0 d8eaf2\r\n1 0 0 d8eaf2\r\n2 0 0 d8eaf2\r\n0 1 0 d8eaf2\r\n1 1 0 d8eaf2\r\n2 1 0 d8eaf2\r\n3 1 0 d8eaf2\r\n0 2 0 d8eaf2\r\n1 2 0 d8eaf2\r\n2 2 0 d8eaf2\r\n3 2 0 d8eaf2\r\n1 3 0 d8eaf2\r\n2 3 0 d8eaf2\r\n3 3 0 d8eaf2\r\n0 0 1 d8eaf2\r\n1 1 1 d8eaf2\r\n2 1 1 d8eaf2\r\n3 1 1 d8eaf2\r\n1 2 1 d8eaf2\r\n2 2 1 d8eaf2\r\n3 2 1 d8eaf2\r\n"))
Ze.push(Se.loadGoxel("# Goxel 0.8.3\r\n# One line per voxel\r\n# X Y Z RRGGBB\r\n-5 -4 -2 d8eaf2\r\n-4 -4 -2 d8eaf2\r\n-3 -4 -2 d8eaf2\r\n-5 -3 -2 d8eaf2\r\n-4 -3 -2 d8eaf2\r\n-3 -3 -2 d8eaf2\r\n-2 -3 -2 d8eaf2\r\n-5 -2 -2 d8eaf2\r\n-4 -2 -2 d8eaf2\r\n-3 -2 -2 d8eaf2\r\n-2 -2 -2 d8eaf2\r\n-4 -1 -2 d8eaf2\r\n-3 -1 -2 d8eaf2\r\n-2 -1 -2 d8eaf2\r\n-1 -1 -2 d8eaf2\r\n-4 -5 -1 d8eaf2\r\n-3 -5 -1 d8eaf2\r\n-5 -4 -1 d8eaf2\r\n-4 -4 -1 d8eaf2\r\n-3 -4 -1 d8eaf2\r\n-2 -4 -1 d8eaf2\r\n-1 -4 -1 d8eaf2\r\n-6 -3 -1 d8eaf2\r\n-5 -3 -1 d8eaf2\r\n-4 -3 -1 d8eaf2\r\n-3 -3 -1 d8eaf2\r\n-2 -3 -1 d8eaf2\r\n-1 -3 -1 d8eaf2\r\n-5 -2 -1 d8eaf2\r\n-4 -2 -1 d8eaf2\r\n-3 -2 -1 d8eaf2\r\n-2 -2 -1 d8eaf2\r\n-1 -2 -1 d8eaf2\r\n-5 -1 -1 d8eaf2\r\n-4 -1 -1 d8eaf2\r\n-3 -1 -1 d8eaf2\r\n-2 -1 -1 d8eaf2\r\n-1 -1 -1 d8eaf2\r\n0 -1 -2 d8eaf2\r\n1 -1 -2 d8eaf2\r\n0 -2 -1 d8eaf2\r\n0 -1 -1 d8eaf2\r\n1 -1 -1 d8eaf2\r\n-1 0 -2 d8eaf2\r\n-1 1 -2 d8eaf2\r\n-1 2 -2 d8eaf2\r\n-5 0 -1 d8eaf2\r\n-4 0 -1 d8eaf2\r\n-3 0 -1 d8eaf2\r\n-2 0 -1 d8eaf2\r\n-1 0 -1 d8eaf2\r\n-5 1 -1 d8eaf2\r\n-4 1 -1 d8eaf2\r\n-3 1 -1 d8eaf2\r\n-2 1 -1 d8eaf2\r\n-1 1 -1 d8eaf2\r\n-2 2 -1 d8eaf2\r\n-1 2 -1 d8eaf2\r\n-2 3 -1 d8eaf2\r\n-1 3 -1 d8eaf2\r\n0 0 -2 d8eaf2\r\n1 0 -2 d8eaf2\r\n0 1 -2 d8eaf2\r\n1 1 -2 d8eaf2\r\n0 2 -2 d8eaf2\r\n1 2 -2 d8eaf2\r\n0 3 -2 d8eaf2\r\n0 0 -1 d8eaf2\r\n1 0 -1 d8eaf2\r\n0 1 -1 d8eaf2\r\n1 1 -1 d8eaf2\r\n0 2 -1 d8eaf2\r\n1 2 -1 d8eaf2\r\n0 3 -1 d8eaf2\r\n1 3 -1 d8eaf2\r\n-4 -5 0 d8eaf2\r\n-3 -5 0 d8eaf2\r\n-5 -4 0 d8eaf2\r\n-4 -4 0 d8eaf2\r\n-3 -4 0 d8eaf2\r\n-2 -4 0 d8eaf2\r\n-6 -3 0 d8eaf2\r\n-5 -3 0 d8eaf2\r\n-4 -3 0 d8eaf2\r\n-3 -3 0 d8eaf2\r\n-2 -3 0 d8eaf2\r\n-5 -2 0 d8eaf2\r\n-4 -2 0 d8eaf2\r\n-3 -2 0 d8eaf2\r\n-2 -2 0 d8eaf2\r\n-1 -2 0 d8eaf2\r\n-5 -1 0 d8eaf2\r\n-4 -1 0 d8eaf2\r\n-3 -1 0 d8eaf2\r\n-2 -1 0 d8eaf2\r\n-1 -1 0 d8eaf2\r\n-5 -4 1 d8eaf2\r\n-4 -4 1 d8eaf2\r\n-3 -4 1 d8eaf2\r\n-5 -3 1 d8eaf2\r\n-4 -3 1 d8eaf2\r\n-3 -3 1 d8eaf2\r\n-2 -3 1 d8eaf2\r\n-5 -2 1 d8eaf2\r\n-4 -2 1 d8eaf2\r\n-3 -2 1 d8eaf2\r\n-2 -2 1 d8eaf2\r\n-4 -1 1 d8eaf2\r\n-3 -1 1 d8eaf2\r\n-2 -1 1 d8eaf2\r\n-1 -1 1 d8eaf2\r\n0 -2 0 d8eaf2\r\n0 -1 0 d8eaf2\r\n1 -1 0 d8eaf2\r\n0 -1 1 d8eaf2\r\n1 -1 1 d8eaf2\r\n-5 0 0 d8eaf2\r\n-4 0 0 d8eaf2\r\n-3 0 0 d8eaf2\r\n-2 0 0 d8eaf2\r\n-1 0 0 d8eaf2\r\n-5 1 0 d8eaf2\r\n-4 1 0 d8eaf2\r\n-3 1 0 d8eaf2\r\n-2 1 0 d8eaf2\r\n-1 1 0 d8eaf2\r\n-4 2 0 d8eaf2\r\n-3 2 0 d8eaf2\r\n-2 2 0 d8eaf2\r\n-1 2 0 d8eaf2\r\n-2 3 0 d8eaf2\r\n-1 3 0 d8eaf2\r\n-5 0 1 d8eaf2\r\n-4 0 1 d8eaf2\r\n-3 0 1 d8eaf2\r\n-1 0 1 d8eaf2\r\n-4 1 1 d8eaf2\r\n-3 1 1 d8eaf2\r\n-2 1 1 d8eaf2\r\n-1 1 1 d8eaf2\r\n-2 2 1 d8eaf2\r\n-1 2 1 d8eaf2\r\n-1 3 1 d8eaf2\r\n0 0 0 d8eaf2\r\n1 0 0 d8eaf2\r\n0 1 0 d8eaf2\r\n1 1 0 d8eaf2\r\n2 1 0 d8eaf2\r\n0 2 0 d8eaf2\r\n1 2 0 d8eaf2\r\n2 2 0 d8eaf2\r\n0 3 0 d8eaf2\r\n1 3 0 d8eaf2\r\n0 0 1 d8eaf2\r\n1 0 1 d8eaf2\r\n0 1 1 d8eaf2\r\n1 1 1 d8eaf2\r\n0 2 1 d8eaf2\r\n1 2 1 d8eaf2\r\n0 3 1 d8eaf2\r\n1 3 1 d8eaf2\r\n0 1 2 d8eaf2\r\n0 2 2 d8eaf2\r\n"))
Ze.push(Se.loadGoxel("# Goxel 0.8.3\r\n# One line per voxel\r\n# X Y Z RRGGBB\r\n-3 -4 -1 d8eaf2\r\n-1 -4 -1 d8eaf2\r\n-1 -3 -1 d8eaf2\r\n-1 -1 -1 d8eaf2\r\n0 -4 -2 d8eaf2\r\n1 -4 -2 d8eaf2\r\n2 -4 -2 d8eaf2\r\n0 -3 -2 d8eaf2\r\n1 -3 -2 d8eaf2\r\n2 -3 -2 d8eaf2\r\n0 -2 -2 d8eaf2\r\n1 -2 -2 d8eaf2\r\n0 -1 -2 d8eaf2\r\n0 -5 -1 d8eaf2\r\n1 -5 -1 d8eaf2\r\n2 -5 -1 d8eaf2\r\n0 -4 -1 d8eaf2\r\n1 -4 -1 d8eaf2\r\n2 -4 -1 d8eaf2\r\n0 -3 -1 d8eaf2\r\n1 -3 -1 d8eaf2\r\n2 -3 -1 d8eaf2\r\n0 -2 -1 d8eaf2\r\n1 -2 -1 d8eaf2\r\n2 -2 -1 d8eaf2\r\n0 -1 -1 d8eaf2\r\n1 -1 -1 d8eaf2\r\n2 -1 -1 d8eaf2\r\n-4 0 -1 d8eaf2\r\n-3 0 -1 d8eaf2\r\n-1 0 -1 d8eaf2\r\n-1 1 -1 d8eaf2\r\n-1 2 -1 d8eaf2\r\n-2 3 -1 d8eaf2\r\n-1 3 -1 d8eaf2\r\n0 0 -2 d8eaf2\r\n1 0 -2 d8eaf2\r\n2 0 -2 d8eaf2\r\n0 1 -2 d8eaf2\r\n1 1 -2 d8eaf2\r\n2 1 -2 d8eaf2\r\n0 2 -2 d8eaf2\r\n1 2 -2 d8eaf2\r\n0 3 -2 d8eaf2\r\n0 0 -1 d8eaf2\r\n1 0 -1 d8eaf2\r\n2 0 -1 d8eaf2\r\n3 0 -1 d8eaf2\r\n0 1 -1 d8eaf2\r\n1 1 -1 d8eaf2\r\n2 1 -1 d8eaf2\r\n3 1 -1 d8eaf2\r\n0 2 -1 d8eaf2\r\n1 2 -1 d8eaf2\r\n2 2 -1 d8eaf2\r\n0 3 -1 d8eaf2\r\n1 3 -1 d8eaf2\r\n2 3 -1 d8eaf2\r\n-1 -4 0 d8eaf2\r\n-1 -3 0 d8eaf2\r\n-1 -2 0 d8eaf2\r\n-1 -1 0 d8eaf2\r\n0 -5 0 d8eaf2\r\n1 -5 0 d8eaf2\r\n2 -5 0 d8eaf2\r\n0 -4 0 d8eaf2\r\n1 -4 0 d8eaf2\r\n2 -4 0 d8eaf2\r\n0 -3 0 d8eaf2\r\n1 -3 0 d8eaf2\r\n2 -3 0 d8eaf2\r\n0 -2 0 d8eaf2\r\n1 -2 0 d8eaf2\r\n2 -2 0 d8eaf2\r\n0 -1 0 d8eaf2\r\n1 -1 0 d8eaf2\r\n2 -1 0 d8eaf2\r\n0 -4 1 d8eaf2\r\n1 -4 1 d8eaf2\r\n2 -4 1 d8eaf2\r\n0 -3 1 d8eaf2\r\n1 -3 1 d8eaf2\r\n2 -3 1 d8eaf2\r\n0 -2 1 d8eaf2\r\n1 -2 1 d8eaf2\r\n0 -1 1 d8eaf2\r\n1 -1 1 d8eaf2\r\n-4 0 0 d8eaf2\r\n-3 0 0 d8eaf2\r\n-1 0 0 d8eaf2\r\n-1 1 0 d8eaf2\r\n-1 2 0 d8eaf2\r\n-2 3 0 d8eaf2\r\n-1 3 0 d8eaf2\r\n-1 2 1 d8eaf2\r\n0 0 0 d8eaf2\r\n1 0 0 d8eaf2\r\n2 0 0 d8eaf2\r\n3 0 0 d8eaf2\r\n0 1 0 d8eaf2\r\n1 1 0 d8eaf2\r\n2 1 0 d8eaf2\r\n3 1 0 d8eaf2\r\n0 2 0 d8eaf2\r\n1 2 0 d8eaf2\r\n2 2 0 d8eaf2\r\n0 3 0 d8eaf2\r\n1 3 0 d8eaf2\r\n2 3 0 d8eaf2\r\n0 4 0 d8eaf2\r\n1 4 0 d8eaf2\r\n0 0 1 d8eaf2\r\n1 0 1 d8eaf2\r\n2 0 1 d8eaf2\r\n0 1 1 d8eaf2\r\n1 1 1 d8eaf2\r\n2 1 1 d8eaf2\r\n0 2 1 d8eaf2\r\n1 2 1 d8eaf2\r\n2 2 1 d8eaf2\r\n0 3 1 d8eaf2\r\n1 3 1 d8eaf2\r\n"))
Xe=l.load("models/sky/sky_sphere.glb")
Qe=T.create("shaders/sky.fp")
$e=T.create("shaders/sky.vp")
var e=O("skies/")
for(var t=0;t<e.length;++t)skyLoad(e[t].slice("skies/".length))
o(/^skies\//,skyReload)
for(var r in yt){var a=yt[r]
if(a.color){gt[r]=oe(0,0,0,1)
Y(gt[r],a.def)}else gt[r]=a.def}updateDayIdx()
T.prelink($e,Qe,st)}function formatProp(e){var t=gt[e]
if(yt[e].radians)t=180*t/Me
return t.toPrecision(4)}var Ot=2
var Rt=1/Ot
var bt={latitude:"Orbit",time:"Time",torch_hue_min:"Torch Light",light_sun_key:"Sun Light",sun_disk_radius:"Skydome"}
var Nt=ie()
function skyEdit(){var e=100
var t=500
var r=Z.UI
var a=10
var i=100
var o=i+a
var n=G.font
var s=16
var l=200
var _=pe
for(var c in yt){var u=e+a
if(bt[c]){n.drawSized(_,u,o+8,r,s,bt[c])
o+=s+8}var d=yt[c]
n.drawSizedAligned(_,u,o,r,s,E.ALIGN.HFIT,150,0,c)
if(g.click({x:u,y:o,w:150,h:s}))if(d.color)Y(gt[c],d.def)
else gt[c]=d.def
u+=158
var f=gt[c]
if(d.color){if(d.gamma)ee(Nt,f,Rt)
else Y(Nt,f)
if(!d.edit_box){d.edit_box=I.createEditBox({font_height:s,x:u,y:o,w:l})
d.edit_box.setText(colorToText(Nt))}d.edit_box.run()
if(d.edit_box.isFocused())colorFromText(Nt,d.edit_box.getText())
else d.edit_box.setText(colorToText(Nt))
m({x:u+=l+8,y:o,z:r,icon_h:s,picker_h:250,color:Nt,pad:14})
if(d.gamma)ee(f,Nt,Ot)
else Y(f,Nt)}else{if(d.gamma){var v=De(f-d.range[0],Rt)
var h=y(v,{x:u,y:o,z:r,w:l,h:.8*s,min:0,max:De(d.range[1]-d.range[0],Rt)})
if(h!==v)gt[c]=De(h,Ot)+d.range[0]}else gt[c]=y(f,{x:u,y:o,z:r,w:l,h:.8*s,min:d.range[0],max:d.range[1]})
u+=l+8
n.drawSized(_,u,o,r,s,formatProp(c))}o+=s}var p={x:e-a,y:i,w:t+2*a,h:(o+=s+a)-i,z:r-1}
if(g.pointerLocked())if(g.click(p))g.pointerLockExit()
I.panel(p)}function sameSkies(e,t){if(e.length!==t.length)return false
for(var r=0;r<e.length;++r){var a=e[r]
var i=t[r]
if(a[0]!==i[0]||a[1]!==i[1])return false}return true}function interpField(e,t,r){if(1===t.length)return t[0]
var a=0
var i=0
for(var o=0;o<t.length;o+=2)if(t[o]>Fe){a=(i=o)-2
break}if(!i)s(i,r+"."+t.length+"@"+Fe)
s(t[a]<=Fe)
var n=(Fe-t[a])/(t[i]-t[a])
if(e.color){Q(Nt,n,t[a+1],t[i+1])
return Nt}else return z(n,t[a+1],t[i+1])}var Ct=-1
function skyAllowAnyThisFrame(){Ct=W()}function skyTick(e,t){updateDayIdx()
Fe=null===he()?gt.time:he()
Fe=H(Fe,0,23.9999)
var r=[[Ke.default,1]]
var a=Oe()||{time_offs:0,time_scale:1}
var i=a.time_offs,o=a.time_scale,n=a.sky
var s=Le("skies")
var l=Ct===W()
if(n&&Ke[n]&&(s.includes(n)||l)){var _=Ke[n]
var c=_.overlay_weight?interpField(It,_.overlay_weight):1
r.push([_,c])}if(we()&&0===i&&1===o&&(Fe>20&&Ve%27===0||Fe<4&&Ve%27===1)){ge(Ee,true)
r.push([Ke.bloodmoon_blend,H(interpField(It,Ke.bloodmoon_blend.overlay_weight),0,1)])}else ge(Ee,false)
var u=F()
var d=t&&t.props&&t.props.sky
if(d&&(!Ke[d]||!s.includes(d)&&!l))d=void 0
var f=u*U
if(d)ze[d]=xe((ze[d]||0)+f,1)
for(var v in ze){var h=ze[v]
if(v!==d)if(!(h=Ce(0,h-f)))delete ze[v]
else ze[v]=h
if(h){var p=Ke[v]
var m=p.overlay_weight?interpField(It,p.overlay_weight):1
r.push([p,H(m*h,0,1)])}}if(de())r.push([Ke.underwater,1])
if(Fe!==We||!sameSkies(r,He)){We=Fe
He=r
for(var E=0;E<St.length;++E){var g=St[E]
var T=yt[g]
var y=1
var S=true
for(var I=r.length-1;I>=0;--I){var A=r[I]
var w=A[0][g]
if(!w)continue
var L=H(A[1],0,y)
if(!L)continue
var O=interpField(T,w,g)
if(S){S=false
if(T.color)te(gt[g],O,L)
else gt[g]=O*L}else if(T.color)j(gt[g],O,L)
else gt[g]+=L*O
y-=L}}}var R
var b
var N
var C
var x
var M=ie(0,0,-1)
R=Re(gt.solar_orbit)
b=ke(gt.solar_orbit)
N=M[0]
x=M[2]
M[0]=R*N+b*x
M[2]=-b*N+R*x
R=Re(gt.axial_tilt)
b=ke(gt.axial_tilt)
C=M[1]
x=M[2]
M[1]=R*C-b*x
M[2]=b*C+R*x
var D=Fe/24*Ge+gt.solar_orbit
R=Re(-D)
b=ke(-D)
N=M[0]
x=M[2]
M[0]=R*N+b*x
M[2]=-b*N+R*x
R=Re(gt.latitude)
b=ke(gt.latitude)
C=M[1]
x=M[2]
M[1]=R*C-b*x
M[2]=b*C+R*x
Y(gt.sun_pos,M)
te(gt.light_dir_ws,M,-1)
if(gt.light_dir_ws[2]>0)gt.light_dir_ws[2]*=-1
Y(G.light_dir_ws,gt.light_dir_ws)
pt[0]=-gt.light_dir_ws[0]
pt[1]=-gt.light_dir_ws[1]
pt[2]=0
q(pt)
Y(ut,gt.light_sun_key)
Y(dt,gt.light_sun_top)
Y(ft,gt.light_sun_back)
ct[0]=we()?.012:.005
if(G.defines.NOGAMMA){Y(mt,gt.color_mid)
Y(Et,gt.sun_glow)}else{$(mt,gt.color_mid,gt.color_mid)
$(Et,gt.sun_glow,gt.sun_glow)}var P=gt.underground_factor
var B=Ce(P,e[0])
var k=Ce(P,e[1])
if(B>0){Q(ut,B,ut,se)
Q(dt,B,dt,se)
Q(mt,B,mt,se)
Q(ft,B,ft,se)}if(k>0){ct[0]=z(k,ct[0],0)
Q(Et,k,Et,mt)}lt=1-B
re(_t,gt.fog_extinction,gt.fog_inscattering,gt.fog_start_dist)
if(G.defines.OLDLIGHT){Y(G.light_ambient,ft)
V(G.light_diffuse,ut,dt)
X(G.light_diffuse,G.light_ambient)}At+=u*gt.torch_value_freq
wt+=u*gt.torch_hue_freq}var xt=M()
function drawSkySphere(){var e=ce()
te(Je,ue(),-1)
Y(et,gt.sun_pos)
Y(rt,e)
J(tt,et,G.mat_view)
if(G.defines.NOGAMMA){Y(at,gt.color_top)
Y(it,gt.color_mid)
te(ot,gt.sun_color,gt.sun_disk_intensity)}else{$(at,gt.color_top,gt.color_top)
$(it,gt.color_mid,gt.color_mid)
te(ot,gt.sun_color,gt.sun_disk_intensity)
K(ot,ot)}Y(nt,Et)
it[3]=gt.color_mid_weight
ot[3]=-(1-.015*gt.sun_disk_radius)
at[3]=1/(1+ot[3])
ot[3]*=at[3]
nt[3]=lt
xt[0]=xt[5]=xt[10]=.99*G.ZFAR
xt[12]=e[0]
xt[13]=e[1]
xt[14]=e[2]
G.updateMatrices(xt)
S.bind(0,S.textures.error)
T.bind($e,Qe,st)
Xe.drawGeom()}var Mt=[]
function skyShift(e){for(var t=0;t<Mt.length;++t)k(Mt[t].pos,e)}var Dt=1200
var Pt=2e3
var Bt=5e3
var kt=24
function cloudRandomPos(){return(2*Pe()-1)*Pt}var Ut=true
function skyReinit(){Ut=true
We=-1
Mt=[]
He=[]
ze={}}function updateClouds(){var e=ve()
var t=G.frame_dt
for(var r=Mt.length-1;r>=0;--r){var a=Mt[r]
if(a.fading){a.age-=t
if(a.age<0){C(Mt,r)
continue}}else a.age+=t
P(a.pos,a.pos,a.speed,t)
if(!a.fading&&D(a.pos,e)>Pt*Pt*1.5*1.5){a.fading=true
a.age=Bt}}while(Mt.length<10){var i=ye[2]*le
Mt.push({prop:Ze[Ne(Pe()*Ze.length)],pos:ie(Ut?cloudRandomPos():-Pt,cloudRandomPos(),Dt+20*Pe()-i),speed:[.0025+.0025*Pe(),0,0],quat:c(h(),ne,Ne(4*Pe())/4*Ge),age:Ut?Bt:0,color:oe(1,1,1,0)})}Ut=false}function cmpCloudDist(e,t){return t.dist-e.dist}var Gt=ie()
var Ft=[]
var Wt=oe(1,1,1,1)
var Ht=oe(1,1,1,1)
function skyDraw(){re(Wt,lt,lt,lt,1)
updateClouds()
var e=ve()
if(!G.defines.NOSKY)drawSkySphere()
gl.enable(gl.BLEND)
var t=G.ZFAR
P(Gt,e,gt.sun_pos,.9*t)
Gt[2]=e[2]-gt.sun_pos[2]*t*.9-.0325*t
Gt[1]-=.1*t
$(Ht,gt.moon_color,Wt)
var r=gt.show_clouds
if(r>0){Ht[3]=r
qe.draw(Gt,p,180*gt.moon_scale,{unlit:true,color:Ht})}if(!G.defines.NOCLOUDS&&r){G.light_dir_ws[2]*=-1
G.setGlobalMatrices(G.mat_view)
var a=Te.view_dist*le*2
var i=0
for(var o=0;o<Mt.length;++o){var n=Mt[o]
var s=N(xe(n.age/Bt,1),2)
var l=Ue(B(n.pos,e))
s*=H((l-a)/25,0,1)
s*=lt
s*=r
if(!(n.color[3]=s));else if(1!==s){n.dist=l
Ft[i++]=n}else n.prop.draw(n.pos,n.quat,kt,{nofog:true,color:n.color})}if(i){Ft.length=i
Ft.sort(cmpCloudDist)
for(var _=0;_<i;++_){var c=Ft[_]
c.prop.draw(c.pos,c.quat,kt,{nofog:true,color:c.color})}}G.light_dir_ws[2]*=-1
G.setGlobalMatrices(G.mat_view)}}},{"../common/globals":248,"../glov/client/cmds":298,"../glov/client/color_picker":300,"../glov/client/engine":305,"../glov/client/filewatch":314,"../glov/client/font":315,"../glov/client/hsv":324,"../glov/client/input":326,"../glov/client/models":337,"../glov/client/quat":346,"../glov/client/shaders":353,"../glov/client/slider":355,"../glov/client/textures":365,"../glov/client/ui":367,"../glov/client/walltime":370,"../glov/client/webfs":371,"../glov/common/util":400,"../glov/common/vmath":402,"./camera":35,"./main":135,"./photo_mode":158,"./styles":197,"./user_data":208,"./voxel_chunk_manager":214,"./voxel_const":215,"./voxel_data":216,"./voxel_data_drawable":217,"./world_metadata":235,assert:void 0}],189:[function(e,t,r){"use strict"
r.socialMenuInit=socialMenuInit
r.socialMenuInternal=socialMenuInternal
r.doSocialMenu=doSocialMenu
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var h=e("assert")
var P=e("../glov/client/link").link
var B=e("../glov/client/net").netUserId
var _=e("../glov/client/scroll_area").scrollAreaCreate
var a=e("../glov/client/social")
var p=a.friendIsBlocked
var m=a.friendsGet
var k=a.getExternalFriendInfos
var E=a.isFriend
var U=e("../glov/client/ui")
var i=e("../glov/client/ui")
var G=i.buttonText
var F=i.buttonWasFocused
var W=i.uiTextHeight
var H=e("../glov/client/urlhash").getLinkURL
var z=e("../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_INSTANT
var V=e("./analytics").logEvent
var g=e("./fbinstant_worlds").fbCanShare
var c=e("./layout").layoutWide
var Y=e("./localization/localization").L
var o=e("./menu")
var j=o.menuDoTransition
var u=o.menuX1
var d=o.menuY1
var n=e("./party_ui")
var K=n.partyGrantAccess
var T=n.partyMembersNeedingAccess
var f=e("./sharing/platform_share_handlers").shareWorld
var v=e("./social_referral").getReferralNumber
var s=e("./styles")
var l=s.color_line
var q=s.color_user_alternate
var X=s.color_user_over
var Q=s.color_user_viewing
var $=s.label_style
var y=s.menu_header_style
var J=s.sublabel_style
var S=e("./user_info_view")
var ee=S.doOnlineStatusDropdown
var te=S.formatPresence
var re=S.onlineStatusDropdownVisible
var I=S.userInfoGet
var ae=S.userInfoViewing
var ie=S.userProfileButton
var oe=S.userWorldLink
var ne=S.viewUser
var A=e("./user_party")
var se=A.partyFormatDisplayName
var w=A.partyGetParticipants
var le=e("./user_profile_view").userProfileViewOpen
var _e=e("./world_comm").getWorldID
function socialMenuInit(){}var L
function cmpFriend(e,t){var r=Boolean(e.presence_data&&"offline"!==e.presence_data.state)
if(r!==Boolean(t.presence_data&&"offline"!==t.presence_data.state))if(r)return-1
else return 1
var a=(e.display_name||e.user_id).toLowerCase()
var i=(t.display_name||t.user_id).toLowerCase()
if(a===i){a=e.user_id
i=t.user_id}if(a<i)return-1
else return 1}var ce={}
var ue=4
var de=8
var fe=4
function showFriendEntry(e,t,r,a,i,o,n,s){var l
var _=U.font
var c=n-16
var u=a+c
var d=a+c/2
var f=W()
var v=.75*W()
var h=2*ue+f+4+v
var p=a+de
var m=p+4*h/3+8
var E=t[r]
var g=E.user_id,T=E.display_name,y=E.presence_data
var S=null==(l=k(g))?void 0:l[z]
var I=null==S?void 0:S.name
var A=i
var w=Boolean(!_e())
if(!s)oe({user_id:g,presence_data:y,x:p,y:i,z:o,h:h,ctx:""+e+r})
var L=m
var O=Boolean(ie({user_id:g,show_online_status:true,x:L,y:i,z:o,w:h,h:h}))
L+=h+4
var R=F()
var b={x:a,y:i-fe,w:c,h:h+2*fe}
var N=u-d
if(g===B()&&"party"!==e){ee({x:d,y:i,z:o,w:N,font_height:f,entry_height:h})
b.w=d+N/2-b.x}else if("party"===e&&ce[g]){var C=N/2-8
var x=u-4-C
if(G({x:x,y:i,z:o,w:C,font_height:f,h:h,text:Y.BTN_MAKE_BUILDER_LONG}))K(g)
b.w=x-b.x}var M=U.buttonShared(_extends({},b,{pad_focusable:false,rollover_quiet:ae(g)}))
if(M.ret)O=true
if(w&&!re()){b.w-=L-b.x
b.x=L
if(P(_extends({},b,{internal:true,url:H("u/"+g)})))O=true}R=R||M.focused
i+=ue
L+=4
var D=T||I||g
D=se(g,D)
if(I&&I!==D)D=D+" ("+I+")"
_.drawSizedAligned($,L,i,o+1,f,_.ALIGN.HLEFT,c,0,D)
i+=f+4
if(!s)_.drawSizedAligned(J,L+8,i,o+1,v,_.ALIGN.HLEFT,c,0,te(y))
i+=v
i+=ue
if(O){j()
V("social_view_user",1,"button")
if(!w)ne({x:a,y:i,user_id:g})
else le(g)}i+=2*fe
if(1&r||R||ae(g))U.drawRect(a,A-fe,a+c,i-fe,o-.5,ae(g)?Q:R?X:q)
return i-A}function lineSep(e,t,r){var a=t
U.drawLine(e-40,t,e+40,t,r+.1,2,1,l)
return(t+=8)-a}function doFriendList(e,t,r,a,i,o,n,s){var l=U.font,_=U.title_font
var c=a+n/2
var u=i
var d=1.5*W()
_.drawSizedAligned(y,c,i,o,d,l.ALIGN.HCENTER,0,0,Y.$(r,t.length))
i+=d+8
i+=lineSep(c,i,o)
for(var f=0;f<t.length;++f)i+=showFriendEntry(e,t,f,a,i,o,n,s)
return(i+=6)-u}var O=120
var R=48
var b=8
function doFriendsReferralButton(e,t,r,a,i){var o=U.font
var n=t
var s=1.2*W()
var l=v()?Y.SOCIAL_REFERRAL_BASIC:Y.SOCIAL_REFERRAL_FIRST
var _=o.getStringWidth($,s,l)
var c=O+2*b
var u=_+2*b+c
if(u<=a)e+=(a-u)/2
else _=a-c-2*b
if(U.buttonText({x:e+b,y:t+(i-R)/2,z:r,w:O,h:R,text:Y.BTN_SHARE}))f(_e())
e+=c
if(u<=a)o.drawSizedAligned($,e+b,t,r,s,o.ALIGN.HLEFT|o.ALIGN.VCENTER,_,i,l)
else o.drawSizedAlignedWrapped($,e+b,t,r,0,s,o.ALIGN.HLEFT|o.ALIGN.VCENTER,_,i,l)
return(t+=i)-n}var N=108
function socialMenuInternal(e){var t=e.x,r=e.w,a=e.z
var i=e.y
i+=6
if(r>1e3){t+=(r-1e3)/2
r=1e3}var o=[]
var n=[]
for(var s in m())if(E(s))o.push(I(s))
else if(p(s))n.push({user_id:s,display_name:s,presence_data:null})
o.sort(cmpFriend)
if(window.FBInstant&&g())i+=doFriendsReferralButton(t,i,a+1,r,N)
var l=B()
h(l)
i+=doFriendList("self",[I(l)],Y.SOCIAL_MYSELF,t,i,a+1,r)
var _=w()
if(_.length>1){var c=[]
for(var u=0;u<_.length;++u){var d=_[u].user_id
c.push(I(d))}var f=T(false)
ce={}
for(var v=0;v<f.length;++v)ce[f[v].user_id]=true
i+=doFriendList("party",c,Y.SOCIAL_PARTY_NUMBER,t,i,a+1,r)}i+=doFriendList("friend",o,Y.SOCIAL_FRIENDS_NUMBER,t,i,a+1,r)
if(n.length)i+=doFriendList("blocked",n,Y.SOCIAL_BLOCKED_NUMBER,t,i,a+1,r,true)
return i}function doSocialMenu(e){var t=0
var r=u()
var a=d()
var i=e
var o=Z.UI
var n=r-t
var s=a-e
if(c()){t+=(n-1e3)/2
n=1e3}if(!L)L=_({z:Z.UI,background_color:null,auto_hide:true})
var l={x:t,y:i,w:n,h:e+s-i}
L.begin(l)
i=socialMenuInternal({x:0,y:0,z:o,w:n})
L.end(i)}},{"../common/external_users/external_users_provider_ids":247,"../glov/client/link":328,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/social":357,"../glov/client/ui":367,"../glov/client/urlhash":369,"./analytics":6,"./fbinstant_worlds":96,"./layout":120,"./localization/localization":131,"./menu":140,"./party_ui":153,"./sharing/platform_share_handlers":185,"./social_referral":190,"./styles":197,"./user_info_view":210,"./user_party":211,"./user_profile_view":212,"./world_comm":226,assert:void 0}],190:[function(e,t,r){"use strict"
r.getReferralNumber=getReferralNumber
r.checkReferrer=checkReferrer
var a=e("../glov/client/net").netSubs
var i=e("../glov/client/urlhash.js")
i.register({key:"referrer"})
function getReferralNumber(){var e=a().getMyUserChannel()
if(!e)return 0
var t=e.getChannelData("public.referrals",{})
return Object.keys(t).length}function checkReferrer(){var e=a().getMyUserChannel()
if(!e)return
if(e.getChannelData("public.referrer"))return
var t=i.get("referrer")
if(!t)return
e.send("referrer_set",t,function(e){if(e)console.error("Failed to confirm referrer: "+e)})}},{"../glov/client/net":338,"../glov/client/urlhash.js":369}],191:[function(e,t,r){"use strict"
r.SOUNDSCAPE_DATA=void 0
var a={base_path:"soundscape/",default_fade_time:3e3,layers:{bgThirdMaster:{excl_group_master:true,odds:[0,1],period:17142,min_intensity:.01,files:[{file:"bgThird_woods_air_a",excl_group:"F"},{file:"bgThird_woods_air_a",excl_group:"Flyd"},{file:"bgThird_woods_air_f",excl_group:"Dm"},{file:"bgThird_woods_air_f",excl_group:"DpedEm"},{file:"bgThird_woods_air_gb",excl_group:"D"},{file:"bgThird_woods_air_d",excl_group:"Bb"},{file:"bgThird_woods_air_e",excl_group:"DpedC"}],tags:{home:{priority:1,files:[{file:"bass_whaledrum_motif_g_tag-home",excl_group:"G"},{file:"bass_whaledrum_motif_g_tag-home",excl_group:"Gm"},{file:"bass_whaledrum_motif_g_tag-home",excl_group:"Gped"}]},night:{priority:.9,files:[{file:"bgThird_woods_echo_e",excl_group:"DpedC"},{file:"bgThird_woods_echo_f",excl_group:"Dm"},{file:"bgThird_woods_echo_d",excl_group:"Bb"},{file:"bgThird_woods_echo_d3",excl_group:"Bb"},{file:"bgThird_woods_echo_a",excl_group:"F"},{file:"bgThird_woods_echo_Bb",excl_group:"Gm"}]},snow:{priority:.8,files:[{file:"bgThird_piano_d",excl_group:"Bb"},{file:"bgThird_piano_Gb",excl_group:"D"},{file:"bgThird_piano_g",excl_group:"DpedEm"},{file:"bgThird_piano_e",excl_group:"DpedC"},{file:"bgThird_piano_A",excl_group:"F"},{file:"bgThird_piano_B",excl_group:"Flyd"},{file:"bgThird_piano_g",excl_group:"FpedEb"},{file:"bgThird_piano_bb",excl_group:"FpedGm"},{file:"bgThird_piano_B",excl_group:"G"},{file:"bgThird_piano_A",excl_group:"Gped"}]},underground:{priority:1,period:8571,files:[{file:"bg_sync_underground_air_d",excl_group:"D"},{file:"bg_sync_underground_air_d_rr2",excl_group:"D"},{file:"bg_sync_underground_air_d",excl_group:"DpedC"},{file:"bg_sync_underground_air_d_rr2",excl_group:"DpedC"},{file:"bg_sync_underground_air_d",excl_group:"Dm"},{file:"bg_sync_underground_air_d",excl_group:"G"},{file:"bg_sync_underground_air_d",excl_group:"Gm"},{file:"bg_sync_underground_air_d_rr2",excl_group:"Gm"}]},underwater:{priority:1,odds:[0,1],period:24e3,files:[{file:"uw_color_harp_daDbe",excl_group:"D"},{file:"uw_color_harp_daDbe",excl_group:"A"},{file:"uw_color_harp_daDbe",excl_group:"ApedG"},{file:"uw_color_harp_daDbe",excl_group:"G"},{file:"uw_color_harp_daDbe",excl_group:"Bdim"},{file:"uw_color_harp_dace",excl_group:"GpedF"},{file:"uw_color_harp_dace",excl_group:"Dm"},{file:"uw_color_harp_dace",excl_group:"F"},{file:"uw_color_harp_dace",excl_group:"Bbmaj7"},{file:"uw_color_harp_dace",excl_group:"Am"},{file:"uw_color_harp_daDbe-2",excl_group:"D"},{file:"uw_color_harp_daDbe-2",excl_group:"A"},{file:"uw_color_harp_daDbe-2",excl_group:"ApedG"},{file:"uw_color_harp_daDbe-2",excl_group:"G"},{file:"uw_color_harp_daDbe-2",excl_group:"Bdim"},{file:"uw_color_harp_dace-2",excl_group:"GpedF"},{file:"uw_color_harp_dace-2",excl_group:"Dm"},{file:"uw_color_harp_dace-2",excl_group:"F"},{file:"uw_color_harp_dace-2",excl_group:"Bbmaj7"},{file:"uw_color_harp_dace-2",excl_group:"Am"}]}}},glue:{min_intensity:.1,odds:[0,1],files:[],tags:{underwater:{odds:[0,1],period:24e3,min_intensity:.1,priority:1,files:[{file:"uw_glue_pad_Am",excl_group:["Am","Cmaj7"]},{file:"uw_glue_pad_A",excl_group:["A"]},{file:"uw_glue_pad_Bb",excl_group:["Bb","Gm","Bbmaj7"]},{file:"uw_glue_pad_Bdim",excl_group:["Bdim"]},{file:"uw_glue_pad_C",excl_group:["C","CpedBb"]},{file:"uw_glue_pad_D",excl_group:["D","DpedC"]},{file:"uw_glue_pad_Dm",excl_group:["Dm"]},{file:"uw_glue_pad_Em",excl_group:["Em","Cmaj7"]},{file:"uw_glue_pad_F",excl_group:["F","GpedF"]},{file:"uw_glue_pad_G",excl_group:["G","ApedG","Em"]}]}}},colorLowHarps:{odds:[5,3,4],period:6e3,period_noise:2e3,min_intensity:.05,add_delay:3e3,files:[{file:"bgColor_harps_pp_bb4",excl_group:["Bb"]},{file:"bgColor_harps_pp_a4",excl_group:["Dm","D","F"]},{file:"bgColor_harps_pp_f4",excl_group:["Dm","F","Flyd","Bb"]},{file:"bgColor_harps_pp_d4",excl_group:["Dm","D","Flyd","G","Gm"]},{file:"bgColor_harps_pp_bb3",excl_group:["Bb"]},{file:"bgColor_harps_pp_a3",excl_group:["Dm","D","F"]}],tags:{night:{priority:1,odds:[2,1],min_intensity:.05,files:[{file:"color_night_guitar_thirds_GBb",excl_group:["Gm","FpedEb"]},{file:"color_night_guitar_thirds_Gb",excl_group:["G","Em","ApedG"]},{file:"color_night_guitar_thirds_Ebg",excl_group:["Cm","FpedEb"]},{file:"color_night_guitar_thirds_ce",excl_group:["DpedC","Am"]},{file:"color_night_guitar_thirds_FAb",excl_group:["Fm","Db"]},{file:"color_night_guitar_thirds_Fa",excl_group:["Dm","F","Gped"]},{file:"color_night_guitar_thirds_Bbd",excl_group:["Bb","Gm","FpedEb"]},{file:"color_night_guitar_thirds_df",excl_group:["Dm","Bb","Bbmaj7","Fm"]}]},snow:{priority:.9,odds:[0,3,2,1],files:[{file:"bgColor_harps_pp_bb4",excl_group:["Bb","Gm","FpedEb"]},{file:"bgColor_harps_pp_a4",excl_group:["Dm","D","F"]},{file:"bgColor_harps_pp_f4",excl_group:["Dm","F","Flyd","Bb","FpedEb"]},{file:"bgColor_harps_pp_d4",excl_group:["Dm","D","Flyd","G","Gm"]},{file:"bgColor_harps_pp_bb3",excl_group:["Bb","Gm","FpedEb"]},{file:"bgColor_harps_pp_a3",excl_group:["Dm","D","F","Gped"]}]},underwater:{priority:.95,min_intensity:.25,odds:[4,1],period:12e3,files:[{file:"uw_chords_str_tides_A",excl_group:["A","D","ApedG"]},{file:"uw_chords_str_tides_Bdim",excl_group:["Bdim","G"]},{file:"uw_chords_str_tides_Bm7",excl_group:["Bm","G"]},{file:"uw_chords_str_tides_D",excl_group:["D"]},{file:"uw_chords_str_tides_Dm",excl_group:["Dm"]},{file:"uw_chords_str_tides_F",excl_group:["F"]},{file:"uw_chords_str_tides_G",excl_group:["G","GpedF","ApedG","Em"]},{file:"uw_chords_str_tides_Gmaj7",excl_group:["G","GpedF","Em"]}]}}},bg:{max:3,period:1e4,period_noise:5e3,min_intensity:.08,add_delay:2e3,files:[{file:"bg_strings_p_a3",excl_group:["Dm","D","F"]},{file:"bg_strings_p_b3",excl_group:["DpedEm","DpedC1"]},{file:"bg_strings_p_c4",excl_group:["F","DpedC"]},{file:"bg_strings_p_g3",excl_group:["F","DpedC","DpedEm"]},{file:"bg_strings_p_g4",excl_group:["F","DpedC","DpedEm"]},{file:"bg_strings_p_d4",excl_group:["Dm","D"]},{file:"bg_strings_p_aba4",excl_group:"Flyd"},{file:"bg_strings_p_Bb3",excl_group:["Gm","FpedEb"]},{file:"bg_strings_p_Eb4",excl_group:["FpedEb","Fm"]},{file:"bg_horn_swell_aba3",excl_group:"Flyd"},{file:"bg_horn_swell_a3",excl_group:["Dm","F"]},{file:"bg_strings_p_adlib_swells_a3",excl_group:["Dm","D","F","Bb"]}],tags:{snow:{priority:.9,files:[{file:"bg_snow_strings_p_a5",excl_group:["Dm","D","F"]},{file:"bg_snow_strings_p_b5",excl_group:["DpedEm","DpedC"]},{file:"bg_snow_strings_p_c6",excl_group:["F","DpedC"]},{file:"bg_snow_strings_p_g5",excl_group:["F","DpedC","DpedEm"]},{file:"bg_snow_strings_p_g6",excl_group:["F","DpedC","DpedEm"]},{file:"bg_snow_strings_p_d6",excl_group:["Dm","D"]},{file:"bg_snow_strings_p_aba6",excl_group:"Flyd"}]},night:{priority:1,files:[{file:"bg_harps_p_e4",excl_group:"DpedC"},{file:"bg_harps_p_f4",excl_group:["Dm","F","Fm"]},{file:"bg_harps_p_f3",excl_group:["Dm","F","Fm"]},{file:"bg_harps_p_d4",excl_group:["Bb","D","Dm"]},{file:"bg_harps_p_a3",excl_group:["F"]},{file:"bg_harps_p_Bb3",excl_group:["Gm","Bb"]},{file:"bg_harps_p_g4",excl_group:["Gm","G","DpedC"]},{file:"bg_harps_p_g3",excl_group:["Gm","G","DpedC"]},{file:"bg_harps_p_c4",excl_group:["DpedC"]},{file:"bg_harps_p_b3",excl_group:["G","FpedEb"]}]},underground:{priority:1,period:8571,odds:[3,1],files:[{file:"bg_underground_air_c",excl_group:["D"]},{file:"bg_underground_air_b",excl_group:["D","G"]},{file:"bg_underground_air_Gb",excl_group:["D"]}]},underwater:{min_intensity:.4,priority:1,sync_with:"bgThirdMaster",odds:[3,1],files:[{file:"bg_strings_p_a3",excl_group:["Dm","D","F","ApedG","Am","A"]},{file:"bg_strings_p_b3",excl_group:["DpedEm","DpedC1","Bm","Bdim","G","ApedG"]},{file:"bg_strings_p_c4",excl_group:["F","DpedC"]},{file:"bg_strings_p_g3",excl_group:["F","DpedC","DpedEm","ApedG","GpedF"]},{file:"bg_strings_p_aba4",excl_group:"Flyd"},{file:"bg_strings_p_Bb3",excl_group:["Gm","FpedEb"]},{file:"bg_strings_p_Eb4",excl_group:["FpedEb","Fm"]}]}}},bgSync:{sync_with:"bgThirdMaster",odds:[1,2],min_intensity:.15,add_delay:5e3,files:[{file:"bg_harp_celesta_low",excl_group:["Dm","F"]},{file:"bg_harp_celesta_low2",excl_group:["Dm","F"]},{file:"bg_harp_celesta_lowest",excl_group:["Dm","F","Bb"]},{file:"bg_harp_celesta_low_dped",excl_group:["DpedC"]},{file:"bg_felt_celesta_low1",excl_group:["Dm","F"]},{file:"bg_felt_celesta_low2",excl_group:"D"},{file:"bg_felt_celesta_low3",excl_group:["F","Dm","Bb"]},{file:"color_harp_p_Dmaj",excl_group:["D","Bb"]},{file:"color_harp_p_gfd",excl_group:["F","Dm","Bb","G"]}],tags:{home:{priority:1,files:[{file:"bg_sync_phrase_gdcbfa_4-4_tag-home",excl_group:["G","Gped"]}]},snow:{priority:.9,odds:[0,1],files:[{file:"bg_sync_guitar_shimmer_abd",excl_group:["Em","DpedEm","Dm","D","G"]},{file:"bg_sync_guitar_shimmer_cdf",excl_group:["Dm","F","Fm","FpedEb","FpedGm","Gm","Bb"]},{file:"bg_sync_guitar_shimmer_gac",excl_group:["DpedC","F"]}]},night:{priority:.95,files:[]},underground:{priority:.99,files:[]},underwater:{priority:1,odds:[0,1],files:[]}}},bgThirdBrass:{sync_with:"bgThirdMaster",odds:[1,1],period:26e3,period_noise:5e3,min_intensity:.25,files:[{file:"bgThird_trombone_mp_gb3",excl_group:"D"},{file:"bgThird_trombone_mp_a2",excl_group:["Dm","F"]},{file:"bgThird_trombone_mp_a3",excl_group:["Dm","D","F"]},{file:"bgThird_trombone_mp_f3g3",excl_group:["F","Bb"]},{file:"bgThird_trombone_mp_f3",excl_group:["Dm","F","Bb"]},{file:"bgThird_trombone_mp_f-e",excl_group:["Dm","F"]},{file:"bgThird_trombone_mp_f4",excl_group:["Dm","F","Bb"]},{file:"bgThird_trombone_mp_e4",excl_group:["DpedC"]},{file:"bgThird_trombone_mp_e3",excl_group:["DpedEm"]}],tags:{night:{priority:1,files:[]},snow:{priority:1,files:[]},underground:{priority:1,files:[]},underwater:{priority:1,files:[]}}},bassLow:{odds:[0,1],sync_with:"bgSync",min_intensity:.2,max_intensity:.6,files:[{file:"bass_strings_5ths_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_5ths_p_d",excl_group:["D","Dm"]},{file:"bass_str_bassoon_f",excl_group:["F","Flyd"]},{file:"bass_str_bassoon_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_str_bassoon_g",excl_group:["G","Gm"]},{file:"bass_str_bassoon_Bb",excl_group:["Bb","Dm"]},{file:"bass_strings_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_p_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_bb",excl_group:["Dm","F","Bb"]}],tags:{home:{priority:.99,odds:[1,1],files:[]},night:{sync_with:"bgThirdMaster",priority:.8,min_intensity:.25,max_intensity:.5,add_delay:5200,files:[{file:"bass_pizz_soft_bs_cel_Dm",excl_group:["Dm"]},{file:"bass_pizz_soft_bs_cel_D5",excl_group:["Dm","D","DpedC"]},{file:"bass_pizz_soft_bs_cel_F5",excl_group:["Fm","FpedEb","F"]},{file:"bass_pizz_soft_bs_cel_Gm",excl_group:["Gm"]},{file:"bass_pizz_soft_bs_cel_Bb5",excl_group:["Dm","Bb"]},{file:"bass_pizz_soft_bs_cel_GmDesc",excl_group:["Gm","Bb"]}]},snow:{priority:.7,odds:[0,1],files:[{file:"bassLow_snow_piano_str_hp_G",excl_group:["G","Gped","Gm"]},{file:"bassLow_snow_piano_str_hp_F",excl_group:["F","Flyd","FpedEb"]},{file:"bassLow_snow_piano_str_hp_D",excl_group:["D","DpedC","DpedEm"]},{file:"bassLow_snow_piano_str_hp_Bb",excl_group:["Bb"]}]},underground:{priority:.9,sync_with:"bgThirdMaster",odds:[1,1],files:[{file:"bass_ug_whale_ppiano_phrase_g",excl_group:["G","Gm","Gped"]},{file:"bass_ug_whale_ppiano_phrase_f",excl_group:["F","Flyd","FpedEb"]},{file:"bass_ug_whale_ppiano_phrase_d",excl_group:["D","DpedC","DpedEm"]},{file:"bass_ug_whale_ppiano_phrase_Bb",excl_group:["Bb"]}]}}},bassUW:{odds:[0,1],files:[],min_intensity:.4,tags:{underwater:{priority:1,period:11268,odds:[0,1],files:[{file:"uw_bass_a1",excl_group:["Am","A","ApedG","Dm"]},{file:"uw_bass_b1",excl_group:["Bdim","Bm"]},{file:"uw_bass_bb1",excl_group:["Bb","Gm","CpedBb"]},{file:"uw_bass_d1",excl_group:["D","Dm","F","G"]},{file:"uw_bass_d2",excl_group:["D","Dm","F","G"]},{file:"uw_bass_f1",excl_group:["F","GpedF","Am","Dm"]},{file:"uw_bass_g1",excl_group:["G","Gm","ApedG"]}]}}},bass:{odds:[0,1],sync_with:"bgThirdMaster",min_intensity:.6,files:[{file:"bass_strings_5ths_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_5ths_p_d",excl_group:["D","Dm"]},{file:"bass_str_bassoon_f",excl_group:["F","Flyd","Fm"]},{file:"bass_str_bassoon_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_f",excl_group:["F","Flyd"]},{file:"bass_strings_p_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_bb",excl_group:["Dm","F","Bb"]},{file:"bass_strings_p_g",excl_group:["Gm","G"]}],tags:{night:{priority:.9,min_intensity:.5,files:[{file:"bass_strings_p_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_strings_p_f",excl_group:["Fm","FpedEb"]},{file:"bass_strings_p_bb",excl_group:["Dm","Bb"]},{file:"bass_strings_p_g",excl_group:["Gm","G"]}]},underground:{priority:1,files:[{file:"bass_str_bassoon_f",excl_group:["F","Flyd","Fm","FpedEb"]},{file:"bass_str_bassoon_d",excl_group:["D","Dm","DpedC","DpedEm"]},{file:"bass_str_bassoon_g",excl_group:["G","Gm"]},{file:"bass_str_bassoon_Bb",excl_group:["Bb"]}]},underwater:{priority:1,files:[]}}},colorLowWoods:{odds:[3,1],period:45e3,period_noise:5e3,min_intensity:.3,max_intensity:.6,add_delay:3e3,files:[{file:"bgWoods_trills_p_ab",excl_group:"Flyd"},{file:"bgWoods_trills_p_dea",excl_group:["D","Dm","F"]},{file:"bgWoods_trills_p_fgc",excl_group:["Dm","F"]},{file:"bgWoods_trills_p_fd5",excl_group:["Dm","F"]},{file:"bgWoods_trills_p_fd4",excl_group:["Dm","F"]},{file:"bgWoods_trills_p_fa",excl_group:["Dm","F","Bb"]},{file:"bgWoods_trills_p_ac",excl_group:["D","Dm","F","Bb"]}],tags:{night:{priority:1,files:[]},underground:{priority:1,files:[]},underwater:{priority:1,files:[]}}},colorRandom:{odds:[1,1],period:17142,period_noise:8571,min_intensity:.2,files:[],tags:{night:{priority:1,odds:[5,1],min_intensity:.3,max_intensity:.5,files:[]},underground:{priority:1,files:[{file:"color_underground_harp_celeste_G",excl_group:["G","Gm"]},{file:"color_underground_harp_celeste_Gb4",excl_group:["D"]},{file:"color_underground_harp_celeste_f4",excl_group:["Dm","D"]},{file:"color_underground_harp_celeste_e4",excl_group:["G","D","Gm"]},{file:"color_underground_harp_celeste_d4",excl_group:["D","G","Gm"]},{file:"color_underground_harp_celeste_C4",excl_group:["D"]},{file:"color_underground_harp_celeste_b3",excl_group:["D","G"]},{file:"color_underground_harp_celeste_Bb3",excl_group:["Bb","Gm"]},{file:"color_underground_harp_celeste_a3",excl_group:["D","G","Gm"]},{file:"color_underground_harp_celeste_g3",excl_group:["Gm","G"]},{file:"color_underground_harp_celeste_gb3",excl_group:["D"]},{file:"color_underground_harp_celeste_f3",excl_group:["Dm","G"]},{file:"color_underground_harp_celeste_e3",excl_group:["G","D","Gm"]},{file:"color_underground_harp_celeste_d3",excl_group:["D","G","Gm"]}]},underwater:{priority:1,odds:[1,1],max_intensity:.69,files:[{file:"uw_color_piano_ae",excl_group:["D","Dm","F","GpedF","G","A","Bm","Bdim"]},{file:"uw_color_piano_gd",excl_group:["Dm","Em","F","ApedG","G","Bb","C"]}]}}},colorRandomHi:{odds:[1,1],period:17142,min_intensity:.699,files:[],tags:{night:{priority:1,odds:[5,1],min_intensity:.3,max_intensity:.5,files:[]},underground:{priority:1,files:[]},underwater:{priority:1,odds:[1,1],period:12e3,files:[{file:"color_underground_harp_celeste_G",excl_group:["G","Gm","GpedF"]},{file:"color_underground_harp_celeste_Gb4",excl_group:["D","Bm"]},{file:"color_underground_harp_celeste_f4",excl_group:["Dm","F","GpedF"]},{file:"color_underground_harp_celeste_e4",excl_group:["G","D","Gm","Em","C","Am","A"]},{file:"color_underground_harp_celeste_d4",excl_group:["D","G","Gm","Dm","ApedG"]},{file:"color_underground_harp_celeste_C4",excl_group:["C","Bb","Bbmaj7"]},{file:"color_underground_harp_celeste_b3",excl_group:["D","G","Bm","Bdim"]},{file:"color_underground_harp_celeste_Bb3",excl_group:["Bb","Gm","Bbmaj7"]},{file:"color_underground_harp_celeste_a3",excl_group:["D","G","Gm","Bbmaj7"]},{file:"color_underground_harp_celeste_g3",excl_group:["Gm","G","Em","GpedF"]},{file:"color_underground_harp_celeste_gb3",excl_group:["D"]},{file:"color_underground_harp_celeste_f3",excl_group:["Dm","G","F","GpedF"]},{file:"color_underground_harp_celeste_e3",excl_group:["G","D","Gm","Em"]},{file:"color_underground_harp_celeste_d3",excl_group:["D","G","Gm","Bm","Bdim"]}]}}},colorSync:{odds:[3,1],min_intensity:.5,sync_with:"bgThirdMaster",files:[{file:"color_glock_p_Dmaj",excl_group:["D"]},{file:"color_glock_p_cda6",excl_group:["Dm","F","Bb"]},{file:"color_glock_p_cda5",excl_group:["Dm","F","Bb"]}],tags:{night:{priority:.8,odds:[1,1],min_intensity:.1,max_intensity:.25,files:[{file:"fg_night_flute_phrase3",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_flute_phrase2",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_flute_phrase1",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_flute_phrase4",excl_group:["Dm","Bb","Gm","DpedC"]}]},snow:{odds:[0,1],priority:.9,files:[{file:"bg_snow_celeste_Bbmaj",excl_group:["Bb"]},{file:"bg_snow_celeste_D",excl_group:["D"]},{file:"bg_snow_celeste_Dm",excl_group:["Dm","F","Bb"]},{file:"bg_snow_celeste_DpedC",excl_group:["DpedC"]},{file:"bg_snow_celeste_Em",excl_group:["Em","G"]},{file:"bg_snow_celeste_F",excl_group:["Dm","F","Bb"]},{file:"bg_snow_celeste_Flyd",excl_group:["Flyd"]},{file:"bg_snow_celeste_Fm",excl_group:["Fm"]},{file:"bg_snow_celeste_Fped",excl_group:["FpedEb"]},{file:"bg_snow_celeste_G",excl_group:["G"]},{file:"bg_snow_celeste_Gped",excl_group:["Gped"]},{file:"bg_snow_celeste_Gm",excl_group:["Gm","Bb"]}]},underground:{priority:.95,odds:[0,1],files:[{file:"color_sync_third_underground_stutters_e3",excl_group:["DpedC"]},{file:"color_sync_third_underground_stutters_b3",excl_group:["G","Dm","D"]},{file:"color_sync_third_underground_stutters_Bb3",excl_group:["Gm"]},{file:"color_sync_third_underground_stutters_Gb3",excl_group:["D"]},{file:"color_sync_third_underground_stutters_f3",excl_group:["Dm"]}]},underwater:{priority:1,files:[]}}},fgLo:{odds:[4,2],period:3e4,sync_with:"bgThirdMaster",period_noise:1e4,min_intensity:.3,max_intensity:.6,files:[{file:"fg_eh_phrase1_mp_dfa",excl_group:["Dm","Bb","F"]},{file:"fg_eh_phrase1_mp_fac",excl_group:["Dm","F","Bb"]},{file:"fg_eh_phrase1_mp_fad",excl_group:["Dm","F","Flyd","Bb"]},{file:"fg_eh_phrase1_mp_gb-ad",excl_group:["D"]},{file:"fg_eh_phrase1_mp_ace",excl_group:["DpedC","F"]}],tags:{night:{priority:1,odds:[5,1],min_intensity:.5,max_intensity:.7,files:[{file:"fg_night_bassoon_phrase_gaf",excl_group:["Dm","Bb","Gm","DpedC"]},{file:"fg_night_bassoon_phrase_efd",excl_group:["Dm","Gm","DpedC"]},{file:"fg_night_bassoon_phrase_cBbc",excl_group:["Fm","Bb"]},{file:"fg_night_bassoon_phrase_aga",excl_group:["Dm","DpedC","Bb"]},{file:"fg_night_bassoon_phrase_EbdEb",excl_group:["Fm"]},{file:"fg_night_bassoon_phrase_gfg",excl_group:["Gm","Fm"]}]},snow:{priority:1,files:[]},underground:{priority:1,odds:[8,1],files:[{file:"fg_underground_basoon_phrase_bg",excl_group:["G"]},{file:"fg_underground_basoon_phrase_cd",excl_group:["D"]},{file:"fg_underground_basoon_phrase_ae",excl_group:["D"]},{file:"fg_underground_basoon_phrase_da",excl_group:["D"]}]},underwater:{odds:[0,1],priority:1,files:[{file:"uw_phrase_marimba_Dbba",excl_group:["D","A"]},{file:"uw_phrase_marimba_dDba",excl_group:["D","A"]},{file:"uw_phrase_marimba_dca",excl_group:["Dm","G","ApedG","F","GpedF"]}]}}},fgHi:{odds:[2,1],sync_with:"bgThirdMaster",min_intensity:.6,max_intensity:1,files:[{file:"fg_fh_mf_phrase_deca1",excl_group:["Dm","Flyd","F","DpedC"]},{file:"fg_fh_mf_phrase_dacg1",excl_group:["Dm","F","Flyd","DpedC"]},{file:"fg_fh_mf_phrase_dac1",excl_group:["Dm","D","Bb","DpedC"]},{file:"fg_fh_mf_phrase_dacbba1",excl_group:["D"]}],tags:{night:{min_intensity:.7,priority:.8,files:[{file:"fg_horn_night_ac_down",excl_group:["Dm","Gm","DpedC","F"]},{file:"fg_horn_night_ad_up",excl_group:["Dm","DpedC","Bb","F","G"]},{file:"fg_horn_night_ad_down",excl_group:["Dm","DpedC","Bb","F","G"]},{file:"fg_horn_night_ae_down",excl_group:["G","F","Dm","DpedC"]},{file:"fg_horn_night_ae_up",excl_group:["G","F","Dm","DpedC"]},{file:"fg_horn_night_dg_down",excl_group:["Gm","G","F","Bb","DpedC"]},{file:"fg_horn_night_gd_up",excl_group:["Gm","G","F","Bb","DpedC"]}]},snow:{priority:.9,files:[{file:"fg_snow_flute_phrase_cgd",excl_group:["Bb","Flyd","F","DpedC"]},{file:"fg_snow_flute_phrase_beGb",excl_group:["D","DpedC"]}]},underground:{priority:1,odds:[8,1],files:[{file:"fg_underground_basoon_phrase_bg",excl_group:["G"]},{file:"fg_underground_basoon_phrase_cd",excl_group:["D"]},{file:"fg_underground_basoon_phrase_ae",excl_group:["D"]},{file:"fg_underground_basoon_phrase_da",excl_group:["D"]}]},underwater:{priority:1,odds:[1,1],min_intensity:.6,files:[{file:"uw_choir_a-b-c-d",excl_group:["Am","F","GpedF"]},{file:"uw_choir_a-b-db-d",excl_group:["Bdim","D","Dm"]},{file:"uw_choir_b-g-d-gb-e",excl_group:["G"]},{file:"uw_choir_c-e-f-g",excl_group:["F","GpedF","Bbmaj7"]},{file:"uw_choir_db-e-gb-ab",excl_group:["A"]}]}}}}}
r.SOUNDSCAPE_DATA=a},{}],192:[function(e,t,r){"use strict"
r.StateMachine=r.State=void 0
var i=e("assert")
var a=function State(e){this.sm=void 0
this.id=void 0
this.allowed_transitions=void 0
this.sm=e}
r.State=a
var o=function(){function StateMachine(e,t,r){this.owner=void 0
this.state_map={}
this.observers=[]
this.states=[]
this.handling_cbs=[]
this.handling_cb_params=[]
this.owner=e
for(var a=0;a<t.length;a++)this.addState(new t[a](this))
i(this.state_map[r])
this.states.push(r)}var e=StateMachine.prototype
e.getOwner=function getOwner(){return this.owner}
e.addState=function addState(e){i(!this.state_map[e.id])
this.state_map[e.id]=e}
e.addObserver=function addObserver(e){i(e.reactTransit)
this.observers.push(e)}
e.validateTransition=function validateTransition(e,t){if(t===e)return void console.error("State machine attempting to transit to self: "+t)
i(this.state_map[t])
i(t in this.state_map[e].allowed_transitions)}
e.transit=function transit(e,t){this.validateTransition(this.states[0],t)
for(var r=0;r<this.observers.length;r++)this.observers[r].reactTransit(this,t)
this.state_map[this.states[0]].exit(e,t)
this.states[0]=t
this.state_map[this.states[0]].enter(e)}
e.push=function push(e,t){this.validateTransition(this.states[0],t)
this.state_map[this.states[0]].exit(e,t)
this.states.unshift(t)
this.state_map[this.states[0]].enter(e)}
e.pop=function pop(e,t){this.validateTransition(this.states[0],t)
this.state_map[this.states[0]].exit(e,t)
this.states.shift()
this.state_map[this.states[0]].enter(e)}
e.addHandlingCB=function addHandlingCB(e,t){this.handling_cbs.push(e)
this.handling_cb_params.push(t)}
e.tick=function tick(e){if(this.handling_cbs.length>0){for(var t=0;t<this.handling_cbs.length;++t)this.handling_cbs[t](this.owner,e,this.handling_cb_params[t])
this.handling_cbs=[]
this.handling_cb_params=[]}this.state_map[this.states[0]].handle(e)
return this.state_map[this.states[0]].update(e)}
e.getState=function getState(){return this.states[0]}
return StateMachine}()
r.StateMachine=o},{assert:void 0}],193:[function(e,t,r){"use strict"
r.statusGet=statusGet
r.clear=clear
r.statusPush=statusPush
r.push=r.get=r.tickStatus=r.STATUS_FONT_SIZE=void 0
var y=30
r.STATUS_FONT_SIZE=y
var S=e("../glov/client/camera2d")
var I=e("../glov/client/engine")
var A=e("../glov/client/font").ALIGN
var a=e("../glov/client/localization").getStringFromLocalizable
var i=e("../glov/client/markdown")
var w=i.markdownDims
var L=i.markdownDraw
var O=i.markdownPrep
var R=e("../glov/client/ui")
var o=e("../glov/common/util")
var b=o.easeIn
var N=o.easeOut
var C=e("../glov/common/vmath").vec4
var x=e("./styles").status_style
var M=Math.max,D=Math.min
var n=3e3
var P=500
var B=500
var k=8
var U={}
var s=0
var l=function(){function StatusImpl(e){this.key=void 0
this.idx=void 0
this.msg="undefined"
this.counter=0
this.fade_rate=1
this.bounce_counter=0
this.done=false
this.lifespan=n
this.pos=void 0
this.md_cache_dims=void 0
this.last_cache_w=void 0
this.md_cache_draw=void 0
this.last_cache_scale=void 0
this.key=e
this.idx=++s}var e=StatusImpl.prototype
e.setMessage=function setMessage(e,t){if(void 0===t)t=n
this.msg=a(e)
this.last_cache_w=-1
this.counter=0
this.lifespan=t
return this}
e.fade=function fade(e){if(e)this.fade_rate=e
this.counter=this.lifespan-P-I.frame_dt*this.fade_rate
this.bounce_counter=B
return this}
e.noBounce=function noBounce(){this.bounce_counter=B
return this}
e.setPos=function setPos(e,t){this.pos=[(e-S.x0())/S.w(),(t-S.y0())/S.h()]
return this}
e.remove=function remove(){if(!this.done){this.done=true
delete U[this.key]}return null}
StatusImpl.tickStatus=function tickStatus(e){var t=Object.keys(U)
for(var r=0;r<t.length;++r){var a=U[t[r]]
var i=I.frame_dt*a.fade_rate
a.counter+=i
a.bounce_counter+=i}t.sort(function(e,t){return U[e].idx-U[t].idx})
var o=.8*S.w()
var n=.5*S.w()
var s=S.h()*(e||.67)
var l=Z.STATUS
for(var _=t.length-1;_>=0;--_){var c=U[t[_]]
if(c.counter>=c.lifespan){c.done=true
delete U[t[_]]
continue}var u=1
var d=c.lifespan-P
if(c.counter>d)u=1-b((c.counter-d)/P,2)
var f=n
var v=y
if(!c.md_cache_dims){c.md_cache_dims={cache:{},font_style:x,text:c.msg,text_height:y,align:A.HWRAP,w:o}
c.last_cache_w=o
O(c.md_cache_dims)
c.last_cache_scale=-1}else if(o!==c.last_cache_w){c.md_cache_dims.cache={}
c.md_cache_dims.text=c.msg
c.last_cache_w=c.md_cache_dims.w=o
O(c.md_cache_dims)
c.last_cache_scale=-1}var h=w(c.md_cache_dims)
var p=h.w
var m=o
var E=void 0
var g=1
var T=h.h
if(c.pos){f=c.pos[0]*S.w()+S.x0()
E=c.pos[1]*S.h()+S.y0()
f=D(M(f,S.x0()+p/2+k),S.x1()-p/2-k)}else{E=s-=T
if(c.bounce_counter<B){v*=g=2-N(c.bounce_counter/B,2)
if(_===t.length-1)T*=g
p*=g
m*=g}}if(!c.md_cache_draw){c.md_cache_draw={cache:{},font_style:x,text:c.msg,text_height:v,align:A.HCENTER|A.HWRAP,w:m,x:0,y:0,z:0}
O(c.md_cache_draw)
c.last_cache_scale=g}else if(g!==c.last_cache_scale){c.md_cache_draw.cache={}
c.md_cache_draw.text_height=v
c.md_cache_draw.w=m
c.md_cache_draw.text=c.msg
O(c.md_cache_draw)
c.last_cache_scale=g}c.md_cache_draw.x=f-.5*m
c.md_cache_draw.y=E
c.md_cache_draw.z=l+1
c.md_cache_draw.alpha=u
L(c.md_cache_draw)
R.drawRect(f-p/2-k,E,f+p/2+k,E+T,l,C(0,0,0,.5*u))}}
return StatusImpl}()
var _=l.tickStatus
r.tickStatus=_
function statusGet(e){var t=U[e]
if(!t)t=U[e]=new l(e)
return t}var c=statusGet
r.get=c
function clear(){U={}}var u=0
function statusPush(e){return statusGet(String(++u)).setMessage(e)}var d=statusPush
r.push=d},{"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/localization":330,"../glov/client/markdown":332,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./styles":197}],194:[function(e,t,r){"use strict"
r.STONE_TIER_DISTRO=r.ORE_DROPRATE=r.ORE_DISTRO=r.ORE_FREQ=r.STONE_TIER_NAMES=r.STONE_TIER_SCALAR=r.STONE_TIER_DEPTH=void 0
var a=e("assert")
var i=e("../common/materials_common").Mat
var n={0:{depth_delta:50,scalar:1},1:{depth_delta:40,scalar:1.5},2:{depth_delta:70,scalar:2},3:{depth_delta:70,scalar:2.5},4:{depth_delta:40,scalar:3},5:{depth_delta:70,scalar:3.5},6:{depth_delta:70,scalar:4},7:{depth_delta:70,scalar:4.5},8:{depth_delta:70,scalar:5},9:{depth_delta:Infinity,scalar:1}}
var s=[]
r.STONE_TIER_DEPTH=s
var l=[]
r.STONE_TIER_SCALAR=l
var o=[]
r.STONE_TIER_NAMES=o;(function(){var e=0
for(var t in n){var r=Number(t)
var a=n[r],i=a.depth_delta,o=a.scalar
e+=i
s[r]=e
l[r]=o}})()
var _=1/6
r.ORE_FREQ=_
var c=[null,i.COPPER,i.TIN,i.IRON,i.SILVER,i.EMBERYLLIUM,i.GOLD,i.COBALT,i.MYTHRIL,i.AETHERSTONE]
r.ORE_DISTRO=c
var u=[0,1,1,1,1,1,1,1,1,1]
r.ORE_DROPRATE=u
a.equal(c.length,u.length)
var d=[[-Infinity,[1,3,1,1,1,3,1,1,3]],[s[0],[2,2,2,2,2,2,2,2,2]],[s[1],[1,3,2,3,2,3,1,3,3]],[s[2],[1,5,2,5,4,5,5,4,5]],[s[3],[1,6,3,6,6,5,6,4,6]],[s[4],[7,7,3,6,7,5,7,4,7]],[s[5],[8,2,8,6,7,8,8,4,8]],[s[6],[1,9,3,9,9,8,9,9,8]],[s[7],[1,2,3,6,7,5,9,4,8]],[Infinity,null]]
r.STONE_TIER_DISTRO=d},{"../common/materials_common":253,assert:void 0}],195:[function(e,t,r){"use strict"
r.getOwnedAmount=getOwnedAmount
r.getProductIdGemCost=getProductIdGemCost
r.getProductIdOrbCost=getProductIdOrbCost
r.canPurchaseProduct=canPurchaseProduct
r.canPurchaseProductId=canPurchaseProductId
r.gameCurrencyPurchase=gameCurrencyPurchase
r.getProduct=r.getAllProducts=void 0
var a=e("../common/store_data")
r.getAllProducts=a.getAllProducts
r.getProduct=a.getProduct
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var E=e("assert")
var i=e("../glov/client/net")
var g=i.netDisconnected
var T=i.netSubs
var y=e("../glov/client/ui")
var o=e("../glov/client/walltime")
var S=e("../glov/common/util").nop
var n=e("../common/store_data")
var s=n.getProduct
r.getProduct=s
var l=n.validatePurchaseRules
var _=e("./analytics")
var I=_.getMenuContext
var A=_.itemFlowEvent
var w=_.logEvent
var L=e("./currency_shop").openCurrencyShop
var O=e("./in_app_purchases/iap_client_worlds").iapEnabled
var R=e("./localization/localization").L
var c=e("./menu")
var b=c.CURRENCY_SHOP
var N=c.getMenuPage
var u=e("./ui_util")
var C=u.GEM_SYMBOL
var x=u.ORB_SYMBOL
var d=e("./world_comm")
var M=d.getGemBalance
var D=d.getOrbBalance
var f=d.getPerm
var P=e("./worlds_sound").playSound
function getOwnedAmount(e){return Number((f("owned")||{})[e]||0)}function getProductIdGemCost(e){var t=s(e)
return t&&t.cost_gems}function getProductIdOrbCost(e){var t=s(e)
if(t&&t.cost_orbs){if(Array.isArray(t.cost_orbs)){var r=getOwnedAmount(t.items[0].id)
if(r>=t.cost_orbs.length)return t.cost_orbs[t.cost_orbs.length-1]
return t.cost_orbs[r]}return t.cost_orbs}}function canPurchaseProduct(e){return l(e,1,o(),getOwnedAmount)}function canPurchaseProductId(e){var t=s(e)
return t?canPurchaseProduct(t):false}function gameCurrencyPurchase(t,r,a,e,i,o,n){var s=o||S
var l
var _
var c
if("gem"===t){var u=M()
var d=getProductIdGemCost(r)
E(d)
l={current_amount:u,cost:d*=a,cost_symbol:C,success_amount:u-d}
_={currency_current_amount_msg:R.addColon(R.DLG_NEED_MORE_GEMS_CURRENT_AMOUNT_MSG)+" "+u+" "+C,need_more_currency_title:R.DLG_NEED_MORE_GEMS_TITLE,need_more_currency_msg:R.DLG_NEED_MORE_GEMS_MSG.$({description:e}),get_more_currency_msg:O()?R.DLG_BUY_MORE_GEMS_MSG:R.DLG_BUY_MORE_GEMS_WEB_MSG}
c={fail_event:"purchase_gems_fail",success_event:"purchase_gems",cancel_event:"purchase_gems_cancel",event_extra_info:_extends({gems:u},n),event_extra_info_success:_extends({gems:u-d,menu_context:I()},n)}}else{var f=D()
var v=getProductIdOrbCost(r)
E(v)
l={current_amount:f,cost:v*=a,cost_symbol:x,success_amount:f-v}
_={currency_current_amount_msg:R.addColon(R.DLG_NEED_MORE_ORBS_CURRENT_AMOUNT_MSG)+" "+f+" "+x,need_more_currency_title:R.DLG_NEED_MORE_ORBS_TITLE,need_more_currency_msg:R.DLG_NEED_MORE_ORBS_MSG.$({description:e}),get_more_currency_msg:O()?R.DLG_BUY_MORE_ORBS_MSG:R.DLG_BUY_MORE_ORBS_WEB_MSG}
c={fail_event:"purchase_orbs_fail",success_event:"purchase_orbs",cancel_event:"purchase_orbs_cancel",event_extra_info:_extends({orbs:f},n),event_extra_info_success:_extends({orbs:f-v,menu_context:I()},n)}}E(l.cost)
var h=T().getMyUserChannel()
if(!h){y.modalDialog({title:R.DLG_ERROR_TITLE,text:R.DLG_CANNOT_PURCHASE_MSG})
return void s("ERR_DISCONNECTED")}var p=i
if(l.cost>l.current_amount){var m=O()&&N()!==b?{go_to_shop:{label:R.BTN_GO_TO_SHOP,cb:function cb(){L("insufficient_funds_"+t)}}}:{}
w(c.fail_event,l.cost,p,r,c.event_extra_info)
y.modalDialog({title:_.need_more_currency_title,text:_.need_more_currency_msg+"\n\n  "+_.currency_current_amount_msg+"\n  "+R.addColon(R.DLG_NEED_MORE_CURRENCY_COST_MSG)+" "+l.cost+" "+l.cost_symbol+"\n\n"+_.get_more_currency_msg,buttons:_extends({OK:null},m),button_width:150})
return void s("ERR_INSUFFICIENT_FUNDS")}y.modalDialog({title:R.DLG_PURCHASE_CONFIRMATION_TITLE,text:R.DLG_PURCHASE_CONFIRMATION_MSG.$({description:e})+"\n\n  "+_.currency_current_amount_msg+"\n  "+R.addColon(R.DLG_NEED_MORE_CURRENCY_COST_MSG)+" "+l.cost+" "+l.cost_symbol,buttons:{Yes:function Yes(){if(g()){y.modalDialog({title:R.DLG_ERROR_TITLE,text:R.DLG_PURCHASE_FAILED_CUSTOM_MSG.$({error:R.ERR_DISCONNECTED}),buttons:{ok:null}})
return void s("ERR_DISCONNECTED")}y.modalDialog({title:R.DLG_PROCESSING_PURCHASE_TITLE,text:R.MSG_PLEASE_WAIT})
var e=h.pak("gem"===t?"purchase_gems":"purchase_orbs")
e.writeAnsiString(r)
e.writeInt(a)
e.send(function(e){y.modalDialogClear()
if(e)y.modalDialog({title:R.DLG_ERROR_TITLE,text:R.DLG_PURCHASE_FAILED_CUSTOM_MSG.$({error:JSON.stringify(e)}),buttons:{ok:null}})
else{P("purchase")
w(c.success_event,l.cost,p,r,c.event_extra_info_success)
A(t,"sink",l.cost,true,r,l.current_amount)
y.modalDialog({title:R.DLG_PURCHASE_SUCCESSFUL_TITLE,text:R.DLG_PURCHASE_SUCCESSFUL_MSG,buttons:{ok:null}})}s(e)})},No:function No(){w(c.cancel_event,l.cost,void 0,r,c.event_extra_info)
s("ERR_USER_CANCELED")}}})}},{"../common/store_data":262,"../glov/client/net":338,"../glov/client/ui":367,"../glov/client/walltime":370,"../glov/common/util":400,"./analytics":6,"./currency_shop":72,"./in_app_purchases/iap_client_worlds":111,"./localization/localization":131,"./menu":140,"./ui_util":205,"./world_comm":226,"./worlds_sound":236,assert:void 0}],196:[function(e,t,r){"use strict"
r.unstuckBlocked=unstuckBlocked
r.unstuck=unstuck
var a=e("./localization/localization").L
var i=e("./client_cmds.js").isElevated
var o=e("./editvolume_client.js").hasVolumeAdminAccessForPos
var s=e("./energy_well.js").possiblyApplyWaygateSickness
var l=e("../common/globals.js").CHUNK_SIZE
var _=e("./main.js")
var c=_.charControllerPos
var u=Math.cos,d=Math.max,f=Math.random,v=Math.round,h=Math.sin,p=Math.PI
var n=e("./proc_gen_biomes.js"),m=n.getElevationEstimate,E=n.getVerticalSliceWorldPos
var g=e("./settlement.js"),T=g.settlementCurrent,y=g.settlementLastBound
var S=e("./user_data.js"),I=S.userLastWaygateTime,A=S.worldReadOnly
var w=e("../glov/common/vmath.js").vec3
var L=e("./voxel_data.js").worldPosFromLocalPos
var O=e("../glov/client/walltime.js")
var R=e("./world_metadata.js"),b=R.adventureMode,N=R.worldMetadataFreePos
var C=0
function unstuckBlocked(){if(!N()&&!b())if(!_.chat_ui.getAccessObj().access.world_admin&&!o(c()))return a.$(a.CHATERROR_STUCK_NOT_ADMIN,"/stuck","/world_free_pos=0")
if(A())return"ERR_ACCESS_DENIED"
if(!b())return null
var e=O.seconds()
if(e-C<60)if(!i())return a.$(a.CHATERROR_STUCK_LESS_MINUTE,"/stuck")
if(e-I()<150)return null
if(T()&&T()===y())return null
return a.CHATERROR_STUCK_TRY_WAYGATE}function unstuck(){s()
C=O.seconds()
var e=f()*p*2
var t=(20+10*f())*l
for(var r=100;r>=0;--r){var a=u(e)
var i=h(e)
var o=L(w(),c())
o[0]+=i*t
o[1]+=a*t
var n=E(o)
if(n.mid_elevation>=n.owner_hexome.water_level||!r){o[2]=d(n.owner_hexome.water_level+2,m(o)+7*l)
_.char_controller.updatePosFromString(o[0]+","+o[1]+","+o[2]+","+v(180*e/p+180)+",0",false)
_.char_controller.setFallDamageShield(10)
return}e+=1
t+=1}}},{"../common/globals.js":248,"../glov/client/walltime.js":370,"../glov/common/vmath.js":402,"./client_cmds.js":43,"./editvolume_client.js":84,"./energy_well.js":85,"./localization/localization":131,"./main.js":135,"./proc_gen_biomes.js":163,"./settlement.js":181,"./user_data.js":208,"./voxel_data.js":216,"./world_metadata.js":235}],197:[function(e,t,r){"use strict"
r.colorAlpha=colorAlpha
r.getStyleForClient=getStyleForClient
r.getStyleForRole=getStyleForRole
r.color_white_50=r.color_white=r.color_black_20=r.color_black_30=r.color_black_50=r.color_black_75=r.color_black=r.color_transparent=r.colors_user_selected=r.color_remove_user_viewing=r.color_remove_user_alternate=r.color_remove_user_over=r.color_remove_user=r.color_user_self_score=r.color_user_viewing=r.color_user_alternate=r.color_user_over=r.color_line=r.unlock_prompt_style=r.auth_migration_error=r.stamina_style=r.status_style=r.style_progress_label=r.style_mode_label_disabled=r.style_mode_label=r.style_photo_label_touch=r.style_photo_label=r.style_boostwidget_text=r.style_boost_buy_text=r.color_boost_bright=r.color_boost_base=r.color_boost_panel_other=r.color_boost_panel_current=r.color_boost=r.style_booster=r.style_wallet_orbs_expired=r.style_wallet_orbs=r.style_wallet_gems_symbol=r.style_wallet_gems_expired=r.style_wallet_gems_free_focused=r.style_wallet_gems_free=r.style_wallet_gems=r.style_wallet_boost_tokens=r.style_orbs=r.style_gems=r.floater_style_disabled=r.floater_style_red=r.chat_style_banned=r.floater_style_banned_no_outline=r.floater_style_banned=r.chat_style_link_hover=r.chat_style_link=r.chat_style_system=r.chat_style_error=r.chat_style_spectator=r.floater_style_spectator_no_outline=r.floater_style_spectator=r.chat_style_world_admin=r.floater_style_world_admin_no_outline=r.floater_style_world_admin=r.chat_style_world_owner=r.floater_style_world_owner_no_outline=r.floater_style_world_owner=r.chat_style_sysadmin=r.floater_style_sysadmin_no_outline=r.floater_style_sysadmin=r.chat_style_default=r.floater_style_default_no_outline=r.floater_style_shadow_focused=r.floater_style_shadow=r.floater_style=r.floater_style_default=r.refreshing_style=r.inventory_style_warn=r.inventory_style=r.party_info_style=r.connection_lost_style=r.white_label_style_shadow=r.white_label_style=r.menu_header_alert_style=r.menu_header_style=r.color_title_underlay=r.overlay_title_style_full=r.overlay_title_style=r.subtitle_style=r.title_style=r.rollover_style=r.helper_text_style=r.menu_style_on_dark=r.menu_style=r.style_ready=r.label_warning_style=r.loading_style=r.label_disabled_style=r.sublabel_style=r.hint_style=r.label_style=r.STYLE_CHAT=r.STYLE_WITHOUT_OUTLINE=r.STYLE_WITH_OUTLINE=void 0
r.style_boost_view_highlight=r.prop_chat_styles=r.first_offer_price_expired_style=r.shop_cost_currency_style=r.styles_per_role=r.colors_gems_free_bonus=r.colors_gems_free_wallet=r.colors_orbs_wallet=r.colors_gems_wallet=r.colors_orbs_buy=r.color_cosmetic_bright_legendary=r.color_cosmetic_bright_epic=r.color_cosmetic_bright_rare=r.color_cosmetic_bright_common=r.color_cosmetic_base_legendary=r.color_cosmetic_base_epic=r.color_cosmetic_base_rare=r.color_cosmetic_base_common=r.customization_legendary=r.customization_epic=r.customization_rare=r.customization_common=r.flavour_text_style=r.sign_font_style=r.color_rarity=r.style_rarity=r.style_log_waygates=r.style_log_commands=r.style_trophies=r.color_trophies=r.color_o2_bar=r.color_stamina_bar=r.style_hp_label_high=r.color_hp_high=r.style_hp_label_med=r.color_hp_med=r.style_hp_label_low=r.color_hp_low=r.style_hp_label_none=r.color_hp_none=r.touch_jump_button_colors=r.color_touch_sprint_inactive=r.color_touch_sprint_active=r.color_touch_dpad_cursor=r.color_touch_dpad_border=r.colors_disabled=r.colors_red=r.colors_light_gold=r.colors_gems=r.color_gems=r.colors_green=r.color_rollover_cover=r.color_photo_frame_listed=r.color_photo_frame_extra=r.color_photo_frame_error=r.color_photo_frame_shadow=r.color_unliked_rollover=r.color_liked_rollover=r.color_liked=r.color_yellow=r.color_red=r.color_green=r.color_locked_fade=r.color_gray_50=r.color_gray80=r.color_white_25=r.color_white_30=void 0
var a=e("../glov/client/font")
var i=a.fontStyle
var o=a.styleAlpha
var n=a.styleColored
var s=e("../glov/client/markdown_renderables").markdownSetColorStyle
var l=e("../glov/client/ui")
var _=l.colorSetMakeCustom
var c=l.makeColorSet
var u=e("../glov/common/vmath")
var d=u.v4fromRGBA
var f=u.rovec4
var v=e("../common/roles_common").classifyRole
var h=0
r.STYLE_WITH_OUTLINE=h
var p=1
r.STYLE_WITHOUT_OUTLINE=p
var m=2
r.STYLE_CHAT=m
var E=n(null,255)
r.label_style=E
var g=n(null,8388863)
r.hint_style=g
var T=n(null,128)
r.sublabel_style=T
var y=n(null,128)
r.label_disabled_style=y
var S=n(null,128)
r.loading_style=S
var I=n(null,2147483903)
r.label_warning_style=I
var A=n(null,1090470143)
r.style_ready=A
var w=i(null,{color:255})
r.menu_style=w
var L=i(null,{color:4210752255})
r.menu_style_on_dark=L
var O=i(null,{color:2425393407})
r.helper_text_style=O
var R=i(E,{outline_width:1,outline_color:4294967295})
r.rollover_style=R
var b=i(null,{color:4294967295,outline_width:2.5,outline_color:255,glow_xoffs:3,glow_yoffs:3,glow_inner:.5,glow_outer:2.5,glow_color:33023})
r.title_style=b
var N=i(null,{color:4294967248,outline_width:2.5,outline_color:128,glow_xoffs:3,glow_yoffs:3,glow_inner:.5,glow_outer:2.5,glow_color:255})
r.subtitle_style=N
var C=i(null,{color:4294967295,glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5,glow_color:128})
r.overlay_title_style=C
var x=i(C,{color:2155905279})
r.overlay_title_style_full=x
var M=f(0,0,0,.5)
r.color_title_underlay=M
var D=i(null,{color:8447,glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5,glow_color:128})
r.menu_header_style=D
var P=i(D,{glow_color:4286578943})
r.menu_header_alert_style=P
var B=i(null,{color:4294967295})
r.white_label_style=B
var k=i(B,{glow_xoffs:0,glow_yoffs:3,glow_inner:-1.5,glow_outer:2.5,glow_color:77})
r.white_label_style_shadow=k
var U=i(null,{outline_width:2,outline_color:255,color:3709870335})
r.connection_lost_style=U
var G=i(null,{outline_width:2,outline_color:255,color:4294967295})
r.party_info_style=G
var F=i(null,{color:255})
var W=n(r.inventory_style=F,2147483903)
r.inventory_style_warn=W
var H=i(null,{color:4294967295,outline_width:2,outline_color:255})
r.refreshing_style=H
var z=i(null,{color:4294967295,outline_width:1,outline_color:160})
var V=r.floater_style_default=z
r.floater_style=V
var Y=i(z,{outline_color:255,glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5,glow_color:255})
r.floater_style_shadow=Y
var j=i(Y,{glow_color:4294934783})
r.floater_style_shadow_focused=j
var K=i(z,{outline_width:0,color:255})
r.floater_style_default_no_outline=K
var q=i(null,{color:4008636159,outline_width:1,outline_color:255})
r.chat_style_default=q
var Z=i(null,{color:4278190335,outline_width:1,outline_color:160})
r.floater_style_sysadmin=Z
var X=i(Z,{outline_width:0})
r.floater_style_sysadmin_no_outline=X
var Q=i(null,{color:4280549631,outline_width:1.2,outline_color:1241777407})
r.chat_style_sysadmin=Q
var $=i(null,{color:4286779391,outline_width:1,outline_color:160})
var J=i($,{outline_width:0})
var ee=i(null,{color:4286779391,outline_width:1.3,outline_color:1328023039})
var te=i(null,{color:2606348031,outline_width:1,outline_color:160})
r.floater_style_world_owner=te
var re=i(te,{outline_width:0})
r.floater_style_world_owner_no_outline=re
var ae=i(null,{color:3429302271,outline_width:1.3,outline_color:806958335})
r.chat_style_world_owner=ae
var ie=i(null,{color:459708671,outline_width:1,outline_color:160})
r.floater_style_world_admin=ie
var oe=i(ie,{outline_width:0})
r.floater_style_world_admin_no_outline=oe
var ne=i(null,{color:1687547391,outline_width:1.3,outline_color:35839})
r.chat_style_world_admin=ne
var se=i(null,{color:2863311615,outline_width:1,outline_color:160})
r.floater_style_spectator=se
var le=i(se,{outline_width:0,color:1195853823})
r.floater_style_spectator_no_outline=le
var _e=i(null,{color:2998842879,outline_width:1.2,outline_color:255})
r.chat_style_spectator=_e
var ce=i(null,{color:3707764991,outline_width:1,outline_color:255})
r.chat_style_error=ce
var ue=i(null,{color:2863311615,outline_width:1,outline_color:255})
r.chat_style_system=ue
var de=i(null,{color:1346437119,outline_width:1,outline_color:255})
r.chat_style_link=de
var fe=i(null,{color:65535,outline_width:1,outline_color:255})
r.chat_style_link_hover=fe
var ve=i(null,{color:2155905279,outline_width:1,outline_color:160})
r.floater_style_banned=ve
var he=i(ve,{outline_width:0,color:1431655935})
r.floater_style_banned_no_outline=he
var pe=i(ve,{color:2998842879,outline_width:1.2,outline_color:255})
r.chat_style_banned=pe
var me=i(null,{color:4278190335,outline_width:1,outline_color:160})
r.floater_style_red=me
var Ee=i(null,{color:2863311615,outline_width:1,outline_color:160})
r.floater_style_disabled=Ee
var ge=i(null,{color:1910702079,outline_width:1.5,outline_color:255})
r.style_gems=ge
var Te=i(null,{color:4294967295,outline_width:1.5,outline_color:2450313727})
r.style_orbs=Te
var ye=i(null,{color:0xffffff80ff,outline_width:1.4,outline_color:572662527})
r.style_wallet_boost_tokens=ye
var Se=i(null,{color:4294967295,outline_width:1.4,outline_color:208916991})
r.style_wallet_gems=Se
var Ie=i(null,{color:4294967295,outline_width:1.4,outline_color:812259071})
r.style_wallet_gems_free=Ie
var Ae=i(null,{color:4294967295,outline_width:1.4,outline_color:1083187455})
r.style_wallet_gems_free_focused=Ae
var we=i(Se,{color:4294967167,outline_color:208916863})
r.style_wallet_gems_expired=we
var Le=i(Se,{glow_outer:6,glow_color:4294967295})
r.style_wallet_gems_symbol=Le
var Oe=i(null,{color:4294967295,outline_width:1,outline_color:2450313727})
r.style_wallet_orbs=Oe
var Re=i(Oe,{color:4294967167,outline_color:2450313599})
r.style_wallet_orbs_expired=Re
var be=i(E,{glow_color:4294902015,glow_inner:-1,glow_outer:3})
r.style_booster=be
var Ne=f(1,1,0,1)
r.color_boost=Ne
var Ce=f(1,1,.6,1)
r.color_boost_panel_current=Ce
var xe=f(1,1,.9,1)
r.color_boost_panel_other=xe
var Me=f(.91,.65,.05,1)
r.color_boost_base=Me
var De=f(.95,.92,.11,1)
r.color_boost_bright=De
var Pe=i(null,{color:4294967295,outline_width:1.4,outline_color:208916991})
r.style_boost_buy_text=Pe
var Be=i(E,{glow_color:4294958591,glow_inner:-1,glow_outer:2.5})
r.style_boostwidget_text=Be
var ke=i(null,{color:4294967295,outline_width:1,outline_color:255})
r.style_photo_label=ke
var Ue=i(null,{color:4294967176,outline_width:1,outline_color:187})
r.style_photo_label_touch=Ue
var Ge=i(null,{outline_width:2,outline_color:128,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:0,glow_color:0,color:4294967295})
var Fe=o(r.style_mode_label=Ge,.5)
r.style_mode_label_disabled=Fe
var We=i(null,{outline_width:2,outline_color:255,glow_xoffs:0,glow_yoffs:0,glow_inner:0,glow_outer:0,glow_color:0,color:4294967295})
r.style_progress_label=We
var He=i(null,{color:4294967295,outline_width:2,outline_color:128})
var ze=r.status_style=He
r.stamina_style=ze
var Ve=i(null,{color:3707764991})
r.auth_migration_error=Ve
var Ye=i(null,{color:4294967295,outline_width:.5,outline_color:128})
r.unlock_prompt_style=Ye
var je=f(0,0,0,1)
r.color_line=je
var Ke=f(0,0,0,.125)
r.color_user_over=Ke
var qe=f(0,0,0,.05)
r.color_user_alternate=qe
var Ze=f(1,1,1,.5)
r.color_user_viewing=Ze
var Xe=d(1958962568)
r.color_user_self_score=Xe
var Qe=f(1,0,0,.25)
r.color_remove_user=Qe
var $e=f(1,0,0,.5)
r.color_remove_user_over=$e
var Je=f(1,0,0,.125)
r.color_remove_user_alternate=Je
var et=f(1,.5,.5,.75)
r.color_remove_user_viewing=et
var tt=c([.33,.33,.33,1])
r.colors_user_selected=tt
var rt=f(0,0,0,0)
r.color_transparent=rt
var at=f(0,0,0,1)
r.color_black=at
var it=f(0,0,0,.75)
r.color_black_75=it
var ot=f(0,0,0,.5)
r.color_black_50=ot
var nt=f(0,0,0,.3)
r.color_black_30=nt
var st=f(0,0,0,.2)
r.color_black_20=st
var lt=f(1,1,1,1)
r.color_white=lt
var _t=f(1,1,1,.5)
r.color_white_50=_t
var ct=f(1,1,1,.3)
r.color_white_30=ct
var ut=f(1,1,1,.25)
r.color_white_25=ut
var dt=f(.8,.8,.8,1)
r.color_gray80=dt
var ft=f(.5,.5,.5,1)
r.color_gray_50=ft
var vt=f(0,0,0,.8)
r.color_locked_fade=vt
var ht=f(.25,1,.25,1)
r.color_green=ht
var pt=f(.75,0,0,1)
r.color_red=pt
var mt=f(1,1,.25,1)
r.color_yellow=mt
var Et=f(.25,.8,.25,1)
r.color_liked=Et
var gt=f(.25,.7,.25,1)
r.color_liked_rollover=gt
var Tt=f(.8,.8,.8,1)
r.color_unliked_rollover=Tt
var yt=f(0,0,0,.2)
r.color_photo_frame_shadow=yt
var St=f(.5,0,0,1)
r.color_photo_frame_error=St
var It=f(.23,.87,1,1)
r.color_photo_frame_extra=It
var At=f(1,.93,.6,1)
r.color_photo_frame_listed=At
var wt=f(0,0,0,.15)
r.color_rollover_cover=wt
var Lt=c(ht)
r.colors_green=Lt
var Ot=f(113/255,226/255,1,1)
var Rt=c(r.color_gems=Ot)
r.colors_gems=Rt
var bt=c([241/255,229/255,172/255,1])
r.colors_light_gold=bt
var Nt=c([1,.2,.2,1])
r.colors_red=Nt
var Ct=c([1,1,1,.5])
r.colors_disabled=Ct
var xt=f(1,1,1,.25)
r.color_touch_dpad_border=xt
var Mt=f(1,1,1,1)
r.color_touch_dpad_cursor=Mt
var Dt=f(1,1,1,1)
r.color_touch_sprint_active=Dt
var Pt=f(.5,.5,.5,.5)
r.color_touch_sprint_inactive=Pt
var Bt=c(f(1,1,1,.7))
r.touch_jump_button_colors=Bt
var kt=at
r.color_hp_none=kt
var Ut=n(Ge,4278190335)
r.style_hp_label_none=Ut
var Gt=pt
r.color_hp_low=Gt
var Ft=n(Ge,4286611711)
r.style_hp_label_low=Ft
var Wt=mt
r.color_hp_med=Wt
var Ht=n(Ge,4294951167)
r.style_hp_label_med=Ht
var zt=ht
r.color_hp_high=zt
var Vt=n(Ge,4294967295)
r.style_hp_label_high=Vt
var Yt=f(.25,1,.25,1)
r.color_stamina_bar=Yt
var jt=f(.25,.5,1,1)
r.color_o2_bar=jt
function colorAlpha(e,t){return f(e[0],e[1],e[2],e[3]*t)}var Kt=[null,4291564031,2695674367,3011859455]
var qt=i(F,{outline_width:1,outline_color:160})
var Zt=Kt.map(function(e){return e&&d(e)})
r.color_trophies=Zt
var Xt=Kt.map(function(e){return e&&i(qt,{color:e})})
r.style_trophies=Xt
var Qt=i(null,{color:8388863,outline_color:153,outline_width:1})
r.style_log_commands=Qt
var $t=i(null,{color:33023,outline_color:153,outline_width:1})
r.style_log_waygates=$t
var Jt=i(F,{glow_inner:0,glow_outer:1.5})
var er=[F,F,i(Jt,{glow_color:550519039}),i(Jt,{glow_color:1082195967}),i(Jt,{glow_color:3764453375})]
r.style_rarity=er
var tr=[null,null,f(0,1,.2,.3),f(0,.4,1,.3),f(.7,.2,1,.3)]
r.color_rarity=tr
var rr=i(null,{color:4210752255,outline_width:1.5,outline_color:255})
r.sign_font_style=rr
var ar=i(null,{color:1431655935})
r.flavour_text_style=ar
var ir=i(null,{glow_xoffs:1,glow_yoffs:1,glow_inner:-1.5,glow_outer:2.5})
var or=i(ir,{color:1083970815,glow_color:1083970815})
r.customization_common=or
var nr=i(ir,{color:208916991,glow_color:208916991})
r.customization_rare=nr
var sr=i(ir,{color:2450313727,glow_color:2450313727})
r.customization_epic=sr
var lr=i(ir,{color:3513453823,glow_color:3513453823})
r.customization_legendary=lr
var _r=f(.25,.61,.08,1)
r.color_cosmetic_base_common=_r
var cr=f(.05,.45,.82,1)
r.color_cosmetic_base_rare=cr
var ur=f(.57,.05,.82,1)
r.color_cosmetic_base_epic=ur
var dr=f(.91,.39,.05,1)
r.color_cosmetic_base_legendary=dr
var fr=f(.72,.89,.11,1)
r.color_cosmetic_bright_common=fr
var vr=f(.25,.72,.9,1)
r.color_cosmetic_bright_rare=vr
var hr=f(.91,.49,.9,1)
r.color_cosmetic_bright_epic=hr
var pr=f(.95,.71,.11,1)
r.color_cosmetic_bright_legendary=pr
var mr=c(hr)
r.colors_orbs_buy=mr
var Er=_(f(.25,.72,.9,1),f(1,1,1,1),f(1,1,1,1),f(.25,.72,.9,1))
r.colors_gems_wallet=Er
var gr=_(f(.95,.54,.96,1),f(1,1,1,1),f(1,1,1,1),f(.95,.54,.96,1))
r.colors_orbs_wallet=gr
var Tr=_(f(.69,.85,.29,1),f(1,1,1,1),f(1,1,1,1),f(.69,.85,.29,1))
r.colors_gems_free_wallet=Tr
var yr=c([.773,.91,.333,1])
r.colors_gems_free_bonus=yr
var Sr=[Z,X,Q]
var Ir=[z,K,q]
var Ar={SYSADMIN:Sr,TEAM:Sr,OWNER:[te,re,ae],ADMIN:[ie,oe,ne],BUILDER:Ir,AREABUILDER:Ir,READONLY:Ir,SPECTATOR:[se,le,_e],NONE:[ve,he,pe],WORLD:[$,J,ee]}
r.styles_per_role=Ar
function getStyleForClient(e,t){var r=v(e,true)
return Ar[r][t]}function getStyleForRole(e,t){return Ar[e][t]}var wr=i(null,{color:4294967295,glow_xoffs:0,glow_yoffs:3,glow_inner:-1.5,glow_outer:2.5,glow_color:77})
r.shop_cost_currency_style=wr
var Lr=n(E,2155905279)
r.first_offer_price_expired_style=Lr
var Or={default:{},sapling:{color:f(.7,1,.6,1)},grow:{color:f(.7,1,.6,1)}}
r.prop_chat_styles=Or
var Rr=i(E,{color:553599231,glow_color:4206847,glow_outer:5})
s("bvhighlight",r.style_boost_view_highlight=Rr)
s("title",D)
s("label",E)},{"../common/roles_common":260,"../glov/client/font":315,"../glov/client/markdown_renderables":334,"../glov/client/ui":367,"../glov/common/vmath":402}],198:[function(e,t,r){"use strict"
r.workerReady=workerReady
r.workerBatchQueued=workerBatchQueued
r.workerFlush=workerFlush
r.workerFlushAll=workerFlushAll
r.workerTaskCount=workerTaskCount
r.taskBatchId=taskBatchId
r.taskCreate=taskCreate
r.startup=startup
r.per_worker_data=r.BATCH_TIME=r.WORKER_MESH=r.WORKER_GEN=r.WORKER_LOD=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var u=e("assert")
var a=e("../glov/client/engine.js")
var d=e("../glov/common/util.js").callEach
var i=e("../glov/common/verify.js")
var o=e("../glov/client/worker_comm.js")
var n=2
r.WORKER_LOD=n
var s=1
r.WORKER_GEN=s
var l=0
r.WORKER_MESH=l
var _=["MeshWorker","GenWorker","LODWorker"]
var c=100
var f=(r.BATCH_TIME=c)/2
var v={}
r.per_worker_data=v
var h
var p=0
var m=[]
var E=0
function WorkerData(e){this.worker=e
this.in_flight_time=0
this.in_flight_count=0
this.in_flight_head=null
this.in_flight_tail=null
this.batched_time=0
this.batch_id=++E
this.batch=[]
this.batch_transfer=null}function workerReady(e){var t=m[e]
if(t.batched_time>c)return false
return t.in_flight_count<=1||t.in_flight_time<=f}function workerBatchQueued(e){return m[e].batch.length}function Task(e,t){this.time=e.time
var r="taskresp:"+e.type
this.cb=function(e){profilerStart(r)
t(e)
profilerStop(r)}
this.next=null
this.id=++p}function workerFlush(e){var t=m[e]
if(!t.batch.length)return
t.in_flight_count+=t.batch.length
var r=t.batch_transfer&&t.batch_transfer.length?t.batch_transfer:void 0
if(r)for(var a=0;a<r.length;++a)u(r[a])
o.sendmsg(e,"task_batch",{batch_id:t.batch_id,batch:t.batch},r)
t.batch_id=++E
t.batch=[]
t.batch_transfer=null
var i=t.batched_time
t.in_flight_time+=i
t.batched_time=0}function workerFlushAll(){for(var e=0;e<m.length;++e){var t=m[e]
if(t&&t.batch.length)workerFlush(e)}}function workerTaskCount(e){var t=m[e]
return t.in_flight_count+t.batch.length}function taskBatchId(e){return m[e].batch_id}function taskCreate(e,t){var r=new Task(e,t)
var a=m[e.worker]
a.batch.push({task_id:r.id,type:e.type,data:e.data})
if(a.in_flight_tail)a.in_flight_tail=a.in_flight_tail.next=r
else a.in_flight_tail=a.in_flight_head=r
a.batched_time+=e.time
if(e.transfer&&e.transfer.length)if(!a.batch_transfer)a.batch_transfer=e.transfer
else a.batch_transfer=a.batch_transfer.concat(e.transfer)
return r}var g=[]
function onTaskBatchDone(e,t){var r=t.results,a=t.tracking_data
u(r&&r.length)
v[e]=a
g.push({worker_index:e,results:r})}function tickTaskSched(){if(!g.length)return
var e=[]
for(var t=0;t<g.length;++t){var r=g[t]
var a=r.worker_index,i=r.results
var o=m[a]
for(var n=0;n<i.length;++n){var s=i[n],l=s.task_id,_=s.res
u(o.in_flight_head)
if(o.in_flight_head.id!==l){u(o.in_flight_head.id<=l)
while(o.in_flight_head&&o.in_flight_head.id<l){console.error("Discarding task #"+o.in_flight_head.id+" because we got the result for "+l+" first")
o.in_flight_head=o.in_flight_head.next}}u.equal(o.in_flight_head.id,l)
var c=o.in_flight_head
o.in_flight_head=c.next
o.in_flight_time-=c.time
o.in_flight_count--
e.push(c.cb.bind(c,_))}if(!o.in_flight_head)o.in_flight_tail=null}g.length=0
d(e)}function startup(){if(a.defines.NOWORKERS)return
h=3
o.setNumWorkers(h)
o.addHandler("task_batch_done",onTaskBatchDone)
var e={should_throw:i.shouldThrow(),is_debug:a.DEBUG}
for(var t=0;t<h;++t){m.push(new WorkerData(t))
o.sendmsg(t,"worker_init",_extends({},e,{name:_[t]}))}a.addTickFunc(tickTaskSched)}},{"../glov/client/engine.js":305,"../glov/client/worker_comm.js":373,"../glov/common/util.js":400,"../glov/common/verify.js":401,assert:void 0}],199:[function(e,t,r){"use strict"
r.tileMapIdentityTinted=tileMapIdentityTinted
r.setMetalTints=setMetalTints
r.setUnreleasedTiles=setUnreleasedTiles
r.priority_solid=r.priority_liquid=r.tile_map_identity=r.VNUDGE_BIT=r.STONES_BY_TIER=r.NUM_STONES=r.STONES=r.DIG_RATE_PROP=r.DIG_RATE_DEFAULT=r.tile_map_liquids=r.tile_map_default=r.liquid_colors=r.tile_colors=r.MAT_METAL_TINT=r.liquid_code_name=r.liquid_name=r.tile_code_name=r.tile_info=r.tile_name_block=r.tile_name=void 0
var O=e("assert")
var a=e("../glov/common/util")
var i=a.defaults
var o=a.merge
var n=e("../glov/common/vmath")
var s=n.v3copy
var l=n.vec4
var R=e("../common/ids").TYPE_BLOCK
var _=e("../common/materials_common").Mat
var c=e("./atlas_params.json")
var u=e("./autogen/liquid_tiles_data")
var d=e("./autogen/tiles_data")
var f=e("./context").getAccessPrerelease
var v=e("./tiles_const").Tint
var h=e("./tiles_const")
var p=o(r,h.TILES)
var m=[]
r.tile_name=m
var E=[]
r.tile_name_block=E
var g=[]
r.tile_info=g
var T={}
r.tile_code_name=T
var y=Object.keys(p)
for(var S=0;S<y.length;++S)T[p[y[S]]]=y[S]
var I=o({},h.LIQUID_TILES)
o(p,I)
var A=[]
r.liquid_name=A
var w=[]
r.liquid_code_name=w
var L=Object.keys(I)
for(var b=0;b<L.length;++b)w[I[L[b]]]=L[b]
o(p,{HIT_LIQUID:256,PROP_PENDING:257,TINT_GRASS:v.GRASS,TINT_ORE:v.ORE,TINT_MAX:v.MAX});(function(){var e=Object.keys(p)
for(var t=0;t<e.length;++t)p["TILE_"+e[t]]=p[e[t]]})()
var N=function(){var e=[]
for(var t=0;t<14;++t)e.push(l(1,0,1,1))
return e}()
var C={};(r.MAT_METAL_TINT=C)[_.COPPER]=N[0]
C[_.IRON]=N[1]
C[_.TIN]=N[2]
C[_.BRONZE]=N[3]
C[_.SILVER]=N[4]
C[_.EMBERYLLIUM]=N[5]
C[_.GOLD]=N[6]
C[_.BRIGHTSTEEL]=N[7]
C[_.COBALT]=N[8]
C[_.MYTHRIL]=N[9]
C[_.AETHERSTONE]=N[10]
C[_.AETHERSTEEL]=N[11]
C[_.MUTTAL]=N[12]
var x=[]
r.tile_colors=x
var M=[]
r.liquid_colors=M
function rgb(e,t,r){return new Uint8Array([e,t,r])}x[p.STONE]=rgb(152,157,178)
x[p.STONE_LIGHT]=rgb(196,205,234)
x[p.STONE_DARK]=rgb(111,115,137)
x[p.STONE_RED]=rgb(155,116,101)
x[p.DIRT]=rgb(180,99,69)
x[p.SNOW]=rgb(201,240,253)
x[p.SAND]=rgb(250,255,177)
x[p.COAL]=rgb(33,32,34)
x[p.CORAL1]=rgb(198,0,117)
x[p.CORAL2]=rgb(26,59,204)
x[p.VEINIUM]=rgb(222,155,255)
x[p.GLASS]=rgb(199,225,242)
x[p.TILLED]=x[p.DIRT]
x[p.TILLED_WATERED]=x[p.DIRT]
x[p.BRICK_CLAY]=rgb(222,110,46)
x.def=rgb(255,0,255)
M[p.WATER]=rgb(0,98,228)
var D=o({},d);(r.tile_map_default=D)[p.COAL].tint_color=N[13]
O(D.prop)
for(var P=p.PROP_BASE;P<=p.PROP_MAX;++P)D[P]=i({debug:"PROP_"+(P-p.PROP_BASE),tile_code:"PROP_"+(P-p.PROP_BASE)},D.prop)
delete D.prop
O(D.unknown)
D.unknown.tile_code="EMPTY"
for(var B=0;B<256;++B)if(!D[B])D[B]=D.unknown
var k=o({},u)
r.tile_map_liquids=k
var U=1
r.DIG_RATE_DEFAULT=U
var G=.5
r.DIG_RATE_PROP=G
var F=[p.STONE,p.STONE,p.STONE,p.STONE_DARK,p.STONE,p.STONE_LIGHT,p.STONE,p.STONE_LIGHT,p.STONE_LIGHT,p.STONE,p.STONE,p.STONE_DARK,p.STONE,p.STONE_LIGHT,p.STONE,p.STONE_LIGHT,p.STONE,p.STONE,p.STONE_RED,p.STONE,p.STONE]
var W=(r.STONES=F).length
r.NUM_STONES=W
var H=[p.STONE,p.STONE_LIGHT,p.STONE_DARK,p.STONE_RED]
var z=[0,1,2,3].map(function(r){return F.map(function(e){var t=H.indexOf(e)
return H[(t+r)%H.length]})})
r.STONES_BY_TIER=z
var V=128
r.VNUDGE_BIT=V
function fillMaps(h,e,t){var p={}
var m={}
var E={}
var g={}
var T={}
var y={}
var S={}
var I={}
var A=256
var w=[]
var L=[]
var r=function _loop(e){var r=h[e]
var t=Number(e)
if(!r.inv&&r.limited_blueprint)r.inv=[r.limited_blueprint]
if(!r.inv){O(isFinite(t))
r.inv=[t]}if(!Array.isArray(r.inv))r.inv=[r.inv]
for(var a=0;a<r.inv.length;++a){var i=r.inv[a]
if("number"===typeof i)r.inv[a]={type:R,id:i}
else O(i.id)}if(r.variable_yield&&r.mat&&C[r.mat])r.tint_color=C[r.mat]
if(r.crafted)r.stamina_use=0
if(r.unlimited_only)O(r.limited_blueprint)
var o=!r.unlimited_only&&!r.unplaceable
if(o&&(1!==r.inv.length||r.inv[0].type!==R||r.inv[0].id!==t))o=false
r.allowed_in_inventory=o
if(r.mat&&!r.not_material_source){O(isFinite(t))
if(r.crafted){O(!L[r.mat])
L[r.mat]=t}else if(!r.unplaceable){O(!w[r.mat])
w[r.mat]=t}}var n=r.alpha||false
var s=r.alpha_cutout||false
var l=(r.tile1?0:r.tile4?3:2)<<5
var _=r.tint||0
var c=r.tint_color||void 0
var u=r.unlit||false
var d=r.doublesided||false
if(c){if(void 0!==S[r.def]&&S[r.def]!==c){var f=--A
I[f]=r.def
r.def=f}S[r.def]=c}function assignValues(e){p[e]=n
m[e]=n||s
y[e]=d
E[e]=l
if(_){O(void 0===g[e]||g[e]===_)
g[e]=_}T[e]=u}assignValues(r.def)
if(r.face){O(!c)
for(var v=0;v<r.face.length;++v)if(r.face[v])assignValues(r.face[v])}["above","below"].forEach(function(e){if(r[e]){O(!c)
for(var t in r[e])assignValues(r[e][t])}})}
for(var a in h)r(a)
if(e)for(var i=e;i<=t;++i)if(E[i])E[i]|=V
h.tile_rate=E
h.alpha_map=p
h.alpha_allow_map=m
h.doublesided_map=y
h.tint_map=g
h.tint_colors=S
h.unlit_map=T
h.material_map=w
h.material_crafted_map=L
h.tile_override=I}fillMaps(D,c.primary.nudge[0],c.primary.nudge[1])
fillMaps(k)
Object.keys(k.alpha_allow_map).forEach(function(e){return D.alpha_allow_map[e]=true})
D.material_map[_.FANCY_STONE]=p.STONE_LIGHT
D.tile_invisible=p.INVISIBLE
D.tile_non_opaque=p.NON_OPAQUE
k.tile_invisible=p.INVISIBLE
k.tile_non_opaque=p.NON_OPAQUE
var Y=function(){var e={}
for(var t=0;t<256;++t)e[t]={def:t}
e.tile_invisible=e.tile_non_opaque=256
return e}()
r.tile_map_identity=Y
function tileMapIdentityTinted(e,t){t=t||256
var r={}
var a={}
var i={}
for(var o=0;o<t;++o){r[o]=Y[o]
a[o]=96
i[o]=o>=e?62:63}r.tile_rate=a
r.tile_override=i
r.tile_invisible=r.tile_non_opaque=t
return r}var j={};(r.priority_liquid=j)[0]=1
j[p.WATER_FLOW]=2
j[p.WATER]=3
var K={};(r.priority_solid=K)[p.GRASS]=1
K[p.TILLED]=2
K[p.DIRT]=3
function setMetalTints(e){O.equal(N.length,e.length-1)
for(var t=0;t<N.length;++t)s(N[t],e[t+1])}var q={}
function setUnreleasedTiles(){if(f())for(var e in q){D[e].def=q[e].def
D[e].face=q[e].face
delete q[e]}else for(var t in D){var r=D[t]
if(r.next_release&&!q[t]){q[t]={def:D[t].def,face:D[t].face}
r.def=D[p.STONE].def
r.face=D[p.STONE].face}}}},{"../common/ids":249,"../common/materials_common":253,"../glov/common/util":400,"../glov/common/vmath":402,"./atlas_params.json":14,"./autogen/liquid_tiles_data":17,"./autogen/tiles_data":18,"./context":45,"./tiles_const":200,assert:void 0}],200:[function(e,t,r){"use strict"
r.FuelRate=r.Tint=r.LIQUID_TILES=r.TILES=void 0
var a={EMPTY:0,DIRT:1,GRASS:2,STONE:3,ORE_IN_STONE:4,COAL:5,WOOD:6,TILLED:8,TILLED_WATERED:9,SNOW:10,SAND:11,STONE_DARK:12,STONE_LIGHT:13,STONE_RED:14,DIRT_WITH_FLINT:16,WOOD_BARK:17,PLANKS_WOOD:18,BRICK_CLAY:19,BRICK_STONE:20,WOOD_LIGHT:21,WOOD_LIGHT_BARK:22,PLANKS_WOOD_LIGHT:23,WOOD_DARK:24,WOOD_DARK_BARK:25,PLANKS_WOOD_DARK:26,WOOD_RED:27,WOOD_RED_BARK:28,PLANKS_WOOD_RED:29,COLORED_HUE0:30,COLORED_HUE1:31,COLORED_HUE2:32,COLORED_HUE3:33,COLORED_HUE4:34,COLORED_HUE5:35,ORE_IN_STONE_LIGHT:36,ORE_IN_STONE_DARK:37,ORE_IN_STONE_RED:38,VEINIUM:39,ORE_IN_VEINIUM:40,CORAL1:41,CORAL2:42,LEAVES1:100,LEAVES2:101,LEAVES3:102,LEAVES4:103,LEAVES5:104,NON_OPAQUE:105,GLASS:110,COPPER:120,TIN:121,IRON:123,SILVER:124,EMBERYLLIUM:125,GOLD:126,COBALT:128,MYTHRIL:129,AETHERSTONE:130,INTANGIBLE:200,PASSABLE_LEAVES:200,POROUS:201,INVISIBLE:220,PROP_MASK:240,PROP_VALUE:224,UNDIGABLE:224,PROP_BASE:224,PROP_MAX:239,AIR:255}
r.TILES=a
var i={LIQUID_EMPTY:0,LIQUID_RESERVED:1,WATER:2,WATER_FLOW:3}
r.LIQUID_TILES=i
var o;(function(e){e[e["GRASS"]=1]="GRASS"
e[e["ORE"]=2]="ORE"
e[e["MAX"]=3]="MAX"})((r.Tint=o)||(r.Tint=o={}))
var n;(function(e){e[e["WOOD"]=10]="WOOD"
e[e["PLANKS"]=20]="PLANKS"
e[e["LEAVES"]=100]="LEAVES"})((r.FuelRate=n)||(r.FuelRate=n={}))},{}],201:[function(e,t,r){"use strict"
r.TILES_UI_SORT=void 0
var a={DIRT:1e3,TILLED:1001,TILLED_WATERED:1002,GRASS:1003,WOOD_LIGHT:2e3,WOOD:2001,WOOD_DARK:2002,WOOD_RED:2003,PLANKS_WOOD_LIGHT:2100,PLANKS_WOOD:2101,PLANKS_WOOD_DARK:2102,PLANKS_WOOD_RED:2103,COLORED_HUE0:2200,COLORED_HUE1:2201,COLORED_HUE2:2202,COLORED_HUE3:2203,COLORED_HUE4:2204,COLORED_HUE5:2205,LEAVES1:3e3,LEAVES2:3001,LEAVES3:3002,LEAVES4:3003,LEAVES5:3004,PASSABLE_LEAVES:3005,STONE_LIGHT:4e3,STONE:4001,STONE_DARK:4002,STONE_RED:4003,VEINIUM:4004,BRICK_STONE:4100,SNOW:5e3,SAND:5001,CORAL1:5002,CORAL2:5003,BRICK_CLAY:5100,GLASS:5101,ORE_IN_STONE_LIGHT:6e3,ORE_IN_STONE:6001,ORE_IN_STONE_DARK:6002,ORE_IN_STONE_RED:6003,ORE_IN_VEINIUM:6004,COAL:6100,EMPTY:null,DIRT_WITH_FLINT:null,WOOD_BARK:null,WOOD_LIGHT_BARK:null,WOOD_DARK_BARK:null,WOOD_RED_BARK:null,NON_OPAQUE:null,COPPER:null,TIN:null,IRON:null,SILVER:null,EMBERYLLIUM:null,GOLD:null,COBALT:null,MYTHRIL:null,AETHERSTONE:null,INTANGIBLE:null,POROUS:null,INVISIBLE:null,PROP_MASK:null,PROP_VALUE:null,UNDIGABLE:null,PROP_BASE:null,PROP_MAX:null,AIR:null}
r.TILES_UI_SORT=a},{}],202:[function(e,t,r){"use strict"
r.todoListActive=todoListActive
r.todoIsInList=todoIsInList
r.todoTooltip=todoTooltip
r.todoDone=todoDone
r.todoListAdd=todoListAdd
r.todoListTick=todoListTick
r.todoListInit=todoListInit
r.TODO_SET=r.TODO_INCREMENT=r.TODO_TOGGLE=void 0
var n=1
r.TODO_TOGGLE=n
var a=2
r.TODO_INCREMENT=a
var s=3
r.TODO_SET=s
var V=e("assert")
var h=e("../glov/client/camera2d")
var Y=e("../glov/client/engine")
var p=e("../glov/client/input")
var m=e("../glov/client/scroll_area").scrollAreaCreate
var i=e("../glov/client/sprites")
var E=i.spriteClipPause
var g=i.spriteClipResume
var j=e("../glov/client/ui")
var o=e("../glov/common/util")
var l=o.clone
var T=o.easeIn
var K=e("../glov/common/verify")
var _=e("../glov/common/vmath")
var q=_.unit_vec
var c=_.v3copy
var u=_.vec4
var d=e("../common/ids")
var f=d.TYPE_RECIPE
var X=d.TYPE_SETTLEMENT_UPGRADE
var Q=e("./blueprint").blueprintGetDef
var y=e("./build_mode").doingDragPlace
var v=e("./crafting_recipes").recipeValidName
var S=e("./inventory")
var $=S.countAvailable
var J=S.countAvailableEx
var ee=e("./inventory_ui").inventoryButton
var I=e("./item_info_view")
var te=I.ITEM_INFO_VIEW_H
var A=I.ITEM_INFO_VIEW_W
var re=I.itemInfoViewShow
var w=e("./items")
var ae=w.ITEM_CONTEXT_BUILD
var ie=w.ITEM_CONTEXT_ITEM
var oe=w.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var ne=w.createItem
var L=w.itemEqualLoose
var se=w.itemIsBlueprint
var O=w.satisfiesCostLoose
var R=e("./layout").menuUpperLeft
var le=e("./localization/localization").L
var b=e("./menu")
var _e=b.menuActive
var ce=b.menuInteractGetProp
var N=e("./menu_ribbon")
var C=N.RIBBON_BOTTOM_MARGIN
var ue=N.getMenuRibbonXOuter
var de=e("./settlement").settlementLastBound
var fe=e("./settlement_edit").settlementProgress
var ve=e("./status")
var x=e("./styles")
var he=x.color_green
var pe=x.style_ready
var M=e("./tutorial")
var me=M.tutorialHook
var Ee=M.tutorialState
var ge=M.tutorialUnderRibbonY1
var Te=e("./ui_util")
var D=e("./user_data")
var P=D.unlimitedItemsAllowed
var ye=D.userDataSet
var Se=D.worldReadOnly
var B=e("./waygate_upgrade")
var Ie=B.WAYGATE_TIERS
var Ae=B.WAYGATE_UPGRADES
var we=e("./world_metadata").worldSettlements
var Le=Math.min
var Oe
var Re
var be
var Ne=u(.8,.8,.8,1)
var Ce=u(0,0,0,.5)
var xe=u(.7,.7,.7,1)
function todoListActive(){return!P()}function sameTodoItem(e,t,r){if(e.context!==t.context)return false
if(e.context===oe)return e.inv.attr1===t.inv.attr1
return r?O(e.inv,t.inv):L(e.inv,t.inv)}function todoIsInList(e,t){var r={inv:e,context:t}
for(var a=0;a<Oe.length;++a)if(sameTodoItem(Oe[a],r,false))return true
return false}function todoTooltip(e,t){return todoIsInList(e,t)?le.TODO_REMOVE_PIN:le.TODO_ADD_PIN}function todoDone(e,t){if(!Oe)return
var r={inv:e,context:t}
for(var a=0;a<Oe.length;++a){var i=Oe[a]
if(sameTodoItem(i,r,true)){if(e.count<i.inv.count)i.inv.count-=e.count
else Oe.splice(a,1)
ye("todo",Oe)}}}function todoListAdd(e,t,r){e=l(e);(e=ne(e)).added_time=Y.frame_timestamp
if(r===s)e.added_frame=Y.frame_index
if(t===ie){if(e.type===f)if(!v(e.attr1))return}else if(t===oe)if(e.type!==X||!Ae[e.attr1])return
var a={inv:e,context:t}
var i=false
for(var o=0;o<Oe.length;++o)if(sameTodoItem(Oe[o],a,false)){if(r===n)if(Oe[o].inv.added_frame>=Y.frame_index-1)ve.push(le.STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK)
else{ve.push(le.$(le.STATUSMSG_REMOVED_TASK,e.getName()))
Oe.splice(o,1)}else{if(r===s){e.added_time=Oe[o].inv.added_time
Oe[o].inv=e}else Oe[o].inv.count+=e.count
if(0!==o)Oe.splice(0,0,Oe.splice(o,1)[0])}i=true
break}if(!i){if(r!==s)ve.push(le.$(le.STATUSMSG_ADDED_TASK,e.getName()))
Oe.splice(0,0,a)}ye("todo",Oe)}var Me=350
var De=16
var k=u()
function colorAlpha(e,t){if(1===t)return e
c(k,e)
k[3]=t
return k}function styleAlpha(e,t){if(1===t)return e
return j.font.styleAlpha(e,t)}function todoListTick(e){var x=de()
if(we()&&x){for(var t=Oe.length-1;t>=0;--t){var r=Oe[t]
if(r.context===oe){var a
var i=r.inv.attr1
if(i===(null==(a=Ee())?void 0:a.name))continue
if(x.unlocked_upgrades[i]||i.startsWith("tier")&&Number(i.slice(4))>x.tier+1)Oe.splice(t,1)}}if(Ee()){if(void 0===Re)Re=x.tier}else if(x.tier!==Re&&todoListActive()){if(void 0!==Re){var o=Ie[x.tier+1]
if(o)todoListAdd({type:X,id:-1,attr1:o.key},oe)}Re=x.tier}}if(Se()||!todoListActive()||!Oe.length){if(be)be.resetScroll()
return}if(y()&&p.touch_mode||Y.defines.NOUI)return
if(!be)be=m({z:Z.UI,background_color:null,auto_hide:true})
var n=ue()
var s=ge()+C
var M=100*(R()?1:-1)
if(!R()){n-=Me+be.barWidth()
M+=h.w()-A}var D={x:n,y:s,w:Me+be.barWidth(),h:h.y1()-250-s,z:Z.TODO_LIST,disabled:e}
be.begin(D)
var P=(n=0)+De
var B=Me-2*De
var k=j.font_height
var U=1.5*k
var G=2*k
var F=4
var W=B-F-G
var H=.75*W
var z=W-F-H
function drawSection(e,t,r,a,i){var o=Oe[r]
var n=o.inv,s=o.context
var l=e
var _
var c
var u=[]
if(s===ie){_=le.separateColon(le.LBL_CRAFT,n.getName())
if(!K(n.isCrafted())){Oe.splice(r,1)
return e}c=n.getCraftCost()
var d=_e()&&ce({no_text:true})
if(d&&d.contents){var f=Object.keys(c)
f.sort()
for(var v=0;v<f.length-1;++v)u[v]=J(d,c[v],false,true)}}else if(s===ae){_=le.separateColon(le.LBL_BUILD,n.getName())
c=n.cost
var h=se(n)&&Q(n.getBID())
if(h)if(!h.loaded)c=[]
else c=h.cost}else if(s===oe){V.equal(n.type,X)
var p=n.attr1
var m=Ae[p]
_=le.separateColon(le.LBL_UNLOCK,m.name)
if(!x)c=Object.values(m.cost)
else{c=m.cost
var E=Object.keys(c)
E.sort()
var g=[]
for(var T=0;T<E.length;++T){var y=E[T]
var S=c[y]
u[T]=fe(x,p,y)
g.push(S)}c=g}}var I=styleAlpha(null,a)
j.font.drawSizedAligned(I,P,e,t,U,j.font.ALIGN.HCENTERFIT,B,0,_)
e+=U+F
var A=true
for(var w=0;w<c.length;++w){var L=c[w]
if(!L.is_item)L=c[w]=ne(L)
var O=L.getName()
var R=$(L,false,true)+(u[w]||0)
j.font.drawSizedAligned(I,P,e,t,k,j.font.ALIGN.HFIT,H,0,O)
j.font.drawSizedAligned(I,P+H+F,e,t,k,j.font.ALIGN.HFIT|j.font.ALIGN.HRIGHT,z,0,R+" / "+L.count)
var b={x:P+B-G,y:e,z:t,w:G,h:G,draw_only:true,base_name:"inv_empty",hide_count:true,colors:{regular:colorAlpha(q,a)},item_context:ie}
ee(b,L)
if(R>=L.count)Te.sprite.draw({x:b.x,y:b.y,z:b.z+1,w:b.w,h:b.h,frame:Te.CHECK,color:colorAlpha(he,a)})
else A=false
j.progressBar({x:P,y:e+k,z:t,w:W,h:G-k,progress:Le(1,R/L.count),color:colorAlpha(xe,a)})
e+=G+F}if(A){j.font.drawSizedAligned(styleAlpha(pe,a),P,e,t,k,j.font.ALIGN.HCENTERFIT,B,0,le.TODO_READY)
e+=k+F
me("todo_ready_"+n.type+"_"+n.id+"_"+n.attr1)}var N={x:P-De/2,y:l-De/2,w:B+De,h:e-l+De,z:t-.1,color:Ce}
if(i){if(j.buttonShared(N).ret){var C
if(2===(null==(C=j.button_click)?void 0:C.button))if(n.added_frame>=Y.frame_index-1)ve.push(le.STATUSMSG_CANNOT_REMOVE_TUTORIAL_TASK)
else{ve.push(le.$(le.STATUSMSG_REMOVED_TASK,n.getName()))
Oe.splice(r,1)
ye("todo",Oe)}else re({x:M,y:e-te/2+D.y,auto_close:true,inv:n.is_item?n:ne(n),context:s})}if(j.button_mouseover)j.drawRect2(N)}else if(a<1){N.color=colorAlpha(Ce,a)
j.drawRect2(N)}return e}var l=!e
var _=(s=0)+De
var c=Z.TODO_LIST
var u=50
Te.sprite.draw({x:P+B-u+De/2,y:_-De/2,z:c,w:u,h:u,color:Ce,frame:Te.PIN})
for(var d=0;d<Oe.length;++d){if(0!==d){_+=4
j.drawLine(P+4,_,P+B-8,_,c,1,1,Ne)
_+=4}var f=Oe[d].inv
if(f.added_time&&Y.frame_timestamp<f.added_time+1e3){var v=.5*T(1-(Y.frame_timestamp-f.added_time)/1e3,2)
E()
drawSection(_,Z.TODO_LIST_FLASH,d,v,false)
g()}_=drawSection(_,c,d,1,l)}_+=De
j.drawRect(n,s,n+Me,_,c-.2,Ce)
be.end(_)
D.h=Le(D.h,_)
if(l)p.mouseOver(D)}function todoListInit(e){Oe=[]
if(e)for(var t=e.length-1;t>=0;--t)todoListAdd(e[t].inv,e[t].context,s)
Re=void 0}},{"../common/ids":249,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/input":326,"../glov/client/scroll_area":349,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./blueprint":28,"./build_mode":33,"./crafting_recipes":68,"./inventory":114,"./inventory_ui":115,"./item_info_view":117,"./items":119,"./layout":120,"./localization/localization":131,"./menu":140,"./menu_ribbon":141,"./settlement":181,"./settlement_edit":182,"./status":193,"./styles":197,"./tutorial":203,"./ui_util":205,"./user_data":208,"./waygate_upgrade":223,"./world_metadata":235,assert:void 0}],203:[function(e,t,r){"use strict"
r.tutorialHook=tutorialHook
r.tutorialPosHook=tutorialPosHook
r.tutorialPostStateTick=tutorialPostStateTick
r.tutorialReset=tutorialReset
r.tutorialStartByName=tutorialStartByName
r.tutorialState=tutorialState
r.tutorialStartup=tutorialStartup
r.tutorialInit=tutorialInit
r.tutorialUnderRibbonY1=tutorialUnderRibbonY1
r.tutorialLeaveWorld=tutorialLeaveWorld
r.tutorialForcingMenu=tutorialForcingMenu
r.tutorialTick=tutorialTick
var a=e("assert")
var L=e("../glov/client/camera2d")
var i=e("../glov/client/cmds").cmd_parse
var O=e("../glov/client/engine")
var o=e("../glov/client/font").fontStyle
var R=e("../glov/client/input")
var d=e("../glov/client/spot").spotGet
var b=e("../glov/client/ui")
var N=e("../glov/client/ui").uiButtonHeight
var n=e("../glov/common/util").callEach
var s=e("../glov/common/verify")
var l=e("../glov/common/vmath")
var f=l.v2add
var _=l.v2addScale
var v=l.v2copy
var C=l.v2set
var c=l.v3copy
var u=l.v3distSq
var x=l.vec2
var h=l.vec3
var p=l.vec4
var m=l.zero_vec
var E=e("../common/ids")
var g=E.ITEM_CORD
var T=E.ITEM_PICKAX
var y=E.ITEM_SAWMILL
var S=E.ITEM_STONECUTTER_SIMPLE
var I=E.ITEM_TOOL_HEAD
var A=E.ITEM_WORKBENCH
var w=E.TYPE_ITEM
var M=E.TYPE_RECIPE
var D=E.TYPE_SETTLEMENT_UPGRADE
var P=e("../common/materials_common").Mat
var B=e("../common/world_trans").decodeWorldPos
var k=e("./analytics").logEvent
var U=e("./build_menu")
var G=U.SUB_SETTLEMENT
var F=U.getBuildMenuSubPage
var W=e("./chunk_searcher").ChunkSearcher
var H=e("./debug").debugAddText
var z=e("./fbinstant_worlds").fbInviteAsync
var V=e("./inventory")
var Y=V.INV_EQUIP
var j=V.countAvailable
var K=e("./items")
var q=K.ITEM_CONTEXT_BUILD
var X=K.ITEM_CONTEXT_ITEM
var Q=K.ITEM_CONTEXT_SETTLEMENT_UPGRADE
var $=K.createItem
var J=e("./layout")
var ee=J.CORNER_BUTTON_MARGIN
var te=J.layoutCameraPop
var re=J.layoutCameraPush
var ae=J.menuUpperLeft
var ie=e("./localization/localization").L
var oe=e("./main").charControllerPos
var ne=e("./menu")
var se=ne.BUILD
var le=ne.FACTORY
var _e=ne.WAYGATE_EDIT
var ce=ne.getMenuPage
var ue=ne.isBuildMenu
var de=ne.menuActive
var fe=ne.menuInteractGetProp
var ve=ne.prefixShortcutKey
var he=ne.setMenuPageLayout
var pe=e("./menu_ribbon")
var me=pe.RIBBON_BOTTOM_MARGIN
var Ee=pe.getMenuRibbonXOuter
var ge=pe.getMenuRibbonY1
var Te=e("./photo_mode").photoModeActive
var ye=e("./props").createIndicatorProp
var Se=e("./quickbar").itemInQuickbar
var Ie=e("./settlement")
var Ae=Ie.settlementCurrent
var we=Ie.settlementGetLazyAsync
var Le=Ie.settlementLastBound
var Oe=e("./settlement_edit").CRAFTING_ICON_SIZE
var Re=e("./status")
var be=e("./styles").menu_header_style
var Ne=e("./todo_list")
var Ce=Ne.TODO_SET
var xe=Ne.todoDone
var Me=Ne.todoListAdd
var De=e("./ui_util")
var Pe=e("./user_data")
var Be=Pe.userDataGet
var ke=Pe.userDataSet
var Ue=Pe.worldReadOnly
var Ge=e("./voxel_data")
var Fe=Ge.drawPropQueued
var We=Ge.localPosFromWorldPos
var He=e("./waygate_ui").waygateUIIsSettlement
var ze=e("./world_comm").getWorldID
var Ve=e("./world_metadata").adventureMode
var Ye=e("./worlds_sound").playSound
var je=Math.PI,Ke=Math.abs,qe=Math.sin
var Ze=80
var Xe=p(.16,1,0,.75)
var Qe={}
var $e={}
function tutorialHook(e,t,r){(r?Qe:$e)[e]=void 0!==t?t:true}function checkHook(e){return Boolean(Qe[e]||$e[e])}function checkFactoryAndRecipe(e,t){var r=fe({no_text:true})
return Boolean(ce()===le&&r&&r.item_id===e&&(!t||r.factory_recipe===t))}var Je={all:function all(){return true},build_menu:ue,build_menu_and_settlement_tab:function build_menu_and_settlement_tab(){return ue()&&F()===G},current_settlement:He,factory_aetherbench:function factory_aetherbench(){return checkFactoryAndRecipe(A)},factory_aetherbench_and_recipe_cord:function factory_aetherbench_and_recipe_cord(){return checkFactoryAndRecipe(A,"cord")},gameplay:function gameplay(){return!de()&&!Te()},menu:function menu(){return de()}}
var et={build_menu:se,build_menu_and_settlement_tab:se,current_settlement:_e,factory_aetherbench:le,factory_aetherbench_and_recipe_cord:le,menu:_e}
function craftingItem(e){return checkHook("crafting_"+w+"_"+e)||checkHook("available_to_take_"+w+"_"+e)}function haveMatsItem(e,t){return checkHook("todo_ready_"+w+"_"+e+"_"+(t||0))}function haveMatsProp(e,t){return checkHook("todo_ready_"+w+"_"+e+"_"+(t||0))||checkHook("transacting_build_prop_"+e)}function haveMatsSettlementUnlock(e){return checkHook("todo_ready_"+D+"_-1_"+e)}function haveMatsRecipe(e){return checkHook("todo_ready_"+M+"_-1_"+e)}var tt={crafting_cord:function crafting_cord(){return craftingItem(g)},have_mats_aetherbench:function have_mats_aetherbench(){return haveMatsProp(A)},have_mats_stonecutter:function have_mats_stonecutter(){return haveMatsProp(S)},have_mats_sawmill:function have_mats_sawmill(){return haveMatsProp(y)},have_mats_cord:function have_mats_cord(){return haveMatsItem(g)},have_mats_tier1:function have_mats_tier1(){return haveMatsSettlementUnlock("tier1")},have_mats_tier2:function have_mats_tier2(){return haveMatsSettlementUnlock("tier2")},have_mats_stone_tool_head:function have_mats_stone_tool_head(){return haveMatsRecipe("stone_tool_head")},have_mats_pickax:function have_mats_pickax(){return haveMatsRecipe("pickax")},in_qbar_aetherbench:function in_qbar_aetherbench(){return Se(A)},in_qbar_stonecutter:function in_qbar_stonecutter(){return Se(S)},in_qbar_sawmill:function in_qbar_sawmill(){return Se(y)},settlement_no_current:function settlement_no_current(){return!Ae(true)},settlement_no_access:function settlement_no_access(){var e=Ae(true)
return e&&!e.buildAllowed()},settlement_not_last_bound:function settlement_not_last_bound(){return Ae(true)!==Le()}}
var rt={}
function tutorialPosHook(e,t){rt[e]=t}var at;(function(e){e[e["DOWN"]=0]="DOWN"
e[e["LEFT"]=je/2]="LEFT"
e[e["UP"]=je]="UP"
e[e["RIGHT"]=3*je/2]="RIGHT"})(at=at||{})
var it=x(1,0)
var ot=x(0,.5)
var nt=x(1,.5)
var st=x(.5,1)
var lt=x(1,1)
function isSpotPos(e){return Boolean(e.spot_key)}var _t=[]
function addTutorialPostStateTick(e){(_t=_t||[]).push(e)}function tutorialPostStateTick(){if(_t.length>0){n(_t)
_t.length=0}}var ct
var ut=h()
function drawWorldIndicator(t,r){addTutorialPostStateTick(function(){var e=ct
if(t(ut)){if(!r)We(ut,ut)
Fe(e,ut)}})}function drawSettlementWorldIndicator(){drawWorldIndicator(function(e){var t=Ae(true)
if(!t)return false
c(e,t.world_pos)
e[2]+=2
return true},false)}function vdHasProp(e,t){var r=e.props
for(var a in r)if(r[a].item_id===t)return r[a]
return null}var dt=h()
var ft=h()
var vt
function searchProp(i){var o=null
vt.setStart(oe())
if(vt.done)vt.reset()
var n=0
var s=0
vt.search(function(e){var t=null
n++
vt.addWork(2)
var r=vdHasProp(e,i)
if(r){s++
B(dt,r.chunk_id,r.pos_idx)
We(ft,dt)
var a=u(vt.start,ft)
if(a<vt.closest_dist){o=r
t={closest_chunk:e,closest_dist:a,closest_offs:ft}}}return t})
if(O.defines.TUTORIAL_SEARCH){H("Checks:")
H("  Chunks Checked: "+n)
H("  Chunks With Prop: "+s)
H("Time: "+(O.hrnow()-vt.search_start_time).toFixed(3))
H("Distance: "+vt.last_closest_dist.toFixed(1)+"/"+vt.range)
H("Walk: "+vt.chunk_walk+" / "+vt.done)}return o}function drawPropWorldIndicator(r){drawWorldIndicator(function(e){var t=searchProp(r)
if(!t||Infinity===vt.last_closest_dist)return false
c(e,vt.last_closest_offs)
_(e,e,t.size,.5)
_(e,e,ct.size,-.5)
e[2]+=t.size[2]+.5
return true},true)}var ht=ie.reactive(function(){return ve("B",ie.LBL_BUILD_MENU,true)})
var pt=ie.separate("\n\n",ie.TUTORIAL_LOST_FRONTIER_MSG,ie.TUTORIAL_LOST_FRONTIER_MSG_NO_SETTLEMENT)
var mt=ie.separate("\n\n",ie.TUTORIAL_LOST_FRONTIER_MSG,ie.TUTORIAL_LOST_FRONTIER_MSG_NO_ACCESS)
var Et=ie.separate("\n\n",ie.TUTORIAL_LOST_FRONTIER_MSG,ie.TUTORIAL_LOST_FRONTIER_MSG_SET_HOME.$({button:ie.BTN_SETTLEMENT_SET_AS_HOME}))
var gt=ie.separate("\n\n",ie.TUTORIAL_LOST_FRONTIER_MSG,ie.TUTORIAL_LOST_FRONTIER_MSG_SELECT)
var Tt=ie.separate("",ie.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_1,"\n\n",ie.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_GENERIC)
var yt=ie.separate("",ie.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_1,"\n\n",ie.TUTORIAL_AETHERBENCH_BUILD_MENU_MSG_2_KEYBOARD.$({build_menu:ht}))
var St=ie.separate("\n\n",ie.TUTORIAL_AETHERBENCH_MATERIALS_MSG_1,ie.TUTORIAL_AETHERBENCH_MATERIALS_MSG_2.$({wood:10,stone:4}))
var It=ie.separate("\n\n",ie.TUTORIAL_STONECUTTERY_BUILD_MSG.$({build_menu:ie.LBL_BUILD_MENU}),ie.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE)
var At=ie.separate("\n\n",ie.TUTORIAL_STONECUTTERY_BUILD_MSG.$({build_menu:ht}),ie.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE)
var wt=ie.separate("\n\n",ie.TUTORIAL_STONECUTTERY_MATERIALS_MSG_1,ie.TUTORIAL_STONECUTTERY_MATERIALS_MSG_2.$({cord:2,stone:10}))
var Lt=ie.separate("",ie.TUTORIAL_WOODCUTTERY_BUILD_MSG.$({build_menu:ie.LBL_BUILD_MENU}),"\n\n  ",ie.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE)
var Ot=ie.separate("",ie.TUTORIAL_WOODCUTTERY_BUILD_MSG.$({build_menu:ht}),"\n\n  ",ie.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE)
var Rt=ie.separate("\n\n",ie.TUTORIAL_WOODCUTTERY_MATERIALS_MSG_1,ie.TUTORIAL_WOODCUTTERY_MATERIALS_MSG_2.$({heads:1,wood:20}))
var bt=300
var Nt=0
var Ct=0
var xt=false
var Mt=[null,{name:"share_url",prompts:[{context:"all",msg:ie.TUTORIAL_SHARE_URL_MSG,indicators:[{dir:at.UP,pos_hook_key:"tut_window_left"}],pos:{pos_hook_key:"tut_top_center"}}],show_as_visitor:true,dismiss:true,auto_dismiss:30,no_interrupt:true,done:function done(){return false},next:null},{name:"fb_share",prompts:[{context:"all",title:ie.TUTORIAL_INVITE_FRIENDS_TITLE,msg:ie.TUTORIAL_INVITE_FRIENDS_MSG,pos:{pos_hook_key:"tut_top_center"}}],show_as_visitor:true,dismiss:true,auto_dismiss:15,no_interrupt:true,done:function done(){return false},action:function action(){return void z(ze())},action_text:ie.BTN_INVITE_TO_WORLD,next:null},{main:true,unskippable:true,name:"adventure_start",title:ie.TUTORIAL_LOST_FRONTIER_TITLE,prompts:[{context:"gameplay",conditions:["settlement_no_current"],title:ie.TUTORIAL_LOST_FRONTIER_TITLE,msg:pt},{context:"gameplay",conditions:["settlement_no_access"],title:ie.TUTORIAL_LOST_FRONTIER_TITLE,msg:mt},{context:"gameplay",conditions:["settlement_not_last_bound"],title:ie.TUTORIAL_LOST_FRONTIER_TITLE,msg:Et},{context:"gameplay",title:ie.TUTORIAL_LOST_FRONTIER_TITLE,msg:gt,draw:drawSettlementWorldIndicator}],done:function done(){var e=Ae(true)
return e&&e.buildAllowed()&&e===Le()&&He()}},{main:true,name:"tier1",prompts:[{context:"current_settlement",conditions:["have_mats_tier1"],title:ie.TUTORIAL_PUT_RESOURCES_TITLE,msg:ie.TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_KEYBOARD,msg_touch:ie.TUTORIAL_UPGRADE_SETTLEMENT_FIRST_PUT_MSG_GENERIC,w:bt,indicators:[{dir:at.RIGHT,pos_hook_key:"required_items_before",offset:x(-Ze,Oe/2-Ze/2)},{dir:at.RIGHT,pos_hook_key:"inventory_slots",offset:x(-Ze,-Ze/2)}],pos:{pos_hook_key:"required_items_after"}},{context:"gameplay",conditions:["have_mats_tier1"],title:ie.TUTORIAL_GO_TO_SETTLEMENT_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_UPGRADE_SETTLEMENT_MSG,ie.TUTORIAL_UPGRADE_SETTLEMENT_MSG_HINT),draw:drawSettlementWorldIndicator},{context:"gameplay",title:ie.TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_TITLE,msg:ie.TUTORIAL_UPGRADE_SETTLEMENT_MATERIALS_MSG}],todo:{inv:{type:D,id:-1,attr1:"tier1"},context:Q},done:function done(){var e
return(null==(e=Ae())?void 0:e.tier)>=1}},{main:true,name:"tier2_workbench",title:ie.TUTORIAL_AETHERBENCH_BUILD_TITLE,prompts:[{context:"gameplay",conditions:["in_qbar_aetherbench","have_mats_aetherbench"],title:ie.TUTORIAL_AETHERBENCH_BUILD_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_KEYBOARD,ie.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_NOTE),msg_touch:ie.separate("\n\n",ie.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_GENERIC,ie.TUTORIAL_AETHERBENCH_PLACE_PROP_MSG_NOTE)},{context:"menu",conditions:["in_qbar_aetherbench","have_mats_aetherbench"]},{context:"build_menu_and_settlement_tab",conditions:["have_mats_aetherbench"],indicators:[{dir:at.UP,spot_key:"build_menu_workbench",anchor:st,offset:x(-Ze/2,0)}],title:ie.TUTORIAL_AETHERBENCH_SELECT_PROP_TITLE,msg:ie.TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_KEYBOARD.$({build_menu:ht}),msg_touch:ie.TUTORIAL_AETHERBENCH_SELECT_PROP_MSG_GENERIC.$({build_menu:ie.LBL_BUILD_MENU}),pos:{spot_key:"build_menu_workbench",anchor:lt}},{context:"build_menu",conditions:["have_mats_aetherbench"],indicators:[{dir:at.LEFT,spot_key:"build_menu_tab_"+G,anchor:nt,offset:x(0,-Ze/2)}],title:ie.TUTORIAL_OPEN_SETTLEMENT_TAB_TITLE,msg:ie.TUTORIAL_AETHERBENCH_SETTLEMENT_TAB_MSG,pos:{spot_key:"build_menu_tab_"+G,anchor:lt}},{context:"menu",conditions:["have_mats_aetherbench"],indicators:[{dir:at.UP,spot_key:"menu_tab_button_"+se,anchor:st,offset:x(-Ze/2,0)}],title:ie.TUTORIAL_OPEN_BUILD_MENU_TITLE,msg:ie.TUTORIAL_AETHERBENCH_BUILD_TAB_MSG,pos:{spot_key:"menu_tab_button_"+se,anchor:lt}},{context:"gameplay",conditions:["have_mats_aetherbench"],title:ie.TUTORIAL_OPEN_BUILD_MENU_TITLE,title_touch:ie.TUTORIAL_OPEN_MENU_TITLE,msg:yt,msg_touch:Tt},{context:"gameplay",title:ie.TUTORIAL_AETHERBENCH_MATERIALS_TITLE,msg:St}],todo:{inv:{type:w,id:A},context:q},done:function done(){return checkHook("build_prop_"+A)||checkHook("factory_"+A)}},{main:true,name:"tier2_cord",title:ie.TUTORIAL_CORD_CRAFT_TITLE,prompts:[{context:"factory_aetherbench",conditions:["crafting_cord"],force_menu:true,title:ie.TUTORIAL_CORD_CRAFT_TITLE,msg:ie.TUTORIAL_CORD_TAKE_MSG,w:bt,pos:{spot_key:"1,0",anchor:it,offset:x(10,0)}},{context:"factory_aetherbench_and_recipe_cord",conditions:["have_mats_cord"],title:ie.TUTORIAL_CORD_CRAFT_TITLE,msg:ie.TUTORIAL_CORD_PUT_MSG,w:bt,pos:{spot_key:"1,0",anchor:it,offset:x(10,0)},indicators:[{dir:at.RIGHT,spot_key:"1,0",anchor:ot,offset:x(-Ze,-Ze/2)},{dir:at.RIGHT,spot_key:"1,1",anchor:ot,offset:x(-Ze,-Ze/2)},{dir:at.RIGHT,pos_hook_key:"inventory_slots",offset:x(-Ze,-Ze/2)}]},{context:"gameplay",conditions:["have_mats_cord"],title:ie.TUTORIAL_GO_TO_AETHERBENCH_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_CORD_CRAFT_MSG_1,ie.TUTORIAL_CORD_CRAFT_MSG_2),draw:function draw(){return drawPropWorldIndicator(A)}},{context:"gameplay",title:ie.TUTORIAL_CORD_MATERIALS_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_CORD_MATERIALS_MSG_1,ie.TUTORIAL_CORD_MATERIALS_MSG_2)}],todo:{inv:{type:w,id:g},context:X},done:function done(){return j($({type:w,id:g}))}},{main:true,name:"tier2_stonecutter",title:ie.TUTORIAL_STONECUTTERY_BUILD_TITLE,prompts:[{context:"gameplay",conditions:["in_qbar_stonecutter","have_mats_stonecutter"],title:ie.TUTORIAL_STONECUTTERY_BUILD_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_KEYBOARD,ie.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE),msg_touch:ie.separate("\n\n",ie.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_GENERIC,ie.TUTORIAL_STONECUTTERY_PLACE_PROP_MSG_NOTE)},{context:"gameplay",conditions:["have_mats_stonecutter"],title:ie.TUTORIAL_STONECUTTERY_BUILD_TITLE,msg:At,msg_touch:It},{context:"gameplay",title:ie.TUTORIAL_STONECUTTERY_MATERIALS_TITLE,msg:wt}],todo:{inv:{type:w,id:S},context:q},done:function done(){return checkHook("build_prop_"+S)||checkHook("factory_"+S)}},{main:true,name:"tier2_tool_head",title:ie.TUTORIAL_STONETOOLHEAD_CRAFT_TITLE,prompts:[{context:"gameplay",conditions:["have_mats_stone_tool_head"],title:ie.TUTORIAL_STONETOOLHEAD_CRAFT_TITLE,msg:ie.separate("\n\n  ",ie.TUTORIAL_STONETOOLHEAD_CRAFT_MSG,ie.TUTORIAL_STONETOOLHEAD_CRAFT_MSG_NOTE),draw:function draw(){return drawPropWorldIndicator(S)}},{context:"gameplay",title:ie.TUTORIAL_STONETOOLHEAD_MATERIALS_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_1,ie.TUTORIAL_STONETOOLHEAD_MATERIALS_MSG_2)}],todo:{inv:{type:M,id:-1,attr1:"stone_tool_head"},context:X},done:function done(){return checkHook("crafting_"+w+"_"+I)||j($({type:w,id:I,attr1:P.STONE}))}},{main:true,name:"tier2_turn_in",prompts:[{context:"gameplay",conditions:["have_mats_tier2"],title:ie.TUTORIAL_UPGRADE_SETTLEMENT_TITLE,msg:ie.TUTORIAL_UPGRADE_SETTLEMENT_SECOND_MSG,draw:drawSettlementWorldIndicator},{context:"gameplay",title:ie.TUTORIAL_UPGRADE_SETTLEMENT_TITLE,msg:ie.TUTORIAL_UPGRADE_SETTLEMENT_SECOND_MSG}],todo:{inv:{type:D,id:-1,attr1:"tier2"},context:Q},done:function done(){var e
return(null==(e=Ae())?void 0:e.tier)>=2}},{main:true,name:"tier3_woodcutter",title:ie.TUTORIAL_WOODCUTTERY_BUILD_TITLE,prompts:[{context:"gameplay",conditions:["in_qbar_sawmill","have_mats_stonecutter"],title:ie.TUTORIAL_WOODCUTTERY_BUILD_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_KEYBOARD,ie.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE),msg_touch:ie.separate("\n\n",ie.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_GENERIC,ie.TUTORIAL_WOODCUTTERY_PLACE_PROP_MSG_NOTE)},{context:"gameplay",conditions:["have_mats_sawmill"],title:ie.TUTORIAL_WOODCUTTERY_BUILD_TITLE,msg:Ot,msg_touch:Lt},{context:"gameplay",title:ie.TUTORIAL_WOODCUTTERY_MATERIALS_TITLE,msg:Rt}],todo:{inv:{type:w,id:y},context:q},done:function done(){return checkHook("build_prop_"+y)||checkHook("factory_"+y)}},{main:true,name:"tier3_pickax",title:ie.TUTORIAL_PICKAX_CRAFT_TITLE,prompts:[{context:"gameplay",conditions:["have_mats_pickax"],title:ie.TUTORIAL_PICKAX_CRAFT_TITLE,msg:ie.separate("",ie.TUTORIAL_PICKAX_CRAFT_MSG,"\n\n",ie.TUTORIAL_PICKAX_CRAFT_MSG_HINT),draw:function draw(){return drawPropWorldIndicator(A)}},{context:"gameplay",title:ie.TUTORIAL_PICKAX_MATERIALS_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_PICKAX_MATERIALS_MSG_1,ie.TUTORIAL_PICKAX_MATERIALS_MSG_2,ie.TUTORIAL_PICKAX_MATERIALS_MSG_HINT)}],todo:{inv:{type:M,id:-1,attr1:"pickax"},context:X},done:function done(){return checkHook("crafting_"+w+"_"+T)||Y.contents[0]}},{main:true,name:"final",prompts:[{context:"gameplay",title:ie.TUTORIAL_COMPLETE_TITLE,msg:ie.separate("\n\n",ie.TUTORIAL_COMPLETE_MSG,ie.TUTORIAL_COMPLETE_MSG_NEXT_STEPS)}],dismiss:true,auto_dismiss:30},{main:true,name:"finished",prompts:[]}]
var Dt=o(null,{color:255,outline_width:1,outline_color:3149642751})
function tutorialSet(e,t){xt=false
Qe={}
Nt=e
if(t){var r=Mt[e]
ke("tut",r&&r.name||void 0)}}function tutorialReset(e){tutorialSet(0,e)}function isTutorialState(e){for(var t=0;t<Mt.length;++t){var r=Mt[t]
if(r&&r.name===e)return true}return false}function tutorialStartByName(e,t,r){if(!e){tutorialReset(t)
return}for(var a=0;a<Mt.length;++a){var i=Mt[a]
if(i&&i.name===e){if(Nt&&i.no_interrupt&&!r)return
tutorialSet(a,t)
Ct=0
return}}if(s("none"===e,"Tried to start unknown tutorial "+e))tutorialReset()}function tutorialState(){return Mt[Nt]}var Pt
var Bt=50
var kt=40
function tutorialStartup(){Pt=b.font
ct=ye();(vt=new W(Bt)).setRange(kt)}var Ut={tier1_turn_in:"tier1",tier2_cord2:"tier2_cord",tier2_cord3:"tier2_cord",tier2_tool_head2:"tier2_tool_head",tier3_pickax2:"tier3_pickax",tier3_pickax3:"tier3_pickax"}
function tutorialInit(e,t){if(!e&&Ve()){var r=t||"default"
if("default"===r)we(r,function(e){if(!(e.tier>1))tutorialStartByName("adventure_start")})}if(e)tutorialStartByName(Ut[e]||e)}function promptIsInMenu(e){return Boolean(e.context&&et[e.context])}function advanceState(e){var t=Mt[Nt]
a(e||t)
if(t)if(void 0!==t.next)tutorialStartByName(t.next||void 0,t.main)
else{Ct=0
tutorialSet(Nt+1,t.main)}}function regressState(e){var t=Mt[Nt]
a(e||t)
if(t){Ct=0
tutorialSet(Nt-1,t.main)}}var Gt=x()
var Ft
function tutorialUnderRibbonY1(){return Ft}var Wt=false
function tutorialLeaveWorld(){if(Wt){Wt=false
b.modalDialogClear()}}var Ht=x()
function getTutRealPos(e){var t
if(isSpotPos(e)){var r=e.spot_key,a=e.anchor,i=e.offset
a=a||m
var o=d(r,true)
if(o){var n=o.dom_pos,s=o.w,l=o.h
Ht[0]=n.x
Ht[1]=n.y
L.domToVirtual(Ht,Ht)
Ht[0]+=s*a[0]
Ht[1]+=l*a[1]
t=i}else return null}else{var _=e.pos_hook_key,c=e.offset
var u=rt[_]
if(u){v(Ht,u)
t=c}else return null}if(t)f(Ht,Ht,t)
return Ht}function drawUIIndicator(e){var t=getTutRealPos(e)
if(t){var r=e.dir
var a=0
var i=0
var o=0
var n=0
switch(r){case at.LEFT:o=a=1
break
case at.UP:n=a=i=1
break
case at.RIGHT:o=-(i=1)
break
default:at.DOWN
n=-1}var s=30*Ke(qe(.005*O.getFrameTimestamp()))
De.sprite.draw({x:t[0]+a*Ze+o*s,y:t[1]+i*Ze+n*s,z:Z.TUT_INDICATOR,rot:r,w:Ze,h:Ze,color:Xe,frame:De.ARROW})}}function calculateTutorialUnderRibbonPos(e){Gt[0]=Ee()
if(!ae())Gt[0]-=(xt?N():e)+ee
Gt[1]=ge()+me}var zt=false
function tutorialForcingMenu(){return zt}var Vt=false
function tutorialTickEnd(){$e={}
rt={}
if(Vt){te()
Vt=false}}function tutorialTickEndEarly(){calculateTutorialUnderRibbonPos(0)
Ft=ge()
tutorialTickEnd()}var Yt=450
var jt=24
var Kt=16
var qt=0
var Zt=50
var Xt=x()
function tutorialTick(){zt=false
var e=Mt[Nt]
if(!e||!e.show_as_visitor&&Ue()){tutorialTickEndEarly()
return}var t=false
while(true){var r=e.todo
if(r&&!de())Me(r.inv,r.context,Ce)
if(e.done&&e.done()){if(r)xe(r.inv,r.context)
if(!t){t=true
if(e.title){Re.push(ie.separateColon(ie.LBL_COMPLETED,e.title))
Ye("tutorial_step_complete")}}advanceState()
if(!(e=Mt[Nt])){tutorialTickEndEarly()
return}}else break}var a
var i
for(var o=0;o<e.prompts.length;++o){a=e.prompts[o]
if(Je[a.context]()){var n=false
if(a.conditions)for(var s=0;s<a.conditions.length;++s)if(!tt[a.conditions[s]]())n=true
if(!n){i=R.touch_mode&&a.msg_touch||a.msg
if(promptIsInMenu(a))if(t)i=void 0
else zt=a.force_menu||false
break}}}if(!a){tutorialTickEndEarly()
return}var l=a.w||Yt
var _=l-2*Kt
var c=(l-50)/2
var u=x()
calculateTutorialUnderRibbonPos(l)
var d=a.pos||{pos_hook_key:"tut_under_ribbon"}
var f=Gt[0]
var v=Gt[1]
var h=ge()
var p=false
if(!xt){if(promptIsInMenu(a)){re()
Vt=true
he(et[a.context])}C(u,L.x0()+(L.w()-l)/2,L.y0())
tutorialPosHook("tut_top_center",u)
tutorialPosHook("tut_under_ribbon",Gt)
var m=getTutRealPos(d)
if(m&&i){f=m[0]
v=h=m[1]}else i=void 0}if(i){var E=Pt.numLines(Dt,_,qt,jt,i)*jt+1.5*jt+2*Kt+8
if(!xt&&a.draw)a.draw()
if(xt){h+=me
p=true
if(b.buttonImage({x:f,y:h,z:Z.MENUBUTTON,img:De.sprite,frame:De.QUESTION_MARK,tooltip:ie.TLTP_SHOW_TUTORIAL})){xt=false
if(promptIsInMenu(a)){Ft=h+N()
tutorialTickEnd()
return}}h+=N()}else{h+=Kt
var g=R.touch_mode&&a.title_touch||a.title||e.title||ie.TUTORIAL_HINT_TITLE
var T=ie.separate(" ","~",g,"~")
b.title_font.drawSizedAligned(be,f+Kt,h,Z.TUT,1.5*jt,Pt.ALIGN.HCENTERFIT,l-2*Kt,0,T)
h+=1.5*jt+8
h+=Pt.drawSizedWrapped(Dt,f+Kt,h,Z.TUT,_,qt,jt,i)
h+=8
if(e.dismiss){E+=Zt
var y=ie.BTN_DISMISS
var S=false
if(e.auto_dismiss){if(!Ct)Ct=1e3*e.auto_dismiss
else if((Ct-=O.frame_dt)<=0){Ct=0
S=true}y=ie.addParenthesesAfter(y,(Ct/1e3).toFixed(0))}if(b.buttonText({x:f+l-c-Kt,y:h,z:Z.TUT,w:c,h:Zt,text:y})||S)advanceState()}else if(e.main&&!e.unskippable){E+=Zt
if(b.buttonText({x:f+Kt,y:h,z:Z.TUT,w:c,h:Zt,text:ie.BTN_HIDE}))xt=true
if(b.buttonText({x:f+c+2*Kt,y:h,z:Z.TUT,w:c,h:Zt,text:a.skip_freely?ie.BTN_SKIP:ie.addEllipsis(ie.BTN_SKIP)}))if(a.skip_freely)advanceState()
else{Wt=true
b.modalDialog({title:ie.DLG_SKIP_TUTORIAL_TITLE,text:ie.DLG_SKIP_TUTORIAL_MSG_ALREADY_KNOW+"\n\n"+ie.DLG_SKIP_TUTORIAL_MSG_OPTIONS,buttons:{skip_step:{label:ie.BTN_SKIP_STEP,cb:function cb(){Wt=false
advanceState()},in_event_cb:!R.touch_mode?R.pointerLockEnter:null},skip_all:{label:ie.BTN_SKIP_ALL,cb:function cb(){Wt=false
tutorialStartByName("finished",true)
k("tutorial_skip_all",Number(Nt))},in_event_cb:!R.touch_mode?R.pointerLockEnter:null},cancel:{cb:function cb(){Wt=false},in_event_cb:!R.touch_mode?R.pointerLockEnter:null}}})}}if(e.action&&e.action_text)if(b.buttonText({x:f+l-2*c-2*Kt,y:h,z:Z.TUT,w:c,h:Zt,text:e.action_text})){e.action()
Nt=0}b.panel({x:f,y:v,z:Z.TUT-1,w:l,h:E,pixel_scale:.5*b.panel_pixel_scale})
h=v+E}tutorialPosHook("tut_window_left",C(Xt,f-Ze,0))
var I=a.indicators
if(I&&!xt)for(var A=0;A<I.length;++A)drawUIIndicator(I[A])}var w="tut_under_ribbon"===d.pos_hook_key||p
Ft=w?h:ge()
tutorialTickEnd()}i.register({cmd:"tut",access_show:["sysadmin"],help:"(Hidden) Get/set current tutorial stage",usage:"  Get tutorial stage: /tut\n  Set tutorial stage: /tut [<STAGE_NAME>|PREVIOUS|NEXT|RESET]",prefix_usage_with_help:true,func:function func(e,t){if(e){var r=e.toLowerCase()
if("previous"===r)regressState(true)
else if("next"===r)advanceState(true)
else if("reset"===r)tutorialStartByName("adventure_start",true)
else if(isTutorialState(e))tutorialStartByName(e,true,true)
else return void t("Invalid Tutorial State.")}t(null,"Tutorial state = "+JSON.stringify(Be("tut")))}})},{"../common/ids":249,"../common/materials_common":253,"../common/world_trans":268,"../glov/client/camera2d":295,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/spot":361,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./analytics":6,"./build_menu":32,"./chunk_searcher":42,"./debug":73,"./fbinstant_worlds":96,"./inventory":114,"./items":119,"./layout":120,"./localization/localization":131,"./main":135,"./menu":140,"./menu_ribbon":141,"./photo_mode":158,"./props":171,"./quickbar":172,"./settlement":181,"./settlement_edit":182,"./status":193,"./styles":197,"./todo_list":202,"./ui_util":205,"./user_data":208,"./voxel_data":216,"./waygate_ui":222,"./world_comm":226,"./world_metadata":235,"./worlds_sound":236,assert:void 0}],204:[function(e,t,r){"use strict"
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a={block_break_dirt:[{file:"blocks/block_dirt_destroy1",volume:1},{file:"blocks/block_dirt_destroy2",volume:1},{file:"blocks/block_dirt_destroy3",volume:1},{file:"blocks/block_dirt_destroy4",volume:1}],block_place_dirt:["blocks/block_dirt_place1","blocks/block_dirt_place2","blocks/block_dirt_place3","blocks/block_dirt_place4"],block_break_stone:["blocks/block_stone_destroy1","blocks/block_stone_destroy2","blocks/block_stone_destroy3","blocks/block_stone_destroy4"],block_place_stone:["blocks/block_stone_place1","blocks/block_stone_place2","blocks/block_stone_place3","blocks/block_stone_place4"],block_break_wood:["blocks/block_wood_destroy1","blocks/block_wood_destroy2","blocks/block_wood_destroy3","blocks/block_wood_destroy4"],block_place_wood:["blocks/block_wood_place1","blocks/block_wood_place2","blocks/block_wood_place3","blocks/block_wood_place4"],block_break_metal:["blocks/block_metal_destroy1","blocks/block_metal_destroy2","blocks/block_metal_destroy3","blocks/block_metal_destroy4"],block_place_metal:["blocks/block_metal_place1","blocks/block_metal_place2","blocks/block_metal_place3","blocks/block_metal_place4"],block_break_coal:["blocks/block_coal_destroy1","blocks/block_coal_destroy2","blocks/block_coal_destroy3","blocks/block_coal_destroy4"],block_place_coal:["blocks/block_coal_place1","blocks/block_coal_place2","blocks/block_coal_place3","blocks/block_coal_place4"],character_enter_water:["character/footstep_enter_water1","character/footstep_enter_water2"],character_enter_flying:{file:"character/character_enter_flying",volume:.7},character_exit_flying:{file:"character/character_exit_flying",volume:.7},jump:["character/jump1","character/jump2","character/jump3"],land_dirt:["character/land_dirt1","character/land_dirt2","character/land_dirt3"],land_wood:["character/land_wood1","character/land_wood2","character/land_wood3"],land_stone:["character/land_stone1","character/land_stone2","character/land_stone3"],land_metal:["character/land_metal1","character/land_metal2","character/land_metal3"],fall_damage:["character/fall_damage1","character/fall_damage2"],underwater_breathe_air:["character/underwater_breathe_air1","character/underwater_breathe_air2","character/underwater_breathe_air3"],pickup:["items/pickup1","items/pickup2","items/pickup3"],pickup_gem:["items/pickup_crystal1","items/pickup_crystal2"],plant_harvest:["items/harvest_plant1","items/harvest_plant2","items/harvest_plant3","items/harvest_plant4"],bucket_fill:["items/bucket_fill1","items/bucket_fill2"],bucket_place_liquid:["items/bucket_place_liquid1","items/bucket_place_liquid2"],bucket_water_crops:["items/bucket_water_crops1","items/bucket_water_crops2"],chest_open:"props/chest_open",door_open:["props/door_open1","props/door_open2"],door_close:["props/door_close1","props/door_close2"],waygate_upgrade:"fanfares/fanfare_waygate_upgrade",cactus_damage:["props/cactus_damage1","props/cactus_damage2","props/cactus_damage3"],energy_well_drink:"props/energy_well_drink",race_start:"props/race_start",race_end:"props/race_end",factory_open:"props/factory_open",button_click:{file:"ui/ui_button",volume:1},rollover:"ui/ui_rollover",msg_err:"ui/msg_err",msg_in:"ui/msg_in",msg_out:"ui/msg_out",msg_out_err:"ui/msg_out_err",user_join:"ui/user_join",user_leave:"ui/user_leave",purchase:["items/pickup_crystal1","items/pickup_crystal2"],silence:"silence"}
var i={tool_break:"legacy/ui/msg_out_err",item_unlock:"items/pickup_crystal2",land_coal:a.land_stone,prop_place_wood:a.block_place_wood,prop_place_stone:a.block_place_stone,prop_place_dirt:a.block_place_dirt,prop_place_metal:a.block_place_metal,prop_place_coal:a.block_place_coal,hoe:a.block_place_dirt,crop_harvest:a.block_break_dirt,race_ready:a.block_place_stone,plant_harvest_empty:a.plant_harvest,tutorial_step_complete:a.pickup_gem,spike_damage:a.block_break_dirt,prop_forced_grow:a.block_place_dirt}
o=o||{}
var o=_extends({},a,i)
t.exports=o},{}],205:[function(e,t,r){"use strict"
r.getUIUtilSprite=getUIUtilSprite
r.getUIUtilSpriteCentered=getUIUtilSpriteCentered
r.uiUtilStartup=uiUtilStartup
r.CHECK_SYMBOL=r.COPY_SYMBOL=r.STAMINA_SYMBOL=r.INFINITY_SYMBOL=r.ORB_SYMBOL=r.GEM_SYMBOL=r.BLANK=r.FILTER=r.TROPHY=r.LIKE_ACTIVE=r.LIKE=r.GEMS=r.USER_PROFILE=r.SOCIAL=r.SORT=r.EDIT=r.WORLD_INFO=r.PLAYER=r.BLUEBOX_EDIT=r.BLUEBOX_PRE_EDIT=r.BLUEBOX_PRE_BUILD=r.BLUEBOX_BUILD=r.HOME=r.BUILD=r.ARROW=r.CHECK=r.GATHERING_TOOLS=r.EMPTY_BLUEPRINT=r.SEARCH=r.BLUEPRINTS=r.ORBS=r.ICON_AREABUILD=r.TIME=r.ENERGY_WELL=r.ICON_BUILD=r.VIEWS=r.WAYGATE=r.ADVENTURE_MODE=r.VIDEO_AD=r.SPRINT=r.TAB_FLORA=r.PIN=r.PINNED=r.TAB_TOOLS=r.CONTEST=r.TELEPORT=r.RESIZE=r.LOCK=r.QUESTION_MARK=r.HANDS=r.BROKEN=r.SETTLEMENT_PROPS=r.TRASH=r.PROPS=r.CRAFTED_BLOCKS=r.RAW_BLOCKS=r.SETTINGS=r.OUTPUT=r.INPUT=r.SLOT_SHOVEL=r.SLOT_HATCHET=r.SLOT_PICKAX=r.CONTAINER=r.CRAFTING=r.INVENTORY=r.X=r.MENU=r.SHARE=r.CROSSHAIR=r.sprite_centered=r.sprite=void 0
var a=e("../glov/client/sprites").spriteCreate
var i
r.sprite=i
var o
r.sprite_centered=o
function getUIUtilSprite(){return i}function getUIUtilSpriteCentered(){return o}function uiUtilStartup(){r.sprite=i=a({url:"img/ui_util.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
r.sprite_centered=o=a({url:"img/ui_util.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],origin:[.5,.5],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}var n=0
r.CROSSHAIR=n
var s=2
r.SHARE=s
var l=3
r.MENU=l
var _=4
r.X=_
var c=5
r.INVENTORY=c
var u=6
r.CRAFTING=u
var d=7
r.CONTAINER=d
var f=8
r.SLOT_PICKAX=f
var v=9
r.SLOT_HATCHET=v
var h=10
r.SLOT_SHOVEL=h
var p=11
r.INPUT=p
var m=12
r.OUTPUT=m
var E=13
r.SETTINGS=E
var g=14
r.RAW_BLOCKS=g
var T=15
r.CRAFTED_BLOCKS=T
var y=16
r.PROPS=y
var S=17
r.TRASH=S
var I=18
r.SETTLEMENT_PROPS=I
var A=19
r.BROKEN=A
var w=20
r.HANDS=w
var L=21
r.QUESTION_MARK=L
var O=22
r.LOCK=O
var R=23
r.RESIZE=R
var b=24
r.TELEPORT=b
var N=25
r.CONTEST=N
var C=26
r.TAB_TOOLS=C
var x=27
r.PINNED=x
var M=28
r.PIN=M
var D=29
r.TAB_FLORA=D
var P=30
r.SPRINT=P
var B=31
r.VIDEO_AD=B
var k=32
r.ADVENTURE_MODE=k
var U=33
r.WAYGATE=U
var G=34
r.VIEWS=G
var F=35
r.ICON_BUILD=F
var W=36
r.ENERGY_WELL=W
var H=37
r.TIME=H
var z=38
r.ICON_AREABUILD=z
var V=39
r.ORBS=V
var Y=40
r.BLUEPRINTS=Y
var j=41
r.SEARCH=j
var K=42
r.EMPTY_BLUEPRINT=K
var q=43
r.GATHERING_TOOLS=q
var Z=44
r.CHECK=Z
var X=45
r.ARROW=X
var Q=46
r.BUILD=Q
var $=47
r.HOME=$
var J=48
r.BLUEBOX_BUILD=J
var ee=49
r.BLUEBOX_PRE_BUILD=ee
var te=50
r.BLUEBOX_PRE_EDIT=te
var re=51
r.BLUEBOX_EDIT=re
var ae=52
r.PLAYER=ae
var ie=53
r.WORLD_INFO=ie
var oe=54
r.EDIT=oe
var ne=55
r.SORT=ne
var se=56
r.SOCIAL=se
var le=57
r.USER_PROFILE=le
var _e=58
r.GEMS=_e
var ce=59
r.LIKE=ce
var ue=60
r.LIKE_ACTIVE=ue
var de=61
r.TROPHY=de
var fe=62
r.FILTER=fe
var ve=63
r.BLANK=ve
var he="♦"
r.GEM_SYMBOL=he
var pe="⚈"
r.ORB_SYMBOL=pe
var me="∞"
r.INFINITY_SYMBOL=me
var Ee="⚡"
r.STAMINA_SYMBOL=Ee
var ge="⧉"
r.COPY_SYMBOL=ge
var Te="✓"
r.CHECK_SYMBOL=Te},{"../glov/client/sprites":363}],206:[function(e,t,r){"use strict"
r.getUIUtil2Sprite=getUIUtil2Sprite
r.getUIUtil2SpriteCentered=getUIUtil2SpriteCentered
r.uiUtil2Startup=uiUtil2Startup
r.BOOSTER6=r.BOOSTER5=r.BOOSTER4=r.BOOSTER3=r.BOOSTER2=r.BOOSTER1=r.BOOSTER0=r.BOOST3=r.BOOST2=r.BOOST1=r.BOOST0=r.BOOST_TOKEN=r.CUSTOMIZATION_CLEAR=r.CALENDAR=r.WORLD=r.BTNICON_PHOTO=r.BTNICON_EMAIL=r.BTNICON_BLOCK=r.BTNICON_REMOVE=r.BTNICON_ADD=r.BTNICON_UPDATES=r.BTNICON_BUGS=r.BTNICON_EXIT=r.BTNICON_OUTFIT=r.BTNICON_PLAY=r.ICON_SOCIAL_INVISIBLE=r.ICON_SOCIAL_AFK=r.ICON_SOCIAL_ONLINE=r.SPINNER=r.EXCLAMATION=r.EYES=r.HAIR=r.SKIN=r.PAINT=r.LEGS=r.ARMS=r.TORSO=r.HEAD=r.COSTUME=r.CUSTOMIZE=r.sprite_centered=r.sprite=void 0
var a=e("../glov/client/sprites").spriteCreate
var i
r.sprite=i
var o
r.sprite_centered=o
function getUIUtil2Sprite(){return i}function getUIUtil2SpriteCentered(){return o}function uiUtil2Startup(){r.sprite=i=a({url:"img/ui_util_2.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})
r.sprite_centered=o=a({url:"img/ui_util_2.png",ws:[1,1,1,1,1,1,1,1],hs:[1,1,1,1,1,1,1,1],origin:[.5,.5],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}var n=0
r.CUSTOMIZE=n
var s=1
r.COSTUME=s
var l=2
r.HEAD=l
var _=3
r.TORSO=_
var c=4
r.ARMS=c
var u=5
r.LEGS=u
var d=6
r.PAINT=d
var f=7
r.SKIN=f
var v=8
r.HAIR=v
var h=9
r.EYES=h
var p=10
r.EXCLAMATION=p
var m=11
r.SPINNER=m
var E=12
r.ICON_SOCIAL_ONLINE=E
var g=13
r.ICON_SOCIAL_AFK=g
var T=14
r.ICON_SOCIAL_INVISIBLE=T
var y=15
r.BTNICON_PLAY=y
var S=16
r.BTNICON_OUTFIT=S
var I=17
r.BTNICON_EXIT=I
var A=18
r.BTNICON_BUGS=A
var w=19
r.BTNICON_UPDATES=w
var L=20
r.BTNICON_ADD=L
var O=21
r.BTNICON_REMOVE=O
var R=22
r.BTNICON_BLOCK=R
var b=23
r.BTNICON_EMAIL=b
var N=24
r.BTNICON_PHOTO=N
var C=25
r.WORLD=C
var x=26
r.CALENDAR=x
var M=27
r.CUSTOMIZATION_CLEAR=M
var D=28
r.BOOST_TOKEN=D
var P=29
r.BOOST0=P
var B=30
r.BOOST1=B
var k=31
r.BOOST2=k
var U=32
r.BOOST3=U
var G=33
r.BOOSTER0=G
var F=34
r.BOOSTER1=F
var W=35
r.BOOSTER2=W
var H=36
r.BOOSTER3=H
var z=37
r.BOOSTER4=z
var V=38
r.BOOSTER5=V
var Y=39
r.BOOSTER6=Y},{"../glov/client/sprites":363}],207:[function(e,t,r){"use strict"
r.getUIUtilHiresSprite=getUIUtilHiresSprite
r.uiUtilHiresStartup=uiUtilHiresStartup
r.ORB_6=r.ORB_5=r.ORB_4=r.ORB_3=r.ORB_2=r.ORB_1=r.ORB_0=r.GEM_5=r.GEM_4=r.GEM_3=r.GEM_2=r.GEM_1=r.GEM_0=r.sprite=void 0
var a=e("../glov/client/sprites").spriteCreate
var i
r.sprite=i
function getUIUtilHiresSprite(){return i}function uiUtilHiresStartup(){r.sprite=i=a({url:"img/ui_util_hires.png",ws:[1,1,1,1],hs:[1,1,1,1],filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}var o=0
r.GEM_0=o
var n=1
r.GEM_1=n
var s=2
r.GEM_2=s
var l=3
r.GEM_3=l
var _=4
r.GEM_4=_
var c=5
r.GEM_5=c
var u=6
r.ORB_0=u
var d=7
r.ORB_1=d
var f=8
r.ORB_2=f
var v=9
r.ORB_3=v
var h=10
r.ORB_4=h
var p=11
r.ORB_5=p
var m=12
r.ORB_6=m},{"../glov/client/sprites":363}],208:[function(e,t,r){"use strict"
r.isPlayAsViewer=isPlayAsViewer
r.userDataStartWaiting=userDataStartWaiting
r.userDataIsWaiting=userDataIsWaiting
r.userDataGet=userDataGet
r.worldReadOnlyBypassPlayingAs=worldReadOnlyBypassPlayingAs
r.worldReadOnly=worldReadOnly
r.doOxygen=doOxygen
r.doFallDamage=doFallDamage
r.userAccessLevel=userAccessLevel
r.userBuildAccessWait=userBuildAccessWait
r.shouldHaveAvatar=shouldHaveAvatar
r.flyingAllowed=flyingAllowed
r.blueprintAllowed=blueprintAllowed
r.saplingsAllowed=saplingsAllowed
r.waygateEditAllowed=waygateEditAllowed
r.leapgateEditAllowed=leapgateEditAllowed
r.viewSettlementAllowed=viewSettlementAllowed
r.editOutsideVolumeAllowed=editOutsideVolumeAllowed
r.establishSettlementAllowed=establishSettlementAllowed
r.areaClearAllowed=areaClearAllowed
r.manageVolumesAllowed=manageVolumesAllowed
r.raceJoinAllowed=raceJoinAllowed
r.raceEditAllowed=raceEditAllowed
r.joinQueueAllowed=joinQueueAllowed
r.followUserAllowed=followUserAllowed
r.unlimitedItemsAllowed=unlimitedItemsAllowed
r.giveItemsAllowed=giveItemsAllowed
r.doWaygateSickness=doWaygateSickness
r.playAsViewerSet=playAsViewerSet
r.userDataSetEx=userDataSetEx
r.userDataSet=userDataSet
r.userDataPredict=userDataPredict
r.userDataGemsFound=userDataGemsFound
r.userDataGemBonusClaimed=userDataGemBonusClaimed
r.userDataLeaveWorld=userDataLeaveWorld
r.setAccessLevel=setAccessLevel
r.userAttribGet=userAttribGet
r.userAttribs=userAttribs
r.userAttribGetFixed=userAttribGetFixed
r.userAttribModBatched=userAttribModBatched
r.userDataSetOnNextAttribFlush=userDataSetOnNextAttribFlush
r.userAttribModTrans=userAttribModTrans
r.userAttribModMaxBatched=userAttribModMaxBatched
r.userAttribModMaxTrans=userAttribModMaxTrans
r.userAttribUndoTransactionOp=userAttribUndoTransactionOp
r.userStaminaMax=userStaminaMax
r.userStaminaCur=userStaminaCur
r.userStaminaMod=userStaminaMod
r.userO2Max=userO2Max
r.userO2Cur=userO2Cur
r.userAttribGetDigRate=userAttribGetDigRate
r.staminaUsageScale=staminaUsageScale
r.setStaminaUsageScaleMod=setStaminaUsageScaleMod
r.userAttribGetSprintingStaminaScale=userAttribGetSprintingStaminaScale
r.userAttribGetSpeedScale=userAttribGetSpeedScale
r.userAttribGetUnderwaterSpeedScale=userAttribGetUnderwaterSpeedScale
r.userAttribTick=userAttribTick
r.userLastEnergyWellTime=userLastEnergyWellTime
r.userLastWaygateTime=userLastWaygateTime
r.userHomeSettlementID=userHomeSettlementID
r.userDataInit=userDataInit
r.stamina_mods_table=r.BLOOD_MOON_MOD=r.MORALE_BOOST_MOD=r.STAMINA_BASE_MAX=void 0
var a=1e4
r.STAMINA_BASE_MAX=a
var i=0
r.MORALE_BOOST_MOD=i
var o=1
r.BLOOD_MOON_MOD=o
var n=[["Team Morale Bonus",.15,false],["Blessed By The Moon",.2,false]]
r.stamina_mods_table=n
r.isWaiting=userDataIsWaiting
r.get=userDataGet
r.set=userDataSet
var s=e("assert")
var c=e("../glov/client/engine")
var l=e("../glov/client/error_report").errorReportSetDynamicDetails
var u=e("../glov/client/net").netDisconnected
var _=e("../glov/common/dot-prop")
var d=_.dotPropGet
var f=_.dotPropSet
var v=e("../glov/common/util")
var h=v.clamp
var p=v.cloneShallow
var m=v.empty
var E=e("../common/roles_common").classifyRole
var g=e("../common/world_constants")
var T=g.ACCESS_READONLY
var y=g.ACCESS_SPECTATOR
var S=g.ATTRIB_FIXED_MAX
var I=g.THRESHOLD_ACCESS_AVATAR
var A=g.THRESHOLD_ACCESS_MANAGE_VOLUMES
var w=g.THRESHOLD_ACCESS_MODIFY
var L=g.WAYGATE_FLAG_SETTLEMENT
var O=e("./analytics").logEvent
var R=e("./build_mode").doStamina
var b=e("./crafting_mods")
var N=b.CMODS
var C=b.CMOD_TABLE
var x=e("./editvolume_client").updateEditVolumes
var M=e("./energy_well").energyWellFixupTimes
var D=e("./huds").showStaminaDamage
var P=e("./inventory").inventoryLoad
var B=e("./localization/localization").L
var k=e("./main")
var U=e("./main").getFrameTransaction
var G=e("./quickbar").quickbarLoad
var F=e("./red_dot").redDotWorldInit
var W=e("./status").statusPush
var H=e("./todo_list").todoListInit
var z=e("./tutorial").tutorialInit
var V=e("./voxel_chunk_manager").releaseClaimed
var Y=e("./world_comm")
var j=Y.getWorldID
var K=Y.worldGetClients
var q=Y.worldGetRoles
var Z=Y.worldRefreshUserData
var X=Y.worldSetUserData
var Q=e("./world_metadata")
var $=Q.adventureMode
var J=Q.unlimitedMode
var ee=Q.worldAccessAreaClear
var te=Q.worldAccessExvolume
var re=Q.worldAccessGiveItems
var ae=Q.worldAccessLeapgate
var ie=Q.worldAccessSaplings
var oe=Q.worldAccessSettlement
var ne=Q.worldAccessUnlimitedItems
var se=Q.worldFallDamage
var le=Q.worldHasGems
var _e=Q.worldMetadata
var ce=Q.worldMetadataFreePos
var ue=Q.worldMetadataWaygate
var de=Q.worldOxygen
var fe=Q.worldSettlements
var ve=Math.min,he=Math.round
var pe=true
var me
var Ee
var ge
var Te=false
var ye=false
var Se={pos:1,pos_adv:1,last_adv_pos:1,wg:1,home:1,quickbar:1,wg_time:1,well_time:1,reddot:1,tut:1,todo:1,race_data:1,inventory:1,equip:1,gems_claimed:1,gem_bonus:1,liked:1,used_free_settlement:1,inv_gen:1,admin_log_id:1}
var Ie=false
function isPlayAsViewer(){return Ie}function userDataStartWaiting(e){pe=true
Ee=me=null
Ie=false
s(!Te||e)}function userDataIsWaiting(){return pe}function userDataGet(e){s(!pe)
if(Se[e])return me[e]
else{var t=e.split(".")[0]
s(Se[t])
return d(me,e)}}function worldReadOnlyBypassPlayingAs(){return pe||!(me.build_access_level>=w)}function worldReadOnly(){return pe||!(me.build_access_level>=w)||Ie}function doOxygen(){return de()&&R()}function doFallDamage(){return se()&&R()}function userAccessLevel(){if(pe)return y
var e=me.build_access_level
if(Ie)e=ve(e,T)
return e}function userTrueAccessLevel(){if(pe)return y
var e=me.access_level
if(Ie)e=ve(e,T)
return e}function userBuildAccessWait(){if(pe)return-1
return me.build_access_wait}function shouldHaveAvatar(){return userAccessLevel()>=I}function flyingAllowed(){return pe||userAccessLevel()>=_e().access_fly}function blueprintAllowed(){return!pe&&userAccessLevel()>=_e().access_blueprint}function saplingsAllowed(){return!pe&&userAccessLevel()>=ie()}function waygateEditAllowed(){return!pe&&_e()&&userTrueAccessLevel()>=_e().access_waygate}function leapgateEditAllowed(){return!pe&&userTrueAccessLevel()>=ae()}function viewSettlementAllowed(){return!pe&&_e()&&fe()&&userTrueAccessLevel()>=w}function editOutsideVolumeAllowed(){return!pe&&userAccessLevel()>=te()}function establishSettlementAllowed(){return!pe&&fe()&&userAccessLevel()>=oe()}function areaClearAllowed(){return!pe&&J()&&userAccessLevel()>=ee()}function manageVolumesAllowed(){return!pe&&userAccessLevel()>=A&&editOutsideVolumeAllowed()}function raceJoinAllowed(){return!pe&&userAccessLevel()>=_e().access_race_join}function raceEditAllowed(){return!worldReadOnly()&&userAccessLevel()>=_e().access_race_edit}function joinQueueAllowed(){return!pe&&q().world_areabuilder}function followUserAllowed(){return ce()}function unlimitedItemsAllowed(){return!pe&&userAccessLevel()>=ne()}function giveItemsAllowed(){return!pe&&userAccessLevel()>=re()}function doWaygateSickness(){return R()&&!ce()}var Ae
function playAsViewerSet(e){s(Ie!==e)
if(Ie=e){V()
Ae=k.char_controller.getPosString()}else{s(Ae)
if(R())k.char_controller.updatePosFromString(Ae,false)}x()}var we=0
var Le=0
var Oe=1e3
function doFlush(){we=c.frame_timestamp
s(Te)
function finalCb(){--Le}for(var e in ge){Le++
X(e,me[e],finalCb)}ge={}
Te=false}var Re=false
function tick(){profilerStart("tick")
if(Le<0)Le=0
if(!Te||!k.omp)Re=false
else if(u()||pe||Le||c.frame_timestamp-we<Oe)setTimeout(tick,Oe/2)
else{doFlush()
Re=false}profilerStop("tick")}function startTick(){if(Re)return
Re=true
tick()}function userDataSetEx(e,t,r){s(!pe)
s(Se[e])
s(ye)
me[e]=me[e]||{}
me[e][t]=r
var a=JSON.stringify(me[e])
if(a===Ee[e])return
Ee[e]=a
ge[e]=true
Te=true
startTick()}function userDataSet(e,t){s(!pe)
s(Se[e])
s(ye)
var r=JSON.stringify(t)
if(r===Ee[e])return
me[e]=t
Ee[e]=r
ge[e]=true
Te=true
startTick()}function userDataPredict(e,t,r){s(!pe)
f(me,e,t)
if(Se[e]&&r)Ee[e]=JSON.stringify(t)}function userDataGemsFound(){return Object.keys(me.gems_claimed||{}).length}function userDataGemBonusClaimed(){return Boolean(me.gem_bonus)}function userDataLeaveWorld(){if(Te)if(u()){Te=false
ge={}}else doFlush()
ye=false}function setAccessLevel(e,t,r){if(!me)return
me.access_level=e
me.build_access_level=t
me.build_access_wait=r
x()}var be
var Ne
function userAttribGet(e){return be[e]||0}function userAttribs(){return be}function userAttribGetFixed(e){return userAttribGet(e)/S}function userAttribGetTimedMod(e){var t=1
for(var r in be)if(r.startsWith(N.TIMED))if(r.split("_")[1]===e)t+=C[r]-1
return t}var Ce
function userStaminaInit(){Ce=he(a*userAttribGetTimedMod(N.STAMINA_CAPACITY))}function userAttribModBatched(e,t){be[e]=(be[e]||0)+t
if(!be[e])delete be[e]
Ne[e]=(Ne[e]||0)+t
if(!Ne[e])delete Ne[e]
if("stamina"===e||e.startsWith("t_stamcap"))userStaminaInit()}var xe
function userDataSetOnNextAttribFlush(e,t){s(Se[e])
if(!xe)xe={}
userDataPredict(e,t,false)
xe[e]=t}function handleUserAttribTransComplete(e){if(e)Z()}var Me=0
function flushBatched(e,t){var r=false
for(var a in Ne){var i=Ne[a]
s(i)
if(!t)t=e.transPre()
t.opUserAttrib(a,i)
r=true}if(r)Ne={}
if(xe){for(var o in xe)userDataSet(o,xe[o])
xe=null}Me=c.frame_timestamp
if(t)t.onComplete(handleUserAttribTransComplete)}function userAttribModTrans(e,t,r){flushBatched(e.tset)
s(r)
var a=(be[t]||0)+r
s(a>=0)
if(a)be[t]=a
else delete be[t]
e.opUserAttrib(t,r)
e.onComplete(handleUserAttribTransComplete)}function userAttribModMaxBatched(e,t){var r=be[e]||0
if(t>r)userAttribModBatched(e,t-r)}function userAttribModMaxTrans(e,t,r){var a=be[t]||0
if(r>a)userAttribModTrans(e,t,r-a)}function userAttribUndoTransactionOp(e){be[e.attrib]=(be[e.attrib]||0)-e.delta
if(!be[e.attrib])delete be[e.attrib]}function userStaminaMax(){return Ce}function userStaminaCur(){return he(userAttribGetFixed("stamina")*a)}function staminaToAttrib(e){return he(e/a*S)}function userStaminaMod(e,t){var r=userAttribGet("stamina")
var a=staminaToAttrib(h(userStaminaCur()+t,0,Ce))
if(a===r)return
var i=a-r
if(e)userAttribModTrans(e,"stamina",i)
else userAttribModBatched("stamina",i)}function userO2Max(){return 100}function userO2Cur(){return(1-userAttribGetFixed("o2"))*userO2Max()}function userAttribGetDigRate(){return worldReadOnly()?1:userAttribGetTimedMod(N.DIG_RATE)}function staminaUsageScale(){var e=1
if(worldReadOnly())return 1
for(var t=0;t<n.length;t++){var r=n[t]
if(r[2])e-=r[1]}return e}function setStaminaUsageScaleMod(e,t){n[e][2]=t}function userAttribGetSprintingStaminaScale(){if(worldReadOnly())return 1
return 1/userAttribGetTimedMod(N.SPRINTING_STAMINA)*staminaUsageScale()}function userAttribGetO2UsageScale(){if(worldReadOnly())return 1
return 1/userAttribGetTimedMod(N.O2_CAPACITY)}function userAttribGetSpeedScale(){if(worldReadOnly())return 1
return userAttribGetTimedMod(N.SPEED)}function userAttribGetUnderwaterSpeedScale(){if(worldReadOnly())return 1
return userAttribGetTimedMod(N.UNDERWATER_SPEED)}var De=1e3
var Pe=1/(1e3*20)
var Be=-1/(1e3*5)
var ke=100
function userAttribTick(e){var t=0
if(doOxygen()){var r=userAttribGet("o2")
t=r/S
var a=e?Pe*userAttribGetO2UsageScale():Be
t=h(t+c.frame_dt*a,0,1)
var i=he(t*S)
if(i!==r)userAttribModBatched("o2",i-r)}if((De-=c.frame_dt)>0||u()||worldReadOnly())return
if((De+=1e3)<0)De=0
if(R()){var o=userStaminaCur()-userStaminaMax()
if(o>0)userStaminaMod(null,-o)}if(t>=1&&doOxygen()){var n=he(ke*staminaUsageScale())
userStaminaMod(null,-n)
D(n,"drowning")}for(var s in be)if(s.startsWith(N.TIMED)){var l=C[s]
if(!l){W(B.$(B.STATUSMSG_UNKNOWN_USERATTRIB,"user_attrib",s))
userAttribModBatched(s,-be[s])
continue}var _=1
if(be[s]<0)_=be[s]
userAttribModBatched(s,-_)
if(s.split("_")[1]===N.STAMINA)userStaminaMod(null,l*_)}if(m(Ne))Me=c.frame_timestamp
else if(c.frame_timestamp-Me>1e4)flushBatched(null,U())}function userLastEnergyWellTime(){return me.well_time||0}function userLastWaygateTime(){return me.wg_time||0}function userHomeSettlementID(){var e=me.home||"default"
var t=ue(e)
if(!t||!(t.flags&L))e="default"
return e}function logGamePlayStart(){var e={}
var t=j()
e.gems=le()
e.players=Object.keys(K()).length
e.role=E(q(),false)
e.world_mode="un"
if($())e.world_mode="lf"
e.access_level=me.access_level
O("game_play_start",1,null,String(t),e)}var Ue=false
function userDataStartup(){Ue=true
l("user_data",function(){var e=p(me)
delete e.inventory
delete e.equip
return JSON.stringify(e)})}function userDataInit(e){if(!Ue)userDataStartup()
s(pe)
s(e)
s(k.omp)
ye=true
be=(me=e).attribs=e.attribs||{}
userStaminaInit()
Ne={}
xe=null
Ee={}
ge={}
Te=false
Le=0
for(var t in me)Ee[t]=JSON.stringify(me[t])
if(!k.omp)me.access_level=Infinity
pe=false
F(e.reddot||{})
M()
z(e.tut)
H(e.todo)
P()
G()
logGamePlayStart()}},{"../common/roles_common":260,"../common/world_constants":267,"../glov/client/engine":305,"../glov/client/error_report":311,"../glov/client/net":338,"../glov/common/dot-prop":383,"../glov/common/util":400,"./analytics":6,"./build_mode":33,"./crafting_mods":67,"./editvolume_client":84,"./energy_well":85,"./huds":104,"./inventory":114,"./localization/localization":131,"./main":135,"./quickbar":172,"./red_dot":176,"./status":193,"./todo_list":202,"./tutorial":203,"./voxel_chunk_manager":214,"./world_comm":226,"./world_metadata":235,assert:void 0}],209:[function(e,t,r){"use strict"
r.isUserDetails=isUserDetails
r.isUserDetailsError=isUserDetailsError
r.userDetailsCacheClearForUser=userDetailsCacheClearForUser
r.userDetailsGetCached=userDetailsGetCached
r.userDetailsGet=userDetailsGet
r.userDetailsGetAsync=userDetailsGetAsync
var i=e("assert")
var a=e("glov-async").asyncLimiter
var o=e("../glov/client/net")
var n=o.netClient
var s=o.netDisconnected
var l=e("../glov/common/util").callEach
var _=e("./world_comm").whenConnected
var c=a(1)
function isUserDetails(e){return Boolean(e&&!e.err)}function isUserDetailsError(e){return!(e&&!e.err)}var u={}
var d=6e4
var f=0
function getUserDetailsCache(e){var t=u[e]
if(!t)t=u[e]={err:null,data:{},timestamp:0,fetching:false,cbs:null}
return t}function userDetailsCacheClearForUser(e){delete u[e]}function userDetailsGetCached(e){return getUserDetailsCache(e).data}function userDetailsGet(t,e,r){var a=getUserDetailsCache(t)
e=e||d
if(r){a.cbs=a.cbs||[]
a.cbs.push(r)}if(a.fetching||s()&&!a.cbs)return a.data
if(Date.now()-a.timestamp<e){if(a.cbs)l(a.cbs,a.cbs=null,a.err,a.data)
return a.data}if(f&&!a.cbs)return a.data
a.fetching=true;++f
c(function(r){function done(e,t){--f
a.fetching=false
a.err=e
a.data=e?{err:e}:t
a.timestamp=Date.now()
if(a.cbs)l(a.cbs,a.cbs=null,a.err,a.data)
r()}_(function(){var e=n().pak("user_get_details")
e.writeAnsiString(t)
e.send(function(e,t){done(e,t||null)
if(e||!t)return
i(isUserDetails(a.data))})})})
return a.data}function userDetailsGetAsync(e,t){userDetailsGet(e,-1,t)}},{"../glov/client/net":338,"../glov/common/util":400,"./world_comm":226,assert:void 0,"glov-async":void 0}],210:[function(e,t,r){"use strict"
r.presenceIsOffline=presenceIsOffline
r.formatPresence=formatPresence
r.userInfoGet=userInfoGet
r.rolesIsWorldsTeam=rolesIsWorldsTeam
r.userGetWorldAndPos=userGetWorldAndPos
r.userInfoViewClear=userInfoViewClear
r.userInfoViewing=userInfoViewing
r.viewUser=viewUser
r.doOnlineStatusDropdown=doOnlineStatusDropdown
r.onlineStatusDropdownVisible=onlineStatusDropdownVisible
r.drawIconOverlay=drawIconOverlay
r.headshotAngleForUser=headshotAngleForUser
r.worldsUserProfileImage=worldsUserProfileImage
r.userProfileButton=userProfileButton
r.userWorldLink=userWorldLink
r.userInfoViewTick=userInfoViewTick
r.USER_VIEW_H=r.USER_VIEW_W=void 0
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var be=600
r.USER_VIEW_W=be
var Ne=445
r.USER_VIEW_H=Ne
var Ce=200
var xe=e("assert")
var Me=e("../glov/client/camera2d")
var De=e("../glov/client/engine").getFrameIndex
var Pe=e("../glov/client/font").ALIGN
var i=e("../glov/client/input")
var Be=i.KEYS
var ke=i.inputClick
var Ue=i.inputDrag
var m=i.inputTouchMode
var Ge=i.keyDownEdge
var Fe=i.mouseDownAnywhere
var We=i.mouseDownOverBounds
var E=i.pointerLockEnter
var o=e("../glov/client/net")
var He=o.netDisconnected
var ze=o.netSubs
var g=o.netUserId
var n=e("../glov/client/selection_box")
var f=n.dropDown
var Ve=n.dropDownCreate
var s=e("../glov/client/social")
var l=s.SOCIAL_AFK
var _=s.SOCIAL_INVISIBLE
var c=s.SOCIAL_ONLINE
var Ye=s.friendIsBlocked
var u=s.getDefaultUserProfileImage
var je=s.getExternalFriendInfos
var Ke=s.isFriend
var v=s.socialPresenceStatusGet
var h=s.socialPresenceStatusSet
var d=e("../glov/client/ui")
var qe=d.button
var Ze=d.buttonImage
var Xe=d.buttonText
var Qe=d.drawLine
var $e=d.modalDialog
var Je=d.panel
var et=d.provideUserString
var tt=d.uiGetFont
var rt=d.uiGetTitleFont
var at=d.uiTextHeight
var it=e("../glov/client/urlhash").getLinkURL
var p=e("../glov/common/enums")
var T=p.PRESENCE_ACTIVE
var y=p.PRESENCE_INACTIVE
var S=e("../glov/common/rand_alea").mashString
var ot=e("../glov/common/util").nop
var I=e("../glov/common/vmath").vec2
var nt=e("../common/effective_access").EFFECTIVE_ACCESS_UNQUEUED
var st=e("../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_INSTANT
var lt=e("../common/world_constants").ACCESS_OWNER
var A=e("./access_control")
var _t=A.accessControlGetUser
var ct=A.accessControlGetUserContext
var ut=e("./analytics").logEvent
var w=e("./cosmetic_thumbnails").cosmeticGetImage
var L=e("./costume_edit").costumeFromUserChannel
var dt=e("./localization/localization").L
var ft=e("./main")
var O=e("./main_menu").socialPresenceIcon
var vt=e("./menu")
var R=e("./menu")
var ht=R.menuActive
var b=R.menuDoTransition
var pt=e("./platform_worlds_client").PLATFORM_DISCORD
var mt=e("./status").statusPush
var N=e("./styles")
var Et=N.color_black
var gt=N.color_line
var C=N.colors_user_selected
var Tt=N.floater_style_sysadmin_no_outline
var yt=N.label_style
var St=N.menu_header_style
var It=N.style_booster
var At=N.sublabel_style
var wt=e("./ui_util")
var Lt=e("./ui_util_2")
var x=e("./user_data").followUserAllowed
var Ot=e("./user_party").partyGetExternalDisplayName
var M=e("./user_profile_view")
var Rt=M.userProfileModfiyingUser
var bt=M.userProfileViewFriendAdd
var Nt=M.userProfileViewFriendBlock
var Ct=M.userProfileViewFriendRemove
var xt=M.userProfileViewFriendUnblock
var D=M.userProfileViewOpen
var P=e("./waygate_ui")
var Mt=P.calcWGLinkWidth
var B=P.waygateLinkUI
var Dt=P.waygateUIIsAccessControl
var k=e("./world_comm")
var Pt=k.getWorldID
var U=k.worldGetClients
var G=k.worldTargetGo
var Bt=e("./world_comm_effective_access").worldEffAccessGetSorted
var kt=e("./world_info").getWorldInfo
var F=e("./world_info_view")
var Ut=F.FLOATER_STYLE_ROLE_NO_OUTLINE
var Gt=F.access_items_admin
var Ft=F.access_items_owner
var Wt=F.access_labels
var Ht=F.access_labels_for_volumes
var zt=F.refreshUserAndAccessList
var Vt=F.refreshUserInfo
var Yt=F.volume_access_items_for_volume_admin
var jt=F.volume_access_items_for_volume_owner
var Kt=F.volume_access_items_for_world_admin
var qt=F.worldCmdParseGated
var Zt=F.worldInfoGetContext
var Xt=F.worldInfoGetUser
var Qt=F.worldInfoModifyingAccess
var W=e("./world_metadata")
var $t=W.adventureMode
var Jt=W.worldUserIsBoosting
var H=Math.floor,er=Math.max
var tr=null
function getWorldName(e){var t=e&&e.world_id
if(t){var r=kt(t,false)
if(!r||!r.user_access)return dt.LBL_UNKNOWN_WORLD_NAME
if(r&&r.name)return r.name}return dt.LBL_UNKNOWN_WORLD_NAME}function presenceIsOffline(e){if(!e||"offline"===e.state)return true
return false}function formatPresence(e){if(presenceIsOffline(e))return dt.PRESENCE_OFFLINE
var t
switch(e.state){case"loading":case"menus":t=dt.PRESENCE_IN_MENUS
break
case"view":t=dt.separateColon(dt.PRESENCE_VIEWING,getWorldName(e.payload))
break
case"build":t=dt.separateColon(dt.PRESENCE_BUILDING,getWorldName(e.payload))
break
case"explore":t=dt.separateColon(dt.PRESENCE_LOST_FRONTIER,getWorldName(e.payload))
break
default:t=dt.PRESENCE_UNKNOWN}if(e.active===y)t=dt.$(dt.PRESENCE_ALSO_IDLE,t)
return t}function getNewestPresenceData(e){if(!e)return null
var t=null
for(var r in e){var a=e[r]
if("offline"===a.state)continue
if(!t||a.active===T&&t.active!==T||a.active===t.active&&a.id>t.id)t=a}return t}function userInfoGet(e){if(e.startsWith("$"))return{user_id:e,display_name:e,presence_data:null}
var t=ze().getChannelImmediate("user."+e)
return{user_id:e,display_name:t.getChannelData("public.display_name",""),presence_data:getNewestPresenceData(t.presence_data)}}function rolesIsWorldsTeam(e){return Boolean(e&&(e.team||e.sysadmin||e.csr))}function userGetWorldAndPos(e,t,r){var a=ze().getChannelImmediate("user."+e).pak("worldpos_get")
a.writeAnsiString(t||"")
a.send(r)}var z
var V
function userInfoViewClear(){if(tr){V=tr.user_id
z=De()}tr=null}function userInfoViewing(e){return Boolean(tr&&tr.user_id===e)}function viewUser(e){var t=e.x,r=e.y,a=e.user_id
if(tr&&tr.user_id===a||z===De()&&V===a){tr=null
return}tr={pos:I(),orig_pos:t||r?I():null,user_id:a,frame:De()}
if(t||r)Me.virtualToCanvas(tr.orig_pos,[t,r])}function getUserClientIds(e){var t=U()
for(var r in t){var a=t[r].ids
if(a&&a.user_id===e)return a}return null}var Y=[{name:dt.SOCIAL_ONLINE,tag:"ONLINE",value:c},{name:dt.SOCIAL_AFK,tag:"AFK",value:l},{name:dt.SOCIAL_INVISIBLE,tag:"INVISIBLE",value:_}]
var j=((a={})[_]="INVISIBLE",a[l]="AFK",a[c]="ONLINE",a)
var K=-1
function doOnlineStatusDropdown(e){var t=e.x,r=e.y,a=e.z,i=e.w,o=e.font_height,n=e.entry_height,s=e.dropdown_w
var l=t+i/2
var _=n/2
tt().drawSizedAligned(yt,l-4-_,r,a,o,Pe.HRIGHT|Pe.VCENTER,0,n,dt.addColon(dt.LBL_SOCIAL_STATUS))
Lt.sprite.draw({x:l-_,y:r+(n-_)/2,w:_,h:_,z:a,frame:O()})
var c=v()
var u={suppress_return_during_dropdown:true}
var d=f({x:l+4,y:r,z:a,width:s||i/2-8,font_height:o,entry_height:n,items:Y},j[c],u)
if(d&&d.value!==c)h(d.value)
if(u.dropdown_visible)K=De()}function onlineStatusDropdownVisible(){return K===De()}var q=.35
function drawIconOverlay(e,t){if(!e.presence_data)return
var r
if(e.presence_data.active===y)r=Lt.ICON_SOCIAL_AFK
else if(e.presence_data.active===T)r=Lt.ICON_SOCIAL_ONLINE
else return
var a=t.x,i=t.y,o=t.w
var n=t.shrink||.75
if(1!==n){var s=.5*(1-n)*o
a+=s
i+=s
o*=n}var l=t.z||Z.UI
var _=.05*-o
var c=o*q
Lt.sprite.draw({x:a+o-_-c,y:i+o-_-c,w:c,h:c,z:l+1,frame:r})}var X=[.4,.45,.55,.6]
function headshotAngleForUser(e,t){var r=t.getChannelData("public.headshot_angle",-1)
if(-1!==r)return r/100
var a=2.3283064365386963e-10*S(e)
return X[H(a*X.length)]}function worldsUserProfileImage(e){if(Ye(e))return u()
var t="user."+e
var r=ze().getChannelImmediate(t)
var a=L(r)
if(!a)return u()
var i={dynamic_snapshot:false,headshot:true,headshot_angle:headshotAngleForUser(e,r)}
w(i,a,t)
if(i.img)return{img:i.img}
return u()}function userProfileButton(e){var t=e.user_id,r=e.show_online_status
var a=_extends({colors:userInfoViewing(t)?C:void 0,shrink:.85},e,worldsUserProfileImage(t))
var i=Ze(a)
if(r&&!Ye(t))drawIconOverlay(userInfoGet(t),a)
return i}function userWorldLink(e){var t
var r=e.user_id,a=e.presence_data,i=e.x,o=e.y,n=e.z,s=e.h,l=e.ctx
var _=r===g()
var c=null==a?void 0:null==(t=a.payload)?void 0:t.world_id
var u=c===Pt()
var d=!u&&c&&kt(c,false)
var f=c&&(u||d&&d.user_access)
var v=u&&x()||!u&&d&&d.unlimited
if(_)v=false
if(f){var h={wid:c,uid:r}
var p={x:i,y:o,z:n,h:s,target:h,ctx:l,url:"u/"+r+"/go",img_style:"thumb",overlay_mode:true,overlay_users:true,teleport_icon:v,in_event_cb:!m()?E:void 0,long_press:false}
if(B(p)){if(p.long_press){h.wgid="info"
delete h.uid}ft.menuExit()
userInfoViewClear()
if(_);else G(h)
return true}}return false}function userProfileViewOpenWithTransition(e,t){ut(t||"user_info_view_profile",1,"button")
b()
D(e)}var rr
var ar
var ir=8
var or=300
var nr=48
var sr=90
var lr=5
function userInfoViewTick(){var e
if(!tr)return
var t=tr,r=t.user_id,a=t.pos,i=t.orig_pos,o=t.frame
if(i)Me.canvasToVirtual(a,i)
else{a[0]=Me.x0()+(Me.w()-be)/2
a[1]=Me.y0()+(Me.h()-Ne)/2}if(a[0]+be>Me.x1())a[0]=Me.x1()-be
if(a[1]+Ne+Ce>Me.y1())a[1]=Me.y1()-Ne-Ce
if(a[0]<0)a[0]=0
if(a[1]<0)a[1]=0
var n=Z.USER_INFO_VIEW
var s=a[0]
var l=s+ir
var _=be-2*ir
var c=a[1]
var u=c+ir
var d=tt()
var f=rt()
var v=l+_/2
var h=Dt()
var p=userInfoGet(r)
var m=Ke(r)
var E=Ye(r)
var g=r===ze().loggedIn()
var T=p.display_name||r
var y=getUserClientIds(r)
var S=y&&y.roles
var I=rolesIsWorldsTeam(S)
var A=worldsUserProfileImage(r)
var w={x:l+lr,y:u,z:n,w:sr,h:sr,frame:A.frame,color:A.img_color,shrink:1}
A.img.draw(w)
drawIconOverlay(p,w)
var L=w.y+w.h+4
var O=l+sr+lr
var R=_-2*sr-2*lr
var b=at()
d.drawSizedAligned(St,O,u,n,1.5*b,Pe.HCENTERFIT,R,0,T)
u+=1.5*b
var N=.75*b
if(I){d.drawSizedAligned(Tt,O,u,n,N,Pe.HCENTERFIT,R,0,dt.USERINFO_WORLDSTEAM)
u+=N}var C=d.drawSizedAligned(At,O,u,n,N,Pe.HCENTERFIT,R,0,dt.separateColon(dt.LBL_USER_ID,r)+" "+wt.COPY_SYMBOL)
if(ke({x:O+(R-C)/2,y:u,w:C,h:N,button:0}))et('"'+T+'"',r)
u+=N
var x=null==(e=je(r))?void 0:e[st]
var M=null==x?void 0:x.name
if(M){d.drawSizedAligned(At,O,u,n,N,Pe.HCENTERFIT,R,0,dt.$(dt.USERINFO_MY_FRIEND_FB,M))
u+=N}else if(pt){var D=Ot(r)
if(D){d.drawSizedAligned(At,O,u,n,.75*b,Pe.HCENTERFIT,R,0,dt.USERINFO_MY_CHANNEL_MEMBER_DISCORD.$({name:D}))
u+=N}}var P=l+(_-or)/2
var B=false
if(!h&&!E){var k,U
var G=p.presence_data
var F=!g&&(null==G?void 0:null==(k=G.payload)?void 0:k.world_id)
var W=F===Pt()
if(F&&(W||(null==(U=kt(F,false))?void 0:U.user_access))){var H=Mt(nr)
var z=O+H+8
var V=R-H-8
if(userWorldLink({user_id:r,presence_data:G,x:z+V/2-d.drawSizedAligned(At,z,u,n,N,Pe.HCENTERFIT|Pe.VCENTER,V,nr,formatPresence(G))/2-H-8,y:u,z:n,h:nr,ctx:"user"+r}))B=true
u+=nr}else{d.drawSizedAligned(At,O,u,n,N,Pe.HCENTERFIT,R,0,formatPresence(G))
u+=N}}if(Jt(r)){d.drawSizedAligned(It,O,u,n,N,Pe.HCENTERFIT,R,0,dt.LBL_USER_IS_BOOSTER_THIS_WORLD)
u+=N}u+=8
function userContextButton(e,t){t=t||!ze().loggedIn()||He()
var r=Xe({x:P,y:u,z:n,w:or,h:nr,disabled:t,text:e})
u+=nr+8
return r}var Y=null
var j=null
var K
if(h){Y=ct()
K=_t(Y,r,T)}else{j=Zt(Pt())
K=Xt(j,r,T)}if(g&&!h){doOnlineStatusDropdown({x:l,y:u,z:n,w:_,font_height:b,entry_height:nr})
u+=nr+8}var q=onlineStatusDropdownVisible()?void 0:it("u/"+r)
if(g){if(qe({x:P,y:u,z:n,w:or,h:nr,text:g?dt.BTN_VIEW_EDIT_PROFILE:dt.BTN_VIEW_PROFILE,img:wt.sprite,img_color:Et,frame:wt.USER_PROFILE,url:q}))userProfileViewOpenWithTransition(r,"user_info_view_profile_self")}else{u=er(u,L)
var X=[{text:dt.BTN_VIEW_PROFILE_SHORT,tooltip:dt.BTN_VIEW_PROFILE,img:wt.sprite,img_color:Et,frame:wt.USER_PROFILE,fn:userProfileViewOpenWithTransition,url:q}]
if(m)X.push({text:dt.BTN_REMOVE_FRIEND_SHORT,tooltip:dt.BTN_REMOVE_FRIEND,img:Lt.sprite,img_color:Et,frame:Lt.BTNICON_REMOVE,fn:Ct})
else{X.push({text:dt.BTN_ADD_FRIEND_SHORT,tooltip:dt.BTN_ADD_FRIEND,img:Lt.sprite,img_color:Et,frame:Lt.BTNICON_ADD,fn:bt})
if(E)X.push({text:dt.BTN_UNBLOCK_USER_SHORT,tooltip:dt.BTN_UNBLOCK_USER,img:Lt.sprite,img_color:Et,frame:Lt.BTNICON_REMOVE,fn:xt})
else X.push({text:dt.BTN_BLOCK_USER_SHORT,tooltip:dt.BTN_BLOCK_USER,img:Lt.sprite,img_color:Et,frame:Lt.BTNICON_BLOCK,fn:Nt})}var Q=or/2
var $=8
var J=l+(_-(X.length*(Q+$)-$))/2
for(var ee=0;ee<X.length;++ee){var te=X[ee]
if(qe(_extends({x:J,y:u,z:n,w:Q,h:nr,disabled:Rt()},te)))te.fn(r)
J+=Q+$}}u+=nr+8
if(g&&!K.allow_actions)d.drawSizedAligned(At,v,u,n,b,Pe.HVCENTER,0,3*(c+Ne-u)/4,dt.USERINFO_THIS_ME)
else if(!h)if(E){d.drawSizedAligned(yt,v,u,n,b,Pe.HCENTER,0,0,dt.USERINFO_USER_BLOCKED)
u+=b+8}else if(m){d.drawSizedAligned(yt,v,u,n,b,Pe.HCENTER,0,0,dt.FRIENDLIST_USER_IS_ADDED)
u+=b+8}var re=De()!==o
var ae=false
if(Pt()&&!h&&(K.allow_actions||g)&&!K.loading){var ie=Bt()
if(ie.sorted_users.length>ie.threshold){var oe=ie.online[r]
if(oe&&(oe>0||oe===nt&&S&&S.world_areabuilder))ae=true}}var ne=(nr-b)/2
if(K.allow_actions){Qe(v-40,u+=8,v+40,u,n+.1,2,1,gt)
u+=12
var se
if(h)se=dt.LBL_AREA_ADMIN_ACTIONS
else{xe(j)
se=dt.separateColon(dt.LBL_ADMIN_ACTIONS,j.world_info.name)}f.drawSizedAligned(St,l,u,n,b,Pe.HCENTERFIT,_,0,se)
u+=b+12
var le=K,_e=le.access,ce=le.access_from_default
if(le.loading){d.drawSizedAligned(yt,v,u,n,b,Pe.HVCENTER,0,nr,dt.USERINFO_LOADING)
u+=nr}else{xe(_e)
d.drawSizedAligned(yt,v-8,u,n,b,Pe.HRIGHT,0,0,dt.addColon(dt.LBL_CURRENT_ACCESS))
var ue=Ut[_e]||null
var de=(h?Ht:Wt)[_e]
d.drawSizedAligned(ue,v,u,n,b,Pe.HLEFT|Pe.HFIT,_/2,0,ce?dt.separateColon(dt.LBL_DEFAULT,de):de)
u+=b+4
var fe
if(h){xe(Y)
var ve=Y,he=ve.is_world_admin,pe=ve.is_volume_owner
fe=he?Kt:pe?jt:Yt}else{xe(j)
fe=j.my_role_rank>=lt?Ft:Gt}d.drawSizedAligned(yt,v-8,u+ne,n,b,Pe.HRIGHT,0,0,dt.addColon(dt.LBL_CHANGE_ACCESS))
if(!rr){rr=Ve({items:fe,z:n,width:or/2,entry_height:nr})
ar=fe}if(ar!==fe){rr.applyParams({items:fe})
ar=fe}var me=Qt()
if(!me&&!rr.isDropdownVisible()){var Ee=-1
var ge=_e
if(ce)ge="DEFAULT"
for(var Te=0;Te<fe.length;++Te)if(fe[Te].tag===ge)Ee=Te
if(-1!==Ee)rr.setSelected(Ee)}var ye={x:v,y:u,disabled:me}
if(rr.isDropdownVisible())re=false
rr.run(ye)
if(rr.wasClicked()&&!me){var Se=rr.getSelected().tag
if(h){xe(Y)
qt("world_volume_access "+Y.mcid+" "+Y.volume_id+" "+r+" "+Se,ot)}else{var Ie=qt.bind(null,"world_access "+r+" "+Se,zt)
if("NONE"===Se&&Jt(r))$e({title:dt.DLG_BAN_BOOSTER_TITLE,text:dt.DLG_BAN_BOOSTER_MSG_1+"\n\n"+dt.DLG_BAN_BOOSTER_MSG_2,buttons:{yes:Ie,cancel:null}})
else Ie()}}u+=nr+4
if(!h&&y){if(userContextButton(dt.BTN_KICK_FROM_WORLD,me)){ut("user_info_kick",1,"button")
qt("kick "+r,Vt)}if(!$t())if(userContextButton(dt.BTN_RESET_INVENTORY,me)){ut("user_info_reset_inventory",1,"button")
qt("world_inventory_reset "+r,function(e){if(!e)mt(dt.STATUSMSG_INVENTORY_RESET)})}}}}if(ae){var Ae=Bt()
var we=Ae.sorted_users.indexOf(r)
d.drawSizedAligned(yt,v-8,u+ne,n,b,Pe.HRIGHT,0,0,dt.addColon(dt.LBL_BUILDER_QUEUE_STATUS))
if(Ae.online[r]===nt)d.drawSizedAligned(yt,v,u+ne,n,b,Pe.HLEFT|Pe.HFIT,_/2,0,dt.LBL_BUILDER_QUEUE_UNQUEUED)
else{d.drawSizedAligned(yt,v,u+ne,n,b,Pe.HLEFT|Pe.HFIT,or/2-nr-4,0,we<Ae.threshold?dt.LBL_BUILDER_QUEUE_ACTIVE:dt.LBL_BUILDER_QUEUE_QUEUED.$({index:we-Ae.threshold+1}))
var Le={x:v+or/2-nr,font_height:nr,y:u,z:n,w:nr,h:nr}
if(K.allow_actions||g)if(we<Ae.threshold){if(Xe(_extends({},Le,{text:"↓",tooltip:dt.TLTP_BUILDER_QUEUE_DEMOTE})))qt("build_queue_demote "+r,ot)}else if(Xe(_extends({},Le,{text:"↑",tooltip:dt.TLTP_BUILDER_QUEUE_PROMOTE})))qt("build_queue_promote "+r,ot)
if(Ze(_extends({},Le,{x:Le.x+nr+4,img:wt.sprite,frame:wt.X,tooltip:g?dt.TLTP_BUILDER_QUEUE_LEAVE:dt.TLTP_BUILDER_QUEUE_KICK})))qt(g?"build_queue_leave":"build_queue_kick "+r,ot)}u+=nr+4}var Oe=er(Ne,u-c+ir)
if(!K.allow_actions&&h&&!g)d.drawSizedAligned(At,s,u,n,b,Pe.HVCENTER|Pe.HWRAP,be,3*(c+Oe-u)/4,dt.USERINFO_NOT_ALLOWED_TO_CHANGE_ACCESS)
var Re={x:s,y:c,w:be,h:Oe}
if(Ue(Re));if(re&&!ht()&&!We(Re)&&Fe())B=true
if(re&&ft.chat_ui.isFocused())B=true
if(re&&ke({peek:true})||Ge(Be.ESC)||B)userInfoViewClear()
Je({x:s,y:c,z:n-1,w:be,h:Oe,pixel_scale:.25,color:vt.panel_color_popup})}},{"../common/effective_access":243,"../common/external_users/external_users_provider_ids":247,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/selection_box":350,"../glov/client/social":357,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/enums":385,"../glov/common/rand_alea":395,"../glov/common/util":400,"../glov/common/vmath":402,"./access_control":2,"./analytics":6,"./cosmetic_thumbnails":63,"./costume_edit":65,"./localization/localization":131,"./main":135,"./main_menu":136,"./menu":140,"./platform_worlds_client":160,"./status":193,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./user_party":211,"./user_profile_view":212,"./waygate_ui":222,"./world_comm":226,"./world_comm_effective_access":227,"./world_info":229,"./world_info_view":231,"./world_metadata":235,assert:void 0}],211:[function(e,t,r){"use strict"
r.partyWaitingData=partyWaitingData
r.partyIsActive=partyIsActive
r.partyGetParticipants=partyGetParticipants
r.partyGetParticipantsAmount=partyGetParticipantsAmount
r.partyIsHost=partyIsHost
r.partyGetHost=partyGetHost
r.partyLeave=partyLeave
r.partyGetExternalDisplayName=partyGetExternalDisplayName
r.partyFormatDisplayName=partyFormatDisplayName
r.partyJoin=partyJoin
r.partySetUserWorld=partySetUserWorld
r.userPartyInit=userPartyInit
function _createForOfIteratorHelperLoose(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]
if(r)return(r=r.call(e)).next.bind(r)
if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"===typeof e.length){if(r)e=r
var a=0
return function(){if(a>=e.length)return{done:true}
return{done:false,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return
if("string"===typeof e)return _arrayLikeToArray(e,t)
var r=Object.prototype.toString.call(e).slice(8,-1)
if("Object"===r&&e.constructor)r=e.constructor.name
if("Map"===r||"Set"===r)return Array.from(e)
if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(null==t||t>e.length)t=e.length
for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r]
return a}var s=e("assert")
var o=e("../glov/client/engine")
var n=e("../glov/client/error_report").errorReportSetDetails
var l=e("../glov/client/external_users_client").externalUsersPartyId
var a=e("../glov/client/net")
var _=a.netClientId
var i=a.netDisconnected
var c=a.netSubs
var u=a.netUserId
var d=e("../glov/common/external_users_common").ERR_NOT_AVAILABLE
var f=e("../common/external_users/external_users_provider_ids")
var v=f.USERS_PROVIDER_DISCORD
var h=f.USERS_PROVIDER_FACEBOOK_INSTANT
var p=e("./localization/localization").L
var m=e("./platform_worlds_client")
var E=m.PLATFORM_DISCORD
var g=m.PLATFORM_FBINSTANT
var T=e("./status").statusPush
var y=e("./user_info_view")
var S=y.userGetWorldAndPos
var I=y.userInfoGet
var A=3e3
var w=false
var L
var O=0
var R={}
function platformPartyProvider(){if(E)return v
else if(g)return h
return null}function partyWaitingData(){return w}function partyIsActive(){return Boolean(L)}function partyGetParticipants(){return L?L.participants:[]}function partyGetParticipantsAmount(){return L?L.participants.length:0}function partyIsHost(){return Boolean(L&&L.is_host)}function updateHostPosition(){var r=L&&L.participants[0]
if(!r||r.querying_pos||!r.world_id||partyIsHost()||r.pos_valid_time&&Date.now()<r.pos_valid_time)return
r.querying_pos=true
r.pos_str=""
S(r.user_id,r.client_id,function(e,t){r.querying_pos=false
r.pos_str=""
r.pos_valid_time=Date.now()+A
if(e||!L||r!==L.participants[0])return
if(!(t&&t.world_id&&t.pos_str))return
r.world_id=t.world_id
r.pos_str=t.pos_str})}function partyGetHost(){updateHostPosition()
return L&&L.participants[0]}function onPartyChannelData(e){var t=e
s(t.public.participants)
s(L)
var r=L.participants[0]
L.participants=t.public.participants
var a=L.participants[0]
if(a){L.is_host=a.user_id===u()&&a.client_id===_()
if(!L.is_host){if(r&&r.user_id===a.user_id&&r.client_id===a.client_id)if(r.world_id===a.world_id)L.participants[0]=r
updateHostPosition()}}if(a&&r)if(a.client_id!==r.client_id)T(L.is_host?p.STATUSMSG_PARTY_YOU_ARE_NEW_HOST:p.STATUSMSG_PARTY_USER_IS_NEW_HOST.$({name:I(a.user_id).display_name}))
else if(!L.is_host&&a.world_id&&!r.world_id)T(p.STATUSMSG_PARTY_HOST_JOINED_WORLD)
for(var i,o=_createForOfIteratorHelperLoose(t.public.participants);!(i=o()).done;){var n=i.value
if(n.external_platform_name)R[""+n.user_id]=n.external_platform_name}w=false}function partyLeave(){w=false
if(L){L.channel.unsubscribe()
L.channel.removeListener("channel_data",onPartyChannelData)
L=void 0}O++}function setExternalPartyData(){var e,t,r
if(!L||i()||!(null!=(e=window.FRVR)&&null!=(t=e.social)&&t.platform)){console.error("ERR_UNABLE_SENDING_EXTERNAL_PARTY_DATA")
return}var a=null==(r=window.FRVR.profile)?void 0:r.id()
window.FRVR.social.platform.getContextPlayers().then(function(e){var t=e.find(function(e){return e.id===a})
if(!t)return console.error("ERR_MISMATCHED_EXTERNAL_ID")
if(!L||i())return console.error("ERR_LEFT_PARTY")
var r={id:t.id,name:t.nickname||t.name}
L.channel.send("set_external_party_data",r)},function(e){console.error("[user party]",e)})}function partyGetExternalDisplayName(e){return R[e]||""}function partyFormatDisplayName(e,t){var r=R[e]
if(r&&r!==t)t=String(p.addParenthesesAfter(t,r))
return t||e}function partyJoin(e){partyLeave()
w=true;(L={id:e,channel:c().getChannel("party."+e,true),is_host:false,participants:[]}).channel.on("channel_data",onPartyChannelData)
setExternalPartyData()}function partySetUserWorld(e){if(L&&!i())L.channel.send("set_user_world",e,function(e){if(e)console.error(e)})}function onLogin(){w=true
if(o.defines.TEST_PARTY){partyJoin("TEST_PARTY")
return}var a=platformPartyProvider()
if(!a){w=false
return}var i=++O
l(a,function(e,t){if(i!==O)return
if(e||!t){if(e&&e!==d)console.error(e)
w=false
return}var r=a+"_"+t
n("external_users_party_id",r)
partyJoin(r)})}function userPartyInit(){c().on("login",onLogin)
c().on("logout",partyLeave)}},{"../common/external_users/external_users_provider_ids":247,"../glov/client/engine":305,"../glov/client/error_report":311,"../glov/client/external_users_client":312,"../glov/client/net":338,"../glov/common/external_users_common":387,"./localization/localization":131,"./platform_worlds_client":160,"./status":193,"./user_info_view":210,assert:void 0}],212:[function(e,t,r){"use strict"
r.userProfileViewIsMe=userProfileViewIsMe
r.userIdValid=userIdValid
r.userProfileViewGetTitle=userProfileViewGetTitle
r.userProfileViewInvalidateWorldList=userProfileViewInvalidateWorldList
r.userProfileViewInvalidatePhotoList=userProfileViewInvalidatePhotoList
r.userProfileViewInit=userProfileViewInit
r.userProfileModfiyingUser=userProfileModfiyingUser
r.userProfileViewFriendAdd=userProfileViewFriendAdd
r.userProfileViewFriendRemove=userProfileViewFriendRemove
r.userProfileViewFriendBlock=userProfileViewFriendBlock
r.userProfileViewFriendUnblock=userProfileViewFriendUnblock
r.doUserProfileView=doUserProfileView
r.userProfileViewOpen=userProfileViewOpen
r.userProfileViewOpenToMyBoosts=userProfileViewOpenToMyBoosts
var X=e("assert")
var a=e("../glov/client/cmds").cmd_parse
var i=e("../glov/client/collapsagories")
var F=i.collapsagoriesHeader
var W=i.collapsagoriesScrollCurrentSectionIntoFocus
var H=i.collapsagoriesStart
var z=i.collapsagoriesStop
var o=e("../glov/client/engine")
var Q=e("../glov/client/font").ALIGN
var n=e("../glov/client/input")
var V=n.KEYS
var $=n.inputClick
var Y=n.keyDownEdge
var J=e("../glov/client/markdown").markdownAuto
var ee=e("../glov/client/markdown_parse").mdEscape
var s=e("../glov/client/net")
var l=s.netClient
var te=s.netDisconnected
var re=s.netSubs
var ae=s.netUserId
var ie=e("../glov/client/scroll_area").scrollAreaCreate
var j=e("../glov/client/selection_box").dropDown
var K=e("../glov/client/slider").slider
var _=e("../glov/client/social")
var c=_.friendAdd
var u=_.friendBlock
var oe=_.friendIsBlocked
var d=_.friendRemove
var f=_.friendUnblock
var ne=_.getExternalFriendInfos
var se=_.isFriend
var v=e("../glov/client/ui")
var le=v.button
var _e=v.buttonImage
var q=v.buttonText
var ce=v.drawLine
var ue=v.label
var de=v.modalDialog
var fe=v.provideUserString
var ve=v.suppressNewDOMElemWarnings
var he=v.uiGetFont
var pe=v.uiGetTitleFont
var me=v.uiTextHeight
var Ee=e("../glov/client/urlhash")
var ge=e("../glov/client/walltime")
var h=e("../glov/common/util")
var p=h.VALID_USER_ID_REGEX
var m=h.callEach
var Te=h.dateToSafeLocaleString
var ye=h.empty
var Se=e("../common/external_users/external_users_provider_ids").USERS_PROVIDER_FACEBOOK_INSTANT
var Ie=e("../common/photo_common").PHOTO_SHOWCASE_MAX
var E=e("../common/store_data")
var Ae=E.PRODUCT_ITEM_ID_BOOST_TOKEN
var we=E.PRODUCT_ITEM_ID_GEM
var Le=E.PRODUCT_ITEM_ID_ORB
var g=e("../common/types").WORLD_BOOST_CANCELLED
var T=e("../common/world_constants")
var Oe=T.BOOST_COOLDOWN
var Re=T.BOOST_STREAK_GRACE_DAYS
var be=e("./account_ui").formatUserID
var Ne=e("./analytics").logEvent
var Ce=e("./character_customization").renamePrompt
var xe=e("./costume_edit").costumeFromUserChannel
var y=e("./fbinstant_worlds")
var Me=y.fbCanInvite
var De=y.fbInviteCreateAsync
var S=e("./localization/localization")
var Pe=S.DURATION_DAYS
var Be=S.DURATION_WITH_MINUTES
var ke=S.L
var Ue=S.TimeComponent
var I=e("./main")
var A=I.chatUI
var Ge=I.returnToMainMenu
var w=e("./menu")
var Fe=w.menuDoTransition
var We=w.menuX1
var He=w.menuY1
var ze=e("./paperdoll").doPaperDoll
var Ve=e("./photo_list").photoListShow
var Ye=e("./platform_worlds_client").PLATFORM_DISCORD
var L=e("./sharing/platform_share_handlers")
var je=L.shareUserLink
var Ke=L.sharingEnabled
var qe=L.sharingLinksEnabled
var Ze=e("./status").statusPush
var O=e("./styles")
var Xe=O.color_black
var Qe=O.color_gray_50
var $e=O.floater_style_sysadmin_no_outline
var Je=O.hint_style
var et=O.label_style
var tt=O.label_warning_style
var rt=O.loading_style
var at=O.menu_header_style
var it=O.style_wallet_boost_tokens
var ot=O.style_wallet_gems
var nt=O.style_wallet_orbs
var st=O.sublabel_style
var lt=e("./ui_util")
var _t=e("./ui_util_2")
var R=e("./user_details")
var ct=R.isUserDetailsError
var b=R.userDetailsCacheClearForUser
var ut=R.userDetailsGet
var N=e("./user_info_view")
var dt=N.doOnlineStatusDropdown
var ft=N.formatPresence
var vt=N.headshotAngleForUser
var ht=N.presenceIsOffline
var pt=N.userInfoGet
var mt=N.userProfileButton
var Et=N.userWorldLink
var gt=e("./user_party").partyGetExternalDisplayName
var C=e("./waygate_ui")
var Tt=C.calcWGLinkWidth
var yt=C.waygateLinkUI
var x=e("./welcome_screen")
var St=x.accountUILogout
var It=x.getAccount
var At=x.welcomeScreenSetState
var M=e("./world_comm")
var wt=M.getBoostTokenBalance
var Lt=M.getGemBalance
var Ot=M.getOrbBalance
var Rt=M.getPerm
var bt=M.getWorldID
var Nt=M.myUserCmdParse
var D=M.whenConnected
var Ct=M.worldGoByURL
var P=e("./world_info")
var xt=P.getWorldInfo
var Mt=P.getWorldInfoCachedIfNewer
var Dt=P.isFullWorldInfo
var B=e("./world_info_view")
var Pt=B.numberFormat
var Bt=B.worldLink
var k=e("./world_list")
var kt=k.worldListHeader
var Ut=k.worldListInitContext
var Gt=k.worldListShow
var Ft=Math.ceil,Wt=Math.floor,Ht=Math.max,zt=Math.round
var Vt=""
var Yt=null
var jt=false
var Kt=false
var qt={for_user_id:"",loading:false,public_worlds:null,public_ids:[],private_worlds:null,private_ids:[],frozen_worlds:null,frozen_ids:[],all_worlds_info:{},all_worlds_info_timestamp:0,err:null}
function worldIDs(e){var t=[]
var r=qt[e]
if(r)for(var a=0;a<r.length;++a){var i=r[a]
qt.all_worlds_info[i.id]=i
t.push(i.id)}return t}function userProfileViewIsMe(){return Boolean(Yt&&Yt===ae())}function userIdValid(e){return Boolean(e&&("me"===e||e.match(p)))}function userProfileViewGetTitle(){return Vt}function userProfileViewInvalidateWorldList(){if(qt.for_user_id===ae()&&!qt.loading)qt.for_user_id=""}function userProfileViewInvalidatePhotoList(){if(Yt)b(Yt)}var Zt=false
var Xt=null
var U=null
function shouldReturnToUserOptions(){U=Yt}function userProfileViewInit(e){Yt=null
var r=e=e.toLowerCase()
Kt=Boolean(o.defines.USER_OPTIONS)||r===U
if(!Xt)Zt=false
U=null
jt=false
re().onceLoggedIn(function(){if("me"===r)if(r=ae()||null)Ee.set("u",r)
else jt=true
if(userIdValid(r)){X(r)
if((Yt=r)!==qt.for_user_id){qt.for_user_id=r
qt.loading=true
qt.public_worlds=null
qt.private_worlds=null
qt.frozen_worlds=null
D(function(){if(Yt!==r)return
var e=l().pak("user_get_worlds")
e.writeAnsiString(r)
e.send(function(e,t){if(Yt!==r)return
X.equal(qt.for_user_id,r)
qt.loading=false
if(e){qt.err=e
return}X(t)
qt.err=null
qt.public_worlds=t.public_worlds||null
qt.private_worlds=t.private_worlds||null
qt.frozen_worlds=t.frozen_worlds||null
qt.all_worlds_info={}
qt.all_worlds_info_timestamp=Date.now()
qt.public_ids=worldIDs("public_worlds")
qt.private_ids=worldIDs("private_worlds")
qt.frozen_ids=worldIDs("frozen_worlds")})})}}})}var Qt=false
var G=null
function handleUserModResp(e,t){Qt=false
A().handleCmdParseError(e,t)
if(e)de({title:ke.DLG_ERR_MODIFYING_USER_TITLE,text:e,buttons:{OK:null}})
if(G)m(G,G=null)}function userProfileModfiyingUser(){return Qt}function myUserCmdParseGated(e){Qt=true
Nt(e,handleUserModResp)}function userProfileViewFriendAdd(e){Qt=true
Ne("friend_add_button",1,"button")
c(e,handleUserModResp)}function userProfileViewFriendRemove(e){Qt=true
Ne("friend_remove_button",1,"button")
d(e,handleUserModResp)}function userProfileViewFriendBlock(e){Qt=true
Ne("friend_block_button",1,"button")
u(e,handleUserModResp)}function userProfileViewFriendUnblock(e){Qt=true
Ne("friend_unblock_button",1,"button")
f(e,handleUserModResp)}var $t=null
var Jt=-1
function setHeadshotAngleSubmit(){X(null!==$t)
if($t===Jt)$t=null
else myUserCmdParseGated("headshot_angle "+(Jt=$t))}function setHeadshotAngle(e){$t=e
if(Qt){if(!G)G=[]
if(!G.includes(setHeadshotAngleSubmit))G.push(setHeadshotAngleSubmit)}else setHeadshotAngleSubmit()}var er=100
var tr=8
var rr=2
var ar=76
var ir=30
var or=zt((zt(2e3/3)-2*tr)/3)
var nr
var sr=[{name:ke.LBL_ANYONE,tag:"0",value:0},{name:ke.LBL_FRIENDS_ONLY,tag:"1",value:1}]
var lr="init"
function checkEmailVerification(){if("init"!==lr)return
lr="checking"
It().checkEmailVerified(function(e,t){if(e)lr="err"
else if(!t)lr="unverified"
else lr="verified"})}var _r=0
var cr=1
var ur=2
var dr=[ke.LBL_BOOST_HEADER_ACTIVE,ke.LBL_BOOST_HEADER_CANCELLED,ke.LBL_BOOST_HEADER_EXPIRED]
var fr=[ke.TLTP_BOOST_HEADER_ACTIVE,ke.TLTP_BOOST_HEADER_CANCELLED,null]
function catBoost(e,t){if(e.expiry<=t)return ur
if(e.flags&g)return cr
return _r}var vr={month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"}
var hr=86400
function userProfileEdit(e,_,t){var r=_.getChannelData("public.display_name","")
var a=Yt
X(a)
var i=0
var o=We()
var n=He()
var I=Z.UI
var s=o-i
var l=n-e
var A=he()
var c=pe()
var w=me()
var L=0
var O=e
if(!nr)nr=ie({z:I,background_color:null,auto_hide:true})
nr.keyboardScroll()
var u=nr.barWidth()
var d={x:i,y:e,w:s,h:n+5-e,auto_hide:false}
nr.begin(d)
var R=(L=0)+(s-=u)/2
var f=ar
H({key:"user_edit_cats",x:O=0,z:I,w:s,num_headers:4,view_y:nr?nr.getScrollPos():O,view_h:nr?nr.h:l,header_h:f,parent_scroll:nr})
F({y:O,text:ke.LBL_CATEGORY_GENERAL,text_height:w,earlydraw:function earlydraw(e){c.drawSizedAligned(at,R,e.y,I+1,1.5*w,Q.HVCENTER,0,e.h,ke.LBL_ACCOUNT_OPTIONS)
if(!Zt&&q({key:"user_edit_stop",x:L+s-ar-4,y:e.y,z:I+1,w:ar,h:ar,font_height:1.5*w,text:"←",tooltip:ke.TLTP_DONE_EDITING})||Y(V.BACKSPACE))Kt=false}})
function headerLabel(e,t){ue({font:c,font_style:at,x:R-8-2*or,y:O,w:4*or+8,h:ar,size:1.25*w,align:Q.HVCENTERFIT,text:e,tooltip:t||void 0})
O+=ar+4}function messageLabel(e,t){ue({font_style:et,x:R-8-2*or,y:O,w:4*or+8,h:ar,size:w,align:Q.HVCENTERFIT,text:e,tooltip:t||void 0})
O+=ar+4}function optionLabel(e,t){ue({font_style:et,x:R-8-2*or,y:O,w:2*or,h:ar,size:w,align:Q.VCENTER|Q.HRIGHT,text:e,tooltip:t||void 0})}function optionValue(e){ue({font_style:st,x:R,y:O,w:2*or,h:ar,size:w,align:Q.VCENTER|Q.HWRAP,text:e})
O+=ar+4}function optionButton(e,t,r,a){var i={x:t===Q.HCENTER?R-or:R,y:O,w:2*or,h:ar,text:e,disabled:Qt,img:r,frame:a}
var o=le(i)
O+=ar+4
return o}if($({x:L,y:O+=f+4,w:s,h:ar}))fe(ke.LBL_USER_ID,a)
optionLabel(ke.LBL_USER_ID,ke.TLTP_USER_ID)
optionValue(a+" "+lt.COPY_SYMBOL)
optionLabel(ke.LBL_DISPLAY_NAME,ke.TLTP_DISPLAY_NAME)
if(optionButton(r,Q.HRIGHT,lt.sprite,lt.EDIT))Ce(r)
dt({x:L-tr/2,y:O,z:I,w:s,dropdown_w:or,font_height:w,entry_height:ar})
O+=ar+rr
optionLabel(ke.LBL_HEADSHOT_ANGLE,null)
var v=null===$t?zt(100*vt(a,_)):$t
var h=zt(K(v,{x:R,y:O,z:I,w:or,h:ar,min:15,max:85,step:5}))
if(h!==v)setHeadshotAngle(h)
mt({user_id:a,show_online_status:false,x:R+or+4,y:O,z:I,w:ar,h:ar,draw_only:true,base_name:"inv_active"})
O+=ar+4
var p=It()
if(p.isEmailPassLogin()){checkEmailVerification()
optionLabel(ke.LBL_ACCOUNT_STATUS,ke.TLTP_ACCOUNT_STATUS)
var m
switch(lr){case"err":m=ke.LBL_ERROR
break
case"unverified":m=ke.LBL_ACCOUNT_STATUS_UNVERIFIED
break
case"verified":m=ke.LBL_ACCOUNT_STATUS_VERIFIED
break
case"sent":m=ke.BTN_EMAIL_SENT
break
case"checking":m=ke.LBL_ACCOUNT_STATUS_CHECKING
break
default:X(false)}optionValue(m)
if("unverified"===lr)if(optionButton(ke.BTN_CONFIRM_EMAIL,Q.HCENTER,_t.sprite,_t.BTNICON_EMAIL)){Ne("user_profile_confirm_email",1,"button")
var E=p.getEmail()
de({title:ke.BTN_EMAIL_SENDING,buttons:{}})
p.sendActivationEmail(E,function(e){if(e){Ne("user_profile_confirm_email_err",1,"button")
de({title:ke.DLG_SEND_ACTIVATION_EMAIL_FAILED_TITLE,text:e,buttons:{ok:null}})
return}Ne("user_profile_confirm_email_succ",1,"button")
de({title:ke.LBL_CONFIRMATION_EMAIL_SENT,text:ke.LBL_CONFIRMATION_EMAIL_WILL_RECEIVE,buttons:{ok:null}})})}if(optionButton(ke.BTN_RESET_PASSWORD,Q.HCENTER,lt.sprite,lt.LOCK)){Ne("user_profile_reset_password",1,"button")
var g=p.getEmail()
de({title:ke.BTN_EMAIL_SENDING,buttons:{}})
p.sendRecoverEmail(g,function(e){if(e){Ne("user_profile_reset_password_err",1,"button")
de({title:ke.DLG_ERROR_TITLE,text:ke.DLG_RESET_EMAIL_FAILED_MSG.$({err:e}),buttons:{ok:null}})
return}Ne("user_profile_reset_password_succ",1,"button")
de({title:ke.DLG_RESET_EMAIL_SUCCESS_TITLE,text:ke.DLG_RESET_EMAIL_SUCCESS_MSG.$({email:g}),buttons:{ok:null}})})}}F({y:O,text:ke.LBL_CATEGORY_PRIVACY,text_height:w})
O+=f+4
function lazyDropdownByValue(e,t,r,a,i){optionLabel(e,t)
var o=_.getChannelData("public."+a,i)
var n=0
for(var s=0;s<r.length;++s)if(r[s].value===o)n=s
var l=j({x:R,y:O,z:I,width:or,entry_height:ar,items:r,disabled:Qt},n,{suppress_return_during_dropdown:true})
if(l)myUserCmdParseGated(a+" "+l.value)
O+=ar+4}lazyDropdownByValue(ke.LBL_PRIVACY_PRESENCE,ke.TLTP_PRIVACY_PRESENCE,sr,"privacy_presence",0)
lazyDropdownByValue(ke.LBL_PRIVACY_WORLDS,ke.TLTP_PRIVACY_WORLDS,sr,"privacy_worlds",0)
lazyDropdownByValue(ke.LBL_PRIVACY_PHOTOS,ke.TLTP_PRIVACY_PHOTOS,sr,"privacy_photos",0)
F({y:O,text:ke.LBL_CATEGORY_BOOSTS,text_height:w,earlydraw:function earlydraw(e){var t=wt()
if(t>0){var r=2*w
var a=e.y+(e.h-r)/2
var i=e.w-r-tr
ue({x:i,y:a,w:r,h:r,img:_t.sprite,frame:_t.BOOST_TOKEN})
ue({x:i,y:a,w:0,size:r,font_style:it,align:Q.HRIGHT,text:""+t})}}})
O+=f+4
if("boosts"===Xt){Xt=null
W()}var T=t.stats
var b=ge()/1e3
optionLabel(ke.LBL_BOOST_STREAK,ke.TLTP_BOOST_STREAK.$({days:Re}))
var y
var S=T&&T.boost_streak_start
var N=T&&T.boost_streak_end||0
var C=N?new Date(1e3*N):null
if(S){var x={days:Ft((b-S)/hr),date:Te(C,true)}
if(N<b)y=ke.LBL_BOOST_STREAK_ENDED_GRACE.$(x)
else y=ke.LBL_BOOST_STREAK_ACTIVE.$(x)
y=y+"\n"+ke.LBL_BOOST_SINCE.$({date:new Date(1e3*S).toLocaleDateString()})}else if(N)y=ke.LBL_BOOST_STREAK_ENDED.$({date:Te(C,true)})
else y=ke.LBL_BOOST_STREAK_NONE
optionValue(y)
var M=_.getChannelData("public.boosts",{})
if(ye(M))messageLabel(ke.LBL_BOOST_LIST_EMPTY,null)
else{var D=Object.keys(M)
D.sort(function(e,t){var r=M[e]
var a=M[t]
var i=catBoost(r,b)-catBoost(a,b)
if(i)return i
return a.expiry-r.expiry})
var P=-1
var B=Tt(ar)
var k=s/2-4-or
var U=function _loop(e){var t=D[e]
var r=M[t]
var a=catBoost(r,b)
if(a!==P){headerLabel(dr[a],fr[a])
P=a}var i=r.world_id,o=r.start,n=r.expiry
var s=xt(i,false)
var l=ke.LBL_UNKNOWN_WORLD_NAME
var _=true
if(s&&Dt(s)){_=false
l=s.name}else if(s&&"ERR_DOES_NOT_EXIST"===s.err)l=ke.LBL_DELETED_WORLD_NAME
var c=R-B-L-16
A.drawSizedAligned(et,L,O+ar/2-w,I,w,Q.HRIGHT|Q.HFIT,c,0,l)
var u=A.drawSizedAligned(st,L,O+ar/2,I,.75*w,Q.HRIGHT|Q.HFIT,c,0,ke.$(ke.LBL_NUMBERED_WORLD,i)+" "+lt.COPY_SYMBOL)
if($({x:L+c-u,y:O+ar/2,w:u,h:.75*w,button:0}))fe('"'+l+'"',i)
if(yt({ctx:t,x:R-B-8,y:O,z:I,w:B,h:ar,target:{wid:i},url:Bt(i,"info"),img_style:"thumb",hide_unlisted:false,overlay_mode:true,disabled:_})){shouldReturnToUserOptions()
Ct(i,"info")}var d=new Date(1e3*n)
var f=Wt((n-b)/hr)
var v=Ft((b-o)/hr)
var h=a===ur?ke.LBL_BOOST_EXPIRED_DATE.$({date:Te(d,true)}):ke.LBL_BOOSTED_UNTIL_DATE.$({date:Te(d,false,vr)})
var p=ke.LBL_BOOST_DAYS_REMAINING.$({days:f})
var m=""
var E=f
if(v<Oe){var g=Oe-v
m=ke.LBL_BOOST_COOLDOWN.$({days:g})
E-=g}if(a===_r){A.drawSizedAligned(et,R,O,I,w,Q.HFIT|Q.HWRAP|Q.HVCENTER,k,ar,h+"\n"+p+(m?"\n"+m:""))
if(le({x:R+k+4,y:O,z:I,w:or,h:ar,img:_t.sprite,frame:_t.BTNICON_REMOVE,text:ke.addEllipsis(ke.BTN_CANCEL)})){var T={days:f,tokens:E}
var y=m?ke.DLG_BOOST_CANCEL_TEXT_COOLDOWN.$(T):ke.DLG_BOOST_CANCEL_TEXT_ACTIVE.$(T)
de({title:ke.DLG_BOOST_CANCEL_TITLE,text:y+"\n\n"+ke.DLG_BOOST_CANCEL_TEXT_FINAL,buttons:{yes:function yes(){Nt("boost_cancel "+t,function(e){if(e)de({title:ke.DLG_ERROR_TITLE,text:e,buttons:{ok:null}})
else{Ne("boost_cancel")
Ze(ke.STATUSMSG_BOOST_CANCELLED.$({tokens:E}))}})},no:null}})}}else if(a===cr)A.drawSizedAligned(et,R,O,I,w,Q.HFIT|Q.HWRAP|Q.HVCENTER,k,ar,h+"\n"+p)
else if(a===ur)A.drawSizedAligned(et,R,O,I,w,Q.HFIT|Q.HWRAP|Q.HVCENTER,k,ar,h+"\n"+ke.LBL_THANKS_FOR_BOOSTING)
else X(false)
O+=ar+4
if(e<D.length-1){var S=D[e]
if(catBoost(M[S],b)===a)O+=16}else O+=16}
for(var G=0;G<D.length;++G)U(G)}F({y:O,text:ke.LBL_CATEGORY_STATS,text_height:w})
O+=f+4
optionLabel(ke.LBL_STAT_PLAY_TIME,ke.TLTP_STAT_PLAY_TIME)
optionValue(T&&T.time?ke.duration(T.time,{lowest:Ue.Minute,highest:Ue.Day}):ke.LBL_NONE)
optionLabel(ke.LBL_STAT_PLACED,ke.TLTP_STAT_PLACED)
optionValue((T&&T.place||0).toLocaleString())
optionLabel(ke.LBL_STAT_BROKEN,ke.TLTP_STAT_BROKEN)
optionValue((T&&T.break||0).toLocaleString())
optionLabel(ke.LBL_STAT_CURRENCY_BALANCE,ke.TLTP_STAT_CURRENCY_BALANCE)
function showCurrencies(e,t,r){if(e+t+r===0){optionValue(ke.LBL_NONE)
return}var a=R
var i=1.5*w
var o=O+(ar-i)/2
if(e){a+=A.drawSizedAligned(ot,a,O,I,w,Q.VCENTER,0,ar,e.toLocaleString())
lt.sprite.draw({x:a,y:o,w:i,h:i,frame:lt.GEMS})
a+=2*i}if(t){a+=A.drawSizedAligned(nt,a,O,I,w,Q.VCENTER,0,ar,t.toLocaleString())
lt.sprite.draw({x:a,y:o,w:i,h:i,frame:lt.ORBS})
a+=2*i}if(r){a+=A.drawSizedAligned(it,a,O,I,w,Q.VCENTER,0,ar,r.toLocaleString())
_t.sprite.draw({x:a,y:o,w:i,h:i,frame:_t.BOOST_TOKEN})}O+=ar+4}showCurrencies(Lt(),Ot(),wt())
optionLabel(ke.LBL_STAT_CURRENCY_SPENT,ke.TLTP_STAT_CURRENCY_SPENT)
showCurrencies(_.getChannelData("public."+we+"_spent",0),_.getChannelData("public."+Le+"_spent",0),_.getChannelData("public."+Ae+"_spent",0))
O+=100
z()
nr.end(O)}var pr=0
var mr
function doUserProfileView(e){var t=0
var r=We()
var a=He()
var d=Z.UI
var i=r-t
var o=a-e
var f=he()
var v=me()
if(jt){var n=ae()
if(n){Ee.set("u",n)
userProfileViewInit(n)}else{f.drawSizedAligned(rt,t,e,d,v,Q.HVCENTER,i,2*o/3,ke.LOGINMSG_LOGGING_IN)
Vt=ke.USERTITLE_LOADING
return}}if(!Yt){f.drawSizedAligned(tt,t,e,d,v,Q.HVCENTER,i,2*o/3,ke.ERR_INVALID_USER_ID)
Vt=ke.USERTITLE_ERROR
return}var h=Yt
var s=ut(h)
if(ct(s)){f.drawSizedAligned(tt,t,e,d,v,Q.HVCENTER,i,2*o/3,ke.separateColon(ke.LBL_ERROR,ke.errorLookup(s.err)))
Vt=ke.USERTITLE_ERROR
return}var l=re().getChannelImmediate("user."+h)
if(!l.isFullySubscribed()||ye(s)){f.drawSizedAligned(rt,t,e,d,v,Q.HVCENTER,i,2*o/3,ke.MSG_LOADING)
Vt=ke.USERTITLE_LOADING
return}var _=l.getChannelData("public.display_name","")
Vt=ke.USERTITLE.$({name:be(h,_)})
var p=h===ae()
if(!p)Kt=false
if(Kt)return userProfileEdit(e,l,s)
var c=se(h)
var m=s.created,E=s.last,u=s.has_friended_me,g=s.worlds_team,T=s.aliases,y=s.stats
var S=oe(h)
var I=zt(t+i/3)
var A=r-I
var w=I
var L=e
mt({user_id:h,show_online_status:true,x:w,y:L,z:d,w:er,h:er,draw_only:true,base_name:"inv_active"})
var O=r-(er+tr)-(w+=er+tr)
var R=2*v
var b=v
var N=R+b
var C=L+=v/2
var x=J({font_style:at,x:w,y:L,z:d,text_height:R,w:O,align:Q.HCENTERFIT,text:p?ke.LBL_USER_ME.$({name:ee(_)}):_}).w
var M=x
L+=R+4
var D=f.drawSizedAligned(st,w,L,d,b,Q.HCENTERFIT,O,0,ke.separateColon(ke.LBL_USER_ID,h)+" "+lt.COPY_SYMBOL)
if($({x:w+(O-D)/2,y:L,w:D,h:b,button:0}))fe('"'+_+'"',h)
M=Ht(M,D)
L+=b+rr
if(p){if(_e({x:w+(O+M)/2+tr,y:C,z:d,w:N,h:N,img:lt.sprite,frame:lt.EDIT,tooltip:ke.TLTP_CHANGE_NAME})){Ne("user_profile_rename",1,"button")
Ce(_)}}else if(T)ue({x:w+(O+x)/2+tr,y:C,z:d,w:R,h:R,font_style:st,size:R,text:"▼",align:Q.HVCENTER,tooltip_markdown:false,tooltip:ke.TLTP_ALIASES.$({list:"\n  "+T.join("\n  ")})})
var P=L+b+rr
function expandWidth(){if(w!==I&&L>e+er){w=I
O=A}}function descLine(e,t,r){expandWidth()
if(e)if(r){ue({font_style:t||st,x:w,y:L,z:d,w:O,size:b,align:Q.HCENTERFIT,text:e,tooltip:r})
L+=b}else L+=f.drawSizedAligned(t||st,w,L,d,b,Q.HCENTER|Q.HWRAP,O,0,e)
else L+=b
L+=rr}var B=w
var k=0
function buttonLine(e,t){expandWidth()
var r=e+t
B=w+(O-(e*or+t*ar+(r-1)*tr))/2
k=r}function userContextButton(e,t,r,a,i){L=Ht(L,P)
var o=Qt||!re().loggedIn()||te()
var n=a?ar:or
var s=le({x:B,y:L,z:d,w:n,h:ar,disabled:o,font_height:ir,text:a?void 0:e,tooltip:a?e:void 0,img:t,img_color:i,frame:r})
if(!--k)L+=ar+tr
else B+=n+tr
return s}function lineSep(){var e=w+O/2
var t=.33*O
ce(e-t/2,L+=tr,e+t/2,L,d,1,1,Qe,0)
L+=tr}function showDetails(){var e=[]
if(m){var t=Ht(0,zt(ge.now()/1e3-m))
var r
if(t<2592e3){if(t>86400)t=60*zt(t/60/60)*60
r=ke.duration(t,Be)}else r=ke.duration(t,Pe)
var a=new Date(1e3*m)
e.push({text:ke.LBL_JOINED.$({time:r}),tooltip:ke.TLTP_ACCOUNT_CREATED.$({date:a.toLocaleDateString()})})}var i=y&&y.boost_streak_start
var o=Boolean(i)
var n=L
var s=2*rr+b
if(e.length){L+=rr
for(var l=0;l<e.length;++l){var _=e[l]
descLine(_.text,et,_.tooltip)}L+=rr}else if(o)L+=s
if(o)if(i){var c=I+A-s-tr
var u=(Date.now()-1e3*i)/1e3
var d=u/31557600
var f=Ft(u/hr)
ue({x:c,y:n,w:s,h:s,img:_t.sprite,frame:d>1?_t.BOOST3:d>1/12?_t.BOOST2:_t.BOOST1,tooltip:ke.LBL_BOOST_SINCE.$({date:new Date(1e3*i).toLocaleDateString()})+"\n"+ke.LBL_BOOST_STREAK_LENGTH.$({days:f})})}if(g)descLine(ke.USERINFO_WORLDSTEAM,$e)
if(!p)if(Ye){var v=gt(h)
if(v)descLine(ke.USERINFO_MY_CHANNEL_MEMBER_DISCORD.$({name:v}))}}function showRichPresence(){var e,t
expandWidth()
var r=pt(h).presence_data
var a=!p&&(null==r?void 0:null==(e=r.payload)?void 0:e.world_id)
var i=a===bt()
if(a&&(i||(null==(t=xt(a,false))?void 0:t.user_access))){var o=Tt(ar)
var n=w+o+tr
var s=O-(o+tr)
var l=f.drawSizedAligned(st,n,L,d,v,Q.HCENTERFIT|Q.VCENTER,s,ar,ft(r))
if(Et({user_id:h,presence_data:r,x:n+(s-l)/2-o-tr,y:L,z:d,h:ar,ctx:"user"+h}));L+=ar}else{if(ht(r)&&E){var _=Ht(0,zt(ge.now()/1e3-E))
var c
if(_<2592e3){if(_>86400)_=60*zt(_/60/60)*60
c=ke.duration(_,Be)}else c=ke.duration(_,Pe)
var u=new Date(1e3*E)
ue({font_style:st,x:w,y:L,z:d,h:v,align:Q.HCENTERFIT,w:O,text:ke.LBL_LAST_ONLINE.$({time:c}),tooltip:ke.TLTP_LAST_ONLINE.$({date:u.toLocaleDateString()})})}else f.drawSizedAligned(st,w,L,d,v,Q.HCENTERFIT,O,0,ft(r))
L+=v}L+=rr}function showFriendAndLinkButtons(){lineSep()
if(p){var e=It().shouldShowLogout()
buttonLine(e?2:1,2)
if(userContextButton(ke.BTN_ACCOUNT_OPTIONS,lt.sprite,lt.SETTINGS)){Ne("user_profile_edit",1,"button")
Kt=true}if(e)if(userContextButton(ke.BTN_LOGOUT,_t.sprite,_t.BTNICON_EXIT)){Ne("user_profile_logout",1,"button")
de({title:ke.DLG_LOG_OUT_TITLE,text:ke.DLG_LOG_OUT_MSG,buttons:{yes:function yes(){Ge()
At()
St()},no:null}})}if(userContextButton(ke.BTN_PHOTO_LIBRARY,_t.sprite,_t.BTNICON_PHOTO,true,Xe)){Fe()
Ee.goRoute("u/me/photos")}}else{var t
var r=null==(t=ne(h))?void 0:t[Se]
if(S){descLine(ke.FRIENDLIST_USER_BLOCKED)
buttonLine(1,1)
if(userContextButton(ke.BTN_UNBLOCK_USER,_t.sprite,_t.BTNICON_REMOVE))userProfileViewFriendUnblock(h)}else if(r){var a=null==r?void 0:r.name
if(a)descLine(ke.$(ke.USERINFO_MY_FRIEND_FB,a))
if(Me()){buttonLine(1,1)
if(userContextButton(ke.BTN_INVITE_PLAY)){Ne("friend_invite_fb",1,"button")
De(h)}}else buttonLine(0,1)}else if(c){descLine(u?ke.FRIENDLIST_MUTUAL:ke.FRIENDLIST_USER_IS_ADDED,u?Je:void 0)
buttonLine(1,1)
if(userContextButton(ke.BTN_REMOVE_FRIEND,_t.sprite,_t.BTNICON_REMOVE))userProfileViewFriendRemove(h)}else{descLine(u?ke.FRIENDLIST_USER_ADDED_ME:"")
buttonLine(2,1)
if(userContextButton(ke.BTN_ADD_FRIEND,_t.sprite,_t.BTNICON_ADD))userProfileViewFriendAdd(h)
if(userContextButton(ke.BTN_BLOCK_USER,_t.sprite,_t.BTNICON_BLOCK))userProfileViewFriendBlock(h)}}if(Ke("shareUserLink")||qe())if(userContextButton(Ke("shareUserLink")?ke.BTN_SHARE:ke.BTN_GET_LINK,lt.sprite,lt.SHARE,true)){Ne("user_profile_share",1,"button")
je(h)}}showDetails()
showRichPresence()
showFriendAndLinkButtons()
var U=L
L=e
w=t
O=zt(i/3)
var G=xe(l)
if(G){var F=zt(1.33*O)
var W=zt(L-.05*F)
ze({x:w,y:W,w:O,h:F,button_h:ar,draw_elipse:false,no_name:true,no_customize:!p,costume:G})
L=zt(W+F-.15*F)}U=Ht(U,L)
L=U
O=i
var H=true
function header(e,t,r){if(H){L-=8
H=false}L=kt(w,L,O,e,t,r)}if(!mr)mr=ie({z:d,background_color:null,auto_hide:true})
mr.keyboardScroll()
var z=L+16
var V={x:t,y:z,w:O,h:a+5-z}
var Y=mr.getScrollPos()
var j=Y+V.h
mr.begin(V)
L=w=0
var K=w+O/2
function showWorldList(e,t,r){if(qt.loading||qt.err)return
var a={all_worlds_info:qt.all_worlds_info,recent_worlds:{},my_worlds:{},allow_join:true,y_min:Y,y_max:j,dims:{y:L,y0:L,w:O,x_mid:K},scroll_param:V}
Ut(a)
var i=qt[e]
if(i.length){var o
var n={visit_count:0,unique:0,like:0,players:0}
for(var s=0;s<i.length;++s){var l=i[s]
var _=qt.all_worlds_info[l]
X(_)
var c=Mt(l,false,qt.all_worlds_info_timestamp)
if(c&&!c.err){_=c
qt.all_worlds_info[l]=_}n.visit_count+=_.stats&&_.stats.visit_count||0
n.unique+=_.stats&&_.stats.unique||0
n.like+=_.stats&&_.stats.like||0
n.players+=_.players||0}var u=[]
if(n.visit_count||n.like)u.push(ke.WORLDINFO_LIKES.$({val:n.like,short_val:Pt(n.like)}),"•",ke.WORLDINFO_VIEWS.$({val:n.visit_count,short_val:Pt(n.visit_count)}))
if(n.players){if(u.length)u.push("•")
u.push(ke.FORMAT_NUMBER_OF_PLAYERS.$({players:n.players}))}if(u.length)o=ke.separateWords.apply(ke,u)
header(t,r||o,r?void 0:et)
L=Gt(L,a,"user_profile",i,100,false)}}function showPublicWorlds(){if(qt.loading){header(ke.LBL_WORLDS_PUBLIC)
descLine(ke.MSG_LOADING)}else if(qt.err){header(ke.LBL_WORLDS_PUBLIC)
descLine(ke.separateColon(ke.LBL_ERROR,ke.errorLookup(qt.err)),tt)}else if(!qt.public_worlds&&!qt.private_worlds&&!qt.frozen_worlds){header(ke.LBL_WORLDS_PUBLIC)
descLine(ke.LBL_USER_NO_WORLDS)}else showWorldList("public_ids",ke.LBL_WORLDS_PUBLIC,null)}function showFrozenWorlds(){showWorldList("frozen_ids",ke.LBL_WORLDS_CONTEST,null)}function showPrivateWorlds(){showWorldList("private_ids",ke.LBL_WORLDS_PRIVATE,ke.LBL_WORLDS_PRIVATE_HINT)}function showPhotoShowcase(){var e=s.listed_photos||[]
if(p||e.length){var t=0
if(p)if(e.length){t=Rt("photo_showcase_size")
var r=ke.$(ke.FORMAT_FRACTION,e.length,t)
header(ke.addParenthesesAfter(ke.LBL_PHOTO_SHOWCASE,r))}else header(ke.LBL_PHOTO_SHOWCASE,ke.LBL_PHOTO_SHOWCASE_HINT)
else header(ke.LBL_PHOTO_SHOWCASE)
if(e.length){var a={y:L,y0:L,w:O,x_mid:K}
if(p&&t<Ie)(e=e.slice(0)).push("EXTRA_SLOT")
L=Ve({y_min:Y,y_max:j,dims:a,scroll_param:V,ctx:"showcase"},e)}if(p){if(le({x:K-or,y:L,z:d,w:2*or,h:ar,font_height:ir,text:ke.BTN_PHOTO_LIBRARY,img:_t.sprite,img_color:Xe,frame:_t.BTNICON_PHOTO})){Fe()
Ee.goRoute("u/me/photos")}L+=ar+tr}}}showPublicWorlds()
showPhotoShowcase()
showPrivateWorlds()
showFrozenWorlds()
L+=24
mr.end(L)
L=V.y+V.h
var q=mr.getScrollPos()
if(pr!==q){ve()
pr=q}}function userProfileViewOpen(e){Ee.goRoute("u/"+e)}function userProfileViewOpenToMyBoosts(){U="me"
Xt="boosts"
Zt=true
Ee.goRoute("u/me")}a.register({cmd:"user_view",help:"View user details",func:function func(e,t){userProfileViewOpen(e)
t()}})},{"../common/external_users/external_users_provider_ids":247,"../common/photo_common":256,"../common/store_data":262,"../common/types":263,"../common/world_constants":267,"../glov/client/cmds":298,"../glov/client/collapsagories":299,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/markdown":332,"../glov/client/markdown_parse":333,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/selection_box":350,"../glov/client/slider":355,"../glov/client/social":357,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/client/walltime":370,"../glov/common/util":400,"./account_ui":4,"./analytics":6,"./character_customization":39,"./costume_edit":65,"./fbinstant_worlds":96,"./localization/localization":131,"./main":135,"./menu":140,"./paperdoll":151,"./photo_list":157,"./platform_worlds_client":160,"./sharing/platform_share_handlers":185,"./status":193,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_details":209,"./user_info_view":210,"./user_party":211,"./waygate_ui":222,"./welcome_screen":224,"./world_comm":226,"./world_info":229,"./world_info_view":231,"./world_list":233,assert:void 0}],213:[function(e,t,r){"use strict"
r.makeAtlas=makeAtlas
var o=e("../common/atlas_common.js")
var n=e("../glov/client/engine.js")
var s=e("./tiles.js").tile_map_default
function canvasAllocator(e,t){var r=document.createElement("canvas")
r.width=e
r.height=t
var i=r.getContext("2d")
i.fillStyle="#000"
r.preClearRect=function(e,t,r,a){i.fillRect(e,t,r,a)}
r.drawImage=i.drawImage.bind(i)
return r}function makeAtlas(e,t,r){var a
var i="default"===e.tile_map?s.alpha_allow_map:null
if(n.webgl2)a=o.makeArray(e,i,r,canvasAllocator)
else a=o.makeAtlas(e,i,r,canvasAllocator)
return a}},{"../common/atlas_common.js":239,"../glov/client/engine.js":305,"./tiles.js":199}],214:[function(e,t,_){"use strict"
_.getViewDist=getViewDist
_.getDetailBudget=getDetailBudget
_.getFrustumPlanes=getFrustumPlanes
_.getThisFrameFrustumPlanes=getThisFrameFrustumPlanes
_.listAddMesh=listAddMesh
_.listRemoveMesh=listRemoveMesh
_.reload=reload
_.getKnownBounds=getKnownBounds
_.resetView=resetView
_.updateChunks=updateChunks
_.drawDebug=drawDebug
_.releaseClaimed=releaseClaimed
_.detailBudgetToPercentage=detailBudgetToPercentage
_.tickVCM=tickVCM
_.drawChunkManDebug=drawChunkManDebug
_.reset=reset
_.nearbyChunksWaiting=nearbyChunksWaiting
_.restartStreaming=restartStreaming
_.startStreaming=startStreaming
_.load_start=_.list_need_tick=_.list_need_update=_.list_need_draw=_.chunk_cur_pos=_.claim_dist_sq=_.view_dist=_.DRAW_COST_DYN_PROP=_.LOD_FORCE_HIGH=_.LOD_KEEP=_.LOD_FORCE_LOW=_.STREAM_ABS_DIST=_.PRIORITY_IMMEDIATE=_.PRIORITY_NORMAL=void 0
var r=1
_.PRIORITY_NORMAL=r
var a=2
_.PRIORITY_IMMEDIATE=a
var c=1
var u=c+4
_.STREAM_ABS_DIST=u
var T=-1
_.LOD_FORCE_LOW=T
var y=0
_.LOD_KEEP=y
var S=1
_.LOD_FORCE_HIGH=S
var n=2e3
_.DRAW_COST_DYN_PROP=n
var I=e("assert")
var i=e("gl-mat4/multiply")
var o=e("gl-mat4/perspective")
var s=e("../glov/client/browser").is_discrete_gpu
var l=e("../glov/client/cmds").cmd_parse
var A=e("../glov/client/engine")
var d=e("../glov/client/models")
var w=e("../glov/client/net").netDisconnected
var f=e("../glov/client/settings")
var v=e("../glov/client/shaders")
var h=e("../glov/client/textures")
var p=e("../glov/common/verify")
var m=e("../glov/common/vmath")
var E=m.mat4
var g=m.unit_vec
var L=m.v3addScale
var O=m.v3distSq
var R=m.v3lengthSq
var b=m.vec2
var N=m.vec3
var C=m.vec4
var x=e("../common/globals")
var M=x.CHUNK_SIZE
var D=x.ID2
var P=x.ID_FACTOR
var B=e("../common/megachunk_common").chunkPosFromId
var k=e("./camera")
var U=k.getActiveController
var G=k.getChunkViewMatrix
var F=k.getCurrentCameraPos
var W=k.getCurrentCameraTargetDir
var H=e("./debug")
var z=e("./lists").listCreate
var V=e("./megachunk_client")
var Y=e("./proc_gen_debug")
var j=e("./task_sched")
var K=j.WORKER_GEN
var q=j.workerFlush
var Z=j.workerReady
var X=e("./user_data").worldReadOnly
var Q=e("./voxel_const").origin_chunk
var $=e("./voxel_data")
var J=e("./voxel_data")
var ee=J.voxelDataGetDrawPerf
var te=J.voxelDataTopOfFrame
var re=e("./voxel_gen").voxelGensInProgress
var ae=e("./voxel_mesh")
var ie=ae.voxelMeshBusy
var oe=ae.voxelMeshDataSends
var ne=ae.voxelMeshFlush
var se=ae.voxelMeshesInProgress
var le=e("./world_claims")
var _e=le.CLAIM_BY_SELF
var ce=le.CLAIM_PENDING
var ue=le.claimFinalize
var de=le.getClaimCount
var fe=le.unclaim
var ve=e("./world_metadata").unlimitedMode
var he=Math.floor,pe=Math.max,me=Math.min,Ee=Math.round,ge=Math.sqrt
var Te
var ye=16
var Se=s?15:8
_.view_dist=Se
var Ie=.5
var Ae=.75*Se*(.75*Se)
_.claim_dist_sq=Ae
var we=1
var Le=5
var Oe=Le
var Re=2
var be=8
var Ne=Re
var Ce=N(-.5,-.5,.5)
_.chunk_cur_pos=Ce
var xe=0
var Me=E()
var De
var Pe=E()
var Be=0
var ke=0
var Ue=0
var Ge=0
var Fe
var We
var He
var ze
_.list_need_draw=ze
var Ve
_.list_need_update=Ve
var Ye
var je
_.list_need_tick=je
var Ke
var qe=0
var Ze=0
function getViewDist(){return Se}function getDetailBudget(){return Ie}function planeNormalize(e,t,r,a,i){var o=t*t+r*r+a*a
if(o>0){var n=1/ge(o)
e[0]=t*n
e[1]=r*n
e[2]=a*n
e[3]=i*n}else{e[0]=0
e[1]=0
e[2]=0
e[3]=0}}var Xe=[C(),C(),C(),C(),C()]
var Qe=N()
var $e
function getFrustumPlanes(e,t){$e=A.frame_index
var r=Pe
var a=r[0]
var i=r[1]
var o=r[3]
var n=r[4]
var s=r[5]
var l=r[7]
var _=r[8]
var c=r[9]
var u=r[11]
var d=r[12]
var f=r[13]
var v=r[15]
planeNormalize(Xe[0],o+a,l+n,u+_,-(v+d))
planeNormalize(Xe[1],o-a,l-n,u-_,-(v-d))
planeNormalize(Xe[2],o-i,l-s,u-c,-(v-f))
planeNormalize(Xe[3],o+i,l+s,u+c,-(v+f))
var h=W()
L(Qe,Q,F(),1/M)
L(Qe,Qe,h,A.ZFAR/M)
var p=h[0]*Qe[0]+h[1]*Qe[1]+h[2]*Qe[2]
planeNormalize(Xe[4],-h[0],-h[1],-h[2],-p)
if(e)Xe[4][3]+=A.ZFAR/M-e
if(t)for(var m=0;m<Xe.length;++m)Xe[m][3]-=t}function getThisFrameFrustumPlanes(){I.equal($e,A.frame_index)
return Xe}function v3distSkewSq(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])*4}function cmpChunkDist(e,t){var r=v3distSkewSq(Ce,e.pos)
return v3distSkewSq(Ce,t.pos)-r}function listPrepare(e,t){if(e.getVisible){getFrustumPlanes(Oe,t?Ne:0)
e.getVisible(Xe,cmpChunkDist)}else e.prepare()}function getChunkWorld(e,t,r){var a=(r*P+t)*P+e
var i=Te[a]
if(!i){(i=Te[a]=$.createWorldVD(e,t,r,a)).in_list_gen=true
xe++
Fe.add(i)}return i}function listAddMesh(e){I(!e.in_list_mesh)
I(e.did_gen)
if(!e.data&&!e.liquid){I(!e.geom_high)
I(!e.geom_alpha)
I(!e.geom_liquid)
e.mesh_dirty=0
e.fadeIn()
return}I(e.data||e.liquid)
I(e.did_gen||e.gen_in_progress)
if(e.mesh_dirty===r)He.add(e)
else We.add(e)
e.in_list_mesh=true}function listRemoveMesh(e){if(e.in_list_mesh){I(e.mesh_dirty)
if(e.mesh_dirty===a)We.remove(e)
else He.remove(e)
e.in_list_mesh=false}}function unload(e){if(e.in_list_gen)Fe.remove(e)
listRemoveMesh(e)
if(e.in_list_draw)ze.remove(e)
if(e.in_list_update)Ve.remove(e)
if(e.in_list_tick)je.remove(e)
e.unload();--xe}function reload(e){var t=e.pos,r=t[0],a=t[1],i=t[2]
unload(e)
getChunkWorld(r,a,i)}var Je=[b(),b(),b()]
var et=0
var tt=0
var rt=0
function getKnownBounds(){return Je}var at=N()
function updateChunkCurPos(){var e=U().getCameraPos()
if(A.DEBUG){var t=(Se+2)*M
I(R(e)<t*t||O(U().pos,e)<M*M*4)}L(at,Q,e,1/M)
L(Ce,at,g,-.5)}var it=8e3
var ot=new Int32Array(3)
var nt
var st
var lt
function streamInOutContinuous(){profilerStart("streamInOutContinuous")
var e=Q
var t=Se*Se/225*it
var r=Ee(A.frame_dt/1e3*t)
var o={}
var n={}
function finish(){profilerStart("unload")
for(var e in n){e=Number(e)
var t=Te[e]
delete Te[e]
n[e]=t}for(var r in n)unload(n[r])
profilerStopStart("alloc")
for(var a in o){a=Number(a)
var i=B(a)
getChunkWorld(i[0],i[1],i[2])}profilerStop()}while(r){if(!et){var a=void(lt=0)
for(var i=0;i<3;++i){if(Je[i][0]>Je[i][1]){finish()
p.equal(Object.keys(Te).length,0)
console.warn("Streamed out everything, resetting chunk view frame")
resetView()
return profilerStop("streamInOutContinuous")}var s=Je[i][1]+1-(e[i]+Se)
if(s<0||s>c){lt+=s<0?-he(s):he(s-c+1)
if(!a||a<0&&s<a||s>0&&s>a){a=s
tt=i
rt=1}}var l=e[i]-Se-Je[i][0]
if(l<0||l>c){lt+=l<0?-he(l):he(l-c+1)
if(!a||a<0&&l<a||l>0&&l>a){a=l
tt=i
rt=0}}}if(!a){finish()
return profilerStop("streamInOutContinuous")}if(a<0){et=1
Je[tt][rt]+=rt?1:-1}else{if(a>u){finish()
console.warn("Too far to incrementally stream "+a+", resetting chunk view frame")
resetView()
return profilerStop("streamInOutContinuous")}et=-1}nt=0===tt?1:0
st=2===tt?1:2
ot[tt]=Je[tt][rt]
ot[nt]=Je[nt][0]+0
ot[st]=Je[st][0]+0}do{var _=ot[0]+ot[1]*P+ot[2]*D
if(-1===et)if(o[_])delete o[_]
else{if(A.DEBUG)I(Te[_])
n[_]=true}else if(n[_])delete n[_]
else{if(A.DEBUG)I(!Te[_])
o[_]=true}--r
ot[nt]++
if(ot[nt]>Je[nt][1]){ot[nt]=Je[nt][0]+0
ot[st]++}if(ot[st]>Je[st][1]){if(-1===et)Je[tt][rt]+=rt?-1:1
et=0
break}}while(r)}finish()
return profilerStop("streamInOutContinuous")}function resetView(){if(!Te)return
profilerStart("resetView")
var e=Se
var t=-e
var r=Q[0]
var a=Q[1]
var i=Q[2]
for(var o=0;o<3;++o){Je[o][0]=Q[o]+t
Je[o][1]=Q[o]+e}var n={}
for(var s=t;s<=e;++s)for(var l=t;l<=e;++l)for(var _=t;_<=e;++_)n[getChunkWorld(r+_,a+l,i+s).chunk_id]=true
for(var c in Te)if(!n[c])unload(Te[c])
et=0
profilerStop("resetView")}function doOneGen(){var t=Fe.preparedPop()
I(t.in_list_gen)
t.in_list_gen=false
Fe.remove(t);++qe
t.doGen(function(e){I(!t.disposed)
I(!t.in_list_gen)
if(e){console.error("Error gening chunk "+t.chunk_id+": "+e)
if("ERR_FAILALL_DISCONNECT"!==e&&!String(e).includes("not on channel"))throw e
t.in_list_gen=true
Fe.add(t)}})
return t}function doOneMesh(e,t){++Ze
t.doMesh(e)}function updateMatrices(){De=G()
o(Me,A.fov_y,A.width/A.height,A.ZNEAR/M,A.ZFAR/M)
i(Pe,Me,De)
te()}function expectedGenCount(){return 100*(Oe+3)}var _t=1
var ct=2
function updateChunksMeshLocal(e){ke=pe(ke,He.length())
listPrepare(He,false)
Ge=He.preparedLength()
while(He.preparedLength()){var t=He.preparedPop()
listRemoveMesh(t)
doOneMesh(true,t)
if(Date.now()>=e)return _t}return 0}function updateChunksMeshWorkers(){if(ie())return ct
ke=pe(ke,He.length())
listPrepare(He,false)
Ge=He.preparedLength()
while(He.preparedLength()){var e=He.preparedPop()
listRemoveMesh(e)
I(Te[e.chunk_id]===e)
I.equal(e.gened_neighbors,$.NEIGHBOR_MASK_ALL)
I(e.did_gen)
doOneMesh(false,e)
if(ie())return _t}return 0}function updateChunksMesh(e){while(We.arr.length){var t=We.arr.pop()
I(t.in_list_mesh)
t.in_list_mesh=false
doOneMesh(true,t)}if(A.defines.NOWORKERS||A.defines.NOMESHWORKERS)return updateChunksMeshLocal(e)
else{var r=updateChunksMeshWorkers()
ne()
return r}}function updateChunksGenLocal(e){var t=Date.now()
listPrepare(Fe,true)
Ue=Fe.preparedLength()
e+=Date.now()-t
while(Fe.preparedLength()){doOneGen()
if(Date.now()>=e)return _t}return 0}function updateChunksGenWorkers(){if(!Z(K)){q(K)
return ct}listPrepare(Fe,true)
Ue=Fe.preparedLength()
while(Fe.preparedLength()){doOneGen()
if(!Z(K))return _t}return 0}var ut
var dt
_.load_start=dt
function updateChunks(e){var t=Date.now()
if(Ne>Re){if(!ut){Y.dumpPerf()
console.log("gen and mesh done in "+(t-dt)+"ms")
ut=true}e/=2}updateMatrices()
var r=t+e
var a=r
if(e===ye)a=t+me(e,.5*A.frame_dt)
if(!(A.frame_index%60))ke=Be=0
if(updateChunksMesh(a)){Ue=pe(Ue,1)
return}Be=pe(Be,Fe.length())
var i
if(!A.defines.NOWORKERS){i=updateChunksGenWorkers()
q(K)}else i=updateChunksGenLocal(r)
if(i){Ge=pe(Ge,1)
if(i!==ct&&Fe.preparedLength()>=expectedGenCount())if(Ne>Re)Ne--
else Oe=pe(we,Oe-1)
return}if(Oe===Se+1){if(!re())Ne=me(Ne+1,be)}else Oe=me(Se+1,Oe+1)}var ft=E()
var vt=C(1,0,0,1)
var ht=C(1,1,0,1)
var pt=C(0,0,1,1)
var mt=C(0,1,1,1)
var Et=C(0,1,0,1)
var gt=C(1,0,1,1)
function drawDebug(){ft[0]=ft[5]=ft[10]=4
gl.disable(gl.BLEND)
var e=d.models.box
h.bind(0,h.textures.white)
for(var t in Te){var r=Te[t]
if(r.shift_gen!==$.shift_gen)r.updateMat()
ft[12]=r.mat[12]+6+1
ft[13]=r.mat[13]+6+1
ft[14]=r.mat[14]+6+1
A.updateMatrices(ft)
v.bind(d.default_vshader,d.default_fshader,{color:!r.did_gen?vt:!r.data&&!r.liquid?r.in_list_draw?gt:pt:r.mesh_dirty||r.in_list_mesh?ht:!r.geom_high&&!r.geom_alpha&&!r.props&&!r.geom_liquid?mt:Et})
e.drawGeom(ft)}}function releaseClaimed(){if(Ye)for(var e=0;e<Ye.length;++e){var t=Ye[e]
if(t.claimed===_e||t.claimed===ce)fe(t)}if(de()){for(var r in Te){var a=Te[r]
if(a.claimed===_e||a.claimed===ce)fe(a)}I(!de())}ue()}function cmpDistanceFrontToBack(e,t){return e.distsq-t.distsq}var Tt=0
var yt=[]
var St=[]
var It
var At=true
var wt=1
var Lt=null
function resetVisHead(){while(Lt){var e=Lt.vis_next
Lt.vis_next=null
Lt=e}++wt}var Ot=12e5
var Rt=.1
var bt=0
function sqr(e){return e*e}function detailBudgetToPercentage(e){if(e<=.5)return e/.5
else if(1===e)return Infinity
else return 2*e+10*sqr(2*(e-.5))}function calcHighDetailBudget(){bt=Ee(Ot*Se/15)
bt*=detailBudgetToPercentage(Ie)
bt=Ee(bt)}function resetDynamicRenderDistance(){At=true
calcHighDetailBudget()}var Nt=1
function tickVCM(){updateChunkCurPos()
if(!w()){if(!X()&&!(Tt&&ve())){profilerStart("VD:updateState")
$.updatePrepare()
for(var e=0;e<Ye.length;++e)Ye[e].updateState()
$.updateFinalize()
profilerStop("VD:updateState")}else releaseClaimed()
profilerStart("VD:tick")
for(var t=0;t<Ke.length;++t)Ke[t].tick()
profilerStop("VD:tick")}streamInOutContinuous()
profilerStart("gen&mesh")
updateChunks(ye)
profilerStopStart("draw setup")
gl.disable(gl.BLEND)
$.drawBulkStart()
ze.tree.finalize()
getFrustumPlanes(0,0)
var r=ze.tree.getVisibleNodes(Xe,yt,0)
It=r
var a=bt
var i=-Rt*a
if(!isFinite(a)||A.defines.FULLSORT){if(Lt)resetVisHead()
if(At){profilerStopStart("dist calc")
for(var o=0;o<r;++o){var n=yt[o]
n.distsq=O(Ce,n.pos)}if(yt.length!==r)yt.length=r
profilerStopStart("sort")
yt.sort(cmpDistanceFrontToBack)}profilerStopStart("draw nodes")
var s=S
for(var l=0;l<r;++l){var _=yt[l]
a-=_.draw_cost_high
if(At)if(_.distsq>Nt)if(s===S&&a<0)s=y
else if(s===y&&a<i)s=T
_.draw2(s)}}else{profilerStopStart("dist and new vis calc")
var c=wt;++wt
var u=0
for(var d=0;d<r;++d){var f=yt[d]
if(f.vis_gen!==c)St[u++]=f
f.distsq=O(Ce,f.pos)
f.vis_gen=wt}if(u){St.length=u
St.sort(cmpDistanceFrontToBack)}profilerStopStart("sort draw nodes")
var v=S
var h=0
var p=null
var m=Lt
while(m||h<u){while(m&&m.vis_gen!==wt){if(p)p.vis_next=m.vis_next
else{I(Lt===m)
Lt=m.vis_next}m=m.vis_next}if(m){var E=m.vis_next
if(E&&E.vis_gen===wt&&m.distsq>E.distsq){m.vis_next=E.vis_next
E.vis_next=m
if(p)p.vis_next=E
else{I(Lt===m)
Lt=E}m=E}}var g=h<u?St[h]:null
if(g&&(!m||g.distsq<m.distsq)){if(p)p.vis_next=g
else{I(Lt===m)
Lt=g}h++
g.vis_next=m
m=g}if(!m)break
a-=m.draw_cost_high
if(m.distsq>Nt)if(v===S&&a<0)v=y
else if(v===y&&a<i)v=T
m.draw2(v)
m=(p=m).vis_next}I.equal(h,u)}At=a<0
$.drawBulkEnd()
profilerStop()}function drawChunkManDebug(){if(A.defines.CHUNKMAN){var e=ee(),t=e.dynamic_drawn,r=e.tricount_high_high,a=e.tricount_high_mid,i=e.tricount_low_mid,o=e.tricount_low_low
H.addText(["Chunks Need Gen: "+Ue+" / "+Fe.length()+" ("+Be+")","Chunks Gen Queued: "+re(),"Chunks Need Mesh: "+He.length()+" ("+ke+")","Chunks Mesh Queued: "+se()+"  Data Sends: "+oe(),"Chunks Need Update: "+Ye.length+" ("+de()+" claimed)","Chunks Need Tick: "+Ke.length,"Chunks Draw: "+It+" / "+ze.length()+(Lt||At?" (sorted)":""),"Tris High + Mid: "+r+" + "+a+" (of "+bt+")","Tris Low + Mid: "+o+" + "+i,"Dynamic Props: "+t+" drawcalls (cost "+t*n+" tris)","Chunks Active: "+xe,"Chunks Gen'd: "+qe+" ("+$.timing.gen+"ms)","Chunks Mesh'd: "+Ze+" ("+$.timing.mesh+"ms)","Chunk Gen Dist: "+Oe+" +/-"+Ne,"Stream State: "+et+(et?" "+tt+":"+rt+" ("+lt+")":"")].join("\n"))
It=0}}function reset(){Oe=Le
qe=Ze=xe=0
Fe=z({type:"hybrid4",name:"need_gen",log_rebuilds:true})
He=z({type:"fifo",name:"need_mesh_normal"})
We=z({type:"lifo",name:"need_mesh_high"})
_.list_need_draw=ze=z({type:"aabbtree",name:"need_draw"})
_.list_need_update=Ve=z({type:"lifo",name:"need_update"})
Ye=Ve.arr
_.list_need_tick=je=z({type:"lifo",name:"need_tick"})
Ke=je.arr
Te=$.chunk_map
resetVisHead()
yt=[]
St=[]}var Ct
var xt=81
function nearbyChunksWaiting(){Ct=Ct.filter(function(e){return(!e.vd.did_gen||e.vd.mesh_dirty||e.vd.mesh_in_flight)&&e.vd.reused===e.reused})
var e=0
var t=0
for(var r=0;r<Ct.length;++r){var a=Ct[r].vd
if(!a.did_gen)e++
else if(a.in_list_mesh||a.mesh_in_flight)t++}var i=e+t
if(i||Oe<Le)Oe=Le
if(Oe===Le)i+=Ue+Ge
return i}function queueNearbyLoads(){Ct=[]
updateChunkCurPos()
Ce[2]-=.5
updateMatrices()
listPrepare(Fe,true)
var e=xt
while(e&&Fe.preparedLength()){var t=doOneGen()
Ct.push({reused:t.reused,vd:t});--e}if(!A.defines.NOWORKERS)q(K)
var r=Date.now()-dt
console.log("Initial view reset in "+r+"ms, waiting for "+Ct.length+" loads...")}function restartStreaming(){_.load_start=dt=Date.now()
ut=false
Oe=Le
Ne=Re
resetDynamicRenderDistance()
resetView()
queueNearbyLoads()}function startStreaming(){_.load_start=dt=Date.now()
ut=false
Oe=Le
Ne=Re
resetDynamicRenderDistance()
var e=Se
var t=-e
var r=Q[0]
var a=Q[1]
var i=Q[2]
for(var o=0;o<3;++o){Je[o][0]=Q[o]+t
Je[o][1]=Q[o]+e}for(var n=t;n<=e;++n)for(var s=t;s<=e;++s)for(var l=t;l<=e;++l)getChunkWorld(r+l,a+s,i+n)
et=0
queueNearbyLoads()}l.registerValue("view_dist",{type:l.TYPE_INT,label:"View Distance",range:[5,30],set:function set(e){_.view_dist=Se=e
var t=pe(1,.75*Se)
_.claim_dist_sq=Ae=t*t
if(dt){resetView()
V.shift()}resetDynamicRenderDistance()},get:function get(){return Se},store:true})
f.register({detail_budget:{type:l.TYPE_FLOAT,label:"High Detail Triangle Budget Scalar",help:"Value used to determine how many triangles are of high details are rendered",range:[0,1],default_value:Ie,on_change:function on_change(){Ie=f.detail_budget
resetDynamicRenderDistance()}}})
if(Ie<.05&&!A.DEBUG)f.set("detail_budget",.5)
l.registerValue("view_dist_temp",{type:l.TYPE_INT,label:"View Distance (not persisted, may crash)",range:[3,1e3],set:function set(e){_.view_dist=Se=e
var t=pe(1,.75*me(Se,30))
_.claim_dist_sq=Ae=t*t
resetView()
V.shift()
resetDynamicRenderDistance()},get:function get(){return Se},store:false})
l.registerValue("sim_pause",{type:l.TYPE_INT,label:"Pause Simulation",help:"Pause all local simulation (water, crops, physics, etc)",range:[0,1],set:function set(e){Tt=e},get:function get(){return Tt},store:A.DEBUG})},{"../common/globals":248,"../common/megachunk_common":254,"../glov/client/browser":293,"../glov/client/cmds":298,"../glov/client/engine":305,"../glov/client/models":337,"../glov/client/net":338,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/textures":365,"../glov/common/verify":401,"../glov/common/vmath":402,"./camera":35,"./debug":73,"./lists":127,"./megachunk_client":139,"./proc_gen_debug":165,"./task_sched":198,"./user_data":208,"./voxel_const":215,"./voxel_data":216,"./voxel_gen":219,"./voxel_mesh":220,"./world_claims":225,"./world_metadata":235,assert:void 0,"gl-mat4/multiply":void 0,"gl-mat4/perspective":void 0}],215:[function(e,t,r){"use strict"
r.origin_chunk=void 0
var a=new Int32Array([0,0,0])
r.origin_chunk=a},{}],216:[function(e,t,v){"use strict"
v.setFlashlight=setFlashlight
v.voxelDataGetDrawPerf=voxelDataGetDrawPerf
v.VoxelData=VoxelData
v.createWorldVD=createWorldVD
v.createUtilVD=createUtilVD
v.chunkIdFromLocalIntPos=chunkIdFromLocalIntPos
v.andGetLocalPos=andGetLocalPos
v.chunkIdFromLocalFloatPos=chunkIdFromLocalFloatPos
v.posPairFromLocalIntPos=posPairFromLocalIntPos
v.getLocalPosFromChunkID=getLocalPosFromChunkID
v.getLocalPosFromChunkIDIfAvailable=getLocalPosFromChunkIDIfAvailable
v.getWorldPosFromChunkID=getWorldPosFromChunkID
v.worldPosFromLocalPos=worldPosFromLocalPos
v.localPosFromWorldPos=localPosFromWorldPos
v.getLocalPosFromPosPair=getLocalPosFromPosPair
v.getVDFromLocalPos=getVDFromLocalPos
v.getGenMiss=getGenMiss
v.resetGenMiss=resetGenMiss
v.voxelDataChunkIsReady=voxelDataChunkIsReady
v.getTileLocal=getTileLocal
v.getTilePosPair=getTilePosPair
v.queuedPlaceSet=queuedPlaceSet
v.queuedPlaceClear=queuedPlaceClear
v.queuedPlaceReset=queuedPlaceReset
v.getTileLocalOrQueuedPlace=getTileLocalOrQueuedPlace
v.getTileRelative=getTileRelative
v.andGetChunkID=andGetChunkID
v.andGetLiquid=andGetLiquid
v.andGetLightDebug=andGetLightDebug
v.markChunkSpoiled=markChunkSpoiled
v.markChunkUnspoiled=markChunkUnspoiled
v.transSetTileDirect=transSetTileDirect
v.transSetTileLocal=transSetTileLocal
v.transSetTilePosPair=transSetTilePosPair
v.transSetTileRelative=transSetTileRelative
v.setTileRelative=setTileRelative
v.getPropDirect=getPropDirect
v.setPropDirect=setPropDirect
v.removePropDirect=removePropDirect
v.replacePropDirect=replacePropDirect
v.propUpdate=propUpdate
v.getPropLocalExact=getPropLocalExact
v.getPropLocal=getPropLocal
v.getPropRelativeFromTile=getPropRelativeFromTile
v.andGetProp=andGetProp
v.getPropRelative=getPropRelative
v.removeProp=removeProp
v.ensurePristineSendProp=ensurePristineSendProp
v.assertPropPristineSend=assertPropPristineSend
v.transPropRemove=transPropRemove
v.transSetPropLocal=transSetPropLocal
v.transPropUpdate=transPropUpdate
v.transPropUpdateField=transPropUpdateField
v.transBagAdd=transBagAdd
v.transItemAnim=transItemAnim
v.getPropLighting=getPropLighting
v.getPropLighting2Prop=getPropLighting2Prop
v.voxelDataDirtyCacheStart=voxelDataDirtyCacheStart
v.voxelDataDirtyCacheEnd=voxelDataDirtyCacheEnd
v.propStateUpdate=propStateUpdate
v.propInWorld=propInWorld
v.exportCombinedGeometry=exportCombinedGeometry
v.drawProp=drawProp
v.drawPropQueued=drawPropQueued
v.voxelDataTopOfFrame=voxelDataTopOfFrame
v.drawBulkStart=drawBulkStart
v.drawBulkEnd=drawBulkEnd
v.updatePrepare=updatePrepare
v.updateFinalize=updateFinalize
v.liquidUpdateDefer=liquidUpdateDefer
v.remeshAll=remeshAll
v.voxelDataWorldMetaChanged=voxelDataWorldMetaChanged
v.reset=reset
v.drawSingleVoxel=drawSingleVoxel
v.drawSingleVoxelTextured=drawSingleVoxelTextured
v.shift=shift
v.VoxelSimpleDrawable=VoxelSimpleDrawable
v.loadGoxel=loadGoxel
v.createSimpleDrawable=createSimpleDrawable
v.tickVD=tickVD
v.applyBevelParamWorld=applyBevelParamWorld
v.applyBevelParamCharacters=applyBevelParamCharacters
v.applyBevelValue=applyBevelValue
v.recalcAtlasParams=recalcAtlasParams
v.startup=startup
v.chunksGenedNear=v.atlas_params_voxel_util_fp=v.atlas_params_voxel_util_vp=v.voxel_util_atlas_params=v.primary_atlas_params=v.NEIGHBOR_MASK_ALL=v.beamcast3DLocal2=v.beamcast3DLocal=v.raycast3DLocalCB=v.raycast3DLocal=v.raycastLocal=v.gatherProps=v.shift_gen=v.bevel_available=v.bevel_value=v.lighting_value=v.chunk_map=v.flashlight=v.timing=v.pack_tex_params=v.pack_textures=v.white_mask=v.pack_texture=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var h=e("./voxel_const").origin_chunk
v.origin_chunk=h
var w=e("assert")
var c=e("gl-mat4/translate")
var r=e("../glov/client/browser").is_discrete_gpu
var a=e("../glov/client/cmds").cmd_parse
var u=e("../glov/client/draw_list")
var S=e("../glov/client/engine")
var i=e("../glov/client/engine")
var o=i.defineOnChange
var n=i.definesChanged
var I=e("../glov/client/error_report").hasCrashed
var s=e("../glov/client/geom").geomCreateQuads
var l=e("../glov/client/hsv").hsvToRGB
var _=e("../glov/client/mat4ScaleRotateTranslate")
var d=e("../glov/client/net").netDisconnected
var f=e("../glov/client/perf").perf_mem_counters
var p=e("../glov/client/quat").unit_quat
var m=e("../glov/client/settings")
var E=e("../glov/client/shaders")
var g=e("../glov/client/shaders")
var T=g.SEMANTIC
var y=g.shaderCreate
var A=g.shadersAddGlobal
var L=g.shadersBind
var O=g.shadersPrelink
var R=g.shadersRequirePrelink
var b=e("../glov/client/textures")
var N=b.TEXTURE_FORMAT
var C=b.textureBind
var x=b.textureBindArray
var M=b.textureIsArrayBound
var D=b.textureLoad
var P=b.textureUnloadDynamic
var B=b.textureWhite
var k=e("../glov/client/urlhash").getURLBase
var U=e("../glov/common/util")
var G=U.clamp
var F=U.defaults
var W=U.easeOut
var H=U.empty
var z=U.inherits
var V=U.isInteger
var Y=U.randomNot
var j=U.toNumber
var K=e("../glov/common/verify")
var q=e("../glov/common/vmath")
var Z=q.half_vec
var X=q.mat4
var Q=q.unit_vec
var $=q.v2scale
var J=q.v3add
var ee=q.v3addScale
var te=q.v3copy
var re=q.v3distSq
var ae=q.v3dot
var ie=q.v3floor
var oe=q.v3iAdd
var ne=q.v3iFloor
var se=q.v3same
var le=q.v3scale
var _e=q.v3scaleFloor
var ce=q.v3set
var ue=q.v3sub
var de=q.v4copy
var fe=q.v4set
var ve=q.vec1
var he=q.vec2
var pe=q.vec3
var me=q.vec4
var Ee=q.zero_vec
var ge=e("../common/globals")
var Te=ge.CHUNK_SIZE
var ye=ge.CS2
var Se=ge.CS3
var Ie=ge.ID2
var Ae=ge.ID_FACTOR
var we=e("../common/ids").TYPE_ITEM
var Le=e("../common/materials_common").Mat
var Oe=e("../common/voxel_data_common")
var Re=Oe.ANIM_TYPE_POS
var be=Oe.LIGHT_DECREASE
var Ne=Oe.LIGHT_INCREASE
var Ce=Oe.TORCH_DECREASE
var xe=Oe.TORCH_INCREASE
var Me=Oe.UNCHUNKED_ID
var De=Oe.VoxelDataBase
var Pe=Oe.voxel_data_mem_tracker
var Be=e("../common/world_trans")
var ke=Be.decodeChunkPos
var Ue=Be.encodeChunkPos
var Ge=Be.worldTransSetPropCheck
var Fe=e("./atlas_params.json")
var We=e("./biome_types")
var He=e("./client_entities").getMyEntID
var ze=e("./editvolume_clear").editVolumeClearContentsInProgress
var Ve=e("./editvolume_client")
var Ye=Ve.inEditBounds
var je=Ve.inEditBoundsByChunkId
var Ke=e("./item_anims")
var qe=e("./items").createItem
var Ze=e("./light_calc")
var Xe=Ze.LIGHT_FADE_HORIZ
var Qe=Ze.sun_table
var $e=Ze.torch_table
var Je=e("./line3d").pointLineDist
var et=e("./liquid")
var tt=e("./liquid")
var rt=tt.liquidStartup
var at=tt.liquidUpdateDeferInternal
var it=tt.liquidUpdateFinalize
var ot=tt.liquidUpdatePrepare
var nt=tt.liquidUpdateReset
var st=tt.updateLiquid
var lt=e("./localization/localization").L
var _t=e("./lods")
var ct=e("./main")
var ut=e("./megachunk_client")
var dt=e("./megachunk_client").detailGenAttachChoices
var ft=e("./mesh_calc")
var vt=ft.BYTES_PER_VERT
var ht=ft.meshCalc
var pt=ft.meshCalcReset
var mt=ft.meshCalcShadowBuf
var Et=e("./mesh_exporter").meshExport
var gt=e("./proc_gen_biomes")
var Tt=gt.getChunkTintColor
var yt=gt.getVSTintColors
var St=e("./props")
var It=St.propCreate
var At=St.propFromJSON
var wt=e("./sky").skyGetTorchColors
var Lt=e("./status")
var Ot=e("./tiles")
var Rt=e("./tiles")
var bt=Rt.TILE_HIT_LIQUID
var Nt=Rt.TILE_INTANGIBLE
var Ct=Rt.TILE_NON_OPAQUE
var xt=Rt.TILE_PROP_BASE
var Mt=Rt.TILE_PROP_MAX
var Dt=Rt.TILE_TINT_GRASS
var Pt=Rt.TILE_TINT_MAX
var Bt=Rt.TILE_TINT_ORE
var kt=Rt.TILE_UNDIGABLE
var Ut=Rt.tileMapIdentityTinted
var Gt=Rt.tile_map_identity
var Ft=e("./user_data").worldReadOnly
var Wt=e("./voxel_chunk_manager")
var Ht=e("./voxel_chunk_manager")
var zt=Ht.DRAW_COST_DYN_PROP
var Vt=Ht.LOD_FORCE_HIGH
var Yt=Ht.LOD_FORCE_LOW
var jt=Ht.PRIORITY_IMMEDIATE
var Kt=Ht.PRIORITY_NORMAL
var qt=e("./voxel_data_xraw").voxelDataXRAWStartup
var Zt=e("./voxel_gen")
var Xt=Zt.voxelGen
var Qt=Zt.voxelGenAttachHexomeChoices
var $t=Zt.voxelGenReset
var Jt=e("./voxel_mesh")
var er=Jt.voxelMesh
var tr=Jt.voxelMeshNotifyLoaded
var rr=Jt.voxelMeshReset
var ar=Jt.voxelMeshStartup
var ir=Jt.voxelMeshUnload
var or=e("./world_claims")
var nr=or.CLAIM_BY_SELF
var sr=or.CLAIM_UNKNOWN
var lr=or.claim
var _r=or.claimFinalize
var cr=or.unclaim
var ur=e("./world_comm")
var dr=ur.getPerm
var fr=ur.refreshProp
var vr=ur.worldGetTile
var hr=e("./world_metadata")
var pr=hr.adventureMode
var mr=hr.worldBoostLevel
var Er=hr.worldFactories
var gr=hr.worldFlora
var Tr=hr.worldLiquid
var yr=hr.worldSeed
var Sr=Math.ceil,Ir=Math.floor,Ar=Math.max,wr=Math.min
w(vt)
w(jt)
f.chunks=Pe
var Lr={}
var Or
var Rr
var br={}
var Nr
var Cr
var xr
var Mr
var Dr
var Pr
var Br
v.pack_texture=Br
var kr
var Ur
v.white_mask=Ur
var Gr=[]
v.pack_textures=Gr
var Fr
var Wr
var Hr
var zr
v.pack_tex_params=zr
var Vr={mesh:0,gen:0}
v.timing=Vr
var Yr=0
v.flashlight=Yr
function setFlashlight(e){v.flashlight=Yr=e}var jr=[]
v.chunk_map=jr
var Kr=1
var qr=1
v.lighting_value=qr
var Zr=r?1:0
v.bevel_value=Zr
var Xr
v.bevel_available=Xr
var Qr=true
var $r=500
var Jr=[[1,2],[0,2],[0,1]]
var ea=Ut(256)
var ta=0
v.shift_gen=ta
var ra
var aa=0
var ia=0
var oa=0
var na=0
function voxelDataGetDrawPerf(){return{dynamic_drawn:ra,tricount_high_high:aa,tricount_high_mid:ia,tricount_low_mid:oa,tricount_low_low:na}}var sa=0
var la=500
var _a=me()
var ca=pe()
var ua=.3
var da=.01
function VoxelData(e,t,r,a,i){this.vis_gen=0
this.vis_next=null
this.distsq=0
this.pos=new Int32Array(3)
this.pos_world=new Int32Array(3)
this.mat=X()
this.reused=0
this.light_torch=null
this.light_sun=null
this.color=me(1,1,1,1)
this.cutout=ve(ua)
this.shader_params={atlas_params_vp:_a,atlas_params_fp:ca,color:this.color,cutout:this.cutout}
this.mem_tracker=Pe
this.mem_tracker.count++
this.init(e,t,r,a,i)}z(VoxelData,De)
VoxelData.prototype.init=function(e,t,r,a,i){this.baseInit(e,t,r,a,i);++this.reused
this.main_world=a!==Me
this.vsid=t*Ae+e
this.mcid=void 0
this.disposed=false
this.geom_high=null
this.geom_high_tricount=0
this.geom_mid_start=0
this.geom_midlow_tricount=0
this.geom_highmid_tricount=0
this.geom_low_start=0
this.geom_low_tricount=0
this.last_was_low=false
this.geom_alpha=null
this.geom_liquid=null
this.draw_cost_high=0
this.draw_cost_high_base=0
this.draw_cost_low=0
this.shift_gen=0
this.did_gen=false
this.did_mesh=false
this.load_timestamp=0
this.drew_high_timestamp=0
this.drew_low_timestamp=0
this.low_fade_alpha=0
this.gen_in_progress=false
this.mesh_dirty=0
this.gened_neighbors=0
this.tile_map=Ot.tile_map_default
this.liquid_unstable=true
this.last_liquid_tick=0
this.has_updatable_prop=false
this.in_list_gen=false
this.in_list_mesh=false
this.in_list_draw=false
this.in_list_update=false
this.in_list_tick=false
this.did_prop_check=false
this.full=false
this.claimed=sr
this.claim_throttle=0
this.mesh_in_flight=false
this.geom_ver_meshing=0
this.ver_data=1
this.ver_meshing=1
this.ver_props=1
this.light_dirty=0
this.lighting_batch_id=0
this.sent_pristine=false
this.baked_props=null
this.drawable_props=null
this.has_ore=false
this.has_ore_ver=0}
VoxelData.prototype.updateMat=function(){this.mat[12]=(this.pos[0]-h[0])*Te-1
this.mat[13]=(this.pos[1]-h[1])*Te-1
this.mat[14]=(this.pos[2]-h[2])*Te-1
this.shift_gen=ta}
var fa=8e3
var va=[]
function createWorldVD(e,t,r,a,i){if(va.length){var o=va.pop()
o.init(e,t,r,a,i)
return o}return new VoxelData(e,t,r,a,i)}function createUtilVD(e,t){var r=new VoxelData(0,0,0,Me,e)
r.cutout[0]=da
r.alloc(t)
return r}VoxelData.prototype.deserializeProp=function(e){var t=At(e[3],null,this.main_world)
t.chunk_id=this.chunk_id
t.setPos(e)
return t}
VoxelData.prototype.serializeProp=function(e){return[e.pos[0],e.pos[1],e.pos[2],e]}
VoxelData.prototype.deserialize=function(e){var t=De.prototype.deserialize.call(this,e)
if(t){if(this.main_world){this.updateHasUpdatableProp(false)
this.updateHasTickableProp(false)
this.liquid_unstable=true}this.dirty()}return t}
var ha=new Int32Array(3)
var pa=new Int32Array(3)
function chunkIdFromLocalIntPos(e){ha[0]=Ir(e[0]/Te)
ha[1]=Ir(e[1]/Te)
ha[2]=Ir(e[2]/Te)
pa[0]=e[0]-ha[0]*Te
pa[1]=e[1]-ha[1]*Te
pa[2]=e[2]-ha[2]*Te
ha[0]+=h[0]
ha[1]+=h[1]
ha[2]+=h[2]
return(ha[2]*Ae+ha[1])*Ae+ha[0]}function andGetLocalPos(){return pa}function chunkIdFromLocalFloatPos(e,t){ha[0]=Ir(t[0]/Te)
ha[1]=Ir(t[1]/Te)
ha[2]=Ir(t[2]/Te)
e[0]=t[0]-ha[0]*Te
e[1]=t[1]-ha[1]*Te
e[2]=t[2]-ha[2]*Te
ha[0]+=h[0]
ha[1]+=h[1]
ha[2]+=h[2]
return(ha[2]*Ae+ha[1])*Ae+ha[0]}function posPairFromLocalIntPos(e){ha[0]=Ir(e[0]/Te)
ha[1]=Ir(e[1]/Te)
ha[2]=Ir(e[2]/Te)
pa[0]=e[0]-ha[0]*Te
pa[1]=e[1]-ha[1]*Te
pa[2]=e[2]-ha[2]*Te
ha[0]+=h[0]
ha[1]+=h[1]
ha[2]+=h[2]
return[(ha[2]*Ae+ha[1])*Ae+ha[0],(pa[2]*Te+pa[1])*Te+pa[0]]}VoxelData.prototype.getLocalPos=function(e){e[0]=(this.pos[0]-h[0])*Te
e[1]=(this.pos[1]-h[1])*Te
e[2]=(this.pos[2]-h[2])*Te
return e}
function getLocalPosFromChunkID(e,t,r){var a=jr[t]
if(a){ue(e,a.pos,h)
ee(e,r,e,Te)}else w(0)}function getLocalPosFromChunkIDIfAvailable(e,t,r){var a=jr[t]
if(a){ue(e,a.pos,h)
ee(e,r,e,Te)
return true}else return false}function getWorldPosFromChunkID(e,t,r){var a=jr[t]
if(a)J(e,a.pos_world,r)
else w(0)}function worldPosFromLocalPos(e,t){return ee(e,t,h,Te)}function localPosFromWorldPos(e,t){return ee(e,t,h,-Te)}function getLocalPosFromPosPair(e,t){getLocalPosFromChunkID(e,t[0],ke(t[1]))}function getVDFromLocalPos(e){var t=chunkIdFromLocalIntPos(e)
return jr[t]}var ma=0
function getGenMiss(){return ma}function resetGenMiss(){ma=0}function voxelDataChunkIsReady(e){var t=jr[e]
return t&&t.did_gen}var Ea
var ga
function getTileLocal(e,t,r){var a=chunkIdFromLocalIntPos(e)
var i=Ea=jr[a]
if(!i||!i.did_gen){++ma
return ga=t}if(!r&&!i.data||r&&!i.liquid)return ga=0
return ga=i.get(pa,r)}function getTilePosPair(e,t,r){w(e[1]>=0&&e[1]<4096)
var a=jr[e[0]]
if(!a||!a.did_gen)return t
var i=r?a.liquid:a.data
if(!i)return 0
return i[e[1]]}var Ta={}
function queuedPlaceSet(e,t){w(t)
var r=chunkIdFromLocalIntPos(e)
var a=Ta[r]
if(!a)a=Ta[r]={}
var i=pa[0]+pa[1]*Ae+pa[2]*Ie
w(!a[i])
a[i]=t}function queuedPlaceClear(e){var t=chunkIdFromLocalIntPos(e)
var r=Ta[t]
w(r)
var a=pa[0]+pa[1]*Ae+pa[2]*Ie
w(r[a])
delete r[a]
if(H(r))delete Ta[t]}function queuedPlaceReset(){Ta={}}function getTileLocalOrQueuedPlace(e,t,r){var a=chunkIdFromLocalIntPos(e)
var i=Ea=jr[a]
if(!i||!i.did_gen){++ma
return t}var o
if(!r&&!i.data||r&&!i.liquid)o=0
else o=i.get(pa,r)
if(!o){var n=Ta[a]
if(n){var s=pa[0]+pa[1]*Ae+pa[2]*Ie
if(n[s])o=n[s]}}return ga=o}function getTileRelative(e,t,r,a){w.equal(typeof e,"number")
te(pa,t)
var i=Ir(pa[0]/Te)
pa[0]-=Te*i
e+=i
i=Ir(pa[1]/Te)
pa[1]-=Te*i
e+=i*Ae
i=Ir(pa[2]/Te)
pa[2]-=Te*i
var o=Ea=jr[e+=i*Ie]
if(!o||!o.did_gen){++ma
return r}if(!a&&!o.data||a&&!o.liquid)return 0
return ga=o.get(pa,a)}function andGetChunkID(){return Ea.chunk_id}function andGetLiquid(e){var t=Ea
if(!t||!t.did_gen)return e
if(!t.liquid)return 0
return t.get(pa,true)}function andGetLightDebug(){var e=Ea
if(!e||!e.did_gen)return{}
var t=pa[2]*ye+pa[1]*Te+pa[0]
return{torch:e.light_torch?e.light_torch[t]:-1,sun:e.light_sun?e.light_sun[t]:-1}}function neighborLightingGet(e,t,r){var a=jr[t]
var i=a&&a[e]
return i&&i[r]||0}function predictLighting(e,t,r){var a=e[t]
var i=0
if(15!==pa[2]){if(a)i=Ar(i,a[r+ye])}else i=Ar(i,neighborLightingGet(t,e.chunk_id+Ie,r-3840))
if(255===i&&"light_sun"===t){if(!a)a=e[t]=new Uint8Array(Se)
a[r]=i
return}if(0!==pa[0]){if(a)i=Ar(i,a[r-1])}else i=Ar(i,neighborLightingGet(t,e.chunk_id-1,r+15))
if(15!==pa[0]){if(a)i=Ar(i,a[r+1])}else i=Ar(i,neighborLightingGet(t,e.chunk_id+1,r-15))
if(0!==pa[1]){if(a)i=Ar(i,a[r-16])}else i=Ar(i,neighborLightingGet(t,e.chunk_id-Ae,r+240))
if(15!==pa[1]){if(a)i=Ar(i,a[r+16])}else i=Ar(i,neighborLightingGet(t,e.chunk_id+Ae,r-240))
if(0!==pa[2]){if(a)i=Ar(i,a[r-ye])}else i=Ar(i,neighborLightingGet(t,e.chunk_id-Ie,r+3840))
if((i-=Xe)>0){if(!a)a=e[t]=new Uint8Array(Se)
a[r]=i}}function markChunkSpoiled(e){var t=jr[e]
if(t)t.sent_pristine=true}function markChunkUnspoiled(e){var t=jr[e]
if(t){dirty(e,63,0,63)
Wt.reload(t)
t=jr[e]
w(!t.sent_pristine)}}function ensurePristineSend(e,t){if(!t.sent_pristine){t.sent_pristine=true
if(!ut.isSpoiled(t.pos,null)){e.tset.sendPristine(t.chunk_id,t.serialize())
Qt(e,t)
dt(e,t)}}}function transSetTileInternal(e,i,o,n,t,r,a){var s=jr[i]
if(!s||!s.did_gen){w(false)
return null}w(!s.disposed)
if(ct.omp){ensurePristineSend(e,s)
ut.onTransSetTile(s.pos)}if(void 0===r)if(n&&!s.liquid||!n&&!s.data)r=0
else r=s.get(pa,n)
if(!n&&r===o)w(false,"Transaction trying to change tile to itself "+i+","+pa+"="+o)
var l=Ue(pa)
var _=e.opSet(i,l,o,n,t,r)
if(a){s.alloc(n)
var c=Kt
if(!o&&!n&&!t)c=jt
s.set(pa,o,n,c)
if(c===jt&&qr){predictLighting(s,"light_sun",l)
predictLighting(s,"light_torch",l)}}var u=s.reused
if(a)e.onComplete(function(e){if(s.reused!==u)return
if(e){console.log("Error after set @"+i+","+l+","+n+", refreshing tile...")
vr(i,l,n,function(e,t){if(s.reused!==u)return
if(e)console.log("Additional error refreshing tile")
else{var r=t
w.equal(typeof t,"number")
var a=s.getDirect(l,n)||0
if(a!==r){s.alloc(n)
s.set(ke(l),r,n)}console.log("Refresh complete @"+i+","+l+","+n+" set="+o+" local="+a+" server="+r)}})
var t=s.getPropDirect(l)
if(t)fr(t,i,ke(l))}})
return _}function transSetTileDirect(e,t,r,a,i,o,n,s){te(pa,r)
return transSetTileInternal(e,t.chunk_id,a,i,o,n,s)}function transSetTileLocal(e,t,r,a,i,o,n){w(Ye(t))
return transSetTileInternal(e,chunkIdFromLocalIntPos(t),r,a,i,o,n)}function transSetTilePosPair(e,t,r,a,i,o,n){var s=t[0]
w(je(s))
te(pa,ke(t[1]))
return transSetTileInternal(e,s,r,a,i,o,n)}function transSetTileRelative(e,t,r,a,i,o,n){w.equal(typeof t,"number")
te(pa,r)
var s=Ir(pa[0]/Te)
pa[0]-=Te*s
t+=s
s=Ir(pa[1]/Te)
pa[1]-=Te*s
t+=s*Ae
s=Ir(pa[2]/Te)
pa[2]-=Te*s
return transSetTileInternal(e,t+=s*Ie,a,i,o,void 0,n)}function setTileRelative(e,t,r,a){w.equal(typeof e,"number")
te(pa,t)
var i=Ir(pa[0]/Te)
pa[0]-=Te*i
e+=i
i=Ir(pa[1]/Te)
pa[1]-=Te*i
e+=i*Ae
i=Ir(pa[2]/Te)
pa[2]-=Te*i
var o=jr[e+=i*Ie]
if(!o||!o.did_gen)return
w(!o.disposed)
if(!r&&(a?!o.liquid:!o.data))return
o.alloc(a)
o.set(pa,r,a)}function getPropDirect(e,t){var r=jr[e]
if(!r||!r.did_gen)return null
return r.getProp(t)}function setPropDirect(e,t,r){var a=jr[e]
if(!a||!a.did_gen)return
a.setProp(t,r)}function removePropDirect(e,t){var r=jr[e]
if(!r||!r.did_gen)return
r.setProp(t,null)}function replacePropDirect(e,t,r){var a=jr[e]
w(a)
a.replaceProp(t,r)}var ya=pe()
function propUpdate(e){jr[e.chunk_id].dirty()}function getPropLocalExact(e){var t=chunkIdFromLocalIntPos(e)
var r=jr[t]
if(!r||!r.did_gen)return null
if(!r.props)return null
return r.getProp(pa)}var Sa={}
function autoCleanPropTile(e,t){w(V(e[0])&&V(e[1])&&V(e[2]))
if(Ft()||I()||!Ye(e))return
var r=e.join(",")
if(!Sa[r]){Sa[r]=true
Lt.push(lt.$(lt.STATUSMSG_ORPHANED_TILEPROP,"TILE_PROP"))
transSetTileLocal(ct.getFrameTransaction(),e,0,false,false,t,false)}}function autoRestorePropTile(e,t,r){w(V(e[0])&&V(e[1])&&V(e[2]))
if(Ft()||I()||!Ye(e))return
var a=e.join(",")
if(!Sa[a]){Sa[a]=true
Lt.push(lt.$(lt.STATUSMSG_PROP_WOUT_TILEPROP,"TILE_PROP"))
transSetTileLocal(ct.getFrameTransaction(),e,t,false,false,r||0,false)}}var Ia=new Int32Array(3)
function getPropLocal(e){var t=getTileLocal(e,0,false)
if(t<xt||t>Mt)return null
var r=t-xt
var a=false
for(var i=r;i>=0;--i){Ia[2]=e[2]-i
for(var o=r-i;o>=0;--o){Ia[1]=e[1]-o
var n=r-i-o
Ia[0]=e[0]-n
var s=chunkIdFromLocalIntPos(Ia)
var l=jr[s]
if(!l||!l.did_gen)a=true
else if(l.props){var _=l.getProp(pa)
if(_&&_.size[0]>n&&_.size[1]>o&&_.size[2]>i)return _}}}if(a)return null
autoCleanPropTile(e,t)
return null}var Aa=pe()
function getPropRelativeFromTile(e,t,r){w(r>=xt&&r<=Mt)
w(t[0]>=0&&t[0]<Te)
w(t[1]>=0&&t[1]<Te)
w(t[2]>=0&&t[2]<Te)
var a=r-xt
var i=false
for(var o=a;o>=0;--o){Ia[2]=t[2]-o
var n=e
if(Ia[2]<0){Ia[2]+=Te
n-=Ie}for(var s=a-o;s>=0;--s){Ia[1]=t[1]-s
var l=n
if(Ia[1]<0){Ia[1]+=Te
l-=Ae}var _=a-o-s
Ia[0]=t[0]-_
var c=l
if(Ia[0]<0){Ia[0]+=Te;--c}var u=jr[c]
if(!u||!u.did_gen)i=true
else if(u.props){var d=u.getProp(Ia)
if(d&&d.size[0]>_&&d.size[1]>s&&d.size[2]>o)return d}}}if(i)return null
getLocalPosFromChunkID(Aa,e,t)
autoCleanPropTile(Aa,r)
return null}function andGetProp(){return getPropRelativeFromTile(Ea.chunk_id,pa,ga)}function getPropRelative(e,t){var r=getTileRelative(e,t)
if(r>=xt&&r<=Mt)return andGetProp()
return null}var wa=function(){var u=pe()
var d=pe()
function chunkPosFromLocalPos(e){_e(e,e,1/Te)
oe(e,h)}return function gatherPropsFn(e,t,r){ee(u,t,Q,-r)
chunkPosFromLocalPos(u)
ee(d,t,Q,r)
chunkPosFromLocalPos(d)
r*=r
var a=[]
for(var i=u[2];i<=d[2];++i)for(var o=u[1];o<=d[1];++o)for(var n=u[0];n<=d[0];++n){var s=jr[n+o*Ae+i*Ie]
if(!s)continue
var l=s.props
if(!l)continue
for(var _ in l){var c=l[_]
if(!c)continue
if(!e(c))continue
c.getLocalPos(pa)
if(re(pa,t)>r)continue
a.push(c)}}return a}}()
v.gatherProps=wa
function removeProp(e){var t=e.pos
for(var r=0;r<e.size[2];++r){ya[2]=t[2]+r
for(var a=0;a<e.size[1];++a){ya[1]=t[1]+a
for(var i=0;i<e.size[0];++i){ya[0]=t[0]+i
setTileRelative(e.chunk_id,ya,0,false)}}}jr[e.chunk_id].setProp(t,null)}var La=function(){var f=new Int32Array(3)
var v=new Int32Array(3)
return function raycastLocalFn(e,t,r,a,i,o){a=Sr((a+Te-1)/Te)
var n=chunkIdFromLocalIntPos(t)
var s=r[0]?0:r[1]?1:2
var l=r[s]
f[0]=pa[0]
f[1]=pa[1]
f[2]=pa[2]
var _=(r[2]*Ae+r[1])*Ae+r[0]
while(a){var c=jr[n]
if(c&&c.did_gen&&!c.data&&(!i||!c.liquid));else while(f[s]>=0&&f[s]<Te){if(!c||!c.did_gen){te(e,t)
return-1}var u=c.data&&c.get(f,false)
if(u>=xt&&u<=Mt){var d=getPropRelativeFromTile(c.chunk_id,f,u)
if(d&&o)o[d.uid]=d
if(d&&d.inv.tangible_height&&c.getLocalPos(v)[2]+f[2]>=d.getLocalPos()[2]+d.inv.tangible_height)u=0
if(!d||d.isIntangible())u=0}else if(u>=Nt)u=0
if(!u&&i&&c.liquid&&c.get(f,true))u=bt
if(u){if(e){ue(e,c.pos,h)
le(e,e,Te)
oe(e,f)}return u}f[s]+=l}n+=_;--a
if(l>0)f[s]=0
else f[s]=Te-1}return 0}}()
v.raycastLocal=La
var Oa=function(){var E=new Int32Array(3)
var g=new Int32Array(3)
var T=pe()
var y=pe()
return function raycast3DLocalFn(e,t,r,a,i,o,n,s,l){var _=s?getTileLocalOrQueuedPlace:getTileLocal
var c=s?-1:0
ie(E,a)
for(var u=0;u<3;++u)if(!i[u]){g[u]=0
T[u]=o+1}else if(i[u]<0){g[u]=-1
T[u]=(E[u]-a[u])/i[u]
y[u]=-1/i[u]}else{T[u]=(E[u]+1-a[u])/i[u]
g[u]=1
y[u]=1/i[u]}var d=0
var f=0
var v=0
var h=null
var p
do{var m=T[0]<T[1]?0:1
if(T[2]<T[m])m=2
if(T[m]>o)break
v=T[f=m]
E[m]+=g[m]
T[m]+=y[m]
d=_(E,c,false)
if(n)p=andGetLiquid()
if(d>=xt&&d<=Mt){if((h=getPropLocal(E))&&(!h.inv.clickable||l&&h.inv.see_through)){h=null
d=0}if(h&&l&&h.inv.tangible_height&&E[2]>=h.getLocalPos()[2]+h.inv.tangible_height){h=null
d=0}}if(n&&p)if(!d)d=bt}while(!d)
te(t,E)
t[f]-=g[f]
te(e,E)
ee(r,a,i,v)
return d?{tile:d,prop:h,liquid:p}:0}}()
v.raycast3DLocal=Oa
var Ra=function(){var l=new Int32Array(3)
var _=new Int32Array(3)
var c=pe()
var u=pe()
return function raycast3DLocalCBFn(e,t,r,a){var i=-1
ie(l,e)
for(var o=0;o<3;++o)if(!t[o]){_[o]=0
c[o]=r+1}else if(t[o]<0){_[o]=-1
c[o]=(l[o]-e[o])/t[o]
u[o]=-1/t[o]}else{c[o]=(l[o]+1-e[o])/t[o]
_[o]=1
u[o]=1/t[o]}var n=0
do{var s=c[0]<c[1]?0:1
if(c[2]<c[s])s=2
if(c[s]>r)break
l[s]+=_[s]
c[s]+=u[s]
n=a(getTileLocal(l,i,false),l)}while(!n)
return n}}()
v.raycast3DLocalCB=Ra
var ba=function(){var E=new Int32Array(3)
var g=new Int32Array(3)
var T=new Int32Array(3)
var y=pe()
var S=pe()
var I=pe()
return function beamcast3DLocalFn(e,t,r,a,i,o,n){ee(I,t,i,-.5)
oe(I,Z)
ie(E,I)
for(var s=0;s<3;++s)if(!r[s]){T[s]=0
y[s]=a+1}else if(r[s]<0){T[s]=-1
y[s]=(E[s]-I[s])/r[s]
S[s]=-1/r[s]}else{y[s]=(E[s]+1-I[s])/r[s]
T[s]=1
S[s]=1/r[s]}var l=0
var _=a
do{var c=y[0]<y[1]?0:1
if(y[2]<y[c])c=2
if(y[c]>_)break
var u=false
var d=Jr[c][0]
var f=Jr[c][1]
g[c]=E[c]+(T[c]>0?o?0:i[c]:o?i[c]-1:-1)
e:for(var v=0;v<i[d];++v){g[d]=E[d]+v
for(var h=0;h<i[f];++h){g[f]=E[f]+h
var p=getTileLocalOrQueuedPlace(g,0,false)
if(p>=xt&&p<=Mt){var m=andGetProp()
if(!m||!m.inv.clickable||n&&m.isIntangible())p=0}if(p){l=p
u=true
if(!o)_=0
else _=wr(_,wr(y[c]+S[c],Ar(y[d],y[f])))
break e}}}if(!u)E[c]+=T[c]
y[c]+=S[c]}while(true)
te(e,E)
return l}}()
v.beamcast3DLocal=ba
var Na=function(){var A=new Int32Array(3)
var w=new Int32Array(3)
var L=new Int32Array(3)
var O=pe()
var R=pe()
var b=pe()
var N=pe()
var C=pe()
var x=pe()
return function beamcast3DLocal2Fn(e,r,a,t,i,o){var n=Sr(2*i)+1
ee(b,r,Q,-.5*n)
ie(A,b)
for(var s=0;s<3;++s)if(!a[s]){L[s]=0
O[s]=t+1}else if(a[s]<0){L[s]=-1
O[s]=(A[s]-b[s])/a[s]
R[s]=-1/a[s]}else{O[s]=(A[s]+1-b[s])/a[s]
L[s]=1
R[s]=1/a[s]}var l
var _
function checkSample(){var e=getTileLocal(w,0,false)
if(e>=kt)if(e>=xt&&e<=Mt){var t=andGetProp()
if(!t||!t.inv.mineable)return false}else return false
else if(!e)return false
J(N,w,Z)
ue(C,N,r)
if((l=Je(r,a,N))>i)return false
if((_=ae(C,a))<=0)return false
if(_<2*l)return false
return true}var c=false
e:for(var u=0;u<n;++u){w[2]=A[2]+u
for(var d=0;d<n;++d){w[1]=A[1]+d
for(var f=0;f<n;++f){w[0]=A[0]+f
if(checkSample()){c=true
break e}}}}if(!c)e:do{var v=O[0]<O[1]?0:1
if(O[2]<O[v])v=2
if(O[v]>t)return false
var h=Jr[v][0]
var p=Jr[v][1]
w[v]=A[v]+(L[v]>0?n:-1)
for(var m=0;m<n;++m){w[h]=A[h]+m
for(var E=0;E<n;++E){w[p]=A[p]+E
if(checkSample())break e}}A[v]+=L[v]
O[v]+=R[v]}while(true)
ee(x,r,a,_)
var g=_
te(o,w)
ne(x)
var T=Sr(i)
for(var y=-T;y<=T;++y){w[2]=x[2]+y
for(var S=-T;S<=T;++S){w[1]=x[1]+S
for(var I=-T;I<=T;++I){w[0]=x[0]+I
if(checkSample())if(_<g){te(o,w)
g=_}}}}ee(e,r,a,g)
return true}}()
v.beamcast3DLocal2=Na
function ensurePristineSendProp(e,t){w(!t.user_inv_type)
var r=jr[t.chunk_id]
w(r&&r.did_gen)
ensurePristineSend(e,r)}function assertPropPristineSend(e){var t=jr[e.chunk_id]
w(t)
w(t.sent_pristine)}var Ca=new Int32Array(3)
function transPropRemove(e,t,r,a){t.getLocalPos(Ca)
var i=jr[t.chunk_id]
for(var o=0;o<t.size[2];++o){ya[2]=Ca[2]+o
for(var n=0;n<t.size[1];++n){ya[1]=Ca[1]+n
for(var s=0;s<t.size[0];++s){ya[0]=Ca[0]+s
var l=getTileLocal(ya)
if(l>=xt&&l<=Mt)transSetTileLocal(e,ya,0,false,a,l,r)}}}if(r)i.setProp(t.pos,null)
var _=e.opPropSet(t.version,t.chunk_id,t.pos,null)
if(r)_.pred=true}function transSetPropLocal(e,t,r,a,i){var o=!r.flowThrough()
var n=chunkIdFromLocalIntPos(t)
var s=jr[n]
w(s)
w(s.did_gen)
ensurePristineSend(e,s)
var l=!i&&s.getProp(pa)
w(!l)
var _=e.opPropSet(l?l.version:0,n,pa,r)
if(a){_.pred=true
s.setProp(pa,r)}for(var c=0;c<r.size[2];++c){ya[2]=t[2]+c
for(var u=0;u<r.size[1];++u){ya[1]=t[1]+u
for(var d=0;d<r.size[0];++d){ya[0]=t[0]+d
transSetTileLocal(e,ya,xt+d+u+c,false,false,0,a)
if(o)transSetTileLocal(e,ya,0,true,false,void 0,a)}}}}var xa=new Int32Array(3)
function transPropUpdate(e,t,r){if(r){getLocalPosFromChunkID(xa,t.chunk_id,t.pos)
for(var a=0;a<3;++a){var i=Jr[a][0]
var o=Jr[a][1]
for(var n=t.last_size[a];n<t.size[a];++n){ya[a]=xa[a]+n
for(var s=0;s<t.size[i];++s){ya[i]=xa[i]+s
for(var l=0;l<t.size[o];++l){ya[o]=xa[o]+l
var _=xt+s+l+n
if(getTileLocal(ya)===_)K(false)
else transSetTileLocal(e,ya,_,false,false,void 0,true)}}}for(var c=t.last_size[a]-1;c>=t.size[a];--c){ya[a]=xa[a]+c
for(var u=0;u<t.last_size[i];++u){ya[i]=xa[i]+u
for(var d=0;d<t.last_size[o];++d){ya[o]=xa[o]+d
transSetTileLocal(e,ya,0,false,false,void 0,true)}}}}te(t.last_size,t.size)}ensurePristineSendProp(e,t)
var f=t.version
t.version=Y(f,2,1e4)
e.opPropSet(f,t.chunk_id,t.pos,t).pred=true
var v=jr[t.chunk_id]
w(v)
v.ver_props++}function transPropUpdateField(e,t,r,a,i){var o=t[a]
if(void 0===o)o=null
if(t[a]===i)return
var n=jr[t.chunk_id]
w(n&&n.did_gen)
ensurePristineSend(e,n)
t[a]=i
e.opPropMod(t.chunk_id,t.pos,r,o,i,t.item_id).pred=true
t.updateRuntimeBehaviour()}function transBagAdd(e,t){var r=chunkIdFromLocalIntPos(t.target_pos)
if(ct.omp&&!ut.isSpoiled(ha,null))ensurePristineSend(e,jr[r])
e.opBagAdd(r,pa,t)}var Ma=pe()
function transItemAnim(e,t){w(t.style)
w(t.src_type)
w(t.target_type)
w(t.items&&t.items.length)
var r=t.src
var a=0
if(t.src_type===Re){a=chunkIdFromLocalFloatPos(Ma,t.src)
r=Ma}else if(!r)t.src=r=He()
var i=t.target
var o=0
if(t.target_type===Re){o=chunkIdFromLocalIntPos(t.target)
i=pa}else if(!i)t.target=i=He()
if(!r||!i)return
var n=e.opItemAnim(t.style,t.from_center,t.src_type,a,r,t.target_type,o,i,t.items)
if(t.pred){n.pred=true
Ke.add(t)}}VoxelData.prototype.releaseProps=function(){if(this.props){for(var e in this.props){var t=this.props[e]
t.removed=true
if(t.onRemove)t.onRemove()}this.props=null}}
VoxelData.prototype.dispose=function(){this.disposed=true
if(this.geom_high){this.geom_high.dispose()
this.geom_high=null}if(this.geom_alpha){this.geom_alpha.dispose()
this.geom_alpha=null}if(this.geom_liquid){this.geom_liquid.dispose()
this.geom_liquid=null}this.data=null
this.shadow_buf=null
this.liquid=null
this.light_torch=null
this.light_sun=null
this.releaseProps()
this.setMemUsage(0)
cr(this)}
VoxelData.prototype.updateInUpdateStateList=function(){var e=Qr&&this.liquid&&this.liquid_unstable||this.has_updatable_prop
if(!e&&this.in_list_update){this.in_list_update=false
Wt.list_need_update.remove(this)}else if(e&&!this.in_list_update){this.in_list_update=true
Wt.list_need_update.add(this)}}
VoxelData.prototype.applyBoostLevel=function(){if(this.props)for(var e in this.props){var t=this.props[e]
if(t.applyBoostLevel)t.applyBoostLevel()}}
VoxelData.prototype.updateRuntimeBehaviour=function(){this.has_updatable_prop=false
if(this.props)for(var e in this.props){var t=this.props[e]
t.updateRuntimeBehaviour()
if(t.updateState)this.has_updatable_prop=true}this.updateInUpdateStateList()}
VoxelData.prototype.updateHasUpdatableProp=function(e){if(!(this.has_updatable_prop=e)&&this.props)for(var t in this.props){var r=this.props[t]
if(r&&r.updateState){this.has_updatable_prop=true
break}}this.updateInUpdateStateList()}
VoxelData.prototype.updateInTickList=function(){var e=this.has_tickable_prop
if(!e&&this.in_list_tick){this.in_list_tick=false
Wt.list_need_tick.remove(this)}else if(e&&!this.in_list_tick){this.in_list_tick=true
Wt.list_need_tick.add(this)}}
VoxelData.prototype.updateHasTickableProp=function(e){if(!(this.has_tickable_prop=e)&&this.props)for(var t in this.props){var r=this.props[t]
if(r&&r.tick){this.has_tickable_prop=true
break}}this.updateInTickList()}
VoxelData.prototype.updateHasLiquid=function(e){if(!e&&this.liquid){var t=false
for(var r=0;r<this.liquid.length;++r)if(this.liquid[r]){t=true
break}if(!t){this.liquid=null
if(this.geom_liquid){this.geom_liquid.dispose()
this.geom_liquid=null
this.updateInDrawList()}if(!this.data&&this.mesh_dirty){if(this.in_list_mesh)Wt.listRemoveMesh(this)
this.mesh_dirty=0}}}this.updateInUpdateStateList()}
var Da=pe()
function checkPropTiles(e){var t=e.chunk_id,r=e.props
e.did_prop_check=true
if(!r)return
if(Ft()||I()||!Ye(e.getLocalPos(Da)))return
for(var a in r){var i=r[a]
var o=i.size,n=i.pos
var s=n[0],l=n[1],_=n[2]
for(var c=0;c<o[2];++c){var u=_+c<Te
for(var d=0;d<o[1];++d){var f=l+d<Te
for(var v=0;v<o[0];++v){var h=s+v<Te
var p=xt+v+d+c
var m=((_+c)*Te+l+d)*Te+s+v
var E=e
if(!(h&&f&&u)){var g=t
if(!h){g++
m-=Te}if(!f){g+=Ae
m-=ye}if(!u){g+=Ie
m-=Se}w(m>=0&&m<Se)
var T=jr[g]
w(T)
w(T.did_gen)
E=T}var y=E.data&&E.data[m]
if(y!==p)if(e.sent_pristine&&!(y>=xt&&y<=Mt)){getLocalPosFromChunkID(Aa,t,n)
Aa[0]+=v
Aa[1]+=d
Aa[2]+=c
autoRestorePropTile(Aa,p,y)}else if(!e.sent_pristine||S.DEBUG)window.onerror((E.sent_pristine?"":"procgen")+" prop tile mismatch ("+p+","+y+") at "+E.chunk_id+","+m+" in seed:"+yr(),"voxel_data.js",0,0)}}}}}var Pa=[-Ie-Ae-1,-Ie-Ae,-Ie-Ae+1,-Ie-1,-Ie,1-Ie,-Ie+Ae-1,-Ie+Ae,-Ie+Ae+1,-Ae-1,-Ae,1-Ae,-1,1,Ae-1,Ae,Ae+1,Ie-Ae-1,Ie-Ae,Ie-Ae+1,Ie-1,Ie,Ie+1,Ie+Ae-1,Ie+Ae,Ie+Ae+1]
w.equal(Pa.length,26)
var Ba=67108863
v.NEIGHBOR_MASK_ALL=Ba
var ka=Pa.map(function(e,t){return 1<<t})
var Ua=Pa.map(function(e,t){return~(1<<t)})
function getNeighborGenMask(e){var t=0
for(var r=0;r<26;++r){var a=jr[e-Pa[r]]
if(a&&a.did_gen)t|=1<<r}return t}function updateNeighborMasks(e,t){for(var r=0;r<26;++r){var a=jr[e+Pa[r]]
if(a)if(t){if((a.gened_neighbors|=ka[r])===Ba){if(!a.did_prop_check&&a.did_gen)checkPropTiles(a)
if(a.mesh_dirty)if(!a.in_list_mesh&&!a.mesh_in_flight)Wt.listAddMesh(a)}}else{a.gened_neighbors&=Ua[r]
if(a.in_list_mesh)Wt.listRemoveMesh(a)}}}VoxelData.prototype.allNeighborsGened=function(){if(!this.did_gen)return false
if(this.gened_neighbors===Ba)return true
this.gened_neighbors=getNeighborGenMask(this.chunk_id)
return this.gened_neighbors===Ba}
VoxelData.prototype.recycle=function(){this.dispose();++this.reused
if(va.length<fa)va.push(this)
else this.mem_tracker.count--}
VoxelData.prototype.unload=function(){delete jr[this.chunk_id]
if(this.did_gen)updateNeighborMasks(this.chunk_id,false)
ir(this)
this.recycle()}
var Ga=pe()
VoxelData.prototype.setDataMembers=function(e){w(!this.data)
this.data=e.data
w(!this.liquid)
this.liquid=e.liquid
this.full=e.full
w(!this.props)
if(e.props){this.props={}
for(var t in e.props){var r=e.props[t]
var a=r.size,i=r.rot,o=r.contents,n=r.proc_genned
w(a)
t=Number(t)
w(!this.props[t])
r.type=we
var s=It(qe(r))
s.main_world=this.main_world
s.chunk_id=this.chunk_id
s.setRot(i)
if(o)s.contents=o.map(qe)
if(!se(a,s.size))window.onerror("procgen prop mismatched size ("+a.join()+"!="+s.size.join()+" "+this.chunk_id+","+t+" in seed:"+yr(),"voxel_data.js",0,0)
ce(Ga,15&t,(240&t)>>4,(3840&t)>>8)
s.setPos(Ga)
s.proc_genned=n
if((this.props[t]=s).baked){if(!this.baked_props)this.baked_props={}
this.baked_props[t]=s.baked}if(s.draw){if(!this.drawable_props)this.drawable_props={}
this.drawable_props[t]=s}if(s.updateState)this.updateHasUpdatableProp(true)
if(s.tick)this.updateHasTickableProp(true)}}if(e.liquid_stable)this.liquid_unstable=false
this.updateInUpdateStateList()
this.dirty()
Vr.gen+=e.gen_time||0}
VoxelData.prototype.assertInChunkMap=function(){if(jr[this.chunk_id]===this);else if(jr[this.chunk_id])w(false,"assertInChunkMap:replaced")
else w(false,"assertInChunkMap:missing")}
VoxelData.prototype.doGen=function(t){var r=this
w(!this.disposed)
w(!this.did_gen)
w(!this.data)
this.assertInChunkMap()
Xt(this,function(e){if(e)return void t(e)
w(r.did_gen)
r.updateHasLiquid(false)
r.assertInChunkMap()
updateNeighborMasks(r.chunk_id,true)
tr(r)
t()})}
function sqr(e){return e*e}function getPropLighting(e,t,r){if(!qr){e.scale_lights=false
return}ie(pa,t)
var a=posPairFromLocalIntPos(pa)
var i=jr[a[0]]
if(!i){if(!r)e.scale_lights=false
return}var o=a[1]
var n=i.light_torch,s=i.light_sun
if(!i.data&&!n&&!s){if(r){if(e.scale_lights){var l=5e-4*S.frame_dt
var _=e.torch_target-e.torch_factor
e.torch_factor+=G(_,-l,l)
_=e.sun_target-e.sun_factor
e.sun_factor+=G(_,-l,l)
return}e.torch_target=0
e.sun_target=1}e.scale_lights=true
e.torch_factor=0
e.sun_factor=1
return}var c=n?sqr($e[n[o]]/255):0
var u=s?sqr(Qe[s[o]]/255):0
if(r){var d=5e-4*S.frame_dt
if(!n&&!s&&!i.did_mesh){if(e.scale_lights){var f=e.torch_target-e.torch_factor
e.torch_factor+=G(f,-d,d)
f=e.sun_target-e.sun_factor
e.sun_factor+=G(f,-d,d)}return}e.torch_target=c
e.sun_target=u
if(e.scale_lights){var v=c-e.torch_factor
e.torch_factor+=G(v,-d,d)
v=u-e.sun_factor
e.sun_factor+=G(v,-d,d)
return}}e.scale_lights=true
e.torch_factor=c
e.sun_factor=u}function getPropLighting2(e,t){var r=t.draw_opts
if(!qr){r.scale_lights=false
return}r.scale_lights=true
var a=t.pos_idx
var i=e.light_torch,o=e.light_sun
r.torch_factor=i?sqr($e[i[a]]/255):0
r.sun_factor=o?sqr(Qe[o[a]]/255):0}function getPropLighting2Prop(e){getPropLighting2(jr[e.chunk_id],e)}VoxelData.prototype.updatePropLights=function(e){var t=this.light_torch,r=this.light_sun
if(!this.drawable_props)return
for(var a in this.drawable_props){var i=this.drawable_props[a]
if(e){i.draw_opts.scale_lights=true
i.draw_opts.torch_factor=t?sqr($e[t[a]]/255):0
i.draw_opts.sun_factor=r?sqr(Qe[r[a]]/255):0}else i.draw_opts.scale_lights=false}}
VoxelData.prototype.fadeIn=function(){if(!this.load_timestamp)this.load_timestamp=S.frame_timestamp}
VoxelData.prototype.disposeGeom=function(e){if(this[e]){this[e].dispose()
this[e]=null}}
VoxelData.prototype.setMeshData=function(e,t){w(t.ver_meshing)
w(t.ver_meshing!==this.geom_ver_meshing)
if(t.mesh_time)Vr.mesh+=t.mesh_time
if(t.ver_meshing<this.geom_ver_meshing)return
this.geom_ver_meshing=t.ver_meshing
this.fadeIn()
this.disposeGeom("geom_liquid")
if(t.liquid)this.geom_liquid=s(Hr,t.liquid)
this.disposeGeom("geom_alpha")
if(t.alpha)this.geom_alpha=s(Hr,t.alpha)
if(t.shadow_buf){this.shadow_buf=t.shadow_buf
this.shadow_buf_ver=t.ver_meshing}else this.shadow_buf=null
this.disposeGeom("geom_high")
if(t.data){this.geom_high=s(Hr,t.data)
this.geom_high_tricount=t.data_high_tricount
this.geom_mid_tricount=t.data_mid_tricount
this.geom_highmid_tricount=t.data_high_tricount+t.data_mid_tricount
this.geom_mid_start=t.data_mid_start
this.geom_midlow_tricount=t.data_mid_tricount+t.data_low_tricount
this.geom_low_start=t.data_low_start
this.geom_low_tricount=t.data_low_tricount}else{this.geom_high_tricount=0
this.geom_mid_tricount=0
this.geom_highmid_tricount=0
this.geom_midlow_tricount=0
this.geom_low_tricount=0}this.updateDrawCost()
if(t.lighting){this.light_sun=t.light_sun
this.light_torch=t.light_torch
this.updatePropLights(true)}else this.updatePropLights(false)
if(e&&e.for_baking){w(t.data)
this.baked_mesh_data=t.data
w(!t.alpha)}}
VoxelData.prototype.updateDrawCost=function(){this.draw_cost_low=this.draw_cost_high_base=0
this.draw_cost_high_base+=this.geom_highmid_tricount
this.draw_cost_low+=this.geom_midlow_tricount
if(this.drawable_props)this.draw_cost_high=this.draw_cost_high_base+Object.keys(this.drawable_props).length*zt
else this.draw_cost_high=this.draw_cost_high_base}
VoxelData.prototype.updateInDrawList=function(){var e=this.shouldDraw()
if(e&&!this.in_list_draw){this.in_list_draw=true
Wt.list_need_draw.add(this)}else if(!e&&this.in_list_draw){this.in_list_draw=false
Wt.list_need_draw.remove(this)}if(e)this.updateDrawCost()}
VoxelData.prototype.doMesh=function(t){var r=this
w(this.main_world)
w(!this.disposed)
w(this.mesh_dirty)
this.mesh_dirty=0
if(!this.data&&!this.liquid)return
var e={ao:Kr,lighting:qr,shadow_buf:m.shadows}
if(!t){w(!this.mesh_in_flight)
this.mesh_in_flight=true}er(this,e,t,function(e){if(!t){w(r.mesh_in_flight)
r.mesh_in_flight=false}if(e){console.error("Error meshing chunk "+r.chunk_id+": "+e)
throw e}if(t&&qr&&!r.mesh_dirty&&!(S.defines.NOWORKERS||S.defines.NOMESHWORKERS)){r.ver_meshing++
r.mesh_dirty=Kt}if(r.mesh_dirty&&!r.in_list_mesh&&!r.mesh_in_flight&&r.gened_neighbors===Ba){w(r.did_gen)
Wt.listAddMesh(r)}r.did_mesh=true
r.updateInDrawList()})}
VoxelData.prototype.get3=function(e,t,r,a){if(e<0||t<0||r<0||e>=this.size[0]||t>=this.size[1]||r>=this.size[2])return 0
var i=r*this.stride2+t*this.stride1+e
if(a)return this.liquid[i]
else return this.data[i]}
var Fa=new Uint8Array(3)
VoxelData.prototype.getDelta=function(e,t,r){Fa[0]=e[0]+t[0]
Fa[1]=e[1]+t[1]
Fa[2]=e[2]+t[2]
return this.get(Fa,r)}
var Wa=function(){var e=new Array(64)
for(var t=0;t<64;++t){var r=e[t]=[0]
if(1&t)r.push(-1)
if(2&t)r.push(1)
var a=r.length
if(4&t)for(var i=a-1;i>=0;--i)r.push(r[i]-Ae)
if(8&t)for(var o=a-1;o>=0;--o)r.push(r[o]+Ae)
a=r.length
if(16&t)for(var n=a-1;n>=0;--n)r.push(r[n]-Ie)
if(32&t)for(var s=a-1;s>=0;--s)r.push(r[s]+Ie)
r.splice(0,1)}return e}()
VoxelData.prototype.dirty=function(e){if(this.data||this.liquid){this.ver_meshing++
if(!this.main_world)return
if((e=e||Kt)>=this.mesh_dirty){if(this.mesh_in_flight){if(e>this.mesh_dirty){w(!this.in_list_mesh)
if(e===jt){this.mesh_dirty=e
Wt.listAddMesh(this)}}}else if(!this.in_list_mesh){if(this.gened_neighbors!==Ba)this.gened_neighbors=getNeighborGenMask(this.chunk_id)
if(this.gened_neighbors===Ba){if(!this.did_prop_check)checkPropTiles(this)
this.mesh_dirty=e
Wt.listAddMesh(this)}}else if(e>this.mesh_dirty&&e===jt){Wt.listRemoveMesh(this)
this.mesh_dirty=e
Wt.listAddMesh(this)}if(this.mesh_dirty!==e)this.mesh_dirty=e}}else{this.did_prop_check=true
this.fadeIn()}}
var Ha=null
function voxelDataDirtyCacheStart(){Ha={}}function voxelDataDirtyCacheEnd(){Ha=null}function dirty(e,t,r,a){if(Ha){var i=[e,t,r,a].join()
if(Ha[i])return
Ha[i]=true}var o=Wa[r]
for(var n=0;n<o.length;++n){var s=e+o[n]
var l=jr[s]
if(l)l.dirty(jt)}o=Wa[t]
for(var _=0;_<o.length;++_){var c=e+o[_]
var u=jr[c]
if(u)u.dirty(Kt)}o=Wa[a]
for(var d=0;d<o.length;++d){var f=e+o[d]
var v=jr[f]
if(v&&!v.liquid_unstable){v.liquid_unstable=true
v.last_liquid_tick=et.liquid_tick_idx
v.updateInUpdateStateList()}}}VoxelData.prototype.setUnchecked=function(e,t){this.data[e[2]*this.stride2+e[1]*this.stride1+e[0]]=t}
VoxelData.prototype.setUncheckedLiquid=function(e,t){this.liquid[e[2]*this.stride2+e[1]*this.stride1+e[0]]=t}
VoxelData.prototype.set=function(e,t,r,a){w(!(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2]))
var i=e[2]*this.stride2+e[1]*this.stride1+e[0]
var o
if(r){if(this.liquid[i]===t)return
this.liquid[i]=t
this.updateHasLiquid(t)}else{if((o=this.data[i])===t)return
this.data[i]=t}if(!this.main_world)return
if(!t)this.full=false
if(!r){var n=o&&o<Ct
var s=t&&t<Ct
var l=0
if(n&&!s)l|=Ne
else if(s&&!n)l|=be
this.light_dirty|=l}this.ver_data++
if(this.liquid){if(!this.liquid_unstable){this.liquid_unstable=true
this.updateInUpdateStateList()}this.last_liquid_tick=et.liquid_tick_idx}this.dirty(a)
var _=0
if(0===e[0])_|=1
else if(e[0]===this.size[0]-1)_|=2
if(0===e[1])_|=4
else if(e[1]===this.size[1]-1)_|=8
if(0===e[2])_|=16
else if(e[2]===this.size[2]-1)_|=32
var c=0
if(qr)c=63
else if(Kr>1){var u=Kr
if(e[0]<u)c|=1
else if(e[0]>this.size[0]-u)c|=2
if(e[1]<u)c|=4
else if(e[1]>this.size[1]-u)c|=8
if(e[2]<u)c|=16
else if(e[2]>this.size[2]-u)c|=32}else c=_
if(c)dirty(this.chunk_id,c,a===jt?_:0,_)}
var za=new Uint8Array(3)
VoxelData.prototype.set3=function(e,t,r,a,i){za[0]=e
za[1]=t
za[2]=r
return this.set(za,a,i)}
VoxelData.prototype.shouldDraw=function(){return this.did_mesh&&(this.geom_high||this.geom_alpha||this.geom_liquid||this.drawable_props)}
VoxelData.prototype.setProp=function(e,t){w(!(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2]))
w(!this.disposed)
var r=e[2]*this.stride2+e[1]*this.stride1+e[0]
if(!t){w(this.props)
var a=this.props[r]
w(a)
a.removed=true
if(a.onRemove)a.onRemove()
delete this.props[r]
if(H(this.props))this.props=null
if(a.baked){w(this.baked_props[r])
delete this.baked_props[r]
if(H(this.baked_props))this.baked_props=null}else w(!this.baked_props||!this.baked_props[r])
if(a.draw){w(this.drawable_props[r])
delete this.drawable_props[r]
if(H(this.drawable_props)){this.drawable_props=null
if(this.in_list_draw&&!this.shouldDraw()){this.in_list_draw=false
Wt.list_need_draw.remove(this)}}}else w(!this.drawable_props||!this.drawable_props[r])
if(this.has_updatable_prop)this.updateHasUpdatableProp(false)
if(this.has_tickable_prop)this.updateHasTickableProp(false)
if(a.emit)this.lightDirty(false)}else{if(!this.props)this.props={}
w(!this.props[r])
t.main_world=this.main_world
t.chunk_id=this.chunk_id
t.setPos(e)
if((this.props[r]=t).baked){if(!this.baked_props)this.baked_props={}
this.baked_props[r]=t.baked}if(t.draw){if(!this.drawable_props){this.drawable_props={}
if(!this.in_list_draw&&this.shouldDraw()){this.in_list_draw=true
Wt.list_need_draw.add(this)}}this.drawable_props[r]=t}if(t.updateState)this.updateHasUpdatableProp(true)
if(t.tick)this.updateHasTickableProp(true)
getPropLighting2(this,t)
if(t.emit)this.lightDirty(true)}++this.ver_props
this.dirty()}
VoxelData.prototype.lightDirty=function(e){if(e)this.light_dirty|=xe
else this.light_dirty|=Ce
if(qr){var t=63
dirty(this.chunk_id,t,0,0)}this.ver_data++}
VoxelData.prototype.replaceProp=function(e,t){w(this.props)
t.main_world=this.main_world
t.chunk_id=this.chunk_id
t.setPos(e)
var r=t.pos_idx
var a=this.props[r]
w(a)
if(a.onRemove)a.onRemove()
if((this.props[r]=t).draw){w(this.drawable_props)
w(this.drawable_props[r])
this.drawable_props[r]=t}else w(!this.drawable_props||!this.drawable_props[r])
var i=false
if(t.baked){w(this.baked_props)
w(this.baked_props[r])
i=this.baked_props[r].key!==t.baked.key
this.baked_props[r]=t.baked}else w(!this.baked_props||!this.baked_props[r])
if(t.updateState)this.updateHasUpdatableProp(true)
if(t.tick)this.updateHasTickableProp(true)
getPropLighting2(this,t)
if(a.emit&&!t.emit)this.lightDirty(false)
else if(t.emit&&!a.emit)this.lightDirty(true);++this.ver_props
if(i)this.dirty()}
VoxelData.prototype.propStateUpdate=function(e){var t=e.pos_idx
w.equal(this.props[t],e)
if(e.draw){if(!this.drawable_props){this.drawable_props={}
if(!this.in_list_draw&&this.shouldDraw()){this.in_list_draw=true
Wt.list_need_draw.add(this)}}this.drawable_props[t]=e}else if(this.drawable_props&&this.drawable_props[t]){delete this.drawable_props[t]
if(H(this.drawable_props)){this.drawable_props=null
if(this.in_list_draw&&!this.shouldDraw()){this.in_list_draw=false
Wt.list_need_draw.remove(this)}}}if(e.baked){if(!this.baked_props)this.baked_props={}
this.baked_props[t]=e.baked}else if(this.baked_props&&this.baked_props[t]){delete this.baked_props[t]
if(H(this.baked_props))this.baked_props=null}if(e.updateState){if(!this.has_updatable_prop)this.updateHasUpdatableProp(true)}else if(this.has_updatable_prop)this.updateHasUpdatableProp(false)
if(e.tick){if(!this.has_tickable_prop)this.updateHasTickableProp(true)}else if(this.has_tickable_prop)this.updateHasTickableProp(false)}
function propStateUpdate(e){jr[e.chunk_id].propStateUpdate(e)}function propInWorld(e){if(!e)return false
var t=jr[e.chunk_id]
if(!t||!t.props)return false
return t.props[e.pos_idx]===e}VoxelData.prototype.updateGeometrySimple=function(e){var t=Date.now()
if(false!==(e=e||{}).ao)e.ao=3
e.not_world=true
var r={ver_meshing:this.ver_meshing}
if(this.data){e.liquid=false
ht(this,r,e)}if(this.liquid){e.liquid=true
ht(this,r,e)}r.mesh_time=Date.now()-t
this.setMeshData(e,r)}
VoxelData.prototype.updateAndReturnGeometry=function(e){var t={ver_meshing:this.ver_meshing}
if(this.data){ht(this,t,{skip_greedy_meshing:true,need_offs:true})
var r=new Uint16Array(t.data.length)
r.set(t.data,0)
for(var a=0;a<t.data.length;a+=vt){r[0+a]+=16*e[0]*7
r[1+a]+=16*e[1]*7
r[2+a]+=16*e[2]*7}return r}return null}
var Va
function defaultTint(e){var t=Va[e]
w(t)
return t}function initDefaultTint(){function map(e){return l(me(0,0,0,1),e[0],e[1],e[2])}Va=[]
var e=We.BIOMES.FLAT
Va[Dt]=map(e.tint_grass_hsv)
Va[Bt]=Ot.MAT_METAL_TINT[Le.GOLD]}VoxelData.prototype.worldZ=function(){return this.pos[2]*Te}
var Ya=[]
for(var ja=0;ja<Pt;++ja)Ya.push(new Array(4))
var Ka=he()
VoxelData.prototype.tintGen=function tintGen(e){if(!this.main_world){var t=defaultTint(e)
return[t,t,t,t]}var r=Ya[e]
$(Ka,this.pos,Te)
r[0]=yt(this.vsid,Ka,e)
Ka[0]+=Te
r[1]=yt(this.vsid+1,Ka,e)
Ka[1]+=Te
r[2]=yt(this.vsid+Ae+1,Ka,e)
Ka[0]-=Te
r[3]=yt(this.vsid+Ae,Ka,e)
return r}
VoxelData.prototype.tintGenSingle=function tintGenSingle(e){if(!this.main_world)return defaultTint(e)
return Tt(this.pos,e)}
VoxelData.prototype.meshCalcWorld=function(e){var t=Date.now()
var r={}
e.did_lighting=true
e.need_offs=true
if(this.data){e.liquid=false
ht(this,r,e)}if(this.liquid){e.liquid=true
ht(this,r,e)}if(e.lighting){r.lighting=true
r.light_sun=this.light_sun
r.light_torch=this.light_torch}if(e.shadow_buf)mt(r)
r.mesh_time=Date.now()-t
return r}
function calcAtlasParams(e,t,r){var a=r.tiles_per_row,i=r.tile_res,o=r.pad,n=r.tex_w,s=r.tex_h,l=r.tex_res
n=n||l
s=s||l
l=l||(n+s)/2
var _=1/a
var c=i+2*o
var u=c/n
var d=c/s
var f=u*a
var v=S.webgl2?0:o/n
var h=S.webgl2?1:i/n
var p=S.webgl2?1:i/s
if(S.webgl2){fe(e,1,0,0,0)
e.tiles_per_row=1}else{fe(e,_,f,d,v)
e.tiles_per_row=a}if(S.webgl2)fe(t,0,0,0,0)
else fe(t,h,p,u,0)}var qa=Fe.primary
v.primary_atlas_params=qa
var Za=Fe.util
v.voxel_util_atlas_params=Za
var Xa=me()
v.atlas_params_voxel_util_vp=Xa
var Qa=pe()
v.atlas_params_voxel_util_fp=Qa
var $a=false
var Ja=false
var ei=[]
var ti=[]
var ri=[]
var ai=pe()
VoxelData.prototype.drawProps=function(){if(Ja&&1!==this.color[3]){ti.push(this)
return}var e=this.draw_cost_high_base
var t=m.max_props_per_chunk
for(var r in this.drawable_props){var a=this.drawable_props[r]
ai[0]=this.mat[12]+1+a.pos[0]+a.draw_offs[0]
ai[1]=this.mat[13]+1+a.pos[1]+a.draw_offs[1]
ai[2]=this.mat[14]+1+a.pos[2]+a.draw_offs[2]
a.draw_opts.color=this.color
var i=a.draw(ai)||1
ra+=i
e+=i*zt
if((t-=i)<=0)break}this.draw_cost_high=e}
function exportCombinedGeometry(e,t){calcAtlasParams(_a,ca,qa)
Et(e,_a,ca,t)}function drawPropBase(e,t,r){if(e.draw)e.draw(t)
if(e.baked&&e.baked.key)e.drawBaked(r)}function drawProp(t,r){ai[0]=r[0]+t.draw_offs[0]
ai[1]=r[1]+t.draw_offs[1]
ai[2]=r[2]+t.draw_offs[2]
if(t.draw_opts&&t.draw_opts.color&&1!==t.draw_opts.color[3]){var a=r
r=ai.slice(0)
t.mat[12]=r[0]
t.mat[13]=r[1]
t.mat[14]=r[2]
u.alphaQueue({mat:t.mat,drawAlpha:function drawAlpha(e){t.draw_opts.sort_z=e
drawPropBase(t,r,a)}})}else drawPropBase(t,ai,r)}function drawPropQueued(e,t){u.opaqueQueue(drawProp.bind(null,e,t.slice(0)))}var ii=me(.1,.1,.1,1)
var oi=me(.75,.25,.25,1)
var ni=me(1,1,1,1)
var si=false
VoxelData.prototype.updateColor=function(){if(si)if(S.defines.CLAIM&&this.claimed!==nr)te(this.color,ii)
else if(S.defines.SPOILED&&ut.isSpoiledDebug(this.pos,null))te(this.color,oi)
else te(this.color,ni)
this.color[3]=1
if(this.load_timestamp&&this.load_timestamp>ct.loading_finished_timestamp){var e=S.frame_timestamp-this.load_timestamp
if(e<$r){var t=W(e/$r,2)
this.color[3]=t}}}
VoxelData.prototype.drawAlpha=function(e){w(this.geom_alpha||this.geom_liquid)
S.projectionZBias(.01,Ar(e+16,16))
S.updateMatrices(this.mat)
x(Gr)
L(Or,Cr,this.shader_params)
if(this.geom_alpha)this.geom_alpha.draw()
if(this.geom_liquid){gl.cullFace(gl.FRONT)
this.geom_liquid.draw()
gl.cullFace(gl.BACK)
this.geom_liquid.draw()}S.projectionZBias(0)}
function voxelDataTopOfFrame(){Ja=Boolean(m.fade_chunks)
sa=Ja?Ar(1,S.frame_timestamp-la):Infinity}function drawBulkStart(){x(Gr)
$a=true
voxelDataTopOfFrame()
if(S.defines.CLAIM||S.defines.SPOILED)si=true
oa=na=ia=aa=ra=0}function geomDrawAuto(e){w(e.geom_high)
if(e.last_was_low){e.geom_high.drawSub(e.geom_mid_start,e.geom_midlow_tricount)
e.drew_low_timestamp=S.frame_timestamp}else{e.geom_high.drawSub(0,e.geom_highmid_tricount)
e.drew_high_timestamp=S.frame_timestamp}}function drawFadingChunks(){if(!S.defines.NOCHUNKS){for(var e=0;e<ei.length;++e){var t=ei[e]
S.updateMatrices(t.mat)
L(Or,Nr,t.shader_params)
geomDrawAuto(t)}for(var r=0;r<ri.length;++r){var a=ri[r]
S.updateMatrices(a.mat)
var i=a.color[3]
a.color[3]=a.low_fade_alpha
L(Or,Nr,a.shader_params)
a.geom_high.drawSub(a.geom_low_start,a.geom_low_tricount)
a.color[3]=i}}if(!S.defines.NOPROPS)for(var o=0;o<ti.length;++o)ti[o].drawProps()}function drawBulkEnd(){w(M(Gr))
Ja=$a=false
if(ei.length||ti.length||ri.length){gl.enable(gl.POLYGON_OFFSET_FILL)
gl.polygonOffset(-2,1)
gl.colorMask(false,false,false,false)
var e=Nr
if(!S.defines.NODEPTHONLY)Nr=Pr
drawFadingChunks()
gl.colorMask(true,true,true,true)
gl.depthMask(false)
gl.depthFunc(gl.EQUAL)
gl.enable(gl.BLEND)
Nr=e
drawFadingChunks()
gl.disable(gl.BLEND)
gl.depthMask(true)
gl.depthFunc(gl.LEQUAL)
ei.length=0
ti.length=0
ri.length=0
gl.disable(gl.POLYGON_OFFSET_FILL)}}VoxelData.prototype.draw2=function(e){if(this.shift_gen!==ta)this.updateMat()
this.updateColor()
if(e===Yt)this.last_was_low=true
else if(e===Vt)this.last_was_low=false
var t=!this.last_was_low
if(this.geom_high&&!S.defines.NOCHUNKS)if(Ja&&1!==this.color[3])ei.push(this)
else{S.updateMatrices(this.mat)
if(!$a)x(Gr)
L(Or,Nr,this.shader_params)
if(t){aa+=this.geom_high_tricount
ia+=this.geom_mid_tricount
this.geom_high.drawSub(0,this.geom_highmid_tricount)
if(this.drew_low_timestamp>sa){var r=S.frame_timestamp-this.drew_low_timestamp
this.low_fade_alpha=1-r/la
ri.push(this)
na+=this.geom_low_tricount
oa+=this.geom_mid_tricount
this.drew_high_timestamp=S.frame_timestamp-(la-r)}else this.drew_high_timestamp=S.frame_timestamp}else{na+=this.geom_low_tricount
oa+=this.geom_mid_tricount
if(this.drew_high_timestamp>sa){t=true
this.geom_high.drawSub(0,this.geom_highmid_tricount)
aa+=this.geom_high_tricount
ia+=this.geom_mid_tricount
var a=S.frame_timestamp-this.drew_high_timestamp
this.drew_low_timestamp=S.frame_timestamp-(la-a)
this.low_fade_alpha=a/la
ri.push(this)}else{this.geom_high.drawSub(this.geom_mid_start,this.geom_midlow_tricount)
this.drew_low_timestamp=S.frame_timestamp}}}if(t&&this.drawable_props&&!S.defines.NOPROPS)this.drawProps()
if((this.geom_alpha||this.geom_liquid)&&!S.defines.NOCHUNKS&&!S.defines.NOCHUNKSALPHA)u.alphaQueue(this)}
var li=5
a.registerValue("liquid_per_tick",{type:a.TYPE_INT,label:"Liquid updates per tick",range:[1,100],help:"Limit number of liquid updates per tick",get:function get(){return li},set:function set(e){li=e},store:false})
var _i=1
var ci
var ui
function updatePrepare(){ui=Qr&&ot()&&!ze()
ci=li}function updateFinalize(){it()
_r()
if(ci&&ui)++_i}function liquidUpdateDefer(e){var t=jr[e]
if(!t||!t.did_gen)return
at(t)}VoxelData.prototype.updateState=function(){if(this.gened_neighbors!==Ba){if(this.claimed===nr)cr(this)
return}var e=re(this.pos,h)>=Wt.claim_dist_sq||S.defines.NOCLAIM
if(!je(this.chunk_id))e=true
if(e){if(this.claimed===nr)cr(this)
return}if(this.claimed===sr&&(!this.claim_throttle||S.frame_timestamp>this.claim_throttle))lr(this)
if(this.claimed!==nr)return
if(this.has_updatable_prop)for(var t in this.props){var r=this.props[t]
if(r.updateState)r.updateState()}if(this.liquid&&this.liquid_unstable&&ui&&ci)if(this.liquid_update_gen===_i);else{this.liquid_update_gen=_i
if(st(this)){--ci
if(!this.liquid_unstable)this.updateInUpdateStateList()}}}
VoxelData.prototype.tick=function(){if(this.has_tickable_prop)for(var e in this.props){var t=this.props[e]
if(t.tick)t.tick()}}
var di=function(){var i=pe()
var o=[pe(-Te/2,-Te/2,-Te/2),pe(-Te/2,-Te/2,Te/2),pe(-Te/2,Te/2,-Te/2),pe(-Te/2,Te/2,Te/2),pe(Te/2,-Te/2,-Te/2),pe(Te/2,-Te/2,Te/2),pe(Te/2,Te/2,-Te/2),pe(Te/2,Te/2,Te/2)]
return function chunksGenedNearFn(e){for(var t=0;t<o.length;++t){J(i,e,o[t])
var r=chunkIdFromLocalFloatPos(pa,i)
var a=jr[r]
if(!a||!a.did_gen)return false}return true}}()
v.chunksGenedNear=di
var fi={}
function remeshAll(){for(var e in jr){var t=jr[e]
if(t.geom_high||t.geom_alpha)t.dirty(Kt)}for(var r in fi)fi[r].dispose()
fi={}}function remeshAllForShadows(){for(var e in jr){var t=jr[e]
if(t.geom_high||t.geom_alpha)if(t.shadow_buf_ver!==t.ver_meshing)t.dirty(Kt)}}a.registerValue("ao",{type:a.TYPE_INT,label:"AO",range:[0,15],help:"(Admin) Enable various Ambient Occlusion modes",access_run:["sysadmin"],get:function get(){return Kr},set:function set(e){Kr=e
remeshAll()},store:false})
function lightingValueFilter(e){if(pr()&&!e&&!dr("sysadmin"))e=1
return e}function checkNoFog(e){if(pr()&&!dr("sysadmin")&&S.defines.NOFOG){S.defines.NOFOG=false
if(!e)n()}}o("NOFOG",checkNoFog.bind(null,true))
var vi
var hi
var pi
function voxelDataWorldMetaChanged(){v.lighting_value=qr=lightingValueFilter(qr)
var e=false
var t=false
var r=false
var a=Tr()
if(a!==Qr){Qr=a
e=true}var i=gr()
if(i!==vi){vi=i
t=true}var o=Er()
if(o!==hi){hi=o
t=true}var n=mr()
if(n!==pi){pi=n
r=true}if(t)if(r)for(var s in jr){var l=jr[s]
l.applyBoostLevel()
l.updateRuntimeBehaviour()}else for(var _ in jr)jr[_].updateRuntimeBehaviour()
else if(e)if(r)for(var c in jr){var u=jr[c]
u.applyBoostLevel()
u.updateInUpdateStateList()}else for(var d in jr)jr[d].updateInUpdateStateList()
else if(r)for(var f in jr)jr[f].applyBoostLevel()
checkNoFog(false)}a.registerValue("lighting",{type:a.TYPE_INT,label:"Lighting",enum_lookup:{OFF:0,ON:1,NOAO:2},get:function get(){return qr},set:function set(e){e=lightingValueFilter(e)
if(qr!==e){v.lighting_value=qr=e
remeshAll()}},store:false})
function reset(){ce(h,0,0,0)
for(var e in jr)jr[e].recycle()
v.chunk_map=jr=[]
Wt.reset()
pt(jr)
$t()
rr()
_t.reset()
Sa={}
nt()
v.flashlight=0}var mi=ve(1)
var Ei=pe()
var gi=ve()
var Ti={}
function scaleLightVec(e,t,r){var a=Ti[t]
if(!a)a=Ti[t]=pe()
e[t]=le(a,E.globals[t],r)}function voxelPrepDrawParams(e,t,r){if(!t){e.minimum_ambient=mi
e.light_torch_top=e.light_torch_bot=e.light_torch_mid=Ee}else if(r&&r.scale_lights)if(r.monochrome){var a=Ar(E.globals.light_sun_key[0]+E.globals.light_sun_top[0],E.globals.light_sun_key[1]+E.globals.light_sun_top[1],E.globals.light_sun_key[2]+E.globals.light_sun_top[2])
a=wr(r.sun_factor*a,1)
if(S.defines.OLDLIGHT)e.ambient=e.light_diffuse=Ee
else e.light_sun_key=e.light_sun_top=e.light_sun_back=Ee
gi[0]=Ar(E.globals.minimum_ambient[0],a)
e.minimum_ambient=gi
le(Ei,Q,r.torch_factor)
e.light_torch_top=e.light_torch_bot=e.light_torch_mid=Ei}else if(S.defines.OLDLIGHT){scaleLightVec(e,"light_diffuse",r.sun_factor)
scaleLightVec(e,"ambient",r.sun_factor)
scaleLightVec(e,"light_torch_mid",r.torch_factor)}else{scaleLightVec(e,"light_sun_key",r.sun_factor)
scaleLightVec(e,"light_sun_top",r.sun_factor)
scaleLightVec(e,"light_sun_back",r.sun_factor)
scaleLightVec(e,"light_torch_top",r.torch_factor)
scaleLightVec(e,"light_torch_mid",r.torch_factor)
scaleLightVec(e,"light_torch_bot",r.torch_factor)}else e.light_torch_top=e.light_torch_bot=e.light_torch_mid=Ee}function drawSingleVoxelDirect(e){var t=this.color,r=this.lit,a=this.mat,i=this.z_bias,o=this.draw_opts,n=this.vd,s=this.face,l=this.opaque
if(a===n.mat){var _=this.pos,c=this.size
a[0]=c[0]
a[5]=c[1]
a[10]=c[2]
a[12]=_[0]
a[13]=_[1]
a[14]=_[2]}if(i)S.projectionZBias(i,Ar(e+16,16))
S.updateMatrices(a)
if(!$a)x(Gr)
var u={atlas_params_vp:_a,atlas_params_fp:ca,color:t||Q,cutout:n.cutout}
voxelPrepDrawParams(u,r,o)
L(Rr,l?xr:Mr,u)
if(n.geom_high)if(void 0!==s)n.geom_high.drawSub(6*s,2)
else n.geom_high.draw()
if(n.geom_alpha)n.geom_alpha.draw()
if(n.geom_liquid)n.geom_liquid.draw()
if(i)S.projectionZBias(0)}function drawSingleVoxel(e){var t=e.tile+(e.is_liquid?256:0)
var r=fi[t]
if(!r){(r=fi[t]=createUtilVD(new Int8Array([1,1,1]),e.is_liquid)).cutout[0]=ua
r.ver_meshing++
if(e.is_liquid){r.setUncheckedLiquid(Ee,e.tile)
r.updateGeometrySimple({liquid:true})}else{r.setUnchecked(Ee,e.tile)
r.updateGeometrySimple()}}e.vd=r
if(!e.mat){e.size=e.size||Q
r.mat[12]=e.pos[0]
r.mat[13]=e.pos[1]
r.mat[14]=e.pos[2]
e.mat=r.mat}e.drawAlpha=drawSingleVoxelDirect
if(e.opaque)e.drawAlpha()
else u.alphaQueue(e)}var yi=null
var Si=me()
var Ii=pe()
var Ai=he()
function drawSingleVoxelTexturedDirect(e){var t=this.tile,r=this.color,a=this.texs,i=this.lit,o=this.mat,n=this.blend,s=this.draw_opts,l=this.z_bias
var _=this.atlas_params_vp||Si
var c=this.atlas_params_fp||Ii
if(o===yi.mat){var u=this.pos,d=this.size
o[0]=d[0]
o[5]=d[1]
o[10]=d[2]
o[12]=u[0]
o[13]=u[1]
o[14]=u[2]}if(l)S.projectionZBias(l,Ar(e+16,16))
S.updateMatrices(o)
if(!$a)x(a)
_[0]=t/_.tiles_per_row
Ai[0]=n
var f={atlas_params_vp:_,atlas_params_fp:c,color:r||Q,blend:Ai,cutout:yi.cutout}
voxelPrepDrawParams(f,i,s)
L(Rr,n?Dr:Mr,f)
yi.geom_high.draw()
if(l)S.projectionZBias(0)}function drawSingleVoxelTextured(e){if(!yi){(yi=createUtilVD(new Int8Array([1,1,1]))).tile_map=Gt
yi.setUnchecked(Ee,1)
yi.updateGeometrySimple()
w(yi.geom_high)
w(!yi.geom_alpha)
w(!yi.geom_liquid)}if(!e.texs)e.texs=[e.tex,kr]
if(!e.mat){e.size=e.size||Q
yi.mat[12]=e.pos[0]
yi.mat[13]=e.pos[1]
yi.mat[14]=e.pos[2]
e.mat=yi.mat}e.drawAlpha=drawSingleVoxelTexturedDirect
if(e.opaque)e.drawAlpha()
else u.alphaQueue(e)}function shift(e){oe(h,e)
v.shift_gen=ta+=1}function VoxelSimpleDrawable(e,t,r,a){this.vd=e
this.origin_offset=pe()
this.inv_origin_offset=pe()
this.setOriginOffset(t)
w(r)
this.tex=r
this.tex_unowned=Boolean(a)}VoxelSimpleDrawable.prototype.setOriginOffset=function(e){te(this.origin_offset,e)
le(this.inv_origin_offset,this.origin_offset,-1)}
VoxelSimpleDrawable.prototype.dispose=function(){this.vd.dispose()
if(!this.tex_unowned)this.tex.dispose()}
VoxelSimpleDrawable.prototype.draw=function(e,t,r,a){a=a||{}
var i=this.vd
t=t||p
_(i.mat,r=r||1,t,e)
this.drawMat(i.mat,a)}
VoxelSimpleDrawable.prototype.drawMat=function(e,t){var r=this.vd
c(r.mat,e,this.inv_origin_offset)
e=r.mat
var a=t.z_bias,i=t.sort_z
if(a&&i)S.projectionZBias(.01,Ar(i+16,16))
S.updateMatrices(e)
if(!$a){C(0,this.tex)
for(var o=1;o<Gr.length;++o)C(o,Gr[o])}var n=t.color||Q
var s={atlas_params_vp:_a,atlas_params_fp:ca,color:n,cutout:r.cutout}
if(t.nofog||t.unlit)s.fog_params=Ee
voxelPrepDrawParams(s,!t.unlit,t)
if(!t.alpha_queue){L(Rr,Mr,s)
if(r.geom_high)r.geom_high.drawSub(0,r.geom_highmid_tricount)
if(r.geom_alpha)r.geom_alpha.draw()
if(r.geom_liquid)r.geom_liquid.draw()}else{L(Rr,xr,s)
var l=false
var _=t.flipped&&1===n[3]&&(r.geom_high||r.drawable_props&&!t.noprops)
if(_){_=true
gl.cullFace(gl.FRONT)}if(r.geom_high)if(1!==n[3])l=s.do_geom_high=true
else r.geom_high.drawSub(0,r.geom_highmid_tricount)
if(r.drawable_props&&!t.noprops)r.drawProps()
if(r.geom_alpha||r.geom_liquid)l=true
if(l)u.alphaQueue({mat:e,drawAlpha:this.drawAlpha2.bind(this,e,s,t)})
if(_)gl.cullFace(gl.BACK)}if(a&&i)S.projectionZBias(0)}
VoxelSimpleDrawable.prototype.drawAlpha2=function(e,t,r,a){var i=this.vd
if(r.flipped)gl.cullFace(gl.FRONT)
if(r.scale_lights)voxelPrepDrawParams(t,!r.unlit,r)
S.projectionZBias(.01,Ar(a+16,16))
S.updateMatrices(e)
if(!$a){C(0,this.tex)
for(var o=1;o<Gr.length;++o)C(o,Gr[o])}L(Rr,Mr,t)
if(t.do_geom_high)i.geom_high.drawSub(0,i.geom_highmid_tricount)
if(i.geom_alpha)i.geom_alpha.draw()
if(i.geom_liquid){gl.cullFace(gl.FRONT)
i.geom_liquid.draw()
gl.cullFace(gl.BACK)
i.geom_liquid.draw()}S.projectionZBias(0)
if(r.flipped)gl.cullFace(gl.BACK)}
function loadGoxel(e,t){t=t||{}
var r=e.split("\n")
var a=[]
a.push("ff00ff")
var i={}
var o=pe(Infinity,Infinity,Infinity)
var n=pe(-Infinity,-Infinity,-Infinity)
var s=[]
for(var l=0;l<r.length;++l){var _=r[l].trim()
if(!_||"#"===_[0])continue
var c=_.split(" ")
w.equal(c.length,4)
var u=pe(Number(c[0]),Number(c[1]),Number(c[2]))
for(var d=0;d<3;++d){o[d]=wr(o[d],u[d])
n[d]=Ar(n[d],u[d]+1)}var f=c[3]
w.equal(f.length,6)
var v=i[f]
if(!v){v=i[f]=a.length
a.push(f)}s.push([u,v])}var h=pe()
ee(h,Q,o,-1)
var p=pe()
ue(p,n,o)
ee(p,p,Q,2)
if(t.ground){p[2]--
h[2]--}w(Ar(Ar(p[0],p[1]),p[2])<128)
var m=createUtilVD(p=new Int8Array(p))
var E=new Int8Array(3)
for(var g=0;g<s.length;++g){var T=s[g]
J(E,T[0],h)
m.setUnchecked(E,T[1])}m.tile_map=ea
t.tint_colors=[]
w(a.length<=256)
for(var y=0;y<a.length;++y){var S=pe()
var I=a[y]
for(var A=0;A<3;++A)S[A]=parseInt(I.slice(2*A,2*A+2),16)/255
t.tint_colors[y]=S}m.updateGeometrySimple(t)
if(t.origin_offset)oe(h,t.origin_offset)
return new VoxelSimpleDrawable(m,h,Br,true)}function createSimpleDrawable(e,t){return new VoxelSimpleDrawable(e,t,Br,true)}var wi=pe(1,1,1)
var Li=pe(1,1,1)
var Oi=pe(1,1,1)
var Ri=pe(1,1,1)
var bi=5e-4
var Ni=ve(1)
function tickVD(){wt(wi,Li,Oi)
le(Ri,Li,v.flashlight)
Ni[0]=S.frame_timestamp*bi}var Ci=me(5,20,0,0)
var xi=me(0,0,0,0)
var Mi=me()
var Di=me()
function applyBumpParam(){if(0===Mi[1])fe(Di,0,0,0,0)
else fe(Di,1/(Mi[1]-Mi[0]),-Mi[0]/(Mi[1]-Mi[0]),0,0)}a.register({cmd:"bump_fade",help:"Set bumpmap fade parameters",usage:"$HELP\nUsage: /bump_fade fade_start fade_end\n  Fade start/end distance in voxels\n  Default: "+Ci[0].toFixed(0)+" "+Ci[1].toFixed(0)+" (WebGL1)\n  Default: "+xi[0].toFixed(0)+" "+xi[1].toFixed(0)+" (WebGL2)",func:function func(e,t){var r=e.split(" ")
if(2===r.length){de(Mi,r.map(j))
applyBumpParam()}return t(null,"bump_fade = "+Mi[0].toFixed(2)+" "+Mi[1].toFixed(2))}})
var Pi=new Float32Array([.05,.1,.2,.4,200])
var Bi=me()
function applyBevelParamWorld(){fe(Bi,1-Pi[0],1-Pi[1],1-Pi[3],1/Pi[4])
applyBevelValue(false,false)}function applyBevelParamCharacters(){fe(Bi,1-Pi[2],1-Pi[2],1-Pi[3],1/Pi[4])
applyBevelValue(false,true)}applyBevelParamWorld()
a.register({cmd:"bevel_param",help:"Set bevel parameters",usage:"$HELP\nUsage: /bevel_param near_vox near_sepx near_char far_all distance\n  Near and Far between 0.01 and 0.49\n  Distance in voxels\n  Default: "+Pi[0].toFixed(2)+" "+Pi[1].toFixed(2)+" "+Pi[2].toFixed(2)+" "+Pi[3].toFixed(2)+" "+Pi[4].toFixed(0),func:function func(e,t){var r=e.split(" ")
if(5===r.length){for(var a=0;a<r.length;++a)Pi[a]=Number(r[a])
applyBevelParamWorld()}return t(null,"bevel_param = "+Pi[0].toFixed(2)+" "+Pi[1].toFixed(2)+" "+Pi[2].toFixed(2)+" "+Pi[3].toFixed(2)+" "+Pi[4].toFixed(0))}})
E.addReservedDefine("BEVEL")
var ki=false
function applyBevelValue(e,t){var r=(Zr||e)&&Xr
var a=r?Wr:Fr
if(a){Gr.length=a.length
for(var i=0;i<a.length;++i)Gr[i]=a[i]
var o=r?"bevel":"nobevel"
var n=o
var s=ki&&!t
if(s)o+="_showchunks"
Or=Lr[o]
Rr=Lr[n]
if(!Or){R(false)
var l=[]
if(r)l.push("BEVEL")
if(s)l.push("SHOWCHUNKS")
Or=Lr[o]=y({filename:"shaders/voxel_pack.vp",defines:l})}if(!(Nr=br[o])){R(false)
var _=[]
if(r)_.push("BEVEL")
if(s)_.push("SHOWCHUNKS")
Nr=br[o]=y({filename:"shaders/voxel_pack.fp",defines:_})}xr=br[n]
o="softalpha_"+o
if(s)n="softalpha_"+n
else n=o
if(!(Cr=br[o])){R(false)
var c=["SOFTALPHA"]
if(r)c.push("BEVEL")
if(s)c.push("SHOWCHUNKS")
Cr=br[o]=y({filename:"shaders/voxel_pack.fp",defines:c})}Mr=br[n]
w(Or&&Rr&&Nr&&Cr&&xr&&Mr)}}m.register({bevel:{type:a.TYPE_INT,label:"Bevel",range:[0,1],help:"Enable corner rounding",default_value:Zr,on_change:function on_change(){v.bevel_value=Zr=m.bevel
applyBevelValue()}},fade_chunks:{type:a.TYPE_INT,label:"Fade Chunks",range:[0,1],help:"Enable fading of chunks",default_value:1},shadows:{type:a.TYPE_INT,label:"Player Shadows",range:[0,1],help:"Draw player shadows",default_value:1,on_change:function on_change(e){if(!e&&m.shadows)remeshAllForShadows()}}})
E.addReservedDefine("SHOWCHUNKS")
m.register({show_chunks:{type:a.TYPE_INT,label:"Show Chunk Boundaries",range:[0,1],help:"Enable visualization of chunk boundaries",default_value:0,is_toggle:true,on_change:function on_change(){ki=m.show_chunks
applyBevelValue()}}})
function recalcAtlasParams(e,t,r,a){if("primary"===e){calcAtlasParams(_a,ca,_extends({},qa,{tile_res:t,tex_w:r,tex_h:a}))
de(Si,_a)
de(Ii,ca)}else if("util"===e)calcAtlasParams(Xa,Qa,_extends({},Za,{tile_res:t,tex_w:r,tex_h:a}))}function disableBevelOnError(){v.bevel_available=Xr=false}function startup(){A("light_torch_top",wi)
A("light_torch_mid",Li)
A("light_torch_bot",Oi)
A("light_flashlight",Ri)
A("sway_offset",Ni)
var e=!S.DEBUG
Lr.bevel=y({filename:"shaders/voxel_pack.vp",defines:["BEVEL"],non_fatal:e})
Lr.nobevel=y({filename:"shaders/voxel_pack.vp",defines:[]})
br.bevel=y({filename:"shaders/voxel_pack.fp",defines:["BEVEL"],non_fatal:e})
br.nobevel=y({filename:"shaders/voxel_pack.fp",defines:[]})
br.softalpha_bevel=y({filename:"shaders/voxel_pack.fp",defines:["SOFTALPHA","BEVEL"],non_fatal:e})
br.softalpha_nobevel=y({filename:"shaders/voxel_pack.fp",defines:["SOFTALPHA"]})
Dr=y("shaders/voxel_pack_blend.fp")
Pr=y("shaders/voxel_pack_depth.fp")
v.bevel_available=Xr=Lr.bevel.valid&&br.bevel.valid&&br.softalpha_bevel.valid
if(S.webgl2){v.pack_tex_params=zr={target:gl.TEXTURE_2D_ARRAY,filter_mag:gl.LINEAR,filter_min:gl.LINEAR_MIPMAP_LINEAR}
var t=new Uint8Array(768)
for(var r=0;r<256;++r){t[3*r]=255
t[3*r+1]=0
t[3*r+2]=0}kr=D({name:"red_mask",width:1,height:256,target:gl.TEXTURE_2D_ARRAY,filter_mag:gl.LINEAR,filter_min:gl.LINEAR,format:N.RGB8,data:t})
var a=new Uint8Array(768)
for(var i=0;i<a.length;++i)a[i]=255
v.white_mask=Ur=D({name:"white_mask",width:1,height:256,target:gl.TEXTURE_2D_ARRAY,filter_mag:gl.LINEAR,filter_min:gl.LINEAR,format:N.RGB8,data:a})}else{v.pack_tex_params=zr={target:gl.TEXTURE_2D,filter_mag:gl.NEAREST,filter_min:gl.NEAREST}
kr=D({name:"red_mask",width:2,height:2,filter_mag:gl.NEAREST,filter_min:gl.NEAREST,format:N.RGB8,data:new Uint8Array([255,0,0,255,0,0,255,0,0,255,0,0])})
v.white_mask=Ur=B()}v.pack_texture=Br=D(F({url:S.webgl2?"img/voxels.array.png":"img/voxels.atlas.png"},zr))
var o=D(F({url:S.webgl2?"img/voxels_mask.array.png":"img/voxels_mask.atlas.png"},zr))
var n=D(F({url:S.webgl2?"img/voxels_normal.array.png":"img/voxels_normal.atlas.png"},zr));(Wr=(Fr=[Br,o]).slice(0)).push(n)
applyBevelValue()
calcAtlasParams(_a,ca,qa)
calcAtlasParams(Xa,Qa,Za)
de(Si,_a)
de(Ii,ca)
Hr=[[T.POSITION,gl.UNSIGNED_BYTE,4,false],[T.ATTR1,gl.UNSIGNED_BYTE,4,false],[T.ATTR2,gl.UNSIGNED_BYTE,4,true],[T.ATTR3,gl.UNSIGNED_BYTE,4,true]]
rt()
A("bevel_param",Bi)
de(Mi,S.webgl2?xi:Ci)
applyBumpParam()
A("bump_param",Di)
initDefaultTint()
Ge(assertPropPristineSend)
function doPrelinks(e,t){O(Lr[e],br[e],void 0,t)
O(Lr[e],br["softalpha_"+e],void 0,t)
O(Lr[e],Dr,void 0,t)
O(Lr[e],Pr,void 0,t)}doPrelinks("nobevel")
if(Xr)doPrelinks("bevel",disableBevelOnError)
if(Lr.nobevel_showchunks)doPrelinks("nobevel_showchunks")
if(Xr&&Lr.bevel_showchunks)doPrelinks("bevel_showchunks",disableBevelOnError)
qt({url_base:k(),on_reload_cb:function on_reload_cb(){remeshAll()
P()},create_vd_cb:createUtilVD,net_disconnected_cb:d})
ar()}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/voxel_data_common":264,"../common/world_trans":268,"../glov/client/browser":293,"../glov/client/cmds":298,"../glov/client/draw_list":301,"../glov/client/engine":305,"../glov/client/error_report":311,"../glov/client/geom":318,"../glov/client/hsv":324,"../glov/client/mat4ScaleRotateTranslate":336,"../glov/client/net":338,"../glov/client/perf":340,"../glov/client/quat":346,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/textures":365,"../glov/client/urlhash":369,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./atlas_params.json":14,"./biome_types":24,"./client_entities":44,"./editvolume_clear":83,"./editvolume_client":84,"./item_anims":116,"./items":119,"./light_calc":122,"./line3d":124,"./liquid":126,"./localization/localization":131,"./lods":132,"./main":135,"./megachunk_client":139,"./mesh_calc":142,"./mesh_exporter":143,"./proc_gen_biomes":163,"./props":171,"./sky":188,"./status":193,"./tiles":199,"./user_data":208,"./voxel_chunk_manager":214,"./voxel_const":215,"./voxel_data_xraw":218,"./voxel_gen":219,"./voxel_mesh":220,"./world_claims":225,"./world_comm":226,"./world_metadata":235,assert:void 0,"gl-mat4/translate":void 0}],217:[function(e,t,r){"use strict"
r.voxelDataDrawableLoad=voxelDataDrawableLoad
var l=e("../glov/common/util").merge
var _=e("./voxel_data")
var c=e("./voxel_data").VoxelSimpleDrawable
var u=e("./voxel_data_xraw").loadXRAW
function voxelDataDrawableReload(e,t){var r=t
var a=e.origin_offset,i=e.tool_pos,o=e.vd
var n=new c(o,a,_.pack_texture,true)
n.tool_pos=i
r.dispose()
var s=r.draw_offset
l(r,n)
r.draw_offset=s}function voxelDataDrawableLoad(e,t){var r=u(e,t)
var a=r.origin_offset,i=r.tool_pos,o=r.baked,n=r.vd,s=r.vmd
var l=new c(n,a,_.pack_texture,true)
l.tool_pos=i
if(t.draw_offset)l.draw_offset=t.draw_offset
s.reload_cb=voxelDataDrawableReload
return{drawing:s.reload_cb_payload=l,meshing:o}}},{"../glov/common/util":400,"./voxel_data":216,"./voxel_data_xraw":218}],218:[function(e,t,r){"use strict"
r.loadXRAW=loadXRAW
r.reloadXRAW=reloadXRAW
r.loadAsyncModelBinary=loadAsyncModelBinary
r.voxelDataXRAWStartup=voxelDataXRAWStartup
r.MODELS_BASEPATH=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i="models/"
r.MODELS_BASEPATH=i
var C=e("assert")
var n=e("../glov/client/fetch").fetch
var a=e("../glov/client/filewatch").filewatchOn
var s=e("../glov/client/locate_asset").locateAsset
var o=e("../glov/client/webfs")
var l=o.webFSGetFile
var _=o.webFSGetFileNames
var c=e("../glov/common/util")
var u=c.merge
var d=c.nop
var f=e("../glov/common/vmath")
var x=f.unit_vec
var M=f.v3addScale
var D=f.v3copy
var P=f.v3iAdd
var B=f.v3iMax
var k=f.v3iMin
var U=f.v3set
var G=f.vec3
var F=f.zero_vec
var v=e("./context").contextThreadName
var W=e("./mesh_calc").generateSimpleLODMesh
var H=e("./palette").paletteGetOrLoad
var z=Math.max
var h="models_streamed/"
var p=4
var m;(function(e){e[e["NOT_LOADED"]=0]="NOT_LOADED"
e[e["LOADING"]=1]="LOADING"
e[e["LOADED"]=2]="LOADED"})(m=m||{})
function isVoxelModelShell(e){return!e.binary}var V={}
var Y
var E=new Uint32Array(256)
function findLODColor(e,t,r){if(r.lod_color&&t[r.lod_color])return t[r.lod_color]
E.fill(0)
var a=e.data,i=e.size
var o=i[0],n=i[1],s=i[2]
var l=o*n
C(a)
for(var _=0,c=0;_<s;++_){var u=0===_||_===s-1
for(var d=0;d<n;++d){var f=u||0===d||d===n-1
for(var v=0;v<o;++v,++c){var h=a[c]
if(h)if(f||0===v||v===o-1||!a[c-1]||!a[c+1]||!a[c+o]||!a[c-o]||!a[c+l]||!a[c+l])E[h]++}}}var p=0
for(var m=1;m<256;++m)if(E[m]>E[p])p=m
return t[p]}function loadXRAW(e,t){var r=V[e]
if(!r||isVoxelModelShell(r))C(false,"Attempted to synchronously load nonexistent VoxelModel: "+e)
C(t)
C(t.palette)
var a=H(t.palette)
C(a)
C(a.tile_map)
var i=r.binary
var o=0
function eat(e){C.equal(i[o++],e)}var n=79===i[0]||67===i[0]||80===i[0]||84===i[0]
var s
var l
var _
var c=[0,0,0]
var u
var d=G()
if(t.origin_offset)D(d,t.origin_offset)
var f
if(t.for_baking){f=D(G(),t.bake_offset||F)
if(!t.origin_offset){var v=t.size||x
U(d,v[0]/2-f[0]/7,v[1]/2-f[1]/7,-f[2]/7)}}var h
var p=0
if(n){o++
s=i[o++]
l=i[o++]
_=i[o++]
var m=t.noscale||t.for_baking?1/7:1
if(80===i[u=0]){d[0]=i[o++]*m
d[1]=i[o++]*m
d[2]=i[o++]*m}if(84===i[0]){d[0]=i[o++]
d[1]=i[o++]
d[2]=i[o++];(h=G())[0]=i[o++]-d[0]
h[1]=i[o++]-d[1]
h[2]=i[o++]-d[2]
d[0]*=m
d[1]*=m
d[2]*=m}c[0]=i[o++]
c[1]=i[o++]
c[2]=i[o++]
if(f){P(f,c)
if(t.for_baking&&c[2]&&t.over_tile&&t.over_tile[4]){p=c[2]
f[2]-=p}}M(d,d,c,-m)
d[2]+=p*m}else{eat(88)
eat(82)
eat(65)
eat(87)
C.equal(i[o++],0)
var E=i[o++]
C(4===E)
C.equal(i[o++],8)
C.equal(i[o++],8)
s=i[o++]
eat(0)
eat(0)
eat(0)
l=i[o++]
eat(0)
eat(0)
eat(0)
_=i[o++]
eat(0)
eat(0)
eat(0)
u=i[o++]+(i[o++]<<8)
C(u<=256)
eat(0)
eat(0)}C(z(z(s,l),_)<128)
var g=new Uint8Array([s,l,_+p])
var T=Y(g)
var y=T.minpos=new Uint8Array([s-1,l-1,_+p-1])
var S=T.maxpos=new Uint8Array([0,0,0])
var I=new Int8Array(3)
for(var A=0;A<_;++A){I[2]=A+p
for(var w=0;w<l;++w){I[1]=w
for(var L=0;L<s;++L){var O=i[o++]
if(O){I[0]=L
B(S,I)
k(y,I)
T.setUnchecked(I,O)}}}}if(o!==i.length)o+=4*u
T.tile_map=a.tile_map
T.updateGeometrySimple(_extends({},t,{tint_colors:a}))
var R
if(t.for_baking){C(T.baked_mesh_data)
C(f)
var b=findLODColor(T,a,t)
R={bake_offset:f,data:T.baked_mesh_data,lod_data:W(y,S,b)}}var N={baked:R,opts:t};(r.vmds=r.vmds||[]).push(N)
return{origin_offset:d,tool_pos:h,baked:R,vd:T,vmd:N}}function reloadModelVMDs(e,t){for(var r=0;r<t.length;++r){var a=t[r]
var i=loadXRAW(e,a.opts)
var o=i.baked,n=i.vmd
var s=t.pop()
C.equal(n,s)
var l=a.baked
if(l){u(l,o)
i.baked=l}if(a.reload_cb)a.reload_cb(i,a.reload_cb_payload)}}var g
function reloadXRAW(e,t){var r=0
t=t||false
function reloadAndCountModelVSDs(e){var t=V[e]
if(t&&t.status===m.LOADED&&t.vmds){reloadModelVMDs(e,t.vmds)
r+=t.vmds.length}}if(!e)Object.keys(V).forEach(function(e){if(V[e].streamed===t)reloadAndCountModelVSDs(e)})
else reloadAndCountModelVSDs(e)
console.log("["+v()+"] Reloaded "+r+" models")
if(r)g()}function loadModelBinary(e){var t=l(e)
var r=e.slice(i.length)
var a=V[r]
if(!a)V[r]={streamed:false,status:m.LOADED,attempts:0,last_attempt:0,binary:t}
else{C(!a.streamed)
a.binary=t}}var T
var y
function loadAsyncModelBinary(a,e,t){var i=V[a]
var r=Date.now()
var o=e||d
if(!i)i=V[a]={streamed:true,status:m.NOT_LOADED,attempts:0,last_attempt:0}
if(!t)if(i.status===m.LOADED){o()
return true}else if(i.status===m.LOADING){o("ERR_LOADING_IN_FLIGHT")
return false}else if(r-i.last_attempt<i.attempts*i.attempts*100){o("ERR_TOO_MANY_ATTEMPTS")
return false}if(y()){i.attempts=0
o("ERR_DISCONNECTED")
return false}i.status=m.LOADING
n({url:""+T+s(""+h+a),response_type:"arraybuffer"},function(e,t){C(i)
if(e){i.status=m.NOT_LOADED;++i.attempts
i.last_attempt=Date.now()
console.error("Failed to load model: "+a+": "+e)
if(i.attempts===p)C(false,"Exhausted attempts to load model: "+a+" ("+e+")")
o(e)
return}i.status=m.LOADED
var r=new Uint8Array(t)
i.binary=r
o()})
return false}function reloadModel(e){loadModelBinary(e)
reloadXRAW(e.slice(i.length))}function reloadAsyncModel(e){var t=e.slice(h.length)
var r=V[t]
if(r)r.attempts=0
loadAsyncModelBinary(t,function(e){if(e){console.error("Failed to reload model: "+t)
return}reloadXRAW(t,true)},true)}function voxelDataXRAWStartup(e){g=e.on_reload_cb
Y=e.create_vd_cb
y=e.net_disconnected_cb
T=e.url_base
var t=_("models")
for(var r=0;r<t.length;++r)loadModelBinary(t[r])
a(i,reloadModel)
a(h,reloadAsyncModel)}},{"../glov/client/fetch":313,"../glov/client/filewatch":314,"../glov/client/locate_asset":331,"../glov/client/webfs":371,"../glov/common/util":400,"../glov/common/vmath":402,"./context":45,"./mesh_calc":142,"./palette":149,assert:void 0}],219:[function(e,t,r){"use strict"
r.voxelGenQueueContinentData=voxelGenQueueContinentData
r.seedWorld=seedWorld
r.voxelGensInProgress=voxelGensInProgress
r.voxelGenReset=voxelGenReset
r.voxelGenAttachHexomeChoices=voxelGenAttachHexomeChoices
r.voxelGenQueueHexomeChoices=voxelGenQueueHexomeChoices
r.voxelGenQueueDetailData=voxelGenQueueDetailData
r.voxelGenUnsubMegachunk2Ds=voxelGenUnsubMegachunk2Ds
r.voxelGenGetDetailDebugData=voxelGenGetDetailDebugData
r.voxelGen=voxelGen
r.hexome_choice_cache=void 0
var o=e("assert")
var n=e("../glov/client/engine")
var a=e("../glov/client/worker_comm")
var i=e("./continent").continentHandleData
var s=e("./continent_loader")
var l=s.continentLoaderReadyChunkPos
var _=s.continentLoaderSeedWorld
var c=s.continentLoaderWhenReadyChunkPos
var u=e("./lods")
var d=u.lodQueueContinentData
var f=u.lodQueueHexomeChoices
var v=e("./megachunk_client")
var h=v.hexomeChoiceGet
var p=v.hexomeChoiceReady
var m=v.hexomeChoiceSet
var E=v.isSpoiled
var g=v.megachunk2DHasZMap
var T=v.megachunk2DReady
var y=e("./proc_gen")
var S=e("./proc_gen_biomes")
var I=e("./proc_gen_biomes").choiceDataSet
var A=e("./proc_gen_constants").HEX_HEIGHT
var w=e("./proc_gen_details").detailGenSetData
var L=e("./sky").skyReinit
var O=e("./task_sched")
var R=O.WORKER_GEN
var b=O.taskCreate
var N=O.workerFlush
var C=O.workerFlushAll
var x=e("./voxel_data")
var M=e("./voxel_mesh")
var D=M.voxelMeshQueueContinentData
var P=M.voxelMeshQueueHexomeChoices
var B=M.voxelMeshQueueZMaps
var k=e("./world_get_chunk").worldGetChunk
var U=e("./world_metadata").worldMetadata
var G
var F
var W
var H
var z
var V
var Y=5*A
function voxelGenQueueContinentData(e){W.push(e)
D(e)
d(e)
i([e])}function seedWorld(){var e=U()
o(e)
o(e.seed)
o(e.world_type)
console.log("Using world seed "+e.seed+" for "+e.world_type+" world "+e.name)
y.seedWorld(e)
_(e)
C()
a.sendmsg(a.ALL,"seed",e)
if(!G)G=S.getHexomeIDsFromChunkPos
L()}var j=0
function voxelGensInProgress(){return j}var K
r.hexome_choice_cache=K
var q
var Z=0
function voxelGenReset(){q={}
r.hexome_choice_cache=K={}
F=[]
W=[]
H=[]
z=null
V={};++Z}function voxelGenAttachHexomeChoices(e,t){var r=G(t.pos)
for(var a=0;a<r.length;++a){var i=r[a]
if(!h(i))if(!K[i]);else{m(i,K[i])
e.tset.sendHexomeChoice(i,K[i])}}}function voxelGenQueueHexomeChoices(e){F.push(e)
P(e)
f(e)
for(var t in e)I(t,e[t])}function voxelGenQueueDetailData(e,t){w(e,t)
H.push(e,t)}function voxelGenUnsubMegachunk2Ds(e){if(z)z=z.concat(e)
else z=e}function voxelGenGetDetailDebugData(t){if(!V[t]){V[t]=[]
var r=Z
b({worker:R,time:0,type:"detail_debug",data:t},function(e){if(r!==Z)return
V[t]=e})
N(R)}return V[t]}var X=.375
var Q=4
function voxelGenWorkerAssign(e){var t=e.vsid
if(q[t])return X
q[t]=1
return Q}function requestGen(e){var t=e.vd,r=e.handleRequestGen
e.reset_generation=Z
o(l(t.pos,Y))
var a={chunk_id:t.chunk_id,pos:t.pos,has_zmap:g(t.pos)}
if(n.defines.NOWORKERS)r(y.gen(a))
else{if(F.length){a.hexome_choices=F
F=[]}if(W.length){a.continents=W
W=[]}if(H.length){a.details=H
H=[]}if(z){a.mc2d_unsubs=z
z=null}var i=voxelGenWorkerAssign(t)
b({worker:R,time:i,type:"gen",data:a},r)}}var $=[]
var J=function(){function VoxelGenRequestor(){this.data=null
this.cbWrap=this.cbWrapInternal.bind(this)
this.handleRequestFromServer=this.handleRequestFromServerInternal.bind(this)
this.whenReadyHandleIsSpoiled=this.whenReadyHandleIsSpoiledInternal.bind(this)
this.whenReadyHandleMegachunk2D=this.whenReadyHandleMegachunk2DInternal.bind(this)
this.whenReadyHandleContinentLoader=this.whenReadyHandleContinentLoaderInternal.bind(this)
this.handleWhenReady=this.handleWhenReadyInternal.bind(this)
this.handleRequestGen=this.handleRequestGenInternal.bind(this)
this.handleIsSpoiledAfterData=this.handleIsSpoiledAfterDataInternal.bind(this)}var e=VoxelGenRequestor.prototype
e.init=function init(e,t){this.vd=e
this.cb=t
this.reused=e.reused}
e.cbWrapInternal=function cbWrapInternal(e){var t=this.vd,r=this.reused,a=this.cb;--j
if(t.reused===r){t.assertInChunkMap()
t.gen_in_progress=false
a(e)}$.push(this)}
e.whenReadyStart=function whenReadyStart(){var e=this.vd
E(e.pos,this.whenReadyHandleIsSpoiled)}
e.whenReadyHandleIsSpoiledInternal=function whenReadyHandleIsSpoiledInternal(e){var t=this.vd,r=this.reused
if(t.reused!==r)return this.cbWrap()
this.spoiled_result=e
T(t.pos,this.whenReadyHandleMegachunk2D)}
e.whenReadyHandleMegachunk2DInternal=function whenReadyHandleMegachunk2DInternal(){var e=this.vd,t=this.reused
if(e.reused!==t)return this.cbWrap()
c(e.pos,Y,this.whenReadyHandleContinentLoader)}
e.whenReadyHandleContinentLoaderInternal=function whenReadyHandleContinentLoaderInternal(){var e=this.vd,t=this.reused
if(e.reused!==t)return this.cbWrap()
p(this.handleWhenReady)}
e.handleWhenReadyInternal=function handleWhenReadyInternal(){var e=this.vd,t=this.reused
if(e.reused!==t)return this.cbWrap()
e.assertInChunkMap()
if(this.spoiled_result)return this.requestFromServer()
requestGen(this)}
e.requestFromServer=function requestFromServer(){k(this.vd.chunk_id,this.handleRequestFromServer)}
e.handleRequestFromServerInternal=function handleRequestFromServerInternal(e,t){var r=this.vd,a=this.reused,i=this.cbWrap
if(r.reused!==a)return i(e)
r.assertInChunkMap()
if(e)return i(e)
r.did_gen=true
r.sent_pristine=true
if(r.deserialize(t))return i()
console.log(t)
return i("Bad serialization data received")}
e.handleRequestGenInternal=function handleRequestGenInternal(e){var t=this.vd,r=this.reused
if(this.reset_generation===Z){if(e.zmaps)B(e.zmaps)
if(e.hexome_choices)for(var a=0;a<e.hexome_choices.length;++a){var i=e.hexome_choices[a]
K[i.hid]=i.data}}if(t.reused!==r){x.timing.gen+=e.gen_time
this.cbWrap()
return}t.assertInChunkMap()
this.data=e
E(t.pos,this.handleIsSpoiledAfterData)}
e.handleIsSpoiledAfterDataInternal=function handleIsSpoiledAfterDataInternal(e){var t=this.vd,r=this.reused,a=this.data
this.data=null
if(t.reused!==r){x.timing.gen+=a.gen_time
return this.cbWrap()}t.assertInChunkMap()
if(e){x.timing.gen+=a.gen_time
this.requestFromServer()
return}t.did_gen=true
t.setDataMembers(a)
this.cbWrap()}
return VoxelGenRequestor}()
function allocVoxelGenRequestor(e,t){var r
if($.length)r=$.pop()
else r=new J(e,t)
r.init(e,t)
return r}function voxelGen(e,t){o(!e.gen_in_progress)
o(!e.did_gen)
e.assertInChunkMap()
e.gen_in_progress=true;++j
allocVoxelGenRequestor(e,t).whenReadyStart()}},{"../glov/client/engine":305,"../glov/client/worker_comm":373,"./continent":46,"./continent_loader":47,"./lods":132,"./megachunk_client":139,"./proc_gen":162,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./proc_gen_details":166,"./sky":188,"./task_sched":198,"./voxel_data":216,"./voxel_mesh":220,"./world_get_chunk":228,"./world_metadata":235,assert:void 0}],220:[function(e,t,r){"use strict"
r.voxelMeshQueueZMaps=voxelMeshQueueZMaps
r.voxelMeshRequestZMap=voxelMeshRequestZMap
r.voxelMeshUnsubMegachunk2Ds=voxelMeshUnsubMegachunk2Ds
r.voxelMeshesInProgress=voxelMeshesInProgress
r.voxelMeshDataSends=voxelMeshDataSends
r.voxelMeshBusy=voxelMeshBusy
r.voxelMeshReset=voxelMeshReset
r.voxelMeshStartup=voxelMeshStartup
r.voxelMeshQueueHexomeChoices=voxelMeshQueueHexomeChoices
r.voxelMeshQueueContinentData=voxelMeshQueueContinentData
r.voxelMeshUnload=voxelMeshUnload
r.voxelMeshNotifyLoaded=voxelMeshNotifyLoaded
r.voxelMesh=voxelMesh
r.voxelMeshFlush=voxelMeshFlush
r.voxelMeshGetZMapDebugData=voxelMeshGetZMapDebugData
var S=e("assert")
var a=e("../glov/client/cmds.js").cmd_parse
var s=e("../glov/client/engine.js")
var i=e("../common/globals.js"),l=i.CHUNK_SIZE,I=i.ID_FACTOR,_=i.ID2
var o=e("./lods.js").lodOnZMap
var c=Math.floor,u=Math.max,d=Math.min
var n=e("./megachunk_client.js").handleZMapData
var f=e("./mesh_calc.js").meshCalcMaxPropsPerChunk
var v=e("../glov/client/settings.js")
var h=e("./task_sched.js"),A=h.WORKER_MESH,w=h.taskBatchId,L=h.taskCreate,p=h.workerBatchQueued,m=h.workerFlush,E=h.workerReady
var O=e("../glov/common/verify.js")
var g=e("./voxel_chunk_manager.js").getKnownBounds
var R=e("./voxel_data.js")
var T=R.remeshAll
var y=e("../glov/common/util.js").nop
var b=e("../common/voxel_data_common.js"),N=b.UNCHUNKED_ID,C=b.ZMAP_UNDERGROUND
var x=1
var M=.125
var D=25
var P=0
var B=0
var k
var U=1+I+_
var G=0
var F=1
var W=2
var H
var z
var V
var Y
var j
var K
var q
var Z
var X
var Q
var $
function voxelMeshQueueZMaps(e){for(var t=0;t<e.length;++t){var r=e[t]
if(r.data!==C)o({vsid:r.vsid,data:r.data,from:"procgen"})}if(q)q=q.concat(e)
else q=e}function voxelMeshRequestZMap(e){Z.push(e)}function voxelMeshUnsubMegachunk2Ds(e){if(X)X=X.concat(e)
else X=e}function voxelMeshesInProgress(){return P}function voxelMeshDataSends(){return B}function voxelMeshBusy(){return!E(A)}var J=0
function voxelMeshReset(){k=R.chunk_map
V=(z=[{},{},{}])[G]
Y=z[F]
j=z[W]
H=[]
K=[]
Z=[]
X=q=null
Q=[]
$=[];++J
if(!s.defines.NOWORKERS)L({worker:A,time:0,type:"mesh_reset"},y)}function voxelMeshStartup(){f(v.max_props_per_chunk)
if(!s.defines.NOWORKERS)L({worker:A,time:0,type:"max_props_per_chunk",data:v.max_props_per_chunk},y)}v.register({max_props_per_chunk:{label:"Maximum Props per Chunk",default_value:400,type:a.TYPE_INT,range:[0,4096],access_show:["sysadmin"],store:false,on_change:function on_change(e){f(v.max_props_per_chunk)
if(J){if(!s.defines.NOWORKERS)L({worker:A,time:0,type:"max_props_per_chunk",data:v.max_props_per_chunk},y)
T()}}}})
function voxelMeshQueueHexomeChoices(e){Q.push(e)}function voxelMeshQueueContinentData(e){$.push(e)}function voxelMeshUnload(e){var t=e.chunk_id
S(t!==N)
var r=false
for(var a=0;a<z.length;++a)if(void 0!==z[a][t]){r=true
delete z[a][t]}if(r)H.push(t)}function voxelMeshNotifyLoaded(e){if(!e.full)K.push(e.chunk_id)}function handleLightingDirty(e,t){var r=g()[2]
for(var a in t){var i=t[a]
a=Number(a)
var o=u(r[0],i[0])
var n=d(r[1],i[1])
for(var s=o;s<=n;++s){var l=k[a+s*_]
if(l&&!l.mesh_dirty&&l.lighting_batch_id<e&&(l.data||l.liquid))l.dirty()}}}function handleResultShared(e,t){--P
if(e===J){if(t.lighting_dirty)if(R.lighting_value)handleLightingDirty(t.lighting_batch_id,t.lighting_dirty)
if(t.zmap_data)n(t.zmap_data)
if(t.extra_lighting)for(var r in t.extra_lighting){var a=k[r]
if(!a)continue
var i=t.extra_lighting[r]
S(!i.light_torch||i.light_torch instanceof Uint8Array)
S(!i.light_sun||i.light_sun instanceof Uint8Array)
a.light_torch=i.light_torch
a.light_sun=i.light_sun}}}function addQueuedEvents(e){var t
if(q){if(R.lighting_value){e.zmap_updates=q
for(var r=0;r<q.length;++r){var a=q[r]
if(a.data.buffer){if(!t)t=[]
t.push(a.data.buffer)}}}q=null}if(Z.length){e.zmap_requests=Z
Z=[]}if(X){e.mc2d_unsubs=X
X=null}if(Q.length){e.hexome_choices=Q
Q=[]}if($.length){e.continents=$
$=[]}return t}function voxelMesh(t,r,e,a){S(t.did_prop_check);++P
var i=t.reused
var o=J
function handleResult(e){handleResultShared(o,e)
if(t.reused===i){if(e.data&&!O(e.data instanceof Uint8Array))e.data=new Uint8Array(e.data)
if(e.alpha&&!O(e.alpha instanceof Uint8Array))e.alpha=new Uint8Array(e.alpha)
if(e.liquid&&!O(e.liquid instanceof Uint8Array))e.liquid=new Uint8Array(e.liquid)
if(e.light_torch&&!O(e.light_torch instanceof Uint8Array))e.light_torch=new Uint8Array(e.light_torch)
if(e.light_sun&&!O(e.light_sun instanceof Uint8Array))e.light_sun=new Uint8Array(e.light_sun)
t.setMeshData(r,e)
a()}}var n=[]
function sendData(e,t){if(t.data){if(V[e]!==t.ver_data)n.push({type:G,chunk_id:e,ver_data:t.ver_data,data:t.data,light_dirty:t.light_dirty})}else if(0!==V[e])n.push({type:G,chunk_id:e,ver_data:0,light_dirty:t.light_dirty})
if(t.liquid){if(Y[e]!==t.ver_data)n.push({type:F,chunk_id:e,ver_data:t.ver_data,data:t.liquid})}else if(0!==Y[e])n.push({type:F,chunk_id:e,ver_data:0})
if(t.baked_props){if(j[e]!==t.ver_props)n.push({type:W,chunk_id:e,ver_data:t.ver_props,data:t.baked_props})}else if(0!==j[e])n.push({type:W,chunk_id:e,ver_data:0})}if(e)handleResult(t.meshCalcWorld(r))
else{var s=t.chunk_id
S(s!==N)
t.lighting_batch_id=w(A)
var l=t.full
for(var _=0;_<=2;++_)for(var c=0;c<=2;++c)for(var u=0;u<=2;++u){var d=s+(_*I+c)*I+u-U
var f=k[d]
S(f)
S(f.did_gen)
l=l&&f.full
sendData(d,f)}if(l)return handleResult({ver_meshing:t.ver_meshing})
var v={chunk_id:s,ver_meshing:t.ver_meshing,opts:r}
var h=addQueuedEvents(v)
if(R.lighting_value){for(var p=0;p<K.length;++p){var m=K[p]
var E=k[m]
if(E)sendData(m,E)}K.length=0}var g=x
if(n.length){v.chunks=[]
for(var T=0;T<n.length;++T){var y=n[T]
v.chunks.push(y)
if(y.data){B++
g+=M}if(y.type===G&&y.light_dirty)k[y.chunk_id].light_dirty=0
z[y.type][y.chunk_id]=y.ver_data}}if(H.length){v.unloads=H
H=[]}L({worker:A,time:g,type:"mesh",data:v,transfer:h},handleResult)}}function voxelMeshFlush(){S(!s.defines.NOWORKERS)
if((q||X||Z.length||H.length)&&(E(A)||p(A))){++P
var e={chunk_id:N,opts:null}
var t=addQueuedEvents(e)
L({worker:A,time:D,type:"mesh",data:e,transfer:t},handleResultShared.bind(null,J))}m(A)}var ee={}
function voxelMeshGetZMapDebugData(e){if(s.defines.NOWORKERS)return"?"
var t=c(e[0]/l)
var r=c(e[1]/l)
var a=t+r*I
var i=e[0]-t*l+(e[1]-r*l)*l
var o=a+"_"+i
var n=ee[o]
if(!n)n=ee[o]={ts:0,v:"."}
if(n.ts<s.frame_timestamp-1e3){n.ts=s.frame_timestamp
L({worker:A,time:0,type:"zmap_debug",data:{vsid:a,idx:i}},function(e){n.v=e})
m(A)}return n.v}},{"../common/globals.js":248,"../common/voxel_data_common.js":264,"../glov/client/cmds.js":298,"../glov/client/engine.js":305,"../glov/client/settings.js":351,"../glov/common/util.js":400,"../glov/common/verify.js":401,"./lods.js":132,"./megachunk_client.js":139,"./mesh_calc.js":142,"./task_sched.js":198,"./voxel_chunk_manager.js":214,"./voxel_data.js":216,assert:void 0}],221:[function(e,t,r){"use strict"
r.walletShowCurrencyButtons=walletShowCurrencyButtons
r.walletShowFreeGemsButton=walletShowFreeGemsButton
r.walletShowValues=walletShowValues
r.walletAnimateIncrease=walletAnimateIncrease
var a=e("../glov/client/font")
var X=a.ALIGN
var Q=a.fontStyleAlpha
var i=e("../glov/client/net").netSubs
var $=e("../glov/client/ui")
var J=e("../glov/common/util").easeOut
var o=e("../glov/common/vmath")
var ee=o.v4set
var n=o.vec4
var s=e("./client_cmds").isElevated
var l=e("./currency_shop")
var _=l.getFreeCurrencyTimeInfo
var c=l.getRedeemRequestStatus
var te=l.openCurrencyShop
var d=e("./localization/localization").L
var re=e("./menu").menuDoTransition
var u=e("./menu_ribbon").pushMenuRibbonElement
var f=e("./styles")
var v=f.color_cosmetic_base_common
var h=f.color_cosmetic_base_epic
var p=f.color_cosmetic_base_rare
var m=f.color_cosmetic_bright_common
var E=f.color_cosmetic_bright_epic
var g=f.color_cosmetic_bright_rare
var ae=f.color_transparent
var ie=f.color_white
var oe=f.color_white_25
var T=f.colors_gems_free_wallet
var y=f.colors_gems_wallet
var S=f.colors_orbs_wallet
var I=f.style_wallet_gems
var A=f.style_wallet_gems_free
var w=f.style_wallet_orbs
var L=f.white_label_style
var ne=e("./ui_util")
var O=e("./world_comm")
var R=O.getGemBalance
var b=O.getOrbBalance
var N=Math.max
var se=1e3
function isWalletButtonParam(e){return Boolean(e.outline_colors)}var le=null
var C=64
var _e=5
var ce=11
var x=11
var M=4
var D=8
var P=5
var ue=3
var de=n()
function walletElement(B){var k=B.font_height,U=B.balance_text,G=B.balance_style,F=B.icon_frame,W=B.currency_type
var e=U.length>4&&isWalletButtonParam(B)?"0000":U
var H=$.font.getStringWidth(G,k,e)
var z=C+2*_e+2*ue
var V=isWalletButtonParam(B)?D:M
var Y=k
var j=H+Y+V
var K=0
var q=0
if(isWalletButtonParam(B)){K=B.msg_w_cb(k)
j+=(q=_e+ce+K+ce+x)+P+_e}u({w:j,cb:function cb(e,t){var r=e
var a=t
var i=e+H+V+Y/2
var o=t+z/2
if(isWalletButtonParam(B)){r+=q
i+=q}var n={x:i,y:o,z:Z.UI,w:Y,h:Y,frame:F}
ne.getUIUtilSpriteCentered().draw(n)
$.font.drawSizedAligned(G,r,a,Z.UI,k,X.HVCENTERFIT,H,z,U)
if(le&&le.currency_type===W){var s=(Date.now()-le.start)/se
if(s<1){var l=J(1-s,2)
var _=J(s,2)
var c=1+2*_
ee(de,1,1,1,l)
var u=i
var d=t-_*z/2
var f=d+z*c/2
var v=Y*c
var h=Z.UI+10
var p={x:u,y:f,z:h,w:v,h:v,frame:F,color:de}
ne.getUIUtilSpriteCentered().draw(p)
var m=i-v/2
var E=$.font.drawSizedAligned(Q(G,l),m,d,h,k*c,X.VCENTER|X.HRIGHT,0,z*c,"+"+le.amount)
var g=v/8
$.drawElipse(m-E-g,d-g,i+v/2+g,d+v+g,h-1,0,de)}}if(!isWalletButtonParam(B))return
var T=B.outline_colors,y=B.button_color_bright,S=B.button_color_dark,I=B.disabled,A=B.tooltip
$.drawCircle(i,o,Z.UI,.33*Y,0,ie)
var w=e+_e+ce
var L=a
B.msg_draw_cb(w,L,k,K,z)
var O={x:e,y:t,z:Z.UI,w:j,h:k+2*(ue+_e),align:X.HVCENTER,colors:T,img:$.sprites.white,img_color:ae,base_name:I?"button_disabled":"cosmetic_unselected",disabled:I,tooltip:A}
var R=$.button(O)
var b=O.w-2*_e
var N=O.h-2*_e
var C=O.x+_e
var x=O.y+_e
var M=C+b
var D=x+N
var P=Z.UI-.1
$.drawRect4Color(C,x,M,D,P,y,y,S,S)
$.drawRect(C,x,C+K+2*ce,x+N,P,oe)
if(R){re()
te(W)}}})}var B="+"
function currencyButtonGetMsgWidth(e){return $.font.getStringWidth(L,e,B)}function currencyButtonDrawMsg(e,t,r,a,i){$.font.drawSizedAligned(L,e,t,Z.UI,r,X.HLEFT|X.VCENTER,0,i,B)}var k=2
var U=.4
var G=.6
function freeGemsButtonGetMsgWidth(e,t){var r=(""+d.LBL_CURRENCY_SHOP_AVAILABLE_IN).toUpperCase()
var a=t*U
var i="00:00:00"
var o=t*G
var n=N($.font.getStringWidth(L,a,r),$.font.getStringWidth(L,o,i))
var s=(""+d.LBL_CURRENCY_SHOP_FREE_DAILY_BONUS).toUpperCase()
var l=t/k
while($.font.dims(L,n,0,l,s).numlines>2)n+=10
return n}function freeGemsButtonDrawMsg(e,t,r,a,i,o){if(!e)return
if(0===e.time_until){var n=(""+d.LBL_CURRENCY_SHOP_FREE_DAILY_BONUS).toUpperCase()
$.font.drawSizedAlignedWrapped(L,t,r,Z.UI,0,a/k,X.HVCENTER,i,o,n)
return}var s=a*U
var l=(""+d.LBL_CURRENCY_SHOP_AVAILABLE_IN).toUpperCase()
var _=a*G
var c=e.time_string
var u=.5*(o-(s+_))
$.font.drawSizedAligned(L,t,r+u,Z.UI,s,X.HVCENTER,i,s,l)
$.font.drawSizedAligned(L,t,r+u+s,Z.UI,_,X.HVCENTER,i,_,c)}function walletShowCurrencyButtons(e){if(!i().getMyUserChannel())return
walletElement({font_height:e=e||C,balance_text:""+b(),balance_style:w,msg_w_cb:currencyButtonGetMsgWidth,msg_draw_cb:currencyButtonDrawMsg,icon_frame:ne.ORBS,outline_colors:S,button_color_bright:E,button_color_dark:h,currency_type:"orb",tooltip:d.TLTP_OPEN_CURRENCY_SHOP})
walletElement({font_height:e,balance_text:""+R(),balance_style:I,msg_w_cb:currencyButtonGetMsgWidth,msg_draw_cb:currencyButtonDrawMsg,icon_frame:ne.GEMS,outline_colors:y,button_color_bright:g,button_color_dark:p,currency_type:"gem",tooltip:d.TLTP_OPEN_CURRENCY_SHOP})}function walletShowFreeGemsButton(e){if(!i().getMyUserChannel())return
e=e||C
var t=_()
if(!t)return
var r=s()?false:t.time_until>0||c()
walletElement({font_height:e,balance_text:""+t.amount,balance_style:A,msg_w_cb:freeGemsButtonGetMsgWidth.bind(null,t),msg_draw_cb:freeGemsButtonDrawMsg.bind(null,t),icon_frame:"gem"===t.currency_type?ne.GEMS:ne.ORBS,outline_colors:T,button_color_bright:m,button_color_dark:v,currency_type:"free_gems",disabled:r,tooltip:d.TLTP_OPEN_CURRENCY_SHOP})}function walletShowValues(e){if(!i().getMyUserChannel())return
walletElement({font_height:e=e||C,balance_text:""+b(),balance_style:w,icon_frame:ne.ORBS,currency_type:"orb"})
walletElement({font_height:e,balance_text:""+R(),balance_style:I,icon_frame:ne.GEMS,currency_type:"gem"})}function walletAnimateIncrease(e,t){le={start:Date.now(),currency_type:e,amount:t}}},{"../glov/client/font":315,"../glov/client/net":338,"../glov/client/ui":367,"../glov/common/util":400,"../glov/common/vmath":402,"./client_cmds":43,"./currency_shop":72,"./localization/localization":131,"./menu":140,"./menu_ribbon":141,"./styles":197,"./ui_util":205,"./world_comm":226}],222:[function(e,t,r){"use strict"
r.waygateUIStartup=waygateUIStartup
r.waygateUIInit=waygateUIInit
r.waygateUIIsSettlement=waygateUIIsSettlement
r.waygateUIIsAccessControl=waygateUIIsAccessControl
r.userTextureLoad=userTextureLoad
r.waygateTexture=waygateTexture
r.calcWGLinkWidth=calcWGLinkWidth
r.linkUIDrawTextureFadeAndSheen=linkUIDrawTextureFadeAndSheen
r.waygateLinkUI=waygateLinkUI
r.drawHLine=drawHLine
r.waygateEditTitle=waygateEditTitle
r.doEnergyWell=doEnergyWell
r.waygateEditRemote=waygateEditRemote
r.doWaygateEdit=doWaygateEdit
r.doWaygateTargets=doWaygateTargets
r.drawWaygateFX=drawWaygateFX
r.waygateSelectAutoActivate=waygateSelectAutoActivate
r.waygateExecuteAutoActivate=waygateExecuteAutoActivate
r.sheen_uvs_idle=r.sheen_uvs_active=r.sheen_color_idle=r.sheen_color_active=r.OVERLAY_TITLE_Y=r.OVERLAY_TITLE_H_THUMB=r.OVERLAY_TITLE_H=r.LINKUI_HOVER_RATE=r.LINKUI_GROW_SIZE=r.SUBLABEL_H=r.SUBLINE_W=r.LINE_W=r.SUBTITLE_H=r.TITLE_H=r.PAD=r.FONT_HEIGHT=void 0
var a=36
r.FONT_HEIGHT=a
var O=8
r.PAD=O
var u=1.5*a
r.TITLE_H=u
var R=1.25*a
r.SUBTITLE_H=R
var d=382
var b=.5*(r.LINE_W=d)
r.SUBLINE_W=b
var f=24
r.SUBLABEL_H=f
var fe=.05
r.LINKUI_GROW_SIZE=fe
var ve=.005
r.LINKUI_HOVER_RATE=ve
var he=.2
var pe=2*(r.OVERLAY_TITLE_H=he)
r.OVERLAY_TITLE_H_THUMB=pe
var me=.02
r.OVERLAY_TITLE_Y=me
var i=e("../glov/common/vmath").rovec4
var Ee=i(1,1,1,.2)
r.sheen_color_active=Ee
var ge=i(1,1,1,.1)
r.sheen_color_idle=ge
var Te=i(0,.2,1,1.2)
r.sheen_uvs_active=Te
var ye=i(0,.5,1,1.5)
r.sheen_uvs_idle=ye
var Q="exit"
var Se=e("assert")
var v=e("../glov/client/camera2d")
var Ie=e("../glov/client/engine")
var h=e("../glov/client/engine").getFrameTimestamp
var Ae=e("../glov/client/font").ALIGN
var N=e("../glov/client/input")
var we=e("../glov/client/link").link
var g=e("../glov/client/markdown_parse").mdEscape
var o=e("../glov/client/net")
var C=o.netClient
var $=o.netSubs
var J=o.netUserId
var x=e("../glov/client/scroll_area").scrollAreaCreate
var ee=e("../glov/client/selection_box").dropDown
var p=e("../glov/client/settings")
var n=e("../glov/client/sprites")
var s=n.spriteCreate
var m=n.spriteQueueRaw
var l=e("../glov/client/textures")
var _=e("../glov/client/transition")
var Le=e("../glov/client/ui")
var c=e("../glov/client/ui")
var E=c.uiButtonHeight
var T=c.uiButtonWidth
var M=e("../glov/client/urlhash")
var Oe=e("../glov/client/urlhash").getLinkURL
var y=e("../glov/common/util")
var S=y.defaults
var I=y.easeInOut
var Re=y.easeOut
var A=y.fract
var be=y.nop
var Ne=e("../glov/common/verify")
var w=e("../glov/common/vmath")
var L=w.unit_vec
var Ce=w.v4lerp
var D=w.vec4
var P=e("../common/ids")
var B=P.ITEM_BLUEPRINT
var k=P.ITEM_WAYGATE
var U=P.TYPE_ITEM
var G=e("../common/types")
var te=G.linkPayloadIsBlueprint
var re=G.linkPayloadIsPhoto
var ae=G.linkPayloadIsUser
var ie=G.linkPayloadIsWorld
var F=e("../common/waygate_common")
var W=F.MAX_WAYGATE_TARGETS
var H=F.WAYGATE_ID_LEN
var oe=F.WAYGATE_MAX_VISUAL_SIZE
var ne=F.WAYGATE_NAME_LEN
var z=F.waygateImagePath
var V=F.waygate_invalid_ids
var Y=F.waygate_invalid_regex
var j=F.waygate_valid_regex
var K=e("../common/world_constants")
var se=K.VOLUME_SETTLEMENT_PREFIX
var le=K.WAYGATE_FLAG_LISTED
var q=K.WAYGATE_FLAG_SETTLEMENT
var X=K.WAYGATE_SETTLEMENT_AUTO
var _e=K.WORLD_ACCESS_MODIFY_BUILDER
var ce=K.WORLD_ACCESS_MODIFY_LIMITED
var xe=K.boostLevelFromCount
var ue=e("./access_control")
var de=ue.accessControlRun
var Me=ue.accessControlStartup
var De=e("./account_ui").formatUserID
var Pe=e("./auto_activate_ui")
var Be=Pe.GateAccess
var ke=Pe.GateTime
var Ue=Pe.gateAccessBlocked
var Ge=Pe.gateAccessDropdown
var Fe=Pe.gateTimeDropdown
var We=e("./blueprint").blueprintGetDef
var He=e("./build_mode").doStamina
var ze=e("./build_queue_ui").boostWidgetShow
var Ve=e("./editvolume_client")
var Ye=Ve.manageVolumeAllowedForPos
var je=Ve.settlementEstablishAllowed
var Ke=e("./energy_well")
var qe=Ke.energyWellCharged
var Ze=Ke.energyWellChargedTime
var Xe=Ke.energyWellDrink
var Qe=Ke.energyWellInit
var $e=Ke.energyWellRun
var Je=Ke.energyWellShouldAutoDrink
var et=Ke.energyWellStartup
var tt=e("./file_management").uploadInProgress
var rt=e("./fx_util")
var at=rt.fxUtilGlow
var it=rt.fxUtilGradient
var ot=e("./inventory").inventoryLocked
var nt=e("./inventory_ui").inventoryButton
var st=e("./items")
var lt=st.ITEM_CONTEXT_BUILD
var _t=st.createItem
var ct=st.sameItem
var ut=e("./layout").layoutCameraCurX1
var dt=e("./link_parse").linkParseGeneric
var ft=e("./localization/localization").L
var vt=e("./main")
var ht=e("./main")
var pt=ht.blockImageUpload
var mt=ht.isMenuPage
var Et=ht.menuExit
var gt=ht.postTick
var Tt=ht.returnToMainMenu
var yt=e("./menu")
var St=e("./menu")
var It=St.WAYGATE_EDIT
var At=St.WAYGATE_EDIT_REMOTE
var wt=St.menuDoTransition
var Lt=St.menuInteractGetPos
var Ot=St.menuInteractGetProp
var Rt=St.menuTabColors
var bt=St.menuY1
var Nt=e("./photo_link_ui")
var Ct=Nt.photoLinkUI
var xt=Nt.photoLinkUIStartup
var Mt=e("./photo_mode")
var Dt=Mt.errorModalDialog
var Pt=Mt.photoCapture
var Bt=Mt.setImageUploadFalse
var kt=Mt.validatePhotoCapture
var Ut=e("./photo_ui").photoInfoGet
var Gt=e("./platform_worlds_client").PLATFORM_DISCORD
var Ft=e("./prop_edit")
var Wt=Ft.BUTTON_H
var Ht=Ft.BUTTON_W
var zt=Ft.saveProp
var Vt=Ft.savingMessage
var Yt=e("./rand_seed")
var jt=e("./settlement")
var Kt=jt.isSettlement
var qt=jt.settlementLastBoundID
var Zt=e("./settlement_edit")
var Xt=Zt.settlementEditInit
var Qt=Zt.settlementEditRun
var $t=Zt.settlementEditStartup
var Jt=e("./sharing/platform_share_handlers")
var er=Jt.shareWorld
var tr=Jt.shareWorldLink
var rr=Jt.sharingLinksEnabled
var ar=Jt.sharingWorldEnabled
var ir=e("./status").statusGet
var or=e("./store").getProductIdOrbCost
var nr=e("./styles")
var sr=nr.color_black
var lr=nr.color_title_underlay
var _r=nr.color_trophies
var cr=nr.hint_style
var ur=nr.label_style
var dr=nr.label_warning_style
var fr=nr.menu_header_style
var vr=nr.overlay_title_style
var hr=nr.overlay_title_style_full
var pr=nr.style_gems
var mr=nr.style_orbs
var Er=nr.sublabel_style
var gr=e("./ui_util")
var Tr=e("./ui_util").STAMINA_SYMBOL
var yr=e("./ui_util_2")
var Sr=e("./user_data")
var Ir=Sr.userDataPredict
var Ar=Sr.userHomeSettlementID
var wr=Sr.waygateEditAllowed
var Lr=e("./user_info_view")
var Or=Lr.userInfoGet
var Rr=Lr.userInfoViewClear
var br=Lr.userProfileButton
var Nr=e("./user_profile_view").userProfileViewOpen
var Cr=e("./world_comm")
var xr=Cr.getWorldChannel
var Mr=Cr.getWorldID
var Dr=Cr.myUserCmdParse
var Pr=Cr.worldRecordCurrentWGID
var Br=Cr.worldSend
var kr=Cr.worldTargetGo
var Ur=e("./world_info").getWorldInfo
var Gr=e("./world_info_view")
var Fr=Gr.cmpWaygateID
var Wr=Gr.cmpWaygateInit
var Hr=Gr.worldLink
var zr=e("./world_metadata")
var Vr=zr.adventureMode
var Yr=zr.worldEnergy
var jr=zr.worldMetadata
var Kr=zr.worldMetadataFreePos
var qr=zr.worldMetadataWaygate
var Zr=zr.worldMetadataWaygates
var Xr=zr.worldSettlements
var Qr=Math.ceil,$r=Math.floor,Jr=Math.max,ea=Math.min,ta=Math.random
var ra
var aa
var ia={}
var oa
var na
function waygateUIStartup(){Le.loadUISprite("rect",[10,44,10],[10,44,10])
Le.loadUISprite("rect_shadow",[10,44,10],[10,44,10])
na=s({name:"sheen",wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
ra=Le.font
aa=Le.title_font
oa={filter_mag:gl.LINEAR,filter_min:gl.LINEAR_MIPMAP_LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE};["procgen","new","extra_slot"].forEach(function(e){ia[e]={preview:l.load(S({url:"img/placeholder/"+e+"_preview.jpg"},oa)),thumb:l.load(S({url:"img/placeholder/"+e+"_thumb.png"},oa))}})
xt()
oa.soft_error=true
oa.auto_unload=true
$t()
et()
Me()}function waygateGetMetadataFromProp(e){var t=Zr()
for(var r in t){var a=t[r]
if(e.chunk_id===a.pos[0]&&e.pos_idx===a.pos[1]){var i=Xr()&&Boolean(a.flags&q)
return{wgid:r,wg:a,is_settlement:i,is_unbound:i&&r!==Ar()}}}return null}var sa
function waygateGetMetadataRemote(){var e=sa
var t=qr(e)
if(!t)return null
var r=Xr()&&Boolean(t.flags&q)
return{wgid:e,wg:t,is_settlement:r,is_unbound:r&&e!==Ar()}}var la=1
var _a=2
var ca=3
var ua=4
var da=la
function waygateUIInit(e){da=la
var t
var r
if(e)t=waygateGetMetadataRemote()
else{sa=null
if((r=Ot())&&r.item_id===k)t=waygateGetMetadataFromProp(r)}if(Xr()){if(t&&t.is_settlement)if(He()&&r&&Je(r))da=ca
else da=_a}else if(He())if(r&&Je(r))da=ca
Xt()
Qe()}function waygateUIIsSettlement(){return yt.page===yt.WAYGATE_EDIT&&da===_a}function waygateUIIsAccessControl(){return yt.page===yt.WAYGATE_EDIT&&da===ua||yt.page===yt.ACCESS_CONTROL}function showError(e,t){if(!t){Vt(ft.MSG_SAVED)
return}Le.modalDialog({title:e,text:t,buttons:{OK:null}})}function stillHere(){var e=Ot()
if(!e){Le.modalDialog({title:ft.LBL_ERROR,text:ft.ERR_WAYGATE_DISAPPEARED,buttons:{OK:null}})
return null}return e}function bestImageID(){var e=Zr()
var t=jr()
var r=t&&t.image&&t.image.sets||{}
var a={}
for(var i in e){var o=e[i]
if(o.imgid)a[o.imgid]=true}var n=0
var s=Infinity
for(var l in r){var _=Number(l)
if(!a[l])n=Jr(n,_)
s=ea(s,_)}if(n)return n
return 0}function confirmAssign(e,r,a){var t=stillHere()
if(t){var i
if(!qr(e)&&e!==X)i=bestImageID()
var o={wgid:e,chunk_id:t.chunk_id,pos_idx:t.pos_idx,rot:t.rot}
if(i)o.imgid=i
Br("waygate_set",o,function(e,t){if(e){Le.modalDialog({title:r||ft.LBL_ERROR,text:e,buttons:{OK:null}})
return void vt.chat_ui.addChatError(e)}if(t.home)Ir("home",t.home,true)
if(t.wg)Ir("wg",t.wg,true)
if(a)da=a})}}function waygateAssignID(e){if(!stillHere())return
if(!e.match(j)||e.match(Y)||V[e]||e.endsWith("_")){Le.modalDialog({title:ft.LBL_ERROR,text:ft.ERR_INVALID_WGID,buttons:{OK:null}})
return}if(Zr()[e])Le.modalDialog({title:ft.DLG_ASSIGN_WGID_TITLE,text:"default"===e?ft.DLG_ASSIGN_WGID_DEF_MSG_CONFIRM+"\n\n"+ft.DLG_ASSIGN_WGID_DEF_MSG_SCREENSHOT:ft.$(ft.DLG_ASSIGN_WGID_ALREADY_MSG_CONFIRM,e)+"\n\n"+ft.DLG_ASSIGN_WGID_ALREADY_MSG_LINKS,buttons:{Yes:function Yes(){confirmAssign(e)},No:null}})
else confirmAssign(e)}function waygateAssignIDPrompt(){var e=1
var t=Zr()
while(t[e])e++
Le.modalTextEntry({edit_text:String(e),max_len:H,title:ft.DLG_LINKABLE_WGID_TITLE,text:ft.DLG_LINKABLE_WGID_MSG,buttons:{OK:function OK(e){waygateAssignID(e.toLowerCase().trim())},Cancel:null}})}function waygateEstablishSettlement(){Le.modalDialog({title:ft.DLG_ESTABLISH_SETTLEMENT_TITLE,text:ft.DLG_ESTABLISH_SETTLEMENT_MSG_HOME+"\n\n"+ft.DLG_ESTABLISH_SETTLEMENT_MSG_CONFIRM,buttons:{yes:function yes(){confirmAssign(X,ft.DLG_ERROR_ESTABLISHING_SETTLEMENT,_a)},cancel:null}})}function waygateMoveSettlement(){var e=qt()
Se(e)
Le.modalDialog({title:ft.DLG_MOVE_SETTLEMENT_TITLE,text:ft.DLG_MOVE_SETTLEMENT_MSG_WARNING+"\n\n"+ft.DLG_MOVE_SETTLEMENT_MSG_CONFIRM,buttons:{yes:function yes(){confirmAssign(e,ft.DLG_ERROR_MOVING_SETTLEMENT,_a)},cancel:null}})}function waygateRename(e,t){if(!xr())return void showError(ft.DLG_ERROR_RENAMING_WG_TITLE,ft.ERR_WORLD_DISCONNECTED)
Br("waygate_mod",{wgid:e,key:"name",value:t},showError.bind(null,ft.DLG_ERROR_RENAMING_WG_TITLE))}function userTextureLoad(e){var t=e
if(Gt)t=e.replace("https://storage.googleapis.com/","storagegoogleapis/")
return l.load(S({url:t},oa))}function waygateTexture(e,t,r){return userTextureLoad(z(e,t,r))}var fa=.175
var va=1.9*fa
var ha=D(0,0,0,1)
var pa=D(1,1,1,1)
var ma=D(0,0,0,.25)
var Ea=D(0,1,0,1)
var ga=D(.3,.3,.3,1)
var Ta=D(1,1,1,1)
var ya={}
function getState(e,t,r){var a=Ie.frame_index
var i=["wglui",e,t,r].join("_")
var o=ya[i]
if(!o)o=ya[i]={key:i,color:D(),uvs:D()}
Ne(o.frame!==a)
if(o.frame!==a-1){o.active=0
o.reset=true}else o.reset=false
o.frame=a
return o}function calcWGLinkWidth(e){return 4*e/3}var Sa={}
function linkUIDrawTextureFadeAndSheen(e,t,r,a,i,o,n){if(e.loaded||e.err){var s=300
var l=L
var _=h()
if(t.reset||!t.last_tex||t.last_tex.destroyed||t.last_tex_time&&t.last_tex_time<_-s){t.last_tex=e
t.last_tex_time=0}else if(e!==t.last_tex){if(!t.last_tex_time)t.last_tex_time=_
m([t.last_tex],r,a,i,o,n,0,0,1,1,L)
var c=(_-t.last_tex_time)/s
Ta[3]=I(c,2)
l=Ta}m([e],r,a,i+.01,o,n,0,0,1,1,l)}Sa.x=r
Sa.y=a
Sa.w=o
Sa.h=n
Sa.z=i+.4
Sa.color=t.color
Sa.uvs=t.uvs
na.draw(Sa)}var Ia=0
var Aa=1
var wa=2
var La=3
var Oa=4
function showBuildIcon(e,t,r){if(e===jr())e=Ur(t,!r)
if(!e)return Ia
var a=e.access_modify>=_e?wa:e.access_modify>=ce?Aa:Ia
if(e.owner&&e.owner.user_id!==J()&&e.user_access)if(e.user_access>=_e){if(a!==wa)a=Oa}else if(e.user_access>=ce)if(a!==Aa)a=La
return a}var Ra={}
function waygateLinkUI(e){profilerStart("waygateLinkUI")
var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.target,s=e.img_style,l=e.max_grow,_=e.ctx,c=e.url,u=e.no_overlay,d=e.world_data,f=e.name_guess,v=e.frozen,h=e.border_color,p=e.hide_unlisted
e.button_long_press=true
Se(_)
a=(a||Z.UI)+22
l=l||fe
if(!Ne("string"!==typeof e.style))s=e.style
s=s||"thumb"
if(!i)i=e.w=calcWGLinkWidth(o)
var m="preview"===s&&!u
var E=void 0===e.overlay_mode?m:e.overlay_mode
var g=void 0===e.overlay_users?m:e.overlay_users
var T=void 0===e.overlay_title?m:e.overlay_title
var y=E||g||T
var S=n.wid||Mr()
var I=n.wgid||"default"
if("info"===I)I="default"
var A=getState(S,I,_)
var w="info"===I||"default"===I
var L="NEW"===S?null:S!==Mr()?d||Ur(S,!w):jr()
if(p&&S!==Mr()&&L&&(!L.access_listed||!L.user_access))L={err:"ERR_DOES_NOT_EXIST"}
var O=L?L.name||f||ft.LBL_UNKNOWN_WORLD_NAME:f
if(L&&L.name&&f&&f!==L.name&&!Ra[S]){Ra[S]=true
Dr("world_name_fix "+S+" "+L.name,be)}var R
if(!L)R=ft.WGLINK_LOADING
if(!R&&L.err)R=L.err
var b=!R&&L.waygates&&L.waygates[I]
if(v)R=ft.WGLINK_FROZEN
if(!R&&!b&&"default"!==I)R=ft.WGLINK_NOT_FOUND
if(!R&&y&&L&&L.full)R=ft.WGLINK_FULL
var N
h=h||ha
var C
if("NEW"===S){O=ft.LBL_NEW_WORLD
R=null
N=ia.new[s]
h=pa}else if("EXTRA_SLOT"===S){O=ft.LBL_EXTRA_WORLD_SLOT
R=null
N=ia.extra_slot[s]
h=pa
C=or("extra_world_slot")
E=true}else N=waygateTexture(L,s,I)
if(!N||!N.loaded)N=ia.procgen[s]
delete e.url
var x=Le.buttonShared(e)
e.url=c
profilerStart("display")
if("rollover"===x.state||"down"===x.state)A.active=ea(1,A.active+ve*Ie.frame_dt)
else A.active=Jr(0,A.active-ve*Ie.frame_dt)
var M=Re(A.active,2)
a+=10*M
Ce(A.color,M,ge,Ee)
Ce(A.uvs,M,ye,Te)
var D=l*M
var P=1+2*D
t-=D*i
r-=D*o
i*=P
o*=P
if(R)ra.drawSizedAligned(ur,t,r,a,Le.font_height*P,Ae.HCENTERFIT|Ae.VCENTER,i,o,R)
if((L||O)&&y){var B=("thumb"===s?pe:he)*o
if(T){var k=.05*i
var U=i-2*k
var G=t+k
var F=r+o*me
var W=ra.drawSizedAligned(L&&L.full?hr:vr,G,F,a+.3,B,Ae.HFIT|Ae.HRIGHT,U,B,O)
Le.drawRect(G+U-W-k,r,t+i,F+B,a+.25,lr)}if(g){var H=L&&L.players||0
if(!H&&L===jr()){var z=Ur(S,!w)
if(z)H=z.players||0}if("thumb"===s&&1===H)H=0
if(H){var V=("thumb"===s?va:fa)*o
var Y={x:t,y:r+o-1.2*V,w:V,h:V,z:a+.3,frame:gr.PLAYER,color:Ea}
gr.sprite.draw(Y)
if(H>1){Y.x+=.55*V
Y.z-=.01
gr.sprite.draw(Y)
if(H>5){Y.x+=.55*V
Y.z-=.01
gr.sprite.draw(Y)}}}}if(e.teleport_icon){var j=.75*o
var K={x:t+.5*(i-j),y:r+.5*(o-j),z:a+.29,w:j,h:j,frame:gr.TELEPORT}
gr.sprite.draw(K)}if(E){var q="thumb"===s?.975*B:B
var X=t+.965*i
var Q=r+.965*o
var $=X
var J=r+o*(1-.965)
if(L&&!L.err&&!L.unlimited){gr.sprite.draw({x:X-q,y:Q-q,z:a+.3,w:q,h:q,frame:gr.ADVENTURE_MODE})
X-=1.1*q}if(L&&L.gems)X-=ra.drawSizedAligned(pr,X,Q,a+.31,q,Ae.HRIGHT|Ae.VBOTTOM,0,0,"♦")+.1*q
if(L&&L.trophy){gr.sprite.draw({x:X-q,y:Q-q,z:a+.3,w:q,h:q,frame:gr.TROPHY,color:_r[L.trophy]})
X-=1.1*q}var ee=xe(L&&L.boost_count||0)
if(ee){var te
var re
if("thumb"===s){te=$-q
re=J
$-=1.1*q}else{te=X-q
re=Q-q
X-=1.1*q}yr.sprite.draw({x:te,y:re,z:a+.32,w:q,h:q,frame:yr.BOOST0+ee})}var ae=showBuildIcon(L,S,w)
if(ae){var ie
var oe
switch(ae){case La:oe=ga
case Aa:ie=gr.ICON_AREABUILD
break
case Oa:oe=ga
case wa:ie=gr.ICON_BUILD
break
default:Se(false)}gr.sprite.draw({x:X-q,y:Q-q,z:a+.3,w:q,h:q,frame:ie,color:oe})
X-=1.1*q}if("EXTRA_SLOT"===S){var ne=""+C
var se=B
var le=ra.getStringWidth(mr,B,ne)-se
var _e=t+i/2
var ce=Q+4-se/2
ra.drawSizedAligned(mr,_e+le,ce,a+.3,B,Ae.VCENTER|Ae.HRIGHT,0,0,ne)
gr.sprite.draw({x:_e+le,y:ce-.5*se,z:a+1,w:se,h:se,frame:gr.ORBS})}}}linkUIDrawTextureFadeAndSheen(N,A,t,r,a,i,o)
var ue=5
var de=1
if(o<100)ue*=de=.5
Le.drawBox({x:t-ue,y:r-ue,w:i+2*ue,h:o+2*ue,z:a+.5},Le.sprites.rect,de,h)
if(!e.disabled){Le.drawBox({x:t-ue+2,y:r-ue+2,w:i+2*ue,h:o+2*ue,z:a-20},Le.sprites.rect_shadow,1,ma)
if(c){profilerStopStart("link")
if(we({key:A.key,x:e.x,y:e.y,w:e.w,h:e.h,internal:true,url:Oe(c)})){x.ret=true
Rr()}}}e.long_press=x.long_press
profilerStop()
profilerStop("waygateLinkUI")
return x.ret}function drawHLine(e,t,r){Le.drawLine(e-.5*r,t+=4,e+.5*r,t,Z.UI,1,1,sr)
return t+4}var ba={}
var Na={}
var Ca=false
var xa
var Ma=[gr.WAYGATE,ft.LBL_WG_CONFIGURATION]
var Da=[gr.HOME,ft.LBL_SETTLEMENT_MNG,ft.WGUI_SETTLEMENT_MNG_SUBTITLE]
var Pa=[gr.ENERGY_WELL,ft.LBL_ENERGY_WELL,ft.$(ft.WGUI_ENERGY_WELL_SUBTITLE,Tr)]
var Ba=[gr.ENERGY_WELL,ft.LBL_ENERGY_WELL_STATUS,ft.$(ft.WGUI_ENERGY_WELL_REMOTE_SUBTITLE,Tr)]
var ka=[gr.LOCK,ft.LBL_AREA_ACCESS_CONTROL,null]
function waygateEditTitle(){var e=Ot()
if(!e||!e.isWaygate())return null
var t=waygateGetMetadataFromProp(e)
if(null==t?void 0:t.is_settlement)if(e.waygateEditAllowed())return ft.LBL_WG_AND_SETTLEMENT_MNG
else return ft.LBL_SETTLEMENT_MNG
else return ft.LBL_WG_CONFIGURATION}var Ua
function waygateEditShowTitle(e,t,r,a){var i=ut()-t
var o=t
var n=o+i/2
var s=e[1]
if(e===Da){var l
if(null!=a&&a.wgid){var _
l=null==(_=qr(a.wgid))?void 0:_.name}if(l)s=ft.$(ft.LBL_NAMED_SETTLEMENT,l)}Ua=s
if(!p.split_waygate){aa.drawSizedAligned(fr,o,r,Z.UI,u,Ae.HCENTERFIT,i,0,s)
r+=u}var c=e[2]
if(c){ra.drawSizedAligned(Er,o,r,Z.UI,f,Ae.HCENTERFIT,i,0,c)
r+=f}if(!p.split_waygate||c)r=drawHLine(n,r,d)
return r}function containsInterWorldTarget(e,t){if(e.length>1&&!t)return false
for(var r=0;r<e.length;++r){var a=e[r]
if(!a.type&&a.wid&&a.wid!==Mr())return true}return false}var Ga={otherworld:ft.DLG_WAYGATE_TARGET_WORLD_MSG,otheruser:ft.DLG_WAYGATE_TARGET_USER_MSG,otherphoto:ft.DLG_WAYGATE_TARGET_PHOTO_MSG,otherblueprint:ft.DLG_WAYGATE_TARGET_BLUEPRINT_MSG}
var Fa=1.5*Ht
var Wa=1.5*Ht+Wt
function waygateEditRun(e,H,z,V){var Y=Z.UI
var t=ut()-e
var r=e
var j=r+t/2
var a=Boolean(V)
var i=V&&V.is_settlement
var o=Boolean(V&&"default"===V.wgid)
var n=wr()
var s=Xr()
var l=Xr()&&!Kr()
var _=n||s||a
if(_){aa.drawSizedAligned(fr,r,H,Z.UI,R,Ae.HCENTERFIT,t,0,Xr()&&(!o&&!a||i)?ft.LBL_ENTRYWAY_SETTLEMENT:ft.LBL_ENTRYWAY)
H+=R+8}if(!a){Se(z)
if(n){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_ENTRYWAY_REQUIREMENT)
H+=Le.font_height+4
if(Le.buttonText({x:j-Ht-4,y:H,z:Y,w:Ht,h:Wt,text:ft.addEllipsis(ft.BTN_ASSIGN_WGID)}))waygateAssignIDPrompt()
if(Le.buttonText({x:j+4,y:H,z:Y,w:Ht,h:Wt,text:ft.addEllipsis(ft.BTN_SET_DEFAULT_WG),disabled:Xr()&&Kt("default")&&"default"!==Ar()}))waygateAssignID("default")
H+=Wt+8}if(s){var c=1.5*Ht
var u=je(z.getLocalPos())
var d=Boolean(qt())
if(!u){d=d&&je(z.getLocalPos(),""+se+Ar())
ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,d?ft.WGUI_SETTLEMENT_OVERLAP:ft.WGUI_SETTLEMENT_OVERLAP_NO_MOVE)
H+=Le.font_height+8}if(Le.buttonText({x:j-c-4,y:H,z:Y,w:c,h:Wt,text:ft.addEllipsis(ft.BTN_ESTABLISH_SETTLEMENT),disabled:!u}))waygateEstablishSettlement()
if(Le.buttonText({x:j+4,y:H,z:Y,w:c,h:Wt,text:ft.addEllipsis(ft.BTN_MOVE_SETTLEMENT),disabled:!d}))waygateMoveSettlement()
H+=Wt+8}}else{var f=V.wgid,v=V.wg
if(n&&!o&&!i){if(l&&!o){ra.drawSizedAligned(dr,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,Vr()?ft.WGUI_ENTRYWAY_LIMITED_LF:ft.WGUI_ENTRYWAY_LIMITED_UNL)
H+=Le.font_height+8}ra.drawSizedAligned(ur,j-8,H,Z.UI,Le.font_height,Ae.HRIGHT|Ae.VCENTER,0,Wt,ft.separateColon(ft.LBL_WAYGATE_ID,f))
if(Le.buttonText({x:j,y:H,z:Y,w:Ht,h:Wt,text:ft.addEllipsis(ft.BTN_REMOVE_WGID)}))Le.modalDialog({title:ft.DLG_REMOVE_WGID_TITLE,text:ft.DLG_REMOVE_WGID_MSG,buttons:{Yes:function Yes(){if(!xr())return void showError(ft.DLG_ERROR_REMOVING_WGID_TITLE,ft.ERR_WORLD_DISCONNECTED)
vt.chat_ui.cmdParse("waygate_remove "+f,showError.bind(null,ft.DLG_ERROR_REMOVING_WGID_TITLE))},No:null}})
H+=Wt+8}if(i){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_WG_IS_SETTLEMENT)
H+=Le.font_height+8
if(!o){if(Le.buttonText({x:j-Ht/2,y:H,z:Y,w:Ht,h:Wt,text:ft.addEllipsis(ft.BTN_DESTROY_SETTLEMENT)}))Le.modalDialog({title:ft.DLG_DESTROY_SETTLEMENT_TITLE,text:ft.DLG_DESTROY_SETTLEMENT_MSG_WARNING+"\n\n"+ft.DLG_DESTROY_SETTLEMENT_MSG_CONFIRM,buttons:{Yes:function Yes(){if(!xr())return void showError(ft.DLG_ERROR_DESTROYING_SETTLEMENT_TITLE,ft.ERR_WORLD_DISCONNECTED)
vt.chat_ui.cmdParse("waygate_remove "+f,showError.bind(null,ft.DLG_ERROR_DESTROYING_SETTLEMENT_TITLE))},No:null}})
H+=Wt+8}}ra.drawSizedAligned(ur,j-8,H,Z.UI,Le.font_height,Ae.HRIGHT|Ae.VCENTER,0,Wt,ft.addColon(ft.LBL_NAME))
ra.drawSizedAligned(ur,j,H,Z.UI,Le.font_height,Ae.HCENTERFIT|Ae.VCENTER,Ht-Wt-8,Wt,v.name)
if(Le.buttonImage({x:j+Ht-Wt,y:H,z:Y,img:gr.sprite,frame:gr.EDIT,w:Wt,h:Wt}))Le.modalTextEntry({edit_text:v.name,title:ft.DLG_WG_NAME_TITLE,text:ft.DLG_WG_NAME_MSG,max_len:ne,max_visual_size:oe,buttons:{OK:function OK(e){waygateRename(f,e.trim()||String(ft.WGUI_NEW_WAYGATE))},Cancel:null}})
H+=Wt+8
var h=(Ht-4)/2
ra.drawSizedAligned(ur,j-8,H,Z.UI,Le.font_height,Ae.HRIGHT|Ae.VCENTER,0,Wt,ft.addColon(ft.LBL_LISTED))
var p=v.flags&le
var m=wr()
if(Le.buttonText({x:j,y:H,z:Y,w:Ht-h-4,h:Wt,text:p?ft.BTN_YES.upper():ft.BTN_NO.upper(),tooltip:ft.WGUI_LISTED_WG_LINKED,disabled:p&&o||!m}))Br("waygate_mod",{wgid:f,key:"listed",value:!p},showError.bind(null,ft.DLG_ERROR_EDITING_WG_TITLE))
if(rr())if(Le.buttonText({x:j+Ht-h,y:H,z:Y,w:h,h:Wt,text:ft.BTN_GET_LINK,disabled:!p})){var E=Mr()
tr(E,f)}if(ar())if(Le.buttonText({x:j+Ht+h+8-h,y:H,z:Y,w:h,h:Wt,text:ft.BTN_SHARE,disabled:!p}))er(Mr(),f)
if(p&&M.get("wg")!==f){M.set("wg",f)
Pr(f)}else if(!p&&M.get("wg")===f)M.set("wg","")
H+=Wt+8
var g=2*Wt
ra.drawSizedAligned(ur,j-8,H,Z.UI,Le.font_height,Ae.HRIGHT|Ae.VCENTER,0,g,ft.addColon(ft.LBL_SCREENSHOT))
var T=pt()
var y=tt()||Ca||T
var S={x:j,y:H,z:Z.UI,h:g,target:{wid:Mr(),wgid:f},disabled:true,ctx:"waygate_edit",no_overlay:true}
waygateLinkUI(S)
var I=S.w
var A=j+I+8
var w=Ht-(I+8)
if(Le.buttonText({x:A,y:H+(g-Wt)/2,z:Y,w:w,h:Wt,text:T?ft.BTN_NOT_AVAILABLE:y?ft.BTN_PROCESSING:ft.addEllipsis(v.imgid?ft.BTN_CHANGE:ft.BTN_SET),tooltip:T?ft.TLTP_VOXEL_PACK_APPLIED:void 0,disabled_focusable:true,disabled:y,in_event_cb:N.pointerLockEnter})){var L=Mr()
Pt({waygate_mode:true,waygate_title:o?jr().name:void 0},function(e,t){if(kt(e,L,t)){var r=C().pak("waygate_set_images")
r.writeAnsiString(L)
r.writeInt(t.full.id)
r.writeInt(t.preview.id)
r.writeInt(t.thumb.id)
r.send(function(e,t){if(e||!xr()){Bt()
Dt(ft.DLG_ERROR_IMAGE_UPLOAD_TITLE,e||ft.ERR_WORLD_DISCONNECTED)}else Br("waygate_mod",{wgid:f,key:"imgid",value:t},function(e){Bt()
if(e)Dt(ft.DLG_ERROR_SETTING_WG_IMG_TITLE,e)
else Vt(ft.STATUSMSG_WG_IMG_SAVED)})})}})}H+=g+8
if(o||i){H+=8
if(i){ra.drawSizedAligned(cr,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_WG_ADVENTURE_HINT_1)
H+=Le.font_height+8
ra.drawSizedAligned(cr,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_WG_ADVENTURE_HINT_2)
H+=Le.font_height+8}else{ra.drawSizedAligned(cr,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_UNLIMITED_HINT_1)
H+=Le.font_height+8
ra.drawSizedAligned(cr,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_UNLIMITED_HINT_2)
H+=Le.font_height+8}if(o){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_THIS_IS_DEFAULT_WG)
H+=Le.font_height+8}}}if(_)H=drawHLine(j,H,b)
aa.drawSizedAligned(fr,r,H,Z.UI,R,Ae.HCENTERFIT,t,0,ft.LBL_EXITWAY_TARGETS)
H+=R+8
if(i){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_SETTLE_CANNOT_EXITWAY)
H+=Le.font_height+8
return}if(o){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_DEFAULT_WG_CANNOT_EXITWAY)
H+=Le.font_height+8
return}if(!wr()){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_NO_EDIT_ACCESS)
H+=Le.font_height+8
return}if(!z){ra.drawSizedAligned(ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,ft.WGUI_MUST_VISIT_EDIT_EXITWAY)
H+=Le.font_height+8
return}var K=z.trans_busy||ot(z)
var q=z.waygate_targets
if(!Array.isArray(q))q=[]
if(l){ra.drawSizedAligned(q.length?dr:ur,r,H,Z.UI,Le.font_height,Ae.HCENTERFIT,t,0,Vr()?ft.WGUI_EXITWAY_LIMITED_LF:ft.WGUI_EXITWAY_LIMITED_UNL)
H+=Le.font_height+8}if(q.length>0){Ge(z,"exitway_access",{x:j-1.5*Ht-O,y:H,z:Y,width:Ht,entry_height:Wt,disabled:K})
Fe(z,{x:j-.5*Ht,y:H,z:Y,width:Ht,entry_height:Wt,disabled:K||containsInterWorldTarget(q,z.exitway_random)})
if(Le.buttonText({x:j+.5*Ht+O,y:H,z:Y,w:Ht,h:Wt,text:q.length<2?ft.LBL_EXITWAY_AUTOMATIC:1===z.exitway_random?ft.LBL_EXITWAY_RANDOM:ft.LBL_EXITWAY_USER,disabled:K||q.length<2})){if(1===z.exitway_random)z.exitway_random=0
else{z.exitway_random=1
if(containsInterWorldTarget(q,z.exitway_random)&&z.gate_time!==ke.DEFAULT)z.gate_time=ke.DEFAULT}zt(z)}H+=Wt+8}if(!xa)xa=x({z:Z.UI,background_color:null,auto_hide:true})
xa.keyboardScroll()
xa.begin({x:r,y:H,w:t,h:bt()-H})
r=H=0
j=t/2
function updateTargets(){if(containsInterWorldTarget(z.waygate_targets=q,z.exitway_random)&&z.gate_time!==ke.DEFAULT)z.gate_time=ke.DEFAULT
zt(z)}var X=null
q.forEach(function(e,t){var r=e.wid?Ur(e.wid,true):jr()
if(r&&!r.err){if(ba[t])X=t
if(Na[t])X=t}})
ba={}
Na={}
q.forEach(function(i,e){var t=i.type||"w"
var r=i.wid
var a
if("w"===t&&r===Q)a=Q
else if("w"===t&&!r)a=void 0
else a=t+"/"+r
var o=K||null!==X&&X!==e
if(Le.buttonText({x:j-Fa-4-Wt-4,y:H,z:Y,w:Wt,h:Wt,text:"X",tooltip:ft.WGUI_REMOVE_WG_TARGET,disabled:o})){q.splice(e,1)
updateTargets()
H+=Wt+8
return}var n=[{name:ft.addParenthesesAfter(ft.LBL_THIS_WORLD,Mr()),tag:void 0},{name:ft.addEllipsis(ft.LBL_OTHER_WORLD_LINK),tag:"otherworld"},{name:ft.addEllipsis(ft.LBL_TARGET_USER),tag:"otheruser"},{name:ft.addEllipsis(ft.LBL_TARGET_PHOTO),tag:"otherphoto"},{name:ft.addEllipsis(ft.LBL_TARGET_BLUEPRINT),tag:"otherblueprint"},{name:ft.BTN_EXIT_TO_MAIN_MENU,tag:Q}]
var s={}
s[Mr()]=true
var l=$().getMyUserChannel()
var _=l&&l.data&&l.data.public||{}
var c=_.worlds||{}
var u=Object.keys(c)
u.sort(function(e,t){var r=Ur(e,false)
var a=Ur(t,false)
if(r){if(a){var i=(r.frozen?1:0)-(a.frozen?1:0)
if(i)return i
return c[t].created-c[e].created}return-1}else return 1})
for(var d=0;d<u.length;++d){var f=u[d]
if(!s[f]){s[f]=true
var v=Ur(f,false)
n.push({name:ft.separateColon(ft.LBL_MINE,v&&!v.err&&v.name?ft.addParenthesesAfter(v.name,f):"#"+f),tag:"w/"+f})}}var h=_.recent||{};(u=Object.keys(h).filter(function(e){return!s[e]})).sort(function(e,t){return h[t].when-h[e].when})
u=u.slice(0,2)
for(var p=0;p<u.length;++p){var m=u[p]
if(!s[m]){s[m]=true
var E=Ur(m,false)
n.push({name:ft.separateColon(ft.LBL_RECENT,E&&!E.err&&E.name?ft.addParenthesesAfter(E.name,m):"#"+m),tag:"w/"+m})}}var g
if(!i.wid||i.wid===Mr())g=0
else{for(var T=0;T<n.length;++T)if(n[T].tag===a)g=T
if(void 0===g)if("w"===t){var y=Ur(i.wid,false)
if(y&&!y.err&&y.name)n.push({name:ft.addParenthesesAfter(y.name,i.wid),tag:a})
else n.push({name:ft.$(ft.LBL_NUMBERED_WORLD,i.wid),tag:a})
g=n.length-1}else if("u"===t){var S=Or(r)
n.push({name:ft.separateColon(ft.LBL_TARGET_USER,De(r,null==S?void 0:S.display_name)),tag:a})
g=n.length-1}else if("photo"===t){var I=Ut(r)
n.push({name:ft.separateColon(ft.LBL_TARGET_PHOTO,(null==I?void 0:I.title)||r),tag:a})
g=n.length-1}else if("blueprint"===t){var A=We(r,false)
n.push({name:ft.separateColon(ft.LBL_TARGET_BLUEPRINT,(null==A?void 0:A.name)||r),tag:a})
g=n.length-1}}var w={suppress_return_during_dropdown:true}
var L=ee({x:j-Fa-4,y:H,disabled:o,items:n,z:Z.UI,width:Fa,entry_height:Wt},g,w)
if(w.dropdown_visible)Na[e]=true
var O=null==L?void 0:L.tag
if(!K&&O&&O!==a)if(O.startsWith("other")){var R={}
if("otherworld"===O)R.current={label:ft.BTN_CURRENT,cb:function cb(){if(stillHere()===z){i.type=void 0
i.wid=void 0
i.wgid=void 0
updateTargets()}}}
if("otheruser"===O)R.self={label:ft.BTN_SELF,cb:function cb(){if(stillHere()===z){i.type="u"
i.wid=J()
i.wgid=void 0
updateTargets()}}}
R.ok={cb:function cb(e){var t=null
if("otherworld"===O)t="w"
else if("otheruser"===O)t="u"
else if("otherphoto"===O)t="photo"
else if("otherblueprint"===O)t="blueprint"
dt(e,t,function(e){if(!e)return void showError(ft.DLG_ERROR_TITLE,ft.DLG_INVALID_LINK_ID_MSG)
var t
var r
var a
if(ie(e)){t=void 0
r=e.w
a=e.wg}else if(te(e)){t="blueprint"
r=e.blueprint}else if(re(e)){t="photo"
r=e.photo}else if(ae(e)){t="u"
r=e.u}if(stillHere()===z){i.type=t
i.wid=r
i.wgid=a
updateTargets()}})}}
R.cancel=null
Le.modalTextEntry({edit_text:i.wid||"",title:ft.DLG_WAYGATE_TARGET_TITLE,text:Ga[O],max_len:120,buttons:R})}else{var b=(O||"").split("/")
Se(b.length<=2)
if(1===b.length){Se(O===Q||!O,O)
i.type=void 0
i.wid=b[0]||void 0
i.wgid=void 0}else if("w"===b[0]){i.type=void 0
i.wid=b[1]||void 0
i.wgid=void 0}else if(2===b.length){i.type=b[0]
i.wid=b[1]
i.wgid=void 0}else Se(false,O)
updateTargets()}var N
if("w"===t&&r!==Q)N=i.wid?Ur(i.wid,true):jr()
if(a===Q||"w"!==t);else if(!N||N.err)ra.drawSizedAligned(ur,j,H,Y,Le.font_height,Ae.VCENTER,0,Wt,N&&N.err?ft.$(ft.WGTARGET_INVALID_WORLD_ID,N.err):ft.WGTARGET_EXITWAY_LOADING)
else{var C=[{name:ft.LBL_DEFAULT_WAYGATE,tag:void 0},{name:ft.LBL_SHOW_WORLD_INFO,tag:"info"}]
var x=N.waygates||{}
var M=Object.keys(x)
Wr(x,null)
M.sort(Fr)
for(var D=0;D<M.length;++D){var P=M[D]
if("default"===P||!i.wid&&V&&V.wgid&&V.wgid===P)continue
var B=x[P]
if(B.flags&le||!i.wid)C.push({name:B.name+" ("+P+(B.flags&le?"":"*")+")",tag:P})}var k
if(!i.wgid)k=0
else for(var U=0;U<C.length;++U)if(C[U].tag===i.wgid)k=U
var G={suppress_return_during_dropdown:true}
var F=ee({x:j+4,y:H,z:Z.UI,disabled:o,width:Wa,entry_height:Wt,items:C},k,G)
if(G.dropdown_visible)ba[e]=true
if(F){var W=F.tag||void 0
if(!K&&W!==i.wgid){i.wgid=W
updateTargets()}}}H+=Wt+8})
if(Object.keys(q).length<W){if(Le.buttonText({x:j-Ht/2,y:H,z:Y,w:Ht,h:Wt,text:ft.BTN_ADD_NEW_TARGET,disabled:K})){q.push(l?{wid:Q}:{})
updateTargets()}H+=Wt+8}xa.end(H)}function doEnergyWell(e){var t=E()
var r=Ot()
if(!r||!r.isEnergyWell()){Et()
return Pa[1]}var a=waygateGetMetadataFromProp(r)
t=waygateEditShowTitle(Pa,e,t,a)
$e(e,t,r,a,false)
return Ua}function waygateEditRemote(e){sa=e
yt.init(At,null)}function doWaygateEdit(e,t){var r=E()
var a=Z.UI
var i=r
var o=e-E()
var n
var s
var l=false
if(t){if(!(n=waygateGetMetadataRemote())){if(mt(At))Et()
return null}}else{n=(s=Ot())&&waygateGetMetadataFromProp(s)
if(!s||!s.isWaygate()){if(mt(It))Et()
return null}l=Ye(Lt())}var _=t&&wr()||!t&&s.waygateEditAllowed()
var c=null==n?void 0:n.is_settlement
var u="default"===(null==n?void 0:n.wgid)
var d=Yr()&&((c||u)&&!(null!=n&&n.is_unbound)||!Xr())
if(!c&&!_&&!d){Et()
return null}if(null!=n&&n.is_unbound)if(da===ca)da=_a
if(da===ca&&!d)da=_a
if(da===_a&&!c)da=la
if(da===la&&!_)if(d)da=ca
else da=_a
var f
function tabButton(e,t){var r=da===e
if(Xr()||Yr()){if(Le.buttonImage({x:o-4,y:i,z:r?a:a-20,z_bias:r?null:{down:20},shrink:.7,img:gr.sprite,frame:t[0],colors:Rt(r),disabled:false,base_name:r?"tab_horiz":"tab_inactive",tooltip:t[1],drag_over:true})){r=true
da=e}i+=E()}if(r)f=t}if(_)tabButton(la,Ma)
if(c)tabButton(_a,Da)
if(d)tabButton(ca,t?Ba:Pa)
if(l)tabButton(ua,ka)
o=e
i=r
if(!f)return ft.LBL_UNKNOWN_MENU
i=waygateEditShowTitle(f,o,i,n)
if(da===_a)Qt(o,i,n,t)
else if(da===ca)$e(o,i,s,n,t)
else if(da===ua)de(o,i,l)
else waygateEditRun(o,i,s,n)
return Ua}function waygateLabel(e,t){var r=e.type||"w"
var a=e.wid
if("w"===r){if(a===Q)return ft.BTN_EXIT_TO_MAIN_MENU
var i=e.wgid||"default"
var o=(a?Ur(a,!("info"===i||"default"===i)):jr())||{}
var n=o.name||ft.$(ft.LBL_NUMBERED_WORLD,a)
var s=o.waygates||{}
if("info"===i||"default"===i&&a&&a!==Mr())return n
else{var l=s[i]
var _=l&&l.name||ft.$(ft.WGUI_UNKNOWN_WAYGATE,i)
return a?ft.$(ft.WGUI_WG_IN_WORLD,_,n):_}}else if("u"===r){var c=a
var u=Or(c)
return ft.separateColon(ft.LBL_TARGET_USER,t?(null==u?void 0:u.display_name)||c:De(c,null==u?void 0:u.display_name))}else if("photo"===r){var d=a
var f=Ut(d)
return ft.separateColon(ft.LBL_TARGET_PHOTO,f.title||d)}else if("blueprint"===r){var v=a
var h=We(v,false)
return ft.separateColon(ft.LBL_TARGET_BLUEPRINT,h.name||v)}Ne(false)
return"Unknown"}var Ha=106
function doWaygateTargets(){var e=E()
var d=Z.UI
var t=0
var r=ut()-t
var f=e
var a=t
var v=a+r/2
var i=ft.LBL_WAYGATE_TARGETS
var h=Ot()
var o=h&&h.waygate_targets
if(!h||!h.isWaygate()||!o||!o.length){if(mt(It))Et()
return i}if(!xa)xa=x({z:Z.UI,background_color:null,auto_hide:true})
xa.keyboardScroll()
xa.begin({x:a,y:f,w:r,h:bt()-f})
a=f=0
f+=12
o.forEach(function(e,t){var r=e.type||"w"
var a=e.wid
function rowLabel(e){ra.drawSizedAligned(ur,v-8,f,Z.UI,Le.font_height,Ae.VCENTER|Ae.HRIGHT,0,Ha,e)}if("w"===r)if(a===Q){if(Le.buttonText({x:v-T()/2,y:f,h:Ha,font_height:36,text:ft.BTN_EXIT_TO_MAIN_MENU}))vt.returnToMainMenu()}else{var i=e.wgid
if(!i)i="default"
var o="info"===i||"default"===i
var n=e.wid===Q?null:e.wid?Ur(e.wid,!o):jr()
if(!n)ra.drawSized(ur,v,f,d,Le.font_height,ft.WGTARGET_EXITWAY_LOADING)
else if(n.err)ra.drawSized(ur,v,f,d,Le.font_height,ft.$(ft.WGTARGET_INVALID_WORLD_ID,n.err))
else{rowLabel(waygateLabel(e,false))
if(waygateLinkUI({x:v,y:f,h:Ha,in_event_cb:N.pointerLockEnter,target:e,img_style:"preview",no_overlay:!e.wid,overlay_mode:e.wid?true:void 0,ctx:"waygate_target_"+t,url:a?Hr(a,i):void 0})){vt.menuExit()
kr(e)}}}else if("u"===r){var s=a
rowLabel(waygateLabel(e,false))
if(br({user_id:s,show_online_status:true,x:v,y:f,z:d,w:Ha,h:Ha,url:Oe("u/"+s)})){wt()
Nr(s)}}else if("photo"===r){var l=a
rowLabel(waygateLabel(e,false))
Ct({ctx:"wgt"+t,photo_id:l,x:v,y:f,z:d,h:Ha,border_scale:.2})}else if("blueprint"===r){var _=a
rowLabel(waygateLabel(e,false))
h.item_icon_cache=h.item_icon_cache||[]
var c=h.item_icon_cache[t]
var u={type:U,id:B,attr1:_}
if(!c||!ct(c,u))c=h.item_icon_cache[t]=_t(u)
if(nt({x:v,y:f,z:d,w:Ha,h:Ha,img:gr.sprite,frame:gr.EMPTY_BLUEPRINT,dynamic_snapshot_on_mouseover:true,hide_count:true,url:Oe("blueprint/"+_),item_context:lt},c))M.goRoute("blueprint/"+_)}f+=Ha+8})
xa.end(f)
return i}var za=30
var Va=Yt.createFast()
var Ya=D(.53,.3,.8,1)
var ja=D(1,1,1,1)
function drawWaygateFX(e){v.push()
v.setNormalized()
Ya[3]=e
var t=.75*Jr(0,1.5*e-.5)
ja[3]=t
m(it(),.5,0,Z.WAYGATE_FX+1,.5,1,0,0,1,1,Ya)
m(it(),0,0,Z.WAYGATE_FX+1,.5,1,1,0,0,1,Ya)
var r=Va
r.reseed(1234)
var a=Ie.frame_timestamp
for(var i=0;i<za;++i){var o=r.random()
var n=a*(.001+.001*r.random())+o
var s=$r(n)
n=1-(n-s)
var l=A(r.random()+.31*s)
var _=r.floatBetween(.02,.03)
var c=r.floatBetween(.25,.5)
m(at(),l,3*n-1,Z.WAYGATE_FX,_,c,0,0,1,1,ja)}v.pop()}function waygateSelectAutoActivate(e,t,r,a){var i=e&&e.waygate_targets
var o=e&&waygateGetMetadataFromProp(e)
var n=o&&o.is_settlement
if(i){if(o&&("default"===o.wgid||n))i=null
if(i){var s=Ue(e,"exitway_access")
if(s===Be.BUILDERS){ir(r).setMessage(ft.STATUSMSG_EXITWAY_INACCESSIBLE).fade()
i=null}else if(s===Be.BOOSTERS){ze("access_waygate")
ir(r).setMessage(ft.STATUSMSG_EXITWAY_INACCESSIBLE_BOOST).fade()
i=null}}}var l=He()&&(n&&o.wgid===Ar()||!Xr())
var _=i&&i.length
var c=true
if(l)if(!Je(e))l=false
else if(!qe(e)){ir(r).setMessage(ft.$(ft.STATUSMSG_WELL_RECHARGING,Ze(e))).fade()
l=false}if(a.do_energy_well=l)a.no_particles=true
if(!_&&!l)c=false
if(c){var u
var d=Qr(t/1e3)
if(l)u=ft.$(ft.STATUSMSG_DRINKING_WELL,d)
else if(1===i.length||e.exitway_random){var f=0
var v=i.length>1&&e.exitway_random
if(v)f=$r(ta()*i.length)
var h=a.single_target=i[f]
var p=h.type||"w"
var m=h.wid
var E={label:waygateLabel(h,true),seconds:d}
if(v){E.label=ft.LBL_UNKNOWN_SYMBOLS
u=ft.STATUSMSG_WAYGATING_RANDOMLY.$(E)}else if("w"===p)if(m===Q)u=ft.STATUSMSG_EXITING.$(E)
else u=ft.STATUSMSG_WAYGATING_TO.$(E)
else u=ft.STATUSMSG_OPENING.$(E)}else u=ft.STATUSMSG_WAYGATING_CHOICES.$({seconds:d})
ir(r).setMessage(g(String(u)))}return c}function waygateExecuteAutoActivate(e,t){if(t.do_energy_well)Xe()
else if(t.single_target){var r=t.single_target
var a=r.type||"w"
var i=r.wid
if("w"===a)if(i===Q){_.queue(Z.TRANSITION_FINAL,_.fade(350))
Tt()}else{_.queue(Z.TRANSITION_FINAL,_.fade(350))
gt(function(){kr(r)})}else{wt()
M.goRoute(a+"/"+i)}}else vt.toggleMenuPage(yt.WAYGATE_TARGETS,e.interactDetails())}},{"../common/ids":249,"../common/types":263,"../common/waygate_common":265,"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/link":328,"../glov/client/markdown_parse":333,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/selection_box":350,"../glov/client/settings":351,"../glov/client/sprites":363,"../glov/client/textures":365,"../glov/client/transition":366,"../glov/client/ui":367,"../glov/client/urlhash":369,"../glov/common/util":400,"../glov/common/verify":401,"../glov/common/vmath":402,"./access_control":2,"./account_ui":4,"./auto_activate_ui":15,"./blueprint":28,"./build_mode":33,"./build_queue_ui":34,"./editvolume_client":84,"./energy_well":85,"./file_management":98,"./fx_util":103,"./inventory":114,"./inventory_ui":115,"./items":119,"./layout":120,"./link_parse":125,"./localization/localization":131,"./main":135,"./menu":140,"./photo_link_ui":156,"./photo_mode":158,"./photo_ui":159,"./platform_worlds_client":160,"./prop_edit":170,"./rand_seed":175,"./settlement":181,"./settlement_edit":182,"./sharing/platform_share_handlers":185,"./status":193,"./store":195,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_data":208,"./user_info_view":210,"./user_profile_view":212,"./world_comm":226,"./world_info":229,"./world_info_view":231,"./world_metadata":235,assert:void 0}],223:[function(e,t,r){"use strict"
r.waygateUpgradeStartup=waygateUpgradeStartup
r.WAYGATE_SICKNESS_DURATION=r.WAYGATE_SAFE_TIME=void 0
var a=3600
var i=r.WAYGATE_SAFE_TIME=a
r.WAYGATE_SICKNESS_DURATION=i
var d=e("assert")
var f=e("../common/ids").TYPE_ITEM
var o=e("../common/waygate_upgrade_common")
var n=o.WAYGATE_TIERS
var v=o.WAYGATE_UPGRADES
var h=o.waygateUpgradeCommonStartup
var s=e("./crafting_recipes")
var p=s.craftingRecipes
var m=s.craftingRecipesStartup
var l=e("./items")
var E=l.createItem
var g=l.itemPrototypePoke
var T=e("./tiles")
r.WAYGATE_TIERS=n
r.WAYGATE_UPGRADES=v
function waygateUpgradeStartup(){m()
h(E,T)
var e=p()
for(var t in v){var r=v[t]
var a=r.unlocks,i=r.unlocks_recipes
if(a||i){var o=[]
if(a)for(var n=0;n<a.length;++n){var s=a[n]
var l=E({type:f,id:s})
if(l.unlock_display_item)l=E(l.unlock_display_item)
o.push(l)
g(s,"is_settlement_locked",true)}if(i)for(var _=0;_<i.length;++_){var c=e[i[_]]
d(c&&c.icon)
c.is_settlement_locked=true
var u=c.icon
o.push(u)}r.unlock_items=o}}}},{"../common/ids":249,"../common/waygate_upgrade_common":266,"./crafting_recipes":68,"./items":119,"./tiles":199,assert:void 0}],224:[function(e,t,r){"use strict"
r.getAccount=getAccount
r.accountUILogout=accountUILogout
r.welcomeScreenStartup=welcomeScreenStartup
r.needWelcomeScreen=needWelcomeScreen
r.welcomeScreen=welcomeScreen
r.welcomeScreenInitSetState=welcomeScreenInitSetState
r.welcomeScreenGetInitialState=welcomeScreenGetInitialState
r.welcomeScreenSetState=welcomeScreenSetState
r.welcomeScreenIsActive=welcomeScreenIsActive
var X=e("assert")
var Q=e("../glov/client/camera2d")
var a=e("../glov/client/engine")
var $=e("../glov/client/font").ALIGN
var i=e("../glov/client/fscreen").fscreenAvailable
var o=e("../glov/client/link").link
var n=e("../glov/client/net")
var J=n.netBuildString
var s=n.netClient
var ee=n.netSubs
var te=e("../glov/client/settings")
var l=e("../glov/client/shaders").shadersRequirePrelink
var _=e("../glov/client/spot").spotAsyncActivateButton
var c=e("../glov/client/sprites").spriteCreate
var u=e("../glov/client/ui")
var d=u.button
var f=u.buttonText
var re=u.uiGetFont
var ae=u.uiTextHeight
var ie=e("../glov/client/urlhash")
var v=e("../glov/client/urlhash").urlhashFireInitialChanges
var h=e("./account").AccountState
var p=e("./account_ui").createAccountUI
var m=e("./analytics")
var E=m.logEvent
var oe=m.logEventOnce
var g=e("./analytics_ftue")
var T=g.FTUE
var y=g.logEventFTUE
var S=e("./app_access")
var ne=S.accessAllowFeedback
var I=S.accessFRVRAuth
var A=S.accessFRVRAuthUserPassMigration
var se=S.accessHasAccess
var le=S.accessSubtitle
var w=e("./create_first_world").createFirstWorldPrompt
var L=e("./currency_shop").openCurrencyShop
var O=e("./fbinstant_worlds")
var _e=O.canFollowOfficialPage
var ce=O.canJoinOfficialGroup
var R=O.fbFollowOfficialPage
var b=O.fbJoinOfficialGroup
var N=e("./feedback").feedbackShow
var C=e("./iframe_content_handlers")
var x=e("./layout")
var ue=x.WIDE
var de=x.layoutCameraTallWideRaw
var fe=e("./localization/localization").L
var ve=e("./login_rewards").checkLoginRewardsToClaim
var M=e("./main")
var he=M.chatUI
var D=M.toggleMenuPage
var P=e("./main_menu")
var pe=P.MAIN_MENU_WELCOME
var B=P.MAIN_MENU_WORLDLIST
var me=P.URL_PRIVACY
var Ee=P.URL_TOS
var ge=P.checkConnection
var k=P.enterAccessTokenInit
var Te=P.joinWorldForUser
var U=P.mainMenuGetPage
var G=P.mainMenuInit
var ye=P.mainMenuMenuOverlay
var Se=P.mainMenuSetPage
var F=P.mainMenuSetState
var Ie=P.mainMenuSubLinks
var Ae=P.mainMenuTop
var we=P.partyDrawInfoMessage
var Le=P.partyLastInfoMessage
var W=e("./menu")
var H=W.BOOST_VIEW
var z=W.CHARACTER_CUSTOMIZATION
var V=W.fscreenEnterAndOrient
var Oe=W.menuActive
var Y=W.menuDoTransition
var Re=e("./motd").motdRun
var j=e("./paperdoll")
var be=j.doPaperDoll
var K=j.resetRotation
var Ne=e("./photo_mode").copyToClipboardCheck
var q=e("./platform_worlds_client").PLATFORM_IOS
var Ce=e("./red_dot").setLatestNewsTS
var xe=e("./styles")
var Me=xe.color_black
var De=xe.colors_light_gold
var Pe=xe.menu_style_on_dark
var Be=xe.subtitle_style
var ke=e("./ui_util")
var Ue=e("./ui_util_2")
var Ge=e("./user_party")
var Fe=Ge.partyGetHost
var We=Ge.partyGetParticipantsAmount
var He=Ge.partyIsActive
var ze=Ge.partyIsHost
var Ve=Ge.partyWaitingData
var Ye=e("./user_profile_view").userProfileViewOpen
var je
var Ke
function getAccount(){return Ke.account}function accountUILogout(){Ke.doLogout()}function welcomeScreenStartup(){Ke=p()
je=c({name:"worlds_splash",ext:".jpg",filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR})}function needLoginView(){var e=getAccount().getState(I(),A())
return!ee().loggedIn()||e===h.LOGGING_IN||e===h.LOGGING_OUT||!s().connected||e===h.NEEDS_FRVR_ACCOUNT}function needWelcomeScreen(){return needLoginView()||!se()}var qe
var Ze
var Xe=false
var Qe=6e4
function getServerStats(){if(Xe||!s().connected)return qe
if(Date.now()-Ze<Qe)return qe
Xe=true
s().send("get_stats",null,null,function(e,t){if(e)console.error("Error on get_stats: "+e)
Xe=false
Ze=Date.now()
qe=t})
return qe}var $e=350
var Je=340
var et=96
var tt=.7*et
var rt=.5*et
var at=0
var it=1
var ot=2
var nt=3
var st=4
var lt=5
var _t=6
var ct=7
var ut=8
var dt="play"
function fscreenEnterAndOrientAndTriggerPlay(){V()
_(dt)}var ft=[]
ft[at]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:et,font_height:rt,text:fe.BTN_PLAY,key:dt,img:Ue.sprite,frame:Ue.BTNICON_PLAY,in_event_cb:te.auto_fullscreen&&i()&&fscreenEnterAndOrientAndTriggerPlay})){E("play_button",1,"button")
y(T.MAIN,1,"main_menu")
Y()
F()
w()}}}
ft[it]={will_show:false,fn:function fn(e,t,r){if(f({x:e,y:t,w:r,h:et,font_height:rt,text:fe.LBL_ACCESS_TOKEN_ENTER})||ie.get("token")){Y()
E("enter_token",1,"button")
k()}}}
ft[ot]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:et,font_height:rt,img:Ue.sprite,frame:Ue.BTNICON_OUTFIT,text:fe.BTN_OUTFIT,hook:"new_cosmetic"})){Y()
D(z)}}}
ft[nt]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:tt,font_height:rt,text:fe.BTN_MY_PROFILE,img:ke.sprite,frame:ke.USER_PROFILE,img_color:Me})){E("welcome_profile",1,"button")
Y()
Ye("me")}}}
ft[lt]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:tt,font_height:rt,text:q?fe.BTN_FEEDBACK_ACCOUNT:fe.BTN_BUGS_FEEDBACK,img:Ue.sprite,frame:Ue.BTNICON_BUGS})){E("welcome_feedback",1,"button")
N()}}}
ft[st]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:tt,font_height:rt,text:fe.BTN_RECENT_UPDATES,img:Ue.sprite,frame:Ue.BTNICON_UPDATES})){E("welcome_changelog",1,"button")
C.changelogShow()}}}
var vt=false
var ht="https://www.reddit.com/r/WorldsFRVR/comments/v5xaat/build_contest_100_anniversary_build_kingdom_of/"
ft[_t]={will_show:false,fn:function fn(e,t,r){if(!window.FBInstant)o({x:e,y:t,w:r,h:tt,url:ht})
if(f({x:e,y:t,w:r,h:tt,font_height:rt,text:fe.BTN_BUILD_CONTEST,colors:De,hook:window.FBInstant?"reddot_news_last_seen_ts":null}))if(window.FBInstant){E("welcome_fb_follow",1,"button")
R()
Ce()}}}
ft[ct]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:tt,font_height:rt,text:fe.BTN_LATEST_NEWS,hook:"reddot_news_last_seen_ts",img:Ue.sprite,frame:Ue.BTNICON_UPDATES})){E("welcome_fb_follow",1,"button")
R()
Ce()}}}
ft[ut]={will_show:false,fn:function fn(e,t,r){if(d({x:e,y:t,w:r,h:tt,font_height:rt,text:fe.BTN_JOIN_OUR_GROUP,img:Ue.sprite,frame:Ue.BTNICON_UPDATES})){E("welcome_fb_join_group",1,"button")
b()}}}
var pt=false
var mt=550
var Et=730
function welcomeScreen(){profilerStart("welcomeScreen")
var e=re()
var t=ee().loggedIn()
var r=needLoginView()
var a=r?1e3:1e3
var i={}
if(!needWelcomeScreen()&&Oe()){ye(i)
return profilerStop("welcomeScreen")}Re()
Ae(i,a,false,false)
var o=i.y,n=(i.w,i.x_mid)
Se(pe)
Ne()
gl.clearColor(3/255,3/255,3/255,1)
var s
var l
var _
var c
var u
var d=1400
var f=1e3
var v=1e3
var h=1700
if(r||!se()){s=750
l=440
_=n
c=0
u=!ue}else{if((u=de(d,f,v,h))===ue){_=3*d/4
l=410}else{_=v/2
l=410}s=780}if(!isFinite(Z.UI))X(isFinite(Z.UI),"z="+Z.UI+";Z="+JSON.stringify(Z))
var p={x:_-s/2,y:(l-s)/2,z:Z.UI-1,w:s,h:s}
je.draw(p)
var m=.627
var E=.685
e.drawSized(Be,p.x+p.w*m,p.y+p.h*E,Z.UI+1,.035*p.h,le())
o=l
var g=.75*rt
if(r){if(!t)oe("home_screen",1,"menu_log_in")
var T=ae()
var y=8
var S=fe.separateColon(fe.LBL_VERSION,J())
var I=getServerStats()
if(I&&I.ccu)S=fe.LBL_USERS_ONLINE_NUMBER.$({users:I.ccu})+"  |  "+S
e.drawSizedAligned(Pe,n,o-T,Z.UI,T,$.HCENTER,0,0,S)
o=Ke.showLogin({x:n,y:o+=y,style:Pe,button_height:et,font_height:rt,font_height_small:g,text_w:800,button_width:220,url_tos:Ee,url_priv:me})}if(!r){if(!pt){ve()
pt=true}oe("home_screen",1,"menu_logged_in")
var A=_
var w=se()
var L={w:mt,h:Et,button_h:et,draw_elipse:true}
if(!w)o=l+(c=100)
else if(u===ue){L.x=(d/2-mt)/2
L.y=(f-Et)/2
o=l}else{c=20
L.x=(v-mt)/2
L.y=l+c
o=L.y+L.h+32}var O=A-Je/2
var R=O-Je/2
var b=O+Je/2
var N=A-$e/2
ft[at].will_show=w&&!ie.get("token")
ft[it].will_show=!ft[at].will_show
ft[ot].will_show=w
ft[nt].will_show=w
ft[lt].will_show=w&&ne()
ft[st].will_show=w
ft[_t].will_show=vt&&(!window.FBInstant||_e())
ft[ut].will_show=ce()
var C
if(Ve())ft[at].will_show=false
else if(He())if(ze())C=fe.MSG_PARTY_HOST_CREATE_OR_JOIN_WORLD
else{ft[at].will_show=false
var x=Fe()
if(x&&x.world_id)if(x.pos_str){Te(x.user_id,x.world_id,x.pos_str)
return profilerStop("welcomeScreen")}else if(x.querying_pos)C=Le()||fe.MSG_PARTY_CHOOSING_HOST
else C=fe.MSG_PARTY_HOST_IN_PRIVATE_WORLD
else if(x)C=fe.MSG_PARTY_WAITING_HOST_WORLD
else C=fe.MSG_PARTY_CHOOSING_HOST}if(We()>1)we(C)
var M=0
for(var D=0;D<ft.length;++D)if(ft[D].will_show)++M
var P=getAccount().shouldShowLogout()&&te.show_logout_on_welcome
if(P)M++
var B=u===ue?650:800
if(!w){c=u===ue?32:150
e.drawSizedAligned(Pe,A-B/2,o,Z.UI,g,$.HCENTERFIT,B,0,fe.MSG_SERVER_NEEDS_ACCESS_TOKEN)
o+=g+c}var k=ae()
var U=8
var G=fe.separateColon(fe.LBL_VERSION,J())
var F=getServerStats()
if(F&&F.ccu)G=fe.LBL_USERS_ONLINE_NUMBER.$({users:F.ccu})+"  |  "+G
o+=u===ue?45:-80
e.drawSizedAligned(Pe,b,o-k,Z.UI,k,$.HCENTER,0,0,G)
o+=U
var W=1
var H=A
var z=$e
if(M>5){W=2
z=Je}if(2===W){var V=0
var Y=R
var j=false
for(var K=0;K<ft.length;K++)if(ft[K].will_show){ft[K].fn(Y,o,Je)
V++
Y=R
if(j=!j)Y=b
else o+=V>2?tt:et}if(j)if(P);else o+=V>2?tt:et
if(Y===b)H=Y+Je/2}else for(var q=0;q<ft.length;q++)if(ft[q].will_show){ft[q].fn(N,o,$e)
o+=(q>2?tt:et)+8}Ke.showLogin({x:H,y:o,style:Pe,font_height:rt,font_height_small:g,button_height:tt,button_width:z,text_w:B,url_tos:Ee,url_priv:me,user_id_x:A})
o+=tt+24
if(w)be(L)}Q.setAspectFixed(900,900)
i.w=900
i.y=Q.y1()-32
Ie(i,Pe)
ge()
he().runLate()
return profilerStop("welcomeScreen")}var gt=true
function welcomeScreenInit(){K()
var e=gt
if(a.DEBUG&&e)l(true)
a.setState(welcomeScreen)
gt=false
if(e){v()
if(a.defines.CURRENCY_SHOP)L("debug")
if(a.defines.OUTFIT)D(z)
if(a.defines.BOOST)D(H,"4568481")}if(e&&U()===B)return void G()
pt=false
welcomeScreen()}function welcomeScreenInitSetState(){a.setState(welcomeScreenInit)}function welcomeScreenGetInitialState(){return welcomeScreenInit}function welcomeScreenSetState(){K()
a.setState(welcomeScreen)}function welcomeScreenIsActive(){return a.stateActive(welcomeScreen)||a.stateActive(welcomeScreenInit)}},{"../glov/client/camera2d":295,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/fscreen":317,"../glov/client/link":328,"../glov/client/net":338,"../glov/client/settings":351,"../glov/client/shaders":353,"../glov/client/spot":361,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/urlhash":369,"./account":3,"./account_ui":4,"./analytics":6,"./analytics_ftue":7,"./app_access":12,"./create_first_world":69,"./currency_shop":72,"./fbinstant_worlds":96,"./feedback":97,"./iframe_content_handlers":105,"./layout":120,"./localization/localization":131,"./login_rewards":134,"./main":135,"./main_menu":136,"./menu":140,"./motd":147,"./paperdoll":151,"./photo_mode":158,"./platform_worlds_client":160,"./red_dot":176,"./styles":197,"./ui_util":205,"./ui_util_2":206,"./user_party":211,"./user_profile_view":212,assert:void 0}],225:[function(e,t,r){"use strict"
r.onWorldUnclaimed=onWorldUnclaimed
r.getClaimCount=getClaimCount
r.claimReset=claimReset
r.claimFinalize=claimFinalize
r.claim=claim
r.unclaim=unclaim
r.CLAIM_NAME=r.CLAIM_BY_SELF=r.CLAIM_BY_OTHER=r.CLAIM_UNKNOWN=r.CLAIM_PENDING=void 0
var n=-2
r.CLAIM_PENDING=n
var s=-1
r.CLAIM_UNKNOWN=s
var l=0
r.CLAIM_BY_OTHER=l
var _=1
r.CLAIM_BY_SELF=_
var c=e("assert")
var u=e("../glov/client/engine.js")
var a=e("../glov/common/util").ridx
var i=e("./main.js")
var o=e("../glov/client/net.js").netDisconnected
var d=e("./voxel_data.js")
var f=e("./world_comm.js").worldSend
function onWorldUnclaimed(e){c(Array.isArray(e))
e.forEach(function(e){var t=d.chunk_map[e]
if(t){c(t.claimed!==_)
if(t.claimed!==n)t.claimed=s}})}var v=[];(r.CLAIM_NAME=v)[n]="CLAIM_PENDING"
v[s]="CLAIM_UNKNOWN"
v[l]="CLAIM_BY_OTHER"
v[_]="CLAIMED"
var h
function getClaimCount(){return h}var p
var m
var E
function claimReset(){p=[]
m=[]
E={}
h=0}claimReset()
function sendClaims(){var o=m
m=[]
if(!i.omp)return
for(var e=0;e<o.length;++e){var t=o[e]
var r=d.chunk_map[t]
c(r)
c.equal(r.claimed,n)}f("claim",o,function(e,t){if(e){console.error("Error claiming chunks",e)
o.forEach(function(e){var t=d.chunk_map[e]
if(t){t.claimed=s
t.claim_throttle=u.frame_timestamp+5e3}})
return}c.equal(t.length,o.length)
for(var r=0;r<t.length;++r){var a=o[r]
if(E[a]){if(!--E[a])delete E[a]
continue}var i=d.chunk_map[a]
if(i){c.equal(i.claimed,n)
if(t[r]){++h
i.claimed=_}else i.claimed=l}}})}function sendUnclaims(){var e=p
p=[]
if(!i.omp||o())return
f("unclaim",e,function(e,t){if(e)console.error("Error unclaiming chunks",e)})}function claimFinalize(){if(m.length)sendClaims()
if(p.length)sendUnclaims()}function claim(e){c.equal(e.claimed,s)
if(!i.omp){++h
e.claimed=_
return}if(o())return
if(p.includes(e.chunk_id)){var t=p.indexOf(e.chunk_id)
a(p,t);++h
e.claimed=_}else{e.claimed=n
m.push(e.chunk_id)}}function unclaim(e){if(e.claimed===_||e.claimed===n){if(e.claimed===n)E[e.chunk_id]=(E[e.chunk_id]||0)+1
if(i.omp)p.push(e.chunk_id)
if(e.claimed===_)--h
e.claimed=s}}},{"../glov/client/engine.js":305,"../glov/client/net.js":338,"../glov/common/util":400,"./main.js":135,"./voxel_data.js":216,"./world_comm.js":226,assert:void 0}],226:[function(e,t,r){"use strict"
r.worldAutoConnect=worldAutoConnect
r.worldAutoConnectIsReconnect=worldAutoConnectIsReconnect
r.getWorldID=getWorldID
r.getWorldChannel=getWorldChannel
r.worldAutoConnectClear=worldAutoConnectClear
r.worldRecordCurrentWGID=worldRecordCurrentWGID
r.worldGoByURL=worldGoByURL
r.getClientID=getClientID
r.worldIsWaiting=worldIsWaiting
r.whenConnected=whenConnected
r.worldGetTile=worldGetTile
r.worldSetUserData=worldSetUserData
r.transDelay=transDelay
r.getUserData=getUserData
r.worldSend=worldSend
r.worldPak=worldPak
r.refreshProp=refreshProp
r.worldTransactionsInProgress=worldTransactionsInProgress
r.transact=transact
r.getGemBalance=getGemBalance
r.getOrbBalance=getOrbBalance
r.getBoostTokenBalance=getBoostTokenBalance
r.worldClaimGem=worldClaimGem
r.getPerm=getPerm
r.worldGetRoles=worldGetRoles
r.worldGetClients=worldGetClients
r.worldBuzzerStart=worldBuzzerStart
r.worldBuzzerAbandon=worldBuzzerAbandon
r.worldBuzzerSubmit=worldBuzzerSubmit
r.worldBuzzerRemove=worldBuzzerRemove
r.worldRefreshUserData=worldRefreshUserData
r.worldCommWhenConnectedToAnyWorld=worldCommWhenConnectedToAnyWorld
r.joinWorld=joinWorld
r.worldTargetGo=worldTargetGo
r.worldCommStartup=worldCommStartup
r.leaveWorld=leaveWorld
r.worldCmdParse=worldCmdParse
r.myUserCmdParse=myUserCmdParse
r.myUserCmdParseWrap=myUserCmdParseWrap
r.world_id=r.world_channel=void 0
var F=e("assert")
var a=e("../glov/client/abtest.js").abTestGetMetricsAndPlatform
var i=e("../glov/client/client_config").platformParameterGet
var o=e("../glov/client/cmds.js").cmd_parse
var L=e("../glov/client/engine.js")
var n=e("../glov/client/error_report.js")
var s=n.errorReportSetDetails
var l=n.errorReportSetDynamicDetails
var _=e("../glov/client/fscreen.js").fscreenActive
var c=e("../glov/client/input.js")
var u=e("../glov/client/local_storage.js")
var d=e("../glov/client/net.js")
var f=d.netClient
var v=d.netClientId
var h=d.netDisconnected
var p=d.netSubs
var m=d.netUserId
var E=e("../glov/client/perf.js").perfSetAutoChannel
var g=e("../glov/client/ui.js")
var T=e("../glov/client/urlhash.js")
var y=e("../glov/common/util.js")
var S=y.callEach
var I=y.msToTimeString
var A=y.nop
var w=y.ridx
var W=e("../glov/common/verify.js")
var O=e("../glov/common/vmath.js")
var R=O.v3iMax
var b=O.v3iMin
var H=O.v3same
var N=O.v3set
var C=O.vec3
var x=e("../common/permissions.js")
var M=e("../common/race_common.js").trueBuzzerID
var D=e("../common/store_data.js")
var P=D.PRODUCT_ITEM_ID_BOOST_TOKEN
var B=D.PRODUCT_ITEM_ID_GEM
var k=D.PRODUCT_ITEM_ID_ORB
var U=e("../common/voxel_data_common.js")
var G=U.ANIM_TYPE_POS
var z=U.TRANSACT_BAG_ADD
var V=U.TRANSACT_INV_ATTRIB
var Y=U.TRANSACT_INV_MOD
var j=U.TRANSACT_ITEM_ANIM
var K=U.TRANSACT_PROP_CHAT
var q=U.TRANSACT_PROP_INV_MOD
var Z=U.TRANSACT_PROP_MOD
var X=U.TRANSACT_PROP_SET
var Q=U.TRANSACT_STAT
var $=U.TRANSACT_USER_ATTRIB
var J=U.TRANSACT_VOLUME_MOD
var ee=U.TRANSACT_VOXEL_SET
var te=U.TRANSACT_VOXEL_SET_RLE
var re=U.TRANS_INV_EQUIP
var ae=U.TRANS_INV_PLAYER
var ie=e("../common/world_constants.js")
var oe=ie.ACCESS_OWNER
var ne=ie.THRESHOLD_ACCESS_MODIFY
var se=ie.WAYGATE_FLAG_LISTED
var le=ie.WAYGATE_FLAG_SETTLEMENT
var _e=e("../common/world_trans.js")
var ce=_e.createTransSet
var ue=_e.decodeChunkPos
var de=_e.encodeChunkPos
var fe=e("./analytics.js")
var ve=fe.analyticsAddFieldFunction
var he=fe.itemFlowEvent
var pe=fe.logEvent
var me=fe.logEventOnce
var Ee=e("./app_access.js").accessPrerelease
var ge=e("./blueprint.js").blueprintUnsubscribeAll
var Te=e("./build_mode.js")
var ye=Te.applyDigProgress
var Se=Te.propAutoSelectOnBreakArea
var Ie=Te.protectBlockIdx
var Ae=e("./client_cmds.js")
var we=Ae.isElevated
var Le=Ae.waygateGo
var Oe=Ae.waygateToPosStr
var Re=e("./client_entities.js").clientEntitiesJoinWorld
var be=e("./continent_loader.js").continentLoaderLeaveWorld
var Ne=e("./editvolume_client.js").resetEditVolumes
var Ce=e("./energy_well.js").possiblyApplyWaygateSickness
var xe=e("./fbinstant_worlds.js")
var Me=xe.fbCanShare
var De=xe.fbPostPassiveToContext
var Pe=e("./huds.js").gemsHudOnGemClaimed
var Be=e("./inventory.js")
var ke=e("./inventory.js")
var Ue=ke.INV_EQUIP
var Ge=ke.INV_PLAYER
var Fe=ke.inventoryLocked
var We=ke.inventoryResetPropLocks
var He=ke.inventorySetLock
var ze=ke.propInventoryLockedByPos
var Ve=ke.propInventorySetLockedByPos
var Ye=e("./item_anims.js")
var je=e("./item_unlock_ui.js").showItemUnlock
var Ke=e("./loading_custom").loadingCustomPrepForWorld
var qe=e("./localization/localization").L
var Ze=e("./main.js")
var Xe=e("./main.js").unreleasedReload
var Qe=e("./main_menu.js")
var $e=e("./megachunk_client.js")
var Je=e("./megachunk_client.js")
var et=Je.detailGenUnspoil
var tt=Je.onVolumeMod
var rt=e("./menu.js")
var at=e("./menu.js")
var it=at.WORLD_INFO_VIEW
var ot=at.exitSpecificMenu
var nt=e("./mobs.js").otherPlayerAnim
var st=e("./party_ui").worldUserBuildAccessCacheClear
var lt=e("./props.js").propFromJSON
var _t=e("./social_referral.js").checkReferrer
var ct=e("./status.js")
var ut=e("./tiles.js")
var dt=ut.TILE_PROP_BASE
var ft=ut.TILE_PROP_MAX
var vt=e("./tutorial.js")
var ht=vt.tutorialLeaveWorld
var pt=vt.tutorialStartByName
var mt=vt.tutorialState
var Et=e("./ui_util.js").GEM_SYMBOL
var gt=e("./user_data.js")
var Tt=gt.doWaygateSickness
var yt=gt.isPlayAsViewer
var St=gt.playAsViewerSet
var It=gt.raceJoinAllowed
var At=gt.setAccessLevel
var wt=gt.userAttribUndoTransactionOp
var Lt=gt.userDataGet
var Ot=gt.userDataInit
var Rt=gt.userDataIsWaiting
var bt=gt.userDataLeaveWorld
var Nt=gt.userDataPredict
var Ct=gt.userDataSet
var xt=gt.userDataStartWaiting
var Mt=gt.worldReadOnly
var Dt=e("./user_party").partySetUserWorld
var Pt=e("./voxel_chunk_manager.js").releaseClaimed
var Bt=e("./voxel_data.js")
var kt=e("./voxel_data.js")
var Ut=kt.getLocalPosFromChunkID
var Gt=kt.getLocalPosFromChunkIDIfAvailable
var Ft=kt.getPropDirect
var Wt=kt.getTilePosPair
var Ht=kt.getTileRelative
var zt=kt.liquidUpdateDefer
var Vt=kt.markChunkSpoiled
var Yt=kt.removePropDirect
var jt=kt.replacePropDirect
var Kt=kt.setPropDirect
var qt=kt.setTileRelative
var Zt=kt.transSetTileDirect
var Xt=kt.voxelDataDirtyCacheEnd
var Qt=kt.voxelDataDirtyCacheStart
var $t=e("./voxel_mesh.js").voxelMeshFlush
var Jt=e("./world_claims.js")
var er=Jt.claimReset
var tr=Jt.onWorldUnclaimed
var rr=e("./world_comm_effective_access.js")
var ar=rr.worldEffAccessOnList
var ir=rr.worldEffAccessUnsub
var or=e("./world_get_chunk.js").worldGetChunkCancel
var nr=e("./world_info.js")
var sr=nr.getWorldInfo
var lr=nr.getWorldInfoCached
var _r=nr.worldInfoCacheClearForWorld
var cr=e("./world_metadata.js")
var ur=cr.unlimitedMode
var dr=cr.worldApplyMetadataToInventory
var fr=cr.worldEnergy
var vr=cr.worldMetadata
var hr=cr.worldMetadataDelete
var pr=cr.worldMetadataFreePos
var mr=cr.worldMetadataReset
var Er=cr.worldMetadataSet
var gr=cr.worldMetadataUpdate
var Tr=cr.worldMetadataWaygate
var yr=cr.worldRaceAsVisitor
var Sr=Math.PI
var Ir=1500
var Ar
r.world_channel=Ar
var wr
r.world_id=wr
var Lr=0
var Or=false
var Rr=false
function worldAutoConnect(){return Rr}var br=false
function worldAutoConnectIsReconnect(){return br}function getWorldID(){return wr}function getWorldChannel(){return Ar}function worldAutoConnectClear(){T.setMulti({w:"",wg:"",u:"",action:""})
Rr=false}l("world",function(){return wr||void 0})
T.register({key:"w",push:true,title:function title(e){var t
if(e===wr)t=vr()
else if(f()){var r="info"===T.get("wg")
t=sr(e,r)}if(t&&t.name)return t.name
return"World #"+e}})
T.register({key:"wg",push:false,hide_values:{default:1,undefined:1}})
T.route("w/:w")
T.route("w/:w/:wg")
var Nr=null
function worldRecordCurrentWGID(e){Nr=e}function worldCommOnURLChange(e){var t=T.get("w")
F(!t||"string"===typeof t)
var r=T.get("wg")
var a="go"===T.get("action")&&T.get("u")
if(t&&"info"===r){Ze.toggleMenuPage(it,t)
return}ot(it)
if(t||a)if(t===wr&&!e&&vr()){if(T.get("pos"));else if(r&&r!==Nr){var i=Le(r,{listed_only:true,from_url:true})
if(i){Ze.chat_ui.addChatError(qe.$(qe.CHATERROR_ACCESSING_WAYGATE,r,i))
T.set("wg","")
Nr=null}}}else{Rr=true
br=false
Ze.returnToMainMenu()}else if(wr)Ze.returnToMainMenu()}function worldGoByURL(e,t){T.setMulti({w:e,wg:t,pos:"",u:"",action:""})
worldCommOnURLChange()}function getClientID(){if(!Ze.omp)return"local"
return v()}var Cr=[]
function checkExpectedPropInvMod(e){F.equal(e.length,10)
e:for(var t=0;t<Cr.length;++t){var r=Cr[t]
F.equal(r.length,10)
for(var a=0;a<9;++a)if(r[a]!==e[a])continue e
w(Cr,t)
return true}return false}var xr=[]
function checkExpectedPropMod(e){F.equal(e.length,8)
e:for(var t=0;t<xr.length;++t){var r=xr[t]
F.equal(r.length,8)
for(var a=0;a<7;++a)if(r[a]!==e[a])continue e
w(xr,t)
return true}return false}var Mr=[]
function checkExpectedItemAnim(e){F.equal(e.length,7)
e:for(var t=0;t<Mr.length;++t){var r=Mr[t]
F.equal(r.length,7)
for(var a=0;a<9;++a)if(r[a]!==e[a])continue e
w(Mr,t)
return true}return false}function clearExpected(e,t){var r=false
for(var a=Cr.length-1;a>=0;--a){var i=Cr[a]
if(i[7]===e&&i[8]===t){w(Cr,a)
r=true}}for(var o=xr.length-1;o>=0;--o){var n=xr[o]
if(n[4]===e&&n[5]===t){w(xr,o)
r=true}}return r}function worldIsWaiting(){return $e.countWaiting()}var Dr=[]
function whenConnected(e){if(!h())return void e()
Dr.push(e)}function worldResync(){console.log("World out of sync, resyncing...")
ct.push(qe.STATUSMSG_OUT_OF_SYNC)
worldCommOnURLChange(true)}o.register({cmd:"world_resync",access_show:["hidden"],func:worldResync})
var Pr=0
var Br=0
function worldGetTile(e,t,r,a){++Br
whenConnected(function(){Ar.send("vd_get_tile",[e,t,r?1:0],function(e,t){--Br
a(e,t)
if("ERR_UNSPOILED_CHUNK"===e)worldResync()})})}function worldSetUserData(e,t,r){Ar.send("set_user",{key:e,value:t},r)}function transDelay(e){if(L.defines.TRANSDELAY)setTimeout(e,Ir)
else e()}function sendGetUser(e,t){var r=Ar.pak("get_user2")
r.writeAnsiString(a())
r.writeAnsiString(e||"")
r.send(t)}function getUserData(e,t){F(Ze.omp)
transDelay(function(){sendGetUser(e,t)})}function worldSend(e,t,r){Ar.send(e,t,r)}function worldPak(e){return Ar.pak(e)}function getVoxel(e,t,r){F(Ze.omp)
transDelay(function(){Ar.send("get_vox",{chunk_id:e,pos_idx:de(t)},r)})}var kr=function(){var t=new Int32Array(3)
var r=C()
return function itemAnimFromTransFn(e){if(e.target_type===G){if(!Bt.chunk_map[e.target_chunk_id])return
Ut(t,e.target_chunk_id,e.target_pos)
e.target=t}if(e.src_type===G){if(!Bt.chunk_map[e.src_chunk_id])return
Ut(r,e.src_chunk_id,e.src_pos)
e.src=r}else nt(e.src)
Ye.add(e)}}()
var Ur=false
var Gr=[0,0,0]
var Fr=[0,0,0]
var Wr=[0,0,0]
function transOpApplyVoxelSet(e,t,r,a,i){var o=ue(t)
if(!a)if(r){if(i!==Ht(e,o,0,r))zt(e)}else if(Ur&&!i)if(Gt(Wr,e,o)){b(Gr,Wr)
R(Fr,Wr)}qt(e,o,i,r)
Ie(e,t)}function transOpApply(e,t,r,a){switch(e){case te:var i=t.get(r)
var o=i[1]
var n=i[2]
var s=i[3]
var l=i[4]
var _=6
var c=1&l
var u=2&l
while(_<i.length){var d=i[_++]
for(var f=0;f<d;++f,++n)transOpApplyVoxelSet(o,n,c,u,s)
if(_<i.length)n+=i[_++]}Vt(o)
break
case ee:var v=t.get(r)
var h=v[1]
var p=v[2]
var m=v[3]
var E=v[4]
transOpApplyVoxelSet(h,p,1&E,2&E,m)
Vt(h)
break
case X:var g=t.get(r)
var T=g[1]
var y=g[3]
var S=g[4]
var I=ue(S)
var A=Ft(y,I)
if(A)Ye.setLastModProp(A)
if(T){var w=false
if(clearExpected(y,S))w=true
var L=lt(JSON.parse(T),A,true)
if(A)if(H(A.size,L.size)&&A.draw===L.draw)jt(y,I,L)
else{Yt(y,I)
Kt(y,I,L)}else Kt(y,I,L)
if(w)if(Wt([y,S])!==dt)refreshProp(L,y,I)}else if(A)Yt(y,I)
Ie(y,S)
Vt(y)
break
case K:var O=t.getPropChat(r)
var R=O.pos
var b=Ft(O.chunk_id,R)
if(b)b.chatAddDirect(O.style_id,O.key,O.params)
break
case Z:var N=t.getPropMod(r)
var C=N.pos
var x=Ft(N.chunk_id,C)
if(x&&x.item_id===N.item_id){if(!checkExpectedPropMod(t.get(r))){x.applyFieldMod(N.field,N.new_value)
if(!x.in_list_mod){x.in_list_mod=true
a.push(x)}}x.version=N.version||1}Vt(N.chunk_id)
break
case z:F(!Ze.omp)
break
case Y:case q:var M=t.getInvMod(r)
var D=false
if(e===q){Vt(M.prop_chunk_id)
if(checkExpectedPropInvMod(t.get(r)))D=true}Be.applyTransactionOp(M,D)
if(M.cb)M.cb()
break
case V:case $:F(false)
break
case j:if(checkExpectedItemAnim(t.get(r)))break
var P=t.getItemAnim(r)
if(W(P))kr(P)
break
case Q:F(false)
break
case J:var B=t.get(r)
F.equal(B.length,4)
var k=B[1]
var U=B[2]
var G=B[3]
tt(G,k,U)
break
default:F(false)}}function transSetApply(e){if(Ur=!Mt()){N(Gr,Infinity,Infinity,Infinity)
N(Fr,-Infinity,-Infinity,-Infinity)}var t=[]
for(var r=0;r<e.numTransactions();++r){var a=e.get(r)
for(var i=0;i<a.numOps();++i)transOpApply(a.get(i)[0],a,i,t)
F(!a.cbs)}for(var o=0;o<t.length;++o){var n=t[o]
n.in_list_mod=false
if(!n.removed)n.updateRuntimeBehaviour()}if(Ur)if(isFinite(Gr[0]))Se(Gr,Fr)}function refreshInventory(e,r){var t=e===ae?"inventory":"equip"
var a=e===ae?Ge:Ue
if(Fe(a)){F(!r)
return}function onData(e,t){if(!Fe(a)){F(!r)
return}if(e){console.error("Error refreshing inventory",e)
He(a,false)}else{F(t)
Be.reload(a,t,void 0)
console.log("Inventory refreshed.")}if(r)r()}console.log("Refreshing inventory after prediction failure...")
He(a,true)
whenConnected(function(){if(!Ze.omp)return
getUserData(t,onData)})}o.register({cmd:"inventory_refresh",access_show:["sysadmin"],help:"(Debug) Trigger an inventory refresh",func:function func(e,t){refreshInventory("equip"===e?re:ae,t)}})
o.register({cmd:"inventory_size",help:"(Admin) Show or adjust inventory size",access_run:["sysadmin"],func:function func(e,r){Ar.cmdParse("world_inventory_size "+e,function(e,t){if(e)return void r(e)
refreshInventory(ae,r)})}})
function refreshProp(n,s,l){var _=de(l)
if(ze(s,_))return
console.log("Refreshing prop "+s+","+_+",uid:"+(n&&n.uid)+" after prediction failure...")
var c=Bt.chunk_map[s]
if(!c)return
Ve(s,_,true);++Br
var u=c.reused
whenConnected(function(){if(c.reused!==u){--Br
Ve(s,_,false)
return}getVoxel(s,l,function(e,t){--Br
Ve(s,_,false)
if(c.reused!==u)return
if(e||!t)console.error("Error refreshing prop "+s+","+_+",uid:"+(n&&n.uid),e)
else{var r=Ft(s,l)
var a=Ht(s,l,0,false)
var i=t.tile>=dt&&t.tile<=ft
if(t.prop&&!i){ct.push(qe.STATUSMSG_ORPHANED_PROP)
Zt(Ze.getFrameTransaction(),c,l,dt,false,false,t.tile,true)
i=true}if(!i){if(n){if(r===n)Kt(s,l,null)}else if(a>=dt&&a<=ft);}else{if(t.prop)if(r&&r===n&&Array.isArray(t.prop.d)&&n.inv.is_container){n.reloadContents(t.prop.d)
n.version=t.prop.v||1}else{if(r)Yt(s,l)
var o=lt(t.prop,null,true)
Kt(s,l,o)}else F(!n||!r||t.tile>dt)
if(!t.prop&&t.tile===dt)Zt(Ze.getFrameTransaction(),c,l,0,false,false,t.tile,true)
else if(a!==t.tile)qt(s,l,t.tile,false)}console.log("Refreshed prop "+s+","+_+",uid:"+(n&&n.uid)+" = "+JSON.stringify(t))}})})}function worldTransactionsInProgress(){return Pr+Br}var Hr={}
function transact(I,A){profilerStart("transact")
var w=[]
for(var e=0;e<I.numTransactions();++e){var t=true
var r=I.get(e)
r.submitted=true
s("trans_compact_debug",r.ops.length>300?r.ops.length+" ops":JSON.stringify(r))
profilerStart("compact()")
r.compact()
profilerStop()
s("trans_compact_debug",void 0)
for(var a=0;a<r.numOps();++a){var i=r.get(a)
if(!i.pred){if(i[0]!==Q)t=false
continue}if(i[0]===q)Cr.push(i)
else if(i[0]===j)Mr.push(i)
else if(i[0]===Z)xr.push(i)
else t=false}w.push(t)}++Pr
function doit(){profilerStart("send()")
var S=Lr
Ar.send("world_trans",I,function(e,t){--Pr
var r=false
if(Lr!==S){r=true
e="ERR_DISCONNECTED"}if(e){t=new Array(I.numTransactions())
for(var a=0;a<t.length;++a)t[a]=e
if(I.hasPristineSends()){for(var i in I.pristine_sends)if(!$e.hasMegachunkForChunkId(i)){var o=Bt.chunk_map[i]
if(o)o.sent_pristine=false}else if(!$e.isSpoiledByChunkId(i)){var n=Bt.chunk_map[i]
if(n)n.sent_pristine=false}for(var s in I.hexome_choices)$e.hexomeChoiceSet(s,null)
for(var l in I.detail_data)et(l)}}else F.equal(t.length,I.numTransactions())
for(var _=0;_<t.length;++_){var c=t[_]
var u=I.get(_)
if(w[_]&&c){var d=true
for(var f=0;f<u.numOps();++f){var v=u.get(f)
if(v[0]===q){if(checkExpectedPropInvMod(v))d=false}else if(v[0]===j){if(checkExpectedItemAnim(v))d=false}else if(v[0]===Z)if(checkExpectedPropMod(v))d=false}if(d){console.log('Transaction Error "'+c+'" while applying '+JSON.stringify(u)+", but all ops already applied, ignoring.")
c=null}}if(c){console.log('Transaction Error "'+c+'" while applying '+JSON.stringify(u))
if(!u.silent_error&&!r)ct.push(qe.$(qe.STATUSMSG_TRANSACTION_FAILED,c))
else if(L.DEBUG)ct.push("(silent) Transaction failed: "+c)}for(var h=0;h<u.numOps();++h){var p=u.get(h)
var m=p.cb
switch(p[0]){case Y:case q:p=u.getInvMod(h)
if(c){if(p.pred)if(void 0!==p.prop_chunk_id)refreshProp(Ft(p.prop_chunk_id,p.prop_pos),p.prop_chunk_id,p.prop_pos)
else refreshInventory(p.user_inv_type)}else if(!p.pred)if(void 0!==p.prop_chunk_id);else Be.applyTransactionOp(p)
break
case V:if(c)refreshInventory((p=u.getInvAttrib(h)).user_inv_type)
break
case $:if(c){p=u.getUserAttrib(h)
wt(p)}break
case X:var E=p[3]
var g=p[4]
var T=E+","+g
if(c){Hr[T]=(Hr[T]||0)+1
if(Hr[T]>10)F(false,"Repeated PROP_SET error on "+T)
if(p.pred||true){var y=ue(g)
refreshProp(Ft(E,y),E,y)}}else delete Hr[T]
break
case Z:if(c)if((p=u.getPropMod(h)).pred)refreshProp(Ft(p.chunk_id,p.pos),p.chunk_id,p.pos)}if(m)m(c)}if(u.cbs)u.callCallbacks(c)}if(A)A(t)})
profilerStop("send()")}transDelay(doit)
profilerStop("transact")}function onWorldTransApply(e){var t=ce()
t.fromJSON(e)
Qt()
transSetApply(t)
Xt()}function onWorldSpoiled(e){F.equal(typeof e,"number")
$e.spoil(e)}function onWorldUnspoiled(e){F(Array.isArray(e))
F(e.length)
F.equal(typeof e[0],"number")
for(var t=0;t<e.length;++t){var r=e[t]
$e.unspoil(r)
Bt.markChunkUnspoiled(r)}$t()}function onWorldDig(e){ye(e)}function onWorldSetPos(e){e[3]*=180/Sr
e[4]*=180/Sr
Ze.char_controller.updatePosFromString(String(e),false)}function onWorldSetPosWG(e){Ce()
Ze.char_controller.updatePosFromString(Oe({pos:e}),false)}function onWorldSetUserData(e){if(!Rt())Nt(e.key,e.value,true)}function getHomeWGID(e){var t
if(e)t=e.home
else t=Lt("home")
var r=Tr(t)
if(r&&r.flags&le)return t
return"default"}function onWorldSetAccess(e){At(e.level,e.build_level||e.level,e.build_wait||0)
if(!e.level){Ze.chat_ui.addChatError(e.msg||qe.CHATERROR_ACCESS_REVOKED)
Ze.returnToMainMenu()
return}if(Rt())return
var t=Lt("pos_adv")
if(Mt())Pt()
else dr(true)
if(!t&&Tt())Le(getHomeWGID(null),{})}function onWorldInventoryNeedsRefresh(e,t){refreshInventory(re)
refreshInventory(ae)
t()}function sameWorldGuard(e){var t=Lr
return function(){if(t===Lr)e.apply(void 0,arguments)}}function getCurrencyBalance(e){var t=p().getMyUserChannel()
if(!t)return 0
return t.getChannelData("public.permissions.owned."+e,0)-t.getChannelData("public."+e+"_spent",0)}function getGemBalance(){return getCurrencyBalance(B)}function getOrbBalance(){return getCurrencyBalance(k)}function getBoostTokenBalance(){return getCurrencyBalance(P)}var zr=2
function worldClaimGem(e,t,r){function success(){Nt("gems_claimed."+e,1,true)
ct.push(qe.$(qe.STATUSMSG_GEM_FOUND,Et))
Pe()}if(L.defines.GEMTEST)return void success()
if(!p().getMyUserChannel())return
var i=getGemBalance()
var a=Ar.pak("gem_claim")
a.writeAnsiString(e)
a.writeInt(t)
a.writeInt(r)
a.send(sameWorldGuard(function(e){Ze.chat_ui.handleCmdParseError(e)
if(!e){var t
var r=lr("all",false)
var a=Number(getWorldID())
he("gem","source",1,false,a===zr?"hub":!e&&null!=r&&null!=(t=r.featured)&&t.includes(a)?"featured":"other",i)
success()}}))}function getPerm(e){var t
if(p().loggedIn()&&f().connected){var r=p().getMyUserChannel()
t=r.data&&r.data.public}if(!t)t={}
return x.getPerm(t.permissions,e)}function worldGetRoles(){if(Ar)return Ar.getChannelData("public.clients."+v()+".ids.roles",{})
var e={}
if(getPerm("sysadmin"))e.sysadmin=1
if(getPerm("csr"))e.csr=1
if(getPerm("team")||getPerm("csr"))e.team=1
return e}function worldGetClients(){if(Ar)return Ar.getChannelData("public.clients",{})
return{}}function startRaceData(e,t){var r={id:e,start:Date.now()+t}
var a=Lt("race_data")
if(a&&void 0!==a.was_playing_as_viewer)r.was_playing_as_viewer=a.was_playing_as_viewer
if(yr()&&!Mt()){r.was_playing_as_viewer=yt()
if(!yt())St(true)}Ct("race_data",r)}function stopRaceData(e){if("boolean"!==typeof e){var t=Lt("race_data")
e=t&&t.was_playing_as_viewer}if("boolean"===typeof e&&yt()!==e)St(e)
Ct("race_data",null)}function buzzerStartSingleClientError(){var e=qe.STATUSMSG_RACE_NO_MULTIPLE_CLIENTS
var t=qe.STATUSMSG_RACE_SINGLE_CLIENT_ENABLE
if(worldGetRoles().world_admin){ct.get("race_msg").setMessage(e,5e3)
ct.get("race_msg_2").setMessage(t,5e3)
Ze.chat_ui.addChatError(e+"\n"+t)}else ct.get("race_msg").setMessage(e)}function worldBuzzerStart(e){if(Ar&&!Rt()&&Ze.char_controller.forceUpdatePos()){if(!Ar.getChannelData("public.single_client")){buzzerStartSingleClientError()
return}startRaceData(M(e.buzzer_id),0)
var t=e.chunk_id,r=e.pos_idx,a=e.buzzer_id
Ar.send("buzzer_start",{chunk_id:t,pos_idx:r,buzzer_id:a},sameWorldGuard(function(e){if(e){if("ERR_NOT_SINGLE_CLIENT"===e)buzzerStartSingleClientError()
else ct.push(qe.$(qe.STATUSMSG_RACE_START_ERROR,e))
stopRaceData()}}))}}function worldBuzzerAbandon(){if(Ar&&!Rt()&&Lt("race_data")){Ar.send("buzzer_abandon",null,sameWorldGuard(function(e){if(e)ct.push(qe.$(qe.STATUSMSG_RACE_ABANDON_ERROR,e))}))
stopRaceData()}}function worldBuzzerSubmit(e,t,r){var a=e.chunk_id,i=e.pos_idx
if(Ar&&!Rt()&&Ze.char_controller.forceUpdatePos()){var o=Lt("race_data")
var n=o&&o.was_playing_as_viewer
Ar.send("buzzer_submit",{chunk_id:a,pos_idx:i,score:t},sameWorldGuard(function(e){if(e)g.modalDialog({title:qe.DLG_RACE_SAVE_ERROR_TITLE,text:e,buttons:{ok:{cb:A,in_event_cb:!c.touch_mode?c.pointerLockEnter:null}}})
else{stopRaceData(n)
g.modalDialogClear()
r()}}))
Ct("race_data",null)}}function worldBuzzerRemove(e,t){var r=e.chunk_id,a=e.pos_idx
if(Ar&&!Rt())Ar.send("buzzer_remove",{chunk_id:r,pos_idx:a,user_id:t},sameWorldGuard(function(e){if(e)g.modalDialog({title:qe.DLG_RACE_SAVE_ERROR_TITLE,text:e,buttons:{ok:{cb:A}}})
else g.modalDialogClear()}))}function onWorldStartGroupRace(e){if(Ar&&!Rt()){var t=e.user_id===p().loggedIn()
if(It()&&!t){onWorldSetPosWG(e.wg_pos)
var r=M(e.group_race_id)
startRaceData(r,e.delay)
Ar.send("buzzer_start_group_race",r,sameWorldGuard(function(e){if(e){var t=qe.CHATERROR_GROUP_RACE_START
ct.push(qe.separateColon(t,e))
Ze.chat_ui.addChatError(t,e)
stopRaceData()}}))}if(It()||t){var a=0===e.delay?qe.STATUSMSG_GROUP_RACE_START:qe.$(qe.STATUSMSG_GROUP_RACE_START_SECONDS,e.delay/1e3)
ct.push(a)
Ze.chat_ui.addChat(a)}}}function onWorldEndGroupRace(e){if(!(null!=e&&e.host))worldBuzzerAbandon()
var t=qe.STATUSMSG_GROUP_RACE_CANCELLED
ct.push(t)
Ze.chat_ui.addChat(t)}function onWorldWinnerGroupRace(e){var t
if(e.user_id===p().loggedIn())t=qe.STATUSMSG_GROUP_RACE_WON_BY_YOU
else t=qe.$(qe.STATUSMSG_GROUP_RACE_WON_BY_OTHER,e.display_name||e.user_id,I(e.time))
ct.push(t)
Ze.chat_ui.addChat(t)}function onWorldUnlockedProp(e){var t=e.id,r=e.attr1,a=e.attr2,i=e.attr3
je(Number(t),Number(r),Number(a),Number(i))}o.register({cmd:"ui_test_unlock_prop",help:"Test pop-up for unlocking prop during gameplay.",access_run:["sysadmin"],usage:"$HELP\nUsage: /ui_test_unlock_prop id attr1 attr2 attr3",func:function func(e,t){var r=e.split(" ")
if(4!==r.length)return void t("Invalid item parameters")
onWorldUnlockedProp({id:r[0],attr1:r[1],attr2:r[2],attr3:r[3]})
t(null)}})
var Vr=false
function worldRefreshUserData(){if(Vr)return
if(Ar){var r=Lr
Vr=true
console.log("Refreshing user data after prediction failure...")
whenConnected(function(){if(r!==Lr){Vr=false
console.log("Refreshing user data after prediction failure: disconnected")
return}sendGetUser(void 0,function(e,t){Vr=false
if(r!==Lr){console.log("Refreshing user data after prediction failure: disconnected")
return}if(!e&&t){console.log("Refreshing user data after prediction failure: complete")
xt(true)
Ot(t)}else console.log("Refreshing user data after prediction failure: error",e)})})}}var Yr
function handleSubscribeFail(e){var t=wr
Yr=true
if("ERR_ACCESS_DENIED_PASS"===e){Rr=true
br=false}var r=T.get("w")
var a=T.get("wg")
var i=T.get("pos")
T.set("u","")
T.set("action","")
Ze.returnToMainMenu()
if("ERR_ACCESS_DENIED_PASS"===e){Qe.enterPasswordInit(t)
return}if("ERR_ACCESS_DENIED"===e)e=qe.$(qe.DLG_WORLD_ACCESS_DENIED_MSG,p().loggedIn())
if("ERR_SERVER_FULL"===e)e=qe.DLG_WORLD_FULL_MSG
var o={title:qe.DLG_JOINING_WORLD_FAILED_TITLE,text:e,buttons:{OK:null}}
if(getPerm("sysadmin")&&"ERR_NOT_FOUND"!==e&&!we()){o.text+="\n\n(Admin) Run /elevate to bypass permissions."
o.buttons["/elevate"]=function(){Ze.chat_ui.cmdParse("elevate",function(e){if(e)return
T.setMulti({w:r,wg:a||"",pos:i||""})
worldCommOnURLChange()})}}g.modalDialog(o)}function handleSubscribe(e){Or=false
F(e&&e.public&&e.public.seed)
Er(wr,e.public)
s("modapi_cdata",e.public.modapi_continent_data?1:0)
if(e.public.owner.user_id&&e.public.owner.user_id===p().loggedIn()&&!e.public.frozen){var t=wr
if(!u.get("did_share_url_"+wr)&&!_()&&i("url_visible"))setTimeout(function(){if(t!==wr)return
if(!mt()){u.set("did_share_url_"+wr,1)
pt("share_url")}},6e4)}if(window.FBInstant)setTimeout(function(){if(Me())pt("fb_share")
De()},100)}var jr=/^public\.clients(?:\.|$)/
function onWorldChannelData(e,t,r){if(!vr())return
if(!t&&e&&e.public||t&&!t.match(jr))if(t&&void 0===r){F(t.startsWith("public."))
hr(t.slice(7))}else gr(e.public)}var Kr=null
function worldCommWhenConnectedToAnyWorld(e){if(Ar&&!Kr)return void e();(Kr=Kr||[]).push(e)}function joinWorld(e,n,s,l){if(h()){ct.push(qe.STATUSMSG_CANT_JOIN_NOT_CONNECTED)
return}F.equal(typeof e,"string")
pe("world_joining",1,null,String(e),{wgid:s})
Rr=false
F(!Ar);++Lr
r.world_id=wr=e
Ke(wr)
T.setMulti({w:wr,wg:s})
var _=[]
Ze.startMain(true,function(){Dt(wr)
pe("world_joined",1,null,String(wr),{initial_wgid:s})
_t()
S(_,_=null)
S(Kr,Kr=null)})
Hr={}
Yr=false
r.world_channel=Ar=p().getChannel("world."+wr,true)
Ze.chat_ui.setChannel(Ar)
Or=true
Ar.on("channel_data",onWorldChannelData)
if(!Ar.hasListener("subscribe",handleSubscribe))Ar.onceSubscribe(handleSubscribe)
if(!Ar.hasListener("subscribe_fail",handleSubscribeFail))Ar.on("subscribe_fail",handleSubscribeFail)
We()
st()
sendGetUser(void 0,sameWorldGuard(function(e,t){if(e){if(Yr)return
return void f().onError(e)}t=t||{}
console.log("my user data for world."+wr,t)
var r=false
var a=fr()&&!pr()&&t.build_access_level>=ne
if(0===t.pos_adv&&a){l=true
s=getHomeWGID(t)}else if(a)s=void 0
if(n&&pr()){t.pos=n
worldRecordCurrentWGID(T.get("wg"))}else if(s){var i=Tr(s)
if(i&&i.flags&se&&(l||s!==t.wg)){r=true
t.pos=Oe(i)
worldRecordCurrentWGID(s)}else worldRecordCurrentWGID(T.get("wg"))}else if(t.wg){T.set("wg",t.wg)
worldRecordCurrentWGID(t.wg)}else worldRecordCurrentWGID(T.get("wg"))
Ot(t)
if(r)Ce()
var o=t.race_data
if(o)_.push(function(){if(yr()&&!yt()){if(!o.was_playing_as_viewer){o.was_playing_as_viewer=yt()
Ct("race_data",o)}St(true)}})
_.push(function(){if(p().isFirstSession())me("enter_first_world",1,null,null,{is_owner:t.access_level===oe,world_type:ur()?"un":"lf"})
Ze.char_controller.handleSoundscapeTags(true)})}))
Re(Ar)}function worldTargetGo(e){var t=e.wid,r=e.wgid,a=e.uid
if(!t)t=getWorldID()
if("info"===r){worldGoByURL(t,r)
return}var i=vr()&&t===getWorldID()
if(a&&i&&Ze.char_controller.followOrLookAtVisibleUser(a));else if(a){Ze.char_controller.setFollowUserOnLoad(a)
T.setMulti({w:"",wg:"",pos:"",u:a,action:"go"})
worldCommOnURLChange()}else if(!i)if(Ze.omp)worldGoByURL(t,r)
else joinWorld(t,null,r,true)
else{if(!r)r="default"
var o=Le(r,{})
if(o)Ze.chat_ui.addChatError(o)}}function worldChannelGuard(r){return function(e,t){if(Or||this!==Ar)return
r.call(this,e,t)}}function worldPerfAutoChannel(){if(Ar)return Ar.channel_id
var e=v()
if(e)return"client."+e
return null}function worldCommStartup(){ve(function(e){e.world_id=getWorldID()})
T.onChange(worldCommOnURLChange)
var t=p()
t.onLogin(function(){var e=m()
if(e)s("user_id",e)})
t.on("disconnect",function(){if(wr){br=Rr=true
Ze.returnToMainMenu()}})
t.on("connect",function(e){if(!t.logging_in)S(Dr,Dr=[])
F(!Ar)
if(Ee())Xe()})
t.on("login",function(){S(Dr,Dr=[])})
t.onChannelMsg("world","world_trans_apply",worldChannelGuard(onWorldTransApply))
t.onChannelMsg("world","world_spoiled",worldChannelGuard(onWorldSpoiled))
t.onChannelMsg("world","world_unspoiled",worldChannelGuard(onWorldUnspoiled))
t.onChannelMsg("world","world_unclaimed",worldChannelGuard(tr))
t.onChannelMsg("world","world_dig",worldChannelGuard(onWorldDig))
t.onChannelMsg("world","world_start_group_race",worldChannelGuard(onWorldStartGroupRace))
t.onChannelMsg("world","world_end_group_race",worldChannelGuard(onWorldEndGroupRace))
t.onChannelMsg("world","world_winner_group_race",worldChannelGuard(onWorldWinnerGroupRace))
t.onChannelMsg("world","world_unlocked_prop",worldChannelGuard(onWorldUnlockedProp))
t.onChannelMsg("world","token_gen",worldChannelGuard(rt.onTokenGen))
t.onChannelMsg("world","set_pos",worldChannelGuard(onWorldSetPos))
t.onChannelMsg("world","set_pos_wg",worldChannelGuard(onWorldSetPosWG))
t.onChannelMsg("world","set_access",worldChannelGuard(onWorldSetAccess))
t.onChannelMsg("world","inventory_needs_refresh",worldChannelGuard(onWorldInventoryNeedsRefresh))
t.onChannelMsg("world","eff_acc_list",worldChannelGuard(ar))
t.onChannelMsg("world","set_user_data",worldChannelGuard(onWorldSetUserData))
$e.init(t,worldChannelGuard)
E(worldPerfAutoChannel)}function leaveWorld(){_r(wr)
er();++Lr
F(Ar)
Dt()
pe("world_leave",1,null,String(wr))
bt()
ht()
Ne()
Ze.chat_ui.setChannel(null)
$e.reset(Ar)
ir()
p().unsubscribe(Ar.channel_id)
ge()
be()
Ar.removeListener("channel_data",onWorldChannelData)
r.world_channel=Ar=null
r.world_id=wr=null
Nr=null
mr()
Dr=[]
or()
Cr=[]
xr=[]
if(!worldAutoConnect())T.setMulti({w:"",wg:""})
s("modapi_cdata",0)}function worldCmdParse(r,a){Ar.cmdParse(r,function(e,t){if(e)Ze.chat_ui.addChatError(qe.$(qe.CHATERROR_RUNNING_COMMAND,r,e))
if(a)a(e,t)})}function myUserCmdParse(e,t){if(h())return void t("ERR_DISCONNECTED")
p().getMyUserChannel().cmdParse(e,t)}function myUserCmdParseWrap(r,a){if(h())return void Ze.chat_ui.addChatError(qe.$(qe.CHATERROR_RUNNING_COMMAND,r,qe.ERR_DISCONNECTED))
p().getMyUserChannel().cmdParse(r,function(e,t){if(e=e||!t&&qe.CHATERROR_EMPTY_RESPONSE)Ze.chat_ui.addChatError(qe.$(qe.CHATERROR_RUNNING_COMMAND,r,e))
else return void a(t)})}},{"../common/permissions.js":255,"../common/race_common.js":258,"../common/store_data.js":262,"../common/voxel_data_common.js":264,"../common/world_constants.js":267,"../common/world_trans.js":268,"../glov/client/abtest.js":288,"../glov/client/client_config":297,"../glov/client/cmds.js":298,"../glov/client/engine.js":305,"../glov/client/error_report.js":311,"../glov/client/fscreen.js":317,"../glov/client/input.js":326,"../glov/client/local_storage.js":329,"../glov/client/net.js":338,"../glov/client/perf.js":340,"../glov/client/ui.js":367,"../glov/client/urlhash.js":369,"../glov/common/util.js":400,"../glov/common/verify.js":401,"../glov/common/vmath.js":402,"./analytics.js":6,"./app_access.js":12,"./blueprint.js":28,"./build_mode.js":33,"./client_cmds.js":43,"./client_entities.js":44,"./continent_loader.js":47,"./editvolume_client.js":84,"./energy_well.js":85,"./fbinstant_worlds.js":96,"./huds.js":104,"./inventory.js":114,"./item_anims.js":116,"./item_unlock_ui.js":118,"./loading_custom":128,"./localization/localization":131,"./main.js":135,"./main_menu.js":136,"./megachunk_client.js":139,"./menu.js":140,"./mobs.js":145,"./party_ui":153,"./props.js":171,"./social_referral.js":190,"./status.js":193,"./tiles.js":199,"./tutorial.js":203,"./ui_util.js":205,"./user_data.js":208,"./user_party":211,"./voxel_chunk_manager.js":214,"./voxel_data.js":216,"./voxel_mesh.js":220,"./world_claims.js":225,"./world_comm_effective_access.js":227,"./world_get_chunk.js":228,"./world_info.js":229,"./world_metadata.js":235,assert:void 0}],227:[function(e,t,r){"use strict"
r.worldEffAccessGet=worldEffAccessGet
r.worldEffAccessGetSorted=worldEffAccessGetSorted
r.worldEffAccessUnsub=worldEffAccessUnsub
r.worldEffAccessOnList=worldEffAccessOnList
var a=e("assert")
var i=e("../glov/client/engine")
var o=i.addTickFunc
var n=i.removeTickFunc
var s=e("../glov/client/net").netDisconnected
var l=e("../glov/common/differ")
var _=l.diffApply
var c=l.diffPacketRead
var u=e("./world_comm").getWorldChannel
var d=false
var f=0
var v=true
var h
var p
function worldEffAccessTick(e){if(e>=f){f=0
worldEffAccessUnsub()}else f-=e}var m=false
function worldEffAccessGet(){if(!d){p={online:{},threshold:0}
o(worldEffAccessTick)
m=true
u().send("world_eff_acc_sub",null,function(e,t){m=false
if(!e){v=true
p=t}})
d=true}f=3e4
return p}function cmpEffAccess(e,t){var r=p.online[e]
var a=p.online[t]
if(r===a)return e<t?-1:1
if(r<0)if(a<0)return a-r
else return 1
else if(a<0)return-1
else return r-a}function worldEffAccessGetSorted(){worldEffAccessGet()
if(v)(h=Object.keys(p.online)).sort(cmpEffAccess)
return{sorted_users:h,online:p.online,threshold:p.threshold}}function worldEffAccessUnsub(){if(d){if(!s())u().send("world_eff_acc_unsub")
n(worldEffAccessTick)
d=false}}function worldEffAccessOnList(e){if(m)return
v=true
a(p)
var t=c(e)
_(p,t)}},{"../glov/client/engine":305,"../glov/client/net":338,"../glov/common/differ":382,"./world_comm":226,assert:void 0}],228:[function(e,t,r){"use strict"
r.worldGetChunkCancel=worldGetChunkCancel
r.worldGetChunk=worldGetChunk
var o=e("../glov/client/net").netDisconnected
var n=e("../glov/common/util").callEach
var s=e("./main").addBatchedSend
var a=e("./world_comm")
var i=a.whenConnected
var l=a.worldSend
var _=6
var c=[]
var u=false
var d=1
var f=0
function worldGetChunkCancel(){c=[];++d
f=0}function sendGetChunkBatch(a){var i=a.generation
if(i!==d||o())return n(a.cbs,null,"ERR_DISCONNECTED");++f
l("vd_get",a.chunk_ids,function(e,t){if(i!==d)return n(a.cbs,null,"ERR_DISCONNECTED");--f
for(var r=0;r<a.cbs.length;++r)a.cbs[r](e,t&&t[r])
if(!u&&c.length){u=true
s(getChunkQueueFlush)}})}function getChunkQueueFlush(){u=false
while(f<_&&c.length)sendGetChunkBatch(c.shift())}function worldGetChunk(t,r){i(function(){var e=c[c.length-1]
if(!e||e.chunk_ids.length>=32){e={generation:d,chunk_ids:[],cbs:[]}
c.push(e)}e.chunk_ids.push(t)
e.cbs.push(r)
if(!u){u=true
s(getChunkQueueFlush)}})}},{"../glov/client/net":338,"../glov/common/util":400,"./main":135,"./world_comm":226}],229:[function(e,t,r){"use strict"
r.isFullWorldInfo=isFullWorldInfo
r.isWorldInfo=isWorldInfo
r.worldInfoCacheClear=worldInfoCacheClear
r.worldInfoCacheClearForWorld=worldInfoCacheClearForWorld
r.getWorldInfoCached=getWorldInfoCached
r.getWorldInfoCachedIfNewer=getWorldInfoCachedIfNewer
r.getWorldInfo=getWorldInfo
r.getWorldInfoAsync=getWorldInfoAsync
var n=e("assert")
var a=e("glov-async").asyncLimiter
var i=e("../glov/client/net")
var s=i.netClient
var l=i.netDisconnected
var _=e("../glov/common/util").callEach
var o=e("../common/world_constants")
var c=o.WORLDINFO_LEVEL_ALL
var u=o.WORLDINFO_LEVEL_BASIC
var d=e("./world_comm").whenConnected
var f=e("./world_info_local_cache")
var v=f.worldInfoLocalCacheGet
var h=f.worldInfoLocalCacheUpdate
var p=a(1)
function isFullWorldInfo(e){return Boolean(e&&e.name)}function isWorldInfo(e){return Boolean(e&&!e.err)}var m={}
var E=6e4
var g=0
function worldInfoCacheClear(){m={}}var T=false
function getWorldInfoCache(e,t){var r=e=String(e)
if(T)r+=":"+(t?c:u)
var a=m[r]
if(!a)a=m[r]={err:null,data:v(e),timestamp:0,level:0,fetching:false,cbs:null}
return a}function worldInfoCacheClearForWorld(e){var t=e
if(T)t+=":"+u
var r=m[t]
if(r)if(r.fetching);else delete m[t]}function getWorldInfoCached(e,t){return getWorldInfoCache(e,t).data}function getWorldInfoCachedIfNewer(e,t,r){var a=e
var i=t?c:u
if(T)a+=":"+u
var o=m[a]
if(o&&o.timestamp&&o.level>=i)return o.data
return null}function getWorldInfo(a,e,t,r){var i=getWorldInfoCache(a,e)
var o=e?c:u
t=t||E
if(r){n(e)
i.cbs=i.cbs||[]
i.cbs.push(r)}if(i.fetching||l()&&!i.cbs)return i.data
if(Date.now()-i.timestamp<t&&i.level>=o){if(i.cbs)_(i.cbs,i.cbs=null,i.err,i.data)
return i.data}if(g&&!i.cbs)return i.data
i.fetching=true;++g
p(function(r){function done(e,t){--g
i.fetching=false
i.err=e
i.data=e?{err:e}:t
i.level=o
i.timestamp=Date.now()
if(i.cbs)if(o<c){getWorldInfo(a,true)
n(i.fetching)}else _(i.cbs,i.cbs=null,i.err,i.data)
r()}d(function(){if("all"===a)s().send("worldlist_get_all",null,null,function(e,t){done(e,t)})
else s().send("world_get_info",{world_id:a,level:o},null,function(e,t){done(e,t||null)
if(e||!t){h(a,null)
return}n(isWorldInfo(i.data))
h(a,t)})})})
return i.data}function getWorldInfoAsync(e,t){getWorldInfo(e,true,void 0,t)}},{"../common/world_constants":267,"../glov/client/net":338,"../glov/common/util":400,"./world_comm":226,"./world_info_local_cache":230,assert:void 0,"glov-async":void 0}],230:[function(e,t,r){"use strict"
r.worldInfoLocalCacheGet=worldInfoLocalCacheGet
r.worldInfoLocalCacheUpdate=worldInfoLocalCacheUpdate
var o=e("assert")
var _=e("../glov/client/engine")
var a=e("../glov/client/local_storage")
var n=a.localStorageGetJSON
var c=a.localStorageSetJSON
var u=100
var d=1e3
var f={name:true,waygates:true,world_type:true,seed:true,unlimited:true,gems:true,access_modify:true,user_access:true,trophy:true,owner:true,image:true,world_id:true,boost_count:true,frozen:true}
var v
function worldInfoLocalCacheGet(e){if(_.defines.NOWORLDLOCALCACHE)return null
if(!v){v={need_save:false,last_save:_.frame_timestamp,by_wid:{}}
var t=n("world_info_cache",[])
for(var r=0;r<t.length;++r){var a=t[r]
o(a.world_id)
v.by_wid[a.world_id]={used:_.frame_timestamp,world_info:a}}}var i=v.by_wid[e]
if(i){i.used=_.frame_timestamp
return i.world_info}return null}function worldInfoLocalCacheUpdate(e,t){if(!v)return
var r=v.by_wid
var a=r[e]
if(a)if(t){a.used=_.frame_timestamp
for(var i in f)if(a.world_info[i]!==t[i]){a.world_info[i]=t[i]
v.need_save=true}a.world_info.world_id=e}else{delete r[e]
v.need_save=true}else if(t){var o={}
for(var n in f)o[n]=t[n]
o.world_id=e
r[e]={used:_.frame_timestamp,world_info:o}
v.need_save=true}if(v.need_save&&_.frame_timestamp-v.last_save>d){v.last_save=_.frame_timestamp
var s=Object.keys(r)
s.sort(function(e,t){return r[t].used-r[e].used})
var l=(s=s.slice(0,u)).map(function(e){return r[e].world_info})
c("world_info_cache",l)}}},{"../glov/client/engine":305,"../glov/client/local_storage":329,assert:void 0}],231:[function(e,t,r){"use strict"
r.worldLink=worldLink
r.worldInfoViewInit=worldInfoViewInit
r.cmpWaygateInit=cmpWaygateInit
r.cmpWaygateID=cmpWaygateID
r.getSkyOptions=getSkyOptions
r.accessString=accessString
r.accessRank=accessRank
r.refreshUserInfo=refreshUserInfo
r.refreshUserAndAccessList=refreshUserAndAccessList
r.refreshWorldInfo=refreshWorldInfo
r.worldInfoModifyingAccess=worldInfoModifyingAccess
r.worldCmdParseGated=worldCmdParseGated
r.isWorldInfoContext=isWorldInfoContext
r.worldInfoGetContext=worldInfoGetContext
r.worldInfoGetUser=worldInfoGetUser
r.numberFormat=numberFormat
r.toggleLiked=toggleLiked
r.displayUserList=displayUserList
r.worldGetUserList=worldGetUserList
r.worldAdminLogHasNew=worldAdminLogHasNew
r.worldInfoShowEditMode=worldInfoShowEditMode
r.worldInfoShowAdminLog=worldInfoShowAdminLog
r.doWorldInfoView=doWorldInfoView
r.worldInfoViewStartup=worldInfoViewStartup
r.access_items_admin=r.access_items_owner=r.volume_access_items_for_volume_admin=r.volume_access_items_for_volume_owner=r.volume_access_items_for_world_admin=r.FLOATER_STYLE_ROLE_NO_OUTLINE=r.access_labels_for_volumes=r.access_labels=r.UserQueueState=void 0
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var Ke;(function(e){e[e["ACTIVE"]=0]="ACTIVE"
e[e["QUEUED"]=1]="QUEUED"
e[e["INACTIVE"]=2]="INACTIVE"
e[e["OFFLINE"]=3]="OFFLINE"})((r.UserQueueState=Ke)||(r.UserQueueState=Ke={}))
var qe=e("assert")
var i=e("./localization/localization")
var Ze=i.DURATION_DAYS
var Xe=i.DURATION_WITH_MINUTES
var Qe=i.L
var o=e("./styles")
var ae=o.chat_style_error
var n=o.floater_style_banned
var s=o.floater_style_banned_no_outline
var l=o.floater_style_default
var _=o.floater_style_default_no_outline
var c=o.floater_style_spectator
var u=o.floater_style_spectator_no_outline
var A=o.floater_style_sysadmin_no_outline
var d=o.floater_style_world_admin
var f=o.floater_style_world_admin_no_outline
var v=o.floater_style_world_owner
var h=o.floater_style_world_owner_no_outline
var $e=o.style_booster
var p={NONE:Qe.LBL_ACCESS_NONE_LONG,SPECTATOR:Qe.LBL_ACCESS_SPECTATOR_LONG,READONLY:Qe.LBL_ACCESS_READONLY_LONG,AREABUILDER:Qe.LBL_ACCESS_AREABUILDER_LONG,BUILDER:Qe.LBL_ACCESS_BUILDER_LONG,ADMIN:Qe.LBL_ACCESS_ADMIN_LONG,OWNER:Qe.LBL_ACCESS_OWNER}
r.access_labels=p
var m={READONLY:Qe.LBL_ACCESS_READONLY,BUILDER:Qe.LBL_ACCESS_BUILDER_LONG,ADMIN:Qe.LBL_ACCESS_ADMIN_LONG,OWNER:Qe.LBL_ACCESS_OWNER}
r.access_labels_for_volumes=m
var E={NONE:n,SPECTATOR:c,READONLY:l,AREABUILDER:l,BUILDER:l,ADMIN:d,OWNER:v}
var Je={NONE:s,SPECTATOR:u,READONLY:_,AREABUILDER:_,BUILDER:_,ADMIN:f,FROZEN_OWNER:h,OWNER:h}
r.FLOATER_STYLE_ROLE_NO_OUTLINE=Je
var g=[{name:Qe.LBL_ACCESS_DEFAULT,tag:"DEFAULT"},{name:Qe.LBL_ACCESS_READONLY,tag:"READONLY"},{name:Qe.LBL_ACCESS_BUILDER,tag:"BUILDER"},{name:Qe.LBL_ACCESS_ADMIN,tag:"ADMIN"},{name:Qe.LBL_ACCESS_OWNER,tag:"OWNER"}]
var T=(r.volume_access_items_for_world_admin=g).slice(0,-1)
var y=(r.volume_access_items_for_volume_owner=T).slice(0,-1)
r.volume_access_items_for_volume_admin=y
var S=[{name:Qe.LBL_ACCESS_DEFAULT,tag:"DEFAULT"},{name:Qe.LBL_ACCESS_NONE_BAN,tag:"NONE"},{name:Qe.LBL_ACCESS_SPECTATOR,tag:"SPECTATOR"},{name:Qe.LBL_ACCESS_READONLY,tag:"READONLY"},{name:Qe.LBL_ACCESS_AREABUILDER,tag:"AREABUILDER"},{name:Qe.LBL_ACCESS_BUILDER,tag:"BUILDER"},{name:Qe.LBL_ACCESS_ADMIN,tag:"ADMIN"}]
var I=(r.access_items_owner=S).slice(0,-1);[g,T,y,S,r.access_items_admin=I].forEach(function(e){for(var t in e){var r=e[t].tag
if("DEFAULT"!==r)e[t].style=E[r]}})
var w="private"
var L="public_spectator"
var O="public_readonly"
var R="public_limited"
var b="public_builder"
var et=[{name:Qe.LBL_ACCESS_PRESET_PRIVATE,name_long:Qe.LBL_ACCESS_PRESET_PRIVATE_LONG,tag:w},{name:Qe.LBL_ACCESS_PRESET_SPECTATE,tag:L},{name:Qe.LBL_ACCESS_PRESET_VISIT,tag:O},{name:Qe.LBL_ACCESS_PRESET_AREA_BUILD,tag:R},{name:Qe.LBL_ACCESS_PRESET_BUILD_ANYWHERE,tag:b}]
var N=et
var C=e("glov-async").asyncSeries
var x=e("../glov/client/animation").animationSequencerCreate
var tt=e("../glov/client/auto_reset").autoResetSkippedFrames
var M=e("../glov/client/collapsagories")
var me=M.collapsagoriesHeader
var Ee=M.collapsagoriesStart
var ge=M.collapsagoriesStop
var rt=e("../glov/client/engine")
var Te=e("../glov/client/engine").getFrameDt
var at=e("../glov/client/font").ALIGN
var it=e("../glov/client/input")
var D=e("../glov/client/input")
var ye=D.eatAllInput
var ot=D.inputClick
var Se=e("../glov/client/link").linkText
var P=e("../glov/client/localization").getStringFromLocalizable
var B=e("../glov/client/markdown")
var Ie=B.markdownAuto
var k=B.markdownLabel
var U=e("../glov/client/net")
var G=U.netClient
var F=U.netSubs
var nt=e("../glov/client/scroll_area").scrollAreaCreate
var W=e("../glov/client/selection_box").dropDownCreate
var H=e("../glov/client/social")
var st=H.friendsGet
var lt=H.isFriend
var z=e("../glov/client/sprites")
var V=z.spriteClipPause
var Y=z.spriteClipResume
var j=z.spriteClipped
var _t=z.spriteCreate
var K=e("../glov/client/ui")
var ct=K.buttonImage
var q=K.buttonShared
var ut=K.buttonText
var X=K.buttonWasFocused
var Q=K.drawLine
var $=K.drawRect
var dt=K.label
var Ae=K.modalDialog
var J=K.modalTextEntry
var ft=K.provideUserString
var ie=K.uiButtonHeight
var vt=K.uiTextHeight
var ht=e("../glov/client/ui")
var pt=e("../glov/client/walltime")
var ee=e("../glov/common/dot-prop").dotPropGet
var te=e("../glov/common/util")
var re=te.clamp
var oe=te.dateToSafeLocaleString
var we=te.nop
var ne=te.secondsToFriendlyString
var se=te.ss2020ToMS
var le=e("../common/blueprint_common").bid_valid_readonly_regex
var _e=e("../common/effective_access").EFFECTIVE_ACCESS_SPECTATOR
var ce=e("../common/photo_common")
var mt=ce.PHOTO_ASPECT
var ue=ce.photo_id_valid_regex
var de=e("../common/roles_common").classifyRole
var fe=e("../common/waygate_common")
var ve=fe.WAYGATE_MAX_VISUAL_SIZE
var he=fe.WAYGATE_NAME_LEN
var pe=e("../common/world_constants")
var Le=pe.ACCESS_ADMIN
var Oe=pe.ACCESS_AREA_BUILDER
var Re=pe.ACCESS_AREA_BUILDER_BOOSTER
var be=pe.ACCESS_BUILDER
var Ne=pe.ACCESS_BUILDER_BOOSTER
var Ce=pe.ACCESS_FROM_STRING
var xe=pe.ACCESS_NONE_HIGH
var Me=pe.ACCESS_OWNER
var De=pe.ACCESS_READONLY
var Pe=pe.ACCESS_READONLY_BOOSTER
var Be=pe.ACCESS_SPECTATOR
var ke=pe.ACCESS_SPECTATOR_BOOSTER
var Ue=pe.ACCESS_TO_STRING
var Ge=pe.BOOST_MAX_LEVEL
var Fe=pe.BOOST_PERKS
var We=pe.CHAT_COOLDOWN_MAXIMUM
var He=pe.CHAT_COOLDOWN_MINIMUM
var ze=pe.DEFAULT_ACCESS_GIVE_ADVENTURE
var Ve=pe.DEFAULT_ACCESS_GIVE_UNLIMITED
var Ye=pe.DEFAULT_ACCESS_LEAPGATE
var je=pe.DEFAULT_ACCESS_SAPLING
var Et=pe.DEFAULT_ACCESS_UNLIMITED_ITEMS_ADVENTURE
var gt=pe.DEFAULT_ACCESS_UNLIMITED_ITEMS_UNLIMITED
var Tt=pe.DEFAULT_TOOL_LOCK_ADVENTURE
var yt=pe.DEFAULT_TOOL_LOCK_UNLIMITED
var St=pe.USER_LIMIT_MAX_BUILDER
var It=pe.WAYGATE_FLAG_LISTED
var At=pe.WORLD_ACCESS_MODIFY_BUILDER
var wt=pe.WORLD_ACCESS_MODIFY_LIMITED
var Lt=pe.WORLD_ACCESS_NONE
var Ot=e("./analytics")
var Rt=Ot.itemFlowEvent
var bt=Ot.logEvent
var Nt=Ot.logEventOnce
var Ct=e("./blueprint").blueprintGetDef
var xt=e("./boost_view")
var Mt=xt.worldBoostWidget
var Dt=xt.worldBoostable
var Pt=e("./build_mode")
var Bt=Pt.doDurability
var kt=Pt.doStamina
var Ut=e("./inventory").inventoryGetNames
var Gt=e("./layout").layoutWide
var Ft=e("./link_parse")
var Wt=Ft.linkParseBlueprint
var Ht=Ft.linkParsePhoto
var zt=e("./loading_custom")
var Vt=zt.bgimgFromWorldInfo
var Yt=zt.loadingCustomDrawNow
var jt=zt.loadingCustomPreload
var Kt=zt.loadingCustomTempOverride
var qt=e("./main")
var Zt=e("./main").returnToMainMenu
var Xt=e("./main_menu")
var Qt=Xt.drawBG
var $t=Xt.mainMenuBgSet
var Jt=e("./menu")
var er=Jt.isQuickMenu
var tr=Jt.menuDoTransition
var rr=Jt.menuX1
var ar=Jt.menuY1
var ir=e("./photo_ui")
var or=ir.PHOTO_INVALID
var nr=ir.PHOTO_LOADING
var sr=ir.photoInfoGet
var lr=e("./platform_worlds_client").PLATFORM_DISCORD
var _r=e("./race_results")
var cr=_r.doResultList
var ur=_r.prepareResultsList
var dr=e("./race_ui").raceReady
var fr=e("./settlement").isSettlement
var vr=e("./sharing/platform_share_handlers")
var hr=vr.shareWorld
var pr=vr.shareWorldLink
var mr=vr.sharingLinksEnabled
var Er=vr.sharingWorldEnabled
var gr=e("./sky")
var Tr=gr.calcTimeOffsetForNewScale
var yr=gr.skyAllowAnyThisFrame
var Sr=e("./status")
var Ir=e("./stuck")
var Ar=Ir.unstuck
var wr=Ir.unstuckBlocked
var Lr=e("./styles")
var Or=Lr.color_gray80
var Rr=Lr.color_green
var br=Lr.color_line
var Nr=Lr.color_user_alternate
var Cr=Lr.color_user_over
var xr=Lr.color_user_viewing
var Mr=Lr.color_white
var Dr=Lr.colors_green
var Pr=Lr.label_disabled_style
var Br=Lr.label_style
var kr=Lr.label_warning_style
var Ur=Lr.loading_style
var Gr=Lr.menu_header_style
var Fr=Lr.style_gems
var Wr=Lr.style_log_commands
var Hr=Lr.style_log_waygates
var zr=Lr.sublabel_style
var Vr=e("./ui_util")
var Yr=e("./user_data")
var jr=Yr.doWaygateSickness
var Kr=Yr.isPlayAsViewer
var qr=Yr.playAsViewerSet
var Zr=Yr.userDataGet
var Xr=Yr.userDataIsWaiting
var Qr=Yr.userDataPredict
var $r=Yr.userHomeSettlementID
var Jr=Yr.userLastWaygateTime
var ea=Yr.viewSettlementAllowed
var ta=Yr.waygateEditAllowed
var ra=Yr.worldReadOnly
var aa=Yr.worldReadOnlyBypassPlayingAs
var ia=e("./user_info_view")
var oa=ia.rolesIsWorldsTeam
var na=ia.userInfoGet
var sa=ia.userInfoViewing
var la=ia.userProfileButton
var _a=ia.viewUser
var ca=e("./user_party").partyFormatDisplayName
var ua=e("./user_profile_view").userProfileViewInvalidateWorldList
var da=e("./wallet_ui").walletAnimateIncrease
var fa=e("./waygate_ui")
var va=fa.calcWGLinkWidth
var ha=fa.waygateEditRemote
var pa=fa.waygateLinkUI
var ma=e("./waygate_upgrade").WAYGATE_SAFE_TIME
var Ea=e("./world_comm")
var ga=Ea.getOrbBalance
var Ta=Ea.getPerm
var ya=Ea.getWorldChannel
var Sa=Ea.getWorldID
var Ia=Ea.whenConnected
var Aa=Ea.worldCmdParse
var wa=Ea.worldGetClients
var La=Ea.worldGetRoles
var Oa=Ea.worldGoByURL
var Ra=Ea.worldPak
var ba=Ea.worldTargetGo
var Na=e("./world_comm_effective_access").worldEffAccessGetSorted
var Ca=e("./world_info")
var xa=Ca.getWorldInfo
var Ma=Ca.isFullWorldInfo
var Da=e("./world_management")
var Pa=Da.deleteWorld
var Ba=Da.forgetWorld
var ka=Da.isDoingWorldOp
var Ua=e("./world_metadata")
var Ga=Ua.adventureMode
var Fa=Ua.worldAccessDefault
var Wa=Ua.worldBoostPerk
var Ha=Ua.worldBoostRewards
var za=Ua.worldBoosters
var Va=Ua.worldEnergy
var Ya=Ua.worldMetadata
var ja=Ua.worldMetadataFreePos
var Ka=Ua.worldOwnerID
var qa=Ua.worldRaceAsVisitor
var Za=Ua.worldSettlements
var Xa=e("./worlds_sound").playSound
var Qa=Math.abs,$a=Math.ceil,Ja=Math.floor,ei=Math.max,ti=Math.min,ri=Math.round
var ai
var ii
var oi
var ni=false
var si
var li=null
var _i=false
function userDataIsLoaded(e){return Boolean(e&&!_i)}function worldLink(e,t){return"w/"+e+(!t||"default"===t?"":"/"+t)}var ci
var ui
function worldInfoViewInit(e){if(e){qe("string"===typeof e)
ui=e}else ui=""
ci=si=oi=null}function isRecentWorld(e){var t
if(F().loggedIn()&&G().connected){var r=F().getMyUserChannel()
t=r.data&&r.data.public}if(!t)t={}
var a=t.recent||{}
return Boolean(a[e])}var di
var fi
function cmpWaygateInit(e,t){fi=e
di=t}function cmpWaygateID(e,t){if(e===di)return-1
else if(t===di)return 1
if("default"===e)return-1
else if("default"===t)return 1
var r=fi[e]
var a=fi[t]
var i=r&&r.flags&It||0
var o=(a&&a.flags&It||0)-i
if(o)return o
var n=Number(e)
var s=Number(t)
if(isFinite(n)){if(isFinite(s))return n-s
return 1}else if(isFinite(s))return-1
return e<t?-1:1}var vi=[{name:Qe.LBL_ACCESS_SPECTATOR_ANYONE,tag:"SPECTATOR",level:Be},{name:Qe.LBL_ACCESS_SPECTATOR_BOOSTER_PLURAL,tag:"SPECTATORBOOSTER",level:ke},{name:Qe.LBL_ACCESS_READONLY_BOOSTER_PLURAL,tag:"READONLYBOOSTER",level:Pe},{name:Qe.LBL_ACCESS_AREABUILDERS,tag:"AREABUILDER",level:Oe},{name:Qe.LBL_ACCESS_AREABUILDER_BOOSTER_PLURAL,tag:"AREABUILDERBOOSTER",level:Re},{name:Qe.LBL_ACCESS_BUILDERS,tag:"BUILDER",level:be},{name:Qe.LBL_ACCESS_BUILDER_BOOSTER_PLURAL,tag:"BUILDERBOOSTER",level:Ne},{name:Qe.LBL_ACCESS_ADMINS,tag:"ADMIN",level:Le},{name:Qe.LBL_ACCESS_OWNER,tag:"OWNER",level:Me},{name:Qe.LBL_ACCESS_NONE_NOBODY,tag:"NONE",level:xe}]
var hi=[{name:Qe.LBL_ACCESS_SPECTATOR_ANYONE,tag:"SPECTATOR",level:Be},{name:Qe.LBL_ACCESS_SPECTATOR_BOOSTER_PLURAL,tag:"SPECTATORBOOSTER",level:ke},{name:Qe.LBL_ACCESS_READONLY_PLURAL,tag:"READONLY",level:De},{name:Qe.LBL_ACCESS_READONLY_BOOSTER_PLURAL,tag:"READONLYBOOSTER",level:Pe},{name:Qe.LBL_ACCESS_AREABUILDERS,tag:"AREABUILDER",level:Oe},{name:Qe.LBL_ACCESS_AREABUILDER_BOOSTER_PLURAL,tag:"AREABUILDERBOOSTER",level:Re},{name:Qe.LBL_ACCESS_BUILDERS,tag:"BUILDER",level:be},{name:Qe.LBL_ACCESS_BUILDER_BOOSTER_PLURAL,tag:"BUILDERBOOSTER",level:Ne},{name:Qe.LBL_ACCESS_ADMINS,tag:"ADMIN",level:Le}]
var pi=[{name:Qe.LBL_DISABLED,tag:"0",value:0},{name:Qe.duration(600),tag:"10",value:10},{name:Qe.duration(3600),tag:"60",value:60},{name:Qe.duration(86400),tag:"1440",value:1440}]
var mi=[{name:Qe.LBL_ACCESS_AREABUILDERS,tag:"AREABUILDER",level:Oe},{name:Qe.LBL_ACCESS_AREABUILDER_BOOSTER_PLURAL,tag:"AREABUILDERBOOSTER",level:Re},{name:Qe.LBL_ACCESS_BUILDERS,tag:"BUILDER",level:be},{name:Qe.LBL_ACCESS_BUILDER_BOOSTER_PLURAL,tag:"BUILDERBOOSTER",level:Ne},{name:Qe.LBL_ACCESS_ADMINS,tag:"ADMIN",level:Le},{name:Qe.LBL_ACCESS_OWNER,tag:"OWNER",level:Me},{name:Qe.LBL_ACCESS_NONE_NOBODY,tag:"NONE",level:xe}]
var Ei
var gi
var Ti=[{name:Qe.LBL_USER_DISTANCE_NEAR,tag:"240",value:240},{name:Qe.LBL_USER_DISTANCE_MEDIUM,tag:"480",value:480},{name:Qe.LBL_USER_DISTANCE_FAR,tag:"960",value:960},{name:Qe.LBL_USER_DISTANCE_UNLIMITED,tag:"0",value:0}]
var yi=[{name:Qe.LBL_BOOSTER_ICON0,tag:"0",value:0},{name:Qe.LBL_BOOSTER_ICON1,tag:"1",value:1},{name:Qe.LBL_BOOSTER_ICON2,tag:"2",value:2},{name:Qe.LBL_BOOSTER_ICON3,tag:"3",value:3},{name:Qe.LBL_BOOSTER_ICON4,tag:"4",value:4},{name:Qe.LBL_BOOSTER_ICON5,tag:"5",value:5},{name:Qe.LBL_BOOSTER_ICON6,tag:"6",value:6}]
var Si=[{name:Qe.LBL_TIME_DYNAMIC,tag:"-1",value:-1},{name:Qe.LBL_TIME_DYNAMIC_10X,tag:"-10",value:-10},{name:Qe.LBL_TIME_DYNAMIC_50X,tag:"-50",value:-50},{name:Qe.LBL_TIME_MIDNIGHT,tag:"0",value:0},{name:Qe.LBL_TIME_DAWN,tag:"5.7",value:5.7},{name:Qe.LBL_TIME_MORNING,tag:"10",value:10},{name:Qe.LBL_TIME_NOON,tag:"12",value:12},{name:Qe.LBL_TIME_AFTERNOON,tag:"17",value:17},{name:Qe.LBL_TIME_DUSK,tag:"20.2",value:20.2}]
var Ii
function getSkyOptions(){if(!Ii){Ii=[{name:Qe.LBL_DEFAULT,tag:"default"}]
var o=Fe[Ge].skies
var e=function _loop(e){var t=o[e]
var r=Ge
for(var a=0;a<Ge;++a)if(Fe[a].skies.includes(t)){r=a
break}var i=Qe.get("LBL_SKY_"+t.toUpperCase())
qe(i,t)
if(r>0)i=Qe.reactive(function(e){return e+"[img=boost"+r+"]"}.bind(null,i))
Ii.push({name:i,tag:t})}
for(var t=0;t<o.length;++t)e(t)}return Ii}var Ai=[{name:Qe.LBL_OFF,tag:"0",value:0},{name:Qe.LBL_ON,tag:"1",value:1}]
var wi=[{name:Qe.LBL_LISTED_UNLISTED,tag:"0",value:0},{name:Qe.LBL_LISTED_LISTED,tag:"1",value:1}]
var Li=[{name:Qe.LBL_BUILD_QUEUE_FORCE_UI_OFF,tag:"0",value:0},{name:Qe.LBL_BUILD_QUEUE_FORCE_UI_ON,tag:"1",value:1}]
var Oi=[{name:Qe.LBL_ACCESS_READONLY,tag:"0",value:0},{name:Qe.LBL_ACCESS_SPECTATOR,tag:"1",value:1}]
var Ri=[{name:Qe.LBL_BUILD_QUEUE_AUTOMATIC_OFF,tag:"0",value:1},{name:Qe.LBL_BUILD_QUEUE_AUTOMATIC_ON,tag:"1",value:0}]
var bi=[{name:Qe.LBL_OFF,tag:"0",value:1},{name:Qe.LBL_ON,tag:"1",value:0}]
var Ni=[{name:Qe.LBL_WORLD_TOOL_LOCK_ANY,tag:"0",value:0},{name:Qe.MAT_REGULAR_NAME,tag:"1",value:1},{name:Qe.MAT_FAST_NAME,tag:"2",value:2},{name:Qe.MAT_SUPER_NAME,tag:"3",value:3},{name:Qe.LBL_WORLD_TOOL_LOCK_CRAFTED,tag:"4",value:4}]
function accessString(e){return Ue[e]||"InvalidAccess"+e}var Ci=_extends({},Ce,{FROZEN_OWNER:Le-1,UNKNOWN:999})
function accessRank(e){var t=Ci[e]
return void 0===t?Ci.UNKNOWN:t}var xi={NONE:Qe.LBL_ACCESS_NONE.lower(),SPECTATOR:Qe.LBL_ACCESS_SPECTATOR.lower(),READONLY:Qe.LBL_ACCESS_READONLY.lower(),AREABUILDER:Qe.LBL_ACCESS_AREABUILDER.lower(),BUILDER:Qe.LBL_ACCESS_BUILDER.lower(),ADMIN:Qe.LBL_ACCESS_ADMIN.lower(),FROZEN_OWNER:Qe.LBL_ACCESS_OWNER_CREATOR.lower(),OWNER:Qe.LBL_ACCESS_OWNER.lower()}
var Mi=Qe.reactive(function(){var e=""
for(var t in xi){var r=xi[t].toString()
if(r.length>e.length)e=r}return Qe.FORMAT_ROLE_DISPLAY.$({role:e,img:"WW"}).toLocalString()})
function refreshUserInfo(){if(!si)return
var i=si
_i=true
Ia(function(){if(!ya()){_i=false
return}var e=Ra("get_access")
e.writeAnsiString(i)
e.send(function(e,t){_i=false
if(e)return void qt.chat_ui.addChatError(e)
var r=t.readInt()
var a=t.readAnsiString()
if(i!==si)return
qe(li)
qe(userDataIsLoaded(li))
li.access_from_default=Boolean(r)
li.access=a
li.rank=accessRank(a)})})}var Di=false
function refreshAccessList(){Di=true
Ia(function(){if(!ya()){Di=false
return}Ra("get_access_list").send(function(e,t){Di=false
if(e)return void qt.chat_ui.addChatError(e)
t.readAnsiString()
var r=t.readJSON()
t.readInt()
t.readInt()
ci={access_map:r}})})}function refreshUserAndAccessList(){refreshUserInfo()
refreshAccessList()}var Pi=false
var Bi=false
function refreshWorldInfo(){xa(ui,Pi=true,1,function(){Pi=false
ua()})}function worldInfoModifyingAccess(){return Pi}function worldCmdParseGated(e,t){qe(t)
if(!ya()){Ae({title:Qe.DLG_ERR_LOST_CONNECTION_TITLE,text:Qe.DLG_ERR_LOST_CONNECTION_MSG,buttons:{OK:null}})
return}Pi=true
Aa(e,function(e){Pi=false
ua()
if(e)Ae({title:Qe.DLG_ERR_MODIFYING_WORLD_TITLE,text:e,buttons:{OK:null}})
t(e)})}function cmpUserElem(e,t){if(e.state!==t.state)return e.state-t.state
if(e.ordinal!==t.ordinal){qe(e.ordinal&&t.ordinal)
return e.ordinal-t.ordinal}return t.rank-e.rank}function isWorldInfoContext(e){return Boolean(e.world_info)}function worldInfoGetContext(e){if(!e)return{}
var t=xa(e,true,3e3)
if(!t)return{}
var r=t.owner,a=t.frozen
var i=Boolean(!a&&r&&r.user_id===F().loggedIn())
var o=Boolean(a&&r&&r.user_id===F().loggedIn())
var n=false
var s=0
if(e===Sa()){s=(n=La().world_admin)?accessRank(de(La(),false)):0
if(n&&!ci&&!Di)refreshAccessList()}return{world_info:t,am_admin:n,frozen:Boolean(a),mine:i,mine_frozen:o,my_role_rank:s}}function worldInfoSelectUser(e,t){li={display_name:ca(si=e,t),rank:Ci.UNKNOWN}
refreshUserInfo()}function worldInfoGetUser(e,t,r){var a=Di
if(!e.am_admin)return{loading:a,allow_actions:false}
if(t!==si)worldInfoSelectUser(t,r)
a=a||_i||Pi
var i=false
var o
var n
if(userDataIsLoaded(li)){i=e.my_role_rank>li.rank
var s=li
o=s.access
n=s.access_from_default}return{loading:a,allow_actions:i,access:o,access_from_default:n}}function numberFormat(e){if(e<1e3)return String(e)
if((e/=1e3)<99.9)return Qe.$(Qe.FORMAT_NUMBER_THOUSAND,e.toFixed(1))
else if(e<999)return Qe.$(Qe.FORMAT_NUMBER_THOUSAND,e.toFixed(0))
return Qe.$(Qe.FORMAT_NUMBER_MILLION,(e/=1e3).toFixed(1))}function toggleLiked(e){var t=Zr("liked")?0:1
Qr("liked",t,true)
if(t)e.like=(e.like||0)+1
else if(e.like)e.like--
Ia(function(){if(!ya())return
Aa("world_like "+t)})}function exitMenuAndGo(e,t){qt.menuExit()
ba({wid:e,wgid:t})}function promptWaygateSickness(e){Ae({title:Qe.DLG_WG_TRAVEL_UNSAFE_TITLE,text:Qe.$(Qe.DLG_WG_TRAVEL_UNSAFE_MSG,Vr.STAMINA_SYMBOL),buttons:{yes:e,no:null}})}function promptWaygateGroupRaceCancel(e){Ae({title:Qe.DLG_WG_TRAVEL_NOT_ALLOWED_TITLE,text:Qe.DLG_WG_TRAVEL_NOT_ALLOWED_MSG,buttons:{yes:e,no:null}})}function lineSep(e,t,r){Q(e-40,t,e+40,t,r+.1,2,1,br)
return 8}var ki=120
var Ui=3*ki
var Gi=48
var Fi=.75*Gi
function worldInfoToAccessPreset(e){var t=e.access_modify,r=e.access_public,a=e.access_viewer
if(r)if(t>=At)return b
else if(t>=wt)return R
else if(a)return O
else return L
else return w}function itemIndex(e,t){for(var r=0;r<e.length;++r)if(e[r].tag===t)return r
return 0}function confirmWorldPrivate(e){var t=[]
for(var r in za()){if(r===Ka())continue
if(ci&&ci.access_map&&ci.access_map[r])continue
var a=r
var i=na(r)
if(i.display_name)a=i.display_name
if(a.toLowerCase()!==r)t.push(String(Qe.addParenthesesAfter(r,a)))
else t.push(a)}if(!t.length)return e()
if(t.length>8){var o=t.length-7;(t=t.slice(0,7)).push(Qe.SETTLEMENT_OTHER.$({val:o}))}Ae({title:Qe.DLG_PRIVATE_BOOSTER_TITLE,text:Qe.DLG_PRIVATE_BOOSTER_MSG_1+"\n  "+t.join(", ")+"\n\n"+Qe.DLG_BAN_BOOSTER_MSG_1+"\n\n"+Qe.DLG_PRIVATE_BOOSTER_MSG_2+"\n\n"+Qe.DLG_PRIVATE_BOOSTER_MSG_3.$({count:t.length}),buttons:{yes:e,cancel:e.bind(null,"canceled")}})}var Wi=false
var Hi=Ui
function doAccessDropdown(e,t,r,a,i,o){var n=e.access_modify,s=e.access_public,l=e.access_viewer
var _=e.unlimited?et:N
if(!t)t=W({z:Z.UI,width:Hi,auto_reset:false,entry_height:Gi,display:o})
if(!Pi&&!t.isDropdownVisible()){var c=worldInfoToAccessPreset(e)
t.setSelected(c)}t.run({x:r,y:a,width:i||Hi,items:_,disabled:Pi})
if(t.isDropdownVisible())Wi=true
if(t.wasClicked()&&!Pi){var u=t.getSelected().tag
var d=[]
var f=u===w===Boolean(s)
switch(u){case w:if(f)d.push(confirmWorldPrivate)
break
case L:if(n!==Lt||l)d.push(worldCmdParseGated.bind(null,"world_access default SPECTATOR"))
break
case O:if(n!==Lt||!l||f)d.push(worldCmdParseGated.bind(null,"world_access default READONLY"))
break
case R:if(n!==wt)d.push(worldCmdParseGated.bind(null,"world_access default AREABUILDER"))
break
case b:if(n!==At)d.push(worldCmdParseGated.bind(null,"world_access default BUILDER"))}if(f)d.push(worldCmdParseGated.bind(null,"world_public "+(u===w?0:1)))
d.push(refreshWorldInfo)
C(d,we)}return t}function findCurrentByLevel(e,t,r){var a=Ya()
qe(a)
var i=a[e]
if(void 0===i){qe("number"===typeof t)
i=t}var o=0
for(var n=0;n<r.length;++n)if(i>=r[n].level)o=n
return o}function findCurrentByField(e,t,r,a,i){var o=ee(Ya(),e,r)
var n=-1
for(var s=0;s<a.length;++s)if(o===a[s][t])n=s
if(-1===n){if(!a[a.length-1].is_custom)a.push({name:Qe.$(Qe.LBL_CUSTOM_SETTING,o),tag:o,is_custom:true})
else if(a[a.length-1].tag!==o){a[a.length-1].name=Qe.$(Qe.LBL_CUSTOM_SETTING,o)
a[a.length-1].tag=o}i.applyParams({items:a})
n=a.length-1}return n}function getCurrentByField(e,t,r){for(var a=0;a<t.length;++a){var i=t[a]
if(r===i.tag)return i[e]}return null}function setCurrentByField(e,t,r,a,i,o){var n=ee(Ya(),e,r)
var s=getCurrentByField(t,a,o)
qe(null!==s)
if(s!==n)worldCmdParseGated(i+" "+o,refreshWorldInfo)}function setCurrentByCallback(e,t,r,a,i,o){var n=ee(Ya(),e,r)
var s=getCurrentByField(t,a,o)
qe(null!==s)
if(s!==n)i(o)}var zi={}
function lazyDropdownInternal(e,t,r,a,i,o,n,s,l){var _=zi[e]
if(_){qe(_.frame!==rt.frame_index)
_.frame=rt.frame_index}else _=zi[e]={frame:rt.frame_index,selbox:W({display:{use_markdown:true},items:o,z:Z.UI,width:Ui,auto_reset:false,entry_height:Gi,line_height:Fi})}
var c=_.selbox
k({font_style:Br,x:t-8-3.5*ki,y:r,w:3.5*ki,h:Gi,line_height:Fi,align:at.VCENTER|at.HRIGHT|at.HFIT,text:a,tooltip:i})
if(!(Pi&&!Bi)&&!c.isDropdownVisible()){var u=n(o,c)
c.setSelected(u)}if(c.isDropdownVisible())Wi=true
c.run({x:t,y:r,disabled:Pi||l})
if(c.wasClicked()&&!Pi){var d=c.getSelected().tag
qe(d)
s(d)}}var Vi=null
var Yi=null
var ji=null
var Ki=[0,0]
function startScrollArea(e,t,r,a){if(e.last_frame!==rt.frame_index-1)if(e.value)e.value.resetScroll()
e.last_frame=rt.frame_index
if(!e.value)e.value=nt(t)
e.value.begin(a)
qe(!Vi&&!Yi&&!ji)
Vi=r
Yi=a
var i=(ji=e.value).getScrollPos()
Ki[0]=i
Ki[1]=Ki[0]+Yi.h
if(e.last_scroll_pos!==i){ht.suppressNewDOMElemWarnings()
e.last_scroll_pos=i}return 0}function finishScrollArea(e,t){e.value.end(t)
qe(Vi&&Yi)
qe(ji===e.value)
var r=Vi+Yi.h
ji=Yi=Vi=null
return r}var qi=4
var Zi=8
var Xi=16
function displayUser(e,t,r,a){var i=e.user_id,o=e.display_name,n=e.role,s=e.style,l=e.is_booster
var _=t.x,c=t.y,u=t.w,d=t.z,f=t.font_height,v=t.row_h
var h=(v-f)/2
var p=_
var m=_+u/2
var E=c
if(!o){var g=na(i)
if(g)o=g.display_name}c+=qi
_+=Zi
ai.drawSizedAligned(s,_,c+h,d+1,f,at.HRIGHT|at.HFIT,m-_-Xi,0,o||i)
var T=xi[n]||(l?"":"?")
Ie({font_style:s,x:m,y:c+h,z:d+1,text_height:f,align:at.HLEFT|at.HFIT,w:r,text:T?Qe.FORMAT_ROLE_DISPLAY.$({role:T,img:l?"[img=booster]":""}):l?"[img=booster]":""})
_=m+r+4
var y=Boolean(la({user_id:i,show_online_status:false,x:_,y:c,z:d+1,w:v,h:v}))
c+=v+qi
var S=X()
if(q({x:p,y:E,w:u,h:c-E,pad_focusable:false,rollover_quiet:sa(i)}).ret)y=true
S=S||X()
if(y)_a({x:m,y:c,user_id:i})
if(1&a||S||sa(i))$(p,E,u,c,d-.5,sa(i)?xr:S?Cr:Nr)}function displayUserList(e){var t=ai.getStringWidth(Br,e.font_height,Mi)
t=ti(t,e.w/2-e.row_h-20)
var r=e.y
var a=e.list,i=e.draw_header
a.sort(cmpUserElem)
var o=null
for(var n=0;n<a.length;++n){var s=a[n]
if(s.state!==o)i(e,o=s.state)
displayUser(s,e,t,n)
e.y+=e.row_h+2*qi}return e.y-r}function renameWorld(e){J({edit_text:e,title:Qe.LBL_WORLD_NAME,text:Qe.DLG_WORLD_NAME_MSG,max_len:he,max_visual_size:ve,buttons:{ok:function ok(e){worldCmdParseGated("world_name "+(e.trim()||Qe.LBL_NEW_WORLD),refreshWorldInfo)},cancel:null}})}function changeChatCooldown(e){J({edit_text:""+e,title:Qe.LBL_CHAT_SLOW_MODE_COOLDOWN,text:Qe.DLG_NEW_VALUE_SECONDS_MSG.$({min:He,max:We}),max_len:3,buttons:{ok:function ok(e){worldCmdParseGated("world_chat_cooldown "+e,refreshWorldInfo)},cancel:null}})}function changeBuildQueueThreshold(e){J({edit_text:""+e,title:Qe.LBL_BUILD_QUEUE_THRESHOLD,text:Qe.DLG_BUILD_QUEUE_THRESHOLD_MSG.$({min:1,max:St,boost_max:Wa("builder_limit")}),max_len:2,buttons:{ok:function ok(e){worldCmdParseGated("build_queue_threshold "+e,refreshWorldInfo)},cancel:null}})}function changeBuildQueueAFK(e){J({edit_text:""+e,title:Qe.LBL_BUILD_QUEUE_AFK,text:Qe.DLG_NEW_VALUE_SECONDS_MSG.$({min:0,max:3600}),max_len:4,buttons:{ok:function ok(e){worldCmdParseGated("build_queue_afk "+e,refreshWorldInfo)},cancel:null}})}var Qi
var $i
var Ji={background_color:null,auto_hide:true}
var eo={whole:{},settings:{},waygates:{},users:{},results:{}}
var to={liquid:{label:Qe.LBL_WORLD_LIQUID,tooltip:Qe.TLTP_WORLD_LIQUID,metadata_field:"liquid",default_value_unlimited:1,default_value_adventure:1,world_cmd:"world_liquid"},flora:{label:Qe.LBL_WORLD_FLORA,tooltip:Qe.TLTP_WORLD_FLORA,metadata_field:"flora",default_value_unlimited:1,default_value_adventure:1,world_cmd:"world_flora"},prop_placement:{label:Qe.LBL_WORLD_PROP_PLACEMENT,tooltip:Qe.TLTP_WORLD_PROP_PLACEMENT,metadata_field:"prop_placement",default_value_unlimited:1,default_value_adventure:1,world_cmd:"world_prop_placement"},item_drop:{label:Qe.LBL_WORLD_ITEM_DROP,tooltip:Qe.TLTP_WORLD_ITEM_DROP,metadata_field:"item_drop",default_value_unlimited:0,default_value_adventure:1,world_cmd:"world_item_drop"},unlimited_items:{label:Qe.LBL_WORLD_UNLIMITED_ITEMS,tooltip:Qe.TLTP_WORLD_UNLIMITED_ITEMS,options_level:mi,metadata_field:"unlimited_items",default_value_unlimited:gt,default_value_adventure:Et,world_cmd:"world_unlimited_items"},give:{label:Qe.LBL_WORLD_GIVE,tooltip:Qe.TLTP_WORLD_GIVE,options_level:mi,metadata_field:"give",default_value_unlimited:Ve,default_value_adventure:ze,world_cmd:"world_give"},settlements:{label:Qe.LBL_WORLD_SETTLEMENTS,tooltip:Qe.TLTP_WORLD_SETTLEMENTS,metadata_field:"settlements",default_value_unlimited:0,default_value_adventure:1,world_cmd:"world_settlements"},factories:{label:Qe.LBL_WORLD_FACTORIES,tooltip:Qe.TLTP_WORLD_FACTORIES,metadata_field:"factories",default_value_unlimited:0,default_value_adventure:1,world_cmd:"world_factories"},energy:{label:Qe.LBL_WORLD_ENERGY.$({symbol:Vr.STAMINA_SYMBOL}),tooltip:Qe.TLTP_WORLD_ENERGY,metadata_field:"energy",default_value_unlimited:0,default_value_adventure:1,world_cmd:"world_energy"},o2:{label:Qe.LBL_WORLD_O2,tooltip:Qe.TLTP_WORLD_O2,metadata_field:"o2",default_value_unlimited:1,default_value_adventure:1,world_cmd:"world_o2"},falldamage:{label:Qe.LBL_WORLD_FALLDAMAGE,tooltip:Qe.TLTP_WORLD_FALLDAMAGE,metadata_field:"falldamage",default_value_unlimited:1,default_value_adventure:1,world_cmd:"world_falldamage"},free_pos:{label:Qe.LBL_WORLD_FREE_POS,tooltip:Qe.TLTP_WORLD_FREE_POS,metadata_field:"free_pos",default_value_unlimited:1,default_value_adventure:0,world_cmd:"world_free_pos"},tool_lock:{label:Qe.LBL_GATHERING_TOOLS,tooltip:Qe.TLTP_WORLD_GATHERING_TOOLS,options_value:Ni,metadata_field:"tool_lock",default_value_unlimited:yt,default_value_adventure:Tt,world_cmd:"world_tool_lock"},consumables:{label:Qe.LBL_WORLD_CONSUMABLES,tooltip:Qe.TLTP_WORLD_CONSUMABLES,metadata_field:"consumables",default_value_unlimited:0,default_value_adventure:1,world_cmd:"world_consumables"}}
function setGameplaySettingsTo(e){var t=Ya()
qe(t)
var r=[]
for(var a in to){var i=to[a]
var o=Ga()?i.default_value_adventure:i.default_value_unlimited
var n=void 0===t[i.metadata_field]?o:t[i.metadata_field]
var s=i[e]
if(n!==s){var l=s
if(i.options_level)for(var _=0;_<i.options_level.length;++_){var c=i.options_level[_]
if(c.level===s)l=c.tag}r.push(worldCmdParseGated.bind(null,i.world_cmd+" "+l))}}Bi=true
C(r,function(){Bi=false})}var ro=null
var ao
function changeLoadSpinner(r){if("custom"===r){J({title:Qe.DLG_BLUEPRINT_LINK_TITLE,text:Qe.DLG_BLUEPRINT_LINK_MSG,buttons:{ok:function ok(e){Wt(e,function(e){var t
if(!e)t=Qe.DLG_ERROR_PARSING_MSG
if(!t&&e&&!e.match(le))t=Qe.DLG_ERROR_MUST_BE_SHARED_MSG
if(!t){var r=Ct(e)
if(!r.loaded||r.error)t=Qe.DLG_ERROR_MUST_BE_LOADED_MSG}if(t)return Ae({title:Qe.DLG_ERROR_TITLE,text:t,buttons:{ok:null}})
qe(e)
changeLoadSpinner(e)})},cancel:null}})
return}worldCmdParseGated("world_load_spinner "+r,refreshWorldInfo)
ao=true;(ro=x()).add(0,1e3,function(e){var t=j()
if(t)V()
Kt(Qe.MSG_LOADING_PREVIEW,r)
Yt()
if(t)Y()
if(1===e)tr()})}function changeInfoBg(a){if("custom"===a||"customblur"===a){J({title:Qe.DLG_PHOTO_LINK_TITLE,text:Qe.DLG_PHOTO_LINK_MSG,buttons:{ok:function ok(e){Ht(e,function(e){var t
if(!e)t=Qe.DLG_ERROR_PARSING_MSG
if(!t&&e&&!e.match(ue))t=Qe.DLG_ERROR_PARSING_MSG
if(t)return Ae({title:Qe.DLG_ERROR_TITLE,text:t,buttons:{ok:null}})
qe(e)
changeInfoBg(("customblur"===a?"blur:":"")+e)})},cancel:null}})
return}worldCmdParseGated("world_info_bg "+a,refreshWorldInfo)
ao=false;(ro=x()).add(0,4500,function(e){var t=j()
if(t)V()
$t(a)
var r=re(1-(e-.9)/.1,.001,1)
Qt(Z.UI-10,r)
if(t)Y()
if(1===r)Sr.statusGet("preview").setMessage(Qe.MSG_WORLD_INFO_BG_PREVIEW).fade()})}function boostLevelForInfoBg(e){for(var t=0;t<Ge;++t)if(Fe[t].info_bgs.includes(e))return t
return Ge}function editWorldMenu(e,t,r,a,s,i,o){var n=e.mine
s=startScrollArea(eo.settings,Ji,s,r)
eo.settings.value.keyboardScroll()
var l=t.access_modify,_=t.access_public
var c=a+i/2
var u=s
qe(ji)
var d=Gi
Ee({key:"world_info_cats",x:0,z:o,w:i,num_headers:4,view_y:ji.getScrollPos(),view_h:ji.h,header_h:d,parent_scroll:ji})
var f=vt()
me({y:s,text:Qe.LBL_CATEGORY_GENERAL,text_height:f,earlydraw:function earlydraw(e){ii.drawSizedAligned(Gr,c,e.y,o+1,1.5*f,at.HVCENTER,0,e.h,Qe.LBL_WORLD_SETTINGS)
if(ut({key:"world_edit_stop",x:a+i-Gi-4,y:e.y,z:o+1,w:Gi,h:Gi,text:"←",tooltip:Qe.TLTP_DONE_EDITING})||it.keyDownEdge(it.KEYS.BACKSPACE))oi=null}})
s+=d+4
function optionLabel(e,t){dt({font_style:Br,x:c-8-Ui,y:s,w:Ui,h:Gi,size:f,align:at.VCENTER|at.HRIGHT,text:e,tooltip:t})}function optionValue(e){dt({font_style:Br,x:c,y:s,w:Ui,h:Gi,size:f,align:at.VCENTER,text:e})
s+=Gi+4}optionLabel(Qe.LBL_WORLD_NAME,Qe.TLTP_WORLD_NAME)
if(ut({x:c,y:s,w:Ui,h:Gi,text:t.name,disabled:Pi||!n,tooltip:!n?Qe.TLTP_OWNER_ONLY:void 0,disabled_focusable:!n}))renameWorld(t.name)
s+=Gi+4
function lazyDropdown(e,t,r,a,i,o,n){lazyDropdownInternal(e,c,s,t,r,a,i,o,n)
s+=Gi+4}function lazyDropdownByLevel(e,t,r,a,i,o,n){lazyDropdown(a,e,t,r,findCurrentByLevel.bind(null,a,i),setCurrentByField.bind(null,a,"level",i||0,r,o),n)}function lazyDropdownByValue(e,t,r,a,i,o,n){lazyDropdown(a,e,t,r,findCurrentByField.bind(null,a,"value",i),setCurrentByField.bind(null,a,"value",i,r,o),n)}function lazyDropdownByTag(e,t,r,a,i,o,n){lazyDropdown(a,e,t,r,findCurrentByField.bind(null,a,"tag",i),setCurrentByCallback.bind(null,a,"tag",i,r,o),n)}var v=Ya()
qe(v)
var h=v.time_offs,p=v.time_scale
lazyDropdown("time",Qe.LBL_TIME_OF_DAY,Qe.TLTP_TIME_OF_DAY,Si,function(e){var t=0
if(!p){var r=Infinity
for(var a=0;a<e.length;++a){var i=e[a]
if(i.value>=0){var o=Qa(i.value-h)
if(o<r){r=o
t=a}}}}else{var n=Infinity
for(var s=0;s<e.length;++s){var l=e[s]
if(l.value<0){var _=Qa(-l.value-p)
if(_<n){n=_
t=s}}}}return t},function(e){var t=getCurrentByField("value",Si,e)||0
if(t<0){var r=-t
if(p!==r)worldCmdParseGated("world_time_scale "+r+" "+Tr(r),refreshWorldInfo)}else if(p||h!==t)worldCmdParseGated("world_time_scale 0 "+t,refreshWorldInfo)},Ga())
lazyDropdownByTag(Qe.LBL_WORLD_SKY,Qe.TLTP_WORLD_SKY+"\n\n"+Qe.TLTP_BOOST_NOTE,getSkyOptions(),"sky","default",setCurrentByField.bind(null,"sky","tag","default",getSkyOptions(),"world_sky"),false)
function boostWarning(){s+=Ie({font_style:kr,x:c,y:s,w:i/2-8,align:at.HWRAP,text_height:f,text:Qe.WORLDINFO_BOOST_WARNING}).h+4}var m=Wa("skies")
var E=v.sky
if(E&&"default"!==E&&!m.includes(E)&&!m.includes("custom")){boostWarning()
yr()}lazyDropdownByValue(Qe.LBL_SHOW_OTHER_PLAYERS,Qe.TLTP_SHOW_OTHER_PLAYERS,Ti,"user_distance",0,"world_user_vis_dist",false)
lazyDropdownByValue(Qe.LBL_SHOW_PLAYER_NAMES,Qe.TLTP_SHOW_PLAYER_NAMES,Ai,"show_names",1,"world_show_names",false)
if(tt("load_spinner_anim"))ro=null
if(ro)if(!ro.update(Te()))ro=null
else if(ao)ye()
if(!Ei){Ei=[{name:Qe.LBL_DEFAULT,tag:"default"}]
var g=Fe[Ge].spinners
for(var T=0;T<g.length;++T){var y=g[T]
var S=Ge
for(var I=0;I<Ge;++I)if(Fe[I].spinners.includes(y)){S=I
break}var A=void 0
var w=void 0
if("custom"===y){A=true
w=Qe.addEllipsis(Qe.LBL_CUSTOM)}else w=y
var L=""
if(S>0)L="[img=boost"+S+"]"
Ei.push({name:w=""+w+L,name_suffix:L,need_name_update:!A,is_custom:A,tag:y})}}var O=-1
var R=v.load_spinner
if(!R)R="default"
var b=false
for(var N=0;N<Ei.length;++N){var C=Ei[N]
if(C.tag===R)O=N
if(C.is_custom)if(-1!==O&&O!==N){if(C.name!==Qe.LBL_CUSTOM){C.name=""+Qe.addEllipsis(Qe.LBL_CUSTOM)+C.name_suffix
C.tag="custom"
C.need_name_update=false
b=true}}else if(C.tag!==R){C.name=""+Qe.$(Qe.LBL_CUSTOM_SETTING,R)+C.name_suffix
C.tag=R
b=C.need_name_update=true}if(C.need_name_update){var x=Ct(C.tag)
if(x.loaded){var M=C.is_custom?Qe.$(Qe.LBL_CUSTOM_SETTING,x.name):x.name
C.name=""+M+C.name_suffix
C.need_name_update=false
b=true}}}if(b){var D
var P=null==(D=zi.load_spinner)?void 0:D.selbox
if(P)P.applyParams({items:Ei})}lazyDropdownByTag(Qe.LBL_LOADING_SPINNER,Qe.TLTP_LOADING_SPINNER+"\n\n"+Qe.TLTP_BOOST_NOTE,Ei,"load_spinner","default",changeLoadSpinner,false)
var B=Wa("spinners")
if("default"!==R&&!B.includes(R)&&!B.includes("custom"))boostWarning()
if(!gi){gi=[{name:Qe.reactive(function(){return"[img=menubg_default aspect=1] "+Qe.LBL_DEFAULT}),tag:"default"}]
var k=Fe[Ge].info_bgs;(k=k.slice(0)).push("custom")
for(var U=0;U<k.length;++U){var G=k[U]
var F=boostLevelForInfoBg(G)
var W=void 0
if("custom"===G)if(U===k.length-1){G="customblur"
W=Qe.addEllipsis(Qe.LBL_CUSTOM_BLURRED)}else W=Qe.addEllipsis(Qe.LBL_CUSTOM)
else{var H=Qe.get("LBL_TIME_"+G)
qe(H)
W="[img=menubg_"+G+" aspect=1] "+H}var z=""
if(F>0)z="[img=boost"+F+"]"
gi.push({name:W=""+W+z,name_suffix:z,need_name_update:false,tag:G})}}O=-1
var V=v.info_bg
if(!V)V="default"
var Y=V.startsWith("blur:")
var j=Y?V.slice("blur:".length):V
var K=false
var q=false
for(var X=0;X<gi.length;++X){var Q=gi[X]
if(Q.tag===V)O=X
if(Q.is_custom){q=true
if(-1!==O&&O!==X);else if(Q.tag!==V){var $=gi[(O=X)-1]
Q.name=""+Qe.separateColon(Y?Qe.LBL_CUSTOM_BLURRED:Qe.LBL_CUSTOM,j)+$.name_suffix
Q.tag=V
K=Q.need_name_update=true}}if(Q.need_name_update){var J=Q.tag
if(J.startsWith("blur:"))J=J.slice("blur:".length)
var ee=sr(J)
if(ee!==or&&ee!==nr&&ee.title){var te=gi[X-1]
var re=Q.is_custom?Qe.separateColon(Y?Qe.LBL_CUSTOM_BLURRED:Qe.LBL_CUSTOM,ee.title):ee.title
Q.name=""+re+te.name_suffix
Q.need_name_update=false
K=true}}}if(-1===O){qe(!q)
var ae=gi[gi.length-1]
qe(ae.name_suffix)
gi.push({name:Qe.separateColon(Y?Qe.LBL_CUSTOM_BLURRED:Qe.LBL_CUSTOM,j)+(""+ae.name_suffix),need_name_update:true,tag:V,is_custom:true})
O=gi.length-1
K=true}if(K){var ie
var oe=null==(ie=zi.info_bg)?void 0:ie.selbox
if(oe)oe.applyParams({items:gi})}lazyDropdownByTag(Qe.LBL_WORLD_INFO_BG,Qe.TLTP_WORLD_INFO_BG+"\n\n"+Qe.TLTP_BOOST_NOTE,gi,"info_bg","default",changeInfoBg,false)
var ne=Wa("info_bgs")
if(V&&"default"!==V&&!ne.includes(V)&&!ne.includes("custom"))boostWarning()
var se=v.boost_icon
var le=Wa("boost_icon")
for(var _e=0;_e<yi.length;++_e){var ce=_e>=le&&se!==_e
if(ce!==yi[_e].disabled){var ue
yi[_e].disabled=ce
var de=null==(ue=zi.boost_icon)?void 0:ue.selbox
if(de)de.applyParams({items:yi})}}lazyDropdownByValue(Qe.LBL_BOOSTER_ICON,Qe.TLTP_BOOSTER_ICON+"\n\n"+Qe.TLTP_BOOST_NOTE,yi,"boost_icon",0,"world_boost_icon",false)
if((se||0)>=le)boostWarning()
me({y:s+=16,text:Qe.LBL_CATEGORY_ACCESS,text_height:f})
s+=d+4
optionLabel(Qe.LBL_ACCESS_PRESET,Qe.TLTP_ACCESS_PRESET)
Qi=doAccessDropdown(t,Qi,c,s)
s+=Gi+4
if(_&&l>=At)s+=ai.drawSizedWrapped(kr,c,s,Z.UI,i/2-8,0,f,Qe.WORLDINFO_ANYONE_BUILD_WARNING)+4
if(_)lazyDropdown("listed",Qe.LBL_LISTED,Qe.TLTP_LISTED,wi,function(e){return t.access_listed?1:0},function(e){worldCmdParseGated("world_listed "+e,refreshWorldInfo)},false)
else{optionLabel(Qe.LBL_LISTED,Qe.TLTP_LISTED)
optionValue(Qe.LBL_LISTED_PRIVATE)}lazyDropdownByLevel(Qe.LBL_FLYING,Qe.TLTP_FLYING,vi,"access_fly",null,"world_fly",Ga())
lazyDropdownByLevel(Qe.LBL_CHAT,Qe.TLTP_CHAT,hi,"access_chat",null,"world_chat",false)
optionLabel(Qe.LBL_CHAT_SLOW_MODE_COOLDOWN,Qe.TLTP_CHAT_SLOW_MODE_COOLDOWN)
var fe=v.chat_cooldown||He
if(ut({x:c,y:s,w:Ui,h:Gi,text:fe?""+fe:Qe.LBL_DISABLED,disabled:Pi}))changeChatCooldown(fe)
s+=Gi+4
lazyDropdownByValue(Qe.LBL_CHAT_MINIMUM_ACCOUNT_AGE,Qe.TLTP_CHAT_MINIMUM_ACCOUNT_AGE,pi,"chat_minimum_account_age",0,"world_chat_minimum_account_age",false)
lazyDropdownByLevel(Qe.LBL_PLACE_BLUEPRINTS,Qe.TLTP_PLACE_BLUEPRINTS,mi,"access_blueprint",null,"world_blueprint",false)
lazyDropdownByLevel(Qe.LBL_PLACE_SAPLINGS,Qe.TLTP_PLACE_SAPLINGS,mi,"access_sapling",je,"world_sapling",false)
lazyDropdownByLevel(Qe.LBL_EDIT_WAYGATES,Qe.TLTP_EDIT_WAYGATES,mi,"access_waygate",null,"world_waygate",false)
lazyDropdownByLevel(Qe.LBL_EDIT_LEAPGATES,Qe.TLTP_EDIT_LEAPGATES,mi,"access_leapgate",Ye,"world_leapgate",false)
if(!window.FBInstant&&!lr){if(!Wi)Se({x:c,y:s,text:Qe.LBL_MORE_ACCESS_OPTIONS,url:"https://www.reddit.com/r/WorldsFRVR/wiki/worldaccess"})
s+=f+4}me({y:s+=16,text:Qe.LBL_CATEGORY_GAMEPLAY,text_height:f})
s+=d+4
if(Ga()){s+=ai.drawSizedAlignedWrapped(Br,a+.25*i,s,Z.UI,0,f,at.HCENTER,.5*i,0,Qe.LBL_WORLD_INFO_LOST_FRONTIER)+4
if(ut({x:c-2*ki-8,y:s,w:4*ki+8,h:Gi,text:Qe.addEllipsis(Qe.BTN_CONVERT_UNLIMITED),disabled:Pi}))Ae({title:Qe.DLG_CONVERT_UNLIMITED_TITLE,text:Qe.DLG_CONVERT_UNLIMITED_MSG,buttons:{yes:worldCmdParseGated.bind(null,"world_unlimited 1 "+Sa(),function(e){if(!e)setGameplaySettingsTo("default_value_adventure")}),no:null}})
s+=Gi+4}else{if(ut({x:c-2*ki-8,y:s,w:2*ki,h:Gi,text:Qe.BTN_RESET_DEFAULTS,tooltip:Qe.TLTP_WORLD_RESET_TO_DEFAULTS,disabled:Pi}))setGameplaySettingsTo("default_value_unlimited")
if(ut({x:c,y:s,w:2*ki,h:Gi,text:Qe.BTN_GAMEPLAY_ALL_ON,tooltip:Qe.TLTP_GAMEPLAY_ALL_ON,disabled:Pi}))setGameplaySettingsTo("default_value_adventure")
s+=Gi+4}function doGameplaySettingDropdown(e){var t=to[e]
qe(t)
var r=Ga()?t.default_value_adventure:t.default_value_unlimited
if(t.options_level)lazyDropdownByLevel(t.label,t.tooltip,t.options_level,t.metadata_field,r,t.world_cmd,Ga())
else lazyDropdownByValue(t.label,t.tooltip,t.options_value||Ai,t.metadata_field,r,t.world_cmd,Ga())}doGameplaySettingDropdown("liquid")
doGameplaySettingDropdown("flora")
doGameplaySettingDropdown("prop_placement")
doGameplaySettingDropdown("item_drop")
doGameplaySettingDropdown("unlimited_items")
doGameplaySettingDropdown("give")
doGameplaySettingDropdown("settlements")
doGameplaySettingDropdown("factories")
doGameplaySettingDropdown("energy")
if(kt()){doGameplaySettingDropdown("o2")
doGameplaySettingDropdown("falldamage")}else{optionLabel(to.o2.label,to.o2.tooltip)
optionValue(Qe.LBL_OFF)
optionLabel(to.falldamage.label,to.falldamage.tooltip)
optionValue(Qe.LBL_OFF)}doGameplaySettingDropdown("consumables")
doGameplaySettingDropdown("free_pos")
doGameplaySettingDropdown("tool_lock")
optionLabel(Qe.LBL_TOOL_DURABILITY,Qe.TLTP_TOOL_DURABILITY)
optionValue(Bt()?Qe.LBL_ON:Qe.LBL_OFF)
if(ut({x:c-2*ki-8,y:s,w:4*ki+8,h:Gi,text:Qe.addEllipsis(Qe.BTN_WORLD_RESET_INVENTORY),tooltip:Qe.TLTP_WORLD_RESET_INVENTORY,disabled:Pi}))Ae({title:Qe.DLG_WORLD_RESET_INVENTORY_TITLE,text:Qe.DLG_WORLD_RESET_INVENTORY_MSG,buttons:{yes:worldCmdParseGated.bind(null,"world_inventory_reset ALL",we),no:null}})
if(ut({x:c-2*ki-8,y:s+=Gi+4,w:4*ki+8,h:Gi,text:Qe.addEllipsis(Qe.BTN_SET_INVENTORY_TO_MINE),tooltip:Qe.TLTP_SET_INVENTORY_TO_MINE,disabled:Pi||Ga()})){var ve=Ut()
Ae({title:Qe.DLG_WORLD_SET_INVENTORY_TITLE,text:Qe.DLG_WORLD_SET_INVENTORY_MSG+"\n\n"+Qe.DLG_WORLD_SET_INVENTORY_MSG2.$({list:Qe.separateComma.apply(Qe,ve)}),buttons:{yes:worldCmdParseGated.bind(null,"world_inventory_clone ALL",we),no:null}})}s+=Gi+4
me({y:s+=16,text:Qe.LBL_CATEGORY_BUILDER_QUEUE,text_height:f})
s+=d+4
optionLabel(Qe.LBL_BUILD_QUEUE_THRESHOLD,Qe.TLTP_BUILD_QUEUE_THRESHOLD)
var he=ya().getChannelData("public.build_queue.threshold",0)
if(!he||he>St)he=St
if(ut({x:c,y:s,w:Ui,h:Gi,text:""+he,disabled:Pi}))changeBuildQueueThreshold(he)
s+=Gi+4
optionLabel(Qe.LBL_BUILD_QUEUE_AFK,Qe.TLTP_BUILD_QUEUE_AFK)
var pe=ya().getChannelData("public.build_queue.afk",0)
if(ut({x:c,y:s,w:Ui,h:Gi,text:pe?""+pe:Qe.LBL_DISABLED,disabled:Pi}))changeBuildQueueAFK(pe)
s+=Gi+4
lazyDropdownByValue(Qe.LBL_BUILD_QUEUE_AUTOMATIC,Qe.TLTP_BUILD_QUEUE_AUTOMATIC,Ri,"build_queue.manual",0,"build_queue_automatic",false)
lazyDropdownByValue(Qe.LBL_BUILD_QUEUE_AUTO_PROMOTE,Qe.TLTP_BUILD_QUEUE_AUTO_PROMOTE,Ai,"build_queue.autopromote",1,"build_queue_auto_promote",false)
lazyDropdownByValue(Qe.LBL_BUILD_QUEUE_CHAT,Qe.TLTP_BUILD_QUEUE_CHAT,bi,"build_queue.mute",0,"build_queue_chat",false)
lazyDropdownByValue(Qe.LBL_BUILD_QUEUE_SPECTATE,Qe.TLTP_BUILD_QUEUE_SPECTATE,Oi,"build_queue.spectate",0,"build_queue_spectate",false)
lazyDropdownByValue(Qe.LBL_BUILD_QUEUE_FORCE_UI,Qe.TLTP_BUILD_QUEUE_FORCE_UI,Li,"build_queue.force_ui",0,"build_queue_force_ui",false)
s+=100
ge()
return(s=finishScrollArea(eo.settings,s))-u}var io=[]
var oo=false
var no
function hourToString(e){return oe(new Date(se(60*e*60)),false,{year:"numeric",month:"short",day:"numeric",hour:"numeric"})}var so={}
function tokenize(e,t){var r=so[e]
if(!r){var a=P(t)
r=so[e]=a.split(" ").map(function(e){return{type:"text",value:e,sep:false}})}return r.slice(0)}function styleFromUserID(e,t){if(e.world_info&&e.world_info.owner&&e.world_info.owner.user_id===t)return Je.OWNER
var r=ci&&ci.access_map&&ci.access_map[t]
var a
if(r){var i=accessString(r.level)
a=Je[i]}return a||Br}function worldAdminLogShow(e,t,r,a,i,o){var n=vt()
if(i!==no){no=i
for(var s=0;s<io.length;++s)io[s].height=0}var l=r.y
ii.draw({style:Gr,text:Qe.addParenthesesAfter(Qe.BTN_WORLD_ADMIN_LOG,Qe.$(Qe.LBL_NUMBERED_WORLD,Sa())),align:at.HVCENTER,x:a,y:l,z:o,w:i,h:Gi,size:1.5*n})
if(ut({key:"world_edit_stop",x:a+r.w-Gi,y:l,z:o+1,w:Gi,h:Gi,text:"←",tooltip:Qe.TLTP_DONE_VIEWING_LOG})||it.keyDownEdge(it.KEYS.BACKSPACE))oi=null
l+=Gi
r.h-=l-r.y
r.y=l
l=startScrollArea(eo.settings,Ji,l,r)
l+=8
eo.settings.value.keyboardScroll()
var _=a+i
var c=l
qe(ji)
if(oo)ai.drawSizedAligned(Ur,a,l,o,n,at.HVCENTER,i,2*r.h/3,Qe.MSG_LOADING)
else if(!io.length)ai.drawSizedAligned(Ur,a,l,o,n,at.HVCENTER|at.HWRAP,i,2*r.h/3,Qe.MSG_ADMIN_LOG_EMPTY)
else{var u=8
var d=4
var f=2
var v=250
var h=Gi
var p=(h-n)/2
var m=ai.getCharacterWidth(Br,n,32)
var E=Qe.FORMAT_SEPARATOR_COMMA
var g=eo.settings.value.getScrollPos()
var T=g+r.h
var y=e.mine,S=e.mine_frozen
var I=Ha()
if(I&&(y||S)){var A=ie()
var w=.5*A
var L=a+i/2
ai.draw({style:Br,x:a,y:l,z:o,h:A,w:i/2-4-w,size:w,align:at.VCENTER|at.HRIGHT,text:Qe.separateColon(Qe.LBL_BOOST_REWARDS_AVAILABLE,I)})
Vr.sprite.draw({x:L-4-w,y:l+(A-w)/2,z:o,w:w,h:w,frame:Vr.ORBS})
if(ut({x:L,y:l,z:o,font_height:w,h:A,text:Qe.BTN_BOOST_CLAIM_REWARDS,disabled:Pi}))worldCmdParseGated(S?"world_reward_claim_frozen":"world_reward_claim",function(e){if(!e){da("orb",I)
Rt("orb","source",I,false,"world_reward_claim",ga())
Xa("purchase")}})
l+=A}for(var O=0;O<io.length;++O){var R=io[O]
var b=void 0
if(R.height){if(l+R.height<g||l>T){l+=R.height
continue}b=true}else b=l<T
var N=l
var C=R.actor,x=R.actions
var M=Object.keys(x)
M.reverse()
for(var D=0;D<M.length;++D){var P=M[D]
var B=x[P]
var k=a
var U=R.dt||hourToString(R.hour)+": "
k+=ai.drawSized(Br,k,l+p,o,n,U)
if(C&&"system"!==C){var G=C
if(b){var F=na(C)
if(F.display_name)G=F.display_name}var W=styleFromUserID(e,C)
k+=f
if(b&&la({user_id:C,show_online_status:false,x:k,y:l,z:o+1,w:h,h:h}))_a({x:k,y:l,user_id:C})
k+=h+f
k+=ai.drawSized(W,k,l+p,o,n,G)
k+=ai.drawSized(Br,k,l+p,o,n,Qe.FORMAT_SEPARATOR_COLON)}var H=void 0
var z="text"
var V=void 0
switch(P){case"change_access":H=tokenize(P,Qe.LBL_ADMIN_LOG_CHANGE_ACCESS)
z="user"
break
case"change_setting":var Y=B.length
H=tokenize(P+Y,Qe.LBL_ADMIN_LOG_CHANGE_SETTING.$({count:Y}))
V=Wr
break
case"change_waygate":var j=B.length
H=tokenize(P+j,Qe.LBL_ADMIN_LOG_CHANGE_WAYGATE.$({count:j}))
V=Hr
break
case"csr_msg":H=tokenize(P,Qe.LBL_ADMIN_LOG_CSR_MESSAGE)
V=ae
break
case"access_token":H=tokenize(P,Qe.LBL_ADMIN_LOG_ACCESS_TOKEN)
z="user"
break
case"access_pass":H=tokenize(P,Qe.LBL_ADMIN_LOG_ACCESS_PASS)
z="user"
break
case"boost_level_down":H=tokenize(P,Qe.LBL_ADMIN_LOG_BOOST_LEVEL_DOWN)
break
case"boost_level_up":H=tokenize(P,Qe.LBL_ADMIN_LOG_BOOST_LEVEL_UP)
break
case"boost":H=tokenize(P,Qe.LBL_ADMIN_LOG_BOOST)
z="user"
break
case"boost_expire":H=tokenize(P,Qe.LBL_ADMIN_LOG_BOOST_EXPIRE)
z="user"
break
case"boost_invalidate":H=tokenize(P,Qe.LBL_ADMIN_LOG_BOOST_INVALIDATE)
z="user"
break
case"boost_reward":H=tokenize(P,Qe.LBL_ADMIN_LOG_BOOST_REWARD)
z="orbs"
break
default:H=[{type:"text",value:P,sep:false}]}for(var K=0;K<B.length;++K)H.push({type:z,value:B[K],sep:true,style:V})
for(var q=0;q<H.length;++q){var Z=H[q]
var X=Z.type,Q=Z.value,$=Z.style
if("user"===X&&"default"===Q){X="text"
$=Wr}if("user"===X){var J=Q
var ee=J
if(b){var te=na(J)
if(te.display_name)ee=te.display_name}var re=styleFromUserID(e,J)
if(k+(f+h+f+ai.getStringWidth(re,n,ee))>_){k=v
l+=h+d}k+=f
if(b&&la({user_id:J,show_online_status:false,x:k,y:l,z:o+1,w:h,h:h}))_a({x:k,y:l,user_id:J})
k+=h+f
k+=ai.drawSized(re,k,l+p,o,n,ee)}else{$=$||Br
if(k+ai.getStringWidth($,n,Q)>_){k=v
l+=h+d}k+=ai.drawSized($,k,l+p,o,n,Q)
if("orbs"===X){Vr.sprite.draw({x:k,y:l+p,z:o,w:n,h:n,frame:Vr.ORBS})
k+=n}}if(q!==H.length-1)if(Z.sep)k+=ai.drawSized(Br,k,l+p,o,n,E)
else k+=m}l+=h+u}R.height=l-N}}return(l=finishScrollArea(eo.settings,l))-c}function exitAndUnstuck(){qt.menuExit()
Ar()}var lo
var _o
var co
var uo
var fo
var vo
function doWaygateList(e,t,r,a,i,o){var n=e.world_info
var s=n.waygates||{}
var l=a
var _=r+i/2
var c=vt()
ii.drawSizedAligned(Gr,_,a,o+1,1.5*c,at.HCENTER,0,0,Qe.LBL_WAYGATES)
a+=1.5*c+8
a+=lineSep(_,a,o)
var u=_o&&!wr()
var d=a
if(fo&&t){var f=7
t.y-=f
t.h+=f
a=startScrollArea(eo.waygates,Ji,a,t)
a+=f}var v=true
if(jr()&&_o){var h=Gi
var p=8
var m=600
var E=c
var g=Jr()
var T=pt.seconds()
var y=ei(0,T-g)
var S=_+h/2+p
var I=S-h-p
var A=y>ma
v=A
Vr.sprite.draw({x:I,y:a,z:o,w:h,h:h,frame:A?Vr.CHECK:Vr.TIME,color:A?Rr:Mr})
var w=_-m/2
var L=I-p-w
if(!A)ai.drawSizedAligned(Br,w,a,o,E,at.HRIGHT|at.HFIT|at.VCENTER,L,h,ne(ma-y+59))
else ai.drawSizedAligned(zr,w,a,o,E,at.HRIGHT|at.HFIT|at.VCENTER,L,h,Qe.$(Qe.FORMAT_READY_WG_TIME,ne(ma)))
ai.drawSizedAligned(A?Br:zr,S,a,o,E,at.HFIT|at.VCENTER,m/2,h,A?Qe.WORLDINFO_SAFE_WG_TRAVEL:Qe.WORLDINFO_WG_TRAVEL_UNSAFE)
a+=h+p}var O=lo&&Za()?$r():null
var R=lo&&ta()
function visibleWaygate(e){if(!(s[e].flags&It))if(R);else if(e===O);else return false
return true}var b=Object.keys(s).filter(visibleWaygate)
cmpWaygateInit(s,O)
b.sort(cmpWaygateID)
var N=va(Gi)
var C=void 0===n.settlements?Ga()?1:0:n.settlements
var x=Boolean(C&&n.user_access>=wt)
if(lo&&(ra()||ja()))x=false
var M=x&&!lo
var D=Gi+8
var P=Ja((Ki[0]-a)/D)
var B=ti(b.length-1,$a((Ki[1]-a)/D))
a+=(P=ei(0,ti(P,b.length-1)))*D
for(var k=P;k<=B;++k){var U=b[k]
var G=s[U]
var F=false
var W=false
var H=U===O
var z="default"===U
if(!(G.flags&It))if(R)W=F=true
else if(H)F=true
var V=0
var Y=_-N-8
var j=G.name||U
if(H){var K={x:Y-=Gi,y:a,w:Gi,h:Gi,frame:Vr.HOME,text:"",tooltip:Qe.TLTP_HOME_SETTLEMENT}
Vr.sprite.draw(K)
if(z){K.tooltip=K.tooltip+"\n"+Qe.TLTP_DEFAULT_WAYGATE
var q={x:K.x+K.h/4,y:K.y+K.h/4,w:K.h/2,h:K.h/2,z:Z.UI+1,color:Or,frame:Vr.CHECK}
Vr.sprite.draw(q)}dt(K)
Y-=8}else if(z){var X={x:Y-=Gi,y:a,w:Gi,h:Gi,frame:Vr.CHECK,tooltip:Qe.TLTP_DEFAULT_WAYGATE,text:"",color:Or}
Vr.sprite.draw(X)
dt(X)
Y-=8}ai.drawSizedAligned(W?Pr:Br,V,a,Z.UI,c,at.VCENTER|at.HRIGHT|at.HFIT,Y-V,Gi,j)
var Q=x&&!H||Wi
var $={x:_-N,y:a,z:o,h:Gi,target:{wid:ui,wgid:U},max_grow:.1,no_overlay:true,in_event_cb:it.pointerLockEnter,url:worldLink(ui,U),ctx:"world_info",disabled:Q,tooltip:Q?Ga()?lo?Qe.TLTP_WAYGATE_DISABLED_LF_IN:Qe.TLTP_WAYGATE_DISABLED_LF_OUT:lo?Qe.TLTP_WAYGATE_DISABLED_UNL_IN:Qe.TLTP_WAYGATE_DISABLED_UNL_OUT:void 0,disabled_focusable:true,w:0}
var J=pa($)
var ee=_-N+$.w+8
var te=ki
var re=lo&&fr(U)&&ea()
if(re||R)te=Gi
if(!M){if(ut({x:ee,y:a,w:te,h:Gi,text:Qe.BTN_WAYGATE_GO,disabled:Q,in_event_cb:it.pointerLockEnter})||J){var ae=exitMenuAndGo.bind(null,ui,U)
if(!v)ae=promptWaygateSickness.bind(null,ae)
if(dr())ae=promptWaygateGroupRaceCancel.bind(null,ae)
ae()}ee+=te+8}if(re||R){if(ct({x:ee,y:a,w:Gi,h:Gi,img:Vr.sprite,frame:re?Vr.HOME:Vr.EDIT,tooltip:re?Qe.BTN_SETTLEMENT_INFO:Qe.BTN_EDIT_WG_INFORMATION}))ha(U)
ee+=Gi+8}if(F){dt({font_style:Pr,x:ee,y:a,w:ki,h:Gi,align:at.HVCENTERFIT,text:Qe.WORLDINFO_UNLISTED})
ee+=ki+8}else{if(mr()||rt.defines.WORLD_INFO_MAX){if(ut({x:ee,y:a,w:ki,h:Gi,text:Qe.BTN_GET_LINK}))pr(ui,U)
ee+=ki+8}if(Er()||rt.defines.WORLD_INFO_MAX){if(ut({x:ee,y:a,w:ki,h:Gi,text:Qe.BTN_SHARE}))hr(ui,U)
ee+=ki+8}}a+=D}a+=(b.length-1-B)*D
if(!b.length){ai.drawSizedAligned(Br,_,a,o+1,c,at.HCENTER,0,0,Qe.WORLDINFO_NO_WG_FOUND)
a+=c+4}var ie
if(fo){ie=a
a=finishScrollArea(eo.waygates,a)}a+=6
if(fo)a=ti(a,d+ie)
if(u){if(ut({x:_-ki,y:a,w:2*ki,h:Gi,text:Qe.BTN_IM_STUCK}))if(dr())promptWaygateGroupRaceCancel(!v?function(){return promptWaygateSickness(exitAndUnstuck)}:exitAndUnstuck)
else if(!v)promptWaygateSickness(exitAndUnstuck)
else exitAndUnstuck()
a+=Gi+8}O=null
return(a+=8)-l}function defaultClientIDsToAccessLevel(e){return de(e.roles,false)}function worldGetUserList(e,t,r,a){var i={}
var o=[]
var n=0
if(!r){var s=Na(),l=s.sorted_users,_=s.online
n=s.threshold
var c={}
for(var u=0;u<l.length&&u<n;++u){var d=l[u]
var f=_[d]
qe(f)
if(f<0)break
c[d]=true}var v=wa()
for(var h in v){var p=v[h].ids
if(!p||!p.user_id||i[p.user_id])continue
var m=p.user_id
var E=p.roles&&p.roles.frozen_owner?"FROZEN_OWNER":t(p)
if(!E)continue
var g=Je[E]
if(oa(p.roles))g=A
i[m]=true
var T=_[m]
if(void 0===T)T=_e
o.push({user_id:m,display_name:ca(m,p.display_name),role:E,rank:Ci[E],is_booster:Boolean(p.roles&&p.roles.world_booster),style:g,state:c[m]?Ke.ACTIVE:T>0?Ke.QUEUED:Ke.INACTIVE,ordinal:T})}}for(var y in e){var S=e[y]
if(i[y])continue
i[y]=true
if(r&&S.level!==Me)continue
var I=accessString(S.level)
o.push({user_id:y,role:I,rank:accessRank(I),is_booster:Boolean(a&&a[y]),style:Je[I]||null,state:Ke.OFFLINE,ordinal:0})}return{list:o,threshold:n,seen_users:i}}function worldAdminLogHasNew(){var e=Ya()
if(!e||!e.admin_log_id)return 0
if(Xr())return 0
var t=Zr("admin_log_id")||0
if(t<e.admin_log_id)return ei(0,e.admin_log_id-t)
return 0}function worldInfoShowEditMode(){oi="settings"
ni=true}function worldInfoShowAdminLog(e){oi="adminlog"
ni=true
if(!oo){io=[]
oo=true
Aa(e?"world_frozen_log_fetch":"world_admin_log_fetch",function(e,t){if(e)console.log("Error fetching admin log: "+e)
else if(!Xr()){var r
var a=null==(r=Ya())?void 0:r.admin_log_id
if(a)Qr("admin_log_id",a,true)}oo=false
io=t||[]})}}var ho={label:Qe.BTN_JOIN_WORLD,pointerlock:true,cb:function cb(e){qt.menuExit()
Oa(ui,void 0)}}
var po={label:Qe.BTN_GET_LINK,cb:function cb(e){pr(ui)}}
var mo={label:Qe.BTN_SHARE,cb:function cb(e){hr(ui)}}
var Eo={label:Qe.addEllipsis(Qe.BTN_FORGET_WORLD),cb:function cb(e){Ae({title:Qe.DLG_FORGET_WORLD_TITLE,text:Qe.$(Qe.DLG_FORGET_WORLD_MSG,e.name,ui),buttons:{yes:Ba.bind(null,ui),no:null}})}}
var go={label:Qe.addEllipsis(Qe.BTN_DELETE_WORLD),cb:function cb(e){Ae({title:Qe.DLG_DELETE_WORLD_TITLE,text:Qe.$(Qe.DLG_DELETE_WORLD_MSG,e.name,ui),buttons:{yes:Pa.bind(null,ui),no:null}})}}
var To=((a={})[Ke.ACTIVE]=Qe.LBL_USERS_ACTIVE,a[Ke.QUEUED]=Qe.LBL_USERS_QUEUED,a[Ke.INACTIVE]=Qe.LBL_USERS_INACTIVE,a[Ke.OFFLINE]=Qe.LBL_USERS_OFFLINE,a)
function drawUserListHeader(e,t){if(!e.first_header)e.y+=8
e.first_header=false
var r=To[t]
var a=vt()
ii.drawSizedAligned(Gr,e.x,e.y,e.z+1,1.5*a,at.HCENTER,e.w,0,r.$({count:e.count_by_state[t]||0,limit:e.threshold}))
e.y+=1.5*a+8
e.y+=lineSep(e.x+e.w/2,e.y,e.z)}var yo=96
var So=300
var Io=268
var Ao=200
var wo
function doWorldInfoView(e,t){Nt("home_screen",1,"world_info")
var r=tt("doWorldInfoView")
_o=lo=t
Wi=false
if(lo){ui=Sa()
qe(ui)
qe.equal(typeof ui,"string")}else if(ui===Sa())_o=true
var a=Z.UI
var i=ar()
var o=0
var n=rr()-o
var s=i-e
var l=e
var _=o
var c=_+n/2
var u=48
var d=vt()
Ji.z=Z.UI
var f=worldInfoGetContext(ui)
var v=f.world_info,h=f.mine,p=f.mine_frozen,m=f.frozen,E=f.am_admin
if(oi&&(r||!(E&&_o))&&!ni)if(!r&&"adminlog"===oi&&p);else oi=null
if(lo&&!er()&&!oi&&Gt())if(ut({x:0,y:e,w:Gt()?391:128,font_height:36,text:Gt()?Qe.BTN_EXIT_TO_MAIN_MENU:Qe.BTN_EXIT_WORLD})){bt("exit_to_main_menu_button",1,"button","worldinfo")
Zt()}if(!isWorldInfoContext(f)){ai.drawSizedAligned(Ur,o,e,a,d,at.HVCENTER,n,2*s/3,Qe.WORLDINFO_LOADING)
return}if(v.err){ai.drawSizedAligned(Ur,o,e,a,d,at.HVCENTER,n,2*s/3,Qe.$(Qe.WORLDINFO_LOADING_ERROR,v.err))
return}qe(Ma(v))
jt(v)
var g=v.owner,T=v.access_modify,y=v.gems
if(rt.defines.WORLD_INFO_MAX){m=true
y=5}if(!wo)wo=nt(Ji).barWidth()
ni=false
if(oi){var S={x:0,y:l,w:n,h:i-l}
if("settings"===oi)l+=editWorldMenu(f,v,S,o,l,S.w-wo,a)
else if("adminlog"===oi)l+=worldAdminLogShow(f,v,S,o,S.w-wo,a)
return}if(rt.defines.INFO_HEADER){var I=Vt(v)
if(I){var A=I
if(A.startsWith("blur:"))A=A.slice("blur:".length)
var w=sr(A)
if(w&&w.img&&w.img.card){var L=_t({filter_mag:gl.LINEAR,filter_min:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,url:w.img.card.url,soft_error:true,lazy_load:true})
var O=1.2*Io
var R=n/mt
var b=4
L.draw4Color({x:o-b,w:n+2*b,y:e-b,h:O,z:Z.UI-.5,uvs:[0,0,1,ti(1,O/R)],color_ul:[1,1,1,.25],color_ur:[1,1,1,.25],color_ll:[1,1,1,0],color_lr:[1,1,1,0]})}}}if(pa({x:c-va(Io),y:l,h:Io,target:{wid:ui},img_style:"preview",overlay_mode:true,overlay_title:false,overlay_users:false,disabled:_o,in_event_cb:it.pointerLockEnter,url:worldLink(ui),ctx:"world_info_header"})){qt.menuExit()
Oa(ui,void 0)}var N=l+Io
var C=450
var x=1.5*d
var M=ii.drawSizedAligned(Gr,c,l+=16,a+1,x,at.HCENTERFIT,C,0,v.name)
var D=l
var P=.75*d
var B=ai.drawSizedAligned(zr,c,l+=x,a+1,P,at.HCENTERFIT,C,0,Qe.$(Qe.LBL_NUMBERED_WORLD,ui)+" "+Vr.COPY_SYMBOL)
if(ot({x:c+(C-B)/2,y:l,w:B,h:P,button:0}))ft('"'+v.name+'"',ui)
l+=P
l+=4
if(h&&_o)if(ct({x:c+(C+ei(M,B))/2+8,y:D-(u-x)/2,z:a,img:Vr.sprite,frame:Vr.EDIT,w:u,h:u,tooltip:Qe.TLTP_RENAME_WORLD,disabled:Pi}))renameWorld(v.name)
var k=v.created
var U=0
var G
var F
if(k){var W=ei(0,ri(pt.now()/1e3-k/1e3))
var H
if(W<2592e3){if(W>86400)W=60*ri(W/60/60)*60
H=Qe.duration(W,Xe)}else H=Qe.duration(W,Ze)
var z=new Date(k)
G=Qe.LBL_CREATED_AGO.$({time:H})
F=Qe.TLTP_WORLD_CREATED.$({date:z.toLocaleDateString()})
U=ai.getStringWidth(Br,P,G)}if(g.user_id&&g.user_id.startsWith("$"));else{l-=(u-d)/2
var V=u
var Y=g.display_name||g.user_id
Y=ca(g.user_id,Y)
var j=ai.drawSizedAligned(Br,c,l,a+1,d,at.HCENTERFIT|at.VCENTER,C,V,Qe.separateColon(m?Qe.LBL_ACCESS_OWNER_CREATOR:Qe.LBL_ACCESS_OWNER,Y))
if(la({user_id:g.user_id,show_online_status:false,x:c+(C+ei(B,j,U))/2+4,y:l,z:a+1,w:u,h:u})||ot({x:c,y:l,w:C,h:V,button:0}))_a({x:c,y:l+u,user_id:g.user_id})
l+=u+4
l-=(u-d)/2}if(k)ht.label({font_style:zr,x:c,y:l,z:a+1,w:C,size:P,align:at.HCENTERFIT,text:G,tooltip:F})
l+=P+4
var K=v.players||0
if(rt.defines.WORLD_INFO_MAX)K=17
if(K&&!lo){var q=v.builders||0
if(rt.defines.WORLD_INFO_MAX)q=7
var X=K-q
var Q=[]
if(q)Q.push(Qe.FORMAT_NUMBER_OF_BUILDERS.$({builders:q}))
if(X){if(Q.length)Q.push("•")
Q.push(Qe.FORMAT_NUMBER_OF_VIEWERS.$({viewers:X}))}ai.drawSizedAligned(Br,c,l,a+1,d,at.HCENTERFIT,C,0,Qe.separateWords.apply(Qe,Q))
l+=d+4}var $=[]
for(var J in st())if(lt(J)){var ee=na(J)
var te=ee.display_name,re=ee.presence_data
if((re&&re.payload&&re.payload.world_id)===ui)$.push(te)}if(rt.defines.WORLD_INFO_MAX)$.push("WWWW1","WWWW2","WWWW3","WWWW WWWW WWWW IV")
var ae=$.length
if(ae){var ie=Qe.separateComma.apply(Qe,$)
var oe=Qe.WORLDINFO_FRIENDS.$({val:ae,names:ie}).toLocalString()
var ne=false
if(oe.length>40){ne=true
oe=Qe.addEllipsis(oe.slice(0,37)).toLocalString()}dt({font_style:Br,align:at.HCENTERFIT,x:c+4,y:l,z:a+1,w:C-8,h:d,size:d,text:oe,tooltip:ne?ie:void 0})
l+=d+4}if(y){ai.drawSizedAligned(Fr,c,l,a+1,d,at.HCENTERFIT,C,0,Qe.WORLDINFO_HIDDEN_GEMS.$({gems:y,symbol:Vr.GEM_SYMBOL}))
l+=d+4}var se=v.stats||{}
var le=se.visit_count||0
var _e=se.unique||0
var ce=se.like||0
var ue=Qe.separateWords(Qe.WORLDINFO_LIKES.$({val:ce,short_val:numberFormat(ce)}),"•",Qe.WORLDINFO_VIEWS.$({val:le,short_val:numberFormat(le)}),"•",Qe.WORLDINFO_VISITORS.$({val:_e,short_val:numberFormat(_e)}))
var de=ai.drawSizedAligned(Br,c,l,a+1,d,at.HCENTERFIT,C,0,ue)
if(lo)if(ct({x:c+(C-de)/2-4-u,y:l-(u-d)/2,z:a+1,w:u,h:u,img:Vr.sprite,colors:Zr("liked")?Dr:void 0,img_color:Mr,frame:Zr("liked")?Vr.LIKE_ACTIVE:Vr.LIKE}))toggleLiked(se)
l+=d+4
if(m&&Ta("sysadmin")){ai.drawSizedAligned(zr,c,l,a+1,P,at.HCENTERFIT,C,0,"(Admin) This world is frozen")
l+=P+4}var fe=worldInfoToAccessPreset(v)
var ve=itemIndex(et,fe)
var he=et[ve].name_long||et[ve].name
ai.drawSizedAligned(zr,c,l,a+1,P,at.HCENTERFIT,C,0,he)
l+=P+4
if(v.access_public&&!v.access_listed){ai.drawSizedAligned(zr,c,l,a+1,P,at.HCENTERFIT,C,0,Qe.LBL_THIS_WORLD_UNLISTED)
l+=P+4}if(v.booster){ai.drawSizedAligned($e,c,l,a+1,d,at.HCENTERFIT,C,0,Qe.LBL_YOU_ARE_A_BOOSTER)
l+=d+4}if(Dt(v)){Mt(ui,c+(C-So)/2,l,So,yo,"world_info")
l+=yo+4}l=ei(l,N)+8
var pe=[]
if(!_o){pe.push(ho)
if(mr()||rt.defines.WORLD_INFO_MAX)pe.push(po)
if(Er()||rt.defines.WORLD_INFO_MAX)pe.push(mo)
if(!h&&!p&&(isRecentWorld(ui)||rt.defines.WORLD_INFO_MAX))pe.push(Eo)
if(h)pe.push(go)}var me=c-((ki+8)*pe.length-8)/2
for(var Ee=0;Ee<pe.length;++Ee)if(ut({x:me+Ee*(ki+8),y:l,z:a,w:ki,h:u,text:pe[Ee].label,in_event_cb:pe[Ee].pointerlock?it.pointerLockEnter:void 0,disabled:ka()}))pe[Ee].cb(v)
if(pe.length)l+=u+16
var ge=T<At&&!aa()&&!Va()
co=v.spotlit_buzzer
uo={x:0,y:l,w:n,h:i-l}
if(ge)uo.h-=u+8
fo=Gt()&&lo
c=((vo=uo.w/(fo?2:1))-wo)/2
if(fo)l=N+8
else l=startScrollArea(eo.whole,Ji,l,{x:uo.x,y:uo.y,w:uo.w,h:uo.h})
if((E||p)&&_o){var Te=h||p?Qe.WORLDINFO_THIS_IS_MY_WORLD:Qe.WORLDINFO_YOU_ARE_ADMIN
ii.drawSizedAligned(Gr,c,l,a+1,d,at.HCENTER,0,0,Qe.WORLDINFO_ADMIN_PANEL.$({reason:Te}))
l+=d+4
var ye=2.5*ki
var Se=c-(ye+4+4*ki+4)/2
if(E){if(ut({x:Se,y:l,w:2*ki,h:u,text:Qe.BTN_EDIT_WORLD_SETTINGS}))worldInfoShowEditMode()
$i=doAccessDropdown(v,$i,Se+=2*ki+4,l,ye,{centered:true})
Se+=ye+4}else Se=c-2*ki/2
var Ie=worldAdminLogHasNew()
if(ut({x:Se,y:l,w:2*ki,h:u,text:Ie?Qe.addParenthesesAfter(Qe.BTN_WORLD_ADMIN_LOG,Ie):Qe.BTN_WORLD_ADMIN_LOG,hook:h?"new_world_admin_log":void 0}))worldInfoShowAdminLog(!E&&p)
l+=u+4}var Ae=null
if(fo){var we=_o&&!wr()
Ae={x:uo.x,y:l,w:vo,h:uo.y+uo.h-l}
if(co)Ae.h/=2
Ae.y+=x+8+8
Ae.h-=x+8+8
if(we&&(!ge||co))Ae.h-=Gi+6}l+=doWaygateList(f,Ae,o,l,vo-wo,a)
if(co){var Le=La().world_owner&&_o
if(Le)if(ut({x:o+Zi,y:l+(x-u)/2,w:Ao,h:u,font_height:d,text:Qe.BTN_REMOVE_SPOTLIGHT,disabled:Pi}))worldCmdParseGated("spotlit_buzzer_remove",refreshWorldInfo)
var Oe=Qe.separateColon(Qe.LBL_RESULTS,co.d)
var Re=1.5*d
var be=2*Zi+Ao
var Ne=ii.getStringWidth(Gr,Re,Oe)
Ne=ti(Ne,vo-2*Zi)
if(Le)Ne=ti(Ne,vo-Zi-be)
var Ce=c-Ne/2
if(Le&&Ce<o+be)Ce+=be/2
ii.drawSizedAligned(Gr,Ce,l,a+1,Re,at.HCENTERFIT,Ne,0,Oe)
l+=Re+8
l+=lineSep(c,l,a)
var xe=ur(co.st)
if(fo){var Me={x:uo.x,y:l,w:vo,h:uo.y+uo.h-l}
l+=cr(eo.results,xe,Me,false)}else l+=cr(null,xe,{x:_,y:l,w:vo},false)}if(fo)l=startScrollArea(eo.users,Ji,l,{x:uo.x+vo,y:uo.y,w:vo,h:uo.h})
if(lo){var De
if(!E)si=null
var Pe=null==(De=Ya())?void 0:De.boosters
var Be=worldGetUserList(ci&&ci.access_map,defaultClientIDsToAccessLevel,false,Pe),ke=Be.list,Ue=Be.threshold,Ge=Be.seen_users
if(Pe)for(var Fe in Pe){if(Ge[Fe])continue
Ge[Fe]=true
var We="UNKNOWN"
if(Fe===g.user_id)We="OWNER"
else if(ci){var He=ci.access_map&&ci.access_map[Fe]
if(He)We=accessString(He.level)
else We=accessString(Fa())}var ze="UNKNOWN"===We
ke.push({user_id:Fe,role:ze?"":We,rank:ze?-1:accessRank(We),is_booster:Boolean(Pe[Fe]),style:Je[ze?"SPECTATOR":We]||null,state:Ke.OFFLINE,ordinal:0})}var Ve={}
for(var Ye=0;Ye<ke.length;++Ye){var je=ke[Ye].state
Ve[je]=(Ve[je]||0)+1}l+=displayUserList({first_header:true,threshold:Ue,count_by_state:Ve,list:ke,x:0,y:l,w:vo,z:a,font_height:d,row_h:Gi,draw_header:drawUserListHeader})}if(fo)l=finishScrollArea(eo.users,l)
else l=finishScrollArea(eo.whole,l)
c=uo.x+uo.w/2
if(lo&&!Zr("race_data")&&qa())if(ge){if(ut({x:o+n/2-ki,y:i-u,w:2*ki,h:u,text:Kr()?Qe.BTN_PLAYING_AS_VISITOR:Qe.BTN_PLAYING_AS_SELF,in_event_cb:Kr()?null:it.pointerLockEnter})){qr(!Kr())
if(Kr()){Sr.push(Qe.STATUSMSG_PLAYING_AS_VISITOR)
qt.menuExit()}}}else if(Kr())qr(false)}function worldInfoViewStartup(){ai=ht.font
ii=ht.title_font}},{"../common/blueprint_common":240,"../common/effective_access":243,"../common/photo_common":256,"../common/roles_common":260,"../common/waygate_common":265,"../common/world_constants":267,"../glov/client/animation":289,"../glov/client/auto_reset":290,"../glov/client/collapsagories":299,"../glov/client/engine":305,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/link":328,"../glov/client/localization":330,"../glov/client/markdown":332,"../glov/client/net":338,"../glov/client/scroll_area":349,"../glov/client/selection_box":350,"../glov/client/social":357,"../glov/client/sprites":363,"../glov/client/ui":367,"../glov/client/walltime":370,"../glov/common/dot-prop":383,"../glov/common/util":400,"./analytics":6,"./blueprint":28,"./boost_view":31,"./build_mode":33,"./inventory":114,"./layout":120,"./link_parse":125,"./loading_custom":128,"./localization/localization":131,"./main":135,"./main_menu":136,"./menu":140,"./photo_ui":159,"./platform_worlds_client":160,"./race_results":173,"./race_ui":174,"./settlement":181,"./sharing/platform_share_handlers":185,"./sky":188,"./status":193,"./stuck":196,"./styles":197,"./ui_util":205,"./user_data":208,"./user_info_view":210,"./user_party":211,"./user_profile_view":212,"./wallet_ui":221,"./waygate_ui":222,"./waygate_upgrade":223,"./world_comm":226,"./world_comm_effective_access":227,"./world_info":229,"./world_management":234,"./world_metadata":235,"./worlds_sound":236,assert:void 0,"glov-async":void 0}],232:[function(e,t,r){"use strict"
r.worldInitStart=worldInitStart
r.worldInitTick=worldInitTick
var i=e("assert")
var a=e("../glov/common/vmath")
var d=a.v2add
var v=a.v3add
var f=a.v3iFloor
var h=a.v3set
var p=a.vec2
var m=a.vec3
var E=e("../common/globals").ID_FACTOR
var o=e("../common/ids")
var g=o.ITEM_PLANT
var n=o.ITEM_TORCH
var T=o.ITEM_WAYGATE
var y=o.TYPE_BLOCK
var S=o.TYPE_ITEM
var s=e("../common/materials_common").Mat
var I=e("../common/waygate_common").FLAT_SEED_EMPTY
var A=e("../common/world_trans").createTransSet
var l=e("./continent_loader").continentLoaderWhenReady
var w=e("./items").createItem
var L=e("./main")
var _=e("./proc_gen_biomes")
var O=_.getHexome
var R=_.getVerticalSliceById
var b=_.getVerticalSliceWorldPos
var c=e("./proc_gen_constants").HEX_HEIGHT
var N=e("./proc_gen_hydro").initPhase37
var C=e("./props")
var u=e("./tiles")
var x=u.TILE_INTANGIBLE
var M=u.TILE_PROP_BASE
var D=u.TILE_PROP_MAX
var P=u.TILE_STONE_LIGHT
var B=e("./voxel_data")
var k=B.andGetLiquid
var U=B.andGetProp
var G=B.getPropLocalExact
var F=B.getTileLocal
var W=B.getTileRelative
var H=B.localPosFromWorldPos
var z=B.posPairFromLocalIntPos
var V=B.transPropRemove
var Y=B.transSetPropLocal
var j=B.transSetTileLocal
var K=e("./world_comm")
var q=e("./world_comm")
var Z=q.getWorldChannel
var X=q.transact
var Q=q.worldSend
var $=e("./world_metadata")
var J=$.adventureMode
var ee=$.worldMetadata
var te=Math.abs,re=Math.cos,ae=Math.sin,ie=Math.PI
var oe=[-1,1,-E,E]
function searchHexome(e,t){var r=O(e)
if(t>=1){var a=r.params.spawn_weight
if(a>=0||2===t)return[b(r.pos_world).vsid,a]
return null}N(r)
if(!r.hydro_paths||r.river_mouth)return null
var i=null
var o=-Infinity
for(var n=0;n<r.hydro_paths.length;++n){var s=r.hydro_paths[n]
for(var l=0;l<s.length;++l){var _=R(s[l][3])
var c=_.mid_elevation
var u=_.owner_hexome.params.spawn_weight
if(u<=0)continue
if(c<=_.owner_hexome.water_level)continue
var d=0
var f=_.vsid
for(var v=0;v<oe.length;++v){var h=f+oe[v]
var p=R(h)
d+=te(p.mid_elevation-c)}var m=u-.03*d
if(m>o&&d<10){i=f
o=m}}}return i?[i,o]:null}var ne=[[1,0],[0,-1],[-1,0],[0,1],[1,0]]
var se=p(10,10)
function findGoodSpawn(e){var t=p()
var r=O(se[0]+se[1]*E).continent
if(!r)return 0
r.getMidpointHexomePos(t)
var a=p()
var i={}
var o=0
function walkSearch(){d(t,t,ne[o])
d(a,t,ne[o+1])
if(!i[a.join()])o=(o+1)%4}var n=null
var s=0
var l=0
do{var _=t[0]+t[1]*E
var c=t.join()
i[c]=true
console.log("Searching Hexome "+_+" for good spawn...")
var u=searchHexome(_,e)
if(u){++l
console.log("Hexome "+_+", VS "+u[0]+" valid, weight="+u[1])
if(!n||u[1]>n[1]||u[1]===n[1]&&u[0]<n[0])n=u}walkSearch()
if(5e3===++s)return-1}while(l<10)
return n[0]}var le
var _e
var ce
var ue
function waitForContinent(){return 7}function findSpawn(e){var t=Date.now()
if(-1===(le=findGoodSpawn(0)))if(Z().getChannelData("public.modapi_continent_data")){console.error("Unable to find good spawn, using fallback for mod-api provided continents")
if(-1===(le=findGoodSpawn(1))){console.error("Unable to find bad spawn, using final fallback for mod-api provided continents")
le=findGoodSpawn(2)
i(-1!==le)}}else i(false,"Unable to find valid spawn in new world")
var r=R(le)
if("flat"===ee().world_type)_e=-1
else _e=r.mid_elevation
var a=(ce=m(r.pos_world[0]+7,r.pos_world[1]+7,_e+5)).join()+",0,0"
console.log("Found spawn = "+le+" ("+_e+") in "+(Date.now()-t)+"ms")
ue=findWaygatePos
e(a)
return 6}function worldInitStart(e){ue=waitForContinent
l([se[0]*c*1.5,se[1]*c],1,function(){ue=findSpawn.bind(null,e)})}var de=[[0,0],[0,1],[1,0],[1,1],[-1,0],[-1,1],[2,0],[2,1],[0,-1],[1,-1],[0,2],[1,2]]
var fe=m()
function isSolid(){var e=W(0,fe,-1,false)
i(-1!==e)
if(e&&e<x)return true
return false}function isOpen(){var e=W(0,fe,-1,false)
i(-1!==e)
if((!e||e===M&&U().item_id===g)&&!k())return true
return false}function validWaygatePos(e){var t=e[2]
for(var r=0;r<de.length;++r){d(fe,e,de[r])
fe[2]=t-1
if(!isSolid())return false
fe[2]=t
if(!isSolid()&&!isOpen())return false
for(var a=0;a<4;++a){fe[2]=t+a+1
if(!isOpen())return false}}return true}var ve=[[0,-7,-10,0],[-7,0,-10,3],[0,7,-10,2],[7,0,-10,1]]
var he
var pe
function findWaygatePos(){var e=m()
if("flat"===ee().world_type)h(e,ce[0],ce[1],_e)
else{var t=20
var r=0
var a=false
do{t++
r+=2*ie/11
h(e,ce[0]+re(r)*t,ce[1]+ae(r)*t,_e-10)
f(e)
for(var i=0;i<30;++i){if(validWaygatePos(e)){e[2]++
if(!validWaygatePos(e))e[2]--
a=true
break}e[2]++}}while(!a)}console.log("Found valid waygate position at "+e)
he=e
var o=m()
var n=null
for(var s=0;s<ve.length;++s){v(o,e,ve[s])
for(var l=0;l<30;++l){if(validWaygatePos(o)){var _=te(o[2]-e[2])
if(!n||_<n[1])n=[s,_,o[2]]
break}o[2]++}}var c
var u=0
if(!n){c=v(m(),e,[1,1,5])
pe=0}else{var d=n[0]
c=[e[0]+ve[d][0]+1,e[1]+ve[d][1]+1,n[2]+5]
u=90*d
pe=ve[d][3]}L.char_controller.updatePosFromString(c.join(",")+","+u+",0",false)
ue=placeWaygate
return 5}var me
var Ee=[[[0,0,0],null],[[0,1,0],null],[[1,0,0],null],[[1,1,0],null],[[-1,-1,0],{type:y,id:P}],[[0,-1,0],{type:y,id:P}],[[1,-1,0],{type:y,id:P}],[[2,-1,0],{type:y,id:P}],[[2,0,0],{type:y,id:P}],[[2,1,0],{type:y,id:P}],[[2,2,0],{type:y,id:P}],[[1,2,0],{type:y,id:P}],[[0,2,0],{type:y,id:P}],[[-1,2,0],{type:y,id:P}],[[-1,1,0],{type:y,id:P}],[[-1,0,0],{type:y,id:P}],[[-1,-1,1],{type:S,id:n,attr1:s.LIGHT_WOOD}],[[-1,2,1],{type:S,id:n,attr1:s.LIGHT_WOOD}],[[2,2,1],{type:S,id:n,attr1:s.LIGHT_WOOD}],[[2,-1,1],{type:S,id:n,attr1:s.LIGHT_WOOD}]]
function placeWaygate(){var e=m()
H(e,he)
me=z(e)
var t=G(e)
if(t&&t.item_id===T){ue=setMetadata
return 4}var r=A()
var a=r.trans()
var i=J()||"flat"===ee().world_type&&ee().seed===I?Ee.length:4
var o=[]
for(var n=0;n<i;++n){var s=Ee[n][0]
v(fe,e,s)
var l=F(fe,0,false)
if(l)if(l>=M&&l<=D)if(U().item_id===g)V(a,U(),true,false)
else o[n]=true
else j(a,fe,0,false,false,l,true)}var _=C.createFromInv(w({type:S,id:T}))
_.setRot(pe)
Y(a,e,_,true,true)
for(var c=0;c<i;++c){var u=Ee[c],d=u[0],f=u[1]
if(o[c]||!f)continue
v(fe,e,d)
if(f.type===y)j(a,fe,f.id,false,false,0,true)
else{_=C.createFromInv(w(f))
Y(a,fe,_,true,true)}}ue=waitForPlace
a.onComplete(function(){ue=setMetadata})
X(r)
return 4}function waitForPlace(){return 3}function setMetadata(){var e={wgid:"default",chunk_id:me[0],pos_idx:me[1],rot:pe,is_settlement:Boolean(J())}
Q("waygate_set",e,function(e){if(e)console.warn(e)
if(!K.world_channel)return
K.world_channel.pak("world_init_finished").send(function(e){if(e)L.chat_ui.addChatError(e)
ue=stageDone})})
ue=waitForMetadataSet
return 2}function waitForMetadataSet(){return 1}function stageDone(){return 0}function worldInitTick(){return ue()}},{"../common/globals":248,"../common/ids":249,"../common/materials_common":253,"../common/waygate_common":265,"../common/world_trans":268,"../glov/common/vmath":402,"./continent_loader":47,"./items":119,"./main":135,"./proc_gen_biomes":163,"./proc_gen_constants":164,"./proc_gen_hydro":167,"./props":171,"./tiles":199,"./voxel_data":216,"./world_comm":226,"./world_metadata":235,assert:void 0}],233:[function(e,t,r){"use strict"
r.worldListInitContext=worldListInitContext
r.worldListShow=worldListShow
r.getLastWorldCount=getLastWorldCount
r.worldListHeader=worldListHeader
r.worldListHome=worldListHome
r.worldListContentEditActive=worldListContentEditActive
r.worldListContentEditClear=worldListContentEditClear
r.worldListContentEditButton=worldListContentEditButton
r.worldListContentEdit=worldListContentEdit
r.worldListOther=worldListOther
r.worldListSearchFocused=worldListSearchFocused
r.worldListSearch=worldListSearch
r.worldListOnTabChange=worldListOnTabChange
r.worldListStartup=worldListStartup
var f=e("../glov/client/camera2d")
var v=e("../glov/client/edit_box").editBoxCreate
var k=e("../glov/client/font").ALIGN
var h=e("../glov/client/input").inputTouchMode
var a=e("../glov/client/net")
var o=a.netClient
var U=a.netSubs
var G=e("../glov/client/settings")
var i=e("../glov/client/social")
var F=i.friendsGet
var W=i.isFriend
var n=e("../glov/client/ui")
var p=n.buttonImage
var H=n.buttonText
var g=n.getUIElemData
var m=n.uiButtonHeight
var s=n.uiGetFont
var l=n.uiGetTitleFont
var z=n.uiTextHeight
var V=e("../glov/client/urlhash")
var _=e("../common/world_constants").WORLD_ACCESS_MODIFY_BUILDER
var Y=e("./analytics").logEventOnce
var j=e("./create_new_world").createWorldUIInit
var K=e("./localization/localization").L
var c=e("./main").chatUI
var u=e("./main_menu")
var d=u.enterAccessTokenInit
var q=u.mainMenuJustEnteredAccessToken
var E=u.mainMenuScroll
var T=e("./menu").menuDoTransition
var y=e("./store")
var X=y.canPurchaseProductId
var S=y.gameCurrencyPurchase
var I=e("./styles")
var A=I.color_black
var w=I.loading_style
var Q=I.menu_header_style
var $=I.menu_style
var L=I.sublabel_style
var O=e("./ui_util")
var J=e("./user_info_view").userInfoGet
var R=e("./waygate_ui").waygateLinkUI
var b=e("./world_comm")
var ee=b.getPerm
var N=b.worldGoByURL
var C=e("./world_info")
var te=C.getWorldInfo
var x=C.worldInfoCacheClear
var M=e("./world_info_view").worldLink
var D=e("./world_management").isDoingWorldOp
var re=Math.ceil,P=Math.floor,B=Math.max,ae=Math.min
var ie=100
var oe=48
var ne=172
var se=4*ne/3
var le=200
var _e
var ce
var ue
function worldListInitContext(e){var t=e.scroll_param
ue=P((t.w-36)/(se+8))
e.y_min-=ne
e.y_max+=ne}var de=0
var fe=0
function cmpActiveWorlds(e,t){var r=(e.full?1:0)-(t.full?1:0)
if(r)return r
var a=e.waygates&&e.waygates.default&&e.waygates.default.imgid
var i=t.waygates&&t.waygates.default&&t.waygates.default.imgid
var o=e.players
if(!e.unlimited&&e.access_modify>=_&&o&&a)o+=de
if(e.boost_count&&o)o+=fe
var n=t.players
if(!t.unlimited&&t.access_modify>=_&&n&&i)n+=de
if(t.boost_count&&n)n+=fe
if(r=n-o)return r
if(a&&!i)return-1
else if(i&&!a)return 1
return e.created-t.created}var ve={}
function autoForget(r){if(ve[r])return
ve[r]=true
o().send("world_forget",r,null,function(e,t){if(e)console.error("Error forgetting "+r+": "+e)})}function showEnterAccessToken(e){if(H({x:0,y:e.y,h:.5*m(),w:le,text:K.LBL_ACCESS_TOKEN_ENTER}))d()}function allocShowWorldElemData(e){var t=e.key
var r=t.split("$"),a=r[0],i=r[1]
return{w:se,h:ne,target:{wid:i},url:M(i,"info"),img_style:"preview",key:t,ctx:a}}var he=5
var pe
function showWorld(e,t,r,a,i,o,n,s){var l=t.my_worlds,_=t.allow_join,c=t.recent_worlds
var u=l[i]&&l[i].name
var d=D()||!_
o=o||te(i,false)
if(c[i]&&o&&o.err&&"ERR_DOES_NOT_EXIST"===o.err)autoForget(i)
var f=g("main_show_world",{key:a+"$"+i},allocShowWorldElemData)
f.x=r
f.y=e
f.disabled=d
f.world_data=o
f.name_guess=u
f.show_private=!n
f.frozen="mine"===a&&l[i]&&l[i].frozen
if(R(f)){T()
if("NEW"===i)j()
else if("EXTRA_SLOT"===i)S("orb","extra_world_slot",1,K.LBL_EXTRA_WORLD_SLOT,"extra_world_slot")
else N(i,"info")
t.allow_join=false}if(s&&s.length){var v=e+ne+8
var h=z()
var p=h+4
for(var m=0;m<s.length&&m<he;++m){var E=s[m]
if(m!==s.length-1&&m===he-1)E=s.length-m+" more..."
_e.drawSizedAligned($,r,v,Z.UI,h,k.HCENTERFIT,se,0,E)
pe=B(pe,v+=p)}}}function worldListShow(e,t,r,a,i,o,n){var s=t.y_min,l=t.y_max,_=t.all_worlds_info
var c=t.dims.x_mid
var u=se
var d=8
var f=ae(ue*i,a.length)
var v=re(f/ue)
var h=0
for(var p=0;p<v;++p){pe=e+ne
var m=ae(ue,f-h)
var E=c-(m*(u+d)-d)/2
for(var g=0;g<m;++g){var T=a[h++]
if(e+ne>=s&&e<l)showWorld(e,t,E+g*(u+d),r,T=String(T),_[T],o,n&&n[T])}e=pe+8}return e}var me=0
function getLastWorldCount(){return me}function worldListHeader(e,t,r,a,i,o){var n=z()
t+=8
if(a){ce.drawSizedAligned(Q,e,t,Z.UI,1.5*n,k.HCENTERFIT,r,0,a)
t+=1.5*n}if(i){_e.drawSizedAligned(o||L,e,t,Z.UI,.8*n,k.HCENTERFIT,r,0,i)
t+=.8*n}return t+8}function worldListHome(n,e){worldListInitContext(n)
var s=z()
var l=n.my_worlds,_=n.recent_worlds,c=n.all_worlds_info,t=n.dims
var u=t.w,d=t.x_mid
var f=0
var v=t.y
if(ee("sysadmin"))U().getChannelImmediate("worldlist.active")
if("createworld"===V.get("page"))j()
var r={}
function showFeaturedWorlds(e){if(e.length){var r
e=e.filter(function(e){var t=c[e]
if(t&&t.full){(r=r||[]).push(e)
return false}return true})
if(r)e=e.concat(r)
v=worldListShow(v=worldListHeader(f,v,u,K.LBL_FEATURED_WORLDS),n,"featured",e,2,false)}}function showFriendsInWorld(e,t){if(e.length)v=worldListShow(v=worldListHeader(f,v,u,K.LBL_FRIENDS_IN_WORLD),n,"friends",e,2,false,t)}var a
var i
var o
function showActiveWorlds(e){if(!e.length){v+=8
_e.drawSizedAligned($,f,v,Z.UI,s,k.HCENTER,u,0,a?K.MSG_ACTIVE_WORLDS_NOT_FOUND:K.MSG_ACTIVE_WORLDS_QUERYING)
v+=s+8}else{var t=i&&o?K.LBL_WORLDS_ACTIVE_AND_RECENT:i?K.LBL_WORLDS_ACTIVE:o?K.LBL_WORLDS_RECENT:K.LBL_WORLDS
v=worldListShow(v=worldListHeader(f,v,u,t),n,"active",e,ie,false)}}function showMyWorlds(){function cmpMyWorlds(e,t){if("EXTRA_SLOT"===e)return 1
else if("EXTRA_SLOT"===t)return-1
if("NEW"===e)return 1
else if("NEW"===t)return-1
var r=l[e]
return l[t].created-r.created}var e=[]
var t=[]
for(var r in l)if(l[r].frozen)t.push(r)
else e.push(r)
me=e.length
var a=ee("max_worlds")
if(!me&&!a){v+=16
_e.drawSizedAligned($,f,v,Z.UI,s,k.HCENTER,u,0,K.MSG_LOADING)
v+=s+4}else{Y("world_count",Number(me),null,null,{quota:a})
v+=8
ce.drawSizedAligned(Q,d,v,Z.UI,1.5*s,k.HCENTER|k.VCENTER,0,oe,K.addParenthesesAfter(K.LBL_MY_WORLDS,K.$(K.FORMAT_FRACTION,me,a)))
v+=oe+8
var i=e
if(me<a)i.push("NEW")
if(me>0&&X("extra_world_slot"))i.push("EXTRA_SLOT")
if(i.length){i.sort(cmpMyWorlds)
v=worldListShow(v,n,"mine",i,Infinity,true,null)}if(t.length){v+=8
var o=ce.drawSizedAligned(Q,d,v,Z.UI,1.5*s,k.HCENTER|k.VCENTER,0,oe,K.addParenthesesAfter(K.LBL_MY_WORLDS_FROZEN,t.length))
if(H({x:d-o/2-8-oe,y:v,w:oe,h:oe,font_height:oe,text:G.show_frozen_worlds?"▼":"▶"}))G.set("show_frozen_worlds",1-G.show_frozen_worlds)
v+=oe+8
if(G.show_frozen_worlds){t.sort(cmpMyWorlds)
v=worldListShow(v,n,"frozen",t,Infinity,true,null)}}}}a=te("all",false)
de=a&&a.sort_lf_bias||0
fe=a&&a.sort_boost_bias||0
if(a&&a.err)a=null
if(a)a=a.list.filter(function(e){if(!e.owner_id)return false
return true})
for(var h=0;h<e.length;++h)r[e[h]]=true
var p=F()
var m=[]
var E={}
for(var g in p)if(W(g)){var T=J(g)
var y=T.display_name,S=T.presence_data
var I=S&&S.payload&&S.payload.world_id
if(I){var A=te(I,false)
if(!A||!A.user_access)continue
if(!E[I]){E[I]=[]
m.push(I)}E[I].push(y||g)}}m.sort(function(e,t){var r=E[t].length-E[e].length
if(r)return r
return e<t?-1:1})
for(var w=0;w<m.length;++w)r[m[w]]=true
var L=Object.keys(_);(L=L.filter(function(e){return!l[e]&&!r[e]})).sort(function(e,t){return _[t].when-_[e].when})
var O=ue*ie
var R=2*ue
var b=[]
var N={}
o=ae(re(ue/2),L.length)
for(var C=0;C<o;++C){var x=L[C]
N[x]=true
b.push(x)}var M=[]
if(a){a.sort(cmpActiveWorlds)
M=a.map(function(e){return(c[e.world_id]=e).world_id}).filter(function(e){return!l[e]&&!N[e]&&!r[e]})}i=ae(M.length,O-b.length)
for(var D=0;D<i;++D){var P=M[D]
N[P]=true
b.push(P)}if(o<L.length&&b.length<R){L=L.filter(function(e){return!N[e]})
var B=R-b.length
b=b.concat(L.slice(0,B))}b.sort(function(e,t){var r=c[e]
var a=c[t]
if(r)if(a)return cmpActiveWorlds(r,a)
else return r.full?1:-1
else if(a)return a.full?-1:1
var i=_[e]
var o=_[t]
if(i&&o)return o.when-i.when
return e<t?-1:1})
if(!q()){t.y=v
showEnterAccessToken(t)
v=t.y}showMyWorlds()
showFriendsInWorld(m,E)
showFeaturedWorlds(e)
showActiveWorlds(b)
t.y=v}var Ee=false
function worldListContentEditActive(){return Ee}function worldListContentEditClear(){Ee=false}var ge
function worldListContentEditButton(e){var t=e.dims.y
if(H({x:le+8,y:t,h:.5*m(),w:le,text:"(Admin) Edit"})){Ee=!Ee
ge=null}}function worldListContentEdit(e,t,r,a){var i=e.w
var o=le
var n=Z.UI
var s=r+o+8
if(Ee){if(!ge)ge=v({w:i/4,text:JSON.stringify(t,void 0,2),initial_focus:true,spellcheck:false,multiline:20,enforce_multiline:false,zindex:1})
var l=ge.getText()
var _=false
try{t=JSON.parse(l)}catch(e){_=true}if(H({x:s,y:a,z:n,h:.5*m(),w:o,text:K.BTN_SAVE,disabled:_})){c().cmdParse("worldlist_content "+JSON.stringify(t))
x()}if(H({x:s+=o+8,y:a,z:n,h:.5*m(),w:o,text:K.BTN_CANCEL}))Ee=false}a+=.5*m()
if(Ee)ge.run({x:r,y:a+8})
return t}function worldListOther(e,t,r){worldListInitContext(e)
var a=t[r]||{}
if(!a.sections)return
var i=e.dims
var o=i.w
var n=0
var s=i.y
for(var l=0;l<a.sections.length;++l){var _=a.sections[l]
s=worldListHeader(n,s,o,_.title,_.subtitle)
if(_.worlds&&_.worlds.length)s=worldListShow(s,e,"tab"+r+"."+l,_.worlds,Infinity,false,null)}i.y=s}var Te={text:"",sort:"likes",edit:false,adventure:false}
var ye
var Se
var Ie=false
var Ae
var we
var Le
var Oe=50
function updateSearch(){var e=Te.sort,t=Te.edit,r=Te.text,a=Te.adventure
var i=[e,t,r,a].join()
if(i===ye||!o().connected||Ie)return
ye=i
Se=[]
Ie=true
we=false
Le={text:r||void 0,sort:e,filter_edit:t?1:void 0,filter_unlimited:a?0:void 0,limit:Oe}
o().send("world_search",Le,null,function(e,t){Ie=false
if(e){console.error(e)
return}Se=t.worlds
Ae=t.search_after})}function searchMore(){if(Ie||we||!Ae)return
Ie=true
Le.search_after=Ae
o().send("world_search",Le,null,function(e,t){Ie=false
if(e){console.error(e)
we=true
return}if(!t.worlds.length){we=true
return}Ae=t.search_after
var r={}
for(var a=0;a<Se.length;++a)r[Se[a]]=true
for(var i=0;i<t.worlds.length;++i){var o=t.worlds[i]
if(!r[o]){Se.push(o)
r[o]=true}}})}var Re
function worldListSearchFocused(){return Re&&Re.isFocused()}var be=false
function worldListSearch(e){worldListInitContext(e)
var t=e.dims
var r=t.y
var a=Z.UI
if(!Re)Re=v({placeholder:K.LBL_SEARCH,initial_select:false,auto_unfocus:true,max_len:40,text:Te.text})
var i=2*z()
var o=m()
var n=i
if(h())n=o
r+=8
var s=0
var l=.5*o
var _=Boolean(Te.text)
var c=ae(370,f.w()-726)
var u=Re.run({x:s,y:r+(o-n)/2,w:c,font_height:n,initial_focus:!h()&&be})
be=false
if(u===Re.SUBMIT||!Re.isFocused())Te.text=Re.getText()
else if(u===Re.CANCEL){Re.setText("")
Te.text=""}s+=c+32
O.sprite.draw({x:s,y:r+(o-l)/2,z:a,w:l,h:l,frame:O.SORT})
s+=l+8
function sortButtonParam(e,t){t.x=s
t.y=r
t.w=o
t.font_height=i
t.img=O.sprite
t.img_color=A
t.disabled=Te.sort===e
t.disabled_mouseover=true
t.base_name=t.disabled?"inv_selected":void 0
return t}if(_){if(H(sortButtonParam("name",{text:K.BTN_SORT_ALPHABETICALLY,tooltip:K.TLTP_SORT_BY_NAME})))Te.sort="name"
s+=o+8}else if("name"===Te.sort)Te.sort="likes"
if(p(sortButtonParam("likes",{frame:O.LIKE,tooltip:K.TLTP_SORT_BY_LIKES})))Te.sort="likes"
s+=o+8
if(p(sortButtonParam("views",{frame:O.VIEWS,tooltip:K.TLTP_SORT_BY_VIEWS})))Te.sort="views"
s+=o+8
s+=20
O.sprite.draw({x:s,y:r+(o-l)/2,z:a,w:l,h:l,frame:O.FILTER})
if(p({x:s+=l+8,y:r,img:O.sprite,frame:O.GATHERING_TOOLS,img_color:Te.edit?null:A,base_name:Te.edit?"inv_selected":null,tooltip:Te.edit?K.TLTP_SEARCH_WORLDS_BUILDER:K.TLTP_SEARCH_WORLDS_ALL}))Te.edit=!Te.edit
if(p({x:s+=o+8,y:r,img:O.sprite,frame:O.ADVENTURE_MODE,img_color:Te.adventure?null:A,base_name:Te.adventure?"inv_selected":null,tooltip:Te.adventure?K.TLTP_SEARCH_WORLDS_LF:K.TLTP_SEARCH_WORLDS_ALL}))Te.adventure=!Te.adventure
s+=o+8
s=0
r+=o+16
updateSearch()
r=worldListShow(r,e,"search",Se,Infinity,false,null)
var d=E()
if(d.getScrollPos()+d.h>r-d.h)searchMore()
if(Ie){r+=24
_e.drawSizedAligned(w,f.w()/2,r,a,i,k.HCENTER,0,0,K.MSG_SEARCHING)
r+=i+8}t.y=r}function worldListOnTabChange(){be=true}function worldListStartup(){_e=s()
ce=l()}},{"../common/world_constants":267,"../glov/client/camera2d":295,"../glov/client/edit_box":303,"../glov/client/font":315,"../glov/client/input":326,"../glov/client/net":338,"../glov/client/settings":351,"../glov/client/social":357,"../glov/client/ui":367,"../glov/client/urlhash":369,"./analytics":6,"./create_new_world":70,"./localization/localization":131,"./main":135,"./main_menu":136,"./menu":140,"./store":195,"./styles":197,"./ui_util":205,"./user_info_view":210,"./waygate_ui":222,"./world_comm":226,"./world_info":229,"./world_info_view":231,"./world_management":234}],234:[function(e,t,r){"use strict"
r.isDoingWorldOp=isDoingWorldOp
r.clearDoingWorldOp=clearDoingWorldOp
r.createWorld=createWorld
r.deleteWorld=deleteWorld
r.forgetWorld=forgetWorld
r.getDefaultWorldName=getDefaultWorldName
var i=e("assert")
var a=e("../glov/client/net")
var o=a.netClient
var n=a.netDisconnected
var s=e("../glov/client/ui").modalDialog
var l=e("./analytics").logEvent
var _=e("./continent_loader").continentLoaderProvideC0
var c=e("./localization/localization").L
var u=e("./main").menuExit
var d=e("./mod_api_host")
var f=d.modContinentDataAvailable
var v=d.modContinentDataGet
var h=e("./user_profile_view").userProfileViewInvalidateWorldList
var p=e("./world_comm")
var m=p.getWorldID
var E=p.joinWorld
var g=p.whenConnected
var T=e("./world_list").getLastWorldCount
var y=false
var S=false
function isDoingWorldOp(){return S||y}function clearDoingWorldOp(){S=y=false}function createWorld(r,a){if("adventure"===r.world_mode){r.world_type="v1"
r.unlimited=false}else r.unlimited=true
if("flat"===r.world_type){r.time_scale=0
r.time_offs=10}l("world_new",1,r.world_mode,r.world_type)
y=true
g(function(){o().send("world_create",r,null,function(e,t){if(a)a()
y=false
if(e)s({title:c.DLG_ERROR_WORLD_CREATE_TITLE,text:e,buttons:{ok:null}})
else{i(t)
h()
console.log("Created world "+t.world_id)
if("flat"!==r.world_type&&f())_(v())
if(!m())E(t.world_id)}})})}function deleteWorld(r){if(n())return void s({title:c.DLG_ERROR_WORLD_DELETE_TITLE,text:c.ERR_DISCONNECTED,buttons:{ok:null}})
S=true
o().send("world_delete",r,null,function(e,t){S=false
if(e)s({title:c.DLG_ERROR_WORLD_DELETE_TITLE,text:e,buttons:{ok:null}})
else{h()
u()
console.log("Deleted world "+r)
l("world_delete",1,void 0,String(r))}})}function forgetWorld(r){if(n())return void s({title:c.DLG_ERROR_WORLD_FORGET_TITLE,text:c.ERR_DISCONNECTED,buttons:{ok:null}})
S=true
o().send("world_forget",r,null,function(e,t){S=false
if(e)s({title:c.DLG_ERROR_WORLD_FORGET_TITLE,text:e,buttons:{ok:null}})
else{u()
console.log("Forgot world "+r)
l("world_forget",1,void 0,String(r))}})}function getDefaultWorldName(){var e=T()
return""+(e?c.addParenthesesAfter(c.LBL_MY_WORLD,String(e)):c.LBL_MY_WORLD)}},{"../glov/client/net":338,"../glov/client/ui":367,"./analytics":6,"./continent_loader":47,"./localization/localization":131,"./main":135,"./mod_api_host":146,"./user_profile_view":212,"./world_comm":226,"./world_list":233,assert:void 0}],235:[function(e,t,r){"use strict"
r.worldUserDistance=worldUserDistance
r.worldMetadata=worldMetadata
r.worldMetadataReset=worldMetadataReset
r.unlimitedMode=unlimitedMode
r.adventureMode=adventureMode
r.worldMetadataFreePos=worldMetadataFreePos
r.worldPhotoMove=worldPhotoMove
r.worldToolLock=worldToolLock
r.worldLiquid=worldLiquid
r.worldFlora=worldFlora
r.worldEnforcePropPlacement=worldEnforcePropPlacement
r.worldConsumables=worldConsumables
r.worldOxygen=worldOxygen
r.worldFallDamage=worldFallDamage
r.worldShowNames=worldShowNames
r.worldMetadataWaygates=worldMetadataWaygates
r.worldMetadataWaygate=worldMetadataWaygate
r.worldAccessLeapgate=worldAccessLeapgate
r.worldAccessExvolume=worldAccessExvolume
r.worldAccessSaplings=worldAccessSaplings
r.worldAccessSettlement=worldAccessSettlement
r.worldAccessAreaClear=worldAccessAreaClear
r.worldHasGems=worldHasGems
r.worldInventoryClone=worldInventoryClone
r.worldInventoryGeneration=worldInventoryGeneration
r.worldAccessDefault=worldAccessDefault
r.worldRaceAsVisitor=worldRaceAsVisitor
r.worldSpotlitBuzzer=worldSpotlitBuzzer
r.worldSeed=worldSeed
r.worldItemDrop=worldItemDrop
r.worldFactories=worldFactories
r.worldEnergy=worldEnergy
r.worldSettlements=worldSettlements
r.worldAccessUnlimitedItems=worldAccessUnlimitedItems
r.worldAccessGiveItems=worldAccessGiveItems
r.worldMetadataDefaultWaygatePos=worldMetadataDefaultWaygatePos
r.worldMetadataSet=worldMetadataSet
r.worldApplyMetadataToInventory=worldApplyMetadataToInventory
r.worldMetadataUpdate=worldMetadataUpdate
r.worldMetadataDelete=worldMetadataDelete
r.worldBuildQueue=worldBuildQueue
r.worldBoostPerk=worldBoostPerk
r.worldBoostLevel=worldBoostLevel
r.worldBoostLevelForProps=worldBoostLevelForProps
r.worldBoostRewards=worldBoostRewards
r.worldBoosters=worldBoosters
r.worldUserIsBoosting=worldUserIsBoosting
r.worldAmIBooster=worldAmIBooster
r.worldOwnerID=worldOwnerID
r.worldBoostIcon=worldBoostIcon
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i=e("assert")
var a=e("../glov/client/cmds").cmd_parse
var o=e("../glov/client/net").netUserId
var n=e("../glov/client/urlhash")
var s=e("../glov/common/dot-prop").dotPropDelete
var l=e("../glov/common/util").has
var _=e("../common/world_constants")
var c=_.ACCESS_BUILDER
var u=_.ACCESS_NONE
var d=_.ACCESS_NONE_HIGH
var f=_.BOOST_MAX_LEVEL
var v=_.BOOST_PERKS
var h=_.DEFAULT_ACCESS_AREA_CLEAR
var p=_.DEFAULT_ACCESS_EXVOLUME
var m=_.DEFAULT_ACCESS_GIVE_ADVENTURE
var E=_.DEFAULT_ACCESS_GIVE_UNLIMITED
var g=_.DEFAULT_ACCESS_LEAPGATE
var T=_.DEFAULT_ACCESS_SAPLING
var y=_.DEFAULT_ACCESS_SETTLEMENT
var S=_.DEFAULT_ACCESS_UNLIMITED_ITEMS_ADVENTURE
var I=_.DEFAULT_ACCESS_UNLIMITED_ITEMS_UNLIMITED
var A=_.DEFAULT_RACE_AS_VISITOR_LF
var w=_.DEFAULT_RACE_AS_VISITOR_UNL
var L=_.DEFAULT_TOOL_LOCK_ADVENTURE
var O=_.DEFAULT_TOOL_LOCK_UNLIMITED
var R=_.TOOL_LOCK_CRAFTED
var b=_.WORLD_RACE_AS_VISITOR_AUTO
var N=_.WORLD_RACE_AS_VISITOR_ON
var C=_.boostLevelFromCount
var x=e("./chat_ui_worlds").boostOnWorldMetadataChange
var M=e("./client_cmds").waygateToPosStr
var D=e("./editvolume_client").resetEditVolumes
var P=e("./inventory")
var B=P.assignLockedTools
var k=P.inventoryApplyGeneration
var U=P.inventoryWhenPlayerUnlocked
var G=e("./main").returnToMainMenu
var F=e("./mobs").mobsOnWorldMetadataChange
var W=e("./settlement").settlementUpdate
var H=e("./voxel_data").voxelDataWorldMetaChanged
var z=null
function worldUserDistance(){i(z)
return z.user_distance||Infinity}var V=0
a.registerValue("admin_free_pos",{type:a.TYPE_INT,label:"Local world_free_pos override",range:[0,1],access_run:["sysadmin"],get:function get(){return V},set:function set(e){return V=e}})
var Y=0
a.registerValue("admin_photo_move",{type:a.TYPE_INT,label:"Local world_photo_move override",range:[0,1],access_run:["sysadmin"],get:function get(){return Y},set:function set(e){return Y=e}})
var j=-1
a.registerValue("admin_tool_lock",{type:a.TYPE_INT,label:"Local world_tool_lock override, -1 to disable",range:[-1,4],access_run:["sysadmin"],get:function get(){return j},set:function set(e){return j=e}})
function worldMetadata(){return z}function worldMetadataReset(){z=null}function unlimitedMode(){return Boolean(z&&z.unlimited)}function adventureMode(){return Boolean(z&&!z.unlimited)}function worldMetadataFreePos(){return Boolean(V||z&&z.free_pos)}function worldPhotoMove(){return Boolean(Y||z&&z.photo_move)}function worldToolLock(){var e=z?z.tool_lock:R
if(void 0===e)e=adventureMode()?L:O
return-1!==j?j:e}function worldLiquid(){if(!z)return false
if(void 0===z.liquid||z.liquid)return true
else return false}function worldFlora(){if(!z)return false
if(void 0===z.flora||z.flora)return true
else return false}function worldEnforcePropPlacement(){if(!z)return false
if(void 0===z.prop_placement||z.prop_placement)return true
else return false}function worldConsumables(){if(!z)return false
if(void 0===z.consumables&&adventureMode()||z.consumables)return true
else return false}function worldOxygen(){if(!z)return false
if(void 0===z.o2||z.o2)return true
else return false}function worldFallDamage(){if(!z)return false
if(void 0===z.falldamage||z.falldamage)return true
else return false}function worldShowNames(){if(!z)return false
if(void 0===z.show_names||z.show_names)return true
else return false}function worldMetadataWaygates(){i(z)
return z.waygates||{}}function worldMetadataWaygate(e){var t=worldMetadataWaygates()
if(!l(t,e))return null
return t[e]}function worldAccessLeapgate(){i(z)
if(void 0!==z.access_leapgate)return z.access_leapgate
return g}function worldAccessExvolume(){i(z)
if(void 0!==z.access_exvolume)return z.access_exvolume
return p}function worldAccessSaplings(){i(z)
if(void 0!==z.access_sapling)return z.access_sapling
return T}function worldAccessSettlement(){i(z)
if(void 0!==z.access_settlement)return z.access_settlement
return y}function worldAccessAreaClear(){i(z)
if(void 0!==z.access_area_clear)return z.access_area_clear
return h}function worldHasGems(){i(z)
return z.gems||0}function worldInventoryClone(){i(z)
return z.inventory_clone||null}function worldInventoryGeneration(){i(z)
return z.inventory_gen||0}function worldAccessDefault(){if(!z)return u
return z.access_default}function worldRaceAsVisitor(){if(z){var e=void 0!==z.race_as_visitor?z.race_as_visitor:z.unlimited?w:A
return e===N||e===b&&!(worldAccessDefault()>=c)}return false}function worldSpotlitBuzzer(){return z&&z.spotlit_buzzer||null}function worldSeed(){i(z)
return z.seed}function worldItemDrop(){if(!z)return false
if(void 0===z.item_drop&&adventureMode()||z.item_drop)return true
else return false}function worldFactories(){if(!z)return false
if(void 0===z.factories&&adventureMode()||z.factories)return true
else return false}function worldEnergy(){if(!z)return false
if(void 0===z.energy&&adventureMode()||z.energy)return true
else return false}function worldSettlements(){if(!z)return false
if(void 0===z.settlements&&adventureMode()||z.settlements)return true
else return false}function worldAccessUnlimitedItems(){if(!z)return d
if(void 0===z.unlimited_items)return adventureMode()?S:I
return z.unlimited_items}function worldAccessGiveItems(){if(!z)return d
if(void 0===z.give)return adventureMode()?m:E
return z.give}function worldMetadataDefaultWaygatePos(){var e=worldMetadataWaygate("default")
if(!e){console.error("Missing default waygate, going to the origin")
return"0,0,100,0,0"}return M(e)}function generalOnWorldMetadataChange(){H()
x()
F()}var K
function worldMetadataSet(e,t){i(t.seed)
z=_extends({world_id:e},t)
K=z.reset_id
n.refreshTitle()
W(true)
D()
generalOnWorldMetadataChange()}function worldApplyMetadataToInventory(e){if(!z)return
if(z.inventory_gen)k()
if(e)B()}function worldMetadataUpdate(e){i(z)
var t=z.tool_lock
for(var r in e)z[r]=e[r]
W()
generalOnWorldMetadataChange()
var a=z.tool_lock!==t
if(z.inventory_gen||a)U(worldApplyMetadataToInventory.bind(null,a))
if(z.reset&&z.reset_id!==K){console.error("Returning to main menu due to server reset")
G()}}function worldMetadataDelete(e){s(z,e)
W()
generalOnWorldMetadataChange()}function worldBuildQueue(){return z&&z.build_queue||null}function worldBoostPerk(e){var t=z&&z.boost_count||0
var r=C(t)
if(z&&z.boost_bypass&&z.boost_bypass[e])r=f
var a=v[r]
i(a)
return a[e]}function worldBoostLevel(){var e=z&&z.boost_count||0
return C(e)}function worldBoostLevelForProps(){if(!z)return 0
if(z.boost_bypass&&z.boost_bypass.props)return f
var e=z.boost_count||0
return C(e)}function worldBoostRewards(){return z&&z.boost_rewards||0}function worldBoosters(){return z&&z.boosters||{}}function worldUserIsBoosting(e){return Boolean(z&&z.boosters&&z.boosters[e])}function worldAmIBooster(){var e=o()
return Boolean(e&&worldUserIsBoosting(e))}function worldOwnerID(){return z&&z.owner&&z.owner.user_id||null}function worldBoostIcon(){var e=z&&z.boost_icon||0
if(e>=worldBoostPerk("boost_icon"))return 0
return e}},{"../common/world_constants":267,"../glov/client/cmds":298,"../glov/client/net":338,"../glov/client/urlhash":369,"../glov/common/dot-prop":383,"../glov/common/util":400,"./chat_ui_worlds":41,"./client_cmds":43,"./editvolume_client":84,"./inventory":114,"./main":135,"./mobs":145,"./settlement":181,"./voxel_data":216,assert:void 0}],236:[function(e,t,r){"use strict"
r.playSound=playSound
var a=e("../glov/client/ui").playUISound
function playSound(e){a(e)}},{"../glov/client/ui":367}],237:[function(e,t,r){"use strict"
r.setSSInstantModState=setSSInstantModState
r.addSSPeriodicModState=addSSPeriodicModState
r.logSSEventModState=logSSEventModState
r.soundscapeSetTag=soundscapeSetTag
r.soundscapeTick=soundscapeTick
r.soundscapeStop=soundscapeStop
r.soundscapePause=soundscapePause
r.soundscapeResume=soundscapeResume
r.soundscapeStartup=soundscapeStartup
r.SoundScapeEventMod=r.SoundScapePeriodicMod=r.SoundScapeInstantMod=r.SoundScapeTag=void 0
var a=e("assert")
var i=e("../glov/client/engine")
var o=i.onEnterBackground
var n=i.onExitBackground
var s=e("../glov/client/sound")
var l=s.fadesCount
var _=s.soundTick
var c=e("../glov/client/soundscape").GlovSoundScape
var u=e("../glov/common/util")
var E=u.clamp
var d=u.merge
var f=e("./debug").debugAddText
var v=e("./soundscape_data").SOUNDSCAPE_DATA
var g=e("../glov/client/engine.js")
var h=Math.PI,p=Math.cos
var m=1e3
var T=1e3
var y=8e3
var S
var I;(function(e){e["Home"]="home"
e["Night"]="night"
e["Snow"]="snow"
e["Underground"]="underground"
e["Underwater"]="underwater"})((r.SoundScapeTag=I)||(r.SoundScapeTag=I={}))
var A=["instant","periodic","event"]
var w;(function(e){e[e["Ambiance"]=0]="Ambiance"
e[e["DistHorizontal"]=1]="DistHorizontal"
e[e["DistVertical"]=2]="DistVertical"
e[e["IsFlying"]=3]="IsFlying"
e[e["MAX"]=4]="MAX"})((r.SoundScapeInstantMod=w)||(r.SoundScapeInstantMod=w={}))
var L;(function(e){e[e["VelHorizontal"]=0]="VelHorizontal"
e[e["VelVertical"]=1]="VelVertical"
e[e["VelFly"]=2]="VelFly"
e[e["O2Attribute"]=3]="O2Attribute"
e[e["MAX"]=4]="MAX"})((r.SoundScapePeriodicMod=L)||(r.SoundScapePeriodicMod=L={}))
var O;(function(e){e[e["Broken"]=0]="Broken"
e[e["BlocksPlaced"]=1]="BlocksPlaced"
e[e["PropsPlaced"]=2]="PropsPlaced"
e[e["PropsInteracted"]=3]="PropsInteracted"
e[e["MAX"]=4]="MAX"})((r.SoundScapeEventMod=O)||(r.SoundScapeEventMod=O={}))
var R={instant:w,periodic:L,event:O}
var b={instant:[{min:-.2,max:.2},{max:.1},{max:.2},{max:.2}],periodic:[{max:.2,period:1e3,expire_time:3e4},{max:.4,period:1e3,expire_time:3e4},{max:.3,period:1e3,expire_time:3e4},{max:.4,period:1e3,expire_time:5e3}],event:[{max:.2,steps:100,expire_time:18e4},{max:.2,steps:150,expire_time:18e4},{max:.2,steps:25,expire_time:18e4},{max:.2,steps:100,expire_time:18e4}]}
function soundScapeModValue(e,t,r){return(r=r||0)+(t-r)*E(e,0,1)}var N=function SoundScapePeriodicModState(e,t,r){this.timestamp=void 0
this.value=void 0
this.value=soundScapeModValue(e,t,r)
this.timestamp=g.frame_timestamp}
var C={instant:[],periodic:[],event:[]}
for(var x=0;x<w.MAX;++x)C.instant[x]=0
for(var M=0;M<L.MAX;++M)C.periodic[M]=[]
for(var D=0;D<O.MAX;++D)C.event[D]=[]
function setSSInstantModState(e,t){C.instant[e]=soundScapeModValue(t,b.instant[e].max,b.instant[e].min)}function addSSPeriodicModState(e,t){var r=C.periodic[e]
if(0===r.length||g.frame_timestamp>r[0].timestamp+b.periodic[e].period){var a=b.periodic[e],i=a.min,o=a.max
r.unshift(new N(t,o,i))}}function logSSEventModState(e){C.event[e].unshift(g.timestamp)}function soundscapeSetTag(e,t,r){S.setTag(e,t,r)}var P={instant:{keys:[],intensity:[]},periodic:{keys:[],intensity:[]},event:{keys:[],intensity:[]}}
for(var B=0;B<A.length;++B){var k=A[B]
var U=R[k]
for(var G=Object.keys(U).length/2;G<Object.keys(U).length-1;++G)P[k].keys.push(Object.keys(U)[G])}function soundscapeDebug(){var i=[]
function modTypeLines(e){i.push("    "+e+" Mods:")
for(var t=0;t<C[e].length;++t){var r=P[e].intensity[t].toFixed(5)
var a="["+(b[e][t].min||0)+"; "+b[e][t].max+"]"
i.push("        "+P[e].keys[t]+" = "+r+" / "+a)}}i.push("SoundScape Intensity:")
i.push("    Total: "+S.getIntensity().toFixed(5))
for(var e=0;e<A.length;++e)modTypeLines(A[e])
i.push("")
i.push("SoundScape Tags:")
for(var t in S.tags){var r=S.getTagTime(t)?" ["+S.getTagTime(t)+"]":""
i.push("    "+t+" = "+S.tags[t]+r)}i.push("")
i.push("SoundScape Layers:")
var a=S.debug()
for(var o=0;o<a.length;++o)i.push("   "+a[o].text)
i.push("")
f(i.join("\n"))}var F=2e5
var W=0
function ambianceModTick(){if((W+=g.frame_dt)>F)W-=F
var e=W/F*2*h
setSSInstantModState(w.Ambiance,(p(e)+1)/2)}function soundscapeTick(){ambianceModTick()
var e=0
var t=g.frame_timestamp
for(var r=0;r<w.MAX;++r){P.instant.intensity[r]=C.instant[r]
e+=C.instant[r]}for(var a=0;a<L.MAX;++a){var i=0
var o=C.periodic[a]
var n=b.periodic[a].expire_time
for(var s=o.length-1;s>=0;--s)if(o[s].timestamp+n<t)o.pop()
else break
for(var l=o.length-1;l>=0;--l)i+=C.periodic[a][l].value
P.periodic.intensity[a]=i/(o.length||1)
e+=P.periodic.intensity[a]}for(var _=0;_<O.MAX;++_){var c=C.event[_]
var u=b.event[_],d=u.steps,f=u.max,v=u.min,h=u.expire_time
for(var p=c.length-1;p>=0;--p)if(c[p]+h<t)c.pop()
else break
var m=(v=v||0)+c.length*((f-v)/d)
P.event.intensity[_]=E(m,v,f)
e+=P.event.intensity[_]}S.setIntensity(E(e,0,1))
S.tick()
if(g.defines.SOUNDSCAPE)soundscapeDebug()}function soundscapeStop(){S.stopAllLayers(m)}var H=1e3/60
var z
function backgroundSoundTick(){_(H)
if(l())z=setTimeout(backgroundSoundTick,H)}var V=0
function soundscapePause(){if(1===++V){S.stopAllLayers(m)
S.forceNoTracks(true)
z=setTimeout(backgroundSoundTick,H)}}function soundscapeResume(){a(V)
if(!--V){S.forceNoTracks(false)
S.setFadeInTime(T)
if(z)clearTimeout(z)}}function soundscapeStartup(){(S=new c(d({add_all:true,kill_delay:m,tag_tolerance:y},v))).setIntensity(0)
o(soundscapePause)
n(soundscapeResume)}},{"../glov/client/engine":305,"../glov/client/engine.js":305,"../glov/client/sound":358,"../glov/client/soundscape":359,"../glov/common/util":400,"./debug":73,"./soundscape_data":191,assert:void 0}],238:[function(e,t,r){"use strict"
r.createAsyncDictionary=createAsyncDictionary
var o=e("assert")
var n=e("../glov/common/util.js").callEach
function AsyncDictionary(e){o.equal(typeof e.loader,"function")
this.loader=e.loader
this.max=e.max||0
this.generation=0
this.reset()}AsyncDictionary.prototype.numLoading=function(){return this.num_loading}
AsyncDictionary.prototype.reset=function(){for(var e in this.loading){var t=this.loading[e]
n(t.load_cbs,t.load_cbs=null,"ERR_DICT_RESET")}++this.generation
this.loading=Object.create(null)
this.loaded=Object.create(null)
this.count=0
this.num_loading=0}
AsyncDictionary.prototype.prune=function(){var e
var t=0
for(var r in this.loaded){var a=this.loaded[r]
if(!t||a.dict_lru<t){t=a.dict_lru
e=r}}o(t)
delete this.loaded[e];--this.count}
AsyncDictionary.prototype.startLoading=function(r,a){var i=this;++this.num_loading
this.loader(r,function(e,t){if(a.generation!==i.generation){o(!a.load_cbs)
return}o.equal(i.loading[r],a);--i.num_loading
if(e)a.load_error=e
else{i.loaded[r]=t
delete i.loading[r];++i.count
if(i.max){t.dict_lru=Date.now()
if(i.count>i.max)i.prune()}}n(a.load_cbs,a.load_cbs=null,e,t)})}
AsyncDictionary.prototype.get=function(e,t){var r=this.loaded[e]
if(r){if(this.max)r.dict_lru=Date.now()
return t?t(null,r):r}var a=this.loading[e]
if(!a){a=this.loading[e]={load_cbs:[],load_error:null,generation:this.generation}
this.startLoading(e,a)
if(r=this.loaded[e])return t?t(null,r):r}if(a.load_error)return t?t(a.load_error):null
if(t)a.load_cbs.push(t)
else return null}
AsyncDictionary.prototype.has=function(e){return Boolean(this.loaded[e])}
AsyncDictionary.prototype.set=function(e,t){var r=this.loading[e]
if(r){if(r.load_cbs){n(r.load_cbs,r.load_cbs=null,null,t);--r.generation;--this.num_loading}delete this.loading[e]}if(this.loaded[e])--this.count
this.loaded[e]=t;++this.count
if(this.max){t.dict_lru=Date.now()
if(this.count>this.max)this.prune()}}
function createAsyncDictionary(e){return new AsyncDictionary(e)}},{"../glov/common/util.js":400,assert:void 0}],239:[function(e,t,r){"use strict"
var A=Math.floor
r.makeArray=function(e,t,r,a){var i=e.tiles_per_row,o=e.nudge
var n=A(r.width/i)
var s=[]
if(o)for(var l=o[0];l<=o[1];++l)s[l]=1
var _=n/2
var c=a(n,n*(i*i))
var u=0
for(var d=0;d<i;++d){var f=d*n
for(var v=0;v<i;++v){var h=v*n
var p=u*n
if(t&&!t[u])c.preClearRect(0,p,n,n)
if(s[u]){var m=n/8
for(var E=0;E<2;++E){var g=E*_
var T=f+g
var y=p+g
for(var S=0;S<m;++S)c.drawImage(r,h,T,n,1,0,y+S,n,1)
c.drawImage(r,h,T,n,_,0,y+m,n,2*m)
for(var I=0;I<m;++I)c.drawImage(r,h,T+_-1,n,1,0,y+3*m+I,n,1)}}else c.drawImage(r,h,f,n,n,0,p,n,n);++u}}return c}
function nextHighestPowerOfTwo(e){--e
for(var t=1;t<32;t<<=1)e|=e>>t
return e+1}r.makeAtlas=function(e,t,r,a){var i=e.pad,o=e.tiles_per_row
var n=A(r.width/o)
var s=n+2*i
var l=nextHighestPowerOfTwo(s*o)
var _=a(l,l)
var c=0
for(var u=0;u<o;++u){var d=u*n
var f=u*s
for(var v=0;v<o;++v){var h=v*n
var p=v*s
if(t&&!t[c])_.preClearRect(p,f,s,s)
_.drawImage(r,h+n-i,d+n-i,i,i,p,f,i,i)
_.drawImage(r,h,d+n-i,n,i,p+i,f,n,i)
_.drawImage(r,h,d+n-i,i,i,p+i+n,f,i,i)
_.drawImage(r,h+n-i,d,i,n,p,f+i,i,n)
_.drawImage(r,h,d,n,n,p+i,f+i,n,n)
_.drawImage(r,h,d,i,n,p+n+i,f+i,i,n)
_.drawImage(r,h+n-i,d,i,i,p,f+i+n,i,i)
_.drawImage(r,h,d,n,i,p+i,f+i+n,n,i)
_.drawImage(r,h,d,i,i,p+i+n,f+i+n,i,i);++c}}return _}},{}],240:[function(e,t,r){"use strict"
r.BLUEPRINT_MAX_DIM=r.BLUEPRINT_NAME_LEN=r.bid_valid_readonly_regex=r.bid_valid_editable_regex=r.bid_valid_regex=r.TYPE_READONLY=r.TYPE_EDITABLE=r.STATE_PAUSED=r.STATE_SELF_DESTRUCT=r.STATE_EDIT=r.STATE_PRE_EDIT=r.STATE_BUILD=r.STATE_PRE_BUILD=void 0
var a=0
r.STATE_PRE_BUILD=a
var i=1
r.STATE_BUILD=i
var o=2
r.STATE_PRE_EDIT=o
var n=3
r.STATE_EDIT=n
var s=4
r.STATE_SELF_DESTRUCT=s
var l=5
r.STATE_PAUSED=l
var _="E"
r.TYPE_EDITABLE=_
var c="R"
r.TYPE_READONLY=c
var u=/^(?:S\d+_\d+_\d+|[ER][A-Z0-9]+)$/
r.bid_valid_regex=u
var d=/^E[A-Z0-9]+$/
r.bid_valid_editable_regex=d
var f=/^R[A-Z0-9]+$/
r.bid_valid_readonly_regex=f
var v=32
r.BLUEPRINT_NAME_LEN=v
var h=16
r.BLUEPRINT_MAX_DIM=h},{}],241:[function(e,t,r){"use strict"
r.isCostume=isCostume
r.isPart=isPart
r.isSwap=isSwap
r.CosmeticTypeLangKeys=r.CosmeticRarities=r.Parts=r.CosmeticTypes=void 0
var a;(function(e){e[e["COSTUME"]=0]="COSTUME"
e[e["PART"]=1]="PART"
e[e["SWAP"]=2]="SWAP"})((r.CosmeticTypes=a)||(r.CosmeticTypes=a={}))
var i;(function(e){e[e["HEAD"]=0]="HEAD"
e[e["TORSO"]=1]="TORSO"
e[e["ARM_R"]=2]="ARM_R"
e[e["ARM_L"]=3]="ARM_L"
e[e["LEG_R"]=4]="LEG_R"
e[e["LEG_L"]=5]="LEG_L"})((r.Parts=i)||(r.Parts=i={}))
var o;(function(e){e[e["COMMON"]=0]="COMMON"
e[e["RARE"]=1]="RARE"
e[e["EPIC"]=2]="EPIC"
e[e["LEGENDARY"]=3]="LEGENDARY"})((r.CosmeticRarities=o)||(r.CosmeticRarities=o={}))
var n;(function(e){e["COSTUME"]="COSMETIC_TYPE_COSTUME"
e["HEAD"]="COSMETIC_TYPE_HEAD"
e["TORSO"]="COSMETIC_TYPE_TORSO"
e["ARMS"]="COSMETIC_TYPE_ARMS"
e["LEGS"]="COSMETIC_TYPE_LEGS"
e["SWAP_EYES"]="COSMETIC_TYPE_COLOR_EYES"
e["SWAP_HAIR"]="COSMETIC_TYPE_COLOR_HAIR"
e["SWAP_SKIN"]="COSMETIC_TYPE_COLOR_SKIN"})((r.CosmeticTypeLangKeys=n)||(r.CosmeticTypeLangKeys=n={}))
function isCostume(e){if(e)return e.cosmetic_type===a.COSTUME
return false}function isPart(e){if(e)return e.cosmetic_type===a.PART
return false}function isSwap(e){if(e)return e.cosmetic_type===a.SWAP
return false}},{}],242:[function(e,t,r){"use strict"
r.volumeContainsPoint=volumeContainsPoint
r.volumesOverlap=volumesOverlap
r.volumeGetOriginMegaChunkId=volumeGetOriginMegaChunkId
r.EDITVOLUME_MAX_SIZE=void 0
var a=e("./megachunk_common").megachunkIdFromWorldPos
var i=480
r.EDITVOLUME_MAX_SIZE=i
function volumeContainsPoint(e,t){return t[0]>=e.min[0]&&t[0]<e.max[0]&&t[1]>=e.min[1]&&t[1]<e.max[1]&&t[2]>=e.min[2]&&t[2]<e.max[2]}function volumesOverlap(e,t){return e.max[0]>t.min[0]&&e.min[0]<t.max[0]&&e.max[1]>t.min[1]&&e.min[1]<t.max[1]&&e.max[2]>t.min[2]&&e.min[2]<t.max[2]}function volumeGetOriginMegaChunkId(e){return a(e.min)}},{"./megachunk_common":254}],243:[function(e,t,r){"use strict"
r.effectiveAccessFromBuildQueue=effectiveAccessFromBuildQueue
r.EFFECTIVE_ACCESS_SPECTATOR=r.EFFECTIVE_ACCESS_UNQUEUED=void 0
var g=Math.floor,T=Math.min
var y=-1
r.EFFECTIVE_ACCESS_UNQUEUED=y
var S=-2
r.EFFECTIVE_ACCESS_SPECTATOR=S
function effectiveAccessFromBuildQueue(e,t,r){var a=t.queue,i=t.unqueue,o=t.threshold
e.threshold=o
var n=e.online
var s={}
var l=0
for(var _=0;_<a.length;++_){var c=a[_]
s[c]=true
var u=a[_+1]
var d=l
var f=n[c]
var v=n[u]
if(!f||f<=d||v&&f>v&&v>d+1){f=d+16
if(v&&v>d+1)f=T(f,g((d+v)/2))
n[c]=f}l=f}for(var h=0;h<i.length;++h){var p=i[h]
n[p]=y
s[p]=true}for(var m in r)if(!s[m])if(r[m].refcount){n[m]=S
s[m]=true}for(var E in n)if(!s[E])delete n[E]}},{}],244:[function(e,t,r){"use strict"
r.propToEntitlementKey=propToEntitlementKey
r.entitlementGet=entitlementGet
r.registerItemEntitlements=registerItemEntitlements
r.entitlementForCostume=entitlementForCostume
r.entitlementForPart=entitlementForPart
r.entitlements=void 0
var u=e("assert")
var d=e("./materials_common").Mat
var f={ctest1:[{type:"costume",name:"villager_1"}],ctest2:[{type:"costume",name:"villager_1"}],ctest3:[{type:"costume",name:"villager_1"}],ctest4:[{type:"costume",name:"villager_1"}],ctest5:[{type:"costume",name:"villager_1"}],ctest6:[{type:"costume",name:"villager_1"}],ctest7:[{type:"costume",name:"villager_1"}],ctest8:[{type:"costume",name:"villager_1"}],ctest9:[{type:"costume",name:"villager_1"}],def:[{type:"costume",name:"villager_1"},{type:"costume",name:"villager_2"},{type:"swap",key:"skin",values:["tone_01","tone_02","tone_03","tone_04","tone_05","tone_06"]},{type:"swap",key:"hair",values:["brown_dark_rum","brown_cinnamon_crumble","brown_bright","grayscale_tin_soldier","red_kobe","yellow_sunflower"]},{type:"swap",key:"eyes",values:["blue_aero","brown_kuro","brown_weathervane","brown_pastel","green_goblin"]}],cbenjaminsen:[{type:"costume",name:"benjaminsen"}],cjonas:[{type:"costume",name:"jonas"}],cglen:[{type:"costume",name:"glen"}],cmicchi:[{type:"costume",name:"micchi"}],cjimbly:[{type:"costume",name:"jimbly"}],cfrancisco:[{type:"costume",name:"francisco"}],cditunes:[{type:"costume",name:"ditunes"}],cyasin:[{type:"costume",name:"yasin"}],cgaps:[{type:"costume",name:"gaps"}],cmooga:[{type:"costume",name:"mooga"}],crogerplasm:[{type:"costume",name:"rogerplasm"}],cthea:[{type:"costume",name:"thea"}],csatera:[{type:"costume",name:"satera"}],cseasonaldev:[{type:"costume",name:"seasonal_dev"}],cvillager_3:[{type:"costume",name:"villager_3"}],cvillager_4:[{type:"costume",name:"villager_4"}],cvillager_5:[{type:"costume",name:"villager_5"}],cvillager_6:[{type:"costume",name:"villager_6"}],phair1:[{type:"part",name:"human_villager_head_short_buzzcut"}],phair2:[{type:"part",name:"human_villager_head_short_full"}],phair3:[{type:"part",name:"human_villager_head_medium_bob_cut"}],phair4:[{type:"part",name:"human_villager_head_long_simple"}],cgnarlshaman:[{type:"costume",name:"gnarl_shaman"}],chumancaptain:[{type:"costume",name:"captain"}],cskeletonminion:[{type:"costume",name:"mortari_skeleton_minion"}],cbeta01:[{type:"costume",name:"gnarl_shaman"},{type:"costume",name:"captain"},{type:"costume",name:"mortari_skeleton_minion"}],xmas2021:[{type:"part",name:"human_villager_head_santahat"},{type:"costume",name:"2021-12-snowman"},{type:"costume",name:"2021-12-sweater-1"},{type:"costume",name:"2021-12-sweater-2"}],xmas2021_1:[{type:"part",name:"human_villager_head_santahat"}],xmas2021_2:[{type:"costume",name:"2021-12-snowman"}],xmas2021_3:[{type:"costume",name:"2021-12-sweater-1"}],xmas2021_4:[{type:"costume",name:"2021-12-sweater-2"}],xmas2023_1:[{type:"costume",name:"2023_12_santa_beard_sweater"}],xmas2023_2:[{type:"costume",name:"2023_12_eyra-sweater"}],xmas2023_3:[{type:"costume",name:"2023_12_reindeer_pajamas"}],easter2024_1:[{type:"costume",name:"easter_egg"}],easter2024_2:[{type:"costume",name:"human_pajamas_bunny"}],cfrizard_archaeologist:[{type:"costume",name:"frizard_archaeologist"}],cfrizard_buccaneer:[{type:"costume",name:"frizard_buccaneer"}],cfrizard_sea_captain:[{type:"costume",name:"frizard_sea_captain"}],chakama:[{type:"costume",name:"human_hakama_boy"}],ckhornos_hunter:[{type:"costume",name:"khornos_hunter"}],ckhornos_warrioress:[{type:"costume",name:"khornos_warrioress"}],cyukata:[{type:"costume",name:"human_yukata_girl"}],ptest:[{type:"part",name:"test_head"}],ccactoid_jackie:[{type:"costume",name:"cactoid_jackie"}],xmas2022_1:[{type:"part",name:"human_villager_1_head_reindeer"}],xmas2022_2:[{type:"part",name:"human_villager_3_head_reindeer"}],cpumpkinhead:[{type:"costume",name:"human_pumpkin_head"}],ceyra_botanist:[{type:"costume",name:"eyra_botanist"}],ceyra_noble:[{type:"costume",name:"eyra_noble"}],chuman_farmer:[{type:"costume",name:"human_farmer"}],chuman_harvester:[{type:"costume",name:"human_harvester"}],ckhornos_chieftainess:[{type:"costume",name:"khornos_chieftainess"}],ckhornos_knight:[{type:"costume",name:"khornos_knight"}],ckhornos_warrior:[{type:"costume",name:"khornos_warrior"}],cmortari_guardian:[{type:"costume",name:"mortari_guardian"}],cgnarl_kindler:[{type:"costume",name:"gnarl_kindler"}],cfrizard_sea_lantern:[{type:"costume",name:"frizard_sea_lantern"}],cgnarl_lumberjack:[{type:"costume",name:"gnarl_lumberjack"}],cmortari_mummy:[{type:"costume",name:"mortari_mummy"}]};(r.entitlements=f).dev=function(){var e=[]
for(var t in f)e=e.concat(f[t])
return e}()
function propToEntitlementKey(e,t,r,a){if(void 0===t)t=d.NONE
if(void 0===r)r=d.NONE
if(void 0===a)a=d.NONE
return"prop_"+e+"_"+t+"_"+r+"_"+a}function entitlementGet(e){return f[e]||null}function registerItemEntitlements(e,t){for(var r=0;r<t.length;++r){var a=t[r].attr1||d.NONE
var i=t[r].attr2||d.NONE
var o=t[r].attr3||d.NONE
var n=t[r].tab||"flora"
for(var s in f){var l=f[s]
var _=l&&l[0]
if(!_||"prop"!==_.type||_.id!==e)continue
if((a===_.attr1||a===d.ANY||_.attr1===d.ANY)&&(i===_.attr2||i===d.ANY||_.attr2===d.ANY)&&(o===_.attr3||o===d.ANY||_.attr3===d.ANY))u(false,"Duplicate prop entitlement: "+e+", "+a+", "+i+", "+o)}var c=propToEntitlementKey(e,a,i,o)
f[c]=[{type:"prop",id:e,attr1:a,attr2:i,attr3:o,tab:n}]}}function entitlementForCostume(e){var t
for(var r in f){var a=f[r]
for(var i=0;i<a.length;++i){var o=a[i]
if("costume"===o.type&&o.name===e)if(!t||a.length<f[t].length)t=r}}return t}function entitlementForPart(e){var t
for(var r in f){var a=f[r]
if(1!==a.length)continue
for(var i=0;i<a.length;++i){var o=a[i]
if("part"===o.type&&o.name===e)if(!t||a.length<f[t].length)t=r}}return t}},{"./materials_common":253,assert:void 0}],245:[function(e,t,r){"use strict"
r.entityTraitsCommonStartup=entityTraitsCommonStartup
function entityTraitsCommonStartup(e){e.registerTrait("player",{properties:{is_player:true}})}},{}],246:[function(e,t,r){"use strict"
r.entityWorldsCommonClass=entityWorldsCommonClass
r.WorldsFieldEncoding=r.ENT_TOL_ROT=r.ENT_TOL_POS=r.VIEW_DIST=r.VA_SIZE=void 0
var a
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var i=e("../glov/common/entity_base_common")
var o=i.EntityBaseCommon
var n=i.EntityFieldEncoding
var s=i.entityCommonRegisterFieldEncoding
var l=e("./globals").MEGACHUNK_VOXEL_SIZE
var _=Math.PI,d=Math.abs,f=Math.floor,v=Math.round
var c=l
r.VA_SIZE=c
var u=200
r.VIEW_DIST=u
var h=.1
r.ENT_TOL_POS=h
var p=.1
r.ENT_TOL_ROT=p
function entityWorldsCommonClass(e){var t=function(i){_inheritsLoose(EntityWorldsCommon,i)
function EntityWorldsCommon(){var e
for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];(e=i.call.apply(i,[this].concat(r))||this).last_sent_pos=void 0
if(!e.data.pos)e.data.pos=[0,0,0,0,0,0]
e.last_sent_pos=e.data.pos.slice(0)
return e}return EntityWorldsCommon}(e)
t.prototype.is_player=false
return t}(function(e){_inheritsLoose(EntityWorldsCommonDummy,e)
function EntityWorldsCommonDummy(){return e.apply(this,arguments)||this}})(entityWorldsCommonClass(o))
var m;(function(e){e[e["EntityPos"]=n.Custom0]="EntityPos"})((r.WorldsFieldEncoding=m)||(r.WorldsFieldEncoding=m={}))
var E=[h/2,h/2,h/2,p/2,p/2,p/2]
var g=256/(2*_)
var T=2*_/256
var y=new Uint8Array(1)
var S=32
var I=1/S
s(((a={})[m.EntityPos]={encoder:function encEntityPos(e,t,r,a){var i=r
var o=e.last_sent_pos
var n=0
for(var s=0;s<6;++s)if(!a)n|=1<<s
else if(d(o[s]-i[s])>E[s]){o[s]=i[s]
n|=1<<s}t.writeU8(n)
for(var l=0;l<3;++l)if(n&1<<l){var _=v(i[l]*S)
t.writeU8(255&_)
t.writeU8((65280&_)>>8)
t.writeU8((16711680&_)>>16)}for(var c=3;c<6;++c)if(n&1<<c){var u=f(i[c]*g)
if(u<0||u>=256){y[0]=u
u=y[0]}t.writeU8(u)}},decoder:function decEntityPos(e,t){var r=t||[0,0,0,0,0,0]
var a=e.readU8()
for(var i=0;i<3;++i)if(a&1<<i){var o=e.readU8()
var n=e.readU8()
var s=e.readU8()
if(s>=128)s|=65280
var l=s<<16|n<<8|o
r[i]=l*I}for(var _=3;_<6;++_)if(a&1<<_)r[_]=e.readU8()*T
return r}},a))},{"../glov/common/entity_base_common":384,"./globals":248}],247:[function(e,t,r){"use strict"
r.USERS_PROVIDER_FRVR=r.USERS_PROVIDER_FACEBOOK_INSTANT=r.USERS_PROVIDER_FACEBOOK_GAMING=r.USERS_PROVIDER_DISCORD=r.USERS_PROVIDER_APPLE=void 0
var a="apl"
r.USERS_PROVIDER_APPLE=a
var i="discord"
r.USERS_PROVIDER_DISCORD=i
var o="fbg"
r.USERS_PROVIDER_FACEBOOK_GAMING=o
var n="fbi"
r.USERS_PROVIDER_FACEBOOK_INSTANT=n
var s="frvr"
r.USERS_PROVIDER_FRVR=s},{}],248:[function(e,t,r){"use strict"
r.STACK_SIZE=r.FAKE_PURCHASES=r.CHAT_MAX_LEN=r.TILE_PROP_MAX=r.TILE_PROP_BASE=r.ENV_LOCAL=r.ENV_TEST2=r.ENV_TEST=r.ENV_STAGING=r.ENV_PRODUCTION=r.PLATFORM_MIN_SUPPORTED_VERSIONS=r.MIN_SUPPORTED_VERSION=r.CURRENT_VERSION=r.MC_COUNT=r.MEGACHUNK_VOXEL_SIZE=r.MEGACHUNK_SIZE=r.SAFE_DIST_Z=r.SAFE_DIST=r.ID2=r.ID_FACTOR=r.VOXELS_PER_M=r.CS3=r.CS2=r.CHUNK_SIZE=void 0
var a=16
var i=(r.CHUNK_SIZE=a)*a
r.CS2=i
var o=a*a*a
r.CS3=o
var n=2
r.VOXELS_PER_M=n
var s=65536
var l=(r.ID_FACTOR=s)*s
r.ID2=l
var _=s*a/4
var c=r.SAFE_DIST=_
r.SAFE_DIST_Z=c
var u=32
var d=(r.MEGACHUNK_SIZE=u)*a
r.MEGACHUNK_VOXEL_SIZE=d
var f=u*u*u
r.MC_COUNT=f
var v="0.106.1"
r.CURRENT_VERSION=v
var h="0.95.0"
r.MIN_SUPPORTED_VERSION=h
var p={}
r.PLATFORM_MIN_SUPPORTED_VERSIONS=p
var m="prod"
r.ENV_PRODUCTION=m
var E="staging"
r.ENV_STAGING=E
var g="test"
r.ENV_TEST=g
var T="test2"
r.ENV_TEST2=T
var y="local"
r.ENV_LOCAL=y
var S=224
r.TILE_PROP_BASE=S
var I=239
r.TILE_PROP_MAX=I
var A=140
r.CHAT_MAX_LEN=A
var w=false
r.FAKE_PURCHASES=w
var L=100
r.STACK_SIZE=L},{}],249:[function(e,t,r){"use strict"
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a={TYPE_ITEM:1,TYPE_BLOCK:2,TYPE_CRAFT_CLASS:-1,TYPE_SETTLEMENT_UPGRADE:-2,TYPE_RECIPE:-3}
var i={ITEM_UNKNOWNID:-1,ITEM_PICKAX:1,ITEM_HATCHET:2,ITEM_SHOVEL:4,ITEM_HOE:5,ITEM_WAYGATE:6,ITEM_BAG:7,ITEM_PLANT:8,ITEM_SEEDS_CORN:9,ITEM_SEEDS_WHEAT:10,ITEM_CORN:11,ITEM_WHEAT:12,ITEM_FIBER:15,ITEM_CORD:16,ITEM_ROD:17,ITEM_TOOL_HEAD:18,ITEM_RODH:19,ITEM_RODV:20,ITEM_CHEST_MEDIUM:22,ITEM_DOOR:23,ITEM_TORCH:24,ITEM_FENCE:25,ITEM_HANDSTOOL:26,ITEM_BUCKET:27,ITEM_BLUEPRINT:28,ITEM_LIGHT_CUBE:29,ITEM_LIQUID:30,ITEM_LANTERN:31,ITEM_SHELF:32,ITEM_CHEST_TINY:33,ITEM_CHEST_SMALL:34,ITEM_CHEST_TALL:35,ITEM_FLOWERPOT:36,ITEM_STEPS:37,ITEM_TABLE_LARGE:38,ITEM_TABLE_SMALL:39,ITEM_CHAIR:40,ITEM_BENCH:41,ITEM_BED:42,ITEM_RUG:43,ITEM_LADDER:44,ITEM_ORE:45,ITEM_INGOT:46,ITEM_FURNACE_ORE:47,ITEM_FURNACE_GLASS:48,ITEM_SAWMILL:49,ITEM_OVEN:50,ITEM_WINDOW_SMALL:51,ITEM_WINDOW_MEDIUM:52,ITEM_WINDOW_LARGE:53,ITEM_DOOR_DOUBLE:54,ITEM_GEM:55,ITEM_STONECUTTER_SIMPLE:56,ITEM_STONECUTTER_ADVANCED:57,ITEM_FACTORY_DEBUG:58,ITEM_WORKBENCH:59,ITEM_COAL:60,ITEM_ANVIL:61,ITEM_DOWSER_ADVANCED:62,ITEM_TOOL_HEAD_CAST:63,ITEM_BERRY_BUSH_RED:64,ITEM_BERRY:65,ITEM_JUICER:66,ITEM_BOTTLE:67,ITEM_JUICE:68,ITEM_SPICE_PLANT:69,ITEM_SPICE:70,ITEM_CAMPFIRE:71,ITEM_SEEDS_TOMATO:72,ITEM_TOMATO:73,ITEM_SEEDS_CARROT:74,ITEM_SEEDS_PUMPKIN:75,ITEM_WATERING_SYSTEM:76,ITEM_WILD_CROP:77,ITEM_BREAD:78,ITEM_PUMPKIN:79,ITEM_CARROT:80,ITEM_PIE:81,ITEM_LEFTOVERS:82,ITEM_ROAST_VEGETABLES:83,ITEM_SANDWICH:84,ITEM_BERRY_BUSH_BLUE:85,ITEM_BERRY_BUSH_YELLOW:86,ITEM_MUSHROOM:87,ITEM_MILL:88,ITEM_FLOUR:89,ITEM_ENERGY_WELL:99,ITEM_PAINT_MIXER:100,ITEM_PAINT:101,ITEM_KILN:102,ITEM_DOWSER_SIMPLE:103,ITEM_SEEDS_SUGAR_CANE:104,ITEM_SUGAR_CANE:105,ITEM_SUGAR:106,ITEM_CROISSANT:107,ITEM_SIGNBOARD:108,ITEM_SIGNPOST:109,ITEM_PARTICLE_DEBUGGER:110,ITEM_BONFIRE:111,ITEM_BONFIRE_METAL:112,ITEM_BUZZERSTART:113,ITEM_BUZZERGOAL:114,ITEM_ACCESS_CONTROL:115,ITEM_VEINIUM_GRINDER:116,ITEM_INDICATOR:117,ITEM_SEASHELL:118,ITEM_CORAL_POWDER:119,ITEM_STARFISH:120,ITEM_LEAPGATE:121,ITEM_LEAPGATE_SHARD:122,ITEM_SEASHELL_PILE:123,ITEM_STARFISH_PILE:124,ITEM_ANEMONE:125,ITEM_ANEMONE_PILE:126,ITEM_ROAST_SEAFOOD:127,ITEM_SEA_CANDY:128,ITEM_DISC_CORAL:129,ITEM_CORAL_TUBES:130,ITEM_ALGAE:131,ITEM_SEEDS_CORAL_MUSHROOM:132,ITEM_ALGAE_SPORES:133,ITEM_CORAL_CRUNCH:134,ITEM_CACTORB:135,ITEM_CACTORB_SEEDS:136,ITEM_DOME:137,ITEM_DOMEBASE:138,ITEM_DOMEHORIZ:139,ITEM_DOMETOP:140,ITEM_DOMEWOOD:141,ITEM_DOMEWOODBASE:142,ITEM_DOMEWOODHORIZ:143,ITEM_DOMEWOODTOP:144,ITEM_GRASS:145,ITEM_CACTINY:146,ITEM_CACTINY_SEEDS:147,ITEM_GRASS_SPIKY:148,ITEM_SAPLING:149,ITEM_ARBORHEART:150,ITEM_BRANCHFORGE:151,ITEM_GROW:152,ITEM_BREAD_DECORATIVE:153,ITEM_BERRY_DECORATIVE:154,ITEM_ROD_WOOD_ALIAS:155,ITEM_RODH_WOOD_ALIAS:156,ITEM_RODV_WOOD_ALIAS:157,ITEM_ROD_METAL_ALIAS:158,ITEM_RODH_METAL_ALIAS:159,ITEM_RODV_METAL_ALIAS:160,ITEM_SIGNBOARD_METAL:161,ITEM_SIGNPOST_METAL:162,ITEM_LADDER_METAL:163,ITEM_CHEST_MEDIUM_METAL:164,ITEM_DOOR_DOUBLE_METAL:165,ITEM_DOOR_METAL:166,ITEM_LANTERN_METAL:167,ITEM_LIGHT_CUBE_METAL:168,ITEM_FENCE_METAL:169,ITEM_CHAIR_METAL:170,ITEM_TABLE_LARGE_METAL:171,ITEM_TABLE_SMALL_METAL:172,ITEM_CHAIN:173,ITEM_CHAINH:174,ITEM_DOOR_DOUBLE_GATE:175,ITEM_SIGNBOARD_STONE:176,ITEM_SIGNPOST_STONE:177,ITEM_ROD_STONE:178,ITEM_RODH_STONE:179,ITEM_RODV_STONE:180,ITEM_DOMESTONE:181,ITEM_DOMESTONEBASE:182,ITEM_DOMESTONEHORIZ:183,ITEM_DOMESTONETOP:184,ITEM_CUP_WOOD:185,ITEM_CUP_STONE:186,ITEM_CUP_METAL:187,ITEM_PLATE_WOOD:188,ITEM_PLATE_STONE:189,ITEM_PLATE_METAL:190,ITEM_VASE_WOOD:191,ITEM_VASE_METAL:192,ITEM_SHELF_METAL:193,ITEM_CHEST_MEDIUM_WOOD_ALIAS:194,ITEM_BLOCK_PREVIEW:999,ITEM_TEST00:1e3,ITEM_TEST01:1001,ITEM_TEST02:1002,ITEM_TEST03:1003,ITEM_TEST04:1004,ITEM_TEST05:1005,ITEM_TEST06:1006,ITEM_TEST07:1007,ITEM_TEST08:1008,ITEM_TEST09:1009}
var o=[]
var n=_extends({ITEM_ID_CODE_NAME:o,INV_ELEM_NAME:a},a,{INV_ITEM_NAME:i},i)
t.exports=n;(function(){for(var e in i){var t=i[e]
o[t]=e}})()},{}],250:[function(e,t,r){"use strict"
r.IAP_PROVIDER_FAKE=r.ERR_IAP_DISABLED=r.ERR_NOT_AVAILABLE=r.ERR_INVALID_PROVIDER=r.ERR_INVALID_DATA=r.ERR_IAP_NOT_SUCCESSFUL=r.ERR_IAP_NOT_VALID=r.ERR_IAP_USER_CANCELED=r.ERR_IAP_PAYMENT_DECLINED=r.ERR_IAP_CONSUMED=void 0
var a="ERR_IAP_CONSUMED"
r.ERR_IAP_CONSUMED=a
var i="ERR_IAP_PAYMENT_DECLINED"
r.ERR_IAP_PAYMENT_DECLINED=i
var o="ERR_IAP_USER_CANCELED"
r.ERR_IAP_USER_CANCELED=o
var n="ERR_IAP_NOT_VALID"
r.ERR_IAP_NOT_VALID=n
var s="ERR_IAP_NOT_SUCCESSFUL"
r.ERR_IAP_NOT_SUCCESSFUL=s
var l="ERR_INVALID_DATA"
r.ERR_INVALID_DATA=l
var _="ERR_INVALID_PROVIDER"
r.ERR_INVALID_PROVIDER=_
var c="ERR_NOT_AVAILABLE"
r.ERR_NOT_AVAILABLE=c
var u="ERR_IAP_DISABLED"
r.ERR_IAP_DISABLED=u
var d="fake"
r.IAP_PROVIDER_FAKE=d},{}],251:[function(e,t,r){"use strict"
r.sameItem=sameItem
r.processItemVariants=processItemVariants
r.processUnlockableVariants=processUnlockableVariants
r.getItemUnlockableVariantMethods=getItemUnlockableVariantMethods
r.itemHasUnlockMethod=itemHasUnlockMethod
r.resetUnlockMethodCache=resetUnlockMethodCache
r.itemIsReleased=itemIsReleased
r.ENT_UNLOCK_TYPES=void 0
var s=e("assert")
var n=e("../glov/common/util").merge
var a=e("./ids").ITEM_BLOCK_PREVIEW
var i=e("./materials_common")
var l=i.Mat
var o=i.UNRELEASED_ATTR1
var _={}
function sameItem(e,t,r){if(!e){if(!t)return true
return false}if(!t)return false
if(!(e.type===t.type&&e.id===t.id&&(e.attr1||0)===(t.attr1||0)&&(e.attr2||0)===(t.attr2||0)&&(e.attr3||0)===(t.attr3||0)))return false
var a=e.attribs||_
var i=t.attribs||_
if(a===i)return true
for(var o in a)if(o!==r&&a[o]!==i[o])return false
for(var n in i)if(n!==r&&i[n]!==a[n])return false
return true}function processItemVariants(e){var t=[]
if(!Array.isArray(e))e=[e]
s(e.length>0)
for(var r=0;r<e.length;++r){var a=e[r]
var i=l[a.attr1||"NONE"]
var o=l[a.attr2||"NONE"]
var n=a.attr3||"NONE"
if("string"===typeof n)n=l[n]
else if("number"!==typeof n)s(false,"Invalid attr3: "+n)
s(void 0!==i,"Invalid material name: "+i)
s(void 0!==o,"Invalid material name: "+o)
s(void 0!==n,"Invalid attr3: "+n)
t.push({attr1:i,attr2:o,attr3:n})}return t}var c={lf_break:true}
r.ENT_UNLOCK_TYPES=c
function processUnlockableVariants(e){var t=[]
if(!Array.isArray(e))e=[e]
var r=processItemVariants(e)
for(var a=0;a<r.length;++a){var i=e[a].methods
if(!Array.isArray(i))i=[i]
s(i.length>0)
for(var o=0;o<i.length;++o)s(c[i[o]],"Invalid Unlock Method: "+i[o])
t[a]=n(r[a],{methods:i,tab:e[a].tab||"flora"})}return t}function itemMatchesVariant(e,t){var r=t.attr1===l.ANY?l.ANY:e.attr1||l.NONE
var a=t.attr2===l.ANY?l.ANY:e.attr2||l.NONE
var i=t.attr3===l.ANY?l.ANY:e.attr3||l.NONE
return r===t.attr1&&a===t.attr2&&i===t.attr3}function getItemUnlockableVariantMethods(e){if(!e.unlockable_variants)return null
for(var t=0;t<e.unlockable_variants.length;++t)if(itemMatchesVariant(e,e.unlockable_variants[t]))return e.unlockable_variants[t].methods
return null}var u={}
function itemHasUnlockMethod(e,t){var r=t+"."+e.id+"."+e.attr1+"."+e.attr2+"."+e.attr3
var a=u[r]
if(void 0!==a)return a
var i=getItemUnlockableVariantMethods(e)
return u[r]=Boolean(i&&i.includes(t))}function resetUnlockMethodCache(){u={}}function itemVariantIsReleased(e){if(!e.next_release_variants)return false
for(var t=0;t<e.next_release_variants.length;++t)if(itemMatchesVariant(e,e.next_release_variants[t]))return true
return false}function itemIsReleased(e,t){return!e.next_release&&(!o[e.attr1]||e.id===a)&&!itemVariantIsReleased(e)||t}},{"../glov/common/util":400,"./ids":249,"./materials_common":253,assert:void 0}],252:[function(e,t,r){"use strict"
r.createLeapgateShardCost=createLeapgateShardCost
r.createLeapgateProgress=createLeapgateProgress
r.getCostSlots=getCostSlots
r.getCostForSlot=getCostForSlot
r.getProgressForSlot=getProgressForSlot
r.isLeapgateCostPaid=isLeapgateCostPaid
r.LEAPGATE_REQUIRED_DEPOSITS=r.LeapgateMode=void 0
var a;(function(e){e[e["INITIAL"]=0]="INITIAL"
e[e["SOURCE"]=1]="SOURCE"
e[e["TARGET"]=2]="TARGET"
e[e["COMPLETE"]=3]="COMPLETE"})((r.LeapgateMode=a)||(r.LeapgateMode=a={}))
var i=5
r.LEAPGATE_REQUIRED_DEPOSITS=i
var n=e("assert")
var o=e("../glov/common/util").isInteger
var s=e("./ids")
var l=s.ITEM_LEAPGATE_SHARD
var _=s.TYPE_ITEM
var c=e("./materials_common").Mat
function createLeapgateShardCost(e,t){var r={type:_,id:l,attr1:c.ANY,attr2:c.ANY,attr3:c.ANY,count:1}
if(o(e)){r.attr1=0
r.attr2=Number(e)}if(o(t)){r.attr1=0
r.attr3=Number(t)}return r}function createLeapgateProgress(e){var t={cost1:0,cost2:0,cost3:0}
if(e.cost0)t.cost0=0
return t}function getCostSlots(e){var t=[]
for(var r in e.leapgate_cost)t.push(r)
return t}function getCostForSlot(e,t){return e.leapgate_cost[t]}function getProgressForSlot(e,t){return e.leapgate_progress[t]||0}function isLeapgateCostPaid(e){var t=getCostSlots(e)
var r=t.length
for(var a=0;a<r;++a){var i=t[a]
var o=getCostForSlot(e,i)
n(o)
if(getProgressForSlot(e,i)<o.count)return false}return true}},{"../glov/common/util":400,"./ids":249,"./materials_common":253,assert:void 0}],253:[function(e,t,r){"use strict"
r.UNRELEASED_ATTR1=r.Mat=r.CraftClass=void 0
var a;(function(e){e[e["FUEL"]=1]="FUEL"
e[e["WOOD_RAW"]=2]="WOOD_RAW"
e[e["STONE_RAW"]=3]="STONE_RAW"
e[e["REPAIRABLE"]=4]="REPAIRABLE"
e[e["INGREDIENT"]=5]="INGREDIENT"
e[e["GRINDABLE"]=6]="GRINDABLE"
e[e["SCALED_INGOT"]=7]="SCALED_INGOT"
e[e["BAKED_FOOD"]=8]="BAKED_FOOD"
e[e["WOOD_PLANK"]=9]="WOOD_PLANK"
e[e["FARMING_SEED"]=10]="FARMING_SEED"
e[e["BRICK"]=11]="BRICK"
e[e["CEREAL_GRAIN"]=12]="CEREAL_GRAIN"
e[e["VEGETABLE"]=13]="VEGETABLE"
e[e["PIE_FILLING"]=14]="PIE_FILLING"
e[e["SEAFOOD"]=15]="SEAFOOD"
e[e["SANDWICH_FILLING"]=16]="SANDWICH_FILLING"
e[e["PAINT_COLOR"]=17]="PAINT_COLOR"
e[e["ROD_WOOD"]=18]="ROD_WOOD"
e[e["ROD_METAL"]=19]="ROD_METAL"})((r.CraftClass=a)||(r.CraftClass=a={}))
var i;(function(e){e[e["NONE"]=0]="NONE"
e[e["ANY"]=-99]="ANY"
e[e["LEAF"]=1]="LEAF"
e[e["LIGHT_WOOD"]=4]="LIGHT_WOOD"
e[e["WOOD"]=2]="WOOD"
e[e["RED_WOOD"]=5]="RED_WOOD"
e[e["DARK_WOOD"]=3]="DARK_WOOD"
e[e["FLINT"]=100]="FLINT"
e[e["ROCK"]=101]="ROCK"
e[e["STONE"]=102]="STONE"
e[e["CORAL"]=105]="CORAL"
e[e["FANCY_STONE"]=104]="FANCY_STONE"
e[e["UNUSED_STONE"]=103]="UNUSED_STONE"
e[e["SAND"]=201]="SAND"
e[e["DIRT"]=200]="DIRT"
e[e["MUTTAL"]=311]="MUTTAL"
e[e["COAL"]=500]="COAL"
e[e["COPPER"]=300]="COPPER"
e[e["TIN"]=302]="TIN"
e[e["BRONZE"]=303]="BRONZE"
e[e["IRON"]=301]="IRON"
e[e["SILVER"]=304]="SILVER"
e[e["EMBERYLLIUM"]=305]="EMBERYLLIUM"
e[e["GOLD"]=306]="GOLD"
e[e["BRIGHTSTEEL"]=307]="BRIGHTSTEEL"
e[e["COBALT"]=308]="COBALT"
e[e["MYTHRIL"]=309]="MYTHRIL"
e[e["AETHERSTONE"]=310]="AETHERSTONE"
e[e["AETHERSTEEL"]=390]="AETHERSTEEL"
e[e["REGULAR"]=397]="REGULAR"
e[e["FAST"]=398]="FAST"
e[e["SUPER"]=399]="SUPER"
e[e["ANY_INGREDIENT"]=400]="ANY_INGREDIENT"
e[e["TOMATO"]=401]="TOMATO"
e[e["PUMPKIN"]=402]="PUMPKIN"
e[e["CARROT"]=403]="CARROT"
e[e["RED_BERRY"]=404]="RED_BERRY"
e[e["BLUE_BERRY"]=405]="BLUE_BERRY"
e[e["YELLOW_BERRY"]=406]="YELLOW_BERRY"
e[e["LABEL"]=407]="LABEL"
e[e["HOT"]=408]="HOT"
e[e["PUNGENT"]=409]="PUNGENT"
e[e["SAVORY"]=410]="SAVORY"
e[e["BREAD"]=411]="BREAD"
e[e["BROWN_MUSHROOM"]=412]="BROWN_MUSHROOM"
e[e["LUMINESCENT_MUSHROOM"]=413]="LUMINESCENT_MUSHROOM"
e[e["RED_MUSHROOM"]=414]="RED_MUSHROOM"
e[e["CORN"]=415]="CORN"
e[e["CORAL_MUSHROOM"]=416]="CORAL_MUSHROOM"
e[e["STARFISH"]=417]="STARFISH"
e[e["ANEMONE"]=418]="ANEMONE"
e[e["MINT_ALGAE"]=419]="MINT_ALGAE"
e[e["JADE_ALGAE"]=420]="JADE_ALGAE"
e[e["BUBBLEGUM_ALGAE"]=421]="BUBBLEGUM_ALGAE"
e[e["INDIGO_ALGAE"]=422]="INDIGO_ALGAE"
e[e["ULTRAMARINE_ALGAE"]=423]="ULTRAMARINE_ALGAE"
e[e["RUBY_CACTORB"]=424]="RUBY_CACTORB"
e[e["KYANITE_CACTORB"]=425]="KYANITE_CACTORB"
e[e["LIZARDITE_CACTINY"]=426]="LIZARDITE_CACTINY"
e[e["AMETHYST_CACTINY"]=427]="AMETHYST_CACTINY"
e[e["RED"]=501]="RED"
e[e["ORANGE"]=502]="ORANGE"
e[e["YELLOW"]=503]="YELLOW"
e[e["GREEN"]=504]="GREEN"
e[e["BLUE"]=505]="BLUE"
e[e["PURPLE"]=506]="PURPLE"})((r.Mat=i)||(r.Mat=i={}))
var o={}
r.UNRELEASED_ATTR1=o},{}],254:[function(e,t,r){"use strict"
r.chunkPosFromId=chunkPosFromId
r.parseChunkId=parseChunkId
r.chunkIdFromWorldPos=chunkIdFromWorldPos
r.posPairFromWorldPos=posPairFromWorldPos
r.megachunkIdFromWorldPos=megachunkIdFromWorldPos
r.parseWorldPos=parseWorldPos
r.isSpoiled=isSpoiled
r.spoil=spoil
r.unspoil=unspoil
var l=e("assert")
var a=e("../common/globals.js"),i=a.ID_FACTOR,o=a.ID2,_=a.MC_COUNT,c=a.MEGACHUNK_SIZE,n=a.MEGACHUNK_VOXEL_SIZE,s=a.CHUNK_SIZE
var u=Math.floor,d=Math.round
var f=new Int32Array(3)
var v=new Int32Array(3)
var h=new Int32Array(3)
var p={chunk_pos:f,mchunk_pos:v,local_pos:h,mcid:0}
function chunkPosFromId(e){f[2]=d(e/o)
e-=f[2]*o
f[1]=d(e/i)
e-=f[1]*i
f[0]=e
return f}function parseChunkId(e){chunkPosFromId(e)
v[0]=u(f[0]/c)
v[1]=u(f[1]/c)
v[2]=u(f[2]/c)
h[0]=f[0]-v[0]*c
h[1]=f[1]-v[1]*c
h[2]=f[2]-v[2]*c
p.mcid=(v[2]*i+v[1])*i+v[0]
return p}function chunkIdFromWorldPos(e){f[0]=u(e[0]/s)
f[1]=u(e[1]/s)
f[2]=u(e[2]/s)
return(f[2]*i+f[1])*i+f[0]}var m={chunk_pos:f,local_pos:h,chunk_id:0,idx:0}
function posPairFromWorldPos(e){m.chunk_id=chunkIdFromWorldPos(e)
h[0]=e[0]-f[0]*s
h[1]=e[1]-f[1]*s
h[2]=e[2]-f[2]*s
m.idx=(h[2]*s+h[1])*s+h[0]
return m}function megachunkIdFromWorldPos(e){v[0]=u(e[0]/n)
v[1]=u(e[1]/n)
v[2]=u(e[2]/n)
return(v[2]*i+v[1])*i+v[0]}var E={chunk_pos:f,mchunk_pos:v,local_pos:h,chunk_id:0,mcid:0}
function parseWorldPos(e){E.chunk_id=chunkIdFromWorldPos(e)
v[0]=u(f[0]/c)
v[1]=u(f[1]/c)
v[2]=u(f[2]/c)
h[0]=f[0]-v[0]*c
h[1]=f[1]-v[1]*c
h[2]=f[2]-v[2]*c
E.mcid=(v[2]*i+v[1])*i+v[0]
return E}function isSpoiled(e,t){var r=(t[2]*c+t[1])*c+t[0]
l(r>=0&&r<_)
var a=false
var i=0
var o=0
while(o<=r){o+=e[i++]
a=!a}return!a}function setPristine(e,t,r){var a=(t[2]*c+t[1])*c+t[0]
l(a>=0&&a<_)
var i=false
var o=0
var n=0
var s=0
while(n<=a){s=n
n+=e[o++]
i=!i}if(i===r)return false
e[--o]--
if(a===n-1){if(o===e.length-1)e.push(1)
else e[o+1]++
if(!e[o]&&0!==o){e[o-1]+=e[o+1]
e.splice(o,2)}}else if(a===s)if(0===o){l(!r)
e.splice(o,0,0,1)}else e[o-1]++
else{e.splice(o+1,0,1,n-a-1)
e[o]=a-s}return true}function spoil(e,t){return setPristine(e,t,false)}function unspoil(e,t){return setPristine(e,t,true)}},{"../common/globals.js":248,assert:void 0}],255:[function(e,t,r){"use strict"
r.getPerm=getPerm
var a={max_blueprints:6,max_photos:Infinity,photo_showcase_size:4}
function getPerm(e,t){var r
if(!e||void 0===e[t])r=a[t]
else r=e[t]
if("csr"===t&&!r)r=getPerm(e,"sysadmin")
return r}},{}],256:[function(e,t,r){"use strict"
r.PHOTO_SHOWCASE_MAX=r.PHOTO_NAME_MAX_VISUAL_SIZE=r.PHOTO_NAME_MAX_LENGTH=r.photo_id_valid_regex=r.PHOTO_ASPECT=r.CARD_H=r.CARD_W=r.WG_IMG_KEYS=r.PHT_IMG_KEYS=void 0
var a=["max","card","thumb"]
r.PHT_IMG_KEYS=a
var i=["full","preview","thumb"]
r.WG_IMG_KEYS=i
var o=1200
var n=630
var s=(r.CARD_W=o)/(r.CARD_H=n)
r.PHOTO_ASPECT=s
var l=/^[A-Z0-9]+$/
r.photo_id_valid_regex=l
var _=24
r.PHOTO_NAME_MAX_LENGTH=_
var c={font_height:24,width:300}
r.PHOTO_NAME_MAX_VISUAL_SIZE=c
var u=8
r.PHOTO_SHOWCASE_MAX=u},{}],257:[function(e,t,r){"use strict"
r.WorldsPlatform=void 0
var a=e("../glov/common/platform").platformRegister
var i;(function(e){e["Android"]="android"
e["Discord"]="discord"
e["FBInstant"]="fbinstant"
e["FBRooms"]="fbrooms"
e["IOS"]="ios"
e["MSStart"]="msstart"
e["MSStore"]="msstore"
e["Web"]="web"
e["Yandex"]="yandex"})((r.WorldsPlatform=i)||(r.WorldsPlatform=i={}))
a(i.Web,{devmode:"auto",reload:true,reload_updates:true,show_logout:true,random_creation_name:false,url_visible:true,internal_urls_only:false})
a(i.Android,{devmode:"off",reload:false,reload_updates:false,show_logout:true,random_creation_name:false,url_visible:false,internal_urls_only:false})
a(i.Discord,{devmode:"off",reload:true,reload_updates:true,show_logout:false,random_creation_name:true,url_visible:false,internal_urls_only:true})
a(i.FBInstant,{devmode:"auto",reload:true,reload_updates:false,show_logout:false,random_creation_name:false,url_visible:false,internal_urls_only:false})
a(i.FBRooms,{devmode:"auto",reload:true,reload_updates:false,show_logout:false,random_creation_name:false,url_visible:false,internal_urls_only:false})
a(i.IOS,{devmode:"off",reload:false,reload_updates:false,show_logout:true,random_creation_name:false,url_visible:false,internal_urls_only:false})
a(i.MSStart,{devmode:"off",reload:true,reload_updates:true,show_logout:true,random_creation_name:false,url_visible:false,internal_urls_only:false})
a(i.MSStore,{devmode:"off",reload:true,reload_updates:true,show_logout:true,random_creation_name:false,url_visible:false,internal_urls_only:false})
a(i.Yandex,{devmode:"off",reload:false,reload_updates:false,show_logout:true,random_creation_name:false,url_visible:false,internal_urls_only:false})},{"../glov/common/platform":394}],258:[function(e,t,r){"use strict"
r.trueBuzzerID=trueBuzzerID
function trueBuzzerID(e){return e.toLowerCase().replace(/[^a-z0-9_]/g,"")}},{}],259:[function(e,t,r){"use strict"
r.rewardTimeUntilAvailable=rewardTimeUntilAvailable
r.VIDEO_MINIMUM_TIME_BETWEEN=r.VIDEO_LIMIT_MAX=r.VIDEO_LIMIT=r.LOGIN_REWARDS=r.LoginRewardRequirementType=void 0
var c=e("assert")
var u=Math.max
var a;(function(e){e[e["REFERRALS"]=1]="REFERRALS"})((r.LoginRewardRequirementType=a)||(r.LoginRewardRequirementType=a={}))
var i={ref_1:{req_type:a.REFERRALS,referrals:1,product_id:"referrals_1"}}
r.LOGIN_REWARDS=i
function rewardTimeUntilAvailable(e,t,r,a){var i=e-60*a.hours*60
var o=a.amount-t
if(o<0)return Infinity
var n=e
var s=Infinity
for(var l=r.length-1;l>=0;--l){var _=r[l]
c(_.time<s)
s=_.time
if(_.time<=i)break
if(_.amount>o){n=_.time+60*a.hours*60
break}else o-=_.amount}return u(n-e,0)}var o={gem:{amount:6,hours:2},orb:{amount:1,hours:2}}
var n=r.VIDEO_LIMIT=o
r.VIDEO_LIMIT_MAX=n
var s=15
r.VIDEO_MINIMUM_TIME_BETWEEN=s},{assert:void 0}],260:[function(e,t,r){"use strict"
r.classifyRole=classifyRole
r.isValidRole=isValidRole
var a={SYSADMIN:1,TEAM:1,OWNER:1,ADMIN:1,BUILDER:1,AREABUILDER:1,READONLY:1,SPECTATOR:1,NONE:1}
function classifyRole(e,t){if(!e)return"SPECTATOR"
if(t){if(e.sysadmin)return"SYSADMIN"
if(e.team||e.csr)return"TEAM"
if(e.frozen_owner)return"OWNER"}if(e.world_owner)return"OWNER"
if(e.world_admin)return"ADMIN"
if(e.world_builder)return"BUILDER"
if(e.world_areabuilder)return"AREABUILDER"
if(e.world_readonly)return"READONLY"
return"SPECTATOR"}function isValidRole(e){return Boolean(a[e])}},{}],261:[function(e,t,r){"use strict"
r.settlementTier=settlementTier
function settlementTier(e){var t=e.unlocks
var r=0
if(t){r=1
while(t["tier"+r])++r;--r}return r}},{}],262:[function(e,t,r){"use strict"
r.getAllProducts=getAllProducts
r.getProduct=getProduct
r.getAllProductItems=getAllProductItems
r.getProductItem=getProductItem
r.validatePurchaseRules=validatePurchaseRules
r.PRODUCT_ITEM_ID_BOOST_TOKEN=r.PRODUCT_ITEM_ID_ORB=r.PRODUCT_ITEM_ID_GEM=r.COST_ORBS_BOOST_DAY=r.PHOTO_SHOWCASE_EXPAND=r.DAILY_ORBS_ADS_AMOUNT=r.DAILY_GEMS_ADS_AMOUNT=r.DAILY_FREE_GEMS_ON=r.DAILY_FREE_ADS_ON=r.DAILY_GEMS_FREE_AMOUNT=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("assert")
var i=e("../glov/common/util").has
var o=10
var n=300
var s=900
var l=1500
var _=100
var c=300
var u=500
var d=3
r.DAILY_GEMS_FREE_AMOUNT=d
var f=true
r.DAILY_FREE_ADS_ON=f
var v=true
r.DAILY_FREE_GEMS_ON=v
var h=3
r.DAILY_GEMS_ADS_AMOUNT=h
var p=1
r.DAILY_ORBS_ADS_AMOUNT=p
var m=4
r.PHOTO_SHOWCASE_EXPAND=m
var E=6
r.COST_ORBS_BOOST_DAY=E
var g="gems"
var T="orbs"
var y="boost_token"
var S=[{id:"world_slot",max_owned:8},{id:"photo_showcase_slot",max_owned:m},{id:r.PRODUCT_ITEM_ID_GEM=g,max_owned:Infinity},{id:r.PRODUCT_ITEM_ID_ORB=T,max_owned:Infinity},{id:r.PRODUCT_ITEM_ID_BOOST_TOKEN=y,max_owned:Infinity}]
var I={available_asof:new Date("2024-03-29T23:59:59Z").getTime(),available_until:new Date("2024-04-30T23:59:59Z").getTime()}
var A={}
S.forEach(function(e){return A[e.id]=e})
function fillProductItems(e){e.items=e.items||[]
if(!e.items.length)e.items.push({id:e.id,amount:1})
for(var t=0;t<e.items.length;++t){var r=e.items[t]
if(!A[r.id]){var a={id:r.id,max_owned:1}
A[r.id]=a
S.push(a)}}return e}var w=[{id:"cvillager_3",cost_gems:o},{id:"cvillager_4",cost_gems:o},{id:"cvillager_5",cost_gems:o},{id:"cvillager_6",cost_gems:o},{id:"phair1",cost_gems:o},{id:"phair2",cost_gems:o},{id:"phair3",cost_gems:o},{id:"phair4",cost_gems:o},_extends({id:"easter2024_1",cost_orbs:n/2},I),_extends({id:"easter2024_2",cost_gems:l/2},I),{id:"cfrizard_sea_captain",cost_gems:s},{id:"ckhornos_warrioress",cost_orbs:_},{id:"cfrizard_archaeologist",cost_gems:s},{id:"cfrizard_buccaneer",cost_gems:l},{id:"chakama",cost_gems:n},{id:"ckhornos_hunter",cost_gems:n},{id:"cyukata",cost_gems:n},{id:"ceyra_botanist",cost_orbs:_},{id:"ceyra_noble",cost_gems:s},{id:"chuman_farmer",cost_orbs:_},{id:"chuman_harvester",cost_orbs:_},{id:"ckhornos_chieftainess",cost_orbs:c},{id:"ckhornos_knight",cost_orbs:u},{id:"ckhornos_warrior",cost_orbs:_},{id:"cmortari_guardian",cost_gems:l},{id:"cfrizard_sea_lantern",cost_orbs:u},{id:"cgnarl_kindler",cost_gems:s},{id:"cgnarl_lumberjack",cost_orbs:c},{id:"cmortari_mummy",cost_gems:n},{id:"cpumpkinhead",cost_gems:n,available_until:new Date("2023-11-19T23:59:59Z").getTime()},{id:"extra_world_slot",items:[{id:"world_slot",amount:1}],cost_orbs:[10,20,40,80,120,160,200,240]},{id:"extra_photo_showcase",items:[{id:"photo_showcase_slot",amount:m}],cost_orbs:[50]},{id:y,cost_orbs:E},{id:"referrals_1",items:[{id:g,amount:50}]},{id:"promo_lost_frontier_farmers",is_first_offer:true,items:[{id:"chuman_farmer",amount:1},{id:"chuman_harvester",amount:1},{id:T,amount:90}]},{id:"gems_daily",items:[{id:g,amount:d}],show_in_currency_shop:v,is_free:true},{id:"gems_ad",items:[{id:g,amount:h}],show_in_currency_shop:f,is_free:true},{id:"gems_xs",items:[{id:g,amount:100}],show_in_currency_shop:false,is_base_offer:true},{id:"gems_s",items:[{id:g,amount:310,supposed_amount:300}],show_in_currency_shop:false},{id:"gems_m",items:[{id:g,amount:520,supposed_amount:500}],show_in_currency_shop:false},{id:"gems_l",items:[{id:g,amount:1100,supposed_amount:1e3}],show_in_currency_shop:false},{id:"gems_xl",items:[{id:g,amount:2400,supposed_amount:1900}],show_in_currency_shop:false},{id:"gems_exchange_s",description:"Gem Pack S",items:[{id:g,amount:120}],cost_orbs:40,show_in_currency_shop:true,is_gem_exchange:true,is_base_offer:true},{id:"gems_exchange_m",description:"Gem Pack M",items:[{id:g,amount:1350,supposed_amount:1200}],cost_orbs:400,show_in_currency_shop:true,is_gem_exchange:true},{id:"gems_exchange_l",description:"Gem Pack L",items:[{id:g,amount:3e3,supposed_amount:2400}],cost_orbs:800,show_in_currency_shop:true,is_gem_exchange:true},{id:"orbs_ad",items:[{id:T,amount:p}],show_in_currency_shop:f,is_free:true},{id:"orbs_xs",items:[{id:T,amount:50}],show_in_currency_shop:true,is_base_offer:true},{id:"orbs_s",items:[{id:T,amount:155,supposed_amount:150}],show_in_currency_shop:true},{id:"orbs_m",items:[{id:T,amount:260,supposed_amount:250}],show_in_currency_shop:true},{id:"orbs_l",items:[{id:T,amount:550,supposed_amount:500}],show_in_currency_shop:true},{id:"orbs_xl",items:[{id:T,amount:1200,supposed_amount:1e3}],show_in_currency_shop:!f},{id:"orbs_xxl",items:[{id:T,amount:3200,supposed_amount:2500}],show_in_currency_shop:true}].map(fillProductItems)
var L={}
w.forEach(function(e){e.items.forEach(function(e){return a(A[e.id])})
L[e.id]=e})
function getAllProducts(){return w}function getProduct(e){return i(L,e)?L[e]:void 0}function getAllProductItems(){return S}function getProductItem(e){return i(A,e)?A[e]:void 0}function validatePurchaseRules(e,t,r,a){if(e.available_until&&r>e.available_until||e.available_asof&&r<e.available_asof)return false
if(e.items.length>1)return true
var i=e.items[0]
var o=A[i.id]
return a(i.id)+i.amount*t<=o.max_owned}},{"../glov/common/util":400,assert:void 0}],263:[function(e,t,r){"use strict"
r.linkPayloadIsWorld=linkPayloadIsWorld
r.linkPayloadIsUser=linkPayloadIsUser
r.linkPayloadIsPhoto=linkPayloadIsPhoto
r.linkPayloadIsBlueprint=linkPayloadIsBlueprint
r.isValidPromptID=isValidPromptID
r.CHAT_FLAG_BOOSTED=r.CHAT_FLAG_WORLDSYSTEM=r.WORLD_BOOST_TAINTED=r.WORLD_BOOST_CANCELLED=r.WORLD_BOOST_DEFAULT=void 0
function linkPayloadIsWorld(e){return Boolean(e&&e.w)}function linkPayloadIsUser(e){return Boolean(e&&e.u)}function linkPayloadIsPhoto(e){return Boolean(e&&e.photo)}function linkPayloadIsBlueprint(e){return Boolean(e&&e.blueprint)}var a=["create_first_world","first_offer"]
function isValidPromptID(e){return a.includes(e)}var i=0
r.WORLD_BOOST_DEFAULT=i
var o=1
r.WORLD_BOOST_CANCELLED=o
var n=2
r.WORLD_BOOST_TAINTED=n
var s=4
r.CHAT_FLAG_WORLDSYSTEM=s
var l=8
r.CHAT_FLAG_BOOSTED=l},{}],264:[function(J,e,ee){(function($){(function(){"use strict"
ee.VoxelDataBase=VoxelDataBase
ee.createUtilVD=createUtilVD
ee.voxelDataCreateEmpty=voxelDataCreateEmpty
ee.ZMap=ZMap
ee.zmapDeserialize=zmapDeserialize
ee.zmapSerialize=zmapSerialize
ee.resetDayIndex=resetDayIndex
ee.LIGHT_DECREASE=ee.LIGHT_INCREASE=ee.TORCH_DECREASE=ee.TORCH_INCREASE=ee.SUN_DECREASE=ee.SUN_INCREASE=ee.ZMAP_UNDERGROUND=ee.ZMAP_MAX=ee.ZMAP_UNKNOWN=ee.UNCHUNKED_ID=ee.ANIM_TYPE_POS=ee.ANIM_TYPE_PLAYER=ee.ANIM_STYLE_BEAM=ee.ANIM_STYLE_PHYS=ee.TRANS_INV_EQUIP=ee.TRANS_INV_PLAYER=ee.TRANSACT_PROP_CHAT=ee.TRANSACT_LEAPGATE_PROGRESS=ee.TRANSACT_BLUEBOX_INFO=ee.TRANSACT_VOLUME_MOD=ee.TRANSACT_SETTLEMENT_PROGRESS=ee.TRANSACT_STAT=ee.TRANSACT_ITEM_ANIM=ee.TRANSACT_PROP_MOD=ee.TRANSACT_USER_ATTRIB=ee.TRANSACT_INV_ATTRIB=ee.TRANSACT_PROP_INV_MOD=ee.TRANSACT_INV_MOD=ee.TRANSACT_BAG_ADD=ee.TRANSACT_PROP_SET=ee.TRANSACT_VOXEL_SET_RLE=ee.TRANSACT_VOXEL_SET=ee.TRANSACT_PRISTINE=ee.voxel_data_mem_tracker=void 0
var c=J("assert")
var s=J("../glov/common/util").deepEqual
var e=J("../common/globals")
var o=e.CHUNK_SIZE
var n=e.CS2
var h=e.TILE_PROP_BASE
var u=Math.ceil,d=Math.max
var r={count:0,bytes:0}
ee.voxel_data_mem_tracker=r
var t="pristine"
ee.TRANSACT_PRISTINE=t
var a="set"
ee.TRANSACT_VOXEL_SET=a
var i="sx2"
ee.TRANSACT_VOXEL_SET_RLE=i
var l="prop"
ee.TRANSACT_PROP_SET=l
var _="bag"
ee.TRANSACT_BAG_ADD=_
var f="inv"
ee.TRANSACT_INV_MOD=f
var v="pinv"
ee.TRANSACT_PROP_INV_MOD=v
var p="iattr"
ee.TRANSACT_INV_ATTRIB=p
var m="uattr"
ee.TRANSACT_USER_ATTRIB=m
var E="pmod"
ee.TRANSACT_PROP_MOD=E
var g="anim"
ee.TRANSACT_ITEM_ANIM=g
var T="stat"
ee.TRANSACT_STAT=T
var y="sprog"
ee.TRANSACT_SETTLEMENT_PROGRESS=y
var S="volm"
ee.TRANSACT_VOLUME_MOD=S
var I="bbinfo"
ee.TRANSACT_BLUEBOX_INFO=I
var A="lgprog"
ee.TRANSACT_LEAPGATE_PROGRESS=A
var w="pcht"
ee.TRANSACT_PROP_CHAT=w
var L=1
ee.TRANS_INV_PLAYER=L
var O=2
ee.TRANS_INV_EQUIP=O
var R=1
ee.ANIM_STYLE_PHYS=R
var b=2
ee.ANIM_STYLE_BEAM=b
var N=1
ee.ANIM_TYPE_PLAYER=N
var C=2
ee.ANIM_TYPE_POS=C
var x=11
var M=32768
ee.UNCHUNKED_ID=M
var D=-32768
ee.ZMAP_UNKNOWN=D
var P=32767
ee.ZMAP_MAX=P
c(D<0)
var B="underground"
ee.ZMAP_UNDERGROUND=B
var k=1
ee.SUN_INCREASE=k
var U=2
ee.SUN_DECREASE=U
var G=4
ee.TORCH_INCREASE=G
var F=8
ee.TORCH_DECREASE=F
var W=k|G
ee.LIGHT_INCREASE=W
var H=U|F
ee.LIGHT_DECREASE=H
var z=new Int8Array([o,o,o])
function VoxelDataBase(e,t,r,a,i,o){this.pos=new Int32Array(3)
this.pos_world=new Int32Array(3)
this.mem_tracker=o
this.mem_tracker.count++
this.baseInit(e,t,r,a,i)}VoxelDataBase.prototype.baseInit=function(e,t,r,a,i){this.pos[0]=e
this.pos[1]=t
this.pos[2]=r
this.pos_world[0]=e*o
this.pos_world[1]=t*o
this.pos_world[2]=r*o
this.chunk_id=a
this.size=i||z
this.byte_size=this.size[0]*this.size[1]*this.size[2]
this.stride1=this.size[0]
this.stride2=this.size[0]*this.size[1]
this.data=null
this.liquid=null
this.props=null
this.setMemUsage(0)}
VoxelDataBase.prototype.setMemUsage=function(e){if(e!==this.mem_last_bytes){this.mem_tracker.bytes+=e-(this.mem_last_bytes||0)
this.mem_last_bytes=e}}
function createUtilVD(e){var t=new VoxelDataBase(0,0,0,M,e,r)
t.alloc()
return t}function voxelDataCreateEmpty(e){return new VoxelDataBase(0,0,0,M,e,r)}function serializeUInt8Array(e,t,r){if(!t)e.push(r,0)
else{var a=t[0]
var i=1
for(var o=1;o<r;++o)if(t[o]!==a){e.push(i,a)
i=1
a=t[o]}else i++
e.push(i,a)}}function deserializeUInt8ArrayFromBuffer(e,t,r){var a=t.str,i=t.offs
var o
function getc(){var e=a[i++]
if(e<=127)return e
else if(e>=192&&e<224)return(31&e)<<6|63&a[i++]
else if(e>=224&&e<240)return(15&e)<<12|(63&a[i++])<<6|63&a[i++]
else{o="Bad character"
return 0}}var n=i
var s=getc()
var l=getc()
if(o)return o
var _
if(!l&&s===r)_=null
else{i=n
_=new Uint8Array(r)
var c=0
for(;i<a.length&&c<r;){var u=getc()
var d=getc()
if(o)return o
if(c+u>r)return"overflow"
while(u){_[c++]=d
u--}}}t.offs=i
e.data=_
return null}function deserializeUInt8Array(e,t,r){var a=t.str
var i=a.charCodeAt(t.offs)
if(!a.charCodeAt(t.offs+1)&&i===r){t.offs+=2
return e.data=null}var o=new Uint8Array(r)
var n=0
for(;t.offs<a.length&&n<r;t.offs+=2){var s=a.charCodeAt(t.offs)
var l=a.charCodeAt(t.offs+1)
if(n+s>r)return"overflow"
while(s){o[n++]=l
s--}}e.data=o
return null}var V
var Y
var j
if("undefined"===typeof process){V=function utf8FromBuffer(){c(false)}
Y=function bufferAlloc(e){return new Uint8Array(e)}
j=function bufferClone(e,t,r){return e.slice(0,r)}}else{c($.alloc(1)instanceof Uint8Array)
V=function utf8FromBuffer(e,t){return $.from(e.buffer,e.byteOffset+t,e.byteLength-t).toString("utf8")}
Y=function bufferAlloc(e){return $.alloc(e)}
j=function bufferClone(e,t,r){return $.from(e.slice(t,r))}}VoxelDataBase.prototype.deserialize=function(e,t){if(!e)return false
var r=e instanceof Uint8Array
var a=r?e[0]:e.charCodeAt(0)
if(a!==x&&10!==a)return false
var i={str:e,offs:1}
var o={}
var n=r?deserializeUInt8ArrayFromBuffer:deserializeUInt8Array
var s=n(o,i,this.byte_size)
if(s){console.error(s)
return false}this.data=o.data
if(s=n(o,i,this.byte_size)){console.error(s)
return false}this.liquid=o.data
var l=0
if(this.data)l+=this.byte_size
if(this.liquid)l+=this.byte_size
if(i.offs!==e.length){if(!this.props)this.props={}
var _
if(r)_=V(e,i.offs)
else _=e.slice(i.offs)
l+=_.length
var c
try{c=JSON.parse(_)}catch(e){}if(!Array.isArray(c)||!c.length){console.error("invalid prop_list")
return false}if(t&&!this.data)this.alloc()
for(var u=0;u<c.length;++u){var d=c[u]
if(!Array.isArray(d)||4!==d.length){console.error("invalid prop_entry")
return false}var f=this.deserializeProp(d)
if(!f){console.error("deserializeProp failed")
return false}var v=f.pos[2]*this.stride2+f.pos[1]*this.stride1+f.pos[0]
if((this.props[v]=f).baked){if(!this.baked_props)this.baked_props={}
this.baked_props[v]=f.baked}if(f.draw){if(!this.drawable_props)this.drawable_props={}
this.drawable_props[v]=f}if(t&&this.data[v]!==h)this.data[v]=h}}this.setMemUsage(l)
return true}
var K=null
var q=0
var Z
function workBufWriteUTF8(e){if(e<=127)K[Z++]=e
else if(e<=2047){K[Z++]=e>>6|192
K[Z++]=63&e|128}else if(e<=65535){K[Z++]=e>>12|224
K[Z++]=e>>6&63|128
K[Z++]=63&e|128}else c(false,"Invalid character: "+e)}VoxelDataBase.prototype.serialize=function(e,t){c(!this.disposed)
var r=[x]
serializeUInt8Array(r,this.data,this.byte_size)
serializeUInt8Array(r,this.liquid,this.byte_size)
var a=""
if(this.props){var i=[]
for(var o in this.props)i.push(this.serializeProp(this.props[o]))
if(i.length)a=JSON.stringify(i)}if(t){var n=0
if(this.data)n+=this.byte_size
if(this.liquid)n+=this.byte_size
n+=a.length
this.setMemUsage(n)}if(e){var s=3*r.length+4*a.length
if(s>q){q=d(u(1.5*q),s)
K=Y(q)}for(var l=Z=0;l<r.length;++l)workBufWriteUTF8(r[l])
for(var _=0;_<a.length;++_)workBufWriteUTF8(a.charCodeAt(_))
c(Z<q)
return j(K,0,Z)}else return""+String.fromCharCode.apply(null,r)+a}
var X=new Uint8Array([0])
function unit8ArrayEquals(e,t){t=t||X
var r=d((e=e||X).length,t.length)
for(var a=0;a<r;++a)if((e[a]||0)!==(t[a]||0))return false
return true}VoxelDataBase.prototype.equals=function(e){c(!this.disposed)
c(!e.disposed)
if(!unit8ArrayEquals(this.data,e.data))return false
if(!unit8ArrayEquals(this.liquid,e.liquid))return false
var t=this.props||{}
var r=e.props||{}
for(var a in t){var i=t[a]
var o=r[a]
if(!o)return false
i=i.toJSON()
o=o.toJSON()
if(!s(i,o))return false}for(var n in r)if(!t[n])return false
return true}
VoxelDataBase.prototype.get=function(e,t){if(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2])return 0
var r=e[2]*this.stride2+e[1]*this.stride1+e[0]
if(t)return this.liquid[r]
else return this.data[r]}
VoxelDataBase.prototype.set=function(e,t,r){c(!(e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2]))
var a=e[2]*this.stride2+e[1]*this.stride1+e[0]
if(r)this.liquid[a]=t
else this.data[a]=t}
VoxelDataBase.prototype.getDirect=function(e,t){var r=t?this.liquid:this.data
if(!r)return null
return r[e]}
VoxelDataBase.prototype.getProp=function(e){if(!this.props||e[0]<0||e[1]<0||e[2]<0||e[0]>=this.size[0]||e[1]>=this.size[1]||e[2]>=this.size[2])return null
return this.props[e[2]*this.stride2+e[1]*this.stride1+e[0]]}
VoxelDataBase.prototype.getPropDirect=function(e){if(!this.props)return null
return this.props[e]}
VoxelDataBase.prototype.alloc=function(e){if(e){if(!this.liquid)this.liquid=new Uint8Array(this.byte_size)}else if(!this.data)this.data=new Uint8Array(this.byte_size)}
function ZMap(e){this.data=e||new Int16Array(n)}var Q=32
function zmapDeserialize(e,t){if(t.charCodeAt(0)!==Q)return"bad version"
if(e)c.equal(e.length,n)
var r=0
for(var a=1;a<t.length;){var i=t.charCodeAt(a++)-33
if(-1===i)i=-(t.charCodeAt(a++)-33)
var o=t.charCodeAt(a++)-31
if(r+o>n)return"overflow"
if(e)while(o){e[r++]=i;--o}else r+=o}if(r!==n)return"underflow"
return null}function zmapSerialize(e){c(e instanceof Int16Array)
c.equal(e.length,n)
var t=[Q]
var r=e[0]
var a=0
for(var i=0;i<n;++i){if(e[i]!==r){if(r<0){t.push(32)
r*=-1}t.push(r+33)
t.push(a+31)
r=e[i]
a=0}++a}if(r<0){t.push(32)
r*=-1}t.push(r+33)
t.push(a+31)
return String.fromCharCode.apply(null,t)}function resetDayIndex(e){return 1}}).call(this)}).call(this,J("buffer").Buffer)},{"../common/globals":248,"../glov/common/util":400,assert:void 0,buffer:void 0}],265:[function(e,t,r){"use strict"
r.waygateImagePath=waygateImagePath
r.waygate_invalid_ids=r.waygate_invalid_regex=r.waygate_valid_regex=r.MAX_WAYGATE_TARGETS=r.WAYGATE_ID_LEN=r.WAYGATE_MAX_VISUAL_SIZE=r.WAYGATE_NAME_LEN=r.MAX_WAYGATES=r.FLAT_SEED_EMPTY=r.FLAT_SEED_WATER=r.FLAT_SEED_GRASS_ON_STONE=void 0
var a
var i=2
r.FLAT_SEED_GRASS_ON_STONE=i
var o=4
r.FLAT_SEED_WATER=o
var n=225
r.FLAT_SEED_EMPTY=n
var s=1e3
r.MAX_WAYGATES=s
var l=32
r.WAYGATE_NAME_LEN=l
var _={font_height:24,width:320}
r.WAYGATE_MAX_VISUAL_SIZE=_
var c=16
r.WAYGATE_ID_LEN=c
var u=100
r.MAX_WAYGATE_TARGETS=u
var d=/^[a-z0-9_]{1,16}$/
r.waygate_valid_regex=d
var f=/^__.*__$/
r.waygate_invalid_regex=f
var v={info:1,admin:1,manage:1,share:1,players:1,stats:1,connect:1,undefined:1}
r.waygate_invalid_ids=v
var h=((a={})[i]="grass",a[o]="water",a[n]="empty",a[10]="snow",a[11]="sand",a[3]="stone",a[12]="stone_dark",a[13]="stone_light",a[14]="stone_red",a[5]="coal",a[41]="coral1",a[42]="coral2",a)
function waygateImagePath(e,t,r){var a=(e=e||{}).waygates||{}
if(!a[r=r||"default"])r="default"
var i=a[r]&&a[r].imgid
var o
if(i){var n=e.image&&e.image.sets&&e.image.sets[i]
var s=n&&n[t]
if(s)o=""+(n.prefix||"")+s}if(!o){o="img/placeholder/"
if("flat"===e.world_type)o+="flat_"+(h[e.seed]||"stone")
else o+="procgen"
o+="_"+t+"."+("thumb"===t?"png":"jpg")}return o}},{}],266:[function(e,t,r){"use strict"
r.waygateUpgradeGetData=waygateUpgradeGetData
r.waygateUpgradeCommonStartup=waygateUpgradeCommonStartup
r.SETTLEMENT_EDITVOLUME_SIZE=r.WAYGATE_UPGRADES=r.WAYGATE_TIERS=void 0
var p=[]
r.WAYGATE_TIERS=p
var m=Object.create(null)
r.WAYGATE_UPGRADES=m
var a=256
r.SETTLEMENT_EDITVOLUME_SIZE=a
var E=e("assert")
var i=e("./ids")
var g=i.ITEM_ANVIL
var T=i.ITEM_BONFIRE
var y=i.ITEM_BONFIRE_METAL
var S=i.ITEM_BRANCHFORGE
var I=i.ITEM_BUCKET
var A=i.ITEM_CORD
var w=i.ITEM_ENERGY_WELL
var L=i.ITEM_FLOUR
var O=i.ITEM_FURNACE_GLASS
var R=i.ITEM_FURNACE_ORE
var b=i.ITEM_INGOT
var N=i.ITEM_JUICER
var C=i.ITEM_KILN
var x=i.ITEM_MILL
var M=i.ITEM_OVEN
var D=i.ITEM_PAINT_MIXER
var P=i.ITEM_ROD
var B=i.ITEM_SAWMILL
var k=i.ITEM_STONECUTTER_SIMPLE
var U=i.ITEM_TOOL_HEAD
var G=i.ITEM_TOOL_HEAD_CAST
var F=i.ITEM_VEINIUM_GRINDER
var W=i.ITEM_WATERING_SYSTEM
var H=i.ITEM_WORKBENCH
var z=i.TYPE_BLOCK
var V=i.TYPE_CRAFT_CLASS
var Y=i.TYPE_ITEM
var o=e("./materials_common")
var j=o.CraftClass
var K=o.Mat
function createItemServer(e){return{count:e.count}}function waygateUpgradeGetData(e){return m[e]}function waygateUpgradeCommonStartup(e,t){e=e||createItemServer
var r=t||{},a=r.TILE_DIRT,i=r.TILE_BRICK_STONE,o=r.TILE_LEAVES3,n=r.TILE_SAND,s=r.TILE_WATER,l=r.TILE_VEINIUM,_=r.TILE_WOOD,c=r.TILE_WOOD_LIGHT,u=r.TILE_WOOD_DARK,d=r.TILE_WOOD_RED
p.push({name:"Primitive",unlocks:[],radius:20},{name:"Basic Industry",cost:{cost1:e({type:z,id:a,count:10}),cost2:e({type:V,id:j.STONE_RAW,count:10}),cost3:e({type:V,id:j.WOOD_RAW,count:10})},unlocks:[H,k,w],radius:20},{name:"Tools",cost:{cost1:e({type:Y,id:A,count:1}),cost2:e({type:Y,id:U,attr1:K.ANY,count:1})},unlocks:[B],unlocks_recipes:["shovel","pickax","hatchet","wood_bucket"],radius:25},{name:"Metals",cost:{cost1:e({type:Y,id:P,attr1:K.ANY,count:5}),cost2:e({type:V,id:j.BRICK,count:10}),cost3:e({type:Y,id:I,attr1:K.ANY,attr2:s,count:1}),cost4:e({type:V,id:j.FARMING_SEED,count:1}),cost5:e({type:z,id:l,count:10})},unlocks:[R,G],unlocks_recipes:["hoe"],radius:30},{name:"Mill and Alloys",cost:{cost1:e({type:V,id:j.CEREAL_GRAIN,count:1}),cost2:e({type:Y,id:b,attr1:K.COPPER,count:3}),cost3:e({type:Y,id:b,attr1:K.TIN,count:1}),cost4:e({type:z,id:l,count:100})},unlocks:[O,x],unlocks_recipes:["alloy"],radius:35},{name:"Oven",cost:{cost1:e({type:Y,id:L,count:1}),cost2:e({type:Y,id:b,attr1:K.BRONZE,count:1})},unlocks:[M,T,y],radius:40},{name:"Juicer",cost:{cost1:e({type:V,id:j.BAKED_FOOD,count:1}),cost2:e({type:Y,id:b,attr1:K.IRON,count:1})},unlocks:[N,W,D,F],radius:45},{name:"That's All For Now!",cost:{cost1:e({type:Y,id:b,attr1:K.GOLD,count:10})},radius:45})
var f=0
function addUpgrade(e,t){E(!m[e])
t.upgrade_idx=++f
m[e]=t}addUpgrade("radius1",{name:"Size 1",cost:{cost1:e({type:z,id:l,count:100})},radius_add:20,prereqs:["tier2"]})
addUpgrade("radius2",{name:"Size 2",cost:{cost1:e({type:V,id:j.STONE_RAW,count:1e3})},radius_add:20,prereqs:["radius1"]})
addUpgrade("branchforge",{name:"Forestry",cost:{cost1:e({type:z,id:_,count:10}),cost2:e({type:z,id:c,count:10}),cost3:e({type:z,id:u,count:10}),cost4:e({type:z,id:d,count:10})},unlocks:[S],prereqs:["tier2"]})
addUpgrade("growstick",{name:"Growsticks",cost:{cost1:e({type:Y,id:P,attr1:K.ANY,count:2}),cost2:e({type:z,id:o,count:25})},unlocks_recipes:["growstick","growstick_repair"],prereqs:["branchforge"]})
addUpgrade("dowser_simple",{name:"Prospecting",cost:{cost1:e({type:Y,id:P,attr1:K.ANY,count:2}),cost2:e({type:z,id:l,count:10})},unlocks_recipes:["dowser_simple"],prereqs:["tier3"]})
addUpgrade("kiln",{name:"Bricks and Charcoal",cost:{cost1:e({type:z,id:n,count:30}),cost2:e({type:Y,id:b,attr1:K.COPPER,count:10})},unlocks:[C],prereqs:["tier3"]})
addUpgrade("dowser_advanced",{name:"Advanced Prospecting",cost:{cost1:e({type:z,id:l,count:200})},unlocks_recipes:["dowser_advanced"],prereqs:["dowser_simple"]})
addUpgrade("metalworking",{name:"Advanced Metalworking",cost:{cost1:e({type:z,id:i,count:100}),cost2:e({type:z,id:l,count:200})},unlocks:[g],prereqs:["tier3"]})
addUpgrade("radius3",{name:"Size 3",cost:{cost1:e({type:V,id:j.STONE_RAW,count:1e4}),cost2:e({type:z,id:l,count:1e3})},radius_add:20,prereqs:["radius2"]})
for(var v=0;v<p.length;++v){p[v].is_tier=true
p[v].tier_idx=v
m["tier"+v]=p[v]}for(var h in m)m[h].key=h}},{"./ids":249,"./materials_common":253,assert:void 0}],267:[function(e,t,r){"use strict"
r.boostLevelFromCount=boostLevelFromCount
r.WORLD_SKY_OPTIONS=r.BOOST_KICKBACK=r.BOOST_STREAK_GRACE=r.BOOST_STREAK_GRACE_DAYS=r.BOOST_COOLDOWN=r.BOOST_GRANULARITY=r.BOOST_PERKS=r.BOOST_MAX_LEVEL=r.BOOST_THRESHOLDS=r.BOOST_ICON_MAX=r.VALID_GEM_ID=r.USER_LIMIT_MAX_BUILDER=r.CHAT_MINIMUM_ACCOUNT_AGE_MINIMUM=r.CHAT_MINIMUM_ACCOUNT_AGE_MAXIMUM=r.CHAT_COOLDOWN_MINIMUM=r.CHAT_COOLDOWN_MAXIMUM=r.WORLD_DIG_MAX_CLIENTS=r.DEFAULT_RACE_AS_VISITOR_LF=r.DEFAULT_RACE_AS_VISITOR_UNL=r.WORLD_RACE_AS_VISITOR_AUTO=r.WORLD_RACE_AS_VISITOR_ON=r.WORLD_RACE_AS_VISITOR_OFF=r.WORLD_ACCESS_MODIFY_BUILDER=r.WORLD_ACCESS_MODIFY_LIMITED=r.WORLD_ACCESS_READONLY=r.WORLD_ACCESS_NONE=r.WAYGATE_SETTLEMENT_AUTO=r.WAYGATE_SETTLEMENT_REGEX=r.WAYGATE_SETTLEMENT_PREFIX=r.VOLUME_SETTLEMENT_PREFIX=r.WAYGATE_FLAG_SETTLEMENT=r.WAYGATE_FLAG_LISTED=r.WORLDINFO_LEVEL_ALL=r.WORLDINFO_LEVEL_BASIC_WITH_STATS=r.WORLDINFO_LEVEL_BASIC=r.ATTRIB_FIXED_MAX=r.DEFAULT_TOOL_LOCK_UNLIMITED=r.DEFAULT_TOOL_LOCK_ADVENTURE=r.TOOL_LOCK_CRAFTED=r.TOOL_LOCK_ANY=r.DEFAULT_ACCESS_LEAPGATE=r.DEFAULT_ACCESS_GIVE_UNLIMITED=r.DEFAULT_ACCESS_GIVE_ADVENTURE=r.DEFAULT_ACCESS_UNLIMITED_ITEMS_UNLIMITED=r.DEFAULT_ACCESS_UNLIMITED_ITEMS_ADVENTURE=r.DEFAULT_ACCESS_AREA_CLEAR=r.DEFAULT_ACCESS_SETTLEMENT=r.DEFAULT_ACCESS_SAPLING=r.DEFAULT_ACCESS_VOLUME=r.DEFAULT_ACCESS_EXVOLUME=r.THRESHOLD_ACCESS_MANAGE_VOLUMES=r.ACCESS_FROM_STRING=r.ACCESS_TO_STRING=r.ACCESS_NONE_HIGH=r.ACCESS_DEV=r.ACCESS_OWNER_BOOSTER=r.ACCESS_OWNER=r.ACCESS_ADMIN_BOOSTER=r.ACCESS_ADMIN=r.ACCESS_BUILDER_BOOSTER=r.ACCESS_BUILDER=r.ACCESS_AREA_BUILDER_BOOSTER=r.ACCESS_AREA_BUILDER=r.THRESHOLD_ACCESS_MODIFY=r.ACCESS_READONLY_BOOSTER=r.ACCESS_READONLY=r.THRESHOLD_ACCESS_AVATAR=r.ACCESS_SPECTATOR_BOOSTER=r.ACCESS_SPECTATOR=r.THRESHOLD_ACCESS_ALLOWED=r.ACCESS_PUBLIC=r.ACCESS_NONE=void 0
var a=0
r.ACCESS_NONE=a
var i=1
r.ACCESS_PUBLIC=i
var o=2
r.THRESHOLD_ACCESS_ALLOWED=o
var n=10
r.ACCESS_SPECTATOR=n
var s=11
r.ACCESS_SPECTATOR_BOOSTER=s
var l=15
r.THRESHOLD_ACCESS_AVATAR=l
var _=20
r.ACCESS_READONLY=_
var c=21
r.ACCESS_READONLY_BOOSTER=c
var u=25
r.THRESHOLD_ACCESS_MODIFY=u
var d=40
r.ACCESS_AREA_BUILDER=d
var f=41
r.ACCESS_AREA_BUILDER_BOOSTER=f
var v=50
r.ACCESS_BUILDER=v
var h=51
r.ACCESS_BUILDER_BOOSTER=h
var p=80
r.ACCESS_ADMIN=p
var m=81
r.ACCESS_ADMIN_BOOSTER=m
var E=90
r.ACCESS_OWNER=E
var g=91
r.ACCESS_OWNER_BOOSTER=g
var T=99
r.ACCESS_DEV=T
var y=100
r.ACCESS_NONE_HIGH=y
var S=[];(r.ACCESS_TO_STRING=S)[a]="NONE"
S[n]="SPECTATOR"
S[s]="SPECTATORBOOSTER"
S[_]="READONLY"
S[c]="READONLYBOOSTER"
S[d]="AREABUILDER"
S[f]="AREABUILDERBOOSTER"
S[v]="BUILDER"
S[h]="BUILDERBOOSTER"
S[p]="ADMIN"
S[m]="ADMINBOOSTER"
S[E]="OWNER"
S[g]="OWNERBOOSTER"
S[T]="DEV"
S[y]="NONE_HIGH"
var I=function(){var e={}
for(var t in S){var r=Number(t)
e[S[r]]=r
e[t]=r}return e}()
r.ACCESS_FROM_STRING=I
var A=p
r.THRESHOLD_ACCESS_MANAGE_VOLUMES=A
var w=v
r.DEFAULT_ACCESS_EXVOLUME=w
var L=_
r.DEFAULT_ACCESS_VOLUME=L
var O=v
r.DEFAULT_ACCESS_SAPLING=O
var R=v
r.DEFAULT_ACCESS_SETTLEMENT=R
var b=E
r.DEFAULT_ACCESS_AREA_CLEAR=b
var N=y
r.DEFAULT_ACCESS_UNLIMITED_ITEMS_ADVENTURE=N
var C=d
r.DEFAULT_ACCESS_UNLIMITED_ITEMS_UNLIMITED=C
var x=y
r.DEFAULT_ACCESS_GIVE_ADVENTURE=x
var M=d
r.DEFAULT_ACCESS_GIVE_UNLIMITED=M
var D=d
r.DEFAULT_ACCESS_LEAPGATE=D
var P=0
r.TOOL_LOCK_ANY=P
var B=4
var k=r.TOOL_LOCK_CRAFTED=B
r.DEFAULT_TOOL_LOCK_ADVENTURE=k
var U=0
r.DEFAULT_TOOL_LOCK_UNLIMITED=U
var G=1e6
r.ATTRIB_FIXED_MAX=G
var F=1
r.WORLDINFO_LEVEL_BASIC=F
var W=3
r.WORLDINFO_LEVEL_BASIC_WITH_STATS=W
var H=9
r.WORLDINFO_LEVEL_ALL=H
var z=1
r.WAYGATE_FLAG_LISTED=z
var V=2
r.WAYGATE_FLAG_SETTLEMENT=V
var Y="s:"
r.VOLUME_SETTLEMENT_PREFIX=Y
var j="s"
r.WAYGATE_SETTLEMENT_PREFIX=j
var K=/^s\d+/
r.WAYGATE_SETTLEMENT_REGEX=K
var q="settlement_auto"
r.WAYGATE_SETTLEMENT_AUTO=q
var Z=0
r.WORLD_ACCESS_NONE=Z
var X=2
r.WORLD_ACCESS_READONLY=X
var Q=4
r.WORLD_ACCESS_MODIFY_LIMITED=Q
var $=8
r.WORLD_ACCESS_MODIFY_BUILDER=$
var J=0
r.WORLD_RACE_AS_VISITOR_OFF=J
var ee=1
r.WORLD_RACE_AS_VISITOR_ON=ee
var te=2
var re=r.WORLD_RACE_AS_VISITOR_AUTO=te
r.DEFAULT_RACE_AS_VISITOR_UNL=re
var ae=J
r.DEFAULT_RACE_AS_VISITOR_LF=ae
var ie=15
r.WORLD_DIG_MAX_CLIENTS=ie
var oe=180
r.CHAT_COOLDOWN_MAXIMUM=oe
var ne=0
r.CHAT_COOLDOWN_MINIMUM=ne
var se=1440
r.CHAT_MINIMUM_ACCOUNT_AGE_MAXIMUM=se
var le=0
r.CHAT_MINIMUM_ACCOUNT_AGE_MINIMUM=le
var _e=35
r.USER_LIMIT_MAX_BUILDER=_e
var ce=/^[a-zA-Z0-9_]+$/
r.VALID_GEM_ID=ce
var ue=6
r.BOOST_ICON_MAX=ue
var de=[0,1,4,15]
var fe=(r.BOOST_THRESHOLDS=de).length-1
r.BOOST_MAX_LEVEL=fe
function boostLevelFromCount(e){for(var t=1;t<de.length;++t)if(e<de[t])return t-1
return fe}var ve=[{builder_limit:4,chat_hist:50,boost_icon:2,spinners:[],info_bgs:[],skies:["underwater","underground","fog"]},{builder_limit:6,chat_hist:100,boost_icon:2,spinners:["RLSCROWN","RLSTROPHY","RLSFRVR"],info_bgs:["DAWN","AFTERNOON","SUNSET","MIDNIGHT"],skies:["underwater","underground","fog","bloodmoon","fog_crimson","disco_torch","lighting_blue","lighting_violet","lighting_cyan","sunset_red","sunset_green","sunset_yellow","overcast"]},{builder_limit:12,chat_hist:200,boost_icon:ue+1,spinners:["RLSCROWN","RLSTROPHY","RLSFRVR","RLSSTAR","RLSRACE","RLSCAFE","RLSLF","RLSCASTLE"],info_bgs:["DAWN","AFTERNOON","SUNSET","MIDNIGHT","custom"],skies:["underwater","underground","fog","bloodmoon","fog_crimson","disco_torch","lighting_blue","lighting_violet","lighting_cyan","sunset_red","sunset_green","sunset_yellow","overcast"]},{builder_limit:35,chat_hist:400,boost_icon:ue+1,spinners:["RLSCROWN","RLSTROPHY","RLSFRVR","RLSSTAR","RLSRACE","RLSCAFE","RLSLF","RLSCASTLE","custom"],info_bgs:["DAWN","AFTERNOON","SUNSET","MIDNIGHT","custom"],skies:["underwater","underground","fog","bloodmoon","fog_crimson","disco_torch","lighting_blue","lighting_violet","lighting_cyan","sunset_red","sunset_green","sunset_yellow","overcast"]}]
r.BOOST_PERKS=ve
var he=30
r.BOOST_GRANULARITY=he
var pe=5
r.BOOST_COOLDOWN=pe
var me=7
r.BOOST_STREAK_GRACE_DAYS=me
var Ee=626400
r.BOOST_STREAK_GRACE=Ee
var ge=10
r.BOOST_KICKBACK=ge
var Te=ve[fe].skies
r.WORLD_SKY_OPTIONS=Te},{}],268:[function(e,t,r){"use strict"
r.worldTransSetPropCheck=worldTransSetPropCheck
r.encodeChunkPos=encodeChunkPos
r.decodeChunkPos=decodeChunkPos
r.decodeWorldPos=decodeWorldPos
r.Transaction=Transaction
r.TransactionSet=TransactionSet
r.createTransSet=createTransSet
r.pristine_fields=void 0
var J=e("assert")
var a=e("../glov/common/util")
var i=a.callEach
var s=a.isInteger
var o=e("./globals")
var n=o.CHUNK_SIZE
var l=o.ID2
var _=o.ID_FACTOR
var ee=e("./items_common").sameItem
var c=e("./voxel_data_common")
var u=c.ANIM_STYLE_BEAM
var d=c.ANIM_STYLE_PHYS
var f=c.ANIM_TYPE_PLAYER
var v=c.ANIM_TYPE_POS
var te=c.TRANSACT_BAG_ADD
var h=c.TRANSACT_BLUEBOX_INFO
var p=c.TRANSACT_INV_ATTRIB
var m=c.TRANSACT_INV_MOD
var re=c.TRANSACT_ITEM_ANIM
var E=c.TRANSACT_LEAPGATE_PROGRESS
var g=c.TRANSACT_PROP_CHAT
var ae=c.TRANSACT_PROP_INV_MOD
var ie=c.TRANSACT_PROP_MOD
var oe=c.TRANSACT_PROP_SET
var T=c.TRANSACT_SETTLEMENT_PROGRESS
var y=c.TRANSACT_STAT
var S=c.TRANSACT_USER_ATTRIB
var I=c.TRANSACT_VOLUME_MOD
var ne=c.TRANSACT_VOXEL_SET
var A=c.TRANSACT_VOXEL_SET_RLE
var w=c.TRANS_INV_EQUIP
var L=c.TRANS_INV_PLAYER
var O=Math.min,R=Math.round
var se=1
var b=8
var N={pristine_sends:"p",hexome_choices:"h",detail_data:"d"}
r.pristine_fields=N
var C
function worldTransSetPropCheck(e){C=e}function itemAttribString(e,t){var r=[]
if(e.attr1){J(s(e.attr1))
r.push("1",e.attr1)}if(e.attr2){J(s(e.attr2))
r.push("2",e.attr2)}if(e.attr3){J(s(e.attr3))
r.push("3",e.attr3)}for(var a in e.attribs){var i=e.attribs[a]
J(i)
J(s(i))
if(a!==t)r.push(a,i)}return r.join(",")}function itemFromAttribString(e,t){if(!t)return
var r=t.split(",")
for(var a=0;a<r.length;a+=2){var i=r[a]
var o=Number(r[a+1])
switch(i){case"1":e.attr1=o
break
case"2":e.attr2=o
break
case"3":e.attr3=o
break
default:if(!e.attribs)e.attribs={}
e.attribs[i]=o}}}function pushItem(e,t){e.push(itemAttribString(t),t.type,t.id,t.count)}function pullItem(e,t){var r={type:e[t+1],id:e[t+2],count:e[t+3]}
itemFromAttribString(r,e[t])
return r}function encodeChunkPos(e){J(s(e[0])&&e[0]>=0&&e[0]<16)
J(s(e[1])&&e[1]>=0&&e[1]<16)
J(s(e[2])&&e[2]>=0&&e[2]<16)
return(e[2]<<8)+(e[1]<<4)+e[0]}function decodeChunkPos(e){return[15&e,(240&e)>>4,(3840&e)>>8]}function decodeWorldPos(e,t,r){var a=R(t/l)
var i=R((t-=a*l)/_)
t-=i*_
e[0]=t*n+(15&r)
e[1]=i*n+((240&r)>>4)
e[2]=a*n+((3840&r)>>8)
return e}function Transaction(e){this.tset=e
this.ops=[]
this.submitted=false}Transaction.prototype.toJSON=function(){return this.ops}
Transaction.prototype.onComplete=function(e){J(!this.submitted)
if(this.cbs)this.cbs.push(e)
else this.cbs=[e]}
Transaction.prototype.callCallbacks=function(e){i(this.cbs,null,e)}
Transaction.prototype.numOps=function(){return this.ops.length}
Transaction.prototype.get=function(e){return this.ops[e]}
Transaction.prototype.opSet=function(e,t,r,a,i,o){J(!this.submitted)
var n=[ne,e,t,r,(a?1:0)+(i?2:0),o]
this.ops.push(n)
return n}
Transaction.prototype.opInvAttrib=function(e){J(!this.submitted)
J(e.attrib)
J(e.delta)
J(s(e.delta))
var t=!e.prop.user_inv_type
J(!t)
var r=e.prop.contents[e.idx]
J(r)
var a=[p,e.attrib,itemAttribString(r,e.attrib),r.type,r.id,e.delta,e.idx,e.prop.user_inv_type]
this.ops.push(a)}
Transaction.prototype.getInvAttrib=function(e){var t=this.get(e)
J(t)
if(t[0]!==p)return null
if(8!==t.length)return null
var r={idx:t[6],item:{type:t[3],id:t[4]},attrib:t[1],delta:t[5],user_inv_type:t[7]}
itemFromAttribString(r.item,t[2])
if(r.user_inv_type!==L&&r.user_inv_type!==w)return null
return r}
Transaction.prototype.opUserAttrib=function(e,t){J(!this.submitted)
J(e)
J(t)
J(s(t))
var r=[S,e,t]
this.ops.push(r)}
Transaction.prototype.getUserAttrib=function(e){var t=this.get(e)
J(t)
if(t[0]!==S)return null
if(3!==t.length)return null
return{attrib:t[1],delta:t[2]}}
Transaction.prototype.opStat=function(e,t){J(!this.submitted)
J.equal(typeof e,"string")
J(s(t)&&t>0)
this.ops.push([y,e,t])}
Transaction.prototype.opSettlementProgress=function(e,t,r,a,i){J(!this.submitted)
J(s(e))
J.equal(typeof t,"string")
J.equal(typeof r,"string")
J.equal(typeof a,"string")
J(s(i)&&i>0,i)
this.ops.push([T,t,r,a,e,i])}
Transaction.prototype.opBlueboxInfo=function(e,t){this.ops.unshift([h,e,t])}
Transaction.prototype.opVolumeMod=function(e,t,r){J(!this.submitted)
J(s(e))
J.equal(typeof t,"string")
this.ops.push([I,t,r,e])}
Transaction.prototype.opLeapgateProgress=function(e,t,r,a,i){J(!this.submitted)
J(void 0!==i.cost1)
J(void 0!==i.cost2)
J(void 0!==i.cost3)
var o=e.chunk_id
var n=e.pos_idx
if(s(e.leapgate_destination_chunk_id)){o=e.leapgate_destination_chunk_id
n=e.leapgate_destination_pos_idx}else if("cost0"===t){o=r.attr2
n=r.attr3}this.ops.push([E,t,itemAttribString(r),itemAttribString(i.cost1),itemAttribString(i.cost2),itemAttribString(i.cost3),r.type,r.id,a,i.cost1.type,i.cost1.id,i.cost1.count,i.cost2.type,i.cost2.id,i.cost2.count,i.cost3.type,i.cost3.id,i.cost3.count,e.chunk_id,e.pos_idx,o,n])}
Transaction.prototype.opInvMod=function(e){J(!this.submitted)
J(e.prop)
var t=!e.prop.user_inv_type
if(t&&C)C(e.prop)
var r
var a=e.item
if(e.add){r=a.count||1
J(!e.delta)}else{J(e.delta)
r=e.delta}var i=(e.add?se:0)+(e.prop.destroy_on_empty&&e.delta<0?b:0)
var o=[t?ae:m]
pushItem(o,a)
o[4]=r
o.push(e.idx,i)
if(t)o.push(e.prop.chunk_id,encodeChunkPos(e.prop.pos),e.prop.version||0)
else o.push(e.prop.user_inv_type)
o.pred=e.pred
o.cb=e.cb
this.ops.push(o)}
Transaction.prototype.getInvMod=function(e){var t=this.get(e)
J(t)
var r=t[0]
var a=r===ae
if(r!==m&&!a)return null
if(t.length!==(a?10:8))return null
var i=t[5]
var o=t[6]
var n={idx:i,add:Boolean(o&se),item:{type:t[2],id:t[3]},pred:t.pred}
itemFromAttribString(n.item,t[1])
var s=t[4]
if(n.add){if(s>1)n.item.count=s}else n.delta=s
if(a){n.prop_destroy_on_empty=Boolean(o&b)
n.prop_chunk_id=t[7]
n.prop_pos_idx=t[8]
n.prop_pos=decodeChunkPos(n.prop_pos_idx)
n.prop_version=t[9]}else{n.user_inv_type=t[7]
if(n.user_inv_type!==L&&n.user_inv_type!==w)return null}return n}
Transaction.prototype.opBagAdd=function(e,t,r){J(!this.submitted)
var a=r.no_pickup,i=r.item,o=r.is_update_func
var n=r.src_offs
var s=(o?1:0)+(i.stackable?2:0)
var l=[te,a]
pushItem(l,i)
l.push(e,encodeChunkPos(t),n[0],n[1],n[2],s)
this.ops.push(l)}
Transaction.prototype.getBagAdd=function(e){var t=this.get(e)
J(t)
if(t[0]!==te)return null
if(12!==t.length)return null
var r=t[11]
var a={no_pickup:t[1],item:pullItem(t,2),target_chunk_id:t[6],target_pos_idx:t[7],target_pos:decodeChunkPos(t[7]),src_offs:t.slice(8,11),is_update_func:1&r,stackable:2&r}
if(1===a.item.count)delete a.item.count
return a}
Transaction.prototype.getLeapgateProgressItem=function(e,t){var r=this.get(e)
J(r)
if(r[0]!==E)return null
if(22!==r.length)return null
var a=6+3*t
var i=2+t
var o={type:r[a],id:r[a+1],count:r[a+2]}
itemFromAttribString(o,r[i])
return o}
Transaction.prototype.opPropSet=function(e,t,r,a){J(!this.submitted)
var i=[oe,a?JSON.stringify(a.toJSON()):"",e||0,t,encodeChunkPos(r)]
this.ops.push(i)
return i}
Transaction.prototype.opPropChat=function(e,t,r,a,i){J(!this.submitted)
var o=[g,r,a?JSON.stringify(a):"",i||"",e,t]
J.equal(typeof o[1],"string")
J.equal(typeof o[2],"string")
J.equal(typeof o[3],"string")
this.ops.push(o)
return o}
Transaction.prototype.getPropChat=function(e){var t=this.get(e)
J.equal(t[0],g)
if(6!==t.length)return null
var r=t[1]
var a
try{if(t[2])a=JSON.parse(t[2])
else a=null}catch(e){console.error("Error parsing prop_mod value",e)
return null}var i=t[3]
var o=t[4]
var n=t[5]
return{chunk_id:o,pos_idx:n,pos:decodeChunkPos(n),key:r,params:a,style_id:i}}
Transaction.prototype.opPropMod=function(e,t,r,a,i,o){J(!this.submitted)
var n=[ie,r,JSON.stringify(a),JSON.stringify(i),e,encodeChunkPos(t),o,0]
J.equal(typeof n[2],"string")
J.equal(typeof n[3],"string")
this.ops.push(n)
return n}
Transaction.prototype.getPropMod=function(e){var t=this.get(e)
J.equal(t[0],ie)
if(8!==t.length)return null
var r=t[1]
var a
var i
try{i=JSON.parse(t[2])
a=JSON.parse(t[3])}catch(e){console.error("Error parsing prop_mod value",e)
return null}var o=t[4]
var n=t[5]
return{field:r,old_value:i,new_value:a,item_id:t[6],version:t[7],chunk_id:o,pos_idx:n,pos:decodeChunkPos(n),pred:t.pred}}
var x=/,"attribs":\{[^}]*\}/g
Transaction.prototype.opItemAnim=function(e,t,r,a,i,o,n,s,l){J(!this.submitted)
J(i)
J(s)
J(l.length)
J(l[0])
var _=(t?1:0)+(r===f?2:0)+(o===f?4:0)+(e===u?8:0)
var c=[re,JSON.stringify(l).replace(x,""),_,r===f?i:a,r===v?encodeChunkPos(i):0,o===f?s:n,o===v?encodeChunkPos(s):0]
this.ops.push(c)
return c}
Transaction.prototype.getItemAnim=function(e){var t=this.get(e)
if(t[0]!==re)return null
if(7!==t.length)return null
var r=t[2]
var a=Boolean(1&r)
var i=2&r?f:v
var o=4&r?f:v
var n=8&r?u:d
var s=t[1]
var l
try{l=JSON.parse(s)}catch(e){console.error("Error parsing items string",e)
return null}var _={style:n,from_center:a,src_type:i,target_type:o,items:l}
if(i===v){_.src_chunk_id=t[3]
_.src_pos_idx=t[4]
_.src_pos=decodeChunkPos(t[4])}else _.src=t[3]
if(o===v){_.target_chunk_id=t[5]
_.target_pos_idx=t[6]
_.target_pos=decodeChunkPos(t[6])}else _.target=t[5]
return _}
Transaction.prototype.compact=function(){profilerStart("compact:compact")
var e=this.ops
profilerStart("voxel_set")
var t=this.loose_compaction
J(e.length)
var r=[{},{}]
for(var a=0;a<e.length;++a){var i=e[a]
if(i[0]!==ne)continue
var o=r[1&i[4]]
var n=i[1]
var s=i[2]
var l=o[n]
if(!l)l=o[n]={}
var _=i[3]
var c=i[5]
if(l[s]){var u=l[s]-1
var d=e[u]
if(d[3]===c);else if(d[5]===c){J(t)
if(d[3]===_);else{J(i.loose_priority&&d.loose_priority)
if(i.loose_priority>d.loose_priority);else _=d[3]}}else J(false)
d[3]=_
d[4]&=i[4]
e.splice(a,1);--a
if(d[3]===d[5]){e.splice(u,1)
delete l[s];--a
for(var f=0;f<r.length;++f){var v=r[f]
for(var h in v){var p=v[h]
for(var m in p)if(p[m]>u)--p[m]}}}}else l[s]=a+1}profilerStopStart("prop_set")
var E={}
for(var g=0;g<e.length;++g){var T=e[g]
if(T[0]!==oe)continue
var y=T[3]+","+T[4]
if(E[y]){var S=e[E[y]-1]
if(""===S[1]&&""===T[1]);else{if(""===S[1]||""===T[1]);else J.equal(S[1],"")
J(!T[2]||S[1]&&T[2]===JSON.parse(S[1]).v)}S[1]=T[1]
e.splice(g,1);--g}else E[y]=g+1}profilerStopStart("prop_inv_mod")
E={}
for(var I=0;I<e.length;++I){var A=e[I]
if(A[0]!==ae)continue
var w=A[7]+","+A[8]+","+A[5]
var L=A[6]
if(L===se){if(E[w]);E[w]=I+1}else if(!L)if(!E[w])E[w]=I+1
else{var O=E[w]-1
var R=e[O]
J.equal(R[1],A[1])
J.equal(R[2],A[2])
J.equal(R[3],A[3])
J(R[4])
J(A[4])
R[4]+=A[4]
e.splice(I,1);--I
if(!R[4]){e.splice(O,1)
delete E[w];--I
for(var b in E)if(E[b]>O)--E[b]}}}profilerStopStart("item_anims")
E={}
for(var N=0;N<e.length;++N){var C=e[N]
if(C[0]!==re)continue
var x=[C[2],C[3],C[4],C[5],C[6]].join(",")
var M=E[x]
if(M){var D=e[M-1]
var P=JSON.parse(C[1])
var B=JSON.parse(D[1])
for(var k=0;k<B.length;++k){var U=B[k]
var G=false
for(var F=0;F<P.length;++F){var W=P[F]
if(ee(W,U)){W.count=(W.count||1)+(U.count||1)
G=true
break}}if(!G)P.push(U)}D[1]=JSON.stringify(P)
e.splice(N,1);--N}else E[x]=N+1}profilerStopStart("bag_add")
E={}
for(var H=0;H<e.length;++H){var z=e[H]
if(z[0]!==te)continue
var V=[z[1],z[2],z[3],z[4],z[6],z[7],z[11]].join(",")
var Y=E[V]
if(Y){var j=e[Y-1]
J(j[5]>0)
J(z[5]>0)
j[5]+=z[5]
e.splice(H,1);--H}else E[V]=H+1}profilerStopStart("prop_mod")
E={}
for(var K=0;K<e.length;++K){var q=e[K]
if(q[0]!==ie)continue
var Z=[q[1],q[4],q[5]].join(",")
if(E[Z]){var X=E[Z]-1
var Q=e[X]
J.equal(Q[3],q[2])
J.equal(Q[6],q[6])
Q[3]=q[3]
e.splice(K,1);--K
if(Q[2]===Q[3]){e.splice(X,1);--K
delete E[Z]
for(var $ in E)if(E[$]>X)--E[$]}}else E[Z]=K+1}profilerStop()
profilerStopStart("compact:compress")
this.compress()
profilerStop()
J(e.length)}
function cmpNumber(e,t){return e-t}var M
var D
function compressRLERecord(e,t){var r=O.apply(Math,t)
var a=[]
for(var i=0;i<t.length;++i){var o=t[i]
var n=e[o][2]
a.push(n)
if(o!==r){M=true
D[o]=1}}a.sort(cmpNumber)
var s=e[r]
J(s[0]===ne)
s[0]=A
var l=0
var _=a[l]
s[2]=_
while(true){var c=0
while(l<a.length&&a[l]===_){++c;++l;++_}J(c)
s.push(c)
if(l===a.length)return
var u=a[l]
s.push(u-_)
_=u}}Transaction.prototype.compress=function(){var e=this.ops
var t={}
if(!D||D.length<e.length)D=new Uint8Array(e.length)
M=false
for(var r=0;r<e.length;++r){D[r]=0
var a=e[r]
if(a[0]!==ne)continue
var i=a[1]
var o=a[3]
var n=a[4]
var s=a[5]
var l=t[n]
if(!l)l=t[n]={}
var _=l[i]
if(!_)_=l[i]={}
var c=_[s]
if(!c)c=_[s]={}
var u=c[o]
if(!u)u=c[o]=[]
u.push(r)}for(var d in t){var f=t[d]
for(var v in f){var h=f[v]
for(var p in h){var m=h[p]
for(var E in m){var g=m[E]
if(g.length>1)compressRLERecord(e,g)}}}}if(M)this.ops=e.filter(function(e,t){return!D[t]})}
Transaction.prototype.isUpdateFunc=function(){for(var e=0;e<this.ops.length;++e){var t=this.ops[e]
switch(t[0]){case ne:case A:if(2&t[4])return true
break
case te:if(1&t[11])return true}}return false}
function TransactionSet(e){for(var t in N)this[t]=null
this.trans_list=e||[]}TransactionSet.prototype.sendPristine=function(e,t){if(!this.pristine_sends)this.pristine_sends={}
J(!this.pristine_sends[e])
this.pristine_sends[e]=t}
TransactionSet.prototype.sendHexomeChoice=function(e,t){if(!this.hexome_choices)this.hexome_choices={}
J(!this.hexome_choices[e])
this.hexome_choices[e]=t}
TransactionSet.prototype.sendDetailData=function(e,t){if(!this.detail_data)this.detail_data={}
J(!this.detail_data[e])
this.detail_data[e]=t}
TransactionSet.prototype.trans=function(){var e=new Transaction(this)
this.trans_list.push(e)
return e}
TransactionSet.prototype.transPre=function(){var e=new Transaction(this)
J(!this.has_trans_pre)
this.has_trans_pre=true
this.trans_list.splice(0,0,e)
return e}
TransactionSet.prototype.get=function(e){return this.trans_list[e]}
TransactionSet.prototype.numTransactions=function(){return this.trans_list.length}
TransactionSet.prototype.toJSON=function(){var e={t:this.trans_list}
for(var t in N)if(this[t])e[N[t]]=this[t]
for(var r=0;r<this.trans_list.length;++r)if(this.trans_list[r].silent_error){e.s=e.s||{}
e.s[r]=1}return e}
TransactionSet.prototype.hasPristineSends=function(){return this.pristine_sends||this.hexome_choices||this.detail_data}
TransactionSet.prototype.mergePristineSends=function(e){for(var t in N)if(e[t]){if(!this[t])this[t]=e[t]
else for(var r in e[t]){J(!this[t][r])
this[t][r]=e[t][r]}e[t]=null}}
Transaction.prototype.fromJSON=function(e){this.ops=e}
TransactionSet.prototype.fromJSON=function(e){for(var t in N)J(!e[N[t]])
J(e.t&&e.t.length)
for(var r=0;r<e.t.length;++r)this.trans().fromJSON(e.t[r])}
function createTransSet(e){return new TransactionSet(e)}},{"../glov/common/util":400,"./globals":248,"./items_common":251,"./voxel_data_common":264,assert:void 0}],269:[function(e,t,r){"use strict"
r.AuthService=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i=e("assert")
var o=e("../../glov/client/fetch.js").fetch
var a=e("../../glov/common/execute_with_retry").executeWithRetry
var n=e("../../glov/common/external_users_common")
var s=n.ERR_EMAIL_ALREADY_USED
var l=n.ERR_INVALID_DATA
var _=n.ERR_SERVER
var c=n.ERR_UNAUTHORIZED
var u=n.ERR_UNCONFIRMED_EMAIL
var d=3e4
var f=4
var v=500
var h=1e4
var p;(function(e){e["frvr"]="frvr"
e["fbInstant"]="facebook-instant"
e["fbWeb"]="facebook-web"
e["google"]="google-internal"
e["apple"]="apple"
e["discord"]="discord"})(p=p||{})
var m=function(){function AuthService(e){this.base_url=void 0
this.cached_keys={}
this.base_url=e}var e=AuthService.prototype
e.signUpWithFRVR=function signUpWithFRVR(e,a){return o({method:"POST",url:this.base_url+"/register",body:{platform:p.frvr,credentials:e},timeout:d},function(e,t){var r=Number(e)
if(r<400)return a(null,t)
if(409===r)return a(s)
if(r<500)return a(l)
if(r>=500)return a(_)
return a(e,t)})}
e.signIn=function signIn(e,t,i){var r=this
return a(function makeRequest(a){o({method:"POST",url:r.base_url+"/login",body:{platform:e,credentials:t},response_type:"json",timeout:d},function(e,t){var r=Number(e)
if(r>=500)return a(e,{response_body:t,status_code:r})
return a(null,{response_body:t,status_code:r})})},{max_retries:f,inc_backoff_duration:v,max_backoff:h},function parseResponse(e,t){var r=null==t?void 0:t.response_body
var a=(null==t?void 0:t.status_code)||NaN
if(a<400)return i(null,r)
if(401===a)return i(c)
if(403===a)return i(u)
if(a<500)return i(l)
if(a>=500)return i(_)
return i(e||null,r)})}
e.signInWithFRVR=function signInWithFRVR(e,t){return this.signIn(p.frvr,e,t)}
e.signInWithGoogle=function signInWithGoogle(e,t){return this.signIn(p.google,e,t)}
e.signInWithFacebookWeb=function signInWithFacebookWeb(e,t){return this.signIn(p.fbWeb,_extends({},e,{appId:"worlds"}),t)}
e.signInWithFacebookInstant=function signInWithFacebookInstant(e,t){return this.signIn(p.fbInstant,_extends({},e,{appId:"worlds"}),t)}
e.signInWithApple=function signInWithApple(e,t){return this.signIn(p.apple,_extends({},e,{appId:"worlds"}),t)}
e.signInWithDiscord=function signInWithDiscord(e,t){if(!e)return t(c)
var r
try{r=JSON.parse(e)}catch(e){console.error("Error parsing pairs",e)
return t(l)}t(null,r)}
e.sendActivationEmail=function sendActivationEmail(e,a){i(e)
return o({method:"POST",url:this.base_url+"/verify-challenge",body:{platform:"frvr",credentials:{email:e}},timeout:d},function(e,t){var r=Number(e)
if(r<400)return a(null,t)
if(r<500)return a(l)
if(r>=500)return a(_)
return a(e,t)})}
e.sendRecoverEmail=function sendRecoverEmail(e,a){i(e)
return o({method:"POST",url:this.base_url+"/recover-challenge",body:{platform:"frvr",credentials:{email:e}}},function(e,t){var r=Number(e)
if(r<400)return a(null,t)
if(r<500)return a(l)
if(r>=500)return a(_)
return a(e,t)})}
e.refreshAccessToken=function refreshAccessToken(e,t){i(e)
return o({method:"POST",url:this.base_url+"/refresh",body:{refreshToken:e},response_type:"json",timeout:d},t)}
e.checkEmailVerified=function checkEmailVerified(e,t){i(e)
return o({url:this.base_url+"/user/verified",headers:{"X-REFRESH-TOKEN":e},response_type:"json",timeout:d},t)}
return AuthService}()
r.AuthService=m},{"../../glov/client/fetch.js":313,"../../glov/common/execute_with_retry":386,"../../glov/common/external_users_common":387,assert:void 0}],270:[function(e,t,r){"use strict"
r.clearPlatformAdapter=clearPlatformAdapter
r.getPlatformAdapter=getPlatformAdapter
r.initPlatformAdapter=initPlatformAdapter
var a=e("./huawei-quickapp/huawei-quickapp").huaweiInit
var i=e("./yandex/yandex").yandexInit
var o=e("./android/android").androidInit
var n=e("./ios/ios").iosInit
var s
var l={getName:function getName(){return"empty"},createAppShortcut:function createAppShortcut(){return null}}
function clearPlatformAdapter(){s=null}function getPlatformAdapter(){return s}function initPlatformAdapter(){return s=s||i()||a()||o()||n()||l}},{"./android/android":271,"./huawei-quickapp/huawei-quickapp":273,"./ios/ios":275,"./yandex/yandex":276}],271:[function(e,t,r){"use strict"
r.androidInit=androidInit
var a=e("../../../../client/platform_worlds_client").PLATFORM_ANDROID
var i=e("../../xplay/idfa/idfa").getIDFA
function androidInit(){if(!a)return null
i(function(e,t){if(t)window.FRVR.tracker.logEvent("idfa",{idfa:t})})
return{getName:function getName(){return"android"},createAppShortcut:function createAppShortcut(){return null}}}},{"../../../../client/platform_worlds_client":160,"../../xplay/idfa/idfa":282}],272:[function(e,t,r){"use strict"
r.huaweiInitEvents=huaweiInitEvents
r.huaweiCall=huaweiCall
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var i
function buildCallbackRegistry(){var t=0
var r={}
return{register:function register(e){r[++t]=e
return t},clear:function clear(e){if(r[e])delete r[e]},get:function get(e){return r[e]}}}function installMessageHandler(r){var a=window.system.onmessage
window.system.onmessage=function(e){var t
try{t=e&&"{"===e[0]&&JSON.parse(e)}catch(e){console.error(e)}if("object"===typeof t&&t.event)r(t)
if(a)a(e)}}function handleIncomingEvent(e){var t=e.id
var r=t&&i.get(t)
if(r){i.clear(t)
switch(e.event){case"iap-response":case"shortcut-response":r(null,e.data)
break
case"iap-error":case"shortcut-error":r(e.err)}}}function huaweiInitEvents(){if(!i){i=buildCallbackRegistry()
installMessageHandler(handleIncomingEvent)}return true}function huaweiCall(e,t,r){var a=_extends({},t,{event:e,id:i.register(r)})
window.system.postMessage(JSON.stringify(a))}},{}],273:[function(e,t,r){"use strict"
r.huaweiInit=huaweiInit
var a=e("./is-huawei"),i=a.isHuaweiEnabled,o=a.isHuaweiValid
var n=e("./huawei-events"),s=n.huaweiCall,l=n.huaweiInitEvents
var _=e("../../../../glov/client/fscreen.js").fscreenDisable
function createAppShortcut(r){s("shortcut-is-installed",{},function(e,t){if(e||t){if(r)r(e,t)
return}s("shortcut-install",{},r)})}function huaweiInit(){if(!i()||!o())return null
l()
_()
return{getName:function getName(){return"huawei-quickapp"},createAppShortcut:createAppShortcut}}},{"../../../../glov/client/fscreen.js":317,"./huawei-events":272,"./is-huawei":274}],274:[function(e,t,r){"use strict"
r.isHuaweiValid=isHuaweiValid
r.clearIsHuaweiCache=r.isHuaweiEnabled=void 0
function getQueryStringValue(e){var t=window.location.href
var r=e.replace(/[[\]]/g,"\\$&")
var a=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)","i").exec(t)
if(!a)return null
if(!a[2])return""
return decodeURIComponent(a[2].replace(/\+/g," "))}function hasHuaweiURLFlag(){return""===getQueryStringValue("huaweiquickapp")}function cached(e){var t=false
var r
return[function(){if(!t){r=e.apply(void 0,arguments)
t=true}return r},function(){t=false}]}var a=cached(hasHuaweiURLFlag),i=a[0],o=a[1]
r.clearIsHuaweiCache=o
r.isHuaweiEnabled=i
function isHuaweiValid(){return window.system&&window.system.postMessage}},{}],275:[function(e,t,r){"use strict"
r.iosInit=iosInit
var a=e("../../../../client/platform_worlds_client").PLATFORM_IOS
var i=e("../../xplay/idfa/idfa").getIDFA
function iosInit(){if(!a)return null
i(function(e,t){if(t)window.FRVR.tracker.logEvent("idfa",{idfa:t})})
return{getName:function getName(){return"ios"},createAppShortcut:function createAppShortcut(){return null}}}},{"../../../../client/platform_worlds_client":160,"../../xplay/idfa/idfa":282}],276:[function(e,t,r){"use strict"
r.yandexInit=yandexInit
function yandexInit(){if(!window.YaGames)return null
return{getName:function getName(){return"yandex"},createAppShortcut:function createAppShortcut(){return null}}}},{}],277:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.graphAPI=graphAPI
r.getAuthToken=getAuthToken
r.login=login
r.logout=logout
r.shareLink=shareLink
r.getFbAccountUserIdForAppId=getFbAccountUserIdForAppId
var a=e("./mobile.js")
var i=e("./web.js")
var n=e("../../../../client/platform_worlds_client.js").PLATFORM_MOBILE?a:i
function isAvailable(){return n.isAvailable()}function graphAPI(e,t,r,a){n.graphAPI(e,t,r,function(e,t){if(e)a(e)
else if(null!=t&&t.error){var r
a(null!=(r=t.error.message)?r:"Unknown error")}else a(null,t)})}function getAuthToken(e){n.getAuthToken(e)}function login(e,t){n.login(e,t)}function logout(){n.logout()}function shareLink(e,t,r,a,i,o){n.shareLink(e,t,r,a,i,o)}function getFbAccountUserIdForAppId(e,t){n.getFbAccountUserIdForAppId(e,t)}},{"../../../../client/platform_worlds_client.js":160,"./mobile.js":278,"./web.js":279}],278:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.graphAPI=graphAPI
r.getAuthToken=getAuthToken
r.login=login
r.logout=logout
r.shareLink=shareLink
var s=e("../host/host.js")
function isAvailable(){return true}function graphAPI(e,t,r,a){s.call("facebook.graphapi",{endpoint:e,method:t,params:r},function(e){if(!a)return
if(e.result)a(null,e.result)
else a("Facebook Graph API failed - "+e.error)})}function getAuthToken(t){s.call("facebook.getauthtoken",{},function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.token)t("Facebook relogin failed - token not defined")
else t(null,e)})}function login(e,t){var r={}
for(var a=0;a<=e.length;++a)r["permission"+a]=e[a]
s.call("facebook.login",r,function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.token)t("Facebook login failed - token not defined")
else t(null,e)})}function logout(){s.call("facebook.logout",{})}function shareLink(e,t,r,a,i,o){var n={url:e,title:t,imageurl:r,description:a,inmessenger:i}
s.call("facebook.sharelink",n,function(e){o(e.result)})}},{"../host/host.js":280}],279:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.graphAPI=graphAPI
r.getAuthToken=getAuthToken
r.login=login
r.logout=logout
var i="Facebook not initialized"
var a="Facebook login failed"
var o
var n=[]
var s
var l
function invokeInitCallbacks(){var e=n
n=[]
for(var t=0;t<e.length;++t)e[t]()}function onInit(e){if(l||!window.FB||!window.fbAsyncInit){e()
return}if(window.fbAsyncInit.hasRun){l=true
invokeInitCallbacks()
e()
return}n.push(e)
if(!o){o=true
var t=window.fbAsyncInit
window.fbAsyncInit=function(){t()
l=true
invokeInitCallbacks()}}if(!s){s=true
setTimeout(function(){s=false
invokeInitCallbacks()},5e3)}}function isAvailable(){return window.FB&&void 0!==window.Set}function graphAPI(e,t,r,a){onInit(function(){if(!l){if(a)a(i)
return}window.FB.api(e,t,r,function(e){if(a)a(null,e)})})}function getAuthToken(r){onInit(function(){if(!l){if(r)r(i)
return}window.FB.getLoginStatus(function(e){var t
try{if("connected"===e.status)t={signedRequest:e.authResponse.signedRequest,token:e.authResponse.accessToken,expiration:e.authResponse.expiresIn,userID:e.authResponse.userID}}catch(e){}if(t)r(null,t)
else r(a)})})}function login(e,r){onInit(function(){if(!l){if(r)r(i)
return}window.FB.login(function(e){var t
try{if("connected"===e.status)t={signedRequest:e.authResponse.signedRequest,token:e.authResponse.accessToken,expiration:e.authResponse.expiresIn,userID:e.authResponse.userID}}catch(e){}if(t){if(r)r(null,t)}else if(r)r(a)},{scope:e})})}function logout(){onInit(function(){if(!l)return
window.FB.logout()})}},{}],280:[function(e,t,r){"use strict"
r.call=call
var n=e("../../../../client/frvr_sdk_worlds").frvrOnInitialized
function call(a,i,o){n(function(){var e,t
var r=null==(e=window.FRVR)?void 0:null==(t=e.channel)?void 0:t.getBootstrapper().nativeBridge
if(r)r.callAsync(a,i).then(o,o)
else console.error("Native bridge not found!",a)})}},{"../../../../client/frvr_sdk_worlds":102}],281:[function(e,t,r){"use strict"
r.getIDFA=getIDFA
var a=e("../host/host")
function getIDFA(t){a.call("googlemobileadsinterstitial.getidfa",{},function(e){if(t)t(""===e.result?null:e.result)})}},{"../host/host":280}],282:[function(e,t,r){"use strict"
r.getIDFA=getIDFA
var a=e("../../../../client/platform_worlds_client.js"),i=a.PLATFORM_ANDROID,o=a.PLATFORM_IOS
var n=o?e("./ios.js"):null
var s=i?e("./android.js"):null
function sendToHostUndefined(e){console.error("Host not defined")}var l=o?n.getIDFA:i?s.getIDFA:sendToHostUndefined
function getIDFA(t){l(function(e){if(t)t(e?e.error:null,e)})}},{"../../../../client/platform_worlds_client.js":160,"./android.js":281,"./ios.js":283}],283:[function(e,t,r){"use strict"
r.getIDFA=getIDFA
var a=e("../host/host")
function getIDFA(t){a.call("ios.getidfa",{},function(e){if(t)t(""===e.result?null:e.result)})}},{"../host/host":280}],284:[function(e,t,r){"use strict"
r.xplayGetCurrentLoginProvider=xplayGetCurrentLoginProvider
r.xplaySetup=xplaySetup
r.xplayIsLoggedIn=xplayIsLoggedIn
r.xplayReLoginAutomatic=xplayReLoginAutomatic
r.xplayLogin=xplayLogin
r.xplayLogout=xplayLogout
r.xplayIsAvailable=xplayIsAvailable
r.XplayLoginProvider=void 0
var a=e("../../../glov/client/local_storage.js")
var i=e("./facebook/facebook.js")
var o=e("../../../client/platform_worlds_client.js").PLATFORM_IOS?e("./signin_with_apple/ios.js"):null
var n=e("./yandex/yandex.js")
var s="Login provider not defined"
var l=Object.freeze({Facebook:"Facebook",SignInWithApple:"SignInWithApple",Yandex:"Yandex"})
r.XplayLoginProvider=l
var _=false
function setCurrentLoginProvider(e){a.set("xplay.loginProviderKey",e)}function xplayGetCurrentLoginProvider(){return a.get("xplay.loginProviderKey")}function promptLoginFB(e){i.login(["gaming_profile","email","user_friends"],e)}function promptLoginApple(e){o.promptLogin(e)}function promptLoginYandex(e){n.login(e)}function xplaySetup(){_=true}function xplayIsLoggedIn(){return Boolean(xplayGetCurrentLoginProvider())}function relogin(r,a){switch(r){case l.Facebook:return void i.getAuthToken(function(e,t){if(e){setCurrentLoginProvider(void 0)
return void a(e)}return void a(null,{provider:r,result:t})})
case l.SignInWithApple:return void o.isLogged(function(e,t){if(e){setCurrentLoginProvider(void 0)
return void a(e)}return void a(null,{provider:r,result:t})})
case l.Yandex:return void n.login(function(e,t){if(e)return void a(e)
return void a(null,{provider:r,result:t})})
default:return void a(s)}}function xplayReLoginAutomatic(e){return relogin(xplayGetCurrentLoginProvider(),e)}function xplayLogin(r,a){if(!_)return void a("Not initialized")
var e
switch(r){case l.Facebook:e=promptLoginFB
break
case l.SignInWithApple:e=promptLoginApple
break
case l.Yandex:e=promptLoginYandex
break
default:return void a(s)}e(function(e,t){if(!a)return
if(e){setCurrentLoginProvider()
return void a(e)}setCurrentLoginProvider(r)
return void a(null,t)})}function xplayLogout(e){e=e||function(){}
if(!_)return void e("Not initialized")
if(!xplayIsLoggedIn())return void e("User is already logged out")
var t
switch(xplayGetCurrentLoginProvider()){case l.Facebook:t=i.logout
break
case l.SignInWithApple:t=o.logout
break
default:return void e(s)}setCurrentLoginProvider(void 0)
return void t(e)}function xplayIsAvailable(e){switch(e){case l.Facebook:return null==i?void 0:i.isAvailable()
case l.SignInWithApple:return null==o?void 0:o.isAvailable()
default:return false}}},{"../../../client/platform_worlds_client.js":160,"../../../glov/client/local_storage.js":329,"./facebook/facebook.js":277,"./signin_with_apple/ios.js":285,"./yandex/yandex.js":286}],285:[function(e,t,r){"use strict"
r.isAvailable=isAvailable
r.isLogged=isLogged
r.promptLogin=promptLogin
r.logout=logout
var a=e("../../../../client/platform_worlds_client.js").PLATFORM_IOS
var i=e("../host/host.js")
var o=false
if(a)i.call("applesignin.isAvailable",{},function(e){o=!e.error&&e.result})
function isAvailable(){return o}function isLogged(t){i.call("applesignin.isLogged",{},function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.loginCredentials)t("Login credentials not defined")
else if(t)t(e.error,e.loginCredentials)})}function promptLogin(t){i.call("applesignin.login",{},function(e){if(!t)return
if(Object.prototype.hasOwnProperty.call(e,"error"))t(e.error)
else if(!e.loginCredentials)t("Login credentials not defined")
else if(t)t(e.error,e.loginCredentials)})}function logout(t){i.call("applesignin.logout",{},function(e){if(t)t(e.error,e)})}},{"../../../../client/platform_worlds_client.js":160,"../host/host.js":280}],286:[function(e,t,r){"use strict"
r.login=login
var a=e("../../../../glov/common/util").unpromisify
function initYandexPlayer(t){return window.ysdk.getPlayer({signed:true,scopes:true}).then(function(e){t(null,e.signature)})}function initYandex(){if(!window.YaGames){console.error("[yandex] sdk not available")
return new Promise(function(e){return e(false)})}if(window.ysdk){console.error("[yandex] sdk already initialized")
return new Promise(function(e){return e(true)})}return window.YaGames.init().then(function(e){if(!e){console.error("[yandex] ysdk is not available")
return false}window.ysdk=e
return true})}function login(t){t=a(t)
return initYandex().then(function(e){if(!e)return void t("[yandex] sdk not initialized")
initYandexPlayer(t).catch(function(e){console.warn("User not authorized in yandex",e)
window.ysdk.auth.openAuthDialog().then(function(){initYandexPlayer(t).catch(function(e){console.warn("User not authorized in yandex "+e)
t("Authentication failed")})}).catch(function(e){console.warn("User not authorized in yandex again "+e)
t("Authentication failed")})})})}},{"../../../../glov/common/util":400}],287:[function(e,t,r){"use strict"
r.create=create
var m=e("assert")
var O=-1
function AABBTreeNode(e,t,r){this.escapeNodeOffset=t
this.externalNode=r
this.extents=e
return this}AABBTreeNode.prototype.isLeaf=function(){return Boolean(this.externalNode)}
AABBTreeNode.prototype.reset=function(e,t,r,a,i,o,n,s){this.escapeNodeOffset=n
this.externalNode=s
var l=this.extents
l[0]=e
l[1]=t
l[2]=r
l[3]=a
l[4]=i
l[5]=o}
AABBTreeNode.prototype.clear=function(){this.escapeNodeOffset=1
this.externalNode=void 0
var e=this.extents
var t=Number.MAX_VALUE
e[0]=t
e[1]=t
e[2]=t
e[3]=-t
e[4]=-t
e[5]=-t}
AABBTreeNode.create=function(e,t,r){return new AABBTreeNode(e,t,r)}
var E=32
var a=0
function AABBTree(e){this.nodes=[]
this.endNode=0
this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.numUpdates=0
this.numExternalNodes=0
this.startUpdate=2147483647
this.endUpdate=-2147483647
this.highQuality=Boolean(e.highQuality)
this.name=e.name
this.log_rebuilds=e.log_rebuilds
this.nodesStack=new Array(32)
this.spat_id="_spat"+ ++a}var i=128
var o=[]
AABBTree.allocateNode=function(){if(!o.length)for(var e=0;e<i;e++){var t=new Float32Array(6)
o[e]=AABBTreeNode.create(t,1,void 0)}return o.pop()}
AABBTree.releaseNode=function(e){if(o.length<i){e.clear()
o.push(e)}}
AABBTree.recycleNodes=function(e,t){var r=e.length
var a
for(a=t;a<r;a++){var i=e[a]
if(i)this.releaseNode(i)}e.length=t}
AABBTree.prototype.add=function(e,t){var r=this.endNode
e[this.spat_id]=r
var a=AABBTree.allocateNode()
a.escapeNodeOffset=1
a.externalNode=e
var i=a.extents
i[0]=t[0]
i[1]=t[1]
i[2]=t[2]
i[3]=t[3]
i[4]=t[4]
i[5]=t[5]
this.nodes[r]=a
this.endNode=r+1
this.numAdds++
this.numExternalNodes++
if(this.numAdds>.2*this.numExternalNodes||this.numAdds>100)this.needsRebuild=true}
AABBTree.prototype.remove=function(e){var t=e[this.spat_id]
if(void 0!==t){if(this.numExternalNodes>1){var r=this.nodes
m(r[t].externalNode===e)
r[t].externalNode=O
this.numExternalNodes--}else this.clear()
e[this.spat_id]=void 0}}
AABBTree.prototype.findParent=function(e){var t=this.nodes
var r=e
var a=0
var i
do{a++
i=t[--r]}while(i&&i.escapeNodeOffset<=a)
return i}
AABBTree.prototype.update=function(e,t){var r=e[this.spat_id]
if(void 0!==r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=t[4]
var l=t[5]
var _=this.needsRebuild
var c=this.needsRebound
var u=this.nodes
var d=u[r]
m(d.externalNode===e)
var f=d.extents
var v=_||c||f[0]>a||f[1]>i||f[2]>o||f[3]<n||f[4]<s||f[5]<l
f[0]=a
f[1]=i
f[2]=o
f[3]=n
f[4]=s
f[5]=l
if(v)if(!_&&u.length>1){this.numUpdates++
if(this.startUpdate>r)this.startUpdate=r
if(this.endUpdate<r)this.endUpdate=r
if(!c)if(2*this.numUpdates>this.numExternalNodes)this.needsRebound=true
else{var h=this.findParent(r)
if(h){var p=h.extents
if(p[0]>a||p[1]>i||p[2]>o||p[3]<n||p[4]<s||p[5]<l)this.needsRebound=true}}else if(this.numUpdates>3*this.numExternalNodes){this.needsRebuild=true
this.numAdds=this.numUpdates}}}else this.add(e,t)}
AABBTree.prototype.needsFinalize=function(){return this.needsRebuild||this.needsRebound}
AABBTree.prototype.finalize=function(){if(this.needsRebuild){this.rebuild()
return true}else if(this.needsRebound){this.rebound()
return true}return false}
AABBTree.prototype.rebound=function(){var e=this.nodes
if(e.length>1){var t=this.startUpdate
var r=this.endUpdate
var a=this.nodesStack
var i=0
var o=0
for(;;){var n=e[o]
var s=o
var l=o+n.escapeNodeOffset
var _=o+1
var c=void 0
do{var u=_+(c=e[_]).escapeNodeOffset
if(_<r){if(!c.externalNode)if(u>t){a[i]=o
i++
o=_}}else break
_=u}while(_<l)
if(o===s){var d=(c=e[_=o+1]).extents
var f=d[0]
var v=d[1]
var h=d[2]
var p=d[3]
var m=d[4]
var E=d[5]
_+=c.escapeNodeOffset
while(_<l){if(f>(d=(c=e[_]).extents)[0])f=d[0]
if(v>d[1])v=d[1]
if(h>d[2])h=d[2]
if(p<d[3])p=d[3]
if(m<d[4])m=d[4]
if(E<d[5])E=d[5]
_+=c.escapeNodeOffset}(d=n.extents)[0]=f
d[1]=v
d[2]=h
d[3]=p
d[4]=m
d[5]=E
r=o
if(i>0)o=a[--i]
else break}}}this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.startUpdate=2147483647
this.endUpdate=-2147483647}
AABBTree.prototype.rebuild=function(){if(this.numExternalNodes>0){var e=Date.now()
var t=this.nodes
var r
var a
if(this.numExternalNodes===t.length){a=(r=t).length
this.nodes=t=[]}else{(r=[]).length=this.numExternalNodes
var i=this.endNode
for(var o=a=0;o<i;o++){var n=t[o]
if(n.externalNode)if(n.externalNode!==O){t[o]=void 0
r[a]=n
a++}}if(r.length>a)r.length=a}var s
if(a>1){if(a>E&&this.numAdds>0)if(this.highQuality)this._sortNodesHighQuality(r)
else this._sortNodes(r)
var l=this._predictNumNodes(0,a,0)
if(t.length>l)AABBTree.recycleNodes(t,l)
this._recursiveBuild(r,0,a,0)
var _=t[0].escapeNodeOffset
if(t.length>_)AABBTree.recycleNodes(t,_)
this.endNode=_}else{(s=r[0]).externalNode[this.spat_id]=0
t.length=1
t[0]=s
this.endNode=1}r=null
var c=Date.now()-e
if(this.log_rebuilds&&c>1)console.log("AABBTree.rebuild("+this.name+") in "+c+"ms")}this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.numUpdates=0
this.startUpdate=2147483647
this.endUpdate=-2147483647}
function medianFn(e,t,r){if(e<t)if(t<r)return t
else if(e<r)return r
else return e
else if(e<r)return e
else if(t<r)return r
return t}function nthElement(e,t,r,a,i){while(a-t>8){var o=medianFn(i(e[t]),i(e[t+(a-t>>1)]),i(e[a-1]))
var n=t
var s=a
var l=void 0
for(;;n++){while(i(e[n])<o)n++
do{s--}while(o<i(e[s]))
if(n>=s){l=n
break}else{var _=e[n]
e[n]=e[s]
e[s]=_}}if(l<=r)t=l
else a=l}var c=t+1
while(c!==a){var u=e[c]
var d=i(u)
var f=c
var v=c-1
while(f!==t&&d<i(e[v])){e[f]=e[v]
f--
v--}if(f!==c)e[f]=u
c++}}function getkeyXfn(e){var t=e.extents
return t[0]+t[3]}function getkeyYfn(e){var t=e.extents
return t[1]+t[4]}function getkeyZfn(e){var t=e.extents
return t[2]+t[5]}function getreversekeyXfn(e){var t=e.extents
return-(t[0]+t[3])}function getreversekeyYfn(e){var t=e.extents
return-(t[1]+t[4])}function getreversekeyZfn(e){var t=e.extents
return-(t[2]+t[5])}AABBTree.prototype._sortNodes=function(i){var e=i.length
var o=false
function sortNodesRecursive(e,t,r){var a=e+t>>1
if(0===r)if(o)nthElement(i,e,a,t,getreversekeyXfn)
else nthElement(i,e,a,t,getkeyXfn)
else if(2===r)if(o)nthElement(i,e,a,t,getreversekeyZfn)
else nthElement(i,e,a,t,getkeyZfn)
else if(o)nthElement(i,e,a,t,getreversekeyYfn)
else nthElement(i,e,a,t,getkeyYfn)
if(0===r)r=2
else if(2===r)r=1
else r=0
o=!o
if(e+E<a)sortNodesRecursive(e,a,r)
if(a+E<t)sortNodesRecursive(a,t,r)}sortNodesRecursive(0,e,0)}
AABBTree.prototype._sortNodesNoY=function(i){var e=i.length
var o=false
function sortNodesNoYRecursive(e,t,r){var a=e+t>>1
if(0===r)if(o)nthElement(i,e,a,t,getreversekeyXfn)
else nthElement(i,e,a,t,getkeyXfn)
else if(o)nthElement(i,e,a,t,getreversekeyZfn)
else nthElement(i,e,a,t,getkeyZfn)
if(0===r)r=2
else r=0
o=!o
if(e+E<a)sortNodesNoYRecursive(e,a,r)
if(a+E<t)sortNodesNoYRecursive(a,t,r)}sortNodesNoYRecursive(0,e,0)}
function getkeyXZfn(e){var t=e.extents
return t[0]+t[2]+t[3]+t[5]}function getkeyZXfn(e){var t=e.extents
return t[0]-t[2]+t[3]-t[5]}function getreversekeyXZfn(e){var t=e.extents
return-(t[0]+t[2]+t[3]+t[5])}function getreversekeyZXfn(e){var t=e.extents
return-(t[0]-t[2]+t[3]-t[5])}function calculateSAH(e,t,r){var a=e[t]
var i=a.extents
var o=i[0]
var n=i[1]
var s=i[2]
var l=i[3]
var _=i[4]
var c=i[5]
for(var u=t+1;u<r;u++){if(o>(i=(a=e[u]).extents)[0])o=i[0]
if(n>i[1])n=i[1]
if(s>i[2])s=i[2]
if(l<i[3])l=i[3]
if(_<i[4])_=i[4]
if(c<i[5])c=i[5]}return l-o+(_-n)+(c-s)}AABBTree.prototype._sortNodesHighQuality=function(l){var e=l.length
var _=false
function sortNodesHighQualityRecursive(e,t){var r=e+t>>1
nthElement(l,e,r,t,getkeyXfn)
var a=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyYfn)
var i=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyZfn)
var o=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyXZfn)
var n=calculateSAH(l,e,r)+calculateSAH(l,r,t)
nthElement(l,e,r,t,getkeyZXfn)
var s=calculateSAH(l,e,r)+calculateSAH(l,r,t)
if(a<=i&&a<=o&&a<=n&&a<=s)if(_)nthElement(l,e,r,t,getreversekeyXfn)
else nthElement(l,e,r,t,getkeyXfn)
else if(o<=i&&o<=n&&o<=s)if(_)nthElement(l,e,r,t,getreversekeyZfn)
else nthElement(l,e,r,t,getkeyZfn)
else if(i<=n&&i<=s)if(_)nthElement(l,e,r,t,getreversekeyYfn)
else nthElement(l,e,r,t,getkeyYfn)
else if(n<=s)if(_)nthElement(l,e,r,t,getreversekeyXZfn)
else nthElement(l,e,r,t,getkeyXZfn)
else if(_)nthElement(l,e,r,t,getreversekeyZXfn)
else nthElement(l,e,r,t,getkeyZXfn)
_=!_
if(e+E<r)sortNodesHighQualityRecursive(e,r)
if(r+E<t)sortNodesHighQualityRecursive(r,t)}sortNodesHighQualityRecursive(0,e)}
AABBTree.prototype._recursiveBuild=function(e,t,r,a){var i=this.nodes
var o=a
a++
var n
var s
var l
var _
var c
var u
var d
var f
var v
if(t+E>=r){n=(d=(f=e[t]).extents)[0]
s=d[1]
l=d[2]
_=d[3]
c=d[4]
u=d[5]
f.externalNode[this.spat_id]=a
this._replaceNode(i,a,f)
for(var h=t+1;h<r;h++){if(n>(d=(f=e[h]).extents)[0])n=d[0]
if(s>d[1])s=d[1]
if(l>d[2])l=d[2]
if(_<d[3])_=d[3]
if(c<d[4])c=d[4]
if(u<d[5])u=d[5]
a++
f.externalNode[this.spat_id]=a
this._replaceNode(i,a,f)}v=i[a]}else{var p=t+r>>1
if(t+1>=p){(f=e[t]).externalNode[this.spat_id]=a
this._replaceNode(i,a,f)}else this._recursiveBuild(e,t,p,a)
n=(d=(v=i[a]).extents)[0]
s=d[1]
l=d[2]
_=d[3]
c=d[4]
u=d[5]
a+=v.escapeNodeOffset
if(p+1>=r){(f=e[p]).externalNode[this.spat_id]=a
this._replaceNode(i,a,f)}else this._recursiveBuild(e,p,r,a)
if(n>(d=(v=i[a]).extents)[0])n=d[0]
if(s>d[1])s=d[1]
if(l>d[2])l=d[2]
if(_<d[3])_=d[3]
if(c<d[4])c=d[4]
if(u<d[5])u=d[5]}var m=i[o]
if(void 0===m)i[o]=m=AABBTree.allocateNode()
m.reset(n,s,l,_,c,u,a+v.escapeNodeOffset-o)}
AABBTree.prototype._replaceNode=function(e,t,r){var a=e[t]
e[t]=r
if(void 0!==a)AABBTree.releaseNode(a)}
AABBTree.prototype._predictNumNodes=function(e,t,r){r++
if(e+E>=t)r+=t-e
else{var a=e+t>>1
if(e+1>=a)r++
else r=this._predictNumNodes(e,a,r)
if(a+1>=t)r++
else r=this._predictNumNodes(a,t,r)}return r}
AABBTree.prototype.getVisibleNodes=function(e,t,r){var a=0
if(this.numExternalNodes>0){var i=0
var o=Date.now()
var n=this.nodes
var s=this.endNode
var l=e.length
var _=void 0===r?t.length:r
var c,u,d
var f,v,h,p,m,E
var g,T,y,S,I,A
var w=0
for(;;){f=(u=(c=n[w]).extents)[0]
v=u[1]
h=u[2]
p=u[3]
m=u[4]
E=u[5]
g=true
T=0
do{if((S=(y=e[T])[0])*(S<0?f:p)+(I=y[1])*(I<0?v:m)+(A=y[2])*(A<0?h:E)<y[3]){g=false
break}T++}while(T<l)
if(g)if(c.externalNode){if(c.externalNode===O)++i
else{t[_]=c.externalNode
_++
a++}if(++w>=s)break}else{T=0
do{if((S=(y=e[T])[0])*(S>0?f:p)+(I=y[1])*(I>0?v:m)+(A=y[2])*(A>0?h:E)<y[3]){g=false
break}T++}while(T<l)
if(g){d=w+c.escapeNodeOffset
w++
do{if((c=n[w]).externalNode)if(c.externalNode===O)++i
else{t[_]=c.externalNode
_++
a++}w++}while(w<d)
if(w>=s)break}else w++}else if((w+=c.escapeNodeOffset)>=s)break}var L=Date.now()-o
if(i>30&&i>5*a&&L>1)this.needsRebuild=true}return a}
AABBTree.prototype.getOverlappingNodes=function(e,t,r){if(this.numExternalNodes>0){var a=e[0]
var i=e[1]
var o=e[2]
var n=e[3]
var s=e[4]
var l=e[5]
var _=this.nodes
var c=this.endNode
var u,d,f
var v=0
var h=void 0===r?t.length:r
var p=0
for(;;){var m=(d=(u=_[p]).extents)[0]
var E=d[1]
var g=d[2]
var T=d[3]
var y=d[4]
var S=d[5]
if(a<=T&&i<=y&&o<=S&&n>=m&&s>=E&&l>=g)if(u.externalNode){if(u.externalNode!==O){t[h]=u.externalNode
h++
v++}if(++p>=c)break}else if(n>=T&&s>=y&&l>=S&&a<=m&&i<=E&&o<=g){f=p+u.escapeNodeOffset
p++
do{if((u=_[p]).externalNode&&u.externalNode!==O){t[h]=u.externalNode
h++
v++}p++}while(p<f)
if(p>=c)break}else p++
else if((p+=u.escapeNodeOffset)>=c)break}return v}else return 0}
AABBTree.prototype.getExtents=function(){return this.nodes.length>0?this.nodes[0].extents:null}
AABBTree.prototype.getRootNode=function(){return this.nodes[0]}
AABBTree.prototype.getNodes=function(){return this.nodes}
AABBTree.prototype.getEndNodeIndex=function(){return this.endNode}
AABBTree.prototype.getNumLeaves=function(){return this.numExternalNodes}
AABBTree.prototype.clear=function(){if(this.nodes.length)AABBTree.recycleNodes(this.nodes,0)
this.endNode=0
this.needsRebuild=false
this.needsRebound=false
this.numAdds=0
this.numUpdates=0
this.numExternalNodes=0
this.startUpdate=2147483647
this.endUpdate=-2147483647}
AABBTree.rayTest=function(e,l,_){var t=l.origin
var r=l.direction
var h=t[0]
var p=t[1]
var m=t[2]
var E=r[0]
var g=r[1]
var T=r[2]
var y=1/E
var S=1/g
var I=1/T
function distanceExtents(e,t){var r=e[0]
var a=e[1]
var i=e[2]
var o=e[3]
var n=e[4]
var s=e[5]
if(r<=h&&h<=o&&a<=p&&p<=n&&i<=m&&m<=s)return 0
var l,_
var c,u
var d
if(E>=0){l=0===(d=r-h)?0:d*y
_=0===(d=o-h)?0:d*y}else{l=(o-h)*y
_=(r-h)*y}if(g>=0){c=0===(d=a-p)?0:d*S
u=0===(d=n-p)?0:d*S}else{c=(n-p)*S
u=(a-p)*S}if(l>u||c>_)return
if(c>l)l=c
if(u<_)_=u
var f,v
if(T>=0){f=0===(d=i-m)?0:d*I
v=0===(d=s-m)?0:d*I}else{f=(s-m)*I
v=(i-m)*I}if(l>v||f>_)return
if(f>l)l=f
if(v<_)_=v
if(l<0)l=_
return l>=0&&l<t?l:void 0}var c=[]
var u=null
function processNode(e,t,r){var a=e.getNodes()[t]
var i=distanceExtents(a.extents,r)
if(void 0===i)return r
if(a.externalNode){if(a.externalNode!==O){var o=_(e,a.externalNode,l,i,r)
if(o)r=(u=o).factor}}else{var n=c.length
var s
for(s=0;s<n;s++)if(i>c[s].distance)break
c.splice(s-1,0,{tree:e,nodeIndex:t,distance:i})}return r}var a=l.maxFactor
var i
var o
for(o=0;o<e.length;o++)if(0!==(i=e[o]).endNode)a=processNode(i,0,a)
while(0!==c.length){var n=c.pop()
if(n.distance>=a)continue
var s=n.nodeIndex
var d=(i=n.tree).getNodes()
var f=s+d[s].escapeNodeOffset
var v=s+1
do{a=processNode(i,v,a)
v+=d[v].escapeNodeOffset}while(v<f)}return u}
function create(e){return new AABBTree(e)}},{assert:void 0}],288:[function(e,t,r){"use strict"
r.abTestGetMetrics=abTestGetMetrics
r.abTestGetMetricsAndPlatform=abTestGetMetricsAndPlatform
r.abTestRegister=abTestRegister
r.abTestGet=abTestGet
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("assert")
var l=e("../common/rand_alea").mashString
var i=e("./client_config").platformGetID
var o=e("./local_storage")
var _=o.localStorageGet
var c=o.localStorageSet
var n=e("./net")
var s=n.netPostInit
var u=n.netSubs
var d=n.netUserId
var f=e("./wsclient").wsclientSetExtraParam
var v=Math.floor
var h="abtests_id"
var p="abtest."
function evaluateSplitGroup(e,t){var r=e.values,a=e.name
var i=""+p+e.name
var o=null
if(e.permanent){var n
var s=_(i)
if(s&&(e.values.includes(s)||null!=(n=e.allowed_values)&&n.includes(s)))o=s}if(!o)o=r[v(l(a+":"+t)/4294967296*r.length)]
e.value=o
null==e.cb||e.cb(e.value)
if("client"===e.scope)c(i,e.value)}var m={}
var E=""
var g=""
function abTestGetMetrics(){return E}function abTestGetMetricsAndPlatform(){return g}function updateMetricsString(){var e=[]
for(var t in m){var r=m[t]
if(r.metrics&&r.value)e.push(""+r.metrics+r.value)}E=e.join(",")
e.push(i())
g=e.join(",")}function updateWSClient(){var e=[]
for(var t in m){var r=m[t]
if("client"===r.scope&&r.metrics)e.push(""+r.metrics+r.value)}f("abt",e.join(","))}var T=null
function evaluatePerUserABTests(){a(T)
for(var e in m){var t=m[e]
if("user"!==t.scope)continue
evaluateSplitGroup(t,T)}updateMetricsString()}function abTestPostNetInit(){u().on("login",function(){T=d()
evaluatePerUserABTests()})
u().on("logout",function(){T=null})}var y
var S=false
function abTestStartup(){if(S)return
S=true
if(!(y=_(h)||"")){y="id"+Math.random()
c(h,y)}s(abTestPostNetInit)}function abTestRegister(e){abTestStartup()
var t=_extends({},e,{value:null})
if("client"===(m[t.name]=t).scope)evaluateSplitGroup(t,y)
if("client"===t.scope&&t.metrics){a(!u())
updateWSClient()
updateMetricsString()}if("user"===t.scope){a(!t.permanent)
a(!u()||!d())}}function abTestGet(e){var t=m[e]
a(t)
a(null!==t.value)
return t.value}},{"../common/rand_alea":395,"./client_config":297,"./local_storage":329,"./net":338,"./wsclient":375,assert:void 0}],289:[function(e,t,r){"use strict"
r.animationSequencerCreate=animationSequencerCreate
var a=function(){function AnimationSequencerImpl(){this.time=0
this.fns=void 0
this.fns=[]}var e=AnimationSequencerImpl.prototype
e.add=function add(e,t,r){var a=e+t
this.fns.push({done:false,fn:r,start:e,end:a,duration:t})
return a}
e.update=function update(e){this.time+=e
var t=false
for(var r=0;r<this.fns.length;++r){var a=this.fns[r]
if(a.start<this.time&&this.time<a.end){t=true
a.fn((this.time-a.start)/a.duration)}else if(this.time>=a.end&&!a.done){a.fn(1)
a.done=true}else if(a.start>=this.time)t=true}return t}
return AnimationSequencerImpl}()
function animationSequencerCreate(){return new a}r.createAnimationSequencer=animationSequencerCreate
r.create=animationSequencerCreate},{}],290:[function(e,t,r){"use strict"
r.autoResetSkippedFrames=autoResetSkippedFrames
r.autoResetEachFrame=autoResetEachFrame
r.autoReset=void 0
var a=autoResetSkippedFrames
r.autoReset=a
var i=e("./engine")
var o=Object.create(null)
function autoResetSkippedFrames(e){var t=o[e]
o[e]=i.frame_index
return!(t>=i.frame_index-1)}function autoResetEachFrame(e){var t=o[e]
o[e]=i.frame_index
return t!==i.frame_index}},{"./engine":305}],291:[function(e,t,r){"use strict"
r.autoAtlasTextureOpts=autoAtlasTextureOpts
r.autoAtlas=autoAtlas
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var a=e("assert")
var i=e("../common/data_error").dataError
var o=e("../common/vmath")
var F=o.v4set
var W=o.vec4
var H=e("./engine").engineStartupFunc
var n=e("./filewatch").filewatchOn
var s=e("./sprites").spriteCreate
var l=e("./textures")
var _=l.textureError
var z=l.textureLoad
var c=e("./webfs")
var V=c.webFSGetFile
var u=c.webFSOnReady
var Y={}
var j=false
function autoAtlasTextureOpts(e,t){a(!j)
Y[e]=t}var d={rects:[[0,0,1,1]],wh:[1],hw:[1],widths:[1],heights:[1],aspect:null,total_w:1,total_h:1}
function spriteMakeError(e){F(e.uvs,0,0,1,1)
e.texs=[_()]
e.uidata=d}var f=function(){var e=AutoAtlasImp.prototype
e.prealloc=function prealloc(){var e=s({texs:this.texs,uvs:W(0,0,1,1)})
e.uidata=d
return e}
e.verifySprites=function verifySprites(e){var t=this.sprites
for(var r in t)if(t[r].autoatlas_used&&!e[r]&&"def"!==r){i('AutoAtlas "'+this.atlas_name+'" does not contain image "'+r+'"')
spriteMakeError(t[r])}}
e.doInit=function doInit(){var i=this
var e=this.sprites,o=this.atlas_name,n=this.texs
var s=V(o+".auat","jsobj")
var t=e.def=this.prealloc()
var r=[]
var a=[]
var l=s.tiles,_=s.w,c=s.h
var u={}
for(var d=0;d<l.length;++d){var f=l[d],v=f[0],h=f[1],p=f[2],m=f[3],E=f[4],g=f[5],T=f[6]
u[v]=true
var y=0
for(var S=0;S<m.length;++S)y+=m[S]
var I=0
for(var A=0;A<E.length;++A)I+=E[A]
a.push(y/I)
var w=e[v]
if(!w)w=e[v]=this.prealloc()
w.texs=n
var L=w.uvs
F(L,h/_,p/c,(h+y)/_,(p+I)/c)
r.push(L)
r[v]=L
var O=[]
for(var R=0;R<m.length;++R)O.push(m[R]/I)
var b=[]
for(var N=0;N<E.length;++N)b.push(E[N]/y)
var C=[]
var x=false
var M=p
var D=[]
for(var P=0;P<E.length;++P){var B=h
for(var k=0;k<m.length;++k){var U=W(B/_,M/c,(B+m[k])/_,(M+E[P])/c)
D.push(U)
var G=m[k]/E[P]
if(1!==G)x=true
C.push(G)
B+=m[k]}M+=E[P]}w.uidata={widths:m,heights:E,wh:O,hw:b,rects:D,aspect:x?C:null,padh:g,padv:T,total_w:y,total_h:I}}t.uidata={rects:r,aspect:a,total_h:c,total_w:_,widths:null,heights:null,wh:null,hw:null}
if(j)this.verifySprites(u)
if(this.did_tex_load)return
this.did_tex_load=true
H(function(){j=true
var e=Y[o]||{}
if(s.layers)for(var t=0;t<s.layers;++t){var r=z(_extends({wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE},e,{url:"img/atlas_"+o+"_"+t+".png"}))
n.push(r)}else{var a=z(_extends({wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE},e,{url:"img/atlas_"+o+".png"}))
n.push(a)}i.verifySprites(u)})}
function AutoAtlasImp(e){this.sprites={}
this.texs=[]
this.did_tex_load=false
this.atlas_name=e
u(this.doInit.bind(this))}e.get=function get(e){var t=this.sprites[e]
if(!t){t=this.sprites[e]=this.prealloc()
if(j){i('AutoAtlas "'+this.atlas_name+'" does not contain image "'+e+'"')
spriteMakeError(t)}}t.autoatlas_used=true
return t}
return AutoAtlasImp}()
var v
function autoAtlasReload(e){e=e.slice(0,-5)
var t=v[e]
if(!t)return
t.doInit()}function autoAtlasGet(e){if(!v){v={}
n(".auat",autoAtlasReload)}var t=v[e]
if(!t)t=v[e]=new f(e)
return t}function autoAtlas(e,t){return autoAtlasGet(e).get(t)}},{"../common/data_error":381,"../common/vmath":402,"./engine":305,"./filewatch":314,"./sprites":363,"./textures":365,"./webfs":371,assert:void 0}],292:[function(e,t,r){"use strict"
e("./polyfill.js")
var u=document.getElementById("debug")
window.onerror=function(e,t,r,a,i){var o=String(e)
if(o.startsWith("[object ")){try{o=JSON.stringify(e)}catch(e){}o=o.slice(0,600)}if("string"===typeof i)o=o+" "+i
if(t||r>0||a>0)o+="\n  at "+t+"("+r+":"+a+")"
var n=false
if(i&&i.stack){n=true
o=""+i.stack
if(i.message)if(-1===o.indexOf(i.message))o=i.message+"\n"+o
var s=document.location.origin||""
if(s){if("/"!==s.slice(-1))s+="/"
o=o.split(s).join("")}o=o.replace(/\[\d+\]<\/?/g,"").replace(/\/</g,"").replace(/<?\/<?/g,"/").replace(/\n\//g,"\n").replace(/\n([^ ])/g,"\n  $1")}if(-1===o.indexOf("Error:"))o="Error: "+o
if(i&&i.errortype)if("unhandledrejection"===i.errortype)o="Uncaught (in promise) "+o
if(i)try{if("object"===typeof i)for(var l in i)if("string"===typeof i[l]){var _=i[l]
if("errortype"!==l&&!(("stack"===l||"message"===l)&&n))o=o+"\n"+l+"="+_}}catch(e){}var c=true
if(window.glov_error_report)c=window.glov_error_report(o,t,r,a)
else if(!window.glov_error_early)window.glov_error_early={msg:o,file:t,line:r,col:a}
if(c)u.innerText=o+"\n\nPlease report this error to the developer, and then reload this page or restart the app."}
window.addEventListener("unhandledrejection",function(e){var t=e.reason
if(!t)return
if(!t||"object"!==typeof t)t={stack:t}
var r
if(e.reason&&e.reason.srcElement&&e.reason.srcElement.src)r=e.reason.srcElement.src
try{t.errortype=e.type}catch(e){}window.onerror(e.reason,r,0,0,t)})
window.debugmsg=function(e,t){if(t)u.innerText=e
else u.innerText+=e+"\n"}
window.profilerStart=window.profilerStop=window.profilerStopStart=function nop(){}},{"./polyfill.js":343}],293:[function(e,t,i){"use strict"
i.is_discrete_gpu=i.is_itch_app=i.is_firefox=i.is_ios_safari=i.is_webkit=i.is_android=i.is_windows_phone=i.is_ios=i.is_mac_osx=void 0
var r=window.navigator.userAgent
var o=r.match(/Mac OS X/)
i.is_mac_osx=o
var n=!window.MSStream&&r.match(/iPad|iPhone|iPod/)
i.is_ios=n
var a=r.match(/windows phone/i)
var s=!(i.is_windows_phone=a)&&r.match(/android/i)
i.is_android=s
var l=r.match(/WebKit/i)
i.is_webkit=l
var _=n&&l&&!r.match(/CriOS/i)
i.is_ios_safari=_
var c=r.match(/Firefox/i)
i.is_firefox=c
var u=-1!==String(window.location.protocol).indexOf("itch")
i.is_itch_app=u
var d=false
i.is_discrete_gpu=d
function init(){try{var e=document.createElement("canvas")
e.width=4
e.height=4
var t=e.getContext("webgl")
if(t){var r=t.getExtension("WEBGL_debug_renderer_info")
if(r){var a=t.getParameter(r.UNMASKED_RENDERER_WEBGL)
i.is_discrete_gpu=d=Boolean(a&&(a.match(/nvidia|radeon/i)||a.match(/apple gpu/i)&&o&&!n))}}}catch(e){}}init()},{}],294:[function(e,t,r){"use strict"
r.buildUIStartup=buildUIStartup
var R=e("./camera2d.js")
var a=e("./engine.js")
var i=a.renderNeeded
var o=e("./font.js")
var b=Math.min
var N=e("./scroll_area.js").scrollAreaCreate
var C=e("./ui.js")
var n=e("./net.js")
var s=e("../common/data_error.js"),l=s.dataErrorEx,x=s.dataErrorQueueClear,M=s.dataErrorQueueGet
var D=e("../common/util.js").plural
var _=e("../common/vmath.js").vec4
var P
var B
Z.BUILD_ERRORS=Z.BUILD_ERRORS||9900
function onGBState(e){P=e
i()}function onServerError(e){B=e
i()}function onDataErrors(e){for(var t=0;t<e.length;++t)l(e[t])
i()}var k=4
var U=_(0,0,0,1)
var G=o.styleColored(null,4280295679)
var F=o.styleColored(null,3722305023)
var W=o.styleColored(null,14540287)
var H=o.styleColored(null,539033599)
var z=_(1,1,1,1)
var V=/\u001b\[(?:[0-9;]*)[0-9A-ORZcf-nqry=><]/g
var Y
function buildUITick(){var e=M()
if(!P&&!B&&!e.length)return
var t=R.x0()+k
var r=R.y0()+k
var a=Z.BUILD_ERRORS
var i=.75*R.w()
var o=C.font,n=C.title_font,s=C.font_height
var l=t
var _=r
var c=((null==P?void 0:P.error_count)||0)+(B?1:0)+e.length
var u=(null==P?void 0:P.warning_count)||0
n.drawSizedAligned(G,l,_,a,s,o.ALIGN.HCENTERFIT,i,0,c+" "+D(c,"error")+", "+u+" "+D(u,"warning"))
_+=s+1
C.drawLine(t+.3*i,_,t+.7*i,_,a,.5,true,z)
_+=k
if(!Y)Y=N({z:a,background_color:null,auto_hide:true})
var d=R.y1()-k-_
var f=_
Y.begin({x:l,y:_,w:i,h:d})
var v=i-k-Y.barWidth()
_=0
a=Z.UI
var h=0
function printLine(e,t){t=t.replace(V,"")
_+=o.drawSizedWrapped(F,l+h,_,a,v-h,0,s,e+": "+t)}if(P)for(var p in P.tasks){var m=P.tasks[p]
h=l=0
o.drawSizedAligned(W,l,_,a,s,o.ALIGN.HLEFT,v,0,p+":")
_+=s
h+=s
var E=false
for(var g in m.jobs){var T=m.jobs[g]
var y=T.warnings,S=T.errors
if("all"!==g){if(g.startsWith("source:"))g=g.slice(7)
_+=o.drawSizedWrapped(H,h,_,a,v,0,s,g)}if(y)for(var I=0;I<y.length;++I){printLine("Warning",y[I])
E=true}if(S)for(var A=0;A<S.length;++A){printLine("Error",S[A])
E=true}}if(!E&&m.err)printLine("Error",m.err)
_+=k}if(B){l=h=0
o.drawSizedAligned(W,l,_,a,s,o.ALIGN.HLEFT,v,0,"Server Error:")
_+=s
l+=s
printLine("Server error",B)}for(var w=0;w<e.length;++w){var L=e[w].msg
l=0
printLine("Data error",L)}Y.end(_)
_=f+b(d,_)
var O=1.5*s
if(C.buttonText({x:t+i-O,y:r,z:Z.BUILD_ERRORS+1,w:O,h:O,text:"X"})){B=P=null
x()}C.panel({x:t-k,y:r-k,z:Z.BUILD_ERRORS-1,w:i+2*k,h:_-r+2*k,color:U})}function buildUIStartup(){if(n.client&&a.DEBUG){n.client.onMsg("gbstate",onGBState)
n.client.onMsg("server_error",onServerError)
n.client.onMsg("data_errors",onDataErrors)
n.subs.on("connect",function(){var e=n.client.pak("gbstate_enable")
e.writeBool(true)
e.send()})
a.addTickFunc(buildUITick)}}},{"../common/data_error.js":381,"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./engine.js":305,"./font.js":315,"./net.js":338,"./scroll_area.js":349,"./ui.js":367}],295:[function(e,t,p){"use strict"
p.virtualToCanvas=virtualToCanvas
p.transformX=transformX
p.transformY=transformY
p.canvasToVirtual=canvasToVirtual
p.set=set
p.setSafeAreaPadding=setSafeAreaPadding
p.safeAreaPadding=safeAreaPadding
p.push=push
p.pop=pop
p.domToCanvasRatio=domToCanvasRatio
p.screenAspect=screenAspect
p.setAspectFixed=setAspectFixed
p.setAspectFixed2=setAspectFixed2
p.zoom=zoom
p.shift=shift
p.calcMap=calcMap
p.setNormalized=setNormalized
p.setScreen=setScreen
p.setDOMMapped=setDOMMapped
p.x0Real=x0Real
p.y0Real=y0Real
p.x1Real=x1Real
p.y1Real=y1Real
p.wReal=wReal
p.hReal=hReal
p.x0=x0
p.y0=y0
p.x1=x1
p.y1=y1
p.w=w
p.h=h
p.xScale=xScale
p.yScale=yScale
p.htmlPos=htmlPos
p.htmlSize=htmlSize
p.setInputClipping=setInputClipping
p.domToVirtual=domToVirtual
p.domDeltaToVirtual=domDeltaToVirtual
p.virtualToDom=virtualToDom
p.setDOMFontPixelScale=setDOMFontPixelScale
p.virtualToFontSize=virtualToFontSize
p.virtualToDomPosParam=virtualToDomPosParam
p.clipTestRect=clipTestRect
p.tickCamera2D=tickCamera2D
p.startup=startup
p.render_offset_y_bottom=p.render_offset_x=p.render_viewport_h=p.render_viewport_w=p.data=void 0
var u=e("assert")
var m=e("./engine.js")
var r=Math.max,E=Math.floor,g=Math.round
var T=new Float32Array(4)
var y=new Float32Array(15)
p.data=y
var S
var I
var A
var L
var O
p.render_viewport_w=O
var R
p.render_viewport_h=R
var b
p.render_offset_x=b
var N
var C
p.render_offset_y_bottom=C
function reapply(){if(A){y[4]=A/y[13]
y[5]=L/y[14]
y[7]=y[13]/O
y[8]=y[14]/R}else{y[4]=S/y[13]
y[5]=I/y[14]}}function virtualToCanvas(e,t){e[0]=(t[0]-y[0])*y[4]
e[1]=(t[1]-y[1])*y[5]}function transformX(e){return(e-y[0])*y[4]}function transformY(e){return(e-y[1])*y[5]}function canvasToVirtual(e,t){e[0]=t[0]/y[4]+y[0]
e[1]=t[1]/y[5]+y[1]}function safeScreenWidth(){return r(1,S-T[0]-T[1])}function safeScreenHeight(){return r(1,I-T[2]-T[3])}function set(e,t,r,a,i){u(isFinite(e))
u(isFinite(t))
u(isFinite(r))
u(isFinite(a))
if(i||A){y[9]=y[0]=e
y[10]=y[1]=t
y[11]=y[2]=r
y[12]=y[3]=a
y[13]=r-e
y[14]=a-t}else{y[9]=e
y[10]=t
y[11]=r
y[12]=a
var o=(r-e)/safeScreenWidth()
var n=(a-t)/safeScreenHeight()
var s=e-T[0]*o
var l=t-T[2]*n
var _=r+T[1]*o
var c=a+T[3]*n
y[0]=s
y[1]=l
y[2]=_
y[3]=c
y[13]=_-s
y[14]=c-l}reapply()}function setSafeAreaPadding(e,t,r,a){T[0]=g(e)
T[1]=g(t)
T[2]=g(r)
T[3]=g(a)}function safeAreaPadding(){return T}var a=[]
function push(){a.push(y.slice(0))}function pop(){var e=a.pop()
for(var t=0;t<e.length;++t)y[t]=e[t]
reapply()}function domToCanvasRatio(){return y[6]}function screenAspect(){return safeScreenWidth()/safeScreenHeight()}function setAspectFixed(e,t){var r=A?1:m.pixel_aspect
var a=t/r/e
var i
var o
var n
if(A){o=A
n=L}else{o=safeScreenWidth()
n=safeScreenHeight()}if(a>(i=n/o)){var s=t/r/i
var l=o/s
var _=s-e
var c=g(_*l/2)/l
set(-c,0,e+(_-c),t,false)}else{var u=e*r*i
var d=n/u
var f=u-t
var v=g(f*d/2)/d
set(0,-v,e,t+(f-v),false)}}function setAspectFixed2(e,t){var r=A?1:m.pixel_aspect
var a=t/r/e
var i
if(A)i=L/A
else i=1/screenAspect()
if(a>i)set(0,0,e+(t/r/i-e),t,false)
else set(0,0,e,t+(e*r*i-t),false)}function zoom(e,t,r){var a=1/r
set(e-(e-y[0])*a,t-(t-y[1])*a,e+(y[2]-e)*a,t+(y[3]-t)*a,true)}function shift(e,t){set(y[0]+e,y[1]+t,y[2]+e,y[3]+t,true)}function calcMap(e,t,r){var a=y[11]-y[9]
var i=y[12]-y[10]
var o=(t[0]-y[9])/a
var n=(t[1]-y[10])/i
var s=(t[2]-y[9])/a
var l=(t[3]-y[10])/i
var _=s-o
var c=l-n
var u=r[2]-r[0]
var d=r[3]-r[1]
e[0]=r[0]-u/_*o
e[1]=r[1]-d/c*n
e[2]=r[2]+u/_*(1-s)
e[3]=r[3]+d/c*(1-l)
return e}function setNormalized(){set(0,0,1,1,true)}function setScreen(e){if(A)set(0,0,A,L)
else if(e)set(0,0,safeScreenWidth(),safeScreenHeight())
else set(0,0,safeScreenWidth()/m.dom_to_canvas_ratio,safeScreenHeight()/m.dom_to_canvas_ratio)}function setDOMMapped(){if(A){var e=1/m.dom_to_canvas_ratio
set(b*e,N*e,(S-b)*e,(I-N)*e,true)}else set(0,0,S/m.dom_to_canvas_ratio,I/m.dom_to_canvas_ratio,true)}function x0Real(){return y[0]}function y0Real(){return y[1]}function x1Real(){return y[2]}function y1Real(){return y[3]}function wReal(){return y[13]}function hReal(){return y[14]}function x0(){return y[9]}function y0(){return y[10]}function x1(){return y[11]}function y1(){return y[12]}function w(){return y[11]-y[9]}function h(){return y[12]-y[10]}function xScale(){return y[4]}function yScale(){return y[5]}function htmlPos(e,t){if(A)return[((e-y[0])/y[7]+b)/S*100,((t-y[1])/y[8]+N)/I*100]
else return[100*(e-y[0])/(y[2]-y[0]),100*(t-y[1])/(y[3]-y[1])]}function htmlSize(e,t){if(A)return[100*e/y[7]/S,100*t/y[8]/I]
else return[100*e/(y[2]-y[0]),100*t/(y[3]-y[1])]}var i
function setInputClipping(e){i=e}function domToVirtual(e,t){var r=true
if(i)if(t[0]<i[0]||t[0]>i[0]+i[2]||t[1]<i[1]||t[1]>i[1]+i[3])r=false
if(A){e[0]=(t[0]*y[6]-b)*y[7]+y[0]
e[1]=(t[1]*y[6]-N)*y[8]+y[1]}else{e[0]=t[0]*y[6]/y[4]+y[0]
e[1]=t[1]*y[6]/y[5]+y[1]}return r}function domDeltaToVirtual(e,t){if(A){e[0]=t[0]*y[6]*y[7]
e[1]=t[1]*y[6]*y[8]}else{e[0]=t[0]*y[6]/y[4]
e[1]=t[1]*y[6]/y[5]}}var o=new Float32Array(4)
function updateVirtualInputClipping(){domToVirtual(o,i)
if(A){o[2]=i[2]*y[6]*y[7]
o[3]=i[3]*y[6]*y[8]}else{o[2]=i[2]*y[6]/y[4]
o[3]=i[3]*y[6]/y[5]}}function virtualToDom(e,t){if(A){e[0]=(b+(t[0]-y[0])/y[7])/y[6]
e[1]=(N+(t[1]-y[1])/y[8])/y[6]}else{e[0]=(t[0]-y[0])*y[4]/y[6]
e[1]=(t[1]-y[1])*y[5]/y[6]}}var n=.84
function setDOMFontPixelScale(e){n=e}function virtualToFontSize(e){if(A)return e/(y[6]*y[8])*n
else return e*y[5]/y[6]*n}function virtualToDomPosParam(e,t){if(A){e.x=(b+(t.x-y[0])/y[7])/y[6]
e.w=t.w/y[7]/y[6]
e.y=(N+(t.y-y[1])/y[8])/y[6]
e.h=t.h/y[8]/y[6]}else{e.x=(t.x-y[0])*y[4]/y[6]
e.w=t.w*y[4]/y[6]
e.y=(t.y-y[1])*y[5]/y[6]
e.h=t.h*y[5]/y[6]}if(i){if(e.x<i[0]){e.w=r(0,e.w-(i[0]-e.x))
e.x=i[0]}if(e.y<i[1]){e.h=r(0,e.h-(i[1]-e.y))
e.y=i[1]}if(e.x>i[0]+i[2])e.w=0
if(e.y>i[1]+i[3])e.h=0}}function clipTestRect(e){if(!i)return true
updateVirtualInputClipping()
var t=o
if(e.x>t[0]+t[2]||e.x+e.w<t[0]||e.y>t[1]+t[3]||e.y+e.h<t[1])return false
if(e.x<t[0]){e.w-=t[0]-e.x
e.x=t[0]}if(e.y<t[1]){e.h-=t[1]-e.y
e.y=t[1]}if(e.x+e.w>t[0]+t[2])e.w=t[0]+t[2]-e.x
if(e.y+e.h>t[1]+t[3])e.h=t[1]+t[3]-e.y
return true}function tickCamera2D(){y[6]=m.dom_to_canvas_ratio
S=m.width
I=m.height
var e=[0,0,S,I]
if(m.render_width){A=m.render_width
L=m.render_height
var t=m.pixel_aspect
var r=L/t/A
var a=safeScreenWidth()
var i=safeScreenHeight()
var o=i/a
if(r>o){var n=(L/o-A*t)/2*i/L
p.render_offset_x=b=T[0]+g(n)
N=T[2]
p.render_offset_y_bottom=C=T[3]
p.render_viewport_w=O=g(a-2*n)
p.render_viewport_h=R=i}else{var s=(A*o-L/t)/2*a/A
p.render_offset_x=b=T[0]
N=T[2]+g(s)
p.render_offset_y_bottom=C=T[3]+g(s)
p.render_viewport_w=O=a
p.render_viewport_h=R=g(i-2*s)}if(m.render_pixel_perfect){var l=O/A
var _=E(l)
if(l>1&&l-_<=m.render_pixel_perfect){var c=A*(l=_)
var u=E(.5*(O-c))
p.render_offset_x=b+=u
p.render_viewport_w=O=c
var d=g(L*l/t)
var f=R-d
var v=E(.5*f)
N+=v
p.render_offset_y_bottom=C+=f-v
p.render_viewport_h=R=d}}e[2]=A
e[3]=L}else{A=L=0
p.render_offset_x=b=0
N=0
p.render_offset_y_bottom=C=0}reapply()
m.setViewport(e)}function startup(){S=m.width
I=m.height
set(0,0,m.width,m.height)
tickCamera2D()}},{"./engine.js":305,assert:void 0}],296:[function(e,t,r){"use strict"
r.decorateUserDefault=decorateUserDefault
r.chatUICreate=chatUICreate
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var R=e("assert")
var a=e("glov-async").asyncParallel
var i=e("../common/enums")
var o=i.CHAT_FLAG_EMOTE
var ue=i.CHAT_FLAG_USERCHAT
var n=e("../common/util")
var de=n.clamp
var s=n.cloneShallow
var l=n.dateToSafeLocaleString
var _=n.defaults
var c=n.deprecate
var u=e("../common/vmath")
var b=u.v3copy
var d=u.vec4
var fe=e("./camera2d")
var ve=e("./client_config").getAbilityChat
var he=e("./cmds").cmd_parse
var f=e("./edit_box").editBoxCreate
var pe=e("./engine")
var v=e("./font")
var me=v.ALIGN
var Ee=v.fontStyle
var N=v.fontStyleAlpha
var h=v.fontStyleColored
var ge=e("./input")
var p=e("./local_storage")
var m=p.getStoragePrefix
var E=p.localStorageGetJSON
var g=p.localStorageSetJSON
var T=e("./localization").getStringIfLocalizable
var y=e("./markdown")
var C=y.markdownAuto
var S=y.markdownDims
var Te=y.markdownDraw
var ye=y.markdownIsAllWhitespace
var I=y.markdownLayoutInvalidate
var A=y.markdownPrep
var w=e("./markdown_parse").mdEscape
var L=e("./markdown_renderables").markdownLayoutFit
var O=e("./net")
var Se=O.netClient
var x=O.netClientId
var Ie=O.netSubs
var M=O.netUserId
var D=e("./scroll_area").scrollAreaCreate
var Ae=e("./settings")
var P=e("./social").isFriend
var B=e("./spot")
var k=B.SPOT_DEFAULT_BUTTON
var U=B.spot
var we=B.spotUnfocus
var G=e("./ui")
var Le=G.drawRect
var F=G.drawRect2
var Oe=G.drawTooltip
var Re=G.isMenuUp
var W=G.panel
var be=G.playUISound
var H=G.provideUserString
var z=G.uiGetFont
var V=G.uiGetPanelColor
var Ne=G.uiGetTooltipPad
var Ce=G.uiGetTooltipPanelPixelScale
var xe=G.uiTextHeight
var Y=e("./uistyle").uiStyleCurrent
var j=e("./words/profanity")
var K=j.profanityFilter
var q=j.profanityStartup
var X=Math.ceil,Q=Math.floor,Me=Math.max,De=Math.min,Pe=Math.round
c(r,"create","chatUICreate")
Z.CHAT=Z.CHAT||500
Z.CHAT_FOCUSED=Z.CHAT_FOCUSED||Z.CHAT
var $=d(1,1,1,.5)
var J=d(1,1,1,.25)
var ee={join_leave:3}
function messageFromUser(e){return"error"!==e.style&&"system"!==e.style}Ae.register({chat_auto_unfocus:{default_value:0,type:he.TYPE_INT,range:[0,1],help:"Automatically unfocus chat after sending a message"},chat_show_join_leave:{default_value:1,type:he.TYPE_INT,range:[0,1],label:"Show join/leave messages",help:"Show join/leave messages"},profanity_filter:{default_value:1,type:he.TYPE_INT,range:[0,1],help:"Filter profanity in chat"}})
var te=function(){function CmdHistory(){this.entries=void 0
this.idx=void 0
this.hist_idx=void 0
this.edit_line=void 0
R("demo"!==m())
this.entries=new Array(50)
var e=E("console_idx")
if("number"!==typeof e||e<0||e>=this.entries.length)this.idx=0
else{this.idx=e
for(var t=0;t<this.entries.length;++t)this.entries[t]=E("console_e"+t)}this.resetPos()}var e=CmdHistory.prototype
e.setHist=function setHist(e,t){this.entries[e]=t
g("console_e"+e,t)}
e.add=function add(e){if(!e)return
var t=this.entries.indexOf(e)
if(-1!==t){var r=(this.idx-1+this.entries.length)%this.entries.length
while(t!==r){var a=(t+1)%this.entries.length
this.setHist(t,this.entries[a])
t=a}this.setHist(r,e)
return}this.setHist(this.idx,e)
this.idx=(this.idx+1)%this.entries.length
g("console_idx",this.idx)
this.resetPos()}
e.unadd=function unadd(e){var t=(this.idx-1+this.entries.length)%this.entries.length
if(this.entries[t]!==e)return
this.idx=t
g("console_idx",this.idx)
this.resetPos()}
e.resetPos=function resetPos(){this.hist_idx=this.idx
this.edit_line=""}
e.prev=function prev(e){if(this.hist_idx===this.idx)this.edit_line=e
var t=(this.hist_idx-1+this.entries.length)%this.entries.length
var r=this.entries[t]
if(t===this.idx||!r)return this.entries[this.hist_idx]||""
this.hist_idx=t
return r||""}
e.next=function next(e){if(this.hist_idx===this.idx)return e||""
var t=(this.hist_idx+1)%this.entries.length
this.hist_idx=t
if(this.hist_idx===this.idx){var r=this.edit_line
this.edit_line=""
return r||""}return this.entries[t]||""}
return CmdHistory}()
function defaultGetRoles(){var e
if(Ie()&&M()&&Se().connected){var t
var r=Ie().getMyUserChannel()
R(r)
if(null!=(e=r.data&&r.data.public)&&null!=(t=e.permissions)&&t.sysadmin)return{sysadmin:1,csr:1}}return{}}function filterIdentity(e){return e}function decorateUserDefault(e){var t=e.display_name
t=w(t)
if(!(e.flags&&e.flags&o))t="\\["+t+"]"
return t}function notHidden(e){return!e.hidden}function toStr(e){return"string"===typeof(e=T(e))?e:w(JSON.stringify(e))}var re={access:null}
var ae={year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"numeric",second:void 0}
var ie={year:void 0,month:"numeric",day:"2-digit",hour:"2-digit",minute:"numeric",second:"2-digit"}
function conciseDate(e){var t=Date.now()-e.getTime()
return l(e,false,t>15552e6?ae:ie)}var oe=h(null,255)
var ne=Ee(oe,{outline_width:.5,outline_color:255})
var se=d(0,0,0,.25)
var le=d(0,0,0,.125)
var _e=20
var ce=0
var Be=""
var ke=d()
function drawHelpTooltip(e){var t=z()
R(Array.isArray(e.tooltip))
var r=e.tooltip
var a=1
var i=e.font_height
var o=Q(.5*Ne())
var n=De(_e,Me(1,Q((e.y-fe.y0()-o)/i)-1))
if(r.length>20){var s=r.join("\n")
if(s!==Be){ce=0
Be=s}a=X(r.length/n)
r=r.slice(ce*n,(ce+1)*n)}else{ce=0
Be=""}var l=e.tooltip_width
var _=e.x
var c=e.z||Z.TOOLTIP+5
var u=_+o
var d=l-2*o
var f=e.y
var v=1
var h=2*o+i*r.length
if(!e.do_selection&&1===a&&ge.mouseOver({x:_,y:f-h,w:l,h:h}))v=.15
var p=oe
if(1!==v)p=N(p,v)
var m=f-o
var E=null
if(a>1){t.drawSizedAligned(oe,u,m-=i,c+1,i,me.HCENTER,d,0,"Page "+(ce+1)+" / "+a)
var g={x:_,y:m,w:l,h:i}
if(ge.mouseUpEdge(g))ce=(ce+1)%a
else if(ge.mouseOver(g))Le(_,m,_+l,m+i,c+.5,se)}for(var T=r.length-1;T>=0;--T){var y=r[T]
if(e.wrap)m-=i*t.numLines(p,d,0,i,y)
else m-=i
var S=y.indexOf(" ")
if("/"===y[0]&&-1!==S&&e.do_selection){var I=y.slice(0,S)
var A=y.slice(S)
var w=t.drawSized(ne,u,m,c+1,i,I)
C({font_style:oe,x:u+w,y:m,z:c+2,text_height:i,align:me.HFIT,w:d-w,text:A})
var L={x:_,y:m,w:l,h:i}
if(ge.mouseUpEdge(L))E=I.slice(1)
else if(ge.mouseOver(L)){Le(_,m,u+w+4,m+i,c+.5,se)
Le(u+w+4,m,_+l,m+i,c+.5,le)}}else C({font_style:p,x:u,y:m,z:c+1,text_height:i,align:e.wrap?me.HWRAP:me.HFIT,w:d,text:y})}m-=o
var O=.5*Ce()
b(ke,V())
ke[3]=v
W({x:_,y:m,z:c,w:l,h:f-m,pixel_scale:O,color:ke})
return E}function urlKeyEscape(e){return e.replace(/]/g,")").replace(/ /g,"%20")}var Ue=~me.HWRAP
var Ge=function(){function MDRChatURL(e,t,r,a){this.msg_url=void 0
this.dims=void 0
this.x=void 0
this.y=void 0
this.w=void 0
this.h=void 0
this.font=void 0
this.parent_font_style=void 0
this.align=void 0
this.alpha_font_style_cache=void 0
this.alpha_font_style_cache_value=void 0
this.url_label=e
this.style_link=t
this.style_link_hover=r
this.parent=a;(this.dims=this).msg_url=""+a.url_base+e}var e=MDRChatURL.prototype
e.layout=function layout(e){var t=e.text_height,r=e.font,a=e.align,i=e.font_style
this.parent_font_style=i
this.font=r
this.align=a
this.h=t
this.w=r.getStringWidth(this.style_link,t,this.url_label)
L(e,this)
return[this]}
e.draw=function draw(e){profilerStart("MDRChatURL::draw")
var t=this.parent,r=this.dims
var a=t.chat_interactive
var i
var o=e.x+r.x
var n=e.y+r.y
if(a){var s=U({x:o,y:n,w:r.w,h:r.h,sound_rollover:null,def:k,url:this.msg_url,internal:true})
i=s.focused?this.style_link_hover:this.style_link
if(s.focused||s.ret){t.handled_rightclick=true
t.focus_tooltip="Click to open "+this.url_label}if(s.ret)t.cmdParseInternal("url "+this.url_label)}else{i=this.parent_font_style
if(1!==e.alpha){if(this.alpha_font_style_cache_value!==e.alpha){this.alpha_font_style_cache_value=e.alpha
this.alpha_font_style_cache=N(i,e.alpha)}i=this.alpha_font_style_cache}}this.font.drawSizedAligned(i,e.x+r.x,e.y+r.y,e.z,r.h,this.align&Ue|me.HFIT,r.w,r.h,this.url_label)
profilerStop()}
return MDRChatURL}()
var Fe=function(){function MDRChatSource(e,t){this.dims=void 0
this.x=void 0
this.y=void 0
this.w=void 0
this.h=void 0
this.submd_cache={}
this.draw_param=void 0
this.alpha_font_style_cache=void 0
this.alpha_font_style_cache_value=void 0
this.msg=e
this.parent=t
this.dims=this}var e=MDRChatSource.prototype
e.layout=function layout(e){var t=this.parent.decorate_user_cb(this.msg)
var r={font:e.font,font_style:e.font_style,w:e.w,h:e.h,text_height:e.text_height,indent:e.indent,align:me.HFIT,cache:this.submd_cache,text:t}
I(r)
A(r)
var a=S(r)
this.w=a.w
this.h=a.h
this.draw_param={x:0,y:0,z:0,alpha:0,cache:this.submd_cache}
L(e,this)
return[this]}
e.draw=function draw(e){profilerStart("MDRChatSource::draw")
var t=e.x+this.x
var r=e.y+this.y
var a=e.z
var i=this.parent,o=this.draw_param,n=this.msg,s=this.dims
var l=i.chat_interactive,_=i.user_context_cb
if(l){R(_)
R(n.id)
R(n.display_name)
var c={x:t,y:r,w:s.w,h:s.h,button:0,z:a+.5,peek:false,color:$}
if(ge.click(c))_({user_id:n.id})
else{c.peek=true
var u=ge.mouseOver(c)
if(i.user_id_mouseover===n.id)F(_extends({},c,{color:J}))
if(u){i.focus_tooltip="Click to view user info"
if(n.chatsrc_tooltip)i.focus_tooltip=n.chatsrc_tooltip+"\n"+i.focus_tooltip
F(c)
i.user_id_mouseover=n.id
i.did_user_id_mouseover=true}}}o.x=t
o.y=r
o.z=a
o.alpha=e.alpha
Te(o)
profilerStop()}
return MDRChatSource}()
var We=function(){function ChatUIImpl(e){this.w=void 0
this.h=void 0
this.edit_text_entry=void 0
this.channel=null
this.on_chat_cb=null
this.max_lines=void 0
this.max_messages=void 0
this.max_len=void 0
this.font_height=void 0
this.hide_disconnected_message=void 0
this.disconnected_message_top=void 0
this.inner_width_adjust=void 0
this.border=void 0
this.volume_join_leave=void 0
this.volume_in=void 0
this.volume_out=void 0
this.msg_out_err_delay=void 0
this.get_roles=void 0
this.url_match=void 0
this.url_info=void 0
this.fade_start_time=void 0
this.fade_time=void 0
this.styles=void 0
this.classifyRole=void 0
this.cmdLogFilter=void 0
this.history=void 0
this.scroll_area=void 0
this.font=void 0
this.on_join=void 0
this.on_leave=void 0
this.on_chat=void 0
this.handle_cmd_parse=void 0
this.handle_cmd_parse_error=void 0
this.z_override=null
this.renderables={}
this.user_id_mouseover=null
this.did_user_id_mouseover=false
this.user_context_cb=void 0
this.decorate_user_cb=void 0
this.message_pre_send_cb=void 0
this.chat_interactive=false
this.url_base=void 0
this.handled_rightclick=false
this.focus_tooltip=""
this.active_font_height=void 0
this.wrap_w=void 0
this.indent=void 0
this.msgs=void 0
this.total_h=void 0
this.did_run_late=false
R.equal(typeof e,"object")
R.equal(typeof e.max_len,"number")
this.font=z()
this.edit_text_entry=f({placeholder:"Chat",initial_focus:false,auto_unfocus:true,spatial_focus:false,max_len:e.max_len,text:"",suppress_up_down:true})
var t=e.style||Y()
this.on_join=this.onMsgJoin.bind(this)
this.on_leave=this.onMsgLeave.bind(this)
this.on_chat=this.onMsgChat.bind(this)
this.handle_cmd_parse=this.handleCmdParse.bind(this)
this.handle_cmd_parse_error=this.handleCmdParseError.bind(this)
he.setDefaultHandler(this.handle_cmd_parse_error)
this.clearChat()
this.max_lines=e.max_lines||8
this.max_messages=e.max_messages||1e3
this.max_len=e.max_len
this.font_height=e.font_height||t.text_height
this.hide_disconnected_message=e.hide_disconnected_message||false
this.disconnected_message_top=e.disconnected_message_top||false
this.scroll_area=D({background_color:null,auto_scroll:true})
this.w=e.w||pe.game_width/2
this.h=e.h||pe.game_height/2
this.inner_width_adjust=e.inner_width_adjust||0
this.border=e.border||void 0
this.volume_join_leave=e.volume_join_leave||.15
this.volume_in=e.volume_in||.5
this.volume_out=e.volume_out||.5
this.msg_out_err_delay=e.msg_out_err_delay||0
this.history=new te
this.get_roles=defaultGetRoles
this.url_match=e.url_match
this.url_info=e.url_info
this.url_base=e.url_base||""
if(this.url_info)R(this.url_base)
this.user_context_cb=e.user_context_cb
this.fade_start_time=e.fade_start_time||[1e4,1e3]
this.fade_time=e.fade_time||[1e3,500]
this.setActiveSize(this.font_height,this.w)
var r=e.outline_width||1
this.styles=_(e.styles||{},{def:Ee(null,{color:4008636159,outline_width:r,outline_color:255}),error:Ee(null,{color:3707764991,outline_width:r,outline_color:255}),link:Ee(null,{color:1346437119,outline_width:r,outline_color:255}),link_hover:Ee(null,{color:65535,outline_width:r,outline_color:255}),system:Ee(null,{color:2863311615,outline_width:r,outline_color:255})})
this.styles.join_leave=this.styles.join_leave||this.styles.system
this.classifyRole=e.classifyRole
this.cmdLogFilter=e.cmdLogFilter||filterIdentity
this.decorate_user_cb=e.decorate_user_cb||decorateUserDefault
this.message_pre_send_cb=e.message_pre_send_cb
if(e.renderables)this.renderables=s(e.renderables)
if(this.url_match)this.renderables.chaturl=this.createMDRChatURL.bind(this)
this.renderables.chatsrc=this.createMDRChatSource.bind(this)
if(Ie())Ie().on("chat_broadcast",this.onChatBroadcast.bind(this))
window.cmd=this.cmdParse.bind(this)}var e=ChatUIImpl.prototype
e.createMDRChatURL=function createMDRChatURL(e){var t=e.key
if(!t)return null
var r=this.url_info
if(r){var a=t.match(r)
if(!a||a[0]!==t)return null}return new Ge(t,this.styles.link,this.styles.link_hover,this)}
e.createMDRChatSource=function createMDRChatSource(e,t){if(!t)return null
return new Fe(t,this)}
e.calcMsgHeight=function calcMsgHeight(e){var t={font_style:this.styles[e.style]||this.styles.def,w:this.wrap_w,indent:this.indent,text_height:this.active_font_height,cache:e.cache,align:me.HWRAP,text:e.msg_text,renderables:this.renderables}
if(e.chatsrc_tag){var r
t.custom=((r={})[e.chatsrc_tag]={type:"chatsrc",data:e},r)}A(t)
var a=S(t)
e.msg_h=a.h
e.msg_w=a.w
this.total_h+=e.msg_h}
e.setActiveSize=function setActiveSize(e,t){var r=t-this.scroll_area.barWidth()
if(this.active_font_height!==e||this.wrap_w!==r){this.active_font_height=e
this.indent=Pe(this.active_font_height/24*40)
this.wrap_w=r
for(var a=this.total_h=0;a<this.msgs.length;++a){var i=this.msgs[a]
if(!i.hidden){I(i)
this.calcMsgHeight(i)}}}}
e.clearChat=function clearChat(){this.msgs=[]
this.total_h=0}
e.addMsgInternal=function addMsgInternal(e){var t=e
t.cache={}
t.flags=t.flags||0
t.timestamp=t.timestamp||Date.now()
if(t.flags&&t.flags&ue){R(t.display_name)
if(this.user_context_cb&&t.id){var r="csrc1"
while(t.msg.includes(r)||t.display_name.includes(r))r="csrc"+String(Math.random()).slice(2)
t.chatsrc_tag=r
t.msg_text="["+r+"=] "+t.msg}else t.msg_text=this.decorate_user_cb(t)+" "+t.msg}else t.msg_text=t.msg
this.calcMsgHeight(t)
this.msgs.push(t)
var a=ee[t.style]
if(a)for(var i=this.msgs.length-2;i>=0;--i){var o=this.msgs[i]
if(o.style===t.style&&!o.hidden)if(t.id&&o.id===t.id){o.hidden=true
this.total_h-=o.msg_h
o.msg_h=0}else if(--a<=0){o.hidden=true
this.total_h-=o.msg_h
o.msg_h=0
break}}if(this.msgs.length>1.25*this.max_messages){this.msgs=this.msgs.filter(notHidden)
if(this.msgs.length>1.25*this.max_messages){this.msgs.splice(0,this.msgs.length-this.max_messages)
for(var n=this.total_h=0;n<this.msgs.length;++n)this.total_h+=this.msgs[n].msg_h}}}
e.addChat=function addChat(e,t){e=toStr(e)
console.log(e)
this.addMsgInternal({msg:e,style:t})}
e.addChatFiltered=function addChatFiltered(e){e.msg=toStr(e.msg)
console.log("Chat from "+e.id+": "+e.msg)
if(Ae.profanity_filter&&e.id!==(M()||x()))e.msg=K(e.msg)
e.msg=this.linkFilter(e.msg)
this.addMsgInternal(e)}
e.linkFilter=function linkFilter(e){var t=this.url_match,i=this.url_info
if(!t)return e
return e.replace(t,function(e,t){var r=t
if(i){var a=t.match(i)
if(a)r=a[1]}return e.replace(t,"[chaturl="+urlKeyEscape(r)+"]")})}
e.linkUnFilter=function linkUnFilter(e){var r=this
return e.replace(/\[chaturl=([^\s\]]+)]/,function(e,t){return""+r.url_base+t})}
e.onMsgJoin=function onMsgJoin(e){if(!Ae.chat_show_join_leave)return
if(e.client_id!==x()){if(this.volume_join_leave)be("user_join",this.volume_join_leave)
this.addChatFiltered({id:e.user_id||e.client_id,display_name:e.display_name||e.client_id,flags:o|ue,msg:"joined the channel",style:"join_leave"})}}
e.onMsgLeave=function onMsgLeave(e){if(!Ae.chat_show_join_leave)return
if(this.volume_join_leave)be("user_leave",this.volume_join_leave)
this.addChatFiltered({id:e.user_id||e.client_id,display_name:e.display_name||e.client_id,flags:o|ue,msg:"left the channel",style:"join_leave"})}
e.registerOnMsgChatCB=function registerOnMsgChatCB(e){R(!this.on_chat_cb)
this.on_chat_cb=e}
e.onMsgChat=function onMsgChat(e){if(this.on_chat_cb)this.on_chat_cb(e)
var t=e.msg,r=e.style,a=e.id,i=e.display_name,o=e.flags
var n=e,s=n.client_id,l=n.ts,_=n.quiet
if(!_&&s!==x())if(this.volume_in)be("msg_in",this.volume_in)
o=(o||0)|ue
this.addChatFiltered({id:a,display_name:i=i||a,msg:t,style:r,flags:o,timestamp:l,quiet:_})}
e.onChatBroadcast=function onChatBroadcast(e){var t=e.msg,r=e.src
be("msg_err")
this.addChatFiltered({msg:"["+r+"] "+t,style:"error"})}
e.focus=function focus(){this.edit_text_entry.focus()}
e.runLate=function runLate(){this.did_run_late=true
if(ve()&&ge.keyDownEdge(ge.KEYS.RETURN))this.focus()
if(ge.keyDownEdge(ge.KEYS.SLASH)||ge.keyDownEdge(ge.KEYS.NUMPAD_DIVIDE)){this.focus()
this.edit_text_entry.setText("/")}}
e.addChatError=function addChatError(e){this.addChat("[error] "+toStr(e),"error")}
e.handleCmdParseError=function handleCmdParseError(e,t){if(e)this.addChatError(e)}
e.handleCmdParse=function handleCmdParse(e,t){if(e)this.addChatError(e)
else if(t)this.addChat("[system] "+toStr(t),"system")}
e.setGetRoles=function setGetRoles(e){this.get_roles=e}
e.getAccessObj=function getAccessObj(){re.access=this.get_roles()
return re}
e.cmdParse=function cmdParse(r,a){var i=this
var o=a?function(e,t){i.handle_cmd_parse(e,t)
if(a)a(e,t)}:this.handle_cmd_parse
he.handle(this.getAccessObj(),r,function(e,t){if(e&&he.was_not_found)Ie().sendCmdParse(r,o)
else o(e,t)})}
e.cmdParseInternal=function cmdParseInternal(e){he.handle(this.getAccessObj(),e,this.handle_cmd_parse_error)}
e.isFocused=function isFocused(){return this.edit_text_entry.isFocused()}
e.sendChat=function sendChat(u,e){var d=this
var t=function do_send(c){if(!c)return
if(!Se()||!Se().connected)return d.addChatError("Cannot chat: Disconnected")
else if(!d.channel)return d.addChatError("Cannot chat: Must be in a channel")
else if(!Ie().loggedIn()&&!Ie().allow_anon)return d.addChatError("Cannot chat: Must be logged in")
else if(c.length>d.max_len)return d.addChatError("Chat message too long")
var e=d.channel.pak("chat")
e.writeInt(u)
e.writeString(c)
e.send(function(e,t){if(e)if("ERR_ECHO"===e){var r,a,i,o,n
var s=null==(r=d.channel)?void 0:null==(a=r.data)?void 0:null==(i=a.public)?void 0:i.clients
var l=null==s?void 0:null==(o=s[x()])?void 0:null==(n=o.ids)?void 0:n.roles
var _=d.classifyRole&&d.classifyRole(l,true)
d.onMsgChat({msg:c,style:_,id:M()||void 0,client_id:x(),display_name:Ie().getDisplayName()||void 0,flags:u})}else{d.addChatError(e)
if(!d.edit_text_entry.getText())d.edit_text_entry.setText(c)}})}
if(this.message_pre_send_cb)this.message_pre_send_cb(u,e,t)
else t(e)}
e.setZOverride=function setZOverride(e){this.z_override=e}
e.copyMessage=function copyMessage(e){var t=this.linkUnFilter(e.msg_text)
if(e.flags&&e.flags&ue&&e.id){var r=e.display_name||e.id
if(e.flags&&e.flags&o)t=r+" "+this.linkUnFilter(e.msg)
else t="["+r+"] "+this.linkUnFilter(e.msg)}var a=this.linkUnFilter(e.msg)
var i={}
if(e.flags&ue&&e.id)i["User ID"]={cb:function cb(){H("User ID",e.id)}}
if(a!==t)i["Just message"]={cb:function cb(){H("Chat Text",a)}}
H("Chat Text",t,i)}
e.run=function run(e){var t=this
var n=xe()/24
e=e||{}
if(!ve())e.hide=true
var r=e.border||this.border||8*n
var a=r
var i=e.scroll_grow||0
var o=this.font
if(Se()&&Se().disconnected&&!this.hide_disconnected_message)o.drawSizedAligned(Ee(null,{outline_width:2,outline_color:255,color:3709870335}),fe.x0(),this.disconnected_message_top?.8*pe.game_height:fe.y0(),Z.DEBUG,xe(),this.disconnected_message_top?me.HCENTER:me.HVCENTER,fe.w(),.2*fe.h(),"Connection lost, attempting to reconnect ("+(Se().timeSinceDisconnect()/1e3).toFixed(0)+")...")
if(!this.did_run_late)this.runLate()
this.did_run_late=false
var s=void 0===e.x?fe.x0():e.x
var l=void 0===e.y?fe.y1()-this.h:e.y
var _=l+this.h
var c=s+r
var u=_
var d=this.w
var f=this.isFocused()
var v=this.z_override||(f?Z.CHAT_FOCUSED:Z.CHAT)
this.z_override=null
var h=false
var p=this.font_height
var m=false
var E=(e.hide||pe.defines.NOUI||!Ie().loggedIn())&&!f?1:0
var g=Re()||E
if(!g&&f&&ge.touch_mode){d=fe.x1()-s-24*n
var T=4
var y=fe.screenAspect()
if(y>2)T=4+4*De((y-2)/8,1)
p*=T}var S=d-r+this.inner_width_adjust
this.setActiveSize(p,S)
if(!g){m=true
u-=r+p+1
if(!f&&e.pointerlock&&ge.pointerLocked())o.drawSizedAligned(this.styles.def,c,u,v+1,p,me.HFIT,S,0,"<Press Enter to chat>")
else{if(f){var I=!ge.keyDown(ge.KEYS.SHIFT)&&ge.keyDownEdge(ge.KEYS.TAB)
if(I)this.focus()
var A=this.edit_text_entry.getText()
if(A){if("/"===A[0]){var w=he.autoComplete(A.slice(1),this.getAccessObj().access)
if(w&&w.length){var L=w[0]
var O=[]
var R=false
for(var b=0;b<w.length;++b){var N=w[b]
O.push("/"+N.cmd+" - "+N.help)}var C=false
if(1===w.length&&L.cname&&he.canonical(A.slice(1)).slice(0,L.cname.length)===L.cname){if(L.usage)O=L.usage.split("\n")
else O=[L.help]
R=true}else C=true
var x=u
var M=this.msgs[this.msgs.length-1]
if(M){var D=M.msg
if(D&&!(M.flags&ue)&&"[error]"===D.slice(0,7))x-=M.msg_h+a}var P=drawHelpTooltip({x:c,y:x,tooltip_width:Me(S,.8*pe.game_width),tooltip:O,do_selection:C,font_height:De(p,fe.w()/30),wrap:R})
if(C)if(I||P)this.edit_text_entry.setText("/"+(P||L.cmd)+" ")}}}else this.history.resetPos()
if(ge.keyDownEdge(ge.KEYS.UP))this.edit_text_entry.setText(this.history.prev(A))
if(ge.keyDownEdge(ge.KEYS.DOWN))this.edit_text_entry.setText(this.history.next(A))
this.scroll_area.keyboardScroll()}var B=p
var k=S-(e.cuddly_scroll?this.scroll_area.barWidth()+1+r:r)
if(ge.touch_mode&&!f){u-=2*p
B=3*p
k=6*p}var U=this.edit_text_entry.run({x:c,y:u,w:k,font_height:B,pointer_lock:e.pointerlock})
h=this.isFocused()
if(U===this.edit_text_entry.SUBMIT){this.scroll_area.scrollToEnd()
var G=this.edit_text_entry.getText().trim()
if(G&&!ye({text:G,renderables:this.renderables})){var F=Date.now()
this.edit_text_entry.setText("")
if("/"===G[0]){if("/"===G[1])G=G.slice(1)
this.history.add(G)
if(Ie())Ie().serverLog("cmd",this.cmdLogFilter(G))
this.cmdParse(G.slice(1),function(e){if(!e)return
if(t.volume_out)setTimeout(function(){return be("msg_out_err",t.volume_out)},Me(0,1e3*t.msg_out_err_delay-(Date.now()-F)))
if(!t.edit_text_entry.getText())t.edit_text_entry.setText(G)
if(!h)t.focus()})}else this.sendChat(0,G)
if(this.volume_out)be("msg_out",this.volume_out)
if(Ae.chat_auto_unfocus){h=false
we()}}else if(this.edit_text_entry.getText())this.edit_text_entry.setText("")
else{h=false
we()}}}}u-=a
var W=this.wrap_w
var H=this
var z=h||e.always_scroll
this.chat_interactive=Boolean(z)
this.did_user_id_mouseover=false
var V
function drawChatLine(e,t){if(e.hidden)return
var r=e.msg_h
var a=false
if(z&&!ge.mousePosIsTouch()&&(!e.style||messageFromUser(e)))a=ge.mouseOver({x:c,y:u,w:e.msg_w,h:r,peek:true})
H.handled_rightclick=false
H.focus_tooltip=""
Te({x:c,y:u,z:v+1,cache:e.cache,viewport:V,alpha:t})
if(a&&(!z||u>H.scroll_area.getScrollPos()-p)&&(!e.style||messageFromUser(e)||H.focus_tooltip))Oe({x:c,y:u,z:Z.TOOLTIP,tooltip_above:true,tooltip_width:450*n,tooltip_pad:Pe(.5*Ne()),tooltip:"Received"+(e.id?' from "'+e.id+'"':"")+" on "+conciseDate(new Date(e.timestamp))+(H.focus_tooltip?"\n"+H.focus_tooltip:"")+(!H.handled_rightclick?"\nRight-click to copy message":""),pixel_scale:.5*Ce()})
var i=!H.handled_rightclick&&ge.longPress({x:c,y:u,w:W,h:r})
var o=!H.handled_rightclick&&ge.click({x:c,y:u,w:W,h:r,button:2})
if(i||o)H.copyMessage(e)
m=true}var Y=Date.now()
if(z){var j=this.total_h
if(e.cuddly_scroll){var K=_-r
j+=K-u
u=K}j+=i
u+=i
var q=e.always_scroll?l+r-i:u-De(this.h,j)
var X=u-q
var Q=1
this.scroll_area.begin({x:c-Q,y:q,z:v,w:S+Q,h:X,focusable_elem:this.edit_text_entry,auto_hide:this.total_h<=2*p})
var $=c
var J=u
c=Q
u=0
var ee=this.scroll_area.getScrollPos()
var te=ee+X
V={x:Q,y:ee,w:S,h:X}
for(var re=0;re<this.msgs.length;++re){var ae=this.msgs[re]
var ie=ae.msg_h
if(u<=te&&u+ie>=ee)drawChatLine(ae,1)
u+=ie}this.scroll_area.end(j)
c=$
u=J-X+i
ge.mouseDownEdge({x:s,y:u-r,w:d,h:_-u+r})
if(ge.mouseUpEdge({x:s,y:u-r,w:d,h:_-u+r,in_event_cb:e.pointerlock?ge.pointerLockEnter:null})){we()
h=false}ge.mouseOver({x:s,y:u-r,w:d,h:_-u+r})
if(h&&ge.mouseDownEdge({peek:true})){we()
h=false}}else{var oe=this.max_lines*p
V={x:c,y:u-oe,w:this.w,h:oe}
for(var ne=0;ne<this.msgs.length;++ne){var se=this.msgs[this.msgs.length-ne-1]
var le=Y-se.timestamp
var _e=1-de((le-this.fade_start_time[E])/this.fade_time[E],0,1)
if(!_e||se.quiet)break
var ce=se.msg_h
oe-=ce
u-=ce
drawChatLine(se,_e)
if(u<=V.y)break}u=Me(u,V.y)}if(!this.did_user_id_mouseover)this.user_id_mouseover=null
if(e.pointerlock&&h&&ge.pointerLocked())ge.pointerLockExit()
if(!m&&(Re()||E))return
Le(s,u-r,s+d,_,v,[.3,.3,.3,.8])}
e.setChannel=function setChannel(e){var o=this
if(e===this.channel)return
if(this.channel){if(!e)this.addChat("Left channel "+this.channel.channel_id)
this.channel.removeMsgHandler("chat",this.on_chat)
this.channel.removeMsgHandler("join",this.on_join)
this.channel.removeMsgHandler("leave",this.on_leave)}if(!(this.channel=e))return
this.clearChat()
e.onMsg("chat",this.on_chat)
e.onMsg("join",this.on_join)
e.onMsg("leave",this.on_leave)
var n
var s=[]
var l={}
var _=[]
a([function(r){e.send("chat_get",null,function(e,t){if(!e&&t&&t.msgs&&t.msgs.length)n=t
r()})},function(n){e.onceSubscribe(function(e){var t=e&&e.public&&e.public.clients
if(t)for(var r in t){var a=t[r]
var i=a.ids&&a.ids.user_id
var o=false
if(i&&a.ids.display_name)if(l[i])o=true
else l[i]=a.ids.display_name
if(r===x()||o)continue
if(a.ids)if(i&&P(i))_.push(a.ids.display_name||i||r)
else s.push(a.ids.display_name||i||r)}n()})}],function(){if(!o.channel)return
if(n){var e=o.msgs.slice(0)
if(e.length)o.msgs=[]
for(var t=0;t<n.msgs.length;++t){var r=(n.idx+t)%n.msgs.length
var a=n.msgs[r]
if(a&&a.msg){a.quiet=true
if(a.id&&l[a.id])a.display_name=l[a.id]
o.onMsgChat(a)}}if(e.length)o.msgs=o.msgs.concat(e)}o.addChat("Joined channel "+o.channel.channel_id,"join_leave")
if(s.length||_.length){var i=[]
if(s.length)if((s=s.map(w)).length>10)i.push("Other users already here: "+s.slice(0,10).join(", ")+" (and "+(s.length-10)+" more...)")
else i.push("Other users already here: "+s.join(", "))
if(_.length)i.push("Friends already here: "+_.map(w).join(", "))
o.addChatFiltered({msg:i.join("\n"),style:"join_leave"})}})}
e.registerCmdHandlers=function registerCmdHandlers(){var t=this
he.registerValue("volume_chat_joinleave",{type:he.TYPE_FLOAT,label:"Join/Leave chat message volume",range:[0,1],get:function get(){return t.volume_join_leave},set:function set(e){return t.volume_join_leave=e},store:true})
he.registerValue("volume_chat_in",{type:he.TYPE_FLOAT,label:"Incoming chat message volume",range:[0,1],get:function get(){return t.volume_in},set:function set(e){return t.volume_in=e},store:true})
he.registerValue("volume_chat_out",{type:he.TYPE_FLOAT,label:"Outgoing chat message volume",range:[0,1],get:function get(){return t.volume_out},set:function set(e){return t.volume_out=e},store:true})}
return ChatUIImpl}()
function chatUICreate(r){q()
var u=new We(r)
function emote(e,t){if(!e)return void t(null,"Usage: /me does something.")
if(r.emote_cb)r.emote_cb(e)
u.sendChat(o,e)}u.registerCmdHandlers()
he.register({cmd:"me",help:"Sends a message emoting an action. Can also perform animated emotes.",usage:"$HELP\n  Example: /me jumps up and down!\n    /me waves\n    /me sits",func:emote})
he.register({access_show:["hidden"],cmd:"em",func:emote})
he.register({cmd:"echo",help:"Echo text locally",func:function func(e,t){u.addChatFiltered({msg:e})
t()}})
he.register({cmd:"csr_all",access_run:["sysadmin"],help:"(Admin) Run a command as all users in the current channel",prefix_usage_with_help:true,usage:"  /csr_all command\nExample: /csr_all me bows down",func:function func(e,t){var r
if(!(u.channel&&u.channel.numSubscriptions()))return void t("Must be in a channel")
var a=(null==(r=u.channel.data.public)?void 0:r.clients)||{}
var i=0
for(var o in a){var n=a[o].ids
if(null!=n&&n.user_id){var s=e
var l=Ie().getChannelImmediate("user."+n.user_id).pak("csr_admin_to_user")
l.writeJSON(he.last_access)
l.writeString(s)
l.writeAnsiString(o)
l.send(u.handle_cmd_parse);++i}}t(null,"Sent command to "+i+" user(s)")}})
he.register({cmd:"csr",access_run:["csr"],help:"(CSR) Run a command as another user",prefix_usage_with_help:true,usage:"  /csr UserID command\nExample: /csr jimbly gems -100",func:function func(e,t){var r=e.indexOf(" ")
if(-1===r)return void t("Invalid number of arguments")
var a=e.slice(0,r)
var i=""
if(u.channel&&u.channel.numSubscriptions()){var o
var n=(null==(o=u.channel.data.public)?void 0:o.clients)||{}
for(var s in n){var l=n[s].ids
if((null==l?void 0:l.user_id)===a)i=s}}var _=e.slice(r+1)
var c=Ie().getChannelImmediate("user."+a).pak("csr_admin_to_user")
c.writeJSON(he.last_access)
c.writeString(_)
c.writeAnsiString(i)
c.send(t)}})
return u}},{"../common/enums":385,"../common/util":400,"../common/vmath":402,"./camera2d":295,"./client_config":297,"./cmds":298,"./edit_box":303,"./engine":305,"./font":315,"./input":326,"./local_storage":329,"./localization":330,"./markdown":332,"./markdown_parse":333,"./markdown_renderables":334,"./net":338,"./scroll_area":349,"./settings":351,"./social":357,"./spot":361,"./ui":367,"./uistyle":368,"./words/profanity":372,assert:void 0,"glov-async":void 0}],297:[function(e,t,r){"use strict"
r.platformOverrideID=platformOverrideID
r.platformGetID=platformGetID
r.platformParameterGet=platformParameterGet
r.getAbilityReload=getAbilityReload
r.setAbilityReload=setAbilityReload
r.getAbilityReloadUpdates=getAbilityReloadUpdates
r.setAbilityReloadUpdates=setAbilityReloadUpdates
r.getAbilityChat=getAbilityChat
r.setAbilityChat=setAbilityChat
r.MODE_PRODUCTION=r.MODE_DEVELOPMENT=r.PLATFORM=void 0
var a=e("assert")
var i=e("../common/platform")
var o=i.platformIsValid
var n=i.platformOverrideParameter
var s=i.platformParameter
a(o(window.conf_platform))
var l=window.conf_platform
var _=r.PLATFORM=l
function platformOverrideID(e){_=e}function platformGetID(){return _}function platformParameterGet(e){return s(platformGetID(),e)}var c=s(l,"devmode")
var u="on"===c||"auto"===c&&Boolean(String(document.location).match(/^https?:\/\/localhost/))
var d=!(r.MODE_DEVELOPMENT=u)
r.MODE_PRODUCTION=d
function getAbilityReload(){return platformParameterGet("reload")}function setAbilityReload(e){n("reload",platformParameterGet("reload")&&e)}function getAbilityReloadUpdates(){return platformParameterGet("reload_updates")}function setAbilityReloadUpdates(e){n("reload_updates",platformParameterGet("reload_updates")&&e)}var f=true
function getAbilityChat(){return f}function setAbilityChat(e){f=e}},{"../common/platform":394,assert:void 0}],298:[function(e,t,r){"use strict"
r.safearea=r.cmd_parse=void 0
var a=e("assert")
var i=e("../common/cmd_parse")
var o=e("./local_storage")
var n=e("./urlhash")
var s=i.create({storage:o})
r.cmd_parse=s
var l=[-1,-1,-1,-1]
r.safearea=l
function cmdDesc(e){return"**/"+e.cmd+"** - "+e.help}s.register({cmd:"help",help:"Searches commands",func:function func(e,t){var r=s.autoComplete("",this&&this.access)
if(e){var a=s.canonical(e)
var i=e.toLowerCase()
r=r.filter(function(e){return-1!==e.cname.indexOf(a)||-1!==e.help.toLowerCase().indexOf(i)})}if(!r.length)return void t(null,'No commands found matching "'+e+'"')
t(null,r.map(cmdDesc).join("\n"))}})
s.registerValue("safe_area",{label:"Safe Area",type:s.TYPE_STRING,usage:"Safe Area value: Use -1 for auto based on browser environment,\nor 0-25 for percentage of screen size\n  Usage: /safe_area [value]\n  Usage: /safe_area horizontal,vertical\n  Usage: /safe_area left,right,top,bottom",default_value:"-1",get:function get(){return-1===l[0]?"-1 (auto)":l.join(",")},set:function set(e){var t=(e=String(e)).split(",")
if(e&&1===t.length)l[0]=l[1]=l[2]=l[3]=Number(e)
else if(2===t.length){l[0]=l[1]=Number(t[0])
l[2]=l[3]=Number(t[1])}else if(4===t.length)for(var r=0;r<4;++r)l[r]=Number(t[r])
for(var a=0;a<4;++a)if(!isFinite(l[a]))l[a]=-1},store:true})
s.register({cmd:"webgl2_auto",help:"Resets WebGL2 auto-detection",func:function func(e,t){if(!o.getJSON("webgl2_disable"))return t(null,"WebGL2 is already being auto-detected")
o.setJSON("webgl2_disable",void 0)
return t(null,"WebGL2 was disabled, will attempt to use it again on the next load")}})
s.register({cmd:"url",help:"Opens an internal URL",func:function func(e,t){setTimeout(function(){profilerStart("/url")
n.go(e)
profilerStop("/url")},1)}})
s.register({cmd:"client_crash",help:"(Debug) - Crash on the client",access_show:["sysadmin"],func:function func(e,t){var r
r.bar++}})
s.register({cmd:"client_assert",help:"(Debug) - Fail an assert on the client",access_show:["sysadmin"],func:function func(e,t){a(false)}})
s.register({cmd:"client_reject_now",help:"(Debug) - Fail an unhandled promise rejection on the client (Error, sync)",access_show:["sysadmin"],func:function func(e,t){new Promise(function(e,t){t(new Error("client_reject_now"))})}})},{"../common/cmd_parse":379,"./local_storage":329,"./urlhash":369,assert:void 0}],299:[function(e,t,r){"use strict"
r.collapsagoriesDrawDefault=collapsagoriesDrawDefault
r.collapsagoriesCreate=collapsagoriesCreate
r.collapsagoriesStart=collapsagoriesStart
r.collapsagoriesHeader=collapsagoriesHeader
r.collapsagoriesScrollCurrentSectionIntoFocus=collapsagoriesScrollCurrentSectionIntoFocus
r.collapsagoriesStop=collapsagoriesStop
var S=e("assert")
var a=e("../common/vmath")
var d=a.v4mul
var i=a.vec4
var o=e("./engine").getFrameIndex
var n=e("./font")
var f=n.ALIGN
var s=n.fontStyleColored
var l=e("./spot")
var I=l.SPOT_DEFAULT_BUTTON
var A=l.spot
var _=l.spotKey
var c=e("./sprites")
var w=c.spriteClipPop
var L=c.spriteClipPush
var O=c.spriteFlippedUVsApplyHFlip
var R=c.spriteFlippedUVsRestore
var u=e("./ui")
var b=u.drawHBox
var v=u.getUIElemData
var h=u.uiGetButtonRolloverColor
var N=e("./ui")
var C=Math.abs,x=Math.min,p=Math.round
var m=s(null,255)
var E=i()
function collapsagoriesDrawDefault(e){var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.text,s=e.text_height,l=e.font_style
var _=e.bar_color
var c=e.text_pad
if(void 0===c)c=p(.2*s)
var u=N.sprites.collapsagories
if(e.ret.focused)if(N.sprites.collapsagories_rollover)u=N.sprites.collapsagories_rollover
else if(_){d(E,_,h())
_=E}else _=h()
b(e,u,_)
N.title_font.draw({style:l||m,x:t+c,y:r,w:i,h:o,z:a+.1,align:f.HFIT|f.VCENTER,size:s,text:n})}var M=i(1,1,1,1)
var g=function(){function CollapsagoriesImpl(){this.headers_done=void 0
this.num_headers=void 0
this.header_h=void 0
this.view_y0=void 0
this.view_y1=void 0
this.clipper_active=false
this.key=void 0
this.parent_scroll=void 0
this.did_shadow_up=false
this.need_shadow_down=0
this.scroll_idx=-1
this.x=void 0
this.z=void 0
this.w=void 0
this.last_header_y=0}var e=CollapsagoriesImpl.prototype
e.start=function start(e){this.key=_(e)
this.num_headers=e.num_headers
this.headers_done=0
this.header_h=e.header_h
this.view_y0=e.view_y
this.view_y1=e.view_y+e.view_h
this.parent_scroll=e.parent_scroll
this.did_shadow_up=false
this.need_shadow_down=0
this.x=e.x
this.z=e.z||Z.UI
this.w=e.w}
e.drawShadowDown=function drawShadowDown(){if(this.need_shadow_down){var e=this.x,t=this.z,r=this.w,a=this.header_h
var i=N.sprites.collapsagories_shadow_down
M[3]=this.need_shadow_down
b({x:e,y:this.view_y0,w:r,h:a,z:t-.1},i,M)
this.need_shadow_down=0}}
e.header=function header(e){S(this.num_headers)
if(this.clipper_active){w()
this.clipper_active=false}var t=e.y,r=e.earlydraw
var a=t
this.last_header_y=t
var i=this.x,o=this.z,n=this.w,s=this.header_h,l=this.parent_scroll
var _
_=e.draw||collapsagoriesDrawDefault
var c=this.view_y0-t
var u=C(c)<.01
if(c>0){t=this.view_y0
this.view_y0+=s
this.need_shadow_down=x(1,c/s)}else this.drawShadowDown()
var d=this.view_y1-this.num_headers*s
if(t>d){var f=t-d
t=d
if(!this.did_shadow_up){this.did_shadow_up=true
M[3]=x(1,f/s)
var v=N.sprites.collapsagories_shadow_up
if(!v){v=N.sprites.collapsagories_shadow_down
O(v)}b({x:i,y:t-s,w:n,h:s,z:o-.1},v,M)
R(v)}}--this.num_headers
var h=e
h.x=i
h.y=t
h.z=o
h.h=s
h.w=n
if(r)r(h)
var p={key:this.key+"."+this.headers_done,def:I,x:i,y:t,w:n,h:s}
var m=A(p)
if(this.scroll_idx===this.headers_done){this.scroll_idx=-1
m.ret++}if(m.ret&&u){if(!this.headers_done)this.scroll_idx=this.headers_done+1
else this.scroll_idx=this.headers_done-1
m.ret=0}if(m.ret&&l){var E=a-this.headers_done*s
l.scrollIntoFocus(E,E,0)}h.ret=m
_(h)
var g=t+s
var T=this.view_y1-this.num_headers*s
var y
if(g>=T){L(o-.1,i,g,n,0)
y=false}else{L(o-.1,i,g,n,T-g)
y=true}this.clipper_active=true;++this.headers_done
return y}
e.scrollCurrentSectionIntoFocus=function scrollCurrentSectionIntoFocus(){var e=this.parent_scroll,t=this.last_header_y,r=this.header_h
if(e){var a=t-(this.headers_done-1)*r
e.scrollIntoFocus(a,a,0)}}
e.stop=function stop(){this.drawShadowDown()
if(this.clipper_active){w()
this.clipper_active=false}}
return CollapsagoriesImpl}()
function collapsagoriesCreate(){return new g}var T
var y=null
function collapsagoriesStart(e){var t=o()
S(!y||T!==t);(y=v("collapsagories",e,collapsagoriesCreate)).start(e)
T=t}function collapsagoriesHeader(e){S(y)
return y.header(e)}function collapsagoriesScrollCurrentSectionIntoFocus(){S(y)
y.scrollCurrentSectionIntoFocus()}function collapsagoriesStop(){S(y)
y.stop()
y=null}},{"../common/vmath":402,"./engine":305,"./font":315,"./spot":361,"./sprites":363,"./ui":367,assert:void 0}],300:[function(e,t,r){"use strict"
r.colorPicker=colorPicker
var w=e("./camera2d.js")
var a=e("./hsv.js"),L=a.hsvToRGB,i=a.rgbToHSV
var O=e("./input.js")
var R=Math.min
var b=e("./ui.js")
var N=b.LINE_CAP_SQUARE,C=b.uiButtonHeight,x=b.buttonWasFocused
var o=e("./sprites.js"),M=o.spriteClipped,D=o.spriteClipPause,P=o.spriteClipResume,l=o.spriteCreate
var _=e("./textures.js").TEXTURE_FORMAT
var B=e("../common/util.js").clamp
var n=e("../common/vmath.js"),c=n.vec3,k=n.v3copy,s=n.vec4
var U=s(0,0,0,1)
function colorPickerOpen(e){e.open=true
if(!e.color_hs){e.color_hs=s(0,0,0,1)
e.color_v=s(0,0,0,1)
e.hsv=c()}i(e.hsv,e.rgba)}function colorPickerAlloc(e){var t={open:false,rgba:s(0,0,0,1)}
k(t.rgba,e.color)
return t}var G
var F
function initTextures(){var e=32
var t=new Uint8Array(e*e*3)
var r=c()
var a=0
for(var i=0;i<e;i++){var o=1-i/(e-1)
for(var n=0;n<e;n++){L(r,360*n/(e-1),o,1)
t[a++]=255*r[0]
t[a++]=255*r[1]
t[a++]=255*r[2]}}G=l({url:"cpicker_hs",width:e,height:e,format:_.RGB8,data:t,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
t=new Uint8Array(32)
for(var s=0;s<t.length;++s)t[s]=255-255*s/(t.length-1)
F=l({url:"cpicker_v",width:1,height:t.length,format:_.R8,data:t,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})}function colorPicker(e){var t=b.getUIElemData("colorpicker",e,colorPickerAlloc)
var r=e.icon_h||C()
var a=e.icon_w||r
var i=e.picker_h||4*C()
var o=e.pad||3
var n=e.x,s=e.y,l=e.z
if(!t.open)k(t.rgba,e.color)
if(b.buttonImage({x:n,y:s,z:l,w:a,h:r,img:b.sprites.white,color:t.rgba}))if(!t.open)colorPickerOpen(t)
else t.open=false
var _=x()
if(t.open){var c=M()
if(c)D()
if(!G)initTextures()
l+=2
var u=n+=a+o
var d=s=R(s,w.y1()-i)
var f=t.hsv
var v=i
var h=.1*i
L(t.color_v,0,0,f[2])
var p={x:n,y:s,z:l,w:v,h:i,color:t.color_v,max_dist:Infinity}
G.draw(p)
var m=O.drag(p)||O.click(p)
if(m){_=true
var E=m.cur_pos||m.pos
f[0]=B((E[0]-n)/p.w*360,0,360)
f[1]=B(1-(E[1]-s)/p.h,0,1)}var g=n+f[0]*v/360
var T=s+(1-f[1])*i
b.drawLine(g-o,T,g+o,T,l+1,1,1,U,N)
b.drawLine(g,T-o,g,T+o,l+1,1,1,U,N)
n+=v+o
L(t.color_hs,f[0],f[1],1)
var y={x:n,y:s,z:l,w:h,h:i,color:t.color_hs,max_dist:Infinity}
F.draw(y)
if(m=O.drag(y)||O.click(y)){_=true
var S=m.cur_pos||m.pos
f[2]=B(1-(S[1]-s)/y.h,0,1)}var I=s+(1-f[2])*i
b.drawLine(n,I,n+h,I,l+1,1,1,U,N)
n+=h
L(t.rgba,t.hsv[0],t.hsv[1],t.hsv[2])
var A={x:u-o,y:d-o,w:n-u+2*o,h:i+2*o,z:l-1}
if(O.mouseOver(A))_=true
O.drag(A)
b.panel(A)
if(c)P()
if(O.click({peek:true})||!_&&O.mouseDownAnywhere())t.open=false}k(e.color,t.rgba)}},{"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./hsv.js":324,"./input.js":326,"./sprites.js":363,"./textures.js":365,"./ui.js":367}],301:[function(e,t,r){"use strict"
r.alphaQueue=alphaQueue
r.alphaDraw=alphaDraw
r.alphaDrawListSize=alphaDrawListSize
r.alphaListPush=alphaListPush
r.alphaListPop=alphaListPop
r.opaqueQueue=opaqueQueue
r.opaqueDraw=opaqueDraw
var a=e("assert")
var i=e("./dyn_geom.js"),o=i.dynGeomDrawAlpha,n=i.dynGeomDrawOpaque
var s=e("./engine.js").mat_vp
var l=[]
function alphaQueue(e){var t=s[2]*e.mat[12]+s[6]*e.mat[13]+s[10]*e.mat[14]+s[14]
l.push([t+(e.sort_bias||0),e])}function cmpAlpha(e,t){return t[0]-e[0]}function alphaDraw(){gl.enable(gl.BLEND)
gl.depthMask(false)
l.sort(cmpAlpha)
for(var e=0;e<l.length;++e)l[e][1].drawAlpha(l[e][0])
l.length=0
o()
gl.depthMask(true)
gl.disable(gl.BLEND)}function alphaDrawListSize(){return l.length}var _=null
function alphaListPush(){a(!_)
_=l
l=[]}function alphaListPop(){a(!l.length)
a(_)
l=_
_=null}var c=[]
function opaqueQueue(e){c.push(e)}function opaqueDraw(){for(var e=0;e<c.length;++e)c[e]()
c.length=0
n()}},{"./dyn_geom.js":302,"./engine.js":305,assert:void 0}],302:[function(e,t,r){"use strict"
r.dynGeomAlloc=dynGeomAlloc
r.dynGeomLookAt=dynGeomLookAt
r.dynGeomSpriteSetup=dynGeomSpriteSetup
r.dynGeomQueueSprite=dynGeomQueueSprite
r.dynGeomDrawOpaque=dynGeomDrawOpaque
r.dynGeomDrawAlpha=dynGeomDrawAlpha
r.sprite3d_vshader=r.FACE_CUSTOM=r.FACE_DEFAULT=r.FACE_CAMERA=r.FACE_FRUSTUM=r.FACE_XYZ=r.FACE_XY=r.FACE_NONE=r.BUCKET_ALPHA=r.BUCKET_DECAL=r.BUCKET_OPAQUE=void 0
var a=1
r.BUCKET_OPAQUE=a
var i=2
r.BUCKET_DECAL=i
var _=3
r.BUCKET_ALPHA=_
var o=0
r.FACE_NONE=o
var c=1
r.FACE_XY=c
var u=2
r.FACE_XYZ=u
var n=4
r.FACE_FRUSTUM=n
var d=8
r.FACE_CAMERA=d
var f=c|n
r.FACE_DEFAULT=f
var v=16
r.FACE_CUSTOM=v
var h=12
var p=65532*h
var m=e("assert")
var s=e("gl-mat4/lookAt")
var l=e("../common/util.js"),E=l.log2,g=l.nextHighestPowerOfTwo
var T=e("../common/vmath.js"),y=T.mat4,S=T.v3addScale,I=T.v3copy,A=T.v3cross,w=T.v3iNormalize,L=T.v3scale,O=T.v3sub,R=T.vec3,b=T.zero_vec
var N=e("./cmds.js").cmd_parse
var C=e("./engine.js")
var x=C.engineStartupFunc,M=C.setGlobalMatrices
var D=e("./geom.js")
var P=Math.ceil,B=Math.max,k=Math.min
var U=e("./settings.js")
var G=e("./shaders.js"),F=G.SEMANTIC,W=G.shaderCreate,H=G.shadersBind,z=G.shadersPrelink
var V=e("./sprites.js")
var Y=V.BLEND_ALPHA,j=V.blendModeReset,K=V.blendModeSet
var q=e("./textures.js"),Z=q.textureCmpArray,X=q.textureBindArray
U.register({gl_polygon_offset_a:{default_value:.1,type:N.TYPE_FLOAT,range:[0,100],access_show:["sysadmin"]},gl_polygon_offset_b:{default_value:4,type:N.TYPE_FLOAT,range:[0,100],access_show:["sysadmin"]}})
var Q
var $=y()
var J
var ee=0
var te
var re
r.sprite3d_vshader=re
var ae={}
var ie=[null,[],[],[]]
var oe=new Uint16Array([1,3,0,1,2,3])
var ne=new Uint16Array([1,3,0,1,2,3,0,3,1,3,2,1])
var se=[]
function DynGeomData(){this.num_tris=0
this.tris=null
this.tri_pool_idx=0
this.num_verts=0
this.verts=null
this.vert_pool_idx=0
this.texs=null
this.shader=null
this.vshader=null
this.shader_params=null
this.blend=0
this.sort_z=0
this.uid=0}function dynGeomAlloc(){var e
if(se.length)e=se.pop()
else e=new DynGeomData
return e}DynGeomData.prototype.queue=function(e,t){m(isFinite(t))
m(this.texs)
m(this.shader)
m(this.vshader)
this.sort_z=t
this.uid=++ee;++J.dyn
ie[e].push(this)}
var le=new Array(15).join(",").split(",").map(function(){return[]})
le[0]=null
var _e=new Array(15).join(",").split(",").map(function(){return[]})
_e[0]=null
var ce=4096
var ue=le.map(function(e,t){return k(ce,1<<14-t)})
var de=le.map(function(e,t){return k(ce,1<<17-t)})
DynGeomData.prototype.allocVerts=function(e){m(e*h<p)
this.num_verts=e
var t=E(this.num_verts)
m(t>0)
this.vert_pool_idx=t
var r=le[this.vert_pool_idx]
if(r&&r.length)this.verts=r.pop()
else{var a=r?g(e):e
this.verts=new Float32Array(h*a)}}
DynGeomData.prototype.allocTris=function(e){this.num_tris=e
var t=E(this.num_tris)
m(t>0)
this.tri_pool_idx=t
var r=_e[this.tri_pool_idx]
if(r&&r.length)this.tris=r.pop()
else{var a=r?g(e):e
this.tris=new Uint16Array(3*a)}}
DynGeomData.prototype.alloc=function(e,t){this.allocVerts(e)
this.allocTris(t)}
DynGeomData.prototype.allocQuad=function(e){this.allocVerts(4)
this.tris=e?ne:oe
this.num_tris=this.tris.length/3
this.tri_pool_idx=0}
DynGeomData.prototype.dispose=function(){var e=le[this.vert_pool_idx]
if(e&&e.length<ue[this.vert_pool_idx])e.push(this.verts)
this.verts=null
if((e=_e[this.tri_pool_idx])&&e.length<de[this.tri_pool_idx])e.push(this.tris)
this.tris=null
se.push(this)}
var fe=R()
var ve=R()
var he=R()
var pe=R()
var me=R()
var Ee=R()
var ge=false
function dynGeomLookAt(e,t,r){ge=true
I(pe,e)
I(ve,r)
L(fe,ve,-1)
O(Ee,t,pe)
w(Ee)
A(me,Ee,ve)
w(me)
A(he,Ee,me)
w(he)
s($,pe,t,ve)
M($)}var Te=R()
var ye=R(1,0,0)
var Se=R()
function dynGeomSpriteSetup(e){m(ge)
var t=e.pos,r=e.shader,a=e.shader_params,i=e.bucket,o=e.facing,n=e.vshader
i=i||_
r=r||te
n=n||re
a=a||null
var s
var l
if((o=void 0===o?f:o)===v){s=e.face_right
l=e.face_down}else if(o&c){s=me
l=fe}else if(o&u){s=me
l=he}else{s=ye
l=fe}if(s===me&&o&d){O(Te,t,pe)
A(Se,Te,ve)
s=w(Se)}return{bucket:i,my_right:s,my_down:l,sort_z:Q[2]*t[0]+Q[6]*t[1]+Q[10]*t[2]+Q[14],shader:r,vshader:n,shader_params:a}}var Ie=R()
function dynGeomQueueSprite(e,t){var r=dynGeomSpriteSetup(t),a=r.bucket,i=r.my_right,o=r.my_down,n=r.sort_z,s=r.shader,l=r.vshader,_=r.shader_params
var c=t.pos,u=t.offs,d=t.size,f=t.uvs,v=t.blend,h=t.color,p=t.doublesided
var m=dynGeomAlloc()
h=h||e.color
u=u||b
m.shader=s
m.vshader=l
m.shader_params=_
m.texs=e.texs
m.blend=v||Y
p=p||false
var E=e.origin
var g=d[0],T=d[1]
S(Ie,c,i,-E[0]*g+u[0])
S(Ie,Ie,o,-E[1]*T+u[1])
m.allocQuad(p)
var y=m.verts
y[0]=Ie[0]
y[1]=Ie[1]
y[2]=Ie[2]
y[4]=h[0]
y[5]=h[1]
y[6]=h[2]
y[7]=h[3]
y[8]=f[0]
y[9]=f[1]
y[12]=Ie[0]+o[0]*T
y[13]=Ie[1]+o[1]*T
y[14]=Ie[2]+o[2]*T
y[16]=h[0]
y[17]=h[1]
y[18]=h[2]
y[19]=h[3]
y[20]=f[0]
y[21]=f[3]
y[24]=Ie[0]+i[0]*g+o[0]*T
y[25]=Ie[1]+i[1]*g+o[1]*T
y[26]=Ie[2]+i[2]*g+o[2]*T
y[28]=h[0]
y[29]=h[1]
y[30]=h[2]
y[31]=h[3]
y[32]=f[2]
y[33]=f[3]
y[36]=Ie[0]+i[0]*g
y[37]=Ie[1]+i[1]*g
y[38]=Ie[2]+i[2]*g
y[40]=h[0]
y[41]=h[1]
y[42]=h[2]
y[43]=h[3]
y[44]=f[2]
y[45]=f[1]
m.queue(a,n)}var Ae
var we
var Le
var Oe=0
var Re
var be=0
var Ne=0
var Ce
var xe
var Me
var De=[]
function commit(){if(be===Ne)return
De.push({state:Ae,start:Ne,end:be})
Ne=be}function commitAndFlush(){commit()
if(!De.length)return
m(be)
we.updateIndex(Re,be)
var e=Oe/h
we.update(Le,e)
we.bind()
J.tris+=be/3
J.verts+=e
for(var t=0;t<De.length;++t){var r=De[t]
var a=r.state,i=r.start,o=r.end
if(xe!==a.shader||Me!==a.vshader||a.shader_params){H(a.vshader,a.shader,a.shader_params||ae)
xe=a.shader
Me=a.vshader}if(Ce)K(a.blend)
X(a.texs);++J.draw_calls_dyn
gl.drawElements(we.mode,o-i,gl.UNSIGNED_SHORT,2*i)}De.length=0
Ne=be=Oe=0}function drawSetup(e){Ce=e
Me=xe=-1
if(!we){we=D.create([[F.POSITION,gl.FLOAT,4,false],[F.COLOR,gl.FLOAT,4,false],[F.TEXCOORD,gl.FLOAT,4,false]],[],[],D.TRIANGLES)
Le=new Float32Array(1024)
Re=new Uint16Array(1024)}}function drawElem(e){if(!Ae||Z(e.texs,Ae.texs)||e.shader!==Ae.shader||e.vshader!==Ae.vshader||e.shader_params!==Ae.shader_params||Ce&&e.blend!==Ae.blend){commit()
Ae=e}var t=e.num_verts*h
if(Oe+t>Le.length){commitAndFlush()
if(Le.length!==p){var r=Le.length/h/3
var a=k(B(t,3*P(1.25*r)*h),p)
Le=new Float32Array(a)}}var i=3*e.num_tris
if(be+i>Re.length){commitAndFlush()
var o=Re.length/3
var n=B(e.tris.length,3*P(1.25*o))
Re=new Uint16Array(n)}var s=Oe/h
if(e.verts.length===t){Le.set(e.verts,Oe)
Oe+=t}else for(var l=0;l<t;++l)Le[Oe++]=e.verts[l]
for(var _=0;_<i;++_)Re[be++]=s+e.tris[_]}function finishDraw(){commitAndFlush()
j()}function queueDraw(e,t,r,a){drawSetup(e)
for(var i=r;i<a;++i){var o=t[i]
drawElem(o)
o.dispose()}finishDraw()}function cmpOpaue(e,t){var r=e.vshader.id-t.vshader.id
if(r)return r
if(r=e.shader.id-t.shader.id)return r
if(r=Z(e.texs,t.texs))return r
return e.uid-t.uid}function cmpAlpha(e,t){var r=t.sort_z-e.sort_z
if(r)return r
return e.uid-t.uid}function dynGeomDrawOpaque(){profilerStart("dynGeomDrawOpaque")
var e=ie[a]
if(e.length){e.sort(cmpOpaue)
queueDraw(false,e,0,e.length)
e.length=0}if((e=ie[i]).length){e.sort(cmpOpaue)
gl.enable(gl.BLEND)
gl.depthMask(false)
gl.enable(gl.POLYGON_OFFSET_FILL)
gl.polygonOffset(-U.gl_polygon_offset_a,-U.gl_polygon_offset_b)
queueDraw(true,e,0,e.length)
e.length=0
gl.disable(gl.POLYGON_OFFSET_FILL)
gl.depthMask(true)
gl.disable(gl.BLEND)}profilerStop("dynGeomDrawOpaque")}function dynGeomDrawAlpha(){profilerStart("dynGeomDrawAlpha")
m(!ie[a].length)
m(!ie[i].length)
var e=ie[_]
if(e.length){e.sort(cmpAlpha)
queueDraw(true,e,0,e.length)
e.length=0}profilerStop("dynGeomDrawAlpha")}function dynGeomStartup(){J=D.stats
r.sprite3d_vshader=re=W("shaders/sprite3d.vp")
te=V.sprite_fshader
z(re,te)
Q=C.mat_vp}x(dynGeomStartup)},{"../common/util.js":400,"../common/vmath.js":402,"./cmds.js":298,"./engine.js":305,"./geom.js":318,"./settings.js":351,"./shaders.js":353,"./sprites.js":363,"./textures.js":365,assert:void 0,"gl-mat4/lookAt":void 0}],303:[function(e,t,r){"use strict"
r.editBoxTick=editBoxTick
r.editBoxAnyActive=editBoxAnyActive
r.editBoxCreate=editBoxCreate
r.editBox=editBox
r.create=editBoxCreate
var o=e("assert")
var a=e("../common/util")
var n=a.clamp
var O=a.trimEnd
var ne=e("../common/verify")
var se=e("../common/vmath").v2same
var le=e("./camera2d")
var _e=e("./engine")
var i=e("./input")
var ce=i.KEYS
var ue=i.eatAllKeyboardInput
var de=i.inputClick
var fe=i.keyDownEdge
var s=i.keyUpEdge
var ve=i.mouseConsumeClicks
var l=i.pointerLockEnter
var _=i.pointerLockExit
var c=i.pointerLocked
var he=e("./localization").getStringIfLocalizable
var u=e("./spot")
var d=u.spotFocusCheck
var f=u.spotFocusSteal
var pe=u.spotSuppressKBNav
var me=u.spotUnfocus
var v=u.spotlog
var h=e("./ui")
var Ee=h.drawLine
var ge=h.drawRect
var p=h.getUIElemData
var m=h.uiButtonWidth
var Te=h.uiGetDOMElem
var ye=h.uiGetDOMTabIndex
var Se=h.uiGetFont
var E=h.uiTextHeight
var Ie=false
var g
var T
var Ae=[]
var y=[]
function editBoxTick(){var e=_e.frame_index-1
for(var t=0;t<y.length;++t){var r=y[t]
if(r.last_frame<e)r.unrun()}y=Ae
Ae=[]}function setActive(e){g=e
T=_e.frame_index}function editBoxAnyActive(){return g&&T>=_e.frame_index-1}function formHook(e){e.preventDefault()
if(!editBoxAnyActive())return
g.submitted=true
g.updateText()
if(g.pointer_lock&&!g.text)l("edit_box_submit")}function charIdxToXY(e,t){t=n(t,0,e.length)
var r=e.split("\n")
var a=0
while(a<r.length){var i=r[a]
if(t<=i.length)return[t,a]
t-=i.length
o(t>0)
t--
a++}ne(false)
return[0,a]}var S=0
var I=function(){function GlovUIEditBox(e){this.key="eb"+ ++S
this.x=0
this.y=0
this.z=Z.UI
this.w=m()
this.type="text"
this.font_height=E()
this.last_set_text=""
this.text=""
this.placeholder=""
this.max_len=0
this.max_visual_size=null
this.zindex=null
this.uppercase=false
this.initial_focus=false
this.onetime_focus=false
this.auto_unfocus=false
this.focus_steal=false
this.initial_select=false
this.spellcheck=true
this.esc_clears=true
this.esc_unfocuses=true
this.multiline=0
this.enforce_multiline=true
this.suppress_up_down=false
this.autocomplete=false
this.center=false
this.sticky_focus=true
this.canvas_render=null
this.applyParams(e)
o.equal(typeof this.text,"string")
this.last_autocomplete=null
this.is_focused=false
this.elem=null
this.input=null
this.submitted=false
this.pointer_lock=false
this.last_frame=0
this.out={}
this.last_valid_state={sel_start:0,sel_end:0}
this.resetCSSCaching()
this.had_overflow=false}var e=GlovUIEditBox.prototype
e.resetCSSCaching=function resetCSSCaching(){this.last_tab_index=-1
this.last_font_size=""
this.last_clip_path=""}
e.applyParams=function applyParams(e){if(!e)return
for(var t in e)if("text"!==t)this[t]=e[t]
if(e.text&&e.text!==this.last_set_text)this.setText(e.text)
this.h=(this.multiline||1)*this.font_height}
e.getSelection=function getSelection(){return[charIdxToXY(this.text,this.input.selectionStart),charIdxToXY(this.text,this.input.selectionEnd)]}
e.setSelectionRange=function setSelectionRange(e,t){this.input.setSelectionRange(e,t)}
e.updateText=function updateText(){var t=this.input
if(!t)return
var r=t.value
var a=r
var i=t.selectionStart
var o=t.selectionEnd
if(r===this.text){this.last_valid_state.sel_start=i
this.last_valid_state.sel_end=o
return}var n=this.multiline,e=this.enforce_multiline,s=this.max_len,l=this.max_visual_size
var _=true
var c=this.text
function debug(e){if(_e.defines.EDITBOX){console.log("Editbox (multiline="+n+", max_len="+s+": "+_e.frame_index+": "+e)
console.log("  Old sel range = ["+i+","+o+"]")
console.log("  New sel range = ["+t.selectionStart+","+t.selectionEnd+"]")
console.log("  Old text         = "+JSON.stringify(c))
console.log("  Desired new text = "+JSON.stringify(a))
console.log("  New text         = "+JSON.stringify(r))}}if(e&&n&&r.split("\n").length>n)if(O(r).split("\n").length<=n){while(r.split("\n").length>n)if(r[r.length-1].match(/\s/))r=r.slice(0,-1)
if(this.text===r)if(o<=r.length){t.value=r
this.setSelectionRange(i,o)
debug("trimming helped to keep selection")}else{_=false
debug("trimmed equal orig")}else{t.value=r
this.setSelectionRange(i,o)
debug("trimming helped")}}else{_=false
debug("trimmed too long")}if(s>0||l){var u=s||Infinity
var d=n?r.split("\n"):[r]
for(var f=0;f<d.length;++f){var v=d[f]
var h=v.length>u
var p=l?Se():null
if(l&&!h)h=p.getStringWidth(null,l.font_height,v)>l.width
var m=O(v)
var E=h&&m.length>u
if(l&&h&&!E)E=p.getStringWidth(null,l.font_height,m)>l.width
if(l&&h&&E&&p.getStringWidth(null,l.font_height,v.slice(0,-2))>l.width)while(m.length&&p.getStringWidth(null,l.font_height,m)>l.width){m=m.slice(0,-1)
E=false}if(h)if(!E){var g=d.slice(0,f+1).join("\n").length
d[f]=m
var T=d.slice(0,f+1).join("\n").length
r=d.join("\n")
var y=g-T
if(i>g)i-=y
else if(i>T)i=T
if(o>=g)o-=y
else if(o>T)o=T
t.value=r
this.setSelectionRange(i,o)
debug("over but not trim_over; updating text and sel")}else{_=false
debug("invalid: over")}}}if(!_){var S=false
if(s>0||l){var I=s||Infinity
var A=n?this.text.split("\n"):[this.text]
for(var w=0;w<A.length;++w){var L=A[w]
if(L.length>I)S=true
if(l&&!S)S=Se().getStringWidth(null,l.font_height,L)>l.width}}if(S)if(r.length<this.text.length)_=true}if(!_){this.had_overflow=true
t.value=this.text
this.setSelectionRange(this.last_valid_state.sel_start,this.last_valid_state.sel_end)
debug("invalid: reset sel range to ["+this.last_valid_state.sel_start+", "+this.last_valid_state.sel_end+"]")}else{this.text=r
this.last_valid_state.sel_start=i
this.last_valid_state.sel_end=o}}
e.getText=function getText(){return this.text}
e.hadOverflow=function hadOverflow(){var e=this.had_overflow
this.had_overflow=false
return e}
e.setText=function setText(e){e=String(e)
var t=this.max_len,r=this.max_visual_size,a=this.multiline
var i=r?Se():null
if(t>0&&r){var o=a?e.split("\n"):[e]
for(var n=0;n<o.length;++n){var s=o[n]
if(t>0){if(s.length>t)s=O(s)
if(s.length>t)s=s.slice(0,t)}if(r)while(s.length&&i.getStringWidth(null,r.font_height,s)>r.width)s=s.slice(0,s.length-1)
o[n]=s}e=o.join("\n")}var l=this.input
if(l&&l.value!==e){if(_e.defines.EDITBOX){console.log("Editbox (multiline="+a+", max_len="+t+": "+_e.frame_index+": setText()")
console.log("  Sel range = ["+l.selectionStart+","+l.selectionEnd+"]")
console.log("  Old text         = "+JSON.stringify(l.value))
console.log("  New text         = "+JSON.stringify(e))}l.value=e}this.text=e
this.last_set_text=e}
e.focus=function focus(){if(this.input){this.input.focus()
if(this.select_on_focus)this.input.select()
setActive(this)}else this.onetime_focus=true
f(this)
this.is_focused=true
if(this.pointer_lock&&c())_()}
e.unfocus=function unfocus(){me()}
e.isFocused=function isFocused(){return this.is_focused}
e.updateFocus=function updateFocus(e){var t=this.is_focused
var r=d(this)
var a=r.focused
var i=this.input&&document.activeElement===this.input
if(t!==a){if(a&&!i){v("GLOV focused, DOM not, focusing",this)
if(this.input){this.input.focus()
if(this.select_on_focus)this.input.select()}else this.onetime_focus=true}if(!a&&i){v("DOM focused, GLOV not, and changed, blurring",this)
this.input.blur()}}else if(i&&!a){v("DOM focused, GLOV not, stealing",this)
f(this)
if(this.input&&this.select_on_focus)this.input.select()
a=true}else if(!i&&a)if(e){this.onetime_focus=true
v("GLOV focused, DOM not, new edit box, focusing",this)}else if(document.activeElement===_e.canvas||document.activeElement===this.postspan){v("GLOV focused, DOM canvas focused, unfocusing",this)
me()}if(a){setActive(this)
var o=this.pointer_lock&&!this.text?{in_event_cb:l}:null
if((this.esc_clears||this.esc_unfocuses)&&s(ce.ESC,o))if(this.text&&this.esc_clears)this.setText("")
else{me()
if(this.input)this.input.blur()
a=false
this.canceled=true}}this.is_focused=a
return r}
e.run=function run(e){var t=this
this.applyParams(e)
var r=this.canvas_render,a=this.font_height,i=this.multiline,o=this.enforce_multiline,n=this.max_len
if(this.focus_steal){this.focus_steal=false
this.focus()}var s=false
if(!ne(this.last_frame!==_e.frame_index))return null
if(this.last_frame!==_e.frame_index-1){this.submitted=false
s=true}this.last_frame=_e.frame_index
this.canceled=false
var l=this.updateFocus(s),_=l.allow_focus,c=l.focused
if(c)pe(true,Boolean(i||this.suppress_up_down))
var u=this.text,d=this.x,f=this.y,v=this.z,h=this.w,p=this.h
var m={x:d,y:f,w:h,h:p}
if(_&&!le.clipTestRect(m))_=false
Ae.push(this)
var E=_&&Te(this.elem,true)
if(E!==this.elem){this.resetCSSCaching()
if(E){if(!Ie){Ie=true
var g=document.getElementById("dynform")
if(g)g.addEventListener("submit",formHook,true)}E.textContent=""
var T=document.createElement(i?"textarea":"input")
var y=[]
if(r)y.push("canvas_render")
if(i&&n)y.push("fixed")
if(this.center)y.push("center")
T.className=y.join(" ")
T.setAttribute("type","number"===this.type?"tel":this.type)
T.setAttribute("placeholder",he(this.placeholder))
if(n)if(i)T.setAttribute("cols",n)
else T.setAttribute("maxLength",n)
if(i)T.setAttribute("rows",i)
E.appendChild(T)
var S=document.createElement("span")
this.postspan=S
E.appendChild(S)
T.value=this.text
if(this.uppercase)T.style["text-transform"]="uppercase"
this.input=T
if(this.initial_focus||this.onetime_focus){T.focus()
setActive(this)
this.onetime_focus=false}if(this.initial_select)T.select()
if(i&&o||n){var I=function onChange(e){t.updateText()
return true}
T.addEventListener("keyup",I)
T.addEventListener("keydown",I)
T.addEventListener("change",I)}}else this.input=null
this.last_autocomplete=null
this.submitted=false
this.elem=E}else if(this.input){this.updateText()
this.last_set_text=this.text}if(E){var A=le.htmlPos(d,f)
if(!this.spellcheck)E.spellcheck=false
E.style.left=A[0]+"%"
E.style.top=A[1]+"%"
var w=le.htmlSize(h,p)
E.style.width=w[0]+"%"
E.style.height=w[1]+"%"
var L=""
if(m.x!==d||m.y!==f||m.w!==h||m.h!==p){var O=(m.x-d)/h*100+"%"
var R=(m.x+m.w-d)/h*100+"%"
var b=(m.y-f)/p*100+"%"
var N=(m.y+m.w-f)/p*100+"%"
L="polygon("+O+" "+b+", "+R+" "+b+", "+R+" "+N+", "+O+" "+N+")"}else L=""
if(L!==this.last_clip_path)E.style.clipPath=this.last_clip_path=L
var C=le.virtualToFontSize(a).toFixed(8)+"px"
if(C!==this.last_font_size){this.last_font_size=C
var x=le.virtualToFontSize(a)
var M=Math.floor(x)
var D=x/M
E.style.fontSize=M+"px"
var P="translate(-50%, -50%)\n                       scale("+D+")\n                       translate(50%, 50%)"
this.input.style.width=(1/D*100).toFixed(8)+"%"
E.style.transform=P}if(this.zindex)E.style["z-index"]=this.zindex
if(this.last_autocomplete!==this.autocomplete){this.last_autocomplete=this.autocomplete
this.input.setAttribute("autocomplete",this.autocomplete||"auto_off_"+Math.random())}var B=ye()
var k=ye()
if(B!==this.last_tab_index){this.last_tab_index=B
this.input.setAttribute("tabindex",B)
this.postspan.setAttribute("tabindex",k)}}else this.resetCSSCaching()
if(c){if(this.auto_unfocus)if(de({peek:true}))me()
if(fe(ce.ENTER))this.submitted=true
ue()}ve({x:d,y:f,w:h,h:p})
if(r){var U=this.center
var G=r.char_width,F=r.char_height,W=r.color_selection,H=r.color_caret,z=r.style_text
var V=Se()
var Y=u.split("\n")
var j=[]
for(var K=0;K<Y.length;++K){var q=Y[K]
var Z=V.draw({style:z,height:a,x:d,y:f+K*F,z:v+.8,w:h,text:q,align:U?V.ALIGN.HCENTER:void 0})
j.push(Z)}if(c){var X=this.getSelection()
if(!se(X[0],X[1])){var Q=X[0][1]
var $=X[1][1]
for(var J=Q;J<=$;++J){var ee=Y[J]
var te=J===Q?X[0][0]:0
var re=J===$?X[1][0]:ee.length
var ae=U?(h-j[J])/2:0
ge(d+G*te-1+ae,f+J*F,d+G*re+ae,f+(J+1)*F,v+.75,W)}}else{var ie=X[1][1]
var oe=d+G*X[1][0]-1
if(U)oe+=(h-j[ie])/2
Ee(oe,f+F*ie,oe,f+F*(ie+1)-1,v+.5,1,1,H)}}}if(this.submitted){this.submitted=false
return this.SUBMIT}if(this.canceled){this.canceled=false
return this.CANCEL}return null}
e.unrun=function unrun(){this.elem=null
this.input=null}
return GlovUIEditBox}()
I.prototype.SUBMIT="submit"
I.prototype.CANCEL="cancel"
function editBoxCreate(e){return new I(e)}function editBox(e,t){var r=p("edit_box",e,editBoxCreate)
return{result:r.run(e),text:r.getText(),edit_box:r}}},{"../common/util":400,"../common/verify":401,"../common/vmath":402,"./camera2d":295,"./engine":305,"./input":326,"./localization":330,"./spot":361,"./ui":367,assert:void 0}],304:[function(e,t,r){"use strict"
r.registerShader=registerShader
r.effectsPassAdd=effectsPassAdd
r.effectsPassConsume=effectsPassConsume
r.effectsLastFramebuffer=effectsLastFramebuffer
r.effectsQueue=effectsQueue
r.effectsTopOfFrame=effectsTopOfFrame
r.effectsReset=effectsReset
r.effectsIsFinal=effectsIsFinal
r.grayScaleMatrix=grayScaleMatrix
r.sepiaMatrix=sepiaMatrix
r.negativeMatrix=negativeMatrix
r.saturationMatrix=saturationMatrix
r.hueMatrix=hueMatrix
r.brightnessAddMatrix=brightnessAddMatrix
r.brightnessScaleMatrix=brightnessScaleMatrix
r.additiveMatrix=additiveMatrix
r.contrastMatrix=contrastMatrix
r.applyCopy=applyCopy
r.applyPixelyExpand=applyPixelyExpand
r.applyGaussianBlur=applyGaussianBlur
r.applyColorMatrix=applyColorMatrix
r.clearAlpha=clearAlpha
r.effectsStartup=effectsStartup
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var s=e("assert")
var c=e("./engine.js")
var u=c.renderWidth,d=c.renderHeight
var a=e("./framebuffer.js"),_=a.framebufferEnd,f=a.framebufferStart,i=a.framebufferTopOfFrame
var o=e("./geom.js")
var n=e("./shaders.js"),l=n.SEMANTIC,v=n.shaderCreate,h=n.shadersBind,p=n.shadersPrelink
var m=e("./sprites.js").spriteQueueFn
var E=e("./textures.js"),g=E.textureBindArray,T=E.textureWhite
var y=e("../common/vmath.js"),S=y.vec3,I=y.vec4,A=y.v4set
var w={vp_copy:{vp:"shaders/effects_copy.vp"},copy:{fp:"shaders/effects_copy.fp"},pixely_expand:{fp:"shaders/pixely_expand.fp"},gaussian_blur:{fp:"shaders/effects_gaussian_blur.fp"},color_matrix:{fp:"shaders/effects_color_matrix.fp"}}
function registerShader(e,t){w[e]=t}function getShader(e){var t=w[e]
if(!t.shader)if(t.fp)t.shader=v(t.fp)
else t.shader=v(t.vp)
return t.shader}var L=false
var O=I(2,2,-1,-1)
var R=I(1,1,0,0)
var b={clip_space:O,copy_uv_scale:R}
var N
var C
var x
var M
function startup(){L=true
M=o.create([[l.POSITION,gl.FLOAT,2,false]],new Float32Array([0,0,1,0,1,1,0,1]),null,o.QUADS)
N={clip_space:O,copy_uv_scale:R,colorMatrix:new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0])}
C={clip_space:O,copy_uv_scale:R,sampleRadius:S(1,1,1),Gauss:new Float32Array([.93,.8,.7,.6,.5,.4,.3,.2,.1])}
x={clip_space:O,copy_uv_scale:R,orig_pixel_size:I()}}var D=0
function effectsPassAdd(){++D}function effectsPassConsume(){s(D);--D}var P
function effectsLastFramebuffer(){return P}function doEffect(e){effectsPassConsume()
e()}function effectsQueue(e,t){effectsPassAdd()
m(e,doEffect.bind(null,t))}function effectsTopOfFrame(){D=0
i()}function effectsReset(){s.equal(D,0)}function effectsIsFinal(){return!D}function grayScaleMatrix(e){e[0]=.2126
e[1]=.2126
e[2]=.2126
e[3]=.7152
e[4]=.7152
e[5]=.7152
e[6]=.0722
e[7]=.0722
e[8]=.0722
e[9]=e[10]=e[11]=0}function sepiaMatrix(e){e[0]=.393
e[1]=.349
e[2]=.272
e[3]=.769
e[4]=.686
e[5]=.534
e[6]=.189
e[7]=.168
e[8]=.131
e[9]=e[10]=e[11]=0}function negativeMatrix(e){e[0]=e[4]=e[8]=-1
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=1}function saturationMatrix(e,t){var r=1-t
e[0]=.2126*r+t
e[1]=.2126*r
e[2]=.2126*r
e[3]=.7152*r
e[4]=.7152*r+t
e[5]=.7152*r
e[6]=.0722*r
e[7]=.0722*r
e[8]=.0722*r+t
e[9]=e[10]=e[11]=0}function hueMatrix(e,t){var r=Math.cos(t)
var a=Math.sin(t)
e[0]=.7874*r+-.3712362230889293*a+.2126
e[1]=-.2126*r+.20611404610069642*a+.2126
e[2]=-.2126*r+-.9485864922785551*a+.2126
e[3]=-.7152*r+-.4962902913954023*a+.7152
e[4]=.2848*r+.08105997779422341*a+.7152
e[5]=-.7152*r+.6584102469838492*a+.7152
e[6]=-.0722*r+.8675265144843316*a+.0722
e[7]=-.0722*r+-.28717402389491986*a+.0722
e[8]=.9278*r+.290176245294706*a+.0722
e[9]=e[10]=e[11]=0}function brightnessAddMatrix(e,t){e[0]=e[4]=e[8]=1
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=t}function brightnessScaleMatrix(e,t){e[0]=e[4]=e[8]=t
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=0}function additiveMatrix(e,t){e[0]=e[4]=e[8]=1
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=t[0]
e[10]=t[1]
e[11]=t[2]}function contrastMatrix(e,t){e[0]=e[4]=e[8]=t
e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0
e[9]=e[10]=e[11]=.5*(1-t)}function applyEffect(e,t,r){var a=false!==e.final&&effectsIsFinal()||e.final
if(e.no_framebuffer){var i=c.viewport
var o=i[2]
var n=i[3]
r=r||n
O[0]=2*(t=t||o)/o
O[1]=2*r/n}else if(e.viewport){var s=e.viewport
var l=s[2]
var _=s[3]
r=r||_
O[0]=2*(t=t||l)/l
O[1]=2*r/_
f({clear:e.clear,clear_all:e.clear_all,clear_color:e.clear_color,viewport:s,final:a,need_depth:e.need_depth_begin})}else{O[0]=2
O[1]=2
t=t||u()
r=r||d()
f({width:t,height:r,final:a,need_depth:e.need_depth_begin})}h(getShader("vp_copy"),getShader(e.shader),e.params)
g(e.texs)
M.draw()}function applyCopy(e){if(!L)startup()
var t=e.source
if(!t){t=_({filter_linear:e.filter_linear,need_depth:e.need_depth})
P=t}e.shader=e.shader||"copy"
e.params=e.params?_extends({},b,e.params):b
if(Array.isArray(t))e.texs=t
else e.texs=[t]
applyEffect(e)}function applyPixelyExpand(e){if(!L)startup()
var t=e.source
s(!t)
if(!t){t=_({filter_linear:true})
P=t}var r=t.width
var a=t.height
var i=(e.hblur||.25)/r
C.sampleRadius[0]=i
C.sampleRadius[1]=0
C.sampleRadius[2]=1
applyEffect({shader:"gaussian_blur",params:C,texs:[t],final:false},r,a)
var o=_({filter_linear:true})
i=(e.vblur||.75)/a
C.sampleRadius[0]=0
C.sampleRadius[1]=i
C.sampleRadius[2]=1
applyEffect({shader:"gaussian_blur",params:C,texs:[o],final:false},r,a)
var n=_({filter_linear:true})
A(x.orig_pixel_size,t.width,t.height,1/t.width,1/t.height)
applyEffect({shader:"pixely_expand",params:x,texs:[t,o,n],clear:e.clear,clear_all:e.clear_all,clear_color:e.clear_color,viewport:e.viewport})}function applyGaussianBlur(e){if(!L)startup()
var t=_({filter_linear:true})
P=t
var r=e.max_size||512
var a=e.min_size||128
var i=t
var o=c.viewport
var n=r
while(n>o[2]||n>o[3])n/=2
while(n>a){applyEffect({shader:e.shader_copy||"copy",params:b,texs:[i],final:false},n,n)
i=_({filter_linear:true})
n/=2}var s=(e.blur||1)/n
C.sampleRadius[0]=s
C.sampleRadius[1]=0
C.sampleRadius[2]=e.glow||1
applyEffect({shader:"gaussian_blur",params:C,texs:[i],final:false},n,n)
var l=_({filter_linear:true})
C.sampleRadius[0]=0
C.sampleRadius[1]=s
C.sampleRadius[2]=e.glow||1
applyEffect({shader:"gaussian_blur",params:C,texs:[l]})
return true}function applyColorMatrix(e){if(!L)startup()
var t=_({filter_linear:true})
P=t
var r=e.colorMatrix
var a=N.colorMatrix
a[0]=r[0]
a[1]=r[3]
a[2]=r[6]
a[3]=r[9]
a[4]=r[1]
a[5]=r[4]
a[6]=r[7]
a[7]=r[10]
a[8]=r[2]
a[9]=r[5]
a[10]=r[8]
a[11]=r[11]
applyEffect({shader:"color_matrix",params:N,texs:[t]})
return true}function clearAlpha(){var e=gl.getParameter(gl.DEPTH_TEST)
if(e)gl.disable(gl.DEPTH_TEST)
gl.colorMask(false,false,false,true)
applyCopy({source:T(),no_framebuffer:true})
gl.colorMask(true,true,true,true)
if(e)gl.enable(gl.DEPTH_TEST)}function effectsStartup(e){e.forEach(function(e){p(getShader("vp_copy"),getShader(e))})}},{"../common/vmath.js":402,"./engine.js":305,"./framebuffer.js":316,"./geom.js":318,"./shaders.js":353,"./sprites.js":363,"./textures.js":365,assert:void 0}],305:[function(d,e,E){"use strict"
E.renderNeeded=renderNeeded
E.disableRender=disableRender
E.addViewSpaceGlobal=addViewSpaceGlobal
E.setGlobalMatrices=setGlobalMatrices
E.setMatVP=setMatVP
E.setFOV=setFOV
E.setGameDims=setGameDims
E.postprocessingAllow=postprocessingAllow
E.glCheckError=glCheckError
E.releaseCanvas=releaseCanvas
E.engineSetReloadFunc=engineSetReloadFunc
E.reloadSafe=reloadSafe
E.defineCausesReload=defineCausesReload
E.defineOnChange=defineOnChange
E.definesChanged=definesChanged
E.definesClearAll=definesClearAll
E.updateMatrices=updateMatrices
E.getFrameTimestamp=getFrameTimestamp
E.getFrameIndex=getFrameIndex
E.getFrameDt=getFrameDt
E.getFrameDtActual=getFrameDtActual
E.setState=setState
E.stateActive=stateActive
E.resizing=resizing
E.addTickFunc=addTickFunc
E.removeTickFunc=removeTickFunc
E.postTick=postTick
E.preSpriteRender=preSpriteRender
E.postRender=postRender
E.renderWidth=renderWidth
E.renderHeight=renderHeight
E.setViewport=setViewport
E.clearHad3DThisFrame=clearHad3DThisFrame
E.needDepthIn2D=needDepthIn2D
E.setupProjection=setupProjection
E.setProjection=setProjection
E.setZRange=setZRange
E.start3DRendering=start3DRendering
E.startSpriteRendering=startSpriteRendering
E.projectionZBias=projectionZBias
E.fixNatives=fixNatives
E.isInBackground=isInBackground
E.isInBackgroundOrBlurred=isInBackgroundOrBlurred
E.onEnterBackground=onEnterBackground
E.onExitBackground=onExitBackground
E.dirtyRenderSet=dirtyRenderSet
E.setPixelyStrict=setPixelyStrict
E.getViewportPostprocess=getViewportPostprocess
E.setViewportPostprocess=setViewportPostprocess
E.setFonts=setFonts
E.engineStartupFunc=engineStartupFunc
E.startup=startup
E.loadPendingDelta=loadPendingDelta
E.loadsPending=loadsPending
E.onLoadMetrics=onLoadMetrics
E.hrnow=E.had_3d_this_frame=E.viewport=E.perf_state=E.PERF_HISTORY_SIZE=E.is_loading=E.hrtime=E.frame_dt=E.frame_index=E.frame_timestamp=E.postprocessing=E.border_clear_color=E.border_color=E.app_state=E.font=E.light_dir_ws=E.light_ambient=E.light_diffuse=E.mat_vp=E.mat_view=E.mat_projection=E.fov_x=E.fov_y=E.ZNEAR=E.ZFAR=E.defines=E.render_height=E.render_width=E.game_height=E.game_width=E.antialias_unavailable=E.antialias=E.dom_to_canvas_ratio=E.render_pixel_perfect=E.pixel_aspect=E.height=E.width=E.glov_particles=E.webgl2=E.canvas=E.DEBUG=void 0
d("./bootstrap.js")
var f=d("./client_config.js").MODE_DEVELOPMENT
E.DEBUG=f
var v=[]
var h=(E.require=d)("assert")
var l=d("./browser.js").is_ios_safari
var p=d("./build_ui.js").buildUIStartup
var g=d("./camera2d.js")
var _=d("./cmds.js")
d("./engine_cmds.js")
var m=d("../common/data_error.js").dataErrorQueueEnable
var T=d("./effects.js")
var t=T.effectsReset,y=T.effectsTopOfFrame,S=T.effectsIsFinal,I=T.effectsPassAdd,A=T.effectsPassConsume
var r=d("./error_report.js"),a=r.errorReportDisable,w=r.errorReportSetTimeAccum,o=r.errorReportSetDetails,L=r.glovErrorReportDisableSubmit,O=r.glovErrorReportSetCrashCB
var R=d("./font.js")
var b=R.fontTick
var i=d("./framebuffer.js"),N=i.framebufferStart,n=i.framebufferEndOfFrame
var s=d("./geom.js"),c=s.geomResetState,C=s.geomStartup
var x=d("./input.js")
var u=d("./input.js").inputAllowAllEvents
var M=d("./local_storage.js")
var D=d("gl-mat3/fromMat4")
var P=d("gl-mat4/copy")
var B=d("gl-mat4/invert")
var k=d("gl-mat4/multiply")
var U=d("gl-mat4/transpose")
var G=d("gl-mat4/perspective")
var F=Math.asin,W=Math.cos,H=Math.floor,z=Math.min,V=Math.max,Y=Math.PI,j=Math.round,K=Math.sin,q=Math.sqrt
var X=d("./models.js"),Q=X.modelLoadCount,$=X.modelStartup
var J=d("./perf.js")
var ee=d("./profiler.js"),te=ee.profilerFrameStart,re=ee.profilerGarbageEstimate
var ae=d("./profiler_ui.js").profilerUIStartup
var ie=d("../common/perfcounters.js").perfCounterTick
var oe=d("./settings.js")
var ne=d("./shaders.js")
var se=d("./shaders.js"),le=se.shadersAddGlobal,_e=se.shadersHandleDefinesChanged,ce=se.shadersStartup,ue=se.shadersResetState
var de=d("./shader_debug_ui.js").shaderDebugUIStartup
var fe=d("./sound.js"),ve=fe.soundLoading,he=fe.soundStartup,pe=fe.soundTick
var me=d("./spot.js").spotEndInput
var Ee=d("./sprites.js"),ge=Ee.blendModeReset,Te=Ee.spriteDraw,ye=Ee.spriteDrawReset,Se=Ee.spriteStartup,Ie=Ee.spriteResetTopOfFrame
var Ae=d("./textures.js"),we=Ae.textureBind,Le=Ae.textureDefaultFilters,Oe=Ae.textureError,Re=Ae.textureLoadCount,be=Ae.textureResetState,Ne=Ae.textureStartup,Ce=Ae.textureTick
var xe=d("./transition.js")
var Me=d("./ui.js"),De=Me.drawRect,Pe=Me.internal,Be=Pe.cleanupDOMElems,ke=Pe.uiEndFrame,Ue=Pe.uiSetFonts,Ge=Pe.uiStartup,Fe=Pe.uiTick,We=Me.uiBindSounds
var He=d("./urlhash.js")
var ze=d("../common/util.js"),Ve=ze.callEach,Ye=ze.clamp,je=ze.nearSame,Ke=ze.ridx
var qe=d("../common/verify.js")
var Ze=d("../common/vmath.js"),Xe=Ze.mat3,Qe=Ze.mat4,$e=Ze.mat4isFinite,Je=Ze.vec3,et=Ze.vec4,tt=Ze.v3mulMat4,rt=Ze.v3iNormalize,at=Ze.v4copy,it=Ze.v4same,ot=Ze.v4set
var nt=d("./webfs.js").webFSStartup
var st=d("./words/profanity.js").profanityStartupLate
var lt
E.canvas=lt
var _t
E.webgl2=_t
var ct
E.glov_particles=ct
var ut
E.width=ut
var dt
E.height=dt
var ft
var vt
var ht=1
E.pixel_aspect=ht
var pt=0
E.render_pixel_perfect=pt
var mt=window.devicePixelRatio||1
E.dom_to_canvas_ratio=mt
var Et
E.antialias=Et
var gt
E.antialias_unavailable=gt
var Tt
E.game_width=Tt
var yt
E.game_height=yt
var St
var It
E.render_width=It
var At
E.render_height=At
var wt=He.register({key:"D",type:He.TYPE_SET,change:definesChanged})
E.defines=wt
He.register({key:"nocoop"})
var Lt
E.ZFAR=Lt
var Ot
E.ZNEAR=Ot
var Rt=1
E.fov_y=Rt
var bt=1
E.fov_x=bt
var Nt=Qe()
E.mat_projection=Nt
var Ct=Qe()
E.mat_view=Ct
var xt=Qe()
var Mt=Qe()
E.mat_vp=Mt
var Dt=Qe()
var Pt=Qe()
var Bt=Qe()
var kt=Xe()
var Ut=Xe()
var Gt=Je(.75,.75,.75)
E.light_diffuse=Gt
var Ft=Je(.25,.25,.25)
E.light_ambient=Ft
var Wt=Je(-1,-2,-3)
E.light_dir_ws=Wt
var Ht
E.font=Ht
var zt=null
E.app_state=zt
var Vt=et(0,0,0,1)
E.border_color=Vt
var Yt=et(0,0,0,1)
E.border_clear_color=Yt
var jt=false
var Kt=false
var qt=3
function renderNeeded(e){qt=V(qt,e||3)}function disableRender(e){u(jt=e)
if(jt)Be()}var Zt=[]
function addViewSpaceGlobal(e){var t=e+"_ws"
var r=ne.globals[t]
h(r)
h.equal(r.length,3)
var a=e+"_vs"
var i=Je()
le(a,i)
Zt.push({vs:i,ws:r})}var Xt=Qe()
function setGlobalMatrices(e){h($e(e))
P(Ct,e)
k(Mt,Nt,Ct)
rt(Wt)
for(var t=0;t<Zt.length;++t){var r=Zt[t]
tt(r.vs,r.ws,Ct)}B(Xt,Ct)
D(Ut,Xt)}function setMatVP(e){h($e(e))
setupProjection(Rt,ft,vt,Ot,Lt)
P(Ct,e)
k(Mt,Nt,Ct)}function setFOV(e){var t=ft/vt
if(t>St){E.fov_y=Rt=e
var r=K(Rt/2)/W(Rt/2)*t
E.fov_x=bt=2*F(r/q(r*r+1))}else{var a=K(e/2)/W(e/2)*St
E.fov_x=bt=2*F(a/q(a*a+1))
var i=K(bt/2)/W(bt/2)/t
E.fov_y=Rt=2*F(i/q(i*i+1))}}function setGameDims(e,t){E.game_width=Tt=e
E.game_height=yt=t
St=Tt/yt}var Qt="5"
var $t=M.get("glov_no_postprocessing")!==Qt
E.postprocessing=$t
function postprocessingAllow(e){M.set("glov_no_postprocessing",e?void 0:Qt)
E.postprocessing=$t=e}function glCheckError(){var e=gl.getError()
if(e){console.error(e)
throw new Error(e)}}function releaseCanvas(){try{if(gl){var e=gl.getExtension("WEBGL_lose_context")
if(e)e.loseContext()}}catch(e){}}function reloadDefault(){document.location.reload()}var Jt=reloadDefault
function engineSetReloadFunc(e){Jt=e}function reloadSafe(){a()
releaseCanvas()
Jt()}window.reloadSafe=reloadSafe
var er={}
function defineCausesReload(e){er[e]=wt[e]}defineCausesReload("FORCEWEBGL2")
defineCausesReload("NOWEBGL2")
var tr={}
function defineOnChange(e,t){(tr[e]=tr[e]||{value:wt[e],cbs:[]}).cbs.push(t)}function definesChanged(){for(var e in er)if(wt[e]!==er[e]){He.onURLChange(reloadSafe)
break}for(var t in tr){var r=tr[t]
if(wt[t]!==r.value){Ve(r.cbs)
r.value=wt[t]}}_e()}function definesClearAll(){var e=false
for(var t in wt){wt[t]=false
e=true}if(e)definesChanged()
return e}function normalizeRow(e,t){var r=e[t]*e[t]+e[t+1]*e[t+1]+e[t+2]*e[t+2]
if(r>0){r=1/q(r)
e[t]*=r
e[t+1]*=r
e[t+2]*=r}}function updateMatrices(e){P(xt,e)
k(Dt,Ct,e)
k(Bt,Nt,Dt)
P(Xt,e)
normalizeRow(Xt,0)
normalizeRow(Xt,4)
normalizeRow(Xt,8)
k(Pt,Ct,Xt)
B(Xt,Pt)
U(Xt,Xt)
D(kt,Xt)}var rr=0
E.frame_timestamp=rr
function getFrameTimestamp(){return rr}var ar=0
E.frame_index=ar
function getFrameIndex(){return ar}var ir=0
E.frame_dt=ir
function getFrameDt(){return ir}var or=0
E.hrtime=or
var nr=0
function getFrameDtActual(){return nr}var sr=null
var lr=true
E.is_loading=lr
function setState(e){if(lr)sr=e
else E.app_state=zt=e
renderNeeded()}function stateActive(e){if(lr)return sr===e
else return zt===e}var _r=1e3
var cr=0
var ur=0
var dr=0
var fr=1e3
var vr=0
var hr=0
var pr=128
E.PERF_HISTORY_SIZE=pr
var mr=window.glov_perf_state={fpsgraph:{index:0,history:new Float32Array(2*pr)},gpu_mem:{tex:0,geom:0}}
var Er=(E.perf_state=mr).fpsgraph
J.addMetric({name:"fps",show_stat:"show_fps",show_graph:"fps_graph",labels:{"fps: ":function fps(){return(1e3/_r).toFixed(1)},"ms/f: ":function msF(){return _r.toFixed(0)},"cpu: ":function cpu(){return fr.toFixed(0)},"gc/f: ":function gcF(){return hr?hr.toFixed(1):""}},data:Er,line_scale_top:50,colors:[et(1,.925,.153,1),et(0,.894,.212,1)]},true)
var gr=true
var Tr=false
var yr=0
function resizing(){return yr}var Sr=[]
function addTickFunc(e){Sr.push(e)}function removeTickFunc(e){var t=Sr.indexOf(e)
if(-1!==t){Sr.splice(t,1)
return true}return false}var Ir=[]
function postTick(e){e.ticks=e.ticks||1
e.inactive=e.inactive||false
h.equal(typeof e.fn,"function")
Ir.push(e)}var Ar=null
function preSpriteRender(e){if(!Ar)Ar=[]
Ar.push(e)}var wr=null
function postRender(e){if(!wr)wr=[]
wr.push(e)}function resetEffects(){t()
n()}function renderWidth(){return It||ut}function renderHeight(){return At||dt}var Lr=function(){var e=window.screen
if(!l||!e)return 0
return{"896,414":896/414,"812,375":812/375,"736,414":736/414,"716,414":736/414,"667,375":667/375,"647,375":667/375,"548,320":1.775}[V(e.availWidth,e.availHeight)+","+z(e.availWidth,e.availHeight)]||0}()
function safariTopSafeArea(e,t){if(Lr&&je(e/t,Lr,.001))return 50*(window.devicePixelRatio||1)
return 0}var Or
var Rr
var br
var Nr
var Cr=false
var xr=[0,0,0,0]
var Mr=[0,0,0,0]
function checkResize(){profilerStart("checkResize")
var e=window.visualViewport||{}
E.dom_to_canvas_ratio=mt=window.devicePixelRatio||1
E.dom_to_canvas_ratio=mt*=oe.render_scale_all
var t=e.width||window.innerWidth
var r=e.height||window.innerHeight
if(r!==br){br=r
if(document.body)document.body.style.height=r+"px"}var a=lt.getBoundingClientRect()
var i=j(a.width*mt)||1
var o=j(a.height*mt)||1
if(-1===_.safearea[0]){if(Nr){var n=Nr.offsetWidth
var s=Nr.offsetHeight
if(n&&s)ot(xr,Nr.offsetLeft*mt,i-(n+Nr.offsetLeft)*mt,V(Nr.offsetTop*mt,safariTopSafeArea(t,r)*oe.render_scale_all),Cr?0:o-(s+Nr.offsetTop)*mt)}}else ot(xr,i*Ye(_.safearea[0],0,25)/100,i*Ye(_.safearea[1],0,25)/100,o*Ye(_.safearea[2],0,25)/100,o*Ye(_.safearea[3],0,25)/100)
if(!it(xr,Mr)){at(Mr,xr)
g.setSafeAreaPadding(xr[0],xr[1],xr[2],xr[3])
yr=V(yr,1)}if(i!==Or||o!==Rr){window.pixel_scale=mt
Or=lt.width=i||1
Rr=lt.height=o||1
E.width=ut=lt.width
E.height=dt=lt.height
yr=10
renderNeeded()}if(l&&(window.visualViewport||yr))window.scroll(0,0)
profilerStop("checkResize")}var Dr=et(0,0,1,1)
E.viewport=Dr
function setViewport(e){at(Dr,e)
gl.viewport(e[0],e[1],e[2],e[3])}var Pr=1e4
var Br=0
function requestFrame(e){var t=oe.max_fps
var r=t>=250?10:1
if(Br>=r)return
if(wt.SLOWLOAD&&lr)t=2
if(r>1)while(Br<r){setTimeout(tick,1)
Br++}else if(t&&t>oe.use_animation_frame){var a=z(Pr,V(0,j(1e3/t-(e||0))))
Br++
setTimeout(tick,a)}else{Br++
requestAnimationFrame(tick)}}var kr
var Ur
E.had_3d_this_frame=Ur
var Gr
function clearHad3DThisFrame(){E.had_3d_this_frame=Ur=false}function needDepthIn2D(){Gr=true}function setupProjection(e,t,r,a,i){G(Nt,e,t/r,a,i)
kr=Nt[10]}function setProjection(e){P(Nt,e)
kr=Nt[10]}function setZRange(e,t){E.ZNEAR=Ot=e
E.ZFAR=Lt=t
if(Ur)setupProjection(Rt,ft,vt,Ot,Lt)}function set3DRenderResolution(e,t){ft=e
vt=t}var Fr
var Wr
function start3DRendering(e){if((e=e||{}).width)set3DRenderResolution(e.width,e.height)
setFOV(e.fov||oe.fov*Y/180)
E.had_3d_this_frame=Ur=true
Gr=false
if(!e.width&&Fr&&!wt.NOCOPY){Wr=true
I()}ge(true)
gl.enable(gl.BLEND)
gl.enable(gl.DEPTH_TEST)
gl.depthMask(true)
var t=ft
var r=vt
if(e.viewport){t=It||ut
r=At||dt}N({width:t,height:r,final:S(),need_depth:e.need_depth||true,clear:true,clear_all:void 0===e.clear_all?oe.render_scale_clear:e.clear_all,viewport:e.viewport})
setupProjection(Rt,ft,vt,Ot,Lt)
gl.enable(gl.CULL_FACE)}function renderScaleFinish(){if(wt.NOCOPY){gl.disable(gl.SCISSOR_TEST)
ot(Dr,0,0,ut,dt)
gl.viewport(Dr[0],Dr[1],Dr[2],Dr[3])}else{A()
if(2===oe.render_scale_mode)T.applyPixelyExpand({final:S(),clear:false})
else T.applyCopy({filter_linear:0===oe.render_scale_mode})}}function startSpriteRendering(){gl.disable(gl.CULL_FACE)
ge(true)
gl.enable(gl.BLEND)
gl.disable(gl.DEPTH_TEST)
gl.depthMask(false)
ye()}function projectionZBias(e,t){if(!e){Nt[10]=kr
return}var r=e/(t*(t+e))*.2
r=V(r,2e-7)
Nt[10]=kr+r}function fixNatives(e){var t=[]
for(var r in t){console[e?"log":"error"]('Found invasive enumerable property "'+r+'" on Array.prototype, removing...')
var a=t[r]
o("had_native_"+r,typeof a)
delete Array.prototype[r]
Object.defineProperty(Array.prototype,r,{value:a,enumerable:false})}for(var i in t)h(false,"Array.prototype has unremovable member "+i)}function resetState(){profilerStart("resetState")
profilerStart("textures")
be()
profilerStopStart("shaders")
ue()
profilerStopStart("geom;gl")
c()
ge(true)
gl.enable(gl.BLEND)
gl.enable(gl.DEPTH_TEST)
gl.depthMask(true)
gl.enable(gl.CULL_FACE)
gl.depthFunc(gl.LEQUAL)
gl.disable(gl.SCISSOR_TEST)
gl.cullFace(gl.BACK)
gl.viewport(0,0,ut,dt)
profilerStop()
profilerStop("resetState")}var Hr=false
var zr=false
var Vr=[]
var Yr=[]
function isInBackground(){return zr}function isInBackgroundOrBlurred(){return zr||Hr}function onEnterBackground(e){Vr.push(e)}function onExitBackground(e){Yr.push(e)}function dirtyRenderSet(e){Kt=e}var jr=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date)
E.hrnow=jr
var Kr=0
var qr=0
var Zr=0
function tick(e){te()
profilerStart("tick")
profilerStart("top")
Br--
if(qt)--qt
if(Kt&&!qt){resetEffects()
x.tickInputInactive()
dr=0
for(var t=Ir.length-1;t>=0;--t)if(Ir[t].inactive&&!--Ir[t].ticks){Ir[t].fn()
Ke(Ir,t)}requestFrame()
profilerStop()
return profilerStop("tick")}E.hrtime=or=jr()
var r=or-qr
qr=or
var a=oe.max_fps
if(a&&a<=oe.use_animation_frame){if((Zr-=r)>0){requestFrame()
profilerStop("top")
return profilerStop("tick")}var i=z(Pr,1e3/a-.1)
if((Zr+=i)<0)Zr=0}var o=j(or)
if(!Kr)Kr=o
var n=z(V(nr=o-Kr,1),250)
E.frame_dt=ir=n
Kr=o
E.frame_timestamp=rr+=n
w(rr)
fixNatives(false)
Er.history[Er.index%pr*2+1]=nr
Er.index++
Er.history[Er.index%pr*2+0]=0;++ur
vr+=dr
if(o-cr>1e3*oe.fps_window)if(!cr)cr=o
else{_r=(o-cr)/ur
fr=vr/ur
vr=0
hr=re()/1024
ur=0
cr=o}ie(n)
y()
if(document.hidden||document.webkitHidden||jt){resetEffects()
x.tickInputInactive()
dr=0
for(var s=Ir.length-1;s>=0;--s)if(Ir[s].inactive&&!--Ir[s].ticks){Ir[s].fn()
Ke(Ir,s)}requestFrame()
profilerStop()
return profilerStop("tick")}E.frame_index=ar+=1
if(zr){zr=false
Ve(Yr)}checkResize()
E.had_3d_this_frame=Ur=false
Wr=Fr=Gr=false
if(It){set3DRenderResolution(It,At)
I()}else{ft=V(1,j(ut*oe.render_scale))
vt=V(1,j(dt*oe.render_scale))
if(ft!==ut)Fr=true}resetState()
Ie()
we(0,Oe())
b()
g.tickCamera2D()
xe.render(n)
g.setAspectFixed(Tt,yt)
profilerStopStart("mid")
pe(n)
x.tickInput()
Fe(n)
if(yr){--yr
var l=[]
g.virtualToDom(l,[0,0])
var _=[]
g.virtualToDom(_,[Tt-1,yt-1])
var c=[l[0],l[1],_[0],_[1]]
var u=c[3]-c[1]
var d=z(256,V(2,H(u/800*16)))
var f=document.getElementById("fullscreen")
if(f)f.style["font-size"]=d+"px"}if(gr){De(g.x0Real(),g.y0Real(),g.x1Real(),0,Z.BORDERS,Vt)
De(g.x0Real(),yt,g.x1Real(),g.y1Real(),Z.BORDERS,Vt)
De(g.x0Real(),0,0,yt,Z.BORDERS,Vt)
De(Tt,0,g.x1Real(),yt,Z.BORDERS,Vt)}J.draw()
profilerStopStart("app_state")
for(var v=0;v<Sr.length;++v)Sr[v](n)
if(zt)zt(n)
profilerStopStart("bottom")
me()
ct.tick(n)
if(Ur){if(Wr)renderScaleFinish()}else if(It)N({width:It,height:At,clear:true,clear_all:oe.render_scale_clear,final:S(),need_depth:Gr})
else N({width:ut,height:dt,clear:true,final:S(),need_depth:Gr})
if(Ar)Ve(Ar,Ar=null)
startSpriteRendering()
Te()
ke()
if(wr)Ve(wr,wr=null)
if(It){A()
var h=[g.render_offset_x,g.render_offset_y_bottom,g.render_viewport_w,g.render_viewport_h]
var p={clear:true,clear_all:true,clear_color:Yt,viewport:h}
if(Tr)T.applyPixelyExpand(p)
else T.applyCopy(p)}x.endFrame()
resetEffects()
Ce()
for(var m=Ir.length-1;m>=0;--m)if(!--Ir[m].ticks){Ir[m].fn()
Ke(Ir,m)}dr=jr()-o
Er.history[Er.index%pr*2+0]=dr
requestFrame(jr()-or)
profilerStop("bottom")
return profilerStop("tick")}function onBlur(e){Hr=true}function onFocus(e){Hr=false}function periodiclyRequestFrame(){requestFrame()
setTimeout(periodiclyRequestFrame,1e3)
if(!zr&&Hr)if(j(jr())-Kr>400){zr=true
Ve(Vr)}}function setPixelyStrict(e){if(e){E.render_width=It=Tt
E.render_height=At=yt}else{E.render_width=It=void 0
E.render_height=At=void 0}}function getViewportPostprocess(){return Tr}function setViewportPostprocess(e){Tr=e}function setFonts(e,t){E.font=Ht=e
Ue(e,t)}function engineStartupFunc(e){if(v)v.push(e)
else e()}function startup(e){fixNatives(true)
h(window.glov_webfs,"Failed to load fsdata.js")
nt(window.glov_webfs,He.getURLBase())
E.canvas=lt=document.getElementById("canvas")
Nr=document.getElementById("safearea")
if(false===e.error_report)L()
if(f)m(true)
if(f&&!window.spector)Object.defineProperty(Number.prototype,"length",{get:function get(){h(false,"Numbers do not have a length property")
return}})
Cr=e.safearea_ignore_bottom||false
window.addEventListener("resize",checkResize,false)
checkResize()
var t=e.pixely&&"off"!==e.pixely
E.antialias=Et=e.antialias||!t&&false!==e.antialias
var r=e.high?"high-performance":"default"
var a=["webgl2","webgl","experimental-webgl"]
var i=wt.NOWEBGL2
var o=M.getJSON("webgl2_disable")
if(o&&o.ua===navigator.userAgent&&o.ts>Date.now()-6048e5){console.log("Disabling WebGL2 because a previous run encountered a related error")
i=true}if(f&&!wt.FORCEWEBGL2){var n=M.getJSON("run_count",0)+1
M.setJSON("run_count",n)
if(n%2)i=true}if(i)a.splice(0,1)
var s=[{antialias:Et,powerPreference:r,alpha:false},{powerPreference:r,alpha:false},{antialias:Et,alpha:false},{alpha:false},{}]
var l=false
E.webgl2=_t=false
for(var _=0;!l&&_<a.length;_+=1)for(var c=0;!l&&c<s.length;++c)try{window.gl=lt.getContext(a[_],s[c])
if(window.gl){if("webgl2"===a[_])E.webgl2=_t=true
if(Et&&!s[c].antialias){E.antialias_unavailable=gt=true
E.antialias=Et=false}l=true
break}}catch(e){}if(!window.requestAnimationFrame)l=false
if(l)if(!ce({light_diffuse:Gt,light_dir_ws:Wt,ambient:Ft,mat_m:xt,mat_mv:Dt,mat_vp:Mt,mvp:Bt,mv_inv_trans:kt,mat_inv_view:Ut,view:Ct,projection:Nt}))l=false
if(!l){window.alert((window.gl?"Error initializing WebGL.\n":"Error initializing WebGL: your browser does not support WebGL or does not have it enabled.\n")+"Try completely closing and re-opening the app or browser.  If the problem persists, try restarting your device.")
document.getElementById("loading").style.visibility="hidden"
document.getElementById("nowebgl").style.visibility="visible"
return false}O(function(){setTimeout(requestFrame,1)})
var u=document.getElementById("nocanvas")
if(qe(u))u.style.visibility="hidden"
console.log("Using WebGL"+(_t?2:1))
h(gl)
lt.focus()
setGameDims(e.game_width||1280,e.game_height||960)
E.ZNEAR=Ot=e.znear||.7
E.ZFAR=Lt=e.zfar||1e4
setPixelyStrict("strict"===e.pixely)
if(e.viewport_postprocess)Tr=true
E.pixel_aspect=ht=e.pixel_aspect||1
E.render_pixel_perfect=pt=e.pixel_perfect||0
gl.depthFunc(gl.LEQUAL)
gl.cullFace(gl.BACK)
gl.clearColor(0,.1,.2,1)
gl.pixelStorei(gl.UNPACK_ALIGNMENT,1)
Ne()
C()
addViewSpaceGlobal("light_dir")
g.startup()
Se()
x.startup(lt,e)
$()
window.addEventListener("blur",onBlur,false)
window.addEventListener("focus",onFocus,false)
E.glov_particles=ct=d("./particles.js").create()
if(t){Le(gl.NEAREST,gl.NEAREST)
oe.runTimeDefault("render_scale_mode",1)}else Le(gl.LINEAR_MIPMAP_LINEAR,gl.LINEAR)
h(e.font)
e.font=E.font=Ht=R.create(e.font.info,e.font.texture)
if(e.title_font)e.title_font=R.create(e.title_font.info,e.title_font.texture)
Ge(e)
he(e.sound)
We(e.ui_sounds)
p()
de()
ae()
Ve(v,v=null)
g.setAspectFixed(Tt,yt)
if(e.state)setState(e.state)
if(void 0!==e.do_borders)gr=e.do_borders
if(void 0!==e.show_fps)oe.show_fps=e.show_fps
Kt=Boolean(e.dirty_render)
periodiclyRequestFrame()
return true}var Xr=0
function loadPendingDelta(e){Xr+=e}function loadsPending(){return Re()+ve()+Q()+Xr}var Qr=[]
function onLoadMetrics(e){Qr.push(e)}onLoadMetrics(function(e){console.log(["Load time summary","  "+e.time_js_load+"ms JS load","  "+e.time_js_init+"ms JS init","  "+e.time_resource_load+"ms resource load",e.time_total+"ms total"].join("\n"))})
function loadingFinished(){var e=Date.now()
var t=window.time_load_onload-window.time_load_start
var r=window.time_load_init-window.time_load_onload
var a=e-window.time_load_init
var i=e-window.time_load_start
Ve(Qr,null,{time_js_load:t,time_js_init:r,time_resource_load:a,time_total:i})
st()}function loading(){var e=loadsPending()
var t=document.getElementById("loading_text")
if(t)t.innerText="Loading ("+e+")..."
renderNeeded()
if(!e){E.is_loading=lr=false
E.app_state=zt=sr
postTick({ticks:2,fn:function fn(){loadingFinished()
renderNeeded()
var e=document.getElementById("loading")
if(e)e.style.visibility="hidden"}})}}E.app_state=zt=loading
window.glov_engine=E},{"../common/data_error.js":381,"../common/perfcounters.js":393,"../common/util.js":400,"../common/verify.js":401,"../common/vmath.js":402,"./bootstrap.js":292,"./browser.js":293,"./build_ui.js":294,"./camera2d.js":295,"./client_config.js":297,"./cmds.js":298,"./effects.js":304,"./engine_cmds.js":306,"./error_report.js":311,"./font.js":315,"./framebuffer.js":316,"./geom.js":318,"./input.js":326,"./local_storage.js":329,"./models.js":337,"./particles.js":339,"./perf.js":340,"./profiler.js":344,"./profiler_ui.js":345,"./settings.js":351,"./shader_debug_ui.js":352,"./shaders.js":353,"./sound.js":358,"./spot.js":361,"./sprites.js":363,"./textures.js":365,"./transition.js":366,"./ui.js":367,"./urlhash.js":369,"./webfs.js":371,"./words/profanity.js":372,assert:void 0,"gl-mat3/fromMat4":void 0,"gl-mat4/copy":void 0,"gl-mat4/invert":void 0,"gl-mat4/multiply":void 0,"gl-mat4/perspective":void 0,"gl-mat4/transpose":void 0}],306:[function(e,t,r){"use strict"
r.resetSettings=resetSettings
var a=e("../common/cmd_parse")
var i=e("../common/wscommon")
var o=i.netDelayGet
var n=i.netDelaySet
var s=e("./cmds").cmd_parse
var l=e("./engine")
var _=e("./error_report").errorReportDetailsString
var c=e("./fetch").fetchDelaySet
var u=e("./net")
var d=u.netClient
var f=u.netDisconnected
var v=e("./shaders").SEMANTIC
var h=e("./textures").textureGetAll
window.cmd=function(e){s.handle(null,e,a.defaultHandler)}
function byteFormat(e){if(e>85e4)return(e/1048576).toFixed(2)+"MB"
if(e>850)return(e/1024).toFixed(2)+"KB"
return e+"B"}s.register({cmd:"texmem",help:"Displays texture memory usage",func:function func(e,t){var r=h()
var a=Object.keys(r);(a=a.filter(function(e){return r[e].gpu_mem>1024})).sort(function(e,t){return r[e].gpu_mem-r[t].gpu_mem})
t(null,a.map(function(e){return byteFormat(r[e].gpu_mem)+" "+e}).join("\n"))}})
s.register({cmd:"gpumem",help:"Displays GPU memory usage summary",func:function func(e,t){var r=l.perf_state.gpu_mem
t(null,byteFormat(r.geom)+" Geo\n"+byteFormat(r.tex)+" Tex\n"+byteFormat(r.geom+r.tex)+" Total")}})
function validDefine(e){if(void 0!==v[e])return false
return e.match(/^[A-Z][A-Z0-9_]*$/)}s.register({cmd:"d",help:"Toggles a debug define",func:function func(e,t){if(!(e=e.toUpperCase().trim()))if(l.definesClearAll())return void t(null,"All debug defines cleared")
else return void t(null,"No debug defines active")
if(!validDefine(e))return void t("Invalid define specified")
l.defines[e]=!l.defines[e]
t(null,"D="+e+" now "+(l.defines[e]?"SET":"unset"))
l.definesChanged()}})
s.register({cmd:"renderer",help:"Displays current renderer",func:function func(e,t){t(null,"Renderer=WebGL"+(l.webgl2?2:1))}})
s.registerValue("postprocessing",{label:"Postprocessing",type:s.TYPE_INT,help:"Enables/disables postprocessing",get:function get(){return l.postprocessing?1:0},set:function set(e){return l.postprocessingAllow(e)}})
s.register({cmd:"net_delay",help:"Sets/shows network delay values",usage:"$HELP\n/net_delay time_base time_rand",func:function func(e,t){if(e){var r=e.split(" ")
n(Number(r[0]),Number(r[1])||0)
c(Number(r[0]),Number(r[1])||0)}var a=o()
t(null,"Client NetDelay: "+a[0]+"+"+a[1])}})
s.register({cmd:"error_report_details",help:"Shows details submitted with any error report",access_show:["hidden"],func:function func(e,t){t(null,_())}})
s.register({cmd:"disconnect",help:"Forcibly disconnect WebSocket connection (Note: will auto-reconnect)",prefix_usage_with_help:true,usage:"/disconnect [disconnnect_duration [disconnect_delay]]",func:function func(e,t){var r
var a=null==(r=d())?void 0:r.socket
if(!a)return void t("No socket")
if(f())return void t("Not connected")
var i=e.split(" ").map(Number)
var o=isFinite(i[0])?i[0]:0
var n=isFinite(i[1])?i[1]:0
d().retry_extra_delay=o
if(n)setTimeout(a.close.bind(a),n)
else a.close()
t()}})
function resetSettings(){var e=s.resetSettings()
if(l.definesClearAll())e.push("Debug defines cleared")
if(!e.length)return null
e.push("Please restart the app or reload to page for the new settings to take effect.")
return e.join("\n")}s.register({cmd:"reset_settings",help:"Resets all settings and options to their defaults (Note: requires an app restart)",func:function func(e,t){t(null,resetSettings()||"No stored settings to reset")}})},{"../common/cmd_parse":379,"../common/wscommon":404,"./cmds":298,"./engine":305,"./error_report":311,"./fetch":313,"./net":338,"./shaders":353,"./textures":365}],307:[function(e,t,r){"use strict"
r.EntityBaseClient=void 0
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var s=e("assert")
var i=e("./engine")
var a=function(r){_inheritsLoose(EntityBaseClient,r)
function EntityBaseClient(e){var t;(t=r.call(this,e)||this).fading_out=void 0
t.fading_in=void 0
t.seq_id=void 0
t.data_overrides=void 0
t.fade=void 0
t.last_update_timestamp=void 0
t.fade=null
t.fading_out=false
t.fading_in=false
t.data_overrides=[]
t.seq_id=0
t.last_update_timestamp=i.frame_timestamp
return t}var e=EntityBaseClient.prototype
e.isMe=function isMe(){return this.id===this.entity_manager.getMyEntID()}
e.getData=function getData(e,t){var r=this.data[e]
for(var a=0;a<this.data_overrides.length;++a){var i=this.data_overrides[a].data[e]
if(void 0!==i)if(null===i)r=void 0
else r=i}return null!=r?r:t}
e.setDataOverride=function setDataOverride(e,t){var r=this.getData(e)
var a=this.entity_manager.getSubscriptionId()+":"+ ++this.seq_id
t[e]=a
this.data_overrides.push({field:e,field_start:r,field_new:a,data:t})
return r}
e.postEntUpdate=function postEntUpdate(){var r=this
this.last_update_timestamp=i.frame_timestamp
if(this.data_overrides.length){var a={}
this.data_overrides=this.data_overrides.filter(function(e){var t=e.field
if(a[t])return true
else if(r.data[t]===e.field_start)return a[t]=true
else return false})}}
e.actionPrepDataAssignments=function actionPrepDataAssignments(e,t,r){s(!e.data_assignments)
s(!e.predicate)
var a=this.setDataOverride(t,r)
e.predicate={field:t,expected_value:a}
if(r.client_only){var i
e.data_assignments=((i={})[t]=r[t],i)}else e.data_assignments=r}
e.handleActionResult=function handleActionResult(e,t,r){if(t){var a=e.predicate
if(a){var i=a.field
var o=a.expected_value
this.data_overrides=this.data_overrides.filter(function(e){if(e.field===i)if(e.field_start===o){o=e.field_new
return false}return true})}}}
e.actionSend=function actionSend(e,t){(e.ent=this).entity_manager.actionSendQueued(e,t)}
e.applyBatchUpdate=function applyBatchUpdate(e,t){var r=e.field,a=e.action_id,i=e.payload,o=e.data_assignments
s(o)
s(!e.predicate)
var n={action_id:a,payload:i}
this.actionPrepDataAssignments(n,r,o)
this.actionSend(n,t)}
e.hasPendingBatchUpdate=function hasPendingBatchUpdate(){for(var e in this.data_overrides)return true
return false}
e.onDelete=function onDelete(e){return 250}
e.onCreate=function onCreate(e){return e&&!this.entity_manager.isReady()?0:250}
return EntityBaseClient}(e("../common/entity_base_common").EntityBaseCommon)
r.EntityBaseClient=a},{"../common/entity_base_common":384,"./engine":305,assert:void 0}],308:[function(e,t,r){"use strict"
r.clientEntityManagerCreate=clientEntityManagerCreate
function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called")
return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}var T=e("assert")
var a=e("../common/entity_base_common")
var g=a.EALF_HAS_ASSIGNMENTS
var y=a.EALF_HAS_ENT_ID
var S=a.EALF_HAS_PAYLOAD
var I=a.EALF_HAS_PREDICATE
var _=a.EntityFieldEncoding
var A=a.EntityFieldSpecial
var w=a.EntityFieldSub
var v=a.EntityUpdateCmd
var L=a.entity_field_decoders
var c=a.entity_field_encoders
var i=e("../common/tiny-events").EventEmitter
var s=e("../common/util").ridx
var o=e("./engine")
var n=e("./net")
var l=n.netClientId
var u=n.netDisconnected
var d=n.netSubs
var f=e("./walltime.js")
var h=Math.max,p=Math.min,m=Math.round
function entActionAppend(e,t,r,a){var i=a.action_id,o=a.ent_id,n=a.predicate,s=a.self,l=a.payload,_=a.data_assignments
var c=0
if(n)c|=I
if(s);else c|=y
if(void 0!==l)c|=S
if(_)c|=g
r.writeInt(c)
r.writeAnsiString(i)
if(c&I){T(n)
r.writeAnsiString(n.field)
r.writeAnsiString(n.expected_value||"")}if(c&y){T(o)
r.writeInt(o)}if(c&S)r.writeJSON(l)
if(c&g){var u=e.field_defs_by_name
T(u)
for(var d in _){var f=u[d]
T(f)
var v=f.field_id,h=f.sub,p=f.default_value,m=f.encoder
T(!h)
var E=_[d]
if(E===p||null===E&&void 0===p){r.writeInt(A.Default)
r.writeInt(v)}else{r.writeInt(v)
m(t,r,E,false)}}r.writeInt(A.Terminate)}}var E=function(r){_inheritsLoose(ClientEntityManagerImpl,r)
function ClientEntityManagerImpl(e){var t;(t=r.call(this)||this).my_ent_id=void 0
t.on_broadcast=void 0
t.create_func=void 0
t.channel=void 0
t.client_id=void 0
t.subscription_id=void 0
t.sub_id_prefix=void 0
t.entities=void 0
t.fading_ents=void 0
t.field_defs=void 0
t.field_defs_by_name=void 0
t.received_ent_ready=void 0
t.received_ent_start=void 0
t.frame_wall_time=void 0
t.dummy_ent_data=void 0
t.action_list_queue=null
T(e.channel_type)
d().onChannelMsg(e.channel_type,"ent_update",t.onEntUpdate.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_broadcast",t.onBroadcast.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_start",t.onEntStart.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_ready",t.onEntReady.bind(_assertThisInitialized(t)))
d().onChannelMsg(e.channel_type,"ent_id_change",t.onEntIdChange.bind(_assertThisInitialized(t)))
d().onChannelEvent(e.channel_type,"subscribe",t.onChannelSubscribe.bind(_assertThisInitialized(t)))
t.reinit(e)
t.frame_wall_time=f()
return t}var e=ClientEntityManagerImpl.prototype
e.reinit=function reinit(e){this.deinit()
this.create_func=e.create_func||this.create_func
this.on_broadcast=e.on_broadcast||this.on_broadcast
this.channel=e.channel
this.reinitInternal()}
e.reinitInternal=function reinitInternal(){this.entities={}
this.fading_ents=[]
this.my_ent_id=0
this.received_ent_ready=false
this.received_ent_start=false
this.sub_id_prefix="::"}
e.deinit=function deinit(){this.received_ent_start=false}
e.finalizeDelete=function finalizeDelete(e){this.emit("ent_delete",e)
delete this.entities[e]}
e.tick=function tick(){this.frame_wall_time=h(this.frame_wall_time,f())
if(this.fading_ents)for(var e=this.fading_ents.length-1;e>=0;--e){var t=this.fading_ents[e]
t.countdown-=o.frame_dt
var r=t.ent_id
if(t.countdown<=0){if(t.is_out)this.finalizeDelete(r)
else{var a=this.entities[r]
T(a)
T(a.fading_in)
a.fading_in=false
a.fade=null}s(this.fading_ents,e)}else{var i=this.entities[r]
T(i)
if(t.is_out)i.fade=p(1,t.countdown/t.countdown_max)
else i.fade=1-t.countdown/t.countdown_max}}}
e.getFrameWallTime=function getFrameWallTime(){return this.frame_wall_time}
e.receivedEntStart=function receivedEntStart(){return this.received_ent_start}
e.getSubscriptionId=function getSubscriptionId(){return this.subscription_id||l()}
e.getSubscriptionIdPrefix=function getSubscriptionIdPrefix(){return this.sub_id_prefix}
e.onChannelSubscribe=function onChannelSubscribe(e){this.reinitInternal()
this.client_id=l()
this.subscription_id=e.sub_id||this.client_id
this.sub_id_prefix=this.subscription_id+":"
this.emit("subscribe",e)}
e.onBroadcast=function onBroadcast(e){if(!this.received_ent_start)return
T(this.on_broadcast)
this.on_broadcast(e)}
e.fadeInEnt=function fadeInEnt(e,t){T(!e.fading_out)
T(!e.fading_in)
e.fading_in=true
this.fading_ents.push({is_out:false,ent_id:e.id,countdown:t,countdown_max:t})}
e.deleteEntityInternal=function deleteEntityInternal(e,t){var r=this.entities[e]
T(r)
T(!r.fading_out)
r.fading_out=true
var a=r.onDelete(t)
if(r.fading_in){r.fading_in=false
for(var i=0;i<this.fading_ents.length;++i){var o=this.fading_ents[i]
if(o.ent_id===e){if(a){o.is_out=true
o.countdown=m((r.fade||0)*a)
o.countdown_max=a}else{s(this.fading_ents,i)
this.finalizeDelete(e)}return}}T(false)}if(a)this.fading_ents.push({is_out:true,ent_id:e,countdown:a,countdown_max:a})
else this.finalizeDelete(e)}
e.deleteEntity=function deleteEntity(e,t){T(false,"Offline only")}
e.getEntDataForDiff=function getEntDataForDiff(e){var t=this.entities[e]
if(t)return[t.data,t]
if(!this.dummy_ent_data)this.dummy_ent_data=this.initializeNewFullEntData()
return[this.dummy_ent_data,null]}
e.readDiffFromPacket=function readDiffFromPacket(e,t){var r=this.field_defs
T(r)
var a=e
var i
while(i=t.readInt()){var o=i===A.Default
if(o)i=t.readInt()
var n=r[i]
if(!n)T(n,'Missing field_def in server-provided schema for field#"'+i+'"')
var s=n.default_value,l=n.encoding,_=n.field_name,c=n.sub
var u=L[l]
if(!u)T(u,"Missing decoder for type "+n.encoding)
if(c){T(!o)
var d=a[_]
if(c===w.Array){if(!d)d=a[_]=[]
T(Array.isArray(d))
var f=void 0
while(f=t.readInt())if(-1===f)d.length=t.readInt()
else{var v=u(t,d[f-1])
d[f-1]=v}}else{if(!d)d=a[_]={}
T(d&&"object"===typeof d&&!Array.isArray(d))
var h=d
var p=void 0
while(p=t.readAnsiString()){var m=u(t,h[p])
if(void 0===m)delete h[p]
else h[p]=m}}}else{var E=a[_]
var g=o?s:u(t,E)
if(void 0===g)delete a[_]
else a[_]=g}}}
e.initSchema=function initSchema(e){var t=[null]
var r={}
for(var a=0;a<e.length;++a){var i=e[a]
var o=a+A.MAX
var n=i.e||_.JSON
var s=c[n]
T(s)
var l=t[o]={encoding:n,encoder:s,default_value:i.d,sub:i.s||w.None,field_name:i.n,field_id:o}
r[l.field_name]=l}this.field_defs=t
this.field_defs_by_name=r}
e.initializeNewFullEntData=function initializeNewFullEntData(){var e=this.field_defs
T(e)
var t={}
for(var r=0;r<e.length;++r){var a=e[r]
if(!a)continue
var i=a.default_value,o=a.field_name
if(void 0!==i&&i!==t[o])t[o]=i}return t}
e.instantiateEntFromFullUpdate=function instantiateEntFromFullUpdate(e,t,r){var a=this.entities[e]
if(a){T(a.fading_out)
a.fading_out=false
a.fade=null
for(var i=0;i<this.fading_ents.length;++i)if(this.fading_ents[i].ent_id===e){s(this.fading_ents,i)
this.finalizeDelete(e)
break}T(!this.entities[e])}var o=this.entities[e]=this.create_func(t)
o.id=e
o.entity_manager=this
var n=o.onCreate(r)
if(n)this.fadeInEnt(o,n)
return o}
e.onEntUpdate=function onEntUpdate(e){if(!this.received_ent_start){e.pool()
return}var t
var r=false
while(t=e.readU8())switch(t){case v.Full:var a=e.readInt()
var i=this.initializeNewFullEntData()
this.readDiffFromPacket(i,e)
var o=this.instantiateEntFromFullUpdate(a,i,r)
o.postEntUpdate()
this.emit("ent_update",o.id)
break
case v.Diff:var n=e.readInt()
var s=this.getEntDataForDiff(n),l=s[0],_=s[1]
this.readDiffFromPacket(l,e)
if(_){_.postEntUpdate()
this.emit("ent_update",_.id)}break
case v.Delete:var c=e.readInt()
var u=e.readAnsiString()
this.deleteEntityInternal(c,u)
break
case v.Event:var d=e.readJSON()
this.onBroadcast(d)
break
case v.Schema:var f=e.readJSON()
this.initSchema(f)
break
case v.IsInitialList:r=true
break
default:T(false,"Unexpected EntityUpdateCmd: "+t)}}
e.onEntReady=function onEntReady(){if(this.received_ent_start){this.received_ent_ready=true
this.emit("ent_ready")}}
e.isReady=function isReady(){return this.received_ent_ready}
e.onEntStart=function onEntStart(e){if(e.sub_id===this.subscription_id){this.my_ent_id=e.ent_id
this.received_ent_start=true
this.emit("ent_start")}}
e.onEntIdChange=function onEntIdChange(e){if(e.sub_id===this.subscription_id)this.my_ent_id=e.ent_id}
e.checkNet=function checkNet(){if(u()||!this.channel||!this.received_ent_ready)return true
if(l()!==this.client_id)return true
return false}
e.handleActionListResult=function handleActionListResult(e,t,r,a){a=a||[]
for(var i=0;i<t.length;++i){var o=a[i]||{}
var n=r||o.err
var s=o.data
var l=e[i]
var _=l.ent
_.handleActionResult(l,n,s)
var c=t[i]
if(c)c(n||null,s)
else{var u=l.predicate,d=l.data_assignments
if(u&&d){var f=u.field,v=u.expected_value
if("ERR_FIELD_MISMATCH"===n||"ERR_INVALID_ENT_ID"===n){console.log("Received (not unexpected) error "+n+" applying batch update "+f+"="+v+"->"+d[f]+" to ent:"+_.id)
return}}if(n)throw n}}}
e.actionListFlush=function actionListFlush(){if(!this.action_list_queue)return
T(this.channel)
T(this.channel.numSubscriptions())
var e=this.action_list_queue,t=e.action_list,r=e.resp_list
this.action_list_queue=null
var a=this.channel.pak("ent_action_list")
a.writeInt(t.length)
for(var i=0;i<t.length;++i){var o=t[i]
var n=o.ent
if(n.id===this.my_ent_id)o.self=true
else o.ent_id=n.id
entActionAppend(this,n,a,o)}a.send(this.handleActionListResult.bind(this,t,r))}
e.actionSendQueued=function actionSendQueued(e,t){var r
T(null==(r=this.channel)?void 0:r.numSubscriptions())
T(e.ent)
if(!this.action_list_queue)this.action_list_queue={action_list:[],resp_list:[]}
this.action_list_queue.action_list.push(e)
this.action_list_queue.resp_list.push(t)}
e.channelSend=function channelSend(e,t,r){T(this.channel)
T(this.channel.numSubscriptions())
this.channel.send(e,t,r)}
e.getEnt=function getEnt(e){return this.entities[e]}
e.hasMyEnt=function hasMyEnt(){return Boolean(this.my_ent_id&&this.getEnt(this.my_ent_id))}
e.isEntless=function isEntless(){return!this.my_ent_id}
e.getMyEntID=function getMyEntID(){return this.my_ent_id}
e.getMyEnt=function getMyEnt(){T(this.my_ent_id)
var e=this.getEnt(this.my_ent_id)
T(e)
return e}
e.entitiesFind=function entitiesFind(e,t){var r=this.entities
var a=[]
for(var i in r){var o=r[i]
if(o.fading_out&&t)continue
if(!e(o))continue
a.push(o)}return a}
e.entitiesReload=function entitiesReload(e){var t=this.entities
var r=[]
for(var a in t){var i=t[a]
if(e&&!e(i))continue
var o=this.create_func(i.data)
o.id=i.id
o.entity_manager=this
i.id=0
i.entity_manager=null
t[a]=o
r.push(o)}return r}
e.isOnline=function isOnline(){return true}
e.addEntityFromSerialized=function addEntityFromSerialized(){T(false,"Offline only")}
e.setMyEntID=function setMyEntID(){T(false,"Offline only")}
return ClientEntityManagerImpl}(i)
function clientEntityManagerCreate(e){return new E(e)}},{"../common/entity_base_common":384,"../common/tiny-events":397,"../common/util":400,"./engine":305,"./net":338,"./walltime.js":370,assert:void 0}],309:[function(e,t,r){"use strict"
r.entityPositionManagerCreate=entityPositionManagerCreate
r.PerEntData=void 0
var h=e("assert")
var v=e("./engine")
var p=e("./engine").getFrameTimestamp
var m=e("../common/util").sign
var a=e("./perf_net").registerPingProvider
var E=Math.abs,g=Math.max,T=Math.PI,i=Math.sqrt
var y=2*T
function defaultErrorHandler(e){if("ERR_FAILALL_DISCONNECT"!==e)throw e}var S=function PerEntData(e){this.pos=void 0
this.net_speed=void 0
this.net_pos=void 0
this.impulse=void 0
this.net_anim_state=void 0
this.anim_state=void 0
this.pos=e.vec()
this.net_speed=1
this.net_pos=e.vec()
this.impulse=e.vec()
this.net_anim_state={}
this.anim_state={}}
r.PerEntData=S
var o=function(){function EntityPositionManagerImpl(e){this.per_ent_data=void 0
this.entity_manager=void 0
this.dim_pos=void 0
this.dim_rot=void 0
this.n=void 0
this.tol_pos=void 0
this.tol_rot=void 0
this.send_time=void 0
this.entless_send_time=void 0
this.window=void 0
this.snap_factor=void 0
this.smooth_windows=void 0
this.smooth_factor=void 0
this.anim_state_defs=void 0
this.error_handler=void 0
this.ping_time=0
this.ping_time_time=0
this.temp_vec=void 0
this.temp_delta=void 0
this.sends_to_ignore=void 0
this.last_send=void 0
this.dim_pos=e.dim_pos||2
this.dim_rot=e.dim_rot||0
this.n=this.dim_pos+this.dim_rot
this.tol_pos=e.tol_pos||.01
this.tol_rot=e.tol_rot||.1
this.send_time=e.send_time||200
this.entless_send_time=e.entless_send_time||1e3
this.window=e.window||200
this.snap_factor=e.snap_factor||1
this.smooth_windows=e.smooth_windows||6.5
this.smooth_factor=e.smooth_factor||1.2
this.anim_state_defs=e.anim_state_defs||{}
this.error_handler=e.error_handler||defaultErrorHandler
this.entity_manager=e.entity_manager
this.entity_manager.on("ent_delete",this.handleEntDelete.bind(this))
this.entity_manager.on("subscribe",this.handleSubscribe.bind(this))
this.entity_manager.on("ent_update",this.otherEntityChanged.bind(this))
this.reinit()
this.temp_vec=this.vec()
this.temp_delta=this.vec()}var e=EntityPositionManagerImpl.prototype
e.reinit=function reinit(){this.per_ent_data={}
this.sends_to_ignore=0
this.last_send={pos:this.vec(-1),anim_state:{},sending:false,send_time:0,time:0,hrtime:0}}
e.handleEntDelete=function handleEntDelete(e){delete this.per_ent_data[e]}
e.handleSubscribe=function handleSubscribe(){this.reinit()}
e.getPos=function getPos(e){var t=this.per_ent_data[e]
if(!t)return null
return t.pos}
e.getPED=function getPED(e){return this.per_ent_data[e]}
e.vec=function vec(e){var t=new Float64Array(this.n)
if(e)for(var r=0;r<this.n;++r)t[r]=e
return t}
e.vcopy=function vcopy(e,t){for(var r=0;r<this.n;++r)e[r]=t[r]
return e}
e.arr=function arr(e){var arr=new Array(this.n)
for(var t=0;t<this.n;++t)arr[t]=e[t]
return arr}
e.arrPos=function arrPos(e){var t=new Array(this.dim_pos)
for(var r=0;r<this.dim_pos;++r)t[r]=e[r]
return t}
e.vsame=function vsame(e,t){for(var r=0;r<this.dim_pos;++r)if(E(e[r]-t[r])>this.tol_pos)return false
for(var a=this.dim_pos;a<this.n;++a)if(E(e[a]-t[a])>this.tol_rot)return false
return true}
e.vsamePos=function vsamePos(e,t){for(var r=0;r<this.dim_pos;++r)if(E(e[r]-t[r])>this.tol_pos)return false
return true}
e.vlength=function vlength(e){var t=0
for(var r=0;r<this.n;++r){var a=e[r]
t+=a*a}return i(t)}
e.vdist=function vdist(e,t){this.vsub(this.temp_vec,e,t)
for(var r=0;r<this.dim_rot;++r){var a=this.dim_pos+r
var i=this.temp_vec[a]%y
this.temp_vec[a]=2*i%y-i}return this.vlength(this.temp_vec)}
e.vsub=function vsub(e,t,r){for(var a=0;a<this.n;++a)e[a]=t[a]-r[a]
return e}
e.vscale=function vscale(e,t,r){for(var a=0;a<this.n;++a)e[a]=t[a]*r
return e}
e.stateDiff=function stateDiff(e,t){var r=this.anim_state_defs
var a=null
for(var i in r){var o=r[i]
if(e[i]!==t[i]&&(!o.equal||!o.equal(e[i],t[i])))(a=a||{})[i]=true}return a}
e.updateMyPos=function updateMyPos(e,t,r){var a=this
var i=this.entity_manager.isEntless()
if(!i&&!this.entity_manager.hasMyEnt())return
var o=i?!this.vsamePos(e,this.last_send.pos):!this.vsame(e,this.last_send.pos)
var n=!i&&this.stateDiff(t,this.last_send.anim_state)
if(o||n){var s=p()
var l=i?this.entless_send_time:this.send_time
if(!this.last_send.sending&&(!this.last_send.time||s-this.last_send.time>l)||r){if(this.last_send.sending)++this.sends_to_ignore
else this.last_send.sending=true
this.last_send.time=s
this.last_send.hrtime=v.hrnow()
var _=0
if(this.last_send.send_time){var c=s-this.last_send.send_time
if((_=this.vdist(this.last_send.pos,e)/c)<.001)_=0}this.last_send.send_time=s
this.vcopy(this.last_send.pos,e)
var u={}
if(o){u.pos=i?this.arrPos(this.last_send.pos):this.arr(this.last_send.pos)
if(!i)u.speed=_}if(n)for(var d in n){u[d]=t[d]
this.last_send.anim_state[d]=t[d]}var f=function handle_resp(e){if(!a.sends_to_ignore){a.last_send.sending=false
var t=p()
var r=v.hrnow()-a.last_send.hrtime
a.ping_time=r
a.ping_time_time=t
if(r>l)a.last_send.time=t}else--a.sends_to_ignore
if(e)return a.error_handler(e)}
if(this.entity_manager.isEntless())this.entity_manager.channelSend("move",u,f)
else this.entity_manager.getMyEnt().actionSend({action_id:"move",data_assignments:u},f)}}else if(!this.last_send.sending)this.last_send.send_time=this.last_send.time=p()}
e.otherEntityChanged=function otherEntityChanged(e){var t=this.anim_state_defs
var r=this.entity_manager.getEnt(e)
h(r)
var a=r.data
var i=this.per_ent_data[e]
if(!i){i=this.per_ent_data[e]=new S(this)
for(var o in t)i.anim_state[o]=a[o]
this.vcopy(i.pos,a.pos)}for(var n in t)i.net_anim_state[n]=a[n]
if(!this.vsame(i.net_pos,a.pos)){this.vcopy(i.net_pos,a.pos)
i.net_speed=a.speed
for(var s=0;s<this.dim_rot;++s){var l=this.dim_pos+s
while(i.pos[l]>i.net_pos[l]+T)i.pos[l]-=y
while(i.pos[l]<i.net_pos[l]-T)i.pos[l]+=y}var _=this.vsub(this.temp_delta,i.net_pos,i.pos)
var c=this.vlength(_)
if(c>0){var u=c/i.net_speed
if(u<this.send_time+this.window)this.vscale(i.impulse,_,i.net_speed/c)
else if(u<this.send_time+this.window*this.smooth_windows){var d=this.vlength(i.impulse)
var f=i.net_speed
var v=g(f*this.smooth_factor,d)
this.vscale(i.impulse,_,v/c)}else this.vscale(i.impulse,_,1/(this.send_time+this.window*this.snap_factor))}}}
e.updateOtherEntity=function updateOtherEntity(e,t){var r=this.per_ent_data[e]
if(!r)return null
var a=true
for(var i=0;i<this.n;++i)if(r.impulse[i]){var o=r.net_pos[i]-r.pos[i]
var n=m(o)
r.pos[i]+=r.impulse[i]*t
var s=r.net_pos[i]-r.pos[i]
if(m(s)!==n){r.pos[i]=r.net_pos[i]
r.impulse[i]=0}else if(i<this.dim_pos&&E(r.impulse[i])>.001)a=false}var l=this.anim_state_defs
for(var _ in l)if(r.anim_state[_]!==r.net_anim_state[_]){var c=l[_]
var u=true
if(c.stopped&&!a){var d=!c.stopped(r.anim_state[_])
var f=c.stopped(r.net_anim_state[_])
if(d&&f)u=false}if(u)r.anim_state[_]=r.net_anim_state[_]}return r}
e.getPing=function getPing(){var e=2e3
if(!this.ping_time_time)return null
var t=p()-this.ping_time_time
if(t>e)return null
return{ping:this.ping_time,fade:1-t/e}}
return EntityPositionManagerImpl}()
function entityPositionManagerCreate(e){var t=new o(e)
a(t.getPing.bind(t))
return t}},{"../common/util":400,"./engine":305,"./perf_net":341,assert:void 0}],310:[function(e,t,r){"use strict"
r.getCurrentEnvironment=getCurrentEnvironment
r.setCurrentEnvironment=setCurrentEnvironment
r.getLinkBase=getLinkBase
r.getAPIPath=getAPIPath
r.getExternalTextureURL=getExternalTextureURL
r.environmentsInit=environmentsInit
var l=e("assert")
var _=e("./client_config").setAbilityReloadUpdates
var a=e("./net").netForceDisconnect
var i=e("./urlhash")
var c={}
var u=null
var d=null
var o
var n
var s
function applyEnvironment(){o=u&&u.link_base||i.getURLBase()
n=u&&u.api_path||o+"api/"
s=o.replace("//localhost:","//127.0.0.1:")}applyEnvironment()
function getCurrentEnvironment(){return u}function setCurrentEnvironment(e){var t=u
if((u=e&&c[e]||d)!==t){applyEnvironment()
_(false)
a()}}function getLinkBase(){return o}function getAPIPath(){return n}function getExternalTextureURL(e){return e.match(/^.{2,7}:/)?e:""+s+e}function environmentsInit(e,r,t){c={}
var a=[]
for(var i=0,o=e.length;i<o;i++){var n=e[i]
var s=n.name
l(s.length>0)
c[s]=n
a.push(s)}u=d=t&&c[t]||null
applyEnvironment()
if(!a.some(function(e){return"default"===e.toLowerCase()}))a.push("default")
if(r){r.registerValue("environment",{type:r.TYPE_STRING,help:"Display or set the current client environment",usage:"Display the current client environment\n  Usage: /environment\nSet the current client environment ("+a.join(", ")+")\n  Usage: /environment <environment_name>",label:"Environment",get:function get(){return JSON.stringify(getCurrentEnvironment()||"default",null,2)},set:setCurrentEnvironment,access_show:["sysadmin"]})
r.register({cmd:"env",help:"Alias for /environment",access_show:["sysadmin"],func:function func(e,t){r.handle(this,"environment "+e,t)}})}if(document.location.pathname.match(/index\.\d+\.\d+\.\d+\.html$/))_(false)}},{"./client_config":297,"./net":338,"./urlhash":369,assert:void 0}],311:[function(e,t,r){"use strict"
r.errorReportDisable=errorReportDisable
r.errorReportIgnoreUncaughtPromises=errorReportIgnoreUncaughtPromises
r.errorReportSetDetails=errorReportSetDetails
r.errorReportSetDynamicDetails=errorReportSetDynamicDetails
r.errorReportSetTimeAccum=errorReportSetTimeAccum
r.errorReportDetailsString=errorReportDetailsString
r.hasCrashed=hasCrashed
r.errorReportClear=errorReportClear
r.glovErrorReportDisableSubmit=glovErrorReportDisableSubmit
r.glovErrorReportSetCrashCB=glovErrorReportSetCrashCB
r.reportingUseAppAPIPath=reportingUseAppAPIPath
r.reportingAPIPath=reportingAPIPath
r.glovErrorReport=glovErrorReport
r.session_uid=void 0
var a=""+String(Date.now()).slice(-8)+String(Math.random()).slice(2,8)
r.session_uid=a
var i={}
var o={}
var n=e("./environments").getAPIPath
var s=e("./client_config").platformGetID
var l=e("./fetch").fetch
var _=e("./local_storage").getStoragePrefix
var c=e("./locate_asset").unlocatePaths
var u=false
function errorReportDisable(){u=true}var d=false
function errorReportIgnoreUncaughtPromises(){d=true}function errorReportSetDetails(e,t){if(t)i[e]=escape(String(t))
else delete i[e]}function errorReportSetDynamicDetails(e,t){o[e]=t}errorReportSetDetails("build","1718180230532")
errorReportSetDetails("project",_())
errorReportSetDetails("sesuid",a)
errorReportSetDynamicDetails("platform",s)
var f=Date.now()
errorReportSetDetails("time_start",f)
errorReportSetDynamicDetails("url",function(){return escape(location.href)})
errorReportSetDynamicDetails("time_up",function(){return Date.now()-f})
var v=0
function errorReportSetTimeAccum(e){v=e}errorReportSetDynamicDetails("time_accum",function(){return v})
function getDynamicDetail(e){var t=o[e]()
if(!t&&0!==t)return""
return"&"+e+"="+t}function errorReportDetailsString(){return"&"+Object.keys(i).map(function(e){return e+"="+i[e]}).join("&")+Object.keys(o).map(getDynamicDetail).join("")}var h=0
var p=0
function hasCrashed(){return p>0}function errorReportClear(){h=0
window.debugmsg("",true)}var m=true
function glovErrorReportDisableSubmit(){m=false}var E=null
function glovErrorReportSetCrashCB(e){E=e}var g="http://www.dashingstrike.com/reports/api/"
if(-1!==window.location.host.indexOf("localhost")||-1!==window.location.host.indexOf("staging"))g="http://staging.dashingstrike.com/reports/api/"
if(window.location.href.startsWith("https://"))g=g.replace(/^http:/,"https:")
var T=false
function reportingUseAppAPIPath(){T=true}function reportingAPIPath(){return T?n():g}var y=new RegExp(["^Error: Script error\\.$","^Error: Script error\\.\n  at \\(0:0\\)$","^Error: null$","^Error: null\n  at null\\(null:null\\)$","avast_submit","vc_request_action","getElementsByTagName\\('video'\\)",'document\\.getElementById\\("search"\\)',"change_ua","chrome-extension","setConnectedRobot","Failed to (?:start|stop) the audio device","zaloJSV2","getCookie is not defined","originalPrompt","_AutofillCallbackHandler","sytaxError","bannerNight","privateSpecialRepair","__gCrWeb","\\$wrap is not","wsWhitelisted","#darkcss","chrome://userjs","worker-hammerhead","ammerhead-browser","hammerhead","isFeatureBroken","PureRead","uv\\.handler\\.js","dashawn\\.cf","clearTransInfo","firefoxSample","gourmetads","apstag","otBannerSdk\\.js","setOTDataLayer","otSDKStub","pubads_20","ima3\\.js","window\\.setDgResult","TranslateService","bdTransJSBridge","ciuvoSDK","stubScriptElement","chrome://internal","getElementById\\('items'\\)","closeModal","WeixinJSBridge","/prebid","property: websredir","property: googletag","ResizeObserver loop","nav_call_update_item_status","GetHTMLElementsAtPoint"].join("|"))
function glovErrorReport(e,t,r,a,i){t=c(t)
console.error(t)
if(E)E()
if(e){++p
var o=Date.now()
var n=o-h
h=o
if(u)return false
if(n<3e4)return false
if(t.match(y))return false}var s=reportingAPIPath()
s+=(e?"errorReport":"errorLog")+"?cidx="+p+"&file="+escape(c(r))+"&line="+(a||0)+"&col="+(i||0)+"&msg="+escape(t)+errorReportDetailsString()
if(m){l({method:"POST",url:s},function(){})
if(window.gtag)window.gtag("event","exception",{description:t,fatal:e})}if(d&&t.match(/Uncaught \(in promise\)/))return false
return true}window.glov_error_report=glovErrorReport.bind(null,true)
var S=window.glov_error_early
if(S)window.glov_error_report(S.msg,S.file,S.line,S.col)},{"./client_config":297,"./environments":310,"./fetch":313,"./local_storage":329,"./locate_asset":331}],312:[function(e,t,r){"use strict"
r.externalUsersEnabled=externalUsersEnabled
r.externalUsersLoggedIn=externalUsersLoggedIn
r.externalUsersAutoLoginProvider=externalUsersAutoLoginProvider
r.externalUsersAutoLoginFallbackProvider=externalUsersAutoLoginFallbackProvider
r.externalUsersEmailPassLoginProvider=externalUsersEmailPassLoginProvider
r.externalUsersSendEmailConfirmation=externalUsersSendEmailConfirmation
r.externalUsersCheckEmailVerified=externalUsersCheckEmailVerified
r.externalUsersSendRecoverEmail=externalUsersSendRecoverEmail
r.externalUsersLogIn=externalUsersLogIn
r.externalUsersLogOut=externalUsersLogOut
r.externalUsersCurrentUser=externalUsersCurrentUser
r.externalUsersFriends=externalUsersFriends
r.externalUsersPartyId=externalUsersPartyId
r.externalUsersSetupProvider=externalUsersSetupProvider
r.externalUsersSetup=externalUsersSetup
var a=e("assert")
var i=e("../common/external_users_common")
var o=i.ERR_INVALID_PROVIDER
var n=i.ERR_NOT_AVAILABLE
var s=i.ERR_UNAUTHORIZED
var l=e("./social").registerExternalUserInfoProvider
var _={getProvider:function getProvider(){a(false)},enabled:function enabled(){return false},loggedIn:function loggedIn(){return false},logIn:function logIn(e,t){t(o)},logOut:function logOut(){},getCurrentUser:function getCurrentUser(e){e(o)}}
var c={}
var u
var d
var f
function getClient(e){return c[e]||_}function externalUsersEnabled(e){var t=c[e]
return t&&t.enabled()||false}function externalUsersLoggedIn(e){var t=c[e]
return t&&t.loggedIn()||false}function externalUsersAutoLoginProvider(){return u}function externalUsersAutoLoginFallbackProvider(){return d}function externalUsersEmailPassLoginProvider(){return f}function externalUsersSendEmailConfirmation(e,t){a(f)
var r=getClient(f)
a(r.sendActivationEmail)
r.sendActivationEmail(e,t)}function externalUsersCheckEmailVerified(e){a(f)
var t=getClient(f)
a(t.checkEmailVerified)
t.checkEmailVerified(e)}function externalUsersSendRecoverEmail(e,t){a(f)
var r=getClient(f)
a(r.sendRecoverEmail)
r.sendRecoverEmail(e,t)}function externalUsersLogIn(e,t,r){getClient(e).logIn(t,r)}function externalUsersLogOut(e){if(e)getClient(e).logOut()
else for(var t in c)getClient(t).logOut()}function externalUsersCurrentUser(e,t){getClient(e).getCurrentUser(t)}function externalUsersFriends(e,t){var r=getClient(e)
if(r.getFriends)r.getFriends(t)
else t(n)}function externalUsersPartyId(e,t){var r=getClient(e)
if(r.getPartyId)r.getPartyId(t)
else t(n)}function externalUsersSetupProvider(t){var e=t.getProvider()
c[e]=t
l(e,function(e){if(t.loggedIn())t.getCurrentUser(e)
else e(s)},t.getFriends&&function(e){if(t.loggedIn())t.getFriends(e)
else e(s)})}function externalUsersSetup(e,t,r,a){u=t
d=r
f=a
e.forEach(externalUsersSetupProvider)}},{"../common/external_users_common":387,"./social":357,assert:void 0}],313:[function(e,t,r){"use strict"
r.fetchDelaySet=fetchDelaySet
r.fetch=fetch
r.ERR_TIMEOUT=r.ERR_CONNECTION=void 0
var v=e("assert")
var h=Math.random,p=Math.round
var m="ERR_CONNECTION"
r.ERR_CONNECTION=m
var E="ERR_TIMEOUT"
r.ERR_TIMEOUT=E
var g=0
var T=0
function fetchDelaySet(e,t){g=e
T=t}var a=/\/\/[^/]+\/([^?#]+)/
var i=/([^?#]+)/
function labelFromURL(e){var t=e.match(a)
if(t)return t[1]
return(t=e.match(i))?t[1]:e}function fetch(e,r){var a=false
var i
function done(e,t){if(a)return
a=true
if(i)clearTimeout(i)
r(e,t)}var t=e.method,o=e.url,n=e.response_type,s=e.label,l=e.body,_=e.headers,c=void 0===_?{}:_,u=e.timeout
t=t||"GET"
v(o)
s=s||labelFromURL(o)
var d=new XMLHttpRequest
d.open(t,o,true)
if(u){d.timeout=u
i=setTimeout(function(){i=setTimeout(function(){profilerStart("fetch_timeout:"+s)
done(E)
profilerStop()},u)},u)}if(n&&"json"!==n)d.responseType=n
for(var f in c)d.setRequestHeader(f,c[f])
d.onload=function(){profilerStart("fetch_onload:"+s)
if(0!==d.status&&d.status<200||d.status>=300){var e
if("arraybuffer"!==n)try{e=d.responseText}catch(e){}done(String(d.status),e||"")}else if("json"===n){var t
var r
try{t=d.responseText
r=JSON.parse(t)}catch(e){console.error("Received invalid JSON response from "+o+": "+(t||"<empty response>"))
done(e)
profilerStop()
return}done(null,r)}else if("arraybuffer"===n)if(d.response)done(null,d.response)
else done("empty response")
else done(null,d.responseText)
profilerStop()}
d.onabort=d.onerror=function(){profilerStart("fetch_onerror:"+s)
done(m)
profilerStop()}
d.ontimeout=function(){profilerStart("fetch_ontimeout:"+s)
done(E)
profilerStop()}
if(void 0!==l)if("object"===typeof l){d.setRequestHeader("Content-Type","application/json")
l=JSON.stringify(l)}else l=String(l)
if(g||T)setTimeout(d.send.bind(d,l),g+p(h()*T))
else d.send(l)}},{assert:void 0}],314:[function(e,t,r){"use strict"
r.filewatchOn=filewatchOn
r.filewatchMessageHandler=filewatchMessageHandler
r.filewatchTriggerChange=filewatchTriggerChange
r.filewatchStartup=filewatchStartup
var a=e("assert")
var o=e("./locate_asset").locateAssetDisableHashing
var n={}
var s=[]
function filewatchOn(e,t){if("."===e[0]){a(!n[e])
n[e]=t}else s.push([e,t])}var l
function filewatchMessageHandler(e){l=e}function onFileChange(e){console.log("FileWatch change: "+e)
o()
var t=e.lastIndexOf(".")
var r=false
if(-1!==t){var a=e.slice(t)
if(n[a])if(false!==n[a](e))r=true}for(var i=0;i<s.length;++i)if(e.match(s[i][0]))if(false!==s[i][1](e))r=true
if(l&&r)l("Reloading: "+e)}function filewatchTriggerChange(e){onFileChange(e)}function filewatchStartup(e){e.onMsg("filewatch",onFileChange)}},{"./locate_asset":331,assert:void 0}],315:[function(e,t,r){"use strict"
r.intColorFromVec4Color=intColorFromVec4Color
r.vec4ColorFromIntColor=vec4ColorFromIntColor
r.fontStyle=fontStyle
r.fontStyleColored=fontStyleColored
r.fontStyleOutlined=fontStyleOutlined
r.fontStyleBold=fontStyleBold
r.fontStyleAlpha=fontStyleAlpha
r.fontStyleHash=fontStyleHash
r.fontSetDefaultSize=fontSetDefaultSize
r.fontRotate=fontRotate
r.fontCreate=fontCreate
r.fontTick=fontTick
r.fontSetReplacementChars=fontSetReplacementChars
r.glov_font_default_style=r.font_shaders=r.EPSILON=r.ALIGN=void 0
r.style=fontStyle
r.styleColored=fontStyleColored
r.styleAlpha=fontStyleAlpha
r.create=fontCreate
var L={HLEFT:0,HCENTER:1,HRIGHT:2,HMASK:3,VTOP:0,VCENTER:4,VBOTTOM:8,VMASK:12,HFIT:16,HWRAP:32,HCENTERFIT:17,HRIGHTFIT:18,HVCENTER:5,HVCENTERFIT:21}
r.ALIGN=L
var O=1e-10
r.EPSILON=O
var me=e("assert")
var Ee=e("./camera2d.js")
var a=e("./camera2d.js"),ge=a.transformX,Te=a.transformY
var ye=e("./engine.js")
var i=e("./geom.js")
var Se=e("./localization.js").getStringFromLocalizable
var o=Math.cos,n=Math.sin,Ie=Math.max,Ae=Math.min,m=Math.round
var s=e("./shaders.js"),l=s.shaderCreate,_=s.shadersPrelink
var c=e("./sprites.js")
var we=c.BLEND_ALPHA,Le=c.BLEND_PREMULALPHA,Oe=c.spriteChainedStart,Re=c.spriteChainedStop,be=c.spriteDataAlloc
var u=e("./textures.js").textureLoad
var d=e("../common/util.js").clamp
var f=e("../common/vmath.js"),v=f.v3scale,Ne=f.v3set,h=f.vec4,p=f.v4copy,Ce=f.v4scale
var E=L.HMASK|L.HFIT
function GlovFontStyle(){this.color_vec4=new Float32Array([1,1,1,1])}GlovFontStyle.prototype.outline_width=0
GlovFontStyle.prototype.outline_color=0
GlovFontStyle.prototype.glow_xoffs=0
GlovFontStyle.prototype.glow_yoffs=0
GlovFontStyle.prototype.glow_inner=0
GlovFontStyle.prototype.glow_outer=0
GlovFontStyle.prototype.glow_color=0
GlovFontStyle.prototype.color=4294967295
GlovFontStyle.prototype.hash=0
var g={}
r.font_shaders=g
function intColorFromVec4Color(e){return(255*e[0]|0)<<24|(255*e[1]|0)<<16|(255*e[2]|0)<<8|255*e[3]|0}function vec4ColorFromIntColor(e,t){e[0]=(t>>24&255)/255
e[1]=(t>>16&255)/255
e[2]=(t>>8&255)/255
e[3]=(255&t)/255
return e}function vec4ColorFromIntColorPreMultiplied(e,t){var r=e[3]=(255&t)/255
e[0]=(t>>24&255)*(r*=1/255)
e[1]=(t>>16&255)*r
e[2]=(t>>8&255)*r}var T=new GlovFontStyle
r.glov_font_default_style=T
function fontStyle(e,t){var r=new GlovFontStyle
var a=r.color_vec4
if(e)for(var i in e)r[i]=e[i]
for(var o in t)r[o]=t[o]
r.color_vec4=a
vec4ColorFromIntColor(r.color_vec4,r.color)
r.hash=0
return r}function fontStyleColored(e,t){return fontStyle(e,{color:t})}function fontStyleOutlined(e,t,r){return fontStyle(e,{outline_width:t,outline_color:r=r||(e||T).color})}function fontStyleBold(e,t){var r=(e||T).color
if(e.outline_width){var a=t+e.outline_width
return fontStyle(e,{outline_width:t,outline_color:r,glow_xoffs:0,glow_yoffs:0,glow_color:e.outline_color,glow_inner:a-.25,glow_outer:a+.25})}else return fontStyle(e,{outline_width:t,outline_color:r})}function colorAlpha(e,t){return 4294967040&e|d(m((255&e)*t),0,255)}function fontStyleAlpha(e,t){return fontStyle(e,{color:colorAlpha((e||T).color,t),outline_color:colorAlpha((e||T).outline_color,t),glow_color:colorAlpha((e||T).glow_color,t)})}function fontStyleHash(e){if(!e.hash)e.hash=e.color+1007*e.outline_width+3*e.outline_color+10007*e.glow_xoffs+100007*e.glow_yoffs+1000007*e.glow_inner+10000007*e.glow_outer+7*e.glow_color
return e.hash}var xe=null
var y=false
var S=[]
var I=0
var A=[]
var w=0
var R=h()
var Me
var De={}
function techParamsAlloc(){if(w===A.length)A.push({param0:h(),outline_color:h(),glow_color:h(),glow_params:h()})
xe=A[w++]}function fontStartup(){if(xe)return
Me=i.stats
techParamsAlloc()}function techParamsSet(e,t){var r=xe[e]
if(!y)if(r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]||r[3]!==t[3]){var a=xe
techParamsAlloc()
p(xe.param0,a.param0)
p(xe.outline_color,a.outline_color)
p(xe.glow_color,a.glow_color)
p(xe.glow_params,a.glow_params)
Me.font_params++
y=true
r=xe[e]}else return
if(y){r[0]=t[0]
r[1]=t[1]
r[2]=t[2]
r[3]=t[3]}}var b=["param0","outline_color","glow_color","glow_params"]
function sameTP(e){for(var t=0;t<4;++t){var r=b[t]
var a=xe[r]
var i=e[r]
for(var o=0;o<4;++o)if(a[o]!==i[o])return false}return true}function techParamsGet(){if(!y)return xe
y=false
for(var e=0;e<S.length;++e)if(sameTP(S[e])){if(xe===A[w-1])w--
xe=S[e]
if(I===e)I=(I+1)%4;--Me.font_params
return xe}S[I]=xe
I=(I+1)%4
return xe}function GlovFont(e,t){me(0!==e.font_size)
this.texture=u({url:"img/"+t+".png",filter_min:e.noFilter?gl.NEAREST:gl.LINEAR,filter_mag:e.noFilter?gl.NEAREST:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})
this.textures=[this.texture]
this.integral=Boolean(e.noFilter)
this.font_info=e
this.font_size=e.font_size
this.inv_font_size=1/e.font_size
this.shader=g.font_aa
this.tex_w=e.imageW
this.tex_h=e.imageH
for(var r=0;r<e.char_infos.length;++r){var a=e.char_infos[r]
a.scale=1/(a.sc||1)
a.w=a.w||0}this.char_infos=[]
for(var i=0;i<e.char_infos.length;++i){var o=e.char_infos[i];(this.char_infos[o.c]=o).xpad=o.xpad||0
o.yoffs=o.yoffs||0
o.w_pad_scale=(o.w+o.xpad)*o.scale}this.replacement_character=this.infoFromChar(65533)
if(!this.replacement_character)this.replacement_character=this.infoFromChar(63)
this.whitespace_character=this.infoFromChar(13)
this.default_style=new GlovFontStyle
this.applied_style=new GlovFontStyle
fontStartup()}GlovFont.prototype.drawSizedColor=function(e,t,r,a,i,o,n){return this.drawSized(fontStyleColored(e,o),t,r,a,i,n)}
GlovFont.prototype.drawSized=function(e,t,r,a,i,o){De.style=e
De.x=t
De.y=r
De.z=a
De.xsc=i*this.inv_font_size
De.ysc=i*this.inv_font_size
De.text=o
return this.drawScaled()}
GlovFont.prototype.drawSizedAligned=function(e,t,r,a,i,o,n,s,l){profilerStart("drawSizedAligned")
l=Se(l)
if(o&L.HWRAP){var _=this.drawSizedAlignedWrapped(e,t,r,a,0,i,o&~L.HWRAP,n,s,l)
profilerStop("drawSizedAligned")
return _}var c=i
var u=i
if(o&E){var d=this.getStringWidth(e,c,l)
if(o&L.HFIT&&d>n+O){var f=n/d
c*=f
d=n
if(f<.5){if((o&L.VMASK)!==L.VCENTER&&(o&L.VMASK)!==L.VBOTTOM)r+=.5*(u-u*f*2)
u*=2*f}}switch(o&L.HMASK){case L.HCENTER:t+=.5*(n-d)
if(this.integral)t=m(t)
break
case L.HRIGHT:t+=n-d}}switch(o&L.VMASK){case L.VCENTER:r+=.5*(s-u)
if(this.integral)r=m(r)
break
case L.VBOTTOM:r+=s-u}var v=c*this.inv_font_size
var h=u*this.inv_font_size
De.style=e
De.x=t
De.y=r
De.z=a
De.xsc=v
De.ysc=h
De.text=l
var p=this.drawScaled()
profilerStop("drawSizedAligned")
return p}
var Pe=0
var Be=false
GlovFont.prototype.drawSizedAlignedWrapped=function(e,t,r,a,i,o,n,s,l,_){_=Se(_)
me(s>0)
me("string"!==typeof l)
var c=[]
var u=[]
c.length=this.wrapLines(e,s,i,o,_,n,function(e,t,r){u[t]=e
c[t]=r})
var d=0
var f=o*c.length
var v=n&L.VMASK
switch(v){case L.VCENTER:d=(l-f)/2
if(this.integral)d|=0
break
case L.VBOTTOM:d=l-f}n&=~L.VMASK
Be=true
Pe=0
Oe()
for(var h=0;h<c.length;++h){var p=c[h]
if(p&&p.trim())this.drawSizedAligned(e,t+u[h],r+d,a,o,n,s-u[h],0,p)
d+=o}Be=false
Re()
return v===L.VBOTTOM?f:d}
GlovFont.prototype.drawSizedColorWrapped=function(e,t,r,a,i,o,n,s,l){return this.drawScaledWrapped(fontStyleColored(e,s),t,r,a,i,o,n*this.inv_font_size,n*this.inv_font_size,l)}
GlovFont.prototype.drawSizedWrapped=function(e,t,r,a,i,o,n,s){return this.drawScaledWrapped(e,t,r,a,i,o,n*this.inv_font_size,n*this.inv_font_size,s)}
var N=24
function fontSetDefaultSize(e){N=e}var ke=0
var Ue=0
var Ge=0
var Fe=0
var We=0
function fontRotate(e,t,r){Ue=o(ke=e)
Ge=n(e)
Fe=ge(t)
We=Te(r)}GlovFont.prototype.draw=function(e){var t=e.style,r=e.color,a=e.alpha,i=e.x,o=e.y,n=e.z,s=e.size,l=e.w,_=e.h,c=e.align,u=e.text,d=e.indent,f=e.rot
if(r)t=fontStyleColored(t,r)
if(void 0!==a)t=fontStyleAlpha(t,a)
d=d||0
s=s||N
n=n||Z.UI
if(f)fontRotate(f,i,o)
var v
if(c)if(c&L.HWRAP)v=this.drawSizedAlignedWrapped(t,i,o,n,d,s,c&~L.HWRAP,l,_,u)
else v=this.drawSizedAligned(t,i,o,n,s,c,l||0,_||0,u)
else v=this.drawSized(t,i,o,n,s,u)
if(f)fontRotate(0)
return v}
GlovFont.prototype.wrapLines=function(e,t,r,a,i,o,n){me("number"!==typeof e)
this.applyStyle(e)
return this.wrapLinesScaled(t,r,a*this.inv_font_size,i,o,n)}
GlovFont.prototype.numLines=function(e,t,r,a,i){return this.wrapLines(e,t,r,a,i,0)}
GlovFont.prototype.dims=function(e,t,r,a,i){var o=0
function lineCallback(e,t,r,a){o=Ie(o,a)}var n=this.wrapLines(e,t,r,a,i,0,lineCallback)
return{w:o,h:n*a,numlines:n}}
var C
GlovFont.prototype.infoFromChar=function(e){var t=this.char_infos[e]
if(t)return t
if(e>=9&&e<=13)return this.whitespace_character
if(C){var r=C[e]
if(r)if(t=this.char_infos[r])return t}return this.replacement_character}
GlovFont.prototype.getCharacterWidth=function(e,t,r){me.equal(typeof r,"number")
this.applyStyle(e)
var a=this.infoFromChar(r)
var i=t*this.inv_font_size
var o=this.calcXAdvance(i)
if(a)return a.w_pad_scale*i+o
return 0}
GlovFont.prototype.getStringWidth=function(e,t,r){r=Se(r)
this.applyStyle(e)
var a=0
var i=t*this.inv_font_size
var o=this.calcXAdvance(i)
for(var n=0;n<r.length;++n){var s=r.charCodeAt(n)
var l=this.infoFromChar(s)
if(l)a+=l.w_pad_scale*i+o}return a}
GlovFont.prototype.getSpaceSize=function(e){var t=this.infoFromChar(32)
return(t?(t.w+t.xpad)*t.scale:this.font_size)*e}
function endsWord(e){return 32===e||0===e||10===e||9===e}GlovFont.prototype.wrapLinesScaled=function(e,t,r,a,i,o){a=Se(a)
me("function"!==typeof i)
var n=a.length
var s=e-t+O
var l=i&L.HFIT
var _=this.calcXAdvance(r)
var c=this.getSpaceSize(r)+_
var u=0
var d=0
var f=0
var v=0
var h=-1
var p=0
var m=0
var E=0
var g=-1
var T=0
var y=0
function flushLine(){if(-1!==h&&o)o(f,y,a.slice(d,h),v)
y++
d=p
h=v=-1
m=f=t}do{var S=u<n?a.charCodeAt(u)||65533:0
if(endsWord(S)){if(p!==u){var I=false
if(m+E<=e+O);else if(E>s&&!l){I=true
if(-1===g){if(-1!==h)flushLine()
u=d+1
E=s}else{u=g
E=T}}else if(-1!==h||t<0&&f!==t)flushLine()
m=v=m+E
E=0
p=h=u
g=-1
if(I)flushLine()
continue}else if(S){p=u+1
m+=c
if(10===S)flushLine()}}else{var A=this.infoFromChar(S)
if(A){var w=A.w_pad_scale*r+_
if(m+(E+=w)<=e+O){g=u+1
T=E}}}++u}while(u<=n)
if(-1!==h){v=m
flushLine()}else if(m!==v){v=m
if(o)o(f,y,"",v)}return y}
GlovFont.prototype.drawScaledWrapped=function(e,i,o,t,r,a,n,s,l){var _=this
if(null===l||void 0===l)l="(null)"
me(r>0)
this.applyStyle(e)
this.last_width=0
De.style=e
De.z=t
De.xsc=n
De.ysc=s
return this.wrapLinesScaled(r,a,n,l,0,function(e,t,r,a){De.x=i+e
De.y=o+_.font_size*s*t
De.text=r
_.drawScaled()
_.last_width=Ie(_.last_width,a)})*this.font_size*s}
GlovFont.prototype.calcXAdvance=function(e){var t=this.font_size/32
var r=m(e*t*Ie(this.applied_style.outline_width-2,0))
return Ie(r,e*t*Ie(this.applied_style.glow_outer-this.applied_style.glow_xoffs-3,0))}
var He=h()
var ze=h()
var Ve=h()
var Ye=h()
GlovFont.prototype.drawScaled=function(){var e=De.style,t=De.x,r=De.y,a=De.z,i=De.xsc,o=De.ysc,n=De.text
profilerStart("drawScaled")
n=Se(n)
var s=t
me(isFinite(s))
me(isFinite(r))
me(isFinite(a))
var l=this.font_info
r+=(l.y_offset||0)*o
var _=this.textures
if(null===n||void 0===n)n="(null)"
var c=n.length
if(0===i||0===o){profilerStop("drawScaled")
return 0}Me.font_calls++
this.applyStyle(e)
var u=ye.defines.NOPREMUL?we:Le
var d=.5*(i+o)
var f=.5*(i*Ee.data[4]+o*Ee.data[5])
var v=this.calcXAdvance(i)
var h=this.font_size/32
if(!Be)Pe=0
var p=this.applied_style
var m=.5/l.spread
var E=m/f
var g=Ne(He,1/E,-.5/E+.5,Ae(0,-.5/E+.5+p.outline_width*h*f))
var T=Ie(0,p.outline_width*h*d)
var y=p.glow_outer*h
var S=p.glow_xoffs*h*i
var I=p.glow_yoffs*h*o
Ve[0]=Ie(y*i-S,T)
Ve[2]=Ie(y*i+S,T)
Ve[1]=Ie(y*o-I,T)
Ve[3]=Ie(y*o+I,T)
techParamsSet("param0",g)
var A=ze
if(p.glow_outer){A[2]=1/((p.glow_outer-p.glow_inner)*m*h)
A[3]=Ae(0,-(.5-p.glow_outer*m*h)/((p.glow_outer-p.glow_inner)*m*h))}else A[2]=g[3]=0
Ce(Ye,Ve,1/d)
for(var w=0;w<4;++w)if(Ye[w]>l.spread){var L=l.spread/Ye[w]
Ve[w]*=L
Ye[w]*=L}var O=p.glow_xoffs<0?-1e-4:0
if(!O){if(!Be)Oe()}else if(Be)Re()
var R=p.glow_xoffs||p.glow_yoffs
if(!R){A[0]=A[1]=0
techParamsSet("glow_params",A)
techParamsGet()}var b=i/d
var N=o/d
var C=Te(r)
var x=p.color_vec4
var M=this.shader
var D
var P
var B
var k
for(var U=0;U<c;U++){var G=n.charCodeAt(U)
if(9===G){var F=i*this.font_size*4
s=(1+((s-t)/F|0))*F+t}else{var W=this.infoFromChar(G)
if(W){var H=W.scale
var z=i*H
if(W.w){var V=o*H
var Y=1/H
var j=this.tex_w
var K=this.tex_h
if(R&&H!==Pe){A[0]=-p.glow_xoffs*h*Y/j
A[1]=-p.glow_yoffs*h*Y/K
techParamsSet("glow_params",A)
if(!O){Re()
Oe()}techParamsGet()
Pe=H}var q=(W.x0-Ye[0]*Y)/j
var Z=(W.x0+W.w+Ye[2]*Y)/j
var X=(W.y0-Ye[1]*Y)/K
var Q=(W.y0+W.h+Ye[3]*Y)/K
var $=W.w*z+(Ve[0]+Ve[2])*b
var J=W.h*V+(Ve[1]+Ve[3])*N
var ee=s-b*Ve[0]
var te=r-N*Ve[1]+W.yoffs*V
var re=te+J
var ae=ee+$
var ie=a+O*U
var oe=ge(ee)
var ne=Te(te)
var se=ge(ae)
var le=Te(re)
if(ke){var _e=se-oe
var ce=le-ne
var ue=oe-Fe
var de=ne-We
var fe=Ge*ce
var ve=Ue*ce
B=(oe=Fe+ue*Ue-de*Ge)-fe
k=(ne=We+ue*Ge+de*Ue)+ve
se=(D=oe+Ue*_e)-fe
le=(P=ne+Ge*_e)+ve}else{D=se
P=ne
B=oe
k=le}var he=be(_,M,xe,u)
var pe=he.data
pe[0]=oe
pe[1]=ne
pe[2]=x[0]
pe[3]=x[1]
pe[4]=x[2]
pe[5]=x[3]
pe[6]=q
pe[7]=X
pe[8]=B
pe[9]=k
pe[10]=x[0]
pe[11]=x[1]
pe[12]=x[2]
pe[13]=x[3]
pe[14]=q
pe[15]=Q
pe[16]=se
pe[17]=le
pe[18]=x[0]
pe[19]=x[1]
pe[20]=x[2]
pe[21]=x[3]
pe[22]=Z
pe[23]=Q
pe[24]=D
pe[25]=P
pe[26]=x[0]
pe[27]=x[1]
pe[28]=x[2]
pe[29]=x[3]
pe[30]=Z
pe[31]=X
he.x=oe
he.y=C
he.queue(ie)}s+=(W.w+W.xpad)*z+v}}}if(!O){if(!Be)Re()}else if(Be)Oe()
profilerStop("drawScaled")
return s-t}
GlovFont.prototype.determineShader=function(){var e=this.applied_style.outline_width&&255&this.applied_style.outline_color
var t=this.applied_style.glow_outer>0&&255&this.applied_style.glow_color
if(e)if(t)this.shader=g.font_aa_outline_glow
else this.shader=g.font_aa_outline
else if(t)this.shader=g.font_aa_glow
else this.shader=g.font_aa}
GlovFont.prototype.applyStyle=function(e){if(!e)e=this.default_style
if(ye.defines.NOPREMUL){vec4ColorFromIntColor(R,e.outline_color)
techParamsSet("outline_color",R)
vec4ColorFromIntColor(R,e.glow_color)
techParamsSet("glow_color",R)}else{vec4ColorFromIntColorPreMultiplied(R,e.outline_color)
techParamsSet("outline_color",R)
vec4ColorFromIntColorPreMultiplied(R,e.glow_color)
techParamsSet("glow_color",R)}this.applied_style.outline_width=e.outline_width
this.applied_style.outline_color=e.outline_color
this.applied_style.glow_xoffs=e.glow_xoffs
this.applied_style.glow_yoffs=e.glow_yoffs
this.applied_style.glow_inner=e.glow_inner
this.applied_style.glow_outer=e.glow_outer
this.applied_style.glow_color=e.glow_color
this.applied_style.color=e.color
if(ye.defines.NOPREMUL)p(this.applied_style.color_vec4,e.color_vec4)
else{var t=this.applied_style.color_vec4[3]=e.color_vec4[3]
v(this.applied_style.color_vec4,e.color_vec4,t)}this.determineShader()}
GlovFont.prototype.ALIGN=L
GlovFont.prototype.style=fontStyle
GlovFont.prototype.styleAlpha=fontStyleAlpha
GlovFont.prototype.styleColored=fontStyleColored
function fontShadersInit(){if(g.font_aa)return
g.font_aa=l("shaders/font_aa.fp")
g.font_aa_glow=l("shaders/font_aa_glow.fp")
g.font_aa_outline=l("shaders/font_aa_outline.fp")
g.font_aa_outline_glow=l("shaders/font_aa_outline_glow.fp")
_(c.sprite_vshader,g.font_aa)
_(c.sprite_vshader,g.font_aa_glow)
_(c.sprite_vshader,g.font_aa_outline)
_(c.sprite_vshader,g.font_aa_outline_glow)}function fontCreate(e,t){fontShadersInit()
return new GlovFont(e,t)}function fontTick(){I=0
S.length=0
w=0
techParamsAlloc()}function fontSetReplacementChars(e){C=e}},{"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./engine.js":305,"./geom.js":318,"./localization.js":330,"./shaders.js":353,"./sprites.js":363,"./textures.js":365,assert:void 0}],316:[function(e,t,r){"use strict"
r.framebufferSkipRelease=framebufferSkipRelease
r.temporaryTextureClaim=temporaryTextureClaim
r.framebufferCapture=framebufferCapture
r.framebufferStart=framebufferStart
r.framebufferEnd=framebufferEnd
r.framebufferTopOfFrame=framebufferTopOfFrame
r.framebufferEndOfFrame=framebufferEndOfFrame
r.framebufferUpdateCanvasForCapture=framebufferUpdateCanvasForCapture
var u=e("assert")
var a=e("./browser.js").is_ios
var i=e("./cmds.js").cmd_parse
var o=e("./effects.js").applyCopy
var d=e("./engine.js")
var f=d.renderWidth,v=d.renderHeight
var n=e("./perf.js")
var h=e("./settings.js")
var s=e("./textures.js"),_=s.TEXTURE_FORMAT,l=s.textureCreateForCapture,c=s.textureCreateForDepthCapture
var p=0
var m=0
var E={}
var g={}
var T={}
var y=false
function resetFBOs(){y=true}var S=false
function framebufferSkipRelease(){S=true}var I=0
function getTemporaryTexture(e,t,r){var a=e+"_"+t
var i=r&&h.use_fbos
if(i)a+="_fbo"
var o=E[a]
if(!o)o=E[a]={list:[],idx:0}
if(o.idx>=o.list.length){var n=l("temp_"+a+"_"+ ++I)
if(i){n.allocFBO(e,t)
u(n.fbo)}o.list.push(n)}var s=o.list[o.idx++]
if(i)u(s.fbo)
return s}function bindTemporaryDepthbuffer(e,t){var r=e+"_"+t
var a=g[r]
if(!a)a=g[r]={list:[],idx:0}
if(a.idx>=a.list.length){var i=gl.createRenderbuffer()
gl.bindRenderbuffer(gl.RENDERBUFFER,i)
var o
if(h.fbo_depth16){gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,e,t)
o=gl.DEPTH_ATTACHMENT}else{gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,e,t)
o=gl.DEPTH_STENCIL_ATTACHMENT}gl.bindRenderbuffer(gl.RENDERBUFFER,null)
a.list.push({depth_buffer:i,attachment:o})}var n=a.list[a.idx++],s=n.depth_buffer,l=n.attachment
gl.framebufferRenderbuffer(gl.FRAMEBUFFER,l,gl.RENDERBUFFER,s)}function bindTemporaryDepthbufferTexture(e,t){var r=e+"_"+t
var a=T[r]
if(!a)a=T[r]={list:[],idx:0}
if(a.idx>=a.list.length){var i=c("temp_"+r+"_"+ ++I,h.fbo_depth16?_.DEPTH16:_.DEPTH24)
i.allocDepth(e,t)
var o=h.fbo_depth16?gl.DEPTH_ATTACHMENT:gl.DEPTH_STENCIL_ATTACHMENT
a.list.push({tex:i,attachment:o})}var n=a.list[a.idx++],s=n.tex,l=n.attachment
gl.framebufferTexture2D(gl.FRAMEBUFFER,l,gl.TEXTURE_2D,s.handle,0)
return s}function temporaryTextureClaim(e){for(var t in E){var r=E[t]
var a=r.list.indexOf(e)
if(-1!==a){r.list.splice(a,1)
if(r.idx>a)--r.idx
return}}u(false)}function framebufferCaptureStart(e,t,r,a){u.equal(d.viewport[0],0)
u.equal(d.viewport[1],0)
if(!t){t=f()
r=v()}if(!e)e=getTemporaryTexture(t,r,a)
e.captureStart(t,r)
return e}function framebufferCapture(e,t,r,a,i){(e=framebufferCaptureStart(e,t,r,false)).captureEnd(a,i)
return e}var A
var w
function framebufferStart(e){u(!A)
u(!w)
var t=e.width,r=e.height,a=e.viewport,i=e.final,o=e.clear,n=e.need_depth,s=e.clear_all,l=e.clear_color,_=e.force_tex
if(!t){t=f()
r=v()}++m
w=null
if(_){u(a);(A=_).captureStart()}else if(!i){A=framebufferCaptureStart(null,t,r,true)
if(h.use_fbos){u(A.fbo)
if(n)if("texture"===n)w=bindTemporaryDepthbufferTexture(t,r)
else bindTemporaryDepthbuffer(t,r)}}if(l)gl.clearColor(l[0],l[1],l[2],l[3])
if(o&&s){gl.disable(gl.SCISSOR_TEST)
gl.clear(gl.COLOR_BUFFER_BIT|(n?gl.DEPTH_BUFFER_BIT:0))}var c
if(a){d.setViewport(a)
c=a[0]||a[1]||a[2]!==d.width||a[3]!==d.height
if(s)c=false}else{d.setViewport([0,0,t,r])
c=t!==d.width}if(c){gl.enable(gl.SCISSOR_TEST)
if(a)gl.scissor(a[0],a[1],a[2],a[3])
else gl.scissor(0,0,t,r)}else gl.disable(gl.SCISSOR_TEST)
if(o&&!s)gl.clear(gl.COLOR_BUFFER_BIT|(n?gl.DEPTH_BUFFER_BIT:0))}function framebufferEnd(e){u(A)
var t=e=e||{},r=t.filter_linear,a=t.wrap,i=t.need_depth
u.equal(Boolean(w),"texture"===i)
A.captureEnd(r,a)
var o
if(w)o=[A,w]
else o=A
w=A=null
return o}function framebufferTopOfFrame(){w=A=null}function framebufferEndOfFrame(){u(!A)
p=m
m=0
S=S&&!y
for(var e in E){var t=E[e]
if(y)t.idx=0
if(!S)while(t.list.length>t.idx)t.list.pop().destroy()
if(!t.list.length)delete E[e]
else t.idx=0}for(var r in g){var a=g[r]
if(y)a.idx=0
if(!S)while(a.list.length>a.idx){var i=a.list.pop().depth_buffer
gl.deleteRenderbuffer(i)}if(!a.list.length)delete g[r]
else a.idx=0}for(var o in T){var n=T[o]
if(y)n.idx=0
if(!S)while(n.list.length>n.idx)n.list.pop().tex.destroy()
if(!n.list.length)delete T[o]
else n.idx=0}S=y=false}function framebufferUpdateCanvasForCapture(){if(A&&h.use_fbos){u(A.fbo)
var e=A
var t=d.viewport.slice(0)
framebufferEnd()
o({source:e,final:true,viewport:t})
framebufferStart({force_tex:e,viewport:t})
return e}else return{width:d.viewport[2],height:d.viewport[3]}}h.register({show_passes:{label:"Show Postprocessing Passes",default_value:0,type:i.TYPE_INT,range:[0,1]},use_fbos:{label:"Use Framebuffer Objects for postprocessing",default_value:a?1:0,type:i.TYPE_INT,range:[0,1],ver:1},fbo_depth16:{label:"Use 16-bit depth buffers for offscreen rendering",default_value:0,type:i.TYPE_INT,range:[0,1],on_change:resetFBOs},fbo_rgba:{label:"Use RGBA color buffers for offscreen rendering",default_value:0,type:i.TYPE_INT,range:[0,1],on_change:resetFBOs}})
y=false
n.addMetric({name:"passes",show_stat:"show_passes",labels:{"passes: ":function passes(){return p.toString()}}})},{"./browser.js":293,"./cmds.js":298,"./effects.js":304,"./engine.js":305,"./perf.js":340,"./settings.js":351,"./textures.js":365,assert:void 0}],317:[function(e,t,r){"use strict"
r.fscreenEnter=fscreenEnter
r.fscreenExit=fscreenExit
r.fscreenAvailable=fscreenAvailable
r.fscreenDisable=fscreenDisable
r.fscreenActive=fscreenActive
var a=e("../common/util.js").eatPossiblePromise
var i={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3}
var o=["fullscreenEnabled","fullscreenElement","requestFullscreen","exitFullscreen"]
var n=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen"]
var s=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen"]
var l=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen"]
var _=o[0]in document&&o||n[0]in document&&n||s[0]in document&&s||l[0]in document&&l||[]
function fscreenEnter(){var e=document.documentElement
a(e[_[i.requestFullscreen]]())}function fscreenExit(){a(document[_[i.exitFullscreen]]())}var c=false
function fscreenAvailable(){return!c&&Boolean(document[_[i.fullscreenEnabled]])}function fscreenDisable(){c=true}function fscreenActive(){return document[_[i.fullscreenElement]]}},{"../common/util.js":400}],318:[function(e,t,r){"use strict"
r.geomCreateIndices=geomCreateIndices
r.geomResetState=geomResetState
r.geomCreate=geomCreate
r.geomCreateQuads=geomCreateQuads
r.geomStartup=geomStartup
r.stats=r.QUADS=r.TRIANGLE_FAN=r.TRIANGLES=void 0
var u=e("assert")
var a=e("./cmds.js").cmd_parse
var n=e("./engine.js")
var i=e("./perf.js")
var o=e("./settings.js")
var s=e("./shaders.js").MAX_SEMANTIC
var l=Math.ceil,_=Math.max,c=Math.min
var d=4
r.TRIANGLES=d
var f=6
r.TRIANGLE_FAN=f
var v=7
r.QUADS=v
var h=65532
o.register({show_render_stats:{default_value:0,type:a.TYPE_INT,range:[0,1]}})
var p={draw_calls:0,draw_calls_geom:0,draw_calls_sprite:0,draw_calls_dyn:0,tris:0,verts:0,sprites:0,dyn:0,sprite_sort_elems:0,sprite_sort_cmps:0,font_calls:0,font_params:0}
r.stats=p
var m={}
var E={}
var g=function _loop(e){E[e+": "]=function(){return String(m[e])}}
for(var T in p)g(T)
i.addMetric({name:"render_stats",show_stat:"show_render_stats",show_all:true,labels:E})
var y={5120:1,5121:1,5122:2,5123:2,5126:4}
var S
var I=null
var A=null
var w
var L=0
function deleteBuffer(e){if(!e)return
if(I===e){gl.bindBuffer(gl.ARRAY_BUFFER,null)
I=null}if(A===e){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)
A=null}gl.deleteBuffer(e)}var O=0
function enableVertexAttribArray(e){if(e===O)return
var t=O&~e
var r=~O&e
O=e
if(t){var a=0
do{if(1&t)gl.disableVertexAttribArray(a)
a++
t>>=1}while(t)}if(r){var i=0
do{if(1&r)gl.enableVertexAttribArray(i)
i++
r>>=1}while(r)}}function getQuadIndexBuf(e){u(e<=h/4)
if(6*e>L){if(!w)w=gl.createBuffer()
else n.perf_state.gpu_mem.geom-=2*L
L=c(_(l(1.5*L),6*e),6*h/4)
if(A!==w){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,w)
A=w}var t=new Uint16Array(L)
var r=0
for(var a=0;a<L;){t[a++]=r+1
t[a++]=r+3
t[a++]=r++
t[a++]=r++
t[a++]=r++
t[a++]=r++}gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,t,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=2*L}return w}function geomCreateIndices(e){var t={ibo:gl.createBuffer(),ibo_size:e.length}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,t.ibo)
A=t.ibo
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,e,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=2*e.length
return t}function formatInfo(e){if(!e.info){var t=0
var r=0
var a=0
var i=0
for(var o=0;o<e.length;++o){var n=e[o]
var s=n[0]
var l=n[1]
var _=n[2]
a|=1<<s
var c=y[l]
u(c)
u(!i||c===i)
i=c
n[3]=n[3]||false
t+=_*(n[4]=c)
r+=_}e.info={stride:t,elem_count:r,used_attribs:a,common_byte_size:i}}return e.info}function Geom(e,t,r,a){this.mode=a||d
this.format=e
var i=this.format_info=formatInfo(e)
this.stride=i.stride
this.used_attribs=i.used_attribs
this.vert_count=t.length/this.format_info.elem_count
this.vert_gpu_mem=t.length*this.format_info.common_byte_size
if(t.length){this.vbo=gl.createBuffer()
gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
I=this.vbo
gl.bufferData(gl.ARRAY_BUFFER,t,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=this.vert_gpu_mem}this.orig_mode=a
if(r)if(r.ibo){this.ibo=r.ibo
this.ibo_owned=false
this.ibo_size=r.ibo_size}else if(r.length){this.ibo=gl.createBuffer()
this.ibo_owned=true
this.ibo_size=r.length
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,r,gl.STATIC_DRAW)
n.perf_state.gpu_mem.geom+=2*r.length}else{this.ibo=null
this.ibo_owned=true
this.ibo_size=0}else if(a===v){u.equal(this.vert_count%4,0)
var o=this.vert_count/4
this.ibo=getQuadIndexBuf(o)
this.ibo_owned=false
this.ibo_size=6*o
this.mode=d}else if(a===f)this.mode=f
else{this.ibo=null
this.ibo_owned=false}this.updateTriCount()}function trianglesFromMode(e,t){if(e===d)return t/3
else if(e===f)return t-2
else{u(!t)
return 0}}Geom.prototype.updateTriCount=function(){var e=this.ibo?this.ibo_size:this.vert_count
this.tri_count=trianglesFromMode(this.mode,e)}
Geom.prototype.updateIndex=function(e,t){u.equal(this.ibo_owned,true)
if(t>this.ibo_size){if(S===this)S=null
n.perf_state.gpu_mem.geom-=2*this.ibo_size
deleteBuffer(this.ibo)
this.ibo_size=e.length
this.ibo=gl.createBuffer()
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,e,gl.DYNAMIC_DRAW)
n.perf_state.gpu_mem.geom+=2*e.length}else{if(A!==this.ibo){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo}gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,e.subarray(0,t))}this.updateTriCount()}
Geom.prototype.updateSub=function(e,t){if(I!==this.vbo){gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
I=this.vbo}gl.bufferSubData(gl.ARRAY_BUFFER,e,t)}
Geom.prototype.update=function(e,t){if(t>this.vert_count){if(S===this)S=null
n.perf_state.gpu_mem.geom-=this.vert_gpu_mem
deleteBuffer(this.vbo)
this.vert_count=e.length/this.format_info.elem_count
this.vert_gpu_mem=e.length*this.format_info.common_byte_size
this.vbo=gl.createBuffer()
gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
I=this.vbo
gl.bufferData(gl.ARRAY_BUFFER,e,gl.DYNAMIC_DRAW)
n.perf_state.gpu_mem.geom+=this.vert_gpu_mem}else{if(I!==this.vbo){gl.bindBuffer(gl.ARRAY_BUFFER,this.vbo)
I=this.vbo}gl.bufferSubData(gl.ARRAY_BUFFER,0,e.subarray(0,t*this.format_info.elem_count))}if(this.orig_mode===v){u.equal(this.ibo_owned,false)
var r=t/4
this.ibo=getQuadIndexBuf(r)
this.ibo_size=6*r}this.updateTriCount()}
Geom.prototype.dispose=function(){if(this.ibo_owned)deleteBuffer(this.ibo)
this.ibo=null
deleteBuffer(this.vbo)
this.vbo=null
n.perf_state.gpu_mem.geom-=this.vert_gpu_mem
this.vert_gpu_mem=0}
var R=function(){var e=[]
for(var t=0;t<16;++t)e.push({vbo:null,offset:0})
return e}()
function geomResetState(){A=S=null
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)
I=null
gl.bindBuffer(gl.ARRAY_BUFFER,null)
for(var e=0;e<s;++e)gl.disableVertexAttribArray(e)
for(var t=O=0;t<R.length;++t)R[t].vbo=null
p.draw_calls=p.draw_calls_geom+p.draw_calls_sprite
for(var r in p){m[r]=p[r]
p[r]=0}}Geom.prototype.bind=function(){if(S!==this){var e=(S=this).vbo
var t=0
for(var r=0;r<this.format.length;++r){var a=this.format[r]
var i=a[2]
var o=a[4]
var n=a[0]
if(R[n].vbo===e);else{if(I!==e){gl.bindBuffer(gl.ARRAY_BUFFER,e)
I=e}var s=a[1]
var l=a[3]
gl.vertexAttribPointer(n,i,s,l,this.stride,t)
R[n].vbo=I}t+=i*o}enableVertexAttribArray(this.used_attribs)}if(this.ibo&&A!==this.ibo){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibo)
A=this.ibo}}
Geom.prototype.draw=function(){this.bind();++p.draw_calls_geom
p.tris+=this.tri_count
p.verts+=this.vert_count
if(this.ibo)gl.drawElements(this.mode,this.ibo_size,gl.UNSIGNED_SHORT,0)
else gl.drawArrays(this.mode,0,this.vert_count)}
Geom.prototype.drawSub=function(e,t){u.equal(this.mode,d)
this.bind();++p.draw_calls_geom
if(this.ibo){p.tris+=t
p.verts+=2*t
gl.drawElements(this.mode,3*t,gl.UNSIGNED_SHORT,2*e)}else gl.drawArrays(this.mode,e,3*t)}
function GeomMultiQuads(e,t){var r=formatInfo(e).elem_count
var a=t.length/r
this.geoms=[]
for(var i=0;i<a;i+=h){var o=c(a-i,h)
var n=new Uint8Array(t.buffer,i*r,o*r)
this.geoms.push(new Geom(e,n,null,v))}}GeomMultiQuads.prototype.draw=function(){for(var e=0;e<this.geoms.length;++e)this.geoms[e].draw()}
GeomMultiQuads.prototype.drawSub=function(e,t){for(var r=0;r<this.geoms.length&&t;++r){var a=this.geoms[r]
var i=a.vert_count/4
if(e<6*i){var o=c(t,2*(i-e/6))
a.drawSub(e,o)
t-=o
e=0}else e-=6*i}}
GeomMultiQuads.prototype.dispose=function(){for(var e=0;e<this.geoms.length;++e)this.geoms[e].dispose()
this.geoms=null}
function geomCreate(e,t,r,a){return new Geom(e,t,r,a)}function geomCreateQuads(e,t,r){var a=formatInfo(e)
u(r||t instanceof Uint8Array)
if(t.length/a.elem_count>h)return new GeomMultiQuads(e,t)
return new Geom(e,t,null,v)}function geomStartup(){}r.createIndices=geomCreateIndices
r.create=geomCreate
r.createQuads=geomCreateQuads},{"./cmds.js":298,"./engine.js":305,"./perf.js":340,"./settings.js":351,"./shaders.js":353,assert:void 0}],319:[function(e,t,r){"use strict"
r.decode=decode
var o=new Array(128)
var n=String.fromCodePoint||String.fromCharCode
var s=[]
function decode(e){var t
var r
var a=e.length
for(var i=s.length=0;i<a;){if((r=e[i++])<=127)t=r
else if(r<=223)t=(31&r)<<6|63&e[i++]
else if(r<=239)t=(15&r)<<12|(63&e[i++])<<6|63&e[i++]
else if(String.fromCodePoint)t=(7&r)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++]
else{t=63
i+=3}s.push(o[t]||(o[t]=n(t)))}return s.join("")}},{}],320:[function(e,t,r){"use strict"
r.getAccessorTypeFromSize=getAccessorTypeFromSize
r.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY=r.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE=r.ATTRIBUTE_TYPE_TO_COMPONENTS=void 0
var a=["SCALAR","VEC2","VEC3","VEC4"]
function getAccessorTypeFromSize(e){return a[e-1]||a[0]}var i={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}
r.ATTRIBUTE_TYPE_TO_COMPONENTS=i
var o={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4}
r.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE=o
var n={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}
r.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY=n},{}],321:[function(e,t,r){"use strict"
var d=e("assert")
var a=e("./unpack-glb-buffers.js").unpackGLBBuffers
var i=e("./unpack-binary-json.js").unpackBinaryJson
function padTo4Bytes(e){return e+3&-4}var f=e("./decode-utf8.js")
var o=e("./gltf-type-utils.js"),l=o.ATTRIBUTE_TYPE_TO_COMPONENTS,_=o.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,c=o.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY
var v=1735152710
var h=12
var p=8
var m=1313821514
var E=5130562
var g=true
var T=false
function GLBParser(){this.binaryByteOffset=null
this.packedJson=null
this.json=null}function parseBinary(e){var t=new DataView(e.glbArrayBuffer)
var r=t.getUint32(0,T)
var a=t.getUint32(4,g)
var i=t.getUint32(8,g)
if(!(r===v))console.warn("Invalid GLB magic string")
d(2===a,"Invalid GLB version "+a+". Only .glb v2 supported")
d(i>20)
var o=t.getUint32(12,g)
var n=t.getUint32(16,g)
d(n===m||0===n,"JSON chunk format "+n)
var s=h+p
var l=new Uint8Array(e.glbArrayBuffer,s,o)
var _=f.decode(l)
e.json=JSON.parse(_)
var c=s+padTo4Bytes(o)
e.binaryByteOffset=c+p
var u=t.getUint32(c+4,g)
d(u===E||1===u,"BIN chunk format "+u)
return{arrayBuffer:e.glbArrayBuffer,binaryByteOffset:e.binaryByteOffset,json:e.json}}function parseInternal(e){var t=parseBinary(e)
e.packedJson=t.json
e.unpackedBuffers=a(e.glbArrayBuffer,e.json,e.binaryByteOffset)
e.json=i(e.json,e.unpackedBuffers)}GLBParser.prototype.parseSync=function(e){this.glbArrayBuffer=e
if(null===this.json&&null===this.binaryByteOffset)parseInternal(this)
return this}
GLBParser.prototype.parse=function(e){return this.parseSync(e)}
GLBParser.prototype.getApplicationData=function(e){return this.json[e]}
GLBParser.prototype.getJSON=function(){return this.json}
GLBParser.prototype.getArrayBuffer=function(){return this.glbArrayBuffer}
GLBParser.prototype.getBinaryByteOffset=function(){return this.binaryByteOffset}
GLBParser.prototype.getBufferView=function(e){var t=(e.byteOffset||0)+this.binaryByteOffset
return new Uint8Array(this.glbArrayBuffer,t,e.byteLength)}
GLBParser.prototype.getBuffer=function(e){var t=c[e.componentType]
var r=l[e.type]
var a=_[e.componentType]
var i=e.count*r
var o=e.count*r*a
var n=this.json.bufferViews[e.bufferView]
d(o>=0&&e.byteOffset+o<=n.byteLength)
var s=n.byteOffset+this.binaryByteOffset+e.byteOffset
return new t(this.glbArrayBuffer,s,i)}
GLBParser.prototype.getImageData=function(e){return{typedArray:this.getBufferView(e.bufferView),mimeType:e.mimeType||"image/jpeg"}}
GLBParser.prototype.getImage=function(e){var t=this.getBufferView(e.bufferView)
var r=e.mimeType||"image/jpeg"
var a=new Blob([t],{type:r})
var i=(window.URL||window.webkitURL).createObjectURL(a)
var o=new Image
o.src=i
return o};(t.exports=GLBParser).parse=function(e){return(new GLBParser).parse(e)}},{"./decode-utf8.js":319,"./gltf-type-utils.js":320,"./unpack-binary-json.js":322,"./unpack-glb-buffers.js":323,assert:void 0}],322:[function(e,t,r){"use strict"
r.unpackBinaryJson=unpackBinaryJson
function parseJSONPointer(e){if("string"===typeof e){if(0===e.indexOf("##/"))return e.slice(1)
var t=e.match(/#\/([a-z]+)\/([0-9]+)/)
if(t){var r=parseInt(t[2],10)
return[t[1],r]}if(t=e.match(/\$\$\$([0-9]+)/))return["accessors",parseInt(t[1],10)]}return null}function decodeJSONPointer(e,t){var r=parseJSONPointer(e)
if(r){var a=r[0]
var i=r[1]
var o=t[a]&&t[a][i]
if(o)return o
console.error("Invalid JSON pointer "+e+": #/"+a+"/"+i)}return null}function unpackJsonArraysRecursive(e,t,r,a){if(void 0===a)a={}
var i=e
var o=decodeJSONPointer(i,r)
if(o)return o
if(Array.isArray(i))return i.map(function(e){return unpackJsonArraysRecursive(e,t,r,a)})
if(null!==i&&"object"===typeof i){var n={}
for(var s in i)n[s]=unpackJsonArraysRecursive(i[s],t,r,a)
return n}return i}function unpackBinaryJson(e,t,r){if(void 0===r)r={}
return unpackJsonArraysRecursive(e,e,t,r)}},{}],323:[function(e,t,r){"use strict"
r.unpackGLBBuffers=unpackGLBBuffers
var d=e("assert")
var a=e("./gltf-type-utils.js"),s=a.ATTRIBUTE_TYPE_TO_COMPONENTS,l=a.ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE,_=a.ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY
function getArrayBufferAtOffset(e,t){var r=e.byteLength-t
var a=new ArrayBuffer(r)
var i=new Uint8Array(e)
var o=new Uint8Array(a)
for(var n=0;n<r;n++)o[n]=i[t+n]
return a}function getArrayTypeAndLength(e,t){var r=_[e.componentType]
var a=s[e.type]
var i=l[e.componentType]
var o=e.count*a
var n=e.count*a*i
d(n>=0&&n<=t.byteLength)
return{ArrayType:r,length:o,byteLength:n}}function unpackAccessors(e,t,r){var a=r.accessors||[]
var i=[]
for(var o=0;o<a.length;++o){var n=a[o]
d(n)
var s=t[n.bufferView]
if(s){var l=getArrayTypeAndLength(n,s),_=l.ArrayType,c=l.length
var u=new _(e,s.byteOffset,c)
u.accessor=n
i.push(u)}}return i}function unpackImages(e,t,r){var a=r.images||[]
var i=[]
for(var o=0;o<a.length;++o){var n=a[o]
d(n)
if(void 0===n.bufferView){i.push(null)
continue}var s=t[n.bufferView]
d(s)
var l=new Uint8Array(e,s.byteOffset,s.byteLength)
l.imate=n
i.push(l)}return i}function unpackGLBBuffers(e,t,r){if(r)e=getArrayBufferAtOffset(e,r)
var a=t.bufferViews||[]
for(var i=0;i<a.length;++i){var o=a[i]
d(o.byteLength>=0)}return{accessors:unpackAccessors(e,a,t),images:unpackImages(e,a,t)}}},{"./gltf-type-utils.js":320,assert:void 0}],324:[function(e,t,r){"use strict"
var l=Math.max,_=Math.min,c=Math.floor
r.rgbToHSV=function rgbToHSV(e,t){var r=t[0]
var a=t[1]
var i=t[2]
var o=_(r,a,i)
var n=l(r,a,i)
var s=(e[2]=n)-o
if(0!==s)e[1]=s/n
else{e[1]=0
e[0]=0
return}if(r===n)e[0]=(a-i)/s
else if(a===n)e[0]=2+(i-r)/s
else e[0]=4+(r-a)/s
e[0]*=60
if(e[0]<0)e[0]+=360}
r.hsvToRGB=function hsvToRGB(e,t,r,a){if(0===r){e[0]=e[1]=e[2]=a
return e}if((t/=60)>=6)t-=6
var i=c(t)
var o=t-i
var n=a*(1-r)
var s=a*(1-r*o)
var l=a*(1-r*(1-o))
switch(i){case 0:e[0]=a
e[1]=l
e[2]=n
break
case 1:e[0]=s
e[1]=a
e[2]=n
break
case 2:e[0]=n
e[1]=a
e[2]=l
break
case 3:e[0]=n
e[1]=s
e[2]=a
break
case 4:e[0]=l
e[1]=n
e[2]=a
break
default:e[0]=a
e[1]=n
e[2]=s}return e}},{}],325:[function(e,t,r){"use strict"
r.topOfFrame=topOfFrame
r.on=on
r.handle=handle
var _=e("assert")
var c={}
function topOfFrame(){c={}}function on(e,t,r){var a=c[e]=c[e]||[]
if("number"===typeof t)a[t]=r
else a.push([t,r])}function handle(e,t){var r=c[e]
if(!r)return
switch(e){case"keydown":case"keyup":if(r[t.keyCode])r[t.keyCode](e,t)
break
case"mouseup":case"mousedown":var a=t.pageX
var i=t.pageY
var o=t.button
for(var n=0;n<r.length;++n){var s=r[n]
var l=s[0]
if(a>=l.x&&a<l.x+l.w&&i>=l.y&&i<l.y+l.h&&(l.button<0||l.button===o)){s[1](e,t)
break}}break
default:_(false)}}},{assert:void 0}],326:[function(e,t,m){"use strict"
m.inputTouchMode=inputTouchMode
m.inputPadMode=inputPadMode
m.inputEatenMouse=inputEatenMouse
m.pointerLocked=pointerLocked
m.pointerLockEnter=pointerLockEnter
m.pointerLockJustEntered=pointerLockJustEntered
m.pointerLockExit=pointerLockExit
m.inputAllowAllEvents=inputAllowAllEvents
m.inputSetEventFilter=inputSetEventFilter
m.inputLastTime=inputLastTime
m.debugGetMouseMoveX=debugGetMouseMoveX
m.handleTouches=handleTouches
m.startup=startup
m.fakeTouchEvent=fakeTouchEvent
m.tickInput=tickInput
m.endFrame=endFrame
m.tickInputInactive=tickInputInactive
m.eatAllInput=eatAllInput
m.eatAllKeyboardInput=eatAllKeyboardInput
m.mousePos=mousePos
m.mouseDomPos=mouseDomPos
m.mouseMoved=mouseMoved
m.mouseButtonHadEdge=mouseButtonHadEdge
m.mouseButtonHadUpEdge=mouseButtonHadUpEdge
m.mouseWheel=mouseWheel
m.mouseOverCaptured=mouseOverCaptured
m.mouseOver=mouseOver
m.mouseDownAnywhere=mouseDownAnywhere
m.mouseDownMidClick=mouseDownMidClick
m.mouseDownOverBounds=mouseDownOverBounds
m.mousePosIsTouch=mousePosIsTouch
m.numTouches=numTouches
m.keyDown=keyDown
m.keyDownEdge=keyDownEdge
m.keyUpEdge=keyUpEdge
m.padGetAxes=padGetAxes
m.padButtonDown=padButtonDown
m.padButtonDownEdge=padButtonDownEdge
m.padButtonUpEdge=padButtonUpEdge
m.mouseUpEdge=mouseUpEdge
m.mouseDownEdge=mouseDownEdge
m.mouseConsumeClicks=mouseConsumeClicks
m.drag=drag
m.longPress=longPress
m.dragDrop=dragDrop
m.dragOver=dragOver
m.pad_mode=m.touch_mode=m.PAD=m.KEYS=m.inputDrag=m.inputClick=m.click=void 0
var r=e("./input_constants")
var _=e("assert")
var s=0
var E=0
var g=1
var l=2
var T=true
var a=true
var i=false
var o=mouseUpEdge
m.click=o
var n=mouseUpEdge
m.inputClick=n
var c=drag
m.inputDrag=c;(0,e("../common/util.js").deprecate)(m,"mouseDown","mouseDownAnywhere, mouseDownMidClick, mouseDownOverBounds")
var u=e("./input_constants")
var d=u.ANY
var f=u.POINTERLOCK
for(var v in r)if("default"!==v)m[v]=r[v]
var h={BACKSPACE:8,TAB:9,ENTER:13,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INS:45,DEL:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL_POINT:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUALS:187,COMMA:188,MINUS:189,PERIOD:190,SLASH:191,TILDE:192}
m.KEYS=h
if("function"===typeof Proxy)m.KEYS=h=new Proxy(h,{get:function get(e,t){var r=e[t]
_(r)
return r}})
var p={A:0,SELECT:0,B:1,CANCEL:1,X:2,Y:3,LB:4,LEFT_BUMPER:4,RB:5,RIGHT_BUMPER:5,LT:6,LEFT_TRIGGER:6,RT:7,RIGHT_TRIGGER:7,BACK:8,START:9,LEFT_STICK:10,RIGHT_STICK:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,ANALOG_UP:20,ANALOG_LEFT:21,ANALOG_DOWN:22,ANALOG_RIGHT:23,LSTICK_UP:20,LSTICK_LEFT:21,LSTICK_DOWN:22,LSTICK_RIGHT:23,RSTICK_UP:24,RSTICK_LEFT:25,RSTICK_DOWN:26,RSTICK_RIGHT:27}
m.PAD=p
var y=e("./browser.js"),S=y.is_firefox,I=y.is_mac_osx
var A=e("./camera2d.js")
var w=e("./cmds.js").cmd_parse
var L=e("./engine.js")
var O=e("./engine.js").renderNeeded
var R=e("./in_event.js")
var b=e("./local_storage.js")
var N=Math.abs,C=Math.max,x=Math.min,M=Math.sqrt
var D=e("./pointer_lock.js")
var P=e("./settings.js")
var B=e("./sound.js").soundResume
var k=e("./spot.js").spotMouseoverHook
var U=e("../common/util.js").empty
var G=e("../common/vmath.js"),F=G.vec2,W=G.v2add,H=G.v2copy,z=G.v2lengthSq,V=G.v2set,Y=G.v2scale,j=G.v2sub
var K
var q
var Z={}
var X=[]
var Q=[]
var $=F()
var J=F()
var ee=false
var te=false
var re=[]
var ae=[]
var ie=0
var oe=2
var ne=false
var se=false
var le={}
var _e=true
var ce=b.getJSON("touch_mode",false)
var ue=!(m.touch_mode=ce)&&b.getJSON("pad_mode",false)
m.pad_mode=ue
w.registerValue("mouse_log",{type:w.TYPE_INT,range:[0,1],get:function get(){return i},set:function set(e){return i=e}})
function inputTouchMode(){return ce}function inputPadMode(){return ue}function inputEatenMouse(){return se}function eventTimestamp(e){if(e&&e.timeStamp){if(e.timeStamp<1e12!==L.hrtime<1e12)return L.hrtime
return e.timeStamp}return L.hrtime}function TouchData(e,t,r,a){this.delta=F()
this.total=0
this.cur_pos=e.slice(0)
this.start_pos=e.slice(0)
this.touch=t
this.button=r
this.start_time=Date.now()
this.dispatched=false
this.dispatched_drag=false
this.dispatched_drag_over=false
this.was_double_click=false
this.up_edge=0
this.down_edge=0
this.state=g
this.down_time=0
this.origin_time=eventTimestamp(a)}TouchData.prototype.down=function(e,t){if(t)this.down_edge++
this.state=g
this.origin_time=eventTimestamp(e)}
var de=.01
function timeDelta(e,t){var r=eventTimestamp(e)
return C(r-t,de)}function KeyData(){this.down_edge=0
this.origin_time=0
this.down_time=0
this.up_edge=0
this.state=E}KeyData.prototype.keyUp=function(e){++this.up_edge
this.down_time+=timeDelta(e,this.origin_time)
this.state=E}
function setMouseToMid(){V($,.5*L.width/A.domToCanvasRatio(),.5*L.height/A.domToCanvasRatio())}function pointerLocked(){return D.isLocked()}var fe="m"+f
var ve=-1
function pointerLockEnter(e){D.enter(e)}function onPointerLockEnter(){if(ce)return
ve=L.frame_index
var e=le[fe]
setMouseToMid()
if(e){H(e.start_pos,$)
e.state=g
e.origin_time=L.hrtime}else e=le[fe]=new TouchData($,false,f,null)
ie=oe}function pointerLockJustEntered(e){return L.frame_index<=ve+(e||1)}function pointerLockExit(){var e=le[fe]
if(e){H(e.cur_pos,$)
e.state=E}D.exit()
ie=oe}var he
var pe={isTrusted:1,sourceCapabilities:1,path:1,currentTarget:1,view:1}
function eventlog(e){if(e===he)return
var t=[]
for(var r in he=e){var a=e[r]
if(!a||"function"===typeof a||r.toUpperCase()===r||pe[r])continue
t.push(r+":"+(a.id||a))}console.log(L.frame_index+" "+e.type+" "+(pointerLocked()?"ptrlck":"unlckd")+" "+t.join(","))}var me=false
function inputAllowAllEvents(e){me=e}function isInputElement(e){return e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"LABEL"===e.tagName||"VIDEO"===e.tagName)}function letWheelEventThrough(e){return me||isInputElement(e.target)}var Ee=function event_filter(){return false}
function inputSetEventFilter(e){Ee=e}function letEventThrough(e){if(!e.target||me||e.glov_do_not_cancel)return true
return isInputElement(e.target)||String(e.target.className).includes("noglov")||Ee(e)}function ignored(e){if(!letEventThrough(e)){e.preventDefault()
e.stopPropagation()}}var ge=false
var Te=false
function beforeUnload(e){if(Te&&ge){pointerLockExit()
e.preventDefault()
e.returnValue="Are you sure you want to quit?"}else L.releaseCanvas()}function protectUnload(e){Te=e}var ye=0
function inputLastTime(){return ye}function onUserInput(){B()
ye=Date.now()
O()}function releaseAllKeysDown(e){for(var t in Z){var r=Z[t]
if(r.state===g)r.keyUp(e)}}function onKeyUp(e){O()
protectUnload(e.ctrlKey)
var t=e.keyCode
if(!letEventThrough(e)){e.stopPropagation()
e.preventDefault()}if(t===h.ESC&&pointerLocked())pointerLockExit()
var r=Z[t]
if(r&&r.state===g)if(I&&"Meta"===e.key)releaseAllKeysDown(e)
else r.keyUp(e)
R.handle("keyup",e)}function onKeyDown(e){protectUnload(e.ctrlKey)
var t=e.keyCode
if(!(letEventThrough(e)||t>=h.F5&&t<=h.F12||t===h.I&&(e.altKey&&e.metaKey||e.ctrlKey&&e.shiftKey)||t===h.R&&e.ctrlKey||(t===h.LEFT||t===h.RIGHT)&&e.altKey)){e.stopPropagation()
e.preventDefault()}onUserInput()
var r=Z[t]
if(!r)r=Z[t]=new KeyData
if(r.state!==g){++r.down_edge
r.state=g
r.origin_time=eventTimestamp(e)
R.handle("keydown",e)}}var Se=0
function debugGetMouseMoveX(){var e=Se
Se=0
return e}var Ie=false
var Ae=false
var we=false
var Le=F()
var Oe=0
var Re=0
var be=0
var Ne=0
function onMouseMove(e,t){O()
if(!letEventThrough(e)&&!t&&3!==e.button){e.preventDefault()
e.stopPropagation()
if(ce){b.setJSON("touch_mode",false)
m.touch_mode=ce=false}if(ue){b.setJSON("pad_mode",false)
m.pad_mode=ue=false}}Ie=true
$[0]=e.pageX
$[1]=e.pageY
ee=false
var r=e.movementX||e.mozMovementX||e.webkitMovementX||0
var a=e.movementY||e.mozMovementY||e.webkitMovementY||0
Se+=r
var i=false
if(pointerLocked()){setMouseToMid()
if(r||a){var o=e.timeStamp||Date.now()
var n=N(r)
var s=N(a)
var l=n+s
if(l>200&&(l>3*Oe||o-Re>1e3))console.log("Ignoring mousemove with sudden large delta: "+r+","+a)
else if(S&&r===be&&a===Ne&&n<2&&s<2);else{V(Le,r||0,a||0)
i=true}Oe=l
Re=o
be=r
Ne=a}}else{j(Le,$,J)
if(Le[0]||Le[1])i=true
H(J,$)}if(i&&ie&&z(Le)>1e4)i=false
if(i)for(var _=f;_<re.length;++_)if(re[_]||_===f&&pointerLocked()){var c=le["m"+_]
if(c){W(c.delta,c.delta,Le)
c.total+=N(Le[0])+N(Le[1])
H(c.cur_pos,$)}}}function onMouseDown(e){if(i)eventlog(e)
onMouseMove(e)
onUserInput()
var t=letEventThrough(e)
var r=e.button
re[r]=true
var a="m"+r
if(le[a])H(le[a].start_pos,$)
else le[a]=new TouchData($,false,r,e)
le[a].down(e,!t)
if(!t)R.handle("mousedown",e)
Ae=true
if(window.focus)window.focus()}var Ce=[{timestamp:0,pos:F()},{timestamp:0,pos:F()}]
function registerMouseUpEdge(e,t){e.up_edge++
var r=Ce[0]
Ce[0]=Ce[1]
Ce[1]=r
H(r.pos,e.cur_pos)
r.timestamp=t}function onMouseUp(e){if(i)eventlog(e)
onMouseMove(e)
var t=letEventThrough(e)
var r=e.button
if(re[r]){var a=le["m"+r]
if(a){H(a.cur_pos,$)
if(!t)registerMouseUpEdge(a,eventTimestamp(e))
a.state=E
a.down_time+=timeDelta(e,a.origin_time)}delete re[r]}we=Ae=true
if(!t)R.handle("mouseup",e)}function onWheel(e){O()
var t=Ie
onMouseMove(e,true)
Ie=t
var r=-e.deltaY||e.wheelDelta||-e.detail
ae.push({pos:[e.pageX,e.pageY],delta:r>0?1:-1,dispatched:false})
if(!letWheelEventThrough(e)){e.stopPropagation()
e.preventDefault()}}var xe=F()
var Me=0
function onTouchChange(e){onUserInput()
if(!ce){b.set("touch_mode",true)
m.touch_mode=ce=true}if(ue){b.set("pad_mode",false)
m.pad_mode=ue=false}if(false!==e.cancelable)e.preventDefault()
var t=e.touches
var r={}
var a=t.length
var i=0
var o
for(var n=0;n<t.length;++n){var s=t[n]
try{if(!isFinite(s.pageX)||!isFinite(s.pageY)){--a
continue}}catch(e){--a
continue}if(!o)o=s
var l=le[s.identifier]
V(xe,s.pageX,s.pageY)
if(!l){(l=le[s.identifier]=new TouchData(xe,true,0,e)).down(e,true)
Ae=true
R.handle("mousedown",s)}else{++i
j(Le,xe,l.cur_pos)
W(l.delta,l.delta,Le)
l.total+=N(Le[0])+N(Le[1])
H(l.cur_pos,xe)}r[s.identifier]=true
if(T&&1===a){H($,xe)
ee=true}}var _
var c=[]
for(var u in le)if(!r[u]){var d=le[u]
if(d.touch&&d.state===g){++i
_=d
c.push(u)
R.handle("mouseup",{pageX:d.cur_pos[0],pageY:d.cur_pos[1]})
registerMouseUpEdge(d,eventTimestamp(e))
we=Ae=true
d.state=E
d.down_time+=timeDelta(e,d.origin_time)
d.release=true}}for(var f=0;f<c.length;++f){var v=c[f]
var h=le[v]
var p="r"+ ++Me
delete le[v]
le[p]=h}if(T)if(1===i&&0===a){delete re[0]
H($,_.cur_pos)
ee=true}else if(1===a){if(!i)re[0]=true
V($,o.pageX,o.pageY)
ee=true}else if(a>1)delete re[0]}function onBlurOrFocus(e){O()
protectUnload(false)
releaseAllKeysDown(e)}var De={}
function genAnalogMap(){if(a){De[p.LEFT]=[p.LSTICK_LEFT,p.RSTICK_LEFT]
De[p.RIGHT]=[p.LSTICK_RIGHT,p.RSTICK_RIGHT]
De[p.UP]=[p.LSTICK_UP,p.RSTICK_UP]
De[p.DOWN]=[p.LSTICK_DOWN,p.RSTICK_DOWN]}}var Pe=false
function handleTouches(e){e.addEventListener("touchstart",onTouchChange,Pe)
e.addEventListener("touchmove",onTouchChange,Pe)
e.addEventListener("touchend",onTouchChange,Pe)
e.addEventListener("touchcancel",onTouchChange,Pe)}function startup(e,t){q=e
D.startup(q,onPointerLockEnter)
if(void 0!==t.map_analog_to_dpad)a=t.map_analog_to_dpad
K=t.pad_to_touch
genAnalogMap()
try{var r=Object.defineProperty({},"passive",{get:function get(){Pe={passive:false}
return false}})
window.addEventListener("test",null,r)
window.removeEventListener("test",null,r)}catch(e){Pe=false}window.addEventListener("keydown",onKeyDown,false)
window.addEventListener("keyup",onKeyUp,false)
window.addEventListener("click",ignored,false)
window.addEventListener("contextmenu",ignored,false)
window.addEventListener("mousemove",onMouseMove,false)
window.addEventListener("mousedown",onMouseDown,false)
window.addEventListener("mouseup",onMouseUp,false)
if(window.WheelEvent)window.addEventListener("wheel",onWheel,Pe)
else{window.addEventListener("DOMMouseScroll",onWheel,false)
window.addEventListener("mousewheel",onWheel,false)}window.addEventListener("blur",onBlurOrFocus,false)
window.addEventListener("focus",onBlurOrFocus,false)
handleTouches(q)
window.addEventListener("beforeunload",beforeUnload,false)}var Be=.26
var ke=Be*Be
var Ue=2
var Ge=.35
function getGamepadData(e){var t=Q[e]
if(!t){t=Q[e]={id:e,timestamp:0,sticks:new Array(Ue)}
for(var r=0;r<Ue;++r)t.sticks[r]=F()
X[e]={}}return t}function updatePadState(e,t,r,a){if(r&&!t[a]){t[a]=l
onUserInput()
if(ce){b.set("touch_mode",false)
m.touch_mode=ce=false}if(!ue){b.setJSON("pad_mode",true)
m.pad_mode=ue=true}if(a===K){var i="g"+e.id
if(le[i]){setMouseToMid()
H(le[i].start_pos,$)}else le[i]=new TouchData($,false,0,null)
le[i].down(null,true)}}else if(!r&&t[a]){t[a]=s
if(a===K){var o="g"+e.id
var n=le[o]
if(n){setMouseToMid()
H(n.cur_pos,$)
registerMouseUpEdge(n,L.hrtime)
n.state=E
n.down_time+=C(L.hrtime-n.origin_time,de)}}}}function gamepadUpdate(){var e
try{e=navigator.gamepads||navigator.webkitGamepads||navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads()}catch(e){}if(e){var t=e.length
for(var r=0;r<t;r++){var a=e[r]
if(!a)continue
var i=getGamepadData(r)
var o=X[r]
if(i.timestamp<a.timestamp){var n=a.buttons
i.timestamp=a.timestamp
var s=n.length
for(var l=0;l<s;l++){var _=n[l]
if("object"===typeof _)_=_.value
updatePadState(i,o,_=_>.5,l)}}var c=a.axes
if(c.length>=2*Ue){for(var u=0;u<Ue;++u){var d=i.sticks[u]
V(d,c[2*u],-c[2*u+1])
var f=z(d)
if(f>ke){f=M(f)
Y(d,d,1/f)
f=x(f,1)
Y(d,d,f=(f-Be)/(1-Be))}else V(d,0,0)
if(u<=1&&void 0!==K){var v=le["g"+i.id]
if(v){Y(Le,d,L.frame_dt)
W(v.delta,v.delta,Le)
v.total+=N(Le[0])+N(Le[1])
setMouseToMid()
H(v.cur_pos,$)}}}updatePadState(i,o,i.sticks[0][0]<-Ge,p.LSTICK_LEFT)
updatePadState(i,o,i.sticks[0][0]>Ge,p.LSTICK_RIGHT)
updatePadState(i,o,i.sticks[0][1]<-Ge,p.LSTICK_DOWN)
updatePadState(i,o,i.sticks[0][1]>Ge,p.LSTICK_UP)
updatePadState(i,o,i.sticks[1][0]<-Ge,p.RSTICK_LEFT)
updatePadState(i,o,i.sticks[1][0]>Ge,p.RSTICK_RIGHT)
updatePadState(i,o,i.sticks[1][1]<-Ge,p.RSTICK_DOWN)
updatePadState(i,o,i.sticks[1][1]>Ge,p.RSTICK_UP)}}}}function fakeTouchEvent(e){var t="faketouch"
var r=le[t]
if(r&&!e){setMouseToMid()
H(r.cur_pos,$)
registerMouseUpEdge(r,L.hrtime)
r.state=E
r.down_time+=C(L.hrtime-r.origin_time,de)}else if(!r&&e){setMouseToMid()
le[t]=new TouchData($,false,0,null)}}function tickInput(){if(ie)--ie
var e=L.hrtime
for(var t in Z){var r=Z[t]
if(r.state===g){r.down_time+=C(e-r.origin_time,de)
r.origin_time=e}}for(var a in le){var i=le[a]
if(i.state===g){i.down_time+=C(e-i.origin_time,de)
i.origin_time=e}}te=false
gamepadUpdate()
R.topOfFrame()
ge=false
if(le[fe]&&!pointerLocked())pointerLockExit()
_e=U(le)}function endFrameTickMap(t){Object.keys(t).forEach(function(e){switch(t[e]){case l:t[e]=g
break
case s:delete t[e]}})}function endFrame(e){for(var t in Z){var r=Z[t]
if(r.state===E){Z[t]=null
delete Z[t]}else{r.up_edge=0
r.down_edge=0
r.down_time=0}}X.forEach(endFrameTickMap)
if(!e){for(var a in le){var i=le[a]
if(i.state===E){le[a]=null
delete le[a]}else{i.delta[0]=i.delta[1]=0
i.dispatched=false
i.dispatched_drag=false
i.dispatched_drag_over=false
if(i.drag_payload_frame===L.frame_index-2)i.drag_payload=null
i.up_edge=0
i.down_edge=0
i.down_time=0}}ae.length=0
we=Ae=Ie=se=false}ne=false}function tickInputInactive(){R.topOfFrame()
ge=false
endFrame()}function eatAllInput(e){endFrame(e)
if(!e)se=te=true
ne=true}function eatAllKeyboardInput(){eatAllInput(true)}function mousePos(e){e=e||F()
A.domToVirtual(e,$)
return e}function mouseDomPos(){return $}function mouseMoved(){return Ie}function mouseButtonHadEdge(){return Ae}function mouseButtonHadUpEdge(){return we}var Fe={}
function mousePosParamUnique(e){var t=(e=e||Fe).mouse_pos_param
if(!t)t=e.mouse_pos_param={}
t.x=void 0===e.x?A.x0Real():e.x
t.y=void 0===e.y?A.y0Real():e.y
t.w=void 0===e.w?A.wReal():e.w
t.h=void 0===e.h?A.hReal():e.h
t.button=void 0===e.button?d:e.button
return t}var We={}
function mousePosParam(e){We.x=void 0===(e=e||{}).x?A.x0Real():e.x
We.y=void 0===e.y?A.y0Real():e.y
We.w=void 0===e.w?A.wReal():e.w
We.h=void 0===e.h?A.hReal():e.h
We.button=void 0===e.button?d:e.button
return We}var He=F()
function checkPos(e,t){if(!A.domToVirtual(He,e))return false
return He[0]>=t.x&&(Infinity===t.w||He[0]<t.x+t.w)&&He[1]>=t.y&&(Infinity===t.h||He[1]<t.y+t.h)}function wasDoubleClick(e){if(L.hrtime-Ce[0].timestamp>P.double_click_time)return false
return checkPos(Ce[0].pos,e)}function mouseWheel(e){if(se||!ae.length)return 0
var t=mousePosParam(e=e||{})
var r=0
for(var a=0;a<ae.length;++a){var i=ae[a]
if(i.dispatched)continue
if(checkPos(i.pos,t)){r+=i.delta
i.dispatched=true}}return r}function mouseOverCaptured(){te=true}function mouseOver(e){profilerStart("mouseOver")
var t=mousePosParamUnique(e=e||{})
k(t,e)
if(te||pointerLocked()&&!e.allow_pointerlock){profilerStop("mouseOver")
return false}if(!e.peek&&!e.peek_touch)for(var r in le){var a=le[r]
if(checkPos(a.cur_pos,t)){if(a.down_edge)a.down_edge=0
if(a.up_edge)a.up_edge=0
if(!e||!e.drag_target)a.dispatched=true}}var i=false
if(checkPos($,t)){if(!e.peek&&!e.peek_over)te=true
i=true}profilerStop("mouseOver")
return i}function mouseDownAnywhere(e){if(se)return false
if(void 0===e)e=d
for(var t in le){var r=le[t]
if(r.state!==g||!(e===d||e===r.button))continue
return true}return false}function mouseDownMidClick(e){if(se||_e)return false
var t=mousePosParam(e=e||{})
var r=t.button
var a=e.max_dist||50
for(var i in le){var o=le[i]
if(o.state!==g||!(r===d||r===o.button)||o.total>a)continue
if(checkPos(o.cur_pos,t))return true}return false}function mouseDownOverBounds(e){if(se||_e)return false
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in le){var i=le[a]
if(i.state!==g||!(r===d||r===i.button))continue
if(checkPos(i.cur_pos,t))return true}return false}function mousePosIsTouch(){return ee}function numTouches(){return Object.keys(le).length}function keyDown(e){if(e===h.CTRL)ge=true
if(ne)return 0
var t=Z[e]
if(!t)return 0
if(t.state===g)_(t.down_time)
return t.down_time}function keyDownEdge(e,t){if(ne)return 0
if(t&&t.in_event_cb)R.on("keydown",e,t.in_event_cb)
var r=Z[e]
if(!r)return 0
var a=r.down_edge
r.down_edge=0
return a}function keyUpEdge(e,t){if(ne)return 0
if(t&&t.in_event_cb)R.on("keyup",e,t.in_event_cb)
var r=Z[e]
if(!r)return 0
var a=r.up_edge
r.up_edge=0
return a}function padGetAxes(e,t,r){_(t>=0&&t<Ue)
if(void 0===r){var a=F()
V(e,0,0)
for(var i=0;i<Q.length;++i){padGetAxes(a,t,i)
W(e,e,a)}return}var o=getGamepadData(r).sticks
H(e,o[t])}function padButtonDownInternal(e,t,r){if(t[r])return L.frame_dt
return 0}function padButtonDownEdgeInternal(e,t,r){if(t[r]===l){t[r]=g
return 1}return 0}function padButtonUpEdgeInternal(e,t,r){if(t[r]===s){delete t[r]
return 1}return 0}function padButtonShared(e,t,r){_(void 0!==t)
var a=0
if(void 0===r){for(var i=0;i<X.length;++i)a+=padButtonShared(e,t,i)
return a}if(se)return 0
var o=Q[r]
if(!o)return 0
var n=X[r]
var s=De[t]
if(s)for(var l=0;l<s.length;++l)a+=e(o,n,s[l])||0
return a+e(o,n,t)}function padButtonDown(e,t){return padButtonShared(padButtonDownInternal,e,t)}function padButtonDownEdge(e,t){return padButtonShared(padButtonDownEdgeInternal,e,t)}function padButtonUpEdge(e,t){return padButtonShared(padButtonUpEdgeInternal,e,t)}var ze=F()
var Ve=F()
var Ye=F()
function mouseUpEdge(e){e=e||{}
if(se||!e.in_event_cb&&_e)return null
var t=mousePosParam(e)
var r=t.button
var a=e.max_dist||50
var i=false
for(var o in le){var n=le[o]
if(n.total>a){i=true
continue}if(n.long_press_dispatched){i=true
continue}if(!n.up_edge)continue
if(!(r===d||r===n.button))continue
if(checkPos(n.cur_pos,t)){if(!e.peek)n.up_edge=0
return{button:n.button,pos:He.slice(0),start_time:n.start_time,was_double_click:wasDoubleClick(t)}}}if(e.in_event_cb&&!te&&!i){if(!e.phys)e.phys={}
e.phys.button="number"===typeof e.in_event_button?e.in_event_button:r
A.virtualToDomPosParam(e.phys,t)
R.on("mouseup",e.phys,e.in_event_cb)}return null}function mouseDownEdge(e){e=e||{}
if(se||!e.in_event_cb&&_e)return null
var t=mousePosParam(e)
var r=t.button
for(var a in le){var i=le[a]
if(!i.down_edge||!(r===d||r===i.button))continue
if(checkPos(i.cur_pos,t)){if(!e.peek)i.down_edge=0
return{button:i.button,pos:He.slice(0),start_time:i.start_time}}}if(e.in_event_cb&&!te){if(!e.phys)e.phys={}
e.phys.button=r
A.virtualToDomPosParam(e.phys,t)
R.on("mousedown",e.phys,e.in_event_cb)}return null}function mouseConsumeClicks(e){if(_e)return
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in le){var i=le[a]
if(!(r===d||r===i.button)||i.dispatched_drag)continue
if(checkPos(i.start_pos,t)){i.down_edge=0
i.start_pos[0]=i.start_pos[1]=Infinity
i.total=Infinity}}}function drag(e){if(se||_e)return null
var t=void 0!==(e=e||{}).w&&isFinite(e.w)
var r=mousePosParam(e)
var a=r.button
var i=e.min_dist||0
for(var o in le){var n=le[o]
if(!(a===d||a===n.button)||n.dispatched_drag||o===e.not_touch_id)continue
if(checkPos(n.start_pos,r)){if(pointerLocked()&&t)continue
A.domDeltaToVirtual(Ye,[n.total/2,n.total/2])
var s=Ye[0]+Ye[1]
if(s<i)continue
if(!e.peek)n.dispatched_drag=true
var l=n.down_edge
if(e.eat_clicks)n.down_edge=n.up_edge=0
if(e.payload){n.drag_payload=e.payload
n.drag_payload_frame=L.frame_index}A.domToVirtual(ze,n.start_pos)
A.domToVirtual(Ve,n.cur_pos)
A.domDeltaToVirtual(Ye,n.delta)
return{cur_pos:Ve,start_pos:ze,delta:Ye,total:s,button:n.button,touch:n.touch,start_time:n.start_time,is_down_edge:l,down_time:n.down_time,touch_id:o,dropped:n.up_edge}}}return null}function longPress(e){if(se||_e)return null
var t=mousePosParam(e=e||{})
var r=t.button
var a=e.long_press_max_dist||50
var i=e.min_time||500
for(var o in le){var n=le[o]
if(!(r===d||r===n.button)||n.long_press_dispatched)continue
if(checkPos(n.start_pos,t)){A.domDeltaToVirtual(Ye,[n.total/2,n.total/2])
var s=Ye[0]+Ye[1]
if(s>a)continue
if(Date.now()-n.start_time<i)continue
if(!e.peek)n.long_press_dispatched=true
var l=n.down_edge
if(e.eat_clicks)n.down_edge=n.up_edge=0
A.domToVirtual(ze,n.start_pos)
A.domToVirtual(Ve,n.cur_pos)
A.domDeltaToVirtual(Ye,n.delta)
return{long_press:true,cur_pos:Ve,start_pos:ze,delta:Ye,total:s,button:n.button,touch:n.touch,start_time:n.start_time,is_down_edge:l,down_time:n.down_time}}}return null}function dragDrop(e){if(se||_e)return null
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in le){var i=le[a]
if(!(r===d||r===i.button)||i.dispatched||!i.drag_payload)continue
if(!i.up_edge)continue
if(checkPos(i.cur_pos,t)){if(!e.peek){i.dispatched_drag_over=true
i.dispatched_drag=true
i.dispatched=true}return{drag_payload:i.drag_payload}}}return null}function dragOver(e){if(se||_e)return null
var t=mousePosParam(e=e||{})
var r=t.button
for(var a in le){var i=le[a]
if(!(r===d||r===i.button)||i.dispatched_drag_over||!i.drag_payload)continue
if(i.state!==g)continue
if(checkPos(i.cur_pos,t)){if(!e.peek)i.dispatched_drag_over=true
A.domToVirtual(Ve,i.cur_pos)
return{cur_pos:Ve,drag_payload:i.drag_payload}}}return null}},{"../common/util.js":400,"../common/vmath.js":402,"./browser.js":293,"./camera2d.js":295,"./cmds.js":298,"./engine.js":305,"./in_event.js":325,"./input_constants":327,"./local_storage.js":329,"./pointer_lock.js":342,"./settings.js":351,"./sound.js":358,"./spot.js":361,assert:void 0}],327:[function(e,t,r){"use strict"
r.POINTERLOCK=r.ANY=r.BUTTON_POINTERLOCK=r.BUTTON_ANY=r.BUTTON_RIGHT=r.BUTTON_MIDDLE=r.BUTTON_LEFT=void 0
var a=0
r.BUTTON_LEFT=a
var i=1
r.BUTTON_MIDDLE=i
var o=2
r.BUTTON_RIGHT=o
var n=-2
r.BUTTON_ANY=n
var s=-1
r.BUTTON_POINTERLOCK=s
var l=n
r.ANY=l
var _=s
r.POINTERLOCK=_},{}],328:[function(e,t,r){"use strict"
r.linkGetDefaultStyle=linkGetDefaultStyle
r.linkSetDefaultStyle=linkSetDefaultStyle
r.linkObscureRect=linkObscureRect
r.link=link
r.linkText=linkText
r.linkTick=linkTick
var T=e("assert")
var E=e("../common/verify")
var g=e("./engine.js")
var a=e("./font.js").fontStyle
var y=e("./camera2d.js")
var S=e("./in_event.js")
var I=e("./input.js")
var A=Math.abs
var i=e("./ui.js"),w=i.playUISound,L=i.uiGetDOMElem
var O=e("./ui.js")
var R=e("./uistyle.js").uiStyleCurrent
var b=e("./settings.js")
var o=e("./spot.js"),N=o.SPOT_DEFAULT_BUTTON,C=o.spot,x=o.spotFocusSteal,M=o.spotKey
var D=Math.max,P=Math.min
var B=a(null,{color:1346437119,outline_width:1,outline_color:32})
var k=a(null,{color:65535,outline_width:1,outline_color:32})
function linkGetDefaultStyle(){return B}function linkSetDefaultStyle(e,t){B=e
k=t}var U=[]
function linkObscureRect(e){if(!e.dom_pos)e.dom_pos={}
y.virtualToDomPosParam(e.dom_pos,e)
U.push(e.dom_pos)}function linkClipRect(e){if(!e.dom_pos)e.dom_pos={}
y.virtualToDomPosParam(e.dom_pos,e)
var t=e.dom_pos
var r=t.x
var a=r+t.w
var i=t.y
var o=i+t.h
var n=r
var s=a
var l=i
var _=o
for(var c=0;c<U.length;++c){var u=U[c]
if(u.x<=n&&u.x+u.w>=s){if(u.y<=l)l=D(l,u.y+u.h)
if(u.y+u.h>=_)_=P(_,u.y)}if(u.y<=l&&u.y+u.h>=_){if(u.x<=n)n=D(n,u.x+u.w)
if(u.x+u.w>=s)s=P(s,u.x)}}if(s<=n||_<=l)return false
if(n!==r||s!==a){var d=t.w
var f=(n-r)/d
var v=(s-n)/d
e.x+=f*e.w
e.w*=v}if(l!==i||_!==o){var h=t.h
var p=(l-i)/h
var m=(_-l)/h
e.y+=p*e.h
e.h*=m}return true}var G={}
var F=/https?:\/\//
function preventFocus(e){e.preventDefault()
if(e.relatedTarget)e.relatedTarget.focus()
else e.currentTarget.blur()}function link(e){var t=e.x,r=e.y,a=e.w,i=e.h,o=e.url,n=e.internal,s=e.allow_modal
if(!o.match(F))o=document.location.protocol+"//"+o
var l=M(e)
var _=G[l]
if(!_)_=G[l]={clicked:false}
E(_.frame!==g.frame_index)
_.frame=g.frame_index
var c={x:t,y:r,w:a,h:i}
if(y.clipTestRect(c)&&linkClipRect(c)&&!(b.shader_debug||b.show_profiler)){var u=L(_.elem,s)
if(u!==_.elem)if(_.elem=u){u.textContent=""
var d=document.createElement("a")
d.setAttribute("draggable",false)
d.textContent=" "
d.className="glovui_link noglov"
d.setAttribute("target","_blank")
d.setAttribute("href",o)
d.setAttribute("tabindex","-1")
d.addEventListener("focus",preventFocus)
_.url=o
if(n){var f
var v
I.handleTouches(d)
d.onmousedown=function(e){f=e.pageX
v=e.pageY}
d.onclick=function(e){e.preventDefault()
if(f)if(A(e.pageX-f)+A(e.pageY-v)>50)return
_.clicked=true
S.handle("mouseup",e)}}u.appendChild(d)
_.a_elem=d}if(u){if(o!==_.url){_.a_elem.setAttribute("href",o)
_.url=o}var h=y.htmlPos(c.x,c.y)
u.style.left=h[0]+"%"
u.style.top=h[1]+"%"
var p=y.htmlSize(c.w,c.h)
u.style.width=p[0]+"%"
u.style.height=p[1]+"%"}}var m=_.clicked
_.clicked=false
return m}function linkText(e){var t=e.style_link,r=e.style_link_hover,a=e.x,i=e.y,o=e.z,n=e.style,s=e.font_size,l=e.text,_=e.url,c=e.internal
l=l||_
o=o||Z.UI
n=n||R()
s=s||n.text_height
var u=O.font.getStringWidth(t||B,s,l)
var d=s
e.w=u
e.h=d
e.def=N
delete e.url
var f=C(e)
e.url=_
var v=f.focused?r||k:t||B
O.font.drawSized(v,a,i,o,s,l)
var h=1
O.drawLine(a,i+d-h,a+u,i+d-h,o-.5,h,1,v.color_vec4)
var p=link(e)
if(p){var m=void 0===e.sound_button?e.def.sound_button:e.sound_button
if(m)w(m)
x(e)}if(f.ret&&!c){var E=M(e)
var g=G[E]
T(g)
T(g.a_elem)
g.a_elem.click()}return p||f.ret}function linkTick(){for(var e in G)if(G[e].frame!==g.frame_index-1)delete G[e]
U.length=0}},{"../common/verify":401,"./camera2d.js":295,"./engine.js":305,"./font.js":315,"./in_event.js":325,"./input.js":326,"./settings.js":351,"./spot.js":361,"./ui.js":367,"./uistyle.js":368,assert:void 0}],329:[function(e,t,r){"use strict"
r.setStoragePrefix=setStoragePrefix
r.getStoragePrefix=getStoragePrefix
r.localStorageGet=localStorageGet
r.localStorageSet=localStorageSet
r.localStorageSetJSON=localStorageSetJSON
r.localStorageGetJSON=localStorageGetJSON
r.localStorageClearAll=localStorageClearAll
r.localStorageExportAll=localStorageExportAll
r.localStorageImportAll=localStorageImportAll
var _=e("assert")
var c="demo"
var a=false
function setStoragePrefix(e){if(a)return
a=true
c=e}function getStoragePrefix(){_(a)
return c}var u=function(){try{localStorage.setItem("test","test")
localStorage.removeItem("test")
return localStorage}catch(e){return null}}()
var d={}
function localStorageGet(e){_(a)
var t=d[e=c+"_"+e]||u&&u.getItem(e)
if("undefined"===t)t=void 0
else if(null===t)t=void 0
return t}function localStorageSet(e,t){_(a)
e=c+"_"+e
if(void 0===t||null===t){if(u)u.removeItem(e)
delete d[e]}else{var r=String(t)
d[e]=r
try{if(u)u.setItem(e,r)}catch(e){}}}function localStorageSetJSON(e,t){localStorageSet(e,JSON.stringify(t))}function localStorageGetJSON(e,t){var r=localStorageGet(e)
if(void 0===r)return t
try{return JSON.parse(r)}catch(e){}return t}function localStorageClearAll(e){var t=new RegExp("^"+c+"_"+(e||""),"u")
if(u){var r=[]
for(var a=0;a<u.length;a++){var i=u.key(a)
_(i)
if(i.match(t))r.push(i)}for(var o=0;o<r.length;o++)u.removeItem(r[o])}for(var n in d)if(n.match(t))delete d[n]}function localStorageExportAll(e){var t={}
var r=new RegExp("^"+c+"_("+(e||"")+".*)")
if(u)for(var a=0;a<u.length;a++){var i=u.key(a)
_(i)
var o=i.match(r)
if(o){var n=u.getItem(i)
if(n&&"undefined"!==n)t[o[1]]=n}}for(var s in d){var l=s.match(r)
if(l)t[l[1]]=d[s]}return t}function localStorageImportAll(e){localStorageClearAll()
for(var t in e)localStorageSet(t,e[t])}r.get=localStorageGet
r.set=localStorageSet
r.setJSON=localStorageSetJSON
r.getJSON=localStorageGetJSON
r.clearAll=localStorageClearAll},{assert:void 0}],330:[function(e,t,r){"use strict"
r.getStringFromLocalizable=getStringFromLocalizable
r.getStringIfLocalizable=getStringIfLocalizable
function getStringFromLocalizable(e){return e&&e.toLocalString?e.toLocalString():e}function getStringIfLocalizable(e){return e&&e.toLocalString?e.toLocalString():e}},{}],331:[function(e,t,r){"use strict"
r.locateAsset=locateAsset
r.locateAssetDisableHashing=locateAssetDisableHashing
r.unlocatePaths=unlocatePaths
var i="undefined"===typeof window?{}:window.glov_asset_mappings
var o=i&&i.asset_dir||""
function locateAsset(e){if(!i)return e
var t=i[e]
if(!t)return e
var r=o+"/"+t
var a=e.lastIndexOf(".")
if(-1!==a)r+=e.slice(a)
return r}function locateAssetDisableHashing(){i={}}function unlocatePaths(e){var r=Object.create(null)
for(var t in i)r[i[t]]=t
return String(e).replace(new RegExp(o+"/([a-zA-Z0-9]+)\\.\\w+","g"),function(e,t){return r[t]||e})}},{}],332:[function(e,t,r){"use strict"
r.markdownLayoutInvalidate=markdownLayoutInvalidate
r.markdownIsAllWhitespace=markdownIsAllWhitespace
r.markdownPrep=markdownPrep
r.markdownDims=markdownDims
r.markdownDraw=markdownDraw
r.markdownAuto=markdownAuto
r.markdownLabel=markdownLabel
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var k=e("assert")
var l=e("../common/util").has
var U=e("../common/verify")
var a=e("../common/vmath")
var u=a.unit_vec
var i=a.vec4
var m=e("./engine")
var o=e("./font")
var G=o.ALIGN
var F=o.EPSILON
var n=o.fontStyleAlpha
var _=o.fontStyleBold
var s=o.fontStyleHash
var E=e("./input").mousePos
var c=e("./localization").getStringFromLocalizable
var d=e("./markdown_parse")
var f=d.mdParse
var v=d.mdParseSetValidRenderables
var h=e("./markdown_renderables")
var p=h.markdownLayoutFit
var g=h.markdown_default_font_styles
var T=h.markdown_default_renderables
var y=e("./spot")
var S=y.SPOT_DEFAULT_LABEL
var I=y.spot
var A=y.spotPadMode
var w=e("./sprites")
var L=w.spriteClipPause
var O=w.spriteClipResume
var R=w.spriteClipped
var b=w.spriteClippedViewport
var N=e("./ui")
var C=N.drawElipse
var x=N.drawRect2
var M=N.getUIElemData
var W=N.uiFontStyleNormal
var H=N.uiGetFont
var z=N.uiTextHeight
var D=Math.ceil,P=Math.floor,V=Math.max,Y=Math.min,j=Math.round
function markdownLayoutInvalidate(e){if(e.cache){var t=e
if(t.cache.layout)delete t.cache.layout}}var B=function(){function MDBlockParagraph(e,t){this.content=void 0
this.content=mdASTToBlock(e,t)}MDBlockParagraph.prototype.layout=function layout(e){var t=[]
for(var r=0;r<this.content.length;++r)t.push(this.content[r].layout(e))
if(e.align&G.HWRAP){if(e.cursor.x!==e.cursor.line_x0){e.cursor.line_x0=e.cursor.x=e.indent
e.cursor.y+=e.line_height}e.cursor.y+=D(.5*e.line_height)}else e.cursor.x+=D(.25*e.text_height)
return Array.prototype.concat.apply([],t)}
return MDBlockParagraph}()
function createParagraph(e,t){return new B(e,t)}var K=function(){function MDBlockBold(e,t){this.content=void 0
this.content=mdASTToBlock(e,t)}MDBlockBold.prototype.layout=function layout(e){var t=e.font_style
var r=e.font_style_idx+".bold"
var a=e.font_styles
var i=a[r]
if(!i){var o=a[e.font_style_idx]||g[e.font_style_idx]||a.def
i=a[r]=_(o,.5)}e.font_style=i
var n=[]
for(var s=0;s<this.content.length;++s)n.push(this.content[s].layout(e))
e.font_style=t
return Array.prototype.concat.apply([],n)}
return MDBlockBold}()
function createBold(e,t){return new K(e,t)}var q=i(0,0,0,.5)
var X=G.VTOP|G.VCENTER|G.VBOTTOM|G.HFIT
var Q=function(){function MDDrawBlockText(e){this.alpha_font_style_cache=void 0
this.alpha_font_style_cache_value=void 0
this.dims=e}MDDrawBlockText.prototype.draw=function draw(e){profilerStart("MDDrawBlockText::draw")
var t=this.dims
var r=t.font_style
if(1!==e.alpha){if(this.alpha_font_style_cache_value!==e.alpha){this.alpha_font_style_cache_value=e.alpha
this.alpha_font_style_cache=n(r,e.alpha)}r=this.alpha_font_style_cache}t.font.drawSizedAligned(r,e.x+t.x,e.y+t.y,e.z,t.h,t.align&X,t.w,t.h,t.text)
profilerStop()}
return MDDrawBlockText}()
var $=function(){function MDBlockText(e,t){this.content=e}MDBlockText.prototype.layout=function layout(o){var n=o.cursor,s=o.line_height,l=o.text_height
var _=[]
var e=this.content
if(!(o.align&G.HWRAP))e=e.replace(/\n/g," ")
if(o.align&G.HWRAP){var c=n.x
var t=n.x
var u=o.w-t
var r=o.indent-t
var d=(s-l)/2
if(o.font.integral)d=j(d)
o.font.wrapLines(o.font_style,u,r,l,e,o.align,function(e,t,r,a){if(t>0){n.y+=s
n.line_x0=o.indent
n.line_y1=n.y}var i={font:o.font,font_style:o.font_style,x:c+e,y:n.y+d,h:l,w:Y(a,u)-e,align:o.align,text:r}
n.line_y1=V(n.line_y1,n.y+s)
_.push(new Q(i))})
if(_.length){var a=_[_.length-1]
n.x=a.dims.x+a.dims.w}else n.x+=o.font.getStringWidth(o.font_style,l,e)}else{var i=o.font.getStringWidth(o.font_style,l,e)
var f={x:-1,y:-1,font:o.font,font_style:o.font_style,h:l,w:i,align:o.align,text:e}
p(o,f)
_.push(new Q(f))}return _}
return MDBlockText}()
function createText(e,t){return new $(e,t)}function createRenderable(e,t){var r=t.custom||{}
var a=t.renderables||T
var i=e.type
var o
if(l(r,i)){var n=r[i]
i=n.type
o=n.data}k(l(a,i))
var s=a[i](e,o)
if(s)return s
return createText(e.orig_text,t)}var J={paragraph:createParagraph,text:createText,strong:createBold,em:createBold,renderable:createRenderable}
function mdASTToBlock(e,t){var r=[]
var a=0
for(var i=0;i<e.length;++i){if(a){--a
continue}var o=e[i]
if("text"===o.type){var n=void 0
while((n=e[i+a+1])&&"text"===n.type){o.content+=n.content;++a}}var s=J[o.type]
r.push(s(o.content,t))}return r}function markdownParse(e){var t=e.cache
if(t.parsed)return
profilerStart("markdownParse")
var r=(e.renderables?e.renderables:T)||{}
if(e.custom){r=_extends({},r)
for(var a in e.custom)r[a]=true}v(r)
var i=f(c(e.text))
var o=t.parsed=mdASTToBlock(i,e)
t.parsed=o
profilerStop("markdownParse")}function markdownIsAllWhitespace(e){var t=(e.renderables?e.renderables:T)||{}
v(t)
function treeContainsNonWhitespace(e){for(var t=0;t<e.length;++t){var r=e[t]
if("text"===r.type){if(r.content.trim())return true}else if("paragraph"===r.type||"em"===r.type||"strong"===r.type){if(treeContainsNonWhitespace(r.content))return true}else if("renderable"===r.type)return true
else U.unreachable(r)}return false}return!treeContainsNonWhitespace(f(c(e.text)))}function cmpDimsY(e,t){var r=e.dims.y-t.dims.y
if(0!==r)return r
if(0!==(r=e.dims.x-t.dims.x))return r
return 0}function markdownLayout(e){var t=e.cache
if(t.layout)return
profilerStart("markdownLayout")
var r=e.font_style||W()
var a
if(e.font_styles)if(e.font_styles.def)a=e.font_styles
else a=_extends({def:r},e.font_styles)
else a={def:r}
var i=e.text_height||z()
var o=e.line_height||i
var n={w:e.w||0,h:e.h||0,text_height:i,line_height:o,indent:e.indent||0,align:e.align||0,font:e.font||H(),font_style:r,font_styles:a,font_style_idx:e.font_style_idx||"def",cursor:{line_x0:0,line_y1:0,x:0,y:0}}
var s=t.parsed
k(s)
var l=[]
var _=0
var c=Infinity
var u=0
for(var d=0;d<s.length;++d){var f=s[d].layout(n)
for(var v=0;v<f.length;++v){var h=f[v]
var p=h.dims
_=V(_,p.x+p.w)
u=V(u,p.y+p.h)
c=Y(c,p.y)
l.push(h)}}var m=V(0,n.cursor.line_y1-u)
if(n.align&(G.HRIGHT|G.HCENTER)&&l.length){var E=n.line_height/2
var g=0
var T=l[0].dims
for(var y=1;y<l.length+1;++y){var S=y===l.length
var I=S
if(!S){var A=l[y].dims
if(A.y+A.h/2>T.y+T.h/2+E&&A.x<T.x+T.w/2)I=true}if(I){var w=n.w-(T.x+T.w)
if(n.align&G.HCENTER){w*=.5
if(n.font.integral)w=j(w)}if(w>0)for(var L=g;L<y;++L)l[L].dims.x+=w
g=y}if(!S)T=l[y].dims}}if(n.align&G.HFIT&&_>n.w+F){var O=n.w/_
for(var R=0;R<l.length;++R){var b=l[R]
var N=b.dims.x
var C=N+b.dims.w
b.dims.x=N*O
b.dims.w=(C-N)*O}}if(l.length&&n.align&(G.VCENTER|G.VBOTTOM))if(U(n.h)){var x=n.h-u
if(n.align&G.VCENTER){x-=c
x*=.5
if(n.font.integral)x=j(x)}for(var M=0;M<l.length;++M)l[M].dims.y+=x}var D=u=_=0
for(var P=0;P<l.length;++P){var B=l[P]
_=V(_,B.dims.x+B.dims.w)
u=V(u,B.dims.y+B.dims.h)
D=V(D,B.dims.h)}u+=m
l.sort(cmpDimsY)
t.layout={blocks:l,dims:{w:_,h:u},max_block_h:D}
profilerStop("markdownLayout")}function markdownPrep(e){markdownParse(e)
markdownLayout(e)}function markdownDims(e){var t=e.cache.layout
k(t)
return t.dims}function bsearch(e,t){var r=0
var a=e.length-1
while(r<a){var i=P((r+a)/2)
if(e[i].dims.y<=t)r=i+1
else a=i}return a}function markdownDraw(e){profilerStart("markdownDraw")
var t=e.cache.layout
k(t)
var r=e.x,a=e.y,i=e.alpha
if(void 0===i)i=1
var o={x:r,y:a,z:e.z||Z.UI,alpha:i}
var n=e.viewport
if(!n&&R())n=b()
var s=t.blocks,l=t.max_block_h
var _=0
var c=s.length-1
if(n){_=bsearch(s,n.y-a-l)
c=bsearch(s,n.y+n.h-a)}var u
if(m.defines.MD)u=E()
for(var d=_;d<=c;++d){var f=s[d]
var v=f.dims
if(!n||r+v.x+v.w>=n.x&&r+v.x<n.x+n.w&&a+v.y+v.h>=n.y&&a+v.y<n.y+n.h){f.draw(o)
if(m.defines.MD){var h={x:o.x+v.x,y:o.y+v.y,z:Z.TOOLTIP,w:v.w,h:v.h,color:q}
if(u[0]>=h.x&&u[0]<=h.x+h.w&&u[1]>=h.y&&u[1]<=h.y+h.h){var p=R()
if(p)L()
x(h)
if(p)O()}}}}profilerStop("markdownDraw")}function mdcAlloc(){return{}}function markdownAuto(e){profilerStart("markdownAuto")
var t=e
k(!e.custom||t.cache)
var r=!t.cache
if(r){profilerStart("auto_cache")
var a=e.text=c(e.text)
var i=["mdc",e.w||0,e.h||0,e.text_height||z(),e.line_height||e.text_height||z(),e.indent||0,e.align||0,e.font_style?s(e.font_style):0].join(":")
t.cache=M(i,{key:a},mdcAlloc)
profilerStop()}var o=e
markdownPrep(o)
var n=markdownDims(o)
markdownDraw(o)
if(r)delete e.cache
profilerStop("markdownAuto")
return n}function markdownLabel(e){var t=e.tooltip
var r=markdownAuto(e)
if(t){var a=e.align,i=e.x,o=e.y,n=e.z,s=e.tooltip_above,l=e.tooltip_right
n=n||Z.UI
a=a||0
var _=e.w||r.w
var c=e.h||r.h
if(I({x:i,y:o,w:_,h:c,tooltip:t,tooltip_width:e.tooltip_width,tooltip_above:s,tooltip_right:Boolean(l||a&G.HRIGHT),tooltip_center:Boolean(a&G.HCENTER),def:S}).focused&&A())C(i-.25*_,o-.25*c,i+1.25*_,o+1.25*c,n-.001,.5,u)}return r}},{"../common/util":400,"../common/verify":401,"../common/vmath":402,"./engine":305,"./font":315,"./input":326,"./localization":330,"./markdown_parse":333,"./markdown_renderables":334,"./spot":361,"./sprites":363,"./ui":367,assert:void 0}],333:[function(e,t,r){"use strict"
r.mdParseSetValidRenderables=mdParseSetValidRenderables
r.mdParse=mdParse
r.mdEscape=mdEscape
var a=e("./simple-markdown")
var i=e("../common/util").has
var o=/^\[([^\s\]=]+)(=?[^\s\]]*)( [^\]]+)?\](?!\()/
var n=/ ([^=]+)(?:=(?:"([^"]+)"|(\S+)))?/g
var s={}
function mdParseSetValidRenderables(e){s=e}var l={renderable:{order:a.defaultRules.link.order-.5,match:function match(e){var t=o.exec(e)
if(t){var r=t[1]
if(t[2].startsWith("="))t[2]=t[2].slice(1)
else if(!r.startsWith("/"))return null
if(i(s,r))return t}return null},parse:function parse(e,t,r){var _
if(e[3]){_={}
e[3].replace(n,function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a]
var i=r[0],o=r[1],n=r[2]
var s=void 0!==o?o:void 0!==n?n:true
if("string"===typeof s){var l=Number(s)
if(isFinite(l))s=l}_[i]=s
return""})}return{content:{type:e[1],key:e[2],param:_,orig_text:e[0]}}}}};["paragraph","escape","em","strong","text"].forEach(function(e){return l[e]=a.defaultRules[e]})
var _=a.parserFor(l)
function mdParse(e){return _(e+"\n\n",{inline:false})}function mdEscape(e){return e.replace(/([\\[*_])/g,"\\$1")}},{"../common/util":400,"./simple-markdown":354}],334:[function(e,t,r){"use strict"
r.markdownRenderableAddDefault=markdownRenderableAddDefault
r.markdownSetColorStyle=markdownSetColorStyle
r.markdownSetColorStyles=markdownSetColorStyles
r.markdownLayoutFit=markdownLayoutFit
r.markdownImageRegister=markdownImageRegister
r.markdownImageRegisterSpriteSheet=markdownImageRegisterSpriteSheet
r.markdown_default_font_styles=r.markdown_default_renderables=void 0
var a={}
r.markdown_default_renderables=a
var n={}
r.markdown_default_font_styles=n
var i=e("assert")
var l=e("../common/verify")
var o=e("../common/vmath")
var s=o.unit_vec
var _=o.vec4
var c=e("./font")
var u=c.ALIGN
var d=c.EPSILON
var f=c.fontStyleColored
var v=e("./ui").sprites
var h=Math.floor,p=Math.max
function markdownRenderableAddDefault(e,t){a[e]=t}function markdownSetColorStyle(e,t){n[e]=t}function markdownSetColorStyles(e){for(var t=0;t<e.length;++t)n[t]=e[t]}markdownSetColorStyles([255,4280295679,553591039,539033599,4294967295].map(function(e){return f(null,e)}))
function markdownLayoutFit(e,t){var r=e.cursor,a=e.line_height
if(r.x+t.w>e.w+d&&r.x!==r.line_x0&&e.align&u.HWRAP){r.x=r.line_x0=e.indent
r.y+=a
r.line_y1=r.y}if(r.x+t.w>e.w+d&&e.align&u.HWRAP)t.w=e.w-r.line_x0
t.x=r.x
if(t.h!==a){t.y=r.y+(a-t.h)/2
if(e.font.integral)t.y=h(t.y)
r.line_y1=p(r.line_y1,r.y+a,t.y+t.h)}else{t.y=r.y
r.line_y1=p(r.line_y1,r.y+a)}r.x+=t.w
return true}var m=Object.create(null)
function markdownImageRegister(e,t){i(t.sprite)
i(!m[e]||t.override)
m[e]=t}function markdownImageRegisterSpriteSheet(e){var t=e.sprite
for(var r in e.tiles)markdownImageRegister(r,{sprite:t,frame:e.tiles[r]})}function getImageData(e){return m[e]||{sprite:v.white}}var E=function(){function MDRImg(e){this.key=void 0
this.scale=void 0
this.aspect=void 0
this.dims=void 0
this.x=void 0
this.y=void 0
this.w=void 0
this.h=void 0
this.alpha_color_cache=void 0
this.alpha_color_cache_value=void 0
this.key=e.key
this.dims=this
var t=e.param&&e.param.scale
this.scale=t&&"number"===typeof t?t:1
var r=e.param&&e.param.aspect
this.aspect=r&&"number"===typeof r?r:0}var e=MDRImg.prototype
e.layout=function layout(e){var t=e.line_height
var r=this.h=t*this.scale
var a=getImageData(this.key)
var i=a.sprite,o=a.frame
var n=1
if("number"===typeof o&&i.uidata){if(i.uidata.aspect)n=i.uidata.aspect[o]}else if(i.isLazyLoad()){l(this.aspect)
n=this.aspect||1}else if(this.aspect)n=this.aspect
else{var s=i.texs[0]
n=s.width/s.height}this.w=r*n
markdownLayoutFit(e,this)
return[this]}
e.draw=function draw(e){profilerStart("MDRImg::draw")
var t=this.x+e.x
var r=this.y+e.y
var a=getImageData(this.key)
var i=a.color
if(1!==e.alpha){if(e.alpha!==this.alpha_color_cache_value){this.alpha_color_cache_value=e.alpha
i=i||s
this.alpha_color_cache=_(i[0],i[1],i[2],i[3]*e.alpha)}i=this.alpha_color_cache}a.sprite.draw({x:t,y:r,z:e.z,w:this.w,h:this.h,frame:a.frame,color:i})
profilerStop()}
return MDRImg}()
function createMDRImg(e){return new E(e)}markdownRenderableAddDefault("img",createMDRImg)
var g=function(){function MDRColorStart(e){this.key=void 0
this.key=e.key}MDRColorStart.prototype.layout=function layout(e){var t=e.font_styles,r=e.font_style_idx,a=e.font_style_stack
if(!a)a=e.font_style_stack=[]
a.push(r)
if(r===this.key);else{var i=t[this.key]||n[this.key]
if(i){e.font_style_idx=this.key
e.font_style=i}}return[]}
return MDRColorStart}()
markdownRenderableAddDefault("c",function(e){return new g(e)})
var T=function(){function MDRColorEnd(){}MDRColorEnd.prototype.layout=function layout(e){var t=e.font_styles,r=e.font_style_idx,a=e.font_style_stack
if(!a||!a.length);else{var i=a.pop()
if(r===i);else{var o=t[i]||n[i]
if(o){e.font_style_idx=i
e.font_style=o}}}return[]}
return MDRColorEnd}()
markdownRenderableAddDefault("/c",function(e){return new T})},{"../common/verify":401,"../common/vmath":402,"./font":315,"./ui":367,assert:void 0}],335:[function(e,t,r){"use strict"
r.mat43=mat43
r.m43identity=m43identity
r.m43mul=m43mul
function mat43(){var e=new Float32Array(12)
e[0]=e[4]=e[8]=1
return e}function m43identity(e){e[0]=1
e[1]=0
e[2]=0
e[3]=0
e[4]=1
e[5]=0
e[6]=0
e[7]=0
e[8]=1
e[9]=0
e[10]=0
e[11]=0}function m43mul(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=t[4]
var l=t[5]
var _=t[6]
var c=t[7]
var u=t[8]
var d=t[9]
var f=t[10]
var v=t[11]
var h=r[0]
var p=r[1]
var m=r[2]
var E=r[3]
var g=r[4]
var T=r[5]
var y=r[6]
var S=r[7]
var I=r[8]
e[0]=h*a+E*i+y*o
e[1]=p*a+g*i+S*o
e[2]=m*a+T*i+I*o
e[3]=h*n+E*s+y*l
e[4]=p*n+g*s+S*l
e[5]=m*n+T*s+I*l
e[6]=h*_+E*c+y*u
e[7]=p*_+g*c+S*u
e[8]=m*_+T*c+I*u
e[9]=h*d+E*f+y*v+r[9]
e[10]=p*d+g*f+S*v+r[10]
e[11]=m*d+T*f+I*v+r[11]
return e}},{}],336:[function(e,t,r){"use strict"
t.exports=function(e,t,r,a){var i=r[0]
var o=r[1]
var n=r[2]
var s=r[3]
var l=i+i
var _=o+o
var c=n+n
var u=i*l
var d=i*_
var f=i*c
var v=o*_
var h=o*c
var p=n*c
var m=s*l
var E=s*_
var g=s*c
e[0]=(1-(v+p))*t
e[1]=(d+g)*t
e[2]=(f-E)*t
e[3]=0
e[4]=(d-g)*t
e[5]=(1-(u+p))*t
e[6]=(h+m)*t
e[7]=0
e[8]=(f+E)*t
e[9]=(h-m)*t
e[10]=(1-(u+v))*t
e[11]=0
e[12]=a[0]
e[13]=a[1]
e[14]=a[2]
e[15]=1
return e}},{}],337:[function(e,t,a){"use strict"
a.modelLoadCount=modelLoadCount
a.modelLoad=modelLoad
a.modelStartup=modelStartup
a.default_fshader=a.default_vshader=a.models=a.load_count=void 0
var M=e("assert")
var D=e("./geom.js")
var P=e("./glb/parser.js")
var B=e("./glb/gltf-type-utils.js").ATTRIBUTE_TYPE_TO_COMPONENTS
var l=e("./engine.js")
var i=e("./locate_asset.js").locateAsset
var o=e("./fetch.js").fetch
var r=e("./shaders.js"),k=r.SEMANTIC,n=r.shaderCreate,_=r.shadersBind,s=r.shadersPrelink
var c=e("./textures.js"),u=c.textureBind,U=c.textureLoad
var d=e("../common/vmath.js").vec4
var f=e("./webfs.js").webFSGetFile
var v=0
a.load_count=v
function modelLoadCount(){return v}var h={}
a.models=h
var p
a.default_vshader=p
var m
a.default_fshader=m
function initShaders(){a.default_vshader=p=n("shaders/default.vp")
a.default_fshader=m=n("shaders/default.fp")
s(p,m)}function Model(e){var t=(this.url=e).lastIndexOf("/")
if(-1!==t)this.base_url=e.slice(0,t+1)
else this.base_url=""}Model.prototype.load=function(){var r=this
a.load_count=v+=1
o({url:i(this.url),response_type:"arraybuffer"},function(e,t){a.load_count=--v
if(e)window.onerror("Model loading error","models.js",0,0,e)
else try{r.parse(t)}catch(e){window.onerror("Model loading error","models.js",0,0,e)}})}
var G={TANGENT:true}
Model.prototype.parse=function(e){var t=P.parse(e)
if(!t)return
var r=t.getJSON()
var a=[]
for(var i=0;i<r.meshes.length;++i){var o=r.meshes[i]
for(var n=0;n<o.primitives.length;++n){var s=o.primitives[n]
var l=r.materials[s.material]
var _=null
if(l){var c=(l.pbrMetallicRoughness||{}).baseColorTexture||{}
var u=r.textures&&r.textures[c.index]||{}
var d=r.samplers&&r.samplers[u.sampler]||{}
var f=r.images&&r.images[u.source]||{}
if(f.uri){var v={url:""+this.base_url+f.uri,filter_mag:d.magFilter,filter_min:d.minFilter,wrap_s:d.wrapS,wrap_t:d.wrapT}
_=U(v)}}var h=[]
var p=[]
var m=[]
var E=0
var g=0
for(var T in s.attributes){if(G[T])continue
M(void 0!==k[T])
var y=r.accessors[s.attributes[T]]
M.equal(y.componentType,5126)
var S=gl.FLOAT
var I=B[y.type]
M(I)
var A=y.count
if(!g)g=A
else M.equal(g,A)
h.push([k[T],S,I])
var w=t.getBuffer(y)
p.push(w)
m.push(0)
E+=w.length}var L=new Float32Array(E)
var O=0
for(var R=0;R<g;++R)for(var b=0;b<h.length;++b)for(var N=0;N<h[b][2];++N)L[O++]=p[b][m[b]++]
var C=r.accessors[s.indices]
M(C)
M.equal(C.type,"SCALAR")
var x=t.getBuffer(C)
if(5125===C.componentType){M(g<65535)
x=new Uint16Array(x)}else M.equal(C.componentType,5123)
a.push({geom:D.create(h,L,x,s.mode),texture:_})}}this.data={objs:a}}
var E={color:d(1,1,1,1)}
Model.prototype.draw=function(e){var t=e.mat,r=e.vshader,a=e.fshader,i=e.shader_params
M(t)
l.updateMatrices(t)
_(r||p,a||m,i||E)
var o=this.data.objs
for(var n=0;n<o.length;++n){var s=o[n]
if(s.texture)u(0,s.texture)
s.geom.draw()}}
Model.prototype.drawGeom=function(){var e=this.data.objs
for(var t=0;t<e.length;++t)e[t].geom.draw()}
function modelLoad(e){if(h[e])return h[e]
var t=h[e]=new Model(e)
t.data=h.box.data
t.load()
return t}function modelStartup(){initShaders();(h.box=new Model("box")).parse(f("models/box_textured_embed.glb").buffer)}a.load=modelLoad},{"../common/vmath.js":402,"./engine.js":305,"./fetch.js":313,"./geom.js":318,"./glb/gltf-type-utils.js":320,"./glb/parser.js":321,"./locate_asset.js":331,"./shaders.js":353,"./textures.js":365,"./webfs.js":371,assert:void 0}],338:[function(e,t,r){"use strict"
r.netPostInit=netPostInit
r.init=init
r.buildString=buildString
r.netDisconnectedRaw=netDisconnectedRaw
r.netDisconnected=netDisconnected
r.netForceDisconnect=netForceDisconnect
r.netClient=netClient
r.netClientId=netClientId
r.netUserId=netUserId
r.netSubs=netSubs
var a=e("../common/util.js").callEach
r.netBuildString=buildString
r.netInit=init
var i=e("./filewatch.js").filewatchStartup
var o=e("../common/packet.js").packetEnableDebug
var n=e("./subscription_manager.js")
var s=e("./wsclient.js")
var l=s.WSClient
var _
var c
var u=[]
function netPostInit(e){if(u)u.push(e)
else e()}function init(e){if((e=e||{}).ver)s.CURRENT_VERSION=e.ver
if(String(document.location).match(/^https?:\/\/localhost/))if(!e.no_packet_debug){console.log("PacketDebug: ON")
o(true)}_=new l(e.path,e.client_app);(c=n.create(_,e.cmd_parse)).auto_create_user=Boolean(e.auto_create_user)
c.no_auto_login=Boolean(e.no_auto_login)
c.allow_anon=Boolean(e.allow_anon)
window.subs=c
r.subs=c
r.client=_
a(u,u=null)
i(_)
if(e.engine){e.engine.addTickFunc(function(e){_.checkDisconnect()
c.tick(e)})
e.engine.onLoadMetrics(function(e){c.onceConnected(function(){_.send("load_metrics",e)})})}}var d=new Date(Number("1718180230532")).toISOString().replace("T"," ").slice(5,-8)
function buildString(){return s.CURRENT_VERSION?s.CURRENT_VERSION+" ("+d+")":d}function netDisconnectedRaw(){return!_||!_.connected||_.disconnected||!_.socket||1!==_.socket.readyState}function netDisconnected(){return netDisconnectedRaw()||c.logging_in}function netForceDisconnect(){var e
if(c)c.was_logged_in=false
null==_||(null==(e=_.socket)||(null==e.close||e.close()))}function netClient(){return _}function netClientId(){return _.id}function netUserId(){return c.getUserId()}function netSubs(){return c}},{"../common/packet.js":392,"../common/util.js":400,"./filewatch.js":314,"./subscription_manager.js":364,"./wsclient.js":375}],339:[function(e,t,r){"use strict"
r.create=create
function create(){return{tick:function tick(){}}}},{}],340:[function(e,t,r){"use strict"
r.addMetric=addMetric
r.friendlyBytes=friendlyBytes
r.perfSetAutoChannel=perfSetAutoChannel
r.perfGraphOverride=perfGraphOverride
r.draw=draw
r.perf_mem_counters=void 0
var o={}
r.perf_mem_counters=o
var b=e("./engine.js")
var N=[]
function addMetric(e,t){if(e.show_graph){e.num_lines=e.colors.length
e.history_size=e.data.history.length/e.num_lines}e.num_labels=Object.keys(e.labels).length
if(void 0===e.interactable)e.interactable=b.DEBUG&&(e.num_labels>1&&!e.show_all||e.show_graph)
if(t)N.splice(0,0,e)
else N.push(e)}var C=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var x=e("./font.js")
var g=e("./input.js")
var M=Math.max
var i=e("./net.js"),n=i.netClient,s=i.netClientId,l=i.netDisconnected
var _=e("../common/perfcounters.js").perfCounterHistory
var D=e("./profiler_ui.js").profilerUI
var P=e("./settings.js")
var c=e("./sprites.js"),A=c.spriteChainedStart,w=c.spriteChainedStop
var B=e("./ui.js")
var k=e("./ui.js").uiTextHeight
var u=e("../common/vmath.js"),d=u.vec4,T=u.v3copy
e("./perf_net.js")
var U=2
var G=d(0,0,0,.5)
var y=d(0,0,0,.75)
var S=d()
P.register({show_metrics:{default_value:1,type:a.TYPE_INT,range:[0,1]},show_fps:{label:"Show FPS",default_value:b.DEBUG?1:0,type:a.TYPE_INT,enum_lookup:{OFF:0,ON:1,MSPF:2,CPU:3,GC:4}},fps_graph:{label:"FPS Graph",default_value:0,type:a.TYPE_INT,range:[0,1]},fps_window:{label:"FPS Time Window (seconds)",default_value:1,type:a.TYPE_FLOAT,range:[.001,120]},show_perf_counters:{default_value:0,type:a.TYPE_INT,range:[0,1]},show_perf_memory:{default_value:0,type:a.TYPE_INT,range:[0,1],access_run:["sysadmin"]},perf_provider:{default_value:"client",type:a.TYPE_STRING,usage:"Set the perf provider for /show_perf_counters and /show_perf_memory\n  CLIENT : show client values\n  AUTO : automatically determine appropriate server\n  user.1234 : use server hosting a particular worker",access_run:["sysadmin"]}})
a.register({cmd:"fps",help:"Toggles FPS display",func:function func(e,t){if(P.show_fps&&P.show_metrics||"0"===e)P.set("show_fps",0)
else{P.set("show_fps",1)
P.set("show_metrics",1)}t()}})
var F=x.style({outline_width:2,outline_color:128,color:4294967295})
function friendlyUnit(e,t){var r=0
while(r<e.length-1&&t>=e[r+1][0])r++
if(0===r)return t+" "+e[r][1]
return(t/e[r][0]).toFixed(2)+" "+e[r][1]}var f=[[1,"bytes"],[1024,"KB"],[1048576,"MB"],[1073741824,"GB"]]
var v=[[1,""],[1e3,"k"],[1e6,"m"],[1e9,"g"]]
function friendlyBytes(e){return friendlyUnit(f,e)}function friendlyCount(e){return friendlyUnit(v,e)}function showMetric(e,t){var r=b.font
var a=U
var i=k()
var o=P.render_scale_all<1?i/P.render_scale_all:i
var n=o*(t.width||2.5)
var s=C.x1Real()-n-a
var l=e
e+=a
var _=0
var c=t.show_all?Infinity:P[t.show_stat]
var u=false
var d=1
for(var f in t.labels){var v=t.labels[f]()
if(v){var h=F
if(v.alpha){d=v.alpha
v=v.value
h=x.styleAlpha(F,d)}var p=r.drawSizedAligned(h,s,e,Z.FPSMETER+3,o,x.ALIGN.HRIGHT,0,0,f)
_=M(_,p)
r.drawSizedAligned(h,s,e,Z.FPSMETER+3,o,x.ALIGN.HFIT,n,0,v)
e+=o
u=true}if(!--c)break}if(!u)return e-a
var m=G
var E={x:(s-=_+U)-a,y:l,w:n+_+U+2*a,h:(e+=a)-l}
if(t.interactable){if(g.mouseUpEdge(E))if(t.num_labels>1&&P[t.show_stat]<=1)P.set(t.show_stat,t.num_labels)
else if(t.show_graph&&!P[t.show_graph])P.set(t.show_graph,1)
else{if(t.show_graph)P.set(t.show_graph,0)
P.set(t.show_stat,1)}if(g.mouseOver(E))m=y}if(1!==d){S[3]=m[3]*d
m=T(S,m)}B.drawRect(E.x,E.y,E.x+E.w,e,Z.FPSMETER+2,m)
return e}function showMetricGraph(e,t){var r=b.game_height<300
var a=r?1:3
var i=r?0:1
var o=r?64:128
var n=t.history_size-1
var s=(a+i)*n
var l=C.x1Real()-s
var _=o+2*i
var c=Z.FPSMETER
A()
B.drawRect(l,e-_,l+s,e,c++,G)
l+=i
e-=i
var u=t.data.index
var d=o/t.line_scale_top
for(var f=0;f<n;f++){var v=(f+u+1)%t.history_size*t.num_lines
var h=t.data.history
var p=0
for(var m=0;m<t.num_lines;m++){var E=h[v+m]
var g=void 0
if(t.bars_stack){g=p
p+=E}else{var T=0
for(var y=0;y<t.num_lines;y++){if(y===m)continue
var S=h[v+y]
if((S<E||S===E&&y<m)&&S>T)T=S}g=T
p=E}var I=t.colors[m]
B.drawRect(l,e-p*d,l+a,e-g*d,c,I)}l+=a+i}c+=n
e-=o+i
w()
return e}function perfDefaultAutoChannel(){var e=s()
if(e)return"client."+e
return null}var h=perfDefaultAutoChannel
function perfSetAutoChannel(e){h=e}var p=1e4
var m=2500
var E={last_update:-Infinity,data:null}
function updatePerfProvider(){var e=p
var r={}
if(P.show_perf_counters)r.counters=1
if(P.show_perf_memory){r.memory=1
e=m}var t=P.perf_provider.toLowerCase()
if("client"===t){var a={source:"client"}
if(r.counters)a.counters=_()
if(r.memory)a.memory=o
return a}if(E.in_flight||l())return E.data
if(b.frame_timestamp-E.last_update<e)return E.data
var i
if("auto"===t)i=h()
else if(t.match(/^[^.]+\.[^.]+$/))i=t
if(i){E.in_flight=true
n().send("perf_fetch",{channel_id:i,fields:r},null,function(e,t){if(e)console.error("Error getting perf data: "+Object.keys(r)+": "+e)
E.data=t
E.last_update=b.frame_timestamp
E.in_flight=false})}return E.data}function perfMemObjToLines(e,t,r){for(var a in t){var i=t[a]
if(i&&"object"===typeof i)perfMemObjToLines(e,i,""+r+a+".")
else{if("number"===typeof i)if(a.endsWith("bytes")||r.includes("data_size"))i=friendlyBytes(i)
else i=friendlyCount(i)
e.push(""+r+a+": "+i)}}}var W=null
function perfGraphOverride(e){W=e}function draw(){C.push()
D()
C.setAspectFixed(b.game_width,b.game_height)
if(P.show_metrics){var e=C.y0Real()
var t=C.y1Real()
if(W){t=showMetricGraph(t,W)
t-=U}for(var r=0;r<N.length;++r){var a=N[r]
if(P[a.show_stat]){e=showMetric(e,a)
e+=U}if(!W&&P[a.show_graph]){t=showMetricGraph(t,a)
t-=U}}}if(P.show_perf_counters||P.show_perf_memory){var i=b.font
var o=updatePerfProvider()||{}
var n=C.y0Real()
var s=n
var l=k()
var _=P.render_scale_all<1?l/P.render_scale_all:l
var c=6*_
var u=C.x0Real()
var d=u+2*c
var f=d+c
var v=Z.FPSMETER+1
var h=u+c
if(o.source){i.drawSized(F,h,n,v,_,"Source: "+o.source)
n+=_}if(o.log){var p=.67*C.wReal()
f=M(f,h+p)
n+=i.drawSizedWrapped(F,h,n,v,p,20,_,o.log)+4}if(o.memory&&P.show_perf_memory){var m=[]
perfMemObjToLines(m,o.memory,"")
for(var E=0;E<m.length;++E){i.drawSized(F,d,n,v,_,m[E])
n+=_}}if(o.counters&&P.show_perf_counters){var g=o.counters||[]
var T={}
for(var y=0;y<g.length;++y){var S=g[y]
for(var I in S){T[I]=T[I]||[]
T[I][y]=S[I]}}var A=Object.keys(T)
A.sort()
for(var w=0;w<A.length;++w){var L=A[w]
var O=T[L]
i.drawSizedAligned(F,d-2*c,n,v,_,x.ALIGN.HRIGHT|x.ALIGN.HFIT,2*c,0,L+": ")
for(var R=0;R<O.length;++R)if(O[R])i.drawSizedAligned(F,d+c*R,n,v,_,x.ALIGN.HFIT,c,0,O[R]+" ")
f=M(f,d+c*O.length)
n+=_}}B.drawRect(u,s,f,n,v-.1,G)}C.pop()
W=null}},{"../common/perfcounters.js":393,"../common/vmath.js":402,"./camera2d.js":295,"./cmds.js":298,"./engine.js":305,"./font.js":315,"./input.js":326,"./net.js":338,"./perf_net.js":341,"./profiler_ui.js":345,"./settings.js":351,"./sprites.js":363,"./ui.js":367}],341:[function(e,t,r){"use strict"
r.registerPingProvider=registerPingProvider
var a=e("../common/wscommon")
var i=a.wsstats
var o=a.wsstats_out
var n=e("./cmds").cmd_parse
var s=e("./perf")
var l=e("./settings")
var _=Math.min
l.register({show_net:{default_value:0,type:n.TYPE_INT,enum_lookup:{OFF:0,ON:2}}})
var c={msgs:0,bytes:0,time:Date.now(),dm:0,db:0}
var u={msgs:0,bytes:0,time:Date.now(),dm:0,db:0}
function bandwidth(e,t){var r=Date.now()
if(r-t.time>1e3){t.dm=e.msgs-t.msgs
t.db=e.bytes-t.bytes
t.msgs=e.msgs
t.bytes=e.bytes
if(r-t.time>2e3)t.time=r
else t.time+=1e3}return(t.db/1024).toFixed(2)+" kb ("+t.dm+")"}s.addMetric({name:"net",show_stat:"show_net",width:5,labels:{"down: ":bandwidth.bind(null,i,c),"up: ":bandwidth.bind(null,o,u)}})
var d=0
function registerPingProvider(t){var e
var r=1===++d?"":""+d
l.register(((e={})["show_ping"+r]={default_value:0,type:n.TYPE_INT,range:[0,1]},e))
s.addMetric({name:"ping"+r,show_stat:"show_ping"+r,labels:{"ping: ":function ping(){var e=t()
if(!e||e.fade<.001)return""
return{value:""+e.ping.toFixed(1),alpha:_(1,3*e.fade)}}}})}},{"../common/wscommon":404,"./cmds":298,"./perf":340,"./settings":351}],342:[function(e,t,r){"use strict"
r.isLocked=isLocked
r.exit=exit
r.enter=enter
r.startup=startup
var a=e("../common/util.js").eatPossiblePromise
var i=false
var o
var n
function isLocked(){return i}function pointerLog(e){console.log("PointerLock: "+e)}function exit(){pointerLog("Lock exit requested")
i=false
a(document.exitPointerLock())}function enter(e){i=true
n()
pointerLog("Trying pointer lock in response to "+e)
a(o.requestPointerLock())}function onPointerLockChange(){if(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement){pointerLog("Lock successful")
if(!i){pointerLog("User canceled lock")
a(document.exitPointerLock())}}else if(i){pointerLog("Lock lost")
i=false}}function onPointerLockError(e){pointerLog("Error")
i=false}function startup(e,t){n=t;(o=e).requestPointerLock=o.requestPointerLock||o.mozRequestPointerLock||o.webkitRequestPointerLock||function(){}
document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||function(){}
document.addEventListener("pointerlockchange",onPointerLockChange,false)
document.addEventListener("mozpointerlockchange",onPointerLockChange,false)
document.addEventListener("webkitpointerlockchange",onPointerLockChange,false)
document.addEventListener("pointerlockerror",onPointerLockError,false)
document.addEventListener("mozpointerlockerror",onPointerLockError,false)
document.addEventListener("webkitpointerlockerror",onPointerLockError,false)}},{"../common/util.js":400}],343:[function(e,t,r){"use strict"
var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array]
if(!Uint8Array.prototype.slice)a.forEach(function(o){Object.defineProperty(o.prototype,"slice",{value:function value(e,t){if(void 0===t)t=this.length
if(t<0)t=this.length-t
if((e=e||0)>=this.length)e=this.length-1
if(t>this.length)t=this.length
if(t<e)t=e
var r=t-e
var a=new o(r)
for(var i=0;i<r;++i)a[i]=this[e+i]
return a}})})
function cmpDefault(e,t){return e-t}var i={join:function join(e){return Array.prototype.join.call(this,e)},fill:function fill(e,t,r){if(void 0===r)r=this.length
for(var a=t||0;a<r;++a)this[a]=e
return this},sort:function sort(e){Array.prototype.sort.call(this,e||cmpDefault)}}
var o=function _loop(t){if(!Uint8Array.prototype[t])a.forEach(function(e){Object.defineProperty(e.prototype,t,{value:i[t]})})}
for(var n in i)o(n)
if(!String.prototype.endsWith){Object.defineProperty(String.prototype,"endsWith",{value:function value(e){return this.slice(-e.length)===e}})
Object.defineProperty(String.prototype,"startsWith",{value:function value(e){return this.slice(0,e.length)===e}})}if(!String.prototype.includes)Object.defineProperty(String.prototype,"includes",{value:function value(e,t){return-1!==this.indexOf(e,t)},configurable:true})
if(!Array.prototype.includes)Object.defineProperty(Array.prototype,"includes",{value:function value(e,t){for(var r=t=void 0===t?0:t<0?this.length+t:t;r<this.length;++r)if(this[r]===e)return true
return false}})
if(!Object.values)Object.values=function values(t){return Object.keys(t).map(function(e){return t[e]})}
if(!Object.entries)Object.entries=function entries(e){var t=Object.keys(e)
var r=new Array(t.length)
for(var a=t.length-1;a>=0;--a)r[a]=[t[a],e[t[a]]]
return r}
if(!Object.assign)Object.assign=function assign(e,t){for(var r=1;r<arguments.length;++r){var a=arguments[r]
for(var i in a)e[i]=a[i]}return e}
if(!Math.sign)Math.sign=function sign(e){return e<0?-1:e>0?1:0}
if("undefined"!==typeof window){if(!window.Intl)window.Intl={}
if(!window.Intl.NumberFormat){window.Intl.NumberFormat=function(){}
window.Intl.NumberFormat.prototype.format=function(e){return String(e)}}if(!window.Intl.DateTimeFormat){window.Intl.DateTimeFormat=function(){}
window.Intl.DateTimeFormat.prototype.format=function(e){return String(e)}}}},{}],344:[function(e,t,r){"use strict"
r.profilerChildCallCount=profilerChildCallCount
r.profilerWarning=profilerWarning
r.profilerNodeRoot=profilerNodeRoot
r.profilerNodeTick=profilerNodeTick
r.profilerHistoryIndex=profilerHistoryIndex
r.profilerFrameStart=profilerFrameStart
r.profilerPaused=profilerPaused
r.profilerPause=profilerPause
r.profilerMemDepthGet=profilerMemDepthGet
r.profilerMemDepthSet=profilerMemDepthSet
r.profilerMeasureBloat=profilerMeasureBloat
r.profilerGarbageEstimate=profilerGarbageEstimate
r.profilerWalkTree=profilerWalkTree
r.profilerAvgTime=profilerAvgTime
r.profilerMaxMem=profilerMaxMem
r.profilerAvgMem=profilerAvgMem
r.profilerExport=profilerExport
r.profilerImport=profilerImport
r.profilerDump=profilerDump
r.MEM_DEPTH_DEFAULT=r.HIST_TOT=r.HIST_COMPONENTS=r.HIST_SIZE=r.HAS_MEMSIZE=void 0
var h=Boolean(window.performance&&performance.memory&&performance.memory.usedJSHeapSize)
r.HAS_MEMSIZE=h
var p=128
r.HIST_SIZE=p
var m=3
r.HIST_COMPONENTS=m
var E=p*m
r.HIST_TOT=E
var a=2
r.MEM_DEPTH_DEFAULT=a
var l=e("assert")
var i=e("./engine.js")
var _=Math.floor,g=Math.max,c=Math.min,u=Math.round
var o=e("./local_storage.js"),n=o.localStorageGetJSON,s=o.localStorageSetJSON
var d=n("profiler_open_keys",{})
var f=0
function ProfilerEntry(e,t){this.parent=e
this.depth=e?e.depth+1:0
this.next=null
this.child=null
this.name=t
this.count=0
this.time=0
this.dmem=0
this.start_time=0
this.start_mem=0
this.history=new Float32Array(E)
this.id=++f
this.show_children=!(e&&e.parent)||d[this.getKey()]||false
this.color_override=null}ProfilerEntry.prototype.isEmpty=function(){for(var e=0;e<E;e+=m)if(this.history[e])return false
return true}
ProfilerEntry.prototype.toJSON=function(){var e=this.next,t=this.child
while(e&&e.isEmpty())e=e.next
while(t&&t.isEmpty())t=t.next
var r={i:this.name,h:Array.prototype.slice.call(this.history)}
if(e)r.n=e
if(t)r.c=t
return r}
function profilerEntryFromJSON(e,t){var r=new ProfilerEntry(e,t.i)
l.equal(t.h.length,r.history.length)
for(var a=0;a<t.h.length;++a)r.history[a]=t.h[a]
if(t.n)r.next=profilerEntryFromJSON(e,t.n)
if(t.c)r.child=profilerEntryFromJSON(r,t.c)
return r}ProfilerEntry.prototype.getKey=function(){if(!this.parent)return""
else return this.parent.getKey()+"."+this.name}
ProfilerEntry.prototype.toggleShowChildren=function(){this.show_children=!this.show_children
if(this.show_children)d[this.getKey()]=1
else delete d[this.getKey()]
s("profiler_open_keys",d)}
var T=new ProfilerEntry(null,"root")
var v=new ProfilerEntry(T,"GPU/idle")
T.child=v
var y=new ProfilerEntry(T,"tick")
v.next=y
var S=T
var I=null
var A=0
var w=false
var L=a
function memSizeChrome(){return performance.memory.usedJSHeapSize}function memSizeNop(){return 0}var O=h?memSizeChrome:memSizeNop
var R=10
function profilerChildCallCount(e,t,r){var a=e.child
var i=0
while(a){if(r){var o=0
var n=0
for(var s=0;s<E;s+=m)if(!t||a.history[s+2]){n++
o+=a.history[s]}if(n)i+=u(o/n)}else if(!t||a.history[A+2])i+=a.history[A]
i+=profilerChildCallCount(a,t,r)
a=a.next}return i}var b=1e3
function profilerWarning(){var e=profilerChildCallCount(T,false,true)
if(e>b)return"Warning: Too many per-frame profilerStart() calls ("+e+" > "+b+")"
else if(!h)return"To access memory profiling, run in Chrome"
else if(L>1&&R<10)return"For precise memory profiling, launch Chrome with --enable-precise-memory-info"
return""}function profilerNodeRoot(){return T}function profilerNodeTick(){return y}function profilerHistoryIndex(){return A}var N=[0,0]
var C=[0,0,0]
function profilerFrameStart(){T.count=1
var e=performance.now()
T.time=e-T.start_time
T.start_time=e
if(L>0){var t=O()
T.dmem=t-T.start_mem
T.start_mem=t}v.count=1
v.time=T.time
v.dmem=T.dmem
for(var r=T.child;r;r=r.next){if(r===v)continue
v.time-=r.time
v.dmem-=r.dmem
if(L>1)if(r.count)if(r.dmem)R++
else R-=5}var a=0
var i=0
for(var o=T.child;o;o=o.next)if(o.dmem<0)i-=o.dmem
else a+=o.dmem
if(a>i){N[0]+=a
C[0]++}else{N[1]+=i
C[1]++}if(S!==T){console.error("Profiler starting new frame but some section was not stopped",S&&S.name)
S=T}if(!w)A=(A+m)%E
var n=T
while(n){var s=true
if(!w){n.history[A]=n.count
n.history[A+1]=n.time
n.history[A+2]=n.dmem}n.count=0
n.time=0
n.dmem=0
do{if(s&&n.child)n=n.child
else if(n.next)n=n.next
else{s=false
if(n=n.parent)continue}break}while(true)}}function profilerStart(e){var t
if(I&&I.name===e)t=I
else if(I&&I.next&&I.next.name===e)t=I.next
else{var r=null
for(t=S.child;t;t=(r=t).next)if(t.name===e)break
if(!t)if(!r){l(!S.child)
t=new ProfilerEntry(S,e)
S.child=t}else if(I){(t=new ProfilerEntry(S,e)).next=I.next
I.next=t}else{t=new ProfilerEntry(S,e)
r.next=t}}l(t.parent===S);(S=t).start_time=performance.now()
if(t.depth<L)t.start_mem=O()
I=null}function profilerStop(e){if(e)l.equal(e,S.name)
S.time+=performance.now()-S.start_time
if(S.depth<L)S.dmem+=O()-S.start_mem
S.count++
S=(I=S).parent}function profilerStopStart(e){profilerStop(null)
profilerStart(e)}if(window.performance&&window.performance.now){window.profilerStart=profilerStart
window.profilerStop=profilerStop
window.profilerStopStart=profilerStopStart}function profilerPaused(){return w}function profilerPause(e){w=e}function profilerMemDepthGet(){return L}function profilerMemDepthSet(e){L=e}var x={time:0,mem:0}
var M={time:0,mem:0}
var D={inner:x,outer:M}
var P="profilerMeasureBloat"
var B="profilerMeasureBloat:child"
var k=10
function profilerMeasureBloat(){var e=L
if(L>=2)L=Infinity
profilerStart(P)
profilerStart(B)
profilerStopStart(B)
profilerStopStart(B)
profilerStopStart(B)
profilerStop(B)
profilerStop(P)
L=e
var t=null
for(t=S.child;t.name!==P;t=t.next);var r=t.child
l.equal(r.name,B)
x.time=Infinity
x.mem=0
M.time=Infinity
var a=M.mem=0
var i=(A-m*(k-1)+E)%E
for(var o=0;o<k;o++){var n=(i+o*m)%E
x.time=c(x.time,r.history[n+1])
M.time=c(M.time,t.history[n+1])
if(r.history[n+2]>0&&t.history[n+2]>0){x.mem+=r.history[n+2]
M.mem+=t.history[n+2];++a}}x.time/=4
M.time=g(0,M.time-x.time)/4
var s=x.mem/a/4
M.mem=a?g(0,_((M.mem/a-s)/4)):0
x.mem=a?g(0,_(s)):0
return D}function profilerGarbageEstimate(){var e
if(C[0]>C[1])e=N[0]/C[0]
else e=N[1]/C[1]
C[0]=C[1]=0
N[0]=N[1]=0
return e}function profilerWalkTree(e,t){var r=0
var a=e
while(a){var i=true
if(a!==e)if(!t(a,r))i=false
do{if(i&&a.child){r++
a=a.child}else if(a.next)a=a.next
else{r--
i=false
if(a=a.parent)continue}break}while(true)}}function profilerAvgTime(e){var t=0
for(var r=0;r<E;r+=m)if(e.history[r])t+=e.history[r+1]
return t/p}function profilerMaxMem(e){var t=0
for(var r=0;r<E;r+=m)if(e.history[r])t=g(t,e.history[r+2])
return t}function profilerAvgMem(e){var t=0
var r=0
for(var a=0;a<E;a+=m)if(e.history[a]){var i=e.history[a+2]
if(i>=0){t+=i
r++}}if(r)t/=r
return t}function profilerExport(){var e={history_index:A,root:T,mem_depth:h?L:0,device:{ua:window.navigator.userAgent,vendor:gl.getParameter(gl.VENDOR),renderer:gl.getParameter(gl.RENDERER),webgl:i.webgl2?2:1,width:i.width,height:i.height}}
var t=gl.getExtension("WEBGL_debug_renderer_info")
if(t){e.device.renderer_unmasked=gl.getParameter(t.UNMASKED_RENDERER_WEBGL)
e.device.vendor_unmasked=gl.getParameter(t.UNMASKED_VENDOR_WEBGL)}var r=JSON.stringify(e)
return r.replace(/\d\.\d\d\d\d+/g,function(e){e=e[5]>"4"?e.slice(0,4)+(Number(e[4])+1):e.slice(0,5)
while("0"===e.slice(-1)||"."===e.slice(-1))e=e.slice(0,-1)
return e})}function profilerImport(e){var t
try{t=JSON.parse(e)}catch(e){}if(!t)return null
t.root=profilerEntryFromJSON(null,t.root)
return t}function profilerDump(){l(S===T)
var f=["","","# PROFILER RESULTS"]
var v=profilerAvgTime(T)
profilerWalkTree(T,function(e,t){var r=0
var a=0
var i=0
var o=0
var n=0
for(var s=0;s<E;s+=m)if(e.history[s]){o++
a+=e.history[s]
r+=e.history[s+1]
i=g(i,e.history[s+1])
n=g(n,e.history[s+2])}if(!a)return true
var l=r/p/v
var _=r/o
var c=(a/o).toFixed(0)
var u=""
for(var d=1;d<t;++d)u+="* "
u+=(100*l).toFixed(0)+"% "+e.name+" "
u+=(1e3*_).toFixed(0)+" ("+c+") max:"+(1e3*i).toFixed(0)
if(h)u+=" dmem:"+n
f.push(u)
return true})
var e=profilerWarning()
if(e)f.push("",e)
f.push("","")
console.log(f.join("\n"))}window.profilerDump=profilerDump},{"./engine.js":305,"./local_storage.js":329,assert:void 0}],345:[function(e,t,r){"use strict"
r.profilerUIStartup=profilerUIStartup
r.profilerUI=profilerUI
var E=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var x=e("./engine.js")
var i=e("./font.js").style
var M=e("./input.js")
var g=Math.floor,D=Math.max,P=Math.min,B=Math.round
var o=e("./net.js"),n=o.netClient,s=o.netDisconnected
var k=e("./ui.js")
var T=e("./ui.js").uiTextHeight
var l=e("./perf.js"),_=l.perfGraphOverride,U=l.friendlyBytes
var c=e("./profiler.js"),G=c.HIST_SIZE,F=c.HIST_COMPONENTS,W=c.HIST_TOT,y=c.HAS_MEMSIZE,S=c.MEM_DEPTH_DEFAULT,H=c.profilerAvgTime,I=c.profilerChildCallCount,u=c.profilerImport,A=c.profilerExport,w=c.profilerHistoryIndex,L=c.profilerAvgMem,O=c.profilerMaxMem,R=c.profilerMeasureBloat,b=c.profilerMemDepthGet,N=c.profilerMemDepthSet,d=c.profilerNodeTick,f=c.profilerNodeRoot,C=c.profilerPause,z=c.profilerPaused,V=c.profilerWalkTree,Y=c.profilerWarning
var j=e("./settings.js")
var v=e("./sprites.js"),K=v.spriteChainedStart,q=v.spriteChainedStop
var X=e("../common/util.js").lerp
var h=e("../common/vmath.js"),p=h.vec2,m=h.vec4
Z.PROFILER=Z.PROFILER||9950
var Q=m(.5,.5,1,1)
var $=null
var J
var ee
function useNewRoot(e){if(J=(ee=e).child)J.color_override=Q}function useSavedProfile(e){var t=u(e)
if(!t){k.modalDialog({title:"Error loading profile",text:e||"No data",buttons:{Ok:null}})
return}useNewRoot(t.root)
$=t}function useLiveProfile(){useNewRoot(f())
$=null}function profilerToggle(e,t){useLiveProfile()
if("1"===e)j.set("show_profiler",1)
else if("0"===e){j.set("show_profiler",0)
N(S)}else if(j.show_profiler)if(z())C(false)
else{j.set("show_profiler",0)
N(S)}else{j.set("show_profiler",1)
C(true)}if(t)t()}var te=x.DEBUG?void 0:["hidden"]
a.register({cmd:"profiler_toggle",help:"Show or toggle profiler visibility",access_show:te,func:profilerToggle})
var re=["% of user","% of parent","% of frame","% of mem"]
j.register({show_profiler:{default_value:0,type:a.TYPE_INT,range:[0,1],access_show:te},profiler_average:{default_value:1,type:a.TYPE_INT,range:[0,2],access_show:["hidden"]},profiler_relative:{default_value:1,type:a.TYPE_INT,range:[0,re.length-1],access_show:["hidden"]},profiler_interactable:{default_value:1,type:a.TYPE_INT,range:[0,1],access_show:["hidden"]},profiler_graph:{default_value:0,type:a.TYPE_INT,range:[0,1],access_show:["hidden"]},profiler_mem_depth:{default_value:S,type:a.TYPE_INT,range:[0,100],access_show:["hidden"]},profiler_hide_bloat:{default_value:1,type:a.TYPE_INT,range:[0,1],access_show:te}})
var ae
var ie
var oe=i(null,{color:4286545919})
var ne=i(null,{color:4294955263})
var se=i(null,{color:4294955263})
var le=i(null,{color:3506438143})
var _e=i(null,{color:3506426111})
var ce=i(null,{color:4294967295,outline_width:.8,outline_color:4294967295})
var ue=i(null,{color:4294967295,outline_width:1,outline_color:128})
var de=22
var fe=24
var ve=(fe-de)/2
var he
var pe
var me
var Ee
var ge=Z.PROFILER
var Te=Z.PROFILER+1
var ye=Z.PROFILER+2
var Se=Z.PROFILER+3
var Ie=Z.PROFILER+4
var Ae=Z.PROFILER+5
var we=58
var Le=56
var Oe=120
var Re=["Profiler","µs (count)","max","GC / Δmem"]
var be=[400,we+4+Le,we,Oe]
var Ne=[]
var Ce
for(var xe=Ne[0]=0;xe<be.length;++xe)Ne[xe+1]=Ne[xe]+be[xe]+4
var Me=Ne[be.length]
var De=Ne[be.length-1]
var Pe=m(0,.25,0,.85)
var Be=m(0,0,0,.85)
var ke=m(.2,.2,.2,.85)
var Ue=m(.3,.3,.3,.85)
var Ge=m(0,0,.5,.85)
var Fe=m(.2,.2,.7,.85)
var We=m(0,0,.3,.85)
var He=m(.2,.2,.4,.85)
var ze=m(1,1,.5,1)
var Ve=m(0,0,0,.5)
var Ye=16
var je=4096
var Ke
var qe
var Ze
var Xe
var Qe
var $e
var Je
var et
var tt
var rt
var at={}
var it
var ot
var nt=0
var st={history_size:G,num_lines:2,data:{history:new Float32Array(2*G),index:0},line_scale_top:Ye,bars_stack:true,colors:[m(.5,1,.5,1),Q]}
var lt
var _t={x:0,peek:true,h:fe}
function profilerShowEntryEarly(e,t){if(0===j.profiler_relative&&e===J)return false
var r=0
for(var a=0;a<W;a+=F)r+=e.history[a]
if(!r)return true
_t.y=ie
_t.w=tt
if(M.mouseOver(_t)){at[(it=e).id]=1
for(var i=e.parent;i;i=i.parent)at[i.id]=2}ie+=fe
if(!e.show_children)return false
return true}function hasActiveChildren(e){if(!(e=e.child))return false
while(e){for(var t=0;t<W;t+=F)if(e.history[t])return true
e=e.next}return false}function childMemCallCount(e,t){var r=e.child
var a=0
while(r){if(r.history[t+2])a+=r.history[t]
a+=childMemCallCount(r,t)
r=r.next}return a}function nodeMemValue(e,t){var r=e.history[t]
var a=e.history[t+2]
if(rt&&j.profiler_hide_bloat&&a>0)a=D(0,a-r*lt.inner.mem-childMemCallCount(e,t)*lt.outer.mem)
return a}var ct={x:0,h:fe}
function profilerShowEntry(e,t){if(0===j.profiler_relative&&e===J)return false
var r=0
var a=0
var i=0
var o=0
var n=Infinity
var s=-Infinity
var l=0
var _=0
for(var c=0;c<W;c+=F)if(e.history[c]){o++
a+=e.history[c]
r+=e.history[c+1]
i=D(i,e.history[c+1])
var u=nodeMemValue(e,c)
nt=D(nt,u)
n=P(n,u)
s=D(s,u)
if(u>=0){l+=u;++_}}if(!a)return true
if(_)l=B(l/_)
var d=1===at[e.id]
var f=2===at[e.id]
if(et){ct.y=ie
ct.w=tt
var v=M.click(ct)
if(v)if(1===v.button)e.parent.toggleShowChildren()
else e.toggleShowChildren()}profilerStart("bar graph")
K()
var h=d?Ge:f?We:Be
var p=d?Fe:f?He:ke
if(!x.defines.NORECTS)k.drawRect4Color(0,ie,tt,ie+fe,ge,h,h,p,p)
var m=Ce
var E=1+j.profiler_graph
var g=j.profiler_graph?je:Ye
for(var T=0;T<G;++T){var y=e.history[(Je+(T+1)*F)%W+E]
if(y>0){var S=y/g
var I=P(S*fe,fe)
if(S<1){ze[0]=S
ze[1]=1}else{ze[0]=1
ze[1]=D(0,2-S)}var A=e.color_override||ze
if(!x.defines.NORECTS){var w=k.drawRect(m+T*Ee,ie+fe-I,m+(T+1)*Ee,ie+fe,Te,A)
w.x=w.y=0}}}q()
profilerStop("bar graph")
ie+=ve
var L
if(hasActiveChildren(e))if(!e.show_children)L="▶"
else L="▼"
var O=0
if(1===j.profiler_relative){if(e.parent)if($e)O=r/G/H(e.parent)
else O=e.history[Xe]?e.history[Xe]/e.parent.history[Xe]:0}else if(3===j.profiler_relative)if(2===$e)O=s/qe
else if($e)O=l/qe
else O=e.history[Qe]/qe
else if($e)O=r/G/Ke
else O=e.history[Xe]/Ke
m=t*de
if(L)ae.drawSized(null,m-16,ie,ye,de,L)
m+=2*de
ae.drawSizedAligned(se,m,ie+me,Ie,pe,ae.ALIGN.HRIGHT,0,0,(100*O).toFixed(0)+"%")
ae.drawSized(ue,m+=4,ie,Se,de,e.name)
m=Ne[1]
var R=$e?r/o:e.history[Xe]
var b=$e?(a/o).toFixed(0):e.history[Ze]
ae.drawSizedAligned(le,m,ie+me,Ae,pe,ae.ALIGN.HRIGHT,we,0,(1e3*R).toFixed(0))
m+=we+4
ae.drawSizedAligned(ne,m,ie+me,Ie,pe,ae.ALIGN.HFIT,Le,0,"("+b+")")
m=Ne[2]
var N=.25*i>r/o&&i>500
ae.drawSizedAligned(N?oe:le,m,ie+me,Ae,pe,ae.ALIGN.HRIGHT,be[2],0,(1e3*i).toFixed(0))
if(rt){m=Ne[3]
var C=2===$e?s:$e?l:nodeMemValue(e,Ze)
if(n<0){ae.drawSizedAligned(oe,m,ie+me,Ae,pe,ae.ALIGN.HLEFT|ae.ALIGN.HFIT,Oe/2,0,""+U(-n))
ae.drawSizedAligned(_e,m+Oe/2,ie+me,Ae,pe,ae.ALIGN.HRIGHT|ae.ALIGN.HFIT,Oe/2,0,""+C)}else ae.drawSizedAligned(_e,m,ie+me,Ae,pe,ae.ALIGN.HRIGHT,Oe,0,""+C)}ie+=de+ve
if(!e.show_children)return false
return true}function doZoomedGraph(){if(j.profiler_graph){st.line_scale_top=je
if(!it)it=d()}else if(!it||it===J)st.line_scale_top=2*Ye
else st.line_scale_top=Ye
var e=1+j.profiler_graph
if(it){var t=it
for(var r=0;r<G;++r){st.data.history[2*r]=t.history[r*F+e]
st.data.history[2*r+1]=0}}else for(var a=0;a<G;++a){var i=a*F+e
st.data.history[2*a]=ee.history[i]-J.history[i]
st.data.history[2*a+1]=J.history[i]}st.data.index=Je/F
_(st)}var ut=140
var dt=48
var ft=24
var vt=p()
var ht={inner:{time:0,mem:0},outer:{time:0,mem:0}}
var pt
var mt
var Et
var gt
var Tt
var yt
var St
var It
var At
var wt
var Lt
var Ot
var Rt
function buttonInit(){var e=Z.PROFILER+10
pt={x:tt,y:ie=0,z:e,w:ut,h:dt,font_height:ft}
mt={x:tt+ut,y:ie,z:e,w:dt,h:dt,font_height:ft,text:"X"}
Et={x:tt,y:ie+=dt,z:e,w:ut,h:dt,font_height:ft}
gt={x:tt,y:ie+=dt,z:e,w:ut,h:dt,font_height:ft}
Tt={x:tt,y:ie+=dt,z:e,w:ut,h:dt,font_height:ft}
yt={x:tt,y:ie+=dt,z:e,w:ut,h:dt,font_height:ft}
ie+=dt
St={x:tt,y:ie+=fe,z:e,w:ut/3,h:dt,font_height:ft,text:"-"}
It={x:tt+ut/3,y:ie,z:e,w:ut/3,h:dt,font_height:ft}
At={x:tt+2*ut/3,y:ie,z:e,w:ut/3,h:dt,font_height:ft,text:"+"}
wt={x:tt,y:ie+=dt,z:e,w:ut,h:dt,font_height:ft}
ie+=dt
Lt={x:tt,y:ie+=fe,z:e,w:ut/2,h:dt,font_height:ft,text:"save"}
Ot={x:tt+ut/2,y:ie,z:e,w:ut/2,h:dt,font_height:ft,text:"load"}}function profilerUIRun(){profilerStart("profilerUIRun")
profilerStart("top+buttons")
lt=ht
if(!$&&j.profiler_hide_bloat)lt=R()
if(x.render_width){var e=de/T()
E.set(0,0,e*x.render_width,e*x.render_height)
he=1
Ee=e}else{E.setScreen(true)
he=.9
Ee=2}Ce=Ne[1]-G*Ee
me=(de-(pe=de*he))/2
if(b()!==j.profiler_mem_depth)N(j.profiler_mem_depth)
if($){Je=$.history_index
rt=$.mem_depth>0}else{Je=w()
rt=y}tt=rt?Me:De
if(!pt||tt!==Rt){Rt=tt
buttonInit()}var t=Z.PROFILER+10
ie=0
var r=tt
pt.text=j.profiler_interactable?"interactable":"overlay"
if(k.buttonText(pt))j.set("profiler_interactable",1-j.profiler_interactable)
if((et=j.profiler_interactable)&&k.buttonText(mt))j.set("show_profiler",0)
ie+=dt
var a=$?"loaded":z()?"paused":"live"
if(et){Et.text=a
if(k.buttonText(Et))if($)useLiveProfile()
else C(!z())}else ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,dt,a)
ie+=dt
if(et){gt.text=re[j.profiler_relative]
if(k.buttonText(gt))j.set("profiler_relative",(j.profiler_relative+1)%re.length)}else ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,dt,re[j.profiler_relative])
ie+=dt
a=2===j.profiler_average?"max":j.profiler_average?"average":"last frame"
if(et){Tt.text=a
if(k.buttonText(Tt)){var i=y?3:2
j.set("profiler_average",(j.profiler_average+1)%i)}}else ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,dt,a)
ie+=dt
a=j.profiler_graph?"graph: mem":"graph: CPU"
if(et){yt.text=a
if(k.buttonText(yt))j.set("profiler_graph",1-j.profiler_graph)}else ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,dt,a)
ie+=dt
if($?true:y){var o=$?$.mem_depth:b()
ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,fe,"Mem Depth")
ie+=fe
a=""+(o||"OFF")
if(et){St.disabled=$||0===o
if(k.buttonText(St)){N(o-1)
j.set("profiler_mem_depth",b())}It.disabled=$
It.text=a
if(k.buttonText(It)){if(o===S)N(99)
else N(S)
j.set("profiler_mem_depth",b())}At.disabled=$
if(k.buttonText(At)){N(o+1)
j.set("profiler_mem_depth",b())}}else ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,dt,a)}else ie+=fe
ie+=dt
a=1e3===j.max_fps?"max CPU":0===j.max_fps?"anim frame":"?"
if(et){wt.text=a
if(k.buttonText(wt))j.set("max_fps",0===j.max_fps?1e3:0)}else ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,dt,a)
ie+=dt
var n=I(ee,false,j.profiler_average)
ae.drawSizedAligned(null,r,ie,t,de,ae.ALIGN.HVCENTERFIT,ut,fe,n+" calls")
ie+=fe
if(et){Lt.disabled=$
if(k.buttonText(Lt)){var s=document.createElement("a")
s.href="data:application/json,"+encodeURIComponent(A())
s.setAttribute("download","profile.json")
s.click()}if(k.buttonText(Ot)){var l=document.createElement("input")
l.setAttribute("type","file")
var _=new FileReader
_.onload=function(){if(2===_.readyState)useSavedProfile(_.error||_.result)}
l.onchange=function(){_.readAsText(l.files[0])}
l.click()}ie+=dt}k.drawRect(r,0,r+ut,ie,t-1,Be)
ie=0
ae.drawSizedAligned(ce,Ne[0],ie,t,de,ae.ALIGN.HLEFT,be[0],0,Re[0])
for(var c=1;c<Re.length-(rt?0:1);++c)ae.drawSizedAligned(ce,Ne[c],ie,t,de,ae.ALIGN.HCENTER,be[c],0,Re[c])
k.drawRect(0,ie,tt,ie+fe,t-1,Ue)
var u=ie+=fe
it=null
ot=-1
if(et){at={}
V(ee,profilerShowEntryEarly)
if(it){if($||z()){var d=M.mousePos(vt)[0]-Ce
if((ot=g(d/Ee))<0||ot>=G)ot=-1}for(var f=nt=0;f<W;f+=F)if(it.history[f])nt=D(nt,it.history[f+2])}}if(nt<.25*je||nt>je)je=X(.1,je,nt)
nt=0
$e=j.profiler_average
Ze=Je
if(-1!==ot){$e=false
Ze=(Ze-(G-ot-1)*F+W)%W}Xe=Ze+1
Qe=Ze+2
if($e){if(0===j.profiler_relative){Ke=0
var v=ee.child
while(v){if(v!==J)Ke+=H(v)
v=v.next}Ke=D(Ke,.001)}else if(2===j.profiler_relative)Ke=H(ee)
else if(3===j.profiler_relative)if(2===$e)qe=O(ee)
else qe=L(ee)}else if(0===j.profiler_relative){Ke=0
var h=ee.child
while(h){if(h!==J)Ke+=h.history[Xe]
h=h.next}Ke=D(Ke,.001)}else if(2===j.profiler_relative)Ke=ee.history[Xe]
else if(3===j.profiler_relative)if((qe=ee.history[Qe])<0){var p=ee.child
qe=0
while(p){qe+=D(0,p.history[Qe])
p=p.next}}profilerStopStart("interface")
ie=u
V(ee,profilerShowEntry)
var m=!$&&Y()
if(m){ae.drawSizedAligned(ue,de,ie,Se,de,ae.ALIGN.HVCENTERFIT,tt-2*de,1.5*fe,m)
k.drawRect(0,ie,tt,ie+1.5*fe,Se-.5,Pe)}if(-1!==ot)k.drawRect(Ce+ot*Ee,u,Ce+(ot+1)*Ee,ie,Te+.5,Ve)
if(et)M.mouseOver({x:0,y:0,w:tt,h:ie})
doZoomedGraph()
profilerStop()
profilerStop("profilerUIRun")}function profilerUIStartup(){ae=k.font
useLiveProfile()}function profilerUI(){if(x.DEBUG&&M.keyUpEdge(M.KEYS.F7))profilerToggle()
if(j.show_profiler)profilerUIRun()
if(x.DEBUG||j.show_profiler);}a.register({cmd:"profile",help:"Captures a performance profile for developer investigation",prefix_usage_with_help:true,usage:"Optionally delays for DELAY seconds before capturing the profile.\nUsage: /profile [DELAY]",func:function func(e,r){function doit(){var e=A()
if(s()){k.provideUserString("Profiler Snapshot",e)
r()}else n().send("profile",e,null,function(e,t){if(null!=t&&t.id){k.provideUserString("Profile submitted","ID="+t.id)
r(null,"Profile submitted with ID="+t.id)}else r(e,t)})}if(Number(e))setTimeout(doit,1e3*Number(e))
else doit()}})},{"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./cmds.js":298,"./engine.js":305,"./font.js":315,"./input.js":326,"./net.js":338,"./perf.js":340,"./profiler.js":344,"./settings.js":351,"./sprites.js":363,"./ui.js":367}],346:[function(e,t,r){"use strict"
r.quat=quat
r.qiNegW=qiNegW
r.qiNormalize=qiNormalize
r.qFromAxisAngle=qFromAxisAngle
r.qFromYPR=qFromYPR
r.qRotateX=qRotateX
r.qRotateY=qRotateY
r.qRotateZ=qRotateZ
r.qSlerp=qSlerp
r.qTransformVec3=qTransformVec3
r.qMult=qMult
r.qInvert=qInvert
r.qLerp=qLerp
r.unit_quat=void 0
var a=e("../common/vmath.js"),i=a.rovec4,o=a.vec4
var m=Math.acos,v=Math.cos,E=Math.sin,n=Math.sqrt
var g=1e-6
var s=i(0,0,0,-1)
r.unit_quat=s
function quat(){return o(0,0,0,-1)}r.createQuat=quat
function qiNegW(e){if(e[3]>0){e[0]*=-1
e[1]*=-1
e[2]*=-1
e[3]*=-1}}function qiNormalize(e){var t=n(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])
if(0!==t){var r=1/t
e[0]*=r
e[1]*=r
e[2]*=r
e[3]*=r}qiNegW(e)}function qFromAxisAngle(e,t,r){var a=E(r*=.5)
e[0]=a*t[0]
e[1]=a*t[1]
e[2]=a*t[2]
e[3]=v(r)
qiNegW(e)
return e}function qFromYPR(e,t,r,a){var i=E(.5*r)
var o=v(.5*r)
var n=E(.5*t)
var s=v(.5*t)
var l=E(.5*a)
var _=v(.5*a)
var c=o*s
var u=i*n
var d=i*s
var f=o*n
e[0]=d*_-f*l
e[1]=u*_+c*l
e[2]=f*_+d*l
e[3]=c*_-u*l
qiNormalize(e)
return e}function qRotateX(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=E(r*=.5)
var l=v(r)
e[0]=a*l+n*s
e[1]=i*l+o*s
e[2]=o*l-i*s
e[3]=n*l-a*s
return e}function qRotateY(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=E(r*=.5)
var l=v(r)
e[0]=a*l-o*s
e[1]=i*l+n*s
e[2]=o*l+a*s
e[3]=n*l-i*s
return e}function qRotateZ(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=E(r*=.5)
var l=v(r)
e[0]=a*l+i*s
e[1]=i*l-a*s
e[2]=o*l+n*s
e[3]=n*l-o*s
return e}function qSlerp(e,t,r,a){var i=r[0]
var o=r[1]
var n=r[2]
var s=r[3]
var l=a[0]
var _=a[1]
var c=a[2]
var u=a[3]
var d
var f
var v=i*l+o*_+n*c+s*u
if(v<0){v=-v
l=-l
_=-_
c=-c
u=-u}if(1-v>g){var h=m(v)
var p=E(h)
d=E((1-t)*h)/p
f=E(t*h)/p}else{d=1-t
f=t}e[0]=d*i+f*l
e[1]=d*o+f*_
e[2]=d*n+f*c
e[3]=d*s+f*u
return e}function qTransformVec3(e,t,r){var a=r[0]
var i=r[1]
var o=r[2]
var n=r[3]
var s=t[0]
var l=t[1]
var _=t[2]
var c=i*_-o*l
var u=o*s-a*_
var d=a*l-i*s
var f=i*d-o*u
var v=o*c-a*d
var h=a*u-i*c
var p=2*n
u*=p
d*=p
v*=2
h*=2
e[0]=s+(c*=p)+(f*=2)
e[1]=l+u+v
e[2]=_+d+h
return e}function qMult(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=t[3]
var s=r[0]
var l=r[1]
var _=r[2]
var c=r[3]
e[0]=a*c+n*s+i*_-o*l
e[1]=i*c+n*l+o*s-a*_
e[2]=o*c+n*_+a*l-i*s
e[3]=n*c-a*s-i*l-o*_
return e}function qInvert(e,t){var r=t[0]
var a=t[1]
var i=t[2]
var o=t[3]
var n=r*r+a*a+i*i+o*o
var s=n?1/n:0
e[0]=-r*s
e[1]=-a*s
e[2]=-i*s
e[3]=o*s
return e}function qLerp(e,t,r,a){qiNormalize(r)
qiNormalize(a)
var i=(r[0]*a[0]+r[1]*a[1]+r[2]*a[2]+r[3]*a[3]<0?-1:1)*(1-t)
e[0]=r[0]*i+a[0]*t
e[1]=r[1]*i+a[1]*t
e[2]=r[2]*i+a[2]*t
e[3]=r[3]*i+a[3]*t
qiNormalize(e)
return e}},{"../common/vmath.js":402}],347:[function(e,t,r){"use strict"
r.randFastCreate=randFastCreate
r.randSimpleSpatial=randSimpleSpatial
function step2(e){e=e>>>0||22329833666
e^=e<<13
e^=e>>>17
e^=e<<5
e^=e<<13
return((e^=e>>>17)^e<<5)>>>0}function RandSeed2(e){this.seed=step2(e)}RandSeed2.prototype.reseed=function(e){this.seed=step2(e)}
RandSeed2.prototype.step=function(){var e=this.seed
e^=e<<13
e^=e>>>17
return(this.seed=(e^=e<<5)>>>0)-1}
RandSeed2.prototype.uint32=RandSeed2.prototype.step
RandSeed2.prototype.range=function(e){return this.step()*e*2.3283064376e-10|0}
RandSeed2.prototype.random=function(){return 2.3283064376e-10*this.step()}
RandSeed2.prototype.floatBetween=function(e,t){return e+(t-e)*this.random()}
function randFastCreate(e){return new RandSeed2(e)}var i=134775813
var o=1103515245
function randSimpleSpatial(e,t,r,a){return(((t^(r+=10327*a))*i^e+t)*(o*t<<16^o*r-i)>>>0)/4294967295}},{}],348:[function(e,t,r){"use strict"
r.roundRobinableCreate=roundRobinableCreate
r.ROUNDROBIN_CONTINUE=r.ROUNDROBIN_START=r.ROUNDROBIN_NO=void 0
var a=e("assert")
var i=0
r.ROUNDROBIN_NO=i
var o=1
r.ROUNDROBIN_START=o
var n=2
r.ROUNDROBIN_CONTINUE=n
var s=function(){function RoundRobinableImpl(){this.head=void 0
this.tail=void 0
this.continuer_this=void 0
this.continuer_next=void 0
this.head=this.tail=null
this.continuer_this=null
this.continuer_next=null}var e=RoundRobinableImpl.prototype
e.query=function query(e){if(void 0===e.roundrobinable_next){if(this.tail){this.tail.roundrobinable_next=e
this.tail=e}else this.head=this.tail=e
e.roundrobinable_next=null}if(this.head===e)if(this.continuer_this===e)return n
else return o
return i}
e.stillWorking=function stillWorking(e){a.equal(this.head,e)
this.continuer_next=e}
e.noNeed=function noNeed(e){a.equal(this.head,e)
a.equal(this.continuer_next,null)
this.tick()}
e.bump=function bump(e){if(this.head===e||this.head&&this.head.roundrobinable_next===e)return
if(void 0!==e.roundrobinable_next){a(this.head)
var t=this.head
a(t.roundrobinable_next)
var r=t.roundrobinable_next
while(r!==e){a((t=r).roundrobinable_next)
r=t.roundrobinable_next}t.roundrobinable_next=e.roundrobinable_next
e.roundrobinable_next=void 0
if(this.tail===e)this.tail=t}if(!this.head){(this.head=this.tail=e).roundrobinable_next=null
return}e.roundrobinable_next=this.head.roundrobinable_next
if(!(this.head.roundrobinable_next=e).roundrobinable_next)this.tail=e}
e.tick=function tick(){var e=this.head
if(e){if(e!==this.continuer_next){var t=e.roundrobinable_next
e.roundrobinable_next=void 0
a(void 0!==t)
e=t}if(!(this.head=e))this.tail=null}this.continuer_this=this.continuer_next
this.continuer_next=null}
return RoundRobinableImpl}()
function roundRobinableCreate(){return new s}},{assert:void 0}],349:[function(e,t,r){"use strict"
r.scrollAreaSetPixelScale=scrollAreaSetPixelScale
r.scrollAreaCreate=scrollAreaCreate
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var X=e("assert")
var a=e("../common/util")
var Q=a.clamp
var i=a.merge
var o=e("../common/vmath")
var n=o.vec2
var s=o.vec4
var $=e("./camera2d")
var J=e("./engine")
var ee=e("./engine").renderNeeded
var te=e("./input")
var l=e("./input")
var re=l.BUTTON_LEFT
var _=l.KEYS
var c=l.PAD
var u=e("./spot")
var ae=u.SPOT_DEFAULT_BUTTON
var ie=u.SPOT_STATE_DOWN
var oe=u.SPOT_STATE_FOCUSED
var ne=u.spot
var se=u.spotPadMode
var h=u.spotSubBegin
var le=u.spotSubEnd
var _e=u.spotUnfocus
var d=e("./sprites")
var ce=d.spriteClipPop
var p=d.spriteClipPush
var ue=e("./ui")
var f=e("./ui").uiTextHeight
var de=Math.abs,fe=Math.max,ve=Math.min,v=Math.round
var m=50
var he=180
function darken(e,t){return s(e[0]*t,e[1]*t,e[2]*t,e[3])}var E=1
function scrollAreaSetPixelScale(e){E=e}var pe=n()
var g=0
var T=function(){function ScrollAreaInternal(e){this.id="sa:"+ ++g
this.x=0
this.y=0
this.z=Z.UI
this.w=10
this.h=10
this.rate_scroll_click=f()
this.pixel_scale=E
this.top_pad=true
this.color=s(1,1,1,1)
this.background_color=s(.4,.4,.4,1)
this.auto_scroll=false
this.auto_hide=false
this.no_disable=false
this.focusable_elem=null
this.min_dist=void 0
this.disabled=false
this.rate_scroll_wheel=void 0
this.rollover_color=void 0
this.rollover_color_light=void 0
this.disabled_color=void 0
this.scroll_pos=0
this.overscroll=0
this.overscroll_delay=0
this.grabbed_pos=0
this.grabbed=false
this.consumed_click=false
this.drag_start=null
this.began=false
this.last_internal_h=0
this.last_frame=0
this.was_disabled=false
this.scrollbar_visible=false
this.last_max_value=0
this.ignore_this_fram_drag=false
this.applyParams(e=e||{})
this.rate_scroll_wheel=e.rate_scroll_wheel||2*this.rate_scroll_click
this.rollover_color=e.rollover_color||darken(this.color,.75)
this.rollover_color_light=e.rollover_color_light||darken(this.color,.95)
X(this.rollover_color_light!==this.color)
this.disabled_color=e.disabled_color||this.rollover_color}var e=ScrollAreaInternal.prototype
e.applyParams=function applyParams(e){if(!e)return
i(this,e)}
e.barWidth=function barWidth(){var e=this.pixel_scale
return ue.sprites.scrollbar_top.uidata.total_w*e}
e.isFocused=function isFocused(){X(false,"deprecated?")
return false}
e.consumedClick=function consumedClick(){return this.consumed_click}
e.isVisible=function isVisible(){return this.scrollbar_visible}
e.begin=function begin(e){this.applyParams(e)
var t=this.x,r=this.y,a=this.w,i=this.h,o=this.z,n=this.id
this.began=true
h({x:t,y:r,w:a,h:i,key:n})
p(o+.05,t,r,a-this.barWidth(),i)
var s=$.x0()
var l=$.x1()
var _=$.y0()
var c=$.y1()
var u=-(t-s)
var d=-(r-_)+this.getScrollPos()
var f=u+l-s
var v=d+c-_
$.push()
$.set(u,d,f,v)
this.ignore_this_fram_drag=false}
e.getScrollPos=function getScrollPos(){return v(this.scroll_pos+this.overscroll)}
e.clampScrollPos=function clampScrollPos(){var e=Q(this.scroll_pos,0,this.last_max_value)
if(this.scroll_pos<0)this.overscroll=fe(this.scroll_pos,-m)
else if(this.scroll_pos>this.last_max_value)this.overscroll=ve(this.scroll_pos-this.last_max_value,m)
this.scroll_pos=e}
e.keyboardScroll=function keyboardScroll(){if(this.was_disabled)return
var e=false
var t=te.padButtonDown(c.RIGHT_TRIGGER)||te.padButtonDown(c.LEFT_TRIGGER)
if(te.keyDownEdge(_.PAGEDOWN)+(t?te.padButtonDownEdge(c.DOWN):0)){this.scroll_pos=ve(this.scroll_pos+this.h,this.scroll_pos===this.last_max_value?Infinity:this.last_max_value)
e=true}if(te.keyDownEdge(_.PAGEUP)+(t?te.padButtonDownEdge(c.UP):0)){this.scroll_pos=fe(this.scroll_pos-this.h,0===this.scroll_pos?-this.h:0)
e=true}if(e)this.clampScrollPos()}
e.end=function end(e){X(e>=0)
e=fe(e,1)
X(this.began)
this.began=false
this.consumed_click=false
var t=le()
$.pop()
ce()
if(t&&se())this.scrollIntoFocus(t.y,t.y+t.h+1,this.h)
var r=fe(e-this.h+1,0)
if(this.scroll_pos>r){var a=this.scroll_pos-r
this.scroll_pos=fe(0,r)
if(this.overscroll<0)this.overscroll=ve(this.overscroll+a,0)}var i=this.scroll_pos===this.last_max_value
if(this.auto_scroll&&(this.last_frame!==J.getFrameIndex()-1||this.last_internal_h!==e&&i)){this.overscroll=fe(0,this.scroll_pos+this.overscroll-r)
this.scroll_pos=r}this.last_internal_h=e
this.last_frame=J.getFrameIndex()
if(this.overscroll){var o=J.getFrameDt()
if(o>=this.overscroll_delay){this.overscroll_delay=0
this.overscroll*=fe(1-.008*o,0)
if(de(this.overscroll)<.001)this.overscroll=0}else this.overscroll_delay-=o
ee()}var n=this.auto_hide,s=this.pixel_scale,l=this.rollover_color,_=this.rollover_color_light
var c=ue.sprites,u=c.scrollbar_top,d=c.scrollbar_bottom,f=c.scrollbar_trough,v=c.scrollbar_handle,h=c.scrollbar_handle_grabber
var p=u.uidata.total_w*s
var m=ve(u.uidata.total_h*s,this.h/3)
var E=this.top_pad?m:0
var g=this.x+this.w-p
var T=this.h/e
T=Q(T,0,1)
var y=this.h>=e?0:this.scroll_pos/(e-this.h)
y=Q(y,0,1)
X(isFinite(y))
var S=T*(this.h-2*E)
var I=v.uidata.total_h*s
var A=this.h-2*m
S=fe(S,ve(I,.75*A))
var w=this.y+E+y*(this.h-2*E-S)
var L=this.color
var O=this.color
var R=this.color
var b=this.color
var N=this.disabled
var C=false
if(!this.h)C=N=true
else if(1===T){C=true
if(this.no_disable)b=L=O=R=this.disabled_color
else N=true}var x=false
if(this.was_disabled=N){b=L=O=R=this.disabled_color
this.drag_start=null}else{var M=te.mouseWheel({x:this.x,y:this.y,w:this.w,h:this.h})
if(M){this.overscroll_delay=he
this.scroll_pos-=this.rate_scroll_wheel*M
if(t)_e()}var D={x:g,y:w,w:p,h:S,button:0,spot_debug_ignore:true}
var P=te.mouseDownEdge(D)
if(P){this.grabbed_pos=P.pos[1]-w
this.grabbed=true
R=_}if(this.grabbed)x=true
if(this.grabbed){var B=te.mouseUpEdge({button:0})
if(B){pe[1]=B.pos[1]
this.consumed_click=true}else if(!te.mouseDownAnywhere(0)){this.grabbed=false
this.consumed_click=true}else te.mousePos(pe)
if(this.grabbed){var k=pe[1]-(this.y+E)-this.grabbed_pos
var U=this.h-2*E-S
if(U>0){this.scroll_pos=(e-this.h)*k/U
X(isFinite(this.scroll_pos))}R=_}}if(te.mouseOver(D))if(R!==_)R=l
var G={x:g,y:this.y,w:p,h:m,button:re,pad_focusable:false,disabled:this.grabbed,disabled_focusable:false,def:ae}
var F=_extends({},G,{y:this.y+this.h-m})
var W=ne(G)
while(W.ret){--W.ret
x=true
this.scroll_pos-=this.rate_scroll_click
this.consumed_click=true}if(W.spot_state===ie)L=_
else if(W.spot_state===oe)L=l
W=ne(F)
while(W.ret){--W.ret
x=true
this.scroll_pos+=this.rate_scroll_click
this.consumed_click=true}if(W.spot_state===ie)O=_
else if(W.spot_state===oe)O=l
var H={key:"bar_"+this.id,x:g,y:this.y,w:p,h:this.h,button:re,sound_rollover:null,pad_focusable:false,def:ae}
var z=ne(H)
while(z.ret){--z.ret
this.consumed_click=x=true
if(z.pos)if(z.pos[1]>w+S/2)this.scroll_pos+=this.h
else this.scroll_pos-=this.h}var V=te.drag({x:this.x,y:this.y,w:this.w-p,h:this.h,button:0,min_dist:this.min_dist})
if(V&&!this.ignore_this_fram_drag){if(null===this.drag_start)this.drag_start=this.scroll_pos
this.scroll_pos=this.drag_start-V.cur_pos[1]+V.start_pos[1]
this.consumed_click=true}else this.drag_start=null
te.drag({x:this.x+this.w-p,y:this.y,w:p,h:this.h,button:0})}if(x&&this.focusable_elem)this.focusable_elem.focus()
this.last_max_value=r
this.clampScrollPos()
if(this.background_color)ue.drawRect(this.x,this.y,this.x+this.w,this.y+this.h,this.z,this.background_color)
if(N&&(n&&C||!this.h)){this.scrollbar_visible=false
return}this.scrollbar_visible=true
u.draw({x:g,y:this.y,z:this.z+.2,w:p,h:m,color:L})
d.draw({x:g,y:this.y+this.h-m,z:this.z+.2,w:p,h:m,color:O})
var Y=m/2
var j=A+2*Y
var K=-Y/s/f.uidata.total_h
var q=K+j/s/f.uidata.total_h
if(f.texs[0].wrap_t===gl.REPEAT)f.draw({x:g,y:this.y+Y,z:this.z+.1,w:p,h:j,uvs:[f.uvs[0],K,f.uvs[2],q],color:b})
else ue.drawVBox({x:g,y:this.y+Y,z:this.z+.1,w:p,h:j},f,b)
ue.drawVBox({x:g,y:w,z:this.z+.3,w:p,h:S},v,R)
var Z=h.uidata.total_h*s
h.draw({x:g,y:w+(S-Z)/2,z:this.z+.4,w:p,h:Z,color:R})}
e.scrollIntoFocus=function scrollIntoFocus(e,t,r){var a=this.scroll_pos
var i=false
if((e=fe(e,0))<this.scroll_pos){this.scroll_pos=e
i=true}if((t-=r)>this.scroll_pos){this.scroll_pos=t
i=true}if(i)this.overscroll=a-this.scroll_pos
this.ignore_this_fram_drag=true}
e.scrollToEnd=function scrollToEnd(){this.scroll_pos=this.last_max_value}
e.resetScroll=function resetScroll(){this.scroll_pos=0
this.overscroll=0}
return ScrollAreaInternal}()
function scrollAreaCreate(e){return new T(e)}},{"../common/util":400,"../common/vmath":402,"./camera2d":295,"./engine":305,"./input":326,"./spot":361,"./sprites":363,"./ui":367,assert:void 0}],350:[function(e,t,r){"use strict"
r.selboxDefaultDrawItemBackground=selboxDefaultDrawItemBackground
r.selboxDefaultDrawItemText=selboxDefaultDrawItemText
r.selboxDefaultDrawItem=selboxDefaultDrawItem
r.selectionBoxCreate=selectionBoxCreate
r.dropDownCreate=dropDownCreate
r.dropDown=dropDown
r.GlovMenuItem=r.default_display=void 0
var a
function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype)
_setPrototypeOf(e.prototype.constructor=e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){e.__proto__=t
return e})(e,t)}r.create=selectionBoxCreate
var c=e("assert")
var s=Math.max,l=Math.round,B=Math.sin
var i=e("../common/util.js")
var k=i.clamp
var o=i.cloneShallow
var u=i.easeIn
var n=i.merge
var _=e("../common/vmath.js")
var d=_.v4copy
var f=_.vec4
var L=e("./camera2d.js")
var U=e("./engine.js")
var v=e("./font")
var O=v.ALIGN
var h=v.fontStyle
var p=e("./input.js")
var R=p.KEYS
var b=p.PAD
var G=p.drag
var N=p.keyDownEdge
var C=p.mouseButtonHadUpEdge
var m=p.padButtonDown
var x=p.padButtonDownEdge
var F=e("./link.js").link
var M=e("./markdown").markdownAuto
var E=e("./scroll_area.js").scrollAreaCreate
var g=e("./spot.js")
var W=g.SPOT_DEFAULT_BUTTON
var H=g.SPOT_NAV_DOWN
var z=g.SPOT_NAV_LEFT
var V=g.SPOT_NAV_RIGHT
var Y=g.SPOT_NAV_UP
var j=g.SPOT_STATE_DISABLED
var K=g.SPOT_STATE_DOWN
var q=g.SPOT_STATE_FOCUSED
var T=g.SPOT_STATE_REGULAR
var X=g.spot
var D=g.spotFocusSteal
var P=g.spotPadMode
var Q=g.spotSubBegin
var $=g.spotSubEnd
var J=g.spotSubPop
var ee=g.spotSubPush
var y=e("./sprites.js")
var te=y.spriteClipPause
var re=y.spriteClipResume
var ae=y.spriteClipped
var S=e("./ui.js")
var ie=S.drawHBox
var I=S.getUIElemData
var oe=S.playUISound
var A=S.uiButtonHeight
var w=S.uiButtonWidth
var ne=S.uiFontStyleFocused
var se=S.uiFontStyleNormal
var le=S.uiGetFont
var _e=S.uiTextHeight
var ce=e("./ui.js")
var ue=0
var de
var fe=h(null,{color:3755991039})
var ve=h(null,{color:4294967295})
var he=h(null,{color:255})
var pe=h(null,{color:2155905279})
var me=8
var Ee=f(1,1,1,1)
var ge=f(1,1,1,1)
function selboxDefaultDrawItemBackground(e){e.item_idx,e.item
var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h,n=e.image_set,s=e.color,l=e.image_set_extra,_=e.image_set_extra_alpha
ie({x:t,y:r,z:a,w:i,h:o},n,s)
if(l&&_){d(ge,s)
ge[3]*=u(_,2)
ie({x:t,y:r,z:a+.001,w:i,h:o},l,ge)}}function selboxDefaultDrawItemText(e){e.item_idx
var t=e.item,r=e.x,a=e.y,i=e.z,o=e.w,n=e.h,s=e.display,l=e.font_height,_=e.line_height,c=e.style
var u=i+1
var d=false
if(s.tab_stop){var f=t.name
var v=f.indexOf("\t")
if(-1!==v){d=true
var h=f.slice(0,v)
var p=f.slice(v+1)
var m=r+s.xpad
var E=r+s.xpad+s.tab_stop+me
var g=s.tab_stop
var T=o-s.tab_stop-2*s.xpad-me
if(s.use_markdown){M({font_style:c,x:m,y:a,z:u,w:g,h:n,text_height:l,line_height:_,align:O.HFIT|O.VCENTER,text:h})
M({font_style:c,x:E,y:a,z:u,w:g,h:n,text_height:l,line_height:_,align:O.HFIT|O.VCENTER,text:p})}else{de.drawSizedAligned(c,m,a,u,l,O.HFIT|O.VCENTER,g,n,h)
de.drawSizedAligned(c,E,a,u,l,O.HFIT|O.VCENTER,T,n,p)}}}if(!d){var y={font_style:c,x:r+s.xpad,y:a,z:u,w:o-2*s.xpad,h:n,text_height:l,line_height:_,align:(t.centered||s.centered?O.HCENTERFIT:O.HFIT)|O.VCENTER,text:t.name}
if(s.use_markdown)M(y)
else de.drawSizedAligned(y.font_style,y.x,y.y,y.z,y.text_height,y.align,y.w,y.h,y.text)}}function selboxDefaultDrawItem(e){selboxDefaultDrawItemBackground(e)
selboxDefaultDrawItemText(e)}var Te={style_default:fe,style_selected:ve,style_disabled:pe,style_down:he,color_default:Ee,color_selected:Ee,color_disabled:Ee,color_down:Ee,draw_item_cb:selboxDefaultDrawItem,centered:false,bounce:true,tab_stop:0,xpad:8,selection_fade:Infinity,use_markdown:false}
r.default_display=Te
var ye=f(.5,.5,.5,1)
var Se=f(.816,.816,.816,1)
var Ie=((a={})[T]=Ee,a[K]=Se,a[q]=Se,a[j]=ye,a)
var Ae=80
var we=function GlovMenuItem(e){if((e=e||{})instanceof GlovMenuItem){for(var t in e)this[t]=e[t]
return}if("string"===typeof e)e={name:e}
this.name=e.name||"NO_NAME"
this.state=e.state||null
this.cb=e.cb||null
this.in_event_cb=e.in_event_cb||void 0
this.value=void 0===e.value?null:e.value
this.value_min=e.value_min||0
this.value_max=e.value_max||0
this.value_inc=e.value_inc||0
this.href=e.href||null
this.tag=e.tag||null
this.style=e.style||null
this.exit=Boolean(e.exit)
this.prompt_int=Boolean(e.prompt_int)
this.prompt_string=Boolean(e.prompt_string)
this.no_sound=Boolean(e.no_sound)
this.slider=Boolean(e.slider)
this.no_controller_exit=Boolean(e.no_controller_exit)
this.plus_minus=Boolean(e.plus_minus)
this.disabled=Boolean(e.disabled)
this.centered=Boolean(e.centered)
this.auto_focus=Boolean(e.auto_focus)
this.selection_alpha=0}
r.GlovMenuItem=we
var Le=function(){function SelectionBoxBase(e){c(!e.auto_unfocus,"Old parameter: auto_unfocus")
this.key="dd"+ ++ue
this.x=0
this.y=0
this.z=Z.UI
this.width=w()
this.items=[]
this.disabled=false
this.display=o(Te)
this.scroll_height=0
this.font_height=_e()
this.line_height=null
this.entry_height=A()
this.auto_reset=true
this.reset_selection=false
this.initial_selection=0
this.show_as_focused=-1
this.applyParams(e)
this.selected=0
this.was_clicked=false
this.was_right_clicked=false
this.is_focused=false
this.expected_frame_index=0
this.ctx={}
if(this.is_dropdown||this.scroll_height)this.sa=E({})}var e=SelectionBoxBase.prototype
e.applyParams=function applyParams(e){if(!e)return
for(var t in e)if("items"===t)this.items=e.items.map(function(e){return new we(e)})
else if("display"===t)n(this.display,e[t])
else this[t]=e[t]}
e.wasClicked=function wasClicked(){return this.was_clicked}
e.wasRightClicked=function wasRightClicked(){return this.was_right_clicked}
e.isSelected=function isSelected(e){if("number"===typeof e)return this.selected===e
return this.items[this.selected].tag===e}
e.getSelected=function getSelected(){return this.items[this.selected]}
e.findIndex=function findIndex(e){if("number"===typeof e){c(e<this.items.length)
return e}else for(var t=0;t<this.items.length;++t)if(this.items[t].tag===e)return t
return-1}
e.setSelected=function setSelected(e){var t=this.findIndex(e)
if(-1!==t)this.selected=t}
e.handleInitialSelection=function handleInitialSelection(){var e=this.auto_reset
if(this.reset_selection||e&&this.expected_frame_index!==U.getFrameIndex()){this.reset_selection=false
if(this.items[this.initial_selection]&&!this.items[this.initial_selection].disabled)this.selected=this.initial_selection
else for(var t=0;t<this.items.length;++t)if(!this.items[t].disabled){this.selected=t
break}}}
e.runPrep=function runPrep(e){var t=this.ctx,r=this.entry_height,a=this.is_dropdown
this.was_clicked=false
this.was_right_clicked=false
var i=0
var o=-1
var n=-1
for(var s=0;s<this.items.length;++s)if(!this.items[s].disabled){if(-1===o)o=s
i++
n=s}var l=this.scroll_height
if(!l&&a)l=L.y1()-(e+r)
t.first_non_disabled_selection=o
t.last_non_disabled_selection=n
t.num_non_disabled_selections=i
t.list_visible=!a||this.dropdown_visible
t.scroll_height=l}
e.selectWalk=function selectWalk(e,t){var r=this.ctx,a=this.selected,i=this.key
var o=r.num_non_disabled_selections,n=r.first_non_disabled_selection,s=r.last_non_disabled_selection,l=r.list_visible
if(!o)this.selected=0
else if(e>=s)this.selected=s
else if(e<=n)this.selected=n
else{while(this.items[e].disabled)e+=t
this.selected=e}if(this.selected!==a)if(l)D({key:i+"_"+this.selected})
else this.was_clicked=true}
e.selectForward=function selectForward(e){this.selectWalk(e,1)}
e.selectBackward=function selectBackward(e){this.selectWalk(e,-1)}
e.doPadMovement=function doPadMovement(){var e=this.ctx,t=this.entry_height
var r=e.list_visible,a=e.scroll_height
var i=l(s(a-1,0)/t)
if(!r)i=1
if(i){var o=m(b.RIGHT_TRIGGER)||m(b.LEFT_TRIGGER)
var n=N(R.PAGEDOWN)+(o?x(b.DOWN):0)
if(n){oe("rollover")
this.selectForward(this.selected+i*n)}if(n=N(R.PAGEUP)+(o?x(b.UP):0)){oe("rollover")
this.selectBackward(this.selected-i*n)}}if(N(R.HOME)){oe("rollover")
this.selectForward(0)}if(N(R.END)){oe("rollover")
this.selectBackward(Infinity)}}
e.doList=function doList(e,t,r,a,i){var o=this.ctx,n=this.disabled,s=this.display,l=this.entry_height,_=this.font_height,c=this.line_height,u=this.key,d=this.selected,f=this.show_as_focused,v=this.width
if(null===c)c=_
var h=o.scroll_height
var p=v
var m=t
if(a){this.sa.begin({x:e,y:t,z:r,w:v,h:h})
e=t=0
p=v-this.sa.barWidth()}else if(this.is_dropdown)Q({key:u,x:e,y:t,z:r,w:v,h:h||l})
var E=U.getFrameDt()
var g=false
var T=o.first_non_disabled_selection,y=o.last_non_disabled_selection
for(var S=0;S<this.items.length;S++){var I
var A=this.items[S]
var w=A.disabled
var L=null
var O=null
var R=0
if(A.href)F({x:e,y:t,w:v,h:l,url:A.href})
var b={def:W,key:u+"_"+S,disabled:n||w,disabled_focusable:false,x:e,y:t,w:v,h:l,custom_nav:((I={})[V]=null,I[z]=null,I),auto_focus:A.auto_focus,in_event_cb:A.in_event_cb}
if(S===T&&this.nav_loop)b.custom_nav[Y]=u+"_"+y
if(S===y&&this.nav_loop)b.custom_nav[H]=u+"_"+T
var N=X(b)
if(S===f){N.focused=true
N.spot_state=q}var C=N.focused||N.spot_state===K
g=g||C
if(A.slider||A.plus_minus)if(N.nav===z){N.nav=V
N.button=2}if(N.nav===V){oe("button_click")
N.spot_state=K
N.ret=true}if(N.ret){this.was_clicked=true
this.was_right_clicked=2===N.button
this.selected=S
this.onListSelect()}var x=false
if(C){this.selected=S
if(!this.is_dropdown&&s.bounce)if(this.selected!==d){x=true
this.bounce_time=Ae}else if(E>=this.bounce_time)this.bounce_time=0
else{x=true
this.bounce_time-=E}}if(N.nav===z){this.selected=i
this.onListSelect()}var M=void 0
var D=void 0
if(N.spot_state===K||N.spot_state===q){D=s.style_selected||ve
M=s.color_selected||Te.color_selected
A.selection_alpha=k(A.selection_alpha+E*s.selection_fade,0,1)
if(1===A.selection_alpha)L=ce.sprites.menu_selected
else{L=ce.sprites.menu_entry
O=ce.sprites.menu_selected
R=A.selection_alpha}if(N.spot_state===K)if(ce.sprites.menu_down){L=ce.sprites.menu_down
if(s.style_down){D=s.style_down
M=s.color_down||Te.color_down}}else{D=s.style_down||he
M=s.color_down||Te.color_down}}else{A.selection_alpha=k(A.selection_alpha-E*s.selection_fade,0,1)
if(1!==A.selection_alpha){O=ce.sprites.menu_selected
R=A.selection_alpha}if(N.spot_state===j){D=s.style_disabled||pe
M=s.color_disabled||Te.color_disabled
L=ce.sprites.menu_entry}else{D=A.style||s.style_default||fe
M=s.color_default||Te.color_default
L=ce.sprites.menu_entry}}var P=0
if(x)P=-4*B(20*this.bounce_time/Ae/10)*l/32
s.draw_item_cb({item_idx:S,item:A,x:e,y:t+P,z:r+1,w:p,h:l,image_set:L,color:M,image_set_extra:O,image_set_extra_alpha:R,font_height:_,line_height:c,display:s,style:D})
if(N.ret&&A.href)window.location.href=A.href
t+=l}o.scroll_area_consumed_click=false
if(a){this.sa.end(t)
o.scroll_area_consumed_click=this.sa.consumedClick()
t=m+h}else if(this.is_dropdown){G({x:e,y:m,w:v,h:t-m})
$()}o.any_focused=g
return t}
return SelectionBoxBase}()
var Oe=function(r){_inheritsLoose(GlovSelectionBox,r)
function GlovSelectionBox(e){var t
c(!e.is_dropdown,"Use dropDownCreate() instead");(t=r.call(this,e)||this).bounce_time=0
return t}var e=GlovSelectionBox.prototype
e.getHeight=function getHeight(){var e=this.entry_height
var t=this.items.length*e
if(this.scroll_height&&this.items.length*e>this.scroll_height)t=this.scroll_height
return t+2+3}
e.focus=function focus(){c(false,"deprecated?")
var e=this.key
D({key:e+"_0"})}
e.onListSelect=function onListSelect(){}
e.isDropdownVisible=function isDropdownVisible(){return false}
e.run=function run(e){this.applyParams(e)
var t=this.x,r=this.y,a=this.z,i=this.entry_height,o=this.ctx
this.handleInitialSelection()
var n=r
var s
this.runPrep(r)
var l=o.scroll_height
var _=l&&this.items.length*i>l
r=this.doList(t,r,a,_,this.selected)
if(o.any_focused)this.doPadMovement()
this.expected_frame_index=U.getFrameIndex()+1
t=10
s=r+=5
c.equal(s-n,this.getHeight())
return s-n}
return GlovSelectionBox}(Le)
Oe.prototype.is_dropdown=false
Oe.prototype.nav_loop=false
var Re=function(r){_inheritsLoose(GlovDropDown,r)
function GlovDropDown(e){var t
c(!e.is_dropdown,"Old parameter: is_dropdown");(t=r.call(this,e)||this).dropdown_visible=false
t.last_selected=void 0
return t}var e=GlovDropDown.prototype
e.isDropdownVisible=function isDropdownVisible(){return this.dropdown_visible}
e.focus=function focus(){c(false,"deprecated?")
D(this)
this.is_focused=true}
e.onListSelect=function onListSelect(){this.dropdown_visible=false
D(this)}
e.run=function run(e){var t
this.applyParams(e)
var r=this.x,a=this.y,i=this.z,o=this.width,n=this.font_height,s=this.line_height,l=this.entry_height,_=this.disabled,c=this.key,u=this.display,d=this.ctx
if(null===s)s=n
this.handleInitialSelection()
if(void 0!==this.last_selected&&(this.last_selected>=this.items.length||this.items[this.last_selected].disabled))this.last_selected=void 0
var f=a
var v
this.runPrep(a)
var h=d.first_non_disabled_selection,p=d.list_visible,m=d.scroll_height
var E={key:c,disabled:_,x:r,y:a,z:i+2-.1,w:o,h:l,def:W,custom_nav:((t={})[V]=null,t)}
d.root_spot_rect=E
if(this.dropdown_visible){E.custom_nav[z]=null
E.custom_nav[H]=c+"_"+h}var g=X(E)
this.is_focused=g.focused
if(g.kb_focused||p)this.doPadMovement()
this.selectForward(this.selected)
var T=this.dropdown_visible&&void 0!==this.last_selected?this.last_selected:this.selected
if(this.dropdown_visible&&(N(R.ESC)||x(b.B))){this.selected=T
this.onListSelect()}if(g.ret||g.nav){if(g.nav)oe("button_click")
if(this.dropdown_visible){this.selected=T
this.dropdown_visible=false}else{this.dropdown_visible=true
this.last_selected=this.selected
if(P())D({key:c+"_"+this.selected})}}ie({x:r,y:a,z:i+1,w:o,h:l},ce.sprites.menu_header,Ie[g.spot_state])
var y={font_style:g.focused?ne():se(),x:r+u.xpad,y:a,z:i+2,w:o-u.xpad-ce.sprites.menu_header.uidata.wh[2]*l,h:l,text_height:n,line_height:s,align:(u.centered?O.HCENTER:O.HLEFT)|O.HFIT|O.VCENTER,text:this.items[T].name}
if(u.use_markdown)M(y)
else de.drawSizedAligned(y.font_style,y.x,y.y,y.z,y.text_height,y.align,y.w,y.h,y.text)
v=(a+=l)+2
if(this.dropdown_visible){i+=1e3
var S=ae()
if(S)te()
ee()
var I=m&&this.items.length*l>m
if(!I&&a+this.items.length*l>=L.y1())a=L.y1()-this.items.length*l
this.doList(r,a,i,I,T)
if(this.was_clicked)this.dropdown_visible=false
J()
if(S)re()
var A=d.any_focused,w=d.scroll_area_consumed_click
if(g.ret||this.was_clicked)A=true
this.is_focused=this.is_focused||A
if(!A)this.selected=T
if(!A&&!g.focused&&!w)if(C()||P()){this.selected=T
this.dropdown_visible=false}}this.expected_frame_index=U.getFrameIndex()+1
return v-f}
return GlovDropDown}(Le)
Re.prototype.is_dropdown=true
Re.prototype.nav_loop=true
function selectionBoxCreate(e){if(!de)de=le()
return new Oe(e)}function dropDownCreate(e){if(!de)de=le()
return new Re(e)}function dropDown(e,t,r){r=r||{}
e.auto_reset=false
var a=r.suppress_return_during_dropdown
var i=I("dropdown",e,dropDownCreate)
i.applyParams(e)
if(!i.isDropdownVisible())i.setSelected(t)
var o
if(a){var n=i.findIndex(t)
o=-1===n?null:i.items[n]}else o=i.getSelected()
i.run()
r.dropdown_visible=i.isDropdownVisible()
if(a&&i.was_clicked||!a)if(o!==i.getSelected())return e.items[i.selected]
return null}},{"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./engine.js":305,"./font":315,"./input.js":326,"./link.js":328,"./markdown":332,"./scroll_area.js":349,"./spot.js":361,"./sprites.js":363,"./ui.js":367,assert:void 0}],351:[function(e,t,a){"use strict"
a.get=get
a.set=set
a.setAsync=setAsync
a.runTimeDefault=runTimeDefault
a.settingIsModified=settingIsModified
a.push=push
a.pop=pop
a.register=register
var i={}
a.true=true
var o={}
var n=e("assert")
var s=e("../common/util.js").titleCase
var l=e("./cmds.js").cmd_parse
var r=e("./engine.js")
function get(e){return a[e]}function set(e,t){if(a[e]!==t)l.handle(null,e+" "+t,null)}function setAsync(e,t){r.postTick({fn:set.bind(null,e,t)})}function runTimeDefault(e,t){n(!o[e])
if(!i[e])a[e]=t}function settingIsModified(e){return i[e]}var _=null
function push(e){n(!_)
_={}
for(var t in e){_[t]=a[t]
a[t]=e[t]
var r=o[t]
if(r)r(false)}}function pop(){n(_)
for(var e in _){a[e]=_[e]
var t=o[e]
if(t)t(false)}_=null}function register(r){Object.keys(r).forEach(function(t){var e=r[t]
a[t]=e.default_value
if(e.on_change)o[t]=e.on_change
l.registerValue(t,{type:e.type,label:e.label||s(t.replace(/_/g," ")),range:e.range,get:function get(){return a[t]},set:function set(e){i[t]=true
a[t]=e},store:false!==e.store,ver:e.ver,help:e.help,usage:e.usage,prefix_usage_with_help:e.prefix_usage_with_help,on_change:e.on_change,access_run:e.access_run,access_show:e.access_show,default_value:e.default_value,enum_lookup:e.enum_lookup,is_toggle:e.is_toggle})})}register({max_fps:{label:"Maximum frame rate (FPS)",prefix_usage_with_help:true,usage:"Display current maximum: /max_fps\nSet maximum FPS limit: /max_fps 30\nSet automatic by browser: /max_fps 0 (may be unresponsive)\nSet unlimited: /max_fps 1000 (may be unresponsive)\nDefault: /max_fps 60",default_value:60,type:l.TYPE_FLOAT,ver:2},use_animation_frame:{label:"Use requestAnimationFrame",help:"Use requestAnimationFrame for any max_fps values lower than this value.",prefix_usage_with_help:true,default_value:60,type:l.TYPE_INT,range:[0,240]},render_scale:{label:"Render Scale (3D)",default_value:1,type:l.TYPE_FLOAT,range:[.1,1]},render_scale_mode:{label:"Render Scale Mode",default_value:0,type:l.TYPE_INT,enum_lookup:{LINEAR:0,NEAREST:1,CRT:2}},render_scale_all:{label:"Render Scale (All)",default_value:1,type:l.TYPE_FLOAT,range:[.3333,4]},render_scale_clear:{label:"Render Scale Full Clear",default_value:1,type:l.TYPE_INT,range:[0,1]},fov:{default_value:60,type:l.TYPE_FLOAT,range:[1,100]},double_click_time:{default_value:500,type:l.TYPE_INT,range:[0,2500]}})},{"../common/util.js":400,"./cmds.js":298,"./engine.js":305,assert:void 0}],352:[function(e,t,r){"use strict"
r.shaderDebugUIStartup=shaderDebugUIStartup
var N=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var i=e("./engine.js")
var o=e("./fetch.js").fetch
var C=e("./font.js")
var x=e("./input.js")
var M=Math.min
var D=e("./scroll_area.js").scrollAreaCreate
var P=e("./shaders.js").shadersGetDebug
var B=e("./settings.js")
var k=e("./ui.js")
var U=e("./ui.js").uiTextHeight
var n=e("../common/util.js").errorString
var s=e("../common/vmath.js").vec4
Z.SHADER_DEBUG=Z.SHADER_DEBUG||900
var l="http://localhost:3000/api/shaderstats"
var _={}
function getShaderStats(e,t,r){if(_[e])return _[e].data
if(r)return null
var a=_[e]={data:null}
o({url:l+"?stage="+t+"&text="+encodeURIComponent(e),response_type:"json"},function(e,t){if(e)a.data={err:"Fetch error: "+n(e)}
else a.data=t})
return a.data}var G=4
var F=C.styleColored(null,2156986367)
var W=C.styleColored(null,572662527)
var H=C.styleColored(null,3710001919)
var z=s(.4,.4,.4,1)
var V=s(1,1,1,1)
var Y=s(.8,0,0,1)
var j=s(.4,.6,1,1)
var K
var q
var X
function shaderDebugUITick(){var e=k.tooltip_pad
var t=N.x0()+e
var r=N.y0()+e
var o=Z.SHADER_DEBUG
var n=k.font,a=k.title_font
var s=U()
var i=20*s
var l=t
var _=r
var c=P()
a.drawSizedAligned(F,l,_,o,s,n.ALIGN.HCENTERFIT,i,0,"Shaders ("+c.length+")")
if(!K){K=D({z:o,background_color:null,auto_hide:true})
q=D({z:o,background_color:null,auto_hide:true})}var u=i-G-K.barWidth()
var d=.3*u
var f=d/2
var v=u-d-G
n.draw({x:l+v+G,y:_+.5*s,z:o,w:f-1,color:1077952767,size:.5*s,text:"Ops",align:n.ALIGN.HCENTERFIT})
n.draw({x:l+v+G+f+1,y:_+.5*s,z:o,w:f-1,color:1077952767,size:.5*s,text:"Bytes",align:n.ALIGN.HCENTERFIT})
_+=s+1
k.drawLine(t+.3*i,_,t+.7*i,_,o,.5,true,z)
_+=G
var h=N.y1()-G-_
var p=_
K.begin({x:l,y:_,w:i,h:h})
_=l=0
o=Z.UI
for(var m=0;m<c.length;++m){var E=c[m]
var g=E.filename.replace("shaders/","")
if(E.defines_arr.length)g+="("+E.defines_arr.join(",")+")"
if(k.buttonText({text:g,x:l,y:_,z:o,w:v,h:s,color:X===E?j:E.valid?void 0:Y,align:C.ALIGN.HFIT}))if(X===E)X=void 0
else X=E
var T=getShaderStats(E.shader_source_text,E.type===gl.FRAGMENT_SHADER?"frag":"vert",false)
if(!T||T.err)n.draw({x:l+v+G,y:_,z:o,w:d,color:null!=T&&T.err?2147483903:2155905279,text:null!=T&&T.err?"ERR":"...",align:n.ALIGN.HCENTERFIT})
else{var y
var S=255
n.draw({x:l+v+G,y:_,z:o,w:f-1,color:S,text:""+(null==(y=T.spirv)?void 0:y.count_total),align:n.ALIGN.HCENTERFIT})
n.draw({x:l+v+G+f+1,y:_,z:o,w:f-1,color:S,text:T.bin_size.toLocaleString(),align:n.ALIGN.HCENTERFIT})}_+=s}K.end(_)
_=p+M(h,_)
o=Z.SHADER_DEBUG
var I=s
if(k.buttonText({x:t+i-I,y:r,z:o+1,w:I,h:I,text:"X"}))B.set("shader_debug",0)
k.panel({x:t-e,y:r-e,z:o-1,w:i+2*e,h:_-r+2*e,color:V})
if(!X)return
var A=X
t+=i+2*e
i=N.x1()-G-t
l=t
_=r
n.draw({x:l,y:_,z:o,w:i,style:W,text:A.filename,align:n.ALIGN.HCENTERFIT})
_+=s+1
k.drawLine(t+.3*i,_,t+.7*i,_,o,.5,true,z)
p=_+=G
q.begin({x:l,y:_,w:i,h:h})
u=i-G-q.barWidth()
_=l=0
o=Z.UI
if(A.error_text)_+=n.draw({x:l,y:_,z:o,w:u,color:2147483903,style:W,text:A.error_text,align:n.ALIGN.HWRAP})
function flatten(e,t){for(var r in e){if("text"===r||"spirv_raw"===r)continue
var a=e[r]
var i=t?t+"."+r:r
if("object"===typeof a)flatten(a,i)
else{n.draw({x:l,y:_,z:o,w:u,style:W,text:i+": "+a,align:n.ALIGN.HFIT})
_+=s}}}var w=getShaderStats(A.shader_source_text,A.type===gl.FRAGMENT_SHADER?"frag":"vert")
if(!w)_+=n.draw({x:l,y:_,z:o,w:i,style:W,text:"Loading shader stats...",align:n.ALIGN.HWRAP})
else if(w.err)_+=n.draw({x:l,y:_,z:o,w:u,style:H,text:String(w.err),align:n.ALIGN.HWRAP})
else flatten(w)
var L=.5*s
if(null!=w&&w.text){_+=G
k.drawLine(l+.3*i,_,l+.7*i,_,o,.5,true,z)
_+=G/2
n.draw({x:l,y:_,z:o,w:i,style:W,text:"Analyzed Shader Source",align:n.ALIGN.HCENTERFIT})
_+=s+1
var O=n.draw({x:l,y:_,z:o,w:i,size:L,style:W,text:w.text,align:n.ALIGN.HWRAP})
if(x.click({x:l,y:_,w:i,h:O}))k.provideUserString("Analyzed shader source",w.text)
_+=O}if(null!=w&&w.spirv_raw){_+=G
k.drawLine(l+.3*i,_,l+.7*i,_,o,.5,true,z)
_+=G/2
n.draw({x:l,y:_,z:o,w:i,style:W,text:"SPIR-V Disassembly",align:n.ALIGN.HCENTERFIT})
_+=s+1
var R=n.draw({x:l,y:_,z:o,w:i,size:L,style:W,text:w.spirv_raw,align:n.ALIGN.HWRAP})
if(x.click({x:l,y:_,w:i,h:R}))k.provideUserString("SPIR-V Disassembly",w.spirv_raw)
_+=R}_+=G
k.drawLine(l+.3*i,_,l+.7*i,_,o,.5,true,z)
_+=G/2
n.draw({x:l,y:_,z:o,w:i,style:W,text:"Actual WebGL Shader Source",align:n.ALIGN.HCENTERFIT})
_+=s+1
var b=n.draw({x:l,y:_,z:o,w:i,size:L,style:W,text:A.shader_source_text,align:n.ALIGN.HWRAP})
if(x.click({x:l,y:_,w:i,h:b}))k.provideUserString("Used WebGL shader source",A.shader_source_text)
_+=b
q.end(_)
_=p+M(h,_)
o=Z.SHADER_DEBUG
k.panel({x:t-e,y:r-e,z:o-1,w:i+2*e,h:_-r+2*e,color:V})}function shaderDebugUIStartup(){B.register({shader_debug:{label:"Shader Debug",default_value:0,type:a.TYPE_INT,range:[0,1],access_show:["sysadmin"],on_change:function on_change(){i.removeTickFunc(shaderDebugUITick)
if(B.shader_debug)i.addTickFunc(shaderDebugUITick)}}})}},{"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./cmds.js":298,"./engine.js":305,"./fetch.js":313,"./font.js":315,"./input.js":326,"./scroll_area.js":349,"./settings.js":351,"./shaders.js":353,"./ui.js":367}],353:[function(e,t,a){"use strict"
a.shadersResetState=shadersResetState
a.shadersSetGLErrorReportDetails=shadersSetGLErrorReportDetails
a.shadersGetDebug=shadersGetDebug
a.shaderCreate=shaderCreate
a.shadersRequirePrelink=shadersRequirePrelink
a.shadersBind=shadersBind
a.shadersPrelink=shadersPrelink
a.addReservedDefine=addReservedDefine
a.shadersHandleDefinesChanged=shadersHandleDefinesChanged
a.shadersSetInternalDefines=shadersSetInternalDefines
a.shadersStartup=shadersStartup
a.shadersAddGlobal=shadersAddGlobal
a.globals=a.SEMANTIC=a.MAX_SEMANTIC=void 0
var r=5
a.MAX_SEMANTIC=r
var v={ATTR0:0,POSITION:0,ATTR1:1,COLOR:1,COLOR_0:1,ATTR2:2,TEXCOORD:2,TEXCOORD_0:2,ATTR3:3,NORMAL:3,ATTR4:4,TEXCOORD_1:4}
a.SEMANTIC=v
var h=e("assert")
var p=e("./engine.js")
var i=e("./error_report.js"),o=i.errorReportClear,n=i.errorReportSetDetails,s=i.errorReportSetDynamicDetails,l=i.glovErrorReport
var _=e("./filewatch.js").filewatchOn
var c=e("../common/util.js"),u=c.matchAll,m=c.nop
var d=e("./textures.js").textureUnloadDynamic
var f=e("./webfs.js").webFSGetFile
var E=0
var g=null
var T
a.globals=T
var y
var S
var I
var A
var w
var L=[]
var O=/attribute [^ ]+ ([^ ;]+);/g
var R=/uniform (?:(?:low|medium|high)p )?((?:(?:vec|mat)\d(?:x\d)?|float) [^ ;]+);/g
var b=/uniform sampler(?:2D|Cube) ([^ ;]+);/g
var N=/\n#include "([^"]+)"/g
var C={float:1,vec2:2,vec3:3,vec4:4,mat3:9,mat4:16}
function loadInclude(e){return'\n// from include "'+e+'":\n'+f(e,"text")+"\n"}function shadersResetState(){for(var e=0;e<L.length;++e){var t=L[e]
if(t.programs)for(var r in t.programs){var a=t.programs[r]
if(null===a.uniforms)h(a.uniforms,"prog.uniforms=null, valid="+a.valid+", fpid="+r+", vp="+t.filename+", handle="+Boolean(a.handle))
for(var i=0;i<a.uniforms.length;++i){var o=a.uniforms[i]
for(var n=0;n<o.size;++n)o.value[n]=NaN}}}g=null
gl.useProgram(null)}function shadersSetGLErrorReportDetails(){var e={max_fragment_uniform_vectors:gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),max_varying_vectors:gl.getParameter(gl.MAX_VARYING_VECTORS),max_vertex_attribs:gl.getParameter(gl.MAX_VERTEX_ATTRIBS),max_vertex_uniform_vectors:gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS),vendor:gl.getParameter(gl.VENDOR),renderer:gl.getParameter(gl.RENDERER),webgl:p.webgl2?2:1}
var t=gl.getExtension("WEBGL_debug_renderer_info")
if(t){e.renderer_unmasked=gl.getParameter(t.UNMASKED_RENDERER_WEBGL)
e.vendor_unmasked=gl.getParameter(t.UNMASKED_VENDOR_WEBGL)}for(var r in e)n(r,e[r])}s("context_lost",function(){if(window.gl&&gl.isContextLost())return"1"
return""})
var x=null
var M
var D
var P=false
function reportShaderError(e,t){function doReport(){x=null
var e="Shader error(s):\n    "+M.join("\n    ")
M=null
if(!gl.isContextLost()){shadersSetGLErrorReportDetails()
P=true
if(!D)l(false,e,"shaders.js")
else h(false,e)}}if(!x){x=setTimeout(doReport,1e3)
M=[]
D=false}D=D||!e
M.push(t)}function parseIncludes(i,e){var o={}
e.replace(R,function(e,t){o[t]=true})
return e.replace(N,function(e,t){var r=i.split("/")
r.pop()
r.push(t)
var a=loadInclude(r=r.join("/"))
if(!a){console.error("Could not evaluate "+e)
return e}return a.replace(R,function(e,t){if(o[t])return"// [removed "+t+"]"
o[t]=true
return e})})}var B=["#version 300 es","#define WEBGL2"].join("\n")
var k=[B,"#define varying in","out lowp vec4 fragColor;","#define gl_FragColor fragColor","#define texture2D texture","#define textureCube texture",""].join("\n")
var U=[B,"#define varying out","#define attribute in",""].join("\n")
function Shader(e){var t=e.filename,r=e.defines,a=e.non_fatal
h.equal(typeof t,"string")
var i=t.endsWith(".fp")?gl.FRAGMENT_SHADER:t.endsWith(".vp")?gl.VERTEX_SHADER:0
h(i)
this.type=i
this.filename=t
this.non_fatal=a
this.defines_arr=r||[]
this.defines=this.defines_arr.map(function(e){return"#define "+e+"\n"}).join("")
this.shader=gl.createShader(i)
this.id=++E
if(i===gl.VERTEX_SHADER)this.programs={}
L.push(this)
this.compile()}function shadersGetDebug(){return L}function cleanShaderError(e){if(e)e=e.replace(/\0/g,"").trim()
return e}Shader.prototype.compile=function(){var e=this.type,t=this.filename
var r=""
var a=f(t,"text")
if(p.webgl2&&a.includes("#pragma WebGL2"))r=e===gl.VERTEX_SHADER?U:k
a=(a=parseIncludes(t,a=""+r+S+this.defines+a)).replace(/#pragma WebGL2?/g,"")
if(e===gl.VERTEX_SHADER){this.attributes=u(a,O)
this.attributes.forEach(function(e){return h(void 0!==v[e])})}else{this.samplers=u(a,b)
var i=[]
this.samplers.forEach(function(e){var t=Number(e.slice(-1))
h(!isNaN(t))
h(!i[t])
i[t]=true})}this.uniforms=u(a,R)
this.uniforms.forEach(function(e){var t=e.split(" ")[0]
h(C[t])})
this.shader_source_text=a
if(gl.isContextLost()){this.valid=false
var o=this.error_text="Context lost"
if(this.defines_arr.length)t+="("+this.defines_arr.join(",")+")"
console[this.non_fatal?"warn":"error"]("Error compiling "+t+": "+o)
return}gl.shaderSource(this.shader,a)
gl.compileShader(this.shader)
if(!gl.getShaderParameter(this.shader,gl.COMPILE_STATUS)){this.valid=false
var n=this.error_text=cleanShaderError(gl.getShaderInfoLog(this.shader))
if(this.defines_arr.length)t+="("+this.defines_arr.join(",")+")"
console[this.non_fatal?"warn":"error"]("Error compiling "+t+": "+n)
reportShaderError(this.non_fatal,t+": "+n)
console.log(a.split("\n").map(function(e,t){return t+1+": "+e}).join("\n"))}else{this.valid=true
if(this.error_text)delete this.error_text}}
function shaderCreate(e){if("object"===typeof e)return new Shader(e)
return new Shader({filename:e})}function uniformSetValue(e){switch(e.width){case 1:gl.uniform1fv(e.location,e.value)
break
case 2:gl.uniform2fv(e.location,e.value)
break
case 3:gl.uniform3fv(e.location,e.value)
break
case 4:gl.uniform4fv(e.location,e.value)
break
case 9:gl.uniformMatrix3fv(e.location,false,e.value)
break
case 16:gl.uniformMatrix4fv(e.location,false,e.value)}}var G=false
function shadersRequirePrelink(e){var t=G
G=e
return t}function link(e,t,r){h(!G)
var c=e.programs[t.id]={handle:gl.createProgram(),uniforms:[]}
var a
if(!c.handle){a="gl.createProgram() returned "+c.handle
c.valid=false}else{gl.attachShader(c.handle,e.shader)
gl.attachShader(c.handle,t.shader)
for(var i=0;i<e.attributes.length;++i)gl.bindAttribLocation(c.handle,v[e.attributes[i]],e.attributes[i])
gl.linkProgram(c.handle)
c.valid=gl.getProgramParameter(c.handle,gl.LINK_STATUS)}if(!c.valid){c.uniforms=[]
a=a||cleanShaderError(gl.getProgramInfoLog(c.handle))
var o=true
if(gl.isContextLost()){a="(Context lost) "+a
o=false}console.error("Shader link error: "+a)
if(r&&(!p.DEBUG||r===m))r(a)
else if(o)reportShaderError(false,"Shader link error ("+e.filename+" & "+t.filename+"): "+a)
return c}gl.useProgram(c.handle)
g=c
var n=e.uniforms.slice(0)
for(var s=0;s<t.uniforms.length;++s){var l=t.uniforms[s]
if(-1===n.indexOf(l))n.push(l)}c.uniforms=n.map(function(e){var t=(e=e.split(" "))[0]
var r=e[1]
var a=1
var i=r.match(/([^[]+)\[(\d+)\]/)
if(i){r=i[1]
a=Number(i[2])}var o=gl.getUniformLocation(c.handle,r)
if(null===o)return null
var n=C[t]
var s=n*a
var l=T[r]
y[r]=true
var _={name:r,size:s,width:n,count:a,value:new Float32Array(s),location:o,glob:l}
uniformSetValue(_)
return _}).filter(function(e){return e})
h(c.uniforms)
for(var _=0;_<t.samplers.length;++_){var u=t.samplers[_]
var d=Number(u.slice(-1))
var f=gl.getUniformLocation(c.handle,u)
if(null!==f)gl.uniform1i(f,d)}return c}function autoLink(e,t,r){var a=e.programs[t.id]
if(!a)a=link(e,t,r)
if(!a.valid){if(!(a=link(e,I,m)).valid&&A)a=link(e,A,m)
if(!a.valid)a=link(w,I,m)
e.programs[t.id]=a}return a}function shadersBind(e,t,r){var a=e.programs[t.id]
if(!a)a=autoLink(e,t)
if(a!==g){g=a
gl.useProgram(a.handle)}for(var i=0;i<a.uniforms.length;++i){var o=a.uniforms[i]
var n=r[o.name]||o.glob
if(!n)continue
var s=false
for(var l=0;l<o.size;++l)if(n[l]!==o.value[l]){s=true
break}if(s){for(var _=0;_<o.size;++_)o.value[_]=n[_]
uniformSetValue(o)}}}function shadersPrelink(e,t,r,a){if(void 0===r)r={}
var i=autoLink(e,t,a)
if(i.valid)shadersBind(e,t,r)
return i.valid}var F={WEBGL2:1,GL_FRAGMENT_PRECISION_HIGH:1}
function addReservedDefine(e){F[e]=1}var W={}
function applyDefines(){S=Object.keys(p.defines).filter(function(e){return!F[e]}).concat(Object.keys(W)).map(function(e){return"#define "+e+"\n"}).join("")}function shaderReload(){shadersRequirePrelink(false)
if(L.length){if(P){o()
P=false}gl.useProgram(null)
for(var e=0;e<L.length;++e){var t=L[e].programs
if(t){for(var r in t)gl.deleteProgram(t[r].handle)
L[e].programs={}}}for(var a=0;a<L.length;++a)L[a].compile()
d()}}function shadersHandleDefinesChanged(){applyDefines()
shaderReload()}function shadersSetInternalDefines(e){for(var t in e)if(e[t])W[t]=e[t]
else delete W[t]
shadersHandleDefinesChanged()}function onShaderChange(e){shaderReload()}function shadersStartup(e){applyDefines()
a.globals=T=e
y={}
I=shaderCreate("shaders/error.fp")
if(p.webgl2)A=shaderCreate("shaders/error_gl2.fp")
w=shaderCreate("shaders/error.vp")
_(".fp",onShaderChange)
_(".vp",onShaderChange)
var t=I.valid&&w.valid
if(t){var r=autoLink(w,I)
if(!r||!r.valid)t=false}if(!t)clearTimeout(x)
return t}function shadersAddGlobal(e,t){h(!T[e])
h(!y[e])
T[e]=t
for(var r=0;r<t.length;++r)h(isFinite(t[r]))}a.create=shaderCreate
a.semantic=v
a.addGlobal=shadersAddGlobal
a.bind=shadersBind
a.prelink=shadersPrelink},{"../common/util.js":400,"./engine.js":305,"./error_report.js":311,"./filewatch.js":314,"./textures.js":365,"./webfs.js":371,assert:void 0}],354:[function(e,t,r){"use strict"
var a=/\r\n?/g
var i=/\t/g
var o=/\f/g
var n=function preprocess(e){return e.replace(a,"\n").replace(o,"").replace(i,"    ")}
var s=function populateInitialState(e,t){var r=e||{}
if(null!=t)for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a))r[a]=t[a]
return r}
var l=function parserFor(h,r){var p=Object.keys(h).filter(function(e){var t=h[e]
if(null==t||null==t.match)return false
var r=t.order
if(("number"!==typeof r||!isFinite(r))&&"undefined"!==typeof console)console.warn("simple-markdown: Invalid order for rule `"+e+"`: "+String(r))
return true})
p.sort(function(e,t){var r=h[e]
var a=h[t]
var i=r.order
var o=a.order
if(i!==o)return i-o
var n=r.quality?0:1
var s=a.quality?0:1
if(n!==s)return n-s
else if(e<t)return-1
else if(e>t)return 1
else return 0})
var m
var a=function nestedParse(e,t){var r=[]
m=t=t||m
while(e){var a=null
var i=null
var o=null
var n=NaN
var s=0
var l=p[0]
var _=h[l]
do{var c=_.order
var u=null==t.prevCapture?"":t.prevCapture[0]
var d=_.match(e,t,u)
if(d){var f=_.quality?_.quality(d,t,u):0
if(!(f<=n)){a=l
i=_
o=d
n=f}}l=p[++s]
_=h[l]}while(_&&(!o||_.order===c&&_.quality))
if(null==i||null==o)throw new Error("Could not find a matching rule for the below content. The rule with highest `order` should always match content provided to it. Check the definition of `match` for '"+p[p.length-1]+"'. It seems to not match the following source:\n"+e)
if(o.index)throw new Error("`match` must return a capture starting at index 0 (the current parse index). Did you forget a ^ at the start of the RegExp?")
var v=i.parse(o,nestedParse,t)
if(Array.isArray(v))Array.prototype.push.apply(r,v)
else{if(null==v||"object"!==typeof v)throw new Error("parse() function returned invalid parse result: '"+v+"'")
if(null==v.type)v.type=a
r.push(v)}t.prevCapture=o
e=e.substring(t.prevCapture[0].length)}return r}
return function outerParse(e,t){if(!(m=s(t,r)).inline&&!m.disableAutoBlockNewlines)e+="\n\n"
m.prevCapture=null
return a(n(e),m)}}
var _=function inlineRegex(a){var e=function match(e,t,r){if(t.inline)return a.exec(e)
else return null}
e.regex=a
return e}
var c=function blockRegex(r){var e=function match(e,t){if(t.inline)return null
else return r.exec(e)}
e.regex=r
return e}
var u=function anyScopeRegex(r){var e=function match(e,t){return r.exec(e)}
e.regex=r
return e}
var d=/\\([^0-9A-Za-z\s])/g
var f=function unescapeUrl(e){return e.replace(d,"$1")}
var v=function parseInline(e,t,r){var a=r.inline||false
r.inline=true
var i=e(t,r)
r.inline=a
return i}
var h=function parseBlock(e,t,r){var a=r.inline||false
r.inline=false
var i=e(t+"\n\n",r)
r.inline=a
return i}
var p=function parseCaptureInline(e,t,r){return{content:v(t,e[1],r)}}
var m=function ignoreCapture(){return{}}
var E="(?:[*+-]|\\d+\\.)"
var g="( *)("+E+") +"
var T=new RegExp("^"+g)
var y=new RegExp(g+"[^\\n]*(?:\\n(?!\\1"+E+" )[^\\n]*)*(\n|$)","gm")
var S=/^ (?= *`)|(` *) $/g
var I=/\n{2,}$/
var A=/ *\n+$/
var w=new RegExp("^( *)("+E+") [\\s\\S]+?(?:\n{2,}(?! )(?!\\1"+E+" )\\n*|\\s*\n*$)")
var L=/(?:^|\n)( *)$/
var O=function(){var i=/^ *\| *| *\| *$/g
var s=/ *$/
var t=/^ *-+: *$/
var r=/^ *:-+: *$/
var a=/^ *:-+ *$/
var o=function parseTableAlignCapture(e){if(t.test(e))return"right"
else if(r.test(e))return"center"
else if(a.test(e))return"left"
else return null}
var l=function parseTableAlign(e,t,r,a){if(a)e=e.replace(i,"")
return e.trim().split("|").map(o)}
var _=function parseTableRow(e,t,r,a){var i=r.inTable
r.inTable=true
var o=t(e.trim(),r)
r.inTable=i
var n=[[]]
o.forEach(function(e,t){if("tableSeparator"===e.type){if(!a||0!==t&&t!==o.length-1)n.push([])}else{if("text"===e.type&&(null==o[t+1]||"tableSeparator"===o[t+1].type))e.content=e.content.replace(s,"")
n[n.length-1].push(e)}})
return n}
var c=function parseTableCells(e,t,r,a){return e.trim().split("\n").map(function(e){return _(e,t,r,a)})}
var e=function parseTable(n){return function(e,t,r){r.inline=true
var a=_(e[1],t,r,n)
var i=l(e[2],t,r,n)
var o=c(e[3],t,r,n)
r.inline=false
return{type:"table",header:a,align:i,cells:o}}}
return{parseTable:e(true),parseNpTable:e(false),TABLE_REGEX:/^ *(\|.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/,NPTABLE_REGEX:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/}}()
var R="(?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*"
var b="\\s*<?((?:\\([^)]*\\)|[^\\s\\\\]|\\\\.)*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*"
var N=/mailto:/i
var C=function parseRef(e,t,r){var a=(e[2]||e[1]).replace(/\s+/g," ").toLowerCase()
if(t._defs&&t._defs[a]){var i=t._defs[a]
r.target=i.target
r.title=i.title}t._refs=t._refs||{}
t._refs[a]=t._refs[a]||[]
t._refs[a].push(r)
return r}
var x=0
var M={defaultRules:{heading:{order:x++,match:c(/^ *(#{1,6})([^\n]+?)#* *(?:\n *)+\n/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{level:e[1].length,content:v(t,e[2].trim(),r)}})},nptable:{order:x++,match:c(O.NPTABLE_REGEX),parse:O.parseNpTable},lheading:{order:x++,match:c(/^([^\n]+)\n *(=|-){3,} *(?:\n *)+\n/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{type:"heading",level:"="===e[2]?1:2,content:v(t,e[1],r)}})},hr:{order:x++,match:c(/^( *[-*_]){3,} *(?:\n *)+\n/),parse:m},codeBlock:{order:x++,match:c(/^(?:    [^\n]+\n*)+(?:\n *)+\n/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{lang:void 0,content:e[0].replace(/^    /gm,"").replace(/\n+$/,"")}})},fence:{order:x++,match:c(/^ *(`{3,}|~{3,}) *(?:(\S+) *)?\n([\s\S]+?)\n?\1 *(?:\n *)+\n/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{type:"codeBlock",lang:e[2]||void 0,content:e[3]}})},blockQuote:{order:x++,match:c(/^( *>[^\n]+(\n[^\n]+)*\n*)+\n{2,}/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{content:t(e[0].replace(/^ *> ?/gm,""),r)}})},list:{order:x++,match:function match(e,t){var r=null==t.prevCapture?"":t.prevCapture[0]
var a=L.exec(r)
var i=t._list||!t.inline
if(a&&i){e=a[1]+e
return w.exec(e)}else return null},parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,d,f){var t=e[2]
var r=t.length>1
var a=r?+t:void 0
var v=e[0].replace(I,"\n").match(y)
var h=false
return{ordered:r,start:a,items:v.map(function(e,t){var r=T.exec(e)
var a=r?r[0].length:0
var i=new RegExp("^ {1,"+a+"}","gm")
var o=e.replace(i,"").replace(T,"")
var n=t===v.length-1
var s=-1!==o.indexOf("\n\n")||n&&h
h=s
var l=f.inline
var _=f._list
f._list=true
var c
if(s){f.inline=false
c=o.replace(A,"\n\n")}else{f.inline=true
c=o.replace(A,"")}var u=d(c,f)
f.inline=l
f._list=_
return u})}})},def:{order:x++,match:c(/^ *\[([^\]]+)\]: *<?([^\s>]*)>?(?: +["(]([^\n]+)[")])? *\n(?: *\n)*/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){var a=e[1].replace(/\s+/g," ").toLowerCase()
var i=e[2]
var o=e[3]
if(r._refs&&r._refs[a])r._refs[a].forEach(function(e){e.target=i
e.title=o})
r._defs=r._defs||{}
r._defs[a]={target:i,title:o}
return{def:a,target:i,title:o}})},table:{order:x++,match:c(O.TABLE_REGEX),parse:O.parseTable},newline:{order:x++,match:c(/^(?:\n *)*\n/),parse:m},paragraph:{order:x++,match:c(/^((?:[^\n]|\n(?! *\n))+)(?:\n *)+\n/),parse:p},escape:{order:x++,match:_(/^\\([^0-9A-Za-z\s])/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{type:"text",content:e[1]}})},tableSeparator:{order:x++,match:function match(e,t){if(!t.inTable)return null
return/^ *\| */.exec(e)},parse:function parse(){return{type:"tableSeparator"}}},autolink:{order:x++,match:_(/^<([^: >]+:\/[^ >]+)>/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{type:"link",content:[{type:"text",content:e[1]}],target:e[1]}})},mailto:{order:x++,match:_(/^<([^ >]+@[^ >]+)>/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){var a=e[1]
var i=e[1]
if(!N.test(i))i="mailto:"+i
return{type:"link",content:[{type:"text",content:a}],target:i}})},url:{order:x++,match:_(/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{type:"link",content:[{type:"text",content:e[1]}],target:e[1],title:void 0}})},link:{order:x++,match:_(new RegExp("^\\[("+R+")\\]\\("+b+"\\)")),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{content:t(e[1],r),target:f(e[2]),title:e[3]}})},image:{order:x++,match:_(new RegExp("^!\\[("+R+")\\]\\("+b+"\\)")),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{alt:e[1],target:f(e[2]),title:e[3]}})},reflink:{order:x++,match:_(new RegExp("^\\[("+R+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return C(e,r,{type:"link",content:t(e[1],r)})})},refimage:{order:x++,match:_(new RegExp("^!\\[("+R+")\\]\\s*\\[([^\\]]*)\\]")),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return C(e,r,{type:"image",alt:e[1]})})},em:{order:x,match:_(new RegExp("^\\b_((?:__|\\\\[\\s\\S]|[^\\\\_])+?)_\\b|^\\*(?=\\S)((?:\\*\\*|\\\\[\\s\\S]|\\s+(?:\\\\[\\s\\S]|[^\\s\\*\\\\]|\\*\\*)|[^\\s\\*\\\\])+?)\\*(?!\\*)")),quality:function quality(e){return e[0].length+.2},parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{content:t(e[2]||e[1],r)}})},strong:{order:x,match:_(/^\*\*((?:\\[\s\S]|[^\\])+?)\*\*(?!\*)/),quality:function quality(e){return e[0].length+.1},parse:p},u:{order:x++,match:_(/^__((?:\\[\s\S]|[^\\])+?)__(?!_)/),quality:function quality(e){return e[0].length},parse:p},del:{order:x++,match:_(/^~~(?=\S)((?:\\[\s\S]|~(?!~)|[^\s~\\]|\s(?!~~))+?)~~/),parse:p},inlineCode:{order:x++,match:_(/^(`+)([\s\S]*?[^`])\1(?!`)/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{content:e[2].replace(S,"$1")}})},br:{order:x++,match:u(/^ {2,}\n/),parse:m},text:{order:x++,match:u(/^[\s\S]+?(?=[^0-9A-Za-z\s\u00c0-\uffff]|\n\n| {2,}\n|\w+:\S|$)/),parse:function(a){function parse(e,t,r){return a.apply(this,arguments)}parse.toString=function(){return a.toString()}
return parse}(function(e,t,r){return{content:e[0]}})}},parserFor:l,inlineRegex:_,blockRegex:c,anyScopeRegex:u,parseInline:v,parseBlock:h,preprocess:n,unescapeUrl:f}
t.exports=M},{}],355:[function(e,t,r){"use strict"
r.sliderSetDefaultShrink=sliderSetDefaultShrink
r.sliderIsDragging=sliderIsDragging
r.sliderIsFocused=sliderIsFocused
r.slider=slider
var a
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var g=e("assert")
var T=Math.round,y=Math.max
var S=e("../common/util.js").clamp
var i=e("../common/vmath.js").vec4
var I=e("./input.js")
var o=e("./spot.js")
var n=o.SPOT_DEFAULT_BUTTON
var A=o.SPOT_NAV_LEFT
var w=o.SPOT_NAV_RIGHT
var L=o.spot
var s=e("./ui.js")
var O=s.Z_MIN_INC
var R=s.drawHBox
var b=s.playUISound
var N=s.uiButtonHeight
var C=s.uiButtonWidth
var x=e("./ui.js")
var M=_extends({},n,{sound_button:null,custom_nav:((a={})[w]=null,a[A]=null,a)})
var D=1
var P=1
var B=0
function sliderSetDefaultShrink(e,t,r){D=e
P=t
B=r||0}var k=i(1,1,1,1)
var U=i(.5,.5,.5,1)
var G=i(.75,.75,.75,1)
var F=false
var W=false
function sliderIsDragging(){return F}function sliderIsFocused(){return W}function slider(e,t){g("number"===typeof t.x)
g("number"===typeof t.y)
g(t.min<t.max)
t.z=t.z||Z.UI
t.w=t.w||C()
t.h=t.h||N()
t.max_dist=t.max_dist||Infinity
var r=t.vshrink||D
var a=t.handle_shrink||P
var i=t.disabled||false
var o=t.h*a
var n=x.sprites.slider_handle.uidata.wh[0]*o
var s=t.pad_focusable
F=false
var l=a-r+B
R({x:t.x+t.h*l/2,y:t.y+t.h*(1-r)/2,z:t.z,w:t.w-t.h*l,h:t.h*r},x.sprites.slider,t.color)
var _=T(y(x.sprites.slider.uidata.wh[0]*t.h*r,n)/2)
var c=t.w-2*_
var u=!i&&I.drag(t)
var d=Boolean(u)
t.def=M
if(d)t.focus_steal=true
t.pad_focusable=s
var f=L(t)
W=f.focused
if(f.ret&&f.pos){d=false
e=(f.pos[0]-(t.x+_))/c
e=t.min+(t.max-t.min)*S(e,0,1)
b("button_click")}else if(d){e=(u.cur_pos[0]-(t.x+_))/c
e=t.min+(t.max-t.min)*S(e,0,1)
I.mouseOver()
W=F=true}if(f.nav){b("button_click")
var v=t.step||(t.max-t.min)/16
if(f.nav===w)e=S(e+v,t.min,t.max)
else if(f.nav===A)e=S(e-v,t.min,t.max)}var h=S(e,t.min,t.max)
var p=t.x+_+c*(h-t.min)/(t.max-t.min)-n/2
var m=t.y+t.h/2-o/2
var E=k
if(d)E=U
else if(f.focused)E=G
x.sprites.slider_handle.draw({x:p,y:m,z:t.z+O,w:n,h:o,color:E,frame:0})
return e}},{"../common/util.js":400,"../common/vmath.js":402,"./input.js":326,"./spot.js":361,"./ui.js":367,assert:void 0}],356:[function(e,t,r){"use strict"
r.viewportRenderPrepare=viewportRenderPrepare
r.viewportRenderFinish=viewportRenderFinish
r.snapshot=snapshot
r.snapshotDrawDynamic=snapshotDrawDynamic
r.snapshotStartup=snapshotStartup
r.OFFSET_GOLDEN=void 0
var i=e("assert")
var a=e("./camera2d.js")
var o=e("./draw_list.js"),s=o.alphaDraw,l=o.alphaDrawListSize,n=o.alphaListPush,_=o.alphaListPop
var c=e("./effects.js")
var u=e("./engine.js")
var d=e("./framebuffer.js").framebufferCapture
var f=e("gl-mat4/copy")
var v=e("gl-mat4/lookAt")
var h=Math.max,p=Math.PI,m=Math.tan
var E=e("./shaders.js"),g=E.shaderCreate,T=E.shadersPrelink
var y=e("./sprites.js")
var S=e("./sprites.js"),I=S.clipCoordsScissor,A=S.scissorPop,w=S.scissorPushIntersection,L=S.spriteCreate,O=S.spriteQueueFn
var R=y.blendModeSet,b=y.BLEND_ALPHA
var N=e("./textures.js").textureCreateForCapture
var C=e("../common/vmath.js"),x=C.mat4,M=C.vec3,D=C.v3addScale,P=C.v3copy,B=C.vec4,k=C.v4copy,U=C.zaxis
var G=e("./quat.js"),F=G.qRotateZ,W=G.qTransformVec3,H=G.quat,z=G.unit_quat
var V=M(-1/1.618,-1,1/1.618/1.618)
r.OFFSET_GOLDEN=V
var Y
var j=B()
var K=x()
var q=x()
function viewportRenderPrepare(e){var t=e.pre,r=e.viewport
k(j,u.viewport)
f(K,u.mat_projection)
f(q,u.mat_view)
n()
y.spriteQueuePush()
a.push()
if(t)t()
R(b)
gl.enable(gl.BLEND)
gl.enable(gl.DEPTH_TEST)
gl.depthMask(true)
gl.enable(gl.CULL_FACE)
u.setViewport(r)
gl.clear(gl.DEPTH_BUFFER_BIT)
a.setNormalized()
w(r)}function viewportRenderFinish(e){var t=e.post
gl.disable(gl.SCISSOR_TEST)
if(t)t()
_()
a.pop()
y.spriteQueuePop()
u.setProjection(K)
u.setViewport(j)
u.setGlobalMatrices(q)
u.startSpriteRendering()
A()}var Z=x()
var X=M()
var Q=M()
var $=M()
var J=H()
var ee=B(0,1,1,0)
var te=15/180*p
var re=.5/m(te/2)*1.1
var ae=0
function snapshotSetupMats(e){var t=e.camera_offset||V
var r=h(e.size[0],e.size[2])*re+e.size[1]/2
u.setupProjection(te,e.w,e.h,.1,2*r)
D(X,e.pos,e.size,.5)
if(e.rot){F(J,z,e.rot)
W($,t,J)}else P($,t)
D(Q,X,$,r)
v(Z,Q,X,U)
u.setGlobalMatrices(Z)}var ie={copy_uv_scale:B(1,-1,0,0)}
function snapshot(e){i(!u.had_3d_this_frame)
var t=e.name||"snapshot_"+ ++ae
var r=e.on_unload
var a=e.sprite&&e.sprite.texs||[N(t+"(0)",r),N(t+"(1)",r)]
e.viewport=[0,0,e.w,e.h]
viewportRenderPrepare(e)
snapshotSetupMats(e)
gl.clearColor(0,0,0,0)
gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)
if(e.snapshot_backdrop){gl.depthMask(false)
c.applyCopy({source:e.snapshot_backdrop.texs,no_framebuffer:true,params:ie})
gl.depthMask(true)}e.draw()
if(l()){s()
gl.depthMask(true)}d(a[0],e.w,e.h,true,false)
gl.clearColor(1,1,1,0)
gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)
if(e.snapshot_backdrop){gl.depthMask(false)
c.applyCopy({source:e.snapshot_backdrop.texs,no_framebuffer:true,params:ie})
gl.depthMask(true)}e.draw()
if(l()){s()
gl.depthMask(true)}d(a[1],e.w,e.h,true,false)
viewportRenderFinish(e)
if(!e.sprite)e.sprite=L({texs:a,shader:Y,uvs:ee})
return e.sprite}function snapshotDrawDynamic(e){var t=e.x,r=e.y,a=e.z,i=e.w,o=e.h
if(e.snapshot_backdrop)e.snapshot_backdrop.draw({x:t,y:r,w:i,h:o,z:a-.01})
var n=I(t,r,i,o)
e.viewport=n
O(a,function(){viewportRenderPrepare(e)
snapshotSetupMats(e)
e.draw()
if(l()){s()
gl.depthMask(true)}viewportRenderFinish(e)})}function snapshotStartup(){Y=g("shaders/snapshot.fp")
T(y.sprite_vshader,Y)}},{"../common/vmath.js":402,"./camera2d.js":295,"./draw_list.js":301,"./effects.js":304,"./engine.js":305,"./framebuffer.js":316,"./quat.js":346,"./shaders.js":353,"./sprites.js":363,"./textures.js":365,assert:void 0,"gl-mat4/copy":void 0,"gl-mat4/lookAt":void 0}],357:[function(e,t,r){"use strict"
r.friendsGet=friendsGet
r.isFriend=isFriend
r.friendIsBlocked=friendIsBlocked
r.friendAdd=friendAdd
r.friendRemove=friendRemove
r.friendBlock=friendBlock
r.friendUnblock=friendUnblock
r.socialPresenceStatusGet=socialPresenceStatusGet
r.socialPresenceStatusSet=socialPresenceStatusSet
r.richPresenceSet=richPresenceSet
r.getExternalCurrentUserInfos=getExternalCurrentUserInfos
r.getExternalFriendInfos=getExternalFriendInfos
r.getExternalUserInfos=getExternalUserInfos
r.getUserProfileImage=getUserProfileImage
r.getDefaultUserProfileImage=getDefaultUserProfileImage
r.setDefaultUserProfileImage=setDefaultUserProfileImage
r.registerExternalUserInfoProvider=registerExternalUserInfoProvider
r.socialInit=socialInit
r.SOCIAL_INVISIBLE=r.SOCIAL_AFK=r.SOCIAL_ONLINE=void 0
var _=e("assert")
var a=e("./settings")
var i=e("../common/enums")
var o=i.PRESENCE_ACTIVE
var n=i.PRESENCE_INACTIVE
var s=i.PRESENCE_OFFLINE
var l=i.PRESENCE_OFFLINE_INACTIVE
var c=e("../common/friends_data").FriendStatus
var u=e("../common/util").deepEqual
var d=e("./abtest").abTestGetMetricsAndPlatform
var f=e("./cmds").cmd_parse
var v=e("./input")
var h=e("./net")
var p=h.netDisconnected
var m=h.netSubs
var E=h.netUserId
var g=e("./sprites").spriteCreate
var T=e("./textures").textureLoad
var y=6e4
var S=null
function friendsGet(){return null!=S?S:Object.create(null)}function isFriend(e){var t=null==S?void 0:S[e]
return(null==t?void 0:t.status)===c.Added||(null==t?void 0:t.status)===c.AddedAuto}function friendIsBlocked(e){var t=null==S?void 0:S[e]
return(null==t?void 0:t.status)===c.Blocked}function makeFriendCmdRequest(e,r,a){r=r.toLowerCase()
var i=E()
if(p())return void a("ERR_DISCONNECTED")
if(!i)return void a("ERR_NOT_LOGGED_IN")
var t=m().getMyUserChannel()
_(t)
t.cmdParse(e+" "+r,function(e,t){if(e)return void a(e)
else if(i!==E()||!S)return void a("Invalid data")
_(t)
if(t.friend)S[r]=t.friend
else delete S[r]
a(null,t.msg)})}function friendAdd(e,t){makeFriendCmdRequest("friend_add",e,t)}function friendRemove(e,t){makeFriendCmdRequest("friend_remove",e,t)}function friendBlock(e,t){makeFriendCmdRequest("friend_block",e,t)}function friendUnblock(e,t){makeFriendCmdRequest("friend_unblock",e,t)}f.register({cmd:"friend_add",help:"Add a friend",func:friendAdd})
f.register({cmd:"friend_remove",help:"Remove a friend",func:friendRemove})
f.register({cmd:"friend_block",help:"Block someone from seeing your rich presence, also removes from your friends list",func:friendBlock})
f.register({cmd:"friend_unblock",help:"Reset a user to allow seeing your rich presence again",func:friendUnblock})
f.register({cmd:"friend_list",help:"List all friends",func:function func(e,t){if(!S)return void t("Friends list not loaded")
t(null,Object.keys(S).filter(isFriend).join(",")||"You have no friends")}})
f.register({cmd:"friend_block_list",help:"List all blocked users",func:function func(e,t){if(!S)return void t("Friends list not loaded")
t(null,Object.keys(S).filter(friendIsBlocked).join(",")||"You have no blocked users")}})
var I=1
r.SOCIAL_ONLINE=I
var A=2
r.SOCIAL_AFK=A
var w=3
r.SOCIAL_INVISIBLE=w
a.register({social_presence:{default_value:I,type:f.TYPE_INT,range:[I,w],access_show:["hidden"]}})
function socialPresenceStatusGet(){return a.social_presence}function socialPresenceStatusSet(e){a.set("social_presence",e)}f.registerValue("invisible",{type:f.TYPE_INT,help:"Hide rich presence information from other users",label:"Invisible",range:[0,1],get:function get(){return a.social_presence===w?1:0},set:function set(e){return socialPresenceStatusSet(e?w:I)}})
f.registerValue("afk",{type:f.TYPE_INT,help:"Appear as idle to other users",label:"AFK",range:[0,1],get:function get(){return a.social_presence===A?1:0},set:function set(e){return socialPresenceStatusSet(e?A:I)}})
function onPresence(e){this.presence_data=e}function onUnSubscribe(){delete this.presence_data}var L=null
var O=false
function richPresenceSend(){if(!m().loggedIn()||!L||O)return
O=true
m().onceConnected(function(){O=false
if(!m().loggedIn()||!L)return
var e=m().getMyUserChannel().pak("presence_set")
e.writeInt(L.active)
e.writeAnsiString(L.state)
e.writeJSON(L.payload)
e.writeAnsiString(d())
e.send()})}function richPresenceSet(e,t,r){var a
switch(socialPresenceStatusGet()){case A:a=e===o?n:e
break
case w:a=s
break
default:a=e}if(Date.now()-v.inputLastTime()>y)if(a===o)a=n
else if(a===s)a=l
r=r||null
if(!L||a!==L.active||t!==L.state||!u(L.payload,r)){L={active:a,state:t,payload:r}
richPresenceSend()}}var R=Object.create(null)
var b=Object.create(null)
function getExternalCurrentUserInfos(){return R}function getExternalFriendInfos(e){return b[e]}function getExternalUserInfos(e){if(e===E())return getExternalCurrentUserInfos()
else return getExternalFriendInfos(e)}function setExternalCurrentUser(e,t){if(t)R[e]=t
else delete R[e]}function updateExternalFriendsOnServer(n,s,e){if(0===s.length&&0===e.length||p())return
var l=E()
var t=m().getMyUserChannel()
_(t)
var r=t.pak("friend_auto_update")
r.writeAnsiString(n)
for(var a=0;a<s.length;++a)r.writeAnsiString(s[a].external_id)
r.writeAnsiString("")
for(var i=0;i<e.length;++i)r.writeAnsiString(e[i])
r.writeAnsiString("")
r.send(function(e,t){if(l!==E()||!S)return
else if(e)return
else if(!t)return
var i=Object.create(null)
for(var r in t){var a=S[r]=t[r]
if(a.ids){var o=a.ids[n]
i[o]=r}}s.forEach(function(e){var t=e.external_id
var r=i[t]
if(r){var a=b[r]
if(!a)a=b[r]=Object.create(null)
a[n]=e}})})}function setExternalFriends(i,e){var o=Object.create(null)
for(var t in S){var r
var a=null==(r=S[t].ids)?void 0:r[i]
if(a)o[a]=t}for(var n in b)delete b[n][i]
var s=[]
e.forEach(function(e){var t=e.external_id
var r=o[t]
if(r){var a=b[r]
if(!a)a=b[r]=Object.create(null)
a[i]=e
delete o[t]}else s.push(e)})
var l=[]
for(var _ in o)l.push(_)
if(0!==s.length||0!==l.length)updateExternalFriendsOnServer(i,s,l)}function requestExternalCurrentUser(r,e){var a=E()
e(function(e,t){if(a!==E())return
else if(e||!t)return
setExternalCurrentUser(r,t)})}function requestExternalFriends(r,e){var a=E()
e(function(e,t){if(a!==E()||!S)return
else if(e||!t)return
setExternalFriends(r,t)})}var N={}
var C
function getUserProfileImage(e){var t=N[e]
if(t)return t
var r=null
var a=getExternalUserInfos(e)
if(a)for(var i in a)if(a[i]&&a[i].profile_picture_url){r=a[i].profile_picture_url
break}if(r){var o=T({url:r,filter_min:gl.LINEAR_MIPMAP_LINEAR,filter_mag:gl.LINEAR,soft_error:true,auto_unload:function auto_unload(){return delete N[e]}})
if(o&&o.loaded)return N[e]={img:g({tex:o})}}return C}function getDefaultUserProfileImage(){return C}function setDefaultUserProfileImage(e){C=e}var x={}
function registerExternalUserInfoProvider(e,t,r){if(t||r){_(!S)
_(!m().loggedIn())
x[e]={get_current_user:t,get_friends:r}}else delete x[e]}function socialInit(){m().on("login",function(){var e=m().getMyUserChannel()
var n=E()
richPresenceSend()
S=null
if(p())return
_(e)
e.pak("friend_list").send(function(e,t){if(e||n!==E())return
_(t)
S=t
for(var r in x){var a=x[r],i=a.get_current_user,o=a.get_friends
if(i)requestExternalCurrentUser(r,i)
if(o)requestExternalFriends(r,o)}})})
m().on("logout",function(){S=null
R=Object.create(null)
b=Object.create(null)})
m().onChannelMsg("user","presence",onPresence)
m().onChannelEvent("user","unsubscribe",onUnSubscribe)}},{"../common/enums":385,"../common/friends_data":388,"../common/util":400,"./abtest":288,"./cmds":298,"./input":326,"./net":338,"./settings":351,"./sprites":363,"./textures":365,assert:void 0}],358:[function(e,t,r){"use strict"
r.isPlaceholderSound=isPlaceholderSound
r.fadesCount=fadesCount
r.soundOnLoadFail=soundOnLoadFail
r.soundFindForReplacement=soundFindForReplacement
r.soundReplaceFromDataURL=soundReplaceFromDataURL
r.soundLoad=soundLoad
r.soundPause=soundPause
r.soundResume=soundResume
r.soundMusicPause=soundMusicPause
r.soundMusicResume=soundMusicResume
r.soundStartup=soundStartup
r.soundResumed=soundResumed
r.soundTick=soundTick
r.soundPlay=soundPlay
r.soundPlayStreaming=soundPlayStreaming
r.soundPlayMusic=soundPlayMusic
r.soundLoading=soundLoading
r.FADE=r.FADE_IN=r.FADE_OUT=r.FADE_DEFAULT=void 0
var a=0
r.FADE_DEFAULT=a
var _=1
r.FADE_OUT=_
var c=2
r.FADE_IN=c
var i=_+c
r.FADE=i
var p=e("assert")
var o=e("../common/util")
var m=o.callEach
var n=o.defaults
var E=o.ridx
var s=e("./browser")
var g=s.is_firefox
var T=s.is_itch_app
var l=e("./cmds").cmd_parse
var u=e("./engine")
var d=u.onEnterBackground
var f=u.onExitBackground
var v=e("./filewatch").filewatchOn
var y=e("./locate_asset").locateAsset
var S=e("./settings")
var h=e("./textures").textureCname
var I=e("./urlhash")
var A=e("@jimbly/howler/src/howler.core.js"),w=A.Howl,L=A.Howler
var O=Math.abs,R=Math.floor,b=Math.max,N=Math.min,C=Math.random
function isPlaceholderSound(e){return e.is_placeholder}var x={}
var M=[]
var D=0
var P={ext_list:["ogg","mp3"],fade_rate:.001,fade_music_in_bg:true}
var B
var k={}
var U=0
var G=[]
var F
function fadesCount(){return G.length}var W=1
var H=1
var z=1
var V=1
S.register({volume:{default_value:1,type:l.TYPE_FLOAT,range:[0,1]}})
S.register({volume_music:{default_value:1,type:l.TYPE_FLOAT,range:[0,1]}})
S.register({volume_sound:{default_value:1,type:l.TYPE_FLOAT,range:[0,1]}})
function musicVolume(){return S.volume*S.volume_music}function soundVolume(){return S.volume*S.volume_sound}var Y={}
var j={}
var K
function soundOnLoadFail(e){K=e}function soundFindForReplacement(e){if(x[e])return e
for(var t in x)if(h(t)===e)return t
return null}function soundReplaceFromDataURL(a,e){var t=x[a]
p(t)
var r=t.glov_load_opts
var i=r.loop
var o=new w({src:e,html5:false,loop:Boolean(i),volume:0,onload:function onload(){o.glov_load_opts=r
x[a]=o},onloaderror:function onloaderror(e,t,r){console.error("Error loading sound "+a+": "+t)}})}function soundLoad(e,t,r){if((t=t||{}).streaming&&(g||T))t.streaming=false
var a=t,o=a.streaming,n=a.loop
if(Array.isArray(e)){p(!r)
for(var i=0;i<e.length;++i)soundLoad(e[i],t)
return}var s="string"===typeof e?e:e.file
if(x[s]){if(r)r()
return}if(j[s]){if(r)j[s].push(r)
return}var l=[]
if(r)l.push(r)
j[s]=l
delete Y[s]
var _=s
var c=_.match(/^((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)\.(mp3|ogg|wav|webm)$/)
var u
if(c){_=c[1]
u=c[2]}var d="sounds/"+_
var f=[]
if(u)f.push(d+"."+u)
for(var v=0;v<B.ext_list.length;++v){var h=B.ext_list[v]
if(h!==u)f.push(d+"."+h)}f=f.map(function(e){if(t.for_reload)e=e+"?rl="+Date.now()
else e=y(e)
return""+I.getURLBase()+e})
function tryLoad(a){if(a===f.length){console.error("Error loading sound "+_+": All fallbacks exhausted, giving up")
if(K)K(_)
Y[s]=t
m(l,delete j[s],"Error loading sound")
return}if(!o)++D
var i=false
var e=new w({src:f.slice(a),html5:Boolean(o),loop:Boolean(n),volume:0,onload:function onload(){if(!i){if(!o)--D
i=true
e.glov_load_opts=t
x[s]=e
m(l,delete j[s],null)}},onloaderror:function onloaderror(e,t,r){if(a===f.length-1)console.error("Error loading sound "+f[a]+": "+t)
else console.log("Error loading sound "+f[a]+": "+t+", trying fallback...")
if(!i){if(!o)--D
i=true
tryLoad(a+1)}}})}tryLoad(0)}function soundReload(e){var t=e.match(/^sounds\/([^.]+)\.\w+$/)
var r=t&&t[1]
if(!r)return
var a=x[r]
var i=Y[r]
if(!a&&!i){console.log("Reload triggered for non-existent sound: "+e)
return}var o
if(a){(o=a.glov_load_opts).for_reload=true
delete x[r]}else{p(i)
o=i
delete Y[r]}soundLoad(r,o)}function soundPause(){soundTick(W=H=0)}function soundResume(){H=1
L.manualUnlock()}function soundMusicPause(){V=0}var q=false
function soundMusicResume(){V=1
q=true}function soundFadeMusicInBackground(){var t=null
var r
function musicForceTick(){var e=Date.now()
soundTick(e-r)
r=e
t=setTimeout(musicForceTick,100)}d(function(){soundMusicPause()
r=Date.now()
if(!t)t=setTimeout(musicForceTick,100)})
f(function(){soundMusicResume()
if(t){clearTimeout(t)
t=null}})}function soundStartup(e){B=n(e||{},P)
F=[]
for(var t=0;t<2;++t)F.push({sound:null,id:0,current_volume:0,target_volume:0,sys_volume:0,need_play:false})
v(".mp3",soundReload)
v(".ogg",soundReload)
v(".wav",soundReload)
v(".webm",soundReload)
if(B.fade_music_in_bg)soundFadeMusicInBackground()}function soundResumed(){return!L.noAudio&&L.safeToPlay}function blendOverride(e,t,r){var a=.001*e
if(t<r)t=N(t+a,r)
else t=b(t-a,r)
return t}function soundTick(e){U+=e
if(W!==H)W=blendOverride(e,W,H)
if(z!==V)if(q)q=false
else z=blendOverride(e,z,V)
if(!soundResumed())return
for(var t=0;t<M.length;++t){var r=M[t],a=r.sound,i=r.play_volume,o=r.set_volume_when_played
if(!a.playing())E(M,t)
else if(o!==musicVolume()){a.volume(i)
M[t].set_volume_when_played=musicVolume()}}var n=e*B.fade_rate
for(var s=0;s<F.length;++s){var l=F[s]
if(!l.sound)continue
var _=S.volume*S.volume_music===0?0:l.target_volume
if(l.current_volume!==_){var c=_-l.current_volume
var u=N(O(c),n)
if(c<0)l.current_volume=b(_,l.current_volume-u)
else l.current_volume=N(_,l.current_volume+u)
if(!l.target_volume&&!l.current_volume){if(!l.need_play)l.sound.stop(l.id)
l.sound=null}}if(l.sound){var d=l.current_volume*musicVolume()*W*z
if(l.need_play){l.need_play=false
l.id=l.sound.play()
l.sys_volume=-1}if(l.sys_volume!==d){l.sound.volume(d,l.id)
l.sys_volume=d}}}for(var f=G.length-1;f>=0;--f){var v=G[f]
var h=v.target_volume-v.volume
var p=N(O(h),v.time?e/v.time:n)
if(h<0)v.volume=b(v.target_volume,v.volume-p)
else v.volume=N(v.target_volume,v.volume+p)
v.sound.volume(v.volume)
if(v.volume===v.target_volume){E(G,f)
if(!v.volume)v.sound.stop()}}}function soundPlay(e,t,r){t=t||1
if(S.volume*(r?S.volume_music:S.volume_sound)===0)return null
if(!soundResumed())return null
if(Array.isArray(e))e=e[R(C()*e.length)]
if("object"===typeof e){t*=e.volume||1
e=e.file}var a=x[e]
if(!a)return null
var i=k[e]||-9e9
if(U-i<45)return null
var o=r?musicVolume:soundVolume
var n=a.play(void 0,t*o()*W)
k[e]=U
var s={name:e,volume_current:t,stop:a.stop.bind(a,n),playing:a.playing.bind(a,n),location:function location(){var e=a.seek(n)
if("number"!==typeof e)return 0
return e},duration:a.duration.bind(a,n),volume:function volume(e){s.volume_current=e
a.volume(e*o()*W,n)},fade:function fade(e,t){var r={sound:s,volume:s.volume_current,target_volume:e,id:n,time:t,settingsVolume:o}
for(var a=0;a<G.length;++a)if(G[a].id===n){G[a]=r
return}G.push(r)}}
if(r)M.push({sound:s,play_volume:t,set_volume_when_played:musicVolume()})
return s}function soundPlayStreaming(t,r,a,i){if(S.volume*(a?S.volume_music:S.volume_sound)===0)return null
if(Array.isArray(t))t=t[R(C()*t.length)]
var o={name:t,is_placeholder:true}
soundLoad(t,{streaming:true,loop:false},function(e){if(!e){o=soundPlay(t,r,a)
if(i)i(o)}})
return o}function soundPlayMusic(n,s,l){if(S.volume*S.volume_music===0)return
if(void 0===s)s=1
l=l||a
soundLoad(n,{streaming:true,loop:true},function(e){var t=null
if(e);else{t=x[n]
p(t)
if(F[0].sound===t){F[0].target_volume=s
if(!l)if(!s){t.stop(F[0].id)
F[0].sound=null}else{var r=F[0].sys_volume=s*musicVolume()*W*z
t.volume(r,F[0].id)
if(!t.playing())t.play(void 0,r)}return}}if(F[0].current_volume)if(l&_){var a=F[1]
F[1]=F[0]
F[0]=a
F[1].target_volume=0}if(F[0].sound)F[0].sound.stop(F[0].id)
if(F[0].sound=t){F[0].target_volume=s
var i=l&c?0:s
F[0].current_volume=i
if(soundResumed()){var o=i*musicVolume()*W*z
F[0].id=t.play(void 0,o)
F[0].sys_volume=o
F[0].need_play=false}else F[0].need_play=true}else F[0].target_volume=F[0].current_volume=0})}function soundLoading(){return D}},{"../common/util":400,"./browser":293,"./cmds":298,"./engine":305,"./filewatch":314,"./locate_asset":331,"./settings":351,"./textures":365,"./urlhash":369,"@jimbly/howler/src/howler.core.js":void 0,assert:void 0}],359:[function(e,t,r){"use strict"
r.GlovSoundScape=void 0
var a=e("./soundscape_types")
var x=e("assert")
var M=e("../common/util").ridx
var s=e("./engine.js")
var i=e("./sound")
var D=i.isPlaceholderSound
var l=i.soundLoad
var P=i.soundPlay
var B=i.soundPlayStreaming
var k=i.soundResumed
var _=e("./soundscape_types").dataLayerHasMax
var U=e("./settings")
var G=Math.floor,F=Math.max,W=Math.min,H=Math.random
for(var o in a)if("default"!==o)r[o]=a[o]
var c=function GlovSSFile(e,t,r){this.file=void 0
this.fade_time=void 0
this.excl_group=void 0
this.excl_group_first=void 0
this.excl_group_debug=void 0
this.tag_id=void 0
this.file=""+e.base_path+t.file
if("string"===typeof t.excl_group)t.excl_group=[t.excl_group]
x(Array.isArray(t.excl_group))
this.excl_group_first=t.excl_group[0]
this.excl_group_debug=t.excl_group.join(",")
var a={}
for(var i=0;i<t.excl_group.length;++i)a[t.excl_group[i]]=true
this.excl_group=a
this.fade_time=t.fade_time||e.default_fade_time
if(r)this.tag_id=r}
var u=3e4
var d=15e3
var f=Infinity
var v=5e3
var n=5e3
var h=function GlovSSTagLayer(r,e,t,a){var i=this
this.excl_group_master=void 0
this.sync_with=void 0
this.odds=void 0
this.odds_total=void 0
this.period=void 0
this.period_noise=void 0
this.min_intensity=void 0
this.max_intensity=void 0
this.add_delay=void 0
this.files=void 0
this.files_map=void 0
this.priority=void 0
this.files_map={}
this.files=e.files.map(function(e){var t=new c(r,e,a)
i.files_map[t.file]=t
if(!r.streaming)l(e.file,{streaming:true})
return t})
this.priority=e.priority
this.excl_group_master=t.excl_group_master
this.sync_with=e.sync_with||t.sync_with
this.odds=e.odds||t.odds
this.period=e.period||t.period||u
this.period_noise=t.period_noise||d
this.min_intensity=e.min_intensity||t.min_intensity
this.max_intensity=e.max_intensity||t.max_intensity||f
this.add_delay=e.add_delay||t.add_delay||v
for(var o=this.odds_total=0;o<this.odds.length;++o)this.odds_total+=this.odds[o]}
var p=function GlovSSParentLayer(r,e){var a=this
this.excl_group_master=void 0
this.sync_with=void 0
this.odds=void 0
this.odds_total=void 0
this.period=void 0
this.period_noise=void 0
this.min_intensity=void 0
this.max_intensity=void 0
this.add_delay=void 0
this.files=void 0
this.files_map=void 0
this.tags=void 0
this.user_idx=void 0
var t=e.tags
this.files_map={}
this.files=e.files.map(function(e){var t=new c(r,e)
a.files_map[t.file]=t
if(!r.streaming)l(e.file,{streaming:true})
return t})
this.excl_group_master=e.excl_group_master
this.sync_with=e.sync_with
this.min_intensity=e.min_intensity
this.odds_total=0
if(_(e)){this.odds=[0]
for(var i=0;i<e.max;++i)this.odds.push(1)}else this.odds=e.odds
for(var o=0;o<this.odds.length;++o)this.odds_total+=this.odds[o]
this.add_delay=e.sync_with?0:e.add_delay||v
this.period=e.period||u
this.period_noise=e.period_noise||d
this.max_intensity=e.max_intensity||f
this.tags={}
for(var n in t){r.tags[n]=false
this.tags[n]=new h(r,t[n],this,n)}this.user_idx=++r.user_idx}
var m=false
var E=true
var g=500
var T=true
var z=1e3
var V=1
var Y=1e-4
var y=function(){function GlovSoundScape(e){this.data_layers=void 0
this.layers=void 0
this.base_path=void 0
this.default_fade_time=void 0
this.enable_logs=void 0
this.streaming=void 0
this.kill_delay=void 0
this.force_no_tracks=false
this.fade_in_time=0
this.fade_in_start=0
this.intensity=0
this.tags={}
this.tag_timer={}
this.tag_tolerance=void 0
this.streaming_cbs={}
this.layer_state={}
this.layer_keys=[]
this.timestamp=s.frame_timestamp
this.user_idx=0
this.data_layers=e.layers
this.layers={}
this.base_path=e.base_path
this.default_fade_time=e.default_fade_time
this.enable_logs=void 0!==e.enable_logs?e.enable_logs:m
this.streaming=void 0!==e.streaming?e.streaming:E
this.kill_delay=void 0!==e.kill_delay?e.kill_delay:g
this.tag_tolerance=void 0!==e.tag_tolerance?e.tag_tolerance:n
e.add_all=void 0!==e.add_all?e.add_all:T
if(e.add_all)this.addAll()}var e=GlovSoundScape.prototype
e.addLayer=function addLayer(e){var o=this
if(!this.layer_state[e]){this.layers[e]=new p(this,this.data_layers[e])
this.layer_state[e]={active:[],rel_intensity:H(),last_add:0,change:this.timestamp+this.layers[e].period+H()*this.layers[e].period_noise,add_blocked:false,drained:false}
this.layer_keys.push(e)
this.layer_keys.sort(function(e,t){var r=o.layers[e]
var a=o.layers[t]
var i=(r.excl_group_master?1:0)-(a.excl_group_master?1:0)
if(i)return-i
if(i=(r.sync_with?1:0)-(a.sync_with?1:0))return i
return r.user_idx-a.user_idx})}}
e.addAll=function addAll(){for(var e in this.data_layers)this.addLayer(e)}
e.getTag=function getTag(e){return this.tags[e]}
e.getTagTime=function getTagTime(e){var t=this.tag_timer[e]
return t&&this.tag_tolerance-(s.frame_timestamp-t)}
e.setTag=function setTag(e,t,r){if(r){this.tags[e]=t
delete this.tag_timer[e]
return}if(this.tag_timer[e]){if(this.tags[e]===t)delete this.tag_timer[e]
return}if(this.tags[e]!==t)this.tag_timer[e]=s.frame_timestamp}
e.getIntensity=function getIntensity(){return this.intensity}
e.setIntensity=function setIntensity(e){this.intensity=e}
e.getLayer=function getLayer(e){var t=this.layers[e]
var r=t
var a=0
for(var i in t.tags){if(!this.tags[i])continue
var o=t.tags[i]
if(o.priority>a)a=(r=o).priority}return r}
e.forceNoTracks=function forceNoTracks(e){this.force_no_tracks=e}
e.setFadeInTime=function setFadeInTime(e){this.fade_in_start=s.frame_timestamp
this.fade_in_time=s.frame_timestamp+e}
e.tick=function tick(){var A=this
var w=s.frame_timestamp
var L=this.intensity,O=this.layer_state,R=this.layer_keys
for(var e in this.tag_timer){var t=this.tag_timer[e]
if(w>t+this.tag_tolerance){this.tags[e]=!this.tags[e]
delete this.tag_timer[e]}}var b=""
var N
function filterValidFiles(e){return!N[e.file]&&(!e.excl_group||e.excl_group[b])}function filterValidFilesMaster(e){return!N[e.file]&&(!e.excl_group||!b||e.excl_group[b])}if(this.fade_in_time&&w>this.fade_in_time){this.fade_in_time=0
this.fade_in_start=0}var C
if(this.streaming){C=false
for(var r=0;r<R.length;++r){var a=O[R[r]]
for(var i=0;i<a.active.length;++i)if(!D(a.active[i].sound))C=true}}var o=function _loop(e){var _=R[e]
var t=A.getLayer(_)
var r=t.files,a=t.files_map,i=t.add_delay,o=t.sync_with,n=t.excl_group_master
var c=O[_]
if(w>c.change){c.change=w+t.period+H()*t.period_noise
c.rel_intensity=H()}var u=0
if(!A.force_no_tracks){if(L>t.min_intensity&&L<t.max_intensity&&t.odds_total){var s=c.rel_intensity*t.odds_total
u=0
do{if((s-=t.odds[u])<0)break
u++}while(u<t.odds.length-1)}u=W(u,r.length)
if(U.volume*U.volume_music===0||!k()){u=0
A.stopAllLayers(A.kill_delay)}}N={}
for(var l=c.active.length-1;l>=0;--l){var d=c.active[l]
var f=d.file,v=d.sound,h=d.start
if(!v){A.log(_,"remove (not playing) "+f.file)
M(c.active,l)}else if(D(v)){if(!C)d.start=h=w
if(w-h>z){A.addStreamedSoundCB(v,function(e){return e.fade(0,1)})
A.log(_,"remove (not loaded on time) "+f.file)
M(c.active,l)}}else if(!v.playing()){if(w-h>z){A.log(_,"remove (not playing) "+f.file)
M(c.active,l)}}else{var p=!a[f.file]?"not in file list":null
if(f.excl_group)if(n){if(!b)b=f.excl_group_first
x(f.excl_group[b])}else if(b&&!f.excl_group[b])p="mismatched excl_group"
if(p){A.log(_,"stop ("+p+") "+f.file)
A.stopSound(c.active,l)}else N[f.file]=true}}if(o){var m=A.layer_state[o]
if(m.last_add===w){for(var E=c.active.length-1;E>=0;--E){var g=c.active[E]
var T=g.sound,y=g.file
if(D(T))A.addStreamedSoundCB(T,function(e){e.fade(0,1)})
else if(!T.playing()){A.log(_,"remove (sync'd changed) "+y.file)
M(c.active,E)}delete N[y.file]}u=W(u,m.active.length)
A.log(_,"sync'd changed, want "+u)}else u=W(u,c.active.length,m.active.length)}while(c.active.length>u){var S=G(H()*c.active.length)
A.log(_,"stop (over wanted count) "+c.active[S].file.file)
A.stopSound(c.active,S)
c.last_add=0}c.add_blocked=false
c.drained=false
var I=function _loop2(){if(c.last_add&&w-c.last_add<i){c.add_blocked=true
return"break"}var e=r.filter(n?filterValidFilesMaster:filterValidFiles)
if(!e.length){c.drained=true
return"break"}var s=e[G(H()*e.length)]
var l={file:s,start:w}
var t=void 0
if(A.streaming)t=B(s.file,V,true,function(e){if(e){var t=e.name
l.sound=e
A.log(_,"start "+s.file)
if(A.fade_in_time){var r=(w-A.fade_in_start)/(A.fade_in_time-A.fade_in_start)
var a=F(Y,V*r)
e.volume(a)
var i=V
e.fade(i,A.fade_in_time-w)}var o=A.streaming_cbs[t]
if(o){for(var n=0;n<o.length;++n)o[n](e)
delete A.streaming_cbs[t]}}})
else t=P(s.file,V,true)
if(!t){A.log(_,"start "+(A.streaming?"streaming ":"")+"failed "+s.file);--u}else{if(A.streaming)delete A.streaming_cbs[t.name]
A.log(_,"start "+(A.streaming?"streaming ":"")+s.file)
l.sound=t
c.last_add=w
c.active.push(l)
N[s.file]=true
if(n&&s.excl_group){x(!b||s.excl_group[b])
b=s.excl_group_first}}}
while(c.active.length<u)if("break"===I())break}
for(var n=0;n<R.length;++n)o(n)}
e.callSoundCBWhenPossible=function callSoundCBWhenPossible(e,t){if(D(e))this.addStreamedSoundCB(e,t)
else t(e)}
e.addStreamedSoundCB=function addStreamedSoundCB(e,t){var r=e.name
if(!this.streaming_cbs[r])this.streaming_cbs[r]=[]
this.streaming_cbs[r].push(t)}
e.stopSound=function stopSound(e,t,r){var a=e[t]
M(e,t)
if(D(a.sound))this.addStreamedSoundCB(a.sound,function(e){e.fade(0,1)})
else a.sound.fade(0,r||a.file.fade_time)}
e.stopAllLayers=function stopAllLayers(e){var t=this.layer_state,r=this.layer_keys
for(var a=0;a<r.length;++a){var i=t[r[a]]
for(var o=i.active.length-1;o>=0;--o){var n=i.active[o].sound
if(D(n)){this.addStreamedSoundCB(n,function(e){e.fade(0,1)})
i.last_add=0}else if(!n.playing())M(i.active,o)
else{this.stopSound(i.active,o,e)
i.last_add=0}}}}
e.debugSolo=function debugSolo(a){var i=this
var e=this.layer_state,t=this.layer_keys
for(var r=0;r<t.length;++r){var o=e[t[r]]
var n=function _loop3(e){var t=o.active[e]
var r=t.sound
i.callSoundCBWhenPossible(r,function(e){if(e.playing())if(t===a||!a)e.volume(1)
else e.volume(0)})}
for(var s=o.active.length-1;s>=0;--s)n(s)}}
e.debug=function debug(){var e=this.layer_state
var t=[]
for(var r in e){var a=e[r]
var i=this.getLayer(r)
var o=a.active,n=a.rel_intensity
if(o.length||this.intensity>i.min_intensity&&this.intensity<i.max_intensity)t.push({text:"Layer "+r+(1===i.odds_total?"":" ("+n.toFixed(2)+")")+(a.add_blocked?" (waiting)":"")+(a.drained?" (no options)":"")+":"})
for(var s=0;s<o.length;++s){var l=o[s]
var _=l.file.file.substring(l.file.file.lastIndexOf("/")+1)
var c="  "
if(l.file.tag_id)c+="["+l.file.tag_id+"]"
c+=" "+_+"\t   "+(l.file.excl_group?l.file.excl_group_debug:"*")+" "
if(D(l.sound))c+="  (Sound being streamed...)"
else{var u,d
c+="  ("+(null==(u=l.sound)?void 0:u.location().toFixed(1))+"/"+(null==(d=l.sound)?void 0:d.duration().toFixed(1))+")"}t.push({hover:l,text:c})}}return t}
e.log=function log(e,t){if(this.enable_logs)console.log((s.frame_timestamp/1e3).toFixed(2)+" ["+e+"]: "+t)}
return GlovSoundScape}()
r.GlovSoundScape=y},{"../common/util":400,"./engine.js":305,"./settings":351,"./sound":358,"./soundscape_types":360,assert:void 0}],360:[function(e,t,r){"use strict"
r.dataLayerHasMax=dataLayerHasMax
function dataLayerHasMax(e){return Boolean(e.max)}},{}],361:[function(e,t,r){"use strict"
r.spotPadMode=spotPadMode
r.spotSetPadMode=spotSetPadMode
r.spotlog=spotlog
r.spotGet=spotGet
r.spotKey=spotKey
r.spotUnfocus=spotUnfocus
r.spotSetNavtype=spotSetNavtype
r.spotSuppressKBNav=spotSuppressKBNav
r.spotTopOfFrame=spotTopOfFrame
r.spotSuppressPad=spotSuppressPad
r.spotPadSuppressed=spotPadSuppressed
r.spotEndOfFrame=spotEndOfFrame
r.spotSubPush=spotSubPush
r.spotSubPop=spotSubPop
r.spotSubBegin=spotSubBegin
r.spotSubEnd=spotSubEnd
r.spotMouseoverHook=spotMouseoverHook
r.spotGetCurrentFocusKey=spotGetCurrentFocusKey
r.spotFocusSteal=spotFocusSteal
r.spotFocusCheck=spotFocusCheck
r.spotEndInput=spotEndInput
r.spotAsyncActivateButton=spotAsyncActivateButton
r.spot=spot
r.SPOT_DEFAULT_LABEL=r.SPOT_DEFAULT_BUTTON_DRAW_ONLY=r.SPOT_DEFAULT_BUTTON_DISABLED=r.SPOT_DEFAULT_BUTTON=r.SPOT_DEFAULT=r.SPOT_STATE_DISABLED=r.SPOT_STATE_FOCUSED=r.SPOT_STATE_DOWN=r.SPOT_STATE_REGULAR=r.SPOT_NAV_PREV=r.SPOT_NAV_NEXT=r.SPOT_NAV_DOWN=r.SPOT_NAV_RIGHT=r.SPOT_NAV_UP=r.SPOT_NAV_LEFT=r.SPOT_NAV_NONE=r.SPOT_NAVTYPE_EXTENDED=r.SPOT_NAVTYPE_SIMPLE=void 0
var a,i,o
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}var n=e("./input_constants").BUTTON_ANY
var s=0
r.SPOT_NAVTYPE_SIMPLE=s
var l=1
r.SPOT_NAVTYPE_EXTENDED=l
var R=0
r.SPOT_NAV_NONE=R
var N=1
r.SPOT_NAV_LEFT=N
var C=2
r.SPOT_NAV_UP=C
var x=3
r.SPOT_NAV_RIGHT=x
var M=4
r.SPOT_NAV_DOWN=M
var I=5
r.SPOT_NAV_NEXT=I
var A=6
r.SPOT_NAV_PREV=A
var w=7
var b=1
r.SPOT_STATE_REGULAR=b
var D=2
r.SPOT_STATE_DOWN=D
var P=3
r.SPOT_STATE_FOCUSED=P
var B=4
r.SPOT_STATE_DISABLED=B
var k={key:void 0,disabled:false,in_event_cb:null,drag_target:false,drag_over:false,button:n,is_button:false,button_long_press:false,pad_focusable:true,spatial_focus:true,auto_focus:false,long_press_focuses:true,sound_button:"button_click",sound_rollover:"rollover",touch_focuses:false,disabled_focusable:true,hotkey:null,hotkeys:null,hotpad:null,focus_steal:false,sticky_focus:false,custom_nav:null}
var _=_extends({},r.SPOT_DEFAULT=k,{is_button:true})
r.SPOT_DEFAULT_BUTTON=_
var c=_extends({},k,{disabled:true,sound_rollover:null})
r.SPOT_DEFAULT_BUTTON_DISABLED=c
var u=_extends({},k,{pad_focusable:false})
r.SPOT_DEFAULT_BUTTON_DRAW_ONLY=u
var d=_extends({},k,{sound_rollover:null,touch_focuses:true})
r.SPOT_DEFAULT_LABEL=d
var U=e("assert")
var G=Math.abs,F=Math.max
var f=e("../common/verify")
var v=e("./camera2d.js")
var h=e("./engine.js")
var p=e("./font.js").fontStyle
var m=e("./input.js")
var W=m.KEYS
var H=m.PAD
var z=m.dragDrop
var V=m.dragOver
var Y=m.inputClick
var E=m.inputEatenMouse
var j=m.inputTouchMode
var g=m.keyDown
var K=m.keyDownEdge
var q=m.longPress
var X=m.mouseButtonHadEdge
var T=m.mouseDomPos
var Q=m.mouseDownAnywhere
var y=m.mouseDownEdge
var $=m.mouseDownMidClick
var J=m.mouseMoved
var ee=m.mouseOver
var te=m.mousePosIsTouch
var re=m.padButtonDownEdge
var ae=e("./link").link
var S=e("./settings.js")
var L=e("./ui.js")
var O=e("./ui.js")
var ie=O.drawLine
var oe=O.drawRect
var ne=O.drawTooltipBox
var se=O.playUISound
var le=L.internal.checkHooks
var _e=null
var ce=null
var ue=[]
var de=null
var fe=false
var ve=null
var he={x:0,y:0,w:0,h:0}
var pe=[]
var me=[]
var Ee=[]
var ge=[]
var Te={}
var ye={}
var Se=false
var Ie=false
var Ae=null
function isSubRect(e){return e.is_sub_rect}function spotPadMode(){return Se}function spotSetPadMode(e){Se=e}function spotlog(){}function spotGet(e,t){var r=t?pe:me
var a=null
for(var i=0;i<r.length;++i){if(e===r[i].key)return r[i]
if(e===r[i].key_computed)a=r[i]}return a}function spotKey(e){if(e.key_computed)if(!h.defines.SPOT_DEBUG)return e.key_computed
profilerStart("spotKey")
var t=e.key||(_e?_e.key_computed:"")+"_"+e.x+"_"+e.y
if(e.key_computed)U.equal(e.key_computed,t)
else e.key_computed=t
profilerStop("spotKey")
return e.key_computed}function spotFocusSet(e,t,r,a){if(t&&(!J()||te()))return false
var i=e.def||k
var o=void 0===e.sound_rollover?i.sound_rollover:e.sound_rollover
var n=e.key_computed||spotKey(e)
var s=fe&&!r&&t&&n!==de
var l=s?ve:de
if((o||!t)&&l!==n)se(o||k.sound_rollover)
if(l!==n||Se!==!t)spotlog("spotFocusSet",n,a,t?"":"pad_mode",s?"nonsticky":"")
Se=!t
if(s)ve=n
else{de=n
var _=void 0===e.sticky_focus?i.sticky_focus:e.sticky_focus
fe=_
ve=null}U(e.dom_pos)
return true}function spotUnfocus(){spotlog("spotUnfocus")
ve=de=null
Se=fe=false}var we=((a={})[N]={pads:[H.LEFT]},a[C]={pads:[H.UP]},a[x]={pads:[H.RIGHT]},a[M]={pads:[H.DOWN]},a[A]={shift_keys:[W.TAB],pads:[H.LEFT_BUMPER]},a[I]={pads:[H.RIGHT_BUMPER],unshift_keys:[W.TAB]},a)
var Le=((i={})[N]={keys:[W.LEFT],pads:we[N].pads},i[C]={keys:[W.UP],pads:we[C].pads},i[x]={keys:[W.RIGHT],pads:we[x].pads},i[M]={keys:[W.DOWN],pads:we[M].pads},i[A]=we[A],i[I]=we[I],i)
var Oe=((o={})[N]={keys:Le[N].keys.concat([W.A,W.NUMPAD4]),pads:Le[N].pads},o[C]={keys:Le[C].keys.concat([W.W,W.NUMPAD8]),pads:Le[C].pads},o[x]={keys:Le[x].keys.concat([W.D,W.NUMPAD6]),pads:Le[x].pads},o[M]={keys:Le[M].keys.concat([W.S,W.NUMPAD5,W.NUMPAD2]),pads:Le[M].pads},o[A]=we[A],o[I]=we[I],o)
function keyDownShifted(e){return g(W.SHIFT)&&K(e)}function keyDownUnshifted(e){return!g(W.SHIFT)&&K(e)}function compileSpotNavKeysEntry(e){var t=[]
if(e.keys)for(var r=0;r<e.keys.length;++r)t.push(K.bind(null,e.keys[r]))
if(e.pads)for(var a=0;a<e.pads.length;++a)t.push(re.bind(null,e.pads[a]))
if(e.shift_keys)for(var i=0;i<e.shift_keys.length;++i)t.push(keyDownShifted.bind(null,e.shift_keys[i]))
if(e.unshift_keys)for(var o=0;o<e.unshift_keys.length;++o)t.push(keyDownUnshifted.bind(null,e.unshift_keys[o]))
return function(){for(var e=0;e<t.length;++e)if(t[e]())return true
return false}}function compileSpotNavKeys(e){var t
return(t={})[N]=compileSpotNavKeysEntry(e[N]),t[C]=compileSpotNavKeysEntry(e[C]),t[x]=compileSpotNavKeysEntry(e[x]),t[M]=compileSpotNavKeysEntry(e[M]),t[A]=compileSpotNavKeysEntry(e[A]),t[I]=compileSpotNavKeysEntry(e[I]),t}var Re=compileSpotNavKeys(we)
var be=compileSpotNavKeys(Le)
var Ne=compileSpotNavKeys(Oe)
var Ce
var xe
function spotSetNavtype(e){xe=(Ce=e)===s?be:Ne}spotSetNavtype(l)
function resetNavKeys(){xe=Ce===s?be:Ne}var Me=false
function spotSuppressKBNav(e,t){Me=true
U(e)
var r=Ce===s?be:Ne
if(t){var a
xe=((a={})[N]=Re[N],a[C]=Re[C],a[x]=Re[x],a[M]=Re[M],a[A]=r[A],a[I]=r[I],a)}else{var i
xe=((i={})[N]=Re[N],i[C]=be[C],i[x]=Re[x],i[M]=be[M],i[A]=r[A],i[I]=r[I],i)}}var De=0
var Pe=1
var Be=2
function findBestTargetInternal(e,t,r,a,i){var o=t.w/2
var n=t.h/2
var s=t.x+o
var l=t.y+n
var _=t.x
var c=t.x+t.w
var u=t.y
var d=t.y+t.h
var f=null
var v
for(var h=0;h<r.length;++h){var p=r[h]
if(!i(p))continue
var m=p.dom_pos
var E=void 0
if(a===De){var g=void 0
var T=m.x+m.w
var y=m.y+m.h
var S=_-T
var I=m.x-c
var A=u-y
var w=m.y-d
if(S>=-o&&y>u-S&&m.y<d+S){g=N
E=S+F(m.y-l,l-y,0)}else if(I>=-o&&y>u-I&&m.y<d+I){g=x
E=I+F(m.y-l,l-y,0)}else if(A>=-n&&T>=_-A&&m.x<=c+A){g=C
E=A+F(m.x-s,s-T,0)}else if(w>=-n&&T>=_-w&&m.x<=c+w){g=M
E=w+F(m.x-s,s-T,0)}if(void 0===g){var L=m.x+m.w/2-s
var O=m.y+m.h/2-l
E=G(L)+G(O)
if(G(L)>G(O))if(L>0)g=x
else g=N
else if(O>0)g=M
else g=C}if(g!==e)continue}else{var R=m.x+m.w/2-s
var b=m.y+m.h/2-l
E=G(R)+G(b)
if(a===Pe)if(R<=0&&e===x||R>=0&&e===N||b<=0&&e===M||b>=0&&e===C)continue}if(!f||E<v){f=p
v=E}}return f}var ke=1e-5
var Ue
function spotDebugList(e,t){if(!Ue)Ue=p(null,{color:255,outline_color:4294967244,outline_width:2})
for(var r=0;r<t.length;++r){var a=t[r]
var i=a.dom_pos
var o=void 0
if(isSubRect(a)){if(e)L.font.drawSizedAligned(Ue,i.x,i.y,Z.DEBUG,8,L.font.ALIGN.HVCENTERFIT,i.w,i.h,a.key_computed||"unknown")
continue}if(a.spot_debug_ignore)continue
if(a.only_mouseover)o=[1,.5,0,.5]
else{var n=a.def||k
if(!(void 0===a.pad_focusable?n.pad_focusable:a.pad_focusable))continue
if(!(void 0===a.spatial_focus?n.spatial_focus:a.spatial_focus))continue
for(var s=0;s<t.length;++s){if(r===s)continue
var l=t[s]
if(isSubRect(l))continue
if(l.sub_rect!==a.sub_rect)continue
var _=l.def||k
var c=void 0===l.pad_focusable?_.pad_focusable:l.pad_focusable
if(l.only_mouseover||!c)continue
if(!(void 0===l.spatial_focus?_.spatial_focus:l.spatial_focus))continue
var u=l.dom_pos
if(i.x<u.x+u.w-ke&&i.x+i.w>u.x+ke&&i.y<u.y+u.h-ke&&i.y+i.h>u.y+ke)o=[1,0,0,.5]}}if(!e&&!o)continue
oe(i.x,i.y,i.x+i.w,i.y+i.h,Z.DEBUG,o||[1,1,0,.5])
L.font.drawSizedAligned(Ue,i.x,i.y,Z.DEBUG,8,L.font.ALIGN.HVCENTERFIT,i.w,i.h,a.key_computed||"unknown")}}function spotDebug(){v.push()
v.setDOMMapped()
var e=g(W.SHIFT)
spotDebugList(e,me)
if(Se||e)for(var t=N;t<=M;++t){var r=Ee[t]
if(r){var a=he
var i=r.dom_pos
var o=ge[t]
if(o){a=o.dom_pos
ie(a.x+a.w/2,a.y+a.h/2,i.x+i.w/2,i.y+i.h/2,Z.DEBUG,1,.95,[1,.5,0,1])
a=he
i=o.dom_pos}ie(a.x+a.w/2,a.y+a.h/2,i.x+i.w/2,i.y+i.h/2,Z.DEBUG,1,.95,[1,1,0,1])}}v.pop()}var Ge
var Fe
function filterMatchesSubrect(e){return e!==Fe&&e.sub_rect===Ge}function overlaps(e,t){return e.x+e.w>t.x&&e.x<t.x+t.w&&e.y+e.h>t.y&&e.y<t.y+t.h}function contains(e,t){return t.x>=e.x&&t.x+t.w<=e.x+e.w&&t.y>=e.y&&t.y+t.h<=e.y+e.h}function filterInSubrectView(e){if(e.sub_rect!==Ge)return false
return overlaps(e.dom_pos,Ge.dom_pos)}function filterMatchesSubrectOrInVisibleChild(e){if(e===Fe)return false
if(e.sub_rect===Ge)return true
if(e.sub_rect&&e.sub_rect.sub_rect===Ge)return overlaps(e.dom_pos,e.sub_rect.dom_pos)
return false}var We=[filterInSubrectView,filterMatchesSubrect]
function findBestWithinSubrect(e,t,r,a,i){Ge=a
for(var o=0;o<We.length;++o){var n=We[o]
for(var s=0;s<=i;++s){var l=findBestTargetInternal(e,t,r,s,n)
if(l){U(!isSubRect(l))
return l}}}return null}function findBestTargetFromSubRect(e,t,r,a,i){Ge=e
var o=findBestTargetInternal(t,r,a,i,filterMatchesSubrectOrInVisibleChild)
if(o)if(isSubRect(o))if(!(o=findBestWithinSubrect(t,r,a,ge[t]=o,i)))ge[t]=void 0
return o}function spotCalcNavTargets(){for(var e=1;e<w;++e){Ee[e]=void 0
ge[e]=void 0}var t
var r=[]
var a
var i
for(var o=0;o<me.length;++o){var n=me[o]
if(isSubRect(n)){if(!n.is_empty_sub_rect)r.push(n)}else if(n.key_computed===de){if(!Ee[A]&&a)Ee[A]=a
t=n}else{var s=n.def||k
if(void 0===n.pad_focusable?s.pad_focusable:n.pad_focusable){if(!i)i=n
a=n
if(!Ee[I]&&t)Ee[I]=n
if(void 0===n.spatial_focus?s.spatial_focus:n.spatial_focus)r.push(n)}}}if(!Ee[A]&&a)Ee[A]=a
if(!Ee[I])Ee[I]=i
var l
var _
if(t){_=t.sub_rect
he.x=t.dom_pos.x
he.y=t.dom_pos.y
he.w=t.dom_pos.w
he.h=t.dom_pos.h
l=Pe}else{_=null
for(var c=0;c<me.length;++c){var u=me[c]
if(isSubRect(u))if(contains(u.dom_pos,he))_=u}if(_)l=Pe
else l=Be}for(var d=1;d<=M;++d)for(var f=0;f<=l;++f){Fe=null
var v=findBestTargetFromSubRect(_,d,he,r,f)
if(v){Ee[d]=v
break}if(_)if(v=findBestTargetFromSubRect((Fe=_).sub_rect,d,he,r,f)){Ee[d]=v
break}}if(t){var h=t.def||k
var p=void 0===t.custom_nav?h.custom_nav:t.custom_nav
if(p){var m
for(var E in p){var g=Number(E)
var T=p[g]
if(null===T||void 0===T)Ee[g]=T
else{if(!m){m={}
for(var y=0;y<me.length;++y){var S=me[y]
if(!isSubRect(S))m[S.key_computed]=S}}if(m[T])Ee[g]=m[T]}}}}}function spotTopOfFrame(){if(J()){var e=T()
he.x=e[0]
he.y=e[1]
he.w=0
he.h=0}if(y({peek:true}))Se=false
ue.length=0
_e=null}function spotSuppressPad(){Ie=true
if(Se&&de&&!fe){spotUnfocus()
Se=true}}function spotPadSuppressed(){return Ie}function spotEndOfFrame(){spotCalcNavTargets()
ye=Te
Ie=false
pe=me
me=[]
Te={}
Ae=null
if(!Me)resetNavKeys()
Me=false}function frameSpotsPush(e){U(e.dom_pos)
f(isFinite(e.dom_pos.x))
f(isFinite(e.dom_pos.y))
f(isFinite(e.dom_pos.w))
f(isFinite(e.dom_pos.h))
e.sub_rect=_e
me.push(e)
if(_e)_e.is_empty_sub_rect=false}function spotEntirelyObscured(e){var t=e.dom_pos
for(var r=0;r<me.length;++r){var a=me[r]
if(isSubRect(a))continue
if(a.sub_rect!==_e)continue
var i=a.dom_pos
if(i.x<=t.x&&i.x+i.w>=t.x+t.w&&i.y<=t.y&&i.y+i.h>=t.y+t.h)return true}return false}function spotSubPush(){ue.push([_e,ce])
_e=null}function spotSubPop(){var e=f(ue.pop())
_e=e[0]
ce=e[1]}function spotSubBegin(e){U(e.key)
if(_e)U(!_e,"Recursive spot, parent:"+_e.key+", self:"+e.key+", same="+(e===_e))
spotKey(e)
var t=e
t.is_sub_rect=true
if(!t.dom_pos)t.dom_pos={}
v.virtualToDomPosParam(t.dom_pos,t)
if(!spotEntirelyObscured(t))frameSpotsPush(t);(_e=t).is_empty_sub_rect=true
ce=null}function spotSubEnd(){U(_e)
_e=null
return ce}function spotMouseoverHook(e,t){if(E()||t.peek)return
if(t.key_computed)return
var r=e
if(!r.dom_pos)r.dom_pos={}
v.virtualToDomPosParam(r.dom_pos,r)
if(!spotEntirelyObscured(r)){var a=r
a.only_mouseover=true
a.pad_focusable=false
if(h.defines.SPOT_DEBUG)a.spot_debug_ignore=t.eat_clicks||t.spot_debug_ignore
frameSpotsPush(a)}}function keyCheck(e){if(Ie)return false
return xe[e]()}function spotFocusCheckNavButtonsFocused(e){for(var t=1;t<w;++t){var r=Ee[t]
if(void 0!==r&&keyCheck(t))if(r)spotFocusSet(r,false,false,"nav_focused")
else e.out.nav=t}}function spotFocusCheckNavButtonsUnfocused(e){for(var t=1;t<w;++t){var r=Ee[t]
if(r&&r.key_computed===e.key_computed&&keyCheck(t))spotFocusSet(r,false,false,"nav_unfocused")}}function spotFocusSetSilent(e){var t=spotKey(e)
var r=e.def||k
de=t
var a=void 0===e.sticky_focus?r.sticky_focus:e.sticky_focus
fe=a
ve=null}function spotGetCurrentFocusKey(){return[de,fe,ve].join(";")}function spotFocusSteal(e){spotlog("spotFocusSteal",spotKey(e),false)
Se=true
spotFocusSetSilent(e)}function spotParamAddOut(e){if(!e.out)e.out={}}function spotParamAddPosCache(e){U(e.key_computed)
if(!e.dom_pos)e.dom_pos={}}function spotParamIsSpotInternal(e){}function spotFocusCheck(e){spotParamAddOut(e)
var t=e.out
t.focused=false
t.kb_focused=false
t.allow_focus=false
var r=spotKey(e)
var a=e.def||k
if(void 0===e.disabled?a.disabled:e.disabled)if(!(void 0===e.disabled_focusable?a.disabled_focusable:e.disabled_focusable))return t
if(void 0===e.focus_steal?a.focus_steal:e.focus_steal)spotFocusSetSilent(e)
if(de===r)spotFocusCheckNavButtonsFocused(e)
else spotFocusCheckNavButtonsUnfocused(e)
var i=de===r||ve===r
if(E()){if(de===r){spotUnfocus()
i=false}if(ve===r){ve=null
i=false}}else{t.allow_focus=true
spotParamAddPosCache(e)
v.virtualToDomPosParam(e.dom_pos,e)
var o=void 0===e.auto_focus?a.auto_focus:e.auto_focus
if(!spotEntirelyObscured(e)||i&&fe){frameSpotsPush(e)
if(o)if(!i&&!ye[r]&&Se){spotlog("auto_focus",r)
spotFocusSetSilent(e)
i=true}}if(o)Te[r]=e
if(_e&&de===r)ce=e}t.kb_focused=de===r
t.focused=i
return t}function spotEndInput(){if(h.defines.SPOT_DEBUG)spotDebug()}function spotAsyncActivateButton(e){Ae=e}var He={key:"",timestamp:0}
function spotSignalRet(e){var t=e.out
var r=e.key_computed
U(r)
t.double_click=r===He.key&&h.frame_timestamp-He.timestamp<S.double_click_time
He.key=r
He.timestamp=h.frame_timestamp
t.ret++}function spot(e){profilerStart("spot")
var t=e.def||k
var r=void 0===e.disabled?t.disabled:e.disabled
var a=void 0===e.is_button?t.is_button:e.is_button
var i=void 0===e.button_long_press?t.button_long_press:e.button_long_press
var o=void 0===e.in_event_cb?t.in_event_cb:e.in_event_cb
var n=void 0===e.drag_target?t.drag_target:e.drag_target
var s=void 0===e.drag_over?t.drag_over:e.drag_over
var l=void 0===e.touch_focuses?t.touch_focuses:e.touch_focuses
var _=void 0===e.focus_steal?t.focus_steal:e.focus_steal
var c=void 0===e.custom_nav?t.custom_nav:e.custom_nav
spotParamAddOut(e)
var u=e.out
u.focused=false
u.ret=0
if(i)u.long_press=false
if(n)u.drag_drop=null
if(c)u.nav=R
var d=b
var f=spotFocusCheck(e),v=f.focused,h=f.allow_focus,p=f.kb_focused
spotParamIsSpotInternal(e)
if(r)d=B
else{var m
var E
if(n&&(u.drag_drop=z(e))){spotFocusSet(e,true,true,"drag_drop")
spotSignalRet(e)
v=true}else if(i&&(E=q(e))||a&&(m=Y(e))){if(E){u.long_press=E.long_press
u.button=E.button
u.pos=void 0}else{U(m)
u.button=m.button
u.pos=m.pos}if(te())if(l)if(!v){spotFocusSet(e,false,false,"touch_focus")
v=true}else{spotSignalRet(e)
spotUnfocus()
v=false}else{spotSignalRet(e)
spotUnfocus()
v=false}else{spotSignalRet(e)
spotFocusSet(e,true,true,"click")
v=true}}else if(!a&&l&&te()&&Y(e)){spotFocusSet(e,false,false,"touch_focus")
v=true}else if(n&&V(e)){spotFocusSet(e,true,false,"drag_over")
v=true
if(Q())d=D}else if(s&&V(e));}if(h&&j())if((void 0===e.long_press_focuses?t.long_press_focuses:e.long_press_focuses)&&q(e)){spotFocusSet(e,false,false,"long_press")
v=true}var g=ee(e)
if(v&&!_&&!g)if(X()){v=false
spotUnfocus()}else if(J()){v=false
if(de===e.key_computed)spotUnfocus()
else if(ve===e.key_computed)ve=null}if(g)if(h)if(spotFocusSet(e,true,false,"mouseover"))v=true
if(a&&g&&$(e))if(!r)d=D
var T=false
if(v){if(d===b)d=P
if(a&&!r&&p&&!Ie){var y=o?{in_event_cb:o}:null
if(K(W.SPACE,y)||K(W.RETURN,y)||re(H.A))T=true}}if(!r){var S=void 0===e.hotkey?t.hotkey:e.hotkey
var I=void 0===e.hotkeys?t.hotkeys:e.hotkeys
var A=void 0===e.hotpad?t.hotpad:e.hotpad
if(S||I){var w=o?{in_event_cb:o}:null
if(S&&K(S,w))T=true
if(I)for(var L=0;L<I.length;++L)if(K(I[L],w))T=true}if(A)if(re(A))T=true
if(Ae===e.key_computed)T=true}if(e.url){if(void 0===e.internal)e.internal=true
if(ae(e))T=true}if(T){spotSignalRet(e)
u.button=0
u.pos=null}u.focused=v
if(u.ret){d=D
var O=void 0===e.sound_button?t.sound_button:e.sound_button
if(O)se(O)}if(u.focused&&e.tooltip)ne(e)
le(e,Boolean(u.ret))
u.spot_state=d
profilerStop("spot")
return u}},{"../common/verify":401,"./camera2d.js":295,"./engine.js":305,"./font.js":315,"./input.js":326,"./input_constants":327,"./link":328,"./settings.js":351,"./ui.js":367,assert:void 0}],362:[function(e,t,r){"use strict"
r.spriteAnimationCreate=spriteAnimationCreate
var a=e("assert")
var i=Math.floor,o=Math.random
var n=function(){function SpriteAnimationImpl(e){this.frame=0
this.time=0
this.frame_time=0
this.state=null
this.anim=null
this.anim_idx=0
this.data=void 0
if(e instanceof SpriteAnimationImpl){this.data=e.data
if(e.state)this.setState(e.state)}else{this.data=e
for(var t in this.data){var r=this.data[t]
if(!Array.isArray(r.frames))r.frames=[r.frames]
if("number"===typeof r.times){var a=new Array(r.frames.length)
for(var i=0;i<r.frames.length;++i)a[i]=r.times
r.times=a}if(r.times_random)if("number"===typeof r.times_random){var o=new Array(r.frames.length)
for(var n=0;n<r.frames.length;++n)o[n]=r.times_random
r.times_random=o}for(var s=r.total_time=0;s<r.times.length;++s)r.total_time+=r.times[s]
r.random_init_frame=r.random_init_frame||false
if(void 0===r.loop)r.loop=true}}}var e=SpriteAnimationImpl.prototype
e.clone=function clone(){return new SpriteAnimationImpl(this)}
e.setFrameIndex=function setFrameIndex(e){this.anim_idx=e
a(this.anim)
this.frame=this.anim.frames[e]
this.frame_time=this.anim.times[e]
if(this.anim.times_random)this.frame_time+=i(o()*this.anim.times_random[e])}
e.setState=function setState(e,t){if(e===this.state&&!t)return this
if(!this.data[e]){console.error("Tried to set anim state "+e+" which does not exist")
return this}this.state=e
this.anim=this.data[e]
if(this.anim.init_time)this.time=i(o()*this.anim.init_time)
else this.time=0
var r=0
if(this.anim.random_init_frame)r=i(o()*this.anim.frames.length)
this.setFrameIndex(r)
return this}
e.progress=function progress(){if(!this.anim)return 1
var e=this.time
for(var t=0;t<this.anim_idx;++t)e+=this.anim.times[t]
return e/this.anim.total_time}
e.update=function update(e){if(!this.anim)return
this.time+=e
if(this.time>this.frame_time){this.time-=this.frame_time
this.anim_idx++
if(this.anim_idx===this.anim.frames.length)if(this.anim.loop)this.anim_idx%=this.anim.frames.length
else if(this.anim.transition_to)this.setState(this.anim.transition_to)
else{this.anim=null
return}this.setFrameIndex(this.anim_idx)
if(this.time>=this.frame_time)this.time=this.frame_time-1}}
e.getFrame=function getFrame(e){if(void 0!==e)this.update(e)
return this.frame}
return SpriteAnimationImpl}()
function spriteAnimationCreate(e){return new n(e)}r.createSpriteAnimation=spriteAnimationCreate
r.create=spriteAnimationCreate},{assert:void 0}],363:[function(e,t,r){"use strict"
r.spriteQueuePush=spriteQueuePush
r.spriteQueuePop=spriteQueuePop
r.spriteChainedStart=spriteChainedStart
r.spriteChainedStop=spriteChainedStop
r.spriteDataAlloc=spriteDataAlloc
r.spriteQueueFn=spriteQueueFn
r.spriteQueueRaw4Color=spriteQueueRaw4Color
r.spriteQueueRaw4=spriteQueueRaw4
r.queueSpriteData=queueSpriteData
r.spriteQueueRaw4ColorBuffer=spriteQueueRaw4ColorBuffer
r.spriteQueueRaw=spriteQueueRaw
r.spriteQueueSprite=spriteQueueSprite
r.clipCoordsScissor=clipCoordsScissor
r.scissorPush=scissorPush
r.scissorPushIntersection=scissorPushIntersection
r.scissorPop=scissorPop
r.spriteClip=spriteClip
r.spriteResetTopOfFrame=spriteResetTopOfFrame
r.spriteClipped=spriteClipped
r.spriteClippedViewport=spriteClippedViewport
r.spriteClipPush=spriteClipPush
r.spriteClipPop=spriteClipPop
r.spriteClipPause=spriteClipPause
r.spriteClipResume=spriteClipResume
r.blendModeSet=blendModeSet
r.blendModeReset=blendModeReset
r.spriteDrawReset=spriteDrawReset
r.spriteDraw=spriteDraw
r.spriteDrawPartial=spriteDrawPartial
r.buildRects=buildRects
r.spriteFlippedUVsApplyHFlip=spriteFlippedUVsApplyHFlip
r.spriteFlippedUVsRestore=spriteFlippedUVsRestore
r.spriteCreate=spriteCreate
r.spriteStartup=spriteStartup
r.sprite_fshader=r.sprite_vshader=r.BLEND_PREMULALPHA=r.BLEND_ADDITIVE=r.BLEND_ALPHA=r.BlendMode=void 0
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}r.createSprite=spriteCreate
r.create=spriteCreate
r.queueraw4color=spriteQueueRaw4Color
r.queueraw4colorBuffer=spriteQueueRaw4ColorBuffer
r.queueraw4=spriteQueueRaw4
r.queueraw=spriteQueueRaw
r.queuesprite=spriteQueueSprite
var a={BLEND_ALPHA:0,BLEND_ADDITIVE:1,BLEND_PREMULALPHA:2}
r.BlendMode=a
var i=0
r.BLEND_ALPHA=i
var o=1
r.BLEND_ADDITIVE=o
var n=2
r.BLEND_PREMULALPHA=n
var O=e("assert")
var R=e("./camera2d.js")
var s=e("./dyn_geom.js").dynGeomQueueSprite
var l=e("./engine.js")
var _=e("./geom.js")
var b=Math.cos,c=Math.max,u=Math.min,d=Math.round,N=Math.sin
var f=e("./textures.js"),v=f.textureCmpArray,h=f.textureBindArray,p=f.textureLoad,m=f.textureFilterKey
var E=e("./shaders.js"),g=E.SEMANTIC,T=E.shaderCreate,y=E.shadersBind,S=E.shadersPrelink
var I=e("../common/util.js"),A=I.deprecate,w=I.nextHighestPowerOfTwo
var L=e("../common/vmath.js"),C=L.vec2,x=L.vec4,M=L.v2set,D=L.v4set
A(r,"clip","spriteClip")
A(r,"clipped","spriteClipped")
A(r,"clipPush","spriteClipPush")
A(r,"clipPop","spriteClipPop")
A(r,"clipPause","spriteClipPause")
A(r,"clipResume","spriteClipResume")
A(r,"queuefn","spriteQueueFn")
A(r,"draw","spriteDraw")
A(r,"drawPartial","spriteDrawPartial")
var P
r.sprite_vshader=P
var B
r.sprite_fshader=B
var k
var U=x()
var G={clip_space:U}
var F=0
var W
var H=[]
var z=[]
var V=[]
function spriteQueuePush(e){O(V.length<10)
V.push(H)
H=e||[]}function spriteQueuePop(e){O(V.length)
O(e||!H.length)
H=V.pop()}function SpriteData(){this.data=new Float32Array(32)
this.texs=null
this.shader=null
this.shader_params=null
this.x=0
this.y=0
this.z=0
this.blend=0
this.uid=0
this.chained=false
this.next=null}SpriteData.prototype.queue=function(e){++W.sprites
if(!this.chained){this.z=e
this.uid=++F
H.push(this)}}
var Y=false
var j=null
function spriteChainedStart(){Y=true
j=null}function spriteChainedStop(){Y=false
j=null}function spriteDataAlloc(e,t,r,a){var i
if(z.length)i=z.pop()
else i=new SpriteData
i.texs=e
if(Y&&j){i.chained=true
j.next=i}else{i.chained=false
i.shader=t||null
if(r){r.clip_space=G.clip_space
i.shader_params=r}else i.shader_params=null
i.blend=a||0}if(Y)j=i
return i}function cmpSprite(e,t){++W.sprite_sort_cmps
if(e.z!==t.z)return e.z-t.z
if(e.blend===o&&t.blend===o)return 0
if(e.y!==t.y)return e.y-t.y
if(e.x!==t.x)return e.x-t.x
return e.uid-t.uid}function spriteQueueFn(e,t){O(isFinite(e))
H.push({fn:t,x:0,y:0,z:e,uid:++F})}function spriteQueueRaw4Color(e,t,r,a,i,o,n,s,l,_,c,u,d,f,v,h,p,m,E,g,T,y,S,I,A){O(isFinite(y))
var w=spriteDataAlloc(e,S,I,A)
var L=w.data
L[0]=(t-R.data[0])*R.data[4]
L[1]=(r-R.data[1])*R.data[5]
L[2]=a[0]
L[3]=a[1]
L[4]=a[2]
L[5]=a[3]
L[6]=i
L[7]=o
L[8]=(n-R.data[0])*R.data[4]
L[9]=(s-R.data[1])*R.data[5]
L[10]=l[0]
L[11]=l[1]
L[12]=l[2]
L[13]=l[3]
L[14]=_
L[15]=c
L[16]=(u-R.data[0])*R.data[4]
L[17]=(d-R.data[1])*R.data[5]
L[18]=f[0]
L[19]=f[1]
L[20]=f[2]
L[21]=f[3]
L[22]=v
L[23]=h
L[24]=(p-R.data[0])*R.data[4]
L[25]=(m-R.data[1])*R.data[5]
L[26]=E[0]
L[27]=E[1]
L[28]=E[2]
L[29]=E[3]
L[30]=g
L[31]=T
w.x=L[0]
w.y=L[1]
w.queue(y)
return w}function spriteQueueRaw4(e,t,r,a,i,o,n,s,l,_,c,u,d,f,v,h,p,m){return spriteQueueRaw4Color(e,t,r,v,c,u,a,i,v,c,f,o,n,v,d,f,s,l,v,d,u,_,h,p,m)}function queueSpriteData(e,t){O(isFinite(t))
var r=e.data
r[0]=(r[0]-R.data[0])*R.data[4]
r[1]=(r[1]-R.data[1])*R.data[5]
r[8]=(r[8]-R.data[0])*R.data[4]
r[9]=(r[9]-R.data[1])*R.data[5]
r[16]=(r[16]-R.data[0])*R.data[4]
r[17]=(r[17]-R.data[1])*R.data[5]
r[24]=(r[24]-R.data[0])*R.data[4]
r[25]=(r[25]-R.data[1])*R.data[5]
e.x=r[0]
e.y=r[1]
e.queue(t)
return e}function spriteQueueRaw4ColorBuffer(e,t,r,a,i,o){O(isFinite(r))
var n=spriteDataAlloc(e,a,i,o)
var s=n.data
for(var l=0;l<32;++l)s[l]=t[l]
queueSpriteData(n,r)
return n}function spriteQueueRaw(e,t,r,a,i,o,n,s,l,_,c,u,d,f){return spriteQueueRaw4Color(e,t,r,c,n,s,t,r+o,c,n,_,t+i,r+o,c,l,_,t+i,r,c,l,s,a,u,d,f)}var K=x()
function fillUVs(e,t,r,a,i){var o=0
var n=0
if(!a&&!e.nozoom){var s=c((i[2]-i[0])*e.width/t,(i[3]-i[1])*e.height/r)
if(s<1){if(e.filter_mag===gl.LINEAR)o=n=.5
else if(e.filter_mag===gl.NEAREST)if(l.antialias)o=n=s/2
else o=n=.01*s}else if(s>1)o=n=.5+s/2
if(i[0]>i[2])o*=-1
if(i[1]>i[3])n*=-1}K[0]=i[0]+o/e.width
K[1]=i[1]+n/e.height
K[2]=i[2]-o/e.width
K[3]=i[3]-n/e.height}var q={}
function queuesprite4colorObj(){var e=q.rot,t=q.z,r=q.sprite,a=q.color_ul,i=q.color_ll,o=q.color_lr,n=q.color_ur
O(isFinite(t))
var s=spriteDataAlloc(r.texs,q.shader,q.shader_params,q.blend)
var l=(q.x-R.data[0])*R.data[4]
var _=(q.y-R.data[1])*R.data[5]
var c=q.w*R.data[4]
var u=q.h*R.data[5]
if(q.pixel_perfect){l|=0
_|=0
c|=0
u|=0}s.x=l
s.y=_
var d=s.data
if(!e){var f=l-r.origin[0]*c
var v=_-r.origin[1]*u
var h=f+c
var p=v+u
d[0]=f
d[1]=v
d[8]=f
d[9]=p
d[16]=h
d[17]=p
d[24]=h
d[25]=v}else{var m=r.origin[0]*c
var E=r.origin[1]*u
var g=b(e)
var T=N(e)
var y=l-g*m+T*E
var S=_-T*m-g*E
var I=g*u
var A=g*c
var w=T*u
var L=T*c
d[0]=y
d[1]=S
d[8]=y-w
d[9]=S+I
d[16]=y+A-w
d[17]=S+L+I
d[24]=y+A
d[25]=S+L}fillUVs(s.texs[0],c,u,q.nozoom,q.uvs)
d[2]=a[0]
d[3]=a[1]
d[4]=a[2]
d[5]=a[3]
d[6]=K[0]
d[7]=K[1]
d[10]=i[0]
d[11]=i[1]
d[12]=i[2]
d[13]=i[3]
d[14]=K[0]
d[15]=K[3]
d[18]=o[0]
d[19]=o[1]
d[20]=o[2]
d[21]=o[3]
d[22]=K[2]
d[23]=K[3]
d[26]=n[0]
d[27]=n[1]
d[28]=n[2]
d[29]=n[3]
d[30]=K[2]
d[31]=K[1]
s.queue(t)
return s}function spriteQueueSprite(e,t,r,a,i,o,n,s,l,_,c,u,d,f){O(!e.lazy_load)
l=l||e.color
q.sprite=e
q.x=t
q.y=r
q.z=a
q.w=i
q.h=o
q.rot=n
q.uvs=s
q.color_ul=l
q.color_ll=l
q.color_lr=l
q.color_ur=l
q.shader=_
q.shader_params=c
q.nozoom=u
q.pixel_perfect=d
q.blend=f
return queuesprite4colorObj(q)}var X=C()
var Q=C()
function clipCoordsScissor(e,t,r,a){R.virtualToCanvas(X,[e,t])
X[0]=d(X[0])
X[1]=d(X[1])
R.virtualToCanvas(Q,[e+r,t+a])
Q[0]=d(Q[0])-X[0]
Q[1]=d(Q[1])-X[1]
var i=l.render_height||l.height
return[X[0],i-(X[1]+Q[1]),Q[0],Q[1]]}function clipCoordsDom(e,t,r,a){var i=x()
R.virtualToDom(i,[e+r,t+a])
i[2]=i[0]
i[3]=i[1]
R.virtualToDom(i,[e,t])
i[0]=d(i[0])
i[1]=d(i[1])
i[2]=d(i[2])-i[0]
i[3]=d(i[3])-i[1]
return i}var $=null
function scissorSet(e){if(!$)gl.enable(gl.SCISSOR_TEST)
gl.scissor(e[0],e[1],e[2],e[3])
$=e}function scisssorClear(){gl.disable(gl.SCISSOR_TEST)
$=null}var J=[]
function scissorPush(e){J.push($)
if(e)scissorSet(e)
else scisssorClear()}function scissorPushIntersection(e){J.push($)
if(e)if($){var t=c($[0],e[0])
var r=c(t,u($[0]+$[2],e[0]+e[2]))
var a=c($[1],e[1])
scissorSet([t,a,r-t,c(a,u($[1]+$[3],e[1]+e[3]))-a])}else scissorSet(e)}function scissorPop(){var e=J.pop()
if(e)scissorSet(e)
else scisssorClear()}function spriteClip(e,t,r,a,i,o){var n=clipCoordsScissor(r,a,i,o)
spriteQueueFn(e-.01,scissorSet.bind(null,n))
spriteQueueFn(t-.01,scisssorClear)}var ee=[]
function spriteResetTopOfFrame(){ee.length=0
V.length=0}var te
function spriteClipped(e){return ee.length>0&&(e||!te)}var re=C()
var ae=C()
var ie=C()
function spriteClippedViewport(){O(ee.length>0)
var e=ee[ee.length-1]
R.domToVirtual(ae,e.dom_clip)
M(re,e.dom_clip[2],e.dom_clip[3])
R.domDeltaToVirtual(ie,re)
return{x:ae[0],y:ae[1],w:ie[0],h:ie[1]}}function spriteClipPush(e,t,r,a,i){O(ee.length<10)
var o=clipCoordsScissor(t,r,a,i)
var n=clipCoordsDom(t,r,a,i)
R.setInputClipping(n)
spriteQueuePush()
ee.push({z:e,scissor:o,dom_clip:n})}function spriteClipPop(){O(spriteClipped(true))
spriteQueueFn(Z.TOOLTIP-.1,scisssorClear)
var e=ee.pop(),t=e.z,r=e.scissor
var a=H
spriteQueuePop(true)
if(ee.length){var i=ee[ee.length-1].dom_clip
R.setInputClipping(i)}else R.setInputClipping(null)
spriteQueueFn(t,function(){scissorPush(r)
spriteQueuePush()
H=a
spriteDraw()
spriteQueuePop()
scissorPop()})}function spriteClipPause(){O(spriteClipped(true))
O(!te)
te=true
spriteQueuePush(V[0])
R.setInputClipping(null)
ee.push({dom_clip:null})}function spriteClipResume(){O(spriteClipped(true))
O(te)
ee.pop()
te=false
O(spriteClipped(true))
var e=ee[ee.length-1].dom_clip
spriteQueuePop(true)
R.setInputClipping(e)}var oe
var ne
var se
var le=0
var _e=0
var ce=0
var ue
var de
var fe=65532
var ve=[]
function commit(){if(ce===_e)return
ve.push({state:oe,start:_e,end:ce})
_e=ce}function blendModeSet(e){if(ue!==e)if((ue=e)===o)gl.blendFunc(gl.SRC_ALPHA,gl.ONE)
else if(ue===n)gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)
else gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)}function blendModeReset(e){if(ue!==i||e){gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)
ue=i}}function commitAndFlush(){commit()
if(!ve.length)return
O(ce)
ne.update(se,ce)
ne.bind()
for(var e=0;e<ve.length;++e){var t=ve[e]
var r=t.state,a=t.start,i=t.end
if(de!==r.shader||r.shader_params){y(P,r.shader||B,r.shader_params||G)
de=r.shader}if(ue!==r.blend)blendModeSet(r.blend)
h(r.texs);++W.draw_calls_sprite
gl.drawElements(ne.mode,3*(i-a)/2,gl.UNSIGNED_SHORT,3*a)}ve.length=0
_e=ce=0}function drawSetup(){if(l.defines.NOSPRITES)H.length=0
if(!H.length)return
U[0]=2/l.viewport[2]
U[1]=-2/l.viewport[3]
de=ue=-1
if(!ne){ne=_.create([[g.POSITION,gl.FLOAT,2,false],[g.COLOR,gl.FLOAT,4,false],[g.TEXCOORD,gl.FLOAT,2,false]],[],null,_.QUADS)
se=new Float32Array(1024)
le=se.length/8}profilerStart("sort")
H.sort(cmpSprite)
W.sprite_sort_elems+=H.length
profilerStop("sort")
oe=null
O.equal(ce,0)
O.equal(_e,0)
O.equal(ve.length,0)}function growSpriteBuffer(){var e=u(1.25*le+3&-4,fe)
le=e
se=new Float32Array(8*e)}function drawElem(e){var t=0
if(e.fn){commitAndFlush()
oe=null
e.fn()
ue=de=-1
O.equal(ce,0)
O.equal(_e,0)
O.equal(ve.length,0)
U[0]=2/l.viewport[2]
U[1]=-2/l.viewport[3]
t++}else{if(!oe||v(e.texs,oe.texs)||e.shader!==oe.shader||e.shader_params!==oe.shader_params||e.blend!==oe.blend){commit()
oe=e}do{if(ce+4>le){commitAndFlush()
if(le!==fe)growSpriteBuffer()}var r=8*ce
ce+=4
se.set(e.data,r)
t++
z.push(e)
var a=e.next
e.next=null
e=a}while(e)}return t}function finishDraw(){commitAndFlush()
blendModeReset()}function spriteDrawReset(){if($){gl.disable(gl.SCISSOR_TEST)
$=null}}function spriteDraw(){profilerStart("sprites:draw")
drawSetup()
profilerStart("drawElem")
for(var e=0;e<H.length;++e)drawElem(H[e])
profilerStop("drawElem")
H.length=0
finishDraw()
profilerStop("sprites:draw")}function spriteDrawPartial(e){profilerStart("sprites:drawPartial")
drawSetup()
profilerStart("drawElem")
for(var t=0;t<H.length;++t){var r=H[t]
if(r.z>e){H=H.slice(t)
break}drawElem(r)}profilerStop("drawElem")
finishDraw()
profilerStop("sprites:drawPartial")}function buildRects(e,t,r){var a=[]
var i=0
for(var o=0;o<e.length;++o)i+=e[o]
var n=0
for(var s=0;s<t.length;++s)n+=t[s]
var l
var _
if(!r||w(r.src_width)===r.width&&w(r.src_height)===r.height){l=w(i)
_=w(n)}else{l=i
_=n}var c=[]
for(var u=0;u<e.length;++u)c.push(e[u]/n)
var d=[]
for(var f=0;f<t.length;++f)d.push(t[f]/i)
var v=[]
var h=false
var p=0
for(var m=0;m<t.length;++m){var E=0
for(var g=0;g<e.length;++g){var T=x(E/l,p/_,(E+e[g])/l,(p+t[m])/_)
a.push(T)
var y=e[g]/t[m]
if(1!==y)h=true
v.push(y)
E+=e[g]}p+=t[m]}return{widths:e,heights:t,wh:c,hw:d,rects:a,aspect:h?v:null,total_w:i,total_h:n}}function flipRectHoriz(e){return x(e[0],e[3],e[2],e[1])}function spriteFlippedUVsApplyHFlip(e){if(!e.uidata.rects_orig)e.uidata.rects_orig=e.uidata.rects
if(!e.uidata.rects_flipped)e.uidata.rects_flipped=e.uidata.rects.map(flipRectHoriz)
e.uidata.rects=e.uidata.rects_flipped}function spriteFlippedUVsRestore(e){if(e.uidata.rects_orig)e.uidata.rects=e.uidata.rects_orig}function Sprite(t){var r=this
this.lazy_load=null
if(t.texs)this.texs=t.texs
else{var e=t.ext||".png"
this.texs=[]
if(t.tex){O(!t.lazy_load)
this.texs.push(t.tex)}else if(t.layers){O(t.name)
O(!t.lazy_load)
this.texs=[]
for(var a=0;a<t.layers;++a)this.texs.push(p({url:"img/"+t.name+"_"+a+e,filter_min:t.filter_min,filter_mag:t.filter_mag,wrap_s:t.wrap_s,wrap_t:t.wrap_t,load_filter:t.load_filter}))}else{var i
if(t.name)i={url:"img/"+t.name+e+"#"+m(t),filter_min:t.filter_min,filter_mag:t.filter_mag,wrap_s:t.wrap_s,wrap_t:t.wrap_t,soft_error:t.soft_error,load_filter:t.load_filter}
else{O(t.url)
i=t}if(t.lazy_load)this.lazy_load=i
else this.texs.push(p(i))}}this.origin=t.origin||C(0,0)
this.size=t.size||C(1,1)
this.color=t.color||x(1,1,1,1)
this.uvs=t.uvs||x(0,0,1,1)
if(t.ws)this.uidata=buildRects(t.ws,t.hs)
this.shader=t.shader||null
var o=function tex_on_load(e){if(!t.uvs){r.uvs[2]=e.src_width/e.width
r.uvs[3]=e.src_height/e.height}if(t.ws)r.uidata=buildRects(t.ws,t.hs,e)}
if(this.texs.length)this.texs[0].onLoad(o)
else this.tex_on_load=o}Sprite.prototype.getAspect=function(){var e=this.texs[0]
if(!e)return 1
return e.src_width/e.src_height}
Sprite.prototype.withOrigin=function(e){var t=String(e[0]+1007*e[1])
if(!this.origin_cache)this.origin_cache={}
if(!this.origin_cache[t])(this.origin_cache[t]=spriteCreate({texs:this.texs,origin:e,size:this.size,color:this.color,uvs:this.uvs})).uidata=this.uidata
return this.origin_cache[t]}
Sprite.prototype.lazyLoadInit=function(){var e=this
var t=p(_extends({},this.lazy_load,{auto_unload:function auto_unload(){e.texs=[]}}))
this.texs.push(t)
this.loaded_at=0
if(t.loaded)this.tex_on_load(t)
else t.onLoad(function(){e.loaded_at=l.frame_timestamp
e.tex_on_load(t)})}
Sprite.prototype.isLazyLoad=function(){return Boolean(this.lazy_load)}
Sprite.prototype.lazyLoad=function(){if(!this.texs.length)this.lazyLoadInit()
if(!this.texs[0].loaded)return 0
if(!this.loaded_at)return 1
var e=(l.frame_timestamp-this.loaded_at)/250
if(e>=1){this.loaded_at=0
return 1}return e}
var he=x()
Sprite.prototype.draw=function(e){if(0===e.w||0===e.h)return null
var t=e.color||this.color
if(this.lazy_load){var r=this.lazyLoad()
if(!r)return null
if(1!==r)t=D(he,t[0],t[1],t[2],t[3]*r)}var a=(e.w||1)*this.size[0]
var i=(e.h||1)*this.size[1]
var o=(void 0!==e.frame?this.uidata.rects[e.frame]:e.uvs)||this.uvs
q.sprite=this
q.x=e.x
q.y=e.y
q.z=e.z||Z.UI
q.w=a
q.h=i
q.rot=e.rot
q.uvs=o
q.color_ul=t
q.color_ll=t
q.color_lr=t
q.color_ur=t
q.shader=e.shader||this.shader
q.shader_params=e.shader_params
q.nozoom=e.nozoom
q.pixel_perfect=e.pixel_perfect
q.blend=e.blend
return queuesprite4colorObj(q)}
Sprite.prototype.drawDualTint=function(e){e.shader=k
e.shader_params={color1:e.color1}
return this.draw(e)}
var pe=x()
var me=x()
var Ee=x()
var ge=x()
Sprite.prototype.draw4Color=function(e){if(0===e.w||0===e.h)return null
q.color_ul=e.color_ul
q.color_ll=e.color_ll
q.color_lr=e.color_lr
q.color_ur=e.color_ur
if(this.lazy_load){var t=this.lazyLoad()
if(!t)return null
if(1!==t){q.color_ul=D(pe,q.color_ul[0],q.color_ul[1],q.color_ul[2],q.color_ul[3]*t)
q.color_ll=D(me,q.color_ll[0],q.color_ll[1],q.color_ll[2],q.color_ll[3]*t)
q.color_ur=D(Ee,q.color_ur[0],q.color_ur[1],q.color_ur[2],q.color_ur[3]*t)
q.color_lr=D(ge,q.color_lr[0],q.color_lr[1],q.color_lr[2],q.color_lr[3]*t)}}var r=(e.w||1)*this.size[0]
var a=(e.h||1)*this.size[1]
var i="number"===typeof e.frame?this.uidata.rects[e.frame]:e.uvs||this.uvs
q.sprite=this
q.x=e.x
q.y=e.y
q.z=e.z||Z.UI
q.w=r
q.h=a
q.rot=e.rot
q.uvs=i
q.shader=e.shader||this.shader
q.shader_params=e.shader_params
q.nozoom=e.nozoom
q.pixel_perfect=e.pixel_perfect
q.blend=e.blend
return queuesprite4colorObj(q)}
Sprite.prototype.draw3D=function(e){if("number"===typeof e.frame)e.uvs=this.uidata.rects[e.frame]
else if(!e.uvs)e.uvs=this.uvs
s(this,e)}
function spriteCreate(e){return new Sprite(e)}function spriteStartup(){W=_.stats
U[2]=-1
U[3]=1
r.sprite_vshader=P=T("shaders/sprite.vp")
r.sprite_fshader=B=T("shaders/sprite.fp")
k=T("shaders/sprite_dual.fp")
S(P,B)
S(P,k)}},{"../common/util.js":400,"../common/vmath.js":402,"./camera2d.js":295,"./dyn_geom.js":302,"./engine.js":305,"./geom.js":318,"./shaders.js":353,"./textures.js":365,assert:void 0}],364:[function(e,t,r){"use strict"
r.create=create
var c=e("assert")
var a=e("./external_users_client")
var n=a.externalUsersAutoLoginFallbackProvider
var s=a.externalUsersAutoLoginProvider
var _=a.externalUsersCurrentUser
var i=a.externalUsersEmailPassLoginProvider
var l=a.externalUsersEnabled
var u=a.externalUsersLogIn
var d=a.externalUsersLogOut
var o=a.externalUsersSendEmailConfirmation
var f=e("../common/chunked_send")
var v=f.chunkedReceiverFinish
var h=f.chunkedReceiverFreeFile
var p=f.chunkedReceiverGetFile
var m=f.chunkedReceiverInit
var E=f.chunkedReceiverOnChunk
var g=f.chunkedReceiverStart
var T=e("../common/dot-prop")
var y=e("../common/external_users_common").ERR_NO_USER_ID
var S=e("../common/md5")
var I=e("../common/packet").isPacket
var A=e("../common/perfcounters").perfCounterAdd
var w=e("../common/tiny-events")
var L=e("../common/util")
var O=e("../common/util").cloneShallow
var R=e("./client_config").platformParameterGet
var b=e("./local_storage")
var N=e("./net")
var C=N.netDisconnected
var x=N.netDisconnectedRaw
var M=e("./walltime")
function ClientChannelWorker(e,t,r,a){w.call(this)
this.subs=e
var i=(this.channel_id=t).match(/^([^.]*)\.(.*)$/)
c(i)
this.channel_type=i[1]
this.channel_subid=i[2]
this.subscriptions=0
this.subscribe_failed=false
this.got_subscribe=false
this.immediate_subscribe=0
this.channel_data_ver=0
this.handlers=Object.create(r)
this.base_event_listeners=a
this.data={}}L.inherits(ClientChannelWorker,w)
ClientChannelWorker.prototype.getChannelID=function(){return this.channel_id}
ClientChannelWorker.prototype.emit=function(e){var t=arguments
w.prototype.emit.apply(this,t)
if(this.base_event_listeners){var r=this.base_event_listeners[e]
if(r)for(var a=0;a<r.length;++a)r[a].apply(this,Array.prototype.slice.call(t,1))}}
ClientChannelWorker.prototype.onSubscribe=function(e){c(this.subscriptions||this.autosubscribed)
this.on("subscribe",e)
if(this.got_subscribe)e(this.data)}
ClientChannelWorker.prototype.onceSubscribe=function(e){c(this.subscriptions||this.autosubscribed)
if(this.got_subscribe)e(this.data)
else this.once("subscribe",e)}
ClientChannelWorker.prototype.numSubscriptions=function(){return this.subscriptions}
ClientChannelWorker.prototype.isFullySubscribed=function(){return this.got_subscribe}
ClientChannelWorker.prototype.handleChannelData=function(e,t){var r=this
console.log("got channel_data("+this.channel_id+"):  "+JSON.stringify(e))
this.data=e;++this.channel_data_ver
this.emit("channel_data",this.data)
this.got_subscribe=true
this.emit("subscribe",this.data)
var a=this.channel_id.split(".")[0]
var i=this.subs.cmds_fetched_by_type
if(i&&!i[a]){i[a]=true
this.send("cmdparse","cmd_list",function(e,t){if(e){console.error("Error getting cmd_list for "+a)
delete i[a]}else r.subs.cmd_parse.addServerCommands(t)})}t()}
ClientChannelWorker.prototype.handleApplyChannelData=function(e,t){if(void 0===e.value)T.delete(this.data,e.key)
else T.set(this.data,e.key,e.value);++this.channel_data_ver
this.emit("channel_data",this.data,e.key,e.value)
t()}
ClientChannelWorker.prototype.handleBatchSet=function(e,t){for(var r=0;r<e.length;++r){var a=e[r],i=a[0],o=a[1]
if(void 0===o)T.delete(this.data.public,i)
else T.set(this.data.public,i,o);++this.channel_data_ver
this.emit("channel_data",this.data,"public."+i,o)}t()}
ClientChannelWorker.prototype.getChannelData=function(e,t){return T.get(this.data,e,t)}
ClientChannelWorker.prototype.predictSetChannelData=function(e,t){T.set(this.data,e,t)}
ClientChannelWorker.prototype.setChannelData=function(e,t,r,a){if(!r)T.set(this.data,e,t)
var i=t&&t.q||void 0
var o=this.subs.client.pak("set_channel_data",this.channel_type+".set_channel_data")
o.writeAnsiString(this.channel_id)
o.writeBool(i)
o.writeAnsiString(e)
o.writeJSON(t)
o.send(a)}
ClientChannelWorker.prototype.removeMsgHandler=function(e,t){c(this.handlers[e]===t)
delete this.handlers[e]}
ClientChannelWorker.prototype.onMsg=function(e,t){c(!this.handlers[e]||this.handlers[e]===t)
this.handlers[e]=t}
ClientChannelWorker.prototype.pak=function(e){var t=this.subs.client.pak("channel_msg","cm:"+this.channel_type+"."+e)
t.writeAnsiString(this.channel_id)
t.writeAnsiString(e)
return t}
ClientChannelWorker.prototype.send=function(e,t,r,a){c(!r||"function"===typeof r)
c(!a)
this.subs.client.send("channel_msg",{channel_id:this.channel_id,msg:e,data:t},"cm:"+this.channel_type+"."+e,r)}
ClientChannelWorker.prototype.cmdParse=function(e,t){this.send("cmdparse",e,t)}
ClientChannelWorker.prototype.unsubscribe=function(){this.subs.unsubscribe(this.channel_id)}
function SubscriptionManager(e,t){w.call(this)
this.client=e
this.channels={}
this.logged_in=false
this.first_session=false
this.login_credentials=null
this.logged_in_email=null
this.logged_in_username=null
this.logged_in_display_name=null
this.was_logged_in=false
this.logging_in=false
this.logging_out=false
this.auto_create_user=false
this.allow_anon=false
this.no_auto_login=false
this.auto_login_error=void 0
if(this.cmd_parse=t)this.cmds_fetched_by_type={}
this.base_handlers={}
this.channel_handlers={}
this.channel_event_listeners={}
this.quiet_messages=Object.create(null)
this.first_connect=true
this.server_time=0
this.server_time_interp=0
this.cack_data={}
e.onMsg("connect",this.handleConnect.bind(this))
e.onMsg("disconnect",this.handleDisconnect.bind(this))
e.onMsg("channel_msg",this.handleChannelMessage.bind(this))
e.onMsg("server_time",this.handleServerTime.bind(this))
e.onMsg("chat_broadcast",this.handleChatBroadcast.bind(this))
e.onMsg("restarting",this.handleRestarting.bind(this))
if(t)e.onMsg("csr_to_client",this.handleCSRToClient.bind(this))
this.chunked=null
e.onMsg("upload_start",this.handleUploadStart.bind(this))
e.onMsg("upload_chunk",this.handleUploadChunk.bind(this))
e.onMsg("upload_finish",this.handleUploadFinish.bind(this))
this.onChannelMsg(null,"channel_data",ClientChannelWorker.prototype.handleChannelData)
this.onChannelMsg(null,"apply_channel_data",ClientChannelWorker.prototype.handleApplyChannelData)
this.onChannelMsg(null,"batch_set",ClientChannelWorker.prototype.handleBatchSet)}L.inherits(SubscriptionManager,w)
SubscriptionManager.prototype.onceConnected=function(e){if(this.client.connected&&1===this.client.socket.readyState)return void e()
this.once("connect",e)}
SubscriptionManager.prototype.getBaseHandlers=function(e){var t=this.channel_handlers[e]
if(!t)t=this.channel_handlers[e]=Object.create(this.base_handlers)
return t}
SubscriptionManager.prototype.onChannelMsg=function(e,t,r){var a=e?this.getBaseHandlers(e):this.base_handlers
c(!a[t])
a[t]=r}
SubscriptionManager.prototype.onChannelEvent=function(e,t,r){var a=this.channel_event_listeners[e]
if(!a)a=this.channel_event_listeners[e]={}
if(!a[t])a[t]=[]
a[t].push(r)}
SubscriptionManager.prototype.handleChatBroadcast=function(e){console.error("["+e.src+"] "+e.msg)
this.emit("chat_broadcast",e)}
SubscriptionManager.prototype.handleRestarting=function(e){this.restarting=e
this.emit("restarting",e)}
SubscriptionManager.prototype.handleDisconnect=function(e){this.emit("disconnect",e)}
SubscriptionManager.prototype.sendResubscribe=function(){var e=this
c(!this.logging_in)
c(this.need_resub)
if(x())return
var t=function _loop(t){var r=e.channels[t]
if(r.subscriptions)e.client.send("subscribe",t,null,function(e){if(e){r.subscribe_failed=true
console.error("Error subscribing to "+t+": "+e)
r.emit("subscribe_fail",e)}})}
for(var r in this.channels)t(r)
this.emit("connect",this.need_resub.reconnect)
this.need_resub=null}
SubscriptionManager.prototype.getCackAppData=function(){var e
return(null==(e=this.cack_data)?void 0:e.app_data)||null}
SubscriptionManager.prototype.handleConnect=function(e){var t=this
var r=false
if(this.first_connect)this.first_connect=false
else r=true
this.need_resub={reconnect:r}
this.restarting=Boolean(e.restarting)
this.cack_data=e
M.sync(e.time)
if(x())return
if(this.logging_in);else if(this.was_logged_in)this.loginRetry(function(e){if(e&&"ERR_FAILALL_DISCONNECT"===e);else if(e)t.auto_login_error=e})
else if(!this.no_auto_login){var a=s()
var i
if(a&&l(a))this.loginExternal({provider:a},function(e){if(e===y&&n()){t.loginExternal({provider:n(),external_login_data:O(t.login_credentials.external_login_data),creation_display_name:t.login_credentials.creation_display_name},function(e){t.auto_login_error=e})
return}t.auto_login_error=e})
else if(b.get("name")&&b.get("password"))this.login(b.get("name"),b.get("password"),function(e){t.auto_login_error=e})
else if(i=b.get("login_external")){var o={provider:i}
this.loginInternal(o,function(e){if(e){t.auto_login_error=e
d(i)}})}}if(!this.logging_in&&this.need_resub)this.sendResubscribe()
this.fetchCmds()}
SubscriptionManager.prototype.fetchCmds=function(){var r=this
var e="client"
var t=this.cmds_fetched_by_type
if(t&&!t[e]){t[e]=true
this.client.send("cmd_parse_list_client",null,null,function(e,t){if(!e)r.cmd_parse.addServerCommands(t)})}}
SubscriptionManager.prototype.quietMessagesSet=function(e){for(var t=0;t<e.length;++t)this.quiet_messages[e[t]]=true}
SubscriptionManager.prototype.quietMessage=function(e,t){return this.quiet_messages[e]}
SubscriptionManager.prototype.handleChannelMessage=function(e,t){c(I(e))
var r=e.readAnsiString()
var a=e.readAnsiString()
var i=e.readBool()
var o=i?e:e.readJSON()
if(!this.quietMessage(a)&&(!o||!o.q)){var n
if(!i)n=JSON.stringify(o)
else if("function"===typeof o.contents)n=o.contents()
else n="(pak)"
console.log("got channel_msg("+r+") "+a+": "+n)}var s=this.getChannel(r)
var l=s.handlers[a]
if(!l){console.error("no handler for channel_msg("+r+") "+a+": "+JSON.stringify(o))
return}var _=r.split(".")[0]+"."+a
A("cm."+_)
profilerStart(_)
l.call(s,o,t)
profilerStop(_)}
SubscriptionManager.prototype.handleServerTime=function(e){this.server_time=e.readInt()
if(this.server_time<this.server_time_interp&&this.server_time>this.server_time_interp-250);else this.server_time_interp=this.server_time
M.sync(e.readInt())}
SubscriptionManager.prototype.getServerTime=function(){return this.server_time_interp}
SubscriptionManager.prototype.tick=function(e){this.server_time_interp+=e
if(!C())for(var t in this.channels){var r=this.channels[t]
if(r.immediate_subscribe)if(e>=r.immediate_subscribe){r.immediate_subscribe=0
this.unsubscribe(t)}else r.immediate_subscribe-=e}}
SubscriptionManager.prototype.onUploadProgress=function(e,t){var a=this
if(!this.upload_progress_cbs)this.upload_progress_cbs={}
c(!this.upload_progress_cbs[e])
this.upload_progress_cbs[e]=t
if(!this.chunked)this.chunked=m("client_receive",Infinity)
if(!this.chunked.on_progress)this.chunked.on_progress=function(e,t,r){if(a.upload_progress_cbs[r])a.upload_progress_cbs[r](e,t)}}
SubscriptionManager.prototype.handleUploadStart=function(e,t){if(!this.chunked)this.chunked=m("client_receive",Infinity)
g(this.chunked,e,t)}
SubscriptionManager.prototype.handleUploadChunk=function(e,t){E(this.chunked,e,t)}
SubscriptionManager.prototype.handleUploadFinish=function(e,t){v(this.chunked,e,t)}
SubscriptionManager.prototype.uploadGetFile=function(e){return p(this.chunked,e)}
SubscriptionManager.prototype.uploadFreeFile=function(e){return h(e)}
SubscriptionManager.prototype.subscribe=function(e){this.getChannel(e,true)}
SubscriptionManager.prototype.getChannel=function(t,e){var r=this.channels[t]
if(!r){var a=t.split(".")[0]
var i=this.getBaseHandlers(a)
var o=this.channel_event_listeners[a]
r=this.channels[t]=new ClientChannelWorker(this,t,i,o)}if(e){r.subscriptions++
if(!x()&&1===r.subscriptions){r.subscribe_failed=false
this.client.send("subscribe",t,null,function(e){if(e){r.subscribe_failed=true
console.error("Error subscribing to "+t+": "+e)
r.emit("subscribe_fail",e)}})}}return r}
SubscriptionManager.prototype.getUserId=function(){return this.loggedIn()}
SubscriptionManager.prototype.getDisplayName=function(){return this.logged_in_display_name}
SubscriptionManager.prototype.getLoginProvider=function(){return this.login_provider}
SubscriptionManager.prototype.getMyUserChannel=function(){var e=this.loggedIn()
if(!e)return null
var t=this.getChannel("user."+e)
if(!this.logging_out)t.autosubscribed=true
return t}
SubscriptionManager.prototype.unsubscribe=function(e){var t=this.channels[e]
c(t)
c(t.subscriptions)
t.subscriptions--
if(!t.subscriptions&&!t.autosubscribed){t.got_subscribe=false
t.emit("unsubscribe")}if(!x()&&!t.subscriptions&&!t.subscribe_failed)this.client.send("unsubscribe",e)}
SubscriptionManager.prototype.getChannelImmediate=function(e,t){t=t||6e4
var r=this.getChannel(e)
if(!r.immediate_subscribe)this.subscribe(e)
r.immediate_subscribe=t
return r}
SubscriptionManager.prototype.onLogin=function(e){this.on("login",e)
if(this.logged_in)return void e()}
SubscriptionManager.prototype.onceLoggedIn=function(e){if(this.logged_in)return void e()
this.once("login",e)}
SubscriptionManager.prototype.loggedIn=function(){return this.logging_out?null:this.logged_in?this.logged_in_username||"missing_name":null}
SubscriptionManager.prototype.userOnChannelData=function(e,t,r,a){if(e!==this.getUserId())return
if("public.display_name"===r)this.logged_in_display_name=a}
SubscriptionManager.prototype.handleLoginResponse=function(e,t,r){var a=this
this.logging_in=false
var i="login_fail"
if(!t){var o
i="login"
this.first_session=Boolean(r.first_session)
this.logged_in_email=r.email||null
this.logged_in_username=r.user_id
this.logged_in_display_name=r.display_name
this.logged_in=true
this.was_logged_in=true
var n=this.getMyUserChannel()
n.onceSubscribe(function(){if(!a.did_master_subscribe){var e=n.getChannelData("public.permissions",{})
if(e.sysadmin)a.subscribe("master.master")
if(e.sysadmin||e.csr){a.did_master_subscribe=true
a.subscribe("global.global")}}})
if(!n.subs_added_user_on_channel_data){n.on("channel_data",this.userOnChannelData.bind(this,this.logged_in_username))
n.subs_added_user_on_channel_data=true}if(this.need_resub)this.sendResubscribe()
if(r.hash&&null!=(o=this.login_credentials)&&o.password){var s=this.login_credentials.password
if(s){var l=S(S(this.logged_in_username.toLowerCase())+s)
if(S(this.client.secret+l)!==r.hash)this.getMyUserChannel().send("set_external_password",{hash:l})}}}if(this.need_resub)this.sendResubscribe()
this.emit(i,t)
e(t)}
SubscriptionManager.prototype.loginRetry=function(t){var r=this
this.loginInternal(this.login_credentials,function(e){if((r.auto_login_error=e)===y&&n()&&r.login_credentials.provider===s()&&l(s()))r.loginExternal({provider:n(),external_login_data:O(r.login_credentials.external_login_data),creation_display_name:r.login_credentials.creation_display_name},function(e){r.auto_login_error=e
t(e)})
else t(e)})}
SubscriptionManager.prototype.getLastLoginCredentials=function(){return this.login_credentials}
SubscriptionManager.prototype.loginInternalExternalUsers=function(o,e,n){var s=this
var t=e.email,r=e.password,a=e.do_creation,i=e.creation_display_name,l=e.external_login_data
return void u(o,{user_initiated:true,do_creation:a,creation_display_name:i,email:t,password:r,external_login_data:l},function(e,i){s.login_credentials.external_login_data=i
if(e){b.set("login_external",s.login_provider=void 0)
s.serverLog("authentication_failed_"+o,{creation_mode:a,email:t,passlen:r&&r.length,external_data:Boolean(l),err:e})
return void s.handleLoginResponse(n,e)}b.set("login_external",s.login_provider=o)
b.set("password",void 0)
_(o,function(e,t){if(e);if(x())return void s.handleLoginResponse(n,"ERR_DISCONNECTED")
var r=(null==t?void 0:t.name)||""
if(R("random_creation_name"))r=""
var a={provider:o,validation_data:i.validation_data,display_name:r}
if(null!=t&&t.name)s.login_credentials.creation_display_name=t.name
s.client.send("login_external",a,null,s.handleLoginResponse.bind(s,n))})})}
SubscriptionManager.prototype.sessionHashedPassword=function(){c(this.login_credentials.password)
return S(this.client.secret+this.login_credentials.password)}
SubscriptionManager.prototype.loginInternal=function(e,t){if(this.logging_in)return void t("Login already in progress")
this.auto_login_error=null
this.logging_in=true
this.logged_in=false
if((this.login_credentials=e).do_creation){this.login_credentials=O(e)
delete this.login_credentials.do_creation}var r=e.provider
if(r)this.loginInternalExternalUsers(r,e,t)
else{var a=e.user_id
this.client.send("login",{user_id:a,password:this.sessionHashedPassword()},null,this.handleLoginResponse.bind(this,t))}}
SubscriptionManager.prototype.userCreateInternal=function(e,t){if(this.logging_in)return t("Login already in progress")
this.logging_in=true
this.logged_in=false
return this.client.send("user_create",e,null,this.handleLoginResponse.bind(this,t))}
function hashedPassword(e,t){var r=t.split("$$")
if(2===r.length&&"prehashed"===r[0]&&32===r[1].length)t=r[1]
else t=S(S(e.toLowerCase())+t)
return t}SubscriptionManager.prototype.login=function(r,a,i){var o=this
if(!(r=(r||"").trim()))return i("Missing username")
if(!(a=(a||"").trim()))return i("Missing password")
var e=hashedPassword(r,a)
if(e!==a)b.set("password","prehashed$$"+e)
var t={user_id:r,password:e}
if(!this.auto_create_user)return this.loginInternal(t,i)
return this.loginInternal(t,function(e,t){if(!e||"ERR_USER_NOT_FOUND"!==e)return void i(e,t)
o.userCreate({user_id:r,password:a,password_confirm:a,email:"autocreate@glovjs.org"},i)})}
SubscriptionManager.prototype.loginEmailPass=function(e,t){e={email:e.email,password:e.password,provider:i(),do_creation:e.do_creation,creation_display_name:e.creation_display_name}
return this.loginInternal(e,t)}
SubscriptionManager.prototype.loginExternal=function(e,t){return this.loginInternal(O(e),t)}
SubscriptionManager.prototype.sendActivationEmail=function(e,t){return o(e,t)}
SubscriptionManager.prototype.userCreate=function(e,t){e.user_id=(e.user_id||"").trim()
if(!e.user_id)return t("Missing username")
e.password=(e.password||"").trim()
if(!e.password)return t("Missing password")
e.password_confirm=(e.password_confirm||"").trim()
if(!this.auto_create_user&&!e.password_confirm)return t("Missing password confirmation")
e.email=(e.email||"").trim()
if(!this.auto_create_user&&!e.email)return t("Missing email")
e.display_name=(e.display_name||"").trim()
var r=hashedPassword(e.user_id,e.password)
if(r!==e.password)b.set("password","prehashed$$"+r)
if(r!==hashedPassword(e.user_id,e.password_confirm))return t("Passwords do not match")
this.login_credentials={user_id:e.user_id,password:r}
return this.userCreateInternal({display_name:e.display_name||e.user_id,user_id:e.user_id,email:e.email,password:r},t)}
SubscriptionManager.prototype.logout=function(){var t=this
c(this.logged_in)
c(!this.logging_in)
c(!this.logging_out)
if(this.did_master_subscribe){this.did_master_subscribe=false
var e=this.getMyUserChannel()
var r=e&&e.getChannelData("public.permissions",{})
if(r&&r.sysadmin)this.unsubscribe("master.master")
this.unsubscribe("global.global")}for(var a in this.channels){var i=this.channels[a]
if(i.immediate_subscribe){i.immediate_subscribe=0
this.unsubscribe(a)}c(!i.subscriptions,"Remaining active subscription for "+a)
if(i.autosubscribed)i.autosubscribed=false}this.logging_out=true
this.client.send("logout",null,null,function(e){t.logging_out=false
if(!e){b.set("password",void 0)
b.set("login_external",t.login_provider=void 0)
t.first_session=false
t.logged_in=false
t.logged_in_username=null
t.logged_in_display_name=null
t.was_logged_in=false
t.login_credentials=null
t.emit("logout")}})}
SubscriptionManager.prototype.isFirstSession=function(){return this.first_session}
SubscriptionManager.prototype.serverLog=function(e,t){var r=this
this.onceConnected(function(){r.client.send("log",{type:e,data:t})})}
SubscriptionManager.prototype.sendCmdParse=function(t,r){var a=this
this.onceConnected(function(){var e=a.client.pak("cmd_parse_auto")
e.writeString(t)
e.send(r)})}
SubscriptionManager.prototype.handleCSRToClient=function(e,r){var a=this
var t=e.readString()
var i=e.readJSON()
this.cmd_parse.handle({access:i},t,function(e,t){if(e&&a.cmd_parse.was_not_found)return r(null,{found:0,err:e})
return r(e,{found:1,resp:t})})}
function create(e,t){return new SubscriptionManager(e,t)}},{"../common/chunked_send":378,"../common/dot-prop":383,"../common/external_users_common":387,"../common/md5":390,"../common/packet":392,"../common/perfcounters":393,"../common/tiny-events":397,"../common/util":400,"./client_config":297,"./external_users_client":312,"./local_storage":329,"./net":338,"./walltime":370,assert:void 0}],365:[function(e,t,r){"use strict"
r.textureLoadCount=textureLoadCount
r.textureDefaultFilters=textureDefaultFilters
r.textureGetAll=textureGetAll
r.textureWhite=textureWhite
r.textureError=textureError
r.textureBind=textureBind
r.textureBindArray=textureBindArray
r.textureCmpArray=textureCmpArray
r.textureIsArrayBound=textureIsArrayBound
r.textureResetState=textureResetState
r.textureCname=textureCname
r.textureFilterKey=textureFilterKey
r.textureCreateForCapture=textureCreateForCapture
r.textureCreateForDepthCapture=textureCreateForDepthCapture
r.textureLoad=textureLoad
r.textureFindForReplacement=textureFindForReplacement
r.textureTick=textureTick
r.textureUnloadDynamic=textureUnloadDynamic
r.textureSupportsDepth=textureSupportsDepth
r.textureStartup=textureStartup
r.TEXTURE_FORMAT=void 0
var E=e("assert")
var a=e("glov-async")
var p=a.asyncParallel
var d=a.asyncSeries
var i=e("../common/texpack_common")
var m=i.FORMAT_PACK
var g=i.FORMAT_PNG
var T=i.TEXPACK_MAGIC
var o=e("../common/util")
var y=o.callEach
var n=o.callbackify
var S=o.isPowerOfTwo
var I=o.nextHighestPowerOfTwo
var s=o.ridx
var A=e("./engine")
var w=e("./fetch").fetch
var l=e("./filewatch").filewatchOn
var _=e("./local_storage")
var L=e("./locate_asset").locateAsset
var c=e("./settings")
var O=e("./shaders").shadersSetGLErrorReportDetails
var R=e("./urlhash")
var u=e("./webfs")
var b=u.webFSExists
var N=u.webFSGetFile
var C=Math.floor
var f=3e5
var v={}
var x=0
function textureLoadCount(){return x}var h=4
var M=0
var D
var P
var B
var k=[{target:"TEXTURE_CUBE_MAP_NEGATIVE_X",pos:[0,1]},{target:"TEXTURE_CUBE_MAP_POSITIVE_X",pos:[0,0]},{target:"TEXTURE_CUBE_MAP_NEGATIVE_Y",pos:[1,0]},{target:"TEXTURE_CUBE_MAP_POSITIVE_Y",pos:[1,1]},{target:"TEXTURE_CUBE_MAP_NEGATIVE_Z",pos:[2,0]},{target:"TEXTURE_CUBE_MAP_POSITIVE_Z",pos:[2,1]}]
var U={R8:{count:1},RGB8:{count:3},RGBA8:{count:4},DEPTH16:{count:1},DEPTH24:{count:1}}
r.TEXTURE_FORMAT=U
function textureDefaultFilters(e,t){P=e
B=t}var G=null
var F=[]
var W
var H
var z
function setUnit(e){if(e!==G){gl.activeTexture(gl.TEXTURE0+e)
G=e}}function bindHandle(e,t,r){if(F[e]!==r){setUnit(e)
gl.bindTexture(t,r)
F[e]=r}}function unbindAll(e){for(var t=0;t<F.length;++t){setUnit(t)
gl.bindTexture(e,e===gl.TEXTURE_2D?W:null)
F[t]=null}}function textureGetAll(){return v}function textureWhite(){return v.white}function textureError(){return v.error}function textureBind(e,t){t.last_use=z
bindHandle(e,t.target,t.eff_handle)}function textureBindArray(e){for(var t=0;t<e.length;++t){var r=e[t]
r.last_use=z
var a=r.eff_handle
if(F[t]!==a){if(t!==G){gl.activeTexture(gl.TEXTURE0+t)
G=t}gl.bindTexture(r.target,a)
F[t]=a}}}function textureCmpArray(e,t){var r=e.length-t.length
if(r)return r
for(var a=0;a<e.length;++a)if(r=e[a].id-t[a].id)return r
return 0}function textureIsArrayBound(e){for(var t=0;t<e.length;++t){var r=e[t].eff_handle
if(F[t]!==r)return false}return true}function textureResetState(){G=-1
if(A.webgl2)unbindAll(gl.TEXTURE_2D_ARRAY)
unbindAll(gl.TEXTURE_2D)
setUnit(0)}function textureCname(e){var t=e.lastIndexOf("/")
if(-1!==t)e=e.slice(t+1)
if(-1!==(t=e.indexOf(".")))e=e.slice(0,t)
return e.toLowerCase()}var V=[]
var Y=0
function Texture(e){this.id=++Y
this.name=e.name
this.cname=textureCname(this.name)
this.loaded=false
this.load_fail=false
this.target=e.target||gl.TEXTURE_2D
this.is_array=this.target===gl.TEXTURE_2D_ARRAY
this.is_cube=this.target===gl.TEXTURE_CUBE_MAP
this.packed_mips=Boolean(e.packed_mips)
if(this.packed_mips)E(this.is_array)
this.handle=gl.createTexture()
this.eff_handle=W
this.setSamplerState(e)
this.src_width=this.src_height=1
this.width=this.height=1
this.nozoom=e.nozoom||false
this.on_load=[]
this.gpu_mem=0
this.soft_error=e.soft_error||false
this.last_use=z
this.auto_unload=e.auto_unload||false
if(this.auto_unload)V.push(this)
this.load_filter=e.load_filter||null
this.format=e.format||U.RGBA8
if(e.data){var t=this.updateData(e.width,e.height,e.data)
if(t){O()
E(false,"Error loading "+e.name+": "+t)}}else{unbindAll(this.target)
if(e.url){this.format=U.RGBA8
this.url=e.url
this.loadURL(e.url,this.load_filter)}}}Texture.prototype.updateGPUMem=function(){var e=this.width*this.height*this.format.count
if(this.mipmaps)e*=1.5
var t=e-this.gpu_mem
A.perf_state.gpu_mem.tex+=t
this.gpu_mem=t}
function bindForced(e){var t=e.target
setUnit(0)
F[0]=null
bindHandle(0,t,e.handle)}function textureFilterKey(e){return(e.filter_min||P)+1e4*(e.filter_mag||B)}Texture.prototype.setSamplerState=function(e){var t=this.target
bindForced(this)
this.filter_min=e.filter_min||P
this.filter_mag=e.filter_mag||B
gl.texParameteri(t,gl.TEXTURE_MIN_FILTER,this.filter_min)
gl.texParameteri(t,gl.TEXTURE_MAG_FILTER,this.filter_mag)
this.wrap_s=e.wrap_s||gl.REPEAT
this.wrap_t=e.wrap_t||gl.REPEAT
gl.texParameteri(t,gl.TEXTURE_WRAP_S,this.wrap_s)
gl.texParameteri(t,gl.TEXTURE_WRAP_T,this.wrap_t)
this.mipmaps=this.filter_min>=9984&&this.filter_min<=9987||e.force_mipmaps
if(M)if(this.mipmaps&&e.filter_mag!==gl.NEAREST)gl.texParameterf(gl.TEXTURE_2D,D,h)
else gl.texParameterf(gl.TEXTURE_2D,D,1)}
Texture.prototype.uploadPackedTexArrayWithMips=function uploadPackedTexArrayWithMips(e,t,r,a){var i
var o=0
var n=t
while(n>=1){var s=e[o]
E(s)
gl.texImage3D(this.target,o,this.format.internal_type,n,n,r,0,this.format.internal_type,this.format.gl_type,0===o?a:s)
if(gl.getError()){(i=i||document.createElement("canvas")).width=n
i.height=n*r
i.getContext("2d").drawImage(s,0,0)
gl.texImage3D(this.target,o,this.format.internal_type,n,n,r,0,this.format.internal_type,this.format.gl_type,i)}o++
n=C(n/2)}E(!e[o])}
Texture.prototype.updateData=function updateData(e,t,r,a){profilerStart("Texture:updateData")
E(!this.destroyed)
bindForced(this)
this.last_use=z
this.src_width=e
this.src_height=t
this.width=e
this.height=t
for(var i=0;i<10&&gl.getError();++i);var o=(!S(e)||!S(t))&&!this.is_array&&!this.is_cube&&!(!this.mipmaps&&this.wrap_s===gl.CLAMP_TO_EDGE&&this.wrap_t===gl.CLAMP_TO_EDGE)
if(o){this.width=I(e)
this.height=I(t)
gl.texImage2D(this.target,0,this.format.internal_type,this.width,this.height,0,this.format.internal_type,this.format.gl_type,null)}if(r instanceof Uint8Array||r instanceof Uint8ClampedArray){E(!a)
E(r.length>=e*t*this.format.count)
E(!this.is_cube)
if(this.is_array){var n=t/e
gl.texImage3D(this.target,0,this.format.internal_type,e,e,n,0,this.format.internal_type,this.format.gl_type,r)}else if(o)gl.texSubImage2D(this.target,0,0,0,e,t,this.format.internal_type,this.format.gl_type,r)
else gl.texImage2D(this.target,0,this.format.internal_type,e,t,0,this.format.internal_type,this.format.gl_type,r)}else{if(!r.width){profilerStop()
return"Missing width ("+r.width+') ("'+String(r).slice(0,100)+'")'}if(this.is_cube){E(!a)
E.equal(2*e,3*t)
var s=t/2
var l=document.createElement("canvas")
l.width=s
l.height=s
var _=l.getContext("2d")
for(var c=0;c<k.length;++c){var u=k[c]
_.drawImage(r,u.pos[0]*s,u.pos[1]*s,s,s,0,0,s,s)
gl.texImage2D(gl[u.target],0,this.format.internal_type,this.format.internal_type,this.format.gl_type,l)}}else if(this.is_array&&a){var d=a[0].width
E(a[0].height%d===0)
var f=a[0].height/d
this.uploadPackedTexArrayWithMips(a,d,f,r)}else if(this.is_array){E(!a)
var v=t/e
gl.texImage3D(this.target,0,this.format.internal_type,e,e,v,0,this.format.internal_type,this.format.gl_type,r)
if(gl.getError()){var h=document.createElement("canvas")
h.width=e
h.height=t
h.getContext("2d").drawImage(r,0,0)
gl.texImage3D(this.target,0,this.format.internal_type,e,e,v,0,this.format.internal_type,this.format.gl_type,h)}}else if(o){E(!a)
if(e!==this.width)gl.texSubImage2D(this.target,0,1,0,this.format.internal_type,this.format.gl_type,r)
if(t!==this.height)gl.texSubImage2D(this.target,0,0,1,this.format.internal_type,this.format.gl_type,r)
gl.texSubImage2D(this.target,0,0,0,this.format.internal_type,this.format.gl_type,r)}else{E(!a)
gl.texImage2D(this.target,0,this.format.internal_type,this.format.internal_type,this.format.gl_type,r)}}var p=null
var m=gl.getError()
if(m)p="GLError("+m+")"
if(!p&&this.mipmaps&&!a){gl.generateMipmap(this.target)
if(m=gl.getError())p="GLError("+m+")"}if(!p){this.updateGPUMem()
this.eff_handle=this.handle
this.loaded=true
y(this.on_load,this.on_load=null,this)}profilerStop()
return p}
Texture.prototype.onLoad=function(e){if(this.loaded)e(this)
else this.on_load.push(e)}
var j=n(window.createImageBitmap)
var K
function blobSupported(){if(void 0!==K)return K
if("undefined"===typeof window.Blob)return K=false
try{var e=new Uint8Array(4)
var t=URL.createObjectURL(new Blob([e],{type:"image/png"}))
URL.revokeObjectURL(t)
K=true}catch(e){K=false}return K}function removeHash(e){var t=e.indexOf("#")
if(-1===t)return e
return e.slice(0,t)}var q=4
Texture.prototype.loadURL=function loadURL(u,f){var v=this
E(!v.destroyed)
var h
var t=v.load_gen=(v.load_gen||0)+1
function tryLoad(r){profilerStart("Texture:tryLoad")
var a=false
function done(e,t){profilerStart("Texture:onload")
if(!a){a=true
r(e,t)}profilerStop()}h=0
var e=u
if(!e.includes(":")){var t=e.lastIndexOf(".")
E(-1!==t)
var i=e.slice(0,t)
var o=i+".png"
var n=i+".tflag"
if(b(n)){h=N(n,"jsobj")
E.equal(typeof h,"number")
if(h&m)e=i+".txp"}if(b(o)&&blobSupported()){E(!(h&m))
var s=N(o)
var l=URL.createObjectURL(new Blob([s],{type:"image/png"}))
var _=new Image
_.onload=function(){URL.revokeObjectURL(l)
done(null,_)}
_.onerror=function(){URL.revokeObjectURL(l)
done("img decode error")}
_.src=l
profilerStop()
return}e=L(removeHash(e))
e=""+R.getURLBase()+e}if(h&m){w({url:e,response_type:"arraybuffer"},done)
profilerStop()
return}var c=new Image
c.onload=function(){done(null,c)}
c.onerror=function(){done("error",null)}
c.crossOrigin="anonymous"
c.src=e
profilerStop()}function decodeTexturePack(s,t){E(s instanceof ArrayBuffer)
var e=new DataView(s)
var r=0
var a=e.getUint32(r,true)
r+=4
if(a!==T)return void t("TXP: Invalid header")
var i=e.getUint32(r,true)
if(i>32)return void t("TXP: Data out of bounds")
var o=e.getUint32(r+=4,true)
var l=[]
var n=[]
function decodeLevelPNG(e,t,r,a){var i=new Image
var o=new Uint8Array(s,t,r)
var n=URL.createObjectURL(new Blob([o],{type:"image/png"}))
i.onload=function(){URL.revokeObjectURL(n)
l[e]=i
a()}
i.onerror=function(){URL.revokeObjectURL(n)
a("img load error")}
i.src=n}var _=(r+=4)+4*i
for(var c=0;c<i;++c){var u=e.getUint32(r,true)
r+=4
if(o&g)n.push(decodeLevelPNG.bind(null,c,_,u))
else return void t("TXP: Unknown format "+o)
_+=u}if(_!==s.byteLength)if(_>s.byteLength)return void t("TXP: Unexpected end of file ("+_+" > "+s.byteLength+")")
else E(false,"TXP: Unexpected end of file ("+_+" != "+s.byteLength+")")
d(n,function(e){t(e,l[0],l)})}function prepImage(e,o,t){if(e||!o)return void t(e||"error",o)
if(h&m)return void decodeTexturePack(o,t)
if(f)o=f(v,o)
if(!(v.is_array&&v.packed_mips))return void t(null,o)
var n=[]
var r=[]
var a=o.width
var i=o.height
var s=2*a/3
E.equal(C(s),s)
var l=i/s
if(A.defines.ARRAYNOMIP){o.width=s
o.height=l*s
return void t(null,o)}function getLevel(r,e,t,a,i){j(o,e,t,a,a*l,{premultiplyAlpha:"none",colorSpaceConversion:"none"},function(e,t){if(e)return void i(e)
n[r]=t
i()})}var _=0
var c=s
var u=0
var d=0
while(c>=1){r.push(getLevel.bind(null,_,d,u,c))
if(d)u+=c*l
else d=c
c=C(c/2);++_}p(r,function(e){t(e,o,n)})}++x
var s=0
function handleLoad(e,n){if(v.load_gen!==t||v.destroyed){--x
return}prepImage(e,n,function(e,t,r){n=t
var a=""
if(e)a=e
else if(n){var i=v.updateData(n.width,n.height,n,r)
if(i){a=String(i)
if(v.is_array&&("GLError(1282)"===i||"GLError(1281)"===i)&&A.webgl2&&!A.DEBUG){_.setJSON("webgl2_disable",{ua:navigator.userAgent,ts:Date.now()})
console.error('Error loading array texture "'+u+'": '+a+", reloading without WebGL2..")
A.reloadSafe()
return}if(!v.for_reload)s=q}else{--x
return}}var o='Error loading texture "'+(u&&u.length>200?u.slice(0,200)+"...":u)+'": '+a
if(++s>q){--x
v.eff_handle=H
v.load_fail=true
console.error(o+": "+a+", retries failed")
if(v.soft_error)v.err="Load failed"
else{O()
E(false,o)}return}console.error(o+": "+a+", retrying... ")
setTimeout(tryLoad.bind(null,handleLoad),100*s*s)})}tryLoad(handleLoad)}
Texture.prototype.allocFBO=function(e,t){var r=c.fbo_rgba?gl.RGBA:gl.RGB
bindForced(this)
gl.texImage2D(this.target,0,r,e,t,0,r,gl.UNSIGNED_BYTE,null)
this.fbo=gl.createFramebuffer()
E(this.fbo)
gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo)
gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.handle,0)
this.last_use=z
this.src_width=this.width=e
this.src_height=this.height=t
this.updateGPUMem()}
Texture.prototype.allocDepth=function(e,t){bindForced(this)
gl.texImage2D(gl.TEXTURE_2D,0,this.format.internal_type,e,t,0,this.format.format,this.format.gl_type,null)
this.last_use=z
this.src_width=this.width=e
this.src_height=this.height=t
this.updateGPUMem()}
Texture.prototype.captureStart=function(e,t){E(!this.capture)
this.capture={w:e,h:t}
if(this.fbo)gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo)
else{E(e)
E(t)}}
Texture.prototype.captureEnd=function(e,t){E(this.capture)
var r=this.capture
this.capture=null
if(this.fbo)gl.bindFramebuffer(gl.FRAMEBUFFER,null)
else this.copyTexImage(0,0,r.w,r.h)
var a=e?gl.LINEAR:gl.NEAREST
this.setSamplerState({filter_min:a,filter_mag:a,wrap_s:t?gl.REPEAT:gl.CLAMP_TO_EDGE,wrap_t:t?gl.REPEAT:gl.CLAMP_TO_EDGE})}
Texture.prototype.copyTexImage=function(e,t,r,a){E(!this.destroyed)
E(r&&a)
bindHandle(0,this.target,this.handle)
gl.copyTexImage2D(this.target,0,gl.RGB,e,t,r,a,0)
this.last_use=z
this.src_width=this.width=r
this.src_height=this.height=a
this.updateGPUMem()}
Texture.prototype.destroy=function(){if(this.destroyed)return
profilerStart("Texture:destroy")
E(this.name)
var e=this.auto_unload
if(e){this.auto_unload=null
var t=V.indexOf(this)
E(-1!==t)
s(V,t)}delete v[this.name]
unbindAll(this.target)
gl.deleteTexture(this.handle)
if(this.fbo){gl.bindFramebuffer(gl.FRAMEBUFFER,null)
gl.deleteFramebuffer(this.fbo)}this.width=this.height=0
this.updateGPUMem()
this.destroyed=true
if("function"===typeof e)e()
profilerStop("Texture:destroy")}
function create(e){E(e.name)
var t=new Texture(e)
return v[e.name]=t}var Z=0
function textureCreateForCapture(e,t){var r=e||"screen_temporary_tex_"+ ++Z
E(!v[r])
var a=create({filter_min:gl.NEAREST,filter_mag:gl.NEAREST,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,format:U.RGB8,name:r,auto_unload:t})
a.loaded=true
a.eff_handle=a.handle
return a}function textureCreateForDepthCapture(e,t){var r=e||"screen_temporary_tex_"+ ++Z
E(!v[r])
var a=create({filter_min:gl.NEAREST,filter_mag:gl.NEAREST,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,format:t,name:r})
a.loaded=true
a.eff_handle=a.handle
return a}function textureLoad(e){var t=e.name=e.name||e.url
E(t)
var r=v[t]
if(!r)r=create(e)
r.last_use=z
return r}function textureFindForReplacement(e){e=textureCname(e)
for(var t in v)if(v[t].cname===e)return v[t]
return null}var X=0
function textureTick(){z=A.frame_timestamp
var e=V.length
if(!e)return
if(X>=e)X=0
var t=V[X]
if(t.last_use<z-f){console.log("Unloading texture "+t.name)
t.destroy()}else++X}function textureUnloadDynamic(){while(V.length)V[0].destroy()}function textureReload(e){var t=false
var r=textureCname(e)
for(var a in v){var i=v[a]
if(i.cname===r&&i.url){i.for_reload=true
i.loadURL(removeHash(i.url)+"?rl="+Date.now(),i.load_filter)
t=true}}return t}var Q
function textureSupportsDepth(){return Q}function textureStartup(){P=gl.LINEAR_MIPMAP_LINEAR
B=gl.LINEAR
U.R8.internal_type=gl.LUMINANCE
U.R8.gl_type=gl.UNSIGNED_BYTE
U.RGB8.internal_type=gl.RGB
U.RGB8.gl_type=gl.UNSIGNED_BYTE
U.RGBA8.internal_type=gl.RGBA
U.RGBA8.gl_type=gl.UNSIGNED_BYTE
var e
if(A.webgl2){Q=true
e=gl.UNSIGNED_INT_24_8}else{var t=gl.getExtension("WEBGL_depth_texture")
if(t){e=t.UNSIGNED_INT_24_8_WEBGL
Q=true}}if(Q){U.DEPTH16.internal_type=A.webgl2?gl.DEPTH_COMPONENT16:gl.DEPTH_COMPONENT
U.DEPTH16.format=gl.DEPTH_COMPONENT
U.DEPTH16.gl_type=gl.UNSIGNED_SHORT
U.DEPTH24.internal_type=A.webgl2?gl.DEPTH24_STENCIL8:gl.DEPTH_STENCIL
U.DEPTH24.format=gl.DEPTH_STENCIL
U.DEPTH24.gl_type=e}var r=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")
if(r){D=r.TEXTURE_MAX_ANISOTROPY_EXT
h=M=gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}H=textureLoad({name:"error",width:2,height:2,nozoom:true,format:U.RGBA8,filter_mag:gl.NEAREST,data:new Uint8Array([255,20,147,255,255,0,0,255,255,255,255,255,255,20,147,255])}).handle
W=textureLoad({name:"loading",width:2,height:2,nozoom:true,format:U.RGBA8,data:new Uint8Array([127,127,127,255,0,0,0,255,64,64,64,255,127,127,127,255])}).handle
textureLoad({name:"white",width:2,height:2,nozoom:true,format:U.RGBA8,data:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255])})
textureLoad({name:"invisible",width:2,height:2,nozoom:true,format:U.RGBA8,data:new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])})
l(".png",textureReload)
l(".jpg",textureReload)
l(".txp",textureReload)}r.format=U
r.defaultFilters=textureDefaultFilters
r.texturesUnloadDynamic=textureUnloadDynamic
r.bind=textureBind
r.bindArray=textureBindArray
r.load=textureLoad
r.cmpTextureArray=textureCmpArray
r.isArrayBound=textureIsArrayBound
r.createForCapture=textureCreateForCapture
r.createForDepthCapture=textureCreateForDepthCapture
r.cname=textureCname
r.findTexForReplacement=textureFindForReplacement
r.textures=v},{"../common/texpack_common":396,"../common/util":400,"./engine":305,"./fetch":313,"./filewatch":314,"./local_storage":329,"./locate_asset":331,"./settings":351,"./shaders":353,"./urlhash":369,"./webfs":371,assert:void 0,"glov-async":void 0}],366:[function(e,t,r){"use strict"
r.queue=queue
r.render=render
r.active=active
r.fade=fade
r.wipe=wipe
r.splitScreen=splitScreen
r.pixelate=pixelate
r.randomTransition=randomTransition
r.CONTINUE=r.REMOVE=r.IMMEDIATE=void 0
var n=e("assert")
var a=e("../common/util")
var f=a.easeOut
var S=a.lerp
var s=e("../common/verify")
var i=e("../common/vmath")
var I=i.unit_vec
var v=i.vec4
var A=e("./camera2d")
var o=e("./effects")
var l=o.applyCopy
var _=o.effectsIsFinal
var c=o.effectsQueue
var u=e("./engine")
var d=e("./framebuffer")
var h=d.framebufferCapture
var p=d.framebufferEnd
var m=d.framebufferStart
var E=d.temporaryTextureClaim
var g=e("./shaders").shaderCreate
var T=e("./sprites")
var y=T.spriteQueueRaw
var w=T.spriteQueueRaw4
var L=T.spriteQueueRaw4Color
var O=e("./textures").textureCreateForCapture
var R=e("./ui")
var b=Math.PI,N=Math.abs,C=Math.cos,x=Math.floor,M=Math.min,D=Math.pow,P=Math.random,B=Math.sin
var k=(0,Math.sqrt)(.5)
var U=b/4
var G=b/2
var F=[]
var W="immediate"
r.IMMEDIATE=W
var H="remove"
r.REMOVE=H
var z="continue"
r.CONTINUE=z
var V={transition_pixelate:{fp:"shaders/transition_pixelate.fp"}}
function getShader(e){var t=V[e]
if(!t.shader)t.shader=g(t.fp)
return t.shader}function GlovTransition(e,t){this.z=e
this.capture=null
this.func=t
this.accum_time=0}function transitionCapture(e){n(!e.capture)
e.capture=O()
h(e.capture)}function transitionCaptureFramebuffer(e){n(!e.capture)
e.capture=p()
E(e.capture)
if(e.capture.fbo)l({source:e.capture,final:_()})
else m({width:e.capture.width,height:e.capture.height,final:_()})}function queue(e,t){n(!u.had_3d_this_frame)
var r=false
if(e===W){r=true
e=Z.TRANSITION_FINAL}for(var a=0;a<F.length;++a){var i=F[a]
if(i.z===e)if(!s(i.capture))return false}var o=new GlovTransition(e,t)
F.push(o)
if(r)transitionCapture(o)
else c(e+Z.TRANSITION_RANGE,transitionCaptureFramebuffer.bind(null,o))
return true}function destroyTexture(e){profilerStart("transition:destroyTexture")
e.destroy()
profilerStop()}function render(e){e=M(e,100)
for(var t=0;t<F.length;++t){var r=F[t]
r.accum_time+=e
n(r.capture)
var a=t<F.length-1
if(r.func(r.z,r.capture,r.accum_time,a)===H){setTimeout(destroyTexture.bind(null,r.capture),0)
F.splice(t,1)
t--}}}function active(){return F.length}function glovTransitionFadeFunc(e,t,r,a,i){var o=M(a/e,1)
var n=1-f(o,2)
var s=v(1,1,1,n)
A.setNormalized()
w([r],0,0,0,1,1,1,1,0,t,0,1,1,0,s)
if(i||1===o)return H
return z}function glovTransitionWipeFunc(e,t,r,a,i,o){var n=M(i/e,1)
A.setNormalized()
var s=[[0,1],[1,0]]
var l=[{},{},{},{}]
for(var _=0;_<4;_++){var c=1===_||2===_?1:0
var u=_>=2?1:0
l[_].x=c
l[_].y=u}t-=b/2
while(t>b)t-=2*b
while(t<-b)t+=2*b
if(t>=-U&&t<=U){var d=2*n
var f=d-B(N(t))/k
if(t<0){l[0].x=f
l[3].x=d}else{l[0].x=d
l[3].x=f}l[1].x=l[2].x=2}else if(t>=G+U||t<=-G-U){var v=1-2*n
var h=v+B(N(t))/k
if(t<0){l[1].x=h
l[2].x=v}else{l[1].x=v
l[2].x=h}l[0].x=l[3].x=-1}else if(t>U&&t<=G+U){var p=2*n
var m=C(t)/k
var E=p-N(m)
if(m>0){l[0].y=p
l[1].y=E}else{l[0].y=E
l[1].y=p}l[2].y=l[3].y=2}else{var g=1-2*n
var T=C(t)/k
var y=g+N(T)
if(T>0){l[2].y=y
l[3].y=g}else{l[2].y=g
l[3].y=y}l[0].y=l[1].y=-1}l[0].u=S(l[0].x,s[0][0],s[1][0])
l[1].u=S(l[1].x,s[0][0],s[1][0])
l[2].u=S(l[2].x,s[0][0],s[1][0])
l[3].u=S(l[3].x,s[0][0],s[1][0])
l[0].v=S(l[0].y,s[0][1],s[1][1])
l[1].v=S(l[1].y,s[0][1],s[1][1])
l[2].v=S(l[2].y,s[0][1],s[1][1])
l[3].v=S(l[3].y,s[0][1],s[1][1])
L([a],l[0].x,l[0].y,I,l[0].u,l[0].v,l[3].x,l[3].y,I,l[3].u,l[3].v,l[2].x,l[2].y,I,l[2].u,l[2].v,l[1].x,l[1].y,I,l[1].u,l[1].v,r)
if(o||1===n)return H
return z}function glovTransitionSplitScreenFunc(e,t,r,a,i,o,n){var s=v(1,1,1,1)
var l=f(M(o/e,1),2)
A.setNormalized()
var _=[[0,1],[1,0]]
var c=l
var u=_[0][1]+(_[1][1]-_[0][1])/2
if(r){y([i],0,0,a,1-c,.5,0,_[0][1],_[1][0]*(1-l),u,I)
y([i],0+c,.5,a,1-c,.5,_[1][0]*l,u,_[1][0],_[1][1],I)}else{y([i],0-c,0,a,1,.5,_[0][0],_[0][1],_[1][0],u,I)
y([i],0+c,.5,a,1,.5,_[0][0],u,_[1][0],_[1][1],I)}var d=M(4*l,1)
s[3]=d
R.drawRect(0,.5-(t*=d),1-c,.5,a+1,s)
R.drawRect(1-c-t,0,1-c,.5,a+1,s)
R.drawRect(c,.5,1,.5+t,a+1,s)
R.drawRect(c,.5,c+t,1,a+1,s)
if(n||1===l)return H
return z}var Y=1
var j=[null]
function transitionPixelateCapture(){var e=p()
m({width:e.width,height:e.height,final:_()})
j[0]=e}function glovTransitionPixelateFunc(e,t,r,a,i){var o=u.width
var n=M(a/e,1)
A.setNormalized()
j[0]=r
if(n>.5)c(t,transitionPixelateCapture)
var s=D(2,x(2*(n>.5?1-n:n)*8.9))/1024*o*Y
var l=v(r.width/s,r.height/s,s/r.width,s/r.height)
var _=v(.5/r.width,.5/r.height,(r.texSizeX-1)/r.width,(r.texSizeY-1)/r.height)
y(j,0,0,t+1,1,1,0,1,1,0,I,getShader("transition_pixelate"),{param0:l,param1:_})
if(i||1===n)return H
return z}function fade(e){return glovTransitionFadeFunc.bind(null,e)}function wipe(e,t){return glovTransitionWipeFunc.bind(null,e,t)}function splitScreen(e,t,r){t/=A.w()
return glovTransitionSplitScreenFunc.bind(null,e,t,r)}function pixelate(e){return glovTransitionPixelateFunc.bind(null,e)}function randomTransition(e){e=e||1
switch(x(3*P())){case 0:return fade(500*e)
case 1:return splitScreen(250*e,2,false)
case 2:return pixelate(750*e)
case 3:return wipe(250*e,2*P()*b)
default:n(0)}return null}},{"../common/util":400,"../common/verify":401,"../common/vmath":402,"./camera2d":295,"./effects":304,"./engine":305,"./framebuffer":316,"./shaders":353,"./sprites":363,"./textures":365,"./ui":367,assert:void 0}],367:[function(e,t,s){"use strict"
s.makeColorSet=makeColorSet
s.colorSetMakeCustom=colorSetMakeCustom
s.addHook=addHook
s.suppressNewDOMElemWarnings=suppressNewDOMElemWarnings
s.getUIElemData=getUIElemData
s.setFontStyles=setFontStyles
s.uiFontStyleNormal=uiFontStyleNormal
s.uiFontStyleFocused=uiFontStyleFocused
s.uiFontStyleDisabled=uiFontStyleDisabled
s.uiFontStyleModal=uiFontStyleModal
s.uiTextHeight=uiTextHeight
s.uiButtonHeight=uiButtonHeight
s.uiButtonWidth=uiButtonWidth
s.uiGetTooltipPad=uiGetTooltipPad
s.uiGetTooltipPanelPixelScale=uiGetTooltipPanelPixelScale
s.uiGetFont=uiGetFont
s.uiGetTitleFont=uiGetTitleFont
s.uiSetButtonColorSet=uiSetButtonColorSet
s.uiGetButtonRolloverColor=uiGetButtonRolloverColor
s.buttonWasFocused=buttonWasFocused
s.buttonLastSpotRet=buttonLastSpotRet
s.colorSetSetShades=colorSetSetShades
s.uiGetFontStyleFocused=uiGetFontStyleFocused
s.uiSetFontStyleFocused=uiSetFontStyleFocused
s.uiSetPanelColor=uiSetPanelColor
s.uiGetPanelColor=uiGetPanelColor
s.loadUISprite=loadUISprite
s.loadUISprite2=loadUISprite2
s.setButtonsDefaultLabels=setButtonsDefaultLabels
s.setProvideUserStringDefaultMessages=setProvideUserStringDefaultMessages
s.uiGetDOMElem=uiGetDOMElem
s.uiGetDOMTabIndex=uiGetDOMTabIndex
s.uiBindSounds=uiBindSounds
s.drawHBox=drawHBox
s.drawVBox=drawVBox
s.drawBox=drawBox
s.drawMultiPartBox=drawMultiPartBox
s.playUISound=playUISound
s.focusCanvas=focusCanvas
s.uiHandlingNav=uiHandlingNav
s.panel=panel
s.drawTooltip=drawTooltip
s.drawTooltipBox=drawTooltipBox
s.progressBar=progressBar
s.buttonSetDefaultYOffs=buttonSetDefaultYOffs
s.buttonShared=buttonShared
s.buttonBackgroundDraw=buttonBackgroundDraw
s.buttonSpotBackgroundDraw=buttonSpotBackgroundDraw
s.buttonTextDraw=buttonTextDraw
s.buttonText=buttonText
s.buttonImage=buttonImage
s.button=button
s.print=print
s.label=label
s.modalDialog=modalDialog
s.modalDialogClear=modalDialogClear
s.modalTextEntry=modalTextEntry
s.createEditBox=createEditBox
s.isMenuUp=isMenuUp
s.menuUp=menuUp
s.copyTextToClipboard=copyTextToClipboard
s.provideUserString=provideUserString
s.drawRect=drawRect
s.drawRect2=drawRect2
s.drawRect4Color=drawRect4Color
s.drawElipse=drawElipse
s.drawCircle=drawCircle
s.drawHollowCircle=drawHollowCircle
s.drawLine=drawLine
s.drawHollowRect=drawHollowRect
s.drawHollowRect2=drawHollowRect2
s.drawCone=drawCone
s.setFontHeight=setFontHeight
s.setButtonHeight=setButtonHeight
s.scaleSizes=scaleSizes
s.setPanelPixelScale=setPanelPixelScale
s.setModalSizes=setModalSizes
s.setTooltipWidth=setTooltipWidth
s.setTooltipTextOffset=setTooltipTextOffset
s.button_last_color=s.menu_up=s.button_last_spot_ret=s.button_click=s.button_focused=s.button_mouseover=s.color_panel=s.title_font=s.font=s.tooltip_pad=s.tooltip_width=s.tooltip_panel_pixel_scale=s.panel_pixel_scale=s.modal_pad=s.modal_title_scale=s.modal_y0=s.modal_width=s.modal_button_width=s.sprites=s.internal=s.LINE_CAP_ROUND=s.LINE_CAP_SQUARE=s.LINE_ALIGN=s.Z_MIN_INC=s.Z=void 0
var r
function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]
for(var a in r)if(Object.prototype.hasOwnProperty.call(r,a))e[a]=r[a]}return e}).apply(this,arguments)}window.Z=window.Z||{}
var W=window.Z
s.Z=W
var m=1e-5
s.Z_MIN_INC=m
W.BORDERS=W.BORDERS||90
W.UI=W.UI||100
W.MODAL=W.MODAL||1e3
W.TOOLTIP=W.TOOLTIP||2e3
W.DEBUG=W.DEBUG||9800
W.TRANSITION_FINAL=W.TRANSITION_FINAL||9900
W.TRANSITION_RANGE=W.TRANSITION_RANGE||10
W.FPSMETER=W.FPSMETER||1e4
var Y=1
s.LINE_ALIGN=Y
var j=2
s.LINE_CAP_SQUARE=j
var K=4
s.LINE_CAP_ROUND=K
var a={checkHooks:checkHooks,cleanupDOMElems:cleanupDOMElems,uiEndFrame:uiEndFrame,uiSetFonts:uiSetFonts,uiStartup:uiStartup,uiTick:uiTick,uiApplyStyle:uiApplyStyle}
s.internal=a
var q={}
s.sprites=q
var I=e("assert")
var o=e("./autoatlas").autoAtlas
var Z=e("./camera2d.js")
var i=e("./edit_box.js"),n=i.editBoxCreate,l=i.editBoxTick
var _=e("./effects.js")
var c=_.effectsQueue
var X=e("./engine.js")
var Q=e("./font.js")
var A=Q.ALIGN,u=Q.fontSetDefaultSize,d=Q.fontStyle,f=Q.fontStyleColored
var H=e("./input.js")
var v=e("./link.js"),h=v.linkTick,p=v.linkObscureRect
var w=e("./localization.js").getStringFromLocalizable
var y=e("./markdown").markdownAuto
var $=Math.abs,E=Math.floor,S=Math.max,J=Math.min,ee=Math.round,te=Math.sqrt
var g=e("./scroll_area.js").scrollAreaSetPixelScale
var T=e("./slider.js").sliderSetDefaultShrink
var L=e("./sound.js"),O=L.soundLoad,R=L.soundPlay
var b=e("./spot.js"),N=b.SPOT_DEFAULT_BUTTON,C=b.SPOT_DEFAULT_BUTTON_DRAW_ONLY,x=b.SPOT_DEFAULT_LABEL,M=b.SPOT_STATE_REGULAR,D=b.SPOT_STATE_DOWN,P=b.SPOT_STATE_FOCUSED,B=b.SPOT_STATE_DISABLED,k=b.spot,U=b.spotEndOfFrame,G=b.spotKey,F=b.spotPadMode,z=b.spotPadSuppressed,V=b.spotTopOfFrame,re=b.spotUnfocus
var ae=e("./sprites.js"),ie=ae.BLEND_PREMULALPHA,oe=ae.spriteClipped,ne=ae.spriteClipPause,se=ae.spriteClipResume,le=ae.spriteChainedStart,_e=ae.spriteChainedStop,ce=ae.spriteCreate,ue=ae.spriteQueueRaw,de=ae.spriteQueueRaw4
var fe=e("./textures.js").TEXTURE_FORMAT
var ve=e("./uistyle.js"),he=ve.uiStyleDefault,pe=ve.uiStyleModify,me=ve.uiStyleTopOfFrame
var Ee=e("../common/util.js"),ge=Ee.clamp,Te=Ee.clone,ye=Ee.defaults,Se=Ee.deprecate,Ie=Ee.lerp,Ae=Ee.merge
var we=e("./mat43.js"),Le=we.mat43,Oe=we.m43identity,Re=we.m43mul
var be=e("../common/vmath.js"),Ne=be.vec2,Ce=be.vec4,xe=be.v4copy,Me=be.v3scale,De=be.unit_vec
Se(s,"slider_dragging","slider.js:sliderIsDragging()")
Se(s,"slider_rollover","slider.js:sliderIsFocused()")
Se(s,"setSliderDefaultShrink","slider.js:sliderSetDefaultShrink()")
Se(s,"slider","slider.js:slider()")
Se(s,"bindSounds","uiBindSounds")
Se(s,"modal_font_style","uiFontStyleModal()")
Se(s,"font_style_noraml","uiFontStyleNoraml()")
Se(s,"font_style_focused","uiFontStyleFocused()")
Se(s,"color_button","uiSetButtonColorSet()")
var Pe=.75
var Be
var ke
var Ue
var Ge={blur:[.125,.865],saturation:[.5,.1],brightness:[1,1-Pe],fallback_darken:Ce(0,0,0,Pe),z:W.MODAL}
var Fe=Ce(1,1,1,1)
var We=[]
function applyColorSet(e){Me(e.regular,e.color,Fe[0])
Me(e.rollover,e.color,Fe[1])
Me(e.down,e.color,Fe[2])
Me(e.disabled,e.color,Fe[3])}function makeColorSet(e){var t={color:e,regular:Ce(),rollover:Ce(),down:Ce(),disabled:Ce()}
for(var r in t)t[r][3]=e[3]
We.push(t)
applyColorSet(t)
return t}function colorSetMakeCustom(e,t,r,a){return{regular:e,rollover:t,down:r,disabled:a}}var He=[]
function addHook(e,t){He.push({draw:e,click:t})}var ze=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
var Ve=0
function suppressNewDOMElemWarnings(){Ve=X.frame_index+1}function uiElemAllocCheck(){if(X.DEBUG&&!X.resizing()&&X.frame_index>Ve){ze[X.frame_index%ze.length]=1
var e=0
for(var t=0;t<ze.length;++t)e+=ze[t]
I(e<ze.length,"Allocated new UI elements for too many consecutive frames")}}var Ye={}
function getUIElemData(e,t,r){var a=G(t)
var i=Ye[e]
if(!i)i=Ye[e]={}
var o=i[a]
if(!o){o=i[a]=r?r(t):{}
uiElemAllocCheck()}o.frame_index=X.frame_index
return o}function doBlurEffect(e){_.applyGaussianBlur({blur:e})}var je=Le()
var Ke=Le()
function doDesaturateEffect(e,t){Oe(je)
_.saturationMatrix(Ke,e)
Re(je,je,Ke)
_.brightnessScaleMatrix(Ke,t)
Re(je,je,Ke)
_.applyColorMatrix({colorMatrix:je})}var qe=100
s.modal_button_width=qe
var Ze=600
s.modal_width=Ze
var Xe=200
s.modal_y0=Xe
var Qe=1.2
s.modal_title_scale=Qe
var $e=16
s.modal_pad=$e
var Je=32/13
var et=s.panel_pixel_scale=Je
s.tooltip_panel_pixel_scale=et
var tt=400
s.tooltip_width=tt
var rt=8
s.tooltip_pad=rt
var at=0
var it
var ot
var nt
var st
function setFontStyles(e,t,r,a){it=e||f(null,255)
ot=t||d(it,{})
st=r||d(it,{})
nt=a||f(it,572662527)}setFontStyles()
function uiFontStyleNormal(){return it}function uiFontStyleFocused(){return ot}function uiFontStyleDisabled(){return st}function uiFontStyleModal(){return st}function uiTextHeight(){return Ue.text_height}function uiButtonHeight(){return Ue.button_height}function uiButtonWidth(){return Ue.button_width}function uiGetTooltipPad(){return rt}function uiGetTooltipPanelPixelScale(){return et}var lt
s.font=lt
var _t
s.title_font=_t
function uiGetFont(){return lt}function uiGetTitleFont(){return _t}var ct=makeColorSet([1,1,1,1])
function uiSetButtonColorSet(e){ct=e}function uiGetButtonRolloverColor(){return ct.rollover}var ut=Ce(1,1,.75,1)
s.color_panel=ut
var dt={}
var ft=false
s.button_mouseover=ft
var vt=false
s.button_focused=vt
var ht=null
s.button_click=ht
var pt=null
s.button_last_spot_ret=pt
function buttonWasFocused(){return vt}function buttonLastSpotRet(){return pt}var mt=null
var Et=false
s.menu_up=Et
var gt=Ae({},Ge)
var Tt=0
var yt=[]
var St=0
var It
var At
var wt={ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}
var Lt="Text copied to clipboard!"
var Ot="Copy to clipboard FAILED, please copy from below."
function colorSetSetShades(e,t,r){Fe[1]=e
Fe[2]=t
Fe[3]=r
for(var a=0;a<We.length;++a)applyColorSet(We[a])}function uiGetFontStyleFocused(){return ot}function uiSetFontStyleFocused(e){ot=e}function uiSetPanelColor(e){xe(ut,e)}function uiGetPanelColor(){return ut}function loadUISprite(e,t,r){var a=gl.CLAMP_TO_EDGE
var i=gl.CLAMP_TO_EDGE
q[e]=ce({name:"ui/"+e,ws:t,hs:r,wrap_s:a,wrap_t:i})}function loadUISprite2(e,t){if(null===t)return
if(t.atlas){q[e]=o(t.atlas,t.name||e)
return}var r=gl.CLAMP_TO_EDGE
var a=t.wrap_t?gl.REPEAT:gl.CLAMP_TO_EDGE
var i={ws:t.ws,hs:t.hs,wrap_s:r,wrap_t:a,layers:t.layers}
if(t.url)i.url=t.url
else i.name="ui/"+(t.name||e)
q[e]=ce(i)}function uiSetFonts(e,t){s.font=lt=e
s.title_font=_t=t||lt}function setButtonsDefaultLabels(e){for(var t in e)wt[t.toLowerCase()]=e[t]}function setProvideUserStringDefaultMessages(e,t){Lt=e
Ot=t}var Rt={color_set_shades:[1,1,1],white:{url:"white"},button:{atlas:"default"},button_rollover:{atlas:"default"},button_down:{atlas:"default"},button_disabled:{atlas:"default"},panel:{atlas:"default"},menu_entry:{atlas:"default"},menu_selected:{atlas:"default"},menu_down:{atlas:"default"},menu_header:{atlas:"default"},slider:{atlas:"default"},slider_handle:{atlas:"default"},scrollbar_bottom:{atlas:"default"},scrollbar_trough:{atlas:"default"},scrollbar_top:{atlas:"default"},scrollbar_handle_grabber:{atlas:"default"},scrollbar_handle:{atlas:"default"},progress_bar:{atlas:"default"},progress_bar_trough:{atlas:"default"},collapsagories:{atlas:"default"},collapsagories_rollover:{atlas:"default"},collapsagories_shadow_down:{atlas:"default"},collapsagories_shadow_up:null}
function uiStartup(e){s.font=lt=e.font
s.title_font=_t=e.title_font||lt
Be=H.KEYS
ke=H.PAD
var t=_extends({},Rt,e.ui_sprites)
for(var r in t){var a=t[r]
if("object"===typeof a&&!Array.isArray(a))loadUISprite2(r,a)}q.button_regular=q.button
if(t.color_set_shades)colorSetSetShades.apply(void 0,t.color_set_shades)
if(t.slider_params)T.apply(void 0,t.slider_params)
if(q.button_rollover&&1!==Fe[1])colorSetSetShades(1,Fe[2],Fe[3])
if(q.button_down&&1!==Fe[2])colorSetSetShades(Fe[1],1,Fe[3])
if(q.button_disabled&&1!==Fe[3])colorSetSetShades(Fe[1],Fe[2],1);(It={ok:{key:[Be.O],pad:[ke.X],low_key:[Be.ESC]},cancel:{key:[Be.ESC],pad:[ke.B,ke.Y]}}).yes=Te(It.ok)
It.yes.key.push(Be.Y)
It.no=Te(It.cancel)
It.no.key.push(Be.N)
if(void 0!==e.line_mode)At=e.line_mode
else At=Y|K
scaleSizes(1)}var bt
function uiGetDOMElem(e,t){if(isMenuUp()&&!t)return null
if(St>=yt.length||!e){var r=document.createElement("div")
uiElemAllocCheck()
r.setAttribute("class","glovui_dynamic")
if(!bt)bt=document.getElementById("dynamic_text")
bt.appendChild(r)
yt.push(r)
e=r}if(yt[St]!==e)for(var a=St+1;a<yt.length;++a)if(yt[a]===e){yt[a]=yt[St]
yt[St]=e}var i=yt[St]
St++
return i}var Nt=0
function uiGetDOMTabIndex(){return++Nt}var Ct={button_click:"button_click",rollover:"rollover"}
function uiBindSounds(e){for(var t in dt=ye(e||{},Ct))if(dt[t])O(dt[t],dt[t].opts)}var xt={nozoom:true}
function drawHBox(e,t,r){le()
var a=t.uidata
var i=e.x
var o=[a.wh[0]*e.h,0,(a.wh[2]||0)*e.h]
if(e.no_min_width&&o[0]+o[2]>e.w){var n=e.w/(o[0]+o[2])
o[0]*=n
o[2]*=n}else if(a.wh[1])o[1]=S(0,e.w-o[0]-o[2])
else o[0]=e.w
xt.y=e.y
xt.z=e.z
xt.h=e.h
xt.color=r
xt.color1=e.color1
xt.shader=null
for(var s=0;s<o.length;++s){var l=o[s]
if(l){xt.x=i
xt.w=l
xt.uvs=a.rects[s]
if(e.color1)t.drawDualTint(xt)
else t.draw(xt)}i+=l}_e()}function drawVBox(e,t,r){le()
var a=t.uidata
var i=[a.hw[0]*e.w,0,(a.hw[2]||0)*e.w]
var o=e.y
i[1]=S(0,e.h-i[0]-i[2])
xt.x=e.x
xt.z=e.z
xt.w=e.w
xt.color=r
xt.shader=null
for(var n=0;n<i.length;++n){var s=i[n]
xt.y=o
xt.h=s
xt.uvs=a.rects[n]
t.draw(xt)
o+=s}_e()}function drawBox(e,t,r,a,i){le()
var o=t.uidata
var n=r
var s=[o.widths[0]*n,0,o.widths[2]*n]
s[1]=S(0,e.w-s[0]-s[2])
var l=[o.heights[0]*n,0,o.heights[2]*n]
l[1]=S(0,e.h-l[0]-l[2])
var _=e.x
xt.z=e.z
xt.color=a
xt.shader=null
if(i)xt.color1=i
for(var c=0;c<s.length;++c){var u=s[c]
if(u){xt.x=_
xt.w=u
var d=e.y
for(var f=0;f<l.length;++f){var v=l[f]
if(v){xt.y=d
xt.h=v
xt.uvs=o.rects[3*f+c]
if(i)t.drawDualTint(xt)
else t.draw(xt)
d+=v}}_+=u}}_e()}function drawMultiPartBox(e,t,r,a,i){le()
var o=r.uidata
var n=a
var s=[]
var l=0
var _=0
for(var c=0;c<o.widths.length;c++)if(t.widths[c]<0){s.push(o.widths[c]*n)
l+=o.widths[c]*n}else{s.push(0)
_+=t.widths[c]}I(1===_)
for(var u=0;u<o.widths.length;u++)if(t.widths[u]>=0)s[u]=S(0,(e.w-l)*t.widths[u])
var d=[]
var f=_=0
for(var v=0;v<o.heights.length;v++)if(t.heights[v]<0){d.push(o.heights[v]*n)
f+=o.heights[v]*n}else{d.push(0)
_+=t.heights[v]}I(1===_)
for(var h=0;h<o.heights.length;h++)if(t.heights[h]>=0)d[h]=S(0,(e.h-f)*t.heights[h])
var p=e.x
for(var m=0;m<s.length;++m){var E=s[m]
if(E){var g=e.y
for(var T=0;T<d.length;++T){var y=d[T]
if(y){r.draw({x:p,y:g,z:e.z,color:i,w:E,h:y,uvs:o.rects[T*s.length+m],nozoom:true})
g+=y}}p+=E}}_e()}function playUISound(e,t){profilerStart("playUISound")
if("select"===e)e="button_click"
if(dt[e])R(dt[e],t)
profilerStop("playUISound")}function focusCanvas(){re()}function uiHandlingNav(){return Et||!z()}function panel(e){I("number"===typeof e.x)
I("number"===typeof e.y)
I("number"===typeof e.w)
I("number"===typeof e.h)
e.z=e.z||W.UI-1
e.eat_clicks=void 0===e.eat_clicks?true:e.eat_clicks
var t=e.color||ut
drawBox(e,e.sprite||q.panel,e.pixel_scale||Je,t)
if(e.eat_clicks){H.mouseOver(e)
p(e)}}function drawTooltip(e){var t=e.tooltip
if("function"===typeof t)if(!(t=t(e)))return
t=w(t)
I("number"===typeof e.x)
I("number"===typeof e.y)
I("string"===typeof t)
var r=oe()
if(r)ne()
var a=q.panel.uidata
var i=e.pixel_scale||et
var o=e.tooltip_width||tt
var n=e.z||W.TOOLTIP
var s=e.y
var l=e.tooltip_pad||(a.padh&&a.padh[0])*i||rt
var _=e.tooltip_pad||(a.padh&&a.padh[2])*i||rt
var c=e.tooltip_pad||(a.padv&&a.padv[0])*i||rt
var u=e.tooltip_pad||(a.padv&&a.padv[2])*i||rt
var d=o-l-_
var f=lt.dims(st,d,0,Ue.text_height,t)
var v=e.tooltip_above
if(!v&&e.tooltip_auto_above_offset)v=s+f.h+c+u>Z.y1()
var h=e.x
var p=f.w+l+_
var m=e.tooltip_right
var E=e.tooltip_center
if(m&&e.tooltip_auto_right_offset)h+=e.tooltip_auto_right_offset-p
else if(E&&e.tooltip_auto_right_offset)h+=(e.tooltip_auto_right_offset-p)/2
if(h+p>Z.x1())h=Z.x1()-p
if(v)s-=f.h+c+u+(e.tooltip_auto_above_offset||0)
var g=s+c
if(false===e.tooltip_markdown)g+=lt.drawSizedWrapped(st,h+l,g+at,n+1,d,0,Ue.text_height,t)
else{var T=y({font_style:st,x:h+l,y:g+at,z:n+1,w:d,align:A.HWRAP,text_height:Ue.text_height,text:t})
p=S(T.w+l+_,p)
g+=T.h}panel({x:h,y:s,z:n,w:p,h:(g+=u)-s,pixel_scale:i,eat_clicks:false})
if(r)se()}function checkHooks(e,t){if(e.hook)for(var r=0;r<He.length;++r){if(t)He[r].click(e)
He[r].draw(e)}}function drawTooltipBox(e){var t=e.tooltip
if("function"===typeof t)if(!(t=t(e)))return
drawTooltip({x:e.x,y:e.y+e.h+2,tooltip_auto_above_offset:e.h+4,tooltip_above:e.tooltip_above,tooltip_auto_right_offset:e.w,tooltip_right:e.tooltip_right,tooltip_center:e.tooltip_center,tooltip:t,tooltip_width:e.tooltip_width,tooltip_markdown:e.tooltip_markdown})}function progressBar(e){drawHBox(e,q.progress_bar_trough,e.color_trough||e.color||De)
var t=ge(e.progress,0,1)
drawHBox({x:e.x+(e.centered?e.w*(1-t)*.5:0),y:e.y,z:(e.z||W.UI)+m,w:e.w*t,h:e.h,no_min_width:true},q.progress_bar,e.color||De)
if(e.tooltip)k({x:e.x,y:e.y,w:e.w,h:e.h,tooltip:e.tooltip,def:x})}var Mt={regular:0,down:0,rollover:0,disabled:0}
function buttonSetDefaultYOffs(e){Ae(Mt,e)}var Dt=((r={})[M]="regular",r[D]="down",r[P]="rollover",r[B]="disabled",r)
var Pt=_extends({},N,{disabled:true,disabled_focusable:false,sound_rollover:null})
function buttonShared(e){profilerStart("buttonShared")
e.z=e.z||W.UI
if(e.rollover_quiet)e.sound_rollover=null
var t
if(e.draw_only&&!e.draw_only_mouseover)t={ret:false,state:"regular",focused:false}
else{if(e.draw_only){I(!e.def||e.def===C)
e.def=C}else if(e.disabled&&!e.disabled_focusable)e.def=e.def||Pt
else e.def=e.def||N
if(e.sound)e.sound_button=e.sound;(t=k(e)).state=Dt[t.spot_state]
if(t.ret){s.button_click=ht=t
ht.was_double_click=t.double_click}}s.button_focused=vt=s.button_mouseover=ft=t.focused
e.z+=e.z_bias&&e.z_bias[t.state]||0
s.button_last_spot_ret=pt=t
profilerStop("buttonShared")
return t}var Bt
s.button_last_color=Bt
function buttonBackgroundDraw(e,t){profilerStart("buttonBackgroundDraw")
var r=e.colors||ct
var a=s.button_last_color=Bt=e.color||r[t]
if(!e.no_bg){var i=e.base_name||(e.w/e.h<1.5&&q.squarebutton?"squarebutton":"button")
var o=q[i+"_"+t]
if(!o)o=q[i]
if(9===o.uidata.rects.length)drawBox(e,o,e.pixel_scale||1,a)
else drawHBox(e,o,a)}profilerStop("buttonBackgroundDraw")}function buttonSpotBackgroundDraw(e,t){profilerStart("buttonSpotBackgroundDraw")
var r=Dt[t]
var a=e.colors||ct
var i=s.button_last_color=Bt=e.color||a[r]
if(!e.no_bg){var o=e.base_name||"button"
var n=q[o+"_"+r]
if(!n)n=q[o]
drawHBox(e,n,i)}profilerStop("buttonSpotBackgroundDraw")}function buttonTextDraw(e,t,r){profilerStart("buttonTextDraw")
buttonBackgroundDraw(e,t)
var a=J(.25*e.font_height,.1*e.w)
var i=e.yoffs&&void 0!==e.yoffs[t]?e.yoffs[t]:Mt[t]
var o="disabled"===t;(e.font||lt).drawSizedAligned(o?e.font_style_disabled||nt:r?e.font_style_focused||ot:e.font_style_normal||it,e.x+a,e.y+i,e.z+.1,e.font_height,e.align||Q.ALIGN.HVCENTERFIT,e.w-2*a,e.h,e.text)
profilerStop("buttonTextDraw")}function buttonText(e){profilerStart("buttonText")
e.text=w(e.text)
I("number"===typeof e.x)
I("number"===typeof e.y)
I("string"===typeof e.text)
e.w=e.w||Ue.button_width
e.h=e.h||Ue.button_height
e.font_height=e.font_height||(e.style||Ue).text_height
var t=buttonShared(e)
var r=t.ret
buttonTextDraw(e,t.state,t.focused)
profilerStop("buttonText")
return r?t:null}function buttonImageDraw(e,t,r){profilerStart("buttonImageDraw")
var a=e.img_rect
var i=e.imgs&&e.imgs[t]||e.img
if("number"===typeof e.frame)a=i.uidata.rects[e.frame]
buttonBackgroundDraw(e,t)
var o=Bt
var n=i.origin
var s=i.size[0]
var l=i.size[1]
var _=s/l
if("number"===typeof e.frame)_=i.uidata.aspect?i.uidata.aspect[e.frame]:1
var c=e.w*e.shrink
var u=e.h*e.shrink*_
s=J(c,u)
var d=e.yoffs&&void 0!==e.yoffs[t]?e.yoffs[t]:Mt[t]
var f=(e.h-(l=s/_))/2
var v={x:e.x+(e.left_align?f:(e.w-s)/2)+n[0]*s,y:e.y+f+n[1]*l+d,z:e.z+(e.z_inc||m),color:e.img_color||e.color1&&e.color||o,color1:e.color1,w:s/i.size[0],h:l/i.size[1],uvs:a,rot:e.rotation}
if(e.flip){var h=v.x,p=v.w
v.x=h+p
v.w=-p}if(e.color1)i.drawDualTint(v)
else i.draw(v)
profilerStop("buttonImageDraw")}function buttonImage(e){profilerStart("buttonImage")
I("number"===typeof e.x)
I("number"===typeof e.y)
I(e.imgs||e.img&&e.img.draw)
e.z=e.z||W.UI
e.w=e.w||Ue.button_height
e.h=e.h||e.w||Ue.button_height
e.shrink=e.shrink||.75
var t=buttonShared(e)
var r=t.ret
buttonImageDraw(e,t.state,t.focused)
profilerStop("buttonImage")
return r?t:null}function button(e){if(e.img&&!e.text)return buttonImage(e)
else if(e.text&&!e.img)return buttonText(e)
profilerStart("button")
I("number"===typeof e.x)
I("number"===typeof e.y)
I(e.img&&e.img.draw)
e.z=e.z||W.UI
e.h=e.h||Ue.button_height
e.w=e.w||Ue.button_width
e.shrink=e.shrink||.75
e.left_align=true
e.font_height=e.font_height||(e.style||Ue).text_height
var t=buttonShared(e)
var r=t.ret,a=t.state,i=t.focused
buttonImageDraw(e,a,i)
var o=e.no_bg
var n=e.w
var s=e.x
e.no_bg=true
e.x+=e.h*e.shrink
e.w-=e.h*e.shrink
buttonTextDraw(e,a,i)
e.no_bg=o
e.w=n
e.x=s
profilerStop("button")
return r?t:null}function print(e,t,r,a,i){return lt.drawSized(e,t,r,a,Ue.text_height,i)}function label(e){profilerStart("label")
var t=e.font_style,r=e.font_style_focused,a=e.x,i=e.y,o=e.align,n=e.w,s=e.h,l=e.text,_=e.tooltip,c=e.tooltip_markdown,u=e.tooltip_above,d=e.tooltip_right,f=e.img,v=e.frame,h=e.img_color,p=e.img_color_focused
if(e.style)I(!e.style.color)
var m=e.z||W.UI
I(isFinite(a))
I(isFinite(i))
var E=e.style||Ue
var g=e.font||lt
var T=e.size||E.text_height
if(f);else{I(void 0!==l)
l=w(l)
if(_){if(!n){n=g.getStringWidth(t,T,l)
if(o&A.HRIGHT)a-=n
else if(o&A.HCENTER)a-=n/2}if(!s){s=T
if(o&A.VBOTTOM)i-=s
else if(o&A.VCENTER)i-=s/2}}}if(_){I(isFinite(n))
I(isFinite(s))
if(k({x:a,y:i,w:n,h:s,tooltip:_,tooltip_markdown:c,tooltip_width:e.tooltip_width,tooltip_above:u,tooltip_right:d||e.align&A.HRIGHT,tooltip_center:e.align&A.HCENTER,def:x}).focused&&F()){var y=false
if(f)if(p)h=p
else y=true
else if(r)t=r
else y=true
if(y)drawElipse(a-.25*n,i-.25*s,a+1.25*n,i+1.25*s,m-.001,.5,De)}}var S=0
if(f)f.draw({x:a,y:i,z:m,w:n,h:s,color:h,frame:v})
else if(l)if(o)S=g.drawSizedAligned(t,a,i,m,T,o,n,s,l)
else S=g.drawSized(t,a,i,m,T,l)
profilerStop("label")
return n||S}function modalDialog(e){e.title=w(e.title)
e.text=""+(w(e.text)||"")
I(!e.title||"string"===typeof e.title)
I(!e.text||"string"===typeof e.text)
I(!e.buttons||"object"===typeof e.buttons)
if(e.buttons)for(var t in e.buttons)if("object"!==typeof e.buttons[t])e.buttons[t]={cb:e.buttons[t]}
mt=e}function modalDialogClear(){mt=null}var kt=Ne(24,24)
var Ut=Ne()
function modalDialogRun(){Z.domDeltaToVirtual(Ut,kt)
var e=false
var t=mt.font_height||(mt.style||Ue).text_height
var r=Ue.button_height
var a=$e
var i=.5*$e
var o=1
var n=true
var s
if(!mt.no_fullscreen_zoom&&Ut[0]>.05*Z.h()&&Z.w()>2*Z.h()){e=true
r=t
i=a=4
var l=Z.h()
Z.push()
for(s=1;;s++){Z.setAspectFixed2(1,t*(Qe+1+s)+4.5*a)
o=Z.h()/l
if(!mt.text)break
var _=Z.x1()-Z.x0()-2*a
if(lt.numLines(st,_,0,t,mt.text)<=s)break}}var c=mt,u=c.buttons,d=c.click_anywhere
var f=Object.keys(u||{})
var v=Z.x1()-Z.x0()
var h=e?v:mt.width||Ze
var p=mt.button_width||qe
p=J(p,2*h/3/f.length)
var m=h-2*a
var E=Z.x0()+ee((v-h)/2)
var g=E+a
var T=e?0:mt.y0||Xe
var y=ee(T+a)
if(mt.title){if(e){_t.drawSizedAligned(st,g,y,W.MODAL,t*Qe,Q.ALIGN.HFIT,m,0,mt.title)
y+=t*Qe}else y+=_t.drawSizedWrapped(st,g,y,W.MODAL,m,0,t*Qe,mt.title)
y=ee(y+1.5*i)}if(mt.text||e){if(e){if(mt.text)lt.drawSizedAligned(st,g,y,W.MODAL,t,Q.ALIGN.HWRAP,m,0,mt.text)
y+=t*s}else y+=lt.drawSizedWrapped(st,g,y,W.MODAL,m,0,t,mt.text)
y=ee(y+i)}var S=mt.color||null
var I
if(mt.tick){var A=h-2*a
if(e)A-=(a+p)*f.length
var w={x0:E,y0:T,x:g,y:y,modal_width:h,avail_width:A,font_height:t,fullscreen_mode:e}
I=mt.tick(w)
y=w.y}g=E+h-(a+p)*f.length
var L=-1
for(var O=0;O<f.length;++O){var R=f[O]
var b=R.toLowerCase()
var N=u[R]=u[R]||{}
var C=It[b]
var x=0
if(C){for(var M=0;M<C.key.length;++M){x+=H.keyUpEdge(C.key[M],N.in_event_cb)
if(C.key[M]===I)x++}for(var D=0;D<C.pad.length;++D)x+=H.padButtonUpEdge(C.pad[D])}if(d&&0===O&&H.click())++x
if(x)L=O
var P=N.label||wt[b]||R
if(button(ye({key:"md_"+R,x:g,y:y,z:W.MODAL,w:p,h:r,text:P,auto_focus:0===O,focus_steal:1===f.length&&!mt.tick},N)))L=O
g=ee(g+a+p)}if(-1===L)for(var B=0;B<f.length;++B){var k=f[B]
var U=It[k.toLowerCase()]
if(U&&U.low_key)for(var G=0;G<U.low_key.length;++G)if(H.keyUpEdge(U.low_key[G],u[k].in_event_cb)||U.low_key[G]===I)L=B}if(-1!==L){var F=f[L]
playUISound("button_click")
mt=null
if(u[F].cb)u[F].cb()
n=false}if(f.length>0)y+=r
y=ee(y+i+a)
panel({x:E,y:T,z:W.MODAL-1,w:h,h:(e?Z.y1():y)-T,pixel_scale:Je*o,color:S})
if(H.pointerLocked()&&n)H.pointerLockExit()
H.eatAllInput()
if(e)Z.pop()}function modalTextEntry(a){var i=n({initial_focus:true,spellcheck:false,initial_select:true,text:a.edit_text,multiline:a.multiline,enforce_multiline:a.enforce_multiline,max_len:a.max_len,max_visual_size:a.max_visual_size,esc_clears:false})
var e={}
for(var t in a.buttons){var r=a.buttons[t]
if(null!==r&&"object"===typeof r&&"cb"in r)r=a.buttons[t].cb
if("function"===typeof r)r=function(e){return function(){e(i.getText())}}(r)
e[t]=ye({cb:r},a.buttons[t])}a.buttons=e
a.text=""+(a.text||"")
var o=a.tick
a.tick=function(e){var t=i.run({x:e.x,y:e.y,w:e.avail_width||a.edit_w,font_height:e.font_height})
if(!e.fullscreen_mode)e.y+=e.font_height*(a.multiline||1)+$e
var r
if(t===i.SUBMIT)r=Be.O
else if(t===i.CANCEL)r=Be.ESC
if(o)r=o(e)||r
return r}
modalDialog(a)}function createEditBox(e){return n(e)}var Gt=0
function isMenuUp(){return mt||Et}function releaseOldUIElemData(){for(var e in Ye){var t=Ye[e]
var r=false
for(var a in t)if(t[a].frame_index<X.frame_index-1)delete t[a]
else r=true
if(!r)delete Ye[e]}}function uiTick(e){ze[X.frame_index%ze.length]=0
releaseOldUIElemData()
l()
h()
Nt=St=0
var t=false
if(mt||Et){var r=gt
if(!Et)r=Ge
Tt+=e
if(X.postprocessing&&!X.defines.NOPP){var a=J(Tt/500,1)
if(a<1)X.renderNeeded()
var i=Ie(a,r.blur[0],r.blur[1])
if(i)c(r.z-2,doBlurEffect.bind(null,i))
var o=Ie(a,r.saturation[0],r.saturation[1])
var n=Ie(a,r.brightness[0],r.brightness[1])
if(1!==o||1!==n)c(r.z-1,doDesaturateEffect.bind(null,o,n))
t=true}else q.white.draw({x:Z.x0Real(),y:Z.y0Real(),z:r.z-2,color:r.fallback_darken,w:Z.wReal(),h:Z.hReal()})}else Tt=0
s.menu_up=Et=false
if(!X.is_loading&&X.getFrameDtActual()>50&&t){if((Gt=(Gt||0)+1)>=6)X.postprocessingAllow(false)}else if(Gt)Gt=0
V()
me()
if(mt)modalDialogRun()}function uiEndFrame(){U()
if(H.click({x:-Infinity,y:-Infinity,w:Infinity,h:Infinity}))re()
while(St<yt.length){var e=yt.pop()
bt.removeChild(e)}}function cleanupDOMElems(){while(yt.length){var e=yt.pop()
bt.removeChild(e)}}function menuUp(e){Ae(gt,Ge)
if(e)Ae(gt,e)
s.menu_up=Et=true
H.eatAllInput()}function copyTextToClipboard(e){var t=document.createElement("textarea")
t.style.position="fixed"
t.style.top=0
t.style.left=0
t.style.width="2em"
t.style.height="2em"
t.style.border="none"
t.style.outline="none"
t.style.boxShadow="none"
t.style.background="transparent"
t.value=e
document.body.appendChild(t)
t.focus()
t.select()
var r=false
try{r=document.execCommand("copy")}catch(e){}document.body.removeChild(t)
return r}function provideUserString(e,t,r){var a=copyTextToClipboard(t)
modalTextEntry({edit_w:400,edit_text:t.replace(/[\n\r]/g," "),title:e,text:a?Lt:Ot,buttons:_extends({},r||{},{ok:null})})}var Ft={}
function drawRect(e,t,r,a,i,o){var n=J(e,r)
var s=J(t,a)
var l=S(e,r)
var _=S(t,a)
Ft.x=n
Ft.y=s
Ft.z=i
Ft.w=l-n
Ft.h=_-s
Ft.color=o
return q.white.draw(Ft)}function drawRect2(e){return q.white.draw(e)}var Wt={}
function drawRect4Color(e,t,r,a,i,o,n,s,l){var _=J(e,r)
var c=J(t,a)
var u=S(e,r)
var d=S(t,a)
Wt.x=_
Wt.y=c
Wt.z=i
Wt.w=u-_
Wt.h=d-c
Wt.color_ul=o
Wt.color_ll=s
Wt.color_lr=l
Wt.color_ur=n
return q.white.draw4Color(Wt)}function spreadTechParams(e){e=J(S(e,0),.99)
var t={param0:Ce(0,0,0,0)}
t.param0[0]=1/(1-e)
t.param0[1]=-.5*t.param0[0]+.5
return t}var Ht=Ce()
function premulAlphaColor(e){Ht[0]=e[0]*e[3]
Ht[1]=e[1]*e[3]
Ht[2]=e[2]*e[3]
Ht[3]=e[3]
return Ht}function drawElipseInternal(e,t,r,a,i,o,n,s,l,_,c,u,d){if(!d&&!X.defines.NOPREMUL){d=ie
u=premulAlphaColor(u)}ue(e.texs,t,r,o,a-t,i-r,s,l,_,c,u,Q.font_shaders.font_aa,spreadTechParams(n),d)}function drawCircleInternal(e,t,r,a,i,o,n,s,l,_,c,u){drawElipseInternal(e,t-2*i+4*i*n,r-2*i+4*i*s,t-2*i+4*i*l,r-2*i+4*i*_,a,o,n,s,l,_,c,u)}function initCircleSprite(){var e=32
var t=new Uint8Array(e*e)
var r=(e-1)/2
for(var a=0;a<e;a++)for(var i=0;i<e;i++){var o=te((a-r)*(a-r)+(i-r)*(i-r))/r
var n=ge(1-o,0,1)
t[a+i*e]=255*n}q.circle=ce({url:"circle",width:e,height:e,format:fe.R8,data:t,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:Ne(.5,.5)})}function drawElipse(e,t,r,a,i,o,n,s){if(!q.circle)initCircleSprite()
drawElipseInternal(q.circle,e,t,r,a,i,o,0,0,1,1,n,s)}function drawCircle(e,t,r,a,i,o,n){if(!q.circle)initCircleSprite()
drawCircleInternal(q.circle,e,t,r,a,i,0,0,1,1,o,n)}function drawHollowCircle(e,t,r,a,i,o,n){if(!q.hollow_circle){var s=128
var l=2
var _=new Uint8Array(s*s)
var c=(s-1)/2
for(var u=0;u<s;u++)for(var d=0;d<s;d++){var f=te((u-c)*(u-c)+(d-c)*(d-c))/c
var v=ge(1-f,0,1)
if(v>.5)v=1-v
v+=l/s
_[u+d*s]=255*v}q.hollow_circle=ce({url:"hollow_circle",width:s,height:s,format:fe.R8,data:_,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:Ne(.5,.5)})}drawCircleInternal(q.hollow_circle,e,t,r,a,i,0,0,1,1,o,n)}var zt=16
var Vt=16
var Yt=E((Vt-1)/2)
var jt=.5/Vt
var Kt=1-1.5/Vt
var qt=.5/zt
var Zt=(Yt+.5)/zt
var Xt=1-Zt
var Qt=1-.5/zt
var $t={param0:[0,0]}
function drawLine(e,t,r,a,i,o,n,s,l){if(void 0===l)l=At
var _
if(!X.defines.NOPREMUL){_=ie
s=premulAlphaColor(s)}var c=l&K?"line3":"line2"
if(!q[c]){var u=new Uint8Array(zt*Vt)
var d=Yt
var f=zt-1-Yt
if("line2"===c)for(var v=0;v<Vt;v++){var h=$((v-Yt)/Yt)
var p=ee(255*ge(1-h,0,1))
for(var m=0;m<zt;m++){var E=ee(255*ge(h=m<d?m/Yt:m>=f?1-(m-f)/Yt:1,0,1))
u[m+v*zt]=J(E,p)}}else for(var g=0;g<Vt;g++){var T=$((g-Yt)/Yt)
for(var y=0;y<zt;y++){var S=y<d?1-y/Yt:y>=f?(y-f)/Yt:0
var I=te(S*S+T*T)
I=ge(1-I,0,1)
u[y+g*zt]=ee(255*I)}}q[c]=ce({url:c,width:zt,height:Vt,format:fe.R8,data:u,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE})}var A=q[c].texs
var w=.5*(Z.data[4]+Z.data[5])
var L=o*w
var O=L+4
var R=.5*O
var b=R*(1/w)
var N=r-e
var C=a-t
var x=te(N*N+C*C)
var M=-(C/=x)*b
var D=(N/=x)*b
if(l&Y){var P=(t-Z.data[1])*Z.data[5]
var B=(ee(P-R)+R-P)/Z.data[5]
t+=B
a+=B
var k=(e-Z.data[0])*Z.data[4]
var U=(ee(k-R)+R-k)/Z.data[4]
e+=U
r+=U}var G=1-(L+1)/O
var F=1/(1+n*(G+2/O-1)-G)
var W=-G*F
var H
if($t.param0[0]!==F||$t.param0[1]!==W)$t={param0:[F,W]}
H=$t
de(A,r+M,a+D,r-M,a-D,e-M,t-D,e+M,t+D,i,Zt,jt,Xt,Kt,s,Q.font_shaders.font_aa,H,_)
if(l&(K|j)){var z=N*o/2
var V=C*o/2
de(A,r-M,a-D,r+M,a+D,r+M+z,a+D+V,r-M+z,a-D+V,i,Xt,Kt,Qt,jt,s,Q.font_shaders.font_aa,H,_)
de(A,e-M,t-D,e+M,t+D,e+M-z,t+D-V,e-M-z,t-D-V,i,Zt,Kt,qt,jt,s,Q.font_shaders.font_aa,H,_)}}function drawHollowRect(e,t,r,a,i,o,n,s,l){drawLine(e,t,r,t,i,o,n,s,l)
drawLine(r,t,r,a,i,o,n,s,l)
drawLine(r,a,e,a,i,o,n,s,l)
drawLine(e,a,e,t,i,o,n,s,l)}function drawHollowRect2(e){drawHollowRect(e.x,e.y,e.x+e.w,e.y+e.h,e.z||W.UI,e.line_width||1,e.precise||1,e.color||De)}function drawCone(e,t,r,a,i,o,n,s,l){var _
if(!X.defines.NOPREMUL){_=ie
l=premulAlphaColor(l)}if(!q.cone){var c=32
var u=new Uint8Array(c*c)
var d=(c-1)/2
for(var f=0;f<c;f++)for(var v=0;v<c;v++){var h=0
var p=0
var m=0
if(f>d){h=(f-d)/d
p=$(v-d)/d
m=h*te(h*h+p*p)}var E=ge(1-m,0,1)
u[f+v*c]=255*E}q.cone=ce({url:"cone",width:c,height:c,format:fe.R8,data:u,filter_min:gl.LINEAR,filter_mag:gl.LINEAR,wrap_s:gl.CLAMP_TO_EDGE,wrap_t:gl.CLAMP_TO_EDGE,origin:Ne(.5,.5)})}var g=r-e
var T=a-t
var y=te(g*g+T*T)
var S=-(T/=y)
var I=g/=y
de(q.cone.texs,e-S*o,t-I*o,e+S*o,t+I*o,r+S*n,a+I*n,r-S*n,a-I*n,i,0,0,1,1,l,Q.font_shaders.font_aa,spreadTechParams(s),_)}function setFontHeight(e){pe(he(),{text_height:e})}function uiApplyStyle(e){Ue=e
s.font_height=e.text_height
s.button_width=e.button_width
s.button_height=e.button_height
u(e.text_height)}function setButtonHeight(e){s.panel_pixel_scale=Je=e/q.panel.uidata.total_h
g(e/q.button.uidata.total_h)
pe(he(),{button_height:e})}function scaleSizes(e){var t=ee(24*e)
var r=ee(200*e)
s.modal_button_width=qe=ee(r/2)
s.modal_width=Ze=ee(600*e)
s.modal_y0=Xe=ee(200*e)
s.modal_title_scale=Qe=1.2
s.modal_pad=$e=ee(16*e)
s.tooltip_width=tt=ee(400*e)
s.tooltip_pad=rt=ee(8*e)
pe(he(),{text_height:t,button_width:r})
setButtonHeight(ee(32*e))
s.tooltip_panel_pixel_scale=et=Je}function setPanelPixelScale(e){s.tooltip_panel_pixel_scale=et=s.panel_pixel_scale=Je=e}function setModalSizes(e,t,r,a,i){s.modal_button_width=qe=e||ee(Ue.button_width/2)
s.modal_width=Ze=t||600
s.modal_y0=Xe=r||200
s.modal_title_scale=Qe=a||1.2
s.modal_pad=$e=i||$e}function setTooltipWidth(e,t){s.tooltip_width=tt=e
s.tooltip_panel_pixel_scale=et=t
s.tooltip_pad=rt=ee($e/2*t)}function setTooltipTextOffset(e){at=e}},{"../common/util.js":400,"../common/vmath.js":402,"./autoatlas":291,"./camera2d.js":295,"./edit_box.js":303,"./effects.js":304,"./engine.js":305,"./font.js":315,"./input.js":326,"./link.js":328,"./localization.js":330,"./markdown":332,"./mat43.js":335,"./scroll_area.js":349,"./slider.js":355,"./sound.js":358,"./spot.js":361,"./sprites.js":363,"./textures.js":365,"./uistyle.js":368,assert:void 0}],368:[function(e,t,r){"use strict"
r.uiStyleModify=uiStyleModify
r.uiStyleAlloc=uiStyleAlloc
r.uiStyleDefault=uiStyleDefault
r.uiStyleCurrent=uiStyleCurrent
r.uiStyleSetCurrent=uiStyleSetCurrent
r.uiStylePush=uiStylePush
r.uiStylePop=uiStylePop
r.uiStyleTopOfFrame=uiStyleTopOfFrame
var d=e("assert")
var _=e("../common/util").tail
var a=e("../common/verify")
var c=e("./ui").internal.uiApplyStyle
var i={text_height:24,button_width:200,button_height:32}
var o
var u
var s=function UIStyleImpl(e){this.id_chain=void 0
this.text_height=void 0
this.button_width=void 0
this.button_height=void 0
this.id_chain=e}
var f=Object.create(null)
var l=0
f.default={def:i,deps:[]}
function uiStyleCompute(e){var t=e.id_chain
var r
var a
var i
for(var o=0;o<t.length;++o){var n=t[o]
var s=f[n]
d(s)
var l=s.def.text_height
if(void 0!==l)if("string"===typeof l){var _=l.match(/^(\d+)%$/)
d(_)
r*=Number(_[1])/100}else{d.equal(typeof l,"number")
r=l}if(void 0!==(l=s.def.button_width))if("string"===typeof l){var c=l.match(/^(\d+)%$/)
d(c)
a*=Number(c[1])/100}else{d.equal(typeof l,"number")
a=l}if(void 0!==(l=s.def.button_height))if("string"===typeof l){var u=l.match(/^(\d+)%$/)
d(u)
i*=Number(u[1])/100}else{d.equal(typeof l,"number")
i=l}if(0===o){d("number"===typeof r)
d("number"===typeof a)
d("number"===typeof i)}}e.text_height=r
e.button_width=a
e.button_height=i}function uiStyleModify(e,t){var r=_(e.id_chain)
d(r)
var a=f[r]
d(a)
var i=a.def
for(var o in t){var n=t[o]
if(void 0===n)delete i[o]
else i[o]=n}for(var s=0;s<a.deps.length;++s){var l=a.deps[s]
uiStyleCompute(l)
if(l===u)c(u)}}function uiStyleAlloc(){var e=[]
e.push("default")
for(var t=0;t<arguments.length;++t){var r=t<0||arguments.length<=t?void 0:arguments[t]
var a=void 0
if("string"===typeof r)d(f[a=r])
else{a="$"+ ++l+")"
f[a]={def:r,deps:[]}}e.push(a)}var i=new s(e)
uiStyleCompute(i)
for(var o=0;o<e.length;++o){var n=e[o]
f[n].deps.push(i)}return i}function uiStyleDefault(){return o}function uiStyleCurrent(){return u}function uiStyleSetCurrent(e){c(u=e)}uiStyleSetCurrent(o=uiStyleAlloc())
var n=[]
function uiStylePush(e){n.push(u)
uiStyleSetCurrent(e)}function uiStylePop(){var e=n.pop()
d(e)
uiStyleSetCurrent(e)}var v=false
function uiStyleTopOfFrame(){if(n.length){if(!v){v=true
a(!n.length,"Style stack push/pop mismatch")}n.length=0}}},{"../common/util":400,"../common/verify":401,"./ui":367,assert:void 0}],369:[function(e,t,r){"use strict"
r.getURLBase=getURLBase
r.getURLPageBase=getURLPageBase
r.getLinkURL=getLinkURL
r.onChange=onChange
r.refreshTitle=refreshTitle
r.onURLChange=onURLChange
r.historyDeferUpdate=historyDeferUpdate
r.startup=startup
r.urlhashFireInitialChanges=urlhashFireInitialChanges
r.route=route
r.routeFixed=routeFixed
r.register=register
r.set=set
r.setMulti=setMulti
r.get=get
r.getRouteString=getRouteString
r.go=go
r.goRoute=goRoute
r.TYPE_STRING=r.TYPE_SET=void 0
var _=e("assert")
var p=e("../common/util.js").callEach
var a=1e3
var E="set"
r.TYPE_SET=E
var i="string"
r.TYPE_STRING=i
var g={}
var T
var o=(document.location.href||"").match(/^[^#?]+/)[0]
var n=o.replace(/[^/]*$/,"")
if(n.endsWith("/a/"))n=n.slice(0,-2)
var m=[]
function getURLBase(){return n}function getURLPageBase(){return o}function getLinkURL(e){var t=""
if(!o.endsWith("/")&&e&&!e.startsWith("?"))t="?"
var r=""+o+t+e
if(r.endsWith("?"))r=r.slice(0,-1)
return r}function onChange(e){m.push(e)}function cmpNumKeys(e,t){var r=t.keys.length-e.keys.length
if(r)return r
for(var a=0;a<e.keys.length;++a)if(e.keys[a]<t.keys[a])return-1
else if(e.keys[a]>t.keys[a])return 1
_(false)
return 0}var y=/:(\w+)/g
var S=[]
function queryString(){var e=String(document.location)
if((e=e.slice(o.length)).includes("#"))e=e.slice(0,e.indexOf("#"))
return e}var c=/[^\w]\w+=([^&]+)/
function getValue(e,t){if(t.routes)for(var r=0;r<t.routes.length;++r){var a=t.routes[r]
var i=e.match(a.regex)
if(i){if(a.value)return a.value
return i[1+a.keys.indexOf(t.key)]}}var o=e.match(t.regex)||[]
if(t.type===E){var n={}
for(var s=0;s<o.length;++s){var l=o[s].match(c)
_(l)
n[l[1]]=1}return n}else return o[1]||t.def}var s=null
function goInternal(e,t,r,a){var i={}
for(var o in g){var n=g[o]
if(n.hides)if(t?n.value:getValue(e,n))for(var s in n.hides)i[s]=1}var l={}
for(var _ in g){if(i[_])continue
var c=g[_]
var u=t?c.value:getValue(e,c)
if(c.type===E){for(var d in u)if(!c.value[d]||t){c.value[d]=1
l[_]=true}if(a&&!(c.routes||c.clear_on_route_change))continue
for(var f in c.value)if(!u[f]){delete c.value[f]
l[_]=true}}else{if(a&&!(c.routes||c.clear_on_route_change)&&!u)continue
if(u!==c.value||t){l[_]=true
c.value=u}}}if(!r){for(var v in l){var h=g[v]
if(h.change)h.change(h.value,t)}p(m,t)}}var I
function toString(e){I=""
var r={}
for(var t in g){var a=g[t]
if(a.hides&&a.value)for(var i in a.hides)r[i]=1}var o=""
e:for(var n=0;n<S.length;++n){var s=S[n]
var l=""
for(var _=0;_<s.keys.length;++_){var c=s.keys[_]
if(r[c])continue e
var u=g[c]
if(u.hide_values[u.value])continue e
if(!l&&u.title)l=u.title(u.value)}for(var d=0;d<s.keys.length;++d){var f=s.keys[d]
if(g[f].route_only)r[f]=true}o=s.route_string.replace(y,function(e,t){r[t]=true
return String(g[t].value)})
if(!I&&l)I=l
break}var v=[]
for(var h in g){if(r[h])continue
var p=g[h]
if(p.type===E)for(var m in p.value)v.push(h+"="+m)
else if(!p.hide_values[p.value]){v.push(h+"="+p.value)
if(!I&&p.title)I=p.title(p.value)}}if(T)I=T(I)
I=String(I)
if(e)v=[]
return o+(v.length?"?":"")+v.join("&")}function refreshTitle(){toString(false)
if(I&&I!==document.title)document.title=I}function periodicRefreshTitle(){profilerStart("periodicRefreshTitle")
refreshTitle()
setTimeout(periodicRefreshTitle,1e3)
profilerStop()}function onPopState(){var e=queryString()
goInternal(s=e,false,false,false)
refreshTitle()}var l
function onURLChange(e){l=e}var u=false
function historyDeferUpdate(e){u=e}var d=0
var f=false
var v=false
function updateHistoryCommit(){profilerStart("updateHistoryCommit")
if(u){setTimeout(updateHistoryCommit,1e3)
return void profilerStop()}f=false
d=Date.now()
var e=getLinkURL(s)
if(e.endsWith("?"))e=e.slice(0,-1)
try{if(v){v=false
window.history.pushState(void 0,I,e)}else window.history.replaceState(void 0,I,e)}catch(e){}if(I)document.title=I
if(l)l()
profilerStop()}function updateHistory(e){var t=toString(false)
if(s===t)return
v=v||e
s=t
if(f)return
var r=a
if(Date.now()-d>a)r=1
f=true
setTimeout(updateHistoryCommit,r)}function startup(e){_(!T)
if(!(T=e.title_transformer)&&(e.title_suffix||e.title_default)){var t=e.title_suffix,r=e.title_default
T=function title_transformer(e){if(t&&e)return e+" | "+t
return e||r||t}}updateHistory(false)
if(T){refreshTitle()
setTimeout(periodicRefreshTitle,1e3)}}function urlhashFireInitialChanges(){goInternal(null,true,false,false)}function routeEx(e){var t=e.keys
for(var r=0;r<t.length;++r){var a=g[t[r]]
_(a)
a.routes=a.routes||[]
a.routes.push(e)
a.value=getValue(queryString(),a)}S.push(e)
S.sort(cmpNumKeys)}function route(e){var r=[]
var t=e.replace(y,function(e,t){r.push(t)
return"([^/&?]+)"})
routeEx({route_string:e,regex:new RegExp("^\\??"+t+"(?:$|\\?|#)"),keys:r})}function routeFixed(e,t){routeEx({route_string:e,regex:new RegExp("^\\??"+e+"(?:$|\\?|#)"),value:"1",keys:[t]})}function register(e){_(e.key)
_(!g[e.key])
e.type=e.type||i
var t="(?:[^\\w])"+e.key+"=([^&#]+)"
var r=""
if(e.type===E)r="g"
else{e.def=e.def||""
e.hide_values=e.hide_values||{}
e.hide_values[e.def]=true}e.regex=new RegExp(t,r);(g[e.key]=e).value=getValue(queryString(),e)
var a=e.value
if(e.type===E&&"function"===typeof Proxy)a=new Proxy(e.value,{set:function set(e,t,r){if(r)e[t]=1
else delete e[t]
updateHistory()
return true}})
if(!window.onpopstate)window.onpopstate=onPopState
return a}function set(e,t,r){var a=g[e]
_(a)
if(a.type===E){if(Boolean(a.value[t])!==Boolean(r)){a.value[t]=r?1:0
updateHistory(a.push)}}else if(a.value!==t){a.value=t
updateHistory(a.push)}}function setMulti(e){var t=false
var r=false
for(var a in e){var i=e[a]
var o=g[a]
_(o)
_(o.type!==E)
if(o.value!==i){o.value=i
t=true
r=r||o.push}}if(t)updateHistory(r)}function get(e){var t=g[e]
_(t)
return t.value}function getRouteString(){return toString(true)}function go(e,t){goInternal(e,false,t,false)
updateHistory(true)}function goRoute(e,t){goInternal(e,false,t,true)
updateHistory(true)}},{"../common/util.js":400,assert:void 0}],370:[function(e,t,r){"use strict"
var a=e("../common/util").msToSS2020
var i=Math.min
var o=0
function now(){return Date.now()+o}t.exports=r=now
r.now=now
var n=true
r.sync=function(e){if(n)o=e-Date.now()
else o=i(o,e-Date.now())}
r.seconds=function(){return a(now())}},{"../common/util":400}],371:[function(e,t,r){"use strict"
r.webFSOnReady=webFSOnReady
r.webFSGetFileNames=webFSGetFileNames
r.webFSGetFile=webFSGetFile
r.webFSExists=webFSExists
r.webFSReportUnused=webFSReportUnused
r.webFSSetToWorkerCB=webFSSetToWorkerCB
r.webFSGetData=webFSGetData
r.webFSApplyReload=webFSApplyReload
r.webFSStartup=webFSStartup
r.webFSAPI=webFSAPI
var s=e("assert")
var a=e("../common/util")
var i=a.callEach
var o=a.clone
var l=a.deepEqual
var n=e("./filewatch")
var _=n.filewatchOn
var c=n.filewatchTriggerChange
var u
var d={}
var f={}
var v=false
var h=[]
function webFSOnReady(e){if(u)e()
else h.push(e)}function decode(e){var t=e[0]
var r=e[1]
var a=new Uint8Array(t)
var i=0
var o=0
while(i<t){var n=r.charCodeAt(o++)
if(126===n)n=0
else if(27===n)n=r.charCodeAt(o++)
a[i++]=n}s.equal(o,r.length)
s.equal(i,t)
return a}function webFSGetFileNames(e){s(u)
var t=[]
for(var r in u)if(r.startsWith(e))t.push(r)
return t}function webFSGetFile(e,t){s(u)
var r=d[e]
if(r)return r
f[e]=true
var a=u[e]
s(a,"Error loading file: "+e)
if("jsobj"===t){s(!Array.isArray(a)||!(2===a.length&&"number"===typeof a[0]&&"string"===typeof a[1]))
r=v?o(a):a}else{s(Array.isArray(a))
if("text"===t)r=a[1]
else r=decode(a)}return d[e]=r}function webFSExists(e){s(u)
return Boolean(u[e])}function webFSReportUnused(e){e=e||/\.(fp|vp)$/
var t=0
for(var r in u)if(!f[r]&&!r.match(e)){console.warn("WebFS file bundled but unreferenced: "+r)
t+=u[r][0]}if(t)console.warn("WebFS wasting "+t+" bytes")}var p
function webFSSetToWorkerCB(e){p=e}function webFSGetData(){return u}function webFSApplyReload(e){var t=u
u=e
if(p)p(u)
d={}
f={}
for(var r in u){var a=t[r]
var i=u[r]
if(Array.isArray(a)){for(var o=0;o<i.length;++o)if(!a||i[o]!==a[o]){c(r)
break}}else if(!l(a,i))c(r)}for(var n in t)if(!u[n])c(n)}var m
function webFSReload(){v=true
window.glov_webfs=null
var e=document.createElement("script")
e.src=m+"fsdata.js?rl="+Date.now()
e.onload=function(){if(window.glov_webfs)webFSApplyReload(window.glov_webfs)}
document.head.appendChild(e)}function webFSStartup(e,t){u=e||{}
if(t){m=t
_("fsdata.js",webFSReload)}if(p)p(u)
i(h,h=null)}function webFSAPI(){return{getFileNames:webFSGetFileNames,getFile:webFSGetFile,filewatchOn:_}}},{"../common/util":400,"./filewatch":314,assert:void 0}],372:[function(e,t,r){"use strict"
r.profanityStartup=profanityStartup
r.profanityStartupLate=profanityStartupLate
r.profanityFilter=profanityFilter
var a=e("../font").fontSetReplacementChars
var i=e("../locate_asset").locateAsset
var o=e("../rand_fast").randFastCreate
var n=e("../urlhash").getURLBase
var s=e("../webfs").webFSGetFile
var l=e("../../common/rand_alea").mashString
var _=e("../../common/words/profanity_common")
var c=_.profanityCommonStartup
var u=_.profanityFilterCommon
var d=_.profanitySetReplacementChars
var f
function profanityStartup(){f=s("words/replacements.txt","text").split("\n").filter(function(e){return e})
c(s("words/filter.gkg","text"),s("words/exceptions.txt","text"))}function profanityStartupLate(){var e=document.createElement("script")
e.src=""+n()+i("replacement_chars.min.js")
e.onload=function(){if(window.unicode_replacement_chars){d(window.unicode_replacement_chars)
a(window.unicode_replacement_chars)}}
document.getElementsByTagName("head")[0].appendChild(e)}var v=o()
var h
function randWord(){if(-1===h||1===f.length)h=v.range(f.length)
else{var e=v.range(f.length-1)
h=e<h?e:e+1}return f[h]}function profanityFilter(e){h=-1
v.seed=l(e)
return u(e,randWord)}},{"../../common/rand_alea":395,"../../common/words/profanity_common":403,"../font":315,"../locate_asset":331,"../rand_fast":347,"../urlhash":369,"../webfs":371}],373:[function(e,t,r){"use strict"
r.numWorkers=numWorkers
r.addHandler=addHandler
r.workerCommSendMsg=workerCommSendMsg
r.setNumWorkers=setNumWorkers
r.startup=startup
r.keepBusy=keepBusy
r.keep_busy=r.WORKER_ALL=void 0
var a=e("assert")
var i=e("./locate_asset").locateAsset
var o=e("./webfs")
var n=o.webFSGetData
var s=o.webFSSetToWorkerCB
var l=[]
function numWorkers(){return l.length}var _={}
var c=-1
r.WORKER_ALL=c
t.exports.ALL=c
function addHandler(e,t){a(!_[e])
_[e]=t}function workerCommSendMsg(e,t,r,a){if(e===c)for(var i=0;i<l.length;++i)workerCommSendMsg(i,t,r)
else l[e].postMessage({id:t,data:r},a)}t.exports.sendmsg=workerCommSendMsg
function workerOnMessage(e,t){if((t=t.data)instanceof Object&&t.id){profilerStart("worker:"+t.id)
a(_[t.id])
_[t.id](e,t.data)
profilerStop()}else console.log("worker_comm (main thread) unhandled message",t)}function workerOnError(e,t,r,a,i){if(!t&&e.message&&e.filename)window.onerror(e.message,e.filename,e.lineno,e.colno,i||e)
else if("[object Event]"===String(e))window.onerror("Unknown worker error ("+(e.message||e.type||e)+")",t,r,a,i)
else window.onerror(e,t,r,a,i)}var u
function allocWorker(e,t){var r=u&&u[e]&&"#"+u[e]||""
var a=new Worker(""+i(t||"worker.bundle.js")+r)
a.onmessage=workerOnMessage.bind(null,l.length)
a.onerror=workerOnError
l.push(a)
if(n())workerCommSendMsg(e,"webfs_data",n())}function setNumWorkers(e,t){for(var r=l.length;r<e;++r)allocWorker(r,t)}var d=0
r.keep_busy=d
function startup(e,t){if(String(document.location).match(/^https?:\/\/localhost/))u=t
addHandler("debugmsg",function(e,t){window.debugmsg(t.msg,t.clear)})
addHandler("log",function(e,t){console.log("[Worker#"+e+"] "+t)})
addHandler("error",function(e,t){console.error(t)
window.onerror(null,null,null,null,t)})
addHandler("busy_done",function(e){if(e<d)workerCommSendMsg(e,"busy",1e3)})
s(function(e){workerCommSendMsg(c,"webfs_data",e)})
allocWorker(0,e)}function keepBusy(e){for(var t=d;t<e;++t)workerCommSendMsg(t,"busy",1e3)
r.keep_busy=d=e}},{"./locate_asset":331,"./webfs":371,assert:void 0}],374:[function(e,t,r){"use strict"
r.startup=startup
var d=e("./camera2d.js")
var a=e("./cmds.js").cmd_parse
var f=e("./engine.js")
var v=Math.max
var i=e("./settings.js")
var h=e("./ui.js")
var o=e("../common/vmath.js").vec4
var n=e("./worker_comm.js")
var s=n.addHandler,l=n.keepBusy,_=n.numWorkers,c=n.sendmsg
var p=256
var u=[]
var m=[o(0,0,0,.75),o(.161,.678,1,1),o(1,.639,0,1),o(1,.467,.659,1)]
var E=1
var g=32
var T=.25
var y=o(0,0,0,.5)
function drawGraph(e,t){var r=507
var a=d.x1Real()-E
var i=a-r
var o=Z.FPSMETER
e-=E
h.drawRect(i,e-g,a+r,e,o++,y)
a-=(f.frame_timestamp-t.last_update)*T
for(var n=1;n<p;++n){if(a<=i)break
var s=(t.index-n+p)%p
var l=t.type[s]
var _=t.time[s]
if(!_)continue
var c=m[l]
var u=v(1,_*T)
if(!l)h.drawRect(v(i,a-u),e-.75*g,a,e-.25*g,o,c)
else h.drawRect(v(i,a-u),e-g,a,e,o,c)
a-=u}return e-g}function tickWorkerPerf(){if(!i.worker_graph)return
d.setAspectFixed(f.game_width,f.game_height)
var e=d.y1Real()
if(i.fps_graph)e-=130
for(var t=0;t<u.length;++t)e=drawGraph(e,u[t])}function onTiming(e,t){var r=u[e]
if(!r){console.log("[Worker"+e+"] "+(100*t.time_work/t.elapsed).toFixed().padStart(2)+"% work "+(100*t.time_idle/t.elapsed).toFixed().padStart(2)+"% idle ("+t.batches.length/2+" batches)")
return}var a=r.batch_idx,i=r.index
for(var o=0;o<t.batches.length;){r.type[i]=0
r.time[i++]=t.batches[o++]
r.type[i]=a+1
r.time[i++]=t.batches[o++]
a=(a+1)%3
i%=p}r.batch_idx=a
r.index=i
r.last_update=f.frame_timestamp}function startup(){i.register({worker_graph:{default_value:0,type:a.TYPE_INT,range:[0,1]}})
a.registerValue("worker_busy",{type:a.TYPE_INT,label:"Worker Busy",range:[0,8],get:function get(){return n.keep_busy},set:l,access_show:["hidden"]})
for(var e=0;e<_();++e)u[e]={index:0,batch_idx:0,last_update:0,type:new Uint8Array(p),time:new Float32Array(p)}
s("timing",onTiming)
for(var t=0;t<_();++t)c(t,"timing_enable",true)
f.addTickFunc(tickWorkerPerf)}},{"../common/vmath.js":402,"./camera2d.js":295,"./cmds.js":298,"./engine.js":305,"./settings.js":351,"./ui.js":367,"./worker_comm.js":373}],375:[function(e,t,r){"use strict"
r.WSClient=WSClient
r.wsclientSetExtraParam=wsclientSetExtraParam
r.ERR_CLIENT_VERSION_OLD=r.ERR_CLIENT_VERSION_NEW=r.ERR_RESTARTING=r.ERR_CONNECTING=void 0
var a=e("./environments")
var _=a.getAPIPath
var c=a.setCurrentEnvironment
var n=e("../common/ack.js")
var i=n.ackInitReceiver
var o=e("../common/verify.js")
var u=e("assert")
var s=e("./error_report.js"),l=s.errorReportSetDetails,d=s.session_uid
var f=e("./fetch.js"),v=f.ERR_CONNECTION,h=f.fetch,p=f.fetchDelaySet
var m=Math.min,E=Math.random
var g=e("../common/perfcounters.js").perfCounterAdd
var T=e("./urlhash.js")
var y=e("../common/wscommon.js")
var S=y.netDelaySet,I=y.wsHandleMessage
var A=e("./client_config.js"),w=A.platformGetID,L=A.getAbilityReloadUpdates
var O="ERR_CONNECTING"
r.ERR_CONNECTING=O
var R="ERR_RESTARTING"
r.ERR_RESTARTING=R
var b="ERR_CLIENT_VERSION_NEW"
r.ERR_CLIENT_VERSION_NEW=b
var N="ERR_CLIENT_VERSION_OLD"
r.ERR_CLIENT_VERSION_OLD=N
r.CURRENT_VERSION=0
function WSClient(e,t){this.id=null
this.my_ids={}
this.handlers={}
this.socket=null
this.net_delayer=null
this.connected=false
this.disconnected=false
this.retry_scheduled=false
this.retry_count=0
this.retry_extra_delay=0
this.disconnect_time=Date.now()
this.last_receive_time=Date.now()
this.idle_counter=0
this.last_send_time=Date.now()
this.connect_error=O
this.update_available=false
this.client_app=t||"app"
i(this)
if(e)this.path=e
this.connect(false)
this.onMsg("cack",this.onConnectAck.bind(this))
this.onMsg("build",this.onBuildChange.bind(this))
this.onMsg("error",this.onError.bind(this))}WSClient.prototype.logPacketDispatch=function(e,t,r,a){g("ws."+a)}
WSClient.prototype.timeSinceDisconnect=function(){return Date.now()-this.disconnect_time}
function getVersionUrlParams(){return"plat="+w()+"&ver="+r.CURRENT_VERSION+"&build=1718180230532"}function jsonParseResponse(e){if(!e)return null
if("<"===e.trim()[0])return null
try{return JSON.parse(e)}catch(e){return null}}function whenServerReady(a){var i=0
function doit(){h({url:_()+"ready?"+getVersionUrlParams()},function(e,t){if(e){var r=jsonParseResponse(t)
if("ERR_CLIENT_VERSION_OLD"!==(null==r?void 0:r.status)){++i
setTimeout(doit,m(i*i*100,15e3)*(.75+.5*E()))
return}}a()})}doit()}WSClient.prototype.onBuildChange=function(e){if(e.app!==this.client_app)return
this.onBuildTimestamp(e.ver)}
WSClient.prototype.onBuildTimestamp=function(e){if("1718180230532"!==e)if(this.on_build_timestamp_mismatch)this.on_build_timestamp_mismatch()
else if(L()){console.error("App build mismatch (server: "+e+", client: 1718180230532), reloading")
whenServerReady(function(){if(window.reloadSafe)window.reloadSafe()
else document.location.reload()})}else console.warn("App build mismatch (server: "+e+", client: 1718180230532), ignoring")}
WSClient.prototype.onConnectAck=function(e,t){var r=this
r.connected=true
r.connect_error=null
r.disconnected=false
r.id=e.id
r.my_ids[e.id]=true
l("client_id",r.id)
r.secret=e.secret
if(e.build)r.onBuildTimestamp(e.build)
if(e.net_delay){S(e.net_delay[0],e.net_delay[1])
p(e.net_delay[0],e.net_delay[1])}u(r.handlers.connect)
e.client_id=r.id
r.handlers.connect(r,e)
t()}
WSClient.prototype.pak=function(e,t){return y.wsPak(e,null,this,t)}
WSClient.prototype.send=function(e,t,r,a){if(!o("function"!==typeof r)){a=r
r=null}y.sendMessage.call(this,e,t,r,a)}
WSClient.prototype.onError=function(e){console.error("WSClient Error")
console.error(e)
if(!(e instanceof Error))e=new Error(e)
throw e}
WSClient.prototype.onMsg=function(e,a){u.ok(!this.handlers[e])
this.handlers[e]=function wrappedCallback(e,t,r){return a(t,r)}}
WSClient.prototype.checkForNewAppBuild=function(){var r=this
if(!L())return
if(this.new_build_check_in_progress)return
this.new_build_check_in_progress=true
h({url:T.getURLBase()+"app.ver.json",response_type:"json"},function(e,t){r.new_build_check_in_progress=false
if(t&&t.ver)r.onBuildTimestamp(t.ver)
if(e&&e!==v)if(!r.delayed_recheck){r.delayed_recheck=true
setTimeout(function(){r.delayed_recheck=false
r.checkForNewAppBuild()},1e3)}})}
WSClient.prototype.retryConnection=function(){var e=this
u(!e.socket)
u(!e.retry_scheduled)
e.retry_scheduled=true;++e.retry_count
this.checkForNewAppBuild()
setTimeout(function(){u(e.retry_scheduled)
u(!e.socket)
e.retry_scheduled=false
e.connect(true)},m(e.retry_count*e.retry_count*100,15e3)*(.75+.5*E())+this.retry_extra_delay)
this.retry_extra_delay=0}
WSClient.prototype.checkDisconnect=function(){if(this.connected&&1!==this.socket.readyState){this.on_close()
u(!this.connected)}}
WSClient.prototype.connect=function(n){var s=this
var l=this
l.socket={readyState:0}
u(!this.ready_check_in_progress)
this.ready_check_in_progress=true
h({url:_()+"ready?"+getVersionUrlParams()},function(e,t){var r=jsonParseResponse(t)
var a=null==r?void 0:r.status
var i=null==r?void 0:r.redirect_environment
s.update_available=null==r?void 0:r.update_available
var o=s.update_available&&L()
u(s.ready_check_in_progress)
s.ready_check_in_progress=false
s.connect_error=O
if(!e&&!i&&!o){if(s.update_available);return void s.connectAfterReady(n)}console.log("Server not ready, err="+e+", response="+t)
if("ERR_RESTARTING"===a||"ERR_STARTUP"===a)l.connect_error=R
else if("ERR_CLIENT_VERSION_NEW"===a)l.connect_error=b
else if("ERR_CLIENT_VERSION_OLD"===a)l.connect_error=N
if(i)c(i)
l.socket=null
l.net_delayer=null
s.retryConnection()})}
var C=""
var x={}
function wsclientSetExtraParam(e,t){if(!t)delete x[e]
else x[e]=t
var r=[]
for(var a in x)r.push(a+"="+x[a])
if(r.length)C="&"+r.join("&")
else C=""}WSClient.prototype.connectAfterReady=function(e){var t=this
var r=t.path||_().replace(/^http/,"ws").replace(/api\/$/,"ws")
r=r+"?"+getVersionUrlParams()+(e&&t.id&&t.secret?"&reconnect="+t.id+"&secret="+t.secret:"")+"&sesuid="+d+C
var a=new WebSocket(r)
a.binaryType="arraybuffer"
t.socket=a
function guard(e){return function(){if(t.socket!==a)return
e.apply(void 0,arguments)}}function abort(e){t.socket=null
t.net_delayer=null
if(t.connected){t.disconnect_time=Date.now()
t.disconnected=true
l("disconnected",1)}t.connected=false
t.connect_error=O
if(!e)try{a.close()}catch(e){}t.handlers.disconnect()
n.failAll(t)}function retry(e){abort(e)
t.retryConnection()}var i=false
t.socket.addEventListener("error",guard(function(e){if(!i){console.log("WebSocket error during initial connection, retrying...",e)
retry()}else console.error("WebSocket error",e)}))
t.socket.addEventListener("message",guard(function(e){profilerStart("WS")
u(e.data instanceof ArrayBuffer)
I(t,new Uint8Array(e.data))
profilerStop("WS")}))
t.socket.addEventListener("open",guard(function(){console.log("WebSocket open")
i=true
t.retry_count=0}))
t.on_close=guard(function(){console.log("WebSocket close, retrying connection...")
retry(true)})
t.socket.addEventListener("close",t.on_close)
var o=guard(function(){if(Date.now()-t.last_send_time>=y.PING_TIME&&t.connected&&1===t.socket.readyState)t.send("ping")
setTimeout(o,y.PING_TIME/2)})
setTimeout(o,y.PING_TIME/2)}},{"../common/ack.js":376,"../common/perfcounters.js":393,"../common/verify.js":401,"../common/wscommon.js":404,"./client_config.js":297,"./environments":310,"./error_report.js":311,"./fetch.js":313,"./urlhash.js":369,assert:void 0}],376:[function(e,t,r){"use strict"
r.ackInitReceiver=ackInitReceiver
r.ackWrapPakStart=ackWrapPakStart
r.ackWrapPakPayload=ackWrapPakPayload
r.ackWrapPakFinish=ackWrapPakFinish
r.ackReadHeader=ackReadHeader
r.failAll=failAll
r.ackHandleMessage=ackHandleMessage
var y=e("assert")
var a=e("./packet.js").isPacket
var S=e("./perfcounters.js").perfCounterAddValue
function ackInitReceiver(e){e.last_pak_id=0
e.resp_cbs={}
e.responses_waiting=0}var I="ERR_FAILALL_DISCONNECT"
var n=8
var s=16
var l=32
function ackWrapPakStart(e,t,r,a){var i=0
e.ack_data={receiver:t,msg_dbg_name:a||r}
if("number"===typeof r){i|=n
e.writeInt(r)}else e.writeAnsiString(r)
var o=t?++t.last_pak_id:0
e.ack_data.resp_pak_id=o
e.ack_data.resp_pak_id_offs=e.getOffset()
e.writeInt(o)
e.ack_data.data_offs=e.getOffset()
e.ack_data.flags=i}function ackWrapPakPayload(e,t){if(a(t))e.appendRemaining(t)
else{e.ack_data.flags|=l
e.writeJSON(t)}}function ackWrapPakFinish(e,t,r){var a=e.ack_data.flags
var i=e.getOffset()
if(t){y.equal(e.ack_data.data_offs,i)
a|=s
e.writeString(String(t))
i=e.getOffset()}e.makeReadable()
var o=0
if(r&&false!==r.expecting_response){o=e.ack_data.resp_pak_id
y(o)
y(e.ack_data.receiver)
y(e.ack_data.msg_dbg_name)
var n="ack."+e.ack_data.msg_dbg_name
e.ack_data.receiver.resp_cbs[o]={func:r,ack_name:n}}else{e.seek(e.ack_data.resp_pak_id_offs)
e.zeroInt()
e.seek(i)}e.updateFlags(a)
delete e.ack_data
return o}function ackReadHeader(e){var t=e.getFlags()
var r=t&n?e.readInt():e.readAnsiString()
var a=e.readInt()
var i=t&s?e.readString():void 0
var o
if(t&l)o=e.readJSON()
else o=e
return{msg:r,err:i,data:o,pak_id:a}}function failAll(e,t){t=t||I
var r=e.resp_cbs
e.resp_cbs={}
e.responses_waiting=0
for(var a in r)r[a].func(t)}function ackHandleMessage(a,e,t,i,o,r,n){var s=t.getOffset()
var l=ackReadHeader(t),_=l.err,c=l.data,u=l.msg,d=l.pak_id
var f
if("number"===typeof u){var v=a.resp_cbs[u]
y(!v||v.ack_name)
if(v&&v.ack_name)f=v.ack_name
else f="ack"}else f=u
if(a.logPacketDispatch){S("net.recv_bytes.total",t.totalSize())
S("net.recv_bytes."+f,t.totalSize())
a.logPacketDispatch(e,t,s,f)}var h=Date.now()
var p=Boolean(d)
var m
if(p)m="pending"
var E=false
var g=h
if(n&&!n(a,u,c))return
function preSendResp(e){y(!E,"Response function called twice")
E=true
if(p){if(m){if("pending"!==m)clearTimeout(m)}else if(e===I);else(a.log?a:console).log("Response finally sent for "+f+" after "+((Date.now()-g)/1e3).toFixed(1)+"s")
a.responses_waiting--}}function respFunc(e,t,r){preSendResp(e)
if(!p){if(r&&false!==r.expecting_response){a.onError("Sending a response to a packet ("+f+") that did not expect one, but we are expecting a response")
return}if(e)i("error",null,e,null)
return}i(d,e,t,r)}respFunc.expecting_response=p
respFunc.pak=function(e){y(p)
var r=o(d,e)
var a=r.send
r.send=function(e,t){preSendResp(e)
a.call(r,e,t)}
return r}
if("number"===typeof u){var T=a.resp_cbs[u]
if(!T)return void a.onError("Received response to unknown packet with id "+f+" from "+e)
delete a.resp_cbs[u]
profilerStart("response")
T.func(_,c,respFunc)
profilerStop("response")}else{if(!u)return void a.onError("Received message with no .msg from "+e)
profilerStart(u)
r(u,c,respFunc)
profilerStop(u)}if(p){a.responses_waiting++
if(!E&&!respFunc.suppress_timeout)m=setTimeout(function(){m=null
if(!respFunc.suppress_timeout)(a.log?a:console).log("Response not sent for "+f+" from "+e+" after "+((Date.now()-g)/1e3).toFixed(1)+"s")},15e3)}}},{"./packet.js":392,"./perfcounters.js":393,assert:void 0}],377:[function(e,t,r){(function(o){(function(){"use strict"
var i=Math.floor
var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("")
var l="="
function encode(e,t,r){var a=e.u8
var i=""
var o
var n
for(o=0;o<r-2;o+=3){i+=s[a[n=t+o]>>2]
i+=s[((3&a[n])<<4)+(a[n+1]>>4)]
i+=s[((15&a[n+1])<<2)+(a[n+2]>>6)]
i+=s[63&a[n+2]]}if(r%3){i+=s[a[n=t+(o=r-r%3)]>>2]
if(r%3===2){i+=s[((3&a[n])<<4)+(a[n+1]>>4)]
i+=s[(15&a[n+1])<<2]
i+=l}else{i+=s[(3&a[n])<<4]
i+=l+l}}return i}function decodeNativeBrowser(e,t){var r=window.atob(e)
var a=r.length
var i=t(a)
var o=i.u8
for(var n=0;n<a;++n)o[n]=r.charCodeAt(n)
i.decode_size=a
return i}function encodeNativeNode(e,t,r){return o.from(e.buffer).toString("base64",t,t+r)}function decodeNativeNode(e,t){var r=t(3*(e.length>>2)+i(e.length%4/1.5))
var a=o.from(r.buffer)
r.decode_size=a.write(e,"base64")
return r}var e="undefined"!==typeof window
r.base64Decode=e?decodeNativeBrowser:decodeNativeNode
r.base64Encode=e?encode:encodeNativeNode
r.base64CharTable=s}).call(this)}).call(this,e("buffer").Buffer)},{buffer:void 0}],378:[function(e,t,r){"use strict"
r.chunkedReceiverInit=chunkedReceiverInit
r.chunkedReceiverCleanup=chunkedReceiverCleanup
r.chunkedReceiverFreeFile=chunkedReceiverFreeFile
r.chunkedReceiverGetFile=chunkedReceiverGetFile
r.chunkedReceiverStart=chunkedReceiverStart
r.chunkedReceiverOnChunk=chunkedReceiverOnChunk
r.chunkedReceiverFinish=chunkedReceiverFinish
r.chunkedSend=chunkedSend
r.MAX_CLIENT_UPLOAD_SIZE=void 0
var u=e("assert")
var a=e("glov-async"),d=a.asyncParallelLimit,n=a.asyncSeries
var f=e("./crc32.js")
var v=Math.ceil,h=Math.min
var i=e("./packet.js"),l=i.packetBufPoolAlloc,o=i.packetBufPoolFree
var s=2097152
r.MAX_CLIENT_UPLOAD_SIZE=s
var p=8092
function cleanupFile(e,t,r){var a=e.files[t]
if(a.dv){o(a.dv)
delete a.dv}e.buffer_size-=a.length
u(e.buffer_size>=0)
delete e.files[t]}function chunkedReceiverInit(e,t){return{name:e,max_buffer_size:t,last_file_id:0,buffer_size:0,files:{}}}function chunkedReceiverCleanup(e){if(!e||!e.files)return
for(var t in e.files)cleanupFile(e,t)}function chunkedReceiverFreeFile(e){var t=e.buffer,r=e.dv
u(t)
u(r)
o(r)
delete e.buffer}function chunkedReceiverGetFile(t,r){if(!t)return{err:"ERR_NOT_INITIALIZED"}
function err(e){console.error(t.name+": chunkedReceiverGetFile("+r+"): "+e)
return{err:e}}if(!t.files)return err("ERR_FILE_NOT_FOUND")
var e=t.files[r]
if(!e)return err("ERR_FILE_NOT_FOUND")
if(!e.finished){cleanupFile(t,r)
return err("ERR_UPLOAD_UNFINISHED")}var a=e.dv,i=e.mime_type,o=e.length
e.buffer=null
e.dv=null
cleanupFile(t,r)
return{dv:a,mime_type:i,buffer:new Uint8Array(a.buffer,a.byteOffset,o)}}function chunkedReceiverStart(e,t,r){u(e)
var a=t.readInt()
var i=t.readU32()
var o=t.readAnsiString()
var n=e.name+": chunkedReceiverStart length="+a+" crc="+i+" mime="+o
if(a>e.max_buffer_size){console.error(n+": ERR_TOO_LARGE")
return void r("ERR_TOO_LARGE")}if(e.buffer_size+a>e.max_buffer_size){console.error(n+": ERR_OUT_OF_SPACE")
return void r("ERR_OUT_OF_SPACE")}e.buffer_size+=a
var s=++e.last_file_id
console.log(n+" id="+s)
e.files[s]={length:a,crc:i,mime_type:o,total:0,dv:l(a)}
r(null,s)}function chunkedReceiverOnChunk(e,t,r){if(!e){t.pool()
return void r("ERR_NOT_INITED")}var a=t.readInt()
var i=t.readInt()
var o=t.readBuffer(false)
var n=e.name+": chunkedReceiverOnChunk id="+a+" offs="+i+" length="+o.length
var s=e.files&&e.files[a]
if(!s){console.error(n+": ERR_INVALID_FILE_ID")
return void r("ERR_INVALID_FILE_ID")}if(s.total+o.length>s.length){cleanupFile(e,a)
console.error(n+": ERR_BUFFER_OVERRUN")
return void r("ERR_BUFFER_OVERRUN")}console.debug(n)
s.total+=o.length
s.dv.u8.set(o,i)
if(e.on_progress)e.on_progress(s.total,s.length,s.mime_type,a)
r()}function chunkedReceiverFinish(e,t,r){var a=t.readInt()
if(!e)return void r("ERR_NOT_INITED")
var i=e.files&&e.files[a]
var o=e.name+": chunkedReceiverFinish id="+a
if(!i){console.error(o+": ERR_INVALID_FILE_ID")
return void r("ERR_INVALID_FILE_ID")}if(i.total!==i.length){cleanupFile(e,a)
console.error(o+": ERR_INCOMPLETE (total="+i.total+" length="+i.length+")")
return void r("ERR_INCOMPLETE")}var n=f(i.dv.u8,i.length)
if(n!==i.crc){cleanupFile(e,a)
console.error(o+": ERR_CRC_MISMATCH (expected="+i.crc+" actual="+n+")")
return void r("ERR_CRC_MISMATCH")}i.finished=true
r()}function chunkedSend(e,t){var s=e.client,l=e.buffer,a=e.mime_type,i=e.max_in_flight
u(l instanceof Uint8Array,"Invalid data type")
u(a,"Missing mime_type")
var _=l.length
u(_)
var o=f(l)
var c
n([function getID(r){var e=s.pak("upload_start")
e.writeInt(_)
e.writeU32(o)
e.writeAnsiString(a)
e.send(function(e,t){c=t
r(e)})},function streamFile(e){var o=v(_/p)
var n=false
function sendChunk(e,t){if(n)return void t()
u(e<o)
var r=s.pak("upload_chunk")
r.writeInt(c)
var a=e*p
r.writeInt(a)
var i=h(p,_-a)
r.writeBuffer(new Uint8Array(l.buffer,l.byteOffset+a,i))
r.send(function(e){if(e)n=true
t(e)})}var t=[]
for(var r=0;r<o;++r)t.push(sendChunk.bind(null,r))
d(t,i,e)},function finish(e){var t=s.pak("upload_finish")
t.writeInt(c)
t.send(e)}],function(e){t(e,c)})}},{"./crc32.js":380,"./packet.js":392,assert:void 0,"glov-async":void 0}],379:[function(e,t,r){"use strict"
r.canonical=canonical
r.defaultHandler=defaultHandler
r.create=create
r.TYPE_STRING=r.TYPE_FLOAT=r.TYPE_INT=void 0
var m=e("assert")
var E=e("./util.js").isInteger
var n=e("./perfcounters.js").perfCounterAdd
function canonical(e){return e.toLowerCase().replace(/[_.]/g,"")}var g=0
r.TYPE_INT=g
var T=1
r.TYPE_FLOAT=T
var a=2
r.TYPE_STRING=a
var i=["INTEGER","NUMBER","STRING"]
function defaultHandler(e,t){if(e)console.error(e,t)
else console.info(t)}function checkAccess(e,t,r){if(r){if(!e)return false
for(var a=0;a<r.length;++a){var i=r[a]
if(!e[i]){var o=false
for(var n in e){var s=t[n]
if(s&&s[i]){o=true
break}}if(!o)return false}}}return true}function formatUsage(e,t,r){return!e?void 0:r?t+"\n"+e:t?String(e).replace(/\$HELP/,t):String(e)}function CmdParse(e){this.cmds={}
this.cmds_for_complete=this.cmds
this.was_not_found=false
this.storage=e&&e.storage
this.default_handler=defaultHandler
this.last_access=null
this.register({cmd:"cmd_list",func:this.cmdList.bind(this),access_show:["hidden"]})
this.implied_access={sysadmin:{csr:true}}}CmdParse.prototype.cmdList=function(e,t){if(!this.cmd_list){var r=this.cmd_list={}
for(var a in this.cmds){var i=this.cmds[a]
var o=[]
if(i.access_show)o=o.concat(i.access_show)
if(i.access_run)o=o.concat(i.access_run)
if(-1!==o.indexOf("hidden"))continue
var n={name:i.name,help:String(i.help)}
if(i.usage)n.usage=formatUsage(i.usage,i.help,i.prefix_usage_with_help)
if(o.length)n.access_show=o
r[a]=n}}t(null,this.cmd_list)}
CmdParse.prototype.setDefaultHandler=function(e){m(this.default_handler===defaultHandler)
this.default_handler=e}
CmdParse.prototype.checkAccess=function(e){return checkAccess(this.last_access,this.implied_access,e)}
CmdParse.prototype.handle=function(e,t,r){r=r||this.default_handler
this.was_not_found=false
var a=t.match(/^([^\s]+)(?:\s+(.*))?$/)
if(!a){r("Missing command")
return true}var i=canonical(a[1])
var o=this.cmds[i]
this.last_access=e&&e.access
if(o&&!this.checkAccess(o.access_run)){r('Access denied: "'+a[1]+'"')
return false}if(!o){this.was_not_found=true
r('Unknown command: "'+a[1]+'"')
return this.was_not_found=false}n("cmd."+i)
o.fn.call(e,a[2]||"",r)
return true}
CmdParse.prototype.register=function(e){m.equal(typeof e,"object")
var t=e.cmd,r=e.func,a=e.help,i=e.usage,o=e.prefix_usage_with_help,n=e.access_show,s=e.access_run,l=e.store_data,_=e.override
m(t)
m(r,'Missing function for command "'+t+'"')
var c=String(a||"").toLowerCase()
if(c.includes("(admin)"))m(s&&s.includes("sysadmin"))
if(c.includes("(csr)"))m(s&&s.includes("csr"))
if(c.includes("(hidden)"))m(n&&n.length)
var u=canonical(t)
m(!this.cmds[u]||_,'Duplicate commands registered as "'+u+'"')
this.cmds[u]={name:t,fn:r,help:a,usage:i,prefix_usage_with_help:o,access_show:n,access_run:s,store_data:l}}
function formatRangeValue(e,t){var r=String(t)
if(e===T&&!r.includes("."))r+=".00"
return r}function formatEnumValue(e,t){if(e)for(var r in e)if(e[r]===t)return r
return t}function lookupEnumValue(e,t){var r=e[t=t.toUpperCase()]
if("number"===typeof r)return r
var a=Number(t)
if(Object.values(e).includes(a))return a
for(var i in e)if(i.startsWith(t))return e[i]
return null}var o={OFF:0,ON:1}
var y="cmd_parse_"
CmdParse.prototype.registerValue=function(l,_){var c=this
m(i[_.type]||!_.set)
m(_.set||_.get)
var u=_.label||l
var d=_.store&&this.storage||false
var f=_.enum_lookup
if(f)m.equal(_.type,g)
var v=""+y+canonical(l)
if(_.ver)v+="_"+_.ver
var h=_.is_toggle
if(h)m(_.get&&_.set&&_.range)
var e
if(d){m(_.set)
e={store_key:v,param:_}
var t=this.storage.getJSON(v)
if(void 0!==t){if(_.range){t=Number(t)
if(!isFinite(t)||t<_.range[0]||t>_.range[1])t=void 0}if(void 0!==t){_.set(t)
if(_.on_change)_.on_change(true)}}}if(!f&&_.type===g&&_.range&&0===_.range[0]&&1===_.range[1])f=o
var p=i[_.type]
if(f)p=Object.keys(f).join("|")
var r=function fn(e,t){function value(){t(null,u+" = **"+formatEnumValue(f,_.get())+"**")}function usage(){t("Usage: **/"+l+" "+p+"**")}if(!e&&h)if(_.get()===_.range[0])e=String(_.range[1])
else e=String(_.range[0])
if(!e)if(_.get&&_.set){var r=[u+":"]
if(_.range&&!(f&&_.type===g))r.push("Valid range: ["+formatRangeValue(_.type,_.range[0])+"..."+formatRangeValue(_.type,_.range[1])+"]")
var a=_.get()
var i=_.range?a===_.range[0]?_.range[1]:_.range[0]:1
if(f)i=Object.keys(f)[0]
r.push("To change: **/"+l+" "+p+"**")
r.push("  example: **/"+l+" "+i+"**")
var o=_.default_value
if(void 0!==o)r.push("Default value = **"+formatEnumValue(f,o)+"**")
r.push("Current value = **"+formatEnumValue(f,a)+"**")
return t(null,r.join("\n"))}else if(_.get)return value()
else return usage()
if(!_.set)return t("Usage: **/"+l+"**")
var n=Number(e)
if(f)if(null===(n=lookupEnumValue(f,e)))return usage()
if(_.range)if(n<_.range[0])n=_.range[0]
else if(n>_.range[1])n=_.range[1]
var s=n
if(_.type===g){if(!E(n))return usage()
_.set(n)}else if(_.type===T){if(!isFinite(n))return usage()
_.set(n)}else{s=e
_.set(e)}if(d)c.storage.setJSON(v,s)
if(_.on_change)_.on_change(false)
if(_.get)return value()
else return t(null,u+" updated")}
this.register({cmd:l,func:r,help:_.help||(_.get&&_.set?"Set or display *"+u+"* value":_.set?"Set *"+u+"* value":"Display *"+u+"* value"),usage:_.usage||(_.get?"Display *"+u+"* value\n  Usage: **/"+l+"**\n":"")+(_.set?"Set *"+u+"* value\n  Usage: **/"+l+" "+p+"**":""),prefix_usage_with_help:_.prefix_usage_with_help,access_show:_.access_show,access_run:_.access_run,store_data:e})}
CmdParse.prototype.resetSettings=function(){var e=[]
var t=this.storage.localStorageExportAll(y)
var r=0
for(var a in t){var i=t[a]
var o=a.slice(y.length)
var n=void 0
var s=o.split("_")
o=s[0]
n=s[1]
var l=this.cmds[o]
if(!l){this.storage.set(a,void 0)
e.push('Cleared unknown setting "'+o+'" = '+i);++r}else{var _
var c=l.name,u=l.store_data
var d=null==u?void 0:null==(_=u.param)?void 0:_.default_value
if(u&&u.store_key!==a){this.storage.set(a,void 0)
e.push('Cleared old setting "'+c+" (v"+(n||0)+')"');++r}else if(void 0!==d)if(JSON.stringify(d)===i)this.storage.set(a,void 0)
else{this.storage.set(a,void 0)
e.push('Cleared setting "'+c+'" = '+i+" (default = "+d+")");++r}else{this.storage.set(a,void 0)
e.push('Cleared setting "'+c+'" = '+i);++r}}}if(e.length)e.push("Reset "+r+" setting(s)")
return e}
function cmpCmd(e,t){if(e.cname<t.cname)return-1
return 1}CmdParse.prototype.addServerCommands=function(e){var t=this.cmds_for_complete
if(this.cmds_for_complete===this.cmds){t=this.cmds_for_complete={}
for(var r in this.cmds)t[r]=this.cmds[r]}for(var a in e)if(!t[a])t[a]=e[a]}
CmdParse.prototype.autoComplete=function(e,t){var r=[]
var a=canonical((e=e.split(" "))[0])
this.last_access=t
for(var i in this.cmds_for_complete)if(1===e.length&&i.slice(0,a.length)===a||e.length>1&&i===a){var o=this.cmds_for_complete[i]
if(this.checkAccess(o.access_show)&&this.checkAccess(o.access_run))r.push({cname:i,cmd:o.name,help:String(o.help),usage:formatUsage(o.usage,o.help,o.prefix_usage_with_help)})}r.sort(cmpCmd)
return r}
CmdParse.prototype.canonical=canonical
CmdParse.prototype.TYPE_INT=g
CmdParse.prototype.TYPE_FLOAT=T
CmdParse.prototype.TYPE_STRING=a
function create(e){return new CmdParse(e)}},{"./perfcounters.js":393,"./util.js":400,assert:void 0}],380:[function(e,t,r){"use strict"
var i=new Array(256);(function(){for(var e=0;e<256;e++){var t=e
for(var r=0;r<8;r++)if(1&t)t=-306674912^t>>>1
else t>>>=1
i[e]=t}})()
function update_crc(e,t,r){for(var a=0;a<r;a++)e=i[255&(e^t[a])]^e>>>8
return e}function crc32(e,t){return(4294967295^update_crc(4294967295,e,t=t||e.length))>>>0}t.exports=crc32
t.exports.crc32=crc32},{}],381:[function(e,t,r){"use strict"
r.dataErrorEx=dataErrorEx
r.dataError=dataError
r.dataErrorQueueEnable=dataErrorQueueEnable
r.dataErrorOnError=dataErrorOnError
r.dataErrorQueueGet=dataErrorQueueGet
r.dataErrorQueueClear=dataErrorQueueClear
var a=e("assert")
var i=null
var o=false
var n=[]
var s=Object.create(null)
function dataErrorEx(e){if(!o)return
if(e.per_frame){if(s[e.msg])return
s[e.msg]=true}if(i)i(e)
n.push(e)
if(n.length>25){var t=n.splice(0,1)[0]
if(t.per_frame)delete s[t.msg]}}function dataError(e){dataErrorEx({msg:e})}function dataErrorQueueEnable(e){o=e}function dataErrorOnError(e){a(!i)
i=e}function dataErrorQueueGet(){return n}function dataErrorQueueClear(){n=[]
s=Object.create(null)}},{assert:void 0}],382:[function(e,t,r){"use strict"
r.typeof2=typeof2
r.differCreate=differCreate
r.diffApply=diffApply
r.diffPacketWrite=diffPacketWrite
r.diffPacketRead=diffPacketRead
var h=e("assert")
var p=e("./types").isDataObject
var m=e("./util").clone
var a=e("./dot-prop")
var n=a.dotPropDelete
var s=a.dotPropSet
var E=Math.max
function typeof2(e){if(null===e)return"null"
var t=typeof e
h("bigint"!==t&&"symbol"!==t&&"function"!==t)
if(!e)return t
if("object"===t&&Array.isArray(e))return"array"
return t}function path(e,t){return e?e+"."+t:String(t)}function walk(e,t,r,a){var i=typeof2(r)
if(i!==typeof2(a)){if(void 0===a)e.push([t])
else{a=m(a)
e.push([t,a])}return a}var o=e.length
if("object"===i){h(p(r))
h(p(a))
var n=Object.create(null)
var s={}
for(var l in r){n[l]=true
var _=walk(e,path(t,l),r[l],a[l])
if(void 0!==_)s[l]=_}for(var c in a)if(!n[c])s[c]=walk(e,path(t,c),r[c],a[c])
return o===e.length?r:s}else if("array"===i){h(Array.isArray(r))
h(Array.isArray(a))
var u=E(r.length,a.length)
var d=new Array(a.length)
for(var f=0;f<u;++f){var v=walk(e,path(t,f),r[f],a[f])
if(f<a.length)d[f]=v
else h.equal(v,void 0)}if(a.length<r.length)e.push([path(t,"length"),a.length])
return o===e.length?r:d}else{if(r!==a){e.push([t,a])
return a}return r}}var i=function(){function DifferImpl(e,t){this.data_last=void 0
this.history_size=void 0
this.history=[]
this.history_idx=0
this.history_max=-1
this.data_last=m(e)
this.history_size=t.history_size||0
if(this.data_last)this.historyPush()}var e=DifferImpl.prototype
e.historyPush=function historyPush(){if(this.history_size){this.history_max=this.history_idx
this.history[this.history_idx++%this.history_size]=this.data_last}}
e.update=function update(e){var t=[]
var r=walk(t,"",this.data_last,e)
if(t.length){this.data_last=r
this.historyPush()}return t}
e.canUndo=function canUndo(){return this.history_idx>1&&this.history_max-this.history_idx<this.history_size-2}
e.canRedo=function canRedo(){return this.history_idx<=this.history_max}
e.undo=function undo(){h(this.canUndo());--this.history_idx
var e=this.history[(this.history_idx-1)%this.history_size]
var t=[]
walk(t,"",this.data_last,e)
h(t.length)
this.data_last=e
return[t,m(e)]}
e.redo=function redo(){h(this.canRedo());++this.history_idx
var e=this.history[(this.history_idx-1)%this.history_size]
var t=[]
walk(t,"",this.data_last,e)
h(t.length)
this.data_last=e
return[t,m(e)]}
return DifferImpl}()
function differCreate(e,t){return new i(e,t)}function diffApply(e,t){for(var r=0;r<t.length;++r){var a=t[r],i=a[0],o=a[1]
if(void 0===o)n(e,i)
else s(e,i,o)}}function diffPacketWrite(e,t){for(var r=0;r<t.length;++r){var a=t[r]
e.writeAnsiString(a[0])
e.writeJSON(a[1])}e.writeAnsiString("")}function diffPacketRead(e){var t=[]
var r
while(r=e.readAnsiString()){var a=e.readJSON()
if(void 0===a)t.push([r])
else t.push([r,a])}return t}},{"./dot-prop":383,"./types":399,"./util":400,assert:void 0}],383:[function(e,t,r){"use strict"
r.dotPropGet=dotPropGet
r.dotPropSet=dotPropSet
r.dotPropDelete=dotPropDelete
r.dotPropHas=dotPropHas
var a=(0,e("./util.js").arrayToSet)(["__proto__","prototype","constructor"])
function isObject(e){var t=typeof e
return null!==e&&("object"===t||"function"===t)}function isValidPath(e){for(var t=0;t<e.length;++t)if(a[e[t]])return false
return true}function getPathSegments(e){var t=e.split(".")
var r=[]
for(var a=0;a<t.length;a++){var i=t[a]
while("\\"===i[i.length-1]&&void 0!==t[a+1]){i=i.slice(0,-1)+"."
i+=t[++a]}r.push(i)}if(!isValidPath(r))return[]
return r}function dotPropGet(e,t,r){if(!isObject(e)||"string"!==typeof t)return void 0===r?e:r
var a=getPathSegments(t)
if(0===a.length)return r
for(var i=0;i<a.length;i++)if(void 0===(e=e[a[i]])||null===e){if(i!==a.length-1)return r
break}return void 0===e?r:e}function dotPropSet(e,t,r){if(!isObject(e)||"string"!==typeof t)return e
var a=e
var i=getPathSegments(t)
for(var o=0;o<i.length;o++){var n=i[o]
if(o===i.length-1)e[n]=r
else if(!isObject(e[n]))e[n]={}
e=e[n]}return a}function dotPropDelete(e,t){if(!isObject(e)||"string"!==typeof t)return false
var r=getPathSegments(t)
for(var a=0;a<r.length;a++){var i=r[a]
if(a===r.length-1){delete e[i]
return true}if(!isObject(e=e[i]))return false}}function dotPropHas(e,t){if(!isObject(e)||"string"!==typeof t)return false
var r=getPathSegments(t)
if(0===r.length)return false
for(var a=0;a<r.length;a++)if(isObject(e)){if(!(r[a]in e))return false
e=e[r[a]]}else return false
return true}r.get=dotPropGet
r.set=dotPropSet
r.delete=dotPropDelete
r.has=dotPropHas},{"./util.js":400}],384:[function(e,t,r){"use strict"
r.entityCommonRegisterFieldEncoding=entityCommonRegisterFieldEncoding
r.EntityBaseCommon=r.EntityUpdateCmd=r.EntityFieldSpecial=r.EntityFieldSub=r.EntityFieldEncoding=r.EALF_HAS_ASSIGNMENTS=r.EALF_HAS_PAYLOAD=r.EALF_HAS_ENT_ID=r.EALF_HAS_PREDICATE=r.entity_field_decoders=r.entity_field_encoders=void 0
var a
var n={}
r.entity_field_encoders=n
var s={}
r.entity_field_decoders=s
var l=e("assert")
var i=1
r.EALF_HAS_PREDICATE=i
var o=2
r.EALF_HAS_ENT_ID=o
var _=4
r.EALF_HAS_PAYLOAD=_
var c=8
r.EALF_HAS_ASSIGNMENTS=c
var u={JSON:1,Int:2,Float:3,AnsiString:4,U8:5,U32:6,String:7,Boolean:8,Vec2:9,Vec3:10,U8Vec3:11,IVec3:12,Custom0:127}
r.EntityFieldEncoding=u
var d={None:0,Array:1,Record:2}
r.EntityFieldSub=d
var f={Terminate:0,Default:1,MAX:2}
r.EntityFieldSpecial=f
var v;(function(e){e[e["Terminate"]=0]="Terminate"
e[e["Full"]=1]="Full"
e[e["Diff"]=2]="Diff"
e[e["Delete"]=3]="Delete"
e[e["Event"]=4]="Event"
e[e["Schema"]=5]="Schema"
e[e["IsInitialList"]=6]="IsInitialList"})((r.EntityUpdateCmd=v)||(r.EntityUpdateCmd=v={}))
var h=function(){function EntityBaseCommon(e){this.id=void 0
this.data=void 0
this.entity_manager=void 0
this.data=e}EntityBaseCommon.prototype.getData=function getData(e){l(0)
return}
return EntityBaseCommon}()
r.EntityBaseCommon=h
function entityCommonRegisterFieldEncoding(e){for(var t in e){var r=Number(t)
var a=e[r]
var i=a.encoder
var o=a.decoder
l(!n[r])
n[r]=i
s[r]=o}}entityCommonRegisterFieldEncoding(((a={})[u.JSON]={encoder:function encJSON(e,t,r){t.writeJSON(r)},decoder:function decJSON(e,t){return e.readJSON()}},a[u.Int]={encoder:function encInt(e,t,r){t.writeInt(r)},decoder:function decInt(e,t){return e.readInt()}},a[u.Float]={encoder:function encFloat(e,t,r){t.writeFloat(r)},decoder:function decFloat(e,t){return e.readFloat()}},a[u.AnsiString]={encoder:function encAnsiString(e,t,r){t.writeAnsiString(r)},decoder:function decAnsiString(e,t){return e.readAnsiString()}},a[u.U8]={encoder:function encU8(e,t,r){t.writeU8(r)},decoder:function decU8(e,t){return e.readU8()}},a[u.U32]={encoder:function encU32(e,t,r){t.writeU32(r)},decoder:function decU32(e,t){return e.readU32()}},a[u.String]={encoder:function encString(e,t,r){t.writeString(r)},decoder:function decString(e,t){return e.readString()}},a[u.Boolean]={encoder:function encBool(e,t,r){t.writeBool(r)},decoder:function decBool(e,t){return e.readBool()}},a[u.Vec2]={encoder:function encVec2(e,t,r){var a=r
t.writeFloat(a[0])
t.writeFloat(a[1])},decoder:function decVec2(e,t){var r=t||[]
r[0]=e.readFloat()
r[1]=e.readFloat()
return r}},a[u.Vec3]={encoder:function encVec3(e,t,r){var a=r
t.writeFloat(a[0])
t.writeFloat(a[1])
t.writeFloat(a[2])},decoder:function decVec3(e,t){var r=t||[]
r[0]=e.readFloat()
r[1]=e.readFloat()
r[2]=e.readFloat()
return r}},a[u.U8Vec3]={encoder:function encU8Vec3(e,t,r){var a=r
t.writeU8(a[0])
t.writeU8(a[1])
t.writeU8(a[2])},decoder:function decU8Vec3(e,t){var r=t||[]
r[0]=e.readU8()
r[1]=e.readU8()
r[2]=e.readU8()
return r}},a[u.IVec3]={encoder:function encIVec3(e,t,r){var a=r
t.writeInt(a[0])
t.writeInt(a[1])
t.writeInt(a[2])},decoder:function decIVec3(e,t){var r=t||[]
r[0]=e.readInt()
r[1]=e.readInt()
r[2]=e.readInt()
return r}},a))},{assert:void 0}],385:[function(e,t,r){"use strict"
r.presenceActive=presenceActive
r.presenceVisible=presenceVisible
r.getStringEnumValues=getStringEnumValues
r.isValidNumberEnumKey=isValidNumberEnumKey
r.isValidStringEnumKey=isValidStringEnumKey
r.isValidStringEnumValue=isValidStringEnumValue
r.CHAT_FLAG_USERCHAT=r.CHAT_FLAG_EMOTE=r.PRESENCE_OFFLINE_INACTIVE=r.PRESENCE_INACTIVE=r.PRESENCE_ACTIVE=r.PRESENCE_OFFLINE=void 0
var a=0
r.PRESENCE_OFFLINE=a
var i=1
r.PRESENCE_ACTIVE=i
var o=2
r.PRESENCE_INACTIVE=o
var n=3
r.PRESENCE_OFFLINE_INACTIVE=n
function presenceActive(e){return!(e===o||e===n)}function presenceVisible(e){return!(e===a||e===n)}function getStringEnumValues(e){return Object.values(e)}function isValidNumberEnumKey(e,t){return"number"===typeof e[t]}function isValidStringEnumKey(e,t){return t in e}function isValidStringEnumValue(e,t){for(var r in e)if(e[r]===t)return true
return false}var s=1
r.CHAT_FLAG_EMOTE=s
var l=2
r.CHAT_FLAG_USERCHAT=l},{}],386:[function(e,t,r){"use strict"
r.setMetricsAdd=setMetricsAdd
r.executeWithRetry=executeWithRetry
var u=e("./perfcounters").perfCounterAdd
var a=Math.floor,d=Math.min,i=Math.random
var f
function setMetricsAdd(e){f=e}function randomNumber(e,t){return a(i()*(t-e+1))+e}function executeWithRetry(e,t,a){var i=t.max_retries
var o=t.inc_backoff_duration
var n=t.max_backoff
var s=t.log_prefix||"Log"
var l=t.quiet
var _=t.no_metrics
var c=0
function execute(){c++
e(function(e,t){if(!e){if(1!==c)console.info("[RETRY] "+s+" | ["+c+"] | Finally succeeded")
return a(null,t)}else{var r=(s.split(" | ")[0].replace(/ /g,"")||"unknown").toLowerCase()
if(c===i){(l?console.info:console.error)("[RETRY] "+s+" | [Retries exhausted] | "+e)
if(f&&!_)f("retry."+r+".fail",1)
return a(e)}if(f&&!_)f("retry."+r,1);(l?console.info:console.warn)("[RETRY] "+s+" | ["+c+"] | "+e)
u("retry."+s)
return setTimeout(execute,d(c*o,n)+randomNumber(100,300))}})}execute()}},{"./perfcounters":393}],387:[function(e,t,r){"use strict"
r.ERR_NOT_AVAILABLE=r.ERR_EMAIL_ALREADY_USED=r.ERR_SERVER=r.ERR_UNCONFIRMED_EMAIL=r.ERR_NO_USER_ID=r.ERR_UNAUTHORIZED=r.ERR_INVALID_PROVIDER=r.ERR_INVALID_DATA=void 0
var a="ERR_INVALID_DATA"
r.ERR_INVALID_DATA=a
var i="ERR_INVALID_PROVIDER"
r.ERR_INVALID_PROVIDER=i
var o="ERR_UNAUTHORIZED"
r.ERR_UNAUTHORIZED=o
var n="ERR_NO_USER_ID"
r.ERR_NO_USER_ID=n
var s="ERR_UNCONFIRMED_EMAIL"
r.ERR_UNCONFIRMED_EMAIL=s
var l="ERR_SERVER"
r.ERR_SERVER=l
var _="ERR_EMAIL_ALREADY_USED"
r.ERR_EMAIL_ALREADY_USED=_
var c="ERR_NOT_AVAILABLE"
r.ERR_NOT_AVAILABLE=c},{}],388:[function(e,t,r){"use strict"
r.FriendStatus=void 0
var a;(function(e){e[e["Added"]=1]="Added"
e[e["AddedAuto"]=2]="AddedAuto"
e[e["Removed"]=3]="Removed"
e[e["Blocked"]=4]="Blocked"})((r.FriendStatus=a)||(r.FriendStatus=a={}))},{}],389:[function(e,t,r){"use strict"
r.fileBaseName=fileBaseName
function fileBaseName(e){var t=e.lastIndexOf("/")
if(-1!==t)e=e.slice(t+1)
if(-1!==(t=e.indexOf(".")))e=e.slice(0,t)
return e}},{}],390:[function(e,t,r){"use strict"
var O=e("assert")
function stringUtf8Encode(e){var t
var r
var a=[]
e=e.replace(/\r\n/g,"\n")
for(r=0;r<e.length;++r)if((t=e.charCodeAt(r))<128)a.push(String.fromCharCode(t))
else if(t>127&&t<2048){a.push(String.fromCharCode(t>>6|192))
a.push(String.fromCharCode(63&t|128))}else{a.push(String.fromCharCode(t>>12|224))
a.push(String.fromCharCode(t>>6&63|128))
a.push(String.fromCharCode(63&t|128))}return a.join("")}function rotateLeft(e,t){return e<<t|e>>>32-t}function addUnsigned(e,t){var r=2147483648&e
var a=2147483648&t
var i=1073741824&e
var o=1073741824&t
var n=(1073741823&e)+(1073741823&t)
if(i&o)return 2147483648^n^r^a
if(i|o)if(1073741824&n)return 3221225472^n^r^a
else return 1073741824^n^r^a
else return n^r^a}function F(e,t,r){return e&t|~e&r}function G(e,t,r){return e&r|t&~r}function H(e,t,r){return e^t^r}function I(e,t,r){return t^(e|~r)}function FF(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(F(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function GG(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(G(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function HH(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(H(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function II(e,t,r,a,i,o,n){e=addUnsigned(e,addUnsigned(addUnsigned(I(t,r,a),i),n))
return addUnsigned(rotateLeft(e,o),t)}function convertToWordArray(e){var t=e.length
var r=t+8
var a=16*((r-r%64)/64+1)
var i=new Array(a-1)
var o=0
var n=0
while(n<t){o=n%4*8
i[(n-n%4)/4]|=e.charCodeAt(n)<<o
n++}i[(n-n%4)/4]|=128<<(o=n%4*8)
i[a-2]=t<<3
i[a-1]=t>>>29
return i}function wordToHex(e){var t=""
var r=""
var a
for(a=0;a<=3;a++)t+=(r="0"+(e>>>8*a&255).toString(16)).substr(r.length-2,2)
return t}t.exports=function md5(e){var t
var r
var a
var i
var o
var n
var s
var l
var _
var c=7
var u=12
var d=17
var f=22
var v=5
var h=9
var p=14
var m=20
var E=4
var g=11
var T=16
var y=23
var S=6
var I=10
var A=15
var w=21
var L
if("string"===typeof e)L=convertToWordArray(e=stringUtf8Encode(e))
else O(false)
o=1732584193
n=4023233417
s=2562383102
l=271733878
for(_=0;_<L.length;_+=16){o=FF(t=o,r=n,a=s,i=l,L[_],c,3614090360)
l=FF(l,o,n,s,L[_+1],u,3905402710)
s=FF(s,l,o,n,L[_+2],d,606105819)
n=FF(n,s,l,o,L[_+3],f,3250441966)
o=FF(o,n,s,l,L[_+4],c,4118548399)
l=FF(l,o,n,s,L[_+5],u,1200080426)
s=FF(s,l,o,n,L[_+6],d,2821735955)
n=FF(n,s,l,o,L[_+7],f,4249261313)
o=FF(o,n,s,l,L[_+8],c,1770035416)
l=FF(l,o,n,s,L[_+9],u,2336552879)
s=FF(s,l,o,n,L[_+10],d,4294925233)
n=FF(n,s,l,o,L[_+11],f,2304563134)
o=FF(o,n,s,l,L[_+12],c,1804603682)
l=FF(l,o,n,s,L[_+13],u,4254626195)
s=FF(s,l,o,n,L[_+14],d,2792965006)
o=GG(o,n=FF(n,s,l,o,L[_+15],f,1236535329),s,l,L[_+1],v,4129170786)
l=GG(l,o,n,s,L[_+6],h,3225465664)
s=GG(s,l,o,n,L[_+11],p,643717713)
n=GG(n,s,l,o,L[_],m,3921069994)
o=GG(o,n,s,l,L[_+5],v,3593408605)
l=GG(l,o,n,s,L[_+10],h,38016083)
s=GG(s,l,o,n,L[_+15],p,3634488961)
n=GG(n,s,l,o,L[_+4],m,3889429448)
o=GG(o,n,s,l,L[_+9],v,568446438)
l=GG(l,o,n,s,L[_+14],h,3275163606)
s=GG(s,l,o,n,L[_+3],p,4107603335)
n=GG(n,s,l,o,L[_+8],m,1163531501)
o=GG(o,n,s,l,L[_+13],v,2850285829)
l=GG(l,o,n,s,L[_+2],h,4243563512)
s=GG(s,l,o,n,L[_+7],p,1735328473)
o=HH(o,n=GG(n,s,l,o,L[_+12],m,2368359562),s,l,L[_+5],E,4294588738)
l=HH(l,o,n,s,L[_+8],g,2272392833)
s=HH(s,l,o,n,L[_+11],T,1839030562)
n=HH(n,s,l,o,L[_+14],y,4259657740)
o=HH(o,n,s,l,L[_+1],E,2763975236)
l=HH(l,o,n,s,L[_+4],g,1272893353)
s=HH(s,l,o,n,L[_+7],T,4139469664)
n=HH(n,s,l,o,L[_+10],y,3200236656)
o=HH(o,n,s,l,L[_+13],E,681279174)
l=HH(l,o,n,s,L[_],g,3936430074)
s=HH(s,l,o,n,L[_+3],T,3572445317)
n=HH(n,s,l,o,L[_+6],y,76029189)
o=HH(o,n,s,l,L[_+9],E,3654602809)
l=HH(l,o,n,s,L[_+12],g,3873151461)
s=HH(s,l,o,n,L[_+15],T,530742520)
o=II(o,n=HH(n,s,l,o,L[_+2],y,3299628645),s,l,L[_],S,4096336452)
l=II(l,o,n,s,L[_+7],I,1126891415)
s=II(s,l,o,n,L[_+14],A,2878612391)
n=II(n,s,l,o,L[_+5],w,4237533241)
o=II(o,n,s,l,L[_+12],S,1700485571)
l=II(l,o,n,s,L[_+3],I,2399980690)
s=II(s,l,o,n,L[_+10],A,4293915773)
n=II(n,s,l,o,L[_+1],w,2240044497)
o=II(o,n,s,l,L[_+8],S,1873313359)
l=II(l,o,n,s,L[_+15],I,4264355552)
s=II(s,l,o,n,L[_+6],A,2734768916)
n=II(n,s,l,o,L[_+13],w,1309151649)
o=II(o,n,s,l,L[_+4],S,4149444226)
l=II(l,o,n,s,L[_+11],I,3174756917)
s=II(s,l,o,n,L[_+2],A,718787259)
n=II(n,s,l,o,L[_+9],w,3951481745)
o=addUnsigned(o,t)
n=addUnsigned(n,r)
s=addUnsigned(s,a)
l=addUnsigned(l,i)}return(wordToHex(o)+wordToHex(n)+wordToHex(s)+wordToHex(l)).toLowerCase()}},{assert:void 0}],391:[function(e,t,r){"use strict"
r.DISPLAY_NAME_MAX_VISUAL_SIZE=r.DISPLAY_NAME_MAX_LENGTH=void 0
var a=30
r.DISPLAY_NAME_MAX_LENGTH=a
var i={font_height:24,width:240}
r.DISPLAY_NAME_MAX_VISUAL_SIZE=i},{}],392:[function(R,e,b){(function(O){(function(){"use strict"
b.packetBufPoolAlloc=packetBufPoolAlloc
b.packetBufPoolFree=packetBufPoolFree
b.packetDefaultFlags=packetDefaultFlags
b.packetEnableDebug=packetEnableDebug
b.packetSizeInt=packetSizeInt
b.packetReadIntFromBuffer=packetReadIntFromBuffer
b.packetSizeAnsiString=packetSizeAnsiString
var i=b.PACKET_DEBUG=1
var e=b.PACKET_RESERVED1=2
var t=b.PACKET_RESERVED2=4
var l=i|e|t
var n=256
var _=R("assert")
var s=Math.max
var r=R("./util.js"),a=r.deprecate,o=r.isInteger,c=r.log2
var u=R("./base64.js"),d=u.base64Encode,f=u.base64Decode
a(b,"default_flags")
var v=[void 0,null,0,false,"",NaN]
var h=1024
var p="PKTERR_UNDERRUN"
var m=5e3
var E=5e3
var g=[0,10,10,20,20,20,20,20,20,20,5e3,20,20,20,20,20,20,10,10]
var T=[]
var y=[]
var S=g.map(function(){return[]})
function allocDataView(e){var t=c(e)
_(t)
if(t>=S.length)t=0
if(t){e=1<<t
if(S[t].length)return S[t].pop()}var r=new Uint8Array(e)
var a=new DataView(r.buffer)
a.u8=r
if(t)a.packet_pool_idx=t
return a}function wrapU8AsDataView(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength)
t.u8=e
return t}function utf8ByteLength(e){var t=e.length
var r=t
for(var a=0;a<t;++a){var i=e.charCodeAt(a)
if(i>127){++r
if(i>2047){++r
if(i>65535){++r
if(i>2097151){++r
if(i>67108863)++r}}}}}return r}function utf8WriteChar(e,t,r){if(r>1114111)r=65535
if(r<=127)e.u8[t++]=r
else if(r<=2047){e.u8[t++]=r>>6|192
e.u8[t++]=63&r|128}else if(r<=65535){e.u8[t++]=r>>12|224
e.u8[t++]=r>>6&63|128
e.u8[t++]=63&r|128}else if(r<=1114111){e.u8[t++]=r>>18|240
e.u8[t++]=r>>12&63|128
e.u8[t++]=r>>6&63|128
e.u8[t++]=63&r|128}else _(false)
return t}function poolBuf(e){_(e)
_(e.u8)
var t=e.packet_pool_idx
if(t){var r=S[t]
if(r.length<g[t])r.push(e)}}function packetBufPoolAlloc(e){return allocDataView(e)}function packetBufPoolFree(e){poolBuf(e)}var I=0
function packetDefaultFlags(){return I}function packetEnableDebug(e){if(e)I|=i}function Packet(e,t,r){this.reinit(e,t,r)}Packet.prototype.reinit=function(e,t,r){this.flags=e||0
this.has_flags=false
this.buf=null
this.buf_len=0
this.buf_offs=0
this.bufs=null
this.bsizes=null
this.readable=false
this.ref_count=1
this.pak_debug=r
if(t){this.fit(t,true)
this.buf_len=t}}
Packet.prototype.getRefCount=function(){return this.ref_count}
Packet.prototype.ref=function(){_(this.ref_count);++this.ref_count}
Packet.prototype.pool=function(){_(this.ref_count)
if(--this.ref_count)return
if(this.flags&n);else{if(this.buf)poolBuf(this.buf)
if(this.bufs)for(var e=0;e<this.bufs.length;++e)poolBuf(this.bufs[e])}if(T.length<m)T.push(this)
if(this.pak_debug)this.pak_debug.poolDebug()}
Packet.prototype.totalSize=function(){var e=0
if(this.readable)return this.buf_len
if(this.bsizes)for(var t=0;t<this.bsizes.length;++t)e+=this.bsizes[t]
return e+this.buf_offs}
Packet.prototype.setReadable=function(){_(this.buf)
_(!this.bufs)
_(!this.readable)
this.readable=true}
Packet.prototype.makeReadable=function(){_(this.buf)
_(!this.readable)
var e=this.totalSize()
this.readable=true
if(!this.bufs){this.buf_len=e
this.buf_offs=0
return}var t=allocDataView(e)
var r=t.u8
var a=0
for(var i=0;i<this.bufs.length;++i){var o=this.bsizes[i]
var n=this.bufs[i]
if(a+n.u8.length>e){_.equal(n.byteOffset,0)
r.set(new Uint8Array(n.buffer,0,o),a)}else r.set(n.u8,a)
a+=o
poolBuf(n)}_.equal(this.buf.byteOffset,0)
r.set(new Uint8Array(this.buf.buffer,this.buf.byteOffset,this.buf_offs),a)
poolBuf(this.buf)
_.equal(a+this.buf_offs,e)
this.bufs=this.bsizes=null
this.buf=t
this.buf_offs=0
this.buf_len=e}
Packet.prototype.flush=function(){var e=this.buf,t=this.buf_offs
if(!this.bufs){this.bufs=[e]
this.bsizes=[t]}else{this.bufs.push(e)
this.bsizes.push(t)}this.buf=null
this.buf_len=0
this.buf_offs=0}
Packet.prototype.fit=function(e,t){var r=this.buf,a=this.buf_len,i=this.buf_offs
var o=i+e
if(o<=a){if(!t)this.buf_offs=o
return i}_(!this.readable)
if(r)this.flush()
this.buf_len=a=s(h,e)
this.buf=allocDataView(a)
this.buf_offs=t?0:e
return 0}
Packet.prototype.advance=function(e){var t=this.buf_offs
var r=t+e
if((this.buf_offs=r)>this.buf_len)throw new Error(p)
if(r===this.buf_len)this.pool()
return t}
Packet.prototype.ended=function(){return this.buf_offs===this.buf_len}
Packet.prototype.writeU8=function(e){_(e>=0&&e<256)
var t=this.fit(1)
this.buf.u8[t]=e}
Packet.prototype.readU8=function(){return this.buf.u8[this.advance(1)]}
function packetSizeInt(e){_(o(e))
var t=e<0?1:0
if(t)e=-e
if(e<248){if(t)return 2
return 1}else if(e<65536)return 3
else if(e<4294967296)return 5
else return 9}Packet.prototype.writeInt=function(e){_(o(e))
var t=this.fit(9,true)
var r=this.buf
var a=e<0?1:0
if(a)e=-e
if(e<248){if(a)r.u8[t++]=255
r.u8[t++]=e}else if(e<65536){r.u8[t++]=248+a
r.setUint16(t,e,true)
t+=2}else if(e<4294967296){r.u8[t++]=250+a
r.setUint32(t,e,true)
t+=4}else{r.u8[t++]=252+a
var i=e>>>0
r.setUint32(t,i,true)
r.setUint32(t+=4,(e-i)/4294967296,true)
t+=4}this.buf_offs=t}
Packet.prototype.zeroInt=function(){var e=this.buf.u8[this.buf_offs]
if(e<248){this.buf.u8[this.buf_offs++]=0
return}this.buf_offs++
var t
switch(e){case 253:case 252:t=8
break
case 251:case 250:t=4
break
case 249:case 248:t=2
break
case 255:t=1
break
default:throw new Error("PKTERR_PACKED_INT")}while(t){--t
this.buf.u8[this.buf_offs++]=0}}
function packetReadIntFromBuffer(e,t,r){if(r-t<1)return null
var a=e[t++]
if(a<248)return{v:a,offs:t}
var i=1
switch(a){case 249:i=-1
case 248:if(r-t<2)return null
return{v:i*e.readUInt16LE(t),offs:t+=2}
case 251:i=-1
case 250:if(r-t<4)return null
return{v:i*e.readUInt32LE(t),offs:t+=4}
case 253:i=-1
case 252:if(r-t<8)return null
var o=e.readUInt32LE(t)
return{v:i*(4294967296*e.readUInt32LE(t+=4)+o),offs:t+=4}
case 255:if(r-t<1)return null
return{v:-e[t++],offs:t}
default:throw new Error("PKTERR_PACKED_INT")}}Packet.prototype.readInt=function(){var e=this.buf.u8[this.advance(1)]
if(e<248)return e
var t=1
switch(e){case 249:t=-1
case 248:return t*this.buf.getUint16(this.advance(2),true)
case 251:t=-1
case 250:return t*this.buf.getUint32(this.advance(4),true)
case 253:t=-1
case 252:var r=this.buf.getUint32(this.advance(4),true)
return t*(4294967296*this.buf.getUint32(this.advance(4),true)+r)
case 255:return-this.buf.u8[this.advance(1)]
default:throw new Error("PKTERR_PACKED_INT")}}
Packet.prototype.writeFloat=function(e){_.equal(typeof e,"number")
if(!e){this.buf.u8[this.fit(1)]=0
return}var t=this.fit(5,true)
this.buf.setFloat32(t,e,true)
if(this.buf.u8[t]<=1){this.buf.u8[t++]=1
this.buf.setFloat32(t,e,true)}this.buf_offs=t+4}
Packet.prototype.readFloat=function(){var e=this.advance(1)
var t=this.buf.u8[e]
if(!t)return 0
if(1===t)return this.buf.getFloat32(this.advance(4),true)
this.advance(3)
return this.buf.getFloat32(e,true)}
Packet.prototype.writeU32=function(e){_.equal(typeof e,"number")
this.buf.setUint32(this.fit(4),e,true)}
Packet.prototype.readU32=function(){return this.buf.getUint32(this.advance(4),true)}
Packet.prototype.writeString=function(e){_.equal(typeof e,"string")
var t=utf8ByteLength(e)
this.writeInt(t)
if(!t)return
var r=this.fit(t)
var a=this.buf
for(var i=0;i<e.length;++i){var o=e.charCodeAt(i)
if(o<=127)a.u8[r++]=o
else r=utf8WriteChar(a,r,o)}}
Packet.prototype.utf8ReadChar=function(e){var t=this.buf
if(e>=192&&e<224)return(31&e)<<6|63&t.u8[this.buf_offs++]
else if(e>=224&&e<240)return(15&e)<<12|(63&t.u8[this.buf_offs++])<<6|63&t.u8[this.buf_offs++]
else if(e>=240&&e<248)return(15&e)<<18|(63&t.u8[this.buf_offs++])<<12|(63&t.u8[this.buf_offs++])<<6|63&t.u8[this.buf_offs++]
else return 65533}
var A=[]
Packet.prototype.readString=function(){var e=this.readInt()
if(!e)return""
if(this.buf_offs+e>this.buf_len)throw new Error(p)
var t=this.buf
var r=this.buf_offs+e
var a
if(e>8192){a=""
while(this.buf_offs<r){var i=t.u8[this.buf_offs++]
if(i>127)i=this.utf8ReadChar(i)
a+=String.fromCharCode(i)}}else{A.length=e
var o=0
while(this.buf_offs<r){var n=t.u8[this.buf_offs++]
if(n>127)n=this.utf8ReadChar(n)
A[o++]=n}if(A.length!==o)A.length=o
a=String.fromCharCode.apply(void 0,A)}if(this.buf_offs===this.buf_len)this.pool()
return a}
Packet.prototype.writeAnsiString=function(e){_.equal(typeof e,"string")
var t=e.length
this.writeInt(t)
var r=this.fit(t)
var a=this.buf
for(var i=0;i<t;++i)a.u8[r++]=e.charCodeAt(i)}
Packet.prototype.readAnsiString=function(){var e=this.readInt()
if(!e)return""
var t=this.advance(e)
var r=this.buf
A.length=e
for(var a=0;a<e;++a)A[a]=r.u8[t++]
return String.fromCharCode.apply(void 0,A)}
function packetSizeAnsiString(e){return packetSizeInt(e.length)+e.length}Packet.prototype.writeJSON=function(e){if(!e){var t=v.indexOf(e)
_(-1!==t)
this.writeU8(t+1)
return}this.writeU8(0)
this.writeString(JSON.stringify(e))}
Packet.prototype.readJSON=function(){var e=this.readU8()
if(e){if(e-1>=v.length)throw new Error("PKTERR_JSON_HEADER")
return v[e-1]}var t=this.readString()
return JSON.parse(t)}
Packet.prototype.writeBuffer=function(e){this.writeInt(e.length)
if(e.length){var t=this.fit(e.length)
this.buf.u8.set(e,t)}}
var w=new Uint8Array(0)
Packet.prototype.readBuffer=function(e){var t=this.readInt()
if(!t)return w
var r=this.advance(t)
if(e)return this.buf.u8.slice(r,r+t)
else{var a=this.buf
return new Uint8Array(a.buffer,a.byteOffset+r,t)}}
Packet.prototype.appendBuffer=function(e){if(e.length){var t=this.fit(e.length)
this.buf.u8.set(e,t)}}
Packet.prototype.writeBool=function(e){this.writeU8(e?1:0)}
Packet.prototype.readBool=function(){return Boolean(this.readU8())}
Packet.prototype.append=function(e){_.equal(this.flags&l,e.flags&l)
if(e.bufs)for(var t=0;t<e.bufs.length;++t){var r=e.bufs[t]
var a=e.bsizes[t]
var i=this.fit(a)
if(a!==r.byteLength)this.buf.u8.set(new Uint8Array(r.buffer,r.byteOffset,a),i)
else this.buf.u8.set(r.u8,i)}if(e.buf){var o=e.buf
var n=e.readable?e.buf_len:e.buf_offs
var s=this.fit(n)
if(n!==o.byteLength)this.buf.u8.set(new Uint8Array(o.buffer,o.byteOffset,n),s)
else this.buf.u8.set(o.u8,s)}}
Packet.prototype.appendRemaining=function(e){_.equal(this.flags&l,e.flags&l)
_(e.readable)
_(!e.bufs)
_(e.buf)
_(e.buf_offs<=e.buf_len)
var t=e.buf_len-e.buf_offs
if(t){var r=this.fit(t)
this.buf.u8.set(new Uint8Array(e.buf.buffer,e.buf.byteOffset+e.buf_offs,t),r)}e.pool()}
Packet.prototype.toJSON=function(){var e={f:this.flags}
if(this.bufs){e.b=[]
for(var t=0;t<this.bufs.length;++t)e.b.push(d(this.bufs[t],0,this.bsizes[t]))}if(this.buf)if(this.readable)e.d=d(this.buf,0,this.buf_len)
else e.d=d(this.buf,0,this.buf_offs)
return e}
Packet.prototype.setBuffer=function(e,t){_(!this.buf)
_(!this.bufs)
_(this.flags&n)
_(e instanceof Uint8Array)
this.buf=wrapU8AsDataView(e)
this.buf_len=t
this.readable=true}
Packet.prototype.getBuffer=function(){_(this.buf)
_(!this.bufs)
return this.buf.u8}
Packet.prototype.getBufferLen=function(){_(this.buf)
_(!this.bufs)
return this.readable?this.buf_len:this.buf_offs}
Packet.prototype.getOffset=function(){if(this.readable)return this.buf_offs
return this.totalSize()}
Packet.prototype.seek=function(e){_(this.readable)
_(e>=0&&e<=this.buf_len)
this.buf_offs=e}
Packet.prototype.writeFlags=function(){_(!this.has_flags)
_.equal(this.buf_offs,0)
this.writeU8(this.flags)
this.has_flags=true}
Packet.prototype.updateFlags=function(e){_(this.has_flags)
_(!(e&l))
this.flags=this.flags&l|e;(this.bufs?this.bufs[0]:this.buf).u8[0]=this.flags}
Packet.prototype.readFlags=function(){var e=this.readU8()
_.equal(e,255&this.flags)
this.has_flags=true
return this.flags}
Packet.prototype.getFlags=function(){return this.flags}
Packet.prototype.getInternalFlags=function(){return this.flags&l}
Packet.prototype.contents=function(){return"pak("+this.totalSize()+"b)"}
function PacketDebug(e,t){this.reinit(e,t)}PacketDebug.prototype.reinit=function(e,t){var r=this
this.in_pool=false
if(T.length){this.pak=T.pop()
this.pak.reinit(e,t,this)}else this.pak=new Packet(e,t,this)
this.warned=false
this.pool_timer=setTimeout(function(){console.warn("Packet not pooled after 5s: "+r.contents())
r.warned=true},E)}
PacketDebug.prototype.poolDebug=function(){if(this.warned)console.warn("Packet pooled after timeout")
else clearTimeout(this.pool_timer)
_(!this.in_pool)
this.in_pool=true
if(y.length<m)y.push(this)}
var L=[null,"U8","U32","Int","Float","String","AnsiString","JSON","Bool","Buffer"]
L.forEach(function(r,a){if(!r)return
var e="write"+r
var t="read"+r
var i=Packet.prototype[e]
var o=Packet.prototype[t]
PacketDebug.prototype[e]=function(e){this.pak.writeU8(a)
i.call(this.pak,e)}
PacketDebug.prototype[t]=function(e){var t=this.pak.readU8()
if(t!==a)_(false,"PacketDebug error: Expected "+r+"("+a+"), found "+L[t]+"("+t+")")
return o.call(this.pak,e)}})
PacketDebug.prototype.zeroInt=function(){this.pak.writeU8(3)
this.pak.zeroInt()};["ended","getBuffer","getBufferLen","getFlags","getInternalFlags","getOffset","getRefCount","makeReadable","pool","readFlags","ref","seek","setBuffer","setReadable","toJSON","totalSize","updateFlags","writeFlags","appendBuffer"].forEach(function(e){var t=Packet.prototype[e]
PacketDebug.prototype[e]=function(){return t.apply(this.pak,arguments)}})
PacketDebug.prototype.append=function(e){_(e instanceof PacketDebug)
this.pak.append(e.pak)}
PacketDebug.prototype.appendRemaining=function(e){_(e instanceof PacketDebug)
this.pak.appendRemaining(e.pak)}
function format(e){switch(typeof e){case"object":if(e instanceof Uint8Array)return"u8<"+e.length+">"
return JSON.stringify(e)
default:return e}}PacketDebug.prototype.contents=function(){var e=this.pak
var t=e.getOffset()
var r=t
var a=["buf:"+e.buf_offs+"/"+e.buf_len]
if(e.bufs){e.makeReadable()
a.push("bufs")}else if(e.buf){if(e.readable)r=e.buf_len
e.buf_offs=0}else{a.push("empty")
r=-1}var i=e.ref_count
e.ref_count=2
try{if(!i)a.push("!ref_count=0!")
if(e.has_flags)a.push("flags:"+e.readU8())
while(e.buf_offs<r){var o=e.readU8()
var n=L[o]
if(!n){a.push("UnknownType:"+o)
break}var s=e["read"+n]()
a.push(n+":"+format(s))}}catch(e){a.push("Error dumping packet contents: "+e)}e.ref_count=i
e.buf_offs=t
return a.join(",")}
function packetCreate(e,t){if(void 0===e)e=I
var r=e&i?y:T
if(r.length){var a=r.pop()
a.reinit(e,t)
return a}if(e&i)return new PacketDebug(e,t)
return new Packet(e,t)}b.packetCreate=packetCreate
function packetFromBuffer(e,t,r){var a=e[0]
_.equal(typeof a,"number")
if(r){_(t)
_(e.buffer instanceof ArrayBuffer)
var i=packetCreate(a,t)
if(e.byteLength!==t)e=O.from(e.buffer,e.byteOffset,t)
i.getBuffer().set(e)
i.setReadable()
return i}else{_(e instanceof Uint8Array)
var o=packetCreate(a|n)
o.setBuffer(e,t||e.byteLength)
return o}}b.packetFromBuffer=packetFromBuffer
function packetFromJSON(e){var t=packetCreate(e.f)
var r=t.pak||t
function decode(e){return f(e,allocDataView)}if(e.b){r.bsizes=[]
r.bufs=[]
for(var a=0;a<e.b.length;++a){var i=decode(e.b[a])
r.bufs.push(i)
r.bsizes.push(i.decode_size)
delete i.decode_size}}if(e.d){r.buf=decode(e.d)
r.buf_len=r.buf.decode_size
delete r.buf.decode_size
r.buf_offs=0}return t}b.packetFromJSON=packetFromJSON
function isPacket(e){return e instanceof Packet||e instanceof PacketDebug}b.isPacket=isPacket}).call(this)}).call(this,R("buffer").Buffer)},{"./base64.js":377,"./util.js":400,assert:void 0,buffer:void 0}],393:[function(e,t,r){"use strict"
r.perfCounterSetBucketTime=perfCounterSetBucketTime
r.perfCounterAdd=perfCounterAdd
r.perfCounterAddValue=perfCounterAddValue
r.perfCounterTick=perfCounterTick
r.perfCounterHistory=perfCounterHistory
var a=5
var i={time_start:Date.now()}
var o=[i]
var n=1e4
var s=n
function perfCounterSetBucketTime(e){s=n=e}function perfCounterAdd(e){i[e]=(i[e]||0)+1}function perfCounterAddValue(e,t){i[e]=(i[e]||0)+t}function perfCounterTick(e,t){if((s-=e)<=0){s=n
if(o.length===a)o.splice(0,1)
var r=Date.now()
i.time_end=r
if(t)t(i);(i={}).time_start=r
o.push(i)}}function perfCounterHistory(){return o}},{}],394:[function(e,t,r){"use strict"
r.platformRegister=platformRegister
r.platformGetValidIDs=platformGetValidIDs
r.platformIsValid=platformIsValid
r.platformParameter=platformParameter
r.platformOverrideParameter=platformOverrideParameter
var i=e("assert")
var o=Object.create(null)
var a=false
function platformRegister(e,t){i(!a)
i(!o[e]||"web"===e)
o[e]=t}function platformGetValidIDs(){return Object.keys(o)}function platformIsValid(e){a=true
return Boolean("string"===typeof e&&o[e])}var n=Object.create(null)
function platformParameter(e,t){var r=n[t]
if(void 0!==r)return r
var a=o[e]
i(a)
return a[t]}function platformOverrideParameter(e,t){n[e]=t}platformRegister("web",{devmode:"auto",reload:true,reload_updates:true,random_creation_name:false})},{assert:void 0}],395:[function(e,t,r){"use strict"
r.mashString=mashString
r.mashI53=mashI53
r.randCreate=randCreate
r.shuffleArray=shuffleArray
function mashString(e){var t=4022871197
for(var r=0;r<e.length;r++){var a=.02519603282416938*(t+=e.charCodeAt(r))
a-=t=a>>>0
t=(a*=t)>>>0
t+=4294967296*(a-=t)}return t>>>0}function mashI53(e){var t=4022871197
while(e){var r=e%256
e=(e-r)/256
var a=.02519603282416938*(t+=r)
a-=t=a>>>0
t=(a*=t)>>>0
t+=4294967296*(a-=t)}return 2.3283064365386963e-10*(t>>>0)}function Mash(){this.n=3228327880}Mash.prototype.mash=function(e){var t=this.n+e
var r=.02519603282416938*t
r-=t=r>>>0
t=(r*=t)>>>0
return 2.3283064365386963e-10*((this.n=t+=4294967296*(r-=t))>>>0)}
function Alea(e){this.reseed(e)}Alea.prototype.reseed=function(e){if(e>=4294967296)e=mashI53(e)
this.c=1
var t=new Mash
this.s0=.3014581324532628
this.s1=.2643220406025648
this.s2=.7516536582261324
this.s0-=t.mash(e)
if(this.s0<0)this.s0+=1
this.s1-=t.mash(e)
if(this.s1<0)this.s1+=1
this.s2-=t.mash(e)
if(this.s2<0)this.s2+=1}
Alea.prototype.step=function(){var e=2091639*this.s0+2.3283064365386963e-10*this.c
this.s0=this.s1
this.s1=this.s2
return this.s2=e-(this.c=0|e)}
Alea.prototype.uint32=function(){return 4294967296*this.step()}
Alea.prototype.fract53=function(){return this.step()+11102230246251565e-32*(2097152*this.step()|0)}
Alea.prototype.random=Alea.prototype.step
Alea.prototype.range=function(e){return this.step()*e|0}
Alea.prototype.floatBetween=function(e,t){return e+(t-e)*this.random()}
Alea.prototype.exportState=function(){return[this.s0,this.s1,this.s2,this.c]}
Alea.prototype.importState=function(e){this.s0=e[0]
this.s1=e[1]
this.s2=e[2]
this.c=e[3]}
function randCreate(e){return new Alea(e)}function shuffleArray(e,t){for(var r=t.length-1;r>=1;--r){var a=e.range(r+1)
var i=t[r]
t[r]=t[a]
t[a]=i}}},{}],396:[function(e,t,r){"use strict"
r.FORMAT_PACK=1
r.FORMAT_PNG=2
r.TEXPACK_MAGIC=2403967826},{}],397:[function(e,t,r){"use strict"
var o=e("assert")
function EventEmitter(){this._listeners={}}t.exports=EventEmitter
Object.defineProperty(t.exports,"EventEmitter",{value:EventEmitter,enumerable:false})
function addListener(e,t,r,a){o("function"===typeof r)
var i=e._listeners[t]
if(!i)i=e._listeners[t]=[]
i.push({once:a,fn:r})}EventEmitter.prototype.hasListener=function(e,t){var r=this._listeners[e]
if(!r)return false
for(var a=0;a<r.length;++a)if(r[a].fn===t)return true
return false}
EventEmitter.prototype.on=function(e,t){addListener(this,e,t,0)
return this}
EventEmitter.prototype.once=function(e,t){addListener(this,e,t,1)
return this}
EventEmitter.prototype.removeListener=function(e,t){var r=this._listeners[e]
o(r)
for(var a=0;a<r.length;++a)if(r[a].fn===t){r.splice(a,1)
return this}o(false)
return this}
function filterNotOnce(e){return!e.once}EventEmitter.prototype.emit=function(e){var t=this._listeners[e]
if(!t)return false
var r=false
var a=false
for(var i=arguments.length,o=new Array(i>1?i-1:0),n=1;n<i;n++)o[n-1]=arguments[n]
for(var s=0;s<t.length;++s){var l=t[s]
r=true
l.fn.apply(l,o)
if(l.once)a=true}if(a)this._listeners[e]=t.filter(filterNotOnce)
return r}},{assert:void 0}],398:[function(require,module,exports){"use strict"
exports.traitFactoryCreate=traitFactoryCreate
var assert=require("assert")
var _data_error=require("./data_error")
var dataError=_data_error.dataError
var _fsapi=require("./fsapi")
var fileBaseName=_fsapi.fileBaseName
var _util=require("./util")
var clone=_util.clone
var defaultsDeep=_util.defaultsDeep
var inherits=_util.inherits
function pascalCase(e){return e.replace(/((?:^|[-_])[a-z])/g,function(e){return e.toUpperCase().replace(/[-_]/g,"")})}var TraitFactoryImpl=function(){function TraitFactoryImpl(){this.ignore_unknown_traits=false
this.initialized=false
this.traits={}
this.name=void 0
this.BaseCtor=void 0
this.ctors={}}var _proto=TraitFactoryImpl.prototype
_proto.registerTrait=function registerTrait(e,t){assert(!this.initialized)
assert(!this.traits[e])
this.traits[e]=t}
_proto.extendTrait=function extendTrait(e,t){assert(!this.initialized)
var r=this.traits[e]
assert(r)
this.traits[e]=defaultsDeep(t,r)}
_proto.buildConstructor=function buildConstructor(filename,BaseCtor,type_id,type_def){var cap_classes="undefined"===typeof window
var name=""+this.name+pascalCase(type_id)
this.BaseCtor=BaseCtor
var traits=type_def.traits||[]
var state_init=[]
var factory_param_names=["BaseCtor"]
var factory_param_values=[BaseCtor]
for(var ii=0;ii<traits.length;++ii){var trait_ref=traits[ii]
assert(trait_ref.id,"Trait reference missing id")
var trait_def=this.traits[trait_ref.id]
if(!trait_def){if(!this.ignore_unknown_traits)dataError(filename+': References unknown trait type "'+trait_ref.id+'"')
continue}if(trait_def.alloc_state){var pname="s"+factory_param_names.length
factory_param_names.push(pname)
factory_param_values.push(trait_def.alloc_state)
state_init.push("this."+trait_ref.id+"_state="+pname+"(this."+trait_ref.id+"_opts, this);")}}var code
if(cap_classes)code="\nclass "+name+" extends BaseCtor {\n  constructor() {\n    super(...arguments);\n    "+state_init.join("\n")+"\n  }\n}"
else code="\nfunction "+name+"() {\n  BaseCtor.apply(this, arguments);\n  "+state_init.join("\n")+"\n}"
var Ctor=eval("(\nfunction factory("+factory_param_names.join(",")+") {\n  return "+code.trim()+";\n})").apply(null,factory_param_values)
if(!cap_classes)inherits(Ctor,BaseCtor)
var proto=Ctor.prototype
proto.type_id=type_id
for(var _ii=0;_ii<traits.length;++_ii){var _trait_ref=traits[_ii]
assert(_trait_ref.id)
var _trait_def=this.traits[_trait_ref.id]
if(!_trait_def)continue
for(var key in _trait_def.properties)proto[key]=_trait_def.properties[key]
for(var _key in _trait_def.methods)proto[_key]=_trait_def.methods[_key]
var num_custom_opts=Object.keys(_trait_ref).length-1
if(_trait_def.default_opts){var opt_key=_trait_ref.id+"_opts"
if(num_custom_opts||_trait_def.init_prototype){var _opts=clone(_trait_def.default_opts)
for(var _key2 in _trait_ref)if("id"!==_key2)_opts[_key2]=_trait_ref[_key2]
proto[opt_key]=_opts}else proto[opt_key]=_trait_def.default_opts}}for(var _key3 in type_def.properties)proto[_key3]=type_def.properties[_key3]
for(var _ii2=0;_ii2<traits.length;++_ii2){var _trait_ref2=traits[_ii2]
assert(_trait_ref2.id)
var _trait_def2=this.traits[_trait_ref2.id]
if(!_trait_def2)continue
if(_trait_def2.init_prototype){var _opt_key=_trait_ref2.id+"_opts"
_trait_def2.init_prototype(proto[_opt_key])}}this.ctors[type_id]=Ctor}
_proto.initialize=function initialize(e){var a=this
var t=e.name,i=e.fs,o=e.directory,r=e.ext,n=e.Ctor,s=e.reload_cb,l=e.ignore_unknown_traits
this.ignore_unknown_traits=l||false
this.name=t
var _=i.getFileNames(o).filter(function(e){return e.endsWith(r)})
var c={}
for(var u=0;u<_.length;++u){var d=_[u]
var f=fileBaseName(d)
if(c[f])assert(false,"Two "+t+' data files both define the same type "'+f+'": '+d+" and "+c[f])
c[f]=d
var v=i.getFile(d,"jsobj")
this.buildConstructor(d,n,f,v)}i.filewatchOn(r,function(e){if(!e.startsWith(o))return
var t=fileBaseName(e)
var r=i.getFile(e,"jsobj")
a.buildConstructor(e,n,t,r)
null==s||s(t)})
this.initialized=true}
_proto.hasType=function hasType(e){return Boolean(this.ctors[e])}
_proto.getTypes=function getTypes(){return Object.keys(this.ctors)}
_proto.allocate=function allocate(e,t){assert(this.initialized)
var r=this.ctors[e]
var a
if(!r){dataError("Missing constructor for "+this.name+' type "'+e+'"')
assert(this.BaseCtor);(a=new this.BaseCtor(t)).type_id=e}else a=new r(t)
assert.equal(a.type_id,e)
return a}
_proto.getCtorForTesting=function getCtorForTesting(e){var t=this.ctors[e]
assert(t)
return t}
return TraitFactoryImpl}()
function traitFactoryCreate(){return new TraitFactoryImpl}},{"./data_error":381,"./fsapi":389,"./util":400,assert:void 0}],399:[function(e,t,r){"use strict"
r.isDataObject=isDataObject
r.isClientHandlerSource=isClientHandlerSource
function isDataObject(e){return e?"object"===typeof e&&!Array.isArray(e):false}function isClientHandlerSource(e){return"client"===e.type}},{}],400:[function(e,t,r){"use strict"
r.nop=nop
r.identity=identity
r.once=once
r.empty=empty
r.easeInOut=easeInOut
r.easeIn=easeIn
r.easeOut=easeOut
r.clone=clone
r.merge=merge
r.has=has
r.defaults=defaults
r.defaultsDeep=defaultsDeep
r.cloneShallow=cloneShallow
r.deepEqual=deepEqual
r.deepAdd=deepAdd
r.clamp=clamp
r.lerp=lerp
r.shortAngleDist=shortAngleDist
r.lerpAngle=lerpAngle
r.mix=mix
r.map01=map01
r.sign=sign
r.mod=mod
r.log2=log2
r.ridx=ridx
r.tail=tail
r.round100=round100
r.round1000=round1000
r.fract=fract
r.nearSame=nearSame
r.nearSameAngle=nearSameAngle
r.titleCase=titleCase
r.lineCircleIntersect=lineCircleIntersect
r.lineLineIntersect=lineLineIntersect
r.inherits=inherits
r.isPowerOfTwo=isPowerOfTwo
r.nextHighestPowerOfTwo=nextHighestPowerOfTwo
r.logdata=logdata
r.isInteger=isInteger
r.toNumber=toNumber
r.randomNot=randomNot
r.toArray=toArray
r.arrayToSet=arrayToSet
r.objectToSet=objectToSet
r.matchAll=matchAll
r.callEach=callEach
r.sanitize=sanitize
r.plural=plural
r.secondsToFriendlyString=secondsToFriendlyString
r.secondsSince2020=secondsSince2020
r.dateToSafeLocaleString=dateToSafeLocaleString
r.dateToFileTimestamp=dateToFileTimestamp
r.msToTimeString=msToTimeString
r.removeSymbols=removeSymbols
r.cleanupStringArray=cleanupStringArray
r.cleanStringSplit=cleanStringSplit
r.eatPossiblePromise=eatPossiblePromise
r.errorString=errorString
r.deprecate=deprecate
r.callbackify=callbackify
r.unpromisify=unpromisify
r.msToSS2020=msToSS2020
r.ss2020ToMS=ss2020ToMS
r.trimEnd=trimEnd
r.cmpNumericSmart=cmpNumericSmart
r.VALID_USER_ID_REGEX=r.EMAIL_REGEX=void 0
var n=e("assert")
var a=Math.PI,u=Math.abs,s=Math.floor,i=Math.min,o=Math.max,l=Math.random,_=Math.round,c=Math.pow,d=Math.sqrt
var f=2*a
var v=/^[^\s@]+@[^\s@]+\.[^\s@]+$/
r.EMAIL_REGEX=v
var h=/^(?:fb\$|[a-z0-9])[a-z0-9_]{1,32}$/
r.VALID_USER_ID_REGEX=h
function nop(){}function identity(e){return e}function once(e){var t=false
return function(){if(t)return
t=true
e.apply(void 0,arguments)}}function empty(e){for(var t in e)return false
return true}function easeInOut(e,t){var r=c(e,t)
return r/(r+c(1-e,t))}function easeIn(e,t){return 2*easeInOut(.5*e,t)}function easeOut(e,t){return 2*easeInOut(.5+.5*e,t)-1}function clone(e){if(!e)return e
return JSON.parse(JSON.stringify(e))}function merge(e,t){for(var r in t)e[r]=t[r]
return e}function has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function defaults(e,t){for(var r in t)if(!has(e,r))e[r]=t[r]
return e}function defaultsDeep(e,t){for(var r in t)if(!has(e,r))e[r]=t[r]
else{var a=e[r]
var i=t[r]
if("object"===typeof a&&!Array.isArray(a)&&"object"===typeof i&&!Array.isArray(i))defaultsDeep(a,t[r])}return e}function cloneShallow(e){return merge({},e)}function deepEqual(e,t){if(Array.isArray(e)){if(!Array.isArray(t))return false
if(e.length!==t.length)return false
for(var r=0;r<e.length;++r)if(!deepEqual(e[r],t[r]))return false
return true}else if("object"===typeof e){if("object"!==typeof t)return false
if(!e||!t)return!e&&!t
for(var a in e)if(!deepEqual(e[a],t[a]))return false
for(var i in t)if(void 0!==t[i]&&void 0===e[i])return false
return true}return e===t}function deepAdd(e,t){n(e&&t)
for(var r in t){var a=t[r]
var i=e[r]
if("object"===typeof a){n(a)
var o=e[r]=i||{}
n.equal(typeof o,"object")
deepAdd(o,a)}else{if(!i)i=0
n("number"===typeof i)
n("number"===typeof a)
e[r]=(i||0)+a}}}function clamp(e,t,r){return i(o(t,e),r)}function lerp(e,t,r){return(1-e)*t+e*r}function shortAngleDist(e,t){var r=(t-e)%f
return 2*r%f-r}function lerpAngle(e,t,r){var a=t+shortAngleDist(t,r)*e
if(a<0)a+=f
return a}function mix(e,t,r){return(1-r)*e+r*t}function map01(e,t,r){return(e-t)/(r-t)}function sign(e){return e<0?-1:e>0?1:0}function mod(e,t){return(e%t+t)%t}function log2(e){for(var t=1,r=0;;t<<=1,++r)if(t>=e)return r}function ridx(e,t){e[t]=e[e.length-1]
e.pop()}function tail(e){if(!e.length)return null
return e[e.length-1]}function round100(e){return _(100*e)/100}function round1000(e){return _(1e3*e)/1e3}function fract(e){return e-s(e)}function nearSame(e,t,r){return u(t-e)<=r}function nearSameAngle(e,t,r){return u(shortAngleDist(e,t))<=r}function titleCase(e){return e.split(" ").map(function(e){return""+e[0].toUpperCase()+e.slice(1)}).join(" ")}var p=1e-5
function lineCircleIntersect(e,t,r,a){var i=[t[0]-e[0],t[1]-e[1]]
var o=i[0]*i[0]+i[1]*i[1]
var n=2*(i[0]*(e[0]-r[0])+i[1]*(e[1]-r[1]))
var s=r[0]*r[0]+r[1]*r[1]
s+=e[0]*e[0]+e[1]*e[1]
s-=2*(r[0]*e[0]+r[1]*e[1])
var l=n*n-4*o*(s-=a*a)
if(u(o)<p||l<0)return false
var _=(-n+d(l))/(2*o)
var c=(-n-d(l))/(2*o)
if(_>=0&&_<=1||c>=0&&c<=1)return true
return false}function lineLineIntersect(e,t,r,a){var i=(a[1]-r[1])*(t[0]-e[0])-(a[0]-r[0])*(t[1]-e[1])
var o=(a[0]-r[0])*(e[1]-r[1])-(a[1]-r[1])*(e[0]-r[0])
var n=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0])
if(0===i){if(!o&&!n)return true
return false}var s=o/i
var l=n/i
if(s<0||s>1||l<0||l>1)return false
return true}function inherits(e,t){n("function"===typeof t)
var r=e.prototype
e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})
for(var a in r)e.prototype[a]=r[a]
for(var i in t)e[i]=t[i]}function isPowerOfTwo(e){return 0===(e&e-1)}function nextHighestPowerOfTwo(e){--e
for(var t=1;t<32;t<<=1)e|=e>>t
return e+1}function logdata(e){if(void 0===e)return""
var t=JSON.stringify(e)
if(t.length<120)return t
return t.slice(0,117)+"...("+t.length+")"}function isInteger(e){return"number"===typeof e&&isFinite(e)&&s(e)===e}function toNumber(e){return Number(e)}function randomNot(e,t,r){var a
var i=r-t
do{a=s(t+l()*i)}while(a===e)
return a}function toArray(e){return Array.prototype.slice.call(e)}function arrayToSet(e){var t=Object.create(null)
for(var r=0;r<e.length;++r)t[e[r]]=true
return t}function objectToSet(e){return merge(Object.create(null),e)}function matchAll(e,t){var r=[]
var a
do{if(a=t.exec(e))r.push(a[1])}while(a)
return r}function callEach(e,t){if(e&&e.length){for(var r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i]
for(var o=0;o<e.length;++o)e[o].apply(e,a)}}var m=/[\uD800-\uDFFF\x00-\x1F\x7F\u1D54\u1D55\u2000-\u200F\u205F-\u206F\uFE00]/g
function sanitize(e){return(e||"").replace(m,"")}function plural(e,t){return t+(1===e?"":"s")}function secondsToFriendlyString(e,t){var r=s(e/86400)
var a=s((e-=60*r*60*24)/3600)
var i=s((e-=60*a*60)/60)
e-=60*i
var o=[]
if(r){var n=s(r/365.25)
if(n){r-=s(365.25*n)
o.push(n+" "+plural(n,"year"))}o.push(r+" "+plural(r,"day"))}if(a)o.push(a+" "+plural(a,"hour"))
if(i||!o.length)o.push(i+" "+plural(i,"minute"))
if(t)o.push(e+" "+plural(e,"second"))
return o.join(", ")}function secondsSince2020(){return s(Date.now()/1e3)-1577836800}function dateToSafeLocaleString(t,r,e){var a
try{a=r?t.toLocaleDateString(void 0,e):t.toLocaleString(void 0,e)}catch(e){console.error(e,"(Using toString as fallback)")
a=r?t.toDateString():t.toString()}return a}function dateToFileTimestamp(e){function pad(e){return""+(e<10?0:"")+e}return e.getFullYear()+"-"+pad(e.getMonth()+1)+"-"+pad(e.getDate())+" "+pad(e.getHours())+"_"+pad(e.getMinutes())+"_"+pad(e.getSeconds())}function msToTimeString(e,t){var r=e%1e3
var a
var i
var o
o=(i=(a=e-r)-(a%=6e4))-(i%=36e5)
i/=6e4
return((o/=36e5)?o+":":"")+(o&&i<10?"0":"")+i+":"+((a/=1e3)<10?"0":"")+a+((t=t||{}).hide_ms?"":"."+(r<10?"00":r<100?"0":"")+r)}function removeSymbols(e){return e.replace(/[.,/\\@#£!$%^&*;:<>{}|?=\-+_`'"~[\]()]/g,"").replace(/\s{1,}/g," ")}var E=arrayToSet(["am","an","and","as","at","be","by","el","for","in","is","la","las","los","of","on","or","the","that","this","to","with"])
function cleanupStringArray(e){return e.filter(function(e){return e.length>1&&e.length<=32&&!E[e]})}function cleanStringSplit(e,t){return cleanupStringArray(removeSymbols(sanitize(e)).toLowerCase().split(t).map(function(e){return e.trim()}))}function eatPossiblePromise(e){if(e&&e.catch)e.catch(nop)}function errorString(e){var t=String(e)
if("[object Object]"===t)try{t=JSON.stringify(e)}catch(e){}if(e&&e.stack&&e.message)t=String(e.message)
return t.slice(0,600)}function deprecate(e,t,r){Object.defineProperty(e,t,{get:function get(){n(false,t+" is deprecated, use "+r+" instead")
return}})}var g="undefined"!==typeof process?process.nextTick:"undefined"!==typeof window&&window.setImmediate?window.setImmediate:function(e){return setTimeout(e,1)}
function callbackify(a){return function(){var t=this
var r=arguments[arguments.length-1]
n.equal(typeof r,"function")
var e=Array.prototype.slice.call(arguments,0,-1)
a.apply(this,e).then(function(e){if(r){g(r.bind(t,null,e))
r=null}}).catch(function(e){if(r){g(r.bind(t,e))
r=null}})}}function unpromisify(e){return function(){g(e.apply.bind(e,this,arguments))}}function msToSS2020(e){return s(e/1e3)-1577836800}function ss2020ToMS(e){return 1e3*(e+1577836800)}var T=/\s/
function trimEnd(e){var t=e.length
while(t>0&&e[t-1].match(T))--t
return e.slice(0,t)}function isDigit(e){return e>="0"&&e<="9"}var y="0".charCodeAt(0)
function cmpNumericSmart(e,t){var r=0
var a=0
while(r<e.length&&a<t.length)if(isDigit(e[r]))if(isDigit(t[a])){var i=0
while(isDigit(e[r])){i*=10
i+=e.charCodeAt(r++)-y}var o=0
while(isDigit(t[a])){o*=10
o+=t.charCodeAt(a++)-y}var n=i-o
if(n)return n}else return-1
else if(isDigit(t[a]))return 1
else{var s=e[r].toLowerCase().charCodeAt(0)-t[a].toLowerCase().charCodeAt(0)
if(s)return s
r++
a++}if(r<e.length)return 1
else if(a<t.length)return-1
else return 0}},{assert:void 0}],401:[function(e,t,r){"use strict"
var a=true
function verify(e,t){if(!e&&a)throw new Error("Assertion failed"+(t?": "+t:""))
return e}(function(e){e.ok=verify
function equal(e,t){if(e===t)return true
if(a)throw new Error('Assertion failed: "'+e+'"==="'+t+'"')
return false}e.equal=equal
function dothrow(e){a=e}e.dothrow=dothrow
function shouldThrow(){return a}e.shouldThrow=shouldThrow
function unreachable(e){verify(false)
return false}e.unreachable=unreachable})(verify=verify||{})
t.exports=verify},{}],402:[function(e,t,r){"use strict"
r.vec1=vec1
r.vec2=vec2
r.ivec2=ivec2
r.vec3=vec3
r.ivec3=ivec3
r.vec4=vec4
r.v2abs=v2abs
r.v2add=v2add
r.v2addScale=v2addScale
r.v2angle=v2angle
r.v2copy=v2copy
r.v2dist=v2dist
r.v2distSq=v2distSq
r.v2div=v2div
r.v2dot=v2dot
r.v2floor=v2floor
r.v2iFloor=v2iFloor
r.v2lengthSq=v2lengthSq
r.v2length=v2length
r.v2lerp=v2lerp
r.v2mul=v2mul
r.v2normalize=v2normalize
r.v2iNormalize=v2iNormalize
r.v2round=v2round
r.v2iRound=v2iRound
r.v2same=v2same
r.v2scale=v2scale
r.v2set=v2set
r.v2sub=v2sub
r.v2linePointDist=v2linePointDist
r.v3add=v3add
r.v3iAdd=v3iAdd
r.v3addScale=v3addScale
r.v3iAddScale=v3iAddScale
r.v3angle=v3angle
r.v3copy=v3copy
r.v3cross=v3cross
r.v3determinant=v3determinant
r.v3distSq=v3distSq
r.v3dist=v3dist
r.v3div=v3div
r.v3dot=v3dot
r.v3iFloor=v3iFloor
r.v3floor=v3floor
r.v3lengthSq=v3lengthSq
r.v3length=v3length
r.v3lerp=v3lerp
r.v3iMax=v3iMax
r.v3min=v3min
r.v3iMin=v3iMin
r.v3mul=v3mul
r.v3iMul=v3iMul
r.v3mulMat4=v3mulMat4
r.m4TransformVec3=m4TransformVec3
r.v3normalize=v3normalize
r.v3iNormalize=v3iNormalize
r.v3perspectiveProject=v3perspectiveProject
r.v3pow=v3pow
r.v3round=v3round
r.v3iRound=v3iRound
r.v3same=v3same
r.v3scale=v3scale
r.v3scaleFloor=v3scaleFloor
r.v3iScale=v3iScale
r.v3set=v3set
r.v3sub=v3sub
r.v3iSub=v3iSub
r.v3zero=v3zero
r.v4add=v4add
r.v4clone=v4clone
r.v4copy=v4copy
r.v4dot=v4dot
r.v4fromRGBA=v4fromRGBA
r.v4lerp=v4lerp
r.v4mul=v4mul
r.v4mulAdd=v4mulAdd
r.v4same=v4same
r.v4scale=v4scale
r.v4set=v4set
r.v4zero=v4zero
r.mat4isFinite=mat4isFinite
r.zaxis=r.yaxis=r.xaxis=r.identity_mat4=r.identity_mat3=r.zero_vec=r.half_vec=r.unit_vec=r.rovec4=r.roivec3=r.rovec3=r.roivec2=r.rovec2=r.rovec1=r.mat4=r.mat3=void 0
var a=e("gl-mat3/create")
var i=e("gl-mat4/create")
var o=Math.abs,n=Math.acos,s=Math.max,l=Math.min,_=Math.floor,c=Math.pow,u=Math.round,d=Math.sqrt
var f=a
r.mat3=f
var v=i
r.mat4=v
function vec1(e){return new Float32Array([e||0])}var h=vec1
r.rovec1=h
function vec2(e,t){var r=new Float32Array(2)
if(e||t){r[0]=e
r[1]=t}return r}var p=vec2
r.rovec2=p
function ivec2(e,t){var r=new Int32Array(2)
if(e||t){r[0]=e
r[1]=t}return r}var m=ivec2
r.roivec2=m
function vec3(e,t,r){var a=new Float32Array(3)
if(e||t||r){a[0]=e
a[1]=t
a[2]=r}return a}var E=vec3
r.rovec3=E
function ivec3(e,t,r){var a=new Int32Array(3)
if(e||t||r){a[0]=e
a[1]=t
a[2]=r}return a}var g=ivec3
r.roivec3=g
function vec4(e,t,r,a){var i=new Float32Array(4)
if(e||t||r||a){i[0]=e
i[1]=t
i[2]=r
i[3]=a}return i}var T=vec4
r.rovec4=T
function frozenVec4(e,t,r,a){return T(e,t,r,a)}var y=frozenVec4(1,1,1,1)
r.unit_vec=y
var S=frozenVec4(.5,.5,.5,.5)
r.half_vec=S
var I=frozenVec4(0,0,0,0)
r.zero_vec=I
var A=f()
r.identity_mat3=A
var w=v()
r.identity_mat4=w
var L=frozenVec4(1,0,0,0)
r.xaxis=L
var O=frozenVec4(0,1,0,0)
r.yaxis=O
var R=frozenVec4(0,0,1,0)
r.zaxis=R
function v2abs(e,t){e[0]=o(t[0])
e[1]=o(t[1])
return e}function v2add(e,t,r){e[0]=t[0]+r[0]
e[1]=t[1]+r[1]
return e}function v2addScale(e,t,r,a){e[0]=t[0]+r[0]*a
e[1]=t[1]+r[1]*a
return e}function v2angle(e,t){var r=d((e[0]*e[0]+e[1]*e[1])*(t[0]*t[0]+t[1]*t[1]))
return n(l(s(r&&(e[0]*t[0]+e[1]*t[1])/r,-1),1))}function v2copy(e,t){e[0]=t[0]
e[1]=t[1]
return e}function v2dist(e,t){return d((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}function v2distSq(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function v2div(e,t,r){e[0]=t[0]/r[0]
e[1]=t[1]/r[1]
return e}function v2dot(e,t){return e[0]*t[0]+e[1]*t[1]}function v2floor(e,t){e[0]=_(t[0])
e[1]=_(t[1])
return e}function v2iFloor(e){e[0]=_(e[0])
e[1]=_(e[1])
return e}function v2lengthSq(e){return e[0]*e[0]+e[1]*e[1]}function v2length(e){return d(v2lengthSq(e))}function v2lerp(e,t,r,a){var i=1-t
e[0]=i*r[0]+t*a[0]
e[1]=i*r[1]+t*a[1]
return e}function v2mul(e,t,r){e[0]=t[0]*r[0]
e[1]=t[1]*r[1]
return e}function v2normalize(e,t){var r=t[0]*t[0]+t[1]*t[1]
if(r>0){r=1/d(r)
e[0]=t[0]*r
e[1]=t[1]*r}return e}function v2iNormalize(e){var t=e[0]*e[0]+e[1]*e[1]
if(t>0){t=1/d(t)
e[0]*=t
e[1]*=t}return e}function v2round(e,t){e[0]=u(t[0])
e[1]=u(t[1])
return e}function v2iRound(e){e[0]=u(e[0])
e[1]=u(e[1])
return e}function v2same(e,t){return e[0]===t[0]&&e[1]===t[1]}function v2scale(e,t,r){e[0]=t[0]*r
e[1]=t[1]*r
return e}function v2set(e,t,r){e[0]=t
e[1]=r
return e}function v2sub(e,t,r){e[0]=t[0]-r[0]
e[1]=t[1]-r[1]
return e}var b=vec2()
function v2linePointDist(e,t,r){v2sub(b,t,e)
var a=v2lengthSq(b)
if(!a)return v2dist(e,r)
var i=((r[0]-e[0])*b[0]+(r[1]-e[1])*b[1])/a
if(i<=0)return v2dist(e,r)
else if(i>=1)return v2dist(t,r)
v2addScale(b,e,b,i)
return v2dist(b,r)}function v3add(e,t,r){e[0]=t[0]+r[0]
e[1]=t[1]+r[1]
e[2]=t[2]+r[2]
return e}function v3iAdd(e,t){e[0]+=t[0]
e[1]+=t[1]
e[2]+=t[2]
return e}function v3addScale(e,t,r,a){e[0]=t[0]+r[0]*a
e[1]=t[1]+r[1]*a
e[2]=t[2]+r[2]*a
return e}function v3iAddScale(e,t,r){e[0]+=t[0]*r
e[1]+=t[1]*r
e[2]+=t[2]*r
return e}function v3angle(e,t){var r=d((e[0]*e[0]+e[1]*e[1]+e[2]*e[2])*(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))
return n(l(s(r&&(e[0]*t[0]+e[1]*t[1]+e[2]*t[2])/r,-1),1))}function v3copy(e,t){e[0]=t[0]
e[1]=t[1]
e[2]=t[2]
return e}function v3cross(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=r[0]
var s=r[1]
var l=r[2]
e[0]=i*l-o*s
e[1]=o*n-a*l
e[2]=a*s-i*n
return e}function v3determinant(e,t,r){var a=e[0]
var i=t[0]
var o=r[0]
var n=e[1]
var s=t[1]
var l=r[1]
var _=e[2]
var c=t[2]
var u=r[2]
return a*(u*s-l*c)+i*(-u*n+l*_)+o*(c*n-s*_)}function v3distSq(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])}function v3dist(e,t){return d(v3distSq(e,t))}function v3div(e,t,r){e[0]=t[0]/r[0]
e[1]=t[1]/r[1]
e[2]=t[2]/r[2]
return e}function v3dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function v3iFloor(e){e[0]=_(e[0])
e[1]=_(e[1])
e[2]=_(e[2])
return e}function v3floor(e,t){e[0]=_(t[0])
e[1]=_(t[1])
e[2]=_(t[2])
return e}function v3lengthSq(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function v3length(e){return d(v3lengthSq(e))}function v3lerp(e,t,r,a){var i=1-t
e[0]=i*r[0]+t*a[0]
e[1]=i*r[1]+t*a[1]
e[2]=i*r[2]+t*a[2]
return e}function v3iMax(e,t){e[0]=s(e[0],t[0])
e[1]=s(e[1],t[1])
e[2]=s(e[2],t[2])
return e}function v3min(e,t,r){e[0]=l(t[0],r[0])
e[1]=l(t[1],r[1])
e[2]=l(t[2],r[2])
return e}function v3iMin(e,t){e[0]=l(e[0],t[0])
e[1]=l(e[1],t[1])
e[2]=l(e[2],t[2])
return e}function v3mul(e,t,r){e[0]=t[0]*r[0]
e[1]=t[1]*r[1]
e[2]=t[2]*r[2]
return e}function v3iMul(e,t){e[0]*=t[0]
e[1]*=t[1]
e[2]*=t[2]
return e}function v3mulMat4(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
e[0]=a*r[0]+i*r[4]+o*r[8]
e[1]=a*r[1]+i*r[5]+o*r[9]
e[2]=a*r[2]+i*r[6]+o*r[10]
return e}function m4TransformVec3(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
e[0]=a*r[0]+i*r[4]+o*r[8]+r[12]
e[1]=a*r[1]+i*r[5]+o*r[9]+r[13]
e[2]=a*r[2]+i*r[6]+o*r[10]+r[14]
return e}function v3normalize(e,t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]
if(r>0){r=1/d(r)
e[0]=t[0]*r
e[1]=t[1]*r
e[2]=t[2]*r}return e}function v3iNormalize(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]
if(t>0){t=1/d(t)
e[0]*=t
e[1]*=t
e[2]*=t}return e}function v3perspectiveProject(e,t,r){var a=t[0]
var i=t[1]
var o=t[2]
var n=.5/(r[3]*a+r[7]*i+r[11]*o+r[15]||1e-5)
e[0]=(r[0]*a+r[4]*i+r[8]*o+r[12])*n+.5
e[1]=(r[1]*a+r[5]*i+r[9]*o+r[13])*-n+.5
e[2]=r[2]*a+r[6]*i+r[10]*o+r[14]
return e}function v3pow(e,t,r){e[0]=c(t[0],r)
e[1]=c(t[1],r)
e[2]=c(t[2],r)
return e}function v3round(e,t){e[0]=u(t[0])
e[1]=u(t[1])
e[2]=u(t[2])
return e}function v3iRound(e){e[0]=u(e[0])
e[1]=u(e[1])
e[2]=u(e[2])
return e}function v3same(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function v3scale(e,t,r){e[0]=t[0]*r
e[1]=t[1]*r
e[2]=t[2]*r
return e}function v3scaleFloor(e,t,r){e[0]=_(t[0]*r)
e[1]=_(t[1]*r)
e[2]=_(t[2]*r)
return e}function v3iScale(e,t){e[0]*=t
e[1]*=t
e[2]*=t
return e}function v3set(e,t,r,a){e[0]=t
e[1]=r
e[2]=a
return e}function v3sub(e,t,r){e[0]=t[0]-r[0]
e[1]=t[1]-r[1]
e[2]=t[2]-r[2]
return e}function v3iSub(e,t){e[0]-=t[0]
e[1]-=t[1]
e[2]-=t[2]
return e}function v3zero(e){e[0]=e[1]=e[2]=0
return e}function v4add(e,t,r){e[0]=t[0]+r[0]
e[1]=t[1]+r[1]
e[2]=t[2]+r[2]
e[3]=t[3]+r[3]
return e}function v4clone(e){return e.slice(0)}function v4copy(e,t){e[0]=t[0]
e[1]=t[1]
e[2]=t[2]
e[3]=t[3]
return e}function v4dot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function v4fromRGBA(e){return vec4((e>>>24)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255)}function v4lerp(e,t,r,a){var i=1-t
e[0]=i*r[0]+t*a[0]
e[1]=i*r[1]+t*a[1]
e[2]=i*r[2]+t*a[2]
e[3]=i*r[3]+t*a[3]
return e}function v4mul(e,t,r){e[0]=t[0]*r[0]
e[1]=t[1]*r[1]
e[2]=t[2]*r[2]
e[3]=t[3]*r[3]
return e}function v4mulAdd(e,t,r,a){e[0]=t[0]*r[0]+a[0]
e[1]=t[1]*r[1]+a[1]
e[2]=t[2]*r[2]+a[2]
e[3]=t[3]*r[3]+a[3]
return e}function v4same(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function v4scale(e,t,r){e[0]=t[0]*r
e[1]=t[1]*r
e[2]=t[2]*r
e[3]=t[3]*r
return e}function v4set(e,t,r,a,i){e[0]=t
e[1]=r
e[2]=a
e[3]=i
return e}function v4zero(e){e[0]=e[1]=e[2]=e[3]=0
return e}function mat4isFinite(e){return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(e[3])&&isFinite(e[4])&&isFinite(e[5])&&isFinite(e[6])&&isFinite(e[7])&&isFinite(e[8])&&isFinite(e[9])&&isFinite(e[10])&&isFinite(e[11])&&isFinite(e[12])&&isFinite(e[13])&&isFinite(e[14])&&isFinite(e[15])}},{"gl-mat3/create":void 0,"gl-mat4/create":void 0}],403:[function(e,t,r){"use strict"
r.profanityCommonStartup=profanityCommonStartup
r.profanitySetReplacementChars=profanitySetReplacementChars
r.reservedStartup=reservedStartup
r.profanityFilterCommon=profanityFilterCommon
r.isProfane=isProfane
r.isReserved=isReserved
var u=e("assert")
var d=Math.max
var f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+"
var v="4bcd3fgh1jk1mn0pqr57uvwxy24bcd3fgh1jk1mn0pqr57uvwxy201234567897"
var a=/\S+/g
var h={}
var i={}
function cannonizeCharacter(e){e=i[e]||e
return h[e]||""}function canonize(e){return e.split("").map(cannonizeCharacter).join("")}function rot13(e){return e.split("").map(function(e){if((e=e.charCodeAt(0))>=97&&e<=122)e=97+(e-97+13)%26
else if(e>=65&&e<=90)e=65+(e-65+13)%26
return String.fromCharCode(e)}).join("")}var p={}
var n={}
var s=["","s","s","in","ing","er","ers","ed","y"]
var m=["","5","35","1n","1ng","3r","3r5","3d","y"]
var E=0
var g=false
function profanityCommonStartup(e,t){u(!g)
g=true
for(var r=0;r<f.length;++r)h[f[r]]=v[r]
var a=e.split("\n").filter(function(e){return e})
for(var i=0;i<a.length;++i){var o=rot13(a[i])
var n=o.length
o=canonize(o)
u.equal(n,o.length)
for(var s=0;s<m.length;++s){var l=o+m[s]
var _=p[l]
if(!_||_>s){E=d(E,l.length)
p[l]=s+1}}}a=t.split("\n").filter(function(e){return e})
for(var c=0;c<a.length;++c)delete p[canonize(a[c])]}function profanitySetReplacementChars(e){u(e)
for(var t in e){var r=e[t]
r=String.fromCharCode(r)
var a=String.fromCharCode(Number(t))
if(" "===r)if(""!==a.trim()){console.log("Invalid whitespace replacement character: "+t)
continue}i[a]=r}}var l=[]
function reservedStartup(e,t){var r=e.split("\n").filter(function(e){return e})
for(var a=0;a<r.length;++a){var i=canonize(r[a])
n[i]=1}for(var o=0;o<t.length;++o)l.push(canonize(t[o]))}var _
function filterWord(e){if(e.length>=E)return e
var t=e[0].toUpperCase()===e[0]
var r=canonize(e)
var a=p[r]
if(!a)return e;--a
var i=_()
if(t)i=i[0].toUpperCase()+i.slice(1)
var o=s[a]
if(i[i.length-1]===o[0])o=o.slice(1)
if(i.endsWith("e")&&"i"===o[0])i=i.slice(0,-1)
return i+o}var o
function checkWord(e){if(e.length>=E)return
if(p[canonize(e)])o=true}function profanityFilterCommon(e,t){u(g)
_=t
return e.replace(a,filterWord)}function isProfane(e){u(g)
o=false
e.replace(a,checkWord)
return o}var c
function checkReserved(e){e=canonize(e)
if(n[e])c=true
for(var t=0;t<l.length;++t)if(e.includes(l[t]))c=true}function isReserved(e){u(g)
c=false
e.replace(a,checkReserved)
var t=canonize(e.replace(/[\s_.]/g,""))
for(var r=0;r<l.length;++r)if(t.includes(l[r]))c=true
return c}},{assert:void 0}],404:[function(e,t,r){"use strict"
r.netDelaySet=netDelaySet
r.netDelayGet=netDelayGet
r.wsPakSendDest=wsPakSendDest
r.wsPak=wsPak
r.sendMessage=sendMessage
r.wsHandleMessage=wsHandleMessage
r.PING_TIME=r.CONNECTION_TIMEOUT=r.wsstats_out=r.wsstats=void 0
var i={msgs:0,bytes:0}
r.wsstats=i
var o={msgs:0,bytes:0}
r.wsstats_out=o
var a=e("./ack.js")
var c=e("assert")
var s=a.ackHandleMessage,u=a.ackReadHeader,n=a.ackWrapPakStart,l=a.ackWrapPakPayload,d=a.ackWrapPakFinish
var _=Math.random,f=Math.round
var v=e("./packet.js"),h=v.isPacket,p=v.packetCreate,m=v.packetDefaultFlags,E=v.packetFromBuffer
var g=e("./perfcounters.js").perfCounterAddValue
var T=6e4
var y=(r.CONNECTION_TIMEOUT=T)/2
r.PING_TIME=y
var S=28
var I=0
var A=0
function socketSendInternal(e,t,r){if(e.ws_server)e.socket.send(t,r.pool.bind(r))
else{e.socket.send(t)
r.pool()}}function netDelaySet(e,t){if(void 0===e){e=100
t=50}if(e)console.log("NetDelay: ON ("+e+"+"+t+")")
else console.log("NetDelay: Off")
I=e
A=t}function netDelayGet(){return[I,A]}function NetDelayer(e,t){this.client=e
this.head=null
this.tail=null
this.tick=this.tickFn.bind(this)}NetDelayer.prototype.send=function(e,t){var r=Date.now()
var a=f(I+A*_())
var i={buf:e,pak:t,time:r+a,next:null}
if(this.tail){this.tail.next=i
this.tail=i}else{this.head=this.tail=i
setTimeout(this.tick,a)}}
NetDelayer.prototype.tickFn=function(){var e=this.client
if(e.net_delayer!==this){while(this.head){var t=this.head
t.pak.pool()
this.head=t.next}this.tail=null
return}var r=Date.now()
do{var a=this.head
this.head=a.next
if(!this.head)this.tail=null
socketSendInternal(e,a.buf,a.pak)}while(this.head&&this.head.time<=r)
if(this.head)setTimeout(this.tick,this.head.time-r)}
function wsPakSendDest(e,t){if(!e.connected||1!==e.socket.readyState){console.warn("Attempting to send on a disconnected link (client_id:"+e.id+"), ignoring")
t.pool()
return}var r=t.getBuffer()
var a=t.getBufferLen()
if(a!==r.length)r=new Uint8Array(r.buffer,r.byteOffset,a)
g("net.send_bytes.total",r.length)
o.msgs++
o.bytes+=r.length
if(I){if(!e.net_delayer)e.net_delayer=new NetDelayer(e)
e.net_delayer.send(r,t)}else socketSendInternal(e,r,t)
e.last_send_time=Date.now()}function wsPakSendFinish(e,t,r){var a=e.ws_data,i=a.client,o=a.msg
delete e.ws_data
var n=d(e,t,r)
if(!i.connected||1!==i.socket.readyState){if("channel_msg"===o){e.seek(0)
e.readFlags()
var s=u(e)
var l
var _
if(h(s.data)){e.ref()
l=e.readAnsiString()
_=e.readAnsiString()
if(!e.ended())e.pool()}else{l=s.data.channel_id
_=s.data.msg}o="channel_msg:"+l+":"+_}if("number"!==typeof o){(i.log?i:console).log("Attempting to send msg="+o+" on a disconnected link, ignoring")
if(!i.log&&i.onError&&o)i.onError("Attempting to send msg="+o+" on a disconnected link")}if(n)delete i.resp_cbs[n]
e.pool()
return}c.equal(Boolean(r&&false!==r.expecting_response),Boolean(n))
wsPakSendDest(i,e)}function wsPakSend(e,t){if("function"===typeof e&&!t){t=e
e=null}wsPakSendFinish(this,e,t)}function wsPak(e,t,r,a){c("string"===typeof e||"number"===typeof e)
var i=p(t?t.getInternalFlags():m(),t?t.totalSize()+S:0)
i.writeFlags()
n(i,r,e,a)
i.ws_data={msg:e,client:r}
i.send=wsPakSend
return i}function sendMessageInternal(e,t,r,a,i,o){var n=wsPak(t,h(a)?a:null,e,i)
if(!r)l(n,a)
n.send(r,o)}function sendMessage(e,t,r,a){sendMessageInternal(this,e,null,t,r,a)}function wsHandleMessage(o,e,t){++i.msgs
var r=Date.now()
var n=o.id?"client "+o.id:"server"
if(!(e instanceof Uint8Array)){(o.log?o:console).log("Received incorrect WebSocket data type from "+n+" ("+typeof e+")")
if("string"===typeof e)(o.log?o:console).log("Invalid WebSocket data: "+JSON.stringify(e.slice(0,120)))
if(o.ws_server){if(!o.has_warned_about_text){o.has_warned_about_text=true
o.send("error","Server received non-binary WebSocket data.  Likely cause is a proxy, VPN or something else intercepting and modifying network traffic.")}return}return void o.onError("Invalid data received")}i.bytes+=e.length
var a=E(e,e.length,false)
a.readFlags()
o.last_receive_time=r
o.idle_counter=0
return void s(o,n,a,function sendFunc(e,t,r,a){if(a&&!a.expecting_response)a=null
sendMessageInternal(o,e,t,r,null,a)},function pakFunc(e,t){return wsPak(e,t,o)},function handleFunc(e,t,r){var a=o.handlers[e]
if(!a){var i="No handler for message "+JSON.stringify(e)+" from "+n
console.error(i,h(t)?t.contents():t)
if(o.onError)return o.onError(i)
return r(i)}return a(o,t,r)},t)}},{"./ack.js":376,"./packet.js":392,"./perfcounters.js":393,assert:void 0}]},{},[11])

//# sourceMappingURL=app.bundle.js.map
